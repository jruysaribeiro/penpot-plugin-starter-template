var Xi=v=>{throw TypeError(v)};var qA=(v,bI,oI)=>bI.has(v)||Xi("Cannot "+oI);var $=(v,bI,oI)=>(qA(v,bI,"read from private field"),oI?oI.call(v):bI.get(v)),PI=(v,bI,oI)=>bI.has(v)?Xi("Cannot add the same private member more than once"):bI instanceof WeakSet?bI.add(v):bI.set(v,oI),uI=(v,bI,oI,ag)=>(qA(v,bI,"write to private field"),ag?ag.call(v,oI):bI.set(v,oI),oI),fI=(v,bI,oI)=>(qA(v,bI,"access private method"),oI);var Ri=(v,bI,oI,ag)=>({set _(CA){uI(v,bI,CA,oI)},get _(){return $(v,bI,ag)}});(function(){"use strict";var Wg,TI,Ig,Sg,$C,pg,Fg,eI,IA,yi,ui,XC,IC,gA;var v=typeof document<"u"?document.currentScript:null;function bI(G){return G&&G.__esModule&&Object.prototype.hasOwnProperty.call(G,"default")?G.default:G}var oI={exports:{}},ag;function CA(){return ag||(ag=1,function(G){(function(){function I(){var g=this;this.versionnumber="1.2.6",this.imageToSVG=function(C,A,l){l=g.checkoptions(l),g.loadImage(C,function(i){A(g.imagedataToSVG(g.getImgdata(i),l))},l)},this.imagedataToSVG=function(C,A){A=g.checkoptions(A);var l=g.imagedataToTracedata(C,A);return g.getsvgstring(l,A)},this.imageToTracedata=function(C,A,l){l=g.checkoptions(l),g.loadImage(C,function(i){A(g.imagedataToTracedata(g.getImgdata(i),l))},l)},this.imagedataToTracedata=function(C,A){A=g.checkoptions(A);var l=g.colorquantization(C,A);if(A.layering===0)for(var i={layers:[],palette:l.palette,width:l.array[0].length-2,height:l.array.length-2},Z=0;Z<l.palette.length;Z++){var d=g.batchtracepaths(g.internodes(g.pathscan(g.layeringstep(l,Z),A.pathomit),A),A.ltres,A.qtres);i.layers.push(d)}else{var s=g.layering(l);A.layercontainerid&&g.drawLayers(s,g.specpalette,A.scale,A.layercontainerid);var c=g.batchpathscan(s,A.pathomit),b=g.batchinternodes(c,A),i={layers:g.batchtracelayers(b,A.ltres,A.qtres),palette:l.palette,width:C.width,height:C.height}}return i},this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.checkoptions=function(C){C=C||{},typeof C=="string"&&(C=C.toLowerCase(),g.optionpresets[C]?C=g.optionpresets[C]:C={});for(var A=Object.keys(g.optionpresets.default),l=0;l<A.length;l++)C.hasOwnProperty(A[l])||(C[A[l]]=g.optionpresets.default[A[l]]);return C},this.colorquantization=function(C,A){var l=[],i=0,Z,d,s,c=[],b=C.width*C.height,m,B,W,o,h;if(C.data.length<b*4){for(var w=new Uint8ClampedArray(b*4),a=0;a<b;a++)w[a*4]=C.data[a*3],w[a*4+1]=C.data[a*3+1],w[a*4+2]=C.data[a*3+2],w[a*4+3]=255;C.data=w}for(B=0;B<C.height+2;B++)for(l[B]=[],m=0;m<C.width+2;m++)l[B][m]=-1;for(A.pal?h=A.pal:A.colorsampling===0?h=g.generatepalette(A.numberofcolors):A.colorsampling===1?h=g.samplepalette(A.numberofcolors,C):h=g.samplepalette2(A.numberofcolors,C),A.blurradius>0&&(C=g.blur(C,A.blurradius,A.blurdelta)),o=0;o<A.colorquantcycles;o++){if(o>0)for(W=0;W<h.length;W++)c[W].n>0&&(h[W]={r:Math.floor(c[W].r/c[W].n),g:Math.floor(c[W].g/c[W].n),b:Math.floor(c[W].b/c[W].n),a:Math.floor(c[W].a/c[W].n)}),c[W].n/b<A.mincolorratio&&o<A.colorquantcycles-1&&(h[W]={r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255),a:Math.floor(Math.random()*255)});for(m=0;m<h.length;m++)c[m]={r:0,g:0,b:0,a:0,n:0};for(B=0;B<C.height;B++)for(m=0;m<C.width;m++){for(i=(B*C.width+m)*4,s=0,d=1024,W=0;W<h.length;W++)Z=Math.abs(h[W].r-C.data[i])+Math.abs(h[W].g-C.data[i+1])+Math.abs(h[W].b-C.data[i+2])+Math.abs(h[W].a-C.data[i+3]),Z<d&&(d=Z,s=W);c[s].r+=C.data[i],c[s].g+=C.data[i+1],c[s].b+=C.data[i+2],c[s].a+=C.data[i+3],c[s].n++,l[B+1][m+1]=s}}return{array:l,palette:h}},this.samplepalette=function(C,A){for(var l,i=[],Z=0;Z<C;Z++)l=Math.floor(Math.random()*A.data.length/4)*4,i.push({r:A.data[l],g:A.data[l+1],b:A.data[l+2],a:A.data[l+3]});return i},this.samplepalette2=function(C,A){for(var l,i=[],Z=Math.ceil(Math.sqrt(C)),d=Math.ceil(C/Z),s=A.width/(Z+1),c=A.height/(d+1),b=0;b<d;b++)for(var m=0;m<Z&&i.length!==C;m++)l=Math.floor((b+1)*c*A.width+(m+1)*s)*4,i.push({r:A.data[l],g:A.data[l+1],b:A.data[l+2],a:A.data[l+3]});return i},this.generatepalette=function(C){var A=[],l,i,Z;if(C<8)for(var d=Math.floor(255/(C-1)),s=0;s<C;s++)A.push({r:s*d,g:s*d,b:s*d,a:255});else{var c=Math.floor(Math.pow(C,.3333333333333333)),b=Math.floor(255/(c-1)),m=C-c*c*c;for(l=0;l<c;l++)for(i=0;i<c;i++)for(Z=0;Z<c;Z++)A.push({r:l*b,g:i*b,b:Z*b,a:255});for(l=0;l<m;l++)A.push({r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255),a:Math.floor(Math.random()*255)})}return A},this.layering=function(C){var A=[],l=0,i=C.array.length,Z=C.array[0].length,d,s,c,b,m,B,W,o,h,w,a;for(a=0;a<C.palette.length;a++)for(A[a]=[],w=0;w<i;w++)for(A[a][w]=[],h=0;h<Z;h++)A[a][w][h]=0;for(w=1;w<i-1;w++)for(h=1;h<Z-1;h++)l=C.array[w][h],d=C.array[w-1][h-1]===l?1:0,s=C.array[w-1][h]===l?1:0,c=C.array[w-1][h+1]===l?1:0,b=C.array[w][h-1]===l?1:0,m=C.array[w][h+1]===l?1:0,B=C.array[w+1][h-1]===l?1:0,W=C.array[w+1][h]===l?1:0,o=C.array[w+1][h+1]===l?1:0,A[l][w+1][h+1]=1+m*2+o*4+W*8,b||(A[l][w+1][h]=2+W*4+B*8),s||(A[l][w][h+1]=0+c*2+m*4+8),d||(A[l][w][h]=0+s*2+4+b*8);return A},this.layeringstep=function(C,A){var l=[],i=C.array.length,Z=C.array[0].length,d,s;for(s=0;s<i;s++)for(l[s]=[],d=0;d<Z;d++)l[s][d]=0;for(s=1;s<i;s++)for(d=1;d<Z;d++)l[s][d]=(C.array[s-1][d-1]===A?1:0)+(C.array[s-1][d]===A?2:0)+(C.array[s][d-1]===A?8:0)+(C.array[s][d]===A?4:0);return l},this.pointinpoly=function(C,A){for(var l=!1,i=0,Z=A.length-1;i<A.length;Z=i++)l=A[i].y>C.y!=A[Z].y>C.y&&C.x<(A[Z].x-A[i].x)*(C.y-A[i].y)/(A[Z].y-A[i].y)+A[i].x?!l:l;return l},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.pathscan=function(C,A){for(var l=[],i=0,Z=0,d=0,s=0,c=C[0].length,b=C.length,m=0,B=!0,W=!1,o,h=0;h<b;h++)for(var w=0;w<c;w++)if(C[h][w]==4||C[h][w]==11)for(d=w,s=h,l[i]={},l[i].points=[],l[i].boundingbox=[d,s,d,s],l[i].holechildren=[],B=!1,Z=0,W=C[h][w]==11,m=1;!B;){if(l[i].points[Z]={},l[i].points[Z].x=d-1,l[i].points[Z].y=s-1,l[i].points[Z].t=C[s][d],d-1<l[i].boundingbox[0]&&(l[i].boundingbox[0]=d-1),d-1>l[i].boundingbox[2]&&(l[i].boundingbox[2]=d-1),s-1<l[i].boundingbox[1]&&(l[i].boundingbox[1]=s-1),s-1>l[i].boundingbox[3]&&(l[i].boundingbox[3]=s-1),o=g.pathscan_combined_lookup[C[s][d]][m],C[s][d]=o[0],m=o[1],d+=o[2],s+=o[3],d-1===l[i].points[0].x&&s-1===l[i].points[0].y)if(B=!0,l[i].points.length<A)l.pop();else{if(l[i].isholepath=!!W,W){for(var a=0,Y=[-1,-1,c+1,b+1],V=0;V<i;V++)!l[V].isholepath&&g.boundingboxincludes(l[V].boundingbox,l[i].boundingbox)&&g.boundingboxincludes(Y,l[V].boundingbox)&&g.pointinpoly(l[i].points[0],l[V].points)&&(a=V,Y=l[V].boundingbox);l[a].holechildren.push(i)}i++}Z++}return l},this.boundingboxincludes=function(C,A){return C[0]<A[0]&&C[1]<A[1]&&C[2]>A[2]&&C[3]>A[3]},this.batchpathscan=function(C,A){var l=[];for(var i in C)C.hasOwnProperty(i)&&(l[i]=g.pathscan(C[i],A));return l},this.internodes=function(C,A){var l=[],i=0,Z=0,d=0,s=0,c=0,b,m;for(b=0;b<C.length;b++)for(l[b]={},l[b].points=[],l[b].boundingbox=C[b].boundingbox,l[b].holechildren=C[b].holechildren,l[b].isholepath=C[b].isholepath,i=C[b].points.length,m=0;m<i;m++)Z=(m+1)%i,d=(m+2)%i,s=(m-1+i)%i,c=(m-2+i)%i,A.rightangleenhance&&g.testrightangle(C[b],c,s,m,Z,d)&&(l[b].points.length>0&&(l[b].points[l[b].points.length-1].linesegment=g.getdirection(l[b].points[l[b].points.length-1].x,l[b].points[l[b].points.length-1].y,C[b].points[m].x,C[b].points[m].y)),l[b].points.push({x:C[b].points[m].x,y:C[b].points[m].y,linesegment:g.getdirection(C[b].points[m].x,C[b].points[m].y,(C[b].points[m].x+C[b].points[Z].x)/2,(C[b].points[m].y+C[b].points[Z].y)/2)})),l[b].points.push({x:(C[b].points[m].x+C[b].points[Z].x)/2,y:(C[b].points[m].y+C[b].points[Z].y)/2,linesegment:g.getdirection((C[b].points[m].x+C[b].points[Z].x)/2,(C[b].points[m].y+C[b].points[Z].y)/2,(C[b].points[Z].x+C[b].points[d].x)/2,(C[b].points[Z].y+C[b].points[d].y)/2)});return l},this.testrightangle=function(C,A,l,i,Z,d){return C.points[i].x===C.points[A].x&&C.points[i].x===C.points[l].x&&C.points[i].y===C.points[Z].y&&C.points[i].y===C.points[d].y||C.points[i].y===C.points[A].y&&C.points[i].y===C.points[l].y&&C.points[i].x===C.points[Z].x&&C.points[i].x===C.points[d].x},this.getdirection=function(C,A,l,i){var Z=8;return C<l?A<i?Z=1:A>i?Z=7:Z=0:C>l?A<i?Z=3:A>i?Z=5:Z=4:A<i?Z=2:A>i?Z=6:Z=8,Z},this.batchinternodes=function(C,A){var l=[];for(var i in C)C.hasOwnProperty(i)&&(l[i]=g.internodes(C[i],A));return l},this.tracepath=function(C,A,l){var i=0,Z,d,s,c={};for(c.segments=[],c.boundingbox=C.boundingbox,c.holechildren=C.holechildren,c.isholepath=C.isholepath;i<C.points.length;){for(Z=C.points[i].linesegment,d=-1,s=i+1;(C.points[s].linesegment===Z||C.points[s].linesegment===d||d===-1)&&s<C.points.length-1;)C.points[s].linesegment!==Z&&d===-1&&(d=C.points[s].linesegment),s++;s===C.points.length-1&&(s=0),c.segments=c.segments.concat(g.fitseq(C,A,l,i,s)),s>0?i=s:i=C.points.length}return c},this.fitseq=function(C,A,l,i,Z){if(Z>C.points.length||Z<0)return[];var d=i,s=0,c=!0,b,m,B,W=Z-i;W<0&&(W+=C.points.length);for(var o=(C.points[Z].x-C.points[i].x)/W,h=(C.points[Z].y-C.points[i].y)/W,w=(i+1)%C.points.length,a;w!=Z;)a=w-i,a<0&&(a+=C.points.length),b=C.points[i].x+o*a,m=C.points[i].y+h*a,B=(C.points[w].x-b)*(C.points[w].x-b)+(C.points[w].y-m)*(C.points[w].y-m),B>A&&(c=!1),B>s&&(d=w,s=B),w=(w+1)%C.points.length;if(c)return[{type:"L",x1:C.points[i].x,y1:C.points[i].y,x2:C.points[Z].x,y2:C.points[Z].y}];var Y=d;c=!0,s=0;var V=(Y-i)/W,n=(1-V)*(1-V),e=2*(1-V)*V,t=V*V,N=(n*C.points[i].x+t*C.points[Z].x-C.points[Y].x)/-e,R=(n*C.points[i].y+t*C.points[Z].y-C.points[Y].y)/-e;for(w=i+1;w!=Z;)V=(w-i)/W,n=(1-V)*(1-V),e=2*(1-V)*V,t=V*V,b=n*C.points[i].x+e*N+t*C.points[Z].x,m=n*C.points[i].y+e*R+t*C.points[Z].y,B=(C.points[w].x-b)*(C.points[w].x-b)+(C.points[w].y-m)*(C.points[w].y-m),B>l&&(c=!1),B>s&&(d=w,s=B),w=(w+1)%C.points.length;if(c)return[{type:"Q",x1:C.points[i].x,y1:C.points[i].y,x2:N,y2:R,x3:C.points[Z].x,y3:C.points[Z].y}];var H=Y;return g.fitseq(C,A,l,i,H).concat(g.fitseq(C,A,l,H,Z))},this.batchtracepaths=function(C,A,l){var i=[];for(var Z in C)C.hasOwnProperty(Z)&&i.push(g.tracepath(C[Z],A,l));return i},this.batchtracelayers=function(C,A,l){var i=[];for(var Z in C)C.hasOwnProperty(Z)&&(i[Z]=g.batchtracepaths(C[Z],A,l));return i},this.roundtodec=function(C,A){return+C.toFixed(A)},this.svgpathstring=function(C,A,l,i){var Z=C.layers[A],d=Z[l],s="",c;if(i.linefilter&&d.segments.length<3)return s;if(s="<path "+(i.desc?'desc="l '+A+" p "+l+'" ':"")+g.tosvgcolorstr(C.palette[A],i)+'d="',i.roundcoords===-1){for(s+="M "+d.segments[0].x1*i.scale+" "+d.segments[0].y1*i.scale+" ",c=0;c<d.segments.length;c++)s+=d.segments[c].type+" "+d.segments[c].x2*i.scale+" "+d.segments[c].y2*i.scale+" ",d.segments[c].hasOwnProperty("x3")&&(s+=d.segments[c].x3*i.scale+" "+d.segments[c].y3*i.scale+" ");s+="Z "}else{for(s+="M "+g.roundtodec(d.segments[0].x1*i.scale,i.roundcoords)+" "+g.roundtodec(d.segments[0].y1*i.scale,i.roundcoords)+" ",c=0;c<d.segments.length;c++)s+=d.segments[c].type+" "+g.roundtodec(d.segments[c].x2*i.scale,i.roundcoords)+" "+g.roundtodec(d.segments[c].y2*i.scale,i.roundcoords)+" ",d.segments[c].hasOwnProperty("x3")&&(s+=g.roundtodec(d.segments[c].x3*i.scale,i.roundcoords)+" "+g.roundtodec(d.segments[c].y3*i.scale,i.roundcoords)+" ");s+="Z "}for(var b=0;b<d.holechildren.length;b++){var m=Z[d.holechildren[b]];if(i.roundcoords===-1)for(m.segments[m.segments.length-1].hasOwnProperty("x3")?s+="M "+m.segments[m.segments.length-1].x3*i.scale+" "+m.segments[m.segments.length-1].y3*i.scale+" ":s+="M "+m.segments[m.segments.length-1].x2*i.scale+" "+m.segments[m.segments.length-1].y2*i.scale+" ",c=m.segments.length-1;c>=0;c--)s+=m.segments[c].type+" ",m.segments[c].hasOwnProperty("x3")&&(s+=m.segments[c].x2*i.scale+" "+m.segments[c].y2*i.scale+" "),s+=m.segments[c].x1*i.scale+" "+m.segments[c].y1*i.scale+" ";else for(m.segments[m.segments.length-1].hasOwnProperty("x3")?s+="M "+g.roundtodec(m.segments[m.segments.length-1].x3*i.scale)+" "+g.roundtodec(m.segments[m.segments.length-1].y3*i.scale)+" ":s+="M "+g.roundtodec(m.segments[m.segments.length-1].x2*i.scale)+" "+g.roundtodec(m.segments[m.segments.length-1].y2*i.scale)+" ",c=m.segments.length-1;c>=0;c--)s+=m.segments[c].type+" ",m.segments[c].hasOwnProperty("x3")&&(s+=g.roundtodec(m.segments[c].x2*i.scale)+" "+g.roundtodec(m.segments[c].y2*i.scale)+" "),s+=g.roundtodec(m.segments[c].x1*i.scale)+" "+g.roundtodec(m.segments[c].y1*i.scale)+" ";s+="Z "}if(s+='" />',i.lcpr||i.qcpr){for(c=0;c<d.segments.length;c++)d.segments[c].hasOwnProperty("x3")&&i.qcpr&&(s+='<circle cx="'+d.segments[c].x2*i.scale+'" cy="'+d.segments[c].y2*i.scale+'" r="'+i.qcpr+'" fill="cyan" stroke-width="'+i.qcpr*.2+'" stroke="black" />',s+='<circle cx="'+d.segments[c].x3*i.scale+'" cy="'+d.segments[c].y3*i.scale+'" r="'+i.qcpr+'" fill="white" stroke-width="'+i.qcpr*.2+'" stroke="black" />',s+='<line x1="'+d.segments[c].x1*i.scale+'" y1="'+d.segments[c].y1*i.scale+'" x2="'+d.segments[c].x2*i.scale+'" y2="'+d.segments[c].y2*i.scale+'" stroke-width="'+i.qcpr*.2+'" stroke="cyan" />',s+='<line x1="'+d.segments[c].x2*i.scale+'" y1="'+d.segments[c].y2*i.scale+'" x2="'+d.segments[c].x3*i.scale+'" y2="'+d.segments[c].y3*i.scale+'" stroke-width="'+i.qcpr*.2+'" stroke="cyan" />'),!d.segments[c].hasOwnProperty("x3")&&i.lcpr&&(s+='<circle cx="'+d.segments[c].x2*i.scale+'" cy="'+d.segments[c].y2*i.scale+'" r="'+i.lcpr+'" fill="white" stroke-width="'+i.lcpr*.2+'" stroke="black" />');for(var b=0;b<d.holechildren.length;b++){var m=Z[d.holechildren[b]];for(c=0;c<m.segments.length;c++)m.segments[c].hasOwnProperty("x3")&&i.qcpr&&(s+='<circle cx="'+m.segments[c].x2*i.scale+'" cy="'+m.segments[c].y2*i.scale+'" r="'+i.qcpr+'" fill="cyan" stroke-width="'+i.qcpr*.2+'" stroke="black" />',s+='<circle cx="'+m.segments[c].x3*i.scale+'" cy="'+m.segments[c].y3*i.scale+'" r="'+i.qcpr+'" fill="white" stroke-width="'+i.qcpr*.2+'" stroke="black" />',s+='<line x1="'+m.segments[c].x1*i.scale+'" y1="'+m.segments[c].y1*i.scale+'" x2="'+m.segments[c].x2*i.scale+'" y2="'+m.segments[c].y2*i.scale+'" stroke-width="'+i.qcpr*.2+'" stroke="cyan" />',s+='<line x1="'+m.segments[c].x2*i.scale+'" y1="'+m.segments[c].y2*i.scale+'" x2="'+m.segments[c].x3*i.scale+'" y2="'+m.segments[c].y3*i.scale+'" stroke-width="'+i.qcpr*.2+'" stroke="cyan" />'),!m.segments[c].hasOwnProperty("x3")&&i.lcpr&&(s+='<circle cx="'+m.segments[c].x2*i.scale+'" cy="'+m.segments[c].y2*i.scale+'" r="'+i.lcpr+'" fill="white" stroke-width="'+i.lcpr*.2+'" stroke="black" />')}}return s},this.getsvgstring=function(C,A){A=g.checkoptions(A);for(var l=C.width*A.scale,i=C.height*A.scale,Z="<svg "+(A.viewbox?'viewBox="0 0 '+l+" "+i+'" ':'width="'+l+'" height="'+i+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+g.versionnumber+'" >',d=0;d<C.layers.length;d++)for(var s=0;s<C.layers[d].length;s++)C.layers[d][s].isholepath||(Z+=g.svgpathstring(C,d,s,A));return Z+="</svg>",Z},this.compareNumbers=function(C,A){return C-A},this.torgbastr=function(C){return"rgba("+C.r+","+C.g+","+C.b+","+C.a+")"},this.tosvgcolorstr=function(C,A){return'fill="rgb('+C.r+","+C.g+","+C.b+')" stroke="rgb('+C.r+","+C.g+","+C.b+')" stroke-width="'+A.strokewidth+'" opacity="'+C.a/255+'" '},this.appendSVGString=function(C,A){var l;A?(l=document.getElementById(A),l||(l=document.createElement("div"),l.id=A,document.body.appendChild(l))):(l=document.createElement("div"),document.body.appendChild(l)),l.innerHTML+=C},this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.blur=function(C,A,l){var i,Z,d,s,c,b,m,B,W,o,h={width:C.width,height:C.height,data:[]};if(A=Math.floor(A),A<1)return C;A>5&&(A=5),l=Math.abs(l),l>1024&&(l=1024);var w=g.gks[A-1];for(Z=0;Z<C.height;Z++)for(i=0;i<C.width;i++){for(b=0,m=0,B=0,W=0,o=0,d=-A;d<A+1;d++)i+d>0&&i+d<C.width&&(c=(Z*C.width+i+d)*4,b+=C.data[c]*w[d+A],m+=C.data[c+1]*w[d+A],B+=C.data[c+2]*w[d+A],W+=C.data[c+3]*w[d+A],o+=w[d+A]);c=(Z*C.width+i)*4,h.data[c]=Math.floor(b/o),h.data[c+1]=Math.floor(m/o),h.data[c+2]=Math.floor(B/o),h.data[c+3]=Math.floor(W/o)}var a=new Uint8ClampedArray(h.data);for(Z=0;Z<C.height;Z++)for(i=0;i<C.width;i++){for(b=0,m=0,B=0,W=0,o=0,d=-A;d<A+1;d++)Z+d>0&&Z+d<C.height&&(c=((Z+d)*C.width+i)*4,b+=a[c]*w[d+A],m+=a[c+1]*w[d+A],B+=a[c+2]*w[d+A],W+=a[c+3]*w[d+A],o+=w[d+A]);c=(Z*C.width+i)*4,h.data[c]=Math.floor(b/o),h.data[c+1]=Math.floor(m/o),h.data[c+2]=Math.floor(B/o),h.data[c+3]=Math.floor(W/o)}for(Z=0;Z<C.height;Z++)for(i=0;i<C.width;i++)c=(Z*C.width+i)*4,s=Math.abs(h.data[c]-C.data[c])+Math.abs(h.data[c+1]-C.data[c+1])+Math.abs(h.data[c+2]-C.data[c+2])+Math.abs(h.data[c+3]-C.data[c+3]),s>l&&(h.data[c]=C.data[c],h.data[c+1]=C.data[c+1],h.data[c+2]=C.data[c+2],h.data[c+3]=C.data[c+3]);return h},this.loadImage=function(C,A,l){var i=new Image;l&&l.corsenabled&&(i.crossOrigin="Anonymous"),i.onload=function(){var Z=document.createElement("canvas");Z.width=i.width,Z.height=i.height;var d=Z.getContext("2d");d.drawImage(i,0,0),A(Z)},i.src=C},this.getImgdata=function(C){var A=C.getContext("2d");return A.getImageData(0,0,C.width,C.height)},this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}],this.drawLayers=function(C,A,l,i){l=l||1;var Z,d,s,c,b,m;i?(m=document.getElementById(i),m||(m=document.createElement("div"),m.id=i,document.body.appendChild(m))):(m=document.createElement("div"),document.body.appendChild(m));for(b in C)if(C.hasOwnProperty(b)){Z=C[b][0].length,d=C[b].length;var B=document.createElement("canvas");B.width=Z*l,B.height=d*l;var W=B.getContext("2d");for(c=0;c<d;c++)for(s=0;s<Z;s++)W.fillStyle=g.torgbastr(A[C[b][c][s]%A.length]),W.fillRect(s*l,c*l,l,l);m.appendChild(B)}}}G.exports=new I})()}(oI)),oI.exports}var Hi=CA();const $A=bI(Hi),VI=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),AA=[.001,0,0,.001,0,0],lA=1.35,HI={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Cg={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},gC="pdfjs_internal_editor_",z={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},L={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Mi={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},iA={TRIANGLES:1,LATTICE:2},mI={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},RC={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ZI={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},zg={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},yC={ERRORS:0,WARNINGS:1,INFOS:5},CC={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},AC={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},Di={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let uC=yC.WARNINGS;function Ki(G){Number.isInteger(G)&&(uC=G)}function Si(){return uC}function HC(G){uC>=yC.INFOS&&console.info(`Info: ${G}`)}function F(G){uC>=yC.WARNINGS&&console.warn(`Warning: ${G}`)}function E(G){throw new Error(G)}function T(G,I){G||E(I)}function pi(G){switch(G?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Il(G,I=null,g=null){if(!G)return null;if(g&&typeof G=="string"&&(g.addDefaultProtocol&&G.startsWith("www.")&&G.match(/\./g)?.length>=2&&(G=`http://${G}`),g.tryConvertEncoding))try{G=Li(G)}catch{}const C=I?URL.parse(G,I):URL.parse(G);return pi(C)?C:null}function gl(G,I,g=!1){const C=URL.parse(G);return C?(C.hash=I,C.href):g&&Il(G,"http://example.com")?G.split("#",1)[0]+`${I?`#${I}`:""}`:""}function J(G,I,g,C=!1){return Object.defineProperty(G,I,{value:g,enumerable:!C,configurable:!0,writable:!1}),g}const Yg=function(){function I(g,C){this.message=g,this.name=C}return I.prototype=new Error,I.constructor=I,I}();class Cl extends Yg{constructor(I,g){super(I,"PasswordException"),this.code=g}}class ZA extends Yg{constructor(I,g){super(I,"UnknownErrorException"),this.details=g}}class dA extends Yg{constructor(I){super(I,"InvalidPDFException")}}class MC extends Yg{constructor(I,g,C){super(I,"ResponseException"),this.status=g,this.missing=C}}class Fi extends Yg{constructor(I){super(I,"FormatError")}}class Ag extends Yg{constructor(I){super(I,"AbortException")}}function Al(G){(typeof G!="object"||G?.length===void 0)&&E("Invalid argument for bytesToString");const I=G.length,g=8192;if(I<g)return String.fromCharCode.apply(null,G);const C=[];for(let A=0;A<I;A+=g){const l=Math.min(A+g,I),i=G.subarray(A,l);C.push(String.fromCharCode.apply(null,i))}return C.join("")}function lC(G){typeof G!="string"&&E("Invalid argument for stringToBytes");const I=G.length,g=new Uint8Array(I);for(let C=0;C<I;++C)g[C]=G.charCodeAt(C)&255;return g}function Ji(G){return String.fromCharCode(G>>24&255,G>>16&255,G>>8&255,G&255)}function zi(){const G=new Uint8Array(4);return G[0]=1,new Uint32Array(G.buffer,0,1)[0]===1}function ki(){try{return new Function(""),!0}catch{return!1}}class BI{static get isLittleEndian(){return J(this,"isLittleEndian",zi())}static get isEvalSupported(){return J(this,"isEvalSupported",ki())}static get isOffscreenCanvasSupported(){return J(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return J(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return J(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return J(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:I,userAgent:g}=navigator;return J(this,"platform",{isAndroid:g.includes("Android"),isLinux:I.includes("Linux"),isMac:I.includes("Mac"),isWindows:I.includes("Win"),isFirefox:g.includes("Firefox")})}static get isCSSRoundSupported(){return J(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const sA=Array.from(Array(256).keys(),G=>G.toString(16).padStart(2,"0"));class u{static makeHexColor(I,g,C){return`#${sA[I]}${sA[g]}${sA[C]}`}static domMatrixToTransform(I){return[I.a,I.b,I.c,I.d,I.e,I.f]}static scaleMinMax(I,g){let C;I[0]?(I[0]<0&&(C=g[0],g[0]=g[2],g[2]=C),g[0]*=I[0],g[2]*=I[0],I[3]<0&&(C=g[1],g[1]=g[3],g[3]=C),g[1]*=I[3],g[3]*=I[3]):(C=g[0],g[0]=g[1],g[1]=C,C=g[2],g[2]=g[3],g[3]=C,I[1]<0&&(C=g[1],g[1]=g[3],g[3]=C),g[1]*=I[1],g[3]*=I[1],I[2]<0&&(C=g[0],g[0]=g[2],g[2]=C),g[0]*=I[2],g[2]*=I[2]),g[0]+=I[4],g[1]+=I[5],g[2]+=I[4],g[3]+=I[5]}static transform(I,g){return[I[0]*g[0]+I[2]*g[1],I[1]*g[0]+I[3]*g[1],I[0]*g[2]+I[2]*g[3],I[1]*g[2]+I[3]*g[3],I[0]*g[4]+I[2]*g[5]+I[4],I[1]*g[4]+I[3]*g[5]+I[5]]}static multiplyByDOMMatrix(I,g){return[I[0]*g.a+I[2]*g.b,I[1]*g.a+I[3]*g.b,I[0]*g.c+I[2]*g.d,I[1]*g.c+I[3]*g.d,I[0]*g.e+I[2]*g.f+I[4],I[1]*g.e+I[3]*g.f+I[5]]}static applyTransform(I,g,C=0){const A=I[C],l=I[C+1];I[C]=A*g[0]+l*g[2]+g[4],I[C+1]=A*g[1]+l*g[3]+g[5]}static applyTransformToBezier(I,g,C=0){const A=g[0],l=g[1],i=g[2],Z=g[3],d=g[4],s=g[5];for(let c=0;c<6;c+=2){const b=I[C+c],m=I[C+c+1];I[C+c]=b*A+m*i+d,I[C+c+1]=b*l+m*Z+s}}static applyInverseTransform(I,g){const C=I[0],A=I[1],l=g[0]*g[3]-g[1]*g[2];I[0]=(C*g[3]-A*g[2]+g[2]*g[5]-g[4]*g[3])/l,I[1]=(-C*g[1]+A*g[0]+g[4]*g[1]-g[5]*g[0])/l}static axialAlignedBoundingBox(I,g,C){const A=g[0],l=g[1],i=g[2],Z=g[3],d=g[4],s=g[5],c=I[0],b=I[1],m=I[2],B=I[3];let W=A*c+d,o=W,h=A*m+d,w=h,a=Z*b+s,Y=a,V=Z*B+s,n=V;if(l!==0||i!==0){const e=l*c,t=l*m,N=i*b,R=i*B;W+=N,w+=N,h+=R,o+=R,a+=e,n+=e,V+=t,Y+=t}C[0]=Math.min(C[0],W,h,o,w),C[1]=Math.min(C[1],a,V,Y,n),C[2]=Math.max(C[2],W,h,o,w),C[3]=Math.max(C[3],a,V,Y,n)}static inverseTransform(I){const g=I[0]*I[3]-I[1]*I[2];return[I[3]/g,-I[1]/g,-I[2]/g,I[0]/g,(I[2]*I[5]-I[4]*I[3])/g,(I[4]*I[1]-I[5]*I[0])/g]}static singularValueDecompose2dScale(I,g){const C=I[0],A=I[1],l=I[2],i=I[3],Z=C**2+A**2,d=C*l+A*i,s=l**2+i**2,c=(Z+s)/2,b=Math.sqrt(c**2-(Z*s-d**2));g[0]=Math.sqrt(c+b||1),g[1]=Math.sqrt(c-b||1)}static normalizeRect(I){const g=I.slice(0);return I[0]>I[2]&&(g[0]=I[2],g[2]=I[0]),I[1]>I[3]&&(g[1]=I[3],g[3]=I[1]),g}static intersect(I,g){const C=Math.max(Math.min(I[0],I[2]),Math.min(g[0],g[2])),A=Math.min(Math.max(I[0],I[2]),Math.max(g[0],g[2]));if(C>A)return null;const l=Math.max(Math.min(I[1],I[3]),Math.min(g[1],g[3])),i=Math.min(Math.max(I[1],I[3]),Math.max(g[1],g[3]));return l>i?null:[C,l,A,i]}static pointBoundingBox(I,g,C){C[0]=Math.min(C[0],I),C[1]=Math.min(C[1],g),C[2]=Math.max(C[2],I),C[3]=Math.max(C[3],g)}static rectBoundingBox(I,g,C,A,l){l[0]=Math.min(l[0],I,C),l[1]=Math.min(l[1],g,A),l[2]=Math.max(l[2],I,C),l[3]=Math.max(l[3],g,A)}static#I(I,g,C,A,l,i,Z,d,s,c){if(s<=0||s>=1)return;const b=1-s,m=s*s,B=m*s,W=b*(b*(b*I+3*s*g)+3*m*C)+B*A,o=b*(b*(b*l+3*s*i)+3*m*Z)+B*d;c[0]=Math.min(c[0],W),c[1]=Math.min(c[1],o),c[2]=Math.max(c[2],W),c[3]=Math.max(c[3],o)}static#g(I,g,C,A,l,i,Z,d,s,c,b,m){if(Math.abs(s)<1e-12){Math.abs(c)>=1e-12&&this.#I(I,g,C,A,l,i,Z,d,-b/c,m);return}const B=c**2-4*b*s;if(B<0)return;const W=Math.sqrt(B),o=2*s;this.#I(I,g,C,A,l,i,Z,d,(-c+W)/o,m),this.#I(I,g,C,A,l,i,Z,d,(-c-W)/o,m)}static bezierBoundingBox(I,g,C,A,l,i,Z,d,s){s[0]=Math.min(s[0],I,Z),s[1]=Math.min(s[1],g,d),s[2]=Math.max(s[2],I,Z),s[3]=Math.max(s[3],g,d),this.#g(I,C,l,Z,g,A,i,d,3*(-I+3*(C-l)+Z),6*(I-2*C+l),3*(C-I),s),this.#g(I,C,l,Z,g,A,i,d,3*(-g+3*(A-i)+d),6*(g-2*A+i),3*(A-g),s)}}function Li(G){return decodeURIComponent(escape(G))}let cA=null,ll=null;function Ti(G){return cA||(cA=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ll=new Map([["ﬅ","ſt"]])),G.replaceAll(cA,(I,g,C)=>g?g.normalize("NFKC"):ll.get(C))}function il(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const G=new Uint8Array(32);return crypto.getRandomValues(G),Al(G)}const kg="pdfjs_internal_id_";function ji(G,I,g){if(!Array.isArray(g)||g.length<2)return!1;const[C,A,...l]=g;if(!G(C)&&!Number.isInteger(C)||!I(A))return!1;const i=l.length;let Z=!0;switch(A.name){case"XYZ":if(i<2||i>3)return!1;break;case"Fit":case"FitB":return i===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(i>1)return!1;break;case"FitR":if(i!==4)return!1;Z=!1;break;default:return!1}for(const d of l)if(!(typeof d=="number"||Z&&d===null))return!1;return!0}function nI(G,I,g){return Math.min(Math.max(G,I),g)}function Zl(G){return Uint8Array.prototype.toBase64?G.toBase64():btoa(Al(G))}function Qi(G){return Uint8Array.fromBase64?Uint8Array.fromBase64(G):lC(atob(G))}typeof Promise.try!="function"&&(Promise.try=function(G,...I){return new Promise(g=>{g(G(...I))})}),typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(G){return G.reduce((I,g)=>I+g,0)});class iC{static textContent(I){const g=[],C={items:g,styles:Object.create(null)};function A(l){if(!l)return;let i=null;const Z=l.name;if(Z==="#text")i=l.value;else if(iC.shouldBuildText(Z))l?.attributes?.textContent?i=l.attributes.textContent:l.value&&(i=l.value);else return;if(i!==null&&g.push({str:i}),!!l.children)for(const d of l.children)A(d)}return A(I),C}static shouldBuildText(I){return!(I==="textarea"||I==="input"||I==="option"||I==="select")}}class dl{static setupStorage(I,g,C,A,l){const i=A.getValue(g,{value:null});switch(C.name){case"textarea":if(i.value!==null&&(I.textContent=i.value),l==="print")break;I.addEventListener("input",Z=>{A.setValue(g,{value:Z.target.value})});break;case"input":if(C.attributes.type==="radio"||C.attributes.type==="checkbox"){if(i.value===C.attributes.xfaOn?I.setAttribute("checked",!0):i.value===C.attributes.xfaOff&&I.removeAttribute("checked"),l==="print")break;I.addEventListener("change",Z=>{A.setValue(g,{value:Z.target.checked?Z.target.getAttribute("xfaOn"):Z.target.getAttribute("xfaOff")})})}else{if(i.value!==null&&I.setAttribute("value",i.value),l==="print")break;I.addEventListener("input",Z=>{A.setValue(g,{value:Z.target.value})})}break;case"select":if(i.value!==null){I.setAttribute("value",i.value);for(const Z of C.children)Z.attributes.value===i.value?Z.attributes.selected=!0:Z.attributes.hasOwnProperty("selected")&&delete Z.attributes.selected}I.addEventListener("input",Z=>{const d=Z.target.options,s=d.selectedIndex===-1?"":d[d.selectedIndex].value;A.setValue(g,{value:s})});break}}static setAttributes({html:I,element:g,storage:C=null,intent:A,linkService:l}){const{attributes:i}=g,Z=I instanceof HTMLAnchorElement;i.type==="radio"&&(i.name=`${i.name}-${A}`);for(const[d,s]of Object.entries(i))if(s!=null)switch(d){case"class":s.length&&I.setAttribute(d,s.join(" "));break;case"dataId":break;case"id":I.setAttribute("data-element-id",s);break;case"style":Object.assign(I.style,s);break;case"textContent":I.textContent=s;break;default:(!Z||d!=="href"&&d!=="newWindow")&&I.setAttribute(d,s)}Z&&l.addLinkAttributes(I,i.href,i.newWindow),C&&i.dataId&&this.setupStorage(I,i.dataId,g,C)}static render(I){const g=I.annotationStorage,C=I.linkService,A=I.xfaHtml,l=I.intent||"display",i=document.createElement(A.name);A.attributes&&this.setAttributes({html:i,element:A,intent:l,linkService:C});const Z=l!=="richText",d=I.div;if(d.append(i),I.viewport){const b=`matrix(${I.viewport.transform.join(",")})`;d.style.transform=b}Z&&d.setAttribute("class","xfaLayer xfaFont");const s=[];if(A.children.length===0){if(A.value){const b=document.createTextNode(A.value);i.append(b),Z&&iC.shouldBuildText(A.name)&&s.push(b)}return{textDivs:s}}const c=[[A,-1,i]];for(;c.length>0;){const[b,m,B]=c.at(-1);if(m+1===b.children.length){c.pop();continue}const W=b.children[++c.at(-1)[1]];if(W===null)continue;const{name:o}=W;if(o==="#text"){const w=document.createTextNode(W.value);s.push(w),B.append(w);continue}const h=W?.attributes?.xmlns?document.createElementNS(W.attributes.xmlns,o):document.createElement(o);if(B.append(h),W.attributes&&this.setAttributes({html:h,element:W,storage:g,intent:l,linkService:C}),W.children?.length>0)c.push([W,-1,h]);else if(W.value){const w=document.createTextNode(W.value);Z&&iC.shouldBuildText(o)&&s.push(w),h.append(w)}}for(const b of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))b.setAttribute("readOnly",!0);return{textDivs:s}}static update(I){const g=`matrix(${I.viewport.transform.join(",")})`;I.div.style.transform=g,I.div.hidden=!1}}const _I="http://www.w3.org/2000/svg";class Lg{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function ZC(G,I="text"){if(sC(G,document.baseURI)){const g=await fetch(G);if(!g.ok)throw new Error(g.statusText);switch(I){case"arraybuffer":return g.arrayBuffer();case"blob":return g.blob();case"json":return g.json()}return g.text()}return new Promise((g,C)=>{const A=new XMLHttpRequest;A.open("GET",G,!0),A.responseType=I,A.onreadystatechange=()=>{if(A.readyState===XMLHttpRequest.DONE){if(A.status===200||A.status===0){switch(I){case"arraybuffer":case"blob":case"json":g(A.response);return}g(A.responseText);return}C(new Error(A.statusText))}},A.send(null)})}class dC{constructor({viewBox:I,userUnit:g,scale:C,rotation:A,offsetX:l=0,offsetY:i=0,dontFlip:Z=!1}){this.viewBox=I,this.userUnit=g,this.scale=C,this.rotation=A,this.offsetX=l,this.offsetY=i,C*=g;const d=(I[2]+I[0])/2,s=(I[3]+I[1])/2;let c,b,m,B;switch(A%=360,A<0&&(A+=360),A){case 180:c=-1,b=0,m=0,B=1;break;case 90:c=0,b=1,m=1,B=0;break;case 270:c=0,b=-1,m=-1,B=0;break;case 0:c=1,b=0,m=0,B=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Z&&(m=-m,B=-B);let W,o,h,w;c===0?(W=Math.abs(s-I[1])*C+l,o=Math.abs(d-I[0])*C+i,h=(I[3]-I[1])*C,w=(I[2]-I[0])*C):(W=Math.abs(d-I[0])*C+l,o=Math.abs(s-I[1])*C+i,h=(I[2]-I[0])*C,w=(I[3]-I[1])*C),this.transform=[c*C,b*C,m*C,B*C,W-c*C*d-m*C*s,o-b*C*d-B*C*s],this.width=h,this.height=w}get rawDims(){const I=this.viewBox;return J(this,"rawDims",{pageWidth:I[2]-I[0],pageHeight:I[3]-I[1],pageX:I[0],pageY:I[1]})}clone({scale:I=this.scale,rotation:g=this.rotation,offsetX:C=this.offsetX,offsetY:A=this.offsetY,dontFlip:l=!1}={}){return new dC({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:I,rotation:g,offsetX:C,offsetY:A,dontFlip:l})}convertToViewportPoint(I,g){const C=[I,g];return u.applyTransform(C,this.transform),C}convertToViewportRectangle(I){const g=[I[0],I[1]];u.applyTransform(g,this.transform);const C=[I[2],I[3]];return u.applyTransform(C,this.transform),[g[0],g[1],C[0],C[1]]}convertToPdfPoint(I,g){const C=[I,g];return u.applyInverseTransform(C,this.transform),C}}class GA extends Yg{constructor(I,g=0){super(I,"RenderingCancelledException"),this.extraDelay=g}}function DC(G){const I=G.length;let g=0;for(;g<I&&G[g].trim()==="";)g++;return G.substring(g,g+5).toLowerCase()==="data:"}function bA(G){return typeof G=="string"&&/\.pdf$/i.test(G)}function ri(G){return[G]=G.split(/[#?]/,1),G.substring(G.lastIndexOf("/")+1)}function Ui(G,I="document.pdf"){if(typeof G!="string")return I;if(DC(G))return F('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),I;const C=(Z=>{try{return new URL(Z)}catch{try{return new URL(decodeURIComponent(Z))}catch{try{return new URL(Z,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(Z),"https://foo.bar")}catch{return null}}}}})(G);if(!C)return I;const A=Z=>{try{let d=decodeURIComponent(Z);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:Z):d}catch{return Z}},l=/\.pdf$/i,i=C.pathname.split("/").at(-1);if(l.test(i))return A(i);if(C.searchParams.size>0){const Z=Array.from(C.searchParams.values()).reverse();for(const s of Z)if(l.test(s))return A(s);const d=Array.from(C.searchParams.keys()).reverse();for(const s of d)if(l.test(s))return A(s)}if(C.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(C.hash);if(d)return A(d[0])}return I}class sl{started=Object.create(null);times=[];time(I){I in this.started&&F(`Timer is already running for ${I}`),this.started[I]=Date.now()}timeEnd(I){I in this.started||F(`Timer has not been started for ${I}`),this.times.push({name:I,start:this.started[I],end:Date.now()}),delete this.started[I]}toString(){const I=[];let g=0;for(const{name:C}of this.times)g=Math.max(C.length,g);for(const{name:C,start:A,end:l}of this.times)I.push(`${C.padEnd(g)} ${l-A}ms
`);return I.join("")}}function sC(G,I){const g=I?URL.parse(G,I):URL.parse(G);return g?.protocol==="http:"||g?.protocol==="https:"}function pI(G){G.preventDefault()}function CI(G){G.preventDefault(),G.stopPropagation()}function Oi(G){console.log("Deprecated API usage: "+G)}class mA{static#I;static toDateObject(I){if(I instanceof Date)return I;if(!I||typeof I!="string")return null;this.#I||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const g=this.#I.exec(I);if(!g)return null;const C=parseInt(g[1],10);let A=parseInt(g[2],10);A=A>=1&&A<=12?A-1:0;let l=parseInt(g[3],10);l=l>=1&&l<=31?l:1;let i=parseInt(g[4],10);i=i>=0&&i<=23?i:0;let Z=parseInt(g[5],10);Z=Z>=0&&Z<=59?Z:0;let d=parseInt(g[6],10);d=d>=0&&d<=59?d:0;const s=g[7]||"Z";let c=parseInt(g[8],10);c=c>=0&&c<=23?c:0;let b=parseInt(g[9],10)||0;return b=b>=0&&b<=59?b:0,s==="-"?(i+=c,Z+=b):s==="+"&&(i-=c,Z-=b),new Date(Date.UTC(C,A,l,i,Z,d))}}function xi(G,{scale:I=1,rotation:g=0}){const{width:C,height:A}=G.attributes.style,l=[0,0,parseInt(C),parseInt(A)];return new dC({viewBox:l,userUnit:1,scale:I,rotation:g})}function cC(G){if(G.startsWith("#")){const I=parseInt(G.slice(1),16);return[(I&16711680)>>16,(I&65280)>>8,I&255]}return G.startsWith("rgb(")?G.slice(4,-1).split(",").map(I=>parseInt(I)):G.startsWith("rgba(")?G.slice(5,-1).split(",").map(I=>parseInt(I)).slice(0,3):(F(`Not a valid color format: "${G}"`),[0,0,0])}function vi(G){const I=document.createElement("span");I.style.visibility="hidden",I.style.colorScheme="only light",document.body.append(I);for(const g of G.keys()){I.style.color=g;const C=window.getComputedStyle(I).color;G.set(g,cC(C))}I.remove()}function II(G){const{a:I,b:g,c:C,d:A,e:l,f:i}=G.getTransform();return[I,g,C,A,l,i]}function jI(G){const{a:I,b:g,c:C,d:A,e:l,f:i}=G.getTransform().invertSelf();return[I,g,C,A,l,i]}function Vg(G,I,g=!1,C=!0){if(I instanceof dC){const{pageWidth:A,pageHeight:l}=I.rawDims,{style:i}=G,Z=BI.isCSSRoundSupported,d=`var(--total-scale-factor) * ${A}px`,s=`var(--total-scale-factor) * ${l}px`,c=Z?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,b=Z?`round(down, ${s}, var(--scale-round-y))`:`calc(${s})`;!g||I.rotation%180===0?(i.width=c,i.height=b):(i.width=b,i.height=c)}C&&G.setAttribute("data-main-rotation",I.rotation)}class QI{constructor(){const{pixelRatio:I}=QI;this.sx=I,this.sy=I}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(I,g,C,A,l=-1){let i=1/0,Z=1/0,d=1/0;C=QI.capPixels(C,l),C>0&&(i=Math.sqrt(C/(I*g))),A!==-1&&(Z=A/I,d=A/g);const s=Math.min(i,Z,d);return this.sx>s||this.sy>s?(this.sx=s,this.sy=s,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(I,g){if(g>=0){const C=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+g/100));return I>0?Math.min(I,C):C}return I}}const BA=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Ei{static get isDarkMode(){return J(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class Pi{static get commentForegroundColor(){const I=document.createElement("span");I.classList.add("comment","sidebar");const{style:g}=I;g.width=g.height="0",g.display="none",g.color="var(--comment-fg-color)",document.body.append(I);const{color:C}=window.getComputedStyle(I);return I.remove(),J(this,"commentForegroundColor",cC(C))}}function fi(G,I,g,C){C=Math.min(Math.max(C??1,0),1);const A=255*(1-C);return G=Math.round(G*C+A),I=Math.round(I*C+A),g=Math.round(g*C+A),[G,I,g]}function cl(G,I){const g=G[0]/255,C=G[1]/255,A=G[2]/255,l=Math.max(g,C,A),i=Math.min(g,C,A),Z=(l+i)/2;if(l===i)I[0]=I[1]=0;else{const d=l-i;switch(I[1]=Z<.5?d/(l+i):d/(2-l-i),l){case g:I[0]=((C-A)/d+(C<A?6:0))*60;break;case C:I[0]=((A-g)/d+2)*60;break;case A:I[0]=((g-C)/d+4)*60;break}}I[2]=Z}function oA(G,I){const g=G[0],C=G[1],A=G[2],l=(1-Math.abs(2*A-1))*C,i=l*(1-Math.abs(g/60%2-1)),Z=A-l/2;switch(Math.floor(g/60)){case 0:I[0]=l+Z,I[1]=i+Z,I[2]=Z;break;case 1:I[0]=i+Z,I[1]=l+Z,I[2]=Z;break;case 2:I[0]=Z,I[1]=l+Z,I[2]=i+Z;break;case 3:I[0]=Z,I[1]=i+Z,I[2]=l+Z;break;case 4:I[0]=i+Z,I[1]=Z,I[2]=l+Z;break;case 5:case 6:I[0]=l+Z,I[1]=Z,I[2]=i+Z;break}}function Gl(G){return G<=.03928?G/12.92:((G+.055)/1.055)**2.4}function bl(G,I,g){oA(G,g),g.map(Gl);const C=.2126*g[0]+.7152*g[1]+.0722*g[2];oA(I,g),g.map(Gl);const A=.2126*g[0]+.7152*g[1]+.0722*g[2];return C>A?(C+.05)/(A+.05):(A+.05)/(C+.05)}const ml=new Map;function _i(G,I){const g=G[0]+G[1]*256+G[2]*65536+I[0]*16777216+I[1]*4294967296+I[2]*1099511627776;let C=ml.get(g);if(C)return C;const A=new Float32Array(9),l=A.subarray(0,3),i=A.subarray(3,6);cl(G,i);const Z=A.subarray(6,9);cl(I,Z);const d=Z[2]<.5,s=d?12:4.5;if(i[2]=d?Math.sqrt(i[2]):1-Math.sqrt(1-i[2]),bl(i,Z,l)<s){let c,b;d?(c=i[2],b=1):(c=0,b=i[2]);const m=.005;for(;b-c>m;){const B=i[2]=(c+b)/2;d===bl(i,Z,l)<s?c=B:b=B}i[2]=d?b:c}return oA(i,l),C=u.makeHexColor(Math.round(l[0]*255),Math.round(l[1]*255),Math.round(l[2]*255)),ml.set(g,C),C}function Bl({html:G,dir:I,className:g},C){const A=document.createDocumentFragment();if(typeof G=="string"){const l=document.createElement("p");l.dir=I||"auto";const i=G.split(/(?:\r\n?|\n)/);for(let Z=0,d=i.length;Z<d;++Z){const s=i[Z];l.append(document.createTextNode(s)),Z<d-1&&l.append(document.createElement("br"))}A.append(l)}else dl.render({xfaHtml:G,div:A,intent:"richText"});A.firstElementChild.classList.add("richText",g),C.append(A)}function ol(G){const I=new Path2D;if(!G)return I;for(let g=0,C=G.length;g<C;)switch(G[g++]){case AC.moveTo:I.moveTo(G[g++],G[g++]);break;case AC.lineTo:I.lineTo(G[g++],G[g++]);break;case AC.curveTo:I.bezierCurveTo(G[g++],G[g++],G[g++],G[g++],G[g++],G[g++]);break;case AC.quadraticCurveTo:I.quadraticCurveTo(G[g++],G[g++],G[g++],G[g++]);break;case AC.closePath:I.closePath();break;default:F(`Unrecognized drawing path operator: ${G[g-1]}`);break}return I}class GC{#I=null;#g=null;#A;#C=null;#Z=null;#i=null;#l=null;#d=null;static#c=null;constructor(I){this.#A=I,GC.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const I=this.#I=document.createElement("div");I.classList.add("editToolbar","hidden"),I.setAttribute("role","toolbar");const g=this.#A._uiManager._signal;g instanceof AbortSignal&&!g.aborted&&(I.addEventListener("contextmenu",pI,{signal:g}),I.addEventListener("pointerdown",GC.#s,{signal:g}));const C=this.#C=document.createElement("div");C.className="buttons",I.append(C);const A=this.#A.toolbarPosition;if(A){const{style:l}=I,i=this.#A._uiManager.direction==="ltr"?1-A[0]:A[0];l.insetInlineEnd=`${100*i}%`,l.top=`calc(${100*A[1]}% + var(--editor-toolbar-vert-offset))`}return I}get div(){return this.#I}static#s(I){I.stopPropagation()}#m(I){this.#A._focusEventsAllowed=!1,CI(I)}#b(I){this.#A._focusEventsAllowed=!0,CI(I)}#B(I){const g=this.#A._uiManager._signal;return!(g instanceof AbortSignal)||g.aborted?!1:(I.addEventListener("focusin",this.#m.bind(this),{capture:!0,signal:g}),I.addEventListener("focusout",this.#b.bind(this),{capture:!0,signal:g}),I.addEventListener("contextmenu",pI,{signal:g}),!0)}hide(){this.#I.classList.add("hidden"),this.#g?.hideDropdown()}show(){this.#I.classList.remove("hidden"),this.#Z?.shown(),this.#i?.shown()}addDeleteButton(){const{editorType:I,_uiManager:g}=this.#A,C=document.createElement("button");C.classList.add("basic","deleteButton"),C.tabIndex=0,C.setAttribute("data-l10n-id",GC.#c[I]),this.#B(C)&&C.addEventListener("click",A=>{g.delete()},{signal:g._signal}),this.#C.append(C)}get#w(){const I=document.createElement("div");return I.className="divider",I}async addAltText(I){const g=await I.render();this.#B(g),this.#C.append(g,this.#w),this.#Z=I}addComment(I,g=null){if(this.#i)return;const C=I.renderForToolbar();if(!C)return;this.#B(C);const A=this.#l=this.#w;g?(this.#C.insertBefore(C,g),this.#C.insertBefore(A,g)):this.#C.append(C,A),this.#i=I,I.toolbar=this}addColorPicker(I){if(this.#g)return;this.#g=I;const g=I.renderButton();this.#B(g),this.#C.append(g,this.#w)}async addEditSignatureButton(I){const g=this.#d=await I.renderEditButton(this.#A);this.#B(g),this.#C.append(g,this.#w)}removeButton(I){switch(I){case"comment":this.#i?.removeToolbarCommentButton(),this.#i=null,this.#l?.remove(),this.#l=null;break}}async addButton(I,g){switch(I){case"colorPicker":g&&this.addColorPicker(g);break;case"altText":g&&await this.addAltText(g);break;case"editSignature":g&&await this.addEditSignatureButton(g);break;case"delete":this.addDeleteButton();break;case"comment":g&&this.addComment(g);break}}async addButtonBefore(I,g,C){if(!g&&I==="comment")return;const A=this.#C.querySelector(C);A&&I==="comment"&&this.addComment(g,A)}updateEditSignatureButton(I){this.#d&&(this.#d.title=I)}remove(){this.#I.remove(),this.#g?.destroy(),this.#g=null}}class qi{#I=null;#g=null;#A;constructor(I){this.#A=I}#C(){const I=this.#g=document.createElement("div");I.className="editToolbar",I.setAttribute("role","toolbar");const g=this.#A._signal;g instanceof AbortSignal&&!g.aborted&&I.addEventListener("contextmenu",pI,{signal:g});const C=this.#I=document.createElement("div");return C.className="buttons",I.append(C),this.#A.hasCommentManager()&&this.#i("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#A.commentSelection("floating_button")}),this.#i("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#A.highlightSelection("floating_button")}),I}#Z(I,g){let C=0,A=0;for(const l of I){const i=l.y+l.height;if(i<C)continue;const Z=l.x+(g?l.width:0);if(i>C){A=Z,C=i;continue}g?Z>A&&(A=Z):Z<A&&(A=Z)}return[g?1-A:A,C]}show(I,g,C){const[A,l]=this.#Z(g,C),{style:i}=this.#g||=this.#C();I.append(this.#g),i.insetInlineEnd=`${100*A}%`,i.top=`calc(${100*l}% + var(--editor-toolbar-vert-offset))`}hide(){this.#g.remove()}#i(I,g,C,A){const l=document.createElement("button");l.classList.add("basic",I),l.tabIndex=0,l.setAttribute("data-l10n-id",g);const i=document.createElement("span");l.append(i),i.className="visuallyHidden",i.setAttribute("data-l10n-id",C);const Z=this.#A._signal;Z instanceof AbortSignal&&!Z.aborted&&(l.addEventListener("contextmenu",pI,{signal:Z}),l.addEventListener("click",A,{signal:Z})),this.#I.append(l)}}function Wl(G,I,g){for(const C of g)I.addEventListener(C,G[C].bind(G))}class Q{static#I=NaN;static#g=null;static#A=NaN;static#C=null;static initializeAndAddPointerId(I){(Q.#g||=new Set).add(I)}static setPointer(I,g){Q.#I||=g,Q.#C??=I}static setTimeStamp(I){Q.#A=I}static isSamePointerId(I){return Q.#I===I}static isSamePointerIdOrRemove(I){return Q.#I===I?!0:(Q.#g?.delete(I),!1)}static isSamePointerType(I){return Q.#C===I}static isInitializedAndDifferentPointerType(I){return Q.#C!==null&&!Q.isSamePointerType(I)}static isSameTimeStamp(I){return Q.#A===I}static isUsingMultiplePointers(){return Q.#g?.size>=1}static clearPointerType(){Q.#C=null}static clearPointerIds(){Q.#I=NaN,Q.#g=null}static clearTimeStamp(){Q.#A=NaN}}class $i{#I=0;get id(){return`${gC}${this.#I++}`}}class WA{#I=il();#g=0;#A=null;static get _isSVGFittingCanvas(){const I='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',C=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),A=new Image;A.src=I;const l=A.decode().then(()=>(C.drawImage(A,0,0,1,1,0,0,1,3),new Uint32Array(C.getImageData(0,0,1,1).data.buffer)[0]===0));return J(this,"_isSVGFittingCanvas",l)}async#C(I,g){this.#A||=new Map;let C=this.#A.get(I);if(C===null)return null;if(C?.bitmap)return C.refCounter+=1,C;try{C||={bitmap:null,id:`image_${this.#I}_${this.#g++}`,refCounter:0,isSvg:!1};let A;if(typeof g=="string"?(C.url=g,A=await ZC(g,"blob")):g instanceof File?A=C.file=g:g instanceof Blob&&(A=g),A.type==="image/svg+xml"){const l=WA._isSVGFittingCanvas,i=new FileReader,Z=new Image,d=new Promise((s,c)=>{Z.onload=()=>{C.bitmap=Z,C.isSvg=!0,s()},i.onload=async()=>{const b=C.svgUrl=i.result;Z.src=await l?`${b}#svgView(preserveAspectRatio(none))`:b},Z.onerror=i.onerror=c});i.readAsDataURL(A),await d}else C.bitmap=await createImageBitmap(A);C.refCounter=1}catch(A){F(A),C=null}return this.#A.set(I,C),C&&this.#A.set(C.id,C),C}async getFromFile(I){const{lastModified:g,name:C,size:A,type:l}=I;return this.#C(`${g}_${C}_${A}_${l}`,I)}async getFromUrl(I){return this.#C(I,I)}async getFromBlob(I,g){const C=await g;return this.#C(I,C)}async getFromId(I){this.#A||=new Map;const g=this.#A.get(I);if(!g)return null;if(g.bitmap)return g.refCounter+=1,g;if(g.file)return this.getFromFile(g.file);if(g.blobPromise){const{blobPromise:C}=g;return delete g.blobPromise,this.getFromBlob(g.id,C)}return this.getFromUrl(g.url)}getFromCanvas(I,g){this.#A||=new Map;let C=this.#A.get(I);if(C?.bitmap)return C.refCounter+=1,C;const A=new OffscreenCanvas(g.width,g.height);return A.getContext("2d").drawImage(g,0,0),C={bitmap:A.transferToImageBitmap(),id:`image_${this.#I}_${this.#g++}`,refCounter:1,isSvg:!1},this.#A.set(I,C),this.#A.set(C.id,C),C}getSvgUrl(I){const g=this.#A.get(I);return g?.isSvg?g.svgUrl:null}deleteId(I){this.#A||=new Map;const g=this.#A.get(I);if(!g||(g.refCounter-=1,g.refCounter!==0))return;const{bitmap:C}=g;if(!g.url&&!g.file){const A=new OffscreenCanvas(C.width,C.height);A.getContext("bitmaprenderer").transferFromImageBitmap(C),g.blobPromise=A.convertToBlob()}C.close?.(),g.bitmap=null}isValidId(I){return I.startsWith(`image_${this.#I}_`)}}class IZ{#I=[];#g=!1;#A;#C=-1;constructor(I=128){this.#A=I}add({cmd:I,undo:g,post:C,mustExec:A,type:l=NaN,overwriteIfSameType:i=!1,keepUndo:Z=!1}){if(A&&I(),this.#g)return;const d={cmd:I,undo:g,post:C,type:l};if(this.#C===-1){this.#I.length>0&&(this.#I.length=0),this.#C=0,this.#I.push(d);return}if(i&&this.#I[this.#C].type===l){Z&&(d.undo=this.#I[this.#C].undo),this.#I[this.#C]=d;return}const s=this.#C+1;s===this.#A?this.#I.splice(0,1):(this.#C=s,s<this.#I.length&&this.#I.splice(s)),this.#I.push(d)}undo(){if(this.#C===-1)return;this.#g=!0;const{undo:I,post:g}=this.#I[this.#C];I(),g?.(),this.#g=!1,this.#C-=1}redo(){if(this.#C<this.#I.length-1){this.#C+=1,this.#g=!0;const{cmd:I,post:g}=this.#I[this.#C];I(),g?.(),this.#g=!1}}hasSomethingToUndo(){return this.#C!==-1}hasSomethingToRedo(){return this.#C<this.#I.length-1}cleanType(I){if(this.#C!==-1){for(let g=this.#C;g>=0;g--)if(this.#I[g].type!==I){this.#I.splice(g+1,this.#C-g),this.#C=g;return}this.#I.length=0,this.#C=-1}}destroy(){this.#I=null}}class bC{constructor(I){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:g}=BI.platform;for(const[C,A,l={}]of I)for(const i of C){const Z=i.startsWith("mac+");g&&Z?(this.callbacks.set(i.slice(4),{callback:A,options:l}),this.allKeys.add(i.split("+").at(-1))):!g&&!Z&&(this.callbacks.set(i,{callback:A,options:l}),this.allKeys.add(i.split("+").at(-1)))}}#I(I){I.altKey&&this.buffer.push("alt"),I.ctrlKey&&this.buffer.push("ctrl"),I.metaKey&&this.buffer.push("meta"),I.shiftKey&&this.buffer.push("shift"),this.buffer.push(I.key);const g=this.buffer.join("+");return this.buffer.length=0,g}exec(I,g){if(!this.allKeys.has(g.key))return;const C=this.callbacks.get(this.#I(g));if(!C)return;const{callback:A,options:{bubbles:l=!1,args:i=[],checker:Z=null}}=C;Z&&!Z(I,g)||(A.bind(I,...i,g)(),l||CI(g))}}class wA{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const I=new Map([["CanvasText",null],["Canvas",null]]);return vi(I),J(this,"_colors",I)}convert(I){const g=cC(I);if(!window.matchMedia("(forced-colors: active)").matches)return g;for(const[C,A]of this._colors)if(A.every((l,i)=>l===g[i]))return wA._colorsMapping.get(C);return g}getHexCode(I){const g=this._colors.get(I);return g?u.makeHexColor(...g):I}}class lg{#I=new AbortController;#g=null;#A=null;#C=new Map;#Z=new Map;#i=null;#l=null;#d=null;#c=new IZ;#s=null;#m=null;#b=null;#B=0;#w=new Set;#W=null;#G=null;#o=new Set;_editorUndoBar=null;#h=!1;#Y=!1;#a=!1;#X=null;#t=null;#n=null;#y=null;#V=!1;#N=null;#M=new $i;#u=!1;#H=!1;#z=!1;#K=null;#p=null;#k=null;#F=null;#U=null;#R=z.NONE;#e=new Set;#S=null;#L=null;#j=null;#v=null;#x=null;#E={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#Q=[0,0];#J=null;#O=null;#q=null;#$=null;#T=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const I=lg.prototype,g=i=>i.#O.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&i.hasSomethingToControl(),C=(i,{target:Z})=>{if(Z instanceof HTMLInputElement){const{type:d}=Z;return d!=="text"&&d!=="number"}return!0},A=this.TRANSLATE_SMALL,l=this.TRANSLATE_BIG;return J(this,"_keyboardManager",new bC([[["ctrl+a","mac+meta+a"],I.selectAll,{checker:C}],[["ctrl+z","mac+meta+z"],I.undo,{checker:C}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],I.redo,{checker:C}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],I.delete,{checker:C}],[["Enter","mac+Enter"],I.addNewEditorFromKeyboard,{checker:(i,{target:Z})=>!(Z instanceof HTMLButtonElement)&&i.#O.contains(Z)&&!i.isEnterHandled}],[[" ","mac+ "],I.addNewEditorFromKeyboard,{checker:(i,{target:Z})=>!(Z instanceof HTMLButtonElement)&&i.#O.contains(document.activeElement)}],[["Escape","mac+Escape"],I.unselectAll],[["ArrowLeft","mac+ArrowLeft"],I.translateSelectedEditors,{args:[-A,0],checker:g}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],I.translateSelectedEditors,{args:[-l,0],checker:g}],[["ArrowRight","mac+ArrowRight"],I.translateSelectedEditors,{args:[A,0],checker:g}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],I.translateSelectedEditors,{args:[l,0],checker:g}],[["ArrowUp","mac+ArrowUp"],I.translateSelectedEditors,{args:[0,-A],checker:g}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],I.translateSelectedEditors,{args:[0,-l],checker:g}],[["ArrowDown","mac+ArrowDown"],I.translateSelectedEditors,{args:[0,A],checker:g}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],I.translateSelectedEditors,{args:[0,l],checker:g}]]))}constructor(I,g,C,A,l,i,Z,d,s,c,b,m,B,W,o,h){const w=this._signal=this.#I.signal;this.#O=I,this.#q=g,this.#$=C,this.#i=A,this.#s=l,this.#L=i,this.#x=d,this._eventBus=Z,Z._on("editingaction",this.onEditingAction.bind(this),{signal:w}),Z._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),Z._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),Z._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),Z._on("setpreference",this.onSetPreference.bind(this),{signal:w}),Z._on("switchannotationeditorparams",a=>this.updateParams(a.type,a.value),{signal:w}),window.addEventListener("pointerdown",()=>{this.#H=!0},{capture:!0,signal:w}),window.addEventListener("pointerup",()=>{this.#H=!1},{capture:!0,signal:w}),this.#ZI(),this.#mI(),this.#gI(),this.#l=d.annotationStorage,this.#X=d.filterFactory,this.#j=s,this.#y=c||null,this.#h=b,this.#Y=m,this.#a=B,this.#U=W||null,this.viewParameters={realScale:Lg.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=o||null,this._supportsPinchToZoom=h!==!1,l?.setSidebarUiManager(this)}destroy(){this.#T?.resolve(),this.#T=null,this.#I?.abort(),this.#I=null,this._signal=null;for(const I of this.#Z.values())I.destroy();this.#Z.clear(),this.#C.clear(),this.#o.clear(),this.#F?.clear(),this.#g=null,this.#e.clear(),this.#c.destroy(),this.#i?.destroy(),this.#s?.destroy(),this.#L?.destroy(),this.#N?.hide(),this.#N=null,this.#k?.destroy(),this.#k=null,this.#A=null,this.#t&&(clearTimeout(this.#t),this.#t=null),this.#J&&(clearTimeout(this.#J),this.#J=null),this._editorUndoBar?.destroy(),this.#x=null}combinedSignal(I){return AbortSignal.any([this._signal,I.signal])}get mlManager(){return this.#U}get useNewAltTextFlow(){return this.#Y}get useNewAltTextWhenAddingImage(){return this.#a}get hcmFilter(){return J(this,"hcmFilter",this.#j?this.#X.addHCMFilter(this.#j.foreground,this.#j.background):"none")}get direction(){return J(this,"direction",getComputedStyle(this.#O).direction)}get _highlightColors(){return J(this,"_highlightColors",this.#y?new Map(this.#y.split(",").map(I=>(I=I.split("=").map(g=>g.trim()),I[1]=I[1].toUpperCase(),I))):null)}get highlightColors(){const{_highlightColors:I}=this;if(!I)return J(this,"highlightColors",null);const g=new Map,C=!!this.#j;for(const[A,l]of I){const i=A.endsWith("_HCM");if(C&&i){g.set(A.replace("_HCM",""),l);continue}!C&&!i&&g.set(A,l)}return J(this,"highlightColors",g)}get highlightColorNames(){return J(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,I=>I.reverse())):null)}getNonHCMColor(I){if(!this._highlightColors)return I;const g=this.highlightColorNames.get(I);return this._highlightColors.get(g)||I}getNonHCMColorName(I){return this.highlightColorNames.get(I)||I}setCurrentDrawingSession(I){I?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#b=I}setMainHighlightColorPicker(I){this.#k=I}editAltText(I,g=!1){this.#i?.editAltText(this,I,g)}hasCommentManager(){return!!this.#s}editComment(I,g,C,A){this.#s?.showDialog(this,I,g,C,A)}selectComment(I,g){this.#Z.get(I)?.getEditorByUID(g)?.toggleComment(!0,!0)}updateComment(I){this.#s?.updateComment(I.getData())}updatePopupColor(I){this.#s?.updatePopupColor(I)}removeComment(I){this.#s?.removeComments([I.uid])}toggleComment(I,g,C=void 0){this.#s?.toggleCommentPopup(I,g,C)}makeCommentColor(I,g){return I&&this.#s?.makeCommentColor(I,g)||null}getCommentDialogElement(){return this.#s?.dialogElement||null}async waitForEditorsRendered(I){if(this.#Z.has(I-1))return;const{resolve:g,promise:C}=Promise.withResolvers(),A=l=>{l.pageNumber===I&&(this._eventBus._off("editorsrendered",A),g())};this._eventBus.on("editorsrendered",A),await C}getSignature(I){this.#L?.getSignature({uiManager:this,editor:I})}get signatureManager(){return this.#L}switchToMode(I,g){this._eventBus.on("annotationeditormodechanged",g,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:I})}setPreference(I,g){this._eventBus.dispatch("setpreference",{source:this,name:I,value:g})}onSetPreference({name:I,value:g}){switch(I){case"enableNewAltTextWhenAddingImage":this.#a=g;break}}onPageChanging({pageNumber:I}){this.#B=I-1}focusMainContainer(){this.#O.focus()}findParent(I,g){for(const C of this.#Z.values()){const{x:A,y:l,width:i,height:Z}=C.div.getBoundingClientRect();if(I>=A&&I<=A+i&&g>=l&&g<=l+Z)return C}return null}disableUserSelect(I=!1){this.#q.classList.toggle("noUserSelect",I)}addShouldRescale(I){this.#o.add(I)}removeShouldRescale(I){this.#o.delete(I)}onScaleChanging({scale:I}){this.commitOrRemove(),this.viewParameters.realScale=I*Lg.PDF_TO_CSS_UNITS;for(const g of this.#o)g.onScaleChanging();this.#b?.onScaleChanging()}onRotationChanging({pagesRotation:I}){this.commitOrRemove(),this.viewParameters.rotation=I}#_({anchorNode:I}){return I.nodeType===Node.TEXT_NODE?I.parentElement:I}#II(I){const{currentLayer:g}=this;if(g.hasTextLayer(I))return g;for(const C of this.#Z.values())if(C.hasTextLayer(I))return C;return null}highlightSelection(I="",g=!1){const C=document.getSelection();if(!C||C.isCollapsed)return;const{anchorNode:A,anchorOffset:l,focusNode:i,focusOffset:Z}=C,d=C.toString(),c=this.#_(C).closest(".textLayer"),b=this.getSelectionBoxes(c);if(!b)return;C.empty();const m=this.#II(c),B=this.#R===z.NONE,W=()=>{const o=m?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:I,boxes:b,anchorNode:A,anchorOffset:l,focusNode:i,focusOffset:Z,text:d});B&&this.showAllEditors("highlight",!0,!0),g&&o?.editComment()};if(B){this.switchToMode(z.HIGHLIGHT,W);return}W()}commentSelection(I=""){this.highlightSelection(I,!0)}#lI(){const I=document.getSelection();if(!I||I.isCollapsed)return;const C=this.#_(I).closest(".textLayer"),A=this.getSelectionBoxes(C);A&&(this.#N||=new qi(this),this.#N.show(C,A,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(I){if(!this.#l)return null;const g=`${gC}${I}`,C=this.#l.getRawValue(g);return C&&this.#l.remove(g),C}addToAnnotationStorage(I){!I.isEmpty()&&this.#l&&!this.#l.has(I.id)&&this.#l.setValue(I.id,I)}a11yAlert(I,g=null){const C=this.#$;C&&(C.setAttribute("data-l10n-id",I),g?C.setAttribute("data-l10n-args",JSON.stringify(g)):C.removeAttribute("data-l10n-args"))}#iI(){const I=document.getSelection();if(!I||I.isCollapsed){this.#S&&(this.#N?.hide(),this.#S=null,this.#D({hasSelectedText:!1}));return}const{anchorNode:g}=I;if(g===this.#S)return;const A=this.#_(I).closest(".textLayer");if(!A){this.#S&&(this.#N?.hide(),this.#S=null,this.#D({hasSelectedText:!1}));return}if(this.#N?.hide(),this.#S=g,this.#D({hasSelectedText:!0}),!(this.#R!==z.HIGHLIGHT&&this.#R!==z.NONE)&&(this.#R===z.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#V=this.isShiftKeyDown,!this.isShiftKeyDown)){const l=this.#R===z.HIGHLIGHT?this.#II(A):null;if(l?.toggleDrawing(),this.#H){const i=new AbortController,Z=this.combinedSignal(i),d=s=>{s.type==="pointerup"&&s.button!==0||(i.abort(),l?.toggleDrawing(!0),s.type==="pointerup"&&this.#P("main_toolbar"))};window.addEventListener("pointerup",d,{signal:Z}),window.addEventListener("blur",d,{signal:Z})}else l?.toggleDrawing(!0),this.#P("main_toolbar")}}#P(I=""){this.#R===z.HIGHLIGHT?this.highlightSelection(I):this.#h&&this.#lI()}#ZI(){document.addEventListener("selectionchange",this.#iI.bind(this),{signal:this._signal})}#dI(){if(this.#n)return;this.#n=new AbortController;const I=this.combinedSignal(this.#n);window.addEventListener("focus",this.focus.bind(this),{signal:I}),window.addEventListener("blur",this.blur.bind(this),{signal:I})}#sI(){this.#n?.abort(),this.#n=null}blur(){if(this.isShiftKeyDown=!1,this.#V&&(this.#V=!1,this.#P("main_toolbar")),!this.hasSelection)return;const{activeElement:I}=document;for(const g of this.#e)if(g.div.contains(I)){this.#p=[g,I],g._focusEventsAllowed=!1;break}}focus(){if(!this.#p)return;const[I,g]=this.#p;this.#p=null,g.addEventListener("focusin",()=>{I._focusEventsAllowed=!0},{once:!0,signal:this._signal}),g.focus()}#gI(){if(this.#K)return;this.#K=new AbortController;const I=this.combinedSignal(this.#K);window.addEventListener("keydown",this.keydown.bind(this),{signal:I}),window.addEventListener("keyup",this.keyup.bind(this),{signal:I})}#cI(){this.#K?.abort(),this.#K=null}#GI(){if(this.#m)return;this.#m=new AbortController;const I=this.combinedSignal(this.#m);document.addEventListener("copy",this.copy.bind(this),{signal:I}),document.addEventListener("cut",this.cut.bind(this),{signal:I}),document.addEventListener("paste",this.paste.bind(this),{signal:I})}#bI(){this.#m?.abort(),this.#m=null}#mI(){const I=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:I}),document.addEventListener("drop",this.drop.bind(this),{signal:I})}addEditListeners(){this.#gI(),this.setEditingState(!0)}removeEditListeners(){this.#cI(),this.setEditingState(!1)}dragOver(I){for(const{type:g}of I.dataTransfer.items)for(const C of this.#G)if(C.isHandlingMimeForPasting(g)){I.dataTransfer.dropEffect="copy",I.preventDefault();return}}drop(I){for(const g of I.dataTransfer.items)for(const C of this.#G)if(C.isHandlingMimeForPasting(g.type)){C.paste(g,this.currentLayer),I.preventDefault();return}}copy(I){if(I.preventDefault(),this.#g?.commitOrRemove(),!this.hasSelection)return;const g=[];for(const C of this.#e){const A=C.serialize(!0);A&&g.push(A)}g.length!==0&&I.clipboardData.setData("application/pdfjs",JSON.stringify(g))}cut(I){this.copy(I),this.delete()}async paste(I){I.preventDefault();const{clipboardData:g}=I;for(const l of g.items)for(const i of this.#G)if(i.isHandlingMimeForPasting(l.type)){i.paste(l,this.currentLayer);return}let C=g.getData("application/pdfjs");if(!C)return;try{C=JSON.parse(C)}catch(l){F(`paste: "${l.message}".`);return}if(!Array.isArray(C))return;this.unselectAll();const A=this.currentLayer;try{const l=[];for(const d of C){const s=await A.deserialize(d);if(!s)return;l.push(s)}const i=()=>{for(const d of l)this.#CI(d);this.#AI(l)},Z=()=>{for(const d of l)d.remove()};this.addCommands({cmd:i,undo:Z,mustExec:!0})}catch(l){F(`paste: "${l.message}".`)}}keydown(I){!this.isShiftKeyDown&&I.key==="Shift"&&(this.isShiftKeyDown=!0),this.#R!==z.NONE&&!this.isEditorHandlingKeyboard&&lg._keyboardManager.exec(this,I)}keyup(I){this.isShiftKeyDown&&I.key==="Shift"&&(this.isShiftKeyDown=!1,this.#V&&(this.#V=!1,this.#P("main_toolbar")))}onEditingAction({name:I}){switch(I){case"undo":case"redo":case"delete":case"selectAll":this[I]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#D(I){Object.entries(I).some(([C,A])=>this.#E[C]!==A)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#E,I)}),this.#R===z.HIGHLIGHT&&I.hasSelectedEditor===!1&&this.#r([[L.HIGHLIGHT_FREE,!0]]))}#r(I){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:I})}setEditingState(I){I?(this.#dI(),this.#GI(),this.#D({isEditing:this.#R!==z.NONE,isEmpty:this.#f(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#sI(),this.#bI(),this.#D({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(I){if(!this.#G){this.#G=I;for(const g of this.#G)this.#r(g.defaultPropertiesToUpdate)}}getId(){return this.#M.id}get currentLayer(){return this.#Z.get(this.#B)}getLayer(I){return this.#Z.get(I)}get currentPageIndex(){return this.#B}addLayer(I){this.#Z.set(I.pageIndex,I),this.#u?I.enable():I.disable()}removeLayer(I){this.#Z.delete(I.pageIndex)}async updateMode(I,g=null,C=!1,A=!1,l=!1,i=!1){if(this.#R!==I&&!(this.#T&&(await this.#T.promise,!this.#T))){if(this.#T=Promise.withResolvers(),this.#b?.commitOrRemove(),this.#R===z.POPUP&&this.#s?.hideSidebar(),this.#s?.destroyPopup(),this.#R=I,I===z.NONE){this.setEditingState(!1),this.#oI();for(const Z of this.#C.values())Z.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#T.resolve();return}for(const Z of this.#C.values())Z.addStandaloneCommentButton();I===z.SIGNATURE&&await this.#L?.loadSignatures(),C&&Q.clearPointerType(),this.setEditingState(!0),await this.#BI(),this.unselectAll();for(const Z of this.#Z.values())Z.updateMode(I);if(I===z.POPUP){this.#A||=await this.#x.getAnnotationsByType(new Set(this.#G.map(s=>s._editorType)));const Z=new Set,d=[];for(const s of this.#C.values()){const{annotationElementId:c,hasComment:b,deleted:m}=s;c&&Z.add(c),b&&!m&&d.push(s.getData())}for(const s of this.#A){const{id:c,popupRef:b,contentsObj:m}=s;b&&m?.str&&!Z.has(c)&&!this.#w.has(c)&&d.push(s)}this.#s?.showSidebar(d)}if(!g){A&&this.addNewEditorFromKeyboard(),this.#T.resolve();return}for(const Z of this.#C.values())Z.uid===g?(this.setSelected(Z),i?Z.editComment():l?Z.enterInEditMode():Z.focus()):Z.unselect();this.#T.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(I){I.mode!==this.#R&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...I})}updateParams(I,g){if(this.#G){switch(I){case L.CREATE:this.currentLayer.addNewEditor(g);return;case L.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#v||=new Map).set(I,g),this.showAllEditors("highlight",g);break}if(this.hasSelection)for(const C of this.#e)C.updateParams(I,g);else for(const C of this.#G)C.updateDefaultParams(I,g)}}showAllEditors(I,g,C=!1){for(const l of this.#C.values())l.editorType===I&&l.show(g);(this.#v?.get(L.HIGHLIGHT_SHOW_ALL)??!0)!==g&&this.#r([[L.HIGHLIGHT_SHOW_ALL,g]])}enableWaiting(I=!1){if(this.#z!==I){this.#z=I;for(const g of this.#Z.values())I?g.disableClick():g.enableClick(),g.div.classList.toggle("waiting",I)}}async#BI(){if(!this.#u){this.#u=!0;const I=[];for(const g of this.#Z.values())I.push(g.enable());await Promise.all(I);for(const g of this.#C.values())g.enable()}}#oI(){if(this.unselectAll(),this.#u){this.#u=!1;for(const I of this.#Z.values())I.disable();for(const I of this.#C.values())I.disable()}}*getEditors(I){for(const g of this.#C.values())g.pageIndex===I&&(yield g)}getEditor(I){return this.#C.get(I)}addEditor(I){this.#C.set(I.id,I)}removeEditor(I){I.div.contains(document.activeElement)&&(this.#t&&clearTimeout(this.#t),this.#t=setTimeout(()=>{this.focusMainContainer(),this.#t=null},0)),this.#C.delete(I.id),I.annotationElementId&&this.#F?.delete(I.annotationElementId),this.unselect(I),(!I.annotationElementId||!this.#w.has(I.annotationElementId))&&this.#l?.remove(I.id)}addDeletedAnnotationElement(I){this.#w.add(I.annotationElementId),this.addChangedExistingAnnotation(I),I.deleted=!0}isDeletedAnnotationElement(I){return this.#w.has(I)}removeDeletedAnnotationElement(I){this.#w.delete(I.annotationElementId),this.removeChangedExistingAnnotation(I),I.deleted=!1}#CI(I){const g=this.#Z.get(I.pageIndex);g?g.addOrRebuild(I):(this.addEditor(I),this.addToAnnotationStorage(I))}setActiveEditor(I){this.#g!==I&&(this.#g=I,I&&this.#r(I.propertiesToUpdate))}get#WI(){let I=null;for(I of this.#e);return I}updateUI(I){this.#WI===I&&this.#r(I.propertiesToUpdate)}updateUIForDefaultProperties(I){this.#r(I.defaultPropertiesToUpdate)}toggleSelected(I){if(this.#e.has(I)){this.#e.delete(I),I.unselect(),this.#D({hasSelectedEditor:this.hasSelection});return}this.#e.add(I),I.select(),this.#r(I.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}setSelected(I){this.updateToolbar({mode:I.mode,editId:I.uid}),this.#b?.commitOrRemove();for(const g of this.#e)g!==I&&g.unselect();this.#e.clear(),this.#e.add(I),I.select(),this.#r(I.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}isSelected(I){return this.#e.has(I)}get firstSelectedEditor(){return this.#e.values().next().value}unselect(I){I.unselect(),this.#e.delete(I),this.#D({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#e.size!==0}get isEnterHandled(){return this.#e.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#D({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#f()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#f()})}addCommands(I){this.#c.add(I),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#f()})}cleanUndoStack(I){this.#c.cleanType(I)}#f(){if(this.#C.size===0)return!0;if(this.#C.size===1)for(const I of this.#C.values())return I.isEmpty();return!1}delete(){this.commitOrRemove();const I=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!I)return;const g=I?[I]:[...this.#e],C=()=>{this._editorUndoBar?.show(A,g.length===1?g[0].editorType:g.length);for(const l of g)l.remove()},A=()=>{for(const l of g)this.#CI(l)};this.addCommands({cmd:C,undo:A,mustExec:!0})}commitOrRemove(){this.#g?.commitOrRemove()}hasSomethingToControl(){return this.#g||this.hasSelection}#AI(I){for(const g of this.#e)g.unselect();this.#e.clear();for(const g of I)g.isEmpty()||(this.#e.add(g),g.select());this.#D({hasSelectedEditor:this.hasSelection})}selectAll(){for(const I of this.#e)I.commit();this.#AI(this.#C.values())}unselectAll(){if(!(this.#g&&(this.#g.commitOrRemove(),this.#R!==z.NONE))&&!this.#b?.commitOrRemove()&&this.hasSelection){for(const I of this.#e)I.unselect();this.#e.clear(),this.#D({hasSelectedEditor:!1})}}translateSelectedEditors(I,g,C=!1){if(C||this.commitOrRemove(),!this.hasSelection)return;this.#Q[0]+=I,this.#Q[1]+=g;const[A,l]=this.#Q,i=[...this.#e],Z=1e3;this.#J&&clearTimeout(this.#J),this.#J=setTimeout(()=>{this.#J=null,this.#Q[0]=this.#Q[1]=0,this.addCommands({cmd:()=>{for(const d of i)this.#C.has(d.id)&&(d.translateInPage(A,l),d.translationDone())},undo:()=>{for(const d of i)this.#C.has(d.id)&&(d.translateInPage(-A,-l),d.translationDone())},mustExec:!1})},Z);for(const d of i)d.translateInPage(I,g),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#W=new Map;for(const I of this.#e)this.#W.set(I,{savedX:I.x,savedY:I.y,savedPageIndex:I.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#W)return!1;this.disableUserSelect(!1);const I=this.#W;this.#W=null;let g=!1;for(const[{x:A,y:l,pageIndex:i},Z]of I)Z.newX=A,Z.newY=l,Z.newPageIndex=i,g||=A!==Z.savedX||l!==Z.savedY||i!==Z.savedPageIndex;if(!g)return!1;const C=(A,l,i,Z)=>{if(this.#C.has(A.id)){const d=this.#Z.get(Z);d?A._setParentAndPosition(d,l,i):(A.pageIndex=Z,A.x=l,A.y=i)}};return this.addCommands({cmd:()=>{for(const[A,{newX:l,newY:i,newPageIndex:Z}]of I)C(A,l,i,Z)},undo:()=>{for(const[A,{savedX:l,savedY:i,savedPageIndex:Z}]of I)C(A,l,i,Z)},mustExec:!0}),!0}dragSelectedEditors(I,g){if(this.#W)for(const C of this.#W.keys())C.drag(I,g)}rebuild(I){if(I.parent===null){const g=this.getLayer(I.pageIndex);g?(g.changeParent(I),g.addOrRebuild(I)):(this.addEditor(I),this.addToAnnotationStorage(I),I.rebuild())}else I.parent.addOrRebuild(I)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#e.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(I){return this.#g===I}getActive(){return this.#g}getMode(){return this.#R}isEditingMode(){return this.#R!==z.NONE}get imageManager(){return J(this,"imageManager",new WA)}getSelectionBoxes(I){if(!I)return null;const g=document.getSelection();for(let s=0,c=g.rangeCount;s<c;s++)if(!I.contains(g.getRangeAt(s).commonAncestorContainer))return null;const{x:C,y:A,width:l,height:i}=I.getBoundingClientRect();let Z;switch(I.getAttribute("data-main-rotation")){case"90":Z=(s,c,b,m)=>({x:(c-A)/i,y:1-(s+b-C)/l,width:m/i,height:b/l});break;case"180":Z=(s,c,b,m)=>({x:1-(s+b-C)/l,y:1-(c+m-A)/i,width:b/l,height:m/i});break;case"270":Z=(s,c,b,m)=>({x:1-(c+m-A)/i,y:(s-C)/l,width:m/i,height:b/l});break;default:Z=(s,c,b,m)=>({x:(s-C)/l,y:(c-A)/i,width:b/l,height:m/i});break}const d=[];for(let s=0,c=g.rangeCount;s<c;s++){const b=g.getRangeAt(s);if(!b.collapsed)for(const{x:m,y:B,width:W,height:o}of b.getClientRects())W===0||o===0||d.push(Z(m,B,W,o))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:I,id:g}){(this.#d||=new Map).set(I,g)}removeChangedExistingAnnotation({annotationElementId:I}){this.#d?.delete(I)}renderAnnotationElement(I){const g=this.#d?.get(I.data.id);if(!g)return;const C=this.#l.getRawValue(g);C&&(this.#R===z.NONE&&!C.hasBeenModified||C.renderAnnotationElement(I))}setMissingCanvas(I,g,C){const A=this.#F?.get(I);A&&(A.setCanvas(g,C),this.#F.delete(I))}addMissingCanvas(I,g){(this.#F||=new Map).set(I,g)}}class rI{#I=null;#g=!1;#A=null;#C=null;#Z=null;#i=null;#l=!1;#d=null;#c=null;#s=null;#m=null;#b=!1;static#B=null;static _l10n=null;constructor(I){this.#c=I,this.#b=I._uiManager.useNewAltTextFlow,rI.#B||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(I){rI._l10n??=I}async render(){const I=this.#A=document.createElement("button");I.className="altText",I.tabIndex="0";const g=this.#C=document.createElement("span");I.append(g),this.#b?(I.classList.add("new"),I.setAttribute("data-l10n-id",rI.#B.missing),g.setAttribute("data-l10n-id",rI.#B["missing-label"])):(I.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),g.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const C=this.#c._uiManager._signal;I.addEventListener("contextmenu",pI,{signal:C}),I.addEventListener("pointerdown",l=>l.stopPropagation(),{signal:C});const A=l=>{l.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#b&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#w}})};return I.addEventListener("click",A,{capture:!0,signal:C}),I.addEventListener("keydown",l=>{l.target===I&&l.key==="Enter"&&(this.#l=!0,A(l))},{signal:C}),await this.#W(),I}get#w(){return this.#I&&"added"||this.#I===null&&this.guessedText&&"review"||"missing"}finish(){this.#A&&(this.#A.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#b?this.#I===null:!this.#I&&!this.#g}hasData(){return this.#b?this.#I!==null||!!this.#s:this.isEmpty()}get guessedText(){return this.#s}async setGuessedText(I){this.#I===null&&(this.#s=I,this.#m=await rI._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:I}),this.#W())}toggleAltTextBadge(I=!1){if(!this.#b||this.#I){this.#d?.remove(),this.#d=null;return}if(!this.#d){const g=this.#d=document.createElement("div");g.className="noAltTextBadge",this.#c.div.append(g)}this.#d.classList.toggle("hidden",!I)}serialize(I){let g=this.#I;return!I&&this.#s===g&&(g=this.#m),{altText:g,decorative:this.#g,guessedText:this.#s,textWithDisclaimer:this.#m}}get data(){return{altText:this.#I,decorative:this.#g}}set data({altText:I,decorative:g,guessedText:C,textWithDisclaimer:A,cancel:l=!1}){C&&(this.#s=C,this.#m=A),!(this.#I===I&&this.#g===g)&&(l||(this.#I=I,this.#g=g),this.#W())}toggle(I=!1){this.#A&&(!I&&this.#i&&(clearTimeout(this.#i),this.#i=null),this.#A.disabled=!I)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#w}})}destroy(){this.#A?.remove(),this.#A=null,this.#C=null,this.#Z=null,this.#d?.remove(),this.#d=null}async#W(){const I=this.#A;if(!I)return;if(this.#b){if(I.classList.toggle("done",!!this.#I),I.setAttribute("data-l10n-id",rI.#B[this.#w]),this.#C?.setAttribute("data-l10n-id",rI.#B[`${this.#w}-label`]),!this.#I){this.#Z?.remove();return}}else{if(!this.#I&&!this.#g){I.classList.remove("done"),this.#Z?.remove();return}I.classList.add("done"),I.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let g=this.#Z;if(!g){this.#Z=g=document.createElement("span"),g.className="tooltip",g.setAttribute("role","tooltip"),g.id=`alt-text-tooltip-${this.#c.id}`;const A=100,l=this.#c._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(this.#i),this.#i=null},{once:!0}),I.addEventListener("mouseenter",()=>{this.#i=setTimeout(()=>{this.#i=null,this.#Z.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},A)},{signal:l}),I.addEventListener("mouseleave",()=>{this.#i&&(clearTimeout(this.#i),this.#i=null),this.#Z?.classList.remove("show")},{signal:l})}this.#g?g.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(g.removeAttribute("data-l10n-id"),g.textContent=this.#I),g.parentNode||I.append(g),this.#c.getElementForAltText()?.setAttribute("aria-describedby",g.id)}}class KC{#I=null;#g=null;#A=!1;#C=null;#Z=null;#i=null;#l=null;#d=null;#c=!1;#s=null;constructor(I){this.#C=I}renderForToolbar(){const I=this.#g=document.createElement("button");return I.className="comment",this.#m(I,!1)}renderForStandalone(){const I=this.#I=document.createElement("button");I.className="annotationCommentButton";const g=this.#C.commentButtonPosition;if(g){const{style:C}=I;C.insetInlineEnd=`calc(${100*(this.#C._uiManager.direction==="ltr"?1-g[0]:g[0])}% - var(--comment-button-dim))`,C.top=`calc(${100*g[1]}% - var(--comment-button-dim))`;const A=this.#C.commentButtonColor;A&&(C.backgroundColor=A)}return this.#m(I,!0)}focusButton(){setTimeout(()=>{(this.#I??this.#g)?.focus()},0)}onUpdatedColor(){if(!this.#I)return;const I=this.#C.commentButtonColor;I&&(this.#I.style.backgroundColor=I),this.#C._uiManager.updatePopupColor(this.#C)}get commentButtonWidth(){return(this.#I?.getBoundingClientRect().width??0)/this.#C.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#s)return this.#s;if(!this.#I)return null;const{x:I,y:g,height:C}=this.#I.getBoundingClientRect(),{x:A,y:l,width:i,height:Z}=this.#C.parent.boundingClientRect;return[(I-A)/i,(g+C-l)/Z]}set commentPopupPositionInLayer(I){this.#s=I}hasDefaultPopupPosition(){return this.#s===null}removeStandaloneCommentButton(){this.#I?.remove(),this.#I=null}removeToolbarCommentButton(){this.#g?.remove(),this.#g=null}setCommentButtonStates({selected:I,hasPopup:g}){this.#I&&(this.#I.classList.toggle("selected",I),this.#I.ariaExpanded=g)}#m(I,g){if(!this.#C._uiManager.hasCommentManager())return null;I.tabIndex="0",I.ariaHasPopup="dialog",g?(I.ariaControls="commentPopup",I.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(I.ariaControlsElements=[this.#C._uiManager.getCommentDialogElement()],I.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const C=this.#C._uiManager._signal;if(!(C instanceof AbortSignal)||C.aborted)return I;I.addEventListener("contextmenu",pI,{signal:C}),g&&(I.addEventListener("focusin",l=>{this.#C._focusEventsAllowed=!1,CI(l)},{capture:!0,signal:C}),I.addEventListener("focusout",l=>{this.#C._focusEventsAllowed=!0,CI(l)},{capture:!0,signal:C})),I.addEventListener("pointerdown",l=>l.stopPropagation(),{signal:C});const A=l=>{l.preventDefault(),I===this.#g?this.edit():this.#C.toggleComment(!0)};return I.addEventListener("click",A,{capture:!0,signal:C}),I.addEventListener("keydown",l=>{l.target===I&&l.key==="Enter"&&(this.#A=!0,A(l))},{signal:C}),I.addEventListener("pointerenter",()=>{this.#C.toggleComment(!1,!0)},{signal:C}),I.addEventListener("pointerleave",()=>{this.#C.toggleComment(!1,!1)},{signal:C}),I}edit(I){const g=this.commentPopupPositionInLayer;let C,A;if(g)[C,A]=g;else{[C,A]=this.#C.commentButtonPosition;const{width:c,height:b,x:m,y:B}=this.#C;C=m+C*c,A=B+A*b}const l=this.#C.parent.boundingClientRect,{x:i,y:Z,width:d,height:s}=l;this.#C._uiManager.editComment(this.#C,i+C*d,Z+A*s,{...I,parentDimensions:l})}finish(){this.#g&&(this.#g.focus({focusVisible:this.#A}),this.#A=!1)}isDeleted(){return this.#c||this.#l===""}isEmpty(){return this.#l===null}hasBeenEdited(){return this.isDeleted()||this.#l!==this.#Z}serialize(){return this.data}get data(){return{text:this.#l,richText:this.#i,date:this.#d,deleted:this.isDeleted()}}set data(I){if(I!==this.#l&&(this.#i=null),I===null){this.#l="",this.#c=!0;return}this.#l=I,this.#d=new Date,this.#c=!1}setInitialText(I,g=null){this.#Z=I,this.data=I,this.#d=null,this.#i=g}shown(){}destroy(){this.#g?.remove(),this.#g=null,this.#I?.remove(),this.#I=null,this.#l="",this.#i=null,this.#d=null,this.#C=null,this.#A=!1,this.#c=!1}}class SC{#I;#g=!1;#A=null;#C;#Z;#i;#l;#d=null;#c;#s=null;#m;#b=null;constructor({container:I,isPinchingDisabled:g=null,isPinchingStopped:C=null,onPinchStart:A=null,onPinching:l=null,onPinchEnd:i=null,signal:Z}){this.#I=I,this.#A=C,this.#C=g,this.#Z=A,this.#i=l,this.#l=i,this.#m=new AbortController,this.#c=AbortSignal.any([Z,this.#m.signal]),I.addEventListener("touchstart",this.#B.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/QI.pixelRatio}#B(I){if(this.#C?.())return;if(I.touches.length===1){if(this.#d)return;const A=this.#d=new AbortController,l=AbortSignal.any([this.#c,A.signal]),i=this.#I,Z={capture:!0,signal:l,passive:!1},d=s=>{s.pointerType==="touch"&&(this.#d?.abort(),this.#d=null)};i.addEventListener("pointerdown",s=>{s.pointerType==="touch"&&(CI(s),d(s))},Z),i.addEventListener("pointerup",d,Z),i.addEventListener("pointercancel",d,Z);return}if(!this.#b){this.#b=new AbortController;const A=AbortSignal.any([this.#c,this.#b.signal]),l=this.#I,i={signal:A,capture:!1,passive:!1};l.addEventListener("touchmove",this.#w.bind(this),i);const Z=this.#W.bind(this);l.addEventListener("touchend",Z,i),l.addEventListener("touchcancel",Z,i),i.capture=!0,l.addEventListener("pointerdown",CI,i),l.addEventListener("pointermove",CI,i),l.addEventListener("pointercancel",CI,i),l.addEventListener("pointerup",CI,i),this.#Z?.()}if(CI(I),I.touches.length!==2||this.#A?.()){this.#s=null;return}let[g,C]=I.touches;g.identifier>C.identifier&&([g,C]=[C,g]),this.#s={touch0X:g.screenX,touch0Y:g.screenY,touch1X:C.screenX,touch1Y:C.screenY}}#w(I){if(!this.#s||I.touches.length!==2)return;CI(I);let[g,C]=I.touches;g.identifier>C.identifier&&([g,C]=[C,g]);const{screenX:A,screenY:l}=g,{screenX:i,screenY:Z}=C,d=this.#s,{touch0X:s,touch0Y:c,touch1X:b,touch1Y:m}=d,B=b-s,W=m-c,o=i-A,h=Z-l,w=Math.hypot(o,h)||1,a=Math.hypot(B,W)||1;if(!this.#g&&Math.abs(a-w)<=SC.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=A,d.touch0Y=l,d.touch1X=i,d.touch1Y=Z,!this.#g){this.#g=!0;return}const Y=[(A+i)/2,(l+Z)/2];this.#i?.(Y,a,w)}#W(I){I.touches.length>=2||(this.#b&&(this.#b.abort(),this.#b=null,this.#l?.()),this.#s&&(CI(I),this.#s=null,this.#g=!1))}destroy(){this.#m?.abort(),this.#m=null,this.#d?.abort(),this.#d=null}}class K{#I=null;#g=null;#A=null;#C=null;#Z=null;#i=!1;#l=null;#d="";#c=null;#s=null;#m=null;#b=null;#B=null;#w="";#W=!1;#G=null;#o=!1;#h=!1;#Y=!1;#a=null;#X=0;#t=0;#n=null;#y=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#V=!1;#N=K._zIndex++;static _borderLineWidth=-1;static _colorManager=new wA;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const I=K.prototype._resizeWithKeyboard,g=lg.TRANSLATE_SMALL,C=lg.TRANSLATE_BIG;return J(this,"_resizerKeyboardManager",new bC([[["ArrowLeft","mac+ArrowLeft"],I,{args:[-g,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],I,{args:[-C,0]}],[["ArrowRight","mac+ArrowRight"],I,{args:[g,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],I,{args:[C,0]}],[["ArrowUp","mac+ArrowUp"],I,{args:[0,-g]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],I,{args:[0,-C]}],[["ArrowDown","mac+ArrowDown"],I,{args:[0,g]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],I,{args:[0,C]}],[["Escape","mac+Escape"],K.prototype._stopResizingWithKeyboard]]))}constructor(I){this.parent=I.parent,this.id=I.id,this.width=this.height=null,this.pageIndex=I.parent.pageIndex,this.name=I.name,this.div=null,this._uiManager=I.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=I.isCentered,this._structTreeParentId=null,this.annotationElementId=I.annotationElementId||null,this.creationDate=I.creationDate||new Date,this.modificationDate=I.modificationDate||null,this.canAddComment=!0;const{rotation:g,rawDims:{pageWidth:C,pageHeight:A,pageX:l,pageY:i}}=this.parent.viewport;this.rotation=g,this.pageRotation=(360+g-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[C,A],this.pageTranslation=[l,i];const[Z,d]=this.parentDimensions;this.x=I.x/Z,this.y=I.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return J(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(I){const g=new gZ({id:I.parent.getNextId(),parent:I.parent,uiManager:I._uiManager});g.annotationElementId=I.annotationElementId,g.deleted=!0,g._uiManager.addToAnnotationStorage(g)}static initialize(I,g){if(K._l10n??=I,K._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),K._borderLineWidth!==-1)return;const C=getComputedStyle(document.documentElement);K._borderLineWidth=parseFloat(C.getPropertyValue("--outline-width"))||0}static updateDefaultParams(I,g){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(I){return!1}static paste(I,g){E("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#V}set _isDraggable(I){this.#V=I,this.div?.classList.toggle("draggable",I)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[I,g]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*g/(I*2),this.y+=this.width*I/(g*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*g/(I*2),this.y-=this.width*I/(g*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(I){this._uiManager.addCommands(I)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#N}setParent(I){I!==null?(this.pageIndex=I.pageIndex,this.pageDimensions=I.pageDimensions):(this.#J(),this.#b?.remove(),this.#b=null),this.parent=I}focusin(I){this._focusEventsAllowed&&(this.#W?this.#W=!1:this.parent.setSelected(this))}focusout(I){!this._focusEventsAllowed||!this.isAttachedToDOM||I.relatedTarget?.closest(`#${this.id}`)||(I.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(I,g,C,A){const[l,i]=this.parentDimensions;[C,A]=this.screenToPageTranslation(C,A),this.x=(I+C)/l,this.y=(g+A)/i,this.fixAndSetPosition()}_moveAfterPaste(I,g){const[C,A]=this.parentDimensions;this.setAt(I*C,g*A,this.width*C,this.height*A),this._onTranslated()}#M([I,g],C,A){[C,A]=this.screenToPageTranslation(C,A),this.x+=C/I,this.y+=A/g,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(I,g){this.#M(this.parentDimensions,I,g)}translateInPage(I,g){this.#G||=[this.x,this.y,this.width,this.height],this.#M(this.pageDimensions,I,g),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(I,g){this.#G||=[this.x,this.y,this.width,this.height];const{div:C,parentDimensions:[A,l]}=this;if(this.x+=I/A,this.y+=g/l,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:b,y:m}=this.div.getBoundingClientRect();this.parent.findNewParent(this,b,m)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:i,y:Z}=this;const[d,s]=this.getBaseTranslation();i+=d,Z+=s;const{style:c}=C;c.left=`${(100*i).toFixed(2)}%`,c.top=`${(100*Z).toFixed(2)}%`,this._onTranslating(i,Z),C.scrollIntoView({block:"nearest"})}_onTranslating(I,g){}_onTranslated(I,g){}get _hasBeenMoved(){return!!this.#G&&(this.#G[0]!==this.x||this.#G[1]!==this.y)}get _hasBeenResized(){return!!this.#G&&(this.#G[2]!==this.width||this.#G[3]!==this.height)}getBaseTranslation(){const[I,g]=this.parentDimensions,{_borderLineWidth:C}=K,A=C/I,l=C/g;switch(this.rotation){case 90:return[-A,l];case 180:return[A,l];case 270:return[A,-l];default:return[-A,-l]}}get _mustFixPosition(){return!0}fixAndSetPosition(I=this.rotation){const{div:{style:g},pageDimensions:[C,A]}=this;let{x:l,y:i,width:Z,height:d}=this;if(Z*=C,d*=A,l*=C,i*=A,this._mustFixPosition)switch(I){case 0:l=nI(l,0,C-Z),i=nI(i,0,A-d);break;case 90:l=nI(l,0,C-d),i=nI(i,Z,A);break;case 180:l=nI(l,Z,C),i=nI(i,d,A);break;case 270:l=nI(l,d,C),i=nI(i,0,A-Z);break}this.x=l/=C,this.y=i/=A;const[s,c]=this.getBaseTranslation();l+=s,i+=c,g.left=`${(100*l).toFixed(2)}%`,g.top=`${(100*i).toFixed(2)}%`,this.moveInDOM()}static#u(I,g,C){switch(C){case 90:return[g,-I];case 180:return[-I,-g];case 270:return[-g,I];default:return[I,g]}}screenToPageTranslation(I,g){return K.#u(I,g,this.parentRotation)}pageTranslationToScreen(I,g){return K.#u(I,g,360-this.parentRotation)}#H(I){switch(I){case 90:{const[g,C]=this.pageDimensions;return[0,-g/C,C/g,0]}case 180:return[-1,0,0,-1];case 270:{const[g,C]=this.pageDimensions;return[0,g/C,-C/g,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:I,pageDimensions:[g,C]}=this;return[g*I,C*I]}setDims(){const{div:{style:I},width:g,height:C}=this;I.width=`${(100*g).toFixed(2)}%`,I.height=`${(100*C).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#z(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const I=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],g=this._uiManager._signal;for(const C of I){const A=document.createElement("div");this.#c.append(A),A.classList.add("resizer",C),A.setAttribute("data-resizer-name",C),A.addEventListener("pointerdown",this.#K.bind(this,C),{signal:g}),A.addEventListener("contextmenu",pI,{signal:g}),A.tabIndex=-1}this.div.prepend(this.#c)}#K(I,g){g.preventDefault();const{isMac:C}=BI.platform;if(g.button!==0||g.ctrlKey&&C)return;this.#A?.toggle(!1);const A=this._isDraggable;this._isDraggable=!1,this.#s=[g.screenX,g.screenY];const l=new AbortController,i=this._uiManager.combinedSignal(l);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#F.bind(this,I),{passive:!0,capture:!0,signal:i}),window.addEventListener("touchmove",CI,{passive:!1,signal:i}),window.addEventListener("contextmenu",pI,{signal:i}),this.#m={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const Z=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(g.target).cursor;const s=()=>{l.abort(),this.parent.togglePointerEvents(!0),this.#A?.toggle(!0),this._isDraggable=A,this.parent.div.style.cursor=Z,this.div.style.cursor=d,this.#k()};window.addEventListener("pointerup",s,{signal:i}),window.addEventListener("blur",s,{signal:i})}#p(I,g,C,A){this.width=C,this.height=A,this.x=I,this.y=g,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#k(){if(!this.#m)return;const{savedX:I,savedY:g,savedWidth:C,savedHeight:A}=this.#m;this.#m=null;const l=this.x,i=this.y,Z=this.width,d=this.height;l===I&&i===g&&Z===C&&d===A||this.addCommands({cmd:this.#p.bind(this,l,i,Z,d),undo:this.#p.bind(this,I,g,C,A),mustExec:!0})}static _round(I){return Math.round(I*1e4)/1e4}#F(I,g){const[C,A]=this.parentDimensions,l=this.x,i=this.y,Z=this.width,d=this.height,s=K.MIN_SIZE/C,c=K.MIN_SIZE/A,b=this.#H(this.rotation),m=(D,p)=>[b[0]*D+b[2]*p,b[1]*D+b[3]*p],B=this.#H(360-this.rotation),W=(D,p)=>[B[0]*D+B[2]*p,B[1]*D+B[3]*p];let o,h,w=!1,a=!1;switch(I){case"topLeft":w=!0,o=(D,p)=>[0,0],h=(D,p)=>[D,p];break;case"topMiddle":o=(D,p)=>[D/2,0],h=(D,p)=>[D/2,p];break;case"topRight":w=!0,o=(D,p)=>[D,0],h=(D,p)=>[0,p];break;case"middleRight":a=!0,o=(D,p)=>[D,p/2],h=(D,p)=>[0,p/2];break;case"bottomRight":w=!0,o=(D,p)=>[D,p],h=(D,p)=>[0,0];break;case"bottomMiddle":o=(D,p)=>[D/2,p],h=(D,p)=>[D/2,0];break;case"bottomLeft":w=!0,o=(D,p)=>[0,p],h=(D,p)=>[D,0];break;case"middleLeft":a=!0,o=(D,p)=>[0,p/2],h=(D,p)=>[D,p/2];break}const Y=o(Z,d),V=h(Z,d);let n=m(...V);const e=K._round(l+n[0]),t=K._round(i+n[1]);let N=1,R=1,H,y;if(g.fromKeyboard)({deltaX:H,deltaY:y}=g);else{const{screenX:D,screenY:p}=g,[O,SI]=this.#s;[H,y]=this.screenToPageTranslation(D-O,p-SI),this.#s[0]=D,this.#s[1]=p}if([H,y]=W(H/C,y/A),w){const D=Math.hypot(Z,d);N=R=Math.max(Math.min(Math.hypot(V[0]-Y[0]-H,V[1]-Y[1]-y)/D,1/Z,1/d),s/Z,c/d)}else a?N=nI(Math.abs(V[0]-Y[0]-H),s,1)/Z:R=nI(Math.abs(V[1]-Y[1]-y),c,1)/d;const U=K._round(Z*N),P=K._round(d*R);n=m(...h(U,P));const j=e-n[0],sI=t-n[1];this.#G||=[this.x,this.y,this.width,this.height],this.width=U,this.height=P,this.x=j,this.y=sI,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#A?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#h)return this._editToolbar;this._editToolbar=new GC(this),this.div.append(this._editToolbar.render());const{toolbarButtons:I}=this;if(I)for(const[g,C]of I)await this._editToolbar.addButton(g,C);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#A?.destroy()}addContainer(I){const g=this._editToolbar?.div;g?g.before(I):this.div.append(I)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#A||(rI.initialize(K._l10n),this.#A=new rI(this),this.#I&&(this.#A.data=this.#I,this.#I=null)),this.#A}get altTextData(){return this.#A?.data}set altTextData(I){this.#A&&(this.#A.data=I)}get guessedAltText(){return this.#A?.guessedText}async setGuessedAltText(I){await this.#A?.setGuessedText(I)}serializeAltText(I){return this.#A?.serialize(I)}hasAltText(){return!!this.#A&&!this.#A.isEmpty()}hasAltTextData(){return this.#A?.hasData()??!1}focusCommentButton(){this.#C?.focusButton()}addCommentButton(){return this.canAddComment?this.#C||=new KC(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#Z){this._uiManager.isEditingMode()&&this.#Z.classList.remove("hidden");return}this.hasComment&&(this.#Z=this.#C.renderForStandalone(),this.div.append(this.#Z))}}removeStandaloneCommentButton(){this.#C.removeStandaloneCommentButton(),this.#Z=null}hideStandaloneCommentButton(){this.#Z?.classList.add("hidden")}get comment(){const{data:{richText:I,text:g,date:C,deleted:A}}=this.#C;return{text:g,richText:I,date:C,deleted:A,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(I){this.#C||=new KC(this),this.#C.data=I,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:I,popupRef:g,richText:C}){if(!g||(this.#C||=new KC(this),this.#C.setInitialText(I,C),!this.annotationElementId))return;const A=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);A&&this.updateFromAnnotationLayer(A)}get hasEditedComment(){return this.#C?.hasBeenEdited()}get hasDeletedComment(){return this.#C?.isDeleted()}get hasComment(){return!!this.#C&&!this.#C.isEmpty()&&!this.#C.isDeleted()}async editComment(I){this.#C||=new KC(this),this.#C.edit(I)}toggleComment(I,g=void 0){this.hasComment&&this._uiManager.toggleComment(this,I,g)}setSelectedCommentButton(I){this.#C.setSelectedButton(I)}addComment(I){if(this.hasEditedComment){const[,,,A]=I.rect,[l]=this.pageDimensions,[i]=this.pageTranslation,Z=i+l+1,d=A-100,s=Z+180;I.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[Z,d,s,A]}}}updateFromAnnotationLayer({popup:{contents:I,deleted:g}}){this.#C.data=g?null:I}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const I=this.div=document.createElement("div");I.setAttribute("data-editor-rotation",(360-this.rotation)%360),I.className=this.name,I.setAttribute("id",this.id),I.tabIndex=this.#i?-1:0,I.setAttribute("role","application"),this.defaultL10nId&&I.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||I.classList.add("hidden"),this.setInForeground(),this.#j();const[g,C]=this.parentDimensions;this.parentRotation%180!==0&&(I.style.maxWidth=`${(100*C/g).toFixed(2)}%`,I.style.maxHeight=`${(100*g/C).toFixed(2)}%`);const[A,l]=this.getInitialTranslation();return this.translate(A,l),Wl(this,I,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#y||=new SC({container:I,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#U.bind(this),onPinching:this.#R.bind(this),onPinchEnd:this.#e.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),I}#U(){this.#m={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#A?.toggle(!1),this.parent.togglePointerEvents(!1)}#R(I,g,C){let l=.7*(C/g)+1-.7;if(l===1)return;const i=this.#H(this.rotation),Z=(e,t)=>[i[0]*e+i[2]*t,i[1]*e+i[3]*t],[d,s]=this.parentDimensions,c=this.x,b=this.y,m=this.width,B=this.height,W=K.MIN_SIZE/d,o=K.MIN_SIZE/s;l=Math.max(Math.min(l,1/m,1/B),W/m,o/B);const h=K._round(m*l),w=K._round(B*l);if(h===m&&w===B)return;this.#G||=[c,b,m,B];const a=Z(m/2,B/2),Y=K._round(c+a[0]),V=K._round(b+a[1]),n=Z(h/2,w/2);this.x=Y-n[0],this.y=V-n[1],this.width=h,this.height=w,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#e(){this.#A?.toggle(!0),this.parent.togglePointerEvents(!0),this.#k()}pointerdown(I){const{isMac:g}=BI.platform;if(I.button!==0||I.ctrlKey&&g){I.preventDefault();return}if(this.#W=!0,this._isDraggable){this.#L(I);return}this.#S(I)}#S(I){const{isMac:g}=BI.platform;I.ctrlKey&&!g||I.shiftKey||I.metaKey&&g?this.parent.toggleSelected(this):this.parent.setSelected(this)}#L(I){const{isSelected:g}=this;this._uiManager.setUpDragSession();let C=!1;const A=new AbortController,l=this._uiManager.combinedSignal(A),i={capture:!0,passive:!1,signal:l},Z=s=>{A.abort(),this.#l=null,this.#W=!1,this._uiManager.endDragSession()||this.#S(s),C&&this._onStopDragging()};g&&(this.#X=I.clientX,this.#t=I.clientY,this.#l=I.pointerId,this.#d=I.pointerType,window.addEventListener("pointermove",s=>{C||(C=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:c,clientY:b,pointerId:m}=s;if(m!==this.#l){CI(s);return}const[B,W]=this.screenToPageTranslation(c-this.#X,b-this.#t);this.#X=c,this.#t=b,this._uiManager.dragSelectedEditors(B,W)},i),window.addEventListener("touchmove",CI,i),window.addEventListener("pointerdown",s=>{s.pointerType===this.#d&&(this.#y||s.isPrimary)&&Z(s),CI(s)},i));const d=s=>{if(!this.#l||this.#l===s.pointerId){Z(s);return}CI(s)};window.addEventListener("pointerup",d,{signal:l}),window.addEventListener("blur",d,{signal:l})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#a&&clearTimeout(this.#a),this.#a=setTimeout(()=>{this.#a=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(I,g,C){I.changeParent(this),this.x=g,this.y=C,this.fixAndSetPosition(),this._onTranslated()}getRect(I,g,C=this.rotation){const A=this.parentScale,[l,i]=this.pageDimensions,[Z,d]=this.pageTranslation,s=I/A,c=g/A,b=this.x*l,m=this.y*i,B=this.width*l,W=this.height*i;switch(C){case 0:return[b+s+Z,i-m-c-W+d,b+s+B+Z,i-m-c+d];case 90:return[b+c+Z,i-m+s+d,b+c+W+Z,i-m+s+B+d];case 180:return[b-s-B+Z,i-m+c+d,b-s+Z,i-m+c+W+d];case 270:return[b-c-W+Z,i-m-s-B+d,b-c+Z,i-m-s+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(I,g){const[C,A,l,i]=I,Z=l-C,d=i-A;switch(this.rotation){case 0:return[C,g-i,Z,d];case 90:return[C,g-A,d,Z];case 180:return[l,g-A,Z,d];case 270:return[l,g-i,d,Z];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&K._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#C?.onUpdatedColor()}getData(){const{comment:{text:I,color:g,date:C,opacity:A,deleted:l,richText:i},uid:Z,pageIndex:d,creationDate:s,modificationDate:c}=this;return{id:Z,pageIndex:d,rect:this.getPDFRect(),richText:i,contentsObj:{str:I},creationDate:s,modificationDate:C||c,popupRef:!l,color:g,opacity:A}}onceAdded(I){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#h=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#h=!1,!0):!1}isInEditMode(){return this.#h}shouldGetKeyboardEvents(){return this.#Y}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:I,left:g,bottom:C,right:A}=this.getClientDimensions(),{innerHeight:l,innerWidth:i}=window;return g<i&&A>0&&I<l&&C>0}#j(){if(this.#B||!this.div)return;this.#B=new AbortController;const I=this._uiManager.combinedSignal(this.#B);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:I}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:I})}rebuild(){this.#j()}rotate(I){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(I=!1,g=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(I,g,C){const A=new this.prototype.constructor({parent:g,id:g.getNextId(),uiManager:C,annotationElementId:I.annotationElementId,creationDate:I.creationDate,modificationDate:I.modificationDate});A.rotation=I.rotation,A.#I=I.accessibilityData,A._isCopy=I.isCopy||!1;const[l,i]=A.pageDimensions,[Z,d,s,c]=A.getRectInCurrentCoords(I.rect,i);return A.x=Z/l,A.y=d/i,A.width=s/l,A.height=c/i,A}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#B?.abort(),this.#B=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#a&&(clearTimeout(this.#a),this.#a=null),this.#J(),this.removeEditToolbar(),this.#n){for(const I of this.#n.values())clearTimeout(I);this.#n=null}this.parent=null,this.#y?.destroy(),this.#y=null,this.#b?.remove(),this.#b=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#z(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[I,g]}=this,[C,A,l,i]=this.getPDFRect();return[K._round(C+(l-C)*I),K._round(A+(i-A)*(1-g))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#C.commentPopupPositionInLayer}set commentPopupPosition(I){this.#C.commentPopupPositionInLayer=I}hasDefaultPopupPosition(){return this.#C.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#C.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(I){this.#C?.setCommentButtonStates(I)}keydown(I){if(!this.isResizable||I.target!==this.div||I.key!=="Enter")return;this._uiManager.setSelected(this),this.#m={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const g=this.#c.children;if(!this.#g){this.#g=Array.from(g);const i=this.#v.bind(this),Z=this.#x.bind(this),d=this._uiManager._signal;for(const s of this.#g){const c=s.getAttribute("data-resizer-name");s.setAttribute("role","spinbutton"),s.addEventListener("keydown",i,{signal:d}),s.addEventListener("blur",Z,{signal:d}),s.addEventListener("focus",this.#E.bind(this,c),{signal:d}),s.setAttribute("data-l10n-id",K._l10nResizer[c])}}const C=this.#g[0];let A=0;for(const i of g){if(i===C)break;A++}const l=(360-this.rotation+this.parentRotation)%360/90*(this.#g.length/4);if(l!==A){if(l<A)for(let Z=0;Z<A-l;Z++)this.#c.append(this.#c.firstElementChild);else if(l>A)for(let Z=0;Z<l-A;Z++)this.#c.firstElementChild.before(this.#c.lastElementChild);let i=0;for(const Z of g){const s=this.#g[i++].getAttribute("data-resizer-name");Z.setAttribute("data-l10n-id",K._l10nResizer[s])}}this.#Q(0),this.#Y=!0,this.#c.firstElementChild.focus({focusVisible:!0}),I.preventDefault(),I.stopImmediatePropagation()}#v(I){K._resizerKeyboardManager.exec(this,I)}#x(I){this.#Y&&I.relatedTarget?.parentNode!==this.#c&&this.#J()}#E(I){this.#w=this.#Y?I:""}#Q(I){if(this.#g)for(const g of this.#g)g.tabIndex=I}_resizeWithKeyboard(I,g){this.#Y&&this.#F(this.#w,{deltaX:I,deltaY:g,fromKeyboard:!0})}#J(){this.#Y=!1,this.#Q(-1),this.#k()}_stopResizingWithKeyboard(){this.#J(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#A?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#A?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(I,g){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(I){I.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#o}set isEditing(I){this.#o=I,this.parent&&(I?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(I,g=!1){if(g){this.#n||=new Map;const{action:C}=I;let A=this.#n.get(C);A&&clearTimeout(A),A=setTimeout(()=>{this._reportTelemetry(I),this.#n.delete(C),this.#n.size===0&&(this.#n=null)},K._telemetryTimeout),this.#n.set(C,A);return}I.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:I}})}show(I=this._isVisible){this.div.classList.toggle("hidden",!I),this._isVisible=I}enable(){this.div&&(this.div.tabIndex=0),this.#i=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#i=!0}updateFakeAnnotationElement(I){if(!this.#b&&!this.deleted){this.#b=I.addFakeAnnotation(this);return}if(this.deleted){this.#b.remove(),this.#b=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#b.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(I){if(this.deleted)return I.hide(),null;let g=I.container.querySelector(".annotationContent");if(!g)g=document.createElement("div"),g.classList.add("annotationContent",this.editorType),I.container.prepend(g);else if(g.nodeName==="CANVAS"){const C=g;g=document.createElement("div"),g.classList.add("annotationContent",this.editorType),C.before(g)}return g}resetAnnotationElement(I){const{firstElementChild:g}=I.container;g?.nodeName==="DIV"&&g.classList.contains("annotationContent")&&g.remove()}}class gZ extends K{constructor(I){super(I),this.annotationElementId=I.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const wl=3285377520,FI=4294901760,UI=65535;class hl{constructor(I){this.h1=I?I&4294967295:wl,this.h2=I?I&4294967295:wl}update(I){let g,C;if(typeof I=="string"){g=new Uint8Array(I.length*2),C=0;for(let o=0,h=I.length;o<h;o++){const w=I.charCodeAt(o);w<=255?g[C++]=w:(g[C++]=w>>>8,g[C++]=w&255)}}else if(ArrayBuffer.isView(I))g=I.slice(),C=g.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const A=C>>2,l=C-A*4,i=new Uint32Array(g.buffer,0,A);let Z=0,d=0,s=this.h1,c=this.h2;const b=3432918353,m=461845907,B=b&UI,W=m&UI;for(let o=0;o<A;o++)o&1?(Z=i[o],Z=Z*b&FI|Z*B&UI,Z=Z<<15|Z>>>17,Z=Z*m&FI|Z*W&UI,s^=Z,s=s<<13|s>>>19,s=s*5+3864292196):(d=i[o],d=d*b&FI|d*B&UI,d=d<<15|d>>>17,d=d*m&FI|d*W&UI,c^=d,c=c<<13|c>>>19,c=c*5+3864292196);switch(Z=0,l){case 3:Z^=g[A*4+2]<<16;case 2:Z^=g[A*4+1]<<8;case 1:Z^=g[A*4],Z=Z*b&FI|Z*B&UI,Z=Z<<15|Z>>>17,Z=Z*m&FI|Z*W&UI,A&1?s^=Z:c^=Z}this.h1=s,this.h2=c}hexdigest(){let I=this.h1,g=this.h2;return I^=g>>>1,I=I*3981806797&FI|I*36045&UI,g=g*4283543511&FI|((g<<16|I>>>16)*2950163797&FI)>>>16,I^=g>>>1,I=I*444984403&FI|I*60499&UI,g=g*3301882366&FI|((g<<16|I>>>16)*3120437893&FI)>>>16,I^=g>>>1,(I>>>0).toString(16).padStart(8,"0")+(g>>>0).toString(16).padStart(8,"0")}}const hA=Object.freeze({map:null,hash:"",transfer:void 0});class aA{#I=!1;#g=null;#A=null;#C=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(I,g){const C=this.#C.get(I);return C===void 0?g:Object.assign(g,C)}getRawValue(I){return this.#C.get(I)}remove(I){const g=this.#C.get(I);if(g!==void 0&&(g instanceof K&&this.#A.delete(g.annotationElementId),this.#C.delete(I),this.#C.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const C of this.#C.values())if(C instanceof K)return;this.onAnnotationEditor(null)}}setValue(I,g){const C=this.#C.get(I);let A=!1;if(C!==void 0)for(const[l,i]of Object.entries(g))C[l]!==i&&(A=!0,C[l]=i);else A=!0,this.#C.set(I,g);A&&this.#Z(),g instanceof K&&((this.#A||=new Map).set(g.annotationElementId,g),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(g.constructor._type))}has(I){return this.#C.has(I)}get size(){return this.#C.size}#Z(){this.#I||(this.#I=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#I&&(this.#I=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new al(this)}get serializable(){if(this.#C.size===0)return hA;const I=new Map,g=new hl,C=[],A=Object.create(null);let l=!1;for(const[i,Z]of this.#C){const d=Z instanceof K?Z.serialize(!1,A):Z;d&&(I.set(i,d),g.update(`${i}:${JSON.stringify(d)}`),l||=!!d.bitmap)}if(l)for(const i of I.values())i.bitmap&&C.push(i.bitmap);return I.size>0?{map:I,hash:g.hexdigest(),transfer:C}:hA}get editorStats(){let I=null;const g=new Map;let C=0,A=0;for(const l of this.#C.values()){if(!(l instanceof K)){l.popup&&(l.popup.deleted?A+=1:C+=1);continue}l.isCommentDeleted?A+=1:l.hasEditedComment&&(C+=1);const i=l.telemetryFinalData;if(!i)continue;const{type:Z}=i;g.has(Z)||g.set(Z,Object.getPrototypeOf(l).constructor),I||=Object.create(null);const d=I[Z]||=new Map;for(const[s,c]of Object.entries(i)){if(s==="type")continue;let b=d.get(s);b||(b=new Map,d.set(s,b));const m=b.get(c)??0;b.set(c,m+1)}}if((A>0||C>0)&&(I||=Object.create(null),I.comments={deleted:A,edited:C}),!I)return null;for(const[l,i]of g)I[l]=i.computeTelemetryFinalData(I[l]);return I}resetModifiedIds(){this.#g=null}updateEditor(I,g){const C=this.#A?.get(I);return C?(C.updateFromAnnotationLayer(g),!0):!1}getEditor(I){return this.#A?.get(I)||null}get modifiedIds(){if(this.#g)return this.#g;const I=[];if(this.#A)for(const g of this.#A.values())g.serialize()&&I.push(g.annotationElementId);return this.#g={ids:new Set(I),hash:I.join(",")}}[Symbol.iterator](){return this.#C.entries()}}class al extends aA{#I;constructor(I){super();const{map:g,hash:C,transfer:A}=I.serializable,l=structuredClone(g,A?{transfer:A}:null);this.#I={map:l,hash:C,transfer:A}}get print(){E("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#I}get modifiedIds(){return J(this,"modifiedIds",{ids:new Set,hash:""})}}class CZ{#I=new Set;constructor({ownerDocument:I=globalThis.document,styleElement:g=null}){this._document=I,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(I){this.nativeFontFaces.add(I),this._document.fonts.add(I)}removeNativeFontFace(I){this.nativeFontFaces.delete(I),this._document.fonts.delete(I)}insertRule(I){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const g=this.styleElement.sheet;g.insertRule(I,g.cssRules.length)}clear(){for(const I of this.nativeFontFaces)this._document.fonts.delete(I);this.nativeFontFaces.clear(),this.#I.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:I,disableFontFace:g,_inspectFont:C}){if(!(!I||this.#I.has(I.loadedName))){if(T(!g,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:A,src:l,style:i}=I,Z=new FontFace(A,l,i);this.addNativeFontFace(Z);try{await Z.load(),this.#I.add(A),C?.(I)}catch{F(`Cannot load system font: ${I.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(Z)}return}E("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(I){if(I.attached||I.missingFile&&!I.systemFontInfo)return;if(I.attached=!0,I.systemFontInfo){await this.loadSystemFont(I);return}if(this.isFontLoadingAPISupported){const C=I.createNativeFontFace();if(C){this.addNativeFontFace(C);try{await C.loaded}catch(A){throw F(`Failed to load font '${C.family}': '${A}'.`),I.disableFontFace=!0,A}}return}const g=I.createFontFaceRule();if(g){if(this.insertRule(g),this.isSyncFontLoadingSupported)return;await new Promise(C=>{const A=this._queueLoadingCallback(C);this._prepareFontLoadEvent(I,A)})}}get isFontLoadingAPISupported(){const I=!!this._document?.fonts;return J(this,"isFontLoadingAPISupported",I)}get isSyncFontLoadingSupported(){return J(this,"isSyncFontLoadingSupported",VI||BI.platform.isFirefox)}_queueLoadingCallback(I){function g(){for(T(!A.done,"completeRequest() cannot be called twice."),A.done=!0;C.length>0&&C[0].done;){const l=C.shift();setTimeout(l.callback,0)}}const{loadingRequests:C}=this,A={done:!1,complete:g,callback:I};return C.push(A),A}get _loadTestFont(){const I=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return J(this,"_loadTestFont",I)}_prepareFontLoadEvent(I,g){function C(V,n){return V.charCodeAt(n)<<24|V.charCodeAt(n+1)<<16|V.charCodeAt(n+2)<<8|V.charCodeAt(n+3)&255}function A(V,n,e,t){const N=V.substring(0,n),R=V.substring(n+e);return N+t+R}let l,i;const Z=this._document.createElement("canvas");Z.width=1,Z.height=1;const d=Z.getContext("2d");let s=0;function c(V,n){if(++s>30){F("Load test font never loaded."),n();return}if(d.font="30px "+V,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){n();return}setTimeout(c.bind(null,V,n))}const b=`lt${Date.now()}${this.loadTestFontId++}`;let m=this._loadTestFont;m=A(m,976,b.length,b);const W=16,o=1482184792;let h=C(m,W);for(l=0,i=b.length-3;l<i;l+=4)h=h-o+C(b,l)|0;l<b.length&&(h=h-o+C(b+"XXX",l)|0),m=A(m,W,4,Ji(h));const w=`url(data:font/opentype;base64,${btoa(m)});`,a=`@font-face {font-family:"${b}";src:${w}}`;this.insertRule(a);const Y=this._document.createElement("div");Y.style.visibility="hidden",Y.style.width=Y.style.height="10px",Y.style.position="absolute",Y.style.top=Y.style.left="0px";for(const V of[I.loadedName,b]){const n=this._document.createElement("span");n.textContent="Hi",n.style.fontFamily=V,Y.append(n)}this._document.body.append(Y),c(b,()=>{Y.remove(),g.complete()})}}class AZ{#I;constructor(I,g=null,C,A){this.compiledGlyphs=Object.create(null),this.#I=I,this._inspectFont=g,C&&Object.assign(this,C),A&&(this.charProcOperatorList=A)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let I;if(!this.cssFontInfo)I=new FontFace(this.loadedName,this.data,{});else{const g={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(g.style=`oblique ${this.cssFontInfo.italicAngle}deg`),I=new FontFace(this.cssFontInfo.fontFamily,this.data,g)}return this._inspectFont?.(this),I}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const I=`url(data:${this.mimetype};base64,${Zl(this.data)});`;let g;if(!this.cssFontInfo)g=`@font-face {font-family:"${this.loadedName}";src:${I}}`;else{let C=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(C+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),g=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${C}src:${I}}`}return this._inspectFont?.(this,I),g}getPathGenerator(I,g){if(this.compiledGlyphs[g]!==void 0)return this.compiledGlyphs[g];const C=this.loadedName+"_path_"+g;let A;try{A=I.get(C)}catch(i){F(`getPathGenerator - ignoring character: "${i}".`)}const l=ol(A?.path);return this.fontExtraProperties||I.delete(C),this.compiledGlyphs[g]=l}get black(){return this.#I.black}get bold(){return this.#I.bold}get disableFontFace(){return this.#I.disableFontFace??!1}set disableFontFace(I){J(this,"disableFontFace",!!I)}get fontExtraProperties(){return this.#I.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#I.isInvalidPDFjsFont}get isType3Font(){return this.#I.isType3Font}get italic(){return this.#I.italic}get missingFile(){return this.#I.missingFile}get remeasure(){return this.#I.remeasure}get vertical(){return this.#I.vertical}get ascent(){return this.#I.ascent}get defaultWidth(){return this.#I.defaultWidth}get descent(){return this.#I.descent}get bbox(){return this.#I.bbox}set bbox(I){J(this,"bbox",I)}get fontMatrix(){return this.#I.fontMatrix}get fallbackName(){return this.#I.fallbackName}get loadedName(){return this.#I.loadedName}get mimetype(){return this.#I.mimetype}get name(){return this.#I.name}get data(){return this.#I.data}clearData(){this.#I.clearData()}get cssFontInfo(){return this.#I.cssFontInfo}get systemFontInfo(){return this.#I.systemFontInfo}get defaultVMetrics(){return this.#I.defaultVMetrics}}class Tg{#I;#g;#A;static strings=["fontFamily","fontWeight","italicAngle"];static write(I){const g=new TextEncoder,C={};let A=0;for(const s of Tg.strings){const c=g.encode(I[s]);C[s]=c,A+=4+c.length}const l=new ArrayBuffer(A),i=new Uint8Array(l),Z=new DataView(l);let d=0;for(const s of Tg.strings){const c=C[s],b=c.length;Z.setUint32(d,b),i.set(c,d+4),d+=4+b}return T(d===l.byteLength,"CssFontInfo.write: Buffer overflow"),l}constructor(I){this.#I=I,this.#g=new DataView(this.#I),this.#A=new TextDecoder}#C(I){T(I<Tg.strings.length,"Invalid string index");let g=0;for(let A=0;A<I;A++)g+=this.#g.getUint32(g)+4;const C=this.#g.getUint32(g);return this.#A.decode(new Uint8Array(this.#I,g+4,C))}get fontFamily(){return this.#C(0)}get fontWeight(){return this.#C(1)}get italicAngle(){return this.#C(2)}}class jg{#I;#g;#A;static strings=["css","loadedName","baseFontName","src"];static write(I){const g=new TextEncoder,C={};let A=0;for(const m of jg.strings){const B=g.encode(I[m]);C[m]=B,A+=4+B.length}A+=4;let l,i,Z=1+A;I.style&&(l=g.encode(I.style.style),i=g.encode(I.style.weight),Z+=4+l.length+4+i.length);const d=new ArrayBuffer(Z),s=new Uint8Array(d),c=new DataView(d);let b=0;c.setUint8(b++,I.guessFallback?1:0),c.setUint32(b,0),b+=4,A=0;for(const m of jg.strings){const B=C[m],W=B.length;A+=4+W,c.setUint32(b,W),s.set(B,b+4),b+=4+W}return c.setUint32(b-A-4,A),I.style&&(c.setUint32(b,l.length),s.set(l,b+4),b+=4+l.length,c.setUint32(b,i.length),s.set(i,b+4),b+=4+i.length),T(b<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(b)}constructor(I){this.#I=I,this.#g=new DataView(this.#I),this.#A=new TextDecoder}get guessFallback(){return this.#g.getUint8(0)!==0}#C(I){T(I<jg.strings.length,"Invalid string index");let g=5;for(let A=0;A<I;A++)g+=this.#g.getUint32(g)+4;const C=this.#g.getUint32(g);return this.#A.decode(new Uint8Array(this.#I,g+4,C))}get css(){return this.#C(0)}get loadedName(){return this.#C(1)}get baseFontName(){return this.#C(2)}get src(){return this.#C(3)}get style(){let I=1;I+=4+this.#g.getUint32(I);const g=this.#g.getUint32(I),C=this.#A.decode(new Uint8Array(this.#I,I+4,g));I+=4+g;const A=this.#g.getUint32(I),l=this.#A.decode(new Uint8Array(this.#I,I+4,A));return{style:C,weight:l}}}class x{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#I=Math.ceil(this.bools.length*2/8);static#g=this.#I+this.numbers.length*8;static#A=this.#g+1+2*4;static#C=this.#A+1+8*6;static#Z=this.#C+1+2*3;#i;#l;#d;constructor({data:I,extra:g}){this.#i=I,this.#l=new TextDecoder,this.#d=new DataView(this.#i),g&&Object.assign(this,g)}#c(I){T(I<x.bools.length,"Invalid boolean index");const g=Math.floor(I/4),C=I*2%8,A=this.#d.getUint8(g)>>C&3;return A===0?void 0:A===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#s(I){return T(I<x.numbers.length,"Invalid number index"),this.#d.getFloat64(x.#I+I*8)}get ascent(){return this.#s(0)}get defaultWidth(){return this.#s(1)}get descent(){return this.#s(2)}get bbox(){let I=x.#g;if(this.#d.getUint8(I)===0)return;I+=1;const C=[];for(let A=0;A<4;A++)C.push(this.#d.getInt16(I,!0)),I+=2;return C}get fontMatrix(){let I=x.#A;if(this.#d.getUint8(I)===0)return;I+=1;const C=[];for(let A=0;A<6;A++)C.push(this.#d.getFloat64(I,!0)),I+=8;return C}get defaultVMetrics(){let I=x.#C;if(this.#d.getUint8(I)===0)return;I+=1;const C=[];for(let A=0;A<3;A++)C.push(this.#d.getInt16(I,!0)),I+=2;return C}#m(I){T(I<x.strings.length,"Invalid string index");let g=x.#Z+4;for(let l=0;l<I;l++)g+=this.#d.getUint32(g)+4;const C=this.#d.getUint32(g),A=new Uint8Array(C);return A.set(new Uint8Array(this.#i,g+4,C)),this.#l.decode(A)}get fallbackName(){return this.#m(0)}get loadedName(){return this.#m(1)}get mimetype(){return this.#m(2)}get name(){return this.#m(3)}get data(){let I=x.#Z;const g=this.#d.getUint32(I);I+=4+g;const C=this.#d.getUint32(I);I+=4+C;const A=this.#d.getUint32(I);I+=4+A;const l=this.#d.getUint32(I);if(l!==0)return new Uint8Array(this.#i,I+4,l)}clearData(){let I=x.#Z;const g=this.#d.getUint32(I);I+=4+g;const C=this.#d.getUint32(I);I+=4+C;const A=this.#d.getUint32(I);I+=4+A;const l=this.#d.getUint32(I);new Uint8Array(this.#i,I+4,l).fill(0),this.#d.setUint32(I,0)}get cssFontInfo(){let I=x.#Z;const g=this.#d.getUint32(I);I+=4+g;const C=this.#d.getUint32(I);I+=4+C;const A=this.#d.getUint32(I);if(A===0)return null;const l=new Uint8Array(A);return l.set(new Uint8Array(this.#i,I+4,A)),new Tg(l.buffer)}get systemFontInfo(){let I=x.#Z;const g=this.#d.getUint32(I);I+=4+g;const C=this.#d.getUint32(I);if(C===0)return null;const A=new Uint8Array(C);return A.set(new Uint8Array(this.#i,I+4,C)),new jg(A.buffer)}static write(I){const g=I.systemFontInfo?jg.write(I.systemFontInfo):null,C=I.cssFontInfo?Tg.write(I.cssFontInfo):null,A=new TextEncoder,l={};let i=0;for(const o of x.strings)l[o]=A.encode(I[o]),i+=4+l[o].length;const Z=x.#Z+4+i+4+(g?g.byteLength:0)+4+(C?C.byteLength:0)+4+(I.data?I.data.length:0),d=new ArrayBuffer(Z),s=new Uint8Array(d),c=new DataView(d);let b=0;const m=x.bools.length;let B=0,W=0;for(let o=0;o<m;o++){const h=I[x.bools[o]];B|=(h===void 0?0:h?2:1)<<W,W+=2,(W===8||o===m-1)&&(c.setUint8(b++,B),B=0,W=0)}T(b===x.#I,"FontInfo.write: Boolean properties offset mismatch");for(const o of x.numbers)c.setFloat64(b,I[o]),b+=8;if(T(b===x.#g,"FontInfo.write: Number properties offset mismatch"),I.bbox){c.setUint8(b++,4);for(const o of I.bbox)c.setInt16(b,o,!0),b+=2}else c.setUint8(b++,0),b+=2*4;if(T(b===x.#A,"FontInfo.write: BBox properties offset mismatch"),I.fontMatrix){c.setUint8(b++,6);for(const o of I.fontMatrix)c.setFloat64(b,o,!0),b+=8}else c.setUint8(b++,0),b+=8*6;if(T(b===x.#C,"FontInfo.write: FontMatrix properties offset mismatch"),I.defaultVMetrics){c.setUint8(b++,1);for(const o of I.defaultVMetrics)c.setInt16(b,o,!0),b+=2}else c.setUint8(b++,0),b+=3*2;T(b===x.#Z,"FontInfo.write: DefaultVMetrics properties offset mismatch"),c.setUint32(x.#Z,0),b+=4;for(const o of x.strings){const h=l[o],w=h.length;c.setUint32(b,w),s.set(h,b+4),b+=4+w}if(c.setUint32(x.#Z,b-x.#Z-4),!g)c.setUint32(b,0),b+=4;else{const o=g.byteLength;c.setUint32(b,o),T(b+4+o<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),s.set(new Uint8Array(g),b+4),b+=4+o}if(!C)c.setUint32(b,0),b+=4;else{const o=C.byteLength;c.setUint32(b,o),T(b+4+o<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),s.set(new Uint8Array(C),b+4),b+=4+o}return I.data===void 0?(c.setUint32(b,0),b+=4):(c.setUint32(b,I.data.length),s.set(I.data,b+4),b+=4+I.data.length),T(b<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(b)}}class WI{static#I=0;static#g=1;static#A=2;static#C=3;static#Z=4;static#i=8;static#l=12;static#d=16;constructor(I){this.buffer=I,this.view=new DataView(I),this.data=new Uint8Array(I)}static write(I){let g,C=null,A=[],l=[],i=[],Z=[],d=null,s=null;switch(I[0]){case"RadialAxial":g=I[1]==="axial"?1:2,C=I[2],i=I[3],g===1?A.push(...I[4],...I[5]):A.push(I[4][0],I[4][1],I[6],I[5][0],I[5][1],I[7]);break;case"Mesh":g=3,d=I[1],A=I[2],l=I[3],Z=I[4]||[],C=I[6],s=I[7];break;default:throw new Error(`Unsupported pattern type: ${I[0]}`)}const c=Math.floor(A.length/2),b=Math.floor(l.length/3),m=i.length,B=Z.length;let W=0;for(const n of Z)W+=1,W=Math.ceil(W/4)*4,W+=4+n.coords.length*4,W+=4+n.colors.length*4,n.verticesPerRow!==void 0&&(W+=4);const o=20+c*8+b*3+m*8+(C?16:0)+(s?3:0)+W,h=new ArrayBuffer(o),w=new DataView(h),a=new Uint8Array(h);w.setUint8(WI.#I,g),w.setUint8(WI.#g,C?1:0),w.setUint8(WI.#A,s?1:0),w.setUint8(WI.#C,d),w.setUint32(WI.#Z,c,!0),w.setUint32(WI.#i,b,!0),w.setUint32(WI.#l,m,!0),w.setUint32(WI.#d,B,!0);let Y=20;new Float32Array(h,Y,c*2).set(A),Y+=c*8,a.set(l,Y),Y+=b*3;for(const[n,e]of i)w.setFloat32(Y,n,!0),Y+=4,w.setUint32(Y,parseInt(e.slice(1),16),!0),Y+=4;if(C)for(const n of C)w.setFloat32(Y,n,!0),Y+=4;s&&(a.set(s,Y),Y+=3);for(let n=0;n<Z.length;n++){const e=Z[n];w.setUint8(Y,e.type),Y+=1,Y=Math.ceil(Y/4)*4,w.setUint32(Y,e.coords.length,!0),Y+=4,new Int32Array(h,Y,e.coords.length).set(e.coords),Y+=e.coords.length*4,w.setUint32(Y,e.colors.length,!0),Y+=4,new Int32Array(h,Y,e.colors.length).set(e.colors),Y+=e.colors.length*4,e.verticesPerRow!==void 0&&(w.setUint32(Y,e.verticesPerRow,!0),Y+=4)}return h}getIR(){const I=this.view,g=this.data[WI.#I],C=!!this.data[WI.#g],A=!!this.data[WI.#A],l=I.getUint32(WI.#Z,!0),i=I.getUint32(WI.#i,!0),Z=I.getUint32(WI.#l,!0),d=I.getUint32(WI.#d,!0);let s=20;const c=new Float32Array(this.buffer,s,l*2);s+=l*8;const b=new Uint8Array(this.buffer,s,i*3);s+=i*3;const m=[];for(let h=0;h<Z;++h){const w=I.getFloat32(s,!0);s+=4;const a=I.getUint32(s,!0);s+=4,m.push([w,`#${a.toString(16).padStart(6,"0")}`])}let B=null;if(C){B=[];for(let h=0;h<4;++h)B.push(I.getFloat32(s,!0)),s+=4}let W=null;A&&(W=new Uint8Array(this.buffer,s,3),s+=3);const o=[];for(let h=0;h<d;++h){const w=I.getUint8(s);s+=1,s=Math.ceil(s/4)*4;const a=I.getUint32(s,!0);s+=4;const Y=new Int32Array(this.buffer,s,a);s+=a*4;const V=I.getUint32(s,!0);s+=4;const n=new Int32Array(this.buffer,s,V);s+=V*4;const e={type:w,coords:Y,colors:n};w===iA.LATTICE&&(e.verticesPerRow=I.getUint32(s,!0),s+=4),o.push(e)}if(g===1)return["RadialAxial","axial",B,m,Array.from(c.slice(0,2)),Array.from(c.slice(2,4)),null,null];if(g===2)return["RadialAxial","radial",B,m,[c[0],c[1]],[c[3],c[4]],c[2],c[5]];if(g===3){const h=this.data[WI.#C];let w=null;if(c.length>0){let a=c[0],Y=c[0],V=c[1],n=c[1];for(let e=0;e<c.length;e+=2){const t=c[e],N=c[e+1];a=a>t?t:a,V=V>N?N:V,Y=Y<t?t:Y,n=n<N?N:n}w=[a,V,Y,n]}return["Mesh",h,c,b,o,w,B,W]}throw new Error(`Unsupported pattern kind: ${g}`)}}class lZ{static write(I){let g,C;return BI.isFloat16ArraySupported?(C=new ArrayBuffer(I.length*2),g=new Float16Array(C)):(C=new ArrayBuffer(I.length*4),g=new Float32Array(C)),g.set(I),C}#I;constructor(I){this.#I=I}get path(){return BI.isFloat16ArraySupported?new Float16Array(this.#I):new Float32Array(this.#I)}}function iZ(G){if(G instanceof URL)return G.href;if(typeof G=="string"){if(VI)return G;const I=URL.parse(G,window.location);if(I)return I.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function ZZ(G){if(VI&&typeof Buffer<"u"&&G instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(G instanceof Uint8Array&&G.byteLength===G.buffer.byteLength)return G;if(typeof G=="string")return lC(G);if(G instanceof ArrayBuffer||ArrayBuffer.isView(G)||typeof G=="object"&&!isNaN(G?.length))return new Uint8Array(G);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function pC(G){if(typeof G!="string")return null;if(G.endsWith("/"))return G;throw new Error(`Invalid factory url: "${G}" must include trailing slash.`)}const YA=G=>typeof G=="object"&&Number.isInteger(G?.num)&&G.num>=0&&Number.isInteger(G?.gen)&&G.gen>=0,dZ=G=>typeof G=="object"&&typeof G?.name=="string",sZ=ji.bind(null,YA,dZ);class cZ{#I=new Map;#g=Promise.resolve();postMessage(I,g){const C={data:structuredClone(I,g?{transfer:g}:null)};this.#g.then(()=>{for(const[A]of this.#I)A.call(this,C)})}addEventListener(I,g,C=null){let A=null;if(C?.signal instanceof AbortSignal){const{signal:l}=C;if(l.aborted){F("LoopbackPort - cannot use an `aborted` signal.");return}const i=()=>this.removeEventListener(I,g);A=()=>l.removeEventListener("abort",i),l.addEventListener("abort",i)}this.#I.set(g,A)}removeEventListener(I,g){this.#I.get(g)?.(),this.#I.delete(g)}terminate(){for(const[,I]of this.#I)I?.();this.#I.clear()}}const FC={DATA:1,ERROR:2},dI={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Yl(){}function tI(G){if(G instanceof Ag||G instanceof dA||G instanceof Cl||G instanceof MC||G instanceof ZA)return G;switch(G instanceof Error||typeof G=="object"&&G!==null||E('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),G.name){case"AbortException":return new Ag(G.message);case"InvalidPDFException":return new dA(G.message);case"PasswordException":return new Cl(G.message,G.code);case"ResponseException":return new MC(G.message,G.status,G.missing);case"UnknownErrorException":return new ZA(G.message,G.details)}return new ZA(G.message,G.toString())}class mC{#I=new AbortController;constructor(I,g,C){this.sourceName=I,this.targetName=g,this.comObj=C,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),C.addEventListener("message",this.#g.bind(this),{signal:this.#I.signal})}#g({data:I}){if(I.targetName!==this.sourceName)return;if(I.stream){this.#C(I);return}if(I.callback){const C=I.callbackId,A=this.callbackCapabilities[C];if(!A)throw new Error(`Cannot resolve callback ${C}`);if(delete this.callbackCapabilities[C],I.callback===FC.DATA)A.resolve(I.data);else if(I.callback===FC.ERROR)A.reject(tI(I.reason));else throw new Error("Unexpected callback case");return}const g=this.actionHandler[I.action];if(!g)throw new Error(`Unknown action from worker: ${I.action}`);if(I.callbackId){const C=this.sourceName,A=I.sourceName,l=this.comObj;Promise.try(g,I.data).then(function(i){l.postMessage({sourceName:C,targetName:A,callback:FC.DATA,callbackId:I.callbackId,data:i})},function(i){l.postMessage({sourceName:C,targetName:A,callback:FC.ERROR,callbackId:I.callbackId,reason:tI(i)})});return}if(I.streamId){this.#A(I);return}g(I.data)}on(I,g){const C=this.actionHandler;if(C[I])throw new Error(`There is already an actionName called "${I}"`);C[I]=g}send(I,g,C){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:I,data:g},C)}sendWithPromise(I,g,C){const A=this.callbackId++,l=Promise.withResolvers();this.callbackCapabilities[A]=l;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:I,callbackId:A,data:g},C)}catch(i){l.reject(i)}return l.promise}sendWithStream(I,g,C,A){const l=this.streamId++,i=this.sourceName,Z=this.targetName,d=this.comObj;return new ReadableStream({start:s=>{const c=Promise.withResolvers();return this.streamControllers[l]={controller:s,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:i,targetName:Z,action:I,streamId:l,data:g,desiredSize:s.desiredSize},A),c.promise},pull:s=>{const c=Promise.withResolvers();return this.streamControllers[l].pullCall=c,d.postMessage({sourceName:i,targetName:Z,stream:dI.PULL,streamId:l,desiredSize:s.desiredSize}),c.promise},cancel:s=>{T(s instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[l].cancelCall=c,this.streamControllers[l].isClosed=!0,d.postMessage({sourceName:i,targetName:Z,stream:dI.CANCEL,streamId:l,reason:tI(s)}),c.promise}},C)}#A(I){const g=I.streamId,C=this.sourceName,A=I.sourceName,l=this.comObj,i=this,Z=this.actionHandler[I.action],d={enqueue(s,c=1,b){if(this.isCancelled)return;const m=this.desiredSize;this.desiredSize-=c,m>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),l.postMessage({sourceName:C,targetName:A,stream:dI.ENQUEUE,streamId:g,chunk:s},b)},close(){this.isCancelled||(this.isCancelled=!0,l.postMessage({sourceName:C,targetName:A,stream:dI.CLOSE,streamId:g}),delete i.streamSinks[g])},error(s){T(s instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,l.postMessage({sourceName:C,targetName:A,stream:dI.ERROR,streamId:g,reason:tI(s)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:I.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[g]=d,Promise.try(Z,I.data,d).then(function(){l.postMessage({sourceName:C,targetName:A,stream:dI.START_COMPLETE,streamId:g,success:!0})},function(s){l.postMessage({sourceName:C,targetName:A,stream:dI.START_COMPLETE,streamId:g,reason:tI(s)})})}#C(I){const g=I.streamId,C=this.sourceName,A=I.sourceName,l=this.comObj,i=this.streamControllers[g],Z=this.streamSinks[g];switch(I.stream){case dI.START_COMPLETE:I.success?i.startCall.resolve():i.startCall.reject(tI(I.reason));break;case dI.PULL_COMPLETE:I.success?i.pullCall.resolve():i.pullCall.reject(tI(I.reason));break;case dI.PULL:if(!Z){l.postMessage({sourceName:C,targetName:A,stream:dI.PULL_COMPLETE,streamId:g,success:!0});break}Z.desiredSize<=0&&I.desiredSize>0&&Z.sinkCapability.resolve(),Z.desiredSize=I.desiredSize,Promise.try(Z.onPull||Yl).then(function(){l.postMessage({sourceName:C,targetName:A,stream:dI.PULL_COMPLETE,streamId:g,success:!0})},function(s){l.postMessage({sourceName:C,targetName:A,stream:dI.PULL_COMPLETE,streamId:g,reason:tI(s)})});break;case dI.ENQUEUE:if(T(i,"enqueue should have stream controller"),i.isClosed)break;i.controller.enqueue(I.chunk);break;case dI.CLOSE:if(T(i,"close should have stream controller"),i.isClosed)break;i.isClosed=!0,i.controller.close(),this.#Z(i,g);break;case dI.ERROR:T(i,"error should have stream controller"),i.controller.error(tI(I.reason)),this.#Z(i,g);break;case dI.CANCEL_COMPLETE:I.success?i.cancelCall.resolve():i.cancelCall.reject(tI(I.reason)),this.#Z(i,g);break;case dI.CANCEL:if(!Z)break;const d=tI(I.reason);Promise.try(Z.onCancel||Yl,d).then(function(){l.postMessage({sourceName:C,targetName:A,stream:dI.CANCEL_COMPLETE,streamId:g,success:!0})},function(s){l.postMessage({sourceName:C,targetName:A,stream:dI.CANCEL_COMPLETE,streamId:g,reason:tI(s)})}),Z.sinkCapability.reject(d),Z.isCancelled=!0,delete this.streamSinks[g];break;default:throw new Error("Unexpected stream case")}}async#Z(I,g){await Promise.allSettled([I.startCall?.promise,I.pullCall?.promise,I.cancelCall?.promise]),delete this.streamControllers[g]}destroy(){this.#I?.abort(),this.#I=null}}class Vl{#I=!1;constructor({enableHWA:I=!1}){this.#I=I}create(I,g){if(I<=0||g<=0)throw new Error("Invalid canvas size");const C=this._createCanvas(I,g);return{canvas:C,context:C.getContext("2d",{willReadFrequently:!this.#I})}}reset(I,g,C){if(!I.canvas)throw new Error("Canvas is not specified");if(g<=0||C<=0)throw new Error("Invalid canvas size");I.canvas.width=g,I.canvas.height=C}destroy(I){if(!I.canvas)throw new Error("Canvas is not specified");I.canvas.width=0,I.canvas.height=0,I.canvas=null,I.context=null}_createCanvas(I,g){E("Abstract method `_createCanvas` called.")}}class GZ extends Vl{constructor({ownerDocument:I=globalThis.document,enableHWA:g=!1}){super({enableHWA:g}),this._document=I}_createCanvas(I,g){const C=this._document.createElement("canvas");return C.width=I,C.height=g,C}}class nl{constructor({baseUrl:I=null,isCompressed:g=!0}){this.baseUrl=I,this.isCompressed=g}async fetch({name:I}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!I)throw new Error("CMap name must be specified.");const g=this.baseUrl+I+(this.isCompressed?".bcmap":"");return this._fetch(g).then(C=>({cMapData:C,isCompressed:this.isCompressed})).catch(C=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${g}`)})}async _fetch(I){E("Abstract method `_fetch` called.")}}class el extends nl{async _fetch(I){const g=await ZC(I,this.isCompressed?"arraybuffer":"text");return g instanceof ArrayBuffer?new Uint8Array(g):lC(g)}}class tl{addFilter(I){return"none"}addHCMFilter(I,g){return"none"}addAlphaFilter(I){return"none"}addLuminosityFilter(I){return"none"}addHighlightHCMFilter(I,g,C,A,l){return"none"}destroy(I=!1){}}class bZ extends tl{#I;#g;#A;#C;#Z;#i;#l=0;constructor({docId:I,ownerDocument:g=globalThis.document}){super(),this.#C=I,this.#Z=g}get#d(){return this.#g||=new Map}get#c(){return this.#i||=new Map}get#s(){if(!this.#A){const I=this.#Z.createElement("div"),{style:g}=I;g.visibility="hidden",g.contain="strict",g.width=g.height=0,g.position="absolute",g.top=g.left=0,g.zIndex=-1;const C=this.#Z.createElementNS(_I,"svg");C.setAttribute("width",0),C.setAttribute("height",0),this.#A=this.#Z.createElementNS(_I,"defs"),I.append(C),C.append(this.#A),this.#Z.body.append(I)}return this.#A}#m(I){if(I.length===1){const d=I[0],s=new Array(256);for(let b=0;b<256;b++)s[b]=d[b]/255;const c=s.join(",");return[c,c,c]}const[g,C,A]=I,l=new Array(256),i=new Array(256),Z=new Array(256);for(let d=0;d<256;d++)l[d]=g[d]/255,i[d]=C[d]/255,Z[d]=A[d]/255;return[l.join(","),i.join(","),Z.join(",")]}#b(I){if(this.#I===void 0){this.#I="";const g=this.#Z.URL;g!==this.#Z.baseURI&&(DC(g)?F('#createUrl: ignore "data:"-URL for performance reasons.'):this.#I=gl(g,""))}return`url(${this.#I}#${I})`}addFilter(I){if(!I)return"none";let g=this.#d.get(I);if(g)return g;const[C,A,l]=this.#m(I),i=I.length===1?C:`${C}${A}${l}`;if(g=this.#d.get(i),g)return this.#d.set(I,g),g;const Z=`g_${this.#C}_transfer_map_${this.#l++}`,d=this.#b(Z);this.#d.set(I,d),this.#d.set(i,d);const s=this.#W(Z);return this.#o(C,A,l,s),d}addHCMFilter(I,g){const C=`${I}-${g}`,A="base";let l=this.#c.get(A);if(l?.key===C||(l?(l.filter?.remove(),l.key=C,l.url="none",l.filter=null):(l={key:C,url:"none",filter:null},this.#c.set(A,l)),!I||!g))return l.url;const i=this.#Y(I);I=u.makeHexColor(...i);const Z=this.#Y(g);if(g=u.makeHexColor(...Z),this.#s.style.color="",I==="#000000"&&g==="#ffffff"||I===g)return l.url;const d=new Array(256);for(let B=0;B<=255;B++){const W=B/255;d[B]=W<=.03928?W/12.92:((W+.055)/1.055)**2.4}const s=d.join(","),c=`g_${this.#C}_hcm_filter`,b=l.filter=this.#W(c);this.#o(s,s,s,b),this.#w(b);const m=(B,W)=>{const o=i[B]/255,h=Z[B]/255,w=new Array(W+1);for(let a=0;a<=W;a++)w[a]=o+a/W*(h-o);return w.join(",")};return this.#o(m(0,5),m(1,5),m(2,5),b),l.url=this.#b(c),l.url}addAlphaFilter(I){let g=this.#d.get(I);if(g)return g;const[C]=this.#m([I]),A=`alpha_${C}`;if(g=this.#d.get(A),g)return this.#d.set(I,g),g;const l=`g_${this.#C}_alpha_map_${this.#l++}`,i=this.#b(l);this.#d.set(I,i),this.#d.set(A,i);const Z=this.#W(l);return this.#h(C,Z),i}addLuminosityFilter(I){let g=this.#d.get(I||"luminosity");if(g)return g;let C,A;if(I?([C]=this.#m([I]),A=`luminosity_${C}`):A="luminosity",g=this.#d.get(A),g)return this.#d.set(I,g),g;const l=`g_${this.#C}_luminosity_map_${this.#l++}`,i=this.#b(l);this.#d.set(I,i),this.#d.set(A,i);const Z=this.#W(l);return this.#B(Z),I&&this.#h(C,Z),i}addHighlightHCMFilter(I,g,C,A,l){const i=`${g}-${C}-${A}-${l}`;let Z=this.#c.get(I);if(Z?.key===i||(Z?(Z.filter?.remove(),Z.key=i,Z.url="none",Z.filter=null):(Z={key:i,url:"none",filter:null},this.#c.set(I,Z)),!g||!C))return Z.url;const[d,s]=[g,C].map(this.#Y.bind(this));let c=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),b=Math.round(.2126*s[0]+.7152*s[1]+.0722*s[2]),[m,B]=[A,l].map(this.#Y.bind(this));b<c&&([c,b,m,B]=[b,c,B,m]),this.#s.style.color="";const W=(w,a,Y)=>{const V=new Array(256),n=(b-c)/Y,e=w/255,t=(a-w)/(255*Y);let N=0;for(let R=0;R<=Y;R++){const H=Math.round(c+R*n),y=e+R*t;for(let U=N;U<=H;U++)V[U]=y;N=H+1}for(let R=N;R<256;R++)V[R]=V[N-1];return V.join(",")},o=`g_${this.#C}_hcm_${I}_filter`,h=Z.filter=this.#W(o);return this.#w(h),this.#o(W(m[0],B[0],5),W(m[1],B[1],5),W(m[2],B[2],5),h),Z.url=this.#b(o),Z.url}destroy(I=!1){I&&this.#i?.size||(this.#A?.parentNode.parentNode.remove(),this.#A=null,this.#g?.clear(),this.#g=null,this.#i?.clear(),this.#i=null,this.#l=0)}#B(I){const g=this.#Z.createElementNS(_I,"feColorMatrix");g.setAttribute("type","matrix"),g.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),I.append(g)}#w(I){const g=this.#Z.createElementNS(_I,"feColorMatrix");g.setAttribute("type","matrix"),g.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),I.append(g)}#W(I){const g=this.#Z.createElementNS(_I,"filter");return g.setAttribute("color-interpolation-filters","sRGB"),g.setAttribute("id",I),this.#s.append(g),g}#G(I,g,C){const A=this.#Z.createElementNS(_I,g);A.setAttribute("type","discrete"),A.setAttribute("tableValues",C),I.append(A)}#o(I,g,C,A){const l=this.#Z.createElementNS(_I,"feComponentTransfer");A.append(l),this.#G(l,"feFuncR",I),this.#G(l,"feFuncG",g),this.#G(l,"feFuncB",C)}#h(I,g){const C=this.#Z.createElementNS(_I,"feComponentTransfer");g.append(C),this.#G(C,"feFuncA",I)}#Y(I){return this.#s.style.color=I,cC(getComputedStyle(this.#s).getPropertyValue("color"))}}class Nl{constructor({baseUrl:I=null}){this.baseUrl=I}async fetch({filename:I}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!I)throw new Error("Font filename must be specified.");const g=`${this.baseUrl}${I}`;return this._fetch(g).catch(C=>{throw new Error(`Unable to load font data at: ${g}`)})}async _fetch(I){E("Abstract method `_fetch` called.")}}class Xl extends Nl{async _fetch(I){const g=await ZC(I,"arraybuffer");return new Uint8Array(g)}}class Rl{constructor({baseUrl:I=null}){this.baseUrl=I}async fetch({filename:I}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!I)throw new Error("Wasm filename must be specified.");const g=`${this.baseUrl}${I}`;return this._fetch(g).catch(C=>{throw new Error(`Unable to load wasm data at: ${g}`)})}async _fetch(I){E("Abstract method `_fetch` called.")}}class yl extends Rl{async _fetch(I){const g=await ZC(I,"arraybuffer");return new Uint8Array(g)}}VI&&F("Please use the `legacy` build in Node.js environments.");async function VA(G){const g=await process.getBuiltinModule("fs").promises.readFile(G);return new Uint8Array(g)}class mZ extends tl{}class BZ extends Vl{_createCanvas(I,g){return process.getBuiltinModule("module").createRequire(v&&v.tagName.toUpperCase()==="SCRIPT"&&v.src||new URL("main.js",document.baseURI).href)("@napi-rs/canvas").createCanvas(I,g)}}class oZ extends nl{async _fetch(I){return VA(I)}}class WZ extends Nl{async _fetch(I){return VA(I)}}class wZ extends Rl{async _fetch(I){return VA(I)}}const Qg="__forcedDependency",{floor:ul,ceil:Hl}=Math;function JC(G,I,g,C,A,l){G[I*4+0]=Math.min(G[I*4+0],g),G[I*4+1]=Math.min(G[I*4+1],C),G[I*4+2]=Math.max(G[I*4+2],A),G[I*4+3]=Math.max(G[I*4+3],l)}const nA=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class hZ{#I;#g;constructor(I,g){this.#I=I,this.#g=g}get length(){return this.#I.length}isEmpty(I){return this.#I[I]===nA}minX(I){return this.#g[I*4+0]/256}minY(I){return this.#g[I*4+1]/256}maxX(I){return(this.#g[I*4+2]+1)/256}maxY(I){return(this.#g[I*4+3]+1)/256}}const zC=(G,I)=>{if(!G)return;let g=G.get(I);return g||(g={dependencies:new Set,isRenderingOperation:!1},G.set(I,g)),g};class aZ{#I={__proto__:null};#g={__proto__:null,transform:[],moveText:[],sameLineText:[],[Qg]:[]};#A=new Map;#C=[];#Z=[];#i=[[1,0,0,1,0,0]];#l=[-1/0,-1/0,1/0,1/0];#d=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#s=new Set;#m=new Map;#b=new Map;#B;#w;#W;#G;#o;constructor(I,g,C=!1){this.#B=I.width,this.#w=I.height,this.#h(g),C&&(this.#o=new Map)}growOperationsCount(I){I>=this.#G.length&&this.#h(I,this.#G)}#h(I,g){const C=new ArrayBuffer(I*4);this.#W=new Uint8ClampedArray(C),this.#G=new Uint32Array(C),g&&g.length>0?(this.#G.set(g),this.#G.fill(nA,g.length)):this.#G.fill(nA)}save(I){return this.#I={__proto__:this.#I},this.#g={__proto__:this.#g,transform:{__proto__:this.#g.transform},moveText:{__proto__:this.#g.moveText},sameLineText:{__proto__:this.#g.sameLineText},[Qg]:{__proto__:this.#g[Qg]}},this.#l={__proto__:this.#l},this.#C.push(I),this}restore(I){const g=Object.getPrototypeOf(this.#I);if(g===null)return this;this.#I=g,this.#g=Object.getPrototypeOf(this.#g),this.#l=Object.getPrototypeOf(this.#l);const C=this.#C.pop();return C!==void 0&&(zC(this.#o,I)?.dependencies.add(C),this.#G[I]=this.#G[C]),this}recordOpenMarker(I){return this.#C.push(I),this}getOpenMarker(){return this.#C.length===0?null:this.#C.at(-1)}recordCloseMarker(I){const g=this.#C.pop();return g!==void 0&&(zC(this.#o,I)?.dependencies.add(g),this.#G[I]=this.#G[g]),this}beginMarkedContent(I){return this.#Z.push(I),this}endMarkedContent(I){const g=this.#Z.pop();return g!==void 0&&(zC(this.#o,I)?.dependencies.add(g),this.#G[I]=this.#G[g]),this}pushBaseTransform(I){return this.#i.push(u.multiplyByDOMMatrix(this.#i.at(-1),I.getTransform())),this}popBaseTransform(){return this.#i.length>1&&this.#i.pop(),this}recordSimpleData(I,g){return this.#I[I]=g,this}recordIncrementalData(I,g){return this.#g[I].push(g),this}resetIncrementalData(I,g){return this.#g[I].length=0,this}recordNamedData(I,g){return this.#A.set(I,g),this}recordSimpleDataFromNamed(I,g,C){this.#I[I]=this.#A.get(g)??C}recordFutureForcedDependency(I,g){return this.recordIncrementalData(Qg,g),this}inheritSimpleDataAsFutureForcedDependencies(I){for(const g of I)g in this.#I&&this.recordFutureForcedDependency(g,this.#I[g]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const I of this.#s)this.recordFutureForcedDependency(Qg,I);return this}resetBBox(I){return this.#c!==I&&(this.#c=I,this.#d[0]=1/0,this.#d[1]=1/0,this.#d[2]=-1/0,this.#d[3]=-1/0),this}recordClipBox(I,g,C,A,l,i){const Z=u.multiplyByDOMMatrix(this.#i.at(-1),g.getTransform()),d=[1/0,1/0,-1/0,-1/0];u.axialAlignedBoundingBox([C,l,A,i],Z,d);const s=u.intersect(this.#l,d);return s?(this.#l[0]=s[0],this.#l[1]=s[1],this.#l[2]=s[2],this.#l[3]=s[3]):(this.#l[0]=this.#l[1]=1/0,this.#l[2]=this.#l[3]=-1/0),this}recordBBox(I,g,C,A,l,i){const Z=this.#l;if(Z[0]===1/0)return this;const d=u.multiplyByDOMMatrix(this.#i.at(-1),g.getTransform());if(Z[0]===-1/0)return u.axialAlignedBoundingBox([C,l,A,i],d,this.#d),this;const s=[1/0,1/0,-1/0,-1/0];return u.axialAlignedBoundingBox([C,l,A,i],d,s),this.#d[0]=Math.min(this.#d[0],Math.max(s[0],Z[0])),this.#d[1]=Math.min(this.#d[1],Math.max(s[1],Z[1])),this.#d[2]=Math.max(this.#d[2],Math.min(s[2],Z[2])),this.#d[3]=Math.max(this.#d[3],Math.min(s[3],Z[3])),this}recordCharacterBBox(I,g,C,A=1,l=0,i=0,Z){const d=C.bbox;let s,c;if(d&&(s=d[2]!==d[0]&&d[3]!==d[1]&&this.#b.get(C),s!==!1&&(c=[0,0,0,0],u.axialAlignedBoundingBox(d,C.fontMatrix,c),(A!==1||l!==0||i!==0)&&u.scaleMinMax([A,0,0,-A,l,i],c),s)))return this.recordBBox(I,g,c[0],c[2],c[1],c[3]);if(!Z)return this.recordFullPageBBox(I);const b=Z();return d&&c&&s===void 0&&(s=c[0]<=l-b.actualBoundingBoxLeft&&c[2]>=l+b.actualBoundingBoxRight&&c[1]<=i-b.actualBoundingBoxAscent&&c[3]>=i+b.actualBoundingBoxDescent,this.#b.set(C,s),s)?this.recordBBox(I,g,c[0],c[2],c[1],c[3]):this.recordBBox(I,g,l-b.actualBoundingBoxLeft,l+b.actualBoundingBoxRight,i-b.actualBoundingBoxAscent,i+b.actualBoundingBoxDescent)}recordFullPageBBox(I){return this.#d[0]=Math.max(0,this.#l[0]),this.#d[1]=Math.max(0,this.#l[1]),this.#d[2]=Math.min(this.#B,this.#l[2]),this.#d[3]=Math.min(this.#w,this.#l[3]),this}getSimpleIndex(I){return this.#I[I]}recordDependencies(I,g){const C=this.#s,A=this.#I,l=this.#g;for(const i of g)i in this.#I?C.add(A[i]):i in l&&l[i].forEach(C.add,C);return this}recordNamedDependency(I,g){return this.#A.has(g)&&this.#s.add(this.#A.get(g)),this}recordOperation(I,g=!1){if(this.recordDependencies(I,[Qg]),this.#o){const C=zC(this.#o,I),{dependencies:A}=C;this.#s.forEach(A.add,A),this.#C.forEach(A.add,A),this.#Z.forEach(A.add,A),A.delete(I),C.isRenderingOperation=!0}if(this.#c===I){const C=ul(this.#d[0]*256/this.#B),A=ul(this.#d[1]*256/this.#w),l=Hl(this.#d[2]*256/this.#B),i=Hl(this.#d[3]*256/this.#w);JC(this.#W,I,C,A,l,i);for(const Z of this.#s)Z!==I&&JC(this.#W,Z,C,A,l,i);for(const Z of this.#C)Z!==I&&JC(this.#W,Z,C,A,l,i);for(const Z of this.#Z)Z!==I&&JC(this.#W,Z,C,A,l,i);g||(this.#s.clear(),this.#c=-1)}return this}recordShowTextOperation(I,g=!1){const C=Array.from(this.#s);this.recordOperation(I,g),this.recordIncrementalData("sameLineText",I);for(const A of C)this.recordIncrementalData("sameLineText",A);return this}bboxToClipBoxDropOperation(I,g=!1){return this.#c===I&&(this.#c=-1,this.#l[0]=Math.max(this.#l[0],this.#d[0]),this.#l[1]=Math.max(this.#l[1],this.#d[1]),this.#l[2]=Math.min(this.#l[2],this.#d[2]),this.#l[3]=Math.min(this.#l[3],this.#d[3]),g||this.#s.clear()),this}_takePendingDependencies(){const I=this.#s;return this.#s=new Set,I}_extractOperation(I){const g=this.#m.get(I);return this.#m.delete(I),g}_pushPendingDependencies(I){for(const g of I)this.#s.add(g)}take(){return this.#b.clear(),new hZ(this.#G,this.#W)}takeDebugMetadata(){return this.#o}}class kC{#I;#g;#A;#C=0;#Z=0;constructor(I,g,C){if(I instanceof kC&&I.#A===!!C)return I;this.#I=I,this.#g=g,this.#A=!!C}growOperationsCount(){throw new Error("Unreachable")}save(I){return this.#Z++,this.#I.save(this.#g),this}restore(I){return this.#Z>0&&(this.#I.restore(this.#g),this.#Z--),this}recordOpenMarker(I){return this.#C++,this}getOpenMarker(){return this.#C>0?this.#g:this.#I.getOpenMarker()}recordCloseMarker(I){return this.#C--,this}beginMarkedContent(I){return this}endMarkedContent(I){return this}pushBaseTransform(I){return this.#I.pushBaseTransform(I),this}popBaseTransform(){return this.#I.popBaseTransform(),this}recordSimpleData(I,g){return this.#I.recordSimpleData(I,this.#g),this}recordIncrementalData(I,g){return this.#I.recordIncrementalData(I,this.#g),this}resetIncrementalData(I,g){return this.#I.resetIncrementalData(I,this.#g),this}recordNamedData(I,g){return this}recordSimpleDataFromNamed(I,g,C){return this.#I.recordSimpleDataFromNamed(I,g,this.#g),this}recordFutureForcedDependency(I,g){return this.#I.recordFutureForcedDependency(I,this.#g),this}inheritSimpleDataAsFutureForcedDependencies(I){return this.#I.inheritSimpleDataAsFutureForcedDependencies(I),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#I.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(I){return this.#A||this.#I.resetBBox(this.#g),this}recordClipBox(I,g,C,A,l,i){return this.#A||this.#I.recordClipBox(this.#g,g,C,A,l,i),this}recordBBox(I,g,C,A,l,i){return this.#A||this.#I.recordBBox(this.#g,g,C,A,l,i),this}recordCharacterBBox(I,g,C,A,l,i,Z){return this.#A||this.#I.recordCharacterBBox(this.#g,g,C,A,l,i,Z),this}recordFullPageBBox(I){return this.#A||this.#I.recordFullPageBBox(this.#g),this}getSimpleIndex(I){return this.#I.getSimpleIndex(I)}recordDependencies(I,g){return this.#I.recordDependencies(this.#g,g),this}recordNamedDependency(I,g){return this.#I.recordNamedDependency(this.#g,g),this}recordOperation(I){return this.#I.recordOperation(this.#g,!0),this}recordShowTextOperation(I){return this.#I.recordShowTextOperation(this.#g,!0),this}bboxToClipBoxDropOperation(I){return this.#A||this.#I.bboxToClipBoxDropOperation(this.#g,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const JI={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},aI={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function eA(G,I){if(!I)return;const g=I[2]-I[0],C=I[3]-I[1],A=new Path2D;A.rect(I[0],I[1],g,C),G.clip(A)}class tA{isModifyingCurrentTransform(){return!1}getPattern(){E("Abstract method `getPattern` called.")}}class YZ extends tA{constructor(I){super(),this._type=I[1],this._bbox=I[2],this._colorStops=I[3],this._p0=I[4],this._p1=I[5],this._r0=I[6],this._r1=I[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(I,g=null){let C,A=this._p0,l=this._p1;if(g&&(A=A.slice(),l=l.slice(),u.applyTransform(A,g),u.applyTransform(l,g)),this._type==="axial")C=I.createLinearGradient(A[0],A[1],l[0],l[1]);else if(this._type==="radial"){let i=this._r0,Z=this._r1;if(g){const d=new Float32Array(2);u.singularValueDecompose2dScale(g,d),i*=d[0],Z*=d[0]}C=I.createRadialGradient(A[0],A[1],i,l[0],l[1],Z)}for(const i of this._colorStops)C.addColorStop(i[0],i[1]);return C}getPattern(I,g,C,A){let l;if(A===aI.STROKE||A===aI.FILL){if(this.isOriginBased()){let m=u.transform(C,g.baseTransform);this.matrix&&(m=u.transform(m,this.matrix));const B=.001,W=Math.hypot(m[0],m[1]),o=Math.hypot(m[2],m[3]),h=(m[0]*m[2]+m[1]*m[3])/(W*o);if(Math.abs(h)<B)if(this.isRadial()){if(Math.abs(W-o)<B)return this._createGradient(I,m)}else return this._createGradient(I,m)}const i=g.current.getClippedPathBoundingBox(A,II(I))||[0,0,0,0],Z=Math.ceil(i[2]-i[0])||1,d=Math.ceil(i[3]-i[1])||1,s=g.cachedCanvases.getCanvas("pattern",Z,d),c=s.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-i[0],-i[1]),C=u.transform(C,[1,0,0,1,i[0],i[1]]),c.transform(...g.baseTransform),this.matrix&&c.transform(...this.matrix),eA(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),l=I.createPattern(s.canvas,"no-repeat");const b=new DOMMatrix(C);l.setTransform(b)}else eA(I,this._bbox),l=this._createGradient(I);return l}}function NA(G,I,g,C,A,l,i,Z){const d=I.coords,s=I.colors,c=G.data,b=G.width*4;let m;d[g+1]>d[C+1]&&(m=g,g=C,C=m,m=l,l=i,i=m),d[C+1]>d[A+1]&&(m=C,C=A,A=m,m=i,i=Z,Z=m),d[g+1]>d[C+1]&&(m=g,g=C,C=m,m=l,l=i,i=m);const B=(d[g]+I.offsetX)*I.scaleX,W=(d[g+1]+I.offsetY)*I.scaleY,o=(d[C]+I.offsetX)*I.scaleX,h=(d[C+1]+I.offsetY)*I.scaleY,w=(d[A]+I.offsetX)*I.scaleX,a=(d[A+1]+I.offsetY)*I.scaleY;if(W>=a)return;const Y=s[l],V=s[l+1],n=s[l+2],e=s[i],t=s[i+1],N=s[i+2],R=s[Z],H=s[Z+1],y=s[Z+2],U=Math.round(W),P=Math.round(a);let j,sI,D,p,O,SI,gg,cI;for(let f=U;f<=P;f++){if(f<h){const GI=f<W?0:(W-f)/(W-h);j=B-(B-o)*GI,sI=Y-(Y-e)*GI,D=V-(V-t)*GI,p=n-(n-N)*GI}else{let GI;f>a?GI=1:h===a?GI=0:GI=(h-f)/(h-a),j=o-(o-w)*GI,sI=e-(e-R)*GI,D=t-(t-H)*GI,p=N-(N-y)*GI}let _;f<W?_=0:f>a?_=1:_=(W-f)/(W-a),O=B-(B-w)*_,SI=Y-(Y-R)*_,gg=V-(V-H)*_,cI=n-(n-y)*_;const Jg=Math.round(Math.min(j,O)),wg=Math.round(Math.max(j,O));let hg=b*f+Jg*4;for(let GI=Jg;GI<=wg;GI++)_=(j-GI)/(j-O),_<0?_=0:_>1&&(_=1),c[hg++]=sI-(sI-SI)*_|0,c[hg++]=D-(D-gg)*_|0,c[hg++]=p-(p-cI)*_|0,c[hg++]=255}}function VZ(G,I,g){const C=I.coords,A=I.colors;let l,i;switch(I.type){case iA.LATTICE:const Z=I.verticesPerRow,d=Math.floor(C.length/Z)-1,s=Z-1;for(l=0;l<d;l++){let c=l*Z;for(let b=0;b<s;b++,c++)NA(G,g,C[c],C[c+1],C[c+Z],A[c],A[c+1],A[c+Z]),NA(G,g,C[c+Z+1],C[c+1],C[c+Z],A[c+Z+1],A[c+1],A[c+Z])}break;case iA.TRIANGLES:for(l=0,i=C.length;l<i;l+=3)NA(G,g,C[l],C[l+1],C[l+2],A[l],A[l+1],A[l+2]);break;default:throw new Error("illegal figure")}}class nZ extends tA{constructor(I){super(),this._coords=I[2],this._colors=I[3],this._figures=I[4],this._bounds=I[5],this._bbox=I[6],this._background=I[7],this.matrix=null}_createMeshCanvas(I,g,C){const Z=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),s=Math.ceil(this._bounds[2])-Z,c=Math.ceil(this._bounds[3])-d,b=Math.min(Math.ceil(Math.abs(s*I[0]*1.1)),3e3),m=Math.min(Math.ceil(Math.abs(c*I[1]*1.1)),3e3),B=s/b,W=c/m,o={coords:this._coords,colors:this._colors,offsetX:-Z,offsetY:-d,scaleX:1/B,scaleY:1/W},h=b+2*2,w=m+2*2,a=C.getCanvas("mesh",h,w),Y=a.context,V=Y.createImageData(b,m);if(g){const e=V.data;for(let t=0,N=e.length;t<N;t+=4)e[t]=g[0],e[t+1]=g[1],e[t+2]=g[2],e[t+3]=255}for(const e of this._figures)VZ(V,e,o);return Y.putImageData(V,2,2),{canvas:a.canvas,offsetX:Z-2*B,offsetY:d-2*W,scaleX:B,scaleY:W}}isModifyingCurrentTransform(){return!0}getPattern(I,g,C,A){eA(I,this._bbox);const l=new Float32Array(2);if(A===aI.SHADING)u.singularValueDecompose2dScale(II(I),l);else if(this.matrix){u.singularValueDecompose2dScale(this.matrix,l);const[Z,d]=l;u.singularValueDecompose2dScale(g.baseTransform,l),l[0]*=Z,l[1]*=d}else u.singularValueDecompose2dScale(g.baseTransform,l);const i=this._createMeshCanvas(l,A===aI.SHADING?null:this._background,g.cachedCanvases);return A!==aI.SHADING&&(I.setTransform(...g.baseTransform),this.matrix&&I.transform(...this.matrix)),I.translate(i.offsetX,i.offsetY),I.scale(i.scaleX,i.scaleY),I.createPattern(i.canvas,"no-repeat")}}class eZ extends tA{getPattern(){return"hotpink"}}function tZ(G){switch(G[0]){case"RadialAxial":return new YZ(G);case"Mesh":return new nZ(G);case"Dummy":return new eZ}throw new Error(`Unknown IR type: ${G[0]}`)}const Ml={COLORED:1,UNCOLORED:2};class XA{static MAX_PATTERN_SIZE=3e3;constructor(I,g,C,A){this.color=I[1],this.operatorList=I[2],this.matrix=I[3],this.bbox=I[4],this.xstep=I[5],this.ystep=I[6],this.paintType=I[7],this.tilingType=I[8],this.ctx=g,this.canvasGraphicsFactory=C,this.baseTransform=A}createPatternCanvas(I,g){const{bbox:C,operatorList:A,paintType:l,tilingType:i,color:Z,canvasGraphicsFactory:d}=this;let{xstep:s,ystep:c}=this;s=Math.abs(s),c=Math.abs(c),HC("TilingType: "+i);const b=C[0],m=C[1],B=C[2],W=C[3],o=B-b,h=W-m,w=new Float32Array(2);u.singularValueDecompose2dScale(this.matrix,w);const[a,Y]=w;u.singularValueDecompose2dScale(this.baseTransform,w);const V=a*w[0],n=Y*w[1];let e=o,t=h,N=!1,R=!1;const H=Math.ceil(s*V),y=Math.ceil(c*n),U=Math.ceil(o*V),P=Math.ceil(h*n);H>=U?e=s:N=!0,y>=P?t=c:R=!0;const j=this.getSizeAndScale(e,this.ctx.canvas.width,V),sI=this.getSizeAndScale(t,this.ctx.canvas.height,n),D=I.cachedCanvases.getCanvas("pattern",j.size,sI.size),p=D.context,O=d.createCanvasGraphics(p,g);if(O.groupLevel=I.groupLevel,this.setFillAndStrokeStyleToContext(O,l,Z),p.translate(-j.scale*b,-sI.scale*m),O.transform(0,j.scale,0,0,sI.scale,0,0),p.save(),O.dependencyTracker?.save(),this.clipBbox(O,b,m,B,W),O.baseTransform=II(O.ctx),O.executeOperatorList(A),O.endDrawing(),O.dependencyTracker?.restore(),p.restore(),N||R){const SI=D.canvas;N&&(e=s),R&&(t=c);const gg=this.getSizeAndScale(e,this.ctx.canvas.width,V),cI=this.getSizeAndScale(t,this.ctx.canvas.height,n),f=gg.size,_=cI.size,Jg=I.cachedCanvases.getCanvas("pattern-workaround",f,_),wg=Jg.context,hg=N?Math.floor(o/s):0,GI=R?Math.floor(h/c):0;for(let tC=0;tC<=hg;tC++)for(let NC=0;NC<=GI;NC++)wg.drawImage(SI,f*tC,_*NC,f,_,0,0,f,_);return{canvas:Jg.canvas,scaleX:gg.scale,scaleY:cI.scale,offsetX:b,offsetY:m}}return{canvas:D.canvas,scaleX:j.scale,scaleY:sI.scale,offsetX:b,offsetY:m}}getSizeAndScale(I,g,C){const A=Math.max(XA.MAX_PATTERN_SIZE,g);let l=Math.ceil(I*C);return l>=A?l=A:C=l/I,{scale:C,size:l}}clipBbox(I,g,C,A,l){const i=A-g,Z=l-C;I.ctx.rect(g,C,i,Z),u.axialAlignedBoundingBox([g,C,A,l],II(I.ctx),I.current.minMax),I.clip(),I.endPath()}setFillAndStrokeStyleToContext(I,g,C){const A=I.ctx,l=I.current;switch(g){case Ml.COLORED:const{fillStyle:i,strokeStyle:Z}=this.ctx;A.fillStyle=l.fillColor=i,A.strokeStyle=l.strokeColor=Z;break;case Ml.UNCOLORED:A.fillStyle=A.strokeStyle=C,l.fillColor=l.strokeColor=C;break;default:throw new Fi(`Unsupported paint type: ${g}`)}}isModifyingCurrentTransform(){return!1}getPattern(I,g,C,A,l){let i=C;A!==aI.SHADING&&(i=u.transform(i,g.baseTransform),this.matrix&&(i=u.transform(i,this.matrix)));const Z=this.createPatternCanvas(g,l);let d=new DOMMatrix(i);d=d.translate(Z.offsetX,Z.offsetY),d=d.scale(1/Z.scaleX,1/Z.scaleY);const s=I.createPattern(Z.canvas,"repeat");return s.setTransform(d),s}}function NZ({src:G,srcPos:I=0,dest:g,width:C,height:A,nonBlackColor:l=4294967295,inverseDecode:i=!1}){const Z=BI.isLittleEndian?4278190080:255,[d,s]=i?[l,Z]:[Z,l],c=C>>3,b=C&7,m=G.length;g=new Uint32Array(g.buffer);let B=0;for(let W=0;W<A;W++){for(const h=I+c;I<h;I++){const w=I<m?G[I]:255;g[B++]=w&128?s:d,g[B++]=w&64?s:d,g[B++]=w&32?s:d,g[B++]=w&16?s:d,g[B++]=w&8?s:d,g[B++]=w&4?s:d,g[B++]=w&2?s:d,g[B++]=w&1?s:d}if(b===0)continue;const o=I<m?G[I++]:255;for(let h=0;h<b;h++)g[B++]=o&1<<7-h?s:d}return{srcPos:I,destPos:B}}const Dl=16,Kl=100,XZ=15,Sl=10,NI=16,RA=new DOMMatrix,MI=new Float32Array(2),rg=new Float32Array([1/0,1/0,-1/0,-1/0]);function RZ(G,I){if(G._removeMirroring)throw new Error("Context is already forwarding operations.");G.__originalSave=G.save,G.__originalRestore=G.restore,G.__originalRotate=G.rotate,G.__originalScale=G.scale,G.__originalTranslate=G.translate,G.__originalTransform=G.transform,G.__originalSetTransform=G.setTransform,G.__originalResetTransform=G.resetTransform,G.__originalClip=G.clip,G.__originalMoveTo=G.moveTo,G.__originalLineTo=G.lineTo,G.__originalBezierCurveTo=G.bezierCurveTo,G.__originalRect=G.rect,G.__originalClosePath=G.closePath,G.__originalBeginPath=G.beginPath,G._removeMirroring=()=>{G.save=G.__originalSave,G.restore=G.__originalRestore,G.rotate=G.__originalRotate,G.scale=G.__originalScale,G.translate=G.__originalTranslate,G.transform=G.__originalTransform,G.setTransform=G.__originalSetTransform,G.resetTransform=G.__originalResetTransform,G.clip=G.__originalClip,G.moveTo=G.__originalMoveTo,G.lineTo=G.__originalLineTo,G.bezierCurveTo=G.__originalBezierCurveTo,G.rect=G.__originalRect,G.closePath=G.__originalClosePath,G.beginPath=G.__originalBeginPath,delete G._removeMirroring},G.save=function(){I.save(),this.__originalSave()},G.restore=function(){I.restore(),this.__originalRestore()},G.translate=function(g,C){I.translate(g,C),this.__originalTranslate(g,C)},G.scale=function(g,C){I.scale(g,C),this.__originalScale(g,C)},G.transform=function(g,C,A,l,i,Z){I.transform(g,C,A,l,i,Z),this.__originalTransform(g,C,A,l,i,Z)},G.setTransform=function(g,C,A,l,i,Z){I.setTransform(g,C,A,l,i,Z),this.__originalSetTransform(g,C,A,l,i,Z)},G.resetTransform=function(){I.resetTransform(),this.__originalResetTransform()},G.rotate=function(g){I.rotate(g),this.__originalRotate(g)},G.clip=function(g){I.clip(g),this.__originalClip(g)},G.moveTo=function(g,C){I.moveTo(g,C),this.__originalMoveTo(g,C)},G.lineTo=function(g,C){I.lineTo(g,C),this.__originalLineTo(g,C)},G.bezierCurveTo=function(g,C,A,l,i,Z){I.bezierCurveTo(g,C,A,l,i,Z),this.__originalBezierCurveTo(g,C,A,l,i,Z)},G.rect=function(g,C,A,l){I.rect(g,C,A,l),this.__originalRect(g,C,A,l)},G.closePath=function(){I.closePath(),this.__originalClosePath()},G.beginPath=function(){I.beginPath(),this.__originalBeginPath()}}class yZ{constructor(I){this.canvasFactory=I,this.cache=Object.create(null)}getCanvas(I,g,C){let A;return this.cache[I]!==void 0?(A=this.cache[I],this.canvasFactory.reset(A,g,C)):(A=this.canvasFactory.create(g,C),this.cache[I]=A),A}delete(I){delete this.cache[I]}clear(){for(const I in this.cache){const g=this.cache[I];this.canvasFactory.destroy(g),delete this.cache[I]}}}function LC(G,I,g,C,A,l,i,Z,d,s){const[c,b,m,B,W,o]=II(G);if(b===0&&m===0){const a=i*c+W,Y=Math.round(a),V=Z*B+o,n=Math.round(V),e=(i+d)*c+W,t=Math.abs(Math.round(e)-Y)||1,N=(Z+s)*B+o,R=Math.abs(Math.round(N)-n)||1;return G.setTransform(Math.sign(c),0,0,Math.sign(B),Y,n),G.drawImage(I,g,C,A,l,0,0,t,R),G.setTransform(c,b,m,B,W,o),[t,R]}if(c===0&&B===0){const a=Z*m+W,Y=Math.round(a),V=i*b+o,n=Math.round(V),e=(Z+s)*m+W,t=Math.abs(Math.round(e)-Y)||1,N=(i+d)*b+o,R=Math.abs(Math.round(N)-n)||1;return G.setTransform(0,Math.sign(b),Math.sign(m),0,Y,n),G.drawImage(I,g,C,A,l,0,0,R,t),G.setTransform(c,b,m,B,W,o),[R,t]}G.drawImage(I,g,C,A,l,i,Z,d,s);const h=Math.hypot(c,b),w=Math.hypot(m,B);return[h*d,w*s]}class pl{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=AA;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=mI.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(I,g,C){C?.(this),this.clipBox=new Float32Array([0,0,I,g]),this.minMax=rg.slice()}clone(){const I=Object.create(this);return I.clipBox=this.clipBox.slice(),I.minMax=this.minMax.slice(),I}getPathBoundingBox(I=aI.FILL,g=null){const C=this.minMax.slice();if(I===aI.STROKE){g||E("Stroke bounding box must include transform."),u.singularValueDecompose2dScale(g,MI);const A=MI[0]*this.lineWidth/2,l=MI[1]*this.lineWidth/2;C[0]-=A,C[1]-=l,C[2]+=A,C[3]+=l}return C}updateClipFromPath(){const I=u.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(I||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(I){this.clipBox.set(I,0),this.minMax.set(rg,0)}getClippedPathBoundingBox(I=aI.FILL,g=null){return u.intersect(this.clipBox,this.getPathBoundingBox(I,g))}}function Fl(G,I){if(I instanceof ImageData){G.putImageData(I,0,0);return}const g=I.height,C=I.width,A=g%NI,l=(g-A)/NI,i=A===0?l:l+1,Z=G.createImageData(C,NI);let d=0,s;const c=I.data,b=Z.data;let m,B,W,o;if(I.kind===RC.GRAYSCALE_1BPP){const h=c.byteLength,w=new Uint32Array(b.buffer,0,b.byteLength>>2),a=w.length,Y=C+7>>3,V=4294967295,n=BI.isLittleEndian?4278190080:255;for(m=0;m<i;m++){for(W=m<l?NI:A,s=0,B=0;B<W;B++){const e=h-d;let t=0;const N=e>Y?C:e*8-7,R=N&-8;let H=0,y=0;for(;t<R;t+=8)y=c[d++],w[s++]=y&128?V:n,w[s++]=y&64?V:n,w[s++]=y&32?V:n,w[s++]=y&16?V:n,w[s++]=y&8?V:n,w[s++]=y&4?V:n,w[s++]=y&2?V:n,w[s++]=y&1?V:n;for(;t<N;t++)H===0&&(y=c[d++],H=128),w[s++]=y&H?V:n,H>>=1}for(;s<a;)w[s++]=0;G.putImageData(Z,0,m*NI)}}else if(I.kind===RC.RGBA_32BPP){for(B=0,o=C*NI*4,m=0;m<l;m++)b.set(c.subarray(d,d+o)),d+=o,G.putImageData(Z,0,B),B+=NI;m<i&&(o=C*A*4,b.set(c.subarray(d,d+o)),G.putImageData(Z,0,B))}else if(I.kind===RC.RGB_24BPP)for(W=NI,o=C*W,m=0;m<i;m++){for(m>=l&&(W=A,o=C*W),s=0,B=o;B--;)b[s++]=c[d++],b[s++]=c[d++],b[s++]=c[d++],b[s++]=255;G.putImageData(Z,0,m*NI)}else throw new Error(`bad image kind: ${I.kind}`)}function Jl(G,I){if(I.bitmap){G.drawImage(I.bitmap,0,0);return}const g=I.height,C=I.width,A=g%NI,l=(g-A)/NI,i=A===0?l:l+1,Z=G.createImageData(C,NI);let d=0;const s=I.data,c=Z.data;for(let b=0;b<i;b++){const m=b<l?NI:A;({srcPos:d}=NZ({src:s,srcPos:d,dest:c,width:C,height:m,nonBlackColor:0})),G.putImageData(Z,0,b*NI)}}function BC(G,I){const g=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const C of g)G[C]!==void 0&&(I[C]=G[C]);G.setLineDash!==void 0&&(I.setLineDash(G.getLineDash()),I.lineDashOffset=G.lineDashOffset)}function TC(G){G.strokeStyle=G.fillStyle="#000000",G.fillRule="nonzero",G.globalAlpha=1,G.lineWidth=1,G.lineCap="butt",G.lineJoin="miter",G.miterLimit=10,G.globalCompositeOperation="source-over",G.font="10px sans-serif",G.setLineDash!==void 0&&(G.setLineDash([]),G.lineDashOffset=0);const{filter:I}=G;I!=="none"&&I!==""&&(G.filter="none")}function zl(G,I){if(I)return!0;u.singularValueDecompose2dScale(G,MI);const g=Math.fround(QI.pixelRatio*Lg.PDF_TO_CSS_UNITS);return MI[0]<=g&&MI[1]<=g}const uZ=["butt","round","square"],HZ=["miter","round","bevel"],MZ={},kl={};class Ug{constructor(I,g,C,A,l,{optionalContentConfig:i,markedContentStack:Z=null},d,s,c){this.ctx=I,this.current=new pl(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=g,this.objs=C,this.canvasFactory=A,this.filterFactory=l,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=Z||[],this.optionalContentConfig=i,this.cachedCanvases=new yZ(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=s,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=c??null}getObject(I,g,C=null){return typeof g=="string"?(this.dependencyTracker?.recordNamedDependency(I,g),g.startsWith("g_")?this.commonObjs.get(g):this.objs.get(g)):C}beginDrawing({transform:I,viewport:g,transparency:C=!1,background:A=null}){const l=this.ctx.canvas.width,i=this.ctx.canvas.height,Z=this.ctx.fillStyle;if(this.ctx.fillStyle=A||"#ffffff",this.ctx.fillRect(0,0,l,i),this.ctx.fillStyle=Z,C){const d=this.cachedCanvases.getCanvas("transparent",l,i);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...II(this.compositeCtx))}this.ctx.save(),TC(this.ctx),I&&(this.ctx.transform(...I),this.outputScaleX=I[0],this.outputScaleY=I[0]),this.ctx.transform(...g.transform),this.viewportScale=g.scale,this.baseTransform=II(this.ctx)}executeOperatorList(I,g,C,A,l){const i=I.argsArray,Z=I.fnArray;let d=g||0;const s=i.length;if(s===d)return d;const c=s-d>Sl&&typeof C=="function",b=c?Date.now()+XZ:0;let m=0;const B=this.commonObjs,W=this.objs;let o,h;for(;;){if(A!==void 0&&d===A.nextBreakPoint)return A.breakIt(d,C),d;if(!l||l(d))if(o=Z[d],h=i[d]??null,o!==CC.dependency)h===null?this[o](d):this[o](d,...h);else for(const w of h){this.dependencyTracker?.recordNamedData(w,d);const a=w.startsWith("g_")?B:W;if(!a.has(w))return a.get(w,C),d}if(d++,d===s)return d;if(c&&++m>Sl){if(Date.now()>b)return C(),d;m=0}}}#I(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#I(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const I of this._cachedBitmapsMap.values()){for(const g of I.values())typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement&&(g.width=g.height=0);I.clear()}this._cachedBitmapsMap.clear(),this.#g()}#g(){if(this.pageColors){const I=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(I!=="none"){const g=this.ctx.filter;this.ctx.filter=I,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=g}}}_scaleImage(I,g){const C=I.width??I.displayWidth,A=I.height??I.displayHeight;let l=Math.max(Math.hypot(g[0],g[1]),1),i=Math.max(Math.hypot(g[2],g[3]),1),Z=C,d=A,s="prescale1",c,b;for(;l>2&&Z>1||i>2&&d>1;){let m=Z,B=d;l>2&&Z>1&&(m=Z>=16384?Math.floor(Z/2)-1||1:Math.ceil(Z/2),l/=Z/m),i>2&&d>1&&(B=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,i/=d/B),c=this.cachedCanvases.getCanvas(s,m,B),b=c.context,b.clearRect(0,0,m,B),b.drawImage(I,0,0,Z,d,0,0,m,B),I=c.canvas,Z=m,d=B,s=s==="prescale1"?"prescale2":"prescale1"}return{img:I,paintWidth:Z,paintHeight:d}}_createMaskCanvas(I,g){const C=this.ctx,{width:A,height:l}=g,i=this.current.fillColor,Z=this.current.patternFill,d=II(C);let s,c,b,m;if((g.bitmap||g.data)&&g.count>1){const H=g.bitmap||g.data.buffer;c=JSON.stringify(Z?d:[d.slice(0,4),i]),s=this._cachedBitmapsMap.get(H),s||(s=new Map,this._cachedBitmapsMap.set(H,s));const y=s.get(c);if(y&&!Z){const U=Math.round(Math.min(d[0],d[2])+d[4]),P=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(I,JI.transformAndFill),{canvas:y,offsetX:U,offsetY:P}}b=y}b||(m=this.cachedCanvases.getCanvas("maskCanvas",A,l),Jl(m.context,g));let B=u.transform(d,[1/A,0,0,-1/l,0,0]);B=u.transform(B,[1,0,0,1,0,-l]);const W=rg.slice();u.axialAlignedBoundingBox([0,0,A,l],B,W);const[o,h,w,a]=W,Y=Math.round(w-o)||1,V=Math.round(a-h)||1,n=this.cachedCanvases.getCanvas("fillCanvas",Y,V),e=n.context,t=o,N=h;e.translate(-t,-N),e.transform(...B),b||(b=this._scaleImage(m.canvas,jI(e)),b=b.img,s&&Z&&s.set(c,b)),e.imageSmoothingEnabled=zl(II(e),g.interpolate),LC(e,b,0,0,b.width,b.height,0,0,A,l),e.globalCompositeOperation="source-in";const R=u.transform(jI(e),[1,0,0,1,-t,-N]);return e.fillStyle=Z?i.getPattern(C,this,R,aI.FILL,I):i,e.fillRect(0,0,A,l),s&&!Z&&(this.cachedCanvases.delete("fillCanvas"),s.set(c,n.canvas)),this.dependencyTracker?.recordDependencies(I,JI.transformAndFill),{canvas:n.canvas,offsetX:Math.round(t),offsetY:Math.round(N)}}setLineWidth(I,g){this.dependencyTracker?.recordSimpleData("lineWidth",I),g!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=g,this.ctx.lineWidth=g}setLineCap(I,g){this.dependencyTracker?.recordSimpleData("lineCap",I),this.ctx.lineCap=uZ[g]}setLineJoin(I,g){this.dependencyTracker?.recordSimpleData("lineJoin",I),this.ctx.lineJoin=HZ[g]}setMiterLimit(I,g){this.dependencyTracker?.recordSimpleData("miterLimit",I),this.ctx.miterLimit=g}setDash(I,g,C){this.dependencyTracker?.recordSimpleData("dash",I);const A=this.ctx;A.setLineDash!==void 0&&(A.setLineDash(g),A.lineDashOffset=C)}setRenderingIntent(I,g){}setFlatness(I,g){}setGState(I,g){for(const[C,A]of g)switch(C){case"LW":this.setLineWidth(I,A);break;case"LC":this.setLineCap(I,A);break;case"LJ":this.setLineJoin(I,A);break;case"ML":this.setMiterLimit(I,A);break;case"D":this.setDash(I,A[0],A[1]);break;case"RI":this.setRenderingIntent(I,A);break;case"FL":this.setFlatness(I,A);break;case"Font":this.setFont(I,A[0],A[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",I),this.current.strokeAlpha=A;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",I),this.ctx.globalAlpha=this.current.fillAlpha=A;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",I),this.ctx.globalCompositeOperation=A;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",I),this.current.activeSMask=A?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",I),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(A);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const I=this.inSMaskMode;this.current.activeSMask&&!I?this.beginSMaskMode():!this.current.activeSMask&&I&&this.endSMaskMode()}beginSMaskMode(I){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const g=this.ctx.canvas.width,C=this.ctx.canvas.height,A="smaskGroupAt"+this.groupLevel,l=this.cachedCanvases.getCanvas(A,g,C);this.suspendedCtx=this.ctx;const i=this.ctx=l.context;i.setTransform(this.suspendedCtx.getTransform()),BC(this.suspendedCtx,i),RZ(i,this.suspendedCtx),this.setGState(I,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),BC(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(I){if(!this.current.activeSMask)return;I?(I[0]=Math.floor(I[0]),I[1]=Math.floor(I[1]),I[2]=Math.ceil(I[2]),I[3]=Math.ceil(I[3])):I=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const g=this.current.activeSMask,C=this.suspendedCtx;this.composeSMask(C,g,this.ctx,I),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(I,g,C,A){const l=A[0],i=A[1],Z=A[2]-l,d=A[3]-i;Z===0||d===0||(this.genericComposeSMask(g.context,C,Z,d,g.subtype,g.backdrop,g.transferMap,l,i,g.offsetX,g.offsetY),I.save(),I.globalAlpha=1,I.globalCompositeOperation="source-over",I.setTransform(1,0,0,1,0,0),I.drawImage(C.canvas,0,0),I.restore())}genericComposeSMask(I,g,C,A,l,i,Z,d,s,c,b){let m=I.canvas,B=d-c,W=s-b;if(i)if(B<0||W<0||B+C>m.width||W+A>m.height){const h=this.cachedCanvases.getCanvas("maskExtension",C,A),w=h.context;w.drawImage(m,-B,-W),w.globalCompositeOperation="destination-atop",w.fillStyle=i,w.fillRect(0,0,C,A),w.globalCompositeOperation="source-over",m=h.canvas,B=W=0}else{I.save(),I.globalAlpha=1,I.setTransform(1,0,0,1,0,0);const h=new Path2D;h.rect(B,W,C,A),I.clip(h),I.globalCompositeOperation="destination-atop",I.fillStyle=i,I.fillRect(B,W,C,A),I.restore()}g.save(),g.globalAlpha=1,g.setTransform(1,0,0,1,0,0),l==="Alpha"&&Z?g.filter=this.filterFactory.addAlphaFilter(Z):l==="Luminosity"&&(g.filter=this.filterFactory.addLuminosityFilter(Z));const o=new Path2D;o.rect(d,s,C,A),g.clip(o),g.globalCompositeOperation="destination-in",g.drawImage(m,B,W,C,A,d,s,C,A),g.restore()}save(I){this.inSMaskMode&&BC(this.ctx,this.suspendedCtx),this.ctx.save();const g=this.current;this.stateStack.push(g),this.current=g.clone(),this.dependencyTracker?.save(I)}restore(I){if(this.dependencyTracker?.restore(I),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&BC(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(I,g,C,A,l,i,Z){this.dependencyTracker?.recordIncrementalData("transform",I),this.ctx.transform(g,C,A,l,i,Z),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(I,g,C,A){let[l]=C;if(!A){l||=C[0]=new Path2D,this[g](I,l);return}if(this.dependencyTracker!==null){const i=g===CC.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(I).recordBBox(I,this.ctx,A[0]-i,A[2]+i,A[1]-i,A[3]+i).recordDependencies(I,["transform"])}l instanceof Path2D||(l=C[0]=ol(l)),u.axialAlignedBoundingBox(A,II(this.ctx),this.current.minMax),this[g](I,l),this._pathStartIdx=I}closePath(I){this.ctx.closePath()}stroke(I,g,C=!0){const A=this.ctx,l=this.current.strokeColor;if(A.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof l=="object"&&l?.getPattern){const i=l.isModifyingCurrentTransform()?A.getTransform():null;if(A.save(),A.strokeStyle=l.getPattern(A,this,jI(A),aI.STROKE,I),i){const Z=new Path2D;Z.addPath(g,A.getTransform().invertSelf().multiplySelf(i)),g=Z}this.rescaleAndStroke(g,!1),A.restore()}else this.rescaleAndStroke(g,!0);this.dependencyTracker?.recordDependencies(I,JI.stroke),C&&this.consumePath(I,g,this.current.getClippedPathBoundingBox(aI.STROKE,II(this.ctx))),A.globalAlpha=this.current.fillAlpha}closeStroke(I,g){this.stroke(I,g)}fill(I,g,C=!0){const A=this.ctx,l=this.current.fillColor,i=this.current.patternFill;let Z=!1;if(i){const s=l.isModifyingCurrentTransform()?A.getTransform():null;if(this.dependencyTracker?.save(I),A.save(),A.fillStyle=l.getPattern(A,this,jI(A),aI.FILL,I),s){const c=new Path2D;c.addPath(g,A.getTransform().invertSelf().multiplySelf(s)),g=c}Z=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(A.fill(g,"evenodd"),this.pendingEOFill=!1):A.fill(g)),this.dependencyTracker?.recordDependencies(I,JI.fill),Z&&(A.restore(),this.dependencyTracker?.restore(I)),C&&this.consumePath(I,g,d)}eoFill(I,g){this.pendingEOFill=!0,this.fill(I,g)}fillStroke(I,g){this.fill(I,g,!1),this.stroke(I,g,!1),this.consumePath(I,g)}eoFillStroke(I,g){this.pendingEOFill=!0,this.fillStroke(I,g)}closeFillStroke(I,g){this.fillStroke(I,g)}closeEOFillStroke(I,g){this.pendingEOFill=!0,this.fillStroke(I,g)}endPath(I,g){this.consumePath(I,g)}rawFillPath(I,g){this.ctx.fill(g),this.dependencyTracker?.recordDependencies(I,JI.rawFillPath).recordOperation(I)}clip(I){this.dependencyTracker?.recordFutureForcedDependency("clipMode",I),this.pendingClip=MZ}eoClip(I){this.dependencyTracker?.recordFutureForcedDependency("clipMode",I),this.pendingClip=kl}beginText(I){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(I).resetIncrementalData("sameLineText").resetIncrementalData("moveText",I)}endText(I){const g=this.pendingTextPaths,C=this.ctx;if(this.dependencyTracker){const{dependencyTracker:A}=this;g!==void 0&&A.recordFutureForcedDependency("textClip",A.getOpenMarker()).recordFutureForcedDependency("textClip",I),A.recordCloseMarker(I)}if(g!==void 0){const A=new Path2D,l=C.getTransform().invertSelf();for(const{transform:i,x:Z,y:d,fontSize:s,path:c}of g)c&&A.addPath(c,new DOMMatrix(i).preMultiplySelf(l).translate(Z,d).scale(s,-s));C.clip(A)}delete this.pendingTextPaths}setCharSpacing(I,g){this.dependencyTracker?.recordSimpleData("charSpacing",I),this.current.charSpacing=g}setWordSpacing(I,g){this.dependencyTracker?.recordSimpleData("wordSpacing",I),this.current.wordSpacing=g}setHScale(I,g){this.dependencyTracker?.recordSimpleData("hScale",I),this.current.textHScale=g/100}setLeading(I,g){this.dependencyTracker?.recordSimpleData("leading",I),this.current.leading=-g}setFont(I,g,C){this.dependencyTracker?.recordSimpleData("font",I).recordSimpleDataFromNamed("fontObj",g,I);const A=this.commonObjs.get(g),l=this.current;if(!A)throw new Error(`Can't find font for ${g}`);if(l.fontMatrix=A.fontMatrix||AA,(l.fontMatrix[0]===0||l.fontMatrix[3]===0)&&F("Invalid font matrix for font "+g),C<0?(C=-C,l.fontDirection=-1):l.fontDirection=1,this.current.font=A,this.current.fontSize=C,A.isType3Font)return;const i=A.loadedName||"sans-serif",Z=A.systemFontInfo?.css||`"${i}", ${A.fallbackName}`;let d="normal";A.black?d="900":A.bold&&(d="bold");const s=A.italic?"italic":"normal";let c=C;C<Dl?c=Dl:C>Kl&&(c=Kl),this.current.fontSizeScale=C/c,this.ctx.font=`${s} ${d} ${c}px ${Z}`}setTextRenderingMode(I,g){this.dependencyTracker?.recordSimpleData("textRenderingMode",I),this.current.textRenderingMode=g}setTextRise(I,g){this.dependencyTracker?.recordSimpleData("textRise",I),this.current.textRise=g}moveText(I,g,C){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",I),this.current.x=this.current.lineX+=g,this.current.y=this.current.lineY+=C}setLeadingMoveText(I,g,C){this.setLeading(I,-C),this.moveText(I,g,C)}setTextMatrix(I,g){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",I);const{current:C}=this;C.textMatrix=g,C.textMatrixScale=Math.hypot(g[0],g[1]),C.x=C.lineX=0,C.y=C.lineY=0}nextLine(I){this.moveText(I,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??I)}#A(I,g,C){const A=new Path2D;return A.addPath(I,new DOMMatrix(C).invertSelf().multiplySelf(g)),A}paintChar(I,g,C,A,l,i){const Z=this.ctx,d=this.current,s=d.font,c=d.textRenderingMode,b=d.fontSize/d.fontSizeScale,m=c&mI.FILL_STROKE_MASK,B=!!(c&mI.ADD_TO_PATH_FLAG),W=d.patternFill&&!s.missingFile,o=d.patternStroke&&!s.missingFile;let h;if((s.disableFontFace||B||W||o)&&!s.missingFile&&(h=s.getPathGenerator(this.commonObjs,g)),h&&(s.disableFontFace||W||o)){Z.save(),Z.translate(C,A),Z.scale(b,-b),this.dependencyTracker?.recordCharacterBBox(I,Z,s);let w;if(m===mI.FILL||m===mI.FILL_STROKE)if(l){w=Z.getTransform(),Z.setTransform(...l);const a=this.#A(h,w,l);Z.fill(a)}else Z.fill(h);if(m===mI.STROKE||m===mI.FILL_STROKE)if(i){w||=Z.getTransform(),Z.setTransform(...i);const{a,b:Y,c:V,d:n}=w,e=u.inverseTransform(i),t=u.transform([a,Y,V,n,0,0],e);u.singularValueDecompose2dScale(t,MI),Z.lineWidth*=Math.max(MI[0],MI[1])/b,Z.stroke(this.#A(h,w,i))}else Z.lineWidth/=b,Z.stroke(h);Z.restore()}else(m===mI.FILL||m===mI.FILL_STROKE)&&(Z.fillText(g,C,A),this.dependencyTracker?.recordCharacterBBox(I,Z,s,b,C,A,()=>Z.measureText(g))),(m===mI.STROKE||m===mI.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(I,Z,s,b,C,A,()=>Z.measureText(g)).recordDependencies(I,JI.stroke),Z.strokeText(g,C,A));B&&((this.pendingTextPaths||=[]).push({transform:II(Z),x:C,y:A,fontSize:b,path:h}),this.dependencyTracker?.recordCharacterBBox(I,Z,s,b,C,A))}get isFontSubpixelAAEnabled(){const{context:I}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);I.scale(1.5,1),I.fillText("I",0,10);const g=I.getImageData(0,0,10,10).data;let C=!1;for(let A=3;A<g.length;A+=4)if(g[A]>0&&g[A]<255){C=!0;break}return J(this,"isFontSubpixelAAEnabled",C)}showText(I,g){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(I,JI.showText).resetBBox(I),this.current.textRenderingMode&mI.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",I).inheritPendingDependenciesAsFutureForcedDependencies());const C=this.current,A=C.font;if(A.isType3Font){this.showType3Text(I,g),this.dependencyTracker?.recordShowTextOperation(I);return}const l=C.fontSize;if(l===0){this.dependencyTracker?.recordOperation(I);return}const i=this.ctx,Z=C.fontSizeScale,d=C.charSpacing,s=C.wordSpacing,c=C.fontDirection,b=C.textHScale*c,m=g.length,B=A.vertical,W=B?1:-1,o=A.defaultVMetrics,h=l*C.fontMatrix[0],w=C.textRenderingMode===mI.FILL&&!A.disableFontFace&&!C.patternFill;i.save(),C.textMatrix&&i.transform(...C.textMatrix),i.translate(C.x,C.y+C.textRise),c>0?i.scale(b,-1):i.scale(b,1);let a,Y;const V=C.textRenderingMode&mI.FILL_STROKE_MASK,n=V===mI.FILL||V===mI.FILL_STROKE,e=V===mI.STROKE||V===mI.FILL_STROKE;if(n&&C.patternFill){i.save();const y=C.fillColor.getPattern(i,this,jI(i),aI.FILL,I);a=II(i),i.restore(),i.fillStyle=y}if(e&&C.patternStroke){i.save();const y=C.strokeColor.getPattern(i,this,jI(i),aI.STROKE,I);Y=II(i),i.restore(),i.strokeStyle=y}let t=C.lineWidth;const N=C.textMatrixScale;if(N===0||t===0?e&&(t=this.getSinglePixelWidth()):t/=N,Z!==1&&(i.scale(Z,Z),t/=Z),i.lineWidth=t,A.isInvalidPDFjsFont){const y=[];let U=0;for(const j of g)y.push(j.unicode),U+=j.width;const P=y.join("");if(i.fillText(P,0,0),this.dependencyTracker!==null){const j=i.measureText(P);this.dependencyTracker.recordBBox(I,this.ctx,-j.actualBoundingBoxLeft,j.actualBoundingBoxRight,-j.actualBoundingBoxAscent,j.actualBoundingBoxDescent).recordShowTextOperation(I)}C.x+=U*h*b,i.restore(),this.compose();return}let R=0,H;for(H=0;H<m;++H){const y=g[H];if(typeof y=="number"){R+=W*y*l/1e3;continue}let U=!1;const P=(y.isSpace?s:0)+d,j=y.fontChar,sI=y.accent;let D,p,O=y.width;if(B){const cI=y.vmetric||o,f=-(y.vmetric?cI[1]:O*.5)*h,_=cI[2]*h;O=cI?-cI[0]:O,D=f/Z,p=(R+_)/Z}else D=R/Z,p=0;let SI;if(A.remeasure&&O>0){SI=i.measureText(j);const cI=SI.width*1e3/l*Z;if(O<cI&&this.isFontSubpixelAAEnabled){const f=O/cI;U=!0,i.save(),i.scale(f,1),D/=f}else O!==cI&&(D+=(O-cI)/2e3*l/Z)}if(this.contentVisible&&(y.isInFont||A.missingFile)){if(w&&!sI)i.fillText(j,D,p),this.dependencyTracker?.recordCharacterBBox(I,i,SI?{bbox:null}:A,l/Z,D,p,()=>SI??i.measureText(j));else if(this.paintChar(I,j,D,p,a,Y),sI){const cI=D+l*sI.offset.x/Z,f=p-l*sI.offset.y/Z;this.paintChar(I,sI.fontChar,cI,f,a,Y)}}const gg=B?O*h-P*c:O*h+P*c;R+=gg,U&&i.restore()}B?C.y-=R:C.x+=R*b,i.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(I)}showType3Text(I,g){const C=this.ctx,A=this.current,l=A.font,i=A.fontSize,Z=A.fontDirection,d=l.vertical?1:-1,s=A.charSpacing,c=A.wordSpacing,b=A.textHScale*Z,m=A.fontMatrix||AA,B=g.length,W=A.textRenderingMode===mI.INVISIBLE;let o,h,w,a;if(W||i===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,C.save(),A.textMatrix&&C.transform(...A.textMatrix),C.translate(A.x,A.y+A.textRise),C.scale(b,Z);const Y=this.dependencyTracker;for(this.dependencyTracker=Y?new kC(Y,I):null,o=0;o<B;++o){if(h=g[o],typeof h=="number"){a=d*h*i/1e3,this.ctx.translate(a,0),A.x+=a*b;continue}const V=(h.isSpace?c:0)+s,n=l.charProcOperatorList[h.operatorListId];n?this.contentVisible&&(this.save(),C.scale(i,i),C.transform(...m),this.executeOperatorList(n),this.restore()):F(`Type3 character "${h.operatorListId}" is not available.`);const e=[h.width,0];u.applyTransform(e,m),w=e[0]*i+V,C.translate(w,0),A.x+=w*b}C.restore(),Y&&(this.dependencyTracker=Y)}setCharWidth(I,g,C){}setCharWidthAndBounds(I,g,C,A,l,i,Z){const d=new Path2D;d.rect(A,l,i-A,Z-l),this.ctx.clip(d),this.dependencyTracker?.recordBBox(I,this.ctx,A,i,l,Z).recordClipBox(I,this.ctx,A,i,l,Z),this.endPath(I)}getColorN_Pattern(I,g){let C;if(g[0]==="TilingPattern"){const A=this.baseTransform||II(this.ctx),l={createCanvasGraphics:(i,Z)=>new Ug(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new kC(this.dependencyTracker,Z,!0):null)};C=new XA(g,this.ctx,l,A)}else C=this._getPattern(I,g[1],g[2]);return C}setStrokeColorN(I,...g){this.dependencyTracker?.recordSimpleData("strokeColor",I),this.current.strokeColor=this.getColorN_Pattern(I,g),this.current.patternStroke=!0}setFillColorN(I,...g){this.dependencyTracker?.recordSimpleData("fillColor",I),this.current.fillColor=this.getColorN_Pattern(I,g),this.current.patternFill=!0}setStrokeRGBColor(I,g){this.dependencyTracker?.recordSimpleData("strokeColor",I),this.ctx.strokeStyle=this.current.strokeColor=g,this.current.patternStroke=!1}setStrokeTransparent(I){this.dependencyTracker?.recordSimpleData("strokeColor",I),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(I,g){this.dependencyTracker?.recordSimpleData("fillColor",I),this.ctx.fillStyle=this.current.fillColor=g,this.current.patternFill=!1}setFillTransparent(I){this.dependencyTracker?.recordSimpleData("fillColor",I),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(I,g,C=null){let A;return this.cachedPatterns.has(g)?A=this.cachedPatterns.get(g):(A=tZ(this.getObject(I,g)),this.cachedPatterns.set(g,A)),C&&(A.matrix=C),A}shadingFill(I,g){if(!this.contentVisible)return;const C=this.ctx;this.save(I);const A=this._getPattern(I,g);C.fillStyle=A.getPattern(C,this,jI(C),aI.SHADING,I);const l=jI(C);if(l){const{width:i,height:Z}=C.canvas,d=rg.slice();u.axialAlignedBoundingBox([0,0,i,Z],l,d);const[s,c,b,m]=d;this.ctx.fillRect(s,c,b-s,m-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(I).recordFullPageBBox(I).recordDependencies(I,JI.transform).recordDependencies(I,JI.fill).recordOperation(I),this.compose(this.current.getClippedPathBoundingBox()),this.restore(I)}beginInlineImage(){E("Should not call beginInlineImage")}beginImageData(){E("Should not call beginImageData")}paintFormXObjectBegin(I,g,C){if(this.contentVisible&&(this.save(I),this.baseTransformStack.push(this.baseTransform),g&&this.transform(I,...g),this.baseTransform=II(this.ctx),C)){u.axialAlignedBoundingBox(C,this.baseTransform,this.current.minMax);const[A,l,i,Z]=C,d=new Path2D;d.rect(A,l,i-A,Z-l),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(I,this.ctx,A,i,l,Z),this.endPath(I)}}paintFormXObjectEnd(I){this.contentVisible&&(this.restore(I),this.baseTransform=this.baseTransformStack.pop())}beginGroup(I,g){if(!this.contentVisible)return;this.save(I),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const C=this.ctx;g.isolated||HC("TODO: Support non-isolated groups."),g.knockout&&F("Knockout groups not supported.");const A=II(C);if(g.matrix&&C.transform(...g.matrix),!g.bbox)throw new Error("Bounding box is required.");let l=rg.slice();u.axialAlignedBoundingBox(g.bbox,II(C),l);const i=[0,0,C.canvas.width,C.canvas.height];l=u.intersect(l,i)||[0,0,0,0];const Z=Math.floor(l[0]),d=Math.floor(l[1]),s=Math.max(Math.ceil(l[2])-Z,1),c=Math.max(Math.ceil(l[3])-d,1);this.current.startNewPathAndClipBox([0,0,s,c]);let b="groupAt"+this.groupLevel;g.smask&&(b+="_smask_"+this.smaskCounter++%2);const m=this.cachedCanvases.getCanvas(b,s,c),B=m.context;B.translate(-Z,-d),B.transform(...A);let W=new Path2D;const[o,h,w,a]=g.bbox;if(W.rect(o,h,w-o,a-h),g.matrix){const Y=new Path2D;Y.addPath(W,new DOMMatrix(g.matrix)),W=Y}B.clip(W),g.smask&&this.smaskStack.push({canvas:m.canvas,context:B,offsetX:Z,offsetY:d,subtype:g.smask.subtype,backdrop:g.smask.backdrop,transferMap:g.smask.transferMap||null,startTransformInverse:null}),(!g.smask||this.dependencyTracker)&&(C.setTransform(1,0,0,1,0,0),C.translate(Z,d),C.save()),BC(C,B),this.ctx=B,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(C),this.setGState(I,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(C),this.groupLevel++}endGroup(I,g){if(!this.contentVisible)return;this.groupLevel--;const C=this.ctx,A=this.groupStack.pop();if(this.ctx=A,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),g.smask)this.tempSMask=this.smaskStack.pop(),this.restore(I),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const l=II(this.ctx);this.restore(I),this.ctx.save(),this.ctx.setTransform(...l);const i=rg.slice();u.axialAlignedBoundingBox([0,0,C.canvas.width,C.canvas.height],l,i),this.ctx.drawImage(C.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(I,g,C,A,l,i){if(this.#I(),TC(this.ctx),this.ctx.save(),this.save(I),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),C){const Z=C[2]-C[0],d=C[3]-C[1];if(i&&this.annotationCanvasMap){A=A.slice(),A[4]-=C[0],A[5]-=C[1],C=C.slice(),C[0]=C[1]=0,C[2]=Z,C[3]=d,u.singularValueDecompose2dScale(II(this.ctx),MI);const{viewportScale:s}=this,c=Math.ceil(Z*this.outputScaleX*s),b=Math.ceil(d*this.outputScaleY*s);this.annotationCanvas=this.canvasFactory.create(c,b);const{canvas:m,context:B}=this.annotationCanvas;this.annotationCanvasMap.set(g,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=B,this.ctx.save(),this.ctx.setTransform(MI[0],0,0,-MI[1],0,d*MI[1]),TC(this.ctx)}else{TC(this.ctx),this.endPath(I);const s=new Path2D;s.rect(C[0],C[1],Z,d),this.ctx.clip(s)}}this.current=new pl(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(I,...A),this.transform(I,...l)}endAnnotation(I){this.annotationCanvas&&(this.ctx.restore(),this.#g(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(I,g){if(!this.contentVisible)return;const C=g.count;g=this.getObject(I,g.data,g),g.count=C;const A=this.ctx,l=this._createMaskCanvas(I,g),i=l.canvas;A.save(),A.setTransform(1,0,0,1,0,0),A.drawImage(i,l.offsetX,l.offsetY),this.dependencyTracker?.resetBBox(I).recordBBox(I,this.ctx,l.offsetX,l.offsetX+i.width,l.offsetY,l.offsetY+i.height).recordOperation(I),A.restore(),this.compose()}paintImageMaskXObjectRepeat(I,g,C,A=0,l=0,i,Z){if(!this.contentVisible)return;g=this.getObject(I,g.data,g);const d=this.ctx;d.save();const s=II(d);d.transform(C,A,l,i,0,0);const c=this._createMaskCanvas(I,g);d.setTransform(1,0,0,1,c.offsetX-s[4],c.offsetY-s[5]),this.dependencyTracker?.resetBBox(I);for(let b=0,m=Z.length;b<m;b+=2){const B=u.transform(s,[C,A,l,i,Z[b],Z[b+1]]);d.drawImage(c.canvas,B[4],B[5]),this.dependencyTracker?.recordBBox(I,this.ctx,B[4],B[4]+c.canvas.width,B[5],B[5]+c.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(I)}paintImageMaskXObjectGroup(I,g){if(!this.contentVisible)return;const C=this.ctx,A=this.current.fillColor,l=this.current.patternFill;this.dependencyTracker?.resetBBox(I).recordDependencies(I,JI.transformAndFill);for(const i of g){const{data:Z,width:d,height:s,transform:c}=i,b=this.cachedCanvases.getCanvas("maskCanvas",d,s),m=b.context;m.save();const B=this.getObject(I,Z,i);Jl(m,B),m.globalCompositeOperation="source-in",m.fillStyle=l?A.getPattern(m,this,jI(C),aI.FILL,I):A,m.fillRect(0,0,d,s),m.restore(),C.save(),C.transform(...c),C.scale(1,-1),LC(C,b.canvas,0,0,d,s,0,-1,1,1),this.dependencyTracker?.recordBBox(I,C,0,d,0,s),C.restore()}this.compose(),this.dependencyTracker?.recordOperation(I)}paintImageXObject(I,g){if(!this.contentVisible)return;const C=this.getObject(I,g);if(!C){F("Dependent image isn't ready yet");return}this.paintInlineImageXObject(I,C)}paintImageXObjectRepeat(I,g,C,A,l){if(!this.contentVisible)return;const i=this.getObject(I,g);if(!i){F("Dependent image isn't ready yet");return}const Z=i.width,d=i.height,s=[];for(let c=0,b=l.length;c<b;c+=2)s.push({transform:[C,0,0,A,l[c],l[c+1]],x:0,y:0,w:Z,h:d});this.paintInlineImageXObjectGroup(I,i,s)}applyTransferMapsToCanvas(I){return this.current.transferMaps!=="none"&&(I.filter=this.current.transferMaps,I.drawImage(I.canvas,0,0),I.filter="none"),I.canvas}applyTransferMapsToBitmap(I){if(this.current.transferMaps==="none")return I.bitmap;const{bitmap:g,width:C,height:A}=I,l=this.cachedCanvases.getCanvas("inlineImage",C,A),i=l.context;return i.filter=this.current.transferMaps,i.drawImage(g,0,0),i.filter="none",l.canvas}paintInlineImageXObject(I,g){if(!this.contentVisible)return;const C=g.width,A=g.height,l=this.ctx;this.save(I);const{filter:i}=l;i!=="none"&&i!==""&&(l.filter="none"),l.scale(1/C,-1/A);let Z;if(g.bitmap)Z=this.applyTransferMapsToBitmap(g);else if(typeof HTMLElement=="function"&&g instanceof HTMLElement||!g.data)Z=g;else{const c=this.cachedCanvases.getCanvas("inlineImage",C,A).context;Fl(c,g),Z=this.applyTransferMapsToCanvas(c)}const d=this._scaleImage(Z,jI(l));l.imageSmoothingEnabled=zl(II(l),g.interpolate),this.dependencyTracker?.resetBBox(I).recordBBox(I,l,0,C,-A,0).recordDependencies(I,JI.imageXObject).recordOperation(I),LC(l,d.img,0,0,d.paintWidth,d.paintHeight,0,-A,C,A),this.compose(),this.restore(I)}paintInlineImageXObjectGroup(I,g,C){if(!this.contentVisible)return;const A=this.ctx;let l;if(g.bitmap)l=g.bitmap;else{const i=g.width,Z=g.height,s=this.cachedCanvases.getCanvas("inlineImage",i,Z).context;Fl(s,g),l=this.applyTransferMapsToCanvas(s)}this.dependencyTracker?.resetBBox(I);for(const i of C)A.save(),A.transform(...i.transform),A.scale(1,-1),LC(A,l,i.x,i.y,i.w,i.h,0,-1,1,1),this.dependencyTracker?.recordBBox(I,A,0,1,-1,0),A.restore();this.dependencyTracker?.recordOperation(I),this.compose()}paintSolidColorImageMask(I){this.contentVisible&&(this.dependencyTracker?.resetBBox(I).recordBBox(I,this.ctx,0,1,0,1).recordDependencies(I,JI.fill).recordOperation(I),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(I,g){}markPointProps(I,g,C){}beginMarkedContent(I,g){this.dependencyTracker?.beginMarkedContent(I),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(I,g,C){this.dependencyTracker?.beginMarkedContent(I),g==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(C)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(I){this.dependencyTracker?.endMarkedContent(I),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(I){}endCompat(I){}consumePath(I,g,C){const A=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(C);const l=this.ctx;this.pendingClip?(A||(this.pendingClip===kl?l.clip(g,"evenodd"):l.clip(g)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(I).recordFutureForcedDependency("clipPath",I)):this.dependencyTracker?.recordOperation(I),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const I=II(this.ctx);if(I[1]===0&&I[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(I[0]),Math.abs(I[3]));else{const g=Math.abs(I[0]*I[3]-I[2]*I[1]),C=Math.hypot(I[0],I[2]),A=Math.hypot(I[1],I[3]);this._cachedGetSinglePixelWidth=Math.max(C,A)/g}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:I}=this.current,{a:g,b:C,c:A,d:l}=this.ctx.getTransform();let i,Z;if(C===0&&A===0){const d=Math.abs(g),s=Math.abs(l);if(d===s)if(I===0)i=Z=1/d;else{const c=d*I;i=Z=c<1?1/c:1}else if(I===0)i=1/d,Z=1/s;else{const c=d*I,b=s*I;i=c<1?1/c:1,Z=b<1?1/b:1}}else{const d=Math.abs(g*l-C*A),s=Math.hypot(g,C),c=Math.hypot(A,l);if(I===0)i=c/d,Z=s/d;else{const b=I*d;i=c>b?c/b:1,Z=s>b?s/b:1}}this._cachedScaleForStroking[0]=i,this._cachedScaleForStroking[1]=Z}return this._cachedScaleForStroking}rescaleAndStroke(I,g){const{ctx:C,current:{lineWidth:A}}=this,[l,i]=this.getScaleForStroking();if(l===i){C.lineWidth=(A||1)*l,C.stroke(I);return}const Z=C.getLineDash();g&&C.save(),C.scale(l,i),RA.a=1/l,RA.d=1/i;const d=new Path2D;if(d.addPath(I,RA),Z.length>0){const s=Math.max(l,i);C.setLineDash(Z.map(c=>c/s)),C.lineDashOffset/=s}C.lineWidth=A||1,C.stroke(d),g&&C.restore()}isContentVisible(){for(let I=this.markedContentStack.length-1;I>=0;I--)if(!this.markedContentStack[I].visible)return!1;return!0}}for(const G in CC)Ug.prototype[G]!==void 0&&(Ug.prototype[CC[G]]=Ug.prototype[G]);class Og{static#I=null;static#g="";static get workerPort(){return this.#I}static set workerPort(I){if(!(typeof Worker<"u"&&I instanceof Worker)&&I!==null)throw new Error("Invalid `workerPort` type.");this.#I=I}static get workerSrc(){return this.#g}static set workerSrc(I){if(typeof I!="string")throw new Error("Invalid `workerSrc` type.");this.#g=I}}class DZ{#I;#g;constructor({parsedData:I,rawData:g}){this.#I=I,this.#g=g}getRaw(){return this.#g}get(I){return this.#I.get(I)??null}[Symbol.iterator](){return this.#I.entries()}}const xg=Symbol("INTERNAL");class KZ{#I=!1;#g=!1;#A=!1;#C=!0;constructor(I,{name:g,intent:C,usage:A,rbGroups:l}){this.#I=!!(I&HI.DISPLAY),this.#g=!!(I&HI.PRINT),this.name=g,this.intent=C,this.usage=A,this.rbGroups=l}get visible(){if(this.#A)return this.#C;if(!this.#C)return!1;const{print:I,view:g}=this.usage;return this.#I?g?.viewState!=="OFF":this.#g?I?.printState!=="OFF":!0}_setVisible(I,g,C=!1){I!==xg&&E("Internal method `_setVisible` called."),this.#A=C,this.#C=g}}class SZ{#I=null;#g=new Map;#A=null;#C=null;constructor(I,g=HI.DISPLAY){if(this.renderingIntent=g,this.name=null,this.creator=null,I!==null){this.name=I.name,this.creator=I.creator,this.#C=I.order;for(const C of I.groups)this.#g.set(C.id,new KZ(g,C));if(I.baseState==="OFF")for(const C of this.#g.values())C._setVisible(xg,!1);for(const C of I.on)this.#g.get(C)._setVisible(xg,!0);for(const C of I.off)this.#g.get(C)._setVisible(xg,!1);this.#A=this.getHash()}}#Z(I){const g=I.length;if(g<2)return!0;const C=I[0];for(let A=1;A<g;A++){const l=I[A];let i;if(Array.isArray(l))i=this.#Z(l);else if(this.#g.has(l))i=this.#g.get(l).visible;else return F(`Optional content group not found: ${l}`),!0;switch(C){case"And":if(!i)return!1;break;case"Or":if(i)return!0;break;case"Not":return!i;default:return!0}}return C==="And"}isVisible(I){if(this.#g.size===0)return!0;if(!I)return HC("Optional content group not defined."),!0;if(I.type==="OCG")return this.#g.has(I.id)?this.#g.get(I.id).visible:(F(`Optional content group not found: ${I.id}`),!0);if(I.type==="OCMD"){if(I.expression)return this.#Z(I.expression);if(!I.policy||I.policy==="AnyOn"){for(const g of I.ids){if(!this.#g.has(g))return F(`Optional content group not found: ${g}`),!0;if(this.#g.get(g).visible)return!0}return!1}else if(I.policy==="AllOn"){for(const g of I.ids){if(!this.#g.has(g))return F(`Optional content group not found: ${g}`),!0;if(!this.#g.get(g).visible)return!1}return!0}else if(I.policy==="AnyOff"){for(const g of I.ids){if(!this.#g.has(g))return F(`Optional content group not found: ${g}`),!0;if(!this.#g.get(g).visible)return!0}return!1}else if(I.policy==="AllOff"){for(const g of I.ids){if(!this.#g.has(g))return F(`Optional content group not found: ${g}`),!0;if(this.#g.get(g).visible)return!1}return!0}return F(`Unknown optional content policy ${I.policy}.`),!0}return F(`Unknown group type ${I.type}.`),!0}setVisibility(I,g=!0,C=!0){const A=this.#g.get(I);if(!A){F(`Optional content group not found: ${I}`);return}if(C&&g&&A.rbGroups.length)for(const l of A.rbGroups)for(const i of l)i!==I&&this.#g.get(i)?._setVisible(xg,!1,!0);A._setVisible(xg,!!g,!0),this.#I=null}setOCGState({state:I,preserveRB:g}){let C;for(const A of I){switch(A){case"ON":case"OFF":case"Toggle":C=A;continue}const l=this.#g.get(A);if(l)switch(C){case"ON":this.setVisibility(A,!0,g);break;case"OFF":this.setVisibility(A,!1,g);break;case"Toggle":this.setVisibility(A,!l.visible,g);break}}this.#I=null}get hasInitialVisibility(){return this.#A===null||this.getHash()===this.#A}getOrder(){return this.#g.size?this.#C?this.#C.slice():[...this.#g.keys()]:null}getGroup(I){return this.#g.get(I)||null}getHash(){if(this.#I!==null)return this.#I;const I=new hl;for(const[g,C]of this.#g)I.update(`${g}:${C.visible}`);return this.#I=I.hexdigest()}[Symbol.iterator](){return this.#g.entries()}}class pZ{constructor(I,{disableRange:g=!1,disableStream:C=!1}){T(I,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:A,initialData:l,progressiveDone:i,contentDispositionFilename:Z}=I;if(this._queuedChunks=[],this._progressiveDone=i,this._contentDispositionFilename=Z,l?.length>0){const d=l instanceof Uint8Array&&l.byteLength===l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=I,this._isStreamingSupported=!C,this._isRangeSupported=!g,this._contentLength=A,this._fullRequestReader=null,this._rangeReaders=[],I.addRangeListener((d,s)=>{this._onReceiveData({begin:d,chunk:s})}),I.addProgressListener((d,s)=>{this._onProgress({loaded:d,total:s})}),I.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),I.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),I.transportReady()}_onReceiveData({begin:I,chunk:g}){const C=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;if(I===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(C):this._queuedChunks.push(C);else{const A=this._rangeReaders.some(function(l){return l._begin!==I?!1:(l._enqueue(C),!0)});T(A,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(I){I.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:I.loaded}):this._fullRequestReader?.onProgress?.({loaded:I.loaded,total:I.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(I){const g=this._rangeReaders.indexOf(I);g>=0&&this._rangeReaders.splice(g,1)}getFullReader(){T(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const I=this._queuedChunks;return this._queuedChunks=null,new FZ(this,I,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(I,g){if(g<=this._progressiveDataLength)return null;const C=new JZ(this,I,g);return this._pdfDataRangeTransport.requestDataRange(I,g),this._rangeReaders.push(C),C}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const g of this._rangeReaders.slice(0))g.cancel(I);this._pdfDataRangeTransport.abort()}}class FZ{constructor(I,g,C=!1,A=null){this._stream=I,this._done=C||!1,this._filename=bA(A)?A:null,this._queuedChunks=g||[],this._loaded=0;for(const l of this._queuedChunks)this._loaded+=l.byteLength;this._requests=[],this._headersReady=Promise.resolve(),I._fullRequestReader=this,this.onProgress=null}_enqueue(I){this._done||(this._requests.length>0?this._requests.shift().resolve({value:I,done:!1}):this._queuedChunks.push(I),this._loaded+=I.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const I=Promise.withResolvers();return this._requests.push(I),I.promise}cancel(I){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class JZ{constructor(I,g,C){this._stream=I,this._begin=g,this._end=C,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(I){if(!this._done){if(this._requests.length===0)this._queuedChunk=I;else{this._requests.shift().resolve({value:I,done:!1});for(const C of this._requests)C.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const I=Promise.withResolvers();return this._requests.push(I),I.promise}cancel(I){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function zZ(G){let I=!0,g=C("filename\\*","i").exec(G);if(g){g=g[1];let c=Z(g);return c=unescape(c),c=d(c),c=s(c),l(c)}if(g=i(G),g){const c=s(g);return l(c)}if(g=C("filename","i").exec(G),g){g=g[1];let c=Z(g);return c=s(c),l(c)}function C(c,b){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',b)}function A(c,b){if(c){if(!/^[\x00-\xFF]+$/.test(b))return b;try{const m=new TextDecoder(c,{fatal:!0}),B=lC(b);b=m.decode(B),I=!1}catch{}}return b}function l(c){return I&&/[\x80-\xff]/.test(c)&&(c=A("utf-8",c),I&&(c=A("iso-8859-1",c))),c}function i(c){const b=[];let m;const B=C("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(m=B.exec(c))!==null;){let[,o,h,w]=m;if(o=parseInt(o,10),o in b){if(o===0)break;continue}b[o]=[h,w]}const W=[];for(let o=0;o<b.length&&o in b;++o){let[h,w]=b[o];w=Z(w),h&&(w=unescape(w),o===0&&(w=d(w))),W.push(w)}return W.join("")}function Z(c){if(c.startsWith('"')){const b=c.slice(1).split('\\"');for(let m=0;m<b.length;++m){const B=b[m].indexOf('"');B!==-1&&(b[m]=b[m].slice(0,B),b.length=m+1),b[m]=b[m].replaceAll(/\\(.)/g,"$1")}c=b.join('"')}return c}function d(c){const b=c.indexOf("'");if(b===-1)return c;const m=c.slice(0,b),W=c.slice(b+1).replace(/^[^']*'/,"");return A(m,W)}function s(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(b,m,B,W){if(B==="q"||B==="Q")return W=W.replaceAll("_"," "),W=W.replaceAll(/=([0-9a-fA-F]{2})/g,function(o,h){return String.fromCharCode(parseInt(h,16))}),A(m,W);try{W=atob(W)}catch{}return A(m,W)})}return""}function Ll(G,I){const g=new Headers;if(!G||!I||typeof I!="object")return g;for(const C in I){const A=I[C];A!==void 0&&g.append(C,A)}return g}function jC(G){return URL.parse(G)?.origin??null}function Tl({responseHeaders:G,isHttp:I,rangeChunkSize:g,disableRange:C}){const A={allowRangeRequests:!1,suggestedLength:void 0},l=parseInt(G.get("Content-Length"),10);return!Number.isInteger(l)||(A.suggestedLength=l,l<=2*g)||C||!I||G.get("Accept-Ranges")!=="bytes"||(G.get("Content-Encoding")||"identity")!=="identity"||(A.allowRangeRequests=!0),A}function jl(G){const I=G.get("Content-Disposition");if(I){let g=zZ(I);if(g.includes("%"))try{g=decodeURIComponent(g)}catch{}if(bA(g))return g}return null}function oC(G,I){return new MC(`Unexpected server response (${G}) while retrieving PDF "${I}".`,G,G===404||G===0&&I.startsWith("file:"))}function Ql(G){return G===200||G===206}function rl(G,I,g){return{method:"GET",headers:G,signal:g.signal,mode:"cors",credentials:I?"include":"same-origin",redirect:"follow"}}function Ul(G){return G instanceof Uint8Array?G.buffer:G instanceof ArrayBuffer?G:(F(`getArrayBuffer - unexpected data format: ${G}`),new Uint8Array(G).buffer)}class kZ{_responseOrigin=null;constructor(I){this.source=I,this.isHttp=/^https?:/i.test(I.url),this.headers=Ll(this.isHttp,I.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return T(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new LZ(this),this._fullRequestReader}getRangeReader(I,g){if(g<=this._progressiveDataLength)return null;const C=new TZ(this,I,g);return this._rangeRequestReaders.push(C),C}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const g of this._rangeRequestReaders.slice(0))g.cancel(I)}}class LZ{constructor(I){this._stream=I,this._reader=null,this._loaded=0,this._filename=null;const g=I.source;this._withCredentials=g.withCredentials||!1,this._contentLength=g.length,this._headersCapability=Promise.withResolvers(),this._disableRange=g.disableRange||!1,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!g.disableStream,this._isRangeSupported=!g.disableRange;const C=new Headers(I.headers),A=g.url;fetch(A,rl(C,this._withCredentials,this._abortController)).then(l=>{if(I._responseOrigin=jC(l.url),!Ql(l.status))throw oC(l.status,A);this._reader=l.body.getReader(),this._headersCapability.resolve();const i=l.headers,{allowRangeRequests:Z,suggestedLength:d}=Tl({responseHeaders:i,isHttp:I.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=Z,this._contentLength=d||this._contentLength,this._filename=jl(i),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ag("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:I,done:g}=await this._reader.read();return g?{value:I,done:g}:(this._loaded+=I.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Ul(I),done:!1})}cancel(I){this._reader?.cancel(I),this._abortController.abort()}}class TZ{constructor(I,g,C){this._stream=I,this._reader=null,this._loaded=0;const A=I.source;this._withCredentials=A.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!A.disableStream,this._abortController=new AbortController;const l=new Headers(I.headers);l.append("Range",`bytes=${g}-${C-1}`);const i=A.url;fetch(i,rl(l,this._withCredentials,this._abortController)).then(Z=>{const d=jC(Z.url);if(d!==I._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${I._responseOrigin}".`);if(!Ql(Z.status))throw oC(Z.status,i);this._readCapability.resolve(),this._reader=Z.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:I,done:g}=await this._reader.read();return g?{value:I,done:g}:(this._loaded+=I.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Ul(I),done:!1})}cancel(I){this._reader?.cancel(I),this._abortController.abort()}}const yA=200,uA=206;function jZ(G){const I=G.response;return typeof I!="string"?I:lC(I).buffer}class QZ{_responseOrigin=null;constructor({url:I,httpHeaders:g,withCredentials:C}){this.url=I,this.isHttp=/^https?:/i.test(I),this.headers=Ll(this.isHttp,g),this.withCredentials=C||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(I){const g=new XMLHttpRequest,C=this.currXhrId++,A=this.pendingRequests[C]={xhr:g};g.open("GET",this.url),g.withCredentials=this.withCredentials;for(const[l,i]of this.headers)g.setRequestHeader(l,i);return this.isHttp&&"begin"in I&&"end"in I?(g.setRequestHeader("Range",`bytes=${I.begin}-${I.end-1}`),A.expectedStatus=uA):A.expectedStatus=yA,g.responseType="arraybuffer",T(I.onError,"Expected `onError` callback to be provided."),g.onerror=()=>{I.onError(g.status)},g.onreadystatechange=this.onStateChange.bind(this,C),g.onprogress=this.onProgress.bind(this,C),A.onHeadersReceived=I.onHeadersReceived,A.onDone=I.onDone,A.onError=I.onError,A.onProgress=I.onProgress,g.send(null),C}onProgress(I,g){const C=this.pendingRequests[I];C&&C.onProgress?.(g)}onStateChange(I,g){const C=this.pendingRequests[I];if(!C)return;const A=C.xhr;if(A.readyState>=2&&C.onHeadersReceived&&(C.onHeadersReceived(),delete C.onHeadersReceived),A.readyState!==4||!(I in this.pendingRequests))return;if(delete this.pendingRequests[I],A.status===0&&this.isHttp){C.onError(A.status);return}const l=A.status||yA;if(!(l===yA&&C.expectedStatus===uA)&&l!==C.expectedStatus){C.onError(A.status);return}const Z=jZ(A);if(l===uA){const d=A.getResponseHeader("Content-Range"),s=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);s?C.onDone({begin:parseInt(s[1],10),chunk:Z}):(F('Missing or invalid "Content-Range" header.'),C.onError(0))}else Z?C.onDone({begin:0,chunk:Z}):C.onError(A.status)}getRequestXhr(I){return this.pendingRequests[I].xhr}isPendingRequest(I){return I in this.pendingRequests}abortRequest(I){const g=this.pendingRequests[I].xhr;delete this.pendingRequests[I],g.abort()}}class rZ{constructor(I){this._source=I,this._manager=new QZ(I),this._rangeChunkSize=I.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(I){const g=this._rangeRequestReaders.indexOf(I);g>=0&&this._rangeRequestReaders.splice(g,1)}getFullReader(){return T(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new UZ(this._manager,this._source),this._fullRequestReader}getRangeReader(I,g){const C=new OZ(this._manager,I,g);return C.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(C),C}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const g of this._rangeRequestReaders.slice(0))g.cancel(I)}}class UZ{constructor(I,g){this._manager=I,this._url=g.url,this._fullRequestId=I.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=g.disableRange||!1,this._contentLength=g.length,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const I=this._fullRequestId,g=this._manager.getRequestXhr(I);this._manager._responseOrigin=jC(g.responseURL);const C=g.getAllResponseHeaders(),A=new Headers(C?C.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(Z=>{const[d,...s]=Z.split(": ");return[d,s.join(": ")]}):[]),{allowRangeRequests:l,suggestedLength:i}=Tl({responseHeaders:A,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});l&&(this._isRangeSupported=!0),this._contentLength=i||this._contentLength,this._filename=jl(A),this._isRangeSupported&&this._manager.abortRequest(I),this._headersCapability.resolve()}_onDone(I){if(I&&(this._requests.length>0?this._requests.shift().resolve({value:I.chunk,done:!1}):this._cachedChunks.push(I.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(I){this._storedError=oC(I,this._url),this._headersCapability.reject(this._storedError);for(const g of this._requests)g.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(I){this.onProgress?.({loaded:I.loaded,total:I.lengthComputable?I.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const I=Promise.withResolvers();return this._requests.push(I),I.promise}cancel(I){this._done=!0,this._headersCapability.reject(I);for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class OZ{constructor(I,g,C){this._manager=I,this._url=I.url,this._requestId=I.request({begin:g,end:C,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const I=jC(this._manager.getRequestXhr(this._requestId)?.responseURL);I!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${I}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(I){const g=I.chunk;this._requests.length>0?this._requests.shift().resolve({value:g,done:!1}):this._queuedChunk=g,this._done=!0;for(const C of this._requests)C.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(I){this._storedError??=oC(I,this._url);for(const g of this._requests)g.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(I){this.isStreamingSupported||this.onProgress?.({loaded:I.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const I=Promise.withResolvers();return this._requests.push(I),I.promise}cancel(I){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const xZ=/^[a-z][a-z0-9\-+.]+:/i;function vZ(G){if(xZ.test(G))return new URL(G);const I=process.getBuiltinModule("url");return new URL(I.pathToFileURL(G))}class EZ{constructor(I){this.source=I,this.url=vZ(I.url),T(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return T(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new PZ(this),this._fullRequestReader}getRangeReader(I,g){if(g<=this._progressiveDataLength)return null;const C=new fZ(this,I,g);return this._rangeRequestReaders.push(C),C}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const g of this._rangeRequestReaders.slice(0))g.cancel(I)}}class PZ{constructor(I){this._url=I.url,this._done=!1,this._storedError=null,this.onProgress=null;const g=I.source;this._contentLength=g.length,this._loaded=0,this._filename=null,this._disableRange=g.disableRange||!1,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!g.disableStream,this._isRangeSupported=!g.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const C=process.getBuiltinModule("fs");C.promises.lstat(this._url).then(A=>{this._contentLength=A.size,this._setReadableStream(C.createReadStream(this._url)),this._headersCapability.resolve()},A=>{A.code==="ENOENT"&&(A=oC(0,this._url.href)),this._storedError=A,this._headersCapability.reject(A)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const I=this._readableStream.read();return I===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=I.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(I).buffer,done:!1})}cancel(I){if(!this._readableStream){this._error(I);return}this._readableStream.destroy(I)}_error(I){this._storedError=I,this._readCapability.resolve()}_setReadableStream(I){this._readableStream=I,I.on("readable",()=>{this._readCapability.resolve()}),I.on("end",()=>{I.destroy(),this._done=!0,this._readCapability.resolve()}),I.on("error",g=>{this._error(g)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ag("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class fZ{constructor(I,g,C){this._url=I.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const A=I.source;this._isStreamingSupported=!A.disableStream;const l=process.getBuiltinModule("fs");this._setReadableStream(l.createReadStream(this._url,{start:g,end:C-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const I=this._readableStream.read();return I===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=I.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(I).buffer,done:!1})}cancel(I){if(!this._readableStream){this._error(I);return}this._readableStream.destroy(I)}_error(I){this._storedError=I,this._readCapability.resolve()}_setReadableStream(I){this._readableStream=I,I.on("readable",()=>{this._readCapability.resolve()}),I.on("end",()=>{I.destroy(),this._done=!0,this._readCapability.resolve()}),I.on("error",g=>{this._error(g)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const WC=Symbol("INITIAL_DATA");class Ol{#I=Object.create(null);#g(I){return this.#I[I]||={...Promise.withResolvers(),data:WC}}get(I,g=null){if(g){const A=this.#g(I);return A.promise.then(()=>g(A.data)),null}const C=this.#I[I];if(!C||C.data===WC)throw new Error(`Requesting object that isn't resolved yet ${I}.`);return C.data}has(I){const g=this.#I[I];return!!g&&g.data!==WC}delete(I){const g=this.#I[I];return!g||g.data===WC?!1:(delete this.#I[I],!0)}resolve(I,g=null){const C=this.#g(I);C.data=g,C.resolve()}clear(){for(const I in this.#I){const{data:g}=this.#I[I];g?.bitmap?.close()}this.#I=Object.create(null)}*[Symbol.iterator](){for(const I in this.#I){const{data:g}=this.#I[I];g!==WC&&(yield[I,g])}}}const _Z=1e5,xl=30;class DI{#I=Promise.withResolvers();#g=null;#A=!1;#C=!!globalThis.FontInspector?.enabled;#Z=null;#i=null;#l=0;#d=0;#c=null;#s=null;#m=0;#b=0;#B=Object.create(null);#w=[];#W=null;#G=[];#o=new WeakMap;#h=null;static#Y=new Map;static#a=new Map;static#X=new WeakMap;static#t=null;static#n=new Set;constructor({textContentSource:I,container:g,viewport:C}){if(I instanceof ReadableStream)this.#W=I;else if(typeof I=="object")this.#W=new ReadableStream({start(d){d.enqueue(I),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#g=this.#s=g,this.#b=C.scale*QI.pixelRatio,this.#m=C.rotation,this.#i={div:null,properties:null,ctx:null};const{pageWidth:A,pageHeight:l,pageX:i,pageY:Z}=C.rawDims;this.#h=[1,0,0,-1,-i,Z+l],this.#d=A,this.#l=l,DI.#H(),g.style.setProperty("--min-font-size",DI.#t),Vg(g,C),this.#I.promise.finally(()=>{DI.#n.delete(this),this.#i=null,this.#B=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:I,isFirefox:g}=BI.platform;return J(this,"fontFamilyMap",new Map([["sans-serif",`${I&&g?"Calibri, ":""}sans-serif`],["monospace",`${I&&g?"Lucida Console, ":""}monospace`]]))}render(){const I=()=>{this.#c.read().then(({value:g,done:C})=>{if(C){this.#I.resolve();return}this.#Z??=g.lang,Object.assign(this.#B,g.styles),this.#y(g.items),I()},this.#I.reject)};return this.#c=this.#W.getReader(),DI.#n.add(this),I(),this.#I.promise}update({viewport:I,onBefore:g=null}){const C=I.scale*QI.pixelRatio,A=I.rotation;if(A!==this.#m&&(g?.(),this.#m=A,Vg(this.#s,{rotation:A})),C!==this.#b){g?.(),this.#b=C;const l={div:null,properties:null,ctx:DI.#M(this.#Z)};for(const i of this.#G)l.properties=this.#o.get(i),l.div=i,this.#N(l)}}cancel(){const I=new Ag("TextLayer task cancelled.");this.#c?.cancel(I).catch(()=>{}),this.#c=null,this.#I.reject(I)}get textDivs(){return this.#G}get textContentItemsStr(){return this.#w}#y(I){if(this.#A)return;this.#i.ctx??=DI.#M(this.#Z);const g=this.#G,C=this.#w;for(const A of I){if(g.length>_Z){F("Ignoring additional textDivs for performance reasons."),this.#A=!0;return}if(A.str===void 0){if(A.type==="beginMarkedContentProps"||A.type==="beginMarkedContent"){const l=this.#g;this.#g=document.createElement("span"),this.#g.classList.add("markedContent"),A.id&&this.#g.setAttribute("id",`${A.id}`),l.append(this.#g)}else A.type==="endMarkedContent"&&(this.#g=this.#g.parentNode);continue}C.push(A.str),this.#V(A)}}#V(I){const g=document.createElement("span"),C={angle:0,canvasWidth:0,hasText:I.str!=="",hasEOL:I.hasEOL,fontSize:0};this.#G.push(g);const A=u.transform(this.#h,I.transform);let l=Math.atan2(A[1],A[0]);const i=this.#B[I.fontName];i.vertical&&(l+=Math.PI/2);let Z=this.#C&&i.fontSubstitution||i.fontFamily;Z=DI.fontFamilyMap.get(Z)||Z;const d=Math.hypot(A[2],A[3]),s=d*DI.#z(Z,i,this.#Z);let c,b;l===0?(c=A[4],b=A[5]-s):(c=A[4]+s*Math.sin(l),b=A[5]-s*Math.cos(l));const m=g.style;m.left=`${(100*c/this.#d).toFixed(2)}%`,m.top=`${(100*b/this.#l).toFixed(2)}%`,m.setProperty("--font-height",`${d.toFixed(2)}px`),m.fontFamily=Z,C.fontSize=d,g.setAttribute("role","presentation"),g.textContent=I.str,g.dir=I.dir,this.#C&&(g.dataset.fontName=i.fontSubstitutionLoadedName||I.fontName),l!==0&&(C.angle=l*(180/Math.PI));let B=!1;if(I.str.length>1)B=!0;else if(I.str!==" "&&I.transform[0]!==I.transform[3]){const W=Math.abs(I.transform[0]),o=Math.abs(I.transform[3]);W!==o&&Math.max(W,o)/Math.min(W,o)>1.5&&(B=!0)}if(B&&(C.canvasWidth=i.vertical?I.height:I.width),this.#o.set(g,C),this.#i.div=g,this.#i.properties=C,this.#N(this.#i),C.hasText&&this.#g.append(g),C.hasEOL){const W=document.createElement("br");W.setAttribute("role","presentation"),this.#g.append(W)}}#N(I){const{div:g,properties:C,ctx:A}=I,{style:l}=g;if(C.canvasWidth!==0&&C.hasText){const{fontFamily:i}=l,{canvasWidth:Z,fontSize:d}=C;DI.#u(A,d*this.#b,i);const{width:s}=A.measureText(g.textContent);s>0&&l.setProperty("--scale-x",Z*this.#b/s)}C.angle!==0&&l.setProperty("--rotate",`${C.angle}deg`)}static cleanup(){if(!(this.#n.size>0)){this.#Y.clear();for(const{canvas:I}of this.#a.values())I.remove();this.#a.clear()}}static#M(I=null){let g=this.#a.get(I||="");if(!g){const C=document.createElement("canvas");C.className="hiddenCanvasElement",C.lang=I,document.body.append(C),g=C.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#a.set(I,g),this.#X.set(g,{size:0,family:""})}return g}static#u(I,g,C){const A=this.#X.get(I);g===A.size&&C===A.family||(I.font=`${g}px ${C}`,A.size=g,A.family=C)}static#H(){if(this.#t!==null)return;const I=document.createElement("div");I.style.opacity=0,I.style.lineHeight=1,I.style.fontSize="1px",I.style.position="absolute",I.textContent="X",document.body.append(I),this.#t=I.getBoundingClientRect().height,I.remove()}static#z(I,g,C){const A=this.#Y.get(I);if(A)return A;const l=this.#M(C);l.canvas.width=l.canvas.height=xl,this.#u(l,xl,I);const i=l.measureText(""),Z=i.fontBoundingBoxAscent,d=Math.abs(i.fontBoundingBoxDescent);l.canvas.width=l.canvas.height=0;let s=.8;return Z?s=Z/(Z+d):(BI.platform.isFirefox&&F("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),g.ascent?s=g.ascent:g.descent&&(s=1+g.descent)),this.#Y.set(I,s),s}}const qZ=100;function vl(G={}){typeof G=="string"||G instanceof URL?G={url:G}:(G instanceof ArrayBuffer||ArrayBuffer.isView(G))&&(G={data:G});const I=new HA,{docId:g}=I,C=G.url?iZ(G.url):null,A=G.data?ZZ(G.data):null,l=G.httpHeaders||null,i=G.withCredentials===!0,Z=G.password??null,d=G.range instanceof El?G.range:null,s=Number.isInteger(G.rangeChunkSize)&&G.rangeChunkSize>0?G.rangeChunkSize:2**16;let c=G.worker instanceof wC?G.worker:null;const b=G.verbosity,m=typeof G.docBaseUrl=="string"&&!DC(G.docBaseUrl)?G.docBaseUrl:null,B=pC(G.cMapUrl),W=G.cMapPacked!==!1,o=G.CMapReaderFactory||(VI?oZ:el),h=pC(G.iccUrl),w=pC(G.standardFontDataUrl),a=G.StandardFontDataFactory||(VI?WZ:Xl),Y=pC(G.wasmUrl),V=G.WasmFactory||(VI?wZ:yl),n=G.stopAtErrors!==!0,e=Number.isInteger(G.maxImageSize)&&G.maxImageSize>-1?G.maxImageSize:-1,t=G.isEvalSupported!==!1,N=typeof G.isOffscreenCanvasSupported=="boolean"?G.isOffscreenCanvasSupported:!VI,R=typeof G.isImageDecoderSupported=="boolean"?G.isImageDecoderSupported:!VI&&(BI.platform.isFirefox||!globalThis.chrome),H=Number.isInteger(G.canvasMaxAreaInBytes)?G.canvasMaxAreaInBytes:-1,y=typeof G.disableFontFace=="boolean"?G.disableFontFace:VI,U=G.fontExtraProperties===!0,P=G.enableXfa===!0,j=G.ownerDocument||globalThis.document,sI=G.disableRange===!0,D=G.disableStream===!0,p=G.disableAutoFetch===!0,O=G.pdfBug===!0,SI=G.CanvasFactory||(VI?BZ:GZ),gg=G.FilterFactory||(VI?mZ:bZ),cI=G.enableHWA===!0,f=G.useWasm!==!1,_=d?d.length:G.length??NaN,Jg=typeof G.useSystemFonts=="boolean"?G.useSystemFonts:!VI&&!y,wg=typeof G.useWorkerFetch=="boolean"?G.useWorkerFetch:!!(o===el&&a===Xl&&V===yl&&B&&w&&Y&&sC(B,document.baseURI)&&sC(w,document.baseURI)&&sC(Y,document.baseURI)),hg=null;Ki(b);const GI={canvasFactory:new SI({ownerDocument:j,enableHWA:cI}),filterFactory:new gg({docId:g,ownerDocument:j}),cMapReaderFactory:wg?null:new o({baseUrl:B,isCompressed:W}),standardFontDataFactory:wg?null:new a({baseUrl:w}),wasmFactory:wg?null:new V({baseUrl:Y})};c||(c=wC.create({verbosity:b,port:Og.workerPort}),I._worker=c);const tC={docId:g,apiVersion:"5.4.530",data:A,password:Z,disableAutoFetch:p,rangeChunkSize:s,length:_,docBaseUrl:m,enableXfa:P,evaluatorOptions:{maxImageSize:e,disableFontFace:y,ignoreErrors:n,isEvalSupported:t,isOffscreenCanvasSupported:N,isImageDecoderSupported:R,canvasMaxAreaInBytes:H,fontExtraProperties:U,useSystemFonts:Jg,useWasm:f,useWorkerFetch:wg,cMapUrl:B,iccUrl:h,standardFontDataUrl:w,wasmUrl:Y}},NC={ownerDocument:j,pdfBug:O,styleElement:hg,loadingParams:{disableAutoFetch:p,enableXfa:P}};return c.promise.then(function(){if(I.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Cs=c.messageHandler.sendWithPromise("GetDocRequest",tC,A?[A.buffer]:null);let fA;if(d)fA=new pZ(d,{disableRange:sI,disableStream:D});else if(!A){if(!C)throw new Error("getDocument - no `url` parameter provided.");const _A=sC(C)?kZ:VI?EZ:rZ;fA=new _A({url:C,length:_,httpHeaders:l,withCredentials:i,rangeChunkSize:s,disableRange:sI,disableStream:D})}return Cs.then(_A=>{if(I.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Ni=new mC(g,_A,c.port),As=new gd(Ni,I,fA,NC,GI,cI);I._transport=As,Ni.send("Ready",null)})}).catch(I._capability.reject),I}class HA{static#I=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${HA.#I++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(I){throw this._worker?.port&&delete this._worker._pendingDestroy,I}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class El{#I=Promise.withResolvers();#g=[];#A=[];#C=[];#Z=[];constructor(I,g,C=!1,A=null){this.length=I,this.initialData=g,this.progressiveDone=C,this.contentDispositionFilename=A}addRangeListener(I){this.#Z.push(I)}addProgressListener(I){this.#C.push(I)}addProgressiveReadListener(I){this.#A.push(I)}addProgressiveDoneListener(I){this.#g.push(I)}onDataRange(I,g){for(const C of this.#Z)C(I,g)}onDataProgress(I,g){this.#I.promise.then(()=>{for(const C of this.#C)C(I,g)})}onDataProgressiveRead(I){this.#I.promise.then(()=>{for(const g of this.#A)g(I)})}onDataProgressiveDone(){this.#I.promise.then(()=>{for(const I of this.#g)I()})}transportReady(){this.#I.resolve()}requestDataRange(I,g){E("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class $Z{constructor(I,g){this._pdfInfo=I,this._transport=g}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return J(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(I){return this._transport.getPage(I)}getPageIndex(I){return this._transport.getPageIndex(I)}getDestinations(){return this._transport.getDestinations()}getDestination(I){return this._transport.getDestination(I)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(I,g){return this._transport.getAnnotationsByType(I,g)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:I="display"}={}){const{renderingIntent:g}=this._transport.getRenderingIntent(I);return this._transport.getOptionalContentConfig(g)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(I){return this._transport.extractPages(I)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(I=!1){return this._transport.startCleanup(I||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(I){return this._transport.cachedPageNumber(I)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Id{#I=!1;constructor(I,g,C,A=!1){this._pageIndex=I,this._pageInfo=g,this._transport=C,this._stats=A?new sl:null,this._pdfBug=A,this.commonObjs=C.commonObjs,this.objs=new Ol,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:I,rotation:g=this.rotate,offsetX:C=0,offsetY:A=0,dontFlip:l=!1}={}){return new dC({viewBox:this.view,userUnit:this.userUnit,scale:I,rotation:g,offsetX:C,offsetY:A,dontFlip:l})}getAnnotations({intent:I="display"}={}){const{renderingIntent:g}=this._transport.getRenderingIntent(I);return this._transport.getAnnotations(this._pageIndex,g)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return J(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:I,canvas:g=I.canvas,viewport:C,intent:A="display",annotationMode:l=Cg.ENABLE,transform:i=null,background:Z=null,optionalContentConfigPromise:d=null,annotationCanvasMap:s=null,pageColors:c=null,printAnnotationStorage:b=null,isEditing:m=!1,recordOperations:B=!1,operationsFilter:W=null}){this._stats?.time("Overall");const o=this._transport.getRenderingIntent(A,l,b,m),{renderingIntent:h,cacheKey:w}=o;this.#I=!1,d||=this._transport.getOptionalContentConfig(h);let a=this._intentStates.get(w);a||(a=Object.create(null),this._intentStates.set(w,a)),a.streamReaderCancelTimeout&&(clearTimeout(a.streamReaderCancelTimeout),a.streamReaderCancelTimeout=null);const Y=!!(h&HI.PRINT);a.displayReadyCapability||(a.displayReadyCapability=Promise.withResolvers(),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o));const V=!!(this._pdfBug&&globalThis.StepperManager?.enabled),n=!this.recordedBBoxes&&(B||V),e=R=>{if(a.renderTasks.delete(t),n){const H=t.gfx?.dependencyTracker.take();H&&(t.stepper&&t.stepper.setOperatorBBoxes(H,t.gfx.dependencyTracker.takeDebugMetadata()),B&&(this.recordedBBoxes=H))}Y&&(this.#I=!0),this.#g(),R?(t.capability.reject(R),this._abortOperatorList({intentState:a,reason:R instanceof Error?R:new Error(R)})):t.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},t=new vg({callback:e,params:{canvas:g,canvasContext:I,dependencyTracker:n?new aZ(g,a.operatorList.length,V):null,viewport:C,transform:i,background:Z},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:s,operatorList:a.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Y,pdfBug:this._pdfBug,pageColors:c,enableHWA:this._transport.enableHWA,operationsFilter:W});(a.renderTasks||=new Set).add(t);const N=t.task;return Promise.all([a.displayReadyCapability.promise,d]).then(([R,H])=>{if(this.destroyed){e();return}if(this._stats?.time("Rendering"),!(H.renderingIntent&h))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");t.initializeGraphics({transparency:R,optionalContentConfig:H}),t.operatorListChanged()}).catch(e),N}getOperatorList({intent:I="display",annotationMode:g=Cg.ENABLE,printAnnotationStorage:C=null,isEditing:A=!1}={}){function l(){Z.operatorList.lastChunk&&(Z.opListReadCapability.resolve(Z.operatorList),Z.renderTasks.delete(d))}const i=this._transport.getRenderingIntent(I,g,C,A,!0);let Z=this._intentStates.get(i.cacheKey);Z||(Z=Object.create(null),this._intentStates.set(i.cacheKey,Z));let d;return Z.opListReadCapability||(d=Object.create(null),d.operatorListChanged=l,Z.opListReadCapability=Promise.withResolvers(),(Z.renderTasks||=new Set).add(d),Z.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(i)),Z.opListReadCapability.promise}streamTextContent({includeMarkedContent:I=!1,disableNormalization:g=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:I===!0,disableNormalization:g===!0},{highWaterMark:100,size(A){return A.items.length}})}getTextContent(I={}){if(this._transport._htmlForXfa)return this.getXfa().then(C=>iC.textContent(C));const g=this.streamTextContent(I);return new Promise(function(C,A){function l(){i.read().then(function({value:d,done:s}){if(s){C(Z);return}Z.lang??=d.lang,Object.assign(Z.styles,d.styles),Z.items.push(...d.items),l()},A)}const i=g.getReader(),Z={items:[],styles:Object.create(null),lang:null};l()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const I=[];for(const g of this._intentStates.values())if(this._abortOperatorList({intentState:g,reason:new Error("Page was destroyed."),force:!0}),!g.opListReadCapability)for(const C of g.renderTasks)I.push(C.completed),C.cancel();return this.objs.clear(),this.#I=!1,Promise.all(I)}cleanup(I=!1){this.#I=!0;const g=this.#g();return I&&g&&(this._stats&&=new sl),g}#g(){if(!this.#I||this.destroyed)return!1;for(const{renderTasks:I,operatorList:g}of this._intentStates.values())if(I.size>0||!g.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#I=!1,!0}_startRenderPage(I,g){const C=this._intentStates.get(g);C&&(this._stats?.timeEnd("Page Request"),C.displayReadyCapability?.resolve(I))}_renderPageChunk(I,g){for(let C=0,A=I.length;C<A;C++)g.operatorList.fnArray.push(I.fnArray[C]),g.operatorList.argsArray.push(I.argsArray[C]);g.operatorList.lastChunk=I.lastChunk,g.operatorList.separateAnnots=I.separateAnnots;for(const C of g.renderTasks)C.operatorListChanged();I.lastChunk&&this.#g()}_pumpOperatorList({renderingIntent:I,cacheKey:g,annotationStorageSerializable:C,modifiedIds:A}){const{map:l,transfer:i}=C,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:I,cacheKey:g,annotationStorage:l,modifiedIds:A},i).getReader(),s=this._intentStates.get(g);s.streamReader=d;const c=()=>{d.read().then(({value:b,done:m})=>{if(m){s.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(b,s),c())},b=>{if(s.streamReader=null,!this._transport.destroyed){if(s.operatorList){s.operatorList.lastChunk=!0;for(const m of s.renderTasks)m.operatorListChanged();this.#g()}if(s.displayReadyCapability)s.displayReadyCapability.reject(b);else if(s.opListReadCapability)s.opListReadCapability.reject(b);else throw b}})};c()}_abortOperatorList({intentState:I,reason:g,force:C=!1}){if(I.streamReader){if(I.streamReaderCancelTimeout&&(clearTimeout(I.streamReaderCancelTimeout),I.streamReaderCancelTimeout=null),!C){if(I.renderTasks.size>0)return;if(g instanceof GA){let A=qZ;g.extraDelay>0&&g.extraDelay<1e3&&(A+=g.extraDelay),I.streamReaderCancelTimeout=setTimeout(()=>{I.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:I,reason:g,force:!0})},A);return}}if(I.streamReader.cancel(new Ag(g.message)).catch(()=>{}),I.streamReader=null,!this._transport.destroyed){for(const[A,l]of this._intentStates)if(l===I){this._intentStates.delete(A);break}this.cleanup()}}}get stats(){return this._stats}}const q=class q{constructor({name:I=null,port:g=null,verbosity:C=Si()}={}){PI(this,eI);PI(this,Wg,Promise.withResolvers());PI(this,TI,null);PI(this,Ig,null);PI(this,Sg,null);if(this.name=I,this.destroyed=!1,this.verbosity=C,g){if($(q,Fg).has(g))throw new Error("Cannot use more than one PDFWorker per port.");$(q,Fg).set(g,this),fI(this,eI,yi).call(this,g)}else fI(this,eI,ui).call(this)}get promise(){return $(this,Wg).promise}get port(){return $(this,Ig)}get messageHandler(){return $(this,TI)}destroy(){this.destroyed=!0,$(this,Sg)?.terminate(),uI(this,Sg,null),$(q,Fg).delete($(this,Ig)),uI(this,Ig,null),$(this,TI)?.destroy(),uI(this,TI,null)}static create(I){const g=$(this,Fg).get(I?.port);if(g){if(g._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return g}return new q(I)}static get workerSrc(){if(Og.workerSrc)return Og.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return J(this,"_setupFakeWorkerGlobal",(async()=>$(this,IC,gA)?$(this,IC,gA):(await import(this.workerSrc)).WorkerMessageHandler)())}};Wg=new WeakMap,TI=new WeakMap,Ig=new WeakMap,Sg=new WeakMap,$C=new WeakMap,pg=new WeakMap,Fg=new WeakMap,eI=new WeakSet,IA=function(){$(this,Wg).resolve(),$(this,TI).send("configure",{verbosity:this.verbosity})},yi=function(I){uI(this,Ig,I),uI(this,TI,new mC("main","worker",I)),$(this,TI).on("ready",()=>{}),fI(this,eI,IA).call(this)},ui=function(){if($(q,pg)||$(q,IC,gA)){fI(this,eI,XC).call(this);return}let{workerSrc:I}=q;try{q._isSameOrigin(window.location,I)||(I=q._createCDNWrapper(new URL(I,window.location).href));const g=new Worker(I,{type:"module"}),C=new mC("main","worker",g),A=()=>{l.abort(),C.destroy(),g.terminate(),this.destroyed?$(this,Wg).reject(new Error("Worker was destroyed")):fI(this,eI,XC).call(this)},l=new AbortController;g.addEventListener("error",()=>{$(this,Sg)||A()},{signal:l.signal}),C.on("test",Z=>{if(l.abort(),this.destroyed||!Z){A();return}uI(this,TI,C),uI(this,Ig,g),uI(this,Sg,g),fI(this,eI,IA).call(this)}),C.on("ready",Z=>{if(l.abort(),this.destroyed){A();return}try{i()}catch{fI(this,eI,XC).call(this)}});const i=()=>{const Z=new Uint8Array;C.send("test",Z,[Z.buffer])};i();return}catch{HC("The worker has been disabled.")}fI(this,eI,XC).call(this)},XC=function(){$(q,pg)||(F("Setting up fake worker."),uI(q,pg,!0)),q._setupFakeWorkerGlobal.then(I=>{if(this.destroyed){$(this,Wg).reject(new Error("Worker was destroyed"));return}const g=new cZ;uI(this,Ig,g);const C=`fake${Ri(q,$C)._++}`,A=new mC(C+"_worker",C,g);I.setup(A,g),uI(this,TI,new mC(C,C+"_worker",g)),fI(this,eI,IA).call(this)}).catch(I=>{$(this,Wg).reject(new Error(`Setting up fake worker failed: "${I.message}".`))})},IC=new WeakSet,gA=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},PI(q,IC),PI(q,$C,0),PI(q,pg,!1),PI(q,Fg,new WeakMap),VI&&(uI(q,pg,!0),Og.workerSrc||="./pdf.worker.mjs"),q._isSameOrigin=(I,g)=>{const C=URL.parse(I);if(!C?.origin||C.origin==="null")return!1;const A=new URL(g,C);return C.origin===A.origin},q._createCDNWrapper=I=>{const g=`await import("${I}");`;return URL.createObjectURL(new Blob([g],{type:"text/javascript"}))},q.fromPort=I=>{if(Oi("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!I?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return q.create(I)};let wC=q;class gd{#I=new Map;#g=new Map;#A=new Map;#C=new Map;#Z=null;constructor(I,g,C,A,l,i){this.messageHandler=I,this.loadingTask=g,this.commonObjs=new Ol,this.fontLoader=new CZ({ownerDocument:A.ownerDocument,styleElement:A.styleElement}),this.loadingParams=A.loadingParams,this._params=A,this.canvasFactory=l.canvasFactory,this.filterFactory=l.filterFactory,this.cMapReaderFactory=l.cMapReaderFactory,this.standardFontDataFactory=l.standardFontDataFactory,this.wasmFactory=l.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=C,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=i,this.setupMessageHandler()}#i(I,g=null){const C=this.#I.get(I);if(C)return C;const A=this.messageHandler.sendWithPromise(I,g);return this.#I.set(I,A),A}get annotationStorage(){return J(this,"annotationStorage",new aA)}getRenderingIntent(I,g=Cg.ENABLE,C=null,A=!1,l=!1){let i=HI.DISPLAY,Z=hA;switch(I){case"any":i=HI.ANY;break;case"display":break;case"print":i=HI.PRINT;break;default:F(`getRenderingIntent - invalid intent: ${I}`)}const d=i&HI.PRINT&&C instanceof al?C:this.annotationStorage;switch(g){case Cg.DISABLE:i+=HI.ANNOTATIONS_DISABLE;break;case Cg.ENABLE:break;case Cg.ENABLE_FORMS:i+=HI.ANNOTATIONS_FORMS;break;case Cg.ENABLE_STORAGE:i+=HI.ANNOTATIONS_STORAGE,Z=d.serializable;break;default:F(`getRenderingIntent - invalid annotationMode: ${g}`)}A&&(i+=HI.IS_EDITING),l&&(i+=HI.OPLIST);const{ids:s,hash:c}=d.modifiedIds,b=[i,Z.hash,c];return{renderingIntent:i,cacheKey:b.join("_"),annotationStorageSerializable:Z,modifiedIds:s}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#Z?.reject(new Error("Worker was destroyed during onPassword callback"));const I=[];for(const C of this.#g.values())I.push(C._destroy());this.#g.clear(),this.#A.clear(),this.#C.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const g=this.messageHandler.sendWithPromise("Terminate",null);return I.push(g),Promise.all(I).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#I.clear(),this.filterFactory.destroy(),DI.cleanup(),this._networkStream?.cancelAllRequests(new Ag("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:I,loadingTask:g}=this;I.on("GetReader",(C,A)=>{T(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=l=>{this._lastProgress={loaded:l.loaded,total:l.total}},A.onPull=()=>{this._fullReader.read().then(function({value:l,done:i}){if(i){A.close();return}T(l instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),A.enqueue(new Uint8Array(l),1,[l])}).catch(l=>{A.error(l)})},A.onCancel=l=>{this._fullReader.cancel(l),A.ready.catch(i=>{if(!this.destroyed)throw i})}}),I.on("ReaderHeadersReady",async C=>{await this._fullReader.headersReady;const{isStreamingSupported:A,isRangeSupported:l,contentLength:i}=this._fullReader;return(!A||!l)&&(this._lastProgress&&g.onProgress?.(this._lastProgress),this._fullReader.onProgress=Z=>{g.onProgress?.({loaded:Z.loaded,total:Z.total})}),{isStreamingSupported:A,isRangeSupported:l,contentLength:i}}),I.on("GetRangeReader",(C,A)=>{T(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const l=this._networkStream.getRangeReader(C.begin,C.end);if(!l){A.close();return}A.onPull=()=>{l.read().then(function({value:i,done:Z}){if(Z){A.close();return}T(i instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),A.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{A.error(i)})},A.onCancel=i=>{l.cancel(i),A.ready.catch(Z=>{if(!this.destroyed)throw Z})}}),I.on("GetDoc",({pdfInfo:C})=>{this._numPages=C.numPages,this._htmlForXfa=C.htmlForXfa,delete C.htmlForXfa,g._capability.resolve(new $Z(C,this))}),I.on("DocException",C=>{g._capability.reject(tI(C))}),I.on("PasswordRequest",C=>{this.#Z=Promise.withResolvers();try{if(!g.onPassword)throw tI(C);const A=l=>{l instanceof Error?this.#Z.reject(l):this.#Z.resolve({password:l})};g.onPassword(A,C.code)}catch(A){this.#Z.reject(A)}return this.#Z.promise}),I.on("DataLoaded",C=>{g.onProgress?.({loaded:C.length,total:C.length}),this.downloadInfoCapability.resolve(C)}),I.on("StartRenderPage",C=>{if(this.destroyed)return;this.#g.get(C.pageIndex)._startRenderPage(C.transparency,C.cacheKey)}),I.on("commonobj",([C,A,l])=>{if(this.destroyed||this.commonObjs.has(C))return null;switch(A){case"Font":if("error"in l){const b=l.error;F(`Error during font loading: ${b}`),this.commonObjs.resolve(C,b);break}const i=new x(l),Z=this._params.pdfBug&&globalThis.FontInspector?.enabled?(b,m)=>globalThis.FontInspector.fontAdded(b,m):null,d=new AZ(i,Z,l.extra,l.charProcOperatorList);this.fontLoader.bind(d).catch(()=>I.sendWithPromise("FontFallback",{id:C})).finally(()=>{!d.fontExtraProperties&&d.data&&d.clearData(),this.commonObjs.resolve(C,d)});break;case"CopyLocalImage":const{imageRef:s}=l;T(s,"The imageRef must be defined.");for(const b of this.#g.values())for(const[,m]of b.objs)if(m?.ref===s)return m.dataLen?(this.commonObjs.resolve(C,structuredClone(m)),m.dataLen):null;break;case"FontPath":this.commonObjs.resolve(C,new lZ(l));break;case"Image":this.commonObjs.resolve(C,l);break;case"Pattern":const c=new WI(l);this.commonObjs.resolve(C,c.getIR());break;default:throw new Error(`Got unknown common object type ${A}`)}return null}),I.on("obj",([C,A,l,i])=>{if(this.destroyed)return;const Z=this.#g.get(A);if(!Z.objs.has(C)){if(Z._intentStates.size===0){i?.bitmap?.close();return}switch(l){case"Image":case"Pattern":Z.objs.resolve(C,i);break;default:throw new Error(`Got unknown object type ${l}`)}}}),I.on("DocProgress",C=>{this.destroyed||g.onProgress?.({loaded:C.loaded,total:C.total})}),I.on("FetchBinaryData",async C=>{if(this.destroyed)throw new Error("Worker was destroyed.");const A=this[C.type];if(!A)throw new Error(`${C.type} not initialized, see the \`useWorkerFetch\` parameter.`);return A.fetch(C)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&F("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:I,transfer:g}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:I,filename:this._fullReader?.filename??null},g).finally(()=>{this.annotationStorage.resetModified()})}extractPages(I){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:I})}getPage(I){if(!Number.isInteger(I)||I<=0||I>this._numPages)return Promise.reject(new Error("Invalid page request."));const g=I-1,C=this.#A.get(g);if(C)return C;const A=this.messageHandler.sendWithPromise("GetPage",{pageIndex:g}).then(l=>{if(this.destroyed)throw new Error("Transport destroyed");l.refStr&&this.#C.set(l.refStr,I);const i=new Id(g,l,this,this._params.pdfBug);return this.#g.set(g,i),i});return this.#A.set(g,A),A}getPageIndex(I){return YA(I)?this.messageHandler.sendWithPromise("GetPageIndex",{num:I.num,gen:I.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(I,g){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:I,intent:g})}getFieldObjects(){return this.#i("GetFieldObjects")}hasJSActions(){return this.#i("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(I){return typeof I!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:I})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(I,g){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:I,pageIndexesToSkip:g})}getDocJSActions(){return this.#i("GetDocJSActions")}getPageJSActions(I){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:I})}getStructTree(I){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:I})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(I){return this.#i("GetOptionalContentConfig").then(g=>new SZ(g,I))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const I="GetMetadata",g=this.#I.get(I);if(g)return g;const C=this.messageHandler.sendWithPromise(I,null).then(A=>({info:A[0],metadata:A[1]?new DZ(A[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:A[2]}));return this.#I.set(I,C),C}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(I=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const g of this.#g.values())if(!g.cleanup())throw new Error(`startCleanup: Page ${g.pageNumber} is currently rendering.`);this.commonObjs.clear(),I||this.fontLoader.clear(),this.#I.clear(),this.filterFactory.destroy(!0),DI.cleanup()}}cachedPageNumber(I){if(!YA(I))return null;const g=I.gen===0?`${I.num}R`:`${I.num}R${I.gen}`;return this.#C.get(g)??null}}class Cd{#I=null;onContinue=null;onError=null;constructor(I){this.#I=I}get promise(){return this.#I.capability.promise}cancel(I=0){this.#I.cancel(null,I)}get separateAnnots(){const{separateAnnots:I}=this.#I.operatorList;if(!I)return!1;const{annotationCanvasMap:g}=this.#I;return I.form||I.canvas&&g?.size>0}}class vg{#I=null;static#g=new WeakSet;constructor({callback:I,params:g,objs:C,commonObjs:A,annotationCanvasMap:l,operatorList:i,pageIndex:Z,canvasFactory:d,filterFactory:s,useRequestAnimationFrame:c=!1,pdfBug:b=!1,pageColors:m=null,enableHWA:B=!1,operationsFilter:W=null}){this.callback=I,this.params=g,this.objs=C,this.commonObjs=A,this.annotationCanvasMap=l,this.operatorListIdx=null,this.operatorList=i,this._pageIndex=Z,this.canvasFactory=d,this.filterFactory=s,this._pdfBug=b,this.pageColors=m,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Cd(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=g.canvas,this._canvasContext=g.canvas?null:g.canvasContext,this._enableHWA=B,this._dependencyTracker=g.dependencyTracker,this._operationsFilter=W}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:I=!1,optionalContentConfig:g}){if(this.cancelled)return;if(this._canvas){if(vg.#g.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");vg.#g.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:C,transform:A,background:l,dependencyTracker:i}=this.params,Z=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Ug(Z,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:g},this.annotationCanvasMap,this.pageColors,i),this.gfx.beginDrawing({transform:A,viewport:C,transparency:I,background:l}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(I=null,g=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#I&&(window.cancelAnimationFrame(this.#I),this.#I=null),vg.#g.delete(this._canvas),I||=new GA(`Rendering cancelled, page ${this._pageIndex+1}`,g),this.callback(I),this.task.onError?.(I)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#I=window.requestAnimationFrame(()=>{this.#I=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),vg.#g.delete(this._canvas),this.callback())))}}const Ad="5.4.530",ld="50cc4adac";class zI{#I=null;#g=null;#A;#C=null;#Z=!1;#i=!1;#l=null;#d;#c=null;#s=null;static#m=null;static get _keyboardManager(){return J(this,"_keyboardManager",new bC([[["Escape","mac+Escape"],zI.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],zI.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],zI.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],zI.prototype._moveToPrevious],[["Home","mac+Home"],zI.prototype._moveToBeginning],[["End","mac+End"],zI.prototype._moveToEnd]]))}constructor({editor:I=null,uiManager:g=null}){I?(this.#i=!1,this.#l=I):this.#i=!0,this.#s=I?._uiManager||g,this.#d=this.#s._eventBus,this.#A=I?.color?.toUpperCase()||this.#s?.highlightColors.values().next().value||"#FFFF98",zI.#m||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const I=this.#I=document.createElement("button");I.className="colorPicker",I.tabIndex="0",I.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),I.ariaHasPopup="true",this.#l&&(I.ariaControls=`${this.#l.id}_colorpicker_dropdown`);const g=this.#s._signal;I.addEventListener("click",this.#W.bind(this),{signal:g}),I.addEventListener("keydown",this.#w.bind(this),{signal:g});const C=this.#g=document.createElement("span");return C.className="swatch",C.ariaHidden="true",C.style.backgroundColor=this.#A,I.append(C),I}renderMainDropdown(){const I=this.#C=this.#b();return I.ariaOrientation="horizontal",I.ariaLabelledBy="highlightColorPickerLabel",I}#b(){const I=document.createElement("div"),g=this.#s._signal;I.addEventListener("contextmenu",pI,{signal:g}),I.className="dropdown",I.role="listbox",I.ariaMultiSelectable="false",I.ariaOrientation="vertical",I.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#l&&(I.id=`${this.#l.id}_colorpicker_dropdown`);for(const[C,A]of this.#s.highlightColors){const l=document.createElement("button");l.tabIndex="0",l.role="option",l.setAttribute("data-color",A),l.title=C,l.setAttribute("data-l10n-id",zI.#m[C]);const i=document.createElement("span");l.append(i),i.className="swatch",i.style.backgroundColor=A,l.ariaSelected=A===this.#A,l.addEventListener("click",this.#B.bind(this,A),{signal:g}),I.append(l)}return I.addEventListener("keydown",this.#w.bind(this),{signal:g}),I}#B(I,g){g.stopPropagation(),this.#d.dispatch("switchannotationeditorparams",{source:this,type:L.HIGHLIGHT_COLOR,value:I}),this.updateColor(I)}_colorSelectFromKeyboard(I){if(I.target===this.#I){this.#W(I);return}const g=I.target.getAttribute("data-color");g&&this.#B(g,I)}_moveToNext(I){if(!this.#o){this.#W(I);return}if(I.target===this.#I){this.#C.firstElementChild?.focus();return}I.target.nextSibling?.focus()}_moveToPrevious(I){if(I.target===this.#C?.firstElementChild||I.target===this.#I){this.#o&&this._hideDropdownFromKeyboard();return}this.#o||this.#W(I),I.target.previousSibling?.focus()}_moveToBeginning(I){if(!this.#o){this.#W(I);return}this.#C.firstElementChild?.focus()}_moveToEnd(I){if(!this.#o){this.#W(I);return}this.#C.lastElementChild?.focus()}#w(I){zI._keyboardManager.exec(this,I)}#W(I){if(this.#o){this.hideDropdown();return}if(this.#Z=I.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#G.bind(this),{signal:this.#s.combinedSignal(this.#c)})),this.#I.ariaExpanded="true",this.#C){this.#C.classList.remove("hidden");return}const g=this.#C=this.#b();this.#I.append(g)}#G(I){this.#C?.contains(I.target)||this.hideDropdown()}hideDropdown(){this.#C?.classList.add("hidden"),this.#I.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#o(){return this.#C&&!this.#C.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#i){if(!this.#o){this.#l?.unselect();return}this.hideDropdown(),this.#I.focus({preventScroll:!0,focusVisible:this.#Z})}}updateColor(I){if(this.#g&&(this.#g.style.backgroundColor=I),!this.#C)return;const g=this.#s.highlightColors.values();for(const C of this.#C.children)C.ariaSelected=g.next().value===I.toUpperCase()}destroy(){this.#I?.remove(),this.#I=null,this.#g=null,this.#C?.remove(),this.#C=null}}class hC{#I=null;#g=null;#A=null;static#C=null;constructor(I){this.#g=I,this.#A=I._uiManager,hC.#C||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#I)return this.#I;const{editorType:I,colorType:g,color:C}=this.#g,A=this.#I=document.createElement("input");return A.type="color",A.value=C||"#000000",A.className="basicColorPicker",A.tabIndex=0,A.setAttribute("data-l10n-id",hC.#C[I]),A.addEventListener("input",()=>{this.#A.updateParams(g,A.value)},{signal:this.#A._signal}),A}update(I){this.#I&&(this.#I.value=I)}destroy(){this.#I?.remove(),this.#I=null}hideDropdown(){}}function Pl(G){return Math.floor(Math.max(0,Math.min(1,G))*255).toString(16).padStart(2,"0")}function aC(G){return Math.max(0,Math.min(255,255*G))}class fl{static CMYK_G([I,g,C,A]){return["G",1-Math.min(1,.3*I+.59*C+.11*g+A)]}static G_CMYK([I]){return["CMYK",0,0,0,1-I]}static G_RGB([I]){return["RGB",I,I,I]}static G_rgb([I]){return I=aC(I),[I,I,I]}static G_HTML([I]){const g=Pl(I);return`#${g}${g}${g}`}static RGB_G([I,g,C]){return["G",.3*I+.59*g+.11*C]}static RGB_rgb(I){return I.map(aC)}static RGB_HTML(I){return`#${I.map(Pl).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([I,g,C,A]){return["RGB",1-Math.min(1,I+A),1-Math.min(1,C+A),1-Math.min(1,g+A)]}static CMYK_rgb([I,g,C,A]){return[aC(1-Math.min(1,I+A)),aC(1-Math.min(1,C+A)),aC(1-Math.min(1,g+A))]}static CMYK_HTML(I){const g=this.CMYK_RGB(I).slice(1);return this.RGB_HTML(g)}static RGB_CMYK([I,g,C]){const A=1-I,l=1-g,i=1-C,Z=Math.min(A,l,i);return["CMYK",A,l,i,Z]}}class id{create(I,g,C=!1){if(I<=0||g<=0)throw new Error("Invalid SVG dimensions");const A=this._createSVG("svg:svg");return A.setAttribute("version","1.1"),C||(A.setAttribute("width",`${I}px`),A.setAttribute("height",`${g}px`)),A.setAttribute("preserveAspectRatio","none"),A.setAttribute("viewBox",`0 0 ${I} ${g}`),A}createElement(I){if(typeof I!="string")throw new Error("Invalid SVG element type");return this._createSVG(I)}_createSVG(I){E("Abstract method `_createSVG` called.")}}class QC extends id{_createSVG(I){return document.createElementNS(_I,I)}}const Zd=9,ng=new WeakSet,dd=new Date().getTimezoneOffset()*60*1e3;class MA{static create(I){switch(I.data.annotationType){case ZI.LINK:return new DA(I);case ZI.TEXT:return new cd(I);case ZI.WIDGET:switch(I.data.fieldType){case"Tx":return new Gd(I);case"Btn":return I.data.radioButton?new _l(I):I.data.checkBox?new md(I):new Bd(I);case"Ch":return new od(I);case"Sig":return new bd(I)}return new eg(I);case ZI.POPUP:return new KA(I);case ZI.FREETEXT:return new ql(I);case ZI.LINE:return new wd(I);case ZI.SQUARE:return new hd(I);case ZI.CIRCLE:return new ad(I);case ZI.POLYLINE:return new $l(I);case ZI.CARET:return new Vd(I);case ZI.INK:return new SA(I);case ZI.POLYGON:return new Yd(I);case ZI.HIGHLIGHT:return new Ii(I);case ZI.UNDERLINE:return new nd(I);case ZI.SQUIGGLY:return new ed(I);case ZI.STRIKEOUT:return new td(I);case ZI.STAMP:return new gi(I);case ZI.FILEATTACHMENT:return new Nd(I);default:return new gI(I)}}}class gI{#I=null;#g=!1;#A=null;constructor(I,{isRenderable:g=!1,ignoreBorder:C=!1,createQuadrilaterals:A=!1}={}){this.isRenderable=g,this.data=I.data,this.layer=I.layer,this.linkService=I.linkService,this.downloadManager=I.downloadManager,this.imageResourcesPath=I.imageResourcesPath,this.renderForms=I.renderForms,this.svgFactory=I.svgFactory,this.annotationStorage=I.annotationStorage,this.enableComment=I.enableComment,this.enableScripting=I.enableScripting,this.hasJSActions=I.hasJSActions,this._fieldObjects=I.fieldObjects,this.parent=I.parent,this.hasOwnCommentButton=!1,g&&(this.contentElement=this.container=this._createContainer(C)),A&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:I,richText:g}){return!!(I?.str||g?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return gI._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:I}=this,g=this.annotationStorage?.getEditor(I.id);return g?g.getData():I}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const I=this.annotationStorage?.getEditor(this.data.id);if(I)return I.commentButtonPositionInPage;const{quadPoints:g,inkLists:C,rect:A}=this.data;let l=-1/0,i=-1/0;if(g?.length>=8){for(let Z=0;Z<g.length;Z+=8)g[Z+1]>i?(i=g[Z+1],l=g[Z+2]):g[Z+1]===i&&(l=Math.max(l,g[Z+2]));return[l,i]}if(C?.length>=1){for(const Z of C)for(let d=0,s=Z.length;d<s;d+=2)Z[d+1]>i?(i=Z[d+1],l=Z[d]):Z[d+1]===i&&(l=Math.max(l,Z[d]));if(l!==1/0)return[l,i]}return A?[A[2],A[3]]:null}_normalizePoint(I){const{page:{view:g},viewport:{rawDims:{pageWidth:C,pageHeight:A,pageX:l,pageY:i}}}=this.parent;return I[1]=g[3]-I[1]+g[1],I[0]=100*(I[0]-l)/C,I[1]=100*(I[1]-i)/A,I}get commentText(){const{data:I}=this;return this.annotationStorage.getRawValue(`${gC}${I.id}`)?.popup?.contents||I.contentsObj?.str||""}set commentText(I){const{data:g}=this,C={deleted:!I,contents:I||""};this.annotationStorage.updateEditor(g.id,{popup:C})||this.annotationStorage.setValue(`${gC}${g.id}`,{id:g.id,annotationType:g.annotationType,pageIndex:this.parent.page._pageIndex,popup:C,popupRef:g.popupRef,modificationDate:new Date}),I||this.removePopup()}removePopup(){(this.#A?.popup||this.popup)?.remove(),this.#A=this.popup=null}updateEdited(I){if(!this.container)return;I.rect&&(this.#I||={rect:this.data.rect.slice(0)});const{rect:g,popup:C}=I;g&&this.#C(g);let A=this.#A?.popup||this.popup;!A&&C?.text&&(this._createPopup(C),A=this.#A.popup),A&&(A.updateEdited(I),C?.deleted&&(A.remove(),this.#A=null,this.popup=null))}resetEdited(){this.#I&&(this.#C(this.#I.rect),this.#A?.popup.resetEdited(),this.#I=null)}#C(I){const{container:{style:g},data:{rect:C,rotation:A},parent:{viewport:{rawDims:{pageWidth:l,pageHeight:i,pageX:Z,pageY:d}}}}=this;C?.splice(0,4,...I),g.left=`${100*(I[0]-Z)/l}%`,g.top=`${100*(i-I[3]+d)/i}%`,A===0?(g.width=`${100*(I[2]-I[0])/l}%`,g.height=`${100*(I[3]-I[1])/i}%`):this.setRotation(A)}_createContainer(I){const{data:g,parent:{page:C,viewport:A}}=this,l=document.createElement("section");l.setAttribute("data-annotation-id",g.id),!(this instanceof eg)&&!(this instanceof DA)&&(l.tabIndex=0);const{style:i}=l;if(i.zIndex=this.parent.zIndex,this.parent.zIndex+=2,g.alternativeText&&(l.title=g.alternativeText),g.noRotate&&l.classList.add("norotate"),!g.rect||this instanceof KA){const{rotation:o}=g;return!g.hasOwnCanvas&&o!==0&&this.setRotation(o,l),l}const{width:Z,height:d}=this;if(!I&&g.borderStyle.width>0){i.borderWidth=`${g.borderStyle.width}px`;const o=g.borderStyle.horizontalCornerRadius,h=g.borderStyle.verticalCornerRadius;if(o>0||h>0){const a=`calc(${o}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`;i.borderRadius=a}else if(this instanceof _l){const a=`calc(${Z}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;i.borderRadius=a}switch(g.borderStyle.style){case zg.SOLID:i.borderStyle="solid";break;case zg.DASHED:i.borderStyle="dashed";break;case zg.BEVELED:F("Unimplemented border style: beveled");break;case zg.INSET:F("Unimplemented border style: inset");break;case zg.UNDERLINE:i.borderBottomStyle="solid";break}const w=g.borderColor||null;w?(this.#g=!0,i.borderColor=u.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):i.borderWidth=0}const s=u.normalizeRect([g.rect[0],C.view[3]-g.rect[1]+C.view[1],g.rect[2],C.view[3]-g.rect[3]+C.view[1]]),{pageWidth:c,pageHeight:b,pageX:m,pageY:B}=A.rawDims;i.left=`${100*(s[0]-m)/c}%`,i.top=`${100*(s[1]-B)/b}%`;const{rotation:W}=g;return g.hasOwnCanvas||W===0?(i.width=`${100*Z/c}%`,i.height=`${100*d/b}%`):this.setRotation(W,l),l}setRotation(I,g=this.container){if(!this.data.rect)return;const{pageWidth:C,pageHeight:A}=this.parent.viewport.rawDims;let{width:l,height:i}=this;I%180!==0&&([l,i]=[i,l]),g.style.width=`${100*l/C}%`,g.style.height=`${100*i/A}%`,g.setAttribute("data-main-rotation",(360-I)%360)}get _commonActions(){const I=(g,C,A)=>{const l=A.detail[g],i=l[0],Z=l.slice(1);A.target.style[C]=fl[`${i}_HTML`](Z),this.annotationStorage.setValue(this.data.id,{[C]:fl[`${i}_rgb`](Z)})};return J(this,"_commonActions",{display:g=>{const{display:C}=g.detail,A=C%2===1;this.container.style.visibility=A?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:A,noPrint:C===1||C===2})},print:g=>{this.annotationStorage.setValue(this.data.id,{noPrint:!g.detail.print})},hidden:g=>{const{hidden:C}=g.detail;this.container.style.visibility=C?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:C,noView:C})},focus:g=>{setTimeout(()=>g.target.focus({preventScroll:!1}),0)},userName:g=>{g.target.title=g.detail.userName},readonly:g=>{g.target.disabled=g.detail.readonly},required:g=>{this._setRequired(g.target,g.detail.required)},bgColor:g=>{I("bgColor","backgroundColor",g)},fillColor:g=>{I("fillColor","backgroundColor",g)},fgColor:g=>{I("fgColor","color",g)},textColor:g=>{I("textColor","color",g)},borderColor:g=>{I("borderColor","borderColor",g)},strokeColor:g=>{I("strokeColor","borderColor",g)},rotation:g=>{const C=g.detail.rotation;this.setRotation(C),this.annotationStorage.setValue(this.data.id,{rotation:C})}})}_dispatchEventFromSandbox(I,g){const C=this._commonActions;for(const A of Object.keys(g.detail))(I[A]||C[A])?.(g)}_setDefaultPropertiesFromJS(I){if(!this.enableScripting)return;const g=this.annotationStorage.getRawValue(this.data.id);if(!g)return;const C=this._commonActions;for(const[A,l]of Object.entries(g)){const i=C[A];if(i){const Z={detail:{[A]:l},target:I};i(Z),delete g[A]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:I}=this.data;if(!I)return;const[g,C,A,l]=this.data.rect.map(o=>Math.fround(o));if(I.length===8){const[o,h,w,a]=I.subarray(2,6);if(A===o&&l===h&&g===w&&C===a)return}const{style:i}=this.container;let Z;if(this.#g){const{borderColor:o,borderWidth:h}=i;i.borderWidth=0,Z=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${o}" stroke-width="${h}">`],this.container.classList.add("hasBorder")}const d=A-g,s=l-C,{svgFactory:c}=this,b=c.createElement("svg");b.classList.add("quadrilateralsContainer"),b.setAttribute("width",0),b.setAttribute("height",0),b.role="none";const m=c.createElement("defs");b.append(m);const B=c.createElement("clipPath"),W=`clippath_${this.data.id}`;B.setAttribute("id",W),B.setAttribute("clipPathUnits","objectBoundingBox"),m.append(B);for(let o=2,h=I.length;o<h;o+=8){const w=I[o],a=I[o+1],Y=I[o+2],V=I[o+3],n=c.createElement("rect"),e=(Y-g)/d,t=(l-a)/s,N=(w-Y)/d,R=(a-V)/s;n.setAttribute("x",e),n.setAttribute("y",t),n.setAttribute("width",N),n.setAttribute("height",R),B.append(n),Z?.push(`<rect vector-effect="non-scaling-stroke" x="${e}" y="${t}" width="${N}" height="${R}"/>`)}this.#g&&(Z.push("</g></svg>')"),i.backgroundImage=Z.join("")),this.container.append(b),this.container.style.clipPath=`url(#${W})`}_createPopup(I=null){const{data:g}=this;let C,A;I?(C={str:I.text},A=I.date):(C=g.contentsObj,A=g.modificationDate),this.#A=new KA({data:{color:g.color,titleObj:g.titleObj,modificationDate:A,contentsObj:C,richText:g.richText,parentRect:g.rect,borderStyle:0,id:`popup_${g.id}`,rotation:g.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#A||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#A}render(){E("Abstract method `AnnotationElement.render` called")}_getElementsByName(I,g=null){const C=[];if(this._fieldObjects){const A=this._fieldObjects[I];if(A)for(const{page:l,id:i,exportValues:Z}of A){if(l===-1||i===g)continue;const d=typeof Z=="string"?Z:null,s=document.querySelector(`[data-element-id="${i}"]`);if(s&&!ng.has(s)){F(`_getElementsByName - element not allowed: ${i}`);continue}C.push({id:i,exportValue:d,domElement:s})}return C}for(const A of document.getElementsByName(I)){const{exportValue:l}=A,i=A.getAttribute("data-element-id");i!==g&&ng.has(A)&&C.push({id:i,exportValue:l,domElement:A})}return C}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const I=this.getElementsToTriggerPopup();if(Array.isArray(I))for(const g of I)g.classList.add("highlightArea");else I.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:I,data:{id:g}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:I,editId:g,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class sd extends gI{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.editor=I.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:I}=this;I.hasComment&&this._createPopup(I.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(I){this.editor.comment=I,I||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class DA extends gI{constructor(I,g=null){super(I,{isRenderable:!0,ignoreBorder:!!g?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=I.data.isTooltipOnly}render(){const{data:I,linkService:g}=this,C=document.createElement("a");C.setAttribute("data-element-id",I.id);let A=!1;return I.url?(g.addLinkAttributes(C,I.url,I.newWindow),A=!0):I.action?(this._bindNamedAction(C,I.action,I.overlaidText),A=!0):I.attachment?(this.#g(C,I.attachment,I.overlaidText,I.attachmentDest),A=!0):I.setOCGState?(this.#A(C,I.setOCGState,I.overlaidText),A=!0):I.dest?(this._bindLink(C,I.dest,I.overlaidText),A=!0):(I.actions&&(I.actions.Action||I.actions["Mouse Up"]||I.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(C,I),A=!0),I.resetForm?(this._bindResetFormAction(C,I.resetForm),A=!0):this.isTooltipOnly&&!A&&(this._bindLink(C,""),A=!0)),this.container.classList.add("linkAnnotation"),A&&(this.contentElement=C,this.container.append(C)),this.container}#I(){this.container.setAttribute("data-internal-link","")}_bindLink(I,g,C=""){I.href=this.linkService.getDestinationHash(g),I.onclick=()=>(g&&this.linkService.goToDestination(g),!1),(g||g==="")&&this.#I(),C&&(I.title=C)}_bindNamedAction(I,g,C=""){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>(this.linkService.executeNamedAction(g),!1),C&&(I.title=C),this.#I()}#g(I,g,C="",A=null){I.href=this.linkService.getAnchorUrl(""),g.description?I.title=g.description:C&&(I.title=C),I.onclick=()=>(this.downloadManager?.openOrDownloadData(g.content,g.filename,A),!1),this.#I()}#A(I,g,C=""){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>(this.linkService.executeSetOCGState(g),!1),C&&(I.title=C),this.#I()}_bindJSAction(I,g){I.href=this.linkService.getAnchorUrl("");const C=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const A of Object.keys(g.actions)){const l=C.get(A);l&&(I[l]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g.id,name:A}}),!1))}g.overlaidText&&(I.title=g.overlaidText),I.onclick||(I.onclick=()=>!1),this.#I()}_bindResetFormAction(I,g){const C=I.onclick;if(C||(I.href=this.linkService.getAnchorUrl("")),this.#I(),!this._fieldObjects){F('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),C||(I.onclick=()=>!1);return}I.onclick=()=>{C?.();const{fields:A,refs:l,include:i}=g,Z=[];if(A.length!==0||l.length!==0){const c=new Set(l);for(const b of A){const m=this._fieldObjects[b]||[];for(const{id:B}of m)c.add(B)}for(const b of Object.values(this._fieldObjects))for(const m of b)c.has(m.id)===i&&Z.push(m)}else for(const c of Object.values(this._fieldObjects))Z.push(...c);const d=this.annotationStorage,s=[];for(const c of Z){const{id:b}=c;switch(s.push(b),c.type){case"text":{const B=c.defaultValue||"";d.setValue(b,{value:B});break}case"checkbox":case"radiobutton":{const B=c.defaultValue===c.exportValues;d.setValue(b,{value:B});break}case"combobox":case"listbox":{const B=c.defaultValue||"";d.setValue(b,{value:B});break}default:continue}const m=document.querySelector(`[data-element-id="${b}"]`);if(m){if(!ng.has(m)){F(`_bindResetFormAction - element not allowed: ${b}`);continue}}else continue;m.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:s,name:"ResetForm"}}),!1}}}class cd extends gI{constructor(I){super(I,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const I=document.createElement("img");return I.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",I.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),I.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(I),this.container}}class eg extends gI{render(){return this.container}showElementAndHideCanvas(I){this.data.hasOwnCanvas&&(I.previousSibling?.nodeName==="CANVAS"&&(I.previousSibling.hidden=!0),I.hidden=!1)}_getKeyModifier(I){return BI.platform.isMac?I.metaKey:I.ctrlKey}_setEventListener(I,g,C,A,l){C.includes("mouse")?I.addEventListener(C,i=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:A,value:l(i),shift:i.shiftKey,modifier:this._getKeyModifier(i)}})}):I.addEventListener(C,i=>{if(C==="blur"){if(!g.focused||!i.relatedTarget)return;g.focused=!1}else if(C==="focus"){if(g.focused)return;g.focused=!0}l&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:A,value:l(i)}})})}_setEventListeners(I,g,C,A){for(const[l,i]of C)(i==="Action"||this.data.actions?.[i])&&((i==="Focus"||i==="Blur")&&(g||={focused:!1}),this._setEventListener(I,g,l,i,A),i==="Focus"&&!this.data.actions?.Blur?this._setEventListener(I,g,"blur","Blur",null):i==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(I,g,"focus","Focus",null))}_setBackgroundColor(I){const g=this.data.backgroundColor||null;I.style.backgroundColor=g===null?"transparent":u.makeHexColor(g[0],g[1],g[2])}_setTextStyle(I){const g=["left","center","right"],{fontColor:C}=this.data.defaultAppearanceData,A=this.data.defaultAppearanceData.fontSize||Zd,l=I.style;let i;const Z=2,d=s=>Math.round(10*s)/10;if(this.data.multiLine){const s=Math.abs(this.data.rect[3]-this.data.rect[1]-Z),c=Math.round(s/(lA*A))||1,b=s/c;i=Math.min(A,d(b/lA))}else{const s=Math.abs(this.data.rect[3]-this.data.rect[1]-Z);i=Math.min(A,d(s/lA))}l.fontSize=`calc(${i}px * var(--total-scale-factor))`,l.color=u.makeHexColor(C[0],C[1],C[2]),this.data.textAlignment!==null&&(l.textAlign=g[this.data.textAlignment])}_setRequired(I,g){g?I.setAttribute("required",!0):I.removeAttribute("required"),I.setAttribute("aria-required",g)}}class Gd extends eg{constructor(I){const g=I.renderForms||I.data.hasOwnCanvas||!I.data.hasAppearance&&!!I.data.fieldValue;super(I,{isRenderable:g})}setPropertyOnSiblings(I,g,C,A){const l=this.annotationStorage;for(const i of this._getElementsByName(I.name,I.id))i.domElement&&(i.domElement[g]=C),l.setValue(i.id,{[A]:C})}render(){const I=this.annotationStorage,g=this.data.id;this.container.classList.add("textWidgetAnnotation");let C=null;if(this.renderForms){const A=I.getValue(g,{value:this.data.fieldValue});let l=A.value||"";const i=I.getValue(g,{charLimit:this.data.maxLen}).charLimit;i&&l.length>i&&(l=l.slice(0,i));let Z=A.formattedValue||this.data.textContent?.join(`
`)||null;Z&&this.data.comb&&(Z=Z.replaceAll(/\s+/g,""));const d={userValue:l,formattedValue:Z,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(C=document.createElement("textarea"),C.textContent=Z??l,this.data.doNotScroll&&(C.style.overflowY="hidden")):(C=document.createElement("input"),C.type=this.data.password?"password":"text",C.setAttribute("value",Z??l),this.data.doNotScroll&&(C.style.overflowX="hidden")),this.data.hasOwnCanvas&&(C.hidden=!0),ng.add(C),this.contentElement=C,C.setAttribute("data-element-id",g),C.disabled=this.data.readOnly,C.name=this.data.fieldName,C.tabIndex=0;const{datetimeFormat:s,datetimeType:c,timeStep:b}=this.data,m=!!c&&this.enableScripting;s&&(C.title=s),this._setRequired(C,this.data.required),i&&(C.maxLength=i),C.addEventListener("input",W=>{I.setValue(g,{value:W.target.value}),this.setPropertyOnSiblings(C,"value",W.target.value,"value"),d.formattedValue=null}),C.addEventListener("resetform",W=>{const o=this.data.defaultFieldValue??"";C.value=d.userValue=o,d.formattedValue=null});let B=W=>{const{formattedValue:o}=d;o!=null&&(W.target.value=o),W.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){C.addEventListener("focus",o=>{if(d.focused)return;const{target:h}=o;if(m&&(h.type=c,b&&(h.step=b)),d.userValue){const w=d.userValue;if(m)if(c==="time"){const a=new Date(w),Y=[a.getHours(),a.getMinutes(),a.getSeconds()];h.value=Y.map(V=>V.toString().padStart(2,"0")).join(":")}else h.value=new Date(w-dd).toISOString().split(c==="date"?"T":".",1)[0];else h.value=w}d.lastCommittedValue=h.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),C.addEventListener("updatefromsandbox",o=>{this.showElementAndHideCanvas(o.target);const h={value(w){d.userValue=w.detail.value??"",m||I.setValue(g,{value:d.userValue.toString()}),w.target.value=d.userValue},formattedValue(w){const{formattedValue:a}=w.detail;d.formattedValue=a,a!=null&&w.target!==document.activeElement&&(w.target.value=a);const Y={formattedValue:a};m&&(Y.value=a),I.setValue(g,Y)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{const{charLimit:a}=w.detail,{target:Y}=w;if(a===0){Y.removeAttribute("maxLength");return}Y.setAttribute("maxLength",a);let V=d.userValue;!V||V.length<=a||(V=V.slice(0,a),Y.value=d.userValue=V,I.setValue(g,{value:V}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:V,willCommit:!0,commitKey:1,selStart:Y.selectionStart,selEnd:Y.selectionEnd}}))}};this._dispatchEventFromSandbox(h,o)}),C.addEventListener("keydown",o=>{d.commitKey=1;let h=-1;if(o.key==="Escape"?h=0:o.key==="Enter"&&!this.data.multiLine?h=2:o.key==="Tab"&&(d.commitKey=3),h===-1)return;const{value:w}=o.target;d.lastCommittedValue!==w&&(d.lastCommittedValue=w,d.userValue=w,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:w,willCommit:!0,commitKey:h,selStart:o.target.selectionStart,selEnd:o.target.selectionEnd}}))});const W=B;B=null,C.addEventListener("blur",o=>{if(!d.focused||!o.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:h}=o;let{value:w}=h;if(m){if(w&&c==="time"){const a=w.split(":").map(Y=>parseInt(Y,10));w=new Date(2e3,0,1,a[0],a[1],a[2]||0).valueOf(),h.step=""}else w.includes("T")||(w=`${w}T00:00`),w=new Date(w).valueOf();h.type="text"}d.userValue=w,d.lastCommittedValue!==w&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:w,willCommit:!0,commitKey:d.commitKey,selStart:o.target.selectionStart,selEnd:o.target.selectionEnd}}),W(o)}),this.data.actions?.Keystroke&&C.addEventListener("beforeinput",o=>{d.lastCommittedValue=null;const{data:h,target:w}=o,{value:a,selectionStart:Y,selectionEnd:V}=w;let n=Y,e=V;switch(o.inputType){case"deleteWordBackward":{const t=a.substring(0,Y).match(/\w*[^\w]*$/);t&&(n-=t[0].length);break}case"deleteWordForward":{const t=a.substring(Y).match(/^[^\w]*\w*/);t&&(e+=t[0].length);break}case"deleteContentBackward":Y===V&&(n-=1);break;case"deleteContentForward":Y===V&&(e+=1);break}o.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:a,change:h||"",willCommit:!1,selStart:n,selEnd:e}})}),this._setEventListeners(C,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.value)}if(B&&C.addEventListener("blur",B),this.data.comb){const o=(this.data.rect[2]-this.data.rect[0])/i;C.classList.add("comb"),C.style.letterSpacing=`calc(${o}px * var(--total-scale-factor) - 1ch)`}}else C=document.createElement("div"),C.textContent=this.data.fieldValue,C.style.verticalAlign="middle",C.style.display="table-cell",this.data.hasOwnCanvas&&(C.hidden=!0);return this._setTextStyle(C),this._setBackgroundColor(C),this._setDefaultPropertiesFromJS(C),this.container.append(C),this.container}}class bd extends eg{constructor(I){super(I,{isRenderable:!!I.data.hasOwnCanvas})}}class md extends eg{constructor(I){super(I,{isRenderable:I.renderForms})}render(){const I=this.annotationStorage,g=this.data,C=g.id;let A=I.getValue(C,{value:g.exportValue===g.fieldValue}).value;typeof A=="string"&&(A=A!=="Off",I.setValue(C,{value:A})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const l=document.createElement("input");return ng.add(l),l.setAttribute("data-element-id",C),l.disabled=g.readOnly,this._setRequired(l,this.data.required),l.type="checkbox",l.name=g.fieldName,A&&l.setAttribute("checked",!0),l.setAttribute("exportValue",g.exportValue),l.tabIndex=0,l.addEventListener("change",i=>{const{name:Z,checked:d}=i.target;for(const s of this._getElementsByName(Z,C)){const c=d&&s.exportValue===g.exportValue;s.domElement&&(s.domElement.checked=c),I.setValue(s.id,{value:c})}I.setValue(C,{value:d})}),l.addEventListener("resetform",i=>{const Z=g.defaultFieldValue||"Off";i.target.checked=Z===g.exportValue}),this.enableScripting&&this.hasJSActions&&(l.addEventListener("updatefromsandbox",i=>{const Z={value(d){d.target.checked=d.detail.value!=="Off",I.setValue(C,{value:d.target.checked})}};this._dispatchEventFromSandbox(Z,i)}),this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],i=>i.target.checked)),this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}class _l extends eg{constructor(I){super(I,{isRenderable:I.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const I=this.annotationStorage,g=this.data,C=g.id;let A=I.getValue(C,{value:g.fieldValue===g.buttonValue}).value;if(typeof A=="string"&&(A=A!==g.buttonValue,I.setValue(C,{value:A})),A)for(const i of this._getElementsByName(g.fieldName,C))I.setValue(i.id,{value:!1});const l=document.createElement("input");if(ng.add(l),l.setAttribute("data-element-id",C),l.disabled=g.readOnly,this._setRequired(l,this.data.required),l.type="radio",l.name=g.fieldName,A&&l.setAttribute("checked",!0),l.tabIndex=0,l.addEventListener("change",i=>{const{name:Z,checked:d}=i.target;for(const s of this._getElementsByName(Z,C))I.setValue(s.id,{value:!1});I.setValue(C,{value:d})}),l.addEventListener("resetform",i=>{const Z=g.defaultFieldValue;i.target.checked=Z!=null&&Z===g.buttonValue}),this.enableScripting&&this.hasJSActions){const i=g.buttonValue;l.addEventListener("updatefromsandbox",Z=>{const d={value:s=>{const c=i===s.detail.value;for(const b of this._getElementsByName(s.target.name)){const m=c&&b.id===C;b.domElement&&(b.domElement.checked=m),I.setValue(b.id,{value:m})}}};this._dispatchEventFromSandbox(d,Z)}),this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Z=>Z.target.checked)}return this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}class Bd extends DA{constructor(I){super(I,{ignoreBorder:I.data.hasAppearance})}render(){const I=super.render();I.classList.add("buttonWidgetAnnotation","pushButton");const g=I.lastChild;return this.enableScripting&&this.hasJSActions&&g&&(this._setDefaultPropertiesFromJS(g),g.addEventListener("updatefromsandbox",C=>{this._dispatchEventFromSandbox({},C)})),I}}class od extends eg{constructor(I){super(I,{isRenderable:I.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const I=this.annotationStorage,g=this.data.id,C=I.getValue(g,{value:this.data.fieldValue}),A=document.createElement("select");ng.add(A),A.setAttribute("data-element-id",g),A.disabled=this.data.readOnly,this._setRequired(A,this.data.required),A.name=this.data.fieldName,A.tabIndex=0;let l=this.data.combo&&this.data.options.length>0;this.data.combo||(A.size=this.data.options.length,this.data.multiSelect&&(A.multiple=!0)),A.addEventListener("resetform",c=>{const b=this.data.defaultFieldValue;for(const m of A.options)m.selected=m.value===b});for(const c of this.data.options){const b=document.createElement("option");b.textContent=c.displayValue,b.value=c.exportValue,C.value.includes(c.exportValue)&&(b.setAttribute("selected",!0),l=!1),A.append(b)}let i=null;if(l){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),A.prepend(c),i=()=>{c.remove(),A.removeEventListener("input",i),i=null},A.addEventListener("input",i)}const Z=c=>{const b=c?"value":"textContent",{options:m,multiple:B}=A;return B?Array.prototype.filter.call(m,W=>W.selected).map(W=>W[b]):m.selectedIndex===-1?null:m[m.selectedIndex][b]};let d=Z(!1);const s=c=>{const b=c.target.options;return Array.prototype.map.call(b,m=>({displayValue:m.textContent,exportValue:m.value}))};return this.enableScripting&&this.hasJSActions?(A.addEventListener("updatefromsandbox",c=>{const b={value(m){i?.();const B=m.detail.value,W=new Set(Array.isArray(B)?B:[B]);for(const o of A.options)o.selected=W.has(o.value);I.setValue(g,{value:Z(!0)}),d=Z(!1)},multipleSelection(m){A.multiple=!0},remove(m){const B=A.options,W=m.detail.remove;B[W].selected=!1,A.remove(W),B.length>0&&Array.prototype.findIndex.call(B,h=>h.selected)===-1&&(B[0].selected=!0),I.setValue(g,{value:Z(!0),items:s(m)}),d=Z(!1)},clear(m){for(;A.length!==0;)A.remove(0);I.setValue(g,{value:null,items:[]}),d=Z(!1)},insert(m){const{index:B,displayValue:W,exportValue:o}=m.detail.insert,h=A.children[B],w=document.createElement("option");w.textContent=W,w.value=o,h?h.before(w):A.append(w),I.setValue(g,{value:Z(!0),items:s(m)}),d=Z(!1)},items(m){const{items:B}=m.detail;for(;A.length!==0;)A.remove(0);for(const W of B){const{displayValue:o,exportValue:h}=W,w=document.createElement("option");w.textContent=o,w.value=h,A.append(w)}A.options.length>0&&(A.options[0].selected=!0),I.setValue(g,{value:Z(!0),items:s(m)}),d=Z(!1)},indices(m){const B=new Set(m.detail.indices);for(const W of m.target.options)W.selected=B.has(W.index);I.setValue(g,{value:Z(!0)}),d=Z(!1)},editable(m){m.target.disabled=!m.detail.editable}};this._dispatchEventFromSandbox(b,c)}),A.addEventListener("input",c=>{const b=Z(!0),m=Z(!1);I.setValue(g,{value:b}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:d,change:m,changeEx:b,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(A,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):A.addEventListener("input",function(c){I.setValue(g,{value:Z(!0)})}),this.data.combo&&this._setTextStyle(A),this._setBackgroundColor(A),this._setDefaultPropertiesFromJS(A),this.container.append(A),this.container}}class KA extends gI{constructor(I){const{data:g,elements:C,parent:A}=I,l=!!A._commentManager;if(super(I,{isRenderable:!l&&gI._hasPopupData(g)}),this.elements=C,l&&gI._hasPopupData(g)){const i=this.popup=this.#I();for(const Z of C)Z.popup=i}else this.popup=null}#I(){return new Wd({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:I}=this;I.classList.add("popupAnnotation"),I.role="comment";const g=this.popup=this.#I(),C=[];for(const A of this.elements)A.popup=g,A.container.ariaHasPopup="dialog",C.push(A.data.id),A.addHighlightArea();return this.container.setAttribute("aria-controls",C.map(A=>`${kg}${A}`).join(",")),this.container}}class Wd{#I=null;#g=this.#U.bind(this);#A=this.#L.bind(this);#C=this.#S.bind(this);#Z=this.#e.bind(this);#i=null;#l=null;#d=null;#c=null;#s=null;#m=null;#b=null;#B=!1;#w=null;#W=null;#G=null;#o=null;#h=null;#Y=null;#a=null;#X=null;#t=null;#n=null;#y=!1;#V=null;#N=null;constructor({container:I,color:g,elements:C,titleObj:A,modificationDate:l,contentsObj:i,richText:Z,parent:d,rect:s,parentRect:c,open:b,commentManager:m=null}){this.#l=I,this.#t=A,this.#d=i,this.#X=Z,this.#m=d,this.#i=g,this.#a=s,this.#b=c,this.#s=C,this.#I=m,this.#V=C[0],this.#c=mA.toDateObject(l),this.trigger=C.flatMap(B=>B.getElementsToTriggerPopup()),m||(this.#M(),this.#l.hidden=!0,b&&this.#e())}#M(){if(this.#W)return;this.#W=new AbortController;const{signal:I}=this.#W;for(const g of this.trigger)g.addEventListener("click",this.#Z,{signal:I}),g.addEventListener("pointerenter",this.#C,{signal:I}),g.addEventListener("pointerleave",this.#A,{signal:I}),g.classList.add("popupTriggerArea");for(const g of this.#s)g.container?.addEventListener("keydown",this.#g,{signal:I})}#u(){const I=this.#s.find(g=>g.hasCommentButton);I&&(this.#h=I._normalizePoint(I.commentButtonPosition))}renderCommentButton(){if(this.#o){this.#o.parentNode||this.#V.container.after(this.#o);return}if(this.#h||this.#u(),!this.#h)return;const{signal:I}=this.#W=new AbortController,g=this.#V.hasOwnCommentButton,C=()=>{this.#I.toggleCommentPopup(this,!0,void 0,!g)},A=()=>{this.#I.toggleCommentPopup(this,!1,!0,!g)},l=()=>{this.#I.toggleCommentPopup(this,!1,!1)};if(g){this.#o=this.#V.container;for(const i of this.trigger)i.ariaHasPopup="dialog",i.ariaControls="commentPopup",i.addEventListener("keydown",this.#g,{signal:I}),i.addEventListener("click",C,{signal:I}),i.addEventListener("pointerenter",A,{signal:I}),i.addEventListener("pointerleave",l,{signal:I}),i.classList.add("popupTriggerArea")}else{const i=this.#o=document.createElement("button");i.className="annotationCommentButton";const Z=this.#V.container;i.style.zIndex=Z.style.zIndex+1,i.tabIndex=0,i.ariaHasPopup="dialog",i.ariaControls="commentPopup",i.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#z(),this.#H(),i.addEventListener("keydown",this.#g,{signal:I}),i.addEventListener("click",C,{signal:I}),i.addEventListener("pointerenter",A,{signal:I}),i.addEventListener("pointerleave",l,{signal:I}),Z.after(i)}}#H(){if(this.#V.extraPopupElement&&!this.#V.editor)return;this.#o||this.renderCommentButton();const[I,g]=this.#h,{style:C}=this.#o;C.left=`calc(${I}%)`,C.top=`calc(${g}% - var(--comment-button-dim))`}#z(){this.#V.extraPopupElement||(this.#o||this.renderCommentButton(),this.#o.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:I,opacity:g}=this.#V.commentData;return I?this.#m._commentManager.makeCommentColor(I,g):null}focusCommentButton(){setTimeout(()=>{this.#o?.focus()},0)}getData(){const{richText:I,color:g,opacity:C,creationDate:A,modificationDate:l}=this.#V.commentData;return{contentsObj:{str:this.comment},richText:I,color:g,opacity:C,creationDate:A,modificationDate:l}}get elementBeforePopup(){return this.#o}get comment(){return this.#N||=this.#V.commentText,this.#N}set comment(I){I!==this.comment&&(this.#V.commentText=this.#N=I)}focus(){this.#V.container?.focus()}get parentBoundingClientRect(){return this.#V.layer.getBoundingClientRect()}setCommentButtonStates({selected:I,hasPopup:g}){this.#o&&(this.#o.classList.toggle("selected",I),this.#o.ariaExpanded=g)}setSelectedCommentButton(I){this.#o.classList.toggle("selected",I)}get commentPopupPosition(){if(this.#Y)return this.#Y;const{x:I,y:g,height:C}=this.#o.getBoundingClientRect(),{x:A,y:l,width:i,height:Z}=this.#V.layer.getBoundingClientRect();return[(I-A)/i,(g+C-l)/Z]}set commentPopupPosition(I){this.#Y=I}hasDefaultPopupPosition(){return this.#Y===null}get commentButtonPosition(){return this.#h}get commentButtonWidth(){return this.#o.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(I){const[g,C]=this.#Y||this.commentButtonPosition.map(s=>s/100),A=this.parentBoundingClientRect,{x:l,y:i,width:Z,height:d}=A;this.#I.showDialog(null,this,l+g*Z,i+C*d,{...I,parentDimensions:A})}render(){if(this.#w)return;const I=this.#w=document.createElement("div");if(I.className="popup",this.#i){const C=I.style.outlineColor=u.makeHexColor(...this.#i);I.style.backgroundColor=`color-mix(in srgb, ${C} 30%, white)`}const g=document.createElement("span");if(g.className="header",this.#t?.str){const C=document.createElement("span");C.className="title",g.append(C),{dir:C.dir,str:C.textContent}=this.#t}if(I.append(g),this.#c){const C=document.createElement("time");C.className="popupDate",C.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),C.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),C.dateTime=this.#c.toISOString(),g.append(C)}Bl({html:this.#K||this.#d.str,dir:this.#d?.dir,className:"popupContent"},I),this.#l.append(I)}get#K(){const I=this.#X,g=this.#d;return I?.str&&(!g?.str||g.str===I.str)&&this.#X.html||null}get#p(){return this.#K?.attributes?.style?.fontSize||0}get#k(){return this.#K?.attributes?.style?.color||null}#F(I){const g=[],C={str:I,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:g}]}},A={style:{color:this.#k,fontSize:this.#p?`calc(${this.#p}px * var(--total-scale-factor))`:""}};for(const l of I.split(`
`))g.push({name:"span",value:l,attributes:A});return C}#U(I){I.altKey||I.shiftKey||I.ctrlKey||I.metaKey||(I.key==="Enter"||I.key==="Escape"&&this.#B)&&this.#e()}updateEdited({rect:I,popup:g,deleted:C}){if(this.#I){C?(this.remove(),this.#N=null):g&&(g.deleted?this.remove():(this.#z(),this.#N=g.text)),I&&(this.#h=null,this.#u(),this.#H());return}if(C||g?.deleted){this.remove();return}this.#M(),this.#n||={contentsObj:this.#d,richText:this.#X},I&&(this.#G=null),g&&g.text&&(this.#X=this.#F(g.text),this.#c=mA.toDateObject(g.date),this.#d=null),this.#w?.remove(),this.#w=null}resetEdited(){this.#n&&({contentsObj:this.#d,richText:this.#X}=this.#n,this.#n=null,this.#w?.remove(),this.#w=null,this.#G=null)}remove(){if(this.#W?.abort(),this.#W=null,this.#w?.remove(),this.#w=null,this.#y=!1,this.#B=!1,this.#o?.remove(),this.#o=null,this.trigger)for(const I of this.trigger)I.classList.remove("popupTriggerArea")}#R(){if(this.#G!==null)return;const{page:{view:I},viewport:{rawDims:{pageWidth:g,pageHeight:C,pageX:A,pageY:l}}}=this.#m;let i=!!this.#b,Z=i?this.#b:this.#a;for(const W of this.#s)if(!Z||u.intersect(W.data.rect,Z)!==null){Z=W.data.rect,i=!0;break}const d=u.normalizeRect([Z[0],I[3]-Z[1]+I[1],Z[2],I[3]-Z[3]+I[1]]),c=i?Z[2]-Z[0]+5:0,b=d[0]+c,m=d[1];this.#G=[100*(b-A)/g,100*(m-l)/C];const{style:B}=this.#l;B.left=`${this.#G[0]}%`,B.top=`${this.#G[1]}%`}#e(){if(this.#I){this.#I.toggleCommentPopup(this,!1);return}this.#B=!this.#B,this.#B?(this.#S(),this.#l.addEventListener("click",this.#Z),this.#l.addEventListener("keydown",this.#g)):(this.#L(),this.#l.removeEventListener("click",this.#Z),this.#l.removeEventListener("keydown",this.#g))}#S(){this.#w||this.render(),this.isVisible?this.#B&&this.#l.classList.add("focused"):(this.#R(),this.#l.hidden=!1,this.#l.style.zIndex=parseInt(this.#l.style.zIndex)+1e3)}#L(){this.#l.classList.remove("focused"),!(this.#B||!this.isVisible)&&(this.#l.hidden=!0,this.#l.style.zIndex=parseInt(this.#l.style.zIndex)-1e3)}forceHide(){this.#y=this.isVisible,this.#y&&(this.#l.hidden=!0)}maybeShow(){this.#I||(this.#M(),this.#y&&(this.#w||this.#S(),this.#y=!1,this.#l.hidden=!1))}get isVisible(){return this.#I?!1:this.#l.hidden===!1}}class ql extends gI{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.textContent=I.data.textContent,this.textPosition=I.data.textPosition,this.annotationEditorType=z.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const I=this.contentElement=document.createElement("div");I.classList.add("annotationTextContent"),I.setAttribute("role","comment");for(const g of this.textContent){const C=document.createElement("span");C.textContent=g,I.append(C)}this.container.append(I)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class wd extends gI{#I=null;constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:I,width:g,height:C}=this,A=this.svgFactory.create(g,C,!0),l=this.#I=this.svgFactory.createElement("svg:line");return l.setAttribute("x1",I.rect[2]-I.lineCoordinates[0]),l.setAttribute("y1",I.rect[3]-I.lineCoordinates[1]),l.setAttribute("x2",I.rect[2]-I.lineCoordinates[2]),l.setAttribute("y2",I.rect[3]-I.lineCoordinates[3]),l.setAttribute("stroke-width",I.borderStyle.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),A.append(l),this.container.append(A),!I.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class hd extends gI{#I=null;constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:I,width:g,height:C}=this,A=this.svgFactory.create(g,C,!0),l=I.borderStyle.width,i=this.#I=this.svgFactory.createElement("svg:rect");return i.setAttribute("x",l/2),i.setAttribute("y",l/2),i.setAttribute("width",g-l),i.setAttribute("height",C-l),i.setAttribute("stroke-width",l||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),A.append(i),this.container.append(A),!I.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class ad extends gI{#I=null;constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:I,width:g,height:C}=this,A=this.svgFactory.create(g,C,!0),l=I.borderStyle.width,i=this.#I=this.svgFactory.createElement("svg:ellipse");return i.setAttribute("cx",g/2),i.setAttribute("cy",C/2),i.setAttribute("rx",g/2-l/2),i.setAttribute("ry",C/2-l/2),i.setAttribute("stroke-width",l||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),A.append(i),this.container.append(A),!I.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class $l extends gI{#I=null;constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:I,vertices:g,borderStyle:C,popupRef:A},width:l,height:i}=this;if(!g)return this.container;const Z=this.svgFactory.create(l,i,!0);let d=[];for(let c=0,b=g.length;c<b;c+=2){const m=g[c]-I[0],B=I[3]-g[c+1];d.push(`${m},${B}`)}d=d.join(" ");const s=this.#I=this.svgFactory.createElement(this.svgElementName);return s.setAttribute("points",d),s.setAttribute("stroke-width",C.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),Z.append(s),this.container.append(Z),!A&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class Yd extends $l{constructor(I){super(I),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Vd extends gI{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class SA extends gI{#I=null;#g=[];constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?z.HIGHLIGHT:z.INK}#A(I,g){switch(I){case 90:return{transform:`rotate(90) translate(${-g[0]},${g[1]}) scale(1,-1)`,width:g[3]-g[1],height:g[2]-g[0]};case 180:return{transform:`rotate(180) translate(${-g[2]},${g[1]}) scale(1,-1)`,width:g[2]-g[0],height:g[3]-g[1]};case 270:return{transform:`rotate(270) translate(${-g[2]},${g[3]}) scale(1,-1)`,width:g[3]-g[1],height:g[2]-g[0]};default:return{transform:`translate(${-g[0]},${g[3]}) scale(1,-1)`,width:g[2]-g[0],height:g[3]-g[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:I,rotation:g,inkLists:C,borderStyle:A,popupRef:l}}=this,{transform:i,width:Z,height:d}=this.#A(g,I),s=this.svgFactory.create(Z,d,!0),c=this.#I=this.svgFactory.createElement("svg:g");s.append(c),c.setAttribute("stroke-width",A.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",i);for(let b=0,m=C.length;b<m;b++){const B=this.svgFactory.createElement(this.svgElementName);this.#g.push(B),B.setAttribute("points",C[b].join(",")),c.append(B)}return!l&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(s),this._editOnDoubleClick(),this.container}updateEdited(I){super.updateEdited(I);const{thickness:g,points:C,rect:A}=I,l=this.#I;if(g>=0&&l.setAttribute("stroke-width",g||1),C)for(let i=0,Z=this.#g.length;i<Z;i++)this.#g[i].setAttribute("points",C[i].join(","));if(A){const{transform:i,width:Z,height:d}=this.#A(this.data.rotation,A);l.parentElement.setAttribute("viewBox",`0 0 ${Z} ${d}`),l.setAttribute("transform",i)}}getElementsToTriggerPopup(){return this.#g}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ii extends gI{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=z.HIGHLIGHT}render(){const{data:{overlaidText:I,popupRef:g}}=this;if(!g&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),I){const C=document.createElement("mark");C.classList.add("overlaidText"),C.textContent=I,this.container.append(C)}return this.container}}class nd extends gI{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:I,popupRef:g}}=this;if(!g&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),I){const C=document.createElement("u");C.classList.add("overlaidText"),C.textContent=I,this.container.append(C)}return this.container}}class ed extends gI{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:I,popupRef:g}}=this;if(!g&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),I){const C=document.createElement("u");C.classList.add("overlaidText"),C.textContent=I,this.container.append(C)}return this.container}}class td extends gI{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:I,popupRef:g}}=this;if(!g&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),I){const C=document.createElement("s");C.classList.add("overlaidText"),C.textContent=I,this.container.append(C)}return this.container}}class gi extends gI{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=z.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Nd extends gI{#I=null;constructor(I){super(I,{isRenderable:!0});const{file:g}=this.data;this.filename=g.filename,this.content=g.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...g})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:I,data:g}=this;let C;g.hasAppearance||g.fillAlpha===0?C=document.createElement("div"):(C=document.createElement("img"),C.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(g.name)?"paperclip":"pushpin"}.svg`,g.fillAlpha&&g.fillAlpha<1&&(C.style=`filter: opacity(${Math.round(g.fillAlpha*100)}%);`)),C.addEventListener("dblclick",this.#g.bind(this)),this.#I=C;const{isMac:A}=BI.platform;return I.addEventListener("keydown",l=>{l.key==="Enter"&&(A?l.metaKey:l.ctrlKey)&&this.#g()}),!g.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):C.classList.add("popupTriggerArea"),I.append(C),I}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}#g(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class pA{#I=null;#g=null;#A=null;#C=new Map;#Z=null;#i=null;#l=[];#d=!1;constructor({div:I,accessibilityManager:g,annotationCanvasMap:C,annotationEditorUIManager:A,page:l,viewport:i,structTreeLayer:Z,commentManager:d,linkService:s,annotationStorage:c}){this.div=I,this.#I=g,this.#g=C,this.#Z=Z||null,this.#i=s||null,this.#A=c||new aA,this.page=l,this.viewport=i,this.zIndex=0,this._annotationEditorUIManager=A,this._commentManager=d||null}hasEditableAnnotations(){return this.#C.size>0}async render(I){const{annotations:g}=I,C=this.div;Vg(C,this.viewport);const A=new Map,l=[],i={data:null,layer:C,linkService:this.#i,downloadManager:I.downloadManager,imageResourcesPath:I.imageResourcesPath||"",renderForms:I.renderForms!==!1,svgFactory:new QC,annotationStorage:this.#A,enableComment:I.enableComment===!0,enableScripting:I.enableScripting===!0,hasJSActions:I.hasJSActions,fieldObjects:I.fieldObjects,parent:this,elements:null};for(const Z of g){if(Z.noHTML)continue;const d=Z.annotationType===ZI.POPUP;if(d){const b=A.get(Z.id);if(!b)continue;if(!this._commentManager){l.push(Z);continue}i.elements=b}else if(Z.rect[2]===Z.rect[0]||Z.rect[3]===Z.rect[1])continue;i.data=Z;const s=MA.create(i);if(!s.isRenderable)continue;if(!d&&(this.#l.push(s),Z.popupRef)){const b=A.get(Z.popupRef);b?b.push(s):A.set(Z.popupRef,[s])}const c=s.render();Z.hidden&&(c.style.visibility="hidden"),s._isEditable&&(this.#C.set(s.data.id,s),this._annotationEditorUIManager?.renderAnnotationElement(s))}await this.#c();for(const Z of l){const d=i.elements=A.get(Z.id);i.data=Z;const s=MA.create(i);if(!s.isRenderable)continue;const c=s.render();s.contentElement.id=`${kg}${Z.id}`,Z.hidden&&(c.style.visibility="hidden"),d.at(-1).container.after(c)}this.#s()}async#c(){if(this.#l.length===0)return;this.div.replaceChildren();const I=[];if(!this.#d){this.#d=!0;for(const{contentElement:C,data:{id:A}}of this.#l){const l=C.id=`${kg}${A}`;I.push(this.#Z?.getAriaAttributes(l).then(i=>{if(i)for(const[Z,d]of i)C.setAttribute(Z,d)}))}}this.#l.sort(({data:{rect:[C,A,l,i]}},{data:{rect:[Z,d,s,c]}})=>{if(C===l&&A===i)return 1;if(Z===s&&d===c)return-1;const b=i,m=A,B=(A+i)/2,W=c,o=d,h=(d+c)/2;if(B>=W&&h<=m)return-1;if(h>=b&&B<=o)return 1;const w=(C+l)/2,a=(Z+s)/2;return w-a});const g=document.createDocumentFragment();for(const C of this.#l)g.append(C.container),this._commentManager?(C.extraPopupElement?.popup||C.popup)?.renderCommentButton():C.extraPopupElement&&g.append(C.extraPopupElement.render());if(this.div.append(g),await Promise.all(I),this.#I)for(const C of this.#l)this.#I.addPointerInTextLayer(C.contentElement,!1)}async addLinkAnnotations(I){const g={data:null,layer:this.div,linkService:this.#i,svgFactory:new QC,parent:this};for(const C of I){C.borderStyle||=pA._defaultBorderStyle,g.data=C;const A=MA.create(g);A.isRenderable&&(A.render(),A.contentElement.id=`${kg}${C.id}`,this.#l.push(A))}await this.#c()}update({viewport:I}){const g=this.div;this.viewport=I,Vg(g,{rotation:I.rotation}),this.#s(),g.hidden=!1}#s(){if(!this.#g)return;const I=this.div;for(const[g,C]of this.#g){const A=I.querySelector(`[data-annotation-id="${g}"]`);if(!A)continue;C.className="annotationContent";const{firstChild:l}=A;l?l.nodeName==="CANVAS"?l.replaceWith(C):l.classList.contains("annotationContent")?l.after(C):l.before(C):A.append(C);const i=this.#C.get(g);i&&(i._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(g,A.id,C),i._hasNoCanvas=!1):i.canvas=C)}this.#g.clear()}getEditableAnnotations(){return Array.from(this.#C.values())}getEditableAnnotation(I){return this.#C.get(I)}addFakeAnnotation(I){const{div:g}=this,{id:C,rotation:A}=I,l=new sd({data:{id:C,rect:I.getPDFRect(),rotation:A},editor:I,layer:g,parent:this,enableComment:!!this._commentManager,linkService:this.#i,annotationStorage:this.#A});return l.render(),l.contentElement.id=`${kg}${C}`,l.createOrUpdatePopup(),this.#l.push(l),l}removeAnnotation(I){const g=this.#l.findIndex(A=>A.data.id===I);if(g<0)return;const[C]=this.#l.splice(g,1);this.#I?.removePointerInTextLayer(C.contentElement)}updateFakeAnnotations(I){if(I.length!==0){for(const g of I)g.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(I=!1){this.div.classList.toggle("disabled",!I)}static get _defaultBorderStyle(){return J(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:zg.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const rC=/\r\n?|\n/g;class wI extends K{#I="";#g=`${this.id}-editor`;#A=null;#C;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const I=wI.prototype,g=l=>l.isEmpty(),C=lg.TRANSLATE_SMALL,A=lg.TRANSLATE_BIG;return J(this,"_keyboardManager",new bC([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],I.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],I.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],I._translateEmpty,{args:[-C,0],checker:g}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],I._translateEmpty,{args:[-A,0],checker:g}],[["ArrowRight","mac+ArrowRight"],I._translateEmpty,{args:[C,0],checker:g}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],I._translateEmpty,{args:[A,0],checker:g}],[["ArrowUp","mac+ArrowUp"],I._translateEmpty,{args:[0,-C],checker:g}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],I._translateEmpty,{args:[0,-A],checker:g}],[["ArrowDown","mac+ArrowDown"],I._translateEmpty,{args:[0,C],checker:g}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],I._translateEmpty,{args:[0,A],checker:g}]]))}static _type="freetext";static _editorType=z.FREETEXT;constructor(I){super({...I,name:"freeTextEditor"}),this.color=I.color||wI._defaultColor||K._defaultLineColor,this.#C=I.fontSize||wI._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(I,g){K.initialize(I,g);const C=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(C.getPropertyValue("--freetext-padding"))}static updateDefaultParams(I,g){switch(I){case L.FREETEXT_SIZE:wI._defaultFontSize=g;break;case L.FREETEXT_COLOR:wI._defaultColor=g;break}}updateParams(I,g){switch(I){case L.FREETEXT_SIZE:this.#Z(g);break;case L.FREETEXT_COLOR:this.#i(g);break}}static get defaultPropertiesToUpdate(){return[[L.FREETEXT_SIZE,wI._defaultFontSize],[L.FREETEXT_COLOR,wI._defaultColor||K._defaultLineColor]]}get propertiesToUpdate(){return[[L.FREETEXT_SIZE,this.#C],[L.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new hC(this),[["colorPicker",this._colorPicker]]}get colorType(){return L.FREETEXT_COLOR}#Z(I){const g=A=>{this.editorDiv.style.fontSize=`calc(${A}px * var(--total-scale-factor))`,this.translate(0,-(A-this.#C)*this.parentScale),this.#C=A,this.#d()},C=this.#C;this.addCommands({cmd:g.bind(this,I),undo:g.bind(this,C),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:L.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#i(I){const g=A=>{this.color=A,this.onUpdatedColor()},C=this.color;this.addCommands({cmd:g.bind(this,I),undo:g.bind(this,C),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:L.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(I,g){this._uiManager.translateSelectedEditors(I,g,!0)}getInitialTranslation(){const I=this.parentScale;return[-wI._internalPadding*I,-(wI._internalPadding+this.#C)*I]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#A=new AbortController;const I=this._uiManager.combinedSignal(this.#A);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:I}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:I}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:I}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:I}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:I}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#g),this._isDraggable=!0,this.#A?.abort(),this.#A=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(I){this._focusEventsAllowed&&(super.focusin(I),I.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(I){this.width||(this.enableEditMode(),I&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#l(){const I=[];this.editorDiv.normalize();let g=null;for(const C of this.editorDiv.childNodes)g?.nodeType===Node.TEXT_NODE&&C.nodeName==="BR"||(I.push(wI.#c(C)),g=C);return I.join(`
`)}#d(){const[I,g]=this.parentDimensions;let C;if(this.isAttachedToDOM)C=this.div.getBoundingClientRect();else{const{currentLayer:A,div:l}=this,i=l.style.display,Z=l.classList.contains("hidden");l.classList.remove("hidden"),l.style.display="hidden",A.div.append(this.div),C=l.getBoundingClientRect(),l.remove(),l.style.display=i,l.classList.toggle("hidden",Z)}this.rotation%180===this.parentRotation%180?(this.width=C.width/I,this.height=C.height/g):(this.width=C.height/I,this.height=C.width/g),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const I=this.#I,g=this.#I=this.#l().trimEnd();if(I===g)return;const C=A=>{if(this.#I=A,!A){this.remove();return}this.#s(),this._uiManager.rebuild(this),this.#d()};this.addCommands({cmd:()=>{C(g)},undo:()=>{C(I)},mustExec:!1}),this.#d()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(I){I.target===this.div&&I.key==="Enter"&&(this.enterInEditMode(),I.preventDefault())}editorDivKeydown(I){wI._keyboardManager.exec(this,I)}editorDivFocus(I){this.isEditing=!0}editorDivBlur(I){this.isEditing=!1}editorDivInput(I){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let I,g;(this._isCopy||this.annotationElementId)&&(I=this.x,g=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#g),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:C}=this.editorDiv;if(C.fontSize=`calc(${this.#C}px * var(--total-scale-factor))`,C.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[A,l]=this.parentDimensions;if(this.annotationElementId){const{position:i}=this._initialData;let[Z,d]=this.getInitialTranslation();[Z,d]=this.pageTranslationToScreen(Z,d);const[s,c]=this.pageDimensions,[b,m]=this.pageTranslation;let B,W;switch(this.rotation){case 0:B=I+(i[0]-b)/s,W=g+this.height-(i[1]-m)/c;break;case 90:B=I+(i[0]-b)/s,W=g-(i[1]-m)/c,[Z,d]=[d,-Z];break;case 180:B=I-this.width+(i[0]-b)/s,W=g-(i[1]-m)/c,[Z,d]=[-Z,-d];break;case 270:B=I+(i[0]-b-this.height*c)/s,W=g+(i[1]-m-this.width*s)/c,[Z,d]=[-d,Z];break}this.setAt(B*A,W*l,Z,d)}else this._moveAfterPaste(I,g);this.#s(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(I){return(I.nodeType===Node.TEXT_NODE?I.nodeValue:I.innerText).replaceAll(rC,"")}editorDivPaste(I){const g=I.clipboardData||window.clipboardData,{types:C}=g;if(C.length===1&&C[0]==="text/plain")return;I.preventDefault();const A=wI.#b(g.getData("text")||"").replaceAll(rC,`
`);if(!A)return;const l=window.getSelection();if(!l.rangeCount)return;this.editorDiv.normalize(),l.deleteFromDocument();const i=l.getRangeAt(0);if(!A.includes(`
`)){i.insertNode(document.createTextNode(A)),this.editorDiv.normalize(),l.collapseToStart();return}const{startContainer:Z,startOffset:d}=i,s=[],c=[];if(Z.nodeType===Node.TEXT_NODE){const B=Z.parentElement;if(c.push(Z.nodeValue.slice(d).replaceAll(rC,"")),B!==this.editorDiv){let W=s;for(const o of this.editorDiv.childNodes){if(o===B){W=c;continue}W.push(wI.#c(o))}}s.push(Z.nodeValue.slice(0,d).replaceAll(rC,""))}else if(Z===this.editorDiv){let B=s,W=0;for(const o of this.editorDiv.childNodes)W++===d&&(B=c),B.push(wI.#c(o))}this.#I=`${s.join(`
`)}${A}${c.join(`
`)}`,this.#s();const b=new Range;let m=Math.sumPrecise(s.map(B=>B.length));for(const{firstChild:B}of this.editorDiv.childNodes)if(B.nodeType===Node.TEXT_NODE){const W=B.nodeValue.length;if(m<=W){b.setStart(B,m),b.setEnd(B,m);break}m-=W}l.removeAllRanges(),l.addRange(b)}#s(){if(this.editorDiv.replaceChildren(),!!this.#I)for(const I of this.#I.split(`
`)){const g=document.createElement("div");g.append(I?document.createTextNode(I):document.createElement("br")),this.editorDiv.append(g)}}#m(){return this.#I.replaceAll(" "," ")}static#b(I){return I.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}getPDFRect(){const I=wI._internalPadding*this.parentScale;return this.getRect(I,I)}static async deserialize(I,g,C){let A=null;if(I instanceof ql){const{data:{defaultAppearanceData:{fontSize:i,fontColor:Z},rect:d,rotation:s,id:c,popupRef:b,richText:m,contentsObj:B,creationDate:W,modificationDate:o},textContent:h,textPosition:w,parent:{page:{pageNumber:a}}}=I;if(!h||h.length===0)return null;A=I={annotationType:z.FREETEXT,color:Array.from(Z),fontSize:i,value:h.join(`
`),position:w,pageIndex:a-1,rect:d.slice(0),rotation:s,annotationElementId:c,id:c,deleted:!1,popupRef:b,comment:B?.str||null,richText:m,creationDate:W,modificationDate:o}}const l=await super.deserialize(I,g,C);return l.#C=I.fontSize,l.color=u.makeHexColor(...I.color),l.#I=wI.#b(I.value),l._initialData=A,I.comment&&l.setCommentData(I),l}serialize(I=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const g=K._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),C=Object.assign(super.serialize(I),{color:g,fontSize:this.#C,value:this.#m()});return this.addComment(C),I?(C.isCopy=!0,C):this.annotationElementId&&!this.#B(C)?null:(C.id=this.annotationElementId,C)}#B(I){const{value:g,fontSize:C,color:A,pageIndex:l}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||I.value!==g||I.fontSize!==C||I.color.some((i,Z)=>i!==A[Z])||I.pageIndex!==l}renderAnnotationElement(I){const g=super.renderAnnotationElement(I);if(!g)return null;const{style:C}=g;C.fontSize=`calc(${this.#C}px * var(--total-scale-factor))`,C.color=this.color,g.replaceChildren();for(const A of this.#I.split(`
`)){const l=document.createElement("div");l.append(A?document.createTextNode(A):document.createElement("br")),g.append(l)}return I.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#I}}),g}resetAnnotationElement(I){super.resetAnnotationElement(I),I.resetEdited()}}class M{static PRECISION=1e-4;toSVGPath(){E("Abstract method `toSVGPath` must be implemented.")}get box(){E("Abstract getter `box` must be implemented.")}serialize(I,g){E("Abstract method `serialize` must be implemented.")}static _rescale(I,g,C,A,l,i){i||=new Float32Array(I.length);for(let Z=0,d=I.length;Z<d;Z+=2)i[Z]=g+I[Z]*A,i[Z+1]=C+I[Z+1]*l;return i}static _rescaleAndSwap(I,g,C,A,l,i){i||=new Float32Array(I.length);for(let Z=0,d=I.length;Z<d;Z+=2)i[Z]=g+I[Z+1]*A,i[Z+1]=C+I[Z]*l;return i}static _translate(I,g,C,A){A||=new Float32Array(I.length);for(let l=0,i=I.length;l<i;l+=2)A[l]=g+I[l],A[l+1]=C+I[l+1];return A}static svgRound(I){return Math.round(I*1e4)}static _normalizePoint(I,g,C,A,l){switch(l){case 90:return[1-g/C,I/A];case 180:return[1-I/C,1-g/A];case 270:return[g/C,1-I/A];default:return[I/C,g/A]}}static _normalizePagePoint(I,g,C){switch(C){case 90:return[1-g,I];case 180:return[1-I,1-g];case 270:return[g,1-I];default:return[I,g]}}static createBezierPoints(I,g,C,A,l,i){return[(I+5*C)/6,(g+5*A)/6,(5*C+l)/6,(5*A+i)/6,(C+l)/2,(A+i)/2]}}class tg{#I;#g=[];#A;#C;#Z=[];#i=new Float32Array(18);#l;#d;#c;#s;#m;#b;#B=[];static#w=8;static#W=2;static#G=tg.#w+tg.#W;constructor({x:I,y:g},C,A,l,i,Z=0){this.#I=C,this.#b=l*A,this.#C=i,this.#i.set([NaN,NaN,NaN,NaN,I,g],6),this.#A=Z,this.#s=tg.#w*A,this.#c=tg.#G*A,this.#m=A,this.#B.push(I,g)}isEmpty(){return isNaN(this.#i[8])}#o(){const I=this.#i.subarray(4,6),g=this.#i.subarray(16,18),[C,A,l,i]=this.#I;return[(this.#l+(I[0]-g[0])/2-C)/l,(this.#d+(I[1]-g[1])/2-A)/i,(this.#l+(g[0]-I[0])/2-C)/l,(this.#d+(g[1]-I[1])/2-A)/i]}add({x:I,y:g}){this.#l=I,this.#d=g;const[C,A,l,i]=this.#I;let[Z,d,s,c]=this.#i.subarray(8,12);const b=I-s,m=g-c,B=Math.hypot(b,m);if(B<this.#c)return!1;const W=B-this.#s,o=W/B,h=o*b,w=o*m;let a=Z,Y=d;Z=s,d=c,s+=h,c+=w,this.#B?.push(I,g);const V=-w/W,n=h/W,e=V*this.#b,t=n*this.#b;return this.#i.set(this.#i.subarray(2,8),0),this.#i.set([s+e,c+t],4),this.#i.set(this.#i.subarray(14,18),12),this.#i.set([s-e,c-t],16),isNaN(this.#i[6])?(this.#Z.length===0&&(this.#i.set([Z+e,d+t],2),this.#Z.push(NaN,NaN,NaN,NaN,(Z+e-C)/l,(d+t-A)/i),this.#i.set([Z-e,d-t],14),this.#g.push(NaN,NaN,NaN,NaN,(Z-e-C)/l,(d-t-A)/i)),this.#i.set([a,Y,Z,d,s,c],6),!this.isEmpty()):(this.#i.set([a,Y,Z,d,s,c],6),Math.abs(Math.atan2(Y-d,a-Z)-Math.atan2(w,h))<Math.PI/2?([Z,d,s,c]=this.#i.subarray(2,6),this.#Z.push(NaN,NaN,NaN,NaN,((Z+s)/2-C)/l,((d+c)/2-A)/i),[Z,d,a,Y]=this.#i.subarray(14,18),this.#g.push(NaN,NaN,NaN,NaN,((a+Z)/2-C)/l,((Y+d)/2-A)/i),!0):([a,Y,Z,d,s,c]=this.#i.subarray(0,6),this.#Z.push(((a+5*Z)/6-C)/l,((Y+5*d)/6-A)/i,((5*Z+s)/6-C)/l,((5*d+c)/6-A)/i,((Z+s)/2-C)/l,((d+c)/2-A)/i),[s,c,Z,d,a,Y]=this.#i.subarray(12,18),this.#g.push(((a+5*Z)/6-C)/l,((Y+5*d)/6-A)/i,((5*Z+s)/6-C)/l,((5*d+c)/6-A)/i,((Z+s)/2-C)/l,((d+c)/2-A)/i),!0))}toSVGPath(){if(this.isEmpty())return"";const I=this.#Z,g=this.#g;if(isNaN(this.#i[6])&&!this.isEmpty())return this.#h();const C=[];C.push(`M${I[4]} ${I[5]}`);for(let A=6;A<I.length;A+=6)isNaN(I[A])?C.push(`L${I[A+4]} ${I[A+5]}`):C.push(`C${I[A]} ${I[A+1]} ${I[A+2]} ${I[A+3]} ${I[A+4]} ${I[A+5]}`);this.#a(C);for(let A=g.length-6;A>=6;A-=6)isNaN(g[A])?C.push(`L${g[A+4]} ${g[A+5]}`):C.push(`C${g[A]} ${g[A+1]} ${g[A+2]} ${g[A+3]} ${g[A+4]} ${g[A+5]}`);return this.#Y(C),C.join(" ")}#h(){const[I,g,C,A]=this.#I,[l,i,Z,d]=this.#o();return`M${(this.#i[2]-I)/C} ${(this.#i[3]-g)/A} L${(this.#i[4]-I)/C} ${(this.#i[5]-g)/A} L${l} ${i} L${Z} ${d} L${(this.#i[16]-I)/C} ${(this.#i[17]-g)/A} L${(this.#i[14]-I)/C} ${(this.#i[15]-g)/A} Z`}#Y(I){const g=this.#g;I.push(`L${g[4]} ${g[5]} Z`)}#a(I){const[g,C,A,l]=this.#I,i=this.#i.subarray(4,6),Z=this.#i.subarray(16,18),[d,s,c,b]=this.#o();I.push(`L${(i[0]-g)/A} ${(i[1]-C)/l} L${d} ${s} L${c} ${b} L${(Z[0]-g)/A} ${(Z[1]-C)/l}`)}newFreeDrawOutline(I,g,C,A,l,i){return new Ci(I,g,C,A,l,i)}getOutlines(){const I=this.#Z,g=this.#g,C=this.#i,[A,l,i,Z]=this.#I,d=new Float32Array((this.#B?.length??0)+2);for(let b=0,m=d.length-2;b<m;b+=2)d[b]=(this.#B[b]-A)/i,d[b+1]=(this.#B[b+1]-l)/Z;if(d[d.length-2]=(this.#l-A)/i,d[d.length-1]=(this.#d-l)/Z,isNaN(C[6])&&!this.isEmpty())return this.#X(d);const s=new Float32Array(this.#Z.length+24+this.#g.length);let c=I.length;for(let b=0;b<c;b+=2){if(isNaN(I[b])){s[b]=s[b+1]=NaN;continue}s[b]=I[b],s[b+1]=I[b+1]}c=this.#n(s,c);for(let b=g.length-6;b>=6;b-=6)for(let m=0;m<6;m+=2){if(isNaN(g[b+m])){s[c]=s[c+1]=NaN,c+=2;continue}s[c]=g[b+m],s[c+1]=g[b+m+1],c+=2}return this.#t(s,c),this.newFreeDrawOutline(s,d,this.#I,this.#m,this.#A,this.#C)}#X(I){const g=this.#i,[C,A,l,i]=this.#I,[Z,d,s,c]=this.#o(),b=new Float32Array(36);return b.set([NaN,NaN,NaN,NaN,(g[2]-C)/l,(g[3]-A)/i,NaN,NaN,NaN,NaN,(g[4]-C)/l,(g[5]-A)/i,NaN,NaN,NaN,NaN,Z,d,NaN,NaN,NaN,NaN,s,c,NaN,NaN,NaN,NaN,(g[16]-C)/l,(g[17]-A)/i,NaN,NaN,NaN,NaN,(g[14]-C)/l,(g[15]-A)/i],0),this.newFreeDrawOutline(b,I,this.#I,this.#m,this.#A,this.#C)}#t(I,g){const C=this.#g;return I.set([NaN,NaN,NaN,NaN,C[4],C[5]],g),g+=6}#n(I,g){const C=this.#i.subarray(4,6),A=this.#i.subarray(16,18),[l,i,Z,d]=this.#I,[s,c,b,m]=this.#o();return I.set([NaN,NaN,NaN,NaN,(C[0]-l)/Z,(C[1]-i)/d,NaN,NaN,NaN,NaN,s,c,NaN,NaN,NaN,NaN,b,m,NaN,NaN,NaN,NaN,(A[0]-l)/Z,(A[1]-i)/d],g),g+=24}}class Ci extends M{#I;#g=new Float32Array(4);#A;#C;#Z;#i;#l;constructor(I,g,C,A,l,i){super(),this.#l=I,this.#Z=g,this.#I=C,this.#i=A,this.#A=l,this.#C=i,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#d(i);const[Z,d,s,c]=this.#g;for(let b=0,m=I.length;b<m;b+=2)I[b]=(I[b]-Z)/s,I[b+1]=(I[b+1]-d)/c;for(let b=0,m=g.length;b<m;b+=2)g[b]=(g[b]-Z)/s,g[b+1]=(g[b+1]-d)/c}toSVGPath(){const I=[`M${this.#l[4]} ${this.#l[5]}`];for(let g=6,C=this.#l.length;g<C;g+=6){if(isNaN(this.#l[g])){I.push(`L${this.#l[g+4]} ${this.#l[g+5]}`);continue}I.push(`C${this.#l[g]} ${this.#l[g+1]} ${this.#l[g+2]} ${this.#l[g+3]} ${this.#l[g+4]} ${this.#l[g+5]}`)}return I.push("Z"),I.join(" ")}serialize([I,g,C,A],l){const i=C-I,Z=A-g;let d,s;switch(l){case 0:d=M._rescale(this.#l,I,A,i,-Z),s=M._rescale(this.#Z,I,A,i,-Z);break;case 90:d=M._rescaleAndSwap(this.#l,I,g,i,Z),s=M._rescaleAndSwap(this.#Z,I,g,i,Z);break;case 180:d=M._rescale(this.#l,C,g,-i,Z),s=M._rescale(this.#Z,C,g,-i,Z);break;case 270:d=M._rescaleAndSwap(this.#l,C,A,-i,-Z),s=M._rescaleAndSwap(this.#Z,C,A,-i,-Z);break}return{outline:Array.from(d),points:[Array.from(s)]}}#d(I){const g=this.#l;let C=g[4],A=g[5];const l=[C,A,C,A];let i=C,Z=A,d=C,s=A;const c=I?Math.max:Math.min,b=new Float32Array(4);for(let B=6,W=g.length;B<W;B+=6){const o=g[B+4],h=g[B+5];isNaN(g[B])?(u.pointBoundingBox(o,h,l),Z>h?(i=o,Z=h):Z===h&&(i=c(i,o)),s<h?(d=o,s=h):s===h&&(d=c(d,o))):(b[0]=b[1]=1/0,b[2]=b[3]=-1/0,u.bezierBoundingBox(C,A,...g.slice(B,B+6),b),u.rectBoundingBox(b[0],b[1],b[2],b[3],l),Z>b[1]?(i=b[0],Z=b[1]):Z===b[1]&&(i=c(i,b[0])),s<b[3]?(d=b[2],s=b[3]):s===b[3]&&(d=c(d,b[2]))),C=o,A=h}const m=this.#g;m[0]=l[0]-this.#A,m[1]=l[1]-this.#A,m[2]=l[2]-l[0]+2*this.#A,m[3]=l[3]-l[1]+2*this.#A,this.firstPoint=[i,Z],this.lastPoint=[d,s]}get box(){return this.#g}newOutliner(I,g,C,A,l,i=0){return new tg(I,g,C,A,l,i)}getNewOutline(I,g){const[C,A,l,i]=this.#g,[Z,d,s,c]=this.#I,b=l*s,m=i*c,B=C*s+Z,W=A*c+d,o=this.newOutliner({x:this.#Z[0]*b+B,y:this.#Z[1]*m+W},this.#I,this.#i,I,this.#C,g??this.#A);for(let h=2;h<this.#Z.length;h+=2)o.add({x:this.#Z[h]*b+B,y:this.#Z[h+1]*m+W});return o.getOutlines()}}class FA{#I;#g;#A;#C=[];#Z=[];constructor(I,g=0,C=0,A=!0){const l=[1/0,1/0,-1/0,-1/0],i=10**-4;for(const{x:o,y:h,width:w,height:a}of I){const Y=Math.floor((o-g)/i)*i,V=Math.ceil((o+w+g)/i)*i,n=Math.floor((h-g)/i)*i,e=Math.ceil((h+a+g)/i)*i,t=[Y,n,e,!0],N=[V,n,e,!1];this.#C.push(t,N),u.rectBoundingBox(Y,n,V,e,l)}const Z=l[2]-l[0]+2*C,d=l[3]-l[1]+2*C,s=l[0]-C,c=l[1]-C;let b=A?-1/0:1/0,m=1/0;const B=this.#C.at(A?-1:-2),W=[B[0],B[2]];for(const o of this.#C){const[h,w,a,Y]=o;!Y&&A?w<m?(m=w,b=h):w===m&&(b=Math.max(b,h)):Y&&!A&&(w<m?(m=w,b=h):w===m&&(b=Math.min(b,h))),o[0]=(h-s)/Z,o[1]=(w-c)/d,o[2]=(a-c)/d}this.#I=new Float32Array([s,c,Z,d]),this.#g=[b,m],this.#A=W}getOutlines(){this.#C.sort((g,C)=>g[0]-C[0]||g[1]-C[1]||g[2]-C[2]);const I=[];for(const g of this.#C)g[3]?(I.push(...this.#s(g)),this.#d(g)):(this.#c(g),I.push(...this.#s(g)));return this.#i(I)}#i(I){const g=[],C=new Set;for(const i of I){const[Z,d,s]=i;g.push([Z,d,i],[Z,s,i])}g.sort((i,Z)=>i[1]-Z[1]||i[0]-Z[0]);for(let i=0,Z=g.length;i<Z;i+=2){const d=g[i][2],s=g[i+1][2];d.push(s),s.push(d),C.add(d),C.add(s)}const A=[];let l;for(;C.size>0;){const i=C.values().next().value;let[Z,d,s,c,b]=i;C.delete(i);let m=Z,B=d;for(l=[Z,s],A.push(l);;){let W;if(C.has(c))W=c;else if(C.has(b))W=b;else break;C.delete(W),[Z,d,s,c,b]=W,m!==Z&&(l.push(m,B,Z,B===d?d:s),m=Z),B=B===d?s:d}l.push(m,B)}return new Xd(A,this.#I,this.#g,this.#A)}#l(I){const g=this.#Z;let C=0,A=g.length-1;for(;C<=A;){const l=C+A>>1,i=g[l][0];if(i===I)return l;i<I?C=l+1:A=l-1}return A+1}#d([,I,g]){const C=this.#l(I);this.#Z.splice(C,0,[I,g])}#c([,I,g]){const C=this.#l(I);for(let A=C;A<this.#Z.length;A++){const[l,i]=this.#Z[A];if(l!==I)break;if(l===I&&i===g){this.#Z.splice(A,1);return}}for(let A=C-1;A>=0;A--){const[l,i]=this.#Z[A];if(l!==I)break;if(l===I&&i===g){this.#Z.splice(A,1);return}}}#s(I){const[g,C,A]=I,l=[[g,C,A]],i=this.#l(A);for(let Z=0;Z<i;Z++){const[d,s]=this.#Z[Z];for(let c=0,b=l.length;c<b;c++){const[,m,B]=l[c];if(!(s<=m||B<=d)){if(m>=d){if(B>s)l[c][1]=s;else{if(b===1)return[];l.splice(c,1),c--,b--}continue}l[c][2]=d,B>s&&l.push([g,s,B])}}}return l}}class Xd extends M{#I;#g;constructor(I,g,C,A){super(),this.#g=I,this.#I=g,this.firstPoint=C,this.lastPoint=A}toSVGPath(){const I=[];for(const g of this.#g){let[C,A]=g;I.push(`M${C} ${A}`);for(let l=2;l<g.length;l+=2){const i=g[l],Z=g[l+1];i===C?(I.push(`V${Z}`),A=Z):Z===A&&(I.push(`H${i}`),C=i)}I.push("Z")}return I.join(" ")}serialize([I,g,C,A],l){const i=[],Z=C-I,d=A-g;for(const s of this.#g){const c=new Array(s.length);for(let b=0;b<s.length;b+=2)c[b]=I+s[b]*Z,c[b+1]=A-s[b+1]*d;i.push(c)}return i}get box(){return this.#I}get classNamesForOutlining(){return["highlightOutline"]}}class JA extends tg{newFreeDrawOutline(I,g,C,A,l,i){return new Rd(I,g,C,A,l,i)}}class Rd extends Ci{newOutliner(I,g,C,A,l,i=0){return new JA(I,g,C,A,l,i)}}class lI extends K{#I=null;#g=0;#A;#C=null;#Z=null;#i=null;#l=null;#d=0;#c=null;#s=null;#m=null;#b=!1;#B=null;#w=null;#W=null;#G="";#o;#h="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=z.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const I=lI.prototype;return J(this,"_keyboardManager",new bC([[["ArrowLeft","mac+ArrowLeft"],I._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],I._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],I._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],I._moveCaret,{args:[3]}]]))}constructor(I){super({...I,name:"highlightEditor"}),this.color=I.color||lI._defaultColor,this.#o=I.thickness||lI._defaultThickness,this.opacity=I.opacity||lI._defaultOpacity,this.#A=I.boxes||null,this.#h=I.methodOfCreation||"",this.#G=I.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",I.highlightId>-1?(this.#b=!0,this.#a(I),this.#V()):this.#A&&(this.#I=I.anchorNode,this.#g=I.anchorOffset,this.#l=I.focusNode,this.#d=I.focusOffset,this.#Y(),this.#V(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#b?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#o,methodOfCreation:this.#h}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(I){return{numberOfColors:I.get("color").size}}#Y(){const I=new FA(this.#A,.001);this.#s=I.getOutlines(),[this.x,this.y,this.width,this.height]=this.#s.box;const g=new FA(this.#A,.0025,.001,this._uiManager.direction==="ltr");this.#i=g.getOutlines();const{firstPoint:C}=this.#s;this.#B=[(C[0]-this.x)/this.width,(C[1]-this.y)/this.height];const{lastPoint:A}=this.#i;this.#w=[(A[0]-this.x)/this.width,(A[1]-this.y)/this.height]}#a({highlightOutlines:I,highlightId:g,clipPathId:C}){this.#s=I;const A=1.5;if(this.#i=I.getNewOutline(this.#o/2+A,.0025),g>=0)this.#m=g,this.#C=C,this.parent.drawLayer.finalizeDraw(g,{bbox:I.box,path:{d:I.toSVGPath()}}),this.#W=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},!0);else if(this.parent){const b=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#m,{bbox:lI.#N(this.#s.box,(b-this.rotation+360)%360),path:{d:I.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#W,{bbox:lI.#N(this.#i.box,b),path:{d:this.#i.toSVGPath()}})}const[l,i,Z,d]=I.box;switch(this.rotation){case 0:this.x=l,this.y=i,this.width=Z,this.height=d;break;case 90:{const[b,m]=this.parentDimensions;this.x=i,this.y=1-l,this.width=Z*m/b,this.height=d*b/m;break}case 180:this.x=1-l,this.y=1-i,this.width=Z,this.height=d;break;case 270:{const[b,m]=this.parentDimensions;this.x=1-i,this.y=l,this.width=Z*m/b,this.height=d*b/m;break}}const{firstPoint:s}=I;this.#B=[(s[0]-l)/Z,(s[1]-i)/d];const{lastPoint:c}=this.#i;this.#w=[(c[0]-l)/Z,(c[1]-i)/d]}static initialize(I,g){K.initialize(I,g),lI._defaultColor||=g.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(I,g){switch(I){case L.HIGHLIGHT_COLOR:lI._defaultColor=g;break;case L.HIGHLIGHT_THICKNESS:lI._defaultThickness=g;break}}translateInPage(I,g){}get toolbarPosition(){return this.#w}get commentButtonPosition(){return this.#B}updateParams(I,g){switch(I){case L.HIGHLIGHT_COLOR:this.#X(g);break;case L.HIGHLIGHT_THICKNESS:this.#t(g);break}}static get defaultPropertiesToUpdate(){return[[L.HIGHLIGHT_COLOR,lI._defaultColor],[L.HIGHLIGHT_THICKNESS,lI._defaultThickness]]}get propertiesToUpdate(){return[[L.HIGHLIGHT_COLOR,this.color||lI._defaultColor],[L.HIGHLIGHT_THICKNESS,this.#o||lI._defaultThickness],[L.HIGHLIGHT_FREE,this.#b]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#m,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#Z?.updateColor(this.color),super.onUpdatedColor()}#X(I){const g=(l,i)=>{this.color=l,this.opacity=i,this.onUpdatedColor()},C=this.color,A=this.opacity;this.addCommands({cmd:g.bind(this,I,lI._defaultOpacity),undo:g.bind(this,C,A),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:L.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(I)},!0)}#t(I){const g=this.#o,C=A=>{this.#o=A,this.#n(A)};this.addCommands({cmd:C.bind(this,I),undo:C.bind(this,g),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:L.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:I},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#Z=new zI({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#H())}getBaseTranslation(){return[0,0]}getRect(I,g){return super.getRect(I,g,this.#H())}onceAdded(I){this.annotationElementId||this.parent.addUndoableEditor(this),I&&this.div.focus()}remove(){this.#y(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#V(),this.isAttachedToDOM||this.parent.add(this)))}setParent(I){let g=!1;this.parent&&!I?this.#y():I&&(this.#V(I),g=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(I),this.show(this._isVisible),g&&this.select()}#n(I){this.#b&&(this.#a({highlightOutlines:this.#s.getNewOutline(I/2)}),this.fixAndSetPosition(),this.setDims())}#y(){this.#m===null||!this.parent||(this.parent.drawLayer.remove(this.#m),this.#m=null,this.parent.drawLayer.remove(this.#W),this.#W=null)}#V(I=this.parent){this.#m===null&&({id:this.#m,clipPathId:this.#C}=I.drawLayer.draw({bbox:this.#s.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#b},path:{d:this.#s.toSVGPath()}},!1,!0),this.#W=I.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#b},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},this.#b),this.#c&&(this.#c.style.clipPath=this.#C))}static#N([I,g,C,A],l){switch(l){case 90:return[1-g-A,I,A,C];case 180:return[1-I-C,1-g-A,C,A];case 270:return[g,1-I-C,A,C]}return[I,g,C,A]}rotate(I){const{drawLayer:g}=this.parent;let C;this.#b?(I=(I-this.rotation+360)%360,C=lI.#N(this.#s.box,I)):C=lI.#N([this.x,this.y,this.width,this.height],I),g.updateProperties(this.#m,{bbox:C,root:{"data-main-rotation":I}}),g.updateProperties(this.#W,{bbox:lI.#N(this.#i.box,I),root:{"data-main-rotation":I}})}render(){if(this.div)return this.div;const I=super.render();this.#G&&(I.setAttribute("aria-label",this.#G),I.setAttribute("role","mark")),this.#b?I.classList.add("free"):this.div.addEventListener("keydown",this.#M.bind(this),{signal:this._uiManager._signal});const g=this.#c=document.createElement("div");return I.append(g),g.setAttribute("aria-hidden","true"),g.className="internal",g.style.clipPath=this.#C,this.setDims(),Wl(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),I}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#W,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#W,{rootClass:{hovered:!1}})}#M(I){lI._keyboardManager.exec(this,I)}_moveCaret(I){switch(this.parent.unselect(this),I){case 0:case 2:this.#u(!0);break;case 1:case 3:this.#u(!1);break}}#u(I){if(!this.#I)return;const g=window.getSelection();I?g.setPosition(this.#I,this.#g):g.setPosition(this.#l,this.#d)}select(){super.select(),this.#W&&this.parent?.drawLayer.updateProperties(this.#W,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#W&&(this.parent?.drawLayer.updateProperties(this.#W,{rootClass:{selected:!1}}),this.#b||this.#u(!1))}get _mustFixPosition(){return!this.#b}show(I=this._isVisible){super.show(I),this.parent&&(this.parent.drawLayer.updateProperties(this.#m,{rootClass:{hidden:!I}}),this.parent.drawLayer.updateProperties(this.#W,{rootClass:{hidden:!I}}))}#H(){return this.#b?this.rotation:0}#z(){if(this.#b)return null;const[I,g]=this.pageDimensions,[C,A]=this.pageTranslation,l=this.#A,i=new Float32Array(l.length*8);let Z=0;for(const{x:d,y:s,width:c,height:b}of l){const m=d*I+C,B=(1-s)*g+A;i[Z]=i[Z+4]=m,i[Z+1]=i[Z+3]=B,i[Z+2]=i[Z+6]=m+c*I,i[Z+5]=i[Z+7]=B-b*g,Z+=8}return i}#K(I){return this.#s.serialize(I,this.#H())}static startHighlighting(I,g,{target:C,x:A,y:l}){const{x:i,y:Z,width:d,height:s}=C.getBoundingClientRect(),c=new AbortController,b=I.combinedSignal(c),m=B=>{c.abort(),this.#k(I,B)};window.addEventListener("blur",m,{signal:b}),window.addEventListener("pointerup",m,{signal:b}),window.addEventListener("pointerdown",CI,{capture:!0,passive:!1,signal:b}),window.addEventListener("contextmenu",pI,{signal:b}),C.addEventListener("pointermove",this.#p.bind(this,I),{signal:b}),this._freeHighlight=new JA({x:A,y:l},[i,Z,d,s],I.scale,this._defaultThickness/2,g,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=I.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#p(I,g){this._freeHighlight.add(g)&&I.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#k(I,g){this._freeHighlight.isEmpty()?I.drawLayer.remove(this._freeHighlightId):I.createAndAddNewEditor(g,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(I,g,C){let A=null;if(I instanceof Ii){const{data:{quadPoints:W,rect:o,rotation:h,id:w,color:a,opacity:Y,popupRef:V,richText:n,contentsObj:e,creationDate:t,modificationDate:N},parent:{page:{pageNumber:R}}}=I;A=I={annotationType:z.HIGHLIGHT,color:Array.from(a),opacity:Y,quadPoints:W,boxes:null,pageIndex:R-1,rect:o.slice(0),rotation:h,annotationElementId:w,id:w,deleted:!1,popupRef:V,richText:n,comment:e?.str||null,creationDate:t,modificationDate:N}}else if(I instanceof SA){const{data:{inkLists:W,rect:o,rotation:h,id:w,color:a,borderStyle:{rawWidth:Y},popupRef:V,richText:n,contentsObj:e,creationDate:t,modificationDate:N},parent:{page:{pageNumber:R}}}=I;A=I={annotationType:z.HIGHLIGHT,color:Array.from(a),thickness:Y,inkLists:W,boxes:null,pageIndex:R-1,rect:o.slice(0),rotation:h,annotationElementId:w,id:w,deleted:!1,popupRef:V,richText:n,comment:e?.str||null,creationDate:t,modificationDate:N}}const{color:l,quadPoints:i,inkLists:Z,opacity:d}=I,s=await super.deserialize(I,g,C);s.color=u.makeHexColor(...l),s.opacity=d||1,Z&&(s.#o=I.thickness),s._initialData=A,I.comment&&s.setCommentData(I);const[c,b]=s.pageDimensions,[m,B]=s.pageTranslation;if(i){const W=s.#A=[];for(let o=0;o<i.length;o+=8)W.push({x:(i[o]-m)/c,y:1-(i[o+1]-B)/b,width:(i[o+2]-i[o])/c,height:(i[o+1]-i[o+5])/b});s.#Y(),s.#V(),s.rotate(s.rotation)}else if(Z){s.#b=!0;const W=Z[0],o={x:W[0]-m,y:b-(W[1]-B)},h=new JA(o,[0,0,c,b],1,s.#o/2,!0,.001);for(let Y=0,V=W.length;Y<V;Y+=2)o.x=W[Y]-m,o.y=b-(W[Y+1]-B),h.add(o);const{id:w,clipPathId:a}=g.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:s.color,"fill-opacity":s._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:h.toSVGPath()}},!0,!0);s.#a({highlightOutlines:h.getOutlines(),highlightId:w,clipPathId:a}),s.#V(),s.rotate(s.parentRotation)}return s}serialize(I=!1){if(this.isEmpty()||I)return null;if(this.deleted)return this.serializeDeleted();const g=K._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),C=super.serialize(I);return Object.assign(C,{color:g,opacity:this.opacity,thickness:this.#o,quadPoints:this.#z(),outlines:this.#K(C.rect)}),this.addComment(C),this.annotationElementId&&!this.#F(C)?null:(C.id=this.annotationElementId,C)}#F(I){const{color:g}=this._initialData;return this.hasEditedComment||I.color.some((C,A)=>C!==g[A])}renderAnnotationElement(I){return this.deleted?(I.hide(),null):(I.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class Ai{#I=Object.create(null);updateProperty(I,g){this[I]=g,this.updateSVGProperty(I,g)}updateProperties(I){if(I)for(const[g,C]of Object.entries(I))g.startsWith("_")||this.updateProperty(g,C)}updateSVGProperty(I,g){this.#I[I]=g}toSVGProperties(){const I=this.#I;return this.#I=Object.create(null),{root:I}}reset(){this.#I=Object.create(null)}updateAll(I=this){this.updateProperties(I)}clone(){E("Not implemented")}}class r extends K{#I=null;#g;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#A=null;static#C=null;static#Z=null;static _INNER_MARGIN=3;constructor(I){super(I),this.#g=I.mustBeCommitted||!1,this._addOutlines(I)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(I){I.drawOutlines&&(this.#i(I),this.#c())}#i({drawOutlines:I,drawId:g,drawingOptions:C}){this.#I=I,this._drawingOptions||=C,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),g>=0?(this._drawId=g,this.parent.drawLayer.finalizeDraw(g,I.defaultProperties)):this._drawId=this.#l(I,this.parent),this.#b(I.box)}#l(I,g){const{id:C}=g.drawLayer.draw(r._mergeSVGProperties(this._drawingOptions.toSVGProperties(),I.defaultSVGProperties),!1,!1);return C}static _mergeSVGProperties(I,g){const C=new Set(Object.keys(I));for(const[A,l]of Object.entries(g))C.has(A)?Object.assign(I[A],l):I[A]=l;return I}static getDefaultDrawingOptions(I){E("Not implemented")}static get typesMap(){E("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(I,g){const C=this.typesMap.get(I);C&&this._defaultDrawingOptions.updateProperty(C,g),this._currentParent&&(r.#A.updateProperty(C,g),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(I,g){const C=this.constructor.typesMap.get(I);C&&this._updateProperty(I,C,g)}static get defaultPropertiesToUpdate(){const I=[],g=this._defaultDrawingOptions;for(const[C,A]of this.typesMap)I.push([C,g[A]]);return I}get propertiesToUpdate(){const I=[],{_drawingOptions:g}=this;for(const[C,A]of this.constructor.typesMap)I.push([C,g[A]]);return I}_updateProperty(I,g,C){const A=this._drawingOptions,l=A[g],i=Z=>{A.updateProperty(g,Z);const d=this.#I.updateProperty(g,Z);d&&this.#b(d),this.parent?.drawLayer.updateProperties(this._drawId,A.toSVGProperties()),I===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:i.bind(this,C),undo:i.bind(this,l),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:I,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,r._mergeSVGProperties(this.#I.getPathResizingSVGProperties(this.#m()),{bbox:this.#B()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,r._mergeSVGProperties(this.#I.getPathResizedSVGProperties(this.#m()),{bbox:this.#B()}))}_onTranslating(I,g){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#B()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,r._mergeSVGProperties(this.#I.getPathTranslatedSVGProperties(this.#m(),this.parentDimensions),{bbox:this.#B()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(I){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#g&&(this.#g=!1,this.commit(),this.parent.setSelected(this),I&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#b(this.#I.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(I){let g=!1;this.parent&&!I?(this._uiManager.removeShouldRescale(this),this.#d()):I&&(this._uiManager.addShouldRescale(this),this.#c(I),g=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(I),g&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(I=this.parent){if(!(this._drawId!==null&&this.parent===I)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,I.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#l(this.#I,I)}}#s([I,g,C,A]){const{parentDimensions:[l,i],rotation:Z}=this;switch(Z){case 90:return[g,1-I,C*(i/l),A*(l/i)];case 180:return[1-I,1-g,C,A];case 270:return[1-g,I,C*(i/l),A*(l/i)];default:return[I,g,C,A]}}#m(){const{x:I,y:g,width:C,height:A,parentDimensions:[l,i],rotation:Z}=this;switch(Z){case 90:return[1-g,I,C*(l/i),A*(i/l)];case 180:return[1-I,1-g,C,A];case 270:return[g,1-I,C*(l/i),A*(i/l)];default:return[I,g,C,A]}}#b(I){[this.x,this.y,this.width,this.height]=this.#s(I),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#B(){const{x:I,y:g,width:C,height:A,rotation:l,parentRotation:i,parentDimensions:[Z,d]}=this;switch((l*4+i)/90){case 1:return[1-g-A,I,A,C];case 2:return[1-I-C,1-g-A,C,A];case 3:return[g,1-I-C,A,C];case 4:return[I,g-C*(Z/d),A*(d/Z),C*(Z/d)];case 5:return[1-g,I,C*(Z/d),A*(d/Z)];case 6:return[1-I-A*(d/Z),1-g,A*(d/Z),C*(Z/d)];case 7:return[g-C*(Z/d),1-I-A*(d/Z),C*(Z/d),A*(d/Z)];case 8:return[I-C,g-A,C,A];case 9:return[1-g,I-C,A,C];case 10:return[1-I,1-g,C,A];case 11:return[g-A,1-I,A,C];case 12:return[I-A*(d/Z),g,A*(d/Z),C*(Z/d)];case 13:return[1-g-C*(Z/d),I-A*(d/Z),C*(Z/d),A*(d/Z)];case 14:return[1-I,1-g-C*(Z/d),A*(d/Z),C*(Z/d)];case 15:return[g,1-I,C*(Z/d),A*(d/Z)];default:return[I,g,C,A]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,r._mergeSVGProperties({bbox:this.#B()},this.#I.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#b(this.#I.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let I,g;this._isCopy&&(I=this.x,g=this.y);const C=super.render();C.classList.add("draw");const A=document.createElement("div");return C.append(A),A.setAttribute("aria-hidden","true"),A.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(I,g),C}static createDrawerInstance(I,g,C,A,l){E("Not implemented")}static startDrawing(I,g,C,A){const{target:l,offsetX:i,offsetY:Z,pointerId:d,pointerType:s}=A;if(Q.isInitializedAndDifferentPointerType(s))return;const{viewport:{rotation:c}}=I,{width:b,height:m}=l.getBoundingClientRect(),B=r.#C=new AbortController,W=I.combinedSignal(B);if(Q.setPointer(s,d),window.addEventListener("pointerup",o=>{Q.isSamePointerIdOrRemove(o.pointerId)&&this._endDraw(o)},{signal:W}),window.addEventListener("pointercancel",o=>{Q.isSamePointerIdOrRemove(o.pointerId)&&this._currentParent.endDrawingSession()},{signal:W}),window.addEventListener("pointerdown",o=>{Q.isSamePointerType(o.pointerType)&&(Q.initializeAndAddPointerId(o.pointerId),r.#A.isCancellable()&&(r.#A.removeLastElement(),r.#A.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:W}),window.addEventListener("contextmenu",pI,{signal:W}),l.addEventListener("pointermove",this._drawMove.bind(this),{signal:W}),l.addEventListener("touchmove",o=>{Q.isSameTimeStamp(o.timeStamp)&&CI(o)},{signal:W}),I.toggleDrawing(),g._editorUndoBar?.hide(),r.#A){I.drawLayer.updateProperties(this._currentDrawId,r.#A.startNew(i,Z,b,m,c));return}g.updateUIForDefaultProperties(this),r.#A=this.createDrawerInstance(i,Z,b,m,c),r.#Z=this.getDefaultDrawingOptions(),this._currentParent=I,{id:this._currentDrawId}=I.drawLayer.draw(this._mergeSVGProperties(r.#Z.toSVGProperties(),r.#A.defaultSVGProperties),!0,!1)}static _drawMove(I){if(Q.isSameTimeStamp(I.timeStamp),!r.#A)return;const{offsetX:g,offsetY:C,pointerId:A}=I;if(Q.isSamePointerId(A)){if(Q.isUsingMultiplePointers()){this._endDraw(I);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,r.#A.add(g,C)),Q.setTimeStamp(I.timeStamp),CI(I)}}static _cleanup(I){I&&(this._currentDrawId=-1,this._currentParent=null,r.#A=null,r.#Z=null,Q.clearTimeStamp()),r.#C&&(r.#C.abort(),r.#C=null,Q.clearPointerIds())}static _endDraw(I){const g=this._currentParent;if(g){if(g.toggleDrawing(!0),this._cleanup(!1),I?.target===g.div&&g.drawLayer.updateProperties(this._currentDrawId,r.#A.end(I.offsetX,I.offsetY)),this.supportMultipleDrawings){const C=r.#A,A=this._currentDrawId,l=C.getLastElement();g.addCommands({cmd:()=>{g.drawLayer.updateProperties(A,C.setLastElement(l))},undo:()=>{g.drawLayer.updateProperties(A,C.removeLastElement())},mustExec:!1,type:L.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(I){const g=this._currentParent;if(!g)return null;if(g.toggleDrawing(!0),g.cleanUndoStack(L.DRAW_STEP),!r.#A.isEmpty()){const{pageDimensions:[C,A],scale:l}=g,i=g.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:r.#A.getOutlines(C*l,A*l,l,this._INNER_MARGIN),drawingOptions:r.#Z,mustBeCommitted:!I});return this._cleanup(!0),i}return g.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(I){}static deserializeDraw(I,g,C,A,l,i){E("Not implemented")}static async deserialize(I,g,C){const{rawDims:{pageWidth:A,pageHeight:l,pageX:i,pageY:Z}}=g.viewport,d=this.deserializeDraw(i,Z,A,l,this._INNER_MARGIN,I),s=await super.deserialize(I,g,C);return s.createDrawingOptions(I),s.#i({drawOutlines:d}),s.#c(),s.onScaleChanging(),s.rotate(),s}serializeDraw(I){const[g,C]=this.pageTranslation,[A,l]=this.pageDimensions;return this.#I.serialize([g,C,A,l],I)}renderAnnotationElement(I){return I.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class yd{#I=new Float64Array(6);#g;#A;#C;#Z;#i;#l="";#d=0;#c=new YC;#s;#m;constructor(I,g,C,A,l,i){this.#s=C,this.#m=A,this.#C=l,this.#Z=i,[I,g]=this.#b(I,g);const Z=this.#g=[NaN,NaN,NaN,NaN,I,g];this.#i=[I,g],this.#A=[{line:Z,points:this.#i}],this.#I.set(Z,0)}updateProperty(I,g){I==="stroke-width"&&(this.#Z=g)}#b(I,g){return M._normalizePoint(I,g,this.#s,this.#m,this.#C)}isEmpty(){return!this.#A||this.#A.length===0}isCancellable(){return this.#i.length<=10}add(I,g){[I,g]=this.#b(I,g);const[C,A,l,i]=this.#I.subarray(2,6),Z=I-l,d=g-i;return Math.hypot(this.#s*Z,this.#m*d)<=2?null:(this.#i.push(I,g),isNaN(C)?(this.#I.set([l,i,I,g],2),this.#g.push(NaN,NaN,NaN,NaN,I,g),{path:{d:this.toSVGPath()}}):(isNaN(this.#I[0])&&this.#g.splice(6,6),this.#I.set([C,A,l,i,I,g],0),this.#g.push(...M.createBezierPoints(C,A,l,i,I,g)),{path:{d:this.toSVGPath()}}))}end(I,g){const C=this.add(I,g);return C||(this.#i.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(I,g,C,A,l){this.#s=C,this.#m=A,this.#C=l,[I,g]=this.#b(I,g);const i=this.#g=[NaN,NaN,NaN,NaN,I,g];this.#i=[I,g];const Z=this.#A.at(-1);return Z&&(Z.line=new Float32Array(Z.line),Z.points=new Float32Array(Z.points)),this.#A.push({line:i,points:this.#i}),this.#I.set(i,0),this.#d=0,this.toSVGPath(),null}getLastElement(){return this.#A.at(-1)}setLastElement(I){return this.#A?(this.#A.push(I),this.#g=I.line,this.#i=I.points,this.#d=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(I)}removeLastElement(){if(!this.#A)return this.#c.removeLastElement();this.#A.pop(),this.#l="";for(let I=0,g=this.#A.length;I<g;I++){const{line:C,points:A}=this.#A[I];this.#g=C,this.#i=A,this.#d=0,this.toSVGPath()}return{path:{d:this.#l}}}toSVGPath(){const I=M.svgRound(this.#g[4]),g=M.svgRound(this.#g[5]);if(this.#i.length===2)return this.#l=`${this.#l} M ${I} ${g} Z`,this.#l;if(this.#i.length<=6){const A=this.#l.lastIndexOf("M");this.#l=`${this.#l.slice(0,A)} M ${I} ${g}`,this.#d=6}if(this.#i.length===4){const A=M.svgRound(this.#g[10]),l=M.svgRound(this.#g[11]);return this.#l=`${this.#l} L ${A} ${l}`,this.#d=12,this.#l}const C=[];this.#d===0&&(C.push(`M ${I} ${g}`),this.#d=6);for(let A=this.#d,l=this.#g.length;A<l;A+=6){const[i,Z,d,s,c,b]=this.#g.slice(A,A+6).map(M.svgRound);C.push(`C${i} ${Z} ${d} ${s} ${c} ${b}`)}return this.#l+=C.join(" "),this.#d=this.#g.length,this.#l}getOutlines(I,g,C,A){const l=this.#A.at(-1);return l.line=new Float32Array(l.line),l.points=new Float32Array(l.points),this.#c.build(this.#A,I,g,C,this.#C,this.#Z,A),this.#I=null,this.#g=null,this.#A=null,this.#l=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class YC extends M{#I;#g=0;#A;#C;#Z;#i;#l;#d;#c;build(I,g,C,A,l,i,Z){this.#Z=g,this.#i=C,this.#l=A,this.#d=l,this.#c=i,this.#A=Z??0,this.#C=I,this.#b()}get thickness(){return this.#c}setLastElement(I){return this.#C.push(I),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#C.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const I=[];for(const{line:g}of this.#C){if(I.push(`M${M.svgRound(g[4])} ${M.svgRound(g[5])}`),g.length===6){I.push("Z");continue}if(g.length===12&&isNaN(g[6])){I.push(`L${M.svgRound(g[10])} ${M.svgRound(g[11])}`);continue}for(let C=6,A=g.length;C<A;C+=6){const[l,i,Z,d,s,c]=g.subarray(C,C+6).map(M.svgRound);I.push(`C${l} ${i} ${Z} ${d} ${s} ${c}`)}}return I.join("")}serialize([I,g,C,A],l){const i=[],Z=[],[d,s,c,b]=this.#m();let m,B,W,o,h,w,a,Y,V;switch(this.#d){case 0:V=M._rescale,m=I,B=g+A,W=C,o=-A,h=I+d*C,w=g+(1-s-b)*A,a=I+(d+c)*C,Y=g+(1-s)*A;break;case 90:V=M._rescaleAndSwap,m=I,B=g,W=C,o=A,h=I+s*C,w=g+d*A,a=I+(s+b)*C,Y=g+(d+c)*A;break;case 180:V=M._rescale,m=I+C,B=g,W=-C,o=A,h=I+(1-d-c)*C,w=g+s*A,a=I+(1-d)*C,Y=g+(s+b)*A;break;case 270:V=M._rescaleAndSwap,m=I+C,B=g+A,W=-C,o=-A,h=I+(1-s-b)*C,w=g+(1-d-c)*A,a=I+(1-s)*C,Y=g+(1-d)*A;break}for(const{line:n,points:e}of this.#C)i.push(V(n,m,B,W,o,l?new Array(n.length):null)),Z.push(V(e,m,B,W,o,l?new Array(e.length):null));return{lines:i,points:Z,rect:[h,w,a,Y]}}static deserialize(I,g,C,A,l,{paths:{lines:i,points:Z},rotation:d,thickness:s}){const c=[];let b,m,B,W,o;switch(d){case 0:o=M._rescale,b=-I/C,m=g/A+1,B=1/C,W=-1/A;break;case 90:o=M._rescaleAndSwap,b=-g/A,m=-I/C,B=1/A,W=1/C;break;case 180:o=M._rescale,b=I/C+1,m=-g/A,B=-1/C,W=1/A;break;case 270:o=M._rescaleAndSwap,b=g/A+1,m=I/C+1,B=-1/A,W=-1/C;break}if(!i){i=[];for(const w of Z){const a=w.length;if(a===2){i.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(a===4){i.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const Y=new Float32Array(3*(a-2));i.push(Y);let[V,n,e,t]=w.subarray(0,4);Y.set([NaN,NaN,NaN,NaN,V,n],0);for(let N=4;N<a;N+=2){const R=w[N],H=w[N+1];Y.set(M.createBezierPoints(V,n,e,t,R,H),(N-2)*3),[V,n,e,t]=[e,t,R,H]}}}for(let w=0,a=i.length;w<a;w++)c.push({line:o(i[w].map(Y=>Y??NaN),b,m,B,W),points:o(Z[w].map(Y=>Y??NaN),b,m,B,W)});const h=new this.prototype.constructor;return h.build(c,C,A,1,d,s,l),h}#s(I=this.#c){const g=this.#A+I/2*this.#l;return this.#d%180===0?[g/this.#Z,g/this.#i]:[g/this.#i,g/this.#Z]}#m(){const[I,g,C,A]=this.#I,[l,i]=this.#s(0);return[I+l,g+i,C-2*l,A-2*i]}#b(){const I=this.#I=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:A}of this.#C){if(A.length<=12){for(let Z=4,d=A.length;Z<d;Z+=6)u.pointBoundingBox(A[Z],A[Z+1],I);continue}let l=A[4],i=A[5];for(let Z=6,d=A.length;Z<d;Z+=6){const[s,c,b,m,B,W]=A.subarray(Z,Z+6);u.bezierBoundingBox(l,i,s,c,b,m,B,W,I),l=B,i=W}}const[g,C]=this.#s();I[0]=nI(I[0]-g,0,1),I[1]=nI(I[1]-C,0,1),I[2]=nI(I[2]+g,0,1),I[3]=nI(I[3]+C,0,1),I[2]-=I[0],I[3]-=I[1]}get box(){return this.#I}updateProperty(I,g){return I==="stroke-width"?this.#B(g):null}#B(I){const[g,C]=this.#s();this.#c=I;const[A,l]=this.#s(),[i,Z]=[A-g,l-C],d=this.#I;return d[0]-=i,d[1]-=Z,d[2]+=2*i,d[3]+=2*Z,d}updateParentDimensions([I,g],C){const[A,l]=this.#s();this.#Z=I,this.#i=g,this.#l=C;const[i,Z]=this.#s(),d=i-A,s=Z-l,c=this.#I;return c[0]-=d,c[1]-=s,c[2]+=2*d,c[3]+=2*s,c}updateRotation(I){return this.#g=I,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#I.map(M.svgRound).join(" ")}get defaultProperties(){const[I,g]=this.#I;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${M.svgRound(I)} ${M.svgRound(g)}`}}}get rotationTransform(){const[,,I,g]=this.#I;let C=0,A=0,l=0,i=0,Z=0,d=0;switch(this.#g){case 90:A=g/I,l=-I/g,Z=I;break;case 180:C=-1,i=-1,Z=I,d=g;break;case 270:A=-g/I,l=I/g,d=g;break;default:return""}return`matrix(${C} ${A} ${l} ${i} ${M.svgRound(Z)} ${M.svgRound(d)})`}getPathResizingSVGProperties([I,g,C,A]){const[l,i]=this.#s(),[Z,d,s,c]=this.#I;if(Math.abs(s-l)<=M.PRECISION||Math.abs(c-i)<=M.PRECISION){const o=I+C/2-(Z+s/2),h=g+A/2-(d+c/2);return{path:{"transform-origin":`${M.svgRound(I)} ${M.svgRound(g)}`,transform:`${this.rotationTransform} translate(${o} ${h})`}}}const b=(C-2*l)/(s-2*l),m=(A-2*i)/(c-2*i),B=s/C,W=c/A;return{path:{"transform-origin":`${M.svgRound(Z)} ${M.svgRound(d)}`,transform:`${this.rotationTransform} scale(${B} ${W}) translate(${M.svgRound(l)} ${M.svgRound(i)}) scale(${b} ${m}) translate(${M.svgRound(-l)} ${M.svgRound(-i)})`}}}getPathResizedSVGProperties([I,g,C,A]){const[l,i]=this.#s(),Z=this.#I,[d,s,c,b]=Z;if(Z[0]=I,Z[1]=g,Z[2]=C,Z[3]=A,Math.abs(c-l)<=M.PRECISION||Math.abs(b-i)<=M.PRECISION){const h=I+C/2-(d+c/2),w=g+A/2-(s+b/2);for(const{line:a,points:Y}of this.#C)M._translate(a,h,w,a),M._translate(Y,h,w,Y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${M.svgRound(I)} ${M.svgRound(g)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(C-2*l)/(c-2*l),B=(A-2*i)/(b-2*i),W=-m*(d+l)+I+l,o=-B*(s+i)+g+i;if(m!==1||B!==1||W!==0||o!==0)for(const{line:h,points:w}of this.#C)M._rescale(h,W,o,m,B,h),M._rescale(w,W,o,m,B,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${M.svgRound(I)} ${M.svgRound(g)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([I,g],C){const[A,l]=C,i=this.#I,Z=I-i[0],d=g-i[1];if(this.#Z===A&&this.#i===l)for(const{line:s,points:c}of this.#C)M._translate(s,Z,d,s),M._translate(c,Z,d,c);else{const s=this.#Z/A,c=this.#i/l;this.#Z=A,this.#i=l;for(const{line:b,points:m}of this.#C)M._rescale(b,Z,d,s,c,b),M._rescale(m,Z,d,s,c,m);i[2]*=s,i[3]*=c}return i[0]=I,i[1]=g,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${M.svgRound(I)} ${M.svgRound(g)}`}}}get defaultSVGProperties(){const I=this.#I;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${M.svgRound(I[0])} ${M.svgRound(I[1])}`,transform:this.rotationTransform||null},bbox:I}}}class UC extends Ai{constructor(I){super(),this._viewParameters=I,super.updateProperties({fill:"none",stroke:K._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(I,g){I==="stroke-width"&&(g??=this["stroke-width"],g*=this._viewParameters.realScale),super.updateSVGProperty(I,g)}clone(){const I=new UC(this._viewParameters);return I.updateAll(this),I}}class zA extends r{static _type="ink";static _editorType=z.INK;static _defaultDrawingOptions=null;constructor(I){super({...I,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(I,g){K.initialize(I,g),this._defaultDrawingOptions=new UC(g.viewParameters)}static getDefaultDrawingOptions(I){const g=this._defaultDrawingOptions.clone();return g.updateProperties(I),g}static get supportMultipleDrawings(){return!0}static get typesMap(){return J(this,"typesMap",new Map([[L.INK_THICKNESS,"stroke-width"],[L.INK_COLOR,"stroke"],[L.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(I,g,C,A,l){return new yd(I,g,C,A,l,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(I,g,C,A,l,i){return YC.deserialize(I,g,C,A,l,i)}static async deserialize(I,g,C){let A=null;if(I instanceof SA){const{data:{inkLists:i,rect:Z,rotation:d,id:s,color:c,opacity:b,borderStyle:{rawWidth:m},popupRef:B,richText:W,contentsObj:o,creationDate:h,modificationDate:w},parent:{page:{pageNumber:a}}}=I;A=I={annotationType:z.INK,color:Array.from(c),thickness:m,opacity:b,paths:{points:i},boxes:null,pageIndex:a-1,rect:Z.slice(0),rotation:d,annotationElementId:s,id:s,deleted:!1,popupRef:B,richText:W,comment:o?.str||null,creationDate:h,modificationDate:w}}const l=await super.deserialize(I,g,C);return l._initialData=A,I.comment&&l.setCommentData(I),l}get toolbarButtons(){return this._colorPicker||=new hC(this),[["colorPicker",this._colorPicker]]}get colorType(){return L.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:I,_drawingOptions:g,parent:C}=this;g.updateSVGProperty("stroke-width"),C.drawLayer.updateProperties(I,g.toSVGProperties())}static onScaleChangingWhenDrawing(){const I=this._currentParent;I&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),I.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:I,thickness:g,opacity:C}){this._drawingOptions=zA.getDefaultDrawingOptions({stroke:u.makeHexColor(...I),"stroke-width":g,"stroke-opacity":C})}serialize(I=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:g,points:C}=this.serializeDraw(I),{_drawingOptions:{stroke:A,"stroke-opacity":l,"stroke-width":i}}=this,Z=Object.assign(super.serialize(I),{color:K._colorManager.convert(A),opacity:l,thickness:i,paths:{lines:g,points:C}});return this.addComment(Z),I?(Z.isCopy=!0,Z):this.annotationElementId&&!this.#I(Z)?null:(Z.id=this.annotationElementId,Z)}#I(I){const{color:g,thickness:C,opacity:A,pageIndex:l}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||I.color.some((i,Z)=>i!==g[Z])||I.thickness!==C||I.opacity!==A||I.pageIndex!==l}renderAnnotationElement(I){if(this.deleted)return I.hide(),null;const{points:g,rect:C}=this.serializeDraw(!1);return I.updateEdited({rect:C,thickness:this._drawingOptions["stroke-width"],points:g,popup:this.comment}),null}}class kA extends YC{toSVGPath(){let I=super.toSVGPath();return I.endsWith("Z")||(I+="Z"),I}}const OC=8,VC=3;class Eg{static#I={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#g(I,g,C,A){return C-=I,A-=g,C===0?A>0?0:4:C===1?A+6:2-A}static#A=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#C(I,g,C,A,l,i,Z){const d=this.#g(C,A,l,i);for(let s=0;s<8;s++){const c=(-s+d-Z+16)%8,b=this.#A[2*c],m=this.#A[2*c+1];if(I[(C+b)*g+(A+m)]!==0)return c}return-1}static#Z(I,g,C,A,l,i,Z){const d=this.#g(C,A,l,i);for(let s=0;s<8;s++){const c=(s+d+Z+16)%8,b=this.#A[2*c],m=this.#A[2*c+1];if(I[(C+b)*g+(A+m)]!==0)return c}return-1}static#i(I,g,C,A){const l=I.length,i=new Int32Array(l);for(let c=0;c<l;c++)i[c]=I[c]<=A?1:0;for(let c=1;c<C-1;c++)i[c*g]=i[c*g+g-1]=0;for(let c=0;c<g;c++)i[c]=i[g*C-1-c]=0;let Z=1,d;const s=[];for(let c=1;c<C-1;c++){d=1;for(let b=1;b<g-1;b++){const m=c*g+b,B=i[m];if(B===0)continue;let W=c,o=b;if(B===1&&i[m-1]===0)Z+=1,o-=1;else if(B>=1&&i[m+1]===0)Z+=1,o+=1,B>1&&(d=B);else{B!==1&&(d=Math.abs(B));continue}const h=[b,c],w=o===b+1,a={isHole:w,points:h,id:Z,parent:0};s.push(a);let Y;for(const y of s)if(y.id===d){Y=y;break}Y?Y.isHole?a.parent=w?Y.parent:d:a.parent=w?d:Y.parent:a.parent=w?d:0;const V=this.#C(i,g,c,b,W,o,0);if(V===-1){i[m]=-Z,i[m]!==1&&(d=Math.abs(i[m]));continue}let n=this.#A[2*V],e=this.#A[2*V+1];const t=c+n,N=b+e;W=t,o=N;let R=c,H=b;for(;;){const y=this.#Z(i,g,R,H,W,o,1);n=this.#A[2*y],e=this.#A[2*y+1];const U=R+n,P=H+e;h.push(P,U);const j=R*g+H;if(i[j+1]===0?i[j]=-Z:i[j]===1&&(i[j]=Z),U===c&&P===b&&R===t&&H===N){i[m]!==1&&(d=Math.abs(i[m]));break}else W=R,o=H,R=U,H=P}}}return s}static#l(I,g,C,A){if(C-g<=4){for(let t=g;t<C-2;t+=2)A.push(I[t],I[t+1]);return}const l=I[g],i=I[g+1],Z=I[C-4]-l,d=I[C-3]-i,s=Math.hypot(Z,d),c=Z/s,b=d/s,m=c*i-b*l,B=d/Z,W=1/s,o=Math.atan(B),h=Math.cos(o),w=Math.sin(o),a=W*(Math.abs(h)+Math.abs(w)),Y=W*(1-a+a**2),V=Math.max(Math.atan(Math.abs(w+h)*Y),Math.atan(Math.abs(w-h)*Y));let n=0,e=g;for(let t=g+2;t<C-2;t+=2){const N=Math.abs(m-c*I[t+1]+b*I[t]);N>n&&(e=t,n=N)}n>(s*V)**2?(this.#l(I,g,e+2,A),this.#l(I,e,C,A)):A.push(l,i)}static#d(I){const g=[],C=I.length;return this.#l(I,0,C,g),g.push(I[C-2],I[C-1]),g.length<=4?null:g}static#c(I,g,C,A,l,i){const Z=new Float32Array(i**2),d=-2*A**2,s=i>>1;for(let o=0;o<i;o++){const h=(o-s)**2;for(let w=0;w<i;w++)Z[o*i+w]=Math.exp((h+(w-s)**2)/d)}const c=new Float32Array(256),b=-2*l**2;for(let o=0;o<256;o++)c[o]=Math.exp(o**2/b);const m=I.length,B=new Uint8Array(m),W=new Uint32Array(256);for(let o=0;o<C;o++)for(let h=0;h<g;h++){const w=o*g+h,a=I[w];let Y=0,V=0;for(let e=0;e<i;e++){const t=o+e-s;if(!(t<0||t>=C))for(let N=0;N<i;N++){const R=h+N-s;if(R<0||R>=g)continue;const H=I[t*g+R],y=Z[e*i+N]*c[Math.abs(H-a)];Y+=H*y,V+=y}}const n=B[w]=Math.round(Y/V);W[n]++}return[B,W]}static#s(I){const g=new Uint32Array(256);for(const C of I)g[C]++;return g}static#m(I){const g=I.length,C=new Uint8ClampedArray(g>>2);let A=-1/0,l=1/0;for(let Z=0,d=C.length;Z<d;Z++){const s=C[Z]=I[Z<<2];A=Math.max(A,s),l=Math.min(l,s)}const i=255/(A-l);for(let Z=0,d=C.length;Z<d;Z++)C[Z]=(C[Z]-l)*i;return C}static#b(I){let g,C=-1/0,A=-1/0;const l=I.findIndex(d=>d!==0);let i=l,Z=l;for(g=l;g<256;g++){const d=I[g];d>C&&(g-i>A&&(A=g-i,Z=g-1),C=d,i=g)}for(g=Z-1;g>=0&&!(I[g]>I[g+1]);g--);return g}static#B(I){const g=I,{width:C,height:A}=I,{maxDim:l}=this.#I;let i=C,Z=A;if(C>l||A>l){let m=C,B=A,W=Math.log2(Math.max(C,A)/l);const o=Math.floor(W);W=W===o?o-1:o;for(let w=0;w<W;w++){i=Math.ceil(m/2),Z=Math.ceil(B/2);const a=new OffscreenCanvas(i,Z);a.getContext("2d").drawImage(I,0,0,m,B,0,0,i,Z),m=i,B=Z,I!==g&&I.close(),I=a.transferToImageBitmap()}const h=Math.min(l/i,l/Z);i=Math.round(i*h),Z=Math.round(Z*h)}const s=new OffscreenCanvas(i,Z).getContext("2d",{willReadFrequently:!0});s.fillStyle="white",s.fillRect(0,0,i,Z),s.filter="grayscale(1)",s.drawImage(I,0,0,I.width,I.height,0,0,i,Z);const c=s.getImageData(0,0,i,Z).data;return[this.#m(c),i,Z]}static extractContoursFromText(I,{fontFamily:g,fontStyle:C,fontWeight:A},l,i,Z,d){let s=new OffscreenCanvas(1,1),c=s.getContext("2d",{alpha:!1});const b=200,m=c.font=`${C} ${A} ${b}px ${g}`,{actualBoundingBoxLeft:B,actualBoundingBoxRight:W,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,fontBoundingBoxAscent:w,fontBoundingBoxDescent:a,width:Y}=c.measureText(I),V=1.5,n=Math.ceil(Math.max(Math.abs(B)+Math.abs(W)||0,Y)*V),e=Math.ceil(Math.max(Math.abs(o)+Math.abs(h)||b,Math.abs(w)+Math.abs(a)||b)*V);s=new OffscreenCanvas(n,e),c=s.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=m,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,n,e),c.fillStyle="black",c.fillText(I,n*(V-1)/2,e*(3-V)/2);const t=this.#m(c.getImageData(0,0,n,e).data),N=this.#s(t),R=this.#b(N),H=this.#i(t,n,e,R);return this.processDrawnLines({lines:{curves:H,width:n,height:e},pageWidth:l,pageHeight:i,rotation:Z,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(I,g,C,A,l){const[i,Z,d]=this.#B(I),[s,c]=this.#c(i,Z,d,Math.hypot(Z,d)*this.#I.sigmaSFactor,this.#I.sigmaR,this.#I.kernelSize),b=this.#b(c),m=this.#i(s,Z,d,b);return this.processDrawnLines({lines:{curves:m,width:Z,height:d},pageWidth:g,pageHeight:C,rotation:A,innerMargin:l,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:I,pageWidth:g,pageHeight:C,rotation:A,innerMargin:l,mustSmooth:i,areContours:Z}){A%180!==0&&([g,C]=[C,g]);const{curves:d,width:s,height:c}=I,b=I.thickness??0,m=[],B=Math.min(g/s,C/c),W=B/g,o=B/C,h=[];for(const{points:a}of d){const Y=i?this.#d(a):a;if(!Y)continue;h.push(Y);const V=Y.length,n=new Float32Array(V),e=new Float32Array(3*(V===2?2:V-2));if(m.push({line:e,points:n}),V===2){n[0]=Y[0]*W,n[1]=Y[1]*o,e.set([NaN,NaN,NaN,NaN,n[0],n[1]],0);continue}let[t,N,R,H]=Y;t*=W,N*=o,R*=W,H*=o,n.set([t,N,R,H],0),e.set([NaN,NaN,NaN,NaN,t,N],0);for(let y=4;y<V;y+=2){const U=n[y]=Y[y]*W,P=n[y+1]=Y[y+1]*o;e.set(M.createBezierPoints(t,N,R,H,U,P),(y-2)*3),[t,N,R,H]=[R,H,U,P]}}if(m.length===0)return null;const w=Z?new kA:new YC;return w.build(m,g,C,1,A,Z?0:b,l),{outline:w,newCurves:h,areContours:Z,thickness:b,width:s,height:c}}static async compressSignature({outlines:I,areContours:g,thickness:C,width:A,height:l}){let i=1/0,Z=-1/0,d=0;for(const Y of I){d+=Y.length;for(let V=2,n=Y.length;V<n;V++){const e=Y[V]-Y[V-2];i=Math.min(i,e),Z=Math.max(Z,e)}}let s;i>=-128&&Z<=127?s=Int8Array:i>=-32768&&Z<=32767?s=Int16Array:s=Int32Array;const c=I.length,b=OC+VC*c,m=new Uint32Array(b);let B=0;m[B++]=b*Uint32Array.BYTES_PER_ELEMENT+(d-2*c)*s.BYTES_PER_ELEMENT,m[B++]=0,m[B++]=A,m[B++]=l,m[B++]=g?0:1,m[B++]=Math.max(0,Math.floor(C??0)),m[B++]=c,m[B++]=s.BYTES_PER_ELEMENT;for(const Y of I)m[B++]=Y.length-2,m[B++]=Y[0],m[B++]=Y[1];const W=new CompressionStream("deflate-raw"),o=W.writable.getWriter();await o.ready,o.write(m);const h=s.prototype.constructor;for(const Y of I){const V=new h(Y.length-2);for(let n=2,e=Y.length;n<e;n++)V[n-2]=Y[n]-Y[n-2];o.write(V)}o.close();const w=await new Response(W.readable).arrayBuffer(),a=new Uint8Array(w);return Zl(a)}static async decompressSignature(I){try{const g=Qi(I),{readable:C,writable:A}=new DecompressionStream("deflate-raw"),l=A.getWriter();await l.ready,l.write(g).then(async()=>{await l.ready,await l.close()}).catch(()=>{});let i=null,Z=0;for await(const Y of C)i||=new Uint8Array(new Uint32Array(Y.buffer,0,4)[0]),i.set(Y,Z),Z+=Y.length;const d=new Uint32Array(i.buffer,0,i.length>>2),s=d[1];if(s!==0)throw new Error(`Invalid version: ${s}`);const c=d[2],b=d[3],m=d[4]===0,B=d[5],W=d[6],o=d[7],h=[],w=(OC+VC*W)*Uint32Array.BYTES_PER_ELEMENT;let a;switch(o){case Int8Array.BYTES_PER_ELEMENT:a=new Int8Array(i.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:a=new Int16Array(i.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:a=new Int32Array(i.buffer,w);break}Z=0;for(let Y=0;Y<W;Y++){const V=d[VC*Y+OC],n=new Float32Array(V+2);h.push(n);for(let e=0;e<VC-1;e++)n[e]=d[VC*Y+OC+e+1];for(let e=0;e<V;e++)n[e+2]=n[e]+a[Z++]}return{areContours:m,thickness:B,outlines:h,width:c,height:b}}catch(g){return F(`decompressSignature: ${g}`),null}}}class LA extends Ai{constructor(){super(),super.updateProperties({fill:K._defaultLineColor,"stroke-width":0})}clone(){const I=new LA;return I.updateAll(this),I}}class TA extends UC{constructor(I){super(I),super.updateProperties({stroke:K._defaultLineColor,"stroke-width":1})}clone(){const I=new TA(this._viewParameters);return I.updateAll(this),I}}class OI extends r{#I=!1;#g=null;#A=null;#C=null;static _type="signature";static _editorType=z.SIGNATURE;static _defaultDrawingOptions=null;constructor(I){super({...I,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#A=I.signatureData||null,this.#g=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(I,g){K.initialize(I,g),this._defaultDrawingOptions=new LA,this._defaultDrawnSignatureOptions=new TA(g.viewParameters)}static getDefaultDrawingOptions(I){const g=this._defaultDrawingOptions.clone();return g.updateProperties(I),g}static get supportMultipleDrawings(){return!1}static get typesMap(){return J(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#g}}static computeTelemetryFinalData(I){const g=I.get("hasDescription");return{hasAltText:g.get(!0)??0,hasNoAltText:g.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let I,g;const{_isCopy:C}=this;if(C&&(this._isCopy=!1,I=this.x,g=this.y),super.render(),this._drawId===null)if(this.#A){const{lines:A,mustSmooth:l,areContours:i,description:Z,uuid:d,heightInPage:s}=this.#A,{rawDims:{pageWidth:c,pageHeight:b},rotation:m}=this.parent.viewport,B=Eg.processDrawnLines({lines:A,pageWidth:c,pageHeight:b,rotation:m,innerMargin:OI._INNER_MARGIN,mustSmooth:l,areContours:i});this.addSignature(B,s,Z,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#g||""}));return C&&(this._isCopy=!0,this._moveAfterPaste(I,g)),this.div}setUuid(I){this.#C=I,this.addEditToolbar()}getUuid(){return this.#C}get description(){return this.#g}set description(I){this.#g=I,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:I})),super.addEditToolbar().then(g=>{g?.updateEditSignatureButton(I)}))}getSignaturePreview(){const{newCurves:I,areContours:g,thickness:C,width:A,height:l}=this.#A,i=Math.max(A,l),Z=Eg.processDrawnLines({lines:{curves:I.map(d=>({points:d})),thickness:C,width:A,height:l},pageWidth:i,pageHeight:i,rotation:0,innerMargin:0,mustSmooth:!1,areContours:g});return{areContours:g,outline:Z.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(I,g,C,A){const{x:l,y:i}=this,{outline:Z}=this.#A=I;this.#I=Z instanceof kA,this.description=C;let d;this.#I?d=OI.getDefaultDrawingOptions():(d=OI._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":Z.thickness})),this._addOutlines({drawOutlines:Z,drawingOptions:d});const[,s]=this.pageDimensions;let c=g/s;c=c>=1?.5:c,this.width*=c/this.height,this.width>=1&&(c*=.9/this.width,this.width=.9),this.height=c,this.setDims(),this.x=l,this.y=i,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(A),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!A,hasDescription:!!C}}),this.div.hidden=!1}getFromImage(I){const{rawDims:{pageWidth:g,pageHeight:C},rotation:A}=this.parent.viewport;return Eg.process(I,g,C,A,OI._INNER_MARGIN)}getFromText(I,g){const{rawDims:{pageWidth:C,pageHeight:A},rotation:l}=this.parent.viewport;return Eg.extractContoursFromText(I,g,C,A,l,OI._INNER_MARGIN)}getDrawnSignature(I){const{rawDims:{pageWidth:g,pageHeight:C},rotation:A}=this.parent.viewport;return Eg.processDrawnLines({lines:I,pageWidth:g,pageHeight:C,rotation:A,innerMargin:OI._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:I,thickness:g}){I?this._drawingOptions=OI.getDefaultDrawingOptions():(this._drawingOptions=OI._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":g}))}serialize(I=!1){if(this.isEmpty())return null;const{lines:g,points:C}=this.serializeDraw(I),{_drawingOptions:{"stroke-width":A}}=this,l=Object.assign(super.serialize(I),{isSignature:!0,areContours:this.#I,color:[0,0,0],thickness:this.#I?0:A});return this.addComment(l),I?(l.paths={lines:g,points:C},l.uuid=this.#C,l.isCopy=!0):l.lines=g,this.#g&&(l.accessibilityData={type:"Figure",alt:this.#g}),l}static deserializeDraw(I,g,C,A,l,i){return i.areContours?kA.deserialize(I,g,C,A,l,i):YC.deserialize(I,g,C,A,l,i)}static async deserialize(I,g,C){const A=await super.deserialize(I,g,C);return A.#I=I.areContours,A.description=I.accessibilityData?.alt||"",A.#C=I.uuid,A}}class ud extends K{#I=null;#g=null;#A=null;#C=null;#Z=null;#i="";#l=null;#d=!1;#c=null;#s=!1;#m=!1;static _type="stamp";static _editorType=z.STAMP;constructor(I){super({...I,name:"stampEditor"}),this.#C=I.bitmapUrl,this.#Z=I.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(I,g){K.initialize(I,g)}static isHandlingMimeForPasting(I){return BA.includes(I)}static paste(I,g){g.pasteEditor({mode:z.STAMP},{bitmapFile:I.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(I){const g=I.get("hasAltText");return{hasAltText:g.get(!0)??0,hasNoAltText:g.get(!1)??0}}#b(I,g=!1){if(!I){this.remove();return}this.#I=I.bitmap,g||(this.#g=I.id,this.#s=I.isSvg),I.file&&(this.#i=I.file.name),this.#W()}#B(){if(this.#A=null,this._uiManager.enableWaiting(!1),!!this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#I){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#I){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(I=null,g=!0){if(this.hasAltTextData())return null;const{mlManager:C}=this._uiManager;if(!C)throw new Error("No ML.");if(!await C.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:A,width:l,height:i}=I||this.copyCanvas(null,null,!0).imageData,Z=await C.guess({name:"altText",request:{data:A,width:l,height:i,channels:A.length/(l*i)}});if(!Z)throw new Error("No response from the AI service.");if(Z.error)throw new Error("Error from the AI service.");if(Z.cancel)return null;if(!Z.output)throw new Error("No valid response from the AI service.");const d=Z.output;return await this.setGuessedAltText(d),g&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#w(){if(this.#g){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#g).then(C=>this.#b(C,!0)).finally(()=>this.#B());return}if(this.#C){const C=this.#C;this.#C=null,this._uiManager.enableWaiting(!0),this.#A=this._uiManager.imageManager.getFromUrl(C).then(A=>this.#b(A)).finally(()=>this.#B());return}if(this.#Z){const C=this.#Z;this.#Z=null,this._uiManager.enableWaiting(!0),this.#A=this._uiManager.imageManager.getFromFile(C).then(A=>this.#b(A)).finally(()=>this.#B());return}const I=document.createElement("input");I.type="file",I.accept=BA.join(",");const g=this._uiManager._signal;this.#A=new Promise(C=>{I.addEventListener("change",async()=>{if(!I.files||I.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const A=await this._uiManager.imageManager.getFromFile(I.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#b(A)}C()},{signal:g}),I.addEventListener("cancel",()=>{this.remove(),C()},{signal:g})}).finally(()=>this.#B()),I.click()}remove(){this.#g&&(this.#I=null,this._uiManager.imageManager.deleteId(this.#g),this.#l?.remove(),this.#l=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#g&&this.#w();return}super.rebuild(),this.div!==null&&(this.#g&&this.#l===null&&this.#w(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(I){this._isDraggable=!0,I&&this.div.focus()}isEmpty(){return!(this.#A||this.#I||this.#C||this.#Z||this.#g||this.#d)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let I,g;return this._isCopy&&(I=this.x,g=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#d||(this.#I?this.#W():this.#w()),this._isCopy&&this._moveAfterPaste(I,g),this._uiManager.addShouldRescale(this),this.div}setCanvas(I,g){const{id:C,bitmap:A}=this._uiManager.imageManager.getFromCanvas(I,g);g.remove(),C&&this._uiManager.imageManager.isValidId(C)&&(this.#g=C,A&&(this.#I=A),this.#d=!1,this.#W())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const I=200;this.#c=setTimeout(()=>{this.#c=null,this.#o()},I)}#W(){const{div:I}=this;let{width:g,height:C}=this.#I;const[A,l]=this.pageDimensions,i=.75;if(this.width)g=this.width*A,C=this.height*l;else if(g>i*A||C>i*l){const d=Math.min(i*A/g,i*l/C);g*=d,C*=d}this._uiManager.enableWaiting(!1);const Z=this.#l=document.createElement("canvas");Z.setAttribute("role","img"),this.addContainer(Z),this.width=g/A,this.height=C/l,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(I.hidden=!1),this.#o(),this.#m||(this.parent.addUndoableEditor(this),this.#m=!0),this._reportTelemetry({action:"inserted_image"}),this.#i&&this.div.setAttribute("aria-description",this.#i),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(I,g,C=!1){I||(I=224);const{width:A,height:l}=this.#I,i=new QI;let Z=this.#I,d=A,s=l,c=null;if(g){if(A>g||l>g){const e=Math.min(g/A,g/l);d=Math.floor(A*e),s=Math.floor(l*e)}c=document.createElement("canvas");const m=c.width=Math.ceil(d*i.sx),B=c.height=Math.ceil(s*i.sy);this.#s||(Z=this.#G(m,B));const W=c.getContext("2d");W.filter=this._uiManager.hcmFilter;let o="white",h="#cfcfd8";this._uiManager.hcmFilter!=="none"?h="black":Ei.isDarkMode&&(o="#8f8f9d",h="#42414d");const w=15,a=w*i.sx,Y=w*i.sy,V=new OffscreenCanvas(a*2,Y*2),n=V.getContext("2d");n.fillStyle=o,n.fillRect(0,0,a*2,Y*2),n.fillStyle=h,n.fillRect(0,0,a,Y),n.fillRect(a,Y,a,Y),W.fillStyle=W.createPattern(V,"repeat"),W.fillRect(0,0,m,B),W.drawImage(Z,0,0,Z.width,Z.height,0,0,m,B)}let b=null;if(C){let m,B;if(i.symmetric&&Z.width<I&&Z.height<I)m=Z.width,B=Z.height;else if(Z=this.#I,A>I||l>I){const h=Math.min(I/A,I/l);m=Math.floor(A*h),B=Math.floor(l*h),this.#s||(Z=this.#G(m,B))}const o=new OffscreenCanvas(m,B).getContext("2d",{willReadFrequently:!0});o.drawImage(Z,0,0,Z.width,Z.height,0,0,m,B),b={width:m,height:B,data:o.getImageData(0,0,m,B).data}}return{canvas:c,width:d,height:s,imageData:b}}#G(I,g){const{width:C,height:A}=this.#I;let l=C,i=A,Z=this.#I;for(;l>2*I||i>2*g;){const d=l,s=i;l>2*I&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2)),i>2*g&&(i=i>=16384?Math.floor(i/2)-1:Math.ceil(i/2));const c=new OffscreenCanvas(l,i);c.getContext("2d").drawImage(Z,0,0,d,s,0,0,l,i),Z=c.transferToImageBitmap()}return Z}#o(){const[I,g]=this.parentDimensions,{width:C,height:A}=this,l=new QI,i=Math.ceil(C*I*l.sx),Z=Math.ceil(A*g*l.sy),d=this.#l;if(!d||d.width===i&&d.height===Z)return;d.width=i,d.height=Z;const s=this.#s?this.#I:this.#G(i,Z),c=d.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(s,0,0,s.width,s.height,0,0,i,Z)}#h(I){if(I){if(this.#s){const A=this._uiManager.imageManager.getSvgUrl(this.#g);if(A)return A}const g=document.createElement("canvas");return{width:g.width,height:g.height}=this.#I,g.getContext("2d").drawImage(this.#I,0,0),g.toDataURL()}if(this.#s){const[g,C]=this.pageDimensions,A=Math.round(this.width*g*Lg.PDF_TO_CSS_UNITS),l=Math.round(this.height*C*Lg.PDF_TO_CSS_UNITS),i=new OffscreenCanvas(A,l);return i.getContext("2d").drawImage(this.#I,0,0,this.#I.width,this.#I.height,0,0,A,l),i.transferToImageBitmap()}return structuredClone(this.#I)}static async deserialize(I,g,C){let A=null,l=!1;if(I instanceof gi){const{data:{rect:o,rotation:h,id:w,structParent:a,popupRef:Y,richText:V,contentsObj:n,creationDate:e,modificationDate:t},container:N,parent:{page:{pageNumber:R}},canvas:H}=I;let y,U;H?(delete I.canvas,{id:y,bitmap:U}=C.imageManager.getFromCanvas(N.id,H),H.remove()):(l=!0,I._hasNoCanvas=!0);const P=(await g._structTree.getAriaAttributes(`${kg}${w}`))?.get("aria-label")||"";A=I={annotationType:z.STAMP,bitmapId:y,bitmap:U,pageIndex:R-1,rect:o.slice(0),rotation:h,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:P},isSvg:!1,structParent:a,popupRef:Y,richText:V,comment:n?.str||null,creationDate:e,modificationDate:t}}const i=await super.deserialize(I,g,C),{rect:Z,bitmap:d,bitmapUrl:s,bitmapId:c,isSvg:b,accessibilityData:m}=I;l?(C.addMissingCanvas(I.id,i),i.#d=!0):c&&C.imageManager.isValidId(c)?(i.#g=c,d&&(i.#I=d)):i.#C=s,i.#s=b;const[B,W]=i.pageDimensions;return i.width=(Z[2]-Z[0])/B,i.height=(Z[3]-Z[1])/W,m&&(i.altTextData=m),i._initialData=A,I.comment&&i.setCommentData(I),i.#m=!!A,i}serialize(I=!1,g=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const C=Object.assign(super.serialize(I),{bitmapId:this.#g,isSvg:this.#s});if(this.addComment(C),I)return C.bitmapUrl=this.#h(!0),C.accessibilityData=this.serializeAltText(!0),C.isCopy=!0,C;const{decorative:A,altText:l}=this.serializeAltText(!1);if(!A&&l&&(C.accessibilityData={type:"Figure",alt:l}),this.annotationElementId){const Z=this.#Y(C);return Z.isSame?null:(Z.isSameAltText?delete C.accessibilityData:C.accessibilityData.structParent=this._initialData.structParent??-1,C.id=this.annotationElementId,delete C.bitmapId,C)}if(g===null)return C;g.stamps||=new Map;const i=this.#s?(C.rect[2]-C.rect[0])*(C.rect[3]-C.rect[1]):null;if(!g.stamps.has(this.#g))g.stamps.set(this.#g,{area:i,serialized:C}),C.bitmap=this.#h(!1);else if(this.#s){const Z=g.stamps.get(this.#g);i>Z.area&&(Z.area=i,Z.serialized.bitmap.close(),Z.serialized.bitmap=this.#h(!1))}return C}#Y(I){const{pageIndex:g,accessibilityData:{altText:C}}=this._initialData,A=I.pageIndex===g,l=(I.accessibilityData?.alt||"")===C;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&A&&l,isSameAltText:l}}renderAnnotationElement(I){return this.deleted?(I.hide(),null):(I.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class qI{#I;#g=!1;#A=null;#C=null;#Z=null;#i=new Map;#l=!1;#d=!1;#c=!1;#s=null;#m=null;#b=null;#B=null;#w=null;#W=-1;#G;static _initialized=!1;static#o=new Map([wI,zA,ud,lI,OI].map(I=>[I._editorType,I]));constructor({uiManager:I,pageIndex:g,div:C,structTreeLayer:A,accessibilityManager:l,annotationLayer:i,drawLayer:Z,textLayer:d,viewport:s,l10n:c}){const b=[...qI.#o.values()];if(!qI._initialized){qI._initialized=!0;for(const m of b)m.initialize(c,I)}I.registerEditorTypes(b),this.#G=I,this.pageIndex=g,this.div=C,this.#I=l,this.#A=i,this.viewport=s,this.#b=d,this.drawLayer=Z,this._structTree=A,this.#G.addLayer(this)}get isEmpty(){return this.#i.size===0}get isInvisible(){return this.isEmpty&&this.#G.getMode()===z.NONE}updateToolbar(I){this.#G.updateToolbar(I)}updateMode(I=this.#G.getMode()){switch(this.#n(),I){case z.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case z.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case z.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:g}=this.div;if(g.toggle("nonEditing",!1),I===z.POPUP)g.toggle("commentEditing",!0);else{g.toggle("commentEditing",!1);for(const C of qI.#o.values())g.toggle(`${C._type}Editing`,I===C._editorType)}this.div.hidden=!1}hasTextLayer(I){return I===this.#b?.div}setEditingState(I){this.#G.setEditingState(I)}addCommands(I){this.#G.addCommands(I)}cleanUndoStack(I){this.#G.cleanUndoStack(I)}toggleDrawing(I=!1){this.div.classList.toggle("drawing",!I)}togglePointerEvents(I=!1){this.div.classList.toggle("disabled",!I)}toggleAnnotationLayerPointerEvents(I=!1){this.#A?.togglePointerEvents(I)}get#h(){return this.#i.size!==0?this.#i.values():this.#G.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#w?.abort(),this.#w=null;const I=new Set;for(const C of this.#h)C.enableEditing(),C.show(!0),C.annotationElementId&&(this.#G.removeChangedExistingAnnotation(C),I.add(C.annotationElementId));const g=this.#A;if(g)for(const C of g.getEditableAnnotations()){if(C.hide(),this.#G.isDeletedAnnotationElement(C.data.id)||I.has(C.data.id))continue;const A=await this.deserialize(C);A&&(this.addOrRebuild(A),A.enableEditing())}this.#c=!1,this.#G._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#d=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#b&&!this.#w){this.#w=new AbortController;const A=this.#G.combinedSignal(this.#w);this.#b.div.addEventListener("pointerdown",l=>{const{clientX:Z,clientY:d,timeStamp:s}=l,c=this.#W;if(s-c>500){this.#W=s;return}this.#W=-1;const{classList:b}=this.div;b.toggle("getElements",!0);const m=document.elementsFromPoint(Z,d);if(b.toggle("getElements",!1),!this.div.contains(m[0]))return;let B;const W=new RegExp(`^${gC}[0-9]+$`);for(const h of m)if(W.test(h.id)){B=h.id;break}if(!B)return;const o=this.#i.get(B);o?.annotationElementId===null&&(l.stopPropagation(),l.preventDefault(),o.dblclick(l))},{signal:A,capture:!0})}const I=this.#A,g=[];if(I){const A=new Map,l=new Map;for(const Z of this.#h){if(Z.disableEditing(),!Z.annotationElementId){g.push(Z);continue}if(Z.serialize()!==null){A.set(Z.annotationElementId,Z);continue}else l.set(Z.annotationElementId,Z);this.getEditableAnnotation(Z.annotationElementId)?.show(),Z.remove()}const i=I.getEditableAnnotations();for(const Z of i){const{id:d}=Z.data;if(this.#G.isDeletedAnnotationElement(d)){Z.updateEdited({deleted:!0});continue}let s=l.get(d);if(s){s.resetAnnotationElement(Z),s.show(!1),Z.show();continue}s=A.get(d),s&&(this.#G.addChangedExistingAnnotation(s),s.renderAnnotationElement(Z)&&s.show(!1)),Z.show()}}this.#n(),this.isEmpty&&(this.div.hidden=!0);const{classList:C}=this.div;for(const A of qI.#o.values())C.remove(`${A._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),I?.updateFakeAnnotations(g),this.#d=!1}getEditableAnnotation(I){return this.#A?.getEditableAnnotation(I)||null}setActiveEditor(I){this.#G.getActive()!==I&&this.#G.setActiveEditor(I)}enableTextSelection(){if(this.div.tabIndex=-1,this.#b?.div&&!this.#B){this.#B=new AbortController;const I=this.#G.combinedSignal(this.#B);this.#b.div.addEventListener("pointerdown",this.#Y.bind(this),{signal:I}),this.#b.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#b?.div&&this.#B&&(this.#B.abort(),this.#B=null,this.#b.div.classList.remove("highlighting"))}#Y(I){this.#G.unselectAll();const{target:g}=I;if(g===this.#b.div||(g.getAttribute("role")==="img"||g.classList.contains("endOfContent"))&&this.#b.div.contains(g)){const{isMac:C}=BI.platform;if(I.button!==0||I.ctrlKey&&C)return;this.#G.showAllEditors("highlight",!0,!0),this.#b.div.classList.add("free"),this.toggleDrawing(),lI.startHighlighting(this,this.#G.direction==="ltr",{target:this.#b.div,x:I.x,y:I.y}),this.#b.div.addEventListener("pointerup",()=>{this.#b.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#G._signal}),I.preventDefault()}}enableClick(){if(this.#C)return;this.#C=new AbortController;const I=this.#G.combinedSignal(this.#C);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:I});const g=this.pointerup.bind(this);this.div.addEventListener("pointerup",g,{signal:I}),this.div.addEventListener("pointercancel",g,{signal:I})}disableClick(){this.#C?.abort(),this.#C=null}attach(I){this.#i.set(I.id,I);const{annotationElementId:g}=I;g&&this.#G.isDeletedAnnotationElement(g)&&this.#G.removeDeletedAnnotationElement(I)}detach(I){this.#i.delete(I.id),this.#I?.removePointerInTextLayer(I.contentDiv),!this.#d&&I.annotationElementId&&this.#G.addDeletedAnnotationElement(I)}remove(I){this.detach(I),this.#G.removeEditor(I),I.div.remove(),I.isAttachedToDOM=!1}changeParent(I){I.parent!==this&&(I.parent&&I.annotationElementId&&(this.#G.addDeletedAnnotationElement(I),K.deleteAnnotationElement(I),I.annotationElementId=null),this.attach(I),I.parent?.detach(I),I.setParent(this),I.div&&I.isAttachedToDOM&&(I.div.remove(),this.div.append(I.div)))}add(I){if(!(I.parent===this&&I.isAttachedToDOM)){if(this.changeParent(I),this.#G.addEditor(I),this.attach(I),!I.isAttachedToDOM){const g=I.render();this.div.append(g),I.isAttachedToDOM=!0}I.fixAndSetPosition(),I.onceAdded(!this.#c),this.#G.addToAnnotationStorage(I),I._reportTelemetry(I.telemetryInitialData)}}moveEditorInDOM(I){if(!I.isAttachedToDOM)return;const{activeElement:g}=document;I.div.contains(g)&&!this.#Z&&(I._focusEventsAllowed=!1,this.#Z=setTimeout(()=>{this.#Z=null,I.div.contains(document.activeElement)?I._focusEventsAllowed=!0:(I.div.addEventListener("focusin",()=>{I._focusEventsAllowed=!0},{once:!0,signal:this.#G._signal}),g.focus())},0)),I._structTreeParentId=this.#I?.moveElementInDOM(this.div,I.div,I.contentDiv,!0)}addOrRebuild(I){I.needsToBeRebuilt()?(I.parent||=this,I.rebuild(),I.show()):this.add(I)}addUndoableEditor(I){const g=()=>I._uiManager.rebuild(I),C=()=>{I.remove()};this.addCommands({cmd:g,undo:C,mustExec:!1})}getEditorByUID(I){for(const g of this.#i.values())if(g.uid===I)return g;return null}getNextId(){return this.#G.getId()}get#a(){return qI.#o.get(this.#G.getMode())}combinedSignal(I){return this.#G.combinedSignal(I)}#X(I){const g=this.#a;return g?new g.prototype.constructor(I):null}canCreateNewEmptyEditor(){return this.#a?.canCreateNewEmptyEditor()}async pasteEditor(I,g){this.updateToolbar(I),await this.#G.updateMode(I.mode);const{offsetX:C,offsetY:A}=this.#t(),l=this.getNextId(),i=this.#X({parent:this,id:l,x:C,y:A,uiManager:this.#G,isCentered:!0,...g});i&&this.add(i)}async deserialize(I){return await qI.#o.get(I.annotationType??I.annotationEditorType)?.deserialize(I,this,this.#G)||null}createAndAddNewEditor(I,g,C={}){const A=this.getNextId(),l=this.#X({parent:this,id:A,x:I.offsetX,y:I.offsetY,uiManager:this.#G,isCentered:g,...C});return l&&this.add(l),l}get boundingClientRect(){return this.div.getBoundingClientRect()}#t(){const{x:I,y:g,width:C,height:A}=this.boundingClientRect,l=Math.max(0,I),i=Math.max(0,g),Z=Math.min(window.innerWidth,I+C),d=Math.min(window.innerHeight,g+A),s=(l+Z)/2-I,c=(i+d)/2-g,[b,m]=this.viewport.rotation%180===0?[s,c]:[c,s];return{offsetX:b,offsetY:m}}addNewEditor(I={}){this.createAndAddNewEditor(this.#t(),!0,I)}setSelected(I){this.#G.setSelected(I)}toggleSelected(I){this.#G.toggleSelected(I)}unselect(I){this.#G.unselect(I)}pointerup(I){const{isMac:g}=BI.platform;if(I.button!==0||I.ctrlKey&&g||I.target!==this.div||!this.#l||(this.#l=!1,this.#a?.isDrawer&&this.#a.supportMultipleDrawings))return;if(!this.#g){this.#g=!0;return}const C=this.#G.getMode();if(C===z.STAMP||C===z.SIGNATURE){this.#G.unselectAll();return}this.createAndAddNewEditor(I,!1)}pointerdown(I){if(this.#G.getMode()===z.HIGHLIGHT&&this.enableTextSelection(),this.#l){this.#l=!1;return}const{isMac:g}=BI.platform;if(I.button!==0||I.ctrlKey&&g||I.target!==this.div)return;if(this.#l=!0,this.#a?.isDrawer){this.startDrawingSession(I);return}const C=this.#G.getActive();this.#g=!C||C.isEmpty()}startDrawingSession(I){if(this.div.focus({preventScroll:!0}),this.#s){this.#a.startDrawing(this,this.#G,!1,I);return}this.#G.setCurrentDrawingSession(this),this.#s=new AbortController;const g=this.#G.combinedSignal(this.#s);this.div.addEventListener("blur",({relatedTarget:C})=>{C&&!this.div.contains(C)&&(this.#m=null,this.commitOrRemove())},{signal:g}),this.#a.startDrawing(this,this.#G,!1,I)}pause(I){if(I){const{activeElement:g}=document;this.div.contains(g)&&(this.#m=g);return}this.#m&&setTimeout(()=>{this.#m?.focus(),this.#m=null},0)}endDrawingSession(I=!1){return this.#s?(this.#G.setCurrentDrawingSession(null),this.#s.abort(),this.#s=null,this.#m=null,this.#a.endDrawing(I)):null}findNewParent(I,g,C){const A=this.#G.findParent(g,C);return A===null||A===this?!1:(A.changeParent(I),!0)}commitOrRemove(){return this.#s?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#s&&this.#a.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#G.getActive()?.parent===this&&(this.#G.commitOrRemove(),this.#G.setActiveEditor(null)),this.#Z&&(clearTimeout(this.#Z),this.#Z=null);for(const I of this.#i.values())this.#I?.removePointerInTextLayer(I.contentDiv),I.setParent(null),I.isAttachedToDOM=!1,I.div.remove();this.div=null,this.#i.clear(),this.#G.removeLayer(this)}#n(){for(const I of this.#i.values())I.isEmpty()&&I.remove()}render({viewport:I}){this.viewport=I,Vg(this.div,I);for(const g of this.#G.getEditors(this.pageIndex))this.add(g),g.rebuild();this.updateMode()}update({viewport:I}){this.#G.commitOrRemove(),this.#n();const g=this.viewport.rotation,C=I.rotation;if(this.viewport=I,Vg(this.div,{rotation:C}),g!==C)for(const A of this.#i.values())A.rotate(C)}get pageDimensions(){const{pageWidth:I,pageHeight:g}=this.viewport.rawDims;return[I,g]}get scale(){return this.#G.viewParameters.realScale}}class YI{#I=null;#g=new Map;#A=new Map;static#C=0;constructor({pageIndex:I}){this.pageIndex=I}setParent(I){if(!this.#I){this.#I=I;return}if(this.#I!==I){if(this.#g.size>0)for(const g of this.#g.values())g.remove(),I.append(g);this.#I=I}}static get _svgFactory(){return J(this,"_svgFactory",new QC)}static#Z(I,[g,C,A,l]){const{style:i}=I;i.top=`${100*C}%`,i.left=`${100*g}%`,i.width=`${100*A}%`,i.height=`${100*l}%`}#i(){const I=YI._svgFactory.create(1,1,!0);return this.#I.append(I),I.setAttribute("aria-hidden",!0),I}#l(I,g){const C=YI._svgFactory.createElement("clipPath");I.append(C);const A=`clip_${g}`;C.setAttribute("id",A),C.setAttribute("clipPathUnits","objectBoundingBox");const l=YI._svgFactory.createElement("use");return C.append(l),l.setAttribute("href",`#${g}`),l.classList.add("clip"),A}#d(I,g){for(const[C,A]of Object.entries(g))A===null?I.removeAttribute(C):I.setAttribute(C,A)}draw(I,g=!1,C=!1){const A=YI.#C++,l=this.#i(),i=YI._svgFactory.createElement("defs");l.append(i);const Z=YI._svgFactory.createElement("path");i.append(Z);const d=`path_p${this.pageIndex}_${A}`;Z.setAttribute("id",d),Z.setAttribute("vector-effect","non-scaling-stroke"),g&&this.#A.set(A,Z);const s=C?this.#l(i,d):null,c=YI._svgFactory.createElement("use");return l.append(c),c.setAttribute("href",`#${d}`),this.updateProperties(l,I),this.#g.set(A,l),{id:A,clipPathId:`url(#${s})`}}drawOutline(I,g){const C=YI.#C++,A=this.#i(),l=YI._svgFactory.createElement("defs");A.append(l);const i=YI._svgFactory.createElement("path");l.append(i);const Z=`path_p${this.pageIndex}_${C}`;i.setAttribute("id",Z),i.setAttribute("vector-effect","non-scaling-stroke");let d;if(g){const b=YI._svgFactory.createElement("mask");l.append(b),d=`mask_p${this.pageIndex}_${C}`,b.setAttribute("id",d),b.setAttribute("maskUnits","objectBoundingBox");const m=YI._svgFactory.createElement("rect");b.append(m),m.setAttribute("width","1"),m.setAttribute("height","1"),m.setAttribute("fill","white");const B=YI._svgFactory.createElement("use");b.append(B),B.setAttribute("href",`#${Z}`),B.setAttribute("stroke","none"),B.setAttribute("fill","black"),B.setAttribute("fill-rule","nonzero"),B.classList.add("mask")}const s=YI._svgFactory.createElement("use");A.append(s),s.setAttribute("href",`#${Z}`),d&&s.setAttribute("mask",`url(#${d})`);const c=s.cloneNode();return A.append(c),s.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(A,I),this.#g.set(C,A),C}finalizeDraw(I,g){this.#A.delete(I),this.updateProperties(I,g)}updateProperties(I,g){if(!g)return;const{root:C,bbox:A,rootClass:l,path:i}=g,Z=typeof I=="number"?this.#g.get(I):I;if(Z){if(C&&this.#d(Z,C),A&&YI.#Z(Z,A),l){const{classList:d}=Z;for(const[s,c]of Object.entries(l))d.toggle(s,c)}if(i){const s=Z.firstElementChild.firstElementChild;this.#d(s,i)}}}updateParent(I,g){if(g===this)return;const C=this.#g.get(I);C&&(g.#I.append(C),this.#g.delete(I),g.#g.set(I,C))}remove(I){this.#A.delete(I),this.#I!==null&&(this.#g.get(I).remove(),this.#g.delete(I))}destroy(){this.#I=null;for(const I of this.#g.values())I.remove();this.#g.clear(),this.#A.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:FA},globalThis.pdfjsLib={AbortException:Ag,AnnotationEditorLayer:qI,AnnotationEditorParamsType:L,AnnotationEditorType:z,AnnotationEditorUIManager:lg,AnnotationLayer:pA,AnnotationMode:Cg,AnnotationType:ZI,applyOpacity:fi,build:ld,ColorPicker:zI,createValidAbsoluteUrl:Il,CSSConstants:Pi,DOMSVGFactory:QC,DrawLayer:YI,FeatureTest:BI,fetchData:ZC,findContrastColor:_i,getDocument:vl,getFilenameFromUrl:ri,getPdfFilenameFromUrl:Ui,getRGB:cC,getUuid:il,getXfaPageViewport:xi,GlobalWorkerOptions:Og,ImageKind:RC,InvalidPDFException:dA,isDataScheme:DC,isPdfFile:bA,isValidExplicitDest:sZ,MathClamp:nI,noContextMenu:pI,normalizeUnicode:Ti,OPS:CC,OutputScale:QI,PasswordResponses:Di,PDFDataRangeTransport:El,PDFDateString:mA,PDFWorker:wC,PermissionFlag:Mi,PixelsPerInch:Lg,RenderingCancelledException:GA,renderRichText:Bl,ResponseException:MC,setLayerDimensions:Vg,shadow:J,SignatureExtractor:Eg,stopEvent:CI,SupportedImageMimeTypes:BA,TextLayer:DI,TouchManager:SC,updateUrlHash:gl,Util:u,VerbosityLevel:yC,version:Ad,XfaLayer:dl};const nC="/api/gemini";console.log("Using API URL:",nC);const li=document.querySelectorAll(".tab-btn"),Hd=document.querySelectorAll(".tab-content");li.forEach(G=>{G.addEventListener("click",()=>{const I=G.getAttribute("data-tab");li.forEach(C=>C.classList.remove("active")),Hd.forEach(C=>C.classList.remove("active")),G.classList.add("active");const g=document.getElementById(I||"");g&&g.classList.add("active")})}),document.body.dataset.theme="light";const Pg=document.getElementById("modelModal"),Md=document.getElementById("closeModal"),Dd=document.getElementById("cancelModelSelection"),eC=document.getElementById("confirmModelSelection"),xI=document.getElementById("modelList"),xC=document.getElementById("modelLoadingState");let jA=null;async function Kd(){try{console.log("Fetching models from",nC);const G=await fetch(nC,{method:"GET"});if(console.log("Response status:",G.status),!G.ok){const g=await G.text();return console.error("Failed to fetch models:",g),[]}const I=await G.json();return console.log("Fetched models:",I),I.models||[]}catch(G){return console.error("Error fetching models:",G),[]}}async function Sd(G,I,g,C,A){console.log("Calling API endpoint:",nC),console.log("Model being sent:",I);const l={model:I,action:g};l.prompt=G;const i=await fetch(nC,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!i.ok){const Z=await i.text();throw console.error("API request failed:",Z),new Error(`API request failed: ${i.status}`)}return await i.json()}function pd(G,I,g){return new Promise(C=>{jA=null,Pg&&(Pg.style.display="flex");const A=document.getElementById("modalDescription");A&&(A.textContent=I),xC&&(xC.style.display="block"),xI&&(xI.style.display="none"),eC&&(eC.disabled=!0),Kd().then(Z=>{if(xC&&(xC.style.display="none"),Z.length===0){xI&&(xI.innerHTML='<p style="text-align: center; color: #999; padding: 20px;">⚠️ Could not fetch models from API.<br><br>Make sure your .env file has:<br><code style="background: #333; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-top: 8px;">GEMINI_API_KEY=your_key</code></p>',xI.style.display="block");return}let d=Z;d=Z.filter(s=>s.supportedGenerationMethods?.includes("generateContent")&&!s.name.includes("embedding")),xI&&(xI.innerHTML=d.map(s=>`
          <div class="model-item" data-model="${s.name}">
            <div class="model-name">${s.displayName||s.name.split("/").pop()}</div>
            <div class="model-description">${s.description||"No description available"}</div>
            <div class="model-capabilities">
              ${s.supportedGenerationMethods?.map(c=>`<span class="model-capability">${c}</span>`).join("")||""}
            </div>
          </div>
        `).join(""),xI.style.display="block",xI.querySelectorAll(".model-item").forEach(s=>{s.addEventListener("click",()=>{xI.querySelectorAll(".model-item").forEach(c=>c.classList.remove("selected")),s.classList.add("selected"),jA=s.getAttribute("data-model"),eC&&(eC.disabled=!1)})}))});const l=()=>{Pg&&(Pg.style.display="none"),C(null)},i=()=>{Pg&&(Pg.style.display="none"),C(jA)};Md?.addEventListener("click",l,{once:!0}),Dd?.addEventListener("click",l,{once:!0}),eC?.addEventListener("click",i,{once:!0})})}const $I=document.querySelector("#traceDropZone"),ii=document.querySelector("#traceFileInput"),QA=document.querySelector("#tracePreviewImage"),Zi=document.querySelector("#traceDropZoneText"),Ng=document.querySelector("#traceBtn");let ig=null;function di(G){if(!G.type.startsWith("image/")){vC("Please upload an image file","error");return}const I=new FileReader;I.onload=g=>{const C=g.target?.result,A=new Image;A.onload=()=>{ig=A,QA&&Zi&&$I&&Ng&&(QA.src=C,QA.style.display="block",Zi.textContent="✓ Image ready - Click button to trace",$I.classList.add("has-image"),Ng.style.display="block")},A.src=C},I.readAsDataURL(G)}$I?.addEventListener("click",()=>ii?.click()),ii?.addEventListener("change",G=>{const I=G.target.files?.[0];I&&di(I)}),$I?.addEventListener("dragover",G=>{G.preventDefault(),$I?.classList.add("drag-over")}),$I?.addEventListener("dragleave",()=>{$I?.classList.remove("drag-over")}),$I?.addEventListener("drop",G=>{G.preventDefault(),$I?.classList.remove("drag-over");const I=G.dataTransfer?.files[0];I&&di(I)}),Ng?.addEventListener("click",async G=>{G.preventDefault(),G.stopPropagation(),ig&&(vC("Tracing image to SVG...","loading"),Ng&&(Ng.disabled=!0),setTimeout(async()=>{try{if(!ig)return;const I=800;let g=ig.width,C=ig.height;if(g>I||C>I){const Z=I/Math.max(g,C);g=Math.floor(g*Z),C=Math.floor(C*Z),console.log(`Resizing image from ${ig.width}x${ig.height} to ${g}x${C}`)}const A=document.createElement("canvas");A.width=g,A.height=C;const l=A.getContext("2d");if(!l)throw new Error("Could not get canvas context");l.drawImage(ig,0,0,g,C);const i=$A.imagedataToSVG($A.getImgdata(A),{ltres:2,qtres:2,pathomit:4,colorsampling:2,numberofcolors:32,mincolorratio:.01,colorquantcycles:5,strokewidth:1,blurradius:0,blurdelta:20,scale:1,roundcoords:2});parent.postMessage({type:"import-svg",svg:i,offsetX:0},"*"),vC("✓ SVG traced and imported successfully!","success"),setTimeout(Fd,3e3)}catch(I){console.error("Tracing error:",I),vC("Failed to trace image","error")}finally{Ng&&(Ng.disabled=!1)}},100))});const fg=document.getElementById("imageEditorStatus");function vC(G,I){fg&&(fg.innerHTML=G.replace(/\n/g,"<br>"),fg.className=`status-message ${I}`)}function Fd(){fg&&(fg.textContent="",fg.className="status-message")}Og.workerSrc=new URL("data:text/javascript;base64,LyoqCiAqIEBsaWNzdGFydCBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQogKiBKYXZhU2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlCiAqCiAqIENvcHlyaWdodCAyMDI0IE1vemlsbGEgRm91bmRhdGlvbgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBAbGljZW5kIFRoZSBhYm92ZSBpcyB0aGUgZW50aXJlIGxpY2Vuc2Ugbm90aWNlIGZvciB0aGUKICogSmF2YVNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZQogKi8KCi8qKgogKiBwZGZqc1ZlcnNpb24gPSA1LjQuNTMwCiAqIHBkZmpzQnVpbGQgPSA1MGNjNGFkYWMKICovCi8qKioqKiovIC8vIFRoZSByZXF1aXJlIHNjb3BlCi8qKioqKiovIHZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307Ci8qKioqKiovIAovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMgKi8KLyoqKioqKi8gKCgpID0+IHsKLyoqKioqKi8gCS8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHMKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7Ci8qKioqKiovIAkJZm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikgewovKioqKioqLyAJCQlpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHsKLyoqKioqKi8gCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7Ci8qKioqKiovIAkJCX0KLyoqKioqKi8gCQl9Ci8qKioqKiovIAl9OwovKioqKioqLyB9KSgpOwovKioqKioqLyAKLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCAqLwovKioqKioqLyAoKCkgPT4gewovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKQovKioqKioqLyB9KSgpOwovKioqKioqLyAKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KdmFyIF9fd2VicGFja19leHBvcnRzX18gPSB7fTsKCjsvLyAuL3NyYy9zaGFyZWQvdXRpbC5qcwpjb25zdCBpc05vZGVKUyA9IHR5cGVvZiBwcm9jZXNzID09PSAib2JqZWN0IiAmJiBwcm9jZXNzICsgIiIgPT09ICJbb2JqZWN0IHByb2Nlc3NdIiAmJiAhcHJvY2Vzcy52ZXJzaW9ucy5udyAmJiAhKHByb2Nlc3MudmVyc2lvbnMuZWxlY3Ryb24gJiYgcHJvY2Vzcy50eXBlICYmIHByb2Nlc3MudHlwZSAhPT0gImJyb3dzZXIiKTsKY29uc3QgRk9OVF9JREVOVElUWV9NQVRSSVggPSBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXTsKY29uc3QgTElORV9GQUNUT1IgPSAxLjM1Owpjb25zdCBMSU5FX0RFU0NFTlRfRkFDVE9SID0gMC4zNTsKY29uc3QgQkFTRUxJTkVfRkFDVE9SID0gTElORV9ERVNDRU5UX0ZBQ1RPUiAvIExJTkVfRkFDVE9SOwpjb25zdCBSZW5kZXJpbmdJbnRlbnRGbGFnID0gewogIEFOWTogMHgwMSwKICBESVNQTEFZOiAweDAyLAogIFBSSU5UOiAweDA0LAogIFNBVkU6IDB4MDgsCiAgQU5OT1RBVElPTlNfRk9STVM6IDB4MTAsCiAgQU5OT1RBVElPTlNfU1RPUkFHRTogMHgyMCwKICBBTk5PVEFUSU9OU19ESVNBQkxFOiAweDQwLAogIElTX0VESVRJTkc6IDB4ODAsCiAgT1BMSVNUOiAweDEwMAp9Owpjb25zdCBBbm5vdGF0aW9uTW9kZSA9IHsKICBESVNBQkxFOiAwLAogIEVOQUJMRTogMSwKICBFTkFCTEVfRk9STVM6IDIsCiAgRU5BQkxFX1NUT1JBR0U6IDMKfTsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclByZWZpeCA9ICJwZGZqc19pbnRlcm5hbF9lZGl0b3JfIjsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclR5cGUgPSB7CiAgRElTQUJMRTogLTEsCiAgTk9ORTogMCwKICBGUkVFVEVYVDogMywKICBISUdITElHSFQ6IDksCiAgU1RBTVA6IDEzLAogIElOSzogMTUsCiAgUE9QVVA6IDE2LAogIFNJR05BVFVSRTogMTAxLAogIENPTU1FTlQ6IDEwMgp9Owpjb25zdCBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZSA9IHsKICBSRVNJWkU6IDEsCiAgQ1JFQVRFOiAyLAogIEZSRUVURVhUX1NJWkU6IDExLAogIEZSRUVURVhUX0NPTE9SOiAxMiwKICBGUkVFVEVYVF9PUEFDSVRZOiAxMywKICBJTktfQ09MT1I6IDIxLAogIElOS19USElDS05FU1M6IDIyLAogIElOS19PUEFDSVRZOiAyMywKICBISUdITElHSFRfQ09MT1I6IDMxLAogIEhJR0hMSUdIVF9USElDS05FU1M6IDMyLAogIEhJR0hMSUdIVF9GUkVFOiAzMywKICBISUdITElHSFRfU0hPV19BTEw6IDM0LAogIERSQVdfU1RFUDogNDEKfTsKY29uc3QgUGVybWlzc2lvbkZsYWcgPSB7CiAgUFJJTlQ6IDB4MDQsCiAgTU9ESUZZX0NPTlRFTlRTOiAweDA4LAogIENPUFk6IDB4MTAsCiAgTU9ESUZZX0FOTk9UQVRJT05TOiAweDIwLAogIEZJTExfSU5URVJBQ1RJVkVfRk9STVM6IDB4MTAwLAogIENPUFlfRk9SX0FDQ0VTU0lCSUxJVFk6IDB4MjAwLAogIEFTU0VNQkxFOiAweDQwMCwKICBQUklOVF9ISUdIX1FVQUxJVFk6IDB4ODAwCn07CmNvbnN0IE1lc2hGaWd1cmVUeXBlID0gewogIFRSSUFOR0xFUzogMSwKICBMQVRUSUNFOiAyLAogIFBBVENIOiAzCn07CmNvbnN0IFRleHRSZW5kZXJpbmdNb2RlID0gewogIEZJTEw6IDAsCiAgU1RST0tFOiAxLAogIEZJTExfU1RST0tFOiAyLAogIElOVklTSUJMRTogMywKICBGSUxMX0FERF9UT19QQVRIOiA0LAogIFNUUk9LRV9BRERfVE9fUEFUSDogNSwKICBGSUxMX1NUUk9LRV9BRERfVE9fUEFUSDogNiwKICBBRERfVE9fUEFUSDogNywKICBGSUxMX1NUUk9LRV9NQVNLOiAzLAogIEFERF9UT19QQVRIX0ZMQUc6IDQKfTsKY29uc3QgSW1hZ2VLaW5kID0gewogIEdSQVlTQ0FMRV8xQlBQOiAxLAogIFJHQl8yNEJQUDogMiwKICBSR0JBXzMyQlBQOiAzCn07CmNvbnN0IEFubm90YXRpb25UeXBlID0gewogIFRFWFQ6IDEsCiAgTElOSzogMiwKICBGUkVFVEVYVDogMywKICBMSU5FOiA0LAogIFNRVUFSRTogNSwKICBDSVJDTEU6IDYsCiAgUE9MWUdPTjogNywKICBQT0xZTElORTogOCwKICBISUdITElHSFQ6IDksCiAgVU5ERVJMSU5FOiAxMCwKICBTUVVJR0dMWTogMTEsCiAgU1RSSUtFT1VUOiAxMiwKICBTVEFNUDogMTMsCiAgQ0FSRVQ6IDE0LAogIElOSzogMTUsCiAgUE9QVVA6IDE2LAogIEZJTEVBVFRBQ0hNRU5UOiAxNywKICBTT1VORDogMTgsCiAgTU9WSUU6IDE5LAogIFdJREdFVDogMjAsCiAgU0NSRUVOOiAyMSwKICBQUklOVEVSTUFSSzogMjIsCiAgVFJBUE5FVDogMjMsCiAgV0FURVJNQVJLOiAyNCwKICBUSFJFRUQ6IDI1LAogIFJFREFDVDogMjYKfTsKY29uc3QgQW5ub3RhdGlvblJlcGx5VHlwZSA9IHsKICBHUk9VUDogIkdyb3VwIiwKICBSRVBMWTogIlIiCn07CmNvbnN0IEFubm90YXRpb25GbGFnID0gewogIElOVklTSUJMRTogMHgwMSwKICBISURERU46IDB4MDIsCiAgUFJJTlQ6IDB4MDQsCiAgTk9aT09NOiAweDA4LAogIE5PUk9UQVRFOiAweDEwLAogIE5PVklFVzogMHgyMCwKICBSRUFET05MWTogMHg0MCwKICBMT0NLRUQ6IDB4ODAsCiAgVE9HR0xFTk9WSUVXOiAweDEwMCwKICBMT0NLRURDT05URU5UUzogMHgyMDAKfTsKY29uc3QgQW5ub3RhdGlvbkZpZWxkRmxhZyA9IHsKICBSRUFET05MWTogMHgwMDAwMDAxLAogIFJFUVVJUkVEOiAweDAwMDAwMDIsCiAgTk9FWFBPUlQ6IDB4MDAwMDAwNCwKICBNVUxUSUxJTkU6IDB4MDAwMTAwMCwKICBQQVNTV09SRDogMHgwMDAyMDAwLAogIE5PVE9HR0xFVE9PRkY6IDB4MDAwNDAwMCwKICBSQURJTzogMHgwMDA4MDAwLAogIFBVU0hCVVRUT046IDB4MDAxMDAwMCwKICBDT01CTzogMHgwMDIwMDAwLAogIEVESVQ6IDB4MDA0MDAwMCwKICBTT1JUOiAweDAwODAwMDAsCiAgRklMRVNFTEVDVDogMHgwMTAwMDAwLAogIE1VTFRJU0VMRUNUOiAweDAyMDAwMDAsCiAgRE9OT1RTUEVMTENIRUNLOiAweDA0MDAwMDAsCiAgRE9OT1RTQ1JPTEw6IDB4MDgwMDAwMCwKICBDT01COiAweDEwMDAwMDAsCiAgUklDSFRFWFQ6IDB4MjAwMDAwMCwKICBSQURJT1NJTlVOSVNPTjogMHgyMDAwMDAwLAogIENPTU1JVE9OU0VMQ0hBTkdFOiAweDQwMDAwMDAKfTsKY29uc3QgQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZSA9IHsKICBTT0xJRDogMSwKICBEQVNIRUQ6IDIsCiAgQkVWRUxFRDogMywKICBJTlNFVDogNCwKICBVTkRFUkxJTkU6IDUKfTsKY29uc3QgQW5ub3RhdGlvbkFjdGlvbkV2ZW50VHlwZSA9IHsKICBFOiAiTW91c2UgRW50ZXIiLAogIFg6ICJNb3VzZSBFeGl0IiwKICBEOiAiTW91c2UgRG93biIsCiAgVTogIk1vdXNlIFVwIiwKICBGbzogIkZvY3VzIiwKICBCbDogIkJsdXIiLAogIFBPOiAiUGFnZU9wZW4iLAogIFBDOiAiUGFnZUNsb3NlIiwKICBQVjogIlBhZ2VWaXNpYmxlIiwKICBQSTogIlBhZ2VJbnZpc2libGUiLAogIEs6ICJLZXlzdHJva2UiLAogIEY6ICJGb3JtYXQiLAogIFY6ICJWYWxpZGF0ZSIsCiAgQzogIkNhbGN1bGF0ZSIKfTsKY29uc3QgRG9jdW1lbnRBY3Rpb25FdmVudFR5cGUgPSB7CiAgV0M6ICJXaWxsQ2xvc2UiLAogIFdTOiAiV2lsbFNhdmUiLAogIERTOiAiRGlkU2F2ZSIsCiAgV1A6ICJXaWxsUHJpbnQiLAogIERQOiAiRGlkUHJpbnQiCn07CmNvbnN0IFBhZ2VBY3Rpb25FdmVudFR5cGUgPSB7CiAgTzogIlBhZ2VPcGVuIiwKICBDOiAiUGFnZUNsb3NlIgp9Owpjb25zdCBWZXJib3NpdHlMZXZlbCA9IHsKICBFUlJPUlM6IDAsCiAgV0FSTklOR1M6IDEsCiAgSU5GT1M6IDUKfTsKY29uc3QgT1BTID0gewogIGRlcGVuZGVuY3k6IDEsCiAgc2V0TGluZVdpZHRoOiAyLAogIHNldExpbmVDYXA6IDMsCiAgc2V0TGluZUpvaW46IDQsCiAgc2V0TWl0ZXJMaW1pdDogNSwKICBzZXREYXNoOiA2LAogIHNldFJlbmRlcmluZ0ludGVudDogNywKICBzZXRGbGF0bmVzczogOCwKICBzZXRHU3RhdGU6IDksCiAgc2F2ZTogMTAsCiAgcmVzdG9yZTogMTEsCiAgdHJhbnNmb3JtOiAxMiwKICBtb3ZlVG86IDEzLAogIGxpbmVUbzogMTQsCiAgY3VydmVUbzogMTUsCiAgY3VydmVUbzI6IDE2LAogIGN1cnZlVG8zOiAxNywKICBjbG9zZVBhdGg6IDE4LAogIHJlY3RhbmdsZTogMTksCiAgc3Ryb2tlOiAyMCwKICBjbG9zZVN0cm9rZTogMjEsCiAgZmlsbDogMjIsCiAgZW9GaWxsOiAyMywKICBmaWxsU3Ryb2tlOiAyNCwKICBlb0ZpbGxTdHJva2U6IDI1LAogIGNsb3NlRmlsbFN0cm9rZTogMjYsCiAgY2xvc2VFT0ZpbGxTdHJva2U6IDI3LAogIGVuZFBhdGg6IDI4LAogIGNsaXA6IDI5LAogIGVvQ2xpcDogMzAsCiAgYmVnaW5UZXh0OiAzMSwKICBlbmRUZXh0OiAzMiwKICBzZXRDaGFyU3BhY2luZzogMzMsCiAgc2V0V29yZFNwYWNpbmc6IDM0LAogIHNldEhTY2FsZTogMzUsCiAgc2V0TGVhZGluZzogMzYsCiAgc2V0Rm9udDogMzcsCiAgc2V0VGV4dFJlbmRlcmluZ01vZGU6IDM4LAogIHNldFRleHRSaXNlOiAzOSwKICBtb3ZlVGV4dDogNDAsCiAgc2V0TGVhZGluZ01vdmVUZXh0OiA0MSwKICBzZXRUZXh0TWF0cml4OiA0MiwKICBuZXh0TGluZTogNDMsCiAgc2hvd1RleHQ6IDQ0LAogIHNob3dTcGFjZWRUZXh0OiA0NSwKICBuZXh0TGluZVNob3dUZXh0OiA0NiwKICBuZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dDogNDcsCiAgc2V0Q2hhcldpZHRoOiA0OCwKICBzZXRDaGFyV2lkdGhBbmRCb3VuZHM6IDQ5LAogIHNldFN0cm9rZUNvbG9yU3BhY2U6IDUwLAogIHNldEZpbGxDb2xvclNwYWNlOiA1MSwKICBzZXRTdHJva2VDb2xvcjogNTIsCiAgc2V0U3Ryb2tlQ29sb3JOOiA1MywKICBzZXRGaWxsQ29sb3I6IDU0LAogIHNldEZpbGxDb2xvck46IDU1LAogIHNldFN0cm9rZUdyYXk6IDU2LAogIHNldEZpbGxHcmF5OiA1NywKICBzZXRTdHJva2VSR0JDb2xvcjogNTgsCiAgc2V0RmlsbFJHQkNvbG9yOiA1OSwKICBzZXRTdHJva2VDTVlLQ29sb3I6IDYwLAogIHNldEZpbGxDTVlLQ29sb3I6IDYxLAogIHNoYWRpbmdGaWxsOiA2MiwKICBiZWdpbklubGluZUltYWdlOiA2MywKICBiZWdpbkltYWdlRGF0YTogNjQsCiAgZW5kSW5saW5lSW1hZ2U6IDY1LAogIHBhaW50WE9iamVjdDogNjYsCiAgbWFya1BvaW50OiA2NywKICBtYXJrUG9pbnRQcm9wczogNjgsCiAgYmVnaW5NYXJrZWRDb250ZW50OiA2OSwKICBiZWdpbk1hcmtlZENvbnRlbnRQcm9wczogNzAsCiAgZW5kTWFya2VkQ29udGVudDogNzEsCiAgYmVnaW5Db21wYXQ6IDcyLAogIGVuZENvbXBhdDogNzMsCiAgcGFpbnRGb3JtWE9iamVjdEJlZ2luOiA3NCwKICBwYWludEZvcm1YT2JqZWN0RW5kOiA3NSwKICBiZWdpbkdyb3VwOiA3NiwKICBlbmRHcm91cDogNzcsCiAgYmVnaW5Bbm5vdGF0aW9uOiA4MCwKICBlbmRBbm5vdGF0aW9uOiA4MSwKICBwYWludEltYWdlTWFza1hPYmplY3Q6IDgzLAogIHBhaW50SW1hZ2VNYXNrWE9iamVjdEdyb3VwOiA4NCwKICBwYWludEltYWdlWE9iamVjdDogODUsCiAgcGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q6IDg2LAogIHBhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXA6IDg3LAogIHBhaW50SW1hZ2VYT2JqZWN0UmVwZWF0OiA4OCwKICBwYWludEltYWdlTWFza1hPYmplY3RSZXBlYXQ6IDg5LAogIHBhaW50U29saWRDb2xvckltYWdlTWFzazogOTAsCiAgY29uc3RydWN0UGF0aDogOTEsCiAgc2V0U3Ryb2tlVHJhbnNwYXJlbnQ6IDkyLAogIHNldEZpbGxUcmFuc3BhcmVudDogOTMsCiAgcmF3RmlsbFBhdGg6IDk0Cn07CmNvbnN0IERyYXdPUFMgPSB7CiAgbW92ZVRvOiAwLAogIGxpbmVUbzogMSwKICBjdXJ2ZVRvOiAyLAogIHF1YWRyYXRpY0N1cnZlVG86IDMsCiAgY2xvc2VQYXRoOiA0Cn07CmNvbnN0IFBhc3N3b3JkUmVzcG9uc2VzID0gewogIE5FRURfUEFTU1dPUkQ6IDEsCiAgSU5DT1JSRUNUX1BBU1NXT1JEOiAyCn07CmxldCB2ZXJib3NpdHkgPSBWZXJib3NpdHlMZXZlbC5XQVJOSU5HUzsKZnVuY3Rpb24gc2V0VmVyYm9zaXR5TGV2ZWwobGV2ZWwpIHsKICBpZiAoTnVtYmVyLmlzSW50ZWdlcihsZXZlbCkpIHsKICAgIHZlcmJvc2l0eSA9IGxldmVsOwogIH0KfQpmdW5jdGlvbiBnZXRWZXJib3NpdHlMZXZlbCgpIHsKICByZXR1cm4gdmVyYm9zaXR5Owp9CmZ1bmN0aW9uIGluZm8obXNnKSB7CiAgaWYgKHZlcmJvc2l0eSA+PSBWZXJib3NpdHlMZXZlbC5JTkZPUykgewogICAgY29uc29sZS5pbmZvKGBJbmZvOiAke21zZ31gKTsKICB9Cn0KZnVuY3Rpb24gd2Fybihtc2cpIHsKICBpZiAodmVyYm9zaXR5ID49IFZlcmJvc2l0eUxldmVsLldBUk5JTkdTKSB7CiAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6ICR7bXNnfWApOwogIH0KfQpmdW5jdGlvbiB1bnJlYWNoYWJsZShtc2cpIHsKICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKfQpmdW5jdGlvbiBhc3NlcnQoY29uZCwgbXNnKSB7CiAgaWYgKCFjb25kKSB7CiAgICB1bnJlYWNoYWJsZShtc2cpOwogIH0KfQpmdW5jdGlvbiBfaXNWYWxpZFByb3RvY29sKHVybCkgewogIHN3aXRjaCAodXJsPy5wcm90b2NvbCkgewogICAgY2FzZSAiaHR0cDoiOgogICAgY2FzZSAiaHR0cHM6IjoKICAgIGNhc2UgImZ0cDoiOgogICAgY2FzZSAibWFpbHRvOiI6CiAgICBjYXNlICJ0ZWw6IjoKICAgICAgcmV0dXJuIHRydWU7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gZmFsc2U7CiAgfQp9CmZ1bmN0aW9uIGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwodXJsLCBiYXNlVXJsID0gbnVsbCwgb3B0aW9ucyA9IG51bGwpIHsKICBpZiAoIXVybCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChvcHRpb25zICYmIHR5cGVvZiB1cmwgPT09ICJzdHJpbmciKSB7CiAgICBpZiAob3B0aW9ucy5hZGREZWZhdWx0UHJvdG9jb2wgJiYgdXJsLnN0YXJ0c1dpdGgoInd3dy4iKSkgewogICAgICBjb25zdCBkb3RzID0gdXJsLm1hdGNoKC9cLi9nKTsKICAgICAgaWYgKGRvdHM/Lmxlbmd0aCA+PSAyKSB7CiAgICAgICAgdXJsID0gYGh0dHA6Ly8ke3VybH1gOwogICAgICB9CiAgICB9CiAgICBpZiAob3B0aW9ucy50cnlDb252ZXJ0RW5jb2RpbmcpIHsKICAgICAgdHJ5IHsKICAgICAgICB1cmwgPSBzdHJpbmdUb1VURjhTdHJpbmcodXJsKTsKICAgICAgfSBjYXRjaCB7fQogICAgfQogIH0KICBjb25zdCBhYnNvbHV0ZVVybCA9IGJhc2VVcmwgPyBVUkwucGFyc2UodXJsLCBiYXNlVXJsKSA6IFVSTC5wYXJzZSh1cmwpOwogIHJldHVybiBfaXNWYWxpZFByb3RvY29sKGFic29sdXRlVXJsKSA/IGFic29sdXRlVXJsIDogbnVsbDsKfQpmdW5jdGlvbiB1cGRhdGVVcmxIYXNoKHVybCwgaGFzaCwgYWxsb3dSZWwgPSBmYWxzZSkgewogIGNvbnN0IHJlcyA9IFVSTC5wYXJzZSh1cmwpOwogIGlmIChyZXMpIHsKICAgIHJlcy5oYXNoID0gaGFzaDsKICAgIHJldHVybiByZXMuaHJlZjsKICB9CiAgaWYgKGFsbG93UmVsICYmIGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwodXJsLCAiaHR0cDovL2V4YW1wbGUuY29tIikpIHsKICAgIHJldHVybiB1cmwuc3BsaXQoIiMiLCAxKVswXSArIGAke2hhc2ggPyBgIyR7aGFzaH1gIDogIiJ9YDsKICB9CiAgcmV0dXJuICIiOwp9CmZ1bmN0aW9uIHNoYWRvdyhvYmosIHByb3AsIHZhbHVlLCBub25TZXJpYWxpemFibGUgPSBmYWxzZSkgewogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHByb3AsIHsKICAgIHZhbHVlLAogICAgZW51bWVyYWJsZTogIW5vblNlcmlhbGl6YWJsZSwKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIHdyaXRhYmxlOiBmYWxzZQogIH0pOwogIHJldHVybiB2YWx1ZTsKfQpjb25zdCBCYXNlRXhjZXB0aW9uID0gZnVuY3Rpb24gQmFzZUV4Y2VwdGlvbkNsb3N1cmUoKSB7CiAgZnVuY3Rpb24gQmFzZUV4Y2VwdGlvbihtZXNzYWdlLCBuYW1lKSB7CiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgdGhpcy5uYW1lID0gbmFtZTsKICB9CiAgQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTsKICBCYXNlRXhjZXB0aW9uLmNvbnN0cnVjdG9yID0gQmFzZUV4Y2VwdGlvbjsKICByZXR1cm4gQmFzZUV4Y2VwdGlvbjsKfSgpOwpjbGFzcyBQYXNzd29yZEV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZywgY29kZSkgewogICAgc3VwZXIobXNnLCAiUGFzc3dvcmRFeGNlcHRpb24iKTsKICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgfQp9CmNsYXNzIFVua25vd25FcnJvckV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZywgZGV0YWlscykgewogICAgc3VwZXIobXNnLCAiVW5rbm93bkVycm9yRXhjZXB0aW9uIik7CiAgICB0aGlzLmRldGFpbHMgPSBkZXRhaWxzOwogIH0KfQpjbGFzcyBJbnZhbGlkUERGRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihtc2csICJJbnZhbGlkUERGRXhjZXB0aW9uIik7CiAgfQp9CmNsYXNzIFJlc3BvbnNlRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnLCBzdGF0dXMsIG1pc3NpbmcpIHsKICAgIHN1cGVyKG1zZywgIlJlc3BvbnNlRXhjZXB0aW9uIik7CiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1czsKICAgIHRoaXMubWlzc2luZyA9IG1pc3Npbmc7CiAgfQp9CmNsYXNzIEZvcm1hdEVycm9yIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihtc2csICJGb3JtYXRFcnJvciIpOwogIH0KfQpjbGFzcyBBYm9ydEV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiQWJvcnRFeGNlcHRpb24iKTsKICB9Cn0KZnVuY3Rpb24gYnl0ZXNUb1N0cmluZyhieXRlcykgewogIGlmICh0eXBlb2YgYnl0ZXMgIT09ICJvYmplY3QiIHx8IGJ5dGVzPy5sZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgdW5yZWFjaGFibGUoIkludmFsaWQgYXJndW1lbnQgZm9yIGJ5dGVzVG9TdHJpbmciKTsKICB9CiAgY29uc3QgbGVuZ3RoID0gYnl0ZXMubGVuZ3RoOwogIGNvbnN0IE1BWF9BUkdVTUVOVF9DT1VOVCA9IDgxOTI7CiAgaWYgKGxlbmd0aCA8IE1BWF9BUkdVTUVOVF9DT1VOVCkgewogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgYnl0ZXMpOwogIH0KICBjb25zdCBzdHJCdWYgPSBbXTsKICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSBNQVhfQVJHVU1FTlRfQ09VTlQpIHsKICAgIGNvbnN0IGNodW5rRW5kID0gTWF0aC5taW4oaSArIE1BWF9BUkdVTUVOVF9DT1VOVCwgbGVuZ3RoKTsKICAgIGNvbnN0IGNodW5rID0gYnl0ZXMuc3ViYXJyYXkoaSwgY2h1bmtFbmQpOwogICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBjaHVuaykpOwogIH0KICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHN0cmluZ1RvQnl0ZXMoc3RyKSB7CiAgaWYgKHR5cGVvZiBzdHIgIT09ICJzdHJpbmciKSB7CiAgICB1bnJlYWNoYWJsZSgiSW52YWxpZCBhcmd1bWVudCBmb3Igc3RyaW5nVG9CeXRlcyIpOwogIH0KICBjb25zdCBsZW5ndGggPSBzdHIubGVuZ3RoOwogIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICBieXRlc1tpXSA9IHN0ci5jaGFyQ29kZUF0KGkpICYgMHhmZjsKICB9CiAgcmV0dXJuIGJ5dGVzOwp9CmZ1bmN0aW9uIHN0cmluZzMyKHZhbHVlKSB7CiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodmFsdWUgPj4gMjQgJiAweGZmLCB2YWx1ZSA+PiAxNiAmIDB4ZmYsIHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwp9CmZ1bmN0aW9uIG9iamVjdFNpemUob2JqKSB7CiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubGVuZ3RoOwp9CmZ1bmN0aW9uIGlzTGl0dGxlRW5kaWFuKCkgewogIGNvbnN0IGJ1ZmZlcjggPSBuZXcgVWludDhBcnJheSg0KTsKICBidWZmZXI4WzBdID0gMTsKICBjb25zdCB2aWV3MzIgPSBuZXcgVWludDMyQXJyYXkoYnVmZmVyOC5idWZmZXIsIDAsIDEpOwogIHJldHVybiB2aWV3MzJbMF0gPT09IDE7Cn0KZnVuY3Rpb24gaXNFdmFsU3VwcG9ydGVkKCkgewogIHRyeSB7CiAgICBuZXcgRnVuY3Rpb24oIiIpOwogICAgcmV0dXJuIHRydWU7CiAgfSBjYXRjaCB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9CmNsYXNzIEZlYXR1cmVUZXN0IHsKICBzdGF0aWMgZ2V0IGlzTGl0dGxlRW5kaWFuKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNMaXR0bGVFbmRpYW4iLCBpc0xpdHRsZUVuZGlhbigpKTsKICB9CiAgc3RhdGljIGdldCBpc0V2YWxTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc0V2YWxTdXBwb3J0ZWQiLCBpc0V2YWxTdXBwb3J0ZWQoKSk7CiAgfQogIHN0YXRpYyBnZXQgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCIsIHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgIT09ICJ1bmRlZmluZWQiKTsKICB9CiAgc3RhdGljIGdldCBpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkIiwgdHlwZW9mIEltYWdlRGVjb2RlciAhPT0gInVuZGVmaW5lZCIpOwogIH0KICBzdGF0aWMgZ2V0IGlzRmxvYXQxNkFycmF5U3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNGbG9hdDE2QXJyYXlTdXBwb3J0ZWQiLCB0eXBlb2YgRmxvYXQxNkFycmF5ICE9PSAidW5kZWZpbmVkIik7CiAgfQogIHN0YXRpYyBnZXQgaXNTYW5pdGl6ZXJTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc1Nhbml0aXplclN1cHBvcnRlZCIsIHR5cGVvZiBTYW5pdGl6ZXIgIT09ICJ1bmRlZmluZWQiKTsKICB9CiAgc3RhdGljIGdldCBwbGF0Zm9ybSgpIHsKICAgIGNvbnN0IHsKICAgICAgcGxhdGZvcm0sCiAgICAgIHVzZXJBZ2VudAogICAgfSA9IG5hdmlnYXRvcjsKICAgIHJldHVybiBzaGFkb3codGhpcywgInBsYXRmb3JtIiwgewogICAgICBpc0FuZHJvaWQ6IHVzZXJBZ2VudC5pbmNsdWRlcygiQW5kcm9pZCIpLAogICAgICBpc0xpbnV4OiBwbGF0Zm9ybS5pbmNsdWRlcygiTGludXgiKSwKICAgICAgaXNNYWM6IHBsYXRmb3JtLmluY2x1ZGVzKCJNYWMiKSwKICAgICAgaXNXaW5kb3dzOiBwbGF0Zm9ybS5pbmNsdWRlcygiV2luIiksCiAgICAgIGlzRmlyZWZveDogdXNlckFnZW50LmluY2x1ZGVzKCJGaXJlZm94IikKICAgIH0pOwogIH0KICBzdGF0aWMgZ2V0IGlzQ1NTUm91bmRTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc0NTU1JvdW5kU3VwcG9ydGVkIiwgZ2xvYmFsVGhpcy5DU1M/LnN1cHBvcnRzPy4oIndpZHRoOiByb3VuZCgxLjVweCwgMXB4KSIpKTsKICB9Cn0KY29uc3QgaGV4TnVtYmVycyA9IEFycmF5LmZyb20oQXJyYXkoMjU2KS5rZXlzKCksIG4gPT4gbi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSk7CmNsYXNzIFV0aWwgewogIHN0YXRpYyBtYWtlSGV4Q29sb3IociwgZywgYikgewogICAgcmV0dXJuIGAjJHtoZXhOdW1iZXJzW3JdfSR7aGV4TnVtYmVyc1tnXX0ke2hleE51bWJlcnNbYl19YDsKICB9CiAgc3RhdGljIGRvbU1hdHJpeFRvVHJhbnNmb3JtKGRtKSB7CiAgICByZXR1cm4gW2RtLmEsIGRtLmIsIGRtLmMsIGRtLmQsIGRtLmUsIGRtLmZdOwogIH0KICBzdGF0aWMgc2NhbGVNaW5NYXgodHJhbnNmb3JtLCBtaW5NYXgpIHsKICAgIGxldCB0ZW1wOwogICAgaWYgKHRyYW5zZm9ybVswXSkgewogICAgICBpZiAodHJhbnNmb3JtWzBdIDwgMCkgewogICAgICAgIHRlbXAgPSBtaW5NYXhbMF07CiAgICAgICAgbWluTWF4WzBdID0gbWluTWF4WzJdOwogICAgICAgIG1pbk1heFsyXSA9IHRlbXA7CiAgICAgIH0KICAgICAgbWluTWF4WzBdICo9IHRyYW5zZm9ybVswXTsKICAgICAgbWluTWF4WzJdICo9IHRyYW5zZm9ybVswXTsKICAgICAgaWYgKHRyYW5zZm9ybVszXSA8IDApIHsKICAgICAgICB0ZW1wID0gbWluTWF4WzFdOwogICAgICAgIG1pbk1heFsxXSA9IG1pbk1heFszXTsKICAgICAgICBtaW5NYXhbM10gPSB0ZW1wOwogICAgICB9CiAgICAgIG1pbk1heFsxXSAqPSB0cmFuc2Zvcm1bM107CiAgICAgIG1pbk1heFszXSAqPSB0cmFuc2Zvcm1bM107CiAgICB9IGVsc2UgewogICAgICB0ZW1wID0gbWluTWF4WzBdOwogICAgICBtaW5NYXhbMF0gPSBtaW5NYXhbMV07CiAgICAgIG1pbk1heFsxXSA9IHRlbXA7CiAgICAgIHRlbXAgPSBtaW5NYXhbMl07CiAgICAgIG1pbk1heFsyXSA9IG1pbk1heFszXTsKICAgICAgbWluTWF4WzNdID0gdGVtcDsKICAgICAgaWYgKHRyYW5zZm9ybVsxXSA8IDApIHsKICAgICAgICB0ZW1wID0gbWluTWF4WzFdOwogICAgICAgIG1pbk1heFsxXSA9IG1pbk1heFszXTsKICAgICAgICBtaW5NYXhbM10gPSB0ZW1wOwogICAgICB9CiAgICAgIG1pbk1heFsxXSAqPSB0cmFuc2Zvcm1bMV07CiAgICAgIG1pbk1heFszXSAqPSB0cmFuc2Zvcm1bMV07CiAgICAgIGlmICh0cmFuc2Zvcm1bMl0gPCAwKSB7CiAgICAgICAgdGVtcCA9IG1pbk1heFswXTsKICAgICAgICBtaW5NYXhbMF0gPSBtaW5NYXhbMl07CiAgICAgICAgbWluTWF4WzJdID0gdGVtcDsKICAgICAgfQogICAgICBtaW5NYXhbMF0gKj0gdHJhbnNmb3JtWzJdOwogICAgICBtaW5NYXhbMl0gKj0gdHJhbnNmb3JtWzJdOwogICAgfQogICAgbWluTWF4WzBdICs9IHRyYW5zZm9ybVs0XTsKICAgIG1pbk1heFsxXSArPSB0cmFuc2Zvcm1bNV07CiAgICBtaW5NYXhbMl0gKz0gdHJhbnNmb3JtWzRdOwogICAgbWluTWF4WzNdICs9IHRyYW5zZm9ybVs1XTsKICB9CiAgc3RhdGljIHRyYW5zZm9ybShtMSwgbTIpIHsKICAgIHJldHVybiBbbTFbMF0gKiBtMlswXSArIG0xWzJdICogbTJbMV0sIG0xWzFdICogbTJbMF0gKyBtMVszXSAqIG0yWzFdLCBtMVswXSAqIG0yWzJdICsgbTFbMl0gKiBtMlszXSwgbTFbMV0gKiBtMlsyXSArIG0xWzNdICogbTJbM10sIG0xWzBdICogbTJbNF0gKyBtMVsyXSAqIG0yWzVdICsgbTFbNF0sIG0xWzFdICogbTJbNF0gKyBtMVszXSAqIG0yWzVdICsgbTFbNV1dOwogIH0KICBzdGF0aWMgbXVsdGlwbHlCeURPTU1hdHJpeChtLCBtZCkgewogICAgcmV0dXJuIFttWzBdICogbWQuYSArIG1bMl0gKiBtZC5iLCBtWzFdICogbWQuYSArIG1bM10gKiBtZC5iLCBtWzBdICogbWQuYyArIG1bMl0gKiBtZC5kLCBtWzFdICogbWQuYyArIG1bM10gKiBtZC5kLCBtWzBdICogbWQuZSArIG1bMl0gKiBtZC5mICsgbVs0XSwgbVsxXSAqIG1kLmUgKyBtWzNdICogbWQuZiArIG1bNV1dOwogIH0KICBzdGF0aWMgYXBwbHlUcmFuc2Zvcm0ocCwgbSwgcG9zID0gMCkgewogICAgY29uc3QgcDAgPSBwW3Bvc107CiAgICBjb25zdCBwMSA9IHBbcG9zICsgMV07CiAgICBwW3Bvc10gPSBwMCAqIG1bMF0gKyBwMSAqIG1bMl0gKyBtWzRdOwogICAgcFtwb3MgKyAxXSA9IHAwICogbVsxXSArIHAxICogbVszXSArIG1bNV07CiAgfQogIHN0YXRpYyBhcHBseVRyYW5zZm9ybVRvQmV6aWVyKHAsIHRyYW5zZm9ybSwgcG9zID0gMCkgewogICAgY29uc3QgbTAgPSB0cmFuc2Zvcm1bMF07CiAgICBjb25zdCBtMSA9IHRyYW5zZm9ybVsxXTsKICAgIGNvbnN0IG0yID0gdHJhbnNmb3JtWzJdOwogICAgY29uc3QgbTMgPSB0cmFuc2Zvcm1bM107CiAgICBjb25zdCBtNCA9IHRyYW5zZm9ybVs0XTsKICAgIGNvbnN0IG01ID0gdHJhbnNmb3JtWzVdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpICs9IDIpIHsKICAgICAgY29uc3QgcEkgPSBwW3BvcyArIGldOwogICAgICBjb25zdCBwSTEgPSBwW3BvcyArIGkgKyAxXTsKICAgICAgcFtwb3MgKyBpXSA9IHBJICogbTAgKyBwSTEgKiBtMiArIG00OwogICAgICBwW3BvcyArIGkgKyAxXSA9IHBJICogbTEgKyBwSTEgKiBtMyArIG01OwogICAgfQogIH0KICBzdGF0aWMgYXBwbHlJbnZlcnNlVHJhbnNmb3JtKHAsIG0pIHsKICAgIGNvbnN0IHAwID0gcFswXTsKICAgIGNvbnN0IHAxID0gcFsxXTsKICAgIGNvbnN0IGQgPSBtWzBdICogbVszXSAtIG1bMV0gKiBtWzJdOwogICAgcFswXSA9IChwMCAqIG1bM10gLSBwMSAqIG1bMl0gKyBtWzJdICogbVs1XSAtIG1bNF0gKiBtWzNdKSAvIGQ7CiAgICBwWzFdID0gKC1wMCAqIG1bMV0gKyBwMSAqIG1bMF0gKyBtWzRdICogbVsxXSAtIG1bNV0gKiBtWzBdKSAvIGQ7CiAgfQogIHN0YXRpYyBheGlhbEFsaWduZWRCb3VuZGluZ0JveChyZWN0LCB0cmFuc2Zvcm0sIG91dHB1dCkgewogICAgY29uc3QgbTAgPSB0cmFuc2Zvcm1bMF07CiAgICBjb25zdCBtMSA9IHRyYW5zZm9ybVsxXTsKICAgIGNvbnN0IG0yID0gdHJhbnNmb3JtWzJdOwogICAgY29uc3QgbTMgPSB0cmFuc2Zvcm1bM107CiAgICBjb25zdCBtNCA9IHRyYW5zZm9ybVs0XTsKICAgIGNvbnN0IG01ID0gdHJhbnNmb3JtWzVdOwogICAgY29uc3QgcjAgPSByZWN0WzBdOwogICAgY29uc3QgcjEgPSByZWN0WzFdOwogICAgY29uc3QgcjIgPSByZWN0WzJdOwogICAgY29uc3QgcjMgPSByZWN0WzNdOwogICAgbGV0IGEwID0gbTAgKiByMCArIG00OwogICAgbGV0IGEyID0gYTA7CiAgICBsZXQgYTEgPSBtMCAqIHIyICsgbTQ7CiAgICBsZXQgYTMgPSBhMTsKICAgIGxldCBiMCA9IG0zICogcjEgKyBtNTsKICAgIGxldCBiMiA9IGIwOwogICAgbGV0IGIxID0gbTMgKiByMyArIG01OwogICAgbGV0IGIzID0gYjE7CiAgICBpZiAobTEgIT09IDAgfHwgbTIgIT09IDApIHsKICAgICAgY29uc3QgbTFyMCA9IG0xICogcjA7CiAgICAgIGNvbnN0IG0xcjIgPSBtMSAqIHIyOwogICAgICBjb25zdCBtMnIxID0gbTIgKiByMTsKICAgICAgY29uc3QgbTJyMyA9IG0yICogcjM7CiAgICAgIGEwICs9IG0ycjE7CiAgICAgIGEzICs9IG0ycjE7CiAgICAgIGExICs9IG0ycjM7CiAgICAgIGEyICs9IG0ycjM7CiAgICAgIGIwICs9IG0xcjA7CiAgICAgIGIzICs9IG0xcjA7CiAgICAgIGIxICs9IG0xcjI7CiAgICAgIGIyICs9IG0xcjI7CiAgICB9CiAgICBvdXRwdXRbMF0gPSBNYXRoLm1pbihvdXRwdXRbMF0sIGEwLCBhMSwgYTIsIGEzKTsKICAgIG91dHB1dFsxXSA9IE1hdGgubWluKG91dHB1dFsxXSwgYjAsIGIxLCBiMiwgYjMpOwogICAgb3V0cHV0WzJdID0gTWF0aC5tYXgob3V0cHV0WzJdLCBhMCwgYTEsIGEyLCBhMyk7CiAgICBvdXRwdXRbM10gPSBNYXRoLm1heChvdXRwdXRbM10sIGIwLCBiMSwgYjIsIGIzKTsKICB9CiAgc3RhdGljIGludmVyc2VUcmFuc2Zvcm0obSkgewogICAgY29uc3QgZCA9IG1bMF0gKiBtWzNdIC0gbVsxXSAqIG1bMl07CiAgICByZXR1cm4gW21bM10gLyBkLCAtbVsxXSAvIGQsIC1tWzJdIC8gZCwgbVswXSAvIGQsIChtWzJdICogbVs1XSAtIG1bNF0gKiBtWzNdKSAvIGQsIChtWzRdICogbVsxXSAtIG1bNV0gKiBtWzBdKSAvIGRdOwogIH0KICBzdGF0aWMgc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUobWF0cml4LCBvdXRwdXQpIHsKICAgIGNvbnN0IG0wID0gbWF0cml4WzBdOwogICAgY29uc3QgbTEgPSBtYXRyaXhbMV07CiAgICBjb25zdCBtMiA9IG1hdHJpeFsyXTsKICAgIGNvbnN0IG0zID0gbWF0cml4WzNdOwogICAgY29uc3QgYSA9IG0wICoqIDIgKyBtMSAqKiAyOwogICAgY29uc3QgYiA9IG0wICogbTIgKyBtMSAqIG0zOwogICAgY29uc3QgYyA9IG0yICoqIDIgKyBtMyAqKiAyOwogICAgY29uc3QgZmlyc3QgPSAoYSArIGMpIC8gMjsKICAgIGNvbnN0IHNlY29uZCA9IE1hdGguc3FydChmaXJzdCAqKiAyIC0gKGEgKiBjIC0gYiAqKiAyKSk7CiAgICBvdXRwdXRbMF0gPSBNYXRoLnNxcnQoZmlyc3QgKyBzZWNvbmQgfHwgMSk7CiAgICBvdXRwdXRbMV0gPSBNYXRoLnNxcnQoZmlyc3QgLSBzZWNvbmQgfHwgMSk7CiAgfQogIHN0YXRpYyBub3JtYWxpemVSZWN0KHJlY3QpIHsKICAgIGNvbnN0IHIgPSByZWN0LnNsaWNlKDApOwogICAgaWYgKHJlY3RbMF0gPiByZWN0WzJdKSB7CiAgICAgIHJbMF0gPSByZWN0WzJdOwogICAgICByWzJdID0gcmVjdFswXTsKICAgIH0KICAgIGlmIChyZWN0WzFdID4gcmVjdFszXSkgewogICAgICByWzFdID0gcmVjdFszXTsKICAgICAgclszXSA9IHJlY3RbMV07CiAgICB9CiAgICByZXR1cm4gcjsKICB9CiAgc3RhdGljIGludGVyc2VjdChyZWN0MSwgcmVjdDIpIHsKICAgIGNvbnN0IHhMb3cgPSBNYXRoLm1heChNYXRoLm1pbihyZWN0MVswXSwgcmVjdDFbMl0pLCBNYXRoLm1pbihyZWN0MlswXSwgcmVjdDJbMl0pKTsKICAgIGNvbnN0IHhIaWdoID0gTWF0aC5taW4oTWF0aC5tYXgocmVjdDFbMF0sIHJlY3QxWzJdKSwgTWF0aC5tYXgocmVjdDJbMF0sIHJlY3QyWzJdKSk7CiAgICBpZiAoeExvdyA+IHhIaWdoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgeUxvdyA9IE1hdGgubWF4KE1hdGgubWluKHJlY3QxWzFdLCByZWN0MVszXSksIE1hdGgubWluKHJlY3QyWzFdLCByZWN0MlszXSkpOwogICAgY29uc3QgeUhpZ2ggPSBNYXRoLm1pbihNYXRoLm1heChyZWN0MVsxXSwgcmVjdDFbM10pLCBNYXRoLm1heChyZWN0MlsxXSwgcmVjdDJbM10pKTsKICAgIGlmICh5TG93ID4geUhpZ2gpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gW3hMb3csIHlMb3csIHhIaWdoLCB5SGlnaF07CiAgfQogIHN0YXRpYyBwb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCkgewogICAgbWluTWF4WzBdID0gTWF0aC5taW4obWluTWF4WzBdLCB4KTsKICAgIG1pbk1heFsxXSA9IE1hdGgubWluKG1pbk1heFsxXSwgeSk7CiAgICBtaW5NYXhbMl0gPSBNYXRoLm1heChtaW5NYXhbMl0sIHgpOwogICAgbWluTWF4WzNdID0gTWF0aC5tYXgobWluTWF4WzNdLCB5KTsKICB9CiAgc3RhdGljIHJlY3RCb3VuZGluZ0JveCh4MCwgeTAsIHgxLCB5MSwgbWluTWF4KSB7CiAgICBtaW5NYXhbMF0gPSBNYXRoLm1pbihtaW5NYXhbMF0sIHgwLCB4MSk7CiAgICBtaW5NYXhbMV0gPSBNYXRoLm1pbihtaW5NYXhbMV0sIHkwLCB5MSk7CiAgICBtaW5NYXhbMl0gPSBNYXRoLm1heChtaW5NYXhbMl0sIHgwLCB4MSk7CiAgICBtaW5NYXhbM10gPSBNYXRoLm1heChtaW5NYXhbM10sIHkwLCB5MSk7CiAgfQogIHN0YXRpYyAjZ2V0RXh0cmVtdW1PbkN1cnZlKHgwLCB4MSwgeDIsIHgzLCB5MCwgeTEsIHkyLCB5MywgdCwgbWluTWF4KSB7CiAgICBpZiAodCA8PSAwIHx8IHQgPj0gMSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBtdCA9IDEgLSB0OwogICAgY29uc3QgdHQgPSB0ICogdDsKICAgIGNvbnN0IHR0dCA9IHR0ICogdDsKICAgIGNvbnN0IHggPSBtdCAqIChtdCAqIChtdCAqIHgwICsgMyAqIHQgKiB4MSkgKyAzICogdHQgKiB4MikgKyB0dHQgKiB4MzsKICAgIGNvbnN0IHkgPSBtdCAqIChtdCAqIChtdCAqIHkwICsgMyAqIHQgKiB5MSkgKyAzICogdHQgKiB5MikgKyB0dHQgKiB5MzsKICAgIG1pbk1heFswXSA9IE1hdGgubWluKG1pbk1heFswXSwgeCk7CiAgICBtaW5NYXhbMV0gPSBNYXRoLm1pbihtaW5NYXhbMV0sIHkpOwogICAgbWluTWF4WzJdID0gTWF0aC5tYXgobWluTWF4WzJdLCB4KTsKICAgIG1pbk1heFszXSA9IE1hdGgubWF4KG1pbk1heFszXSwgeSk7CiAgfQogIHN0YXRpYyAjZ2V0RXh0cmVtdW0oeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCBhLCBiLCBjLCBtaW5NYXgpIHsKICAgIGlmIChNYXRoLmFicyhhKSA8IDFlLTEyKSB7CiAgICAgIGlmIChNYXRoLmFicyhiKSA+PSAxZS0xMikgewogICAgICAgIHRoaXMuI2dldEV4dHJlbXVtT25DdXJ2ZSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsIC1jIC8gYiwgbWluTWF4KTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBkZWx0YSA9IGIgKiogMiAtIDQgKiBjICogYTsKICAgIGlmIChkZWx0YSA8IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3FydERlbHRhID0gTWF0aC5zcXJ0KGRlbHRhKTsKICAgIGNvbnN0IGEyID0gMiAqIGE7CiAgICB0aGlzLiNnZXRFeHRyZW11bU9uQ3VydmUoeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCAoLWIgKyBzcXJ0RGVsdGEpIC8gYTIsIG1pbk1heCk7CiAgICB0aGlzLiNnZXRFeHRyZW11bU9uQ3VydmUoeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCAoLWIgLSBzcXJ0RGVsdGEpIC8gYTIsIG1pbk1heCk7CiAgfQogIHN0YXRpYyBiZXppZXJCb3VuZGluZ0JveCh4MCwgeTAsIHgxLCB5MSwgeDIsIHkyLCB4MywgeTMsIG1pbk1heCkgewogICAgbWluTWF4WzBdID0gTWF0aC5taW4obWluTWF4WzBdLCB4MCwgeDMpOwogICAgbWluTWF4WzFdID0gTWF0aC5taW4obWluTWF4WzFdLCB5MCwgeTMpOwogICAgbWluTWF4WzJdID0gTWF0aC5tYXgobWluTWF4WzJdLCB4MCwgeDMpOwogICAgbWluTWF4WzNdID0gTWF0aC5tYXgobWluTWF4WzNdLCB5MCwgeTMpOwogICAgdGhpcy4jZ2V0RXh0cmVtdW0oeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCAzICogKC14MCArIDMgKiAoeDEgLSB4MikgKyB4MyksIDYgKiAoeDAgLSAyICogeDEgKyB4MiksIDMgKiAoeDEgLSB4MCksIG1pbk1heCk7CiAgICB0aGlzLiNnZXRFeHRyZW11bSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsIDMgKiAoLXkwICsgMyAqICh5MSAtIHkyKSArIHkzKSwgNiAqICh5MCAtIDIgKiB5MSArIHkyKSwgMyAqICh5MSAtIHkwKSwgbWluTWF4KTsKICB9Cn0KY29uc3QgUERGU3RyaW5nVHJhbnNsYXRlVGFibGUgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMHgyZDgsIDB4MmM3LCAweDJjNiwgMHgyZDksIDB4MmRkLCAweDJkYiwgMHgyZGEsIDB4MmRjLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAweDIwMjIsIDB4MjAyMCwgMHgyMDIxLCAweDIwMjYsIDB4MjAxNCwgMHgyMDEzLCAweDE5MiwgMHgyMDQ0LCAweDIwMzksIDB4MjAzYSwgMHgyMjEyLCAweDIwMzAsIDB4MjAxZSwgMHgyMDFjLCAweDIwMWQsIDB4MjAxOCwgMHgyMDE5LCAweDIwMWEsIDB4MjEyMiwgMHhmYjAxLCAweGZiMDIsIDB4MTQxLCAweDE1MiwgMHgxNjAsIDB4MTc4LCAweDE3ZCwgMHgxMzEsIDB4MTQyLCAweDE1MywgMHgxNjEsIDB4MTdlLCAwLCAweDIwYWNdOwpmdW5jdGlvbiBzdHJpbmdUb1BERlN0cmluZyhzdHIsIGtlZXBFc2NhcGVTZXF1ZW5jZSA9IGZhbHNlKSB7CiAgaWYgKHN0clswXSA+PSAiXHhFRiIpIHsKICAgIGxldCBlbmNvZGluZzsKICAgIGlmIChzdHJbMF0gPT09ICJceEZFIiAmJiBzdHJbMV0gPT09ICJceEZGIikgewogICAgICBlbmNvZGluZyA9ICJ1dGYtMTZiZSI7CiAgICAgIGlmIChzdHIubGVuZ3RoICUgMiA9PT0gMSkgewogICAgICAgIHN0ciA9IHN0ci5zbGljZSgwLCAtMSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoc3RyWzBdID09PSAiXHhGRiIgJiYgc3RyWzFdID09PSAiXHhGRSIpIHsKICAgICAgZW5jb2RpbmcgPSAidXRmLTE2bGUiOwogICAgICBpZiAoc3RyLmxlbmd0aCAlIDIgPT09IDEpIHsKICAgICAgICBzdHIgPSBzdHIuc2xpY2UoMCwgLTEpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHN0clswXSA9PT0gIlx4RUYiICYmIHN0clsxXSA9PT0gIlx4QkIiICYmIHN0clsyXSA9PT0gIlx4QkYiKSB7CiAgICAgIGVuY29kaW5nID0gInV0Zi04IjsKICAgIH0KICAgIGlmIChlbmNvZGluZykgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmcsIHsKICAgICAgICAgIGZhdGFsOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgYnVmZmVyID0gc3RyaW5nVG9CeXRlcyhzdHIpOwogICAgICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGVyLmRlY29kZShidWZmZXIpOwogICAgICAgIGlmIChrZWVwRXNjYXBlU2VxdWVuY2UgfHwgIWRlY29kZWQuaW5jbHVkZXMoIlx4MWIiKSkgewogICAgICAgICAgcmV0dXJuIGRlY29kZWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZWNvZGVkLnJlcGxhY2VBbGwoL1x4MWJbXlx4MWJdKig/Olx4MWJ8JCkvZywgIiIpOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHdhcm4oYHN0cmluZ1RvUERGU3RyaW5nOiAiJHtleH0iLmApOwogICAgICB9CiAgICB9CiAgfQogIGNvbnN0IHN0ckJ1ZiA9IFtdOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBjaGFyQ29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgaWYgKCFrZWVwRXNjYXBlU2VxdWVuY2UgJiYgY2hhckNvZGUgPT09IDB4MWIpIHsKICAgICAgd2hpbGUgKCsraSA8IGlpICYmIHN0ci5jaGFyQ29kZUF0KGkpICE9PSAweDFiKSB7fQogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGNvZGUgPSBQREZTdHJpbmdUcmFuc2xhdGVUYWJsZVtjaGFyQ29kZV07CiAgICBzdHJCdWYucHVzaChjb2RlID8gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSA6IHN0ci5jaGFyQXQoaSkpOwogIH0KICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHN0cmluZ1RvVVRGOFN0cmluZyhzdHIpIHsKICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShzdHIpKTsKfQpmdW5jdGlvbiB1dGY4U3RyaW5nVG9TdHJpbmcoc3RyKSB7CiAgcmV0dXJuIHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzdHIpKTsKfQpmdW5jdGlvbiBpc0FycmF5RXF1YWwoYXJyMSwgYXJyMikgewogIGlmIChhcnIxLmxlbmd0aCAhPT0gYXJyMi5sZW5ndGgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gYXJyMS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBpZiAoYXJyMVtpXSAhPT0gYXJyMltpXSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGdldE1vZGlmaWNhdGlvbkRhdGUoZGF0ZSA9IG5ldyBEYXRlKCkpIHsKICBpZiAoIShkYXRlIGluc3RhbmNlb2YgRGF0ZSkpIHsKICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTsKICB9CiAgY29uc3QgYnVmZmVyID0gW2RhdGUuZ2V0VVRDRnVsbFllYXIoKS50b1N0cmluZygpLCAoZGF0ZS5nZXRVVENNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpLCBkYXRlLmdldFVUQ0RhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIiksIGRhdGUuZ2V0VVRDSG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIiksIGRhdGUuZ2V0VVRDTWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKSwgZGF0ZS5nZXRVVENTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpXTsKICByZXR1cm4gYnVmZmVyLmpvaW4oIiIpOwp9CmxldCBOb3JtYWxpemVSZWdleCA9IG51bGw7CmxldCBOb3JtYWxpemF0aW9uTWFwID0gbnVsbDsKZnVuY3Rpb24gbm9ybWFsaXplVW5pY29kZShzdHIpIHsKICBpZiAoIU5vcm1hbGl6ZVJlZ2V4KSB7CiAgICBOb3JtYWxpemVSZWdleCA9IC8oW1x1MDBhMFx1MDBiNVx1MDM3ZVx1MGViM1x1MjAwMC1cdTIwMGFcdTIwMmZcdTIxMjZcdWZiMDAtXHVmYjA0XHVmYjA2XHVmYjIwLVx1ZmIzNlx1ZmIzOC1cdWZiM2NcdWZiM2VcdWZiNDAtXHVmYjQxXHVmYjQzLVx1ZmI0NFx1ZmI0Ni1cdWZiYTFcdWZiYTQtXHVmYmE5XHVmYmFlLVx1ZmJiMVx1ZmJkMy1cdWZiZGNcdWZiZGUtXHVmYmU3XHVmYmVhLVx1ZmJmOFx1ZmJmYy1cdWZiZmRcdWZjMDAtXHVmYzVkXHVmYzY0LVx1ZmNmMVx1ZmNmNS1cdWZkM2RcdWZkODhcdWZkZjRcdWZkZmEtXHVmZGZiXHVmZTcxXHVmZTc3XHVmZTc5XHVmZTdiXHVmZTdkXSspfChcdWZiMDUrKS9ndTsKICAgIE5vcm1hbGl6YXRpb25NYXAgPSBuZXcgTWFwKFtbIu+shSIsICLFv3QiXV0pOwogIH0KICByZXR1cm4gc3RyLnJlcGxhY2VBbGwoTm9ybWFsaXplUmVnZXgsIChfLCBwMSwgcDIpID0+IHAxID8gcDEubm9ybWFsaXplKCJORktDIikgOiBOb3JtYWxpemF0aW9uTWFwLmdldChwMikpOwp9CmZ1bmN0aW9uIGdldFV1aWQoKSB7CiAgaWYgKHR5cGVvZiBjcnlwdG8ucmFuZG9tVVVJRCA9PT0gImZ1bmN0aW9uIikgewogICAgcmV0dXJuIGNyeXB0by5yYW5kb21VVUlEKCk7CiAgfQogIGNvbnN0IGJ1ZiA9IG5ldyBVaW50OEFycmF5KDMyKTsKICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGJ1Zik7CiAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoYnVmKTsKfQpjb25zdCBBbm5vdGF0aW9uUHJlZml4ID0gInBkZmpzX2ludGVybmFsX2lkXyI7CmZ1bmN0aW9uIF9pc1ZhbGlkRXhwbGljaXREZXN0KHZhbGlkUmVmLCB2YWxpZE5hbWUsIGRlc3QpIHsKICBpZiAoIUFycmF5LmlzQXJyYXkoZGVzdCkgfHwgZGVzdC5sZW5ndGggPCAyKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbnN0IFtwYWdlLCB6b29tLCAuLi5hcmdzXSA9IGRlc3Q7CiAgaWYgKCF2YWxpZFJlZihwYWdlKSAmJiAhTnVtYmVyLmlzSW50ZWdlcihwYWdlKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoIXZhbGlkTmFtZSh6b29tKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCBhcmdzTGVuID0gYXJncy5sZW5ndGg7CiAgbGV0IGFsbG93TnVsbCA9IHRydWU7CiAgc3dpdGNoICh6b29tLm5hbWUpIHsKICAgIGNhc2UgIlhZWiI6CiAgICAgIGlmIChhcmdzTGVuIDwgMiB8fCBhcmdzTGVuID4gMykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIkZpdCI6CiAgICBjYXNlICJGaXRCIjoKICAgICAgcmV0dXJuIGFyZ3NMZW4gPT09IDA7CiAgICBjYXNlICJGaXRIIjoKICAgIGNhc2UgIkZpdEJIIjoKICAgIGNhc2UgIkZpdFYiOgogICAgY2FzZSAiRml0QlYiOgogICAgICBpZiAoYXJnc0xlbiA+IDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJGaXRSIjoKICAgICAgaWYgKGFyZ3NMZW4gIT09IDQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgYWxsb3dOdWxsID0gZmFsc2U7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlOwogIH0KICBmb3IgKGNvbnN0IGFyZyBvZiBhcmdzKSB7CiAgICBpZiAodHlwZW9mIGFyZyA9PT0gIm51bWJlciIgfHwgYWxsb3dOdWxsICYmIGFyZyA9PT0gbnVsbCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuIHRydWU7Cn0KZnVuY3Rpb24gTWF0aENsYW1wKHYsIG1pbiwgbWF4KSB7CiAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHYsIG1pbiksIG1heCk7Cn0KZnVuY3Rpb24gdG9IZXhVdGlsKGFycikgewogIGlmIChVaW50OEFycmF5LnByb3RvdHlwZS50b0hleCkgewogICAgcmV0dXJuIGFyci50b0hleCgpOwogIH0KICByZXR1cm4gQXJyYXkuZnJvbShhcnIsIG51bSA9PiBoZXhOdW1iZXJzW251bV0pLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHRvQmFzZTY0VXRpbChhcnIpIHsKICBpZiAoVWludDhBcnJheS5wcm90b3R5cGUudG9CYXNlNjQpIHsKICAgIHJldHVybiBhcnIudG9CYXNlNjQoKTsKICB9CiAgcmV0dXJuIGJ0b2EoYnl0ZXNUb1N0cmluZyhhcnIpKTsKfQpmdW5jdGlvbiBmcm9tQmFzZTY0VXRpbChzdHIpIHsKICBpZiAoVWludDhBcnJheS5mcm9tQmFzZTY0KSB7CiAgICByZXR1cm4gVWludDhBcnJheS5mcm9tQmFzZTY0KHN0cik7CiAgfQogIHJldHVybiBzdHJpbmdUb0J5dGVzKGF0b2Ioc3RyKSk7Cn0KaWYgKHR5cGVvZiBQcm9taXNlLnRyeSAhPT0gImZ1bmN0aW9uIikgewogIFByb21pc2UudHJ5ID0gZnVuY3Rpb24gKGZuLCAuLi5hcmdzKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpOwogICAgfSk7CiAgfTsKfQppZiAodHlwZW9mIE1hdGguc3VtUHJlY2lzZSAhPT0gImZ1bmN0aW9uIikgewogIE1hdGguc3VtUHJlY2lzZSA9IGZ1bmN0aW9uIChudW1iZXJzKSB7CiAgICByZXR1cm4gbnVtYmVycy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTsKICB9Owp9Cgo7Ly8gLi9zcmMvY29yZS9wcmltaXRpdmVzLmpzCgpjb25zdCBDSVJDVUxBUl9SRUYgPSBTeW1ib2woIkNJUkNVTEFSX1JFRiIpOwpjb25zdCBFT0YgPSBTeW1ib2woIkVPRiIpOwpsZXQgQ21kQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwpsZXQgTmFtZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKbGV0IFJlZkNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKZnVuY3Rpb24gY2xlYXJQcmltaXRpdmVDYWNoZXMoKSB7CiAgQ21kQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIE5hbWVDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgUmVmQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwp9CmNsYXNzIE5hbWUgewogIGNvbnN0cnVjdG9yKG5hbWUpIHsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgfQogIHN0YXRpYyBnZXQobmFtZSkgewogICAgcmV0dXJuIE5hbWVDYWNoZVtuYW1lXSB8fD0gbmV3IE5hbWUobmFtZSk7CiAgfQp9CmNsYXNzIENtZCB7CiAgY29uc3RydWN0b3IoY21kKSB7CiAgICB0aGlzLmNtZCA9IGNtZDsKICB9CiAgc3RhdGljIGdldChjbWQpIHsKICAgIHJldHVybiBDbWRDYWNoZVtjbWRdIHx8PSBuZXcgQ21kKGNtZCk7CiAgfQp9CmNvbnN0IG5vblNlcmlhbGl6YWJsZSA9IGZ1bmN0aW9uIG5vblNlcmlhbGl6YWJsZUNsb3N1cmUoKSB7CiAgcmV0dXJuIG5vblNlcmlhbGl6YWJsZTsKfTsKY2xhc3MgRGljdCB7CiAgY29uc3RydWN0b3IoeHJlZiA9IG51bGwpIHsKICAgIHRoaXMuX21hcCA9IG5ldyBNYXAoKTsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLm9iaklkID0gbnVsbDsKICAgIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2U7CiAgICB0aGlzLl9fbm9uU2VyaWFsaXphYmxlX18gPSBub25TZXJpYWxpemFibGU7CiAgfQogIGFzc2lnblhyZWYobmV3WHJlZikgewogICAgdGhpcy54cmVmID0gbmV3WHJlZjsKICB9CiAgZ2V0IHNpemUoKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLnNpemU7CiAgfQogIGdldChrZXkxLCBrZXkyLCBrZXkzKSB7CiAgICBsZXQgdmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleTEpOwogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkyKTsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleTMpOwogICAgICB9CiAgICB9CiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYgJiYgdGhpcy54cmVmKSB7CiAgICAgIHJldHVybiB0aGlzLnhyZWYuZmV0Y2godmFsdWUsIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9CiAgYXN5bmMgZ2V0QXN5bmMoa2V5MSwga2V5Miwga2V5MykgewogICAgbGV0IHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkxKTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTIgIT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5Mik7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkzKTsKICAgICAgfQogICAgfQogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIHRoaXMueHJlZikgewogICAgICByZXR1cm4gdGhpcy54cmVmLmZldGNoQXN5bmModmFsdWUsIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9CiAgZ2V0QXJyYXkoa2V5MSwga2V5Miwga2V5MykgewogICAgbGV0IHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkxKTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTIgIT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5Mik7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkzKTsKICAgICAgfQogICAgfQogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIHRoaXMueHJlZikgewogICAgICB2YWx1ZSA9IHRoaXMueHJlZi5mZXRjaCh2YWx1ZSwgdGhpcy5zdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdmFsdWUubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGlmICh2YWx1ZVtpXSBpbnN0YW5jZW9mIFJlZiAmJiB0aGlzLnhyZWYpIHsKICAgICAgICAgIHZhbHVlW2ldID0gdGhpcy54cmVmLmZldGNoKHZhbHVlW2ldLCB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIGdldFJhdyhrZXkpIHsKICAgIHJldHVybiB0aGlzLl9tYXAuZ2V0KGtleSk7CiAgfQogIGdldEtleXMoKSB7CiAgICByZXR1cm4gWy4uLnRoaXMuX21hcC5rZXlzKCldOwogIH0KICBnZXRSYXdWYWx1ZXMoKSB7CiAgICByZXR1cm4gWy4uLnRoaXMuX21hcC52YWx1ZXMoKV07CiAgfQogIGdldFJhd0VudHJpZXMoKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLmVudHJpZXMoKTsKICB9CiAgc2V0KGtleSwgdmFsdWUpIHsKICAgIHRoaXMuX21hcC5zZXQoa2V5LCB2YWx1ZSk7CiAgfQogIHNldElmTm90RXhpc3RzKGtleSwgdmFsdWUpIHsKICAgIGlmICghdGhpcy5oYXMoa2V5KSkgewogICAgICB0aGlzLnNldChrZXksIHZhbHVlKTsKICAgIH0KICB9CiAgc2V0SWZOdW1iZXIoa2V5LCB2YWx1ZSkgewogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHsKICAgICAgdGhpcy5zZXQoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQogIHNldElmQXJyYXkoa2V5LCB2YWx1ZSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpIHx8IEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSkpIHsKICAgICAgdGhpcy5zZXQoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQogIHNldElmRGVmaW5lZChrZXksIHZhbHVlKSB7CiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkgewogICAgICB0aGlzLnNldChrZXksIHZhbHVlKTsKICAgIH0KICB9CiAgc2V0SWZOYW1lKGtleSwgdmFsdWUpIHsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgIHRoaXMuc2V0KGtleSwgTmFtZS5nZXQodmFsdWUpKTsKICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIHRoaXMuc2V0KGtleSwgdmFsdWUpOwogICAgfQogIH0KICBzZXRJZkRpY3Qoa2V5LCB2YWx1ZSkgewogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGljdCkgewogICAgICB0aGlzLnNldChrZXksIHZhbHVlKTsKICAgIH0KICB9CiAgaGFzKGtleSkgewogICAgcmV0dXJuIHRoaXMuX21hcC5oYXMoa2V5KTsKICB9CiAgKltTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7CiAgICAgIHlpZWxkIFtrZXksIHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIHRoaXMueHJlZiA/IHRoaXMueHJlZi5mZXRjaCh2YWx1ZSwgdGhpcy5zdXBwcmVzc0VuY3J5cHRpb24pIDogdmFsdWVdOwogICAgfQogIH0KICBzdGF0aWMgZ2V0IGVtcHR5KCkgewogICAgY29uc3QgZW1wdHlEaWN0ID0gbmV3IERpY3QobnVsbCk7CiAgICBlbXB0eURpY3Quc2V0ID0gKGtleSwgdmFsdWUpID0+IHsKICAgICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBgc2V0YCBvbiB0aGUgZW1wdHkgZGljdGlvbmFyeS4iKTsKICAgIH07CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJlbXB0eSIsIGVtcHR5RGljdCk7CiAgfQogIHN0YXRpYyBtZXJnZSh7CiAgICB4cmVmLAogICAgZGljdEFycmF5LAogICAgbWVyZ2VTdWJEaWN0cyA9IGZhbHNlCiAgfSkgewogICAgY29uc3QgbWVyZ2VkRGljdCA9IG5ldyBEaWN0KHhyZWYpLAogICAgICBwcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwogICAgZm9yIChjb25zdCBkaWN0IG9mIGRpY3RBcnJheSkgewogICAgICBpZiAoIShkaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBkaWN0Ll9tYXApIHsKICAgICAgICBsZXQgcHJvcGVydHkgPSBwcm9wZXJ0aWVzLmdldChrZXkpOwogICAgICAgIGlmIChwcm9wZXJ0eSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBwcm9wZXJ0eSA9IFtdOwogICAgICAgICAgcHJvcGVydGllcy5zZXQoa2V5LCBwcm9wZXJ0eSk7CiAgICAgICAgfSBlbHNlIGlmICghbWVyZ2VTdWJEaWN0cyB8fCAhKHZhbHVlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBwcm9wZXJ0eS5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVzXSBvZiBwcm9wZXJ0aWVzKSB7CiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAxIHx8ICEodmFsdWVzWzBdIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBtZXJnZWREaWN0Ll9tYXAuc2V0KG5hbWUsIHZhbHVlc1swXSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qgc3ViRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgdmFsdWVzKSB7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZGljdC5fbWFwKSB7CiAgICAgICAgICBpZiAoIXN1YkRpY3QuX21hcC5oYXMoa2V5KSkgewogICAgICAgICAgICBzdWJEaWN0Ll9tYXAuc2V0KGtleSwgdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3ViRGljdC5zaXplID4gMCkgewogICAgICAgIG1lcmdlZERpY3QuX21hcC5zZXQobmFtZSwgc3ViRGljdCk7CiAgICAgIH0KICAgIH0KICAgIHByb3BlcnRpZXMuY2xlYXIoKTsKICAgIHJldHVybiBtZXJnZWREaWN0LnNpemUgPiAwID8gbWVyZ2VkRGljdCA6IERpY3QuZW1wdHk7CiAgfQogIGNsb25lKCkgewogICAgY29uc3QgZGljdCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBmb3IgKGNvbnN0IGtleSBvZiB0aGlzLmdldEtleXMoKSkgewogICAgICBkaWN0LnNldChrZXksIHRoaXMuZ2V0UmF3KGtleSkpOwogICAgfQogICAgcmV0dXJuIGRpY3Q7CiAgfQogIGRlbGV0ZShrZXkpIHsKICAgIHRoaXMuX21hcC5kZWxldGUoa2V5KTsKICB9Cn0KY2xhc3MgUmVmIHsKICBjb25zdHJ1Y3RvcihudW0sIGdlbikgewogICAgdGhpcy5udW0gPSBudW07CiAgICB0aGlzLmdlbiA9IGdlbjsKICB9CiAgdG9TdHJpbmcoKSB7CiAgICBpZiAodGhpcy5nZW4gPT09IDApIHsKICAgICAgcmV0dXJuIGAke3RoaXMubnVtfVJgOwogICAgfQogICAgcmV0dXJuIGAke3RoaXMubnVtfVIke3RoaXMuZ2VufWA7CiAgfQogIHN0YXRpYyBmcm9tU3RyaW5nKHN0cikgewogICAgY29uc3QgcmVmID0gUmVmQ2FjaGVbc3RyXTsKICAgIGlmIChyZWYpIHsKICAgICAgcmV0dXJuIHJlZjsKICAgIH0KICAgIGNvbnN0IG0gPSAvXihcZCspUihcZCopJC8uZXhlYyhzdHIpOwogICAgaWYgKCFtIHx8IG1bMV0gPT09ICIwIikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiBSZWZDYWNoZVtzdHJdID0gbmV3IFJlZihwYXJzZUludChtWzFdKSwgIW1bMl0gPyAwIDogcGFyc2VJbnQobVsyXSkpOwogIH0KICBzdGF0aWMgZ2V0KG51bSwgZ2VuKSB7CiAgICBjb25zdCBrZXkgPSBnZW4gPT09IDAgPyBgJHtudW19UmAgOiBgJHtudW19UiR7Z2VufWA7CiAgICByZXR1cm4gUmVmQ2FjaGVba2V5XSB8fD0gbmV3IFJlZihudW0sIGdlbik7CiAgfQp9CmNsYXNzIFJlZlNldCB7CiAgY29uc3RydWN0b3IocGFyZW50ID0gbnVsbCkgewogICAgdGhpcy5fc2V0ID0gbmV3IFNldChwYXJlbnQ/Ll9zZXQpOwogIH0KICBoYXMocmVmKSB7CiAgICByZXR1cm4gdGhpcy5fc2V0LmhhcyhyZWYudG9TdHJpbmcoKSk7CiAgfQogIHB1dChyZWYpIHsKICAgIHRoaXMuX3NldC5hZGQocmVmLnRvU3RyaW5nKCkpOwogIH0KICByZW1vdmUocmVmKSB7CiAgICB0aGlzLl9zZXQuZGVsZXRlKHJlZi50b1N0cmluZygpKTsKICB9CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICByZXR1cm4gdGhpcy5fc2V0LnZhbHVlcygpOwogIH0KICBjbGVhcigpIHsKICAgIHRoaXMuX3NldC5jbGVhcigpOwogIH0KfQpjbGFzcyBSZWZTZXRDYWNoZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLl9tYXAgPSBuZXcgTWFwKCk7CiAgfQogIGdldCBzaXplKCkgewogICAgcmV0dXJuIHRoaXMuX21hcC5zaXplOwogIH0KICBnZXQocmVmKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLmdldChyZWYudG9TdHJpbmcoKSk7CiAgfQogIGhhcyhyZWYpIHsKICAgIHJldHVybiB0aGlzLl9tYXAuaGFzKHJlZi50b1N0cmluZygpKTsKICB9CiAgcHV0KHJlZiwgb2JqKSB7CiAgICB0aGlzLl9tYXAuc2V0KHJlZi50b1N0cmluZygpLCBvYmopOwogIH0KICBwdXRBbGlhcyhyZWYsIGFsaWFzUmVmKSB7CiAgICB0aGlzLl9tYXAuc2V0KHJlZi50b1N0cmluZygpLCB0aGlzLmdldChhbGlhc1JlZikpOwogIH0KICBbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgIHJldHVybiB0aGlzLl9tYXAudmFsdWVzKCk7CiAgfQogIGNsZWFyKCkgewogICAgdGhpcy5fbWFwLmNsZWFyKCk7CiAgfQogICp2YWx1ZXMoKSB7CiAgICB5aWVsZCogdGhpcy5fbWFwLnZhbHVlcygpOwogIH0KICAqaXRlbXMoKSB7CiAgICBmb3IgKGNvbnN0IFtyZWYsIHZhbHVlXSBvZiB0aGlzLl9tYXApIHsKICAgICAgeWllbGQgW1JlZi5mcm9tU3RyaW5nKHJlZiksIHZhbHVlXTsKICAgIH0KICB9CiAgKmtleXMoKSB7CiAgICBmb3IgKGNvbnN0IHJlZiBvZiB0aGlzLl9tYXAua2V5cygpKSB7CiAgICAgIHlpZWxkIFJlZi5mcm9tU3RyaW5nKHJlZik7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGlzTmFtZSh2LCBuYW1lKSB7CiAgcmV0dXJuIHYgaW5zdGFuY2VvZiBOYW1lICYmIChuYW1lID09PSB1bmRlZmluZWQgfHwgdi5uYW1lID09PSBuYW1lKTsKfQpmdW5jdGlvbiBpc0NtZCh2LCBjbWQpIHsKICByZXR1cm4gdiBpbnN0YW5jZW9mIENtZCAmJiAoY21kID09PSB1bmRlZmluZWQgfHwgdi5jbWQgPT09IGNtZCk7Cn0KZnVuY3Rpb24gaXNEaWN0KHYsIHR5cGUpIHsKICByZXR1cm4gdiBpbnN0YW5jZW9mIERpY3QgJiYgKHR5cGUgPT09IHVuZGVmaW5lZCB8fCBpc05hbWUodi5nZXQoIlR5cGUiKSwgdHlwZSkpOwp9CmZ1bmN0aW9uIGlzUmVmc0VxdWFsKHYxLCB2MikgewogIHJldHVybiB2MS5udW0gPT09IHYyLm51bSAmJiB2MS5nZW4gPT09IHYyLmdlbjsKfQoKOy8vIC4vc3JjL2NvcmUvYmFzZV9zdHJlYW0uanMKCmNsYXNzIEJhc2VTdHJlYW0gewogIGdldCBsZW5ndGgoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgZ2V0dGVyIGBsZW5ndGhgIGFjY2Vzc2VkIik7CiAgfQogIGdldCBpc0VtcHR5KCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IGdldHRlciBgaXNFbXB0eWAgYWNjZXNzZWQiKTsKICB9CiAgZ2V0IGlzRGF0YUxvYWRlZCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzRGF0YUxvYWRlZCIsIHRydWUpOwogIH0KICBnZXRCeXRlKCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgZ2V0Qnl0ZWAgY2FsbGVkIik7CiAgfQogIGdldEJ5dGVzKGxlbmd0aCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgZ2V0Qnl0ZXNgIGNhbGxlZCIpOwogIH0KICBhc3luYyBnZXRJbWFnZURhdGEobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucykgewogICAgcmV0dXJuIHRoaXMuZ2V0Qnl0ZXMobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucyk7CiAgfQogIGFzeW5jIGFzeW5jR2V0Qnl0ZXMoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBhc3luY0dldEJ5dGVzYCBjYWxsZWQiKTsKICB9CiAgZ2V0IGlzQXN5bmMoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGdldCBpc0FzeW5jRGVjb2RlcigpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGNhbkFzeW5jRGVjb2RlSW1hZ2VGcm9tQnVmZmVyKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBhc3luYyBnZXRUcmFuc2ZlcmFibGVJbWFnZSgpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBwZWVrQnl0ZSgpIHsKICAgIGNvbnN0IHBlZWtlZEJ5dGUgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGlmIChwZWVrZWRCeXRlICE9PSAtMSkgewogICAgICB0aGlzLnBvcy0tOwogICAgfQogICAgcmV0dXJuIHBlZWtlZEJ5dGU7CiAgfQogIHBlZWtCeXRlcyhsZW5ndGgpIHsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5nZXRCeXRlcyhsZW5ndGgpOwogICAgdGhpcy5wb3MgLT0gYnl0ZXMubGVuZ3RoOwogICAgcmV0dXJuIGJ5dGVzOwogIH0KICBnZXRVaW50MTYoKSB7CiAgICBjb25zdCBiMCA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgY29uc3QgYjEgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGlmIChiMCA9PT0gLTEgfHwgYjEgPT09IC0xKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHJldHVybiAoYjAgPDwgOCkgKyBiMTsKICB9CiAgZ2V0SW50MzIoKSB7CiAgICBjb25zdCBiMCA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgY29uc3QgYjEgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGNvbnN0IGIyID0gdGhpcy5nZXRCeXRlKCk7CiAgICBjb25zdCBiMyA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgcmV0dXJuIChiMCA8PCAyNCkgKyAoYjEgPDwgMTYpICsgKGIyIDw8IDgpICsgYjM7CiAgfQogIGdldEJ5dGVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRCeXRlUmFuZ2VgIGNhbGxlZCIpOwogIH0KICBnZXRTdHJpbmcobGVuZ3RoKSB7CiAgICByZXR1cm4gYnl0ZXNUb1N0cmluZyh0aGlzLmdldEJ5dGVzKGxlbmd0aCkpOwogIH0KICBza2lwKG4pIHsKICAgIHRoaXMucG9zICs9IG4gfHwgMTsKICB9CiAgcmVzZXQoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGByZXNldGAgY2FsbGVkIik7CiAgfQogIG1vdmVTdGFydCgpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYG1vdmVTdGFydGAgY2FsbGVkIik7CiAgfQogIG1ha2VTdWJTdHJlYW0oc3RhcnQsIGxlbmd0aCwgZGljdCA9IG51bGwpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYG1ha2VTdWJTdHJlYW1gIGNhbGxlZCIpOwogIH0KICBnZXRCYXNlU3RyZWFtcygpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBnZXRPcmlnaW5hbFN0cmVhbSgpIHsKICAgIHJldHVybiB0aGlzLnN0cmVhbT8uZ2V0T3JpZ2luYWxTdHJlYW0oKSB8fCB0aGlzOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY29yZV91dGlscy5qcwoKCgpjb25zdCBQREZfVkVSU0lPTl9SRUdFWFAgPSAvXlsxLTldXC5cZCQvOwpjb25zdCBNQVhfSU5UXzMyID0gMiAqKiAzMSAtIDE7CmNvbnN0IE1JTl9JTlRfMzIgPSAtKDIgKiogMzEpOwpjb25zdCBJREVOVElUWV9NQVRSSVggPSBbMSwgMCwgMCwgMSwgMCwgMF07CmNvbnN0IFJFU09VUkNFU19LRVlTX09QRVJBVE9SX0xJU1QgPSBbIkNvbG9yU3BhY2UiLCAiRXh0R1N0YXRlIiwgIkZvbnQiLCAiUGF0dGVybiIsICJQcm9wZXJ0aWVzIiwgIlNoYWRpbmciLCAiWE9iamVjdCJdOwpjb25zdCBSRVNPVVJDRVNfS0VZU19URVhUX0NPTlRFTlQgPSBbIkV4dEdTdGF0ZSIsICJGb250IiwgIlByb3BlcnRpZXMiLCAiWE9iamVjdCJdOwpmdW5jdGlvbiBnZXRMb29rdXBUYWJsZUZhY3RvcnkoaW5pdGlhbGl6ZXIpIHsKICBsZXQgbG9va3VwOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoaW5pdGlhbGl6ZXIpIHsKICAgICAgbG9va3VwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgaW5pdGlhbGl6ZXIobG9va3VwKTsKICAgICAgaW5pdGlhbGl6ZXIgPSBudWxsOwogICAgfQogICAgcmV0dXJuIGxvb2t1cDsKICB9Owp9CmNsYXNzIE1pc3NpbmdEYXRhRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IoYmVnaW4sIGVuZCkgewogICAgc3VwZXIoYE1pc3NpbmcgZGF0YSBbJHtiZWdpbn0sICR7ZW5kfSlgLCAiTWlzc2luZ0RhdGFFeGNlcHRpb24iKTsKICAgIHRoaXMuYmVnaW4gPSBiZWdpbjsKICAgIHRoaXMuZW5kID0gZW5kOwogIH0KfQpjbGFzcyBQYXJzZXJFT0ZFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIlBhcnNlckVPRkV4Y2VwdGlvbiIpOwogIH0KfQpjbGFzcyBYUmVmRW50cnlFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIlhSZWZFbnRyeUV4Y2VwdGlvbiIpOwogIH0KfQpjbGFzcyBYUmVmUGFyc2VFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIlhSZWZQYXJzZUV4Y2VwdGlvbiIpOwogIH0KfQpmdW5jdGlvbiBhcnJheUJ1ZmZlcnNUb0J5dGVzKGFycikgewogIGNvbnN0IGxlbmd0aCA9IGFyci5sZW5ndGg7CiAgaWYgKGxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOwogIH0KICBpZiAobGVuZ3RoID09PSAxKSB7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYXJyWzBdKTsKICB9CiAgbGV0IGRhdGFMZW5ndGggPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIGRhdGFMZW5ndGggKz0gYXJyW2ldLmJ5dGVMZW5ndGg7CiAgfQogIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShkYXRhTGVuZ3RoKTsKICBsZXQgcG9zID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBpdGVtID0gbmV3IFVpbnQ4QXJyYXkoYXJyW2ldKTsKICAgIGRhdGEuc2V0KGl0ZW0sIHBvcyk7CiAgICBwb3MgKz0gaXRlbS5ieXRlTGVuZ3RoOwogIH0KICByZXR1cm4gZGF0YTsKfQphc3luYyBmdW5jdGlvbiBmZXRjaEJpbmFyeURhdGEodXJsKSB7CiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpOwogIGlmICghcmVzcG9uc2Uub2spIHsKICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIGZpbGUgIiR7dXJsfSIgd2l0aCAiJHtyZXNwb25zZS5zdGF0dXNUZXh0fSIuYCk7CiAgfQogIHJldHVybiBuZXcgVWludDhBcnJheShhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpKTsKfQpmdW5jdGlvbiBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICBkaWN0LAogIGtleSwKICBnZXRBcnJheSA9IGZhbHNlLAogIHN0b3BXaGVuRm91bmQgPSB0cnVlCn0pIHsKICBsZXQgdmFsdWVzOwogIGNvbnN0IHZpc2l0ZWQgPSBuZXcgUmVmU2V0KCk7CiAgd2hpbGUgKGRpY3QgaW5zdGFuY2VvZiBEaWN0ICYmICEoZGljdC5vYmpJZCAmJiB2aXNpdGVkLmhhcyhkaWN0Lm9iaklkKSkpIHsKICAgIGlmIChkaWN0Lm9iaklkKSB7CiAgICAgIHZpc2l0ZWQucHV0KGRpY3Qub2JqSWQpOwogICAgfQogICAgY29uc3QgdmFsdWUgPSBnZXRBcnJheSA/IGRpY3QuZ2V0QXJyYXkoa2V5KSA6IGRpY3QuZ2V0KGtleSk7CiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICBpZiAoc3RvcFdoZW5Gb3VuZCkgewogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgICAodmFsdWVzIHx8PSBbXSkucHVzaCh2YWx1ZSk7CiAgICB9CiAgICBkaWN0ID0gZGljdC5nZXQoIlBhcmVudCIpOwogIH0KICByZXR1cm4gdmFsdWVzOwp9CmZ1bmN0aW9uIGdldFBhcmVudFRvVXBkYXRlKGRpY3QsIHJlZiwgeHJlZikgewogIGNvbnN0IHZpc2l0ZWQgPSBuZXcgUmVmU2V0KCk7CiAgY29uc3QgZmlyc3REaWN0ID0gZGljdDsKICBjb25zdCByZXN1bHQgPSB7CiAgICBkaWN0OiBudWxsLAogICAgcmVmOiBudWxsCiAgfTsKICB3aGlsZSAoZGljdCBpbnN0YW5jZW9mIERpY3QgJiYgIXZpc2l0ZWQuaGFzKHJlZikpIHsKICAgIHZpc2l0ZWQucHV0KHJlZik7CiAgICBpZiAoZGljdC5oYXMoIlQiKSkgewogICAgICBicmVhazsKICAgIH0KICAgIHJlZiA9IGRpY3QuZ2V0UmF3KCJQYXJlbnQiKTsKICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGRpY3QgPSB4cmVmLmZldGNoKHJlZik7CiAgfQogIGlmIChkaWN0IGluc3RhbmNlb2YgRGljdCAmJiBkaWN0ICE9PSBmaXJzdERpY3QpIHsKICAgIHJlc3VsdC5kaWN0ID0gZGljdDsKICAgIHJlc3VsdC5yZWYgPSByZWY7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KY29uc3QgUk9NQU5fTlVNQkVSX01BUCA9IFsiIiwgIkMiLCAiQ0MiLCAiQ0NDIiwgIkNEIiwgIkQiLCAiREMiLCAiRENDIiwgIkRDQ0MiLCAiQ00iLCAiIiwgIlgiLCAiWFgiLCAiWFhYIiwgIlhMIiwgIkwiLCAiTFgiLCAiTFhYIiwgIkxYWFgiLCAiWEMiLCAiIiwgIkkiLCAiSUkiLCAiSUlJIiwgIklWIiwgIlYiLCAiVkkiLCAiVklJIiwgIlZJSUkiLCAiSVgiXTsKZnVuY3Rpb24gdG9Sb21hbk51bWVyYWxzKG51bWJlciwgbG93ZXJDYXNlID0gZmFsc2UpIHsKICBhc3NlcnQoTnVtYmVyLmlzSW50ZWdlcihudW1iZXIpICYmIG51bWJlciA+IDAsICJUaGUgbnVtYmVyIHNob3VsZCBiZSBhIHBvc2l0aXZlIGludGVnZXIuIik7CiAgY29uc3Qgcm9tYW4gPSAiTSIucmVwZWF0KG51bWJlciAvIDEwMDAgfCAwKSArIFJPTUFOX05VTUJFUl9NQVBbbnVtYmVyICUgMTAwMCAvIDEwMCB8IDBdICsgUk9NQU5fTlVNQkVSX01BUFsxMCArIChudW1iZXIgJSAxMDAgLyAxMCB8IDApXSArIFJPTUFOX05VTUJFUl9NQVBbMjAgKyBudW1iZXIgJSAxMF07CiAgcmV0dXJuIGxvd2VyQ2FzZSA/IHJvbWFuLnRvTG93ZXJDYXNlKCkgOiByb21hbjsKfQpmdW5jdGlvbiBsb2cyKHgpIHsKICByZXR1cm4geCA+IDAgPyBNYXRoLmNlaWwoTWF0aC5sb2cyKHgpKSA6IDA7Cn0KZnVuY3Rpb24gcmVhZEludDgoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCAyNCA+PiAyNDsKfQpmdW5jdGlvbiByZWFkSW50MTYoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIChkYXRhW29mZnNldF0gPDwgMjQgfCBkYXRhW29mZnNldCArIDFdIDw8IDE2KSA+PiAxNjsKfQpmdW5jdGlvbiByZWFkVWludDE2KGRhdGEsIG9mZnNldCkgewogIHJldHVybiBkYXRhW29mZnNldF0gPDwgOCB8IGRhdGFbb2Zmc2V0ICsgMV07Cn0KZnVuY3Rpb24gcmVhZFVpbnQzMihkYXRhLCBvZmZzZXQpIHsKICByZXR1cm4gKGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdKSA+Pj4gMDsKfQpmdW5jdGlvbiBpc1doaXRlU3BhY2UoY2gpIHsKICByZXR1cm4gY2ggPT09IDB4MjAgfHwgY2ggPT09IDB4MDkgfHwgY2ggPT09IDB4MGQgfHwgY2ggPT09IDB4MGE7Cn0KZnVuY3Rpb24gaXNCb29sZWFuQXJyYXkoYXJyLCBsZW4pIHsKICByZXR1cm4gQXJyYXkuaXNBcnJheShhcnIpICYmIChsZW4gPT09IG51bGwgfHwgYXJyLmxlbmd0aCA9PT0gbGVuKSAmJiBhcnIuZXZlcnkoeCA9PiB0eXBlb2YgeCA9PT0gImJvb2xlYW4iKTsKfQpmdW5jdGlvbiBpc051bWJlckFycmF5KGFyciwgbGVuKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgcmV0dXJuIChsZW4gPT09IG51bGwgfHwgYXJyLmxlbmd0aCA9PT0gbGVuKSAmJiBhcnIuZXZlcnkoeCA9PiB0eXBlb2YgeCA9PT0gIm51bWJlciIpOwogIH0KICByZXR1cm4gQXJyYXlCdWZmZXIuaXNWaWV3KGFycikgJiYgIShhcnIgaW5zdGFuY2VvZiBCaWdJbnQ2NEFycmF5IHx8IGFyciBpbnN0YW5jZW9mIEJpZ1VpbnQ2NEFycmF5KSAmJiAobGVuID09PSBudWxsIHx8IGFyci5sZW5ndGggPT09IGxlbik7Cn0KZnVuY3Rpb24gbG9va3VwTWF0cml4KGFyciwgZmFsbGJhY2spIHsKICByZXR1cm4gaXNOdW1iZXJBcnJheShhcnIsIDYpID8gYXJyIDogZmFsbGJhY2s7Cn0KZnVuY3Rpb24gbG9va3VwUmVjdChhcnIsIGZhbGxiYWNrKSB7CiAgcmV0dXJuIGlzTnVtYmVyQXJyYXkoYXJyLCA0KSA/IGFyciA6IGZhbGxiYWNrOwp9CmZ1bmN0aW9uIGxvb2t1cE5vcm1hbFJlY3QoYXJyLCBmYWxsYmFjaykgewogIHJldHVybiBpc051bWJlckFycmF5KGFyciwgNCkgPyBVdGlsLm5vcm1hbGl6ZVJlY3QoYXJyKSA6IGZhbGxiYWNrOwp9CmZ1bmN0aW9uIHBhcnNlWEZBUGF0aChwYXRoKSB7CiAgY29uc3QgcG9zaXRpb25QYXR0ZXJuID0gLyguKylcWyhcZCspXF0kLzsKICByZXR1cm4gcGF0aC5zcGxpdCgiLiIpLm1hcChjb21wb25lbnQgPT4gewogICAgY29uc3QgbSA9IGNvbXBvbmVudC5tYXRjaChwb3NpdGlvblBhdHRlcm4pOwogICAgaWYgKG0pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBtWzFdLAogICAgICAgIHBvczogcGFyc2VJbnQobVsyXSwgMTApCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gewogICAgICBuYW1lOiBjb21wb25lbnQsCiAgICAgIHBvczogMAogICAgfTsKICB9KTsKfQpmdW5jdGlvbiBlc2NhcGVQREZOYW1lKHN0cikgewogIGNvbnN0IGJ1ZmZlciA9IFtdOwogIGxldCBzdGFydCA9IDA7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3RyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IGNoYXIgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgIGlmIChjaGFyIDwgMHgyMSB8fCBjaGFyID4gMHg3ZSB8fCBjaGFyID09PSAweDIzIHx8IGNoYXIgPT09IDB4MjggfHwgY2hhciA9PT0gMHgyOSB8fCBjaGFyID09PSAweDNjIHx8IGNoYXIgPT09IDB4M2UgfHwgY2hhciA9PT0gMHg1YiB8fCBjaGFyID09PSAweDVkIHx8IGNoYXIgPT09IDB4N2IgfHwgY2hhciA9PT0gMHg3ZCB8fCBjaGFyID09PSAweDJmIHx8IGNoYXIgPT09IDB4MjUpIHsKICAgICAgaWYgKHN0YXJ0IDwgaSkgewogICAgICAgIGJ1ZmZlci5wdXNoKHN0ci5zdWJzdHJpbmcoc3RhcnQsIGkpKTsKICAgICAgfQogICAgICBidWZmZXIucHVzaChgIyR7Y2hhci50b1N0cmluZygxNil9YCk7CiAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICB9CiAgfQogIGlmIChidWZmZXIubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gc3RyOwogIH0KICBpZiAoc3RhcnQgPCBzdHIubGVuZ3RoKSB7CiAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBzdHIubGVuZ3RoKSk7CiAgfQogIHJldHVybiBidWZmZXIuam9pbigiIik7Cn0KZnVuY3Rpb24gZXNjYXBlU3RyaW5nKHN0cikgewogIHJldHVybiBzdHIucmVwbGFjZUFsbCgvKFsoKVxcXG5ccl0pL2csIG1hdGNoID0+IHsKICAgIGlmIChtYXRjaCA9PT0gIlxuIikgewogICAgICByZXR1cm4gIlxcbiI7CiAgICB9IGVsc2UgaWYgKG1hdGNoID09PSAiXHIiKSB7CiAgICAgIHJldHVybiAiXFxyIjsKICAgIH0KICAgIHJldHVybiBgXFwke21hdGNofWA7CiAgfSk7Cn0KZnVuY3Rpb24gX2NvbGxlY3RKUyhlbnRyeSwgeHJlZiwgbGlzdCwgcGFyZW50cykgewogIGlmICghZW50cnkpIHsKICAgIHJldHVybjsKICB9CiAgbGV0IHBhcmVudCA9IG51bGw7CiAgaWYgKGVudHJ5IGluc3RhbmNlb2YgUmVmKSB7CiAgICBpZiAocGFyZW50cy5oYXMoZW50cnkpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHBhcmVudCA9IGVudHJ5OwogICAgcGFyZW50cy5wdXQocGFyZW50KTsKICAgIGVudHJ5ID0geHJlZi5mZXRjaChlbnRyeSk7CiAgfQogIGlmIChBcnJheS5pc0FycmF5KGVudHJ5KSkgewogICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVudHJ5KSB7CiAgICAgIF9jb2xsZWN0SlMoZWxlbWVudCwgeHJlZiwgbGlzdCwgcGFyZW50cyk7CiAgICB9CiAgfSBlbHNlIGlmIChlbnRyeSBpbnN0YW5jZW9mIERpY3QpIHsKICAgIGlmIChpc05hbWUoZW50cnkuZ2V0KCJTIiksICJKYXZhU2NyaXB0IikpIHsKICAgICAgY29uc3QganMgPSBlbnRyeS5nZXQoIkpTIik7CiAgICAgIGxldCBjb2RlOwogICAgICBpZiAoanMgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgY29kZSA9IGpzLmdldFN0cmluZygpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBqcyA9PT0gInN0cmluZyIpIHsKICAgICAgICBjb2RlID0ganM7CiAgICAgIH0KICAgICAgY29kZSAmJj0gc3RyaW5nVG9QREZTdHJpbmcoY29kZSwgdHJ1ZSkucmVwbGFjZUFsbCgiXHgwMCIsICIiKTsKICAgICAgaWYgKGNvZGUpIHsKICAgICAgICBsaXN0LnB1c2goY29kZS50cmltKCkpOwogICAgICB9CiAgICB9CiAgICBfY29sbGVjdEpTKGVudHJ5LmdldFJhdygiTmV4dCIpLCB4cmVmLCBsaXN0LCBwYXJlbnRzKTsKICB9CiAgaWYgKHBhcmVudCkgewogICAgcGFyZW50cy5yZW1vdmUocGFyZW50KTsKICB9Cn0KZnVuY3Rpb24gY29sbGVjdEFjdGlvbnMoeHJlZiwgZGljdCwgZXZlbnRUeXBlKSB7CiAgY29uc3QgYWN0aW9ucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgY29uc3QgYWRkaXRpb25hbEFjdGlvbnNEaWN0cyA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgZGljdCwKICAgIGtleTogIkFBIiwKICAgIHN0b3BXaGVuRm91bmQ6IGZhbHNlCiAgfSk7CiAgaWYgKGFkZGl0aW9uYWxBY3Rpb25zRGljdHMpIHsKICAgIGZvciAobGV0IGkgPSBhZGRpdGlvbmFsQWN0aW9uc0RpY3RzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIGNvbnN0IGFkZGl0aW9uYWxBY3Rpb25zID0gYWRkaXRpb25hbEFjdGlvbnNEaWN0c1tpXTsKICAgICAgaWYgKCEoYWRkaXRpb25hbEFjdGlvbnMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGFkZGl0aW9uYWxBY3Rpb25zLmdldEtleXMoKSkgewogICAgICAgIGNvbnN0IGFjdGlvbiA9IGV2ZW50VHlwZVtrZXldOwogICAgICAgIGlmICghYWN0aW9uKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYWN0aW9uRGljdCA9IGFkZGl0aW9uYWxBY3Rpb25zLmdldFJhdyhrZXkpOwogICAgICAgIGNvbnN0IHBhcmVudHMgPSBuZXcgUmVmU2V0KCk7CiAgICAgICAgY29uc3QgbGlzdCA9IFtdOwogICAgICAgIF9jb2xsZWN0SlMoYWN0aW9uRGljdCwgeHJlZiwgbGlzdCwgcGFyZW50cyk7CiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgYWN0aW9uc1thY3Rpb25dID0gbGlzdDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgaWYgKGRpY3QuaGFzKCJBIikpIHsKICAgIGNvbnN0IGFjdGlvbkRpY3QgPSBkaWN0LmdldCgiQSIpOwogICAgY29uc3QgcGFyZW50cyA9IG5ldyBSZWZTZXQoKTsKICAgIGNvbnN0IGxpc3QgPSBbXTsKICAgIF9jb2xsZWN0SlMoYWN0aW9uRGljdCwgeHJlZiwgbGlzdCwgcGFyZW50cyk7CiAgICBpZiAobGlzdC5sZW5ndGggPiAwKSB7CiAgICAgIGFjdGlvbnMuQWN0aW9uID0gbGlzdDsKICAgIH0KICB9CiAgcmV0dXJuIG9iamVjdFNpemUoYWN0aW9ucykgPiAwID8gYWN0aW9ucyA6IG51bGw7Cn0KY29uc3QgWE1MRW50aXRpZXMgPSB7CiAgMHgzYzogIiZsdDsiLAogIDB4M2U6ICImZ3Q7IiwKICAweDI2OiAiJmFtcDsiLAogIDB4MjI6ICImcXVvdDsiLAogIDB4Mjc6ICImYXBvczsiCn07CmZ1bmN0aW9uKiBjb2RlUG9pbnRJdGVyKHN0cikgewogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBjaGFyID0gc3RyLmNvZGVQb2ludEF0KGkpOwogICAgaWYgKGNoYXIgPiAweGQ3ZmYgJiYgKGNoYXIgPCAweGUwMDAgfHwgY2hhciA+IDB4ZmZmZCkpIHsKICAgICAgaSsrOwogICAgfQogICAgeWllbGQgY2hhcjsKICB9Cn0KZnVuY3Rpb24gZW5jb2RlVG9YbWxTdHJpbmcoc3RyKSB7CiAgY29uc3QgYnVmZmVyID0gW107CiAgbGV0IHN0YXJ0ID0gMDsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jb2RlUG9pbnRBdChpKTsKICAgIGlmICgweDIwIDw9IGNoYXIgJiYgY2hhciA8PSAweDdlKSB7CiAgICAgIGNvbnN0IGVudGl0eSA9IFhNTEVudGl0aWVzW2NoYXJdOwogICAgICBpZiAoZW50aXR5KSB7CiAgICAgICAgaWYgKHN0YXJ0IDwgaSkgewogICAgICAgICAgYnVmZmVyLnB1c2goc3RyLnN1YnN0cmluZyhzdGFydCwgaSkpOwogICAgICAgIH0KICAgICAgICBidWZmZXIucHVzaChlbnRpdHkpOwogICAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChzdGFydCA8IGkpIHsKICAgICAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBpKSk7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goYCYjeCR7Y2hhci50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX07YCk7CiAgICAgIGlmIChjaGFyID4gMHhkN2ZmICYmIChjaGFyIDwgMHhlMDAwIHx8IGNoYXIgPiAweGZmZmQpKSB7CiAgICAgICAgaSsrOwogICAgICB9CiAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICB9CiAgfQogIGlmIChidWZmZXIubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gc3RyOwogIH0KICBpZiAoc3RhcnQgPCBzdHIubGVuZ3RoKSB7CiAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBzdHIubGVuZ3RoKSk7CiAgfQogIHJldHVybiBidWZmZXIuam9pbigiIik7Cn0KZnVuY3Rpb24gdmFsaWRhdGVGb250TmFtZShmb250RmFtaWx5LCBtdXN0V2FybiA9IGZhbHNlKSB7CiAgY29uc3QgbSA9IC9eKCJ8JykuKigifCcpJC8uZXhlYyhmb250RmFtaWx5KTsKICBpZiAobSAmJiBtWzFdID09PSBtWzJdKSB7CiAgICBjb25zdCByZSA9IG5ldyBSZWdFeHAoYFteXFxcXF0ke21bMV19YCk7CiAgICBpZiAocmUudGVzdChmb250RmFtaWx5LnNsaWNlKDEsIC0xKSkpIHsKICAgICAgaWYgKG11c3RXYXJuKSB7CiAgICAgICAgd2FybihgRm9udEZhbWlseSBjb250YWlucyB1bmVzY2FwZWQgJHttWzFdfTogJHtmb250RmFtaWx5fS5gKTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSBlbHNlIHsKICAgIGZvciAoY29uc3QgaWRlbnQgb2YgZm9udEZhbWlseS5zcGxpdCgvWyBcdF0rLykpIHsKICAgICAgaWYgKC9eKFxkfCgtKFxkfC0pKSkvLnRlc3QoaWRlbnQpIHx8ICEvXltcdy1cXF0rJC8udGVzdChpZGVudCkpIHsKICAgICAgICBpZiAobXVzdFdhcm4pIHsKICAgICAgICAgIHdhcm4oYEZvbnRGYW1pbHkgY29udGFpbnMgaW52YWxpZCA8Y3VzdG9tLWlkZW50PjogJHtmb250RmFtaWx5fS5gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIHZhbGlkYXRlQ1NTRm9udChjc3NGb250SW5mbykgewogIGNvbnN0IERFRkFVTFRfQ1NTX0ZPTlRfT0JMSVFVRSA9ICIxNCI7CiAgY29uc3QgREVGQVVMVF9DU1NfRk9OVF9XRUlHSFQgPSAiNDAwIjsKICBjb25zdCBDU1NfRk9OVF9XRUlHSFRfVkFMVUVTID0gbmV3IFNldChbIjEwMCIsICIyMDAiLCAiMzAwIiwgIjQwMCIsICI1MDAiLCAiNjAwIiwgIjcwMCIsICI4MDAiLCAiOTAwIiwgIjEwMDAiLCAibm9ybWFsIiwgImJvbGQiLCAiYm9sZGVyIiwgImxpZ2h0ZXIiXSk7CiAgY29uc3QgewogICAgZm9udEZhbWlseSwKICAgIGZvbnRXZWlnaHQsCiAgICBpdGFsaWNBbmdsZQogIH0gPSBjc3NGb250SW5mbzsKICBpZiAoIXZhbGlkYXRlRm9udE5hbWUoZm9udEZhbWlseSwgdHJ1ZSkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3Qgd2VpZ2h0ID0gZm9udFdlaWdodCA/IGZvbnRXZWlnaHQudG9TdHJpbmcoKSA6ICIiOwogIGNzc0ZvbnRJbmZvLmZvbnRXZWlnaHQgPSBDU1NfRk9OVF9XRUlHSFRfVkFMVUVTLmhhcyh3ZWlnaHQpID8gd2VpZ2h0IDogREVGQVVMVF9DU1NfRk9OVF9XRUlHSFQ7CiAgY29uc3QgYW5nbGUgPSBwYXJzZUZsb2F0KGl0YWxpY0FuZ2xlKTsKICBjc3NGb250SW5mby5pdGFsaWNBbmdsZSA9IGlzTmFOKGFuZ2xlKSB8fCBhbmdsZSA8IC05MCB8fCBhbmdsZSA+IDkwID8gREVGQVVMVF9DU1NfRk9OVF9PQkxJUVVFIDogaXRhbGljQW5nbGUudG9TdHJpbmcoKTsKICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiByZWNvdmVySnNVUkwoc3RyKSB7CiAgY29uc3QgVVJMX09QRU5fTUVUSE9EUyA9IFsiYXBwLmxhdW5jaFVSTCIsICJ3aW5kb3cub3BlbiIsICJ4ZmEuaG9zdC5nb3RvVVJMIl07CiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKCJeXFxzKigiICsgVVJMX09QRU5fTUVUSE9EUy5qb2luKCJ8IikucmVwbGFjZUFsbCgiLiIsICJcXC4iKSArICIpXFwoKD86J3xcIikoW14nXCJdKikoPzonfFwiKSg/OixcXHMqKFxcdyspXFwpfFxcKSkiLCAiaSIpOwogIGNvbnN0IGpzVXJsID0gcmVnZXguZXhlYyhzdHIpOwogIGlmIChqc1VybD8uWzJdKSB7CiAgICByZXR1cm4gewogICAgICB1cmw6IGpzVXJsWzJdLAogICAgICBuZXdXaW5kb3c6IGpzVXJsWzFdID09PSAiYXBwLmxhdW5jaFVSTCIgJiYganNVcmxbM10gPT09ICJ0cnVlIgogICAgfTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gbnVtYmVyVG9TdHJpbmcodmFsdWUpIHsKICBpZiAoTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkpIHsKICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpOwogIH0KICBjb25zdCByb3VuZGVkVmFsdWUgPSBNYXRoLnJvdW5kKHZhbHVlICogMTAwKTsKICBpZiAocm91bmRlZFZhbHVlICUgMTAwID09PSAwKSB7CiAgICByZXR1cm4gKHJvdW5kZWRWYWx1ZSAvIDEwMCkudG9TdHJpbmcoKTsKICB9CiAgaWYgKHJvdW5kZWRWYWx1ZSAlIDEwID09PSAwKSB7CiAgICByZXR1cm4gdmFsdWUudG9GaXhlZCgxKTsKICB9CiAgcmV0dXJuIHZhbHVlLnRvRml4ZWQoMik7Cn0KZnVuY3Rpb24gZ2V0TmV3QW5ub3RhdGlvbnNNYXAoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgbmV3QW5ub3RhdGlvbnNCeVBhZ2UgPSBuZXcgTWFwKCk7CiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGlmICgha2V5LnN0YXJ0c1dpdGgoQW5ub3RhdGlvbkVkaXRvclByZWZpeCkpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgYW5ub3RhdGlvbnMgPSBuZXdBbm5vdGF0aW9uc0J5UGFnZS5nZXQodmFsdWUucGFnZUluZGV4KTsKICAgIGlmICghYW5ub3RhdGlvbnMpIHsKICAgICAgYW5ub3RhdGlvbnMgPSBbXTsKICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2Uuc2V0KHZhbHVlLnBhZ2VJbmRleCwgYW5ub3RhdGlvbnMpOwogICAgfQogICAgYW5ub3RhdGlvbnMucHVzaCh2YWx1ZSk7CiAgfQogIHJldHVybiBuZXdBbm5vdGF0aW9uc0J5UGFnZS5zaXplID4gMCA/IG5ld0Fubm90YXRpb25zQnlQYWdlIDogbnVsbDsKfQpmdW5jdGlvbiBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHN0cikgewogIGlmIChzdHIgPT09IG51bGwgfHwgc3RyID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiBzdHI7CiAgfQogIHJldHVybiBpc0FzY2lpKHN0cikgPyBzdHIgOiBzdHJpbmdUb1VURjE2U3RyaW5nKHN0ciwgdHJ1ZSk7Cn0KZnVuY3Rpb24gaXNBc2NpaShzdHIpIHsKICBpZiAodHlwZW9mIHN0ciAhPT0gInN0cmluZyIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuICFzdHIgfHwgL15bXHgwMC1ceDdGXSokLy50ZXN0KHN0cik7Cn0KZnVuY3Rpb24gc3RyaW5nVG9VVEYxNkhleFN0cmluZyhzdHIpIHsKICBjb25zdCBidWYgPSBbXTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgYnVmLnB1c2goaGV4TnVtYmVyc1tjaGFyID4+IDggJiAweGZmXSwgaGV4TnVtYmVyc1tjaGFyICYgMHhmZl0pOwogIH0KICByZXR1cm4gYnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHN0cmluZ1RvVVRGMTZTdHJpbmcoc3RyLCBiaWdFbmRpYW4gPSBmYWxzZSkgewogIGNvbnN0IGJ1ZiA9IFtdOwogIGlmIChiaWdFbmRpYW4pIHsKICAgIGJ1Zi5wdXNoKCJceEZFXHhGRiIpOwogIH0KICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgYnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyID4+IDggJiAweGZmKSwgU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyICYgMHhmZikpOwogIH0KICByZXR1cm4gYnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIGdldFJvdGF0aW9uTWF0cml4KHJvdGF0aW9uLCB3aWR0aCwgaGVpZ2h0KSB7CiAgc3dpdGNoIChyb3RhdGlvbikgewogICAgY2FzZSA5MDoKICAgICAgcmV0dXJuIFswLCAxLCAtMSwgMCwgd2lkdGgsIDBdOwogICAgY2FzZSAxODA6CiAgICAgIHJldHVybiBbLTEsIDAsIDAsIC0xLCB3aWR0aCwgaGVpZ2h0XTsKICAgIGNhc2UgMjcwOgogICAgICByZXR1cm4gWzAsIC0xLCAxLCAwLCAwLCBoZWlnaHRdOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJvdGF0aW9uIik7CiAgfQp9CmZ1bmN0aW9uIGdldFNpemVJbkJ5dGVzKHgpIHsKICByZXR1cm4gTWF0aC5jZWlsKE1hdGguY2VpbChNYXRoLmxvZzIoMSArIHgpKSAvIDgpOwp9Cgo7Ly8gLi9leHRlcm5hbC9xY21zL3FjbXNfdXRpbHMuanMKY2xhc3MgUUNNUyB7CiAgc3RhdGljICNtZW1vcnlBcnJheSA9IG51bGw7CiAgc3RhdGljIF9tZW1vcnkgPSBudWxsOwogIHN0YXRpYyBfbXVzdEFkZEFscGhhID0gZmFsc2U7CiAgc3RhdGljIF9kZXN0QnVmZmVyID0gbnVsbDsKICBzdGF0aWMgX2Rlc3RPZmZzZXQgPSAwOwogIHN0YXRpYyBfZGVzdExlbmd0aCA9IDA7CiAgc3RhdGljIF9jc3NDb2xvciA9ICIiOwogIHN0YXRpYyBfbWFrZUhleENvbG9yID0gbnVsbDsKICBzdGF0aWMgZ2V0IF9tZW1vcnlBcnJheSgpIHsKICAgIGNvbnN0IGFycmF5ID0gdGhpcy4jbWVtb3J5QXJyYXk7CiAgICBpZiAoYXJyYXk/LmJ5dGVMZW5ndGgpIHsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfQogICAgcmV0dXJuIHRoaXMuI21lbW9yeUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fbWVtb3J5LmJ1ZmZlcik7CiAgfQp9CmZ1bmN0aW9uIGNvcHlfcmVzdWx0KHB0ciwgbGVuKSB7CiAgY29uc3QgewogICAgX211c3RBZGRBbHBoYSwKICAgIF9kZXN0QnVmZmVyLAogICAgX2Rlc3RPZmZzZXQsCiAgICBfZGVzdExlbmd0aCwKICAgIF9tZW1vcnlBcnJheQogIH0gPSBRQ01TOwogIGlmIChsZW4gPT09IF9kZXN0TGVuZ3RoKSB7CiAgICBfZGVzdEJ1ZmZlci5zZXQoX21lbW9yeUFycmF5LnN1YmFycmF5KHB0ciwgcHRyICsgbGVuKSwgX2Rlc3RPZmZzZXQpOwogICAgcmV0dXJuOwogIH0KICBpZiAoX211c3RBZGRBbHBoYSkgewogICAgZm9yIChsZXQgaSA9IHB0ciwgaWkgPSBwdHIgKyBsZW4sIGogPSBfZGVzdE9mZnNldDsgaSA8IGlpOyBpICs9IDMsIGogKz0gNCkgewogICAgICBfZGVzdEJ1ZmZlcltqXSA9IF9tZW1vcnlBcnJheVtpXTsKICAgICAgX2Rlc3RCdWZmZXJbaiArIDFdID0gX21lbW9yeUFycmF5W2kgKyAxXTsKICAgICAgX2Rlc3RCdWZmZXJbaiArIDJdID0gX21lbW9yeUFycmF5W2kgKyAyXTsKICAgICAgX2Rlc3RCdWZmZXJbaiArIDNdID0gMjU1OwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IgKGxldCBpID0gcHRyLCBpaSA9IHB0ciArIGxlbiwgaiA9IF9kZXN0T2Zmc2V0OyBpIDwgaWk7IGkgKz0gMywgaiArPSA0KSB7CiAgICAgIF9kZXN0QnVmZmVyW2pdID0gX21lbW9yeUFycmF5W2ldOwogICAgICBfZGVzdEJ1ZmZlcltqICsgMV0gPSBfbWVtb3J5QXJyYXlbaSArIDFdOwogICAgICBfZGVzdEJ1ZmZlcltqICsgMl0gPSBfbWVtb3J5QXJyYXlbaSArIDJdOwogICAgfQogIH0KfQpmdW5jdGlvbiBjb3B5X3JnYihwdHIpIHsKICBjb25zdCB7CiAgICBfZGVzdEJ1ZmZlciwKICAgIF9kZXN0T2Zmc2V0LAogICAgX21lbW9yeUFycmF5CiAgfSA9IFFDTVM7CiAgX2Rlc3RCdWZmZXJbX2Rlc3RPZmZzZXRdID0gX21lbW9yeUFycmF5W3B0cl07CiAgX2Rlc3RCdWZmZXJbX2Rlc3RPZmZzZXQgKyAxXSA9IF9tZW1vcnlBcnJheVtwdHIgKyAxXTsKICBfZGVzdEJ1ZmZlcltfZGVzdE9mZnNldCArIDJdID0gX21lbW9yeUFycmF5W3B0ciArIDJdOwp9CmZ1bmN0aW9uIG1ha2VfY3NzUkdCKHB0cikgewogIGNvbnN0IHsKICAgIF9tZW1vcnlBcnJheQogIH0gPSBRQ01TOwogIFFDTVMuX2Nzc0NvbG9yID0gUUNNUy5fbWFrZUhleENvbG9yKF9tZW1vcnlBcnJheVtwdHJdLCBfbWVtb3J5QXJyYXlbcHRyICsgMV0sIF9tZW1vcnlBcnJheVtwdHIgKyAyXSk7Cn0KCjsvLyAuL2V4dGVybmFsL3FjbXMvcWNtcy5qcwoKbGV0IHdhc207CmNvbnN0IGNhY2hlZFRleHREZWNvZGVyID0gdHlwZW9mIFRleHREZWNvZGVyICE9PSAndW5kZWZpbmVkJyA/IG5ldyBUZXh0RGVjb2RlcigndXRmLTgnLCB7CiAgaWdub3JlQk9NOiB0cnVlLAogIGZhdGFsOiB0cnVlCn0pIDogewogIGRlY29kZTogKCkgPT4gewogICAgdGhyb3cgRXJyb3IoJ1RleHREZWNvZGVyIG5vdCBhdmFpbGFibGUnKTsKICB9Cn07CmlmICh0eXBlb2YgVGV4dERlY29kZXIgIT09ICd1bmRlZmluZWQnKSB7CiAgY2FjaGVkVGV4dERlY29kZXIuZGVjb2RlKCk7Cn0KOwpsZXQgY2FjaGVkVWludDhBcnJheU1lbW9yeTAgPSBudWxsOwpmdW5jdGlvbiBnZXRVaW50OEFycmF5TWVtb3J5MCgpIHsKICBpZiAoY2FjaGVkVWludDhBcnJheU1lbW9yeTAgPT09IG51bGwgfHwgY2FjaGVkVWludDhBcnJheU1lbW9yeTAuYnl0ZUxlbmd0aCA9PT0gMCkgewogICAgY2FjaGVkVWludDhBcnJheU1lbW9yeTAgPSBuZXcgVWludDhBcnJheSh3YXNtLm1lbW9yeS5idWZmZXIpOwogIH0KICByZXR1cm4gY2FjaGVkVWludDhBcnJheU1lbW9yeTA7Cn0KZnVuY3Rpb24gZ2V0U3RyaW5nRnJvbVdhc20wKHB0ciwgbGVuKSB7CiAgcHRyID0gcHRyID4+PiAwOwogIHJldHVybiBjYWNoZWRUZXh0RGVjb2Rlci5kZWNvZGUoZ2V0VWludDhBcnJheU1lbW9yeTAoKS5zdWJhcnJheShwdHIsIHB0ciArIGxlbikpOwp9CmxldCBXQVNNX1ZFQ1RPUl9MRU4gPSAwOwpmdW5jdGlvbiBwYXNzQXJyYXk4VG9XYXNtMChhcmcsIG1hbGxvYykgewogIGNvbnN0IHB0ciA9IG1hbGxvYyhhcmcubGVuZ3RoICogMSwgMSkgPj4+IDA7CiAgZ2V0VWludDhBcnJheU1lbW9yeTAoKS5zZXQoYXJnLCBwdHIgLyAxKTsKICBXQVNNX1ZFQ1RPUl9MRU4gPSBhcmcubGVuZ3RoOwogIHJldHVybiBwdHI7Cn0KZnVuY3Rpb24gcWNtc19jb252ZXJ0X2FycmF5KHRyYW5zZm9ybWVyLCBzcmMpIHsKICBjb25zdCBwdHIwID0gcGFzc0FycmF5OFRvV2FzbTAoc3JjLCB3YXNtLl9fd2JpbmRnZW5fbWFsbG9jKTsKICBjb25zdCBsZW4wID0gV0FTTV9WRUNUT1JfTEVOOwogIHdhc20ucWNtc19jb252ZXJ0X2FycmF5KHRyYW5zZm9ybWVyLCBwdHIwLCBsZW4wKTsKfQpmdW5jdGlvbiBxY21zX2NvbnZlcnRfb25lKHRyYW5zZm9ybWVyLCBzcmMsIGNzcykgewogIHdhc20ucWNtc19jb252ZXJ0X29uZSh0cmFuc2Zvcm1lciwgc3JjLCBjc3MpOwp9CmZ1bmN0aW9uIHFjbXNfY29udmVydF90aHJlZSh0cmFuc2Zvcm1lciwgc3JjMSwgc3JjMiwgc3JjMywgY3NzKSB7CiAgd2FzbS5xY21zX2NvbnZlcnRfdGhyZWUodHJhbnNmb3JtZXIsIHNyYzEsIHNyYzIsIHNyYzMsIGNzcyk7Cn0KZnVuY3Rpb24gcWNtc19jb252ZXJ0X2ZvdXIodHJhbnNmb3JtZXIsIHNyYzEsIHNyYzIsIHNyYzMsIHNyYzQsIGNzcykgewogIHdhc20ucWNtc19jb252ZXJ0X2ZvdXIodHJhbnNmb3JtZXIsIHNyYzEsIHNyYzIsIHNyYzMsIHNyYzQsIGNzcyk7Cn0KZnVuY3Rpb24gcWNtc190cmFuc2Zvcm1lcl9mcm9tX21lbW9yeShtZW0sIGluX3R5cGUsIGludGVudCkgewogIGNvbnN0IHB0cjAgPSBwYXNzQXJyYXk4VG9XYXNtMChtZW0sIHdhc20uX193YmluZGdlbl9tYWxsb2MpOwogIGNvbnN0IGxlbjAgPSBXQVNNX1ZFQ1RPUl9MRU47CiAgY29uc3QgcmV0ID0gd2FzbS5xY21zX3RyYW5zZm9ybWVyX2Zyb21fbWVtb3J5KHB0cjAsIGxlbjAsIGluX3R5cGUsIGludGVudCk7CiAgcmV0dXJuIHJldCA+Pj4gMDsKfQpmdW5jdGlvbiBxY21zX2Ryb3BfdHJhbnNmb3JtZXIodHJhbnNmb3JtZXIpIHsKICB3YXNtLnFjbXNfZHJvcF90cmFuc2Zvcm1lcih0cmFuc2Zvcm1lcik7Cn0KY29uc3QgRGF0YVR5cGUgPSBPYmplY3QuZnJlZXplKHsKICBSR0I4OiAwLAogICIwIjogIlJHQjgiLAogIFJHQkE4OiAxLAogICIxIjogIlJHQkE4IiwKICBCR1JBODogMiwKICAiMiI6ICJCR1JBOCIsCiAgR3JheTg6IDMsCiAgIjMiOiAiR3JheTgiLAogIEdyYXlBODogNCwKICAiNCI6ICJHcmF5QTgiLAogIENNWUs6IDUsCiAgIjUiOiAiQ01ZSyIKfSk7CmNvbnN0IEludGVudCA9IE9iamVjdC5mcmVlemUoewogIFBlcmNlcHR1YWw6IDAsCiAgIjAiOiAiUGVyY2VwdHVhbCIsCiAgUmVsYXRpdmVDb2xvcmltZXRyaWM6IDEsCiAgIjEiOiAiUmVsYXRpdmVDb2xvcmltZXRyaWMiLAogIFNhdHVyYXRpb246IDIsCiAgIjIiOiAiU2F0dXJhdGlvbiIsCiAgQWJzb2x1dGVDb2xvcmltZXRyaWM6IDMsCiAgIjMiOiAiQWJzb2x1dGVDb2xvcmltZXRyaWMiCn0pOwphc3luYyBmdW5jdGlvbiBfX3diZ19sb2FkKG1vZHVsZSwgaW1wb3J0cykgewogIGlmICh0eXBlb2YgUmVzcG9uc2UgPT09ICdmdW5jdGlvbicgJiYgbW9kdWxlIGluc3RhbmNlb2YgUmVzcG9uc2UpIHsKICAgIGlmICh0eXBlb2YgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcgPT09ICdmdW5jdGlvbicpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gYXdhaXQgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcobW9kdWxlLCBpbXBvcnRzKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmIChtb2R1bGUuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScpICE9ICdhcHBsaWNhdGlvbi93YXNtJykgewogICAgICAgICAgY29uc29sZS53YXJuKCJgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmdgIGZhaWxlZCBiZWNhdXNlIHlvdXIgc2VydmVyIGRvZXMgbm90IHNlcnZlIFdhc20gd2l0aCBgYXBwbGljYXRpb24vd2FzbWAgTUlNRSB0eXBlLiBGYWxsaW5nIGJhY2sgdG8gYFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlYCB3aGljaCBpcyBzbG93ZXIuIE9yaWdpbmFsIGVycm9yOlxuIiwgZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCBieXRlcyA9IGF3YWl0IG1vZHVsZS5hcnJheUJ1ZmZlcigpOwogICAgcmV0dXJuIGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGJ5dGVzLCBpbXBvcnRzKTsKICB9IGVsc2UgewogICAgY29uc3QgaW5zdGFuY2UgPSBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShtb2R1bGUsIGltcG9ydHMpOwogICAgaWYgKGluc3RhbmNlIGluc3RhbmNlb2YgV2ViQXNzZW1ibHkuSW5zdGFuY2UpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBpbnN0YW5jZSwKICAgICAgICBtb2R1bGUKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBpbnN0YW5jZTsKICAgIH0KICB9Cn0KZnVuY3Rpb24gX193YmdfZ2V0X2ltcG9ydHMoKSB7CiAgY29uc3QgaW1wb3J0cyA9IHt9OwogIGltcG9ydHMud2JnID0ge307CiAgaW1wb3J0cy53YmcuX193YmdfY29weXJlc3VsdF9iMDhlZTdkMjczZjI5NWRkID0gZnVuY3Rpb24gKGFyZzAsIGFyZzEpIHsKICAgIGNvcHlfcmVzdWx0KGFyZzAgPj4+IDAsIGFyZzEgPj4+IDApOwogIH07CiAgaW1wb3J0cy53YmcuX193YmdfY29weXJnYl9kNjBjZTE3YmIwNWQ5YjY3ID0gZnVuY3Rpb24gKGFyZzApIHsKICAgIGNvcHlfcmdiKGFyZzAgPj4+IDApOwogIH07CiAgaW1wb3J0cy53YmcuX193YmdfbWFrZWNzc1JHQl84OTNiZjBjZDlmZGIzMDJkID0gZnVuY3Rpb24gKGFyZzApIHsKICAgIG1ha2VfY3NzUkdCKGFyZzAgPj4+IDApOwogIH07CiAgaW1wb3J0cy53YmcuX193YmluZGdlbl9pbml0X2V4dGVybnJlZl90YWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IHRhYmxlID0gd2FzbS5fX3diaW5kZ2VuX2V4cG9ydF8wOwogICAgY29uc3Qgb2Zmc2V0ID0gdGFibGUuZ3Jvdyg0KTsKICAgIHRhYmxlLnNldCgwLCB1bmRlZmluZWQpOwogICAgdGFibGUuc2V0KG9mZnNldCArIDAsIHVuZGVmaW5lZCk7CiAgICB0YWJsZS5zZXQob2Zmc2V0ICsgMSwgbnVsbCk7CiAgICB0YWJsZS5zZXQob2Zmc2V0ICsgMiwgdHJ1ZSk7CiAgICB0YWJsZS5zZXQob2Zmc2V0ICsgMywgZmFsc2UpOwogIH07CiAgaW1wb3J0cy53YmcuX193YmluZGdlbl90aHJvdyA9IGZ1bmN0aW9uIChhcmcwLCBhcmcxKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoZ2V0U3RyaW5nRnJvbVdhc20wKGFyZzAsIGFyZzEpKTsKICB9OwogIHJldHVybiBpbXBvcnRzOwp9CmZ1bmN0aW9uIF9fd2JnX2luaXRfbWVtb3J5KGltcG9ydHMsIG1lbW9yeSkge30KZnVuY3Rpb24gX193YmdfZmluYWxpemVfaW5pdChpbnN0YW5jZSwgbW9kdWxlKSB7CiAgd2FzbSA9IGluc3RhbmNlLmV4cG9ydHM7CiAgX193YmdfaW5pdC5fX3diaW5kZ2VuX3dhc21fbW9kdWxlID0gbW9kdWxlOwogIGNhY2hlZFVpbnQ4QXJyYXlNZW1vcnkwID0gbnVsbDsKICB3YXNtLl9fd2JpbmRnZW5fc3RhcnQoKTsKICByZXR1cm4gd2FzbTsKfQpmdW5jdGlvbiBpbml0U3luYyhtb2R1bGUpIHsKICBpZiAod2FzbSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gd2FzbTsKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YobW9kdWxlKSA9PT0gT2JqZWN0LnByb3RvdHlwZSkgewogICAgICAoewogICAgICAgIG1vZHVsZQogICAgICB9ID0gbW9kdWxlKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUud2FybigndXNpbmcgZGVwcmVjYXRlZCBwYXJhbWV0ZXJzIGZvciBgaW5pdFN5bmMoKWA7IHBhc3MgYSBzaW5nbGUgb2JqZWN0IGluc3RlYWQnKTsKICAgIH0KICB9CiAgY29uc3QgaW1wb3J0cyA9IF9fd2JnX2dldF9pbXBvcnRzKCk7CiAgX193YmdfaW5pdF9tZW1vcnkoaW1wb3J0cyk7CiAgaWYgKCEobW9kdWxlIGluc3RhbmNlb2YgV2ViQXNzZW1ibHkuTW9kdWxlKSkgewogICAgbW9kdWxlID0gbmV3IFdlYkFzc2VtYmx5Lk1vZHVsZShtb2R1bGUpOwogIH0KICBjb25zdCBpbnN0YW5jZSA9IG5ldyBXZWJBc3NlbWJseS5JbnN0YW5jZShtb2R1bGUsIGltcG9ydHMpOwogIHJldHVybiBfX3diZ19maW5hbGl6ZV9pbml0KGluc3RhbmNlLCBtb2R1bGUpOwp9CmFzeW5jIGZ1bmN0aW9uIF9fd2JnX2luaXQobW9kdWxlX29yX3BhdGgpIHsKICBpZiAod2FzbSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gd2FzbTsKICBpZiAodHlwZW9mIG1vZHVsZV9vcl9wYXRoICE9PSAndW5kZWZpbmVkJykgewogICAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZihtb2R1bGVfb3JfcGF0aCkgPT09IE9iamVjdC5wcm90b3R5cGUpIHsKICAgICAgKHsKICAgICAgICBtb2R1bGVfb3JfcGF0aAogICAgICB9ID0gbW9kdWxlX29yX3BhdGgpOwogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS53YXJuKCd1c2luZyBkZXByZWNhdGVkIHBhcmFtZXRlcnMgZm9yIHRoZSBpbml0aWFsaXphdGlvbiBmdW5jdGlvbjsgcGFzcyBhIHNpbmdsZSBvYmplY3QgaW5zdGVhZCcpOwogICAgfQogIH0KICBjb25zdCBpbXBvcnRzID0gX193YmdfZ2V0X2ltcG9ydHMoKTsKICBpZiAodHlwZW9mIG1vZHVsZV9vcl9wYXRoID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgUmVxdWVzdCA9PT0gJ2Z1bmN0aW9uJyAmJiBtb2R1bGVfb3JfcGF0aCBpbnN0YW5jZW9mIFJlcXVlc3QgfHwgdHlwZW9mIFVSTCA9PT0gJ2Z1bmN0aW9uJyAmJiBtb2R1bGVfb3JfcGF0aCBpbnN0YW5jZW9mIFVSTCkgewogICAgbW9kdWxlX29yX3BhdGggPSBmZXRjaChtb2R1bGVfb3JfcGF0aCk7CiAgfQogIF9fd2JnX2luaXRfbWVtb3J5KGltcG9ydHMpOwogIGNvbnN0IHsKICAgIGluc3RhbmNlLAogICAgbW9kdWxlCiAgfSA9IGF3YWl0IF9fd2JnX2xvYWQoYXdhaXQgbW9kdWxlX29yX3BhdGgsIGltcG9ydHMpOwogIHJldHVybiBfX3diZ19maW5hbGl6ZV9pbml0KGluc3RhbmNlLCBtb2R1bGUpOwp9CgovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGNvbnN0IHFjbXMgPSAoKC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi8gbnVsbCAmJiAoX193YmdfaW5pdCkpKTsKOy8vIC4vc3JjL2NvcmUvY29sb3JzcGFjZS5qcwoKCmZ1bmN0aW9uIHJlc2l6ZVJnYkltYWdlKHNyYywgZGVzdCwgdzEsIGgxLCB3MiwgaDIsIGFscGhhMDEpIHsKICBjb25zdCBDT01QT05FTlRTID0gMzsKICBhbHBoYTAxID0gYWxwaGEwMSAhPT0gMSA/IDAgOiBhbHBoYTAxOwogIGNvbnN0IHhSYXRpbyA9IHcxIC8gdzI7CiAgY29uc3QgeVJhdGlvID0gaDEgLyBoMjsKICBsZXQgbmV3SW5kZXggPSAwLAogICAgb2xkSW5kZXg7CiAgY29uc3QgeFNjYWxlZCA9IG5ldyBVaW50MTZBcnJheSh3Mik7CiAgY29uc3QgdzFTY2FubGluZSA9IHcxICogQ09NUE9ORU5UUzsKICBmb3IgKGxldCBpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgIHhTY2FsZWRbaV0gPSBNYXRoLmZsb29yKGkgKiB4UmF0aW8pICogQ09NUE9ORU5UUzsKICB9CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoMjsgaSsrKSB7CiAgICBjb25zdCBweSA9IE1hdGguZmxvb3IoaSAqIHlSYXRpbykgKiB3MVNjYW5saW5lOwogICAgZm9yIChsZXQgaiA9IDA7IGogPCB3MjsgaisrKSB7CiAgICAgIG9sZEluZGV4ID0gcHkgKyB4U2NhbGVkW2pdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBuZXdJbmRleCArPSBhbHBoYTAxOwogICAgfQogIH0KfQpmdW5jdGlvbiByZXNpemVSZ2JhSW1hZ2Uoc3JjLCBkZXN0LCB3MSwgaDEsIHcyLCBoMiwgYWxwaGEwMSkgewogIGNvbnN0IHhSYXRpbyA9IHcxIC8gdzI7CiAgY29uc3QgeVJhdGlvID0gaDEgLyBoMjsKICBsZXQgbmV3SW5kZXggPSAwOwogIGNvbnN0IHhTY2FsZWQgPSBuZXcgVWludDE2QXJyYXkodzIpOwogIGlmIChhbHBoYTAxID09PSAxKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgICAgeFNjYWxlZFtpXSA9IE1hdGguZmxvb3IoaSAqIHhSYXRpbyk7CiAgICB9CiAgICBjb25zdCBzcmMzMiA9IG5ldyBVaW50MzJBcnJheShzcmMuYnVmZmVyKTsKICAgIGNvbnN0IGRlc3QzMiA9IG5ldyBVaW50MzJBcnJheShkZXN0LmJ1ZmZlcik7CiAgICBjb25zdCByZ2JNYXNrID0gRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4gPyAweDAwZmZmZmZmIDogMHhmZmZmZmYwMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaDI7IGkrKykgewogICAgICBjb25zdCBidWYgPSBzcmMzMi5zdWJhcnJheShNYXRoLmZsb29yKGkgKiB5UmF0aW8pICogdzEpOwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHcyOyBqKyspIHsKICAgICAgICBkZXN0MzJbbmV3SW5kZXgrK10gfD0gYnVmW3hTY2FsZWRbal1dICYgcmdiTWFzazsKICAgICAgfQogICAgfQogIH0gZWxzZSB7CiAgICBjb25zdCBDT01QT05FTlRTID0gNDsKICAgIGNvbnN0IHcxU2NhbmxpbmUgPSB3MSAqIENPTVBPTkVOVFM7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgICAgeFNjYWxlZFtpXSA9IE1hdGguZmxvb3IoaSAqIHhSYXRpbykgKiBDT01QT05FTlRTOwogICAgfQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoMjsgaSsrKSB7CiAgICAgIGNvbnN0IGJ1ZiA9IHNyYy5zdWJhcnJheShNYXRoLmZsb29yKGkgKiB5UmF0aW8pICogdzFTY2FubGluZSk7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdzI7IGorKykgewogICAgICAgIGNvbnN0IG9sZEluZGV4ID0geFNjYWxlZFtqXTsKICAgICAgICBkZXN0W25ld0luZGV4KytdID0gYnVmW29sZEluZGV4XTsKICAgICAgICBkZXN0W25ld0luZGV4KytdID0gYnVmW29sZEluZGV4ICsgMV07CiAgICAgICAgZGVzdFtuZXdJbmRleCsrXSA9IGJ1ZltvbGRJbmRleCArIDJdOwogICAgICB9CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGNvcHlSZ2JhSW1hZ2Uoc3JjLCBkZXN0LCBhbHBoYTAxKSB7CiAgaWYgKGFscGhhMDEgPT09IDEpIHsKICAgIGNvbnN0IHNyYzMyID0gbmV3IFVpbnQzMkFycmF5KHNyYy5idWZmZXIpOwogICAgY29uc3QgZGVzdDMyID0gbmV3IFVpbnQzMkFycmF5KGRlc3QuYnVmZmVyKTsKICAgIGNvbnN0IHJnYk1hc2sgPSBGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4MDBmZmZmZmYgOiAweGZmZmZmZjAwOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjMzIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBkZXN0MzJbaV0gfD0gc3JjMzJbaV0gJiByZ2JNYXNrOwogICAgfQogIH0gZWxzZSB7CiAgICBsZXQgaiA9IDA7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzcmMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gNCkgewogICAgICBkZXN0W2orK10gPSBzcmNbaV07CiAgICAgIGRlc3RbaisrXSA9IHNyY1tpICsgMV07CiAgICAgIGRlc3RbaisrXSA9IHNyY1tpICsgMl07CiAgICB9CiAgfQp9CmNsYXNzIENvbG9yU3BhY2UgewogIHN0YXRpYyAjcmdiQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwogIGNvbnN0cnVjdG9yKG5hbWUsIG51bUNvbXBzKSB7CiAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgdGhpcy5udW1Db21wcyA9IG51bUNvbXBzOwogIH0KICBnZXRSZ2Ioc3JjLCBzcmNPZmZzZXQsIG91dHB1dCA9IG5ldyBVaW50OENsYW1wZWRBcnJheSgzKSkgewogICAgdGhpcy5nZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBvdXRwdXQsIDApOwogICAgcmV0dXJuIG91dHB1dDsKICB9CiAgZ2V0UmdiSGV4KHNyYywgc3JjT2Zmc2V0KSB7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmdldFJnYihzcmMsIHNyY09mZnNldCwgQ29sb3JTcGFjZS4jcmdiQnVmKTsKICAgIHJldHVybiBVdGlsLm1ha2VIZXhDb2xvcihidWZmZXJbMF0sIGJ1ZmZlclsxXSwgYnVmZmVyWzJdKTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBDb2xvclNwYWNlLmdldFJnYkl0ZW0iKTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBDb2xvclNwYWNlLmdldFJnYkJ1ZmZlciIpOwogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgQ29sb3JTcGFjZS5nZXRPdXRwdXRMZW5ndGgiKTsKICB9CiAgaXNQYXNzdGhyb3VnaChiaXRzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgcmV0dXJuIENvbG9yU3BhY2UuaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgdGhpcy5udW1Db21wcyk7CiAgfQogIGZpbGxSZ2IoZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFjdHVhbEhlaWdodCwgYnBjLCBjb21wcywgYWxwaGEwMSkgewogICAgY29uc3QgY291bnQgPSBvcmlnaW5hbFdpZHRoICogb3JpZ2luYWxIZWlnaHQ7CiAgICBsZXQgcmdiQnVmID0gbnVsbDsKICAgIGNvbnN0IG51bUNvbXBvbmVudENvbG9ycyA9IDEgPDwgYnBjOwogICAgY29uc3QgbmVlZHNSZXNpemluZyA9IG9yaWdpbmFsSGVpZ2h0ICE9PSBoZWlnaHQgfHwgb3JpZ2luYWxXaWR0aCAhPT0gd2lkdGg7CiAgICBpZiAodGhpcy5pc1Bhc3N0aHJvdWdoKGJwYykpIHsKICAgICAgcmdiQnVmID0gY29tcHM7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcHMgPT09IDEgJiYgY291bnQgPiBudW1Db21wb25lbnRDb2xvcnMgJiYgdGhpcy5uYW1lICE9PSAiRGV2aWNlR3JheSIgJiYgdGhpcy5uYW1lICE9PSAiRGV2aWNlUkdCIikgewogICAgICBjb25zdCBhbGxDb2xvcnMgPSBicGMgPD0gOCA/IG5ldyBVaW50OEFycmF5KG51bUNvbXBvbmVudENvbG9ycykgOiBuZXcgVWludDE2QXJyYXkobnVtQ29tcG9uZW50Q29sb3JzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Db21wb25lbnRDb2xvcnM7IGkrKykgewogICAgICAgIGFsbENvbG9yc1tpXSA9IGk7CiAgICAgIH0KICAgICAgY29uc3QgY29sb3JNYXAgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobnVtQ29tcG9uZW50Q29sb3JzICogMyk7CiAgICAgIHRoaXMuZ2V0UmdiQnVmZmVyKGFsbENvbG9ycywgMCwgbnVtQ29tcG9uZW50Q29sb3JzLCBjb2xvck1hcCwgMCwgYnBjLCAwKTsKICAgICAgaWYgKCFuZWVkc1Jlc2l6aW5nKSB7CiAgICAgICAgbGV0IGRlc3RQb3MgPSAwOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICAgICAgY29uc3Qga2V5ID0gY29tcHNbaV0gKiAzOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5XTsKICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGNvbG9yTWFwW2tleSArIDFdOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5ICsgMl07CiAgICAgICAgICBkZXN0UG9zICs9IGFscGhhMDE7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJnYkJ1ZiA9IG5ldyBVaW50OEFycmF5KGNvdW50ICogMyk7CiAgICAgICAgbGV0IHJnYlBvcyA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgICAgICBjb25zdCBrZXkgPSBjb21wc1tpXSAqIDM7CiAgICAgICAgICByZ2JCdWZbcmdiUG9zKytdID0gY29sb3JNYXBba2V5XTsKICAgICAgICAgIHJnYkJ1ZltyZ2JQb3MrK10gPSBjb2xvck1hcFtrZXkgKyAxXTsKICAgICAgICAgIHJnYkJ1ZltyZ2JQb3MrK10gPSBjb2xvck1hcFtrZXkgKyAyXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIW5lZWRzUmVzaXppbmcpIHsKICAgICAgdGhpcy5nZXRSZ2JCdWZmZXIoY29tcHMsIDAsIHdpZHRoICogYWN0dWFsSGVpZ2h0LCBkZXN0LCAwLCBicGMsIGFscGhhMDEpOwogICAgfSBlbHNlIHsKICAgICAgcmdiQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGNvdW50ICogMyk7CiAgICAgIHRoaXMuZ2V0UmdiQnVmZmVyKGNvbXBzLCAwLCBjb3VudCwgcmdiQnVmLCAwLCBicGMsIDApOwogICAgfQogICAgaWYgKHJnYkJ1ZikgewogICAgICBpZiAobmVlZHNSZXNpemluZykgewogICAgICAgIHJlc2l6ZVJnYkltYWdlKHJnYkJ1ZiwgZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFscGhhMDEpOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBkZXN0UG9zID0gMCwKICAgICAgICAgIHJnYlBvcyA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBkZXN0W2Rlc3RQb3MrK10gPSByZ2JCdWZbcmdiUG9zKytdOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gcmdiQnVmW3JnYlBvcysrXTsKICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHJnYkJ1ZltyZ2JQb3MrK107CiAgICAgICAgICBkZXN0UG9zICs9IGFscGhhMDE7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGdldCB1c2VzWmVyb1RvT25lUmFuZ2UoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ1c2VzWmVyb1RvT25lUmFuZ2UiLCB0cnVlKTsKICB9CiAgc3RhdGljIGlzRGVmYXVsdERlY29kZShkZWNvZGUsIG51bUNvbXBzKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGVjb2RlKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChudW1Db21wcyAqIDIgIT09IGRlY29kZS5sZW5ndGgpIHsKICAgICAgd2FybigiVGhlIGRlY29kZSBtYXAgaXMgbm90IHRoZSBjb3JyZWN0IGxlbmd0aCIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGRlY29kZS5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIGlmIChkZWNvZGVbaV0gIT09IDAgfHwgZGVjb2RlW2kgKyAxXSAhPT0gMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIEFsdGVybmF0ZUNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IobnVtQ29tcHMsIGJhc2UsIHRpbnRGbikgewogICAgc3VwZXIoIkFsdGVybmF0ZSIsIG51bUNvbXBzKTsKICAgIHRoaXMuYmFzZSA9IGJhc2U7CiAgICB0aGlzLnRpbnRGbiA9IHRpbnRGbjsKICAgIHRoaXMudG1wQnVmID0gbmV3IEZsb2F0MzJBcnJheShiYXNlLm51bUNvbXBzKTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgY29uc3QgdG1wQnVmID0gdGhpcy50bXBCdWY7CiAgICB0aGlzLnRpbnRGbihzcmMsIHNyY09mZnNldCwgdG1wQnVmLCAwKTsKICAgIHRoaXMuYmFzZS5nZXRSZ2JJdGVtKHRtcEJ1ZiwgMCwgZGVzdCwgZGVzdE9mZnNldCk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHRpbnRGbiA9IHRoaXMudGludEZuOwogICAgY29uc3QgYmFzZSA9IHRoaXMuYmFzZTsKICAgIGNvbnN0IHNjYWxlID0gMSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgY29uc3QgYmFzZU51bUNvbXBzID0gYmFzZS5udW1Db21wczsKICAgIGNvbnN0IHVzZXNaZXJvVG9PbmVSYW5nZSA9IGJhc2UudXNlc1plcm9Ub09uZVJhbmdlOwogICAgY29uc3QgaXNQYXNzdGhyb3VnaCA9IChiYXNlLmlzUGFzc3Rocm91Z2goOCkgfHwgIXVzZXNaZXJvVG9PbmVSYW5nZSkgJiYgYWxwaGEwMSA9PT0gMDsKICAgIGxldCBwb3MgPSBpc1Bhc3N0aHJvdWdoID8gZGVzdE9mZnNldCA6IDA7CiAgICBjb25zdCBiYXNlQnVmID0gaXNQYXNzdGhyb3VnaCA/IGRlc3QgOiBuZXcgVWludDhDbGFtcGVkQXJyYXkoYmFzZU51bUNvbXBzICogY291bnQpOwogICAgY29uc3QgbnVtQ29tcHMgPSB0aGlzLm51bUNvbXBzOwogICAgY29uc3Qgc2NhbGVkID0gbmV3IEZsb2F0MzJBcnJheShudW1Db21wcyk7CiAgICBjb25zdCB0aW50ZWQgPSBuZXcgRmxvYXQzMkFycmF5KGJhc2VOdW1Db21wcyk7CiAgICBsZXQgaSwgajsKICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIGZvciAoaiA9IDA7IGogPCBudW1Db21wczsgaisrKSB7CiAgICAgICAgc2NhbGVkW2pdID0gc3JjW3NyY09mZnNldCsrXSAqIHNjYWxlOwogICAgICB9CiAgICAgIHRpbnRGbihzY2FsZWQsIDAsIHRpbnRlZCwgMCk7CiAgICAgIGlmICh1c2VzWmVyb1RvT25lUmFuZ2UpIHsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgYmFzZU51bUNvbXBzOyBqKyspIHsKICAgICAgICAgIGJhc2VCdWZbcG9zKytdID0gdGludGVkW2pdICogMjU1OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBiYXNlLmdldFJnYkl0ZW0odGludGVkLCAwLCBiYXNlQnVmLCBwb3MpOwogICAgICAgIHBvcyArPSBiYXNlTnVtQ29tcHM7CiAgICAgIH0KICAgIH0KICAgIGlmICghaXNQYXNzdGhyb3VnaCkgewogICAgICBiYXNlLmdldFJnYkJ1ZmZlcihiYXNlQnVmLCAwLCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgOCwgYWxwaGEwMSk7CiAgICB9CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgcmV0dXJuIHRoaXMuYmFzZS5nZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGggKiB0aGlzLmJhc2UubnVtQ29tcHMgLyB0aGlzLm51bUNvbXBzLCBhbHBoYTAxKTsKICB9Cn0KY2xhc3MgUGF0dGVybkNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoYmFzZUNTKSB7CiAgICBzdXBlcigiUGF0dGVybiIsIG51bGwpOwogICAgdGhpcy5iYXNlID0gYmFzZUNTOwogIH0KICBpc0RlZmF1bHREZWNvZGUoZGVjb2RlTWFwLCBicGMpIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgUGF0dGVybkNTLmlzRGVmYXVsdERlY29kZSIpOwogIH0KfQpjbGFzcyBJbmRleGVkQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcihiYXNlLCBoaWdoVmFsLCBsb29rdXApIHsKICAgIHN1cGVyKCJJbmRleGVkIiwgMSk7CiAgICB0aGlzLmJhc2UgPSBiYXNlOwogICAgdGhpcy5oaWdoVmFsID0gaGlnaFZhbDsKICAgIGNvbnN0IGxlbmd0aCA9IGJhc2UubnVtQ29tcHMgKiAoaGlnaFZhbCArIDEpOwogICAgdGhpcy5sb29rdXAgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgaWYgKGxvb2t1cCBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgY29uc3QgYnl0ZXMgPSBsb29rdXAuZ2V0Qnl0ZXMobGVuZ3RoKTsKICAgICAgdGhpcy5sb29rdXAuc2V0KGJ5dGVzKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGxvb2t1cCA9PT0gInN0cmluZyIpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgIHRoaXMubG9va3VwW2ldID0gbG9va3VwLmNoYXJDb2RlQXQoaSkgJiAweGZmOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEluZGV4ZWRDUyAtIHVucmVjb2duaXplZCBsb29rdXAgdGFibGU6ICR7bG9va3VwfWApOwogICAgfQogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICBjb25zdCB7CiAgICAgIGJhc2UsCiAgICAgIGhpZ2hWYWwsCiAgICAgIGxvb2t1cAogICAgfSA9IHRoaXM7CiAgICBjb25zdCBzdGFydCA9IE1hdGhDbGFtcChNYXRoLnJvdW5kKHNyY1tzcmNPZmZzZXRdKSwgMCwgaGlnaFZhbCkgKiBiYXNlLm51bUNvbXBzOwogICAgYmFzZS5nZXRSZ2JCdWZmZXIobG9va3VwLCBzdGFydCwgMSwgZGVzdCwgZGVzdE9mZnNldCwgOCwgMCk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHsKICAgICAgYmFzZSwKICAgICAgaGlnaFZhbCwKICAgICAgbG9va3VwCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgbnVtQ29tcHMKICAgIH0gPSBiYXNlOwogICAgY29uc3Qgb3V0cHV0RGVsdGEgPSBiYXNlLmdldE91dHB1dExlbmd0aChudW1Db21wcywgYWxwaGEwMSk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgY29uc3QgbG9va3VwUG9zID0gTWF0aENsYW1wKE1hdGgucm91bmQoc3JjW3NyY09mZnNldCsrXSksIDAsIGhpZ2hWYWwpICogbnVtQ29tcHM7CiAgICAgIGJhc2UuZ2V0UmdiQnVmZmVyKGxvb2t1cCwgbG9va3VwUG9zLCAxLCBkZXN0LCBkZXN0T2Zmc2V0LCA4LCBhbHBoYTAxKTsKICAgICAgZGVzdE9mZnNldCArPSBvdXRwdXREZWx0YTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlLmdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCAqIHRoaXMuYmFzZS5udW1Db21wcywgYWxwaGEwMSk7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgaWYgKCFBcnJheS5pc0FycmF5KGRlY29kZU1hcCkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoZGVjb2RlTWFwLmxlbmd0aCAhPT0gMikgewogICAgICB3YXJuKCJEZWNvZGUgbWFwIGxlbmd0aCBpcyBub3QgY29ycmVjdCIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihicGMpIHx8IGJwYyA8IDEpIHsKICAgICAgd2FybigiQml0cyBwZXIgY29tcG9uZW50IGlzIG5vdCBjb3JyZWN0Iik7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGRlY29kZU1hcFswXSA9PT0gMCAmJiBkZWNvZGVNYXBbMV0gPT09ICgxIDw8IGJwYykgLSAxOwogIH0KfQpjbGFzcyBEZXZpY2VHcmF5Q1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCJEZXZpY2VHcmF5IiwgMSk7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIGNvbnN0IGMgPSBzcmNbc3JjT2Zmc2V0XSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldF0gPSBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IGRlc3RbZGVzdE9mZnNldCArIDJdID0gYzsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3Qgc2NhbGUgPSAyNTUgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgIGxldCBqID0gc3JjT2Zmc2V0LAogICAgICBxID0gZGVzdE9mZnNldDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICBjb25zdCBjID0gc2NhbGUgKiBzcmNbaisrXTsKICAgICAgZGVzdFtxKytdID0gYzsKICAgICAgZGVzdFtxKytdID0gYzsKICAgICAgZGVzdFtxKytdID0gYzsKICAgICAgcSArPSBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqICgzICsgYWxwaGEwMSk7CiAgfQp9CmNsYXNzIERldmljZVJnYkNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigiRGV2aWNlUkdCIiwgMyk7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIGRlc3RbZGVzdE9mZnNldF0gPSBzcmNbc3JjT2Zmc2V0XSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gc3JjW3NyY09mZnNldCArIDFdICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSBzcmNbc3JjT2Zmc2V0ICsgMl0gKiAyNTU7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGlmIChiaXRzID09PSA4ICYmIGFscGhhMDEgPT09IDApIHsKICAgICAgZGVzdC5zZXQoc3JjLnN1YmFycmF5KHNyY09mZnNldCwgc3JjT2Zmc2V0ICsgY291bnQgKiAzKSwgZGVzdE9mZnNldCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHNjYWxlID0gMjU1IC8gKCgxIDw8IGJpdHMpIC0gMSk7CiAgICBsZXQgaiA9IHNyY09mZnNldCwKICAgICAgcSA9IGRlc3RPZmZzZXQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgZGVzdFtxKytdID0gc2NhbGUgKiBzcmNbaisrXTsKICAgICAgZGVzdFtxKytdID0gc2NhbGUgKiBzcmNbaisrXTsKICAgICAgZGVzdFtxKytdID0gc2NhbGUgKiBzcmNbaisrXTsKICAgICAgcSArPSBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqICgzICsgYWxwaGEwMSkgLyAzIHwgMDsKICB9CiAgaXNQYXNzdGhyb3VnaChiaXRzKSB7CiAgICByZXR1cm4gYml0cyA9PT0gODsKICB9Cn0KY2xhc3MgRGV2aWNlUmdiYUNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigiRGV2aWNlUkdCQSIsIDQpOwogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIF9hbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiA0OwogIH0KICBpc1Bhc3N0aHJvdWdoKGJpdHMpIHsKICAgIHJldHVybiBiaXRzID09PSA4OwogIH0KICBmaWxsUmdiKGRlc3QsIG9yaWdpbmFsV2lkdGgsIG9yaWdpbmFsSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBhY3R1YWxIZWlnaHQsIGJwYywgY29tcHMsIGFscGhhMDEpIHsKICAgIGlmIChvcmlnaW5hbEhlaWdodCAhPT0gaGVpZ2h0IHx8IG9yaWdpbmFsV2lkdGggIT09IHdpZHRoKSB7CiAgICAgIHJlc2l6ZVJnYmFJbWFnZShjb21wcywgZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFscGhhMDEpOwogICAgfSBlbHNlIHsKICAgICAgY29weVJnYmFJbWFnZShjb21wcywgZGVzdCwgYWxwaGEwMSk7CiAgICB9CiAgfQp9CmNsYXNzIERldmljZUNteWtDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoIkRldmljZUNNWUsiLCA0KTsKICB9CiAgI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBzcmNTY2FsZSwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgY29uc3QgYyA9IHNyY1tzcmNPZmZzZXRdICogc3JjU2NhbGU7CiAgICBjb25zdCBtID0gc3JjW3NyY09mZnNldCArIDFdICogc3JjU2NhbGU7CiAgICBjb25zdCB5ID0gc3JjW3NyY09mZnNldCArIDJdICogc3JjU2NhbGU7CiAgICBjb25zdCBrID0gc3JjW3NyY09mZnNldCArIDNdICogc3JjU2NhbGU7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gMjU1ICsgYyAqICgtNC4zODczMzIzODQ2MDk5ODggKiBjICsgNTQuNDg2MTUxOTQxODkxNzYgKiBtICsgMTguODIyOTA1MDIxNjUzMDIgKiB5ICsgMjEyLjI1NjYyNDUxNjM5NTg1ICogayArIC0yODUuMjMzMTAyNjEzNzAwNCkgKyBtICogKDEuNzE0OTc2MzQ3NzM2MjEzNCAqIG0gLSA1LjYwOTY3MzY5MDQwNDczMTUgKiB5ICsgLTE3Ljg3Mzg3MDg2MTQxNTQ0NCAqIGsgLSA1LjQ5NzAwNjQyNzE5NjM2NikgKyB5ICogKC0yLjUyMTczNDAxMzE2ODMwMzMgKiB5IC0gMjEuMjQ4OTIzMzM3MzUzMDczICogayArIDE3LjUxMTkyNzA4NDE4MTMpICsgayAqICgtMjEuODYxMjIxNDc0NjM2MDUgKiBrIC0gMTg5LjQ4MTgwODM1OTIyNzQ3KTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gMjU1ICsgYyAqICg4Ljg0MTA0MTQyMjAzNjE0OSAqIGMgKyA2MC4xMTgwMjcwNDU1OTczNjYgKiBtICsgNi44NzE0MjU1OTIwNDkwMDcgKiB5ICsgMzEuMTU5MTAwMTMwMDU1OTIyICogayArIC03OS4yOTcwODQ0ODE2NTQ4KSArIG0gKiAoLTE1LjMxMDM2MTMwNjk2NzgxNyAqIG0gKyAxNy41NzUyNTEyNjExMDk0ODIgKiB5ICsgMTMxLjM1MjUwOTEyNDkzOTc2ICogayAtIDE5MC45NDUzMzAyNTg4OTUxKSArIHkgKiAoNC40NDQzMzkxMDI4NTI3MzkgKiB5ICsgOS44NjMyODYxNDkzNDA1ICogayAtIDI0Ljg2NzQxNTgyNTU1ODc4KSArIGsgKiAoLTIwLjczNzMyNTQ3MTE4MTAzNCAqIGsgLSAxODcuODA0NTM3MDk3MTk1NzgpOwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSAyNTUgKyBjICogKDAuODg0MjUyMjQzMDAwMzI5NiAqIGMgKyA4LjA3ODY3NzUwMzExMjkyOCAqIG0gKyAzMC44OTk3ODMwOTcwMzcyOSAqIHkgLSAwLjIzODgzMjM4Njg5MTc4OTM0ICogayArIC0xNC4xODM1NzY3OTk2NzMyODYpICsgbSAqICgxMC40OTU5MzI3MzQzMjA3MiAqIG0gKyA2My4wMjM3ODQ5NDc1NDA1MiAqIHkgKyA1MC42MDY5NTc2NTYzNjA3MzQgKiBrIC0gMTEyLjIzODg0MjUzNzE5MjQ4KSArIHkgKiAoMC4wMzI5NjA0MTExNDg3MzIxNyAqIHkgKyAxMTUuNjAzODQ0NDk2NDY2NDEgKiBrICsgLTE5My41ODIwOTM1Njg2MTUwNSkgKyBrICogKC0yMi4zMzgxNjgwNzMwOTg4NiAqIGsgLSAxODAuMTI2MTM5NzQ3MDgzNjcpOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgMSwgZGVzdCwgZGVzdE9mZnNldCk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHNjYWxlID0gMSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBzY2FsZSwgZGVzdCwgZGVzdE9mZnNldCk7CiAgICAgIHNyY09mZnNldCArPSA0OwogICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAvIDQgKiAoMyArIGFscGhhMDEpIHwgMDsKICB9Cn0KY2xhc3MgQ2FsR3JheUNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3Iod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEpIHsKICAgIHN1cGVyKCJDYWxHcmF5IiwgMSk7CiAgICBpZiAoIXdoaXRlUG9pbnQpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJXaGl0ZVBvaW50IG1pc3NpbmcgLSByZXF1aXJlZCBmb3IgY29sb3Igc3BhY2UgQ2FsR3JheSIpOwogICAgfQogICAgW3RoaXMuWFcsIHRoaXMuWVcsIHRoaXMuWlddID0gd2hpdGVQb2ludDsKICAgIFt0aGlzLlhCLCB0aGlzLllCLCB0aGlzLlpCXSA9IGJsYWNrUG9pbnQgfHwgWzAsIDAsIDBdOwogICAgdGhpcy5HID0gZ2FtbWEgfHwgMTsKICAgIGlmICh0aGlzLlhXIDwgMCB8fCB0aGlzLlpXIDwgMCB8fCB0aGlzLllXICE9PSAxKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBXaGl0ZVBvaW50IGNvbXBvbmVudHMgZm9yICR7dGhpcy5uYW1lfSwgbm8gZmFsbGJhY2sgYXZhaWxhYmxlYCk7CiAgICB9CiAgICBpZiAodGhpcy5YQiA8IDAgfHwgdGhpcy5ZQiA8IDAgfHwgdGhpcy5aQiA8IDApIHsKICAgICAgaW5mbyhgSW52YWxpZCBCbGFja1BvaW50IGZvciAke3RoaXMubmFtZX0sIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0LmApOwogICAgICB0aGlzLlhCID0gdGhpcy5ZQiA9IHRoaXMuWkIgPSAwOwogICAgfQogICAgaWYgKHRoaXMuWEIgIT09IDAgfHwgdGhpcy5ZQiAhPT0gMCB8fCB0aGlzLlpCICE9PSAwKSB7CiAgICAgIHdhcm4oYCR7dGhpcy5uYW1lfSwgQmxhY2tQb2ludDogWEI6ICR7dGhpcy5YQn0sIFlCOiAke3RoaXMuWUJ9LCBgICsgYFpCOiAke3RoaXMuWkJ9LCBvbmx5IGRlZmF1bHQgdmFsdWVzIGFyZSBzdXBwb3J0ZWQuYCk7CiAgICB9CiAgICBpZiAodGhpcy5HIDwgMSkgewogICAgICBpbmZvKGBJbnZhbGlkIEdhbW1hOiAke3RoaXMuR30gZm9yICR7dGhpcy5uYW1lfSwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuYCk7CiAgICAgIHRoaXMuRyA9IDE7CiAgICB9CiAgfQogICN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpIHsKICAgIGNvbnN0IEEgPSBzcmNbc3JjT2Zmc2V0XSAqIHNjYWxlOwogICAgY29uc3QgQUcgPSBBICoqIHRoaXMuRzsKICAgIGNvbnN0IEwgPSB0aGlzLllXICogQUc7CiAgICBjb25zdCB2YWwgPSBNYXRoLm1heCgyOTUuOCAqIEwgKiogMC4zMzMzMzMzMzMzMzMzMzMzIC0gNDAuOCwgMCk7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gdmFsOwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSB2YWw7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IHZhbDsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIDEpOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBzY2FsZSA9IDEgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpOwogICAgICBzcmNPZmZzZXQgKz0gMTsKICAgICAgZGVzdE9mZnNldCArPSAzICsgYWxwaGEwMTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpOwogIH0KfQpjbGFzcyBDYWxSR0JDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIHN0YXRpYyAjQlJBREZPUkRfU0NBTEVfTUFUUklYID0gbmV3IEZsb2F0MzJBcnJheShbMC44OTUxLCAwLjI2NjQsIC0wLjE2MTQsIC0wLjc1MDIsIDEuNzEzNSwgMC4wMzY3LCAwLjAzODksIC0wLjA2ODUsIDEuMDI5Nl0pOwogIHN0YXRpYyAjQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFswLjk4Njk5MjksIC0wLjE0NzA1NDMsIDAuMTU5OTYyNywgMC40MzIzMDUzLCAwLjUxODM2MDMsIDAuMDQ5MjkxMiwgLTAuMDA4NTI4NywgMC4wNDAwNDI4LCAwLjk2ODQ4NjddKTsKICBzdGF0aWMgI1NSR0JfRDY1X1hZWl9UT19SR0JfTUFUUklYID0gbmV3IEZsb2F0MzJBcnJheShbMy4yNDA0NTQyLCAtMS41MzcxMzg1LCAtMC40OTg1MzE0LCAtMC45NjkyNjYwLCAxLjg3NjAxMDgsIDAuMDQxNTU2MCwgMC4wNTU2NDM0LCAtMC4yMDQwMjU5LCAxLjA1NzIyNTJdKTsKICBzdGF0aWMgI0ZMQVRfV0hJVEVQT0lOVF9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFsxLCAxLCAxXSk7CiAgc3RhdGljICN0ZW1wTm9ybWFsaXplTWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICBzdGF0aWMgI3RlbXBDb252ZXJ0TWF0cml4MSA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgc3RhdGljICN0ZW1wQ29udmVydE1hdHJpeDIgPSBuZXcgRmxvYXQzMkFycmF5KDMpOwogIHN0YXRpYyAjREVDT0RFX0xfQ09OU1RBTlQgPSAoKDggKyAxNikgLyAxMTYpICoqIDMgLyA4LjA7CiAgY29uc3RydWN0b3Iod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEsIG1hdHJpeCkgewogICAgc3VwZXIoIkNhbFJHQiIsIDMpOwogICAgaWYgKCF3aGl0ZVBvaW50KSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiV2hpdGVQb2ludCBtaXNzaW5nIC0gcmVxdWlyZWQgZm9yIGNvbG9yIHNwYWNlIENhbFJHQiIpOwogICAgfQogICAgY29uc3QgW1hXLCBZVywgWlddID0gdGhpcy53aGl0ZVBvaW50ID0gd2hpdGVQb2ludDsKICAgIGNvbnN0IFtYQiwgWUIsIFpCXSA9IHRoaXMuYmxhY2tQb2ludCA9IGJsYWNrUG9pbnQgfHwgbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgIFt0aGlzLkdSLCB0aGlzLkdHLCB0aGlzLkdCXSA9IGdhbW1hIHx8IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDEsIDFdKTsKICAgIFt0aGlzLk1YQSwgdGhpcy5NWUEsIHRoaXMuTVpBLCB0aGlzLk1YQiwgdGhpcy5NWUIsIHRoaXMuTVpCLCB0aGlzLk1YQywgdGhpcy5NWUMsIHRoaXMuTVpDXSA9IG1hdHJpeCB8fCBuZXcgRmxvYXQzMkFycmF5KFsxLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAxXSk7CiAgICBpZiAoWFcgPCAwIHx8IFpXIDwgMCB8fCBZVyAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgV2hpdGVQb2ludCBjb21wb25lbnRzIGZvciAke3RoaXMubmFtZX0sIG5vIGZhbGxiYWNrIGF2YWlsYWJsZWApOwogICAgfQogICAgaWYgKFhCIDwgMCB8fCBZQiA8IDAgfHwgWkIgPCAwKSB7CiAgICAgIGluZm8oYEludmFsaWQgQmxhY2tQb2ludCBmb3IgJHt0aGlzLm5hbWV9IFske1hCfSwgJHtZQn0sICR7WkJ9XSwgYCArICJmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdC4iKTsKICAgICAgdGhpcy5ibGFja1BvaW50ID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgIH0KICAgIGlmICh0aGlzLkdSIDwgMCB8fCB0aGlzLkdHIDwgMCB8fCB0aGlzLkdCIDwgMCkgewogICAgICBpbmZvKGBJbnZhbGlkIEdhbW1hIFske3RoaXMuR1J9LCAke3RoaXMuR0d9LCAke3RoaXMuR0J9XSBmb3IgYCArIGAke3RoaXMubmFtZX0sIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0LmApOwogICAgICB0aGlzLkdSID0gdGhpcy5HRyA9IHRoaXMuR0IgPSAxOwogICAgfQogIH0KICAjbWF0cml4UHJvZHVjdChhLCBiLCByZXN1bHQpIHsKICAgIHJlc3VsdFswXSA9IGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV0gKyBhWzJdICogYlsyXTsKICAgIHJlc3VsdFsxXSA9IGFbM10gKiBiWzBdICsgYVs0XSAqIGJbMV0gKyBhWzVdICogYlsyXTsKICAgIHJlc3VsdFsyXSA9IGFbNl0gKiBiWzBdICsgYVs3XSAqIGJbMV0gKyBhWzhdICogYlsyXTsKICB9CiAgI3RvRmxhdChzb3VyY2VXaGl0ZVBvaW50LCBMTVMsIHJlc3VsdCkgewogICAgcmVzdWx0WzBdID0gTE1TWzBdICogMSAvIHNvdXJjZVdoaXRlUG9pbnRbMF07CiAgICByZXN1bHRbMV0gPSBMTVNbMV0gKiAxIC8gc291cmNlV2hpdGVQb2ludFsxXTsKICAgIHJlc3VsdFsyXSA9IExNU1syXSAqIDEgLyBzb3VyY2VXaGl0ZVBvaW50WzJdOwogIH0KICAjdG9ENjUoc291cmNlV2hpdGVQb2ludCwgTE1TLCByZXN1bHQpIHsKICAgIGNvbnN0IEQ2NVggPSAwLjk1MDQ3OwogICAgY29uc3QgRDY1WSA9IDE7CiAgICBjb25zdCBENjVaID0gMS4wODg4MzsKICAgIHJlc3VsdFswXSA9IExNU1swXSAqIEQ2NVggLyBzb3VyY2VXaGl0ZVBvaW50WzBdOwogICAgcmVzdWx0WzFdID0gTE1TWzFdICogRDY1WSAvIHNvdXJjZVdoaXRlUG9pbnRbMV07CiAgICByZXN1bHRbMl0gPSBMTVNbMl0gKiBENjVaIC8gc291cmNlV2hpdGVQb2ludFsyXTsKICB9CiAgI3NSR0JUcmFuc2ZlckZ1bmN0aW9uKGNvbG9yKSB7CiAgICBpZiAoY29sb3IgPD0gMC4wMDMxMzA4KSB7CiAgICAgIHJldHVybiBNYXRoQ2xhbXAoMTIuOTIgKiBjb2xvciwgMCwgMSk7CiAgICB9CiAgICBpZiAoY29sb3IgPj0gMC45OTU1NDUyNSkgewogICAgICByZXR1cm4gMTsKICAgIH0KICAgIHJldHVybiBNYXRoQ2xhbXAoKDEgKyAwLjA1NSkgKiBjb2xvciAqKiAoMSAvIDIuNCkgLSAwLjA1NSwgMCwgMSk7CiAgfQogICNkZWNvZGVMKEwpIHsKICAgIGlmIChMIDwgMCkgewogICAgICByZXR1cm4gLXRoaXMuI2RlY29kZUwoLUwpOwogICAgfQogICAgaWYgKEwgPiA4LjApIHsKICAgICAgcmV0dXJuICgoTCArIDE2KSAvIDExNikgKiogMzsKICAgIH0KICAgIHJldHVybiBMICogQ2FsUkdCQ1MuI0RFQ09ERV9MX0NPTlNUQU5UOwogIH0KICAjY29tcGVuc2F0ZUJsYWNrUG9pbnQoc291cmNlQmxhY2tQb2ludCwgWFlaX0ZsYXQsIHJlc3VsdCkgewogICAgaWYgKHNvdXJjZUJsYWNrUG9pbnRbMF0gPT09IDAgJiYgc291cmNlQmxhY2tQb2ludFsxXSA9PT0gMCAmJiBzb3VyY2VCbGFja1BvaW50WzJdID09PSAwKSB7CiAgICAgIHJlc3VsdFswXSA9IFhZWl9GbGF0WzBdOwogICAgICByZXN1bHRbMV0gPSBYWVpfRmxhdFsxXTsKICAgICAgcmVzdWx0WzJdID0gWFlaX0ZsYXRbMl07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHplcm9EZWNvZGVMID0gdGhpcy4jZGVjb2RlTCgwKTsKICAgIGNvbnN0IFhfRFNUID0gemVyb0RlY29kZUw7CiAgICBjb25zdCBYX1NSQyA9IHRoaXMuI2RlY29kZUwoc291cmNlQmxhY2tQb2ludFswXSk7CiAgICBjb25zdCBZX0RTVCA9IHplcm9EZWNvZGVMOwogICAgY29uc3QgWV9TUkMgPSB0aGlzLiNkZWNvZGVMKHNvdXJjZUJsYWNrUG9pbnRbMV0pOwogICAgY29uc3QgWl9EU1QgPSB6ZXJvRGVjb2RlTDsKICAgIGNvbnN0IFpfU1JDID0gdGhpcy4jZGVjb2RlTChzb3VyY2VCbGFja1BvaW50WzJdKTsKICAgIGNvbnN0IFhfU2NhbGUgPSAoMSAtIFhfRFNUKSAvICgxIC0gWF9TUkMpOwogICAgY29uc3QgWF9PZmZzZXQgPSAxIC0gWF9TY2FsZTsKICAgIGNvbnN0IFlfU2NhbGUgPSAoMSAtIFlfRFNUKSAvICgxIC0gWV9TUkMpOwogICAgY29uc3QgWV9PZmZzZXQgPSAxIC0gWV9TY2FsZTsKICAgIGNvbnN0IFpfU2NhbGUgPSAoMSAtIFpfRFNUKSAvICgxIC0gWl9TUkMpOwogICAgY29uc3QgWl9PZmZzZXQgPSAxIC0gWl9TY2FsZTsKICAgIHJlc3VsdFswXSA9IFhZWl9GbGF0WzBdICogWF9TY2FsZSArIFhfT2Zmc2V0OwogICAgcmVzdWx0WzFdID0gWFlaX0ZsYXRbMV0gKiBZX1NjYWxlICsgWV9PZmZzZXQ7CiAgICByZXN1bHRbMl0gPSBYWVpfRmxhdFsyXSAqIFpfU2NhbGUgKyBaX09mZnNldDsKICB9CiAgI25vcm1hbGl6ZVdoaXRlUG9pbnRUb0ZsYXQoc291cmNlV2hpdGVQb2ludCwgWFlaX0luLCByZXN1bHQpIHsKICAgIGlmIChzb3VyY2VXaGl0ZVBvaW50WzBdID09PSAxICYmIHNvdXJjZVdoaXRlUG9pbnRbMl0gPT09IDEpIHsKICAgICAgcmVzdWx0WzBdID0gWFlaX0luWzBdOwogICAgICByZXN1bHRbMV0gPSBYWVpfSW5bMV07CiAgICAgIHJlc3VsdFsyXSA9IFhZWl9JblsyXTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgTE1TID0gcmVzdWx0OwogICAgdGhpcy4jbWF0cml4UHJvZHVjdChDYWxSR0JDUy4jQlJBREZPUkRfU0NBTEVfTUFUUklYLCBYWVpfSW4sIExNUyk7CiAgICBjb25zdCBMTVNfRmxhdCA9IENhbFJHQkNTLiN0ZW1wTm9ybWFsaXplTWF0cml4OwogICAgdGhpcy4jdG9GbGF0KHNvdXJjZVdoaXRlUG9pbnQsIExNUywgTE1TX0ZsYXQpOwogICAgdGhpcy4jbWF0cml4UHJvZHVjdChDYWxSR0JDUy4jQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVgsIExNU19GbGF0LCByZXN1bHQpOwogIH0KICAjbm9ybWFsaXplV2hpdGVQb2ludFRvRDY1KHNvdXJjZVdoaXRlUG9pbnQsIFhZWl9JbiwgcmVzdWx0KSB7CiAgICBjb25zdCBMTVMgPSByZXN1bHQ7CiAgICB0aGlzLiNtYXRyaXhQcm9kdWN0KENhbFJHQkNTLiNCUkFERk9SRF9TQ0FMRV9NQVRSSVgsIFhZWl9JbiwgTE1TKTsKICAgIGNvbnN0IExNU19ENjUgPSBDYWxSR0JDUy4jdGVtcE5vcm1hbGl6ZU1hdHJpeDsKICAgIHRoaXMuI3RvRDY1KHNvdXJjZVdoaXRlUG9pbnQsIExNUywgTE1TX0Q2NSk7CiAgICB0aGlzLiNtYXRyaXhQcm9kdWN0KENhbFJHQkNTLiNCUkFERk9SRF9TQ0FMRV9JTlZFUlNFX01BVFJJWCwgTE1TX0Q2NSwgcmVzdWx0KTsKICB9CiAgI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0LCBzY2FsZSkgewogICAgY29uc3QgQSA9IE1hdGhDbGFtcChzcmNbc3JjT2Zmc2V0XSAqIHNjYWxlLCAwLCAxKTsKICAgIGNvbnN0IEIgPSBNYXRoQ2xhbXAoc3JjW3NyY09mZnNldCArIDFdICogc2NhbGUsIDAsIDEpOwogICAgY29uc3QgQyA9IE1hdGhDbGFtcChzcmNbc3JjT2Zmc2V0ICsgMl0gKiBzY2FsZSwgMCwgMSk7CiAgICBjb25zdCBBR1IgPSBBID09PSAxID8gMSA6IEEgKiogdGhpcy5HUjsKICAgIGNvbnN0IEJHRyA9IEIgPT09IDEgPyAxIDogQiAqKiB0aGlzLkdHOwogICAgY29uc3QgQ0dCID0gQyA9PT0gMSA/IDEgOiBDICoqIHRoaXMuR0I7CiAgICBjb25zdCBYID0gdGhpcy5NWEEgKiBBR1IgKyB0aGlzLk1YQiAqIEJHRyArIHRoaXMuTVhDICogQ0dCOwogICAgY29uc3QgWSA9IHRoaXMuTVlBICogQUdSICsgdGhpcy5NWUIgKiBCR0cgKyB0aGlzLk1ZQyAqIENHQjsKICAgIGNvbnN0IFogPSB0aGlzLk1aQSAqIEFHUiArIHRoaXMuTVpCICogQkdHICsgdGhpcy5NWkMgKiBDR0I7CiAgICBjb25zdCBYWVogPSBDYWxSR0JDUy4jdGVtcENvbnZlcnRNYXRyaXgxOwogICAgWFlaWzBdID0gWDsKICAgIFhZWlsxXSA9IFk7CiAgICBYWVpbMl0gPSBaOwogICAgY29uc3QgWFlaX0ZsYXQgPSBDYWxSR0JDUy4jdGVtcENvbnZlcnRNYXRyaXgyOwogICAgdGhpcy4jbm9ybWFsaXplV2hpdGVQb2ludFRvRmxhdCh0aGlzLndoaXRlUG9pbnQsIFhZWiwgWFlaX0ZsYXQpOwogICAgY29uc3QgWFlaX0JsYWNrID0gQ2FsUkdCQ1MuI3RlbXBDb252ZXJ0TWF0cml4MTsKICAgIHRoaXMuI2NvbXBlbnNhdGVCbGFja1BvaW50KHRoaXMuYmxhY2tQb2ludCwgWFlaX0ZsYXQsIFhZWl9CbGFjayk7CiAgICBjb25zdCBYWVpfRDY1ID0gQ2FsUkdCQ1MuI3RlbXBDb252ZXJ0TWF0cml4MjsKICAgIHRoaXMuI25vcm1hbGl6ZVdoaXRlUG9pbnRUb0Q2NShDYWxSR0JDUy4jRkxBVF9XSElURVBPSU5UX01BVFJJWCwgWFlaX0JsYWNrLCBYWVpfRDY1KTsKICAgIGNvbnN0IFNSR0IgPSBDYWxSR0JDUy4jdGVtcENvbnZlcnRNYXRyaXgxOwogICAgdGhpcy4jbWF0cml4UHJvZHVjdChDYWxSR0JDUy4jU1JHQl9ENjVfWFlaX1RPX1JHQl9NQVRSSVgsIFhZWl9ENjUsIFNSR0IpOwogICAgZGVzdFtkZXN0T2Zmc2V0XSA9IHRoaXMuI3NSR0JUcmFuc2ZlckZ1bmN0aW9uKFNSR0JbMF0pICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSB0aGlzLiNzUkdCVHJhbnNmZXJGdW5jdGlvbihTUkdCWzFdKSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDJdID0gdGhpcy4jc1JHQlRyYW5zZmVyRnVuY3Rpb24oU1JHQlsyXSkgKiAyNTU7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0LCAxKTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3Qgc2NhbGUgPSAxIC8gKCgxIDw8IGJpdHMpIC0gMSk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIHNjYWxlKTsKICAgICAgc3JjT2Zmc2V0ICs9IDM7CiAgICAgIGRlc3RPZmZzZXQgKz0gMyArIGFscGhhMDE7CiAgICB9CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgcmV0dXJuIGlucHV0TGVuZ3RoICogKDMgKyBhbHBoYTAxKSAvIDMgfCAwOwogIH0KfQpjbGFzcyBMYWJDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIGNvbnN0cnVjdG9yKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIHJhbmdlKSB7CiAgICBzdXBlcigiTGFiIiwgMyk7CiAgICBpZiAoIXdoaXRlUG9pbnQpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJXaGl0ZVBvaW50IG1pc3NpbmcgLSByZXF1aXJlZCBmb3IgY29sb3Igc3BhY2UgTGFiIik7CiAgICB9CiAgICBbdGhpcy5YVywgdGhpcy5ZVywgdGhpcy5aV10gPSB3aGl0ZVBvaW50OwogICAgW3RoaXMuYW1pbiwgdGhpcy5hbWF4LCB0aGlzLmJtaW4sIHRoaXMuYm1heF0gPSByYW5nZSB8fCBbLTEwMCwgMTAwLCAtMTAwLCAxMDBdOwogICAgW3RoaXMuWEIsIHRoaXMuWUIsIHRoaXMuWkJdID0gYmxhY2tQb2ludCB8fCBbMCwgMCwgMF07CiAgICBpZiAodGhpcy5YVyA8IDAgfHwgdGhpcy5aVyA8IDAgfHwgdGhpcy5ZVyAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgV2hpdGVQb2ludCBjb21wb25lbnRzLCBubyBmYWxsYmFjayBhdmFpbGFibGUiKTsKICAgIH0KICAgIGlmICh0aGlzLlhCIDwgMCB8fCB0aGlzLllCIDwgMCB8fCB0aGlzLlpCIDwgMCkgewogICAgICBpbmZvKCJJbnZhbGlkIEJsYWNrUG9pbnQsIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0Iik7CiAgICAgIHRoaXMuWEIgPSB0aGlzLllCID0gdGhpcy5aQiA9IDA7CiAgICB9CiAgICBpZiAodGhpcy5hbWluID4gdGhpcy5hbWF4IHx8IHRoaXMuYm1pbiA+IHRoaXMuYm1heCkgewogICAgICBpbmZvKCJJbnZhbGlkIFJhbmdlLCBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdHMiKTsKICAgICAgdGhpcy5hbWluID0gLTEwMDsKICAgICAgdGhpcy5hbWF4ID0gMTAwOwogICAgICB0aGlzLmJtaW4gPSAtMTAwOwogICAgICB0aGlzLmJtYXggPSAxMDA7CiAgICB9CiAgfQogICNmbl9nKHgpIHsKICAgIHJldHVybiB4ID49IDYgLyAyOSA/IHggKiogMyA6IDEwOCAvIDg0MSAqICh4IC0gNCAvIDI5KTsKICB9CiAgI2RlY29kZSh2YWx1ZSwgaGlnaDEsIGxvdzIsIGhpZ2gyKSB7CiAgICByZXR1cm4gbG93MiArIHZhbHVlICogKGhpZ2gyIC0gbG93MikgLyBoaWdoMTsKICB9CiAgI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBtYXhWYWwsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIGxldCBMcyA9IHNyY1tzcmNPZmZzZXRdOwogICAgbGV0IGFzID0gc3JjW3NyY09mZnNldCArIDFdOwogICAgbGV0IGJzID0gc3JjW3NyY09mZnNldCArIDJdOwogICAgaWYgKG1heFZhbCAhPT0gZmFsc2UpIHsKICAgICAgTHMgPSB0aGlzLiNkZWNvZGUoTHMsIG1heFZhbCwgMCwgMTAwKTsKICAgICAgYXMgPSB0aGlzLiNkZWNvZGUoYXMsIG1heFZhbCwgdGhpcy5hbWluLCB0aGlzLmFtYXgpOwogICAgICBicyA9IHRoaXMuI2RlY29kZShicywgbWF4VmFsLCB0aGlzLmJtaW4sIHRoaXMuYm1heCk7CiAgICB9CiAgICBpZiAoYXMgPiB0aGlzLmFtYXgpIHsKICAgICAgYXMgPSB0aGlzLmFtYXg7CiAgICB9IGVsc2UgaWYgKGFzIDwgdGhpcy5hbWluKSB7CiAgICAgIGFzID0gdGhpcy5hbWluOwogICAgfQogICAgaWYgKGJzID4gdGhpcy5ibWF4KSB7CiAgICAgIGJzID0gdGhpcy5ibWF4OwogICAgfSBlbHNlIGlmIChicyA8IHRoaXMuYm1pbikgewogICAgICBicyA9IHRoaXMuYm1pbjsKICAgIH0KICAgIGNvbnN0IE0gPSAoTHMgKyAxNikgLyAxMTY7CiAgICBjb25zdCBMID0gTSArIGFzIC8gNTAwOwogICAgY29uc3QgTiA9IE0gLSBicyAvIDIwMDsKICAgIGNvbnN0IFggPSB0aGlzLlhXICogdGhpcy4jZm5fZyhMKTsKICAgIGNvbnN0IFkgPSB0aGlzLllXICogdGhpcy4jZm5fZyhNKTsKICAgIGNvbnN0IFogPSB0aGlzLlpXICogdGhpcy4jZm5fZyhOKTsKICAgIGxldCByLCBnLCBiOwogICAgaWYgKHRoaXMuWlcgPCAxKSB7CiAgICAgIHIgPSBYICogMy4xMzM5ICsgWSAqIC0xLjYxNyArIFogKiAtMC40OTA2OwogICAgICBnID0gWCAqIC0wLjk3ODUgKyBZICogMS45MTYgKyBaICogMC4wMzMzOwogICAgICBiID0gWCAqIDAuMDcyICsgWSAqIC0wLjIyOSArIFogKiAxLjQwNTc7CiAgICB9IGVsc2UgewogICAgICByID0gWCAqIDMuMjQwNiArIFkgKiAtMS41MzcyICsgWiAqIC0wLjQ5ODY7CiAgICAgIGcgPSBYICogLTAuOTY4OSArIFkgKiAxLjg3NTggKyBaICogMC4wNDE1OwogICAgICBiID0gWCAqIDAuMDU1NyArIFkgKiAtMC4yMDQgKyBaICogMS4wNTc7CiAgICB9CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gTWF0aC5zcXJ0KHIpICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSBNYXRoLnNxcnQoZykgKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IE1hdGguc3FydChiKSAqIDI1NTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGZhbHNlLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3QgbWF4VmFsID0gKDEgPDwgYml0cykgLSAxOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBtYXhWYWwsIGRlc3QsIGRlc3RPZmZzZXQpOwogICAgICBzcmNPZmZzZXQgKz0gMzsKICAgICAgZGVzdE9mZnNldCArPSAzICsgYWxwaGEwMTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpIC8gMyB8IDA7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGdldCB1c2VzWmVyb1RvT25lUmFuZ2UoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ1c2VzWmVyb1RvT25lUmFuZ2UiLCBmYWxzZSk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9pY2NfY29sb3JzcGFjZS5qcwoKCgoKZnVuY3Rpb24gZmV0Y2hTeW5jKHVybCkgewogIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHhoci5vcGVuKCJHRVQiLCB1cmwsIGZhbHNlKTsKICB4aHIucmVzcG9uc2VUeXBlID0gImFycmF5YnVmZmVyIjsKICB4aHIuc2VuZChudWxsKTsKICByZXR1cm4geGhyLnJlc3BvbnNlOwp9CmNsYXNzIEljY0NvbG9yU3BhY2UgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICAjdHJhbnNmb3JtZXI7CiAgI2NvbnZlcnRQaXhlbDsKICBzdGF0aWMgI3VzZVdhc20gPSB0cnVlOwogIHN0YXRpYyAjd2FzbVVybCA9IG51bGw7CiAgc3RhdGljICNmaW5hbGl6ZXIgPSBudWxsOwogIGNvbnN0cnVjdG9yKGljY1Byb2ZpbGUsIG5hbWUsIG51bUNvbXBzKSB7CiAgICBpZiAoIUljY0NvbG9yU3BhY2UuaXNVc2FibGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBJQ0MgY29sb3Igc3BhY2Ugc3VwcG9ydCIpOwogICAgfQogICAgc3VwZXIobmFtZSwgbnVtQ29tcHMpOwogICAgbGV0IGluVHlwZTsKICAgIHN3aXRjaCAobnVtQ29tcHMpIHsKICAgICAgY2FzZSAxOgogICAgICAgIGluVHlwZSA9IERhdGFUeXBlLkdyYXk4OwogICAgICAgIHRoaXMuI2NvbnZlcnRQaXhlbCA9IChzcmMsIHNyY09mZnNldCwgY3NzKSA9PiBxY21zX2NvbnZlcnRfb25lKHRoaXMuI3RyYW5zZm9ybWVyLCBzcmNbc3JjT2Zmc2V0XSAqIDI1NSwgY3NzKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIGluVHlwZSA9IERhdGFUeXBlLlJHQjg7CiAgICAgICAgdGhpcy4jY29udmVydFBpeGVsID0gKHNyYywgc3JjT2Zmc2V0LCBjc3MpID0+IHFjbXNfY29udmVydF90aHJlZSh0aGlzLiN0cmFuc2Zvcm1lciwgc3JjW3NyY09mZnNldF0gKiAyNTUsIHNyY1tzcmNPZmZzZXQgKyAxXSAqIDI1NSwgc3JjW3NyY09mZnNldCArIDJdICogMjU1LCBjc3MpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDQ6CiAgICAgICAgaW5UeXBlID0gRGF0YVR5cGUuQ01ZSzsKICAgICAgICB0aGlzLiNjb252ZXJ0UGl4ZWwgPSAoc3JjLCBzcmNPZmZzZXQsIGNzcykgPT4gcWNtc19jb252ZXJ0X2ZvdXIodGhpcy4jdHJhbnNmb3JtZXIsIHNyY1tzcmNPZmZzZXRdICogMjU1LCBzcmNbc3JjT2Zmc2V0ICsgMV0gKiAyNTUsIHNyY1tzcmNPZmZzZXQgKyAyXSAqIDI1NSwgc3JjW3NyY09mZnNldCArIDNdICogMjU1LCBjc3MpOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgbnVtYmVyIG9mIGNvbXBvbmVudHM6ICR7bnVtQ29tcHN9YCk7CiAgICB9CiAgICB0aGlzLiN0cmFuc2Zvcm1lciA9IHFjbXNfdHJhbnNmb3JtZXJfZnJvbV9tZW1vcnkoaWNjUHJvZmlsZSwgaW5UeXBlLCBJbnRlbnQuUGVyY2VwdHVhbCk7CiAgICBpZiAoIXRoaXMuI3RyYW5zZm9ybWVyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIGNyZWF0ZSBJQ0MgY29sb3Igc3BhY2UiKTsKICAgIH0KICAgIEljY0NvbG9yU3BhY2UuI2ZpbmFsaXplciB8fD0gbmV3IEZpbmFsaXphdGlvblJlZ2lzdHJ5KHRyYW5zZm9ybWVyID0+IHsKICAgICAgcWNtc19kcm9wX3RyYW5zZm9ybWVyKHRyYW5zZm9ybWVyKTsKICAgIH0pOwogICAgSWNjQ29sb3JTcGFjZS4jZmluYWxpemVyLnJlZ2lzdGVyKHRoaXMsIHRoaXMuI3RyYW5zZm9ybWVyKTsKICB9CiAgZ2V0UmdiSGV4KHNyYywgc3JjT2Zmc2V0KSB7CiAgICB0aGlzLiNjb252ZXJ0UGl4ZWwoc3JjLCBzcmNPZmZzZXQsIHRydWUpOwogICAgcmV0dXJuIFFDTVMuX2Nzc0NvbG9yOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICBRQ01TLl9kZXN0QnVmZmVyID0gZGVzdDsKICAgIFFDTVMuX2Rlc3RPZmZzZXQgPSBkZXN0T2Zmc2V0OwogICAgUUNNUy5fZGVzdExlbmd0aCA9IDM7CiAgICB0aGlzLiNjb252ZXJ0UGl4ZWwoc3JjLCBzcmNPZmZzZXQsIGZhbHNlKTsKICAgIFFDTVMuX2Rlc3RCdWZmZXIgPSBudWxsOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBzcmMgPSBzcmMuc3ViYXJyYXkoc3JjT2Zmc2V0LCBzcmNPZmZzZXQgKyBjb3VudCAqIHRoaXMubnVtQ29tcHMpOwogICAgaWYgKGJpdHMgIT09IDgpIHsKICAgICAgY29uc3Qgc2NhbGUgPSAyNTUgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBzcmNbaV0gKj0gc2NhbGU7CiAgICAgIH0KICAgIH0KICAgIFFDTVMuX211c3RBZGRBbHBoYSA9IGFscGhhMDEgJiYgZGVzdC5idWZmZXIgPT09IHNyYy5idWZmZXI7CiAgICBRQ01TLl9kZXN0QnVmZmVyID0gZGVzdDsKICAgIFFDTVMuX2Rlc3RPZmZzZXQgPSBkZXN0T2Zmc2V0OwogICAgUUNNUy5fZGVzdExlbmd0aCA9IGNvdW50ICogKDMgKyBhbHBoYTAxKTsKICAgIHFjbXNfY29udmVydF9hcnJheSh0aGlzLiN0cmFuc2Zvcm1lciwgc3JjKTsKICAgIFFDTVMuX211c3RBZGRBbHBoYSA9IGZhbHNlOwogICAgUUNNUy5fZGVzdEJ1ZmZlciA9IG51bGw7CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgcmV0dXJuIGlucHV0TGVuZ3RoIC8gdGhpcy5udW1Db21wcyAqICgzICsgYWxwaGEwMSkgfCAwOwogIH0KICBzdGF0aWMgc2V0T3B0aW9ucyh7CiAgICB1c2VXYXNtLAogICAgdXNlV29ya2VyRmV0Y2gsCiAgICB3YXNtVXJsCiAgfSkgewogICAgaWYgKCF1c2VXb3JrZXJGZXRjaCkgewogICAgICB0aGlzLiN1c2VXYXNtID0gZmFsc2U7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI3VzZVdhc20gPSB1c2VXYXNtOwogICAgdGhpcy4jd2FzbVVybCA9IHdhc21Vcmw7CiAgfQogIHN0YXRpYyBnZXQgaXNVc2FibGUoKSB7CiAgICBsZXQgaXNVc2FibGUgPSBmYWxzZTsKICAgIGlmICh0aGlzLiN1c2VXYXNtKSB7CiAgICAgIGlmICh0aGlzLiN3YXNtVXJsKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuX21vZHVsZSA9IGluaXRTeW5jKHsKICAgICAgICAgICAgbW9kdWxlOiBmZXRjaFN5bmMoYCR7dGhpcy4jd2FzbVVybH1xY21zX2JnLndhc21gKQogICAgICAgICAgfSk7CiAgICAgICAgICBpc1VzYWJsZSA9ICEhdGhpcy5fbW9kdWxlOwogICAgICAgICAgUUNNUy5fbWVtb3J5ID0gdGhpcy5fbW9kdWxlLm1lbW9yeTsKICAgICAgICAgIFFDTVMuX21ha2VIZXhDb2xvciA9IFV0aWwubWFrZUhleENvbG9yOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHdhcm4oYElDQ0Jhc2VkIGNvbG9yIHNwYWNlOiAiJHtlfSIuYCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oIk5vIElDQyBjb2xvciBzcGFjZSBzdXBwb3J0IGR1ZSB0byBtaXNzaW5nIGB3YXNtVXJsYCBBUEkgb3B0aW9uIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImlzVXNhYmxlIiwgaXNVc2FibGUpOwogIH0KfQpjbGFzcyBDbXlrSUNDQmFzZWRDUyBleHRlbmRzIEljY0NvbG9yU3BhY2UgewogIHN0YXRpYyAjaWNjVXJsOwogIGNvbnN0cnVjdG9yKCkgewogICAgY29uc3QgaWNjUHJvZmlsZSA9IG5ldyBVaW50OEFycmF5KGZldGNoU3luYyhgJHtDbXlrSUNDQmFzZWRDUy4jaWNjVXJsfUNHQVRTMDAxQ29tcGF0LXYyLW1pY3JvLmljY2ApKTsKICAgIHN1cGVyKGljY1Byb2ZpbGUsICJEZXZpY2VDTVlLIiwgNCk7CiAgfQogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIGljY1VybAogIH0pIHsKICAgIHRoaXMuI2ljY1VybCA9IGljY1VybDsKICB9CiAgc3RhdGljIGdldCBpc1VzYWJsZSgpIHsKICAgIGxldCBpc1VzYWJsZSA9IGZhbHNlOwogICAgaWYgKEljY0NvbG9yU3BhY2UuaXNVc2FibGUpIHsKICAgICAgaWYgKHRoaXMuI2ljY1VybCkgewogICAgICAgIGlzVXNhYmxlID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJObyBDTVlLIElDQyBwcm9maWxlIHN1cHBvcnQgZHVlIHRvIG1pc3NpbmcgYGljY1VybGAgQVBJIG9wdGlvbiIpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc1VzYWJsZSIsIGlzVXNhYmxlKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3N0cmVhbS5qcwoKCmNsYXNzIFN0cmVhbSBleHRlbmRzIEJhc2VTdHJlYW0gewogIGNvbnN0cnVjdG9yKGFycmF5QnVmZmVyLCBzdGFydCwgbGVuZ3RoLCBkaWN0KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ieXRlcyA9IGFycmF5QnVmZmVyIGluc3RhbmNlb2YgVWludDhBcnJheSA/IGFycmF5QnVmZmVyIDogbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpOwogICAgdGhpcy5zdGFydCA9IHN0YXJ0IHx8IDA7CiAgICB0aGlzLnBvcyA9IHRoaXMuc3RhcnQ7CiAgICB0aGlzLmVuZCA9IHN0YXJ0ICsgbGVuZ3RoIHx8IHRoaXMuYnl0ZXMubGVuZ3RoOwogICAgdGhpcy5kaWN0ID0gZGljdDsKICB9CiAgZ2V0IGxlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLmVuZCAtIHRoaXMuc3RhcnQ7CiAgfQogIGdldCBpc0VtcHR5KCkgewogICAgcmV0dXJuIHRoaXMubGVuZ3RoID09PSAwOwogIH0KICBnZXRCeXRlKCkgewogICAgaWYgKHRoaXMucG9zID49IHRoaXMuZW5kKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ5dGVzW3RoaXMucG9zKytdOwogIH0KICBnZXRCeXRlcyhsZW5ndGgpIHsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5ieXRlczsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgY29uc3Qgc3RyRW5kID0gdGhpcy5lbmQ7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gYnl0ZXMuc3ViYXJyYXkocG9zLCBzdHJFbmQpOwogICAgfQogICAgbGV0IGVuZCA9IHBvcyArIGxlbmd0aDsKICAgIGlmIChlbmQgPiBzdHJFbmQpIHsKICAgICAgZW5kID0gc3RyRW5kOwogICAgfQogICAgdGhpcy5wb3MgPSBlbmQ7CiAgICByZXR1cm4gYnl0ZXMuc3ViYXJyYXkocG9zLCBlbmQpOwogIH0KICBnZXRCeXRlUmFuZ2UoYmVnaW4sIGVuZCkgewogICAgaWYgKGJlZ2luIDwgMCkgewogICAgICBiZWdpbiA9IDA7CiAgICB9CiAgICBpZiAoZW5kID4gdGhpcy5lbmQpIHsKICAgICAgZW5kID0gdGhpcy5lbmQ7CiAgICB9CiAgICByZXR1cm4gdGhpcy5ieXRlcy5zdWJhcnJheShiZWdpbiwgZW5kKTsKICB9CiAgcmVzZXQoKSB7CiAgICB0aGlzLnBvcyA9IHRoaXMuc3RhcnQ7CiAgfQogIG1vdmVTdGFydCgpIHsKICAgIHRoaXMuc3RhcnQgPSB0aGlzLnBvczsKICB9CiAgbWFrZVN1YlN0cmVhbShzdGFydCwgbGVuZ3RoLCBkaWN0ID0gbnVsbCkgewogICAgcmV0dXJuIG5ldyBTdHJlYW0odGhpcy5ieXRlcy5idWZmZXIsIHN0YXJ0LCBsZW5ndGgsIGRpY3QpOwogIH0KICBjbG9uZSgpIHsKICAgIHJldHVybiBuZXcgU3RyZWFtKHRoaXMuYnl0ZXMuYnVmZmVyLCB0aGlzLnN0YXJ0LCB0aGlzLmVuZCAtIHRoaXMuc3RhcnQsIHRoaXMuZGljdC5jbG9uZSgpKTsKICB9Cn0KY2xhc3MgU3RyaW5nU3RyZWFtIGV4dGVuZHMgU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIpIHsKICAgIHN1cGVyKHN0cmluZ1RvQnl0ZXMoc3RyKSk7CiAgfQp9CmNsYXNzIE51bGxTdHJlYW0gZXh0ZW5kcyBTdHJlYW0gewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIobmV3IFVpbnQ4QXJyYXkoMCkpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2h1bmtlZF9zdHJlYW0uanMKCgoKY2xhc3MgQ2h1bmtlZFN0cmVhbSBleHRlbmRzIFN0cmVhbSB7CiAgY29uc3RydWN0b3IobGVuZ3RoLCBjaHVua1NpemUsIG1hbmFnZXIpIHsKICAgIHN1cGVyKG5ldyBVaW50OEFycmF5KGxlbmd0aCksIDAsIGxlbmd0aCwgbnVsbCk7CiAgICB0aGlzLmNodW5rU2l6ZSA9IGNodW5rU2l6ZTsKICAgIHRoaXMuX2xvYWRlZENodW5rcyA9IG5ldyBTZXQoKTsKICAgIHRoaXMubnVtQ2h1bmtzID0gTWF0aC5jZWlsKGxlbmd0aCAvIGNodW5rU2l6ZSk7CiAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyOwogICAgdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGggPSAwOwogICAgdGhpcy5sYXN0U3VjY2Vzc2Z1bEVuc3VyZUJ5dGVDaHVuayA9IC0xOwogIH0KICBnZXRNaXNzaW5nQ2h1bmtzKCkgewogICAgY29uc3QgY2h1bmtzID0gW107CiAgICBmb3IgKGxldCBjaHVuayA9IDAsIG4gPSB0aGlzLm51bUNodW5rczsgY2h1bmsgPCBuOyArK2NodW5rKSB7CiAgICAgIGlmICghdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuaykpIHsKICAgICAgICBjaHVua3MucHVzaChjaHVuayk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjaHVua3M7CiAgfQogIGdldCBudW1DaHVua3NMb2FkZWQoKSB7CiAgICByZXR1cm4gdGhpcy5fbG9hZGVkQ2h1bmtzLnNpemU7CiAgfQogIGdldCBpc0RhdGFMb2FkZWQoKSB7CiAgICByZXR1cm4gdGhpcy5udW1DaHVua3NMb2FkZWQgPT09IHRoaXMubnVtQ2h1bmtzOwogIH0KICBvblJlY2VpdmVEYXRhKGJlZ2luLCBjaHVuaykgewogICAgY29uc3QgY2h1bmtTaXplID0gdGhpcy5jaHVua1NpemU7CiAgICBpZiAoYmVnaW4gJSBjaHVua1NpemUgIT09IDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYWQgYmVnaW4gb2Zmc2V0OiAke2JlZ2lufWApOwogICAgfQogICAgY29uc3QgZW5kID0gYmVnaW4gKyBjaHVuay5ieXRlTGVuZ3RoOwogICAgaWYgKGVuZCAlIGNodW5rU2l6ZSAhPT0gMCAmJiBlbmQgIT09IHRoaXMuYnl0ZXMubGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIGVuZCBvZmZzZXQ6ICR7ZW5kfWApOwogICAgfQogICAgdGhpcy5ieXRlcy5zZXQobmV3IFVpbnQ4QXJyYXkoY2h1bmspLCBiZWdpbik7CiAgICBjb25zdCBiZWdpbkNodW5rID0gTWF0aC5mbG9vcihiZWdpbiAvIGNodW5rU2l6ZSk7CiAgICBjb25zdCBlbmRDaHVuayA9IE1hdGguZmxvb3IoKGVuZCAtIDEpIC8gY2h1bmtTaXplKSArIDE7CiAgICBmb3IgKGxldCBjdXJDaHVuayA9IGJlZ2luQ2h1bms7IGN1ckNodW5rIDwgZW5kQ2h1bms7ICsrY3VyQ2h1bmspIHsKICAgICAgdGhpcy5fbG9hZGVkQ2h1bmtzLmFkZChjdXJDaHVuayk7CiAgICB9CiAgfQogIG9uUmVjZWl2ZVByb2dyZXNzaXZlRGF0YShkYXRhKSB7CiAgICBsZXQgcG9zaXRpb24gPSB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aDsKICAgIGNvbnN0IGJlZ2luQ2h1bmsgPSBNYXRoLmZsb29yKHBvc2l0aW9uIC8gdGhpcy5jaHVua1NpemUpOwogICAgdGhpcy5ieXRlcy5zZXQobmV3IFVpbnQ4QXJyYXkoZGF0YSksIHBvc2l0aW9uKTsKICAgIHBvc2l0aW9uICs9IGRhdGEuYnl0ZUxlbmd0aDsKICAgIHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoID0gcG9zaXRpb247CiAgICBjb25zdCBlbmRDaHVuayA9IHBvc2l0aW9uID49IHRoaXMuZW5kID8gdGhpcy5udW1DaHVua3MgOiBNYXRoLmZsb29yKHBvc2l0aW9uIC8gdGhpcy5jaHVua1NpemUpOwogICAgZm9yIChsZXQgY3VyQ2h1bmsgPSBiZWdpbkNodW5rOyBjdXJDaHVuayA8IGVuZENodW5rOyArK2N1ckNodW5rKSB7CiAgICAgIHRoaXMuX2xvYWRlZENodW5rcy5hZGQoY3VyQ2h1bmspOwogICAgfQogIH0KICBlbnN1cmVCeXRlKHBvcykgewogICAgaWYgKHBvcyA8IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGNodW5rID0gTWF0aC5mbG9vcihwb3MgLyB0aGlzLmNodW5rU2l6ZSk7CiAgICBpZiAoY2h1bmsgPiB0aGlzLm51bUNodW5rcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoY2h1bmsgPT09IHRoaXMubGFzdFN1Y2Nlc3NmdWxFbnN1cmVCeXRlQ2h1bmspIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLl9sb2FkZWRDaHVua3MuaGFzKGNodW5rKSkgewogICAgICB0aHJvdyBuZXcgTWlzc2luZ0RhdGFFeGNlcHRpb24ocG9zLCBwb3MgKyAxKTsKICAgIH0KICAgIHRoaXMubGFzdFN1Y2Nlc3NmdWxFbnN1cmVCeXRlQ2h1bmsgPSBjaHVuazsKICB9CiAgZW5zdXJlUmFuZ2UoYmVnaW4sIGVuZCkgewogICAgaWYgKGJlZ2luID49IGVuZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoZW5kIDw9IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGJlZ2luQ2h1bmsgPSBNYXRoLmZsb29yKGJlZ2luIC8gdGhpcy5jaHVua1NpemUpOwogICAgaWYgKGJlZ2luQ2h1bmsgPiB0aGlzLm51bUNodW5rcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBlbmRDaHVuayA9IE1hdGgubWluKE1hdGguZmxvb3IoKGVuZCAtIDEpIC8gdGhpcy5jaHVua1NpemUpICsgMSwgdGhpcy5udW1DaHVua3MpOwogICAgZm9yIChsZXQgY2h1bmsgPSBiZWdpbkNodW5rOyBjaHVuayA8IGVuZENodW5rOyArK2NodW5rKSB7CiAgICAgIGlmICghdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuaykpIHsKICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ0RhdGFFeGNlcHRpb24oYmVnaW4sIGVuZCk7CiAgICAgIH0KICAgIH0KICB9CiAgbmV4dEVtcHR5Q2h1bmsoYmVnaW5DaHVuaykgewogICAgY29uc3QgbnVtQ2h1bmtzID0gdGhpcy5udW1DaHVua3M7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNodW5rczsgKytpKSB7CiAgICAgIGNvbnN0IGNodW5rID0gKGJlZ2luQ2h1bmsgKyBpKSAlIG51bUNodW5rczsKICAgICAgaWYgKCF0aGlzLl9sb2FkZWRDaHVua3MuaGFzKGNodW5rKSkgewogICAgICAgIHJldHVybiBjaHVuazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGhhc0NodW5rKGNodW5rKSB7CiAgICByZXR1cm4gdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuayk7CiAgfQogIGdldEJ5dGUoKSB7CiAgICBjb25zdCBwb3MgPSB0aGlzLnBvczsKICAgIGlmIChwb3MgPj0gdGhpcy5lbmQpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgaWYgKHBvcyA+PSB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICB0aGlzLmVuc3VyZUJ5dGUocG9zKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ5dGVzW3RoaXMucG9zKytdOwogIH0KICBnZXRCeXRlcyhsZW5ndGgpIHsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5ieXRlczsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgY29uc3Qgc3RyRW5kID0gdGhpcy5lbmQ7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICBpZiAoc3RyRW5kID4gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgICB0aGlzLmVuc3VyZVJhbmdlKHBvcywgc3RyRW5kKTsKICAgICAgfQogICAgICByZXR1cm4gYnl0ZXMuc3ViYXJyYXkocG9zLCBzdHJFbmQpOwogICAgfQogICAgbGV0IGVuZCA9IHBvcyArIGxlbmd0aDsKICAgIGlmIChlbmQgPiBzdHJFbmQpIHsKICAgICAgZW5kID0gc3RyRW5kOwogICAgfQogICAgaWYgKGVuZCA+IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgIHRoaXMuZW5zdXJlUmFuZ2UocG9zLCBlbmQpOwogICAgfQogICAgdGhpcy5wb3MgPSBlbmQ7CiAgICByZXR1cm4gYnl0ZXMuc3ViYXJyYXkocG9zLCBlbmQpOwogIH0KICBnZXRCeXRlUmFuZ2UoYmVnaW4sIGVuZCkgewogICAgaWYgKGJlZ2luIDwgMCkgewogICAgICBiZWdpbiA9IDA7CiAgICB9CiAgICBpZiAoZW5kID4gdGhpcy5lbmQpIHsKICAgICAgZW5kID0gdGhpcy5lbmQ7CiAgICB9CiAgICBpZiAoZW5kID4gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgdGhpcy5lbnN1cmVSYW5nZShiZWdpbiwgZW5kKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ5dGVzLnN1YmFycmF5KGJlZ2luLCBlbmQpOwogIH0KICBtYWtlU3ViU3RyZWFtKHN0YXJ0LCBsZW5ndGgsIGRpY3QgPSBudWxsKSB7CiAgICBpZiAobGVuZ3RoKSB7CiAgICAgIGlmIChzdGFydCArIGxlbmd0aCA+IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgICAgdGhpcy5lbnN1cmVSYW5nZShzdGFydCwgc3RhcnQgKyBsZW5ndGgpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHN0YXJ0ID49IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgIHRoaXMuZW5zdXJlQnl0ZShzdGFydCk7CiAgICB9CiAgICBmdW5jdGlvbiBDaHVua2VkU3RyZWFtU3Vic3RyZWFtKCkge30KICAgIENodW5rZWRTdHJlYW1TdWJzdHJlYW0ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSh0aGlzKTsKICAgIENodW5rZWRTdHJlYW1TdWJzdHJlYW0ucHJvdG90eXBlLmdldE1pc3NpbmdDaHVua3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnN0IGNodW5rU2l6ZSA9IHRoaXMuY2h1bmtTaXplOwogICAgICBjb25zdCBiZWdpbkNodW5rID0gTWF0aC5mbG9vcih0aGlzLnN0YXJ0IC8gY2h1bmtTaXplKTsKICAgICAgY29uc3QgZW5kQ2h1bmsgPSBNYXRoLmZsb29yKCh0aGlzLmVuZCAtIDEpIC8gY2h1bmtTaXplKSArIDE7CiAgICAgIGNvbnN0IG1pc3NpbmdDaHVua3MgPSBbXTsKICAgICAgZm9yIChsZXQgY2h1bmsgPSBiZWdpbkNodW5rOyBjaHVuayA8IGVuZENodW5rOyArK2NodW5rKSB7CiAgICAgICAgaWYgKCF0aGlzLl9sb2FkZWRDaHVua3MuaGFzKGNodW5rKSkgewogICAgICAgICAgbWlzc2luZ0NodW5rcy5wdXNoKGNodW5rKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG1pc3NpbmdDaHVua3M7CiAgICB9OwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENodW5rZWRTdHJlYW1TdWJzdHJlYW0ucHJvdG90eXBlLCAiaXNEYXRhTG9hZGVkIiwgewogICAgICBnZXQoKSB7CiAgICAgICAgaWYgKHRoaXMubnVtQ2h1bmtzTG9hZGVkID09PSB0aGlzLm51bUNodW5rcykgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmdldE1pc3NpbmdDaHVua3MoKS5sZW5ndGggPT09IDA7CiAgICAgIH0sCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfSk7CiAgICBjb25zdCBzdWJTdHJlYW0gPSBuZXcgQ2h1bmtlZFN0cmVhbVN1YnN0cmVhbSgpOwogICAgc3ViU3RyZWFtLnBvcyA9IHN1YlN0cmVhbS5zdGFydCA9IHN0YXJ0OwogICAgc3ViU3RyZWFtLmVuZCA9IHN0YXJ0ICsgbGVuZ3RoIHx8IHRoaXMuZW5kOwogICAgc3ViU3RyZWFtLmRpY3QgPSBkaWN0OwogICAgcmV0dXJuIHN1YlN0cmVhbTsKICB9CiAgZ2V0QmFzZVN0cmVhbXMoKSB7CiAgICByZXR1cm4gW3RoaXNdOwogIH0KfQpjbGFzcyBDaHVua2VkU3RyZWFtTWFuYWdlciB7CiAgY29uc3RydWN0b3IocGRmTmV0d29ya1N0cmVhbSwgYXJncykgewogICAgdGhpcy5sZW5ndGggPSBhcmdzLmxlbmd0aDsKICAgIHRoaXMuY2h1bmtTaXplID0gYXJncy5yYW5nZUNodW5rU2l6ZTsKICAgIHRoaXMuc3RyZWFtID0gbmV3IENodW5rZWRTdHJlYW0odGhpcy5sZW5ndGgsIHRoaXMuY2h1bmtTaXplLCB0aGlzKTsKICAgIHRoaXMucGRmTmV0d29ya1N0cmVhbSA9IHBkZk5ldHdvcmtTdHJlYW07CiAgICB0aGlzLmRpc2FibGVBdXRvRmV0Y2ggPSBhcmdzLmRpc2FibGVBdXRvRmV0Y2g7CiAgICB0aGlzLm1zZ0hhbmRsZXIgPSBhcmdzLm1zZ0hhbmRsZXI7CiAgICB0aGlzLmN1cnJSZXF1ZXN0SWQgPSAwOwogICAgdGhpcy5fY2h1bmtzTmVlZGVkQnlSZXF1ZXN0ID0gbmV3IE1hcCgpOwogICAgdGhpcy5fcmVxdWVzdHNCeUNodW5rID0gbmV3IE1hcCgpOwogICAgdGhpcy5fcHJvbWlzZXNCeVJlcXVlc3QgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA9IDA7CiAgICB0aGlzLmFib3J0ZWQgPSBmYWxzZTsKICAgIHRoaXMuX2xvYWRlZFN0cmVhbUNhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICB9CiAgc2VuZFJlcXVlc3QoYmVnaW4sIGVuZCkgewogICAgY29uc3QgcmFuZ2VSZWFkZXIgPSB0aGlzLnBkZk5ldHdvcmtTdHJlYW0uZ2V0UmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCk7CiAgICBpZiAoIXJhbmdlUmVhZGVyLmlzU3RyZWFtaW5nU3VwcG9ydGVkKSB7CiAgICAgIHJhbmdlUmVhZGVyLm9uUHJvZ3Jlc3MgPSB0aGlzLm9uUHJvZ3Jlc3MuYmluZCh0aGlzKTsKICAgIH0KICAgIGxldCBjaHVua3MgPSBbXSwKICAgICAgbG9hZGVkID0gMDsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNvbnN0IHJlYWRDaHVuayA9ICh7CiAgICAgICAgdmFsdWUsCiAgICAgICAgZG9uZQogICAgICB9KSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgIGNvbnN0IGNodW5rRGF0YSA9IGFycmF5QnVmZmVyc1RvQnl0ZXMoY2h1bmtzKTsKICAgICAgICAgICAgY2h1bmtzID0gbnVsbDsKICAgICAgICAgICAgcmVzb2x2ZShjaHVua0RhdGEpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBsb2FkZWQgKz0gdmFsdWUuYnl0ZUxlbmd0aDsKICAgICAgICAgIGlmIChyYW5nZVJlYWRlci5pc1N0cmVhbWluZ1N1cHBvcnRlZCkgewogICAgICAgICAgICB0aGlzLm9uUHJvZ3Jlc3MoewogICAgICAgICAgICAgIGxvYWRlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGNodW5rcy5wdXNoKHZhbHVlKTsKICAgICAgICAgIHJhbmdlUmVhZGVyLnJlYWQoKS50aGVuKHJlYWRDaHVuaywgcmVqZWN0KTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgfQogICAgICB9OwogICAgICByYW5nZVJlYWRlci5yZWFkKCkudGhlbihyZWFkQ2h1bmssIHJlamVjdCk7CiAgICB9KS50aGVuKGRhdGEgPT4gewogICAgICBpZiAodGhpcy5hYm9ydGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMub25SZWNlaXZlRGF0YSh7CiAgICAgICAgY2h1bms6IGRhdGEsCiAgICAgICAgYmVnaW4KICAgICAgfSk7CiAgICB9KTsKICB9CiAgcmVxdWVzdEFsbENodW5rcyhub0ZldGNoID0gZmFsc2UpIHsKICAgIGlmICghbm9GZXRjaCkgewogICAgICBjb25zdCBtaXNzaW5nQ2h1bmtzID0gdGhpcy5zdHJlYW0uZ2V0TWlzc2luZ0NodW5rcygpOwogICAgICB0aGlzLl9yZXF1ZXN0Q2h1bmtzKG1pc3NpbmdDaHVua3MpOwogICAgfQogICAgcmV0dXJuIHRoaXMuX2xvYWRlZFN0cmVhbUNhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgX3JlcXVlc3RDaHVua3MoY2h1bmtzKSB7CiAgICBjb25zdCByZXF1ZXN0SWQgPSB0aGlzLmN1cnJSZXF1ZXN0SWQrKzsKICAgIGNvbnN0IGNodW5rc05lZWRlZCA9IG5ldyBTZXQoKTsKICAgIHRoaXMuX2NodW5rc05lZWRlZEJ5UmVxdWVzdC5zZXQocmVxdWVzdElkLCBjaHVua3NOZWVkZWQpOwogICAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3MpIHsKICAgICAgaWYgKCF0aGlzLnN0cmVhbS5oYXNDaHVuayhjaHVuaykpIHsKICAgICAgICBjaHVua3NOZWVkZWQuYWRkKGNodW5rKTsKICAgICAgfQogICAgfQogICAgaWYgKGNodW5rc05lZWRlZC5zaXplID09PSAwKSB7CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgIH0KICAgIGNvbnN0IGNhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuX3Byb21pc2VzQnlSZXF1ZXN0LnNldChyZXF1ZXN0SWQsIGNhcGFiaWxpdHkpOwogICAgY29uc3QgY2h1bmtzVG9SZXF1ZXN0ID0gW107CiAgICBmb3IgKGNvbnN0IGNodW5rIG9mIGNodW5rc05lZWRlZCkgewogICAgICBsZXQgcmVxdWVzdElkcyA9IHRoaXMuX3JlcXVlc3RzQnlDaHVuay5nZXQoY2h1bmspOwogICAgICBpZiAoIXJlcXVlc3RJZHMpIHsKICAgICAgICByZXF1ZXN0SWRzID0gW107CiAgICAgICAgdGhpcy5fcmVxdWVzdHNCeUNodW5rLnNldChjaHVuaywgcmVxdWVzdElkcyk7CiAgICAgICAgY2h1bmtzVG9SZXF1ZXN0LnB1c2goY2h1bmspOwogICAgICB9CiAgICAgIHJlcXVlc3RJZHMucHVzaChyZXF1ZXN0SWQpOwogICAgfQogICAgaWYgKGNodW5rc1RvUmVxdWVzdC5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IGdyb3VwZWRDaHVua3NUb1JlcXVlc3QgPSB0aGlzLmdyb3VwQ2h1bmtzKGNodW5rc1RvUmVxdWVzdCk7CiAgICAgIGZvciAoY29uc3QgZ3JvdXBlZENodW5rIG9mIGdyb3VwZWRDaHVua3NUb1JlcXVlc3QpIHsKICAgICAgICBjb25zdCBiZWdpbiA9IGdyb3VwZWRDaHVuay5iZWdpbkNodW5rICogdGhpcy5jaHVua1NpemU7CiAgICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4oZ3JvdXBlZENodW5rLmVuZENodW5rICogdGhpcy5jaHVua1NpemUsIHRoaXMubGVuZ3RoKTsKICAgICAgICB0aGlzLnNlbmRSZXF1ZXN0KGJlZ2luLCBlbmQpLmNhdGNoKGNhcGFiaWxpdHkucmVqZWN0KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAodGhpcy5hYm9ydGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0pOwogIH0KICBnZXRTdHJlYW0oKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW07CiAgfQogIHJlcXVlc3RSYW5nZShiZWdpbiwgZW5kKSB7CiAgICBlbmQgPSBNYXRoLm1pbihlbmQsIHRoaXMubGVuZ3RoKTsKICAgIGNvbnN0IGJlZ2luQ2h1bmsgPSB0aGlzLmdldEJlZ2luQ2h1bmsoYmVnaW4pOwogICAgY29uc3QgZW5kQ2h1bmsgPSB0aGlzLmdldEVuZENodW5rKGVuZCk7CiAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgIGZvciAobGV0IGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICBjaHVua3MucHVzaChjaHVuayk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdENodW5rcyhjaHVua3MpOwogIH0KICByZXF1ZXN0UmFuZ2VzKHJhbmdlcyA9IFtdKSB7CiAgICBjb25zdCBjaHVua3NUb1JlcXVlc3QgPSBbXTsKICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgcmFuZ2VzKSB7CiAgICAgIGNvbnN0IGJlZ2luQ2h1bmsgPSB0aGlzLmdldEJlZ2luQ2h1bmsocmFuZ2UuYmVnaW4pOwogICAgICBjb25zdCBlbmRDaHVuayA9IHRoaXMuZ2V0RW5kQ2h1bmsocmFuZ2UuZW5kKTsKICAgICAgZm9yIChsZXQgY2h1bmsgPSBiZWdpbkNodW5rOyBjaHVuayA8IGVuZENodW5rOyArK2NodW5rKSB7CiAgICAgICAgaWYgKCFjaHVua3NUb1JlcXVlc3QuaW5jbHVkZXMoY2h1bmspKSB7CiAgICAgICAgICBjaHVua3NUb1JlcXVlc3QucHVzaChjaHVuayk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjaHVua3NUb1JlcXVlc3Quc29ydCgoYSwgYikgPT4gYSAtIGIpOwogICAgcmV0dXJuIHRoaXMuX3JlcXVlc3RDaHVua3MoY2h1bmtzVG9SZXF1ZXN0KTsKICB9CiAgZ3JvdXBDaHVua3MoY2h1bmtzKSB7CiAgICBjb25zdCBncm91cGVkQ2h1bmtzID0gW107CiAgICBsZXQgYmVnaW5DaHVuayA9IC0xOwogICAgbGV0IHByZXZDaHVuayA9IC0xOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY2h1bmtzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgY29uc3QgY2h1bmsgPSBjaHVua3NbaV07CiAgICAgIGlmIChiZWdpbkNodW5rIDwgMCkgewogICAgICAgIGJlZ2luQ2h1bmsgPSBjaHVuazsKICAgICAgfQogICAgICBpZiAocHJldkNodW5rID49IDAgJiYgcHJldkNodW5rICsgMSAhPT0gY2h1bmspIHsKICAgICAgICBncm91cGVkQ2h1bmtzLnB1c2goewogICAgICAgICAgYmVnaW5DaHVuaywKICAgICAgICAgIGVuZENodW5rOiBwcmV2Q2h1bmsgKyAxCiAgICAgICAgfSk7CiAgICAgICAgYmVnaW5DaHVuayA9IGNodW5rOwogICAgICB9CiAgICAgIGlmIChpICsgMSA9PT0gY2h1bmtzLmxlbmd0aCkgewogICAgICAgIGdyb3VwZWRDaHVua3MucHVzaCh7CiAgICAgICAgICBiZWdpbkNodW5rLAogICAgICAgICAgZW5kQ2h1bms6IGNodW5rICsgMQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHByZXZDaHVuayA9IGNodW5rOwogICAgfQogICAgcmV0dXJuIGdyb3VwZWRDaHVua3M7CiAgfQogIG9uUHJvZ3Jlc3MoYXJncykgewogICAgdGhpcy5tc2dIYW5kbGVyLnNlbmQoIkRvY1Byb2dyZXNzIiwgewogICAgICBsb2FkZWQ6IHRoaXMuc3RyZWFtLm51bUNodW5rc0xvYWRlZCAqIHRoaXMuY2h1bmtTaXplICsgYXJncy5sb2FkZWQsCiAgICAgIHRvdGFsOiB0aGlzLmxlbmd0aAogICAgfSk7CiAgfQogIG9uUmVjZWl2ZURhdGEoYXJncykgewogICAgY29uc3QgY2h1bmsgPSBhcmdzLmNodW5rOwogICAgY29uc3QgaXNQcm9ncmVzc2l2ZSA9IGFyZ3MuYmVnaW4gPT09IHVuZGVmaW5lZDsKICAgIGNvbnN0IGJlZ2luID0gaXNQcm9ncmVzc2l2ZSA/IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoIDogYXJncy5iZWdpbjsKICAgIGNvbnN0IGVuZCA9IGJlZ2luICsgY2h1bmsuYnl0ZUxlbmd0aDsKICAgIGNvbnN0IGJlZ2luQ2h1bmsgPSBNYXRoLmZsb29yKGJlZ2luIC8gdGhpcy5jaHVua1NpemUpOwogICAgY29uc3QgZW5kQ2h1bmsgPSBlbmQgPCB0aGlzLmxlbmd0aCA/IE1hdGguZmxvb3IoZW5kIC8gdGhpcy5jaHVua1NpemUpIDogTWF0aC5jZWlsKGVuZCAvIHRoaXMuY2h1bmtTaXplKTsKICAgIGlmIChpc1Byb2dyZXNzaXZlKSB7CiAgICAgIHRoaXMuc3RyZWFtLm9uUmVjZWl2ZVByb2dyZXNzaXZlRGF0YShjaHVuayk7CiAgICAgIHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoID0gZW5kOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zdHJlYW0ub25SZWNlaXZlRGF0YShiZWdpbiwgY2h1bmspOwogICAgfQogICAgaWYgKHRoaXMuc3RyZWFtLmlzRGF0YUxvYWRlZCkgewogICAgICB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5LnJlc29sdmUodGhpcy5zdHJlYW0pOwogICAgfQogICAgY29uc3QgbG9hZGVkUmVxdWVzdHMgPSBbXTsKICAgIGZvciAobGV0IGN1ckNodW5rID0gYmVnaW5DaHVuazsgY3VyQ2h1bmsgPCBlbmRDaHVuazsgKytjdXJDaHVuaykgewogICAgICBjb25zdCByZXF1ZXN0SWRzID0gdGhpcy5fcmVxdWVzdHNCeUNodW5rLmdldChjdXJDaHVuayk7CiAgICAgIGlmICghcmVxdWVzdElkcykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRoaXMuX3JlcXVlc3RzQnlDaHVuay5kZWxldGUoY3VyQ2h1bmspOwogICAgICBmb3IgKGNvbnN0IHJlcXVlc3RJZCBvZiByZXF1ZXN0SWRzKSB7CiAgICAgICAgY29uc3QgY2h1bmtzTmVlZGVkID0gdGhpcy5fY2h1bmtzTmVlZGVkQnlSZXF1ZXN0LmdldChyZXF1ZXN0SWQpOwogICAgICAgIGlmIChjaHVua3NOZWVkZWQuaGFzKGN1ckNodW5rKSkgewogICAgICAgICAgY2h1bmtzTmVlZGVkLmRlbGV0ZShjdXJDaHVuayk7CiAgICAgICAgfQogICAgICAgIGlmIChjaHVua3NOZWVkZWQuc2l6ZSA+IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsb2FkZWRSZXF1ZXN0cy5wdXNoKHJlcXVlc3RJZCk7CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpcy5kaXNhYmxlQXV0b0ZldGNoICYmIHRoaXMuX3JlcXVlc3RzQnlDaHVuay5zaXplID09PSAwKSB7CiAgICAgIGxldCBuZXh0RW1wdHlDaHVuazsKICAgICAgaWYgKHRoaXMuc3RyZWFtLm51bUNodW5rc0xvYWRlZCA9PT0gMSkgewogICAgICAgIGNvbnN0IGxhc3RDaHVuayA9IHRoaXMuc3RyZWFtLm51bUNodW5rcyAtIDE7CiAgICAgICAgaWYgKCF0aGlzLnN0cmVhbS5oYXNDaHVuayhsYXN0Q2h1bmspKSB7CiAgICAgICAgICBuZXh0RW1wdHlDaHVuayA9IGxhc3RDaHVuazsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV4dEVtcHR5Q2h1bmsgPSB0aGlzLnN0cmVhbS5uZXh0RW1wdHlDaHVuayhlbmRDaHVuayk7CiAgICAgIH0KICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIobmV4dEVtcHR5Q2h1bmspKSB7CiAgICAgICAgdGhpcy5fcmVxdWVzdENodW5rcyhbbmV4dEVtcHR5Q2h1bmtdKTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCByZXF1ZXN0SWQgb2YgbG9hZGVkUmVxdWVzdHMpIHsKICAgICAgY29uc3QgY2FwYWJpbGl0eSA9IHRoaXMuX3Byb21pc2VzQnlSZXF1ZXN0LmdldChyZXF1ZXN0SWQpOwogICAgICB0aGlzLl9wcm9taXNlc0J5UmVxdWVzdC5kZWxldGUocmVxdWVzdElkKTsKICAgICAgY2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICB9CiAgICB0aGlzLm1zZ0hhbmRsZXIuc2VuZCgiRG9jUHJvZ3Jlc3MiLCB7CiAgICAgIGxvYWRlZDogdGhpcy5zdHJlYW0ubnVtQ2h1bmtzTG9hZGVkICogdGhpcy5jaHVua1NpemUsCiAgICAgIHRvdGFsOiB0aGlzLmxlbmd0aAogICAgfSk7CiAgfQogIG9uRXJyb3IoZXJyKSB7CiAgICB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5LnJlamVjdChlcnIpOwogIH0KICBnZXRCZWdpbkNodW5rKGJlZ2luKSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihiZWdpbiAvIHRoaXMuY2h1bmtTaXplKTsKICB9CiAgZ2V0RW5kQ2h1bmsoZW5kKSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcigoZW5kIC0gMSkgLyB0aGlzLmNodW5rU2l6ZSkgKyAxOwogIH0KICBhYm9ydChyZWFzb24pIHsKICAgIHRoaXMuYWJvcnRlZCA9IHRydWU7CiAgICB0aGlzLnBkZk5ldHdvcmtTdHJlYW0/LmNhbmNlbEFsbFJlcXVlc3RzKHJlYXNvbik7CiAgICBmb3IgKGNvbnN0IGNhcGFiaWxpdHkgb2YgdGhpcy5fcHJvbWlzZXNCeVJlcXVlc3QudmFsdWVzKCkpIHsKICAgICAgY2FwYWJpbGl0eS5yZWplY3QocmVhc29uKTsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9zaGFyZWQvaW1hZ2VfdXRpbHMuanMKCmZ1bmN0aW9uIGNvbnZlcnRUb1JHQkEocGFyYW1zKSB7CiAgc3dpdGNoIChwYXJhbXMua2luZCkgewogICAgY2FzZSBJbWFnZUtpbmQuR1JBWVNDQUxFXzFCUFA6CiAgICAgIHJldHVybiBjb252ZXJ0QmxhY2tBbmRXaGl0ZVRvUkdCQShwYXJhbXMpOwogICAgY2FzZSBJbWFnZUtpbmQuUkdCXzI0QlBQOgogICAgICByZXR1cm4gY29udmVydFJHQlRvUkdCQShwYXJhbXMpOwogIH0KICByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiBjb252ZXJ0QmxhY2tBbmRXaGl0ZVRvUkdCQSh7CiAgc3JjLAogIHNyY1BvcyA9IDAsCiAgZGVzdCwKICB3aWR0aCwKICBoZWlnaHQsCiAgbm9uQmxhY2tDb2xvciA9IDB4ZmZmZmZmZmYsCiAgaW52ZXJzZURlY29kZSA9IGZhbHNlCn0pIHsKICBjb25zdCBibGFjayA9IEZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuID8gMHhmZjAwMDAwMCA6IDB4MDAwMDAwZmY7CiAgY29uc3QgW3plcm9NYXBwaW5nLCBvbmVNYXBwaW5nXSA9IGludmVyc2VEZWNvZGUgPyBbbm9uQmxhY2tDb2xvciwgYmxhY2tdIDogW2JsYWNrLCBub25CbGFja0NvbG9yXTsKICBjb25zdCB3aWR0aEluU291cmNlID0gd2lkdGggPj4gMzsKICBjb25zdCB3aWR0aFJlbWFpbmRlciA9IHdpZHRoICYgNzsKICBjb25zdCBzcmNMZW5ndGggPSBzcmMubGVuZ3RoOwogIGRlc3QgPSBuZXcgVWludDMyQXJyYXkoZGVzdC5idWZmZXIpOwogIGxldCBkZXN0UG9zID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICBmb3IgKGNvbnN0IG1heCA9IHNyY1BvcyArIHdpZHRoSW5Tb3VyY2U7IHNyY1BvcyA8IG1heDsgc3JjUG9zKyspIHsKICAgICAgY29uc3QgZWxlbSA9IHNyY1BvcyA8IHNyY0xlbmd0aCA/IHNyY1tzcmNQb3NdIDogMjU1OwogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMGIxMDAwMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAwID8gb25lTWFwcGluZyA6IHplcm9NYXBwaW5nOwogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMGIxMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwID8gb25lTWFwcGluZyA6IHplcm9NYXBwaW5nOwogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMGIxMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMSA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgIH0KICAgIGlmICh3aWR0aFJlbWFpbmRlciA9PT0gMCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGVsZW0gPSBzcmNQb3MgPCBzcmNMZW5ndGggPyBzcmNbc3JjUG9zKytdIDogMjU1OwogICAgZm9yIChsZXQgaiA9IDA7IGogPCB3aWR0aFJlbWFpbmRlcjsgaisrKSB7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAxIDw8IDcgLSBqID8gb25lTWFwcGluZyA6IHplcm9NYXBwaW5nOwogICAgfQogIH0KICByZXR1cm4gewogICAgc3JjUG9zLAogICAgZGVzdFBvcwogIH07Cn0KZnVuY3Rpb24gY29udmVydFJHQlRvUkdCQSh7CiAgc3JjLAogIHNyY1BvcyA9IDAsCiAgZGVzdCwKICBkZXN0UG9zID0gMCwKICB3aWR0aCwKICBoZWlnaHQKfSkgewogIGxldCBpID0gMDsKICBjb25zdCBsZW4gPSB3aWR0aCAqIGhlaWdodCAqIDM7CiAgY29uc3QgbGVuMzIgPSBsZW4gPj4gMjsKICBjb25zdCBzcmMzMiA9IG5ldyBVaW50MzJBcnJheShzcmMuYnVmZmVyLCBzcmNQb3MsIGxlbjMyKTsKICBpZiAoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgIGZvciAoOyBpIDwgbGVuMzIgLSAyOyBpICs9IDMsIGRlc3RQb3MgKz0gNCkgewogICAgICBjb25zdCBzMSA9IHNyYzMyW2ldOwogICAgICBjb25zdCBzMiA9IHNyYzMyW2kgKyAxXTsKICAgICAgY29uc3QgczMgPSBzcmMzMltpICsgMl07CiAgICAgIGRlc3RbZGVzdFBvc10gPSBzMSB8IDB4ZmYwMDAwMDA7CiAgICAgIGRlc3RbZGVzdFBvcyArIDFdID0gczEgPj4+IDI0IHwgczIgPDwgOCB8IDB4ZmYwMDAwMDA7CiAgICAgIGRlc3RbZGVzdFBvcyArIDJdID0gczIgPj4+IDE2IHwgczMgPDwgMTYgfCAweGZmMDAwMDAwOwogICAgICBkZXN0W2Rlc3RQb3MgKyAzXSA9IHMzID4+PiA4IHwgMHhmZjAwMDAwMDsKICAgIH0KICAgIGZvciAobGV0IGogPSBpICogNCwgamogPSBzcmNQb3MgKyBsZW47IGogPCBqajsgaiArPSAzKSB7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tqXSB8IHNyY1tqICsgMV0gPDwgOCB8IHNyY1tqICsgMl0gPDwgMTYgfCAweGZmMDAwMDAwOwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IgKDsgaSA8IGxlbjMyIC0gMjsgaSArPSAzLCBkZXN0UG9zICs9IDQpIHsKICAgICAgY29uc3QgczEgPSBzcmMzMltpXTsKICAgICAgY29uc3QgczIgPSBzcmMzMltpICsgMV07CiAgICAgIGNvbnN0IHMzID0gc3JjMzJbaSArIDJdOwogICAgICBkZXN0W2Rlc3RQb3NdID0gczEgfCAweGZmOwogICAgICBkZXN0W2Rlc3RQb3MgKyAxXSA9IHMxIDw8IDI0IHwgczIgPj4+IDggfCAweGZmOwogICAgICBkZXN0W2Rlc3RQb3MgKyAyXSA9IHMyIDw8IDE2IHwgczMgPj4+IDE2IHwgMHhmZjsKICAgICAgZGVzdFtkZXN0UG9zICsgM10gPSBzMyA8PCA4IHwgMHhmZjsKICAgIH0KICAgIGZvciAobGV0IGogPSBpICogNCwgamogPSBzcmNQb3MgKyBsZW47IGogPCBqajsgaiArPSAzKSB7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tqXSA8PCAyNCB8IHNyY1tqICsgMV0gPDwgMTYgfCBzcmNbaiArIDJdIDw8IDggfCAweGZmOwogICAgfQogIH0KICByZXR1cm4gewogICAgc3JjUG9zOiBzcmNQb3MgKyBsZW4sCiAgICBkZXN0UG9zCiAgfTsKfQpmdW5jdGlvbiBncmF5VG9SR0JBKHNyYywgZGVzdCkgewogIGlmIChGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbikgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgZGVzdFtpXSA9IHNyY1tpXSAqIDB4MTAxMDEgfCAweGZmMDAwMDAwOwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzcmMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBkZXN0W2ldID0gc3JjW2ldICogMHgxMDEwMTAwIHwgMHgwMDAwMDBmZjsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ltYWdlX3Jlc2l6ZXIuanMKCgoKY29uc3QgTUlOX0lNQUdFX0RJTSA9IDIwNDg7CmNvbnN0IE1BWF9JTUFHRV9ESU0gPSA2NTUzNzsKY29uc3QgTUFYX0VSUk9SID0gMTI4OwpjbGFzcyBJbWFnZVJlc2l6ZXIgewogIHN0YXRpYyAjZ29vZFNxdWFyZUxlbmd0aCA9IE1JTl9JTUFHRV9ESU07CiAgc3RhdGljICNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IEZlYXR1cmVUZXN0LmlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIGNvbnN0cnVjdG9yKGltZ0RhdGEsIGlzTWFzaykgewogICAgdGhpcy5faW1nRGF0YSA9IGltZ0RhdGE7CiAgICB0aGlzLl9pc01hc2sgPSBpc01hc2s7CiAgfQogIHN0YXRpYyBnZXQgY2FuVXNlSW1hZ2VEZWNvZGVyKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY2FuVXNlSW1hZ2VEZWNvZGVyIiwgdGhpcy4jaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQgPyBJbWFnZURlY29kZXIuaXNUeXBlU3VwcG9ydGVkKCJpbWFnZS9ibXAiKSA6IFByb21pc2UucmVzb2x2ZShmYWxzZSkpOwogIH0KICBzdGF0aWMgbmVlZHNUb0JlUmVzaXplZCh3aWR0aCwgaGVpZ2h0KSB7CiAgICBpZiAod2lkdGggPD0gdGhpcy4jZ29vZFNxdWFyZUxlbmd0aCAmJiBoZWlnaHQgPD0gdGhpcy4jZ29vZFNxdWFyZUxlbmd0aCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIE1BWF9ESU0KICAgIH0gPSB0aGlzOwogICAgaWYgKHdpZHRoID4gTUFYX0RJTSB8fCBoZWlnaHQgPiBNQVhfRElNKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgY29uc3QgYXJlYSA9IHdpZHRoICogaGVpZ2h0OwogICAgaWYgKHRoaXMuX2hhc01heEFyZWEpIHsKICAgICAgcmV0dXJuIGFyZWEgPiB0aGlzLk1BWF9BUkVBOwogICAgfQogICAgaWYgKGFyZWEgPCB0aGlzLiNnb29kU3F1YXJlTGVuZ3RoICoqIDIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRoaXMuX2FyZUdvb2REaW1zKHdpZHRoLCBoZWlnaHQpKSB7CiAgICAgIHRoaXMuI2dvb2RTcXVhcmVMZW5ndGggPSBNYXRoLm1heCh0aGlzLiNnb29kU3F1YXJlTGVuZ3RoLCBNYXRoLmZsb29yKE1hdGguc3FydCh3aWR0aCAqIGhlaWdodCkpKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGhpcy4jZ29vZFNxdWFyZUxlbmd0aCA9IHRoaXMuX2d1ZXNzTWF4KHRoaXMuI2dvb2RTcXVhcmVMZW5ndGgsIE1BWF9ESU0sIE1BWF9FUlJPUiwgMCk7CiAgICBjb25zdCBtYXhBcmVhID0gdGhpcy5NQVhfQVJFQSA9IHRoaXMuI2dvb2RTcXVhcmVMZW5ndGggKiogMjsKICAgIHJldHVybiBhcmVhID4gbWF4QXJlYTsKICB9CiAgc3RhdGljIGdldFJlZHVjZVBvd2VyRm9ySlBYKHdpZHRoLCBoZWlnaHQsIGNvbXBvbmVudHNDb3VudCkgewogICAgY29uc3QgYXJlYSA9IHdpZHRoICogaGVpZ2h0OwogICAgY29uc3QgbWF4SlBYQXJlYSA9IDIgKiogMzAgLyAoY29tcG9uZW50c0NvdW50ICogNCk7CiAgICBpZiAoIXRoaXMubmVlZHNUb0JlUmVzaXplZCh3aWR0aCwgaGVpZ2h0KSkgewogICAgICBpZiAoYXJlYSA+IG1heEpQWEFyZWEpIHsKICAgICAgICByZXR1cm4gTWF0aC5jZWlsKE1hdGgubG9nMihhcmVhIC8gbWF4SlBYQXJlYSkpOwogICAgICB9CiAgICAgIHJldHVybiAwOwogICAgfQogICAgY29uc3QgewogICAgICBNQVhfRElNLAogICAgICBNQVhfQVJFQQogICAgfSA9IHRoaXM7CiAgICBjb25zdCBtaW5GYWN0b3IgPSBNYXRoLm1heCh3aWR0aCAvIE1BWF9ESU0sIGhlaWdodCAvIE1BWF9ESU0sIE1hdGguc3FydChhcmVhIC8gTWF0aC5taW4obWF4SlBYQXJlYSwgTUFYX0FSRUEpKSk7CiAgICByZXR1cm4gTWF0aC5jZWlsKE1hdGgubG9nMihtaW5GYWN0b3IpKTsKICB9CiAgc3RhdGljIGdldCBNQVhfRElNKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiTUFYX0RJTSIsIHRoaXMuX2d1ZXNzTWF4KE1JTl9JTUFHRV9ESU0sIE1BWF9JTUFHRV9ESU0sIDAsIDEpKTsKICB9CiAgc3RhdGljIGdldCBNQVhfQVJFQSgpIHsKICAgIHRoaXMuX2hhc01heEFyZWEgPSB0cnVlOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiTUFYX0FSRUEiLCB0aGlzLl9ndWVzc01heCh0aGlzLiNnb29kU3F1YXJlTGVuZ3RoLCB0aGlzLk1BWF9ESU0sIE1BWF9FUlJPUiwgMCkgKiogMik7CiAgfQogIHN0YXRpYyBzZXQgTUFYX0FSRUEoYXJlYSkgewogICAgaWYgKGFyZWEgPj0gMCkgewogICAgICB0aGlzLl9oYXNNYXhBcmVhID0gdHJ1ZTsKICAgICAgc2hhZG93KHRoaXMsICJNQVhfQVJFQSIsIGFyZWEpOwogICAgfQogIH0KICBzdGF0aWMgc2V0T3B0aW9ucyh7CiAgICBjYW52YXNNYXhBcmVhSW5CeXRlcyA9IC0xLAogICAgaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQgPSBmYWxzZQogIH0pIHsKICAgIGlmICghdGhpcy5faGFzTWF4QXJlYSkgewogICAgICB0aGlzLk1BWF9BUkVBID0gY2FudmFzTWF4QXJlYUluQnl0ZXMgPj4gMjsKICAgIH0KICAgIHRoaXMuI2lzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID0gaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQ7CiAgfQogIHN0YXRpYyBfYXJlR29vZERpbXMod2lkdGgsIGhlaWdodCkgewogICAgdHJ5IHsKICAgICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCAxLCAxKTsKICAgICAgY29uc3Qgb3BhY2l0eSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgMSkuZGF0YVszXTsKICAgICAgY2FudmFzLndpZHRoID0gY2FudmFzLmhlaWdodCA9IDE7CiAgICAgIHJldHVybiBvcGFjaXR5ICE9PSAwOwogICAgfSBjYXRjaCB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CiAgc3RhdGljIF9ndWVzc01heChzdGFydCwgZW5kLCB0b2xlcmFuY2UsIGRlZmF1bHRIZWlnaHQpIHsKICAgIHdoaWxlIChzdGFydCArIHRvbGVyYW5jZSArIDEgPCBlbmQpIHsKICAgICAgY29uc3QgbWlkZGxlID0gTWF0aC5mbG9vcigoc3RhcnQgKyBlbmQpIC8gMik7CiAgICAgIGNvbnN0IGhlaWdodCA9IGRlZmF1bHRIZWlnaHQgfHwgbWlkZGxlOwogICAgICBpZiAodGhpcy5fYXJlR29vZERpbXMobWlkZGxlLCBoZWlnaHQpKSB7CiAgICAgICAgc3RhcnQgPSBtaWRkbGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZW5kID0gbWlkZGxlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RhcnQ7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVJbWFnZShpbWdEYXRhLCBpc01hc2sgPSBmYWxzZSkgewogICAgcmV0dXJuIG5ldyBJbWFnZVJlc2l6ZXIoaW1nRGF0YSwgaXNNYXNrKS5fY3JlYXRlSW1hZ2UoKTsKICB9CiAgYXN5bmMgX2NyZWF0ZUltYWdlKCkgewogICAgY29uc3QgewogICAgICBfaW1nRGF0YTogaW1nRGF0YQogICAgfSA9IHRoaXM7CiAgICBjb25zdCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSBpbWdEYXRhOwogICAgaWYgKHdpZHRoICogaGVpZ2h0ICogNCA+IE1BWF9JTlRfMzIpIHsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy4jcmVzY2FsZUltYWdlRGF0YSgpOwogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgfQogICAgY29uc3QgZGF0YSA9IHRoaXMuX2VuY29kZUJNUCgpOwogICAgbGV0IGRlY29kZXIsIGltYWdlUHJvbWlzZTsKICAgIGlmIChhd2FpdCBJbWFnZVJlc2l6ZXIuY2FuVXNlSW1hZ2VEZWNvZGVyKSB7CiAgICAgIGRlY29kZXIgPSBuZXcgSW1hZ2VEZWNvZGVyKHsKICAgICAgICBkYXRhLAogICAgICAgIHR5cGU6ICJpbWFnZS9ibXAiLAogICAgICAgIHByZWZlckFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdHJhbnNmZXI6IFtkYXRhLmJ1ZmZlcl0KICAgICAgfSk7CiAgICAgIGltYWdlUHJvbWlzZSA9IGRlY29kZXIuZGVjb2RlKCkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgICB3YXJuKGBCTVAgaW1hZ2UgZGVjb2RpbmcgZmFpbGVkOiAke3JlYXNvbn1gKTsKICAgICAgICByZXR1cm4gY3JlYXRlSW1hZ2VCaXRtYXAobmV3IEJsb2IoW3RoaXMuX2VuY29kZUJNUCgpLmJ1ZmZlcl0sIHsKICAgICAgICAgIHR5cGU6ICJpbWFnZS9ibXAiCiAgICAgICAgfSkpOwogICAgICB9KS5maW5hbGx5KCgpID0+IHsKICAgICAgICBkZWNvZGVyLmNsb3NlKCk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgaW1hZ2VQcm9taXNlID0gY3JlYXRlSW1hZ2VCaXRtYXAobmV3IEJsb2IoW2RhdGEuYnVmZmVyXSwgewogICAgICAgIHR5cGU6ICJpbWFnZS9ibXAiCiAgICAgIH0pKTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgTUFYX0FSRUEsCiAgICAgIE1BWF9ESU0KICAgIH0gPSBJbWFnZVJlc2l6ZXI7CiAgICBjb25zdCBtaW5GYWN0b3IgPSBNYXRoLm1heCh3aWR0aCAvIE1BWF9ESU0sIGhlaWdodCAvIE1BWF9ESU0sIE1hdGguc3FydCh3aWR0aCAqIGhlaWdodCAvIE1BWF9BUkVBKSk7CiAgICBjb25zdCBmaXJzdEZhY3RvciA9IE1hdGgubWF4KG1pbkZhY3RvciwgMik7CiAgICBjb25zdCBmYWN0b3IgPSBNYXRoLnJvdW5kKDEwICogKG1pbkZhY3RvciArIDEuMjUpKSAvIDEwIC8gZmlyc3RGYWN0b3I7CiAgICBjb25zdCBOID0gTWF0aC5mbG9vcihNYXRoLmxvZzIoZmFjdG9yKSk7CiAgICBjb25zdCBzdGVwcyA9IG5ldyBBcnJheShOICsgMikuZmlsbCgyKTsKICAgIHN0ZXBzWzBdID0gZmlyc3RGYWN0b3I7CiAgICBzdGVwcy5zcGxpY2UoLTEsIDEsIGZhY3RvciAvICgxIDw8IE4pKTsKICAgIGxldCBuZXdXaWR0aCA9IHdpZHRoOwogICAgbGV0IG5ld0hlaWdodCA9IGhlaWdodDsKICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGltYWdlUHJvbWlzZTsKICAgIGxldCBiaXRtYXAgPSByZXN1bHQuaW1hZ2UgfHwgcmVzdWx0OwogICAgZm9yIChjb25zdCBzdGVwIG9mIHN0ZXBzKSB7CiAgICAgIGNvbnN0IHByZXZXaWR0aCA9IG5ld1dpZHRoOwogICAgICBjb25zdCBwcmV2SGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgICBuZXdXaWR0aCA9IE1hdGguZmxvb3IobmV3V2lkdGggLyBzdGVwKSAtIDE7CiAgICAgIG5ld0hlaWdodCA9IE1hdGguZmxvb3IobmV3SGVpZ2h0IC8gc3RlcCkgLSAxOwogICAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDAsIHByZXZXaWR0aCwgcHJldkhlaWdodCwgMCwgMCwgbmV3V2lkdGgsIG5ld0hlaWdodCk7CiAgICAgIGJpdG1hcC5jbG9zZSgpOwogICAgICBiaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICB9CiAgICBpbWdEYXRhLmRhdGEgPSBudWxsOwogICAgaW1nRGF0YS5iaXRtYXAgPSBiaXRtYXA7CiAgICBpbWdEYXRhLndpZHRoID0gbmV3V2lkdGg7CiAgICBpbWdEYXRhLmhlaWdodCA9IG5ld0hlaWdodDsKICAgIHJldHVybiBpbWdEYXRhOwogIH0KICAjcmVzY2FsZUltYWdlRGF0YSgpIHsKICAgIGNvbnN0IHsKICAgICAgX2ltZ0RhdGE6IGltZ0RhdGEKICAgIH0gPSB0aGlzOwogICAgY29uc3QgewogICAgICBkYXRhLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBraW5kCiAgICB9ID0gaW1nRGF0YTsKICAgIGNvbnN0IHJnYmFTaXplID0gd2lkdGggKiBoZWlnaHQgKiA0OwogICAgY29uc3QgSyA9IE1hdGguY2VpbChNYXRoLmxvZzIocmdiYVNpemUgLyBNQVhfSU5UXzMyKSk7CiAgICBjb25zdCBuZXdXaWR0aCA9IHdpZHRoID4+IEs7CiAgICBjb25zdCBuZXdIZWlnaHQgPSBoZWlnaHQgPj4gSzsKICAgIGxldCByZ2JhRGF0YTsKICAgIGxldCBtYXhIZWlnaHQgPSBoZWlnaHQ7CiAgICB0cnkgewogICAgICByZ2JhRGF0YSA9IG5ldyBVaW50OEFycmF5KHJnYmFTaXplKTsKICAgIH0gY2F0Y2ggewogICAgICBsZXQgbiA9IE1hdGguZmxvb3IoTWF0aC5sb2cyKHJnYmFTaXplICsgMSkpOwogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZ2JhRGF0YSA9IG5ldyBVaW50OEFycmF5KDIgKiogbiAtIDEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICBuIC09IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIG1heEhlaWdodCA9IE1hdGguZmxvb3IoKDIgKiogbiAtIDEpIC8gKHdpZHRoICogNCkpOwogICAgICBjb25zdCBuZXdTaXplID0gd2lkdGggKiBtYXhIZWlnaHQgKiA0OwogICAgICBpZiAobmV3U2l6ZSA8IHJnYmFEYXRhLmxlbmd0aCkgewogICAgICAgIHJnYmFEYXRhID0gbmV3IFVpbnQ4QXJyYXkobmV3U2l6ZSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHNyYzMyID0gbmV3IFVpbnQzMkFycmF5KHJnYmFEYXRhLmJ1ZmZlcik7CiAgICBjb25zdCBkZXN0MzIgPSBuZXcgVWludDMyQXJyYXkobmV3V2lkdGggKiBuZXdIZWlnaHQpOwogICAgbGV0IHNyY1BvcyA9IDA7CiAgICBsZXQgbmV3SW5kZXggPSAwOwogICAgY29uc3Qgc3RlcCA9IE1hdGguY2VpbChoZWlnaHQgLyBtYXhIZWlnaHQpOwogICAgY29uc3QgcmVtYWluZGVyID0gaGVpZ2h0ICUgbWF4SGVpZ2h0ID09PSAwID8gaGVpZ2h0IDogaGVpZ2h0ICUgbWF4SGVpZ2h0OwogICAgZm9yIChsZXQgayA9IDA7IGsgPCBzdGVwOyBrKyspIHsKICAgICAgY29uc3QgaCA9IGsgPCBzdGVwIC0gMSA/IG1heEhlaWdodCA6IHJlbWFpbmRlcjsKICAgICAgKHsKICAgICAgICBzcmNQb3MKICAgICAgfSA9IGNvbnZlcnRUb1JHQkEoewogICAgICAgIGtpbmQsCiAgICAgICAgc3JjOiBkYXRhLAogICAgICAgIGRlc3Q6IHNyYzMyLAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodDogaCwKICAgICAgICBpbnZlcnNlRGVjb2RlOiB0aGlzLl9pc01hc2ssCiAgICAgICAgc3JjUG9zCiAgICAgIH0pKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaCA+PiBLOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IGJ1ZiA9IHNyYzMyLnN1YmFycmF5KChpIDw8IEspICogd2lkdGgpOwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbmV3V2lkdGg7IGorKykgewogICAgICAgICAgZGVzdDMyW25ld0luZGV4KytdID0gYnVmW2ogPDwgS107CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoSW1hZ2VSZXNpemVyLm5lZWRzVG9CZVJlc2l6ZWQobmV3V2lkdGgsIG5ld0hlaWdodCkpIHsKICAgICAgaW1nRGF0YS5kYXRhID0gZGVzdDMyOwogICAgICBpbWdEYXRhLndpZHRoID0gbmV3V2lkdGg7CiAgICAgIGltZ0RhdGEuaGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgICBpbWdEYXRhLmtpbmQgPSBJbWFnZUtpbmQuUkdCQV8zMkJQUDsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICB3aWxsUmVhZEZyZXF1ZW50bHk6IHRydWUKICAgIH0pOwogICAgY3R4LnB1dEltYWdlRGF0YShuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShkZXN0MzIuYnVmZmVyKSwgbmV3V2lkdGgsIG5ld0hlaWdodCksIDAsIDApOwogICAgaW1nRGF0YS5kYXRhID0gbnVsbDsKICAgIGltZ0RhdGEuYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgaW1nRGF0YS53aWR0aCA9IG5ld1dpZHRoOwogICAgaW1nRGF0YS5oZWlnaHQgPSBuZXdIZWlnaHQ7CiAgICByZXR1cm4gaW1nRGF0YTsKICB9CiAgX2VuY29kZUJNUCgpIHsKICAgIGNvbnN0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAga2luZAogICAgfSA9IHRoaXMuX2ltZ0RhdGE7CiAgICBsZXQgZGF0YSA9IHRoaXMuX2ltZ0RhdGEuZGF0YTsKICAgIGxldCBiaXRQZXJQaXhlbDsKICAgIGxldCBjb2xvclRhYmxlID0gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICBsZXQgbWFza1RhYmxlID0gY29sb3JUYWJsZTsKICAgIGxldCBjb21wcmVzc2lvbiA9IDA7CiAgICBzd2l0Y2ggKGtpbmQpIHsKICAgICAgY2FzZSBJbWFnZUtpbmQuR1JBWVNDQUxFXzFCUFA6CiAgICAgICAgewogICAgICAgICAgYml0UGVyUGl4ZWwgPSAxOwogICAgICAgICAgY29sb3JUYWJsZSA9IG5ldyBVaW50OEFycmF5KHRoaXMuX2lzTWFzayA/IFsyNTUsIDI1NSwgMjU1LCAyNTUsIDAsIDAsIDAsIDBdIDogWzAsIDAsIDAsIDAsIDI1NSwgMjU1LCAyNTUsIDI1NV0pOwogICAgICAgICAgY29uc3Qgcm93TGVuID0gd2lkdGggKyA3ID4+IDM7CiAgICAgICAgICBjb25zdCByb3dTaXplID0gcm93TGVuICsgMyAmIC00OwogICAgICAgICAgaWYgKHJvd0xlbiAhPT0gcm93U2l6ZSkgewogICAgICAgICAgICBjb25zdCBuZXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkocm93U2l6ZSAqIGhlaWdodCk7CiAgICAgICAgICAgIGxldCBrID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaGVpZ2h0ICogcm93TGVuOyBpIDwgaWk7IGkgKz0gcm93TGVuLCBrICs9IHJvd1NpemUpIHsKICAgICAgICAgICAgICBuZXdEYXRhLnNldChkYXRhLnN1YmFycmF5KGksIGkgKyByb3dMZW4pLCBrKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhID0gbmV3RGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSBJbWFnZUtpbmQuUkdCXzI0QlBQOgogICAgICAgIHsKICAgICAgICAgIGJpdFBlclBpeGVsID0gMjQ7CiAgICAgICAgICBpZiAod2lkdGggJiAzKSB7CiAgICAgICAgICAgIGNvbnN0IHJvd0xlbiA9IDMgKiB3aWR0aDsKICAgICAgICAgICAgY29uc3Qgcm93U2l6ZSA9IHJvd0xlbiArIDMgJiAtNDsKICAgICAgICAgICAgY29uc3QgZXh0cmFMZW4gPSByb3dTaXplIC0gcm93TGVuOwogICAgICAgICAgICBjb25zdCBuZXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkocm93U2l6ZSAqIGhlaWdodCk7CiAgICAgICAgICAgIGxldCBrID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaGVpZ2h0ICogcm93TGVuOyBpIDwgaWk7IGkgKz0gcm93TGVuKSB7CiAgICAgICAgICAgICAgY29uc3Qgcm93ID0gZGF0YS5zdWJhcnJheShpLCBpICsgcm93TGVuKTsKICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHJvd0xlbjsgaiArPSAzKSB7CiAgICAgICAgICAgICAgICBuZXdEYXRhW2srK10gPSByb3dbaiArIDJdOwogICAgICAgICAgICAgICAgbmV3RGF0YVtrKytdID0gcm93W2ogKyAxXTsKICAgICAgICAgICAgICAgIG5ld0RhdGFbaysrXSA9IHJvd1tqXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgayArPSBleHRyYUxlbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhID0gbmV3RGF0YTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGRhdGEubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMykgewogICAgICAgICAgICAgIGNvbnN0IHRtcCA9IGRhdGFbaV07CiAgICAgICAgICAgICAgZGF0YVtpXSA9IGRhdGFbaSArIDJdOwogICAgICAgICAgICAgIGRhdGFbaSArIDJdID0gdG1wOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgSW1hZ2VLaW5kLlJHQkFfMzJCUFA6CiAgICAgICAgYml0UGVyUGl4ZWwgPSAzMjsKICAgICAgICBjb21wcmVzc2lvbiA9IDM7CiAgICAgICAgbWFza1RhYmxlID0gbmV3IFVpbnQ4QXJyYXkoNCArIDQgKyA0ICsgNCArIDUyKTsKICAgICAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KG1hc2tUYWJsZS5idWZmZXIpOwogICAgICAgIGlmIChGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbikgewogICAgICAgICAgdmlldy5zZXRVaW50MzIoMCwgMHgwMDAwMDBmZiwgdHJ1ZSk7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMig0LCAweDAwMDBmZjAwLCB0cnVlKTsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDgsIDB4MDBmZjAwMDAsIHRydWUpOwogICAgICAgICAgdmlldy5zZXRVaW50MzIoMTIsIDB4ZmYwMDAwMDAsIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMigwLCAweGZmMDAwMDAwLCB0cnVlKTsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDQsIDB4MDBmZjAwMDAsIHRydWUpOwogICAgICAgICAgdmlldy5zZXRVaW50MzIoOCwgMHgwMDAwZmYwMCwgdHJ1ZSk7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMigxMiwgMHgwMDAwMDBmZiwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBmb3JtYXQiKTsKICAgIH0KICAgIGxldCBpID0gMDsKICAgIGNvbnN0IGhlYWRlckxlbmd0aCA9IDQwICsgbWFza1RhYmxlLmxlbmd0aDsKICAgIGNvbnN0IGZpbGVMZW5ndGggPSAxNCArIGhlYWRlckxlbmd0aCArIGNvbG9yVGFibGUubGVuZ3RoICsgZGF0YS5sZW5ndGg7CiAgICBjb25zdCBibXBEYXRhID0gbmV3IFVpbnQ4QXJyYXkoZmlsZUxlbmd0aCk7CiAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KGJtcERhdGEuYnVmZmVyKTsKICAgIHZpZXcuc2V0VWludDE2KGksIDB4NGQ0MiwgdHJ1ZSk7CiAgICBpICs9IDI7CiAgICB2aWV3LnNldFVpbnQzMihpLCBmaWxlTGVuZ3RoLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDMyKGksIDAsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MzIoaSwgMTQgKyBoZWFkZXJMZW5ndGggKyBjb2xvclRhYmxlLmxlbmd0aCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQzMihpLCBoZWFkZXJMZW5ndGgsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRJbnQzMihpLCB3aWR0aCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldEludDMyKGksIC1oZWlnaHQsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MTYoaSwgMSwgdHJ1ZSk7CiAgICBpICs9IDI7CiAgICB2aWV3LnNldFVpbnQxNihpLCBiaXRQZXJQaXhlbCwgdHJ1ZSk7CiAgICBpICs9IDI7CiAgICB2aWV3LnNldFVpbnQzMihpLCBjb21wcmVzc2lvbiwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQzMihpLCAwLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0SW50MzIoaSwgMCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldEludDMyKGksIDAsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MzIoaSwgY29sb3JUYWJsZS5sZW5ndGggLyA0LCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDMyKGksIDAsIHRydWUpOwogICAgaSArPSA0OwogICAgYm1wRGF0YS5zZXQobWFza1RhYmxlLCBpKTsKICAgIGkgKz0gbWFza1RhYmxlLmxlbmd0aDsKICAgIGJtcERhdGEuc2V0KGNvbG9yVGFibGUsIGkpOwogICAgaSArPSBjb2xvclRhYmxlLmxlbmd0aDsKICAgIGJtcERhdGEuc2V0KGRhdGEsIGkpOwogICAgcmV0dXJuIGJtcERhdGE7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9kZWNvZGVfc3RyZWFtLmpzCgoKY29uc3QgZW1wdHlCdWZmZXIgPSBuZXcgVWludDhBcnJheSgwKTsKY2xhc3MgRGVjb2RlU3RyZWFtIGV4dGVuZHMgQmFzZVN0cmVhbSB7CiAgY29uc3RydWN0b3IobWF5YmVNaW5CdWZmZXJMZW5ndGgpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLl9yYXdNaW5CdWZmZXJMZW5ndGggPSBtYXliZU1pbkJ1ZmZlckxlbmd0aCB8fCAwOwogICAgdGhpcy5wb3MgPSAwOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogICAgdGhpcy5lb2YgPSBmYWxzZTsKICAgIHRoaXMuYnVmZmVyID0gZW1wdHlCdWZmZXI7CiAgICB0aGlzLm1pbkJ1ZmZlckxlbmd0aCA9IDUxMjsKICAgIGlmIChtYXliZU1pbkJ1ZmZlckxlbmd0aCkgewogICAgICB3aGlsZSAodGhpcy5taW5CdWZmZXJMZW5ndGggPCBtYXliZU1pbkJ1ZmZlckxlbmd0aCkgewogICAgICAgIHRoaXMubWluQnVmZmVyTGVuZ3RoICo9IDI7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0IGlzRW1wdHkoKSB7CiAgICB3aGlsZSAoIXRoaXMuZW9mICYmIHRoaXMuYnVmZmVyTGVuZ3RoID09PSAwKSB7CiAgICAgIHRoaXMucmVhZEJsb2NrKCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5idWZmZXJMZW5ndGggPT09IDA7CiAgfQogIGVuc3VyZUJ1ZmZlcihyZXF1ZXN0ZWQpIHsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyOwogICAgaWYgKHJlcXVlc3RlZCA8PSBidWZmZXIuYnl0ZUxlbmd0aCkgewogICAgICByZXR1cm4gYnVmZmVyOwogICAgfQogICAgbGV0IHNpemUgPSB0aGlzLm1pbkJ1ZmZlckxlbmd0aDsKICAgIHdoaWxlIChzaXplIDwgcmVxdWVzdGVkKSB7CiAgICAgIHNpemUgKj0gMjsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlcjIgPSBuZXcgVWludDhBcnJheShzaXplKTsKICAgIGJ1ZmZlcjIuc2V0KGJ1ZmZlcik7CiAgICByZXR1cm4gdGhpcy5idWZmZXIgPSBidWZmZXIyOwogIH0KICBnZXRCeXRlKCkgewogICAgY29uc3QgcG9zID0gdGhpcy5wb3M7CiAgICB3aGlsZSAodGhpcy5idWZmZXJMZW5ndGggPD0gcG9zKSB7CiAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgfQogICAgcmV0dXJuIHRoaXMuYnVmZmVyW3RoaXMucG9zKytdOwogIH0KICBnZXRCeXRlcyhsZW5ndGgsIGRlY29kZXJPcHRpb25zID0gbnVsbCkgewogICAgY29uc3QgcG9zID0gdGhpcy5wb3M7CiAgICBsZXQgZW5kOwogICAgaWYgKGxlbmd0aCkgewogICAgICB0aGlzLmVuc3VyZUJ1ZmZlcihwb3MgKyBsZW5ndGgpOwogICAgICBlbmQgPSBwb3MgKyBsZW5ndGg7CiAgICAgIHdoaWxlICghdGhpcy5lb2YgJiYgdGhpcy5idWZmZXJMZW5ndGggPCBlbmQpIHsKICAgICAgICB0aGlzLnJlYWRCbG9jayhkZWNvZGVyT3B0aW9ucyk7CiAgICAgIH0KICAgICAgY29uc3QgYnVmRW5kID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICAgIGlmIChlbmQgPiBidWZFbmQpIHsKICAgICAgICBlbmQgPSBidWZFbmQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICB0aGlzLnJlYWRCbG9jayhkZWNvZGVyT3B0aW9ucyk7CiAgICAgIH0KICAgICAgZW5kID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICB9CiAgICB0aGlzLnBvcyA9IGVuZDsKICAgIHJldHVybiB0aGlzLmJ1ZmZlci5zdWJhcnJheShwb3MsIGVuZCk7CiAgfQogIGFzeW5jIGdldEltYWdlRGF0YShsZW5ndGgsIGRlY29kZXJPcHRpb25zKSB7CiAgICBpZiAoIXRoaXMuY2FuQXN5bmNEZWNvZGVJbWFnZUZyb21CdWZmZXIpIHsKICAgICAgaWYgKHRoaXMuaXNBc3luY0RlY29kZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5kZWNvZGVJbWFnZShudWxsLCBkZWNvZGVyT3B0aW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuZ2V0Qnl0ZXMobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucyk7CiAgICB9CiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5zdHJlYW0uYXN5bmNHZXRCeXRlcygpOwogICAgcmV0dXJuIHRoaXMuZGVjb2RlSW1hZ2UoZGF0YSwgZGVjb2Rlck9wdGlvbnMpOwogIH0KICByZXNldCgpIHsKICAgIHRoaXMucG9zID0gMDsKICB9CiAgbWFrZVN1YlN0cmVhbShzdGFydCwgbGVuZ3RoLCBkaWN0ID0gbnVsbCkgewogICAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBlbmQgPSBzdGFydCArIGxlbmd0aDsKICAgICAgd2hpbGUgKHRoaXMuYnVmZmVyTGVuZ3RoIDw9IGVuZCAmJiAhdGhpcy5lb2YpIHsKICAgICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV3IFN0cmVhbSh0aGlzLmJ1ZmZlciwgc3RhcnQsIGxlbmd0aCwgZGljdCk7CiAgfQogIGdldEJhc2VTdHJlYW1zKCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtID8gdGhpcy5zdHJlYW0uZ2V0QmFzZVN0cmVhbXMoKSA6IG51bGw7CiAgfQogIGNsb25lKCkgewogICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgfQogICAgcmV0dXJuIG5ldyBTdHJlYW0odGhpcy5idWZmZXIsIHRoaXMuc3RhcnQsIHRoaXMuZW5kIC0gdGhpcy5zdGFydCwgdGhpcy5kaWN0LmNsb25lKCkpOwogIH0KfQpjbGFzcyBTdHJlYW1zU2VxdWVuY2VTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0cmVhbXMsIG9uRXJyb3IgPSBudWxsKSB7CiAgICBzdHJlYW1zID0gc3RyZWFtcy5maWx0ZXIocyA9PiBzIGluc3RhbmNlb2YgQmFzZVN0cmVhbSk7CiAgICBsZXQgbWF5YmVMZW5ndGggPSAwOwogICAgZm9yIChjb25zdCBzdHJlYW0gb2Ygc3RyZWFtcykgewogICAgICBtYXliZUxlbmd0aCArPSBzdHJlYW0gaW5zdGFuY2VvZiBEZWNvZGVTdHJlYW0gPyBzdHJlYW0uX3Jhd01pbkJ1ZmZlckxlbmd0aCA6IHN0cmVhbS5sZW5ndGg7CiAgICB9CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0cmVhbXMgPSBzdHJlYW1zOwogICAgdGhpcy5fb25FcnJvciA9IG9uRXJyb3I7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGNvbnN0IHN0cmVhbXMgPSB0aGlzLnN0cmVhbXM7CiAgICBpZiAoc3RyZWFtcy5sZW5ndGggPT09IDApIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzdHJlYW0gPSBzdHJlYW1zLnNoaWZ0KCk7CiAgICBsZXQgY2h1bms7CiAgICB0cnkgewogICAgICBjaHVuayA9IHN0cmVhbS5nZXRCeXRlcygpOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIGlmICh0aGlzLl9vbkVycm9yKSB7CiAgICAgICAgdGhpcy5fb25FcnJvcihyZWFzb24sIHN0cmVhbS5kaWN0Py5vYmpJZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgY29uc3QgbmV3TGVuZ3RoID0gYnVmZmVyTGVuZ3RoICsgY2h1bmsubGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIobmV3TGVuZ3RoKTsKICAgIGJ1ZmZlci5zZXQoY2h1bmssIGJ1ZmZlckxlbmd0aCk7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IG5ld0xlbmd0aDsKICB9CiAgZ2V0QmFzZVN0cmVhbXMoKSB7CiAgICBjb25zdCBiYXNlU3RyZWFtc0J1ZiA9IFtdOwogICAgZm9yIChjb25zdCBzdHJlYW0gb2YgdGhpcy5zdHJlYW1zKSB7CiAgICAgIGNvbnN0IGJhc2VTdHJlYW1zID0gc3RyZWFtLmdldEJhc2VTdHJlYW1zKCk7CiAgICAgIGlmIChiYXNlU3RyZWFtcykgewogICAgICAgIGJhc2VTdHJlYW1zQnVmLnB1c2goLi4uYmFzZVN0cmVhbXMpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYmFzZVN0cmVhbXNCdWYubGVuZ3RoID4gMCA/IGJhc2VTdHJlYW1zQnVmIDogbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NvbG9yc3BhY2VfdXRpbHMuanMKCgoKCgpjbGFzcyBDb2xvclNwYWNlVXRpbHMgewogIHN0YXRpYyBwYXJzZSh7CiAgICBjcywKICAgIHhyZWYsCiAgICByZXNvdXJjZXMgPSBudWxsLAogICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBhc3luY0lmTm90Q2FjaGVkID0gZmFsc2UKICB9KSB7CiAgICBjb25zdCBvcHRpb25zID0gewogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgfTsKICAgIGxldCBjc05hbWUsIGNzUmVmLCBwYXJzZWRDUzsKICAgIGlmIChjcyBpbnN0YW5jZW9mIFJlZikgewogICAgICBjc1JlZiA9IGNzOwogICAgICBjb25zdCBjYWNoZWRDUyA9IGdsb2JhbENvbG9yU3BhY2VDYWNoZS5nZXRCeVJlZihjc1JlZikgfHwgbG9jYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NSZWYpOwogICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgIH0KICAgICAgY3MgPSB4cmVmLmZldGNoKGNzKTsKICAgIH0KICAgIGlmIChjcyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgY3NOYW1lID0gY3MubmFtZTsKICAgICAgY29uc3QgY2FjaGVkQ1MgPSBsb2NhbENvbG9yU3BhY2VDYWNoZS5nZXRCeU5hbWUoY3NOYW1lKTsKICAgICAgaWYgKGNhY2hlZENTKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlZENTOwogICAgICB9CiAgICB9CiAgICB0cnkgewogICAgICBwYXJzZWRDUyA9IHRoaXMuI3BhcnNlKGNzLCBvcHRpb25zKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChhc3luY0lmTm90Q2FjaGVkICYmICEoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXgpOwogICAgICB9CiAgICAgIHRocm93IGV4OwogICAgfQogICAgaWYgKGNzTmFtZSB8fCBjc1JlZikgewogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZS5zZXQoY3NOYW1lLCBjc1JlZiwgcGFyc2VkQ1MpOwogICAgICBpZiAoY3NSZWYpIHsKICAgICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuc2V0KG51bGwsIGNzUmVmLCBwYXJzZWRDUyk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhc3luY0lmTm90Q2FjaGVkID8gUHJvbWlzZS5yZXNvbHZlKHBhcnNlZENTKSA6IHBhcnNlZENTOwogIH0KICBzdGF0aWMgI3N1YlBhcnNlKGNzLCBvcHRpb25zKSB7CiAgICBjb25zdCB7CiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZQogICAgfSA9IG9wdGlvbnM7CiAgICBsZXQgY3NSZWY7CiAgICBpZiAoY3MgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgY3NSZWYgPSBjczsKICAgICAgY29uc3QgY2FjaGVkQ1MgPSBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NSZWYpOwogICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHBhcnNlZENTID0gdGhpcy4jcGFyc2UoY3MsIG9wdGlvbnMpOwogICAgaWYgKGNzUmVmKSB7CiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZS5zZXQobnVsbCwgY3NSZWYsIHBhcnNlZENTKTsKICAgIH0KICAgIHJldHVybiBwYXJzZWRDUzsKICB9CiAgc3RhdGljICNwYXJzZShjcywgb3B0aW9ucykgewogICAgY29uc3QgewogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlCiAgICB9ID0gb3B0aW9uczsKICAgIGNzID0geHJlZi5mZXRjaElmUmVmKGNzKTsKICAgIGlmIChjcyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgc3dpdGNoIChjcy5uYW1lKSB7CiAgICAgICAgY2FzZSAiRyI6CiAgICAgICAgY2FzZSAiRGV2aWNlR3JheSI6CiAgICAgICAgICByZXR1cm4gdGhpcy5ncmF5OwogICAgICAgIGNhc2UgIlJHQiI6CiAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgIHJldHVybiB0aGlzLnJnYjsKICAgICAgICBjYXNlICJEZXZpY2VSR0JBIjoKICAgICAgICAgIHJldHVybiB0aGlzLnJnYmE7CiAgICAgICAgY2FzZSAiQ01ZSyI6CiAgICAgICAgY2FzZSAiRGV2aWNlQ01ZSyI6CiAgICAgICAgICByZXR1cm4gdGhpcy5jbXlrOwogICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgcmV0dXJuIG5ldyBQYXR0ZXJuQ1MobnVsbCk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yU3BhY2VzID0gcmVzb3VyY2VzLmdldCgiQ29sb3JTcGFjZSIpOwogICAgICAgICAgICBpZiAoY29sb3JTcGFjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgICAgY29uc3QgcmVzb3VyY2VzQ1MgPSBjb2xvclNwYWNlcy5nZXQoY3MubmFtZSk7CiAgICAgICAgICAgICAgaWYgKHJlc291cmNlc0NTKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VzQ1MgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNwYXJzZShyZXNvdXJjZXNDUywgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjcyA9IHJlc291cmNlc0NTOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB3YXJuKGBVbnJlY29nbml6ZWQgQ29sb3JTcGFjZTogJHtjcy5uYW1lfWApOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ3JheTsKICAgICAgfQogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkoY3MpKSB7CiAgICAgIGNvbnN0IG1vZGUgPSB4cmVmLmZldGNoSWZSZWYoY3NbMF0pLm5hbWU7CiAgICAgIGxldCBwYXJhbXMsIG51bUNvbXBzLCBiYXNlQ1MsIHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hOwogICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICBjYXNlICJHIjoKICAgICAgICBjYXNlICJEZXZpY2VHcmF5IjoKICAgICAgICAgIHJldHVybiB0aGlzLmdyYXk7CiAgICAgICAgY2FzZSAiUkdCIjoKICAgICAgICBjYXNlICJEZXZpY2VSR0IiOgogICAgICAgICAgcmV0dXJuIHRoaXMucmdiOwogICAgICAgIGNhc2UgIkNNWUsiOgogICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgcmV0dXJuIHRoaXMuY215azsKICAgICAgICBjYXNlICJDYWxHcmF5IjoKICAgICAgICAgIHBhcmFtcyA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICB3aGl0ZVBvaW50ID0gcGFyYW1zLmdldEFycmF5KCJXaGl0ZVBvaW50Iik7CiAgICAgICAgICBibGFja1BvaW50ID0gcGFyYW1zLmdldEFycmF5KCJCbGFja1BvaW50Iik7CiAgICAgICAgICBnYW1tYSA9IHBhcmFtcy5nZXQoIkdhbW1hIik7CiAgICAgICAgICByZXR1cm4gbmV3IENhbEdyYXlDUyh3aGl0ZVBvaW50LCBibGFja1BvaW50LCBnYW1tYSk7CiAgICAgICAgY2FzZSAiQ2FsUkdCIjoKICAgICAgICAgIHBhcmFtcyA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICB3aGl0ZVBvaW50ID0gcGFyYW1zLmdldEFycmF5KCJXaGl0ZVBvaW50Iik7CiAgICAgICAgICBibGFja1BvaW50ID0gcGFyYW1zLmdldEFycmF5KCJCbGFja1BvaW50Iik7CiAgICAgICAgICBnYW1tYSA9IHBhcmFtcy5nZXRBcnJheSgiR2FtbWEiKTsKICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IHBhcmFtcy5nZXRBcnJheSgiTWF0cml4Iik7CiAgICAgICAgICByZXR1cm4gbmV3IENhbFJHQkNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hLCBtYXRyaXgpOwogICAgICAgIGNhc2UgIklDQ0Jhc2VkIjoKICAgICAgICAgIGNvbnN0IGlzUmVmID0gY3NbMV0gaW5zdGFuY2VvZiBSZWY7CiAgICAgICAgICBpZiAoaXNSZWYpIHsKICAgICAgICAgICAgY29uc3QgY2FjaGVkQ1MgPSBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NbMV0pOwogICAgICAgICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHN0cmVhbSA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICBjb25zdCBkaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICAgICAgICBudW1Db21wcyA9IGRpY3QuZ2V0KCJOIik7CiAgICAgICAgICBpZiAoSWNjQ29sb3JTcGFjZS5pc1VzYWJsZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGNvbnN0IGljY0NTID0gbmV3IEljY0NvbG9yU3BhY2Uoc3RyZWFtLmdldEJ5dGVzKCksICJJQ0NCYXNlZCIsIG51bUNvbXBzKTsKICAgICAgICAgICAgICBpZiAoaXNSZWYpIHsKICAgICAgICAgICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZS5zZXQobnVsbCwgY3NbMV0sIGljY0NTKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGljY0NTOwogICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgd2FybihgSUNDQmFzZWQgY29sb3Igc3BhY2UgKCR7Y3NbMV19KTogIiR7ZXh9Ii5gKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29uc3QgYWx0UmF3ID0gZGljdC5nZXRSYXcoIkFsdGVybmF0ZSIpOwogICAgICAgICAgaWYgKGFsdFJhdykgewogICAgICAgICAgICBjb25zdCBhbHRDUyA9IHRoaXMuI3N1YlBhcnNlKGFsdFJhdywgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChhbHRDUy5udW1Db21wcyA9PT0gbnVtQ29tcHMpIHsKICAgICAgICAgICAgICByZXR1cm4gYWx0Q1M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2FybigiSUNDQmFzZWQgY29sb3Igc3BhY2U6IElnbm9yaW5nIGluY29ycmVjdCAvQWx0ZXJuYXRlIGVudHJ5LiIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG51bUNvbXBzID09PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdyYXk7CiAgICAgICAgICB9IGVsc2UgaWYgKG51bUNvbXBzID09PSAzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJnYjsKICAgICAgICAgIH0gZWxzZSBpZiAobnVtQ29tcHMgPT09IDQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY215azsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgYmFzZUNTID0gY3NbMV0gfHwgbnVsbDsKICAgICAgICAgIGlmIChiYXNlQ1MpIHsKICAgICAgICAgICAgYmFzZUNTID0gdGhpcy4jc3ViUGFyc2UoYmFzZUNTLCBvcHRpb25zKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgUGF0dGVybkNTKGJhc2VDUyk7CiAgICAgICAgY2FzZSAiSSI6CiAgICAgICAgY2FzZSAiSW5kZXhlZCI6CiAgICAgICAgICBiYXNlQ1MgPSB0aGlzLiNzdWJQYXJzZShjc1sxXSwgb3B0aW9ucyk7CiAgICAgICAgICBjb25zdCBoaVZhbCA9IE1hdGhDbGFtcCh4cmVmLmZldGNoSWZSZWYoY3NbMl0pLCAwLCAyNTUpOwogICAgICAgICAgY29uc3QgbG9va3VwID0geHJlZi5mZXRjaElmUmVmKGNzWzNdKTsKICAgICAgICAgIHJldHVybiBuZXcgSW5kZXhlZENTKGJhc2VDUywgaGlWYWwsIGxvb2t1cCk7CiAgICAgICAgY2FzZSAiU2VwYXJhdGlvbiI6CiAgICAgICAgY2FzZSAiRGV2aWNlTiI6CiAgICAgICAgICBjb25zdCBuYW1lID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgIG51bUNvbXBzID0gQXJyYXkuaXNBcnJheShuYW1lKSA/IG5hbWUubGVuZ3RoIDogMTsKICAgICAgICAgIGJhc2VDUyA9IHRoaXMuI3N1YlBhcnNlKGNzWzJdLCBvcHRpb25zKTsKICAgICAgICAgIGNvbnN0IHRpbnRGbiA9IHBkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUoY3NbM10pOwogICAgICAgICAgcmV0dXJuIG5ldyBBbHRlcm5hdGVDUyhudW1Db21wcywgYmFzZUNTLCB0aW50Rm4pOwogICAgICAgIGNhc2UgIkxhYiI6CiAgICAgICAgICBwYXJhbXMgPSB4cmVmLmZldGNoSWZSZWYoY3NbMV0pOwogICAgICAgICAgd2hpdGVQb2ludCA9IHBhcmFtcy5nZXRBcnJheSgiV2hpdGVQb2ludCIpOwogICAgICAgICAgYmxhY2tQb2ludCA9IHBhcmFtcy5nZXRBcnJheSgiQmxhY2tQb2ludCIpOwogICAgICAgICAgY29uc3QgcmFuZ2UgPSBwYXJhbXMuZ2V0QXJyYXkoIlJhbmdlIik7CiAgICAgICAgICByZXR1cm4gbmV3IExhYkNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIHJhbmdlKTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgd2FybihgVW5pbXBsZW1lbnRlZCBDb2xvclNwYWNlIG9iamVjdDogJHttb2RlfWApOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ3JheTsKICAgICAgfQogICAgfQogICAgd2FybihgVW5yZWNvZ25pemVkIENvbG9yU3BhY2Ugb2JqZWN0OiAke2NzfWApOwogICAgcmV0dXJuIHRoaXMuZ3JheTsKICB9CiAgc3RhdGljIGdldCBncmF5KCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZ3JheSIsIG5ldyBEZXZpY2VHcmF5Q1MoKSk7CiAgfQogIHN0YXRpYyBnZXQgcmdiKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicmdiIiwgbmV3IERldmljZVJnYkNTKCkpOwogIH0KICBzdGF0aWMgZ2V0IHJnYmEoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJyZ2JhIiwgbmV3IERldmljZVJnYmFDUygpKTsKICB9CiAgc3RhdGljIGdldCBjbXlrKCkgewogICAgaWYgKENteWtJQ0NCYXNlZENTLmlzVXNhYmxlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY215ayIsIG5ldyBDbXlrSUNDQmFzZWRDUygpKTsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgd2FybigiQ01ZSyBmYWxsYmFjazogRGV2aWNlQ01ZSyIpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjbXlrIiwgbmV3IERldmljZUNteWtDUygpKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2pwZy5qcwoKCgoKCmNsYXNzIEpwZWdFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSnBlZ0Vycm9yIik7CiAgfQp9CmNsYXNzIEROTE1hcmtlckVycm9yIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobWVzc2FnZSwgc2NhbkxpbmVzKSB7CiAgICBzdXBlcihtZXNzYWdlLCAiRE5MTWFya2VyRXJyb3IiKTsKICAgIHRoaXMuc2NhbkxpbmVzID0gc2NhbkxpbmVzOwogIH0KfQpjbGFzcyBFT0lNYXJrZXJFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiRU9JTWFya2VyRXJyb3IiKTsKICB9Cn0KY29uc3QgZGN0WmlnWmFnID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDEsIDgsIDE2LCA5LCAyLCAzLCAxMCwgMTcsIDI0LCAzMiwgMjUsIDE4LCAxMSwgNCwgNSwgMTIsIDE5LCAyNiwgMzMsIDQwLCA0OCwgNDEsIDM0LCAyNywgMjAsIDEzLCA2LCA3LCAxNCwgMjEsIDI4LCAzNSwgNDIsIDQ5LCA1NiwgNTcsIDUwLCA0MywgMzYsIDI5LCAyMiwgMTUsIDIzLCAzMCwgMzcsIDQ0LCA1MSwgNTgsIDU5LCA1MiwgNDUsIDM4LCAzMSwgMzksIDQ2LCA1MywgNjAsIDYxLCA1NCwgNDcsIDU1LCA2MiwgNjNdKTsKY29uc3QgZGN0Q29zMSA9IDQwMTc7CmNvbnN0IGRjdFNpbjEgPSA3OTk7CmNvbnN0IGRjdENvczMgPSAzNDA2Owpjb25zdCBkY3RTaW4zID0gMjI3NjsKY29uc3QgZGN0Q29zNiA9IDE1Njc7CmNvbnN0IGRjdFNpbjYgPSAzNzg0Owpjb25zdCBkY3RTcXJ0MiA9IDU3OTM7CmNvbnN0IGRjdFNxcnQxZDIgPSAyODk2OwpmdW5jdGlvbiBidWlsZEh1ZmZtYW5UYWJsZShjb2RlTGVuZ3RocywgdmFsdWVzKSB7CiAgbGV0IGsgPSAwLAogICAgaSwKICAgIGosCiAgICBsZW5ndGggPSAxNjsKICB3aGlsZSAobGVuZ3RoID4gMCAmJiAhY29kZUxlbmd0aHNbbGVuZ3RoIC0gMV0pIHsKICAgIGxlbmd0aC0tOwogIH0KICBjb25zdCBjb2RlID0gW3sKICAgIGNoaWxkcmVuOiBbXSwKICAgIGluZGV4OiAwCiAgfV07CiAgbGV0IHAgPSBjb2RlWzBdLAogICAgcTsKICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIGZvciAoaiA9IDA7IGogPCBjb2RlTGVuZ3Roc1tpXTsgaisrKSB7CiAgICAgIHAgPSBjb2RlLnBvcCgpOwogICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gdmFsdWVzW2tdOwogICAgICB3aGlsZSAocC5pbmRleCA+IDApIHsKICAgICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgfQogICAgICBwLmluZGV4Kys7CiAgICAgIGNvZGUucHVzaChwKTsKICAgICAgd2hpbGUgKGNvZGUubGVuZ3RoIDw9IGkpIHsKICAgICAgICBjb2RlLnB1c2gocSA9IHsKICAgICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICAgIGluZGV4OiAwCiAgICAgICAgfSk7CiAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgcCA9IHE7CiAgICAgIH0KICAgICAgaysrOwogICAgfQogICAgaWYgKGkgKyAxIDwgbGVuZ3RoKSB7CiAgICAgIGNvZGUucHVzaChxID0gewogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBpbmRleDogMAogICAgICB9KTsKICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgIHAgPSBxOwogICAgfQogIH0KICByZXR1cm4gY29kZVswXS5jaGlsZHJlbjsKfQpmdW5jdGlvbiBnZXRCbG9ja0J1ZmZlck9mZnNldChjb21wb25lbnQsIHJvdywgY29sKSB7CiAgcmV0dXJuIDY0ICogKChjb21wb25lbnQuYmxvY2tzUGVyTGluZSArIDEpICogcm93ICsgY29sKTsKfQpmdW5jdGlvbiBkZWNvZGVTY2FuKGRhdGEsIG9mZnNldCwgZnJhbWUsIGNvbXBvbmVudHMsIHJlc2V0SW50ZXJ2YWwsIHNwZWN0cmFsU3RhcnQsIHNwZWN0cmFsRW5kLCBzdWNjZXNzaXZlUHJldiwgc3VjY2Vzc2l2ZSwgcGFyc2VETkxNYXJrZXIgPSBmYWxzZSkgewogIGNvbnN0IG1jdXNQZXJMaW5lID0gZnJhbWUubWN1c1BlckxpbmU7CiAgY29uc3QgcHJvZ3Jlc3NpdmUgPSBmcmFtZS5wcm9ncmVzc2l2ZTsKICBjb25zdCBzdGFydE9mZnNldCA9IG9mZnNldDsKICBsZXQgYml0c0RhdGEgPSAwLAogICAgYml0c0NvdW50ID0gMDsKICBmdW5jdGlvbiByZWFkQml0KCkgewogICAgaWYgKGJpdHNDb3VudCA+IDApIHsKICAgICAgYml0c0NvdW50LS07CiAgICAgIHJldHVybiBiaXRzRGF0YSA+PiBiaXRzQ291bnQgJiAxOwogICAgfQogICAgYml0c0RhdGEgPSBkYXRhW29mZnNldCsrXTsKICAgIGlmIChiaXRzRGF0YSA9PT0gMHhmZikgewogICAgICBjb25zdCBuZXh0Qnl0ZSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICBpZiAobmV4dEJ5dGUpIHsKICAgICAgICBpZiAobmV4dEJ5dGUgPT09IDB4ZGMgJiYgcGFyc2VETkxNYXJrZXIpIHsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29uc3Qgc2NhbkxpbmVzID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBpZiAoc2NhbkxpbmVzID4gMCAmJiBzY2FuTGluZXMgIT09IGZyYW1lLnNjYW5MaW5lcykgewogICAgICAgICAgICB0aHJvdyBuZXcgRE5MTWFya2VyRXJyb3IoIkZvdW5kIEROTCBtYXJrZXIgKDB4RkZEQykgd2hpbGUgcGFyc2luZyBzY2FuIGRhdGEiLCBzY2FuTGluZXMpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAobmV4dEJ5dGUgPT09IDB4ZDkpIHsKICAgICAgICAgIGlmIChwYXJzZUROTE1hcmtlcikgewogICAgICAgICAgICBjb25zdCBtYXliZVNjYW5MaW5lcyA9IGJsb2NrUm93ICogKGZyYW1lLnByZWNpc2lvbiA9PT0gOCA/IDggOiAwKTsKICAgICAgICAgICAgaWYgKG1heWJlU2NhbkxpbmVzID4gMCAmJiBNYXRoLnJvdW5kKGZyYW1lLnNjYW5MaW5lcyAvIG1heWJlU2NhbkxpbmVzKSA+PSA1KSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEROTE1hcmtlckVycm9yKCJGb3VuZCBFT0kgbWFya2VyICgweEZGRDkpIHdoaWxlIHBhcnNpbmcgc2NhbiBkYXRhLCAiICsgInBvc3NpYmx5IGNhdXNlZCBieSBpbmNvcnJlY3QgYHNjYW5MaW5lc2AgcGFyYW1ldGVyIiwgbWF5YmVTY2FuTGluZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgRU9JTWFya2VyRXJyb3IoIkZvdW5kIEVPSSBtYXJrZXIgKDB4RkZEOSkgd2hpbGUgcGFyc2luZyBzY2FuIGRhdGEiKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcihgdW5leHBlY3RlZCBtYXJrZXIgJHsoYml0c0RhdGEgPDwgOCB8IG5leHRCeXRlKS50b1N0cmluZygxNil9YCk7CiAgICAgIH0KICAgIH0KICAgIGJpdHNDb3VudCA9IDc7CiAgICByZXR1cm4gYml0c0RhdGEgPj4+IDc7CiAgfQogIGZ1bmN0aW9uIGRlY29kZUh1ZmZtYW4odHJlZSkgewogICAgbGV0IG5vZGUgPSB0cmVlOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbm9kZSA9IG5vZGVbcmVhZEJpdCgpXTsKICAgICAgc3dpdGNoICh0eXBlb2Ygbm9kZSkgewogICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBodWZmbWFuIHNlcXVlbmNlIik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHJlY2VpdmUobGVuZ3RoKSB7CiAgICBsZXQgbiA9IDA7CiAgICB3aGlsZSAobGVuZ3RoID4gMCkgewogICAgICBuID0gbiA8PCAxIHwgcmVhZEJpdCgpOwogICAgICBsZW5ndGgtLTsKICAgIH0KICAgIHJldHVybiBuOwogIH0KICBmdW5jdGlvbiByZWNlaXZlQW5kRXh0ZW5kKGxlbmd0aCkgewogICAgaWYgKGxlbmd0aCA9PT0gMSkgewogICAgICByZXR1cm4gcmVhZEJpdCgpID09PSAxID8gMSA6IC0xOwogICAgfQogICAgY29uc3QgbiA9IHJlY2VpdmUobGVuZ3RoKTsKICAgIGlmIChuID49IDEgPDwgbGVuZ3RoIC0gMSkgewogICAgICByZXR1cm4gbjsKICAgIH0KICAgIHJldHVybiBuICsgKC0xIDw8IGxlbmd0aCkgKyAxOwogIH0KICBmdW5jdGlvbiBkZWNvZGVCYXNlbGluZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBjb25zdCB0ID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlREMpOwogICAgY29uc3QgZGlmZiA9IHQgPT09IDAgPyAwIDogcmVjZWl2ZUFuZEV4dGVuZCh0KTsKICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbYmxvY2tPZmZzZXRdID0gY29tcG9uZW50LnByZWQgKz0gZGlmZjsKICAgIGxldCBrID0gMTsKICAgIHdoaWxlIChrIDwgNjQpIHsKICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgIGNvbnN0IHMgPSBycyAmIDE1LAogICAgICAgIHIgPSBycyA+PiA0OwogICAgICBpZiAocyA9PT0gMCkgewogICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBrICs9IDE2OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGsgKz0gcjsKICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtibG9ja09mZnNldCArIHpdID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgaysrOwogICAgfQogIH0KICBmdW5jdGlvbiBkZWNvZGVEQ0ZpcnN0KGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpIHsKICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICBjb25zdCBkaWZmID0gdCA9PT0gMCA/IDAgOiByZWNlaXZlQW5kRXh0ZW5kKHQpIDw8IHN1Y2Nlc3NpdmU7CiAgICBjb21wb25lbnQuYmxvY2tEYXRhW2Jsb2NrT2Zmc2V0XSA9IGNvbXBvbmVudC5wcmVkICs9IGRpZmY7CiAgfQogIGZ1bmN0aW9uIGRlY29kZURDU3VjY2Vzc2l2ZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBjb21wb25lbnQuYmxvY2tEYXRhW2Jsb2NrT2Zmc2V0XSB8PSByZWFkQml0KCkgPDwgc3VjY2Vzc2l2ZTsKICB9CiAgbGV0IGVvYnJ1biA9IDA7CiAgZnVuY3Rpb24gZGVjb2RlQUNGaXJzdChjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBpZiAoZW9icnVuID4gMCkgewogICAgICBlb2JydW4tLTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGsgPSBzcGVjdHJhbFN0YXJ0OwogICAgY29uc3QgZSA9IHNwZWN0cmFsRW5kOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCBycyA9IGRlY29kZUh1ZmZtYW4oY29tcG9uZW50Lmh1ZmZtYW5UYWJsZUFDKTsKICAgICAgY29uc3QgcyA9IHJzICYgMTUsCiAgICAgICAgciA9IHJzID4+IDQ7CiAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgaWYgKHIgPCAxNSkgewogICAgICAgICAgZW9icnVuID0gcmVjZWl2ZShyKSArICgxIDw8IHIpIC0gMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBrICs9IDE2OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGsgKz0gcjsKICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtibG9ja09mZnNldCArIHpdID0gcmVjZWl2ZUFuZEV4dGVuZChzKSAqICgxIDw8IHN1Y2Nlc3NpdmUpOwogICAgICBrKys7CiAgICB9CiAgfQogIGxldCBzdWNjZXNzaXZlQUNTdGF0ZSA9IDAsCiAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWU7CiAgZnVuY3Rpb24gZGVjb2RlQUNTdWNjZXNzaXZlKGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpIHsKICAgIGxldCBrID0gc3BlY3RyYWxTdGFydDsKICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgIGxldCByID0gMDsKICAgIGxldCBzOwogICAgbGV0IHJzOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCBvZmZzZXRaID0gYmxvY2tPZmZzZXQgKyBkY3RaaWdaYWdba107CiAgICAgIGNvbnN0IHNpZ24gPSBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdIDwgMCA/IC0xIDogMTsKICAgICAgc3dpdGNoIChzdWNjZXNzaXZlQUNTdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgICAgcyA9IHJzICYgMTU7CiAgICAgICAgICByID0gcnMgPj4gNDsKICAgICAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcik7CiAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSA0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHIgPSAxNjsKICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzICE9PSAxKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBBQ24gZW5jb2RpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPSByZWNlaXZlQW5kRXh0ZW5kKHMpOwogICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IHIgPyAyIDogMzsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNhc2UgMToKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAoY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSkgewogICAgICAgICAgICBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdICs9IHNpZ24gKiAocmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgci0tOwogICAgICAgICAgICBpZiAociA9PT0gMCkgewogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDIgPyAzIDogMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0gPSBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPDwgc3VjY2Vzc2l2ZTsKICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSAwOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGsrKzsKICAgIH0KICAgIGlmIChzdWNjZXNzaXZlQUNTdGF0ZSA9PT0gNCkgewogICAgICBlb2JydW4tLTsKICAgICAgaWYgKGVvYnJ1biA9PT0gMCkgewogICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgfQogICAgfQogIH0KICBsZXQgYmxvY2tSb3cgPSAwOwogIGZ1bmN0aW9uIGRlY29kZU1jdShjb21wb25lbnQsIGRlY29kZSwgbWN1LCByb3csIGNvbCkgewogICAgY29uc3QgbWN1Um93ID0gbWN1IC8gbWN1c1BlckxpbmUgfCAwOwogICAgY29uc3QgbWN1Q29sID0gbWN1ICUgbWN1c1BlckxpbmU7CiAgICBibG9ja1JvdyA9IG1jdVJvdyAqIGNvbXBvbmVudC52ICsgcm93OwogICAgY29uc3QgYmxvY2tDb2wgPSBtY3VDb2wgKiBjb21wb25lbnQuaCArIGNvbDsKICAgIGNvbnN0IGJsb2NrT2Zmc2V0ID0gZ2V0QmxvY2tCdWZmZXJPZmZzZXQoY29tcG9uZW50LCBibG9ja1JvdywgYmxvY2tDb2wpOwogICAgZGVjb2RlKGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpOwogIH0KICBmdW5jdGlvbiBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZSwgbWN1KSB7CiAgICBibG9ja1JvdyA9IG1jdSAvIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lIHwgMDsKICAgIGNvbnN0IGJsb2NrQ29sID0gbWN1ICUgY29tcG9uZW50LmJsb2Nrc1BlckxpbmU7CiAgICBjb25zdCBibG9ja09mZnNldCA9IGdldEJsb2NrQnVmZmVyT2Zmc2V0KGNvbXBvbmVudCwgYmxvY2tSb3csIGJsb2NrQ29sKTsKICAgIGRlY29kZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KTsKICB9CiAgY29uc3QgY29tcG9uZW50c0xlbmd0aCA9IGNvbXBvbmVudHMubGVuZ3RoOwogIGxldCBjb21wb25lbnQsIGksIGosIGssIG47CiAgbGV0IGRlY29kZUZuOwogIGlmIChwcm9ncmVzc2l2ZSkgewogICAgaWYgKHNwZWN0cmFsU3RhcnQgPT09IDApIHsKICAgICAgZGVjb2RlRm4gPSBzdWNjZXNzaXZlUHJldiA9PT0gMCA/IGRlY29kZURDRmlyc3QgOiBkZWNvZGVEQ1N1Y2Nlc3NpdmU7CiAgICB9IGVsc2UgewogICAgICBkZWNvZGVGbiA9IHN1Y2Nlc3NpdmVQcmV2ID09PSAwID8gZGVjb2RlQUNGaXJzdCA6IGRlY29kZUFDU3VjY2Vzc2l2ZTsKICAgIH0KICB9IGVsc2UgewogICAgZGVjb2RlRm4gPSBkZWNvZGVCYXNlbGluZTsKICB9CiAgbGV0IG1jdSA9IDAsCiAgICBmaWxlTWFya2VyOwogIGNvbnN0IG1jdUV4cGVjdGVkID0gY29tcG9uZW50c0xlbmd0aCA9PT0gMSA/IGNvbXBvbmVudHNbMF0uYmxvY2tzUGVyTGluZSAqIGNvbXBvbmVudHNbMF0uYmxvY2tzUGVyQ29sdW1uIDogbWN1c1BlckxpbmUgKiBmcmFtZS5tY3VzUGVyQ29sdW1uOwogIGxldCBoLCB2OwogIHdoaWxlIChtY3UgPD0gbWN1RXhwZWN0ZWQpIHsKICAgIGNvbnN0IG1jdVRvUmVhZCA9IHJlc2V0SW50ZXJ2YWwgPyBNYXRoLm1pbihtY3VFeHBlY3RlZCAtIG1jdSwgcmVzZXRJbnRlcnZhbCkgOiBtY3VFeHBlY3RlZDsKICAgIGlmIChtY3VUb1JlYWQgPiAwKSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb21wb25lbnRzW2ldLnByZWQgPSAwOwogICAgICB9CiAgICAgIGVvYnJ1biA9IDA7CiAgICAgIGlmIChjb21wb25lbnRzTGVuZ3RoID09PSAxKSB7CiAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1swXTsKICAgICAgICBmb3IgKG4gPSAwOyBuIDwgbWN1VG9SZWFkOyBuKyspIHsKICAgICAgICAgIGRlY29kZUJsb2NrKGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSk7CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChuID0gMDsgbiA8IG1jdVRvUmVhZDsgbisrKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcG9uZW50c0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbaV07CiAgICAgICAgICAgIGggPSBjb21wb25lbnQuaDsKICAgICAgICAgICAgdiA9IGNvbXBvbmVudC52OwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgdjsgaisrKSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGg7IGsrKykgewogICAgICAgICAgICAgICAgZGVjb2RlTWN1KGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSwgaiwgayk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGJpdHNDb3VudCA9IDA7CiAgICBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIG9mZnNldCk7CiAgICBpZiAoIWZpbGVNYXJrZXIpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoZmlsZU1hcmtlci5pbnZhbGlkKSB7CiAgICAgIGNvbnN0IHBhcnRpYWxNc2cgPSBtY3VUb1JlYWQgPiAwID8gInVuZXhwZWN0ZWQiIDogImV4Y2Vzc2l2ZSI7CiAgICAgIHdhcm4oYGRlY29kZVNjYW4gLSAke3BhcnRpYWxNc2d9IE1DVSBkYXRhLCBjdXJyZW50IG1hcmtlciBpczogJHtmaWxlTWFya2VyLmludmFsaWR9YCk7CiAgICAgIG9mZnNldCA9IGZpbGVNYXJrZXIub2Zmc2V0OwogICAgfQogICAgaWYgKGZpbGVNYXJrZXIubWFya2VyID49IDB4ZmZkMCAmJiBmaWxlTWFya2VyLm1hcmtlciA8PSAweGZmZDcpIHsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KICB9CiAgcmV0dXJuIG9mZnNldCAtIHN0YXJ0T2Zmc2V0Owp9CmZ1bmN0aW9uIHF1YW50aXplQW5kSW52ZXJzZShjb21wb25lbnQsIGJsb2NrQnVmZmVyT2Zmc2V0LCBwKSB7CiAgY29uc3QgcXQgPSBjb21wb25lbnQucXVhbnRpemF0aW9uVGFibGUsCiAgICBibG9ja0RhdGEgPSBjb21wb25lbnQuYmxvY2tEYXRhOwogIGxldCB2MCwgdjEsIHYyLCB2MywgdjQsIHY1LCB2Niwgdjc7CiAgbGV0IHAwLCBwMSwgcDIsIHAzLCBwNCwgcDUsIHA2LCBwNzsKICBsZXQgdDsKICBpZiAoIXF0KSB7CiAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJtaXNzaW5nIHJlcXVpcmVkIFF1YW50aXphdGlvbiBUYWJsZS4iKTsKICB9CiAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgNjQ7IHJvdyArPSA4KSB7CiAgICBwMCA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvd107CiAgICBwMSA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDFdOwogICAgcDIgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyAyXTsKICAgIHAzID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgM107CiAgICBwNCA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDRdOwogICAgcDUgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyA1XTsKICAgIHA2ID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgNl07CiAgICBwNyA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDddOwogICAgcDAgKj0gcXRbcm93XTsKICAgIGlmICgocDEgfCBwMiB8IHAzIHwgcDQgfCBwNSB8IHA2IHwgcDcpID09PSAwKSB7CiAgICAgIHQgPSBkY3RTcXJ0MiAqIHAwICsgNTEyID4+IDEwOwogICAgICBwW3Jvd10gPSB0OwogICAgICBwW3JvdyArIDFdID0gdDsKICAgICAgcFtyb3cgKyAyXSA9IHQ7CiAgICAgIHBbcm93ICsgM10gPSB0OwogICAgICBwW3JvdyArIDRdID0gdDsKICAgICAgcFtyb3cgKyA1XSA9IHQ7CiAgICAgIHBbcm93ICsgNl0gPSB0OwogICAgICBwW3JvdyArIDddID0gdDsKICAgICAgY29udGludWU7CiAgICB9CiAgICBwMSAqPSBxdFtyb3cgKyAxXTsKICAgIHAyICo9IHF0W3JvdyArIDJdOwogICAgcDMgKj0gcXRbcm93ICsgM107CiAgICBwNCAqPSBxdFtyb3cgKyA0XTsKICAgIHA1ICo9IHF0W3JvdyArIDVdOwogICAgcDYgKj0gcXRbcm93ICsgNl07CiAgICBwNyAqPSBxdFtyb3cgKyA3XTsKICAgIHYwID0gZGN0U3FydDIgKiBwMCArIDEyOCA+PiA4OwogICAgdjEgPSBkY3RTcXJ0MiAqIHA0ICsgMTI4ID4+IDg7CiAgICB2MiA9IHAyOwogICAgdjMgPSBwNjsKICAgIHY0ID0gZGN0U3FydDFkMiAqIChwMSAtIHA3KSArIDEyOCA+PiA4OwogICAgdjcgPSBkY3RTcXJ0MWQyICogKHAxICsgcDcpICsgMTI4ID4+IDg7CiAgICB2NSA9IHAzIDw8IDQ7CiAgICB2NiA9IHA1IDw8IDQ7CiAgICB2MCA9IHYwICsgdjEgKyAxID4+IDE7CiAgICB2MSA9IHYwIC0gdjE7CiAgICB0ID0gdjIgKiBkY3RTaW42ICsgdjMgKiBkY3RDb3M2ICsgMTI4ID4+IDg7CiAgICB2MiA9IHYyICogZGN0Q29zNiAtIHYzICogZGN0U2luNiArIDEyOCA+PiA4OwogICAgdjMgPSB0OwogICAgdjQgPSB2NCArIHY2ICsgMSA+PiAxOwogICAgdjYgPSB2NCAtIHY2OwogICAgdjcgPSB2NyArIHY1ICsgMSA+PiAxOwogICAgdjUgPSB2NyAtIHY1OwogICAgdjAgPSB2MCArIHYzICsgMSA+PiAxOwogICAgdjMgPSB2MCAtIHYzOwogICAgdjEgPSB2MSArIHYyICsgMSA+PiAxOwogICAgdjIgPSB2MSAtIHYyOwogICAgdCA9IHY0ICogZGN0U2luMyArIHY3ICogZGN0Q29zMyArIDIwNDggPj4gMTI7CiAgICB2NCA9IHY0ICogZGN0Q29zMyAtIHY3ICogZGN0U2luMyArIDIwNDggPj4gMTI7CiAgICB2NyA9IHQ7CiAgICB0ID0gdjUgKiBkY3RTaW4xICsgdjYgKiBkY3RDb3MxICsgMjA0OCA+PiAxMjsKICAgIHY1ID0gdjUgKiBkY3RDb3MxIC0gdjYgKiBkY3RTaW4xICsgMjA0OCA+PiAxMjsKICAgIHY2ID0gdDsKICAgIHBbcm93XSA9IHYwICsgdjc7CiAgICBwW3JvdyArIDddID0gdjAgLSB2NzsKICAgIHBbcm93ICsgMV0gPSB2MSArIHY2OwogICAgcFtyb3cgKyA2XSA9IHYxIC0gdjY7CiAgICBwW3JvdyArIDJdID0gdjIgKyB2NTsKICAgIHBbcm93ICsgNV0gPSB2MiAtIHY1OwogICAgcFtyb3cgKyAzXSA9IHYzICsgdjQ7CiAgICBwW3JvdyArIDRdID0gdjMgLSB2NDsKICB9CiAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgODsgKytjb2wpIHsKICAgIHAwID0gcFtjb2xdOwogICAgcDEgPSBwW2NvbCArIDhdOwogICAgcDIgPSBwW2NvbCArIDE2XTsKICAgIHAzID0gcFtjb2wgKyAyNF07CiAgICBwNCA9IHBbY29sICsgMzJdOwogICAgcDUgPSBwW2NvbCArIDQwXTsKICAgIHA2ID0gcFtjb2wgKyA0OF07CiAgICBwNyA9IHBbY29sICsgNTZdOwogICAgaWYgKChwMSB8IHAyIHwgcDMgfCBwNCB8IHA1IHwgcDYgfCBwNykgPT09IDApIHsKICAgICAgdCA9IGRjdFNxcnQyICogcDAgKyA4MTkyID4+IDE0OwogICAgICBpZiAodCA8IC0yMDQwKSB7CiAgICAgICAgdCA9IDA7CiAgICAgIH0gZWxzZSBpZiAodCA+PSAyMDI0KSB7CiAgICAgICAgdCA9IDI1NTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ID0gdCArIDIwNTYgPj4gNDsKICAgICAgfQogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2xdID0gdDsKICAgICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgOF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAxNl0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAyNF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAzMl0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0MF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0OF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA1Nl0gPSB0OwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHYwID0gZGN0U3FydDIgKiBwMCArIDIwNDggPj4gMTI7CiAgICB2MSA9IGRjdFNxcnQyICogcDQgKyAyMDQ4ID4+IDEyOwogICAgdjIgPSBwMjsKICAgIHYzID0gcDY7CiAgICB2NCA9IGRjdFNxcnQxZDIgKiAocDEgLSBwNykgKyAyMDQ4ID4+IDEyOwogICAgdjcgPSBkY3RTcXJ0MWQyICogKHAxICsgcDcpICsgMjA0OCA+PiAxMjsKICAgIHY1ID0gcDM7CiAgICB2NiA9IHA1OwogICAgdjAgPSAodjAgKyB2MSArIDEgPj4gMSkgKyA0MTEyOwogICAgdjEgPSB2MCAtIHYxOwogICAgdCA9IHYyICogZGN0U2luNiArIHYzICogZGN0Q29zNiArIDIwNDggPj4gMTI7CiAgICB2MiA9IHYyICogZGN0Q29zNiAtIHYzICogZGN0U2luNiArIDIwNDggPj4gMTI7CiAgICB2MyA9IHQ7CiAgICB2NCA9IHY0ICsgdjYgKyAxID4+IDE7CiAgICB2NiA9IHY0IC0gdjY7CiAgICB2NyA9IHY3ICsgdjUgKyAxID4+IDE7CiAgICB2NSA9IHY3IC0gdjU7CiAgICB2MCA9IHYwICsgdjMgKyAxID4+IDE7CiAgICB2MyA9IHYwIC0gdjM7CiAgICB2MSA9IHYxICsgdjIgKyAxID4+IDE7CiAgICB2MiA9IHYxIC0gdjI7CiAgICB0ID0gdjQgKiBkY3RTaW4zICsgdjcgKiBkY3RDb3MzICsgMjA0OCA+PiAxMjsKICAgIHY0ID0gdjQgKiBkY3RDb3MzIC0gdjcgKiBkY3RTaW4zICsgMjA0OCA+PiAxMjsKICAgIHY3ID0gdDsKICAgIHQgPSB2NSAqIGRjdFNpbjEgKyB2NiAqIGRjdENvczEgKyAyMDQ4ID4+IDEyOwogICAgdjUgPSB2NSAqIGRjdENvczEgLSB2NiAqIGRjdFNpbjEgKyAyMDQ4ID4+IDEyOwogICAgdjYgPSB0OwogICAgcDAgPSB2MCArIHY3OwogICAgcDcgPSB2MCAtIHY3OwogICAgcDEgPSB2MSArIHY2OwogICAgcDYgPSB2MSAtIHY2OwogICAgcDIgPSB2MiArIHY1OwogICAgcDUgPSB2MiAtIHY1OwogICAgcDMgPSB2MyArIHY0OwogICAgcDQgPSB2MyAtIHY0OwogICAgaWYgKHAwIDwgMTYpIHsKICAgICAgcDAgPSAwOwogICAgfSBlbHNlIGlmIChwMCA+PSA0MDgwKSB7CiAgICAgIHAwID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDAgPj49IDQ7CiAgICB9CiAgICBpZiAocDEgPCAxNikgewogICAgICBwMSA9IDA7CiAgICB9IGVsc2UgaWYgKHAxID49IDQwODApIHsKICAgICAgcDEgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwMSA+Pj0gNDsKICAgIH0KICAgIGlmIChwMiA8IDE2KSB7CiAgICAgIHAyID0gMDsKICAgIH0gZWxzZSBpZiAocDIgPj0gNDA4MCkgewogICAgICBwMiA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHAyID4+PSA0OwogICAgfQogICAgaWYgKHAzIDwgMTYpIHsKICAgICAgcDMgPSAwOwogICAgfSBlbHNlIGlmIChwMyA+PSA0MDgwKSB7CiAgICAgIHAzID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDMgPj49IDQ7CiAgICB9CiAgICBpZiAocDQgPCAxNikgewogICAgICBwNCA9IDA7CiAgICB9IGVsc2UgaWYgKHA0ID49IDQwODApIHsKICAgICAgcDQgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwNCA+Pj0gNDsKICAgIH0KICAgIGlmIChwNSA8IDE2KSB7CiAgICAgIHA1ID0gMDsKICAgIH0gZWxzZSBpZiAocDUgPj0gNDA4MCkgewogICAgICBwNSA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHA1ID4+PSA0OwogICAgfQogICAgaWYgKHA2IDwgMTYpIHsKICAgICAgcDYgPSAwOwogICAgfSBlbHNlIGlmIChwNiA+PSA0MDgwKSB7CiAgICAgIHA2ID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDYgPj49IDQ7CiAgICB9CiAgICBpZiAocDcgPCAxNikgewogICAgICBwNyA9IDA7CiAgICB9IGVsc2UgaWYgKHA3ID49IDQwODApIHsKICAgICAgcDcgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwNyA+Pj0gNDsKICAgIH0KICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbF0gPSBwMDsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDhdID0gcDE7CiAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAxNl0gPSBwMjsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDI0XSA9IHAzOwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgMzJdID0gcDQ7CiAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0MF0gPSBwNTsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDQ4XSA9IHA2OwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgNTZdID0gcDc7CiAgfQp9CmZ1bmN0aW9uIGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSB7CiAgY29uc3QgYmxvY2tzUGVyTGluZSA9IGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lOwogIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IGNvbXBvbmVudC5ibG9ja3NQZXJDb2x1bW47CiAgY29uc3QgY29tcHV0YXRpb25CdWZmZXIgPSBuZXcgSW50MTZBcnJheSg2NCk7CiAgZm9yIChsZXQgYmxvY2tSb3cgPSAwOyBibG9ja1JvdyA8IGJsb2Nrc1BlckNvbHVtbjsgYmxvY2tSb3crKykgewogICAgZm9yIChsZXQgYmxvY2tDb2wgPSAwOyBibG9ja0NvbCA8IGJsb2Nrc1BlckxpbmU7IGJsb2NrQ29sKyspIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gZ2V0QmxvY2tCdWZmZXJPZmZzZXQoY29tcG9uZW50LCBibG9ja1JvdywgYmxvY2tDb2wpOwogICAgICBxdWFudGl6ZUFuZEludmVyc2UoY29tcG9uZW50LCBvZmZzZXQsIGNvbXB1dGF0aW9uQnVmZmVyKTsKICAgIH0KICB9CiAgcmV0dXJuIGNvbXBvbmVudC5ibG9ja0RhdGE7Cn0KZnVuY3Rpb24gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGN1cnJlbnRQb3MsIHN0YXJ0UG9zID0gY3VycmVudFBvcykgewogIGNvbnN0IG1heFBvcyA9IGRhdGEubGVuZ3RoIC0gMTsKICBsZXQgbmV3UG9zID0gc3RhcnRQb3MgPCBjdXJyZW50UG9zID8gc3RhcnRQb3MgOiBjdXJyZW50UG9zOwogIGlmIChjdXJyZW50UG9zID49IG1heFBvcykgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGN1cnJlbnRNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIGN1cnJlbnRQb3MpOwogIGlmIChjdXJyZW50TWFya2VyID49IDB4ZmZjMCAmJiBjdXJyZW50TWFya2VyIDw9IDB4ZmZmZSkgewogICAgcmV0dXJuIHsKICAgICAgaW52YWxpZDogbnVsbCwKICAgICAgbWFya2VyOiBjdXJyZW50TWFya2VyLAogICAgICBvZmZzZXQ6IGN1cnJlbnRQb3MKICAgIH07CiAgfQogIGxldCBuZXdNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIG5ld1Bvcyk7CiAgd2hpbGUgKCEobmV3TWFya2VyID49IDB4ZmZjMCAmJiBuZXdNYXJrZXIgPD0gMHhmZmZlKSkgewogICAgaWYgKCsrbmV3UG9zID49IG1heFBvcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIG5ld01hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgbmV3UG9zKTsKICB9CiAgcmV0dXJuIHsKICAgIGludmFsaWQ6IGN1cnJlbnRNYXJrZXIudG9TdHJpbmcoMTYpLAogICAgbWFya2VyOiBuZXdNYXJrZXIsCiAgICBvZmZzZXQ6IG5ld1BvcwogIH07Cn0KZnVuY3Rpb24gcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpIHsKICBjb25zdCBtY3VzUGVyTGluZSA9IE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDggLyBmcmFtZS5tYXhIKTsKICBjb25zdCBtY3VzUGVyQ29sdW1uID0gTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDggLyBmcmFtZS5tYXhWKTsKICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICBjb25zdCBibG9ja3NQZXJMaW5lID0gTWF0aC5jZWlsKE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDgpICogY29tcG9uZW50LmggLyBmcmFtZS5tYXhIKTsKICAgIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2NhbkxpbmVzIC8gOCkgKiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYpOwogICAgY29uc3QgYmxvY2tzUGVyTGluZUZvck1jdSA9IG1jdXNQZXJMaW5lICogY29tcG9uZW50Lmg7CiAgICBjb25zdCBibG9ja3NQZXJDb2x1bW5Gb3JNY3UgPSBtY3VzUGVyQ29sdW1uICogY29tcG9uZW50LnY7CiAgICBjb25zdCBibG9ja3NCdWZmZXJTaXplID0gNjQgKiBibG9ja3NQZXJDb2x1bW5Gb3JNY3UgKiAoYmxvY2tzUGVyTGluZUZvck1jdSArIDEpOwogICAgY29tcG9uZW50LmJsb2NrRGF0YSA9IG5ldyBJbnQxNkFycmF5KGJsb2Nrc0J1ZmZlclNpemUpOwogICAgY29tcG9uZW50LmJsb2Nrc1BlckxpbmUgPSBibG9ja3NQZXJMaW5lOwogICAgY29tcG9uZW50LmJsb2Nrc1BlckNvbHVtbiA9IGJsb2Nrc1BlckNvbHVtbjsKICB9CiAgZnJhbWUubWN1c1BlckxpbmUgPSBtY3VzUGVyTGluZTsKICBmcmFtZS5tY3VzUGVyQ29sdW1uID0gbWN1c1BlckNvbHVtbjsKfQpmdW5jdGlvbiByZWFkRGF0YUJsb2NrKGRhdGEsIG9mZnNldCkgewogIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICBvZmZzZXQgKz0gMjsKICBsZXQgZW5kT2Zmc2V0ID0gb2Zmc2V0ICsgbGVuZ3RoIC0gMjsKICBjb25zdCBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGVuZE9mZnNldCwgb2Zmc2V0KTsKICBpZiAoZmlsZU1hcmtlcj8uaW52YWxpZCkgewogICAgd2FybigicmVhZERhdGFCbG9jayAtIGluY29ycmVjdCBsZW5ndGgsIGN1cnJlbnQgbWFya2VyIGlzOiAiICsgZmlsZU1hcmtlci5pbnZhbGlkKTsKICAgIGVuZE9mZnNldCA9IGZpbGVNYXJrZXIub2Zmc2V0OwogIH0KICBjb25zdCBhcnJheSA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBlbmRPZmZzZXQpOwogIHJldHVybiB7CiAgICBhcHBEYXRhOiBhcnJheSwKICAgIG9sZE9mZnNldDogb2Zmc2V0LAogICAgbmV3T2Zmc2V0OiBvZmZzZXQgKyBhcnJheS5sZW5ndGgKICB9Owp9CmZ1bmN0aW9uIHNraXBEYXRhKGRhdGEsIG9mZnNldCkgewogIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICBvZmZzZXQgKz0gMjsKICBjb25zdCBlbmRPZmZzZXQgPSBvZmZzZXQgKyBsZW5ndGggLSAyOwogIGNvbnN0IGZpbGVNYXJrZXIgPSBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgZW5kT2Zmc2V0LCBvZmZzZXQpOwogIGlmIChmaWxlTWFya2VyPy5pbnZhbGlkKSB7CiAgICByZXR1cm4gZmlsZU1hcmtlci5vZmZzZXQ7CiAgfQogIHJldHVybiBlbmRPZmZzZXQ7Cn0KY2xhc3MgSnBlZ0ltYWdlIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBkZWNvZGVUcmFuc2Zvcm0gPSBudWxsLAogICAgY29sb3JUcmFuc2Zvcm0gPSAtMQogIH0gPSB7fSkgewogICAgdGhpcy5fZGVjb2RlVHJhbnNmb3JtID0gZGVjb2RlVHJhbnNmb3JtOwogICAgdGhpcy5fY29sb3JUcmFuc2Zvcm0gPSBjb2xvclRyYW5zZm9ybTsKICB9CiAgc3RhdGljIGNhblVzZUltYWdlRGVjb2RlcihkYXRhLCBjb2xvclRyYW5zZm9ybSA9IC0xKSB7CiAgICBsZXQgZXhpZk9mZnNldHMgPSBudWxsOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBsZXQgbnVtQ29tcG9uZW50cyA9IG51bGw7CiAgICBsZXQgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgIG9mZnNldCArPSAyOwogICAgaWYgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOCkgewogICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJTT0kgbm90IGZvdW5kIik7CiAgICB9CiAgICBmaWxlTWFya2VyID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDI7CiAgICBtYXJrZXJMb29wOiB3aGlsZSAoZmlsZU1hcmtlciAhPT0gMHhmZmQ5KSB7CiAgICAgIHN3aXRjaCAoZmlsZU1hcmtlcikgewogICAgICAgIGNhc2UgMHhmZmUxOgogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBhcHBEYXRhLAogICAgICAgICAgICBvbGRPZmZzZXQsCiAgICAgICAgICAgIG5ld09mZnNldAogICAgICAgICAgfSA9IHJlYWREYXRhQmxvY2soZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCA9IG5ld09mZnNldDsKICAgICAgICAgIGlmIChhcHBEYXRhWzBdID09PSAweDQ1ICYmIGFwcERhdGFbMV0gPT09IDB4NzggJiYgYXBwRGF0YVsyXSA9PT0gMHg2OSAmJiBhcHBEYXRhWzNdID09PSAweDY2ICYmIGFwcERhdGFbNF0gPT09IDAgJiYgYXBwRGF0YVs1XSA9PT0gMCkgewogICAgICAgICAgICBpZiAoZXhpZk9mZnNldHMpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJEdXBsaWNhdGUgRVhJRi1ibG9ja3MgZm91bmQuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXhpZk9mZnNldHMgPSB7CiAgICAgICAgICAgICAgZXhpZlN0YXJ0OiBvbGRPZmZzZXQgKyA2LAogICAgICAgICAgICAgIGV4aWZFbmQ6IG5ld09mZnNldAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgY2FzZSAweGZmYzA6CiAgICAgICAgY2FzZSAweGZmYzE6CiAgICAgICAgY2FzZSAweGZmYzI6CiAgICAgICAgICBudW1Db21wb25lbnRzID0gZGF0YVtvZmZzZXQgKyAoMiArIDEgKyAyICsgMildOwogICAgICAgICAgYnJlYWsgbWFya2VyTG9vcDsKICAgICAgICBjYXNlIDB4ZmZmZjoKICAgICAgICAgIGlmIChkYXRhW29mZnNldF0gIT09IDB4ZmYpIHsKICAgICAgICAgICAgb2Zmc2V0LS07CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBvZmZzZXQgPSBza2lwRGF0YShkYXRhLCBvZmZzZXQpOwogICAgICBmaWxlTWFya2VyID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICBvZmZzZXQgKz0gMjsKICAgIH0KICAgIGlmIChudW1Db21wb25lbnRzID09PSA0KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKG51bUNvbXBvbmVudHMgPT09IDMgJiYgY29sb3JUcmFuc2Zvcm0gPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gZXhpZk9mZnNldHMgfHwge307CiAgfQogIHBhcnNlKGRhdGEsIHsKICAgIGRubFNjYW5MaW5lcyA9IG51bGwKICB9ID0ge30pIHsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgbGV0IGpmaWYgPSBudWxsOwogICAgbGV0IGFkb2JlID0gbnVsbDsKICAgIGxldCBmcmFtZSwgcmVzZXRJbnRlcnZhbDsKICAgIGxldCBudW1TT1NNYXJrZXJzID0gMDsKICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlcyA9IFtdOwogICAgY29uc3QgaHVmZm1hblRhYmxlc0FDID0gW10sCiAgICAgIGh1ZmZtYW5UYWJsZXNEQyA9IFtdOwogICAgbGV0IGZpbGVNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCk7CiAgICBvZmZzZXQgKz0gMjsKICAgIGlmIChmaWxlTWFya2VyICE9PSAweGZmZDgpIHsKICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiU09JIG5vdCBmb3VuZCIpOwogICAgfQogICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgIG9mZnNldCArPSAyOwogICAgbWFya2VyTG9vcDogd2hpbGUgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOSkgewogICAgICBsZXQgaSwgaiwgbDsKICAgICAgc3dpdGNoIChmaWxlTWFya2VyKSB7CiAgICAgICAgY2FzZSAweGZmZTA6CiAgICAgICAgY2FzZSAweGZmZTE6CiAgICAgICAgY2FzZSAweGZmZTI6CiAgICAgICAgY2FzZSAweGZmZTM6CiAgICAgICAgY2FzZSAweGZmZTQ6CiAgICAgICAgY2FzZSAweGZmZTU6CiAgICAgICAgY2FzZSAweGZmZTY6CiAgICAgICAgY2FzZSAweGZmZTc6CiAgICAgICAgY2FzZSAweGZmZTg6CiAgICAgICAgY2FzZSAweGZmZTk6CiAgICAgICAgY2FzZSAweGZmZWE6CiAgICAgICAgY2FzZSAweGZmZWI6CiAgICAgICAgY2FzZSAweGZmZWM6CiAgICAgICAgY2FzZSAweGZmZWQ6CiAgICAgICAgY2FzZSAweGZmZWU6CiAgICAgICAgY2FzZSAweGZmZWY6CiAgICAgICAgY2FzZSAweGZmZmU6CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGFwcERhdGEsCiAgICAgICAgICAgIG5ld09mZnNldAogICAgICAgICAgfSA9IHJlYWREYXRhQmxvY2soZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCA9IG5ld09mZnNldDsKICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweGZmZTApIHsKICAgICAgICAgICAgaWYgKGFwcERhdGFbMF0gPT09IDB4NGEgJiYgYXBwRGF0YVsxXSA9PT0gMHg0NiAmJiBhcHBEYXRhWzJdID09PSAweDQ5ICYmIGFwcERhdGFbM10gPT09IDB4NDYgJiYgYXBwRGF0YVs0XSA9PT0gMCkgewogICAgICAgICAgICAgIGpmaWYgPSB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgIG1ham9yOiBhcHBEYXRhWzVdLAogICAgICAgICAgICAgICAgICBtaW5vcjogYXBwRGF0YVs2XQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlbnNpdHlVbml0czogYXBwRGF0YVs3XSwKICAgICAgICAgICAgICAgIHhEZW5zaXR5OiBhcHBEYXRhWzhdIDw8IDggfCBhcHBEYXRhWzldLAogICAgICAgICAgICAgICAgeURlbnNpdHk6IGFwcERhdGFbMTBdIDw8IDggfCBhcHBEYXRhWzExXSwKICAgICAgICAgICAgICAgIHRodW1iV2lkdGg6IGFwcERhdGFbMTJdLAogICAgICAgICAgICAgICAgdGh1bWJIZWlnaHQ6IGFwcERhdGFbMTNdLAogICAgICAgICAgICAgICAgdGh1bWJEYXRhOiBhcHBEYXRhLnN1YmFycmF5KDE0LCAxNCArIDMgKiBhcHBEYXRhWzEyXSAqIGFwcERhdGFbMTNdKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweGZmZWUpIHsKICAgICAgICAgICAgaWYgKGFwcERhdGFbMF0gPT09IDB4NDEgJiYgYXBwRGF0YVsxXSA9PT0gMHg2NCAmJiBhcHBEYXRhWzJdID09PSAweDZmICYmIGFwcERhdGFbM10gPT09IDB4NjIgJiYgYXBwRGF0YVs0XSA9PT0gMHg2NSkgewogICAgICAgICAgICAgIGFkb2JlID0gewogICAgICAgICAgICAgICAgdmVyc2lvbjogYXBwRGF0YVs1XSA8PCA4IHwgYXBwRGF0YVs2XSwKICAgICAgICAgICAgICAgIGZsYWdzMDogYXBwRGF0YVs3XSA8PCA4IHwgYXBwRGF0YVs4XSwKICAgICAgICAgICAgICAgIGZsYWdzMTogYXBwRGF0YVs5XSA8PCA4IHwgYXBwRGF0YVsxMF0sCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db2RlOiBhcHBEYXRhWzExXQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRiOgogICAgICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGVzTGVuZ3RoID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBjb25zdCBxdWFudGl6YXRpb25UYWJsZXNFbmQgPSBxdWFudGl6YXRpb25UYWJsZXNMZW5ndGggKyBvZmZzZXQgLSAyOwogICAgICAgICAgbGV0IHo7CiAgICAgICAgICB3aGlsZSAob2Zmc2V0IDwgcXVhbnRpemF0aW9uVGFibGVzRW5kKSB7CiAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCB0YWJsZURhdGEgPSBuZXcgVWludDE2QXJyYXkoNjQpOwogICAgICAgICAgICBpZiAocXVhbnRpemF0aW9uVGFibGVTcGVjID4+IDQgPT09IDApIHsKICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgIHRhYmxlRGF0YVt6XSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChxdWFudGl6YXRpb25UYWJsZVNwZWMgPj4gNCA9PT0gMSkgewogICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCA2NDsgaisrKSB7CiAgICAgICAgICAgICAgICB6ID0gZGN0WmlnWmFnW2pdOwogICAgICAgICAgICAgICAgdGFibGVEYXRhW3pdID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkRRVCAtIGludmFsaWQgdGFibGUgc3BlYyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHF1YW50aXphdGlvblRhYmxlc1txdWFudGl6YXRpb25UYWJsZVNwZWMgJiAxNV0gPSB0YWJsZURhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmZjMDoKICAgICAgICBjYXNlIDB4ZmZjMToKICAgICAgICBjYXNlIDB4ZmZjMjoKICAgICAgICAgIGlmIChmcmFtZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJPbmx5IHNpbmdsZSBmcmFtZSBKUEVHcyBzdXBwb3J0ZWQiKTsKICAgICAgICAgIH0KICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgZnJhbWUgPSB7fTsKICAgICAgICAgIGZyYW1lLmV4dGVuZGVkID0gZmlsZU1hcmtlciA9PT0gMHhmZmMxOwogICAgICAgICAgZnJhbWUucHJvZ3Jlc3NpdmUgPSBmaWxlTWFya2VyID09PSAweGZmYzI7CiAgICAgICAgICBmcmFtZS5wcmVjaXNpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIGNvbnN0IHNvZlNjYW5MaW5lcyA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgZnJhbWUuc2NhbkxpbmVzID0gZG5sU2NhbkxpbmVzIHx8IHNvZlNjYW5MaW5lczsKICAgICAgICAgIGZyYW1lLnNhbXBsZXNQZXJMaW5lID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBmcmFtZS5jb21wb25lbnRzID0gW107CiAgICAgICAgICBmcmFtZS5jb21wb25lbnRJZHMgPSB7fTsKICAgICAgICAgIGNvbnN0IGNvbXBvbmVudHNDb3VudCA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgbGV0IG1heEggPSAwLAogICAgICAgICAgICBtYXhWID0gMDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzQ291bnQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBjb21wb25lbnRJZCA9IGRhdGFbb2Zmc2V0XTsKICAgICAgICAgICAgY29uc3QgaCA9IGRhdGFbb2Zmc2V0ICsgMV0gPj4gNDsKICAgICAgICAgICAgY29uc3QgdiA9IGRhdGFbb2Zmc2V0ICsgMV0gJiAxNTsKICAgICAgICAgICAgaWYgKG1heEggPCBoKSB7CiAgICAgICAgICAgICAgbWF4SCA9IGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1heFYgPCB2KSB7CiAgICAgICAgICAgICAgbWF4ViA9IHY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcUlkID0gZGF0YVtvZmZzZXQgKyAyXTsKICAgICAgICAgICAgbCA9IGZyYW1lLmNvbXBvbmVudHMucHVzaCh7CiAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgIHF1YW50aXphdGlvbklkOiBxSWQsCiAgICAgICAgICAgICAgcXVhbnRpemF0aW9uVGFibGU6IG51bGwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGZyYW1lLmNvbXBvbmVudElkc1tjb21wb25lbnRJZF0gPSBsIC0gMTsKICAgICAgICAgICAgb2Zmc2V0ICs9IDM7CiAgICAgICAgICB9CiAgICAgICAgICBmcmFtZS5tYXhIID0gbWF4SDsKICAgICAgICAgIGZyYW1lLm1heFYgPSBtYXhWOwogICAgICAgICAgcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmYzQ6CiAgICAgICAgICBjb25zdCBodWZmbWFuTGVuZ3RoID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgaHVmZm1hbkxlbmd0aDspIHsKICAgICAgICAgICAgY29uc3QgaHVmZm1hblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCBjb2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgbGV0IGNvZGVMZW5ndGhTdW0gPSAwOwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgMTY7IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICBjb2RlTGVuZ3RoU3VtICs9IGNvZGVMZW5ndGhzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGh1ZmZtYW5WYWx1ZXMgPSBuZXcgVWludDhBcnJheShjb2RlTGVuZ3RoU3VtKTsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNvZGVMZW5ndGhTdW07IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICBodWZmbWFuVmFsdWVzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMTcgKyBjb2RlTGVuZ3RoU3VtOwogICAgICAgICAgICAoaHVmZm1hblRhYmxlU3BlYyA+PiA0ID09PSAwID8gaHVmZm1hblRhYmxlc0RDIDogaHVmZm1hblRhYmxlc0FDKVtodWZmbWFuVGFibGVTcGVjICYgMTVdID0gYnVpbGRIdWZmbWFuVGFibGUoY29kZUxlbmd0aHMsIGh1ZmZtYW5WYWx1ZXMpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmZGQ6CiAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgIHJlc2V0SW50ZXJ2YWwgPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCk7CiAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRhOgogICAgICAgICAgY29uc3QgcGFyc2VETkxNYXJrZXIgPSArK251bVNPU01hcmtlcnMgPT09IDEgJiYgIWRubFNjYW5MaW5lczsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29uc3Qgc2VsZWN0b3JzQ291bnQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlbGVjdG9yc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50SW5kZXggPSBmcmFtZS5jb21wb25lbnRJZHNbaW5kZXhdOwogICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudEluZGV4XTsKICAgICAgICAgICAgY29tcG9uZW50LmluZGV4ID0gaW5kZXg7CiAgICAgICAgICAgIGNvbnN0IHRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlREMgPSBodWZmbWFuVGFibGVzRENbdGFibGVTcGVjID4+IDRdOwogICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlQUMgPSBodWZmbWFuVGFibGVzQUNbdGFibGVTcGVjICYgMTVdOwogICAgICAgICAgICBjb21wb25lbnRzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHNwZWN0cmFsU3RhcnQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgc3BlY3RyYWxFbmQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgc3VjY2Vzc2l2ZUFwcHJveGltYXRpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZCA9IGRlY29kZVNjYW4oZGF0YSwgb2Zmc2V0LCBmcmFtZSwgY29tcG9uZW50cywgcmVzZXRJbnRlcnZhbCwgc3BlY3RyYWxTdGFydCwgc3BlY3RyYWxFbmQsIHN1Y2Nlc3NpdmVBcHByb3hpbWF0aW9uID4+IDQsIHN1Y2Nlc3NpdmVBcHByb3hpbWF0aW9uICYgMTUsIHBhcnNlRE5MTWFya2VyKTsKICAgICAgICAgICAgb2Zmc2V0ICs9IHByb2Nlc3NlZDsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIEROTE1hcmtlckVycm9yKSB7CiAgICAgICAgICAgICAgd2FybihgJHtleC5tZXNzYWdlfSAtLSBhdHRlbXB0aW5nIHRvIHJlLXBhcnNlIHRoZSBKUEVHIGltYWdlLmApOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlKGRhdGEsIHsKICAgICAgICAgICAgICAgIGRubFNjYW5MaW5lczogZXguc2NhbkxpbmVzCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXggaW5zdGFuY2VvZiBFT0lNYXJrZXJFcnJvcikgewogICAgICAgICAgICAgIHdhcm4oYCR7ZXgubWVzc2FnZX0gLS0gaWdub3JpbmcgdGhlIHJlc3Qgb2YgdGhlIGltYWdlIGRhdGEuYCk7CiAgICAgICAgICAgICAgYnJlYWsgbWFya2VyTG9vcDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRjOgogICAgICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmZmZjoKICAgICAgICAgIGlmIChkYXRhW29mZnNldF0gIT09IDB4ZmYpIHsKICAgICAgICAgICAgb2Zmc2V0LS07CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY29uc3QgbmV4dEZpbGVNYXJrZXIgPSBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgb2Zmc2V0IC0gMiwgb2Zmc2V0IC0gMyk7CiAgICAgICAgICBpZiAobmV4dEZpbGVNYXJrZXI/LmludmFsaWQpIHsKICAgICAgICAgICAgd2FybigiSnBlZ0ltYWdlLnBhcnNlIC0gdW5leHBlY3RlZCBkYXRhLCBjdXJyZW50IG1hcmtlciBpczogIiArIG5leHRGaWxlTWFya2VyLmludmFsaWQpOwogICAgICAgICAgICBvZmZzZXQgPSBuZXh0RmlsZU1hcmtlci5vZmZzZXQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFuZXh0RmlsZU1hcmtlciB8fCBvZmZzZXQgPj0gZGF0YS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHdhcm4oIkpwZWdJbWFnZS5wYXJzZSAtIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgaW1hZ2UgZGF0YSAiICsgIndpdGhvdXQgZmluZGluZyBhbiBFT0kgbWFya2VyICgweEZGRDkpLiIpOwogICAgICAgICAgICBicmVhayBtYXJrZXJMb29wOwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiSnBlZ0ltYWdlLnBhcnNlIC0gdW5rbm93biBtYXJrZXI6ICIgKyBmaWxlTWFya2VyLnRvU3RyaW5nKDE2KSk7CiAgICAgIH0KICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9CiAgICBpZiAoIWZyYW1lKSB7CiAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkpwZWdJbWFnZS5wYXJzZSAtIG5vIGZyYW1lIGRhdGEgZm91bmQuIik7CiAgICB9CiAgICB0aGlzLndpZHRoID0gZnJhbWUuc2FtcGxlc1BlckxpbmU7CiAgICB0aGlzLmhlaWdodCA9IGZyYW1lLnNjYW5MaW5lczsKICAgIHRoaXMuamZpZiA9IGpmaWY7CiAgICB0aGlzLmFkb2JlID0gYWRvYmU7CiAgICB0aGlzLmNvbXBvbmVudHMgPSBbXTsKICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIGZyYW1lLmNvbXBvbmVudHMpIHsKICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGUgPSBxdWFudGl6YXRpb25UYWJsZXNbY29tcG9uZW50LnF1YW50aXphdGlvbklkXTsKICAgICAgaWYgKHF1YW50aXphdGlvblRhYmxlKSB7CiAgICAgICAgY29tcG9uZW50LnF1YW50aXphdGlvblRhYmxlID0gcXVhbnRpemF0aW9uVGFibGU7CiAgICAgIH0KICAgICAgdGhpcy5jb21wb25lbnRzLnB1c2goewogICAgICAgIGluZGV4OiBjb21wb25lbnQuaW5kZXgsCiAgICAgICAgb3V0cHV0OiBidWlsZENvbXBvbmVudERhdGEoZnJhbWUsIGNvbXBvbmVudCksCiAgICAgICAgc2NhbGVYOiBjb21wb25lbnQuaCAvIGZyYW1lLm1heEgsCiAgICAgICAgc2NhbGVZOiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYsCiAgICAgICAgYmxvY2tzUGVyTGluZTogY29tcG9uZW50LmJsb2Nrc1BlckxpbmUsCiAgICAgICAgYmxvY2tzUGVyQ29sdW1uOiBjb21wb25lbnQuYmxvY2tzUGVyQ29sdW1uCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5udW1Db21wb25lbnRzID0gdGhpcy5jb21wb25lbnRzLmxlbmd0aDsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIF9nZXRMaW5lYXJpemVkQmxvY2tEYXRhKHdpZHRoLCBoZWlnaHQsIGlzU291cmNlUERGID0gZmFsc2UpIHsKICAgIGNvbnN0IHNjYWxlWCA9IHRoaXMud2lkdGggLyB3aWR0aCwKICAgICAgc2NhbGVZID0gdGhpcy5oZWlnaHQgLyBoZWlnaHQ7CiAgICBsZXQgY29tcG9uZW50LCBjb21wb25lbnRTY2FsZVgsIGNvbXBvbmVudFNjYWxlWSwgYmxvY2tzUGVyU2NhbmxpbmU7CiAgICBsZXQgeCwgeSwgaSwgaiwgazsKICAgIGxldCBpbmRleDsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgbGV0IG91dHB1dDsKICAgIGNvbnN0IG51bUNvbXBvbmVudHMgPSB0aGlzLmNvbXBvbmVudHMubGVuZ3RoOwogICAgY29uc3QgZGF0YUxlbmd0aCA9IHdpZHRoICogaGVpZ2h0ICogbnVtQ29tcG9uZW50czsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZGF0YUxlbmd0aCk7CiAgICBjb25zdCB4U2NhbGVCbG9ja09mZnNldCA9IG5ldyBVaW50MzJBcnJheSh3aWR0aCk7CiAgICBjb25zdCBtYXNrM0xTQiA9IDB4ZmZmZmZmZjg7CiAgICBsZXQgbGFzdENvbXBvbmVudFNjYWxlWDsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1Db21wb25lbnRzOyBpKyspIHsKICAgICAgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRzW2ldOwogICAgICBjb21wb25lbnRTY2FsZVggPSBjb21wb25lbnQuc2NhbGVYICogc2NhbGVYOwogICAgICBjb21wb25lbnRTY2FsZVkgPSBjb21wb25lbnQuc2NhbGVZICogc2NhbGVZOwogICAgICBvZmZzZXQgPSBpOwogICAgICBvdXRwdXQgPSBjb21wb25lbnQub3V0cHV0OwogICAgICBibG9ja3NQZXJTY2FubGluZSA9IGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lICsgMSA8PCAzOwogICAgICBpZiAoY29tcG9uZW50U2NhbGVYICE9PSBsYXN0Q29tcG9uZW50U2NhbGVYKSB7CiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgIGogPSAwIHwgeCAqIGNvbXBvbmVudFNjYWxlWDsKICAgICAgICAgIHhTY2FsZUJsb2NrT2Zmc2V0W3hdID0gKGogJiBtYXNrM0xTQikgPDwgMyB8IGogJiA3OwogICAgICAgIH0KICAgICAgICBsYXN0Q29tcG9uZW50U2NhbGVYID0gY29tcG9uZW50U2NhbGVYOwogICAgICB9CiAgICAgIGZvciAoeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykgewogICAgICAgIGogPSAwIHwgeSAqIGNvbXBvbmVudFNjYWxlWTsKICAgICAgICBpbmRleCA9IGJsb2Nrc1BlclNjYW5saW5lICogKGogJiBtYXNrM0xTQikgfCAoaiAmIDcpIDw8IDM7CiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgIGRhdGFbb2Zmc2V0XSA9IG91dHB1dFtpbmRleCArIHhTY2FsZUJsb2NrT2Zmc2V0W3hdXTsKICAgICAgICAgIG9mZnNldCArPSBudW1Db21wb25lbnRzOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IHRyYW5zZm9ybSA9IHRoaXMuX2RlY29kZVRyYW5zZm9ybTsKICAgIGlmICghaXNTb3VyY2VQREYgJiYgbnVtQ29tcG9uZW50cyA9PT0gNCAmJiAhdHJhbnNmb3JtKSB7CiAgICAgIHRyYW5zZm9ybSA9IG5ldyBJbnQzMkFycmF5KFstMjU2LCAyNTUsIC0yNTYsIDI1NSwgLTI1NiwgMjU1LCAtMjU2LCAyNTVdKTsKICAgIH0KICAgIGlmICh0cmFuc2Zvcm0pIHsKICAgICAgZm9yIChpID0gMDsgaSA8IGRhdGFMZW5ndGg7KSB7CiAgICAgICAgZm9yIChqID0gMCwgayA9IDA7IGogPCBudW1Db21wb25lbnRzOyBqKyssIGkrKywgayArPSAyKSB7CiAgICAgICAgICBkYXRhW2ldID0gKGRhdGFbaV0gKiB0cmFuc2Zvcm1ba10gPj4gOCkgKyB0cmFuc2Zvcm1bayArIDFdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldCBfaXNDb2xvckNvbnZlcnNpb25OZWVkZWQoKSB7CiAgICBpZiAodGhpcy5hZG9iZSkgewogICAgICByZXR1cm4gISF0aGlzLmFkb2JlLnRyYW5zZm9ybUNvZGU7CiAgICB9CiAgICBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSAzKSB7CiAgICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbXBvbmVudHNbMF0uaW5kZXggPT09IDB4NTIgJiYgdGhpcy5jb21wb25lbnRzWzFdLmluZGV4ID09PSAweDQ3ICYmIHRoaXMuY29tcG9uZW50c1syXS5pbmRleCA9PT0gMHg0MikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgX2NvbnZlcnRZY2NUb1JnYihkYXRhKSB7CiAgICBsZXQgWSwgQ2IsIENyOwogICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDMpIHsKICAgICAgWSA9IGRhdGFbaV07CiAgICAgIENiID0gZGF0YVtpICsgMV07CiAgICAgIENyID0gZGF0YVtpICsgMl07CiAgICAgIGRhdGFbaV0gPSBZIC0gMTc5LjQ1NiArIDEuNDAyICogQ3I7CiAgICAgIGRhdGFbaSArIDFdID0gWSArIDEzNS40NTkgLSAwLjM0NCAqIENiIC0gMC43MTQgKiBDcjsKICAgICAgZGF0YVtpICsgMl0gPSBZIC0gMjI2LjgxNiArIDEuNzcyICogQ2I7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgX2NvbnZlcnRZY2NUb1JnYmEoZGF0YSwgb3V0KSB7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDMsIGogKz0gNCkgewogICAgICBjb25zdCBZID0gZGF0YVtpXTsKICAgICAgY29uc3QgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgY29uc3QgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgb3V0W2pdID0gWSAtIDE3OS40NTYgKyAxLjQwMiAqIENyOwogICAgICBvdXRbaiArIDFdID0gWSArIDEzNS40NTkgLSAwLjM0NCAqIENiIC0gMC43MTQgKiBDcjsKICAgICAgb3V0W2ogKyAyXSA9IFkgLSAyMjYuODE2ICsgMS43NzIgKiBDYjsKICAgICAgb3V0W2ogKyAzXSA9IDI1NTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIF9jb252ZXJ0WWNja1RvUmdiKGRhdGEpIHsKICAgIHRoaXMuX2NvbnZlcnRZY2NrVG9DbXlrKGRhdGEpOwogICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRDbXlrVG9SZ2IoZGF0YSk7CiAgfQogIF9jb252ZXJ0WWNja1RvUmdiYShkYXRhKSB7CiAgICB0aGlzLl9jb252ZXJ0WWNja1RvQ215ayhkYXRhKTsKICAgIHJldHVybiB0aGlzLl9jb252ZXJ0Q215a1RvUmdiYShkYXRhKTsKICB9CiAgX2NvbnZlcnRZY2NrVG9DbXlrKGRhdGEpIHsKICAgIGxldCBZLCBDYiwgQ3I7CiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICBZID0gZGF0YVtpXTsKICAgICAgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgZGF0YVtpXSA9IDQzNC40NTYgLSBZIC0gMS40MDIgKiBDcjsKICAgICAgZGF0YVtpICsgMV0gPSAxMTkuNTQxIC0gWSArIDAuMzQ0ICogQ2IgKyAwLjcxNCAqIENyOwogICAgICBkYXRhW2kgKyAyXSA9IDQ4MS44MTYgLSBZIC0gMS43NzIgKiBDYjsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBfY29udmVydENteWtUb1JnYihkYXRhKSB7CiAgICBjb25zdCBjb3VudCA9IGRhdGEubGVuZ3RoIC8gNDsKICAgIENvbG9yU3BhY2VVdGlscy5jbXlrLmdldFJnYkJ1ZmZlcihkYXRhLCAwLCBjb3VudCwgZGF0YSwgMCwgOCwgMCk7CiAgICByZXR1cm4gZGF0YS5zdWJhcnJheSgwLCBjb3VudCAqIDMpOwogIH0KICBfY29udmVydENteWtUb1JnYmEoZGF0YSkgewogICAgQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiQnVmZmVyKGRhdGEsIDAsIGRhdGEubGVuZ3RoIC8gNCwgZGF0YSwgMCwgOCwgMSk7CiAgICBpZiAoQ29sb3JTcGFjZVV0aWxzLmNteWsgaW5zdGFuY2VvZiBEZXZpY2VDbXlrQ1MpIHsKICAgICAgZm9yIChsZXQgaSA9IDMsIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSArPSA0KSB7CiAgICAgICAgZGF0YVtpXSA9IDI1NTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldERhdGEoewogICAgd2lkdGgsCiAgICBoZWlnaHQsCiAgICBmb3JjZVJHQkEgPSBmYWxzZSwKICAgIGZvcmNlUkdCID0gZmFsc2UsCiAgICBpc1NvdXJjZVBERiA9IGZhbHNlCiAgfSkgewogICAgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA+IDQpIHsKICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiVW5zdXBwb3J0ZWQgY29sb3IgbW9kZSIpOwogICAgfQogICAgY29uc3QgZGF0YSA9IHRoaXMuX2dldExpbmVhcml6ZWRCbG9ja0RhdGEod2lkdGgsIGhlaWdodCwgaXNTb3VyY2VQREYpOwogICAgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gMSAmJiAoZm9yY2VSR0JBIHx8IGZvcmNlUkdCKSkgewogICAgICBjb25zdCBsZW4gPSBkYXRhLmxlbmd0aCAqIChmb3JjZVJHQkEgPyA0IDogMyk7CiAgICAgIGNvbnN0IHJnYmFEYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGxlbik7CiAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgZ3JheVRvUkdCQShkYXRhLCBuZXcgVWludDMyQXJyYXkocmdiYURhdGEuYnVmZmVyKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBncmF5Q29sb3Igb2YgZGF0YSkgewogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmdiYURhdGE7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gMyAmJiB0aGlzLl9pc0NvbG9yQ29udmVyc2lvbk5lZWRlZCkgewogICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgY29uc3QgcmdiYURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZGF0YS5sZW5ndGggLyAzICogNCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NUb1JnYmEoZGF0YSwgcmdiYURhdGEpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0WWNjVG9SZ2IoZGF0YSk7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gNCkgewogICAgICBpZiAodGhpcy5faXNDb2xvckNvbnZlcnNpb25OZWVkZWQpIHsKICAgICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydFljY2tUb1JnYmEoZGF0YSk7CiAgICAgICAgfQogICAgICAgIGlmIChmb3JjZVJHQikgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NrVG9SZ2IoZGF0YSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0WWNja1RvQ215ayhkYXRhKTsKICAgICAgfSBlbHNlIGlmIChmb3JjZVJHQkEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydENteWtUb1JnYmEoZGF0YSk7CiAgICAgIH0gZWxzZSBpZiAoZm9yY2VSR0IpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydENteWtUb1JnYihkYXRhKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9qcGVnX3N0cmVhbS5qcwoKCgoKY2xhc3MgSnBlZ1N0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgc3RhdGljICNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IEZlYXR1cmVUZXN0LmlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIGNvbnN0cnVjdG9yKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmRpY3QgPSBzdHJlYW0uZGljdDsKICAgIHRoaXMubWF5YmVMZW5ndGggPSBtYXliZUxlbmd0aDsKICAgIHRoaXMucGFyYW1zID0gcGFyYW1zOwogIH0KICBzdGF0aWMgZ2V0IGNhblVzZUltYWdlRGVjb2RlcigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImNhblVzZUltYWdlRGVjb2RlciIsIHRoaXMuI2lzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID8gSW1hZ2VEZWNvZGVyLmlzVHlwZVN1cHBvcnRlZCgiaW1hZ2UvanBlZyIpIDogUHJvbWlzZS5yZXNvbHZlKGZhbHNlKSk7CiAgfQogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID0gZmFsc2UKICB9KSB7CiAgICB0aGlzLiNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIH0KICBnZXQgYnl0ZXMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJieXRlcyIsIHRoaXMuc3RyZWFtLmdldEJ5dGVzKHRoaXMubWF5YmVMZW5ndGgpKTsKICB9CiAgZW5zdXJlQnVmZmVyKHJlcXVlc3RlZCkge30KICByZWFkQmxvY2soKSB7CiAgICB0aGlzLmRlY29kZUltYWdlKCk7CiAgfQogIGdldCBqcGVnT3B0aW9ucygpIHsKICAgIGNvbnN0IGpwZWdPcHRpb25zID0gewogICAgICBkZWNvZGVUcmFuc2Zvcm06IHVuZGVmaW5lZCwKICAgICAgY29sb3JUcmFuc2Zvcm06IHVuZGVmaW5lZAogICAgfTsKICAgIGNvbnN0IGRlY29kZUFyciA9IHRoaXMuZGljdC5nZXRBcnJheSgiRCIsICJEZWNvZGUiKTsKICAgIGlmICgodGhpcy5mb3JjZVJHQkEgfHwgdGhpcy5mb3JjZVJHQikgJiYgQXJyYXkuaXNBcnJheShkZWNvZGVBcnIpKSB7CiAgICAgIGNvbnN0IGJpdHNQZXJDb21wb25lbnQgPSB0aGlzLmRpY3QuZ2V0KCJCUEMiLCAiQml0c1BlckNvbXBvbmVudCIpIHx8IDg7CiAgICAgIGNvbnN0IGRlY29kZUFyckxlbmd0aCA9IGRlY29kZUFyci5sZW5ndGg7CiAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IG5ldyBJbnQzMkFycmF5KGRlY29kZUFyckxlbmd0aCk7CiAgICAgIGxldCB0cmFuc2Zvcm1OZWVkZWQgPSBmYWxzZTsKICAgICAgY29uc3QgbWF4VmFsdWUgPSAoMSA8PCBiaXRzUGVyQ29tcG9uZW50KSAtIDE7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVjb2RlQXJyTGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICB0cmFuc2Zvcm1baV0gPSAoZGVjb2RlQXJyW2kgKyAxXSAtIGRlY29kZUFycltpXSkgKiAyNTYgfCAwOwogICAgICAgIHRyYW5zZm9ybVtpICsgMV0gPSBkZWNvZGVBcnJbaV0gKiBtYXhWYWx1ZSB8IDA7CiAgICAgICAgaWYgKHRyYW5zZm9ybVtpXSAhPT0gMjU2IHx8IHRyYW5zZm9ybVtpICsgMV0gIT09IDApIHsKICAgICAgICAgIHRyYW5zZm9ybU5lZWRlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0cmFuc2Zvcm1OZWVkZWQpIHsKICAgICAgICBqcGVnT3B0aW9ucy5kZWNvZGVUcmFuc2Zvcm0gPSB0cmFuc2Zvcm07CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLnBhcmFtcyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgY29sb3JUcmFuc2Zvcm0gPSB0aGlzLnBhcmFtcy5nZXQoIkNvbG9yVHJhbnNmb3JtIik7CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNvbG9yVHJhbnNmb3JtKSkgewogICAgICAgIGpwZWdPcHRpb25zLmNvbG9yVHJhbnNmb3JtID0gY29sb3JUcmFuc2Zvcm07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImpwZWdPcHRpb25zIiwganBlZ09wdGlvbnMpOwogIH0KICAjc2tpcFVzZWxlc3NCeXRlcyhkYXRhKSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aCAtIDE7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGlmIChkYXRhW2ldID09PSAweGZmICYmIGRhdGFbaSArIDFdID09PSAweGQ4KSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShpKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBkZWNvZGVJbWFnZShieXRlcykgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgIH0KICAgIGJ5dGVzID0gdGhpcy4jc2tpcFVzZWxlc3NCeXRlcyhieXRlcyB8fCB0aGlzLmJ5dGVzKTsKICAgIGNvbnN0IGpwZWdJbWFnZSA9IG5ldyBKcGVnSW1hZ2UodGhpcy5qcGVnT3B0aW9ucyk7CiAgICBqcGVnSW1hZ2UucGFyc2UoYnl0ZXMpOwogICAgY29uc3QgZGF0YSA9IGpwZWdJbWFnZS5nZXREYXRhKHsKICAgICAgd2lkdGg6IHRoaXMuZHJhd1dpZHRoLAogICAgICBoZWlnaHQ6IHRoaXMuZHJhd0hlaWdodCwKICAgICAgZm9yY2VSR0JBOiB0aGlzLmZvcmNlUkdCQSwKICAgICAgZm9yY2VSR0I6IHRoaXMuZm9yY2VSR0IsCiAgICAgIGlzU291cmNlUERGOiB0cnVlCiAgICB9KTsKICAgIHRoaXMuYnVmZmVyID0gZGF0YTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICB0aGlzLmVvZiA9IHRydWU7CiAgICByZXR1cm4gdGhpcy5idWZmZXI7CiAgfQogIGdldCBjYW5Bc3luY0RlY29kZUltYWdlRnJvbUJ1ZmZlcigpIHsKICAgIHJldHVybiB0aGlzLnN0cmVhbS5pc0FzeW5jOwogIH0KICBhc3luYyBnZXRUcmFuc2ZlcmFibGVJbWFnZSgpIHsKICAgIGlmICghKGF3YWl0IEpwZWdTdHJlYW0uY2FuVXNlSW1hZ2VEZWNvZGVyKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGpwZWdPcHRpb25zID0gdGhpcy5qcGVnT3B0aW9uczsKICAgIGlmIChqcGVnT3B0aW9ucy5kZWNvZGVUcmFuc2Zvcm0pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgZGVjb2RlcjsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5jYW5Bc3luY0RlY29kZUltYWdlRnJvbUJ1ZmZlciAmJiAoYXdhaXQgdGhpcy5zdHJlYW0uYXN5bmNHZXRCeXRlcygpKSB8fCB0aGlzLmJ5dGVzOwogICAgICBpZiAoIWJ5dGVzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgbGV0IGRhdGEgPSB0aGlzLiNza2lwVXNlbGVzc0J5dGVzKGJ5dGVzKTsKICAgICAgY29uc3QgdXNlSW1hZ2VEZWNvZGVyID0gSnBlZ0ltYWdlLmNhblVzZUltYWdlRGVjb2RlcihkYXRhLCBqcGVnT3B0aW9ucy5jb2xvclRyYW5zZm9ybSk7CiAgICAgIGlmICghdXNlSW1hZ2VEZWNvZGVyKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHVzZUltYWdlRGVjb2Rlci5leGlmU3RhcnQpIHsKICAgICAgICBkYXRhID0gZGF0YS5zbGljZSgpOwogICAgICAgIGRhdGEuZmlsbCgweDAwLCB1c2VJbWFnZURlY29kZXIuZXhpZlN0YXJ0LCB1c2VJbWFnZURlY29kZXIuZXhpZkVuZCk7CiAgICAgIH0KICAgICAgZGVjb2RlciA9IG5ldyBJbWFnZURlY29kZXIoewogICAgICAgIGRhdGEsCiAgICAgICAgdHlwZTogImltYWdlL2pwZWciLAogICAgICAgIHByZWZlckFuaW1hdGlvbjogZmFsc2UKICAgICAgfSk7CiAgICAgIHJldHVybiAoYXdhaXQgZGVjb2Rlci5kZWNvZGUoKSkuaW1hZ2U7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgZ2V0VHJhbnNmZXJhYmxlSW1hZ2UgLSBmYWlsZWQ6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZmluYWxseSB7CiAgICAgIGRlY29kZXI/LmNsb3NlKCk7CiAgICB9CiAgfQp9Cgo7Ly8gLi9leHRlcm5hbC9vcGVuanBlZy9vcGVuanBlZy5qcwphc3luYyBmdW5jdGlvbiBPcGVuSlBFRyhtb2R1bGVBcmcgPSB7fSkgewogIHZhciBtb2R1bGVSdG47CiAgdmFyIE1vZHVsZSA9IG1vZHVsZUFyZzsKICB2YXIgRU5WSVJPTk1FTlRfSVNfV0VCID0gdHJ1ZTsKICB2YXIgRU5WSVJPTk1FTlRfSVNfV09SS0VSID0gZmFsc2U7CiAgdmFyIGFyZ3VtZW50c18gPSBbXTsKICB2YXIgdGhpc1Byb2dyYW0gPSAiLi90aGlzLnByb2dyYW0iOwogIHZhciBxdWl0XyA9IChzdGF0dXMsIHRvVGhyb3cpID0+IHsKICAgIHRocm93IHRvVGhyb3c7CiAgfTsKICB2YXIgX3NjcmlwdE5hbWUgPSBpbXBvcnQubWV0YS51cmw7CiAgdmFyIHNjcmlwdERpcmVjdG9yeSA9ICIiOwogIHZhciByZWFkQXN5bmMsIHJlYWRCaW5hcnk7CiAgaWYgKEVOVklST05NRU5UX0lTX1dFQiB8fCBFTlZJUk9OTUVOVF9JU19XT1JLRVIpIHsKICAgIHRyeSB7CiAgICAgIHNjcmlwdERpcmVjdG9yeSA9IG5ldyBVUkwoIi4iLCBfc2NyaXB0TmFtZSkuaHJlZjsKICAgIH0gY2F0Y2gge30KICAgIHJlYWRBc3luYyA9IGFzeW5jIHVybCA9PiB7CiAgICAgIHZhciByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgewogICAgICAgIGNyZWRlbnRpYWxzOiAic2FtZS1vcmlnaW4iCiAgICAgIH0pOwogICAgICBpZiAocmVzcG9uc2Uub2spIHsKICAgICAgICByZXR1cm4gcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzICsgIiA6ICIgKyByZXNwb25zZS51cmwpOwogICAgfTsKICB9IGVsc2Uge30KICB2YXIgb3V0ID0gY29uc29sZS5sb2cuYmluZChjb25zb2xlKTsKICB2YXIgZXJyID0gY29uc29sZS5lcnJvci5iaW5kKGNvbnNvbGUpOwogIHZhciB3YXNtQmluYXJ5OwogIHZhciBBQk9SVCA9IGZhbHNlOwogIHZhciBFWElUU1RBVFVTOwogIHZhciByZWFkeVByb21pc2VSZXNvbHZlLCByZWFkeVByb21pc2VSZWplY3Q7CiAgdmFyIHdhc21NZW1vcnk7CiAgdmFyIEhFQVA4LCBIRUFQVTgsIEhFQVAxNiwgSEVBUFUxNiwgSEVBUDMyLCBIRUFQVTMyLCBIRUFQRjMyLCBIRUFQRjY0OwogIHZhciBIRUFQNjQsIEhFQVBVNjQ7CiAgdmFyIHJ1bnRpbWVJbml0aWFsaXplZCA9IGZhbHNlOwogIGZ1bmN0aW9uIHVwZGF0ZU1lbW9yeVZpZXdzKCkgewogICAgdmFyIGIgPSB3YXNtTWVtb3J5LmJ1ZmZlcjsKICAgIEhFQVA4ID0gbmV3IEludDhBcnJheShiKTsKICAgIEhFQVAxNiA9IG5ldyBJbnQxNkFycmF5KGIpOwogICAgSEVBUFU4ID0gbmV3IFVpbnQ4QXJyYXkoYik7CiAgICBIRUFQVTE2ID0gbmV3IFVpbnQxNkFycmF5KGIpOwogICAgSEVBUDMyID0gbmV3IEludDMyQXJyYXkoYik7CiAgICBIRUFQVTMyID0gbmV3IFVpbnQzMkFycmF5KGIpOwogICAgSEVBUEYzMiA9IG5ldyBGbG9hdDMyQXJyYXkoYik7CiAgICBIRUFQRjY0ID0gbmV3IEZsb2F0NjRBcnJheShiKTsKICAgIEhFQVA2NCA9IG5ldyBCaWdJbnQ2NEFycmF5KGIpOwogICAgSEVBUFU2NCA9IG5ldyBCaWdVaW50NjRBcnJheShiKTsKICB9CiAgZnVuY3Rpb24gcHJlUnVuKCkgewogICAgaWYgKE1vZHVsZVsicHJlUnVuIl0pIHsKICAgICAgaWYgKHR5cGVvZiBNb2R1bGVbInByZVJ1biJdID09ICJmdW5jdGlvbiIpIE1vZHVsZVsicHJlUnVuIl0gPSBbTW9kdWxlWyJwcmVSdW4iXV07CiAgICAgIHdoaWxlIChNb2R1bGVbInByZVJ1biJdLmxlbmd0aCkgewogICAgICAgIGFkZE9uUHJlUnVuKE1vZHVsZVsicHJlUnVuIl0uc2hpZnQoKSk7CiAgICAgIH0KICAgIH0KICAgIGNhbGxSdW50aW1lQ2FsbGJhY2tzKG9uUHJlUnVucyk7CiAgfQogIGZ1bmN0aW9uIGluaXRSdW50aW1lKCkgewogICAgcnVudGltZUluaXRpYWxpemVkID0gdHJ1ZTsKICAgIHdhc21FeHBvcnRzWyJzIl0oKTsKICB9CiAgZnVuY3Rpb24gcG9zdFJ1bigpIHsKICAgIGlmIChNb2R1bGVbInBvc3RSdW4iXSkgewogICAgICBpZiAodHlwZW9mIE1vZHVsZVsicG9zdFJ1biJdID09ICJmdW5jdGlvbiIpIE1vZHVsZVsicG9zdFJ1biJdID0gW01vZHVsZVsicG9zdFJ1biJdXTsKICAgICAgd2hpbGUgKE1vZHVsZVsicG9zdFJ1biJdLmxlbmd0aCkgewogICAgICAgIGFkZE9uUG9zdFJ1bihNb2R1bGVbInBvc3RSdW4iXS5zaGlmdCgpKTsKICAgICAgfQogICAgfQogICAgY2FsbFJ1bnRpbWVDYWxsYmFja3Mob25Qb3N0UnVucyk7CiAgfQogIGZ1bmN0aW9uIGFib3J0KHdoYXQpIHsKICAgIE1vZHVsZVsib25BYm9ydCJdPy4od2hhdCk7CiAgICB3aGF0ID0gIkFib3J0ZWQoIiArIHdoYXQgKyAiKSI7CiAgICBlcnIod2hhdCk7CiAgICBBQk9SVCA9IHRydWU7CiAgICB3aGF0ICs9ICIuIEJ1aWxkIHdpdGggLXNBU1NFUlRJT05TIGZvciBtb3JlIGluZm8uIjsKICAgIHZhciBlID0gbmV3IFdlYkFzc2VtYmx5LlJ1bnRpbWVFcnJvcih3aGF0KTsKICAgIHJlYWR5UHJvbWlzZVJlamVjdD8uKGUpOwogICAgdGhyb3cgZTsKICB9CiAgdmFyIHdhc21CaW5hcnlGaWxlOwogIGZ1bmN0aW9uIGdldFdhc21JbXBvcnRzKCkgewogICAgcmV0dXJuIHsKICAgICAgYTogd2FzbUltcG9ydHMKICAgIH07CiAgfQogIGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVdhc20oKSB7CiAgICBmdW5jdGlvbiByZWNlaXZlSW5zdGFuY2UoaW5zdGFuY2UsIG1vZHVsZSkgewogICAgICB3YXNtRXhwb3J0cyA9IGluc3RhbmNlLmV4cG9ydHM7CiAgICAgIHdhc21NZW1vcnkgPSB3YXNtRXhwb3J0c1siciJdOwogICAgICB1cGRhdGVNZW1vcnlWaWV3cygpOwogICAgICBhc3NpZ25XYXNtRXhwb3J0cyh3YXNtRXhwb3J0cyk7CiAgICAgIHJldHVybiB3YXNtRXhwb3J0czsKICAgIH0KICAgIHZhciBpbmZvID0gZ2V0V2FzbUltcG9ydHMoKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIE1vZHVsZVsiaW5zdGFudGlhdGVXYXNtIl0oaW5mbywgKG1vZCwgaW5zdCkgPT4gewogICAgICAgIHJlc29sdmUocmVjZWl2ZUluc3RhbmNlKG1vZCwgaW5zdCkpOwogICAgICB9KTsKICAgIH0pOwogIH0KICBjbGFzcyBFeGl0U3RhdHVzIHsKICAgIG5hbWUgPSAiRXhpdFN0YXR1cyI7CiAgICBjb25zdHJ1Y3RvcihzdGF0dXMpIHsKICAgICAgdGhpcy5tZXNzYWdlID0gYFByb2dyYW0gdGVybWluYXRlZCB3aXRoIGV4aXQoJHtzdGF0dXN9KWA7CiAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzOwogICAgfQogIH0KICB2YXIgY2FsbFJ1bnRpbWVDYWxsYmFja3MgPSBjYWxsYmFja3MgPT4gewogICAgd2hpbGUgKGNhbGxiYWNrcy5sZW5ndGggPiAwKSB7CiAgICAgIGNhbGxiYWNrcy5zaGlmdCgpKE1vZHVsZSk7CiAgICB9CiAgfTsKICB2YXIgb25Qb3N0UnVucyA9IFtdOwogIHZhciBhZGRPblBvc3RSdW4gPSBjYiA9PiBvblBvc3RSdW5zLnB1c2goY2IpOwogIHZhciBvblByZVJ1bnMgPSBbXTsKICB2YXIgYWRkT25QcmVSdW4gPSBjYiA9PiBvblByZVJ1bnMucHVzaChjYik7CiAgdmFyIG5vRXhpdFJ1bnRpbWUgPSB0cnVlOwogIHZhciBfX2Fib3J0X2pzID0gKCkgPT4gYWJvcnQoIiIpOwogIHZhciBydW50aW1lS2VlcGFsaXZlQ291bnRlciA9IDA7CiAgdmFyIF9fZW1zY3JpcHRlbl9ydW50aW1lX2tlZXBhbGl2ZV9jbGVhciA9ICgpID0+IHsKICAgIG5vRXhpdFJ1bnRpbWUgPSBmYWxzZTsKICAgIHJ1bnRpbWVLZWVwYWxpdmVDb3VudGVyID0gMDsKICB9OwogIHZhciB0aW1lcnMgPSB7fTsKICB2YXIgaGFuZGxlRXhjZXB0aW9uID0gZSA9PiB7CiAgICBpZiAoZSBpbnN0YW5jZW9mIEV4aXRTdGF0dXMgfHwgZSA9PSAidW53aW5kIikgewogICAgICByZXR1cm4gRVhJVFNUQVRVUzsKICAgIH0KICAgIHF1aXRfKDEsIGUpOwogIH07CiAgdmFyIGtlZXBSdW50aW1lQWxpdmUgPSAoKSA9PiBub0V4aXRSdW50aW1lIHx8IHJ1bnRpbWVLZWVwYWxpdmVDb3VudGVyID4gMDsKICB2YXIgX3Byb2NfZXhpdCA9IGNvZGUgPT4gewogICAgRVhJVFNUQVRVUyA9IGNvZGU7CiAgICBpZiAoIWtlZXBSdW50aW1lQWxpdmUoKSkgewogICAgICBNb2R1bGVbIm9uRXhpdCJdPy4oY29kZSk7CiAgICAgIEFCT1JUID0gdHJ1ZTsKICAgIH0KICAgIHF1aXRfKGNvZGUsIG5ldyBFeGl0U3RhdHVzKGNvZGUpKTsKICB9OwogIHZhciBleGl0SlMgPSAoc3RhdHVzLCBpbXBsaWNpdCkgPT4gewogICAgRVhJVFNUQVRVUyA9IHN0YXR1czsKICAgIF9wcm9jX2V4aXQoc3RhdHVzKTsKICB9OwogIHZhciBfZXhpdCA9IGV4aXRKUzsKICB2YXIgbWF5YmVFeGl0ID0gKCkgPT4gewogICAgaWYgKCFrZWVwUnVudGltZUFsaXZlKCkpIHsKICAgICAgdHJ5IHsKICAgICAgICBfZXhpdChFWElUU1RBVFVTKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGhhbmRsZUV4Y2VwdGlvbihlKTsKICAgICAgfQogICAgfQogIH07CiAgdmFyIGNhbGxVc2VyQ2FsbGJhY2sgPSBmdW5jID0+IHsKICAgIGlmIChBQk9SVCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICBmdW5jKCk7CiAgICAgIG1heWJlRXhpdCgpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVFeGNlcHRpb24oZSk7CiAgICB9CiAgfTsKICB2YXIgX2Vtc2NyaXB0ZW5fZ2V0X25vdyA9ICgpID0+IHBlcmZvcm1hbmNlLm5vdygpOwogIHZhciBfX3NldGl0aW1lcl9qcyA9ICh3aGljaCwgdGltZW91dF9tcykgPT4gewogICAgaWYgKHRpbWVyc1t3aGljaF0pIHsKICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyc1t3aGljaF0uaWQpOwogICAgICBkZWxldGUgdGltZXJzW3doaWNoXTsKICAgIH0KICAgIGlmICghdGltZW91dF9tcykgcmV0dXJuIDA7CiAgICB2YXIgaWQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgZGVsZXRlIHRpbWVyc1t3aGljaF07CiAgICAgIGNhbGxVc2VyQ2FsbGJhY2soKCkgPT4gX19lbXNjcmlwdGVuX3RpbWVvdXQod2hpY2gsIF9lbXNjcmlwdGVuX2dldF9ub3coKSkpOwogICAgfSwgdGltZW91dF9tcyk7CiAgICB0aW1lcnNbd2hpY2hdID0gewogICAgICBpZCwKICAgICAgdGltZW91dF9tcwogICAgfTsKICAgIHJldHVybiAwOwogIH07CiAgZnVuY3Rpb24gX2NvcHlfcGl4ZWxzXzEoY29tcEdfcHRyLCBuYl9waXhlbHMpIHsKICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgIGNvbnN0IGltYWdlRGF0YSA9IE1vZHVsZS5pbWFnZURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobmJfcGl4ZWxzKTsKICAgIGNvbnN0IGNvbXBHID0gSEVBUDMyLnN1YmFycmF5KGNvbXBHX3B0ciwgY29tcEdfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGltYWdlRGF0YS5zZXQoY29tcEcpOwogIH0KICBmdW5jdGlvbiBfY29weV9waXhlbHNfMyhjb21wUl9wdHIsIGNvbXBHX3B0ciwgY29tcEJfcHRyLCBuYl9waXhlbHMpIHsKICAgIGNvbXBSX3B0ciA+Pj0gMjsKICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgIGNvbXBCX3B0ciA+Pj0gMjsKICAgIGNvbnN0IGltYWdlRGF0YSA9IE1vZHVsZS5pbWFnZURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobmJfcGl4ZWxzICogMyk7CiAgICBjb25zdCBjb21wUiA9IEhFQVAzMi5zdWJhcnJheShjb21wUl9wdHIsIGNvbXBSX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wQiA9IEhFQVAzMi5zdWJhcnJheShjb21wQl9wdHIsIGNvbXBCX3B0ciArIG5iX3BpeGVscyk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5iX3BpeGVsczsgaSsrKSB7CiAgICAgIGltYWdlRGF0YVszICogaV0gPSBjb21wUltpXTsKICAgICAgaW1hZ2VEYXRhWzMgKiBpICsgMV0gPSBjb21wR1tpXTsKICAgICAgaW1hZ2VEYXRhWzMgKiBpICsgMl0gPSBjb21wQltpXTsKICAgIH0KICB9CiAgZnVuY3Rpb24gX2NvcHlfcGl4ZWxzXzQoY29tcFJfcHRyLCBjb21wR19wdHIsIGNvbXBCX3B0ciwgY29tcEFfcHRyLCBuYl9waXhlbHMpIHsKICAgIGNvbXBSX3B0ciA+Pj0gMjsKICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgIGNvbXBCX3B0ciA+Pj0gMjsKICAgIGNvbXBBX3B0ciA+Pj0gMjsKICAgIGNvbnN0IGltYWdlRGF0YSA9IE1vZHVsZS5pbWFnZURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobmJfcGl4ZWxzICogNCk7CiAgICBjb25zdCBjb21wUiA9IEhFQVAzMi5zdWJhcnJheShjb21wUl9wdHIsIGNvbXBSX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wQiA9IEhFQVAzMi5zdWJhcnJheShjb21wQl9wdHIsIGNvbXBCX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wQSA9IEhFQVAzMi5zdWJhcnJheShjb21wQV9wdHIsIGNvbXBBX3B0ciArIG5iX3BpeGVscyk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5iX3BpeGVsczsgaSsrKSB7CiAgICAgIGltYWdlRGF0YVs0ICogaV0gPSBjb21wUltpXTsKICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgMV0gPSBjb21wR1tpXTsKICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgMl0gPSBjb21wQltpXTsKICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgM10gPSBjb21wQVtpXTsKICAgIH0KICB9CiAgdmFyIGdldEhlYXBNYXggPSAoKSA9PiAyMTQ3NDgzNjQ4OwogIHZhciBhbGlnbk1lbW9yeSA9IChzaXplLCBhbGlnbm1lbnQpID0+IE1hdGguY2VpbChzaXplIC8gYWxpZ25tZW50KSAqIGFsaWdubWVudDsKICB2YXIgZ3Jvd01lbW9yeSA9IHNpemUgPT4gewogICAgdmFyIG9sZEhlYXBTaXplID0gd2FzbU1lbW9yeS5idWZmZXIuYnl0ZUxlbmd0aDsKICAgIHZhciBwYWdlcyA9IChzaXplIC0gb2xkSGVhcFNpemUgKyA2NTUzNSkgLyA2NTUzNiB8IDA7CiAgICB0cnkgewogICAgICB3YXNtTWVtb3J5Lmdyb3cocGFnZXMpOwogICAgICB1cGRhdGVNZW1vcnlWaWV3cygpOwogICAgICByZXR1cm4gMTsKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfTsKICB2YXIgX2Vtc2NyaXB0ZW5fcmVzaXplX2hlYXAgPSByZXF1ZXN0ZWRTaXplID0+IHsKICAgIHZhciBvbGRTaXplID0gSEVBUFU4Lmxlbmd0aDsKICAgIHJlcXVlc3RlZFNpemUgPj4+PSAwOwogICAgdmFyIG1heEhlYXBTaXplID0gZ2V0SGVhcE1heCgpOwogICAgaWYgKHJlcXVlc3RlZFNpemUgPiBtYXhIZWFwU2l6ZSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBmb3IgKHZhciBjdXREb3duID0gMTsgY3V0RG93biA8PSA0OyBjdXREb3duICo9IDIpIHsKICAgICAgdmFyIG92ZXJHcm93bkhlYXBTaXplID0gb2xkU2l6ZSAqICgxICsgLjIgLyBjdXREb3duKTsKICAgICAgb3Zlckdyb3duSGVhcFNpemUgPSBNYXRoLm1pbihvdmVyR3Jvd25IZWFwU2l6ZSwgcmVxdWVzdGVkU2l6ZSArIDEwMDY2MzI5Nik7CiAgICAgIHZhciBuZXdTaXplID0gTWF0aC5taW4obWF4SGVhcFNpemUsIGFsaWduTWVtb3J5KE1hdGgubWF4KHJlcXVlc3RlZFNpemUsIG92ZXJHcm93bkhlYXBTaXplKSwgNjU1MzYpKTsKICAgICAgdmFyIHJlcGxhY2VtZW50ID0gZ3Jvd01lbW9yeShuZXdTaXplKTsKICAgICAgaWYgKHJlcGxhY2VtZW50KSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9OwogIHZhciBFTlYgPSB7fTsKICB2YXIgZ2V0RXhlY3V0YWJsZU5hbWUgPSAoKSA9PiB0aGlzUHJvZ3JhbSB8fCAiLi90aGlzLnByb2dyYW0iOwogIHZhciBnZXRFbnZTdHJpbmdzID0gKCkgPT4gewogICAgaWYgKCFnZXRFbnZTdHJpbmdzLnN0cmluZ3MpIHsKICAgICAgdmFyIGxhbmcgPSAodHlwZW9mIG5hdmlnYXRvciA9PSAib2JqZWN0IiAmJiBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgIkMiKS5yZXBsYWNlKCItIiwgIl8iKSArICIuVVRGLTgiOwogICAgICB2YXIgZW52ID0gewogICAgICAgIFVTRVI6ICJ3ZWJfdXNlciIsCiAgICAgICAgTE9HTkFNRTogIndlYl91c2VyIiwKICAgICAgICBQQVRIOiAiLyIsCiAgICAgICAgUFdEOiAiLyIsCiAgICAgICAgSE9NRTogIi9ob21lL3dlYl91c2VyIiwKICAgICAgICBMQU5HOiBsYW5nLAogICAgICAgIF86IGdldEV4ZWN1dGFibGVOYW1lKCkKICAgICAgfTsKICAgICAgZm9yICh2YXIgeCBpbiBFTlYpIHsKICAgICAgICBpZiAoRU5WW3hdID09PSB1bmRlZmluZWQpIGRlbGV0ZSBlbnZbeF07ZWxzZSBlbnZbeF0gPSBFTlZbeF07CiAgICAgIH0KICAgICAgdmFyIHN0cmluZ3MgPSBbXTsKICAgICAgZm9yICh2YXIgeCBpbiBlbnYpIHsKICAgICAgICBzdHJpbmdzLnB1c2goYCR7eH09JHtlbnZbeF19YCk7CiAgICAgIH0KICAgICAgZ2V0RW52U3RyaW5ncy5zdHJpbmdzID0gc3RyaW5nczsKICAgIH0KICAgIHJldHVybiBnZXRFbnZTdHJpbmdzLnN0cmluZ3M7CiAgfTsKICB2YXIgc3RyaW5nVG9VVEY4QXJyYXkgPSAoc3RyLCBoZWFwLCBvdXRJZHgsIG1heEJ5dGVzVG9Xcml0ZSkgPT4gewogICAgaWYgKCEobWF4Qnl0ZXNUb1dyaXRlID4gMCkpIHJldHVybiAwOwogICAgdmFyIHN0YXJ0SWR4ID0gb3V0SWR4OwogICAgdmFyIGVuZElkeCA9IG91dElkeCArIG1heEJ5dGVzVG9Xcml0ZSAtIDE7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkgewogICAgICB2YXIgdSA9IHN0ci5jb2RlUG9pbnRBdChpKTsKICAgICAgaWYgKHUgPD0gMTI3KSB7CiAgICAgICAgaWYgKG91dElkeCA+PSBlbmRJZHgpIGJyZWFrOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gdTsKICAgICAgfSBlbHNlIGlmICh1IDw9IDIwNDcpIHsKICAgICAgICBpZiAob3V0SWR4ICsgMSA+PSBlbmRJZHgpIGJyZWFrOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTkyIHwgdSA+PiA2OwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSAmIDYzOwogICAgICB9IGVsc2UgaWYgKHUgPD0gNjU1MzUpIHsKICAgICAgICBpZiAob3V0SWR4ICsgMiA+PSBlbmRJZHgpIGJyZWFrOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMjI0IHwgdSA+PiAxMjsKICAgICAgICBoZWFwW291dElkeCsrXSA9IDEyOCB8IHUgPj4gNiAmIDYzOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSAmIDYzOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChvdXRJZHggKyAzID49IGVuZElkeCkgYnJlYWs7CiAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAyNDAgfCB1ID4+IDE4OwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSA+PiAxMiAmIDYzOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSA+PiA2ICYgNjM7CiAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAxMjggfCB1ICYgNjM7CiAgICAgICAgaSsrOwogICAgICB9CiAgICB9CiAgICBoZWFwW291dElkeF0gPSAwOwogICAgcmV0dXJuIG91dElkeCAtIHN0YXJ0SWR4OwogIH07CiAgdmFyIHN0cmluZ1RvVVRGOCA9IChzdHIsIG91dFB0ciwgbWF4Qnl0ZXNUb1dyaXRlKSA9PiBzdHJpbmdUb1VURjhBcnJheShzdHIsIEhFQVBVOCwgb3V0UHRyLCBtYXhCeXRlc1RvV3JpdGUpOwogIHZhciBfZW52aXJvbl9nZXQgPSAoX19lbnZpcm9uLCBlbnZpcm9uX2J1ZikgPT4gewogICAgdmFyIGJ1ZlNpemUgPSAwOwogICAgdmFyIGVudnAgPSAwOwogICAgZm9yICh2YXIgc3RyaW5nIG9mIGdldEVudlN0cmluZ3MoKSkgewogICAgICB2YXIgcHRyID0gZW52aXJvbl9idWYgKyBidWZTaXplOwogICAgICBIRUFQVTMyW19fZW52aXJvbiArIGVudnAgPj4gMl0gPSBwdHI7CiAgICAgIGJ1ZlNpemUgKz0gc3RyaW5nVG9VVEY4KHN0cmluZywgcHRyLCBJbmZpbml0eSkgKyAxOwogICAgICBlbnZwICs9IDQ7CiAgICB9CiAgICByZXR1cm4gMDsKICB9OwogIHZhciBsZW5ndGhCeXRlc1VURjggPSBzdHIgPT4gewogICAgdmFyIGxlbiA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkgewogICAgICB2YXIgYyA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgICBpZiAoYyA8PSAxMjcpIHsKICAgICAgICBsZW4rKzsKICAgICAgfSBlbHNlIGlmIChjIDw9IDIwNDcpIHsKICAgICAgICBsZW4gKz0gMjsKICAgICAgfSBlbHNlIGlmIChjID49IDU1Mjk2ICYmIGMgPD0gNTczNDMpIHsKICAgICAgICBsZW4gKz0gNDsKICAgICAgICArK2k7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGVuICs9IDM7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBsZW47CiAgfTsKICB2YXIgX2Vudmlyb25fc2l6ZXNfZ2V0ID0gKHBlbnZpcm9uX2NvdW50LCBwZW52aXJvbl9idWZfc2l6ZSkgPT4gewogICAgdmFyIHN0cmluZ3MgPSBnZXRFbnZTdHJpbmdzKCk7CiAgICBIRUFQVTMyW3BlbnZpcm9uX2NvdW50ID4+IDJdID0gc3RyaW5ncy5sZW5ndGg7CiAgICB2YXIgYnVmU2l6ZSA9IDA7CiAgICBmb3IgKHZhciBzdHJpbmcgb2Ygc3RyaW5ncykgewogICAgICBidWZTaXplICs9IGxlbmd0aEJ5dGVzVVRGOChzdHJpbmcpICsgMTsKICAgIH0KICAgIEhFQVBVMzJbcGVudmlyb25fYnVmX3NpemUgPj4gMl0gPSBidWZTaXplOwogICAgcmV0dXJuIDA7CiAgfTsKICB2YXIgSU5UNTNfTUFYID0gOTAwNzE5OTI1NDc0MDk5MjsKICB2YXIgSU5UNTNfTUlOID0gLTkwMDcxOTkyNTQ3NDA5OTI7CiAgdmFyIGJpZ2ludFRvSTUzQ2hlY2tlZCA9IG51bSA9PiBudW0gPCBJTlQ1M19NSU4gfHwgbnVtID4gSU5UNTNfTUFYID8gTmFOIDogTnVtYmVyKG51bSk7CiAgZnVuY3Rpb24gX2ZkX3NlZWsoZmQsIG9mZnNldCwgd2hlbmNlLCBuZXdPZmZzZXQpIHsKICAgIG9mZnNldCA9IGJpZ2ludFRvSTUzQ2hlY2tlZChvZmZzZXQpOwogICAgcmV0dXJuIDcwOwogIH0KICB2YXIgcHJpbnRDaGFyQnVmZmVycyA9IFtudWxsLCBbXSwgW11dOwogIHZhciBVVEY4RGVjb2RlciA9IHR5cGVvZiBUZXh0RGVjb2RlciAhPSAidW5kZWZpbmVkIiA/IG5ldyBUZXh0RGVjb2RlcigpIDogdW5kZWZpbmVkOwogIHZhciBmaW5kU3RyaW5nRW5kID0gKGhlYXBPckFycmF5LCBpZHgsIG1heEJ5dGVzVG9SZWFkLCBpZ25vcmVOdWwpID0+IHsKICAgIHZhciBtYXhJZHggPSBpZHggKyBtYXhCeXRlc1RvUmVhZDsKICAgIGlmIChpZ25vcmVOdWwpIHJldHVybiBtYXhJZHg7CiAgICB3aGlsZSAoaGVhcE9yQXJyYXlbaWR4XSAmJiAhKGlkeCA+PSBtYXhJZHgpKSArK2lkeDsKICAgIHJldHVybiBpZHg7CiAgfTsKICB2YXIgVVRGOEFycmF5VG9TdHJpbmcgPSAoaGVhcE9yQXJyYXksIGlkeCA9IDAsIG1heEJ5dGVzVG9SZWFkLCBpZ25vcmVOdWwpID0+IHsKICAgIHZhciBlbmRQdHIgPSBmaW5kU3RyaW5nRW5kKGhlYXBPckFycmF5LCBpZHgsIG1heEJ5dGVzVG9SZWFkLCBpZ25vcmVOdWwpOwogICAgaWYgKGVuZFB0ciAtIGlkeCA+IDE2ICYmIGhlYXBPckFycmF5LmJ1ZmZlciAmJiBVVEY4RGVjb2RlcikgewogICAgICByZXR1cm4gVVRGOERlY29kZXIuZGVjb2RlKGhlYXBPckFycmF5LnN1YmFycmF5KGlkeCwgZW5kUHRyKSk7CiAgICB9CiAgICB2YXIgc3RyID0gIiI7CiAgICB3aGlsZSAoaWR4IDwgZW5kUHRyKSB7CiAgICAgIHZhciB1MCA9IGhlYXBPckFycmF5W2lkeCsrXTsKICAgICAgaWYgKCEodTAgJiAxMjgpKSB7CiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodTApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHZhciB1MSA9IGhlYXBPckFycmF5W2lkeCsrXSAmIDYzOwogICAgICBpZiAoKHUwICYgMjI0KSA9PSAxOTIpIHsKICAgICAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgodTAgJiAzMSkgPDwgNiB8IHUxKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB2YXIgdTIgPSBoZWFwT3JBcnJheVtpZHgrK10gJiA2MzsKICAgICAgaWYgKCh1MCAmIDI0MCkgPT0gMjI0KSB7CiAgICAgICAgdTAgPSAodTAgJiAxNSkgPDwgMTIgfCB1MSA8PCA2IHwgdTI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdTAgPSAodTAgJiA3KSA8PCAxOCB8IHUxIDw8IDEyIHwgdTIgPDwgNiB8IGhlYXBPckFycmF5W2lkeCsrXSAmIDYzOwogICAgICB9CiAgICAgIGlmICh1MCA8IDY1NTM2KSB7CiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodTApOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBjaCA9IHUwIC0gNjU1MzY7CiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTYgfCBjaCA+PiAxMCwgNTYzMjAgfCBjaCAmIDEwMjMpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RyOwogIH07CiAgdmFyIHByaW50Q2hhciA9IChzdHJlYW0sIGN1cnIpID0+IHsKICAgIHZhciBidWZmZXIgPSBwcmludENoYXJCdWZmZXJzW3N0cmVhbV07CiAgICBpZiAoY3VyciA9PT0gMCB8fCBjdXJyID09PSAxMCkgewogICAgICAoc3RyZWFtID09PSAxID8gb3V0IDogZXJyKShVVEY4QXJyYXlUb1N0cmluZyhidWZmZXIpKTsKICAgICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgICB9IGVsc2UgewogICAgICBidWZmZXIucHVzaChjdXJyKTsKICAgIH0KICB9OwogIHZhciBVVEY4VG9TdHJpbmcgPSAocHRyLCBtYXhCeXRlc1RvUmVhZCwgaWdub3JlTnVsKSA9PiBwdHIgPyBVVEY4QXJyYXlUb1N0cmluZyhIRUFQVTgsIHB0ciwgbWF4Qnl0ZXNUb1JlYWQsIGlnbm9yZU51bCkgOiAiIjsKICB2YXIgX2ZkX3dyaXRlID0gKGZkLCBpb3YsIGlvdmNudCwgcG51bSkgPT4gewogICAgdmFyIG51bSA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlvdmNudDsgaSsrKSB7CiAgICAgIHZhciBwdHIgPSBIRUFQVTMyW2lvdiA+PiAyXTsKICAgICAgdmFyIGxlbiA9IEhFQVBVMzJbaW92ICsgNCA+PiAyXTsKICAgICAgaW92ICs9IDg7CiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICBwcmludENoYXIoZmQsIEhFQVBVOFtwdHIgKyBqXSk7CiAgICAgIH0KICAgICAgbnVtICs9IGxlbjsKICAgIH0KICAgIEhFQVBVMzJbcG51bSA+PiAyXSA9IG51bTsKICAgIHJldHVybiAwOwogIH07CiAgZnVuY3Rpb24gX2dyYXlfdG9fcmdiYShjb21wR19wdHIsIG5iX3BpeGVscykgewogICAgY29tcEdfcHRyID4+PSAyOwogICAgY29uc3QgaW1hZ2VEYXRhID0gTW9kdWxlLmltYWdlRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShuYl9waXhlbHMgKiA0KTsKICAgIGNvbnN0IGNvbXBHID0gSEVBUDMyLnN1YmFycmF5KGNvbXBHX3B0ciwgY29tcEdfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmJfcGl4ZWxzOyBpKyspIHsKICAgICAgaW1hZ2VEYXRhWzQgKiBpXSA9IGltYWdlRGF0YVs0ICogaSArIDFdID0gaW1hZ2VEYXRhWzQgKiBpICsgMl0gPSBjb21wR1tpXTsKICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgM10gPSAyNTU7CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9ncmF5YV90b19yZ2JhKGNvbXBHX3B0ciwgY29tcEFfcHRyLCBuYl9waXhlbHMpIHsKICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgIGNvbXBBX3B0ciA+Pj0gMjsKICAgIGNvbnN0IGltYWdlRGF0YSA9IE1vZHVsZS5pbWFnZURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobmJfcGl4ZWxzICogNCk7CiAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wQSA9IEhFQVAzMi5zdWJhcnJheShjb21wQV9wdHIsIGNvbXBBX3B0ciArIG5iX3BpeGVscyk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5iX3BpeGVsczsgaSsrKSB7CiAgICAgIGltYWdlRGF0YVs0ICogaV0gPSBpbWFnZURhdGFbNCAqIGkgKyAxXSA9IGltYWdlRGF0YVs0ICogaSArIDJdID0gY29tcEdbaV07CiAgICAgIGltYWdlRGF0YVs0ICogaSArIDNdID0gY29tcEFbaV07CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9qc1ByaW50V2FybmluZyhtZXNzYWdlX3B0cikgewogICAgY29uc3QgbWVzc2FnZSA9IFVURjhUb1N0cmluZyhtZXNzYWdlX3B0cik7CiAgICAoTW9kdWxlLndhcm4gfHwgY29uc29sZS53YXJuKShgT3BlbkpQRUc6ICR7bWVzc2FnZX1gKTsKICB9CiAgZnVuY3Rpb24gX3JnYl90b19yZ2JhKGNvbXBSX3B0ciwgY29tcEdfcHRyLCBjb21wQl9wdHIsIG5iX3BpeGVscykgewogICAgY29tcFJfcHRyID4+PSAyOwogICAgY29tcEdfcHRyID4+PSAyOwogICAgY29tcEJfcHRyID4+PSAyOwogICAgY29uc3QgaW1hZ2VEYXRhID0gTW9kdWxlLmltYWdlRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShuYl9waXhlbHMgKiA0KTsKICAgIGNvbnN0IGNvbXBSID0gSEVBUDMyLnN1YmFycmF5KGNvbXBSX3B0ciwgY29tcFJfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGNvbnN0IGNvbXBHID0gSEVBUDMyLnN1YmFycmF5KGNvbXBHX3B0ciwgY29tcEdfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGNvbnN0IGNvbXBCID0gSEVBUDMyLnN1YmFycmF5KGNvbXBCX3B0ciwgY29tcEJfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmJfcGl4ZWxzOyBpKyspIHsKICAgICAgaW1hZ2VEYXRhWzQgKiBpXSA9IGNvbXBSW2ldOwogICAgICBpbWFnZURhdGFbNCAqIGkgKyAxXSA9IGNvbXBHW2ldOwogICAgICBpbWFnZURhdGFbNCAqIGkgKyAyXSA9IGNvbXBCW2ldOwogICAgICBpbWFnZURhdGFbNCAqIGkgKyAzXSA9IDI1NTsKICAgIH0KICB9CiAgZnVuY3Rpb24gX3N0b3JlRXJyb3JNZXNzYWdlKG1lc3NhZ2VfcHRyKSB7CiAgICBjb25zdCBtZXNzYWdlID0gVVRGOFRvU3RyaW5nKG1lc3NhZ2VfcHRyKTsKICAgIGlmICghTW9kdWxlLmVycm9yTWVzc2FnZXMpIHsKICAgICAgTW9kdWxlLmVycm9yTWVzc2FnZXMgPSBtZXNzYWdlOwogICAgfSBlbHNlIHsKICAgICAgTW9kdWxlLmVycm9yTWVzc2FnZXMgKz0gIlxuIiArIG1lc3NhZ2U7CiAgICB9CiAgfQogIHZhciB3cml0ZUFycmF5VG9NZW1vcnkgPSAoYXJyYXksIGJ1ZmZlcikgPT4gewogICAgSEVBUDguc2V0KGFycmF5LCBidWZmZXIpOwogIH07CiAgaWYgKE1vZHVsZVsibm9FeGl0UnVudGltZSJdKSBub0V4aXRSdW50aW1lID0gTW9kdWxlWyJub0V4aXRSdW50aW1lIl07CiAgaWYgKE1vZHVsZVsicHJpbnQiXSkgb3V0ID0gTW9kdWxlWyJwcmludCJdOwogIGlmIChNb2R1bGVbInByaW50RXJyIl0pIGVyciA9IE1vZHVsZVsicHJpbnRFcnIiXTsKICBpZiAoTW9kdWxlWyJ3YXNtQmluYXJ5Il0pIHdhc21CaW5hcnkgPSBNb2R1bGVbIndhc21CaW5hcnkiXTsKICBpZiAoTW9kdWxlWyJhcmd1bWVudHMiXSkgYXJndW1lbnRzXyA9IE1vZHVsZVsiYXJndW1lbnRzIl07CiAgaWYgKE1vZHVsZVsidGhpc1Byb2dyYW0iXSkgdGhpc1Byb2dyYW0gPSBNb2R1bGVbInRoaXNQcm9ncmFtIl07CiAgaWYgKE1vZHVsZVsicHJlSW5pdCJdKSB7CiAgICBpZiAodHlwZW9mIE1vZHVsZVsicHJlSW5pdCJdID09ICJmdW5jdGlvbiIpIE1vZHVsZVsicHJlSW5pdCJdID0gW01vZHVsZVsicHJlSW5pdCJdXTsKICAgIHdoaWxlIChNb2R1bGVbInByZUluaXQiXS5sZW5ndGggPiAwKSB7CiAgICAgIE1vZHVsZVsicHJlSW5pdCJdLnNoaWZ0KCkoKTsKICAgIH0KICB9CiAgTW9kdWxlWyJ3cml0ZUFycmF5VG9NZW1vcnkiXSA9IHdyaXRlQXJyYXlUb01lbW9yeTsKICB2YXIgX21hbGxvYywgX2ZyZWUsIF9qcDJfZGVjb2RlLCBfX2Vtc2NyaXB0ZW5fdGltZW91dDsKICBmdW5jdGlvbiBhc3NpZ25XYXNtRXhwb3J0cyh3YXNtRXhwb3J0cykgewogICAgTW9kdWxlWyJfbWFsbG9jIl0gPSBfbWFsbG9jID0gd2FzbUV4cG9ydHNbInQiXTsKICAgIE1vZHVsZVsiX2ZyZWUiXSA9IF9mcmVlID0gd2FzbUV4cG9ydHNbInUiXTsKICAgIE1vZHVsZVsiX2pwMl9kZWNvZGUiXSA9IF9qcDJfZGVjb2RlID0gd2FzbUV4cG9ydHNbInYiXTsKICAgIF9fZW1zY3JpcHRlbl90aW1lb3V0ID0gd2FzbUV4cG9ydHNbInciXTsKICB9CiAgdmFyIHdhc21JbXBvcnRzID0gewogICAgazogX19hYm9ydF9qcywKICAgIGo6IF9fZW1zY3JpcHRlbl9ydW50aW1lX2tlZXBhbGl2ZV9jbGVhciwKICAgIGw6IF9fc2V0aXRpbWVyX2pzLAogICAgZjogX2NvcHlfcGl4ZWxzXzEsCiAgICBlOiBfY29weV9waXhlbHNfMywKICAgIGQ6IF9jb3B5X3BpeGVsc180LAogICAgbTogX2Vtc2NyaXB0ZW5fcmVzaXplX2hlYXAsCiAgICBvOiBfZW52aXJvbl9nZXQsCiAgICBwOiBfZW52aXJvbl9zaXplc19nZXQsCiAgICBuOiBfZmRfc2VlaywKICAgIGI6IF9mZF93cml0ZSwKICAgIHE6IF9ncmF5X3RvX3JnYmEsCiAgICBoOiBfZ3JheWFfdG9fcmdiYSwKICAgIGM6IF9qc1ByaW50V2FybmluZywKICAgIGk6IF9wcm9jX2V4aXQsCiAgICBnOiBfcmdiX3RvX3JnYmEsCiAgICBhOiBfc3RvcmVFcnJvck1lc3NhZ2UKICB9OwogIGZ1bmN0aW9uIHJ1bigpIHsKICAgIHByZVJ1bigpOwogICAgZnVuY3Rpb24gZG9SdW4oKSB7CiAgICAgIE1vZHVsZVsiY2FsbGVkUnVuIl0gPSB0cnVlOwogICAgICBpZiAoQUJPUlQpIHJldHVybjsKICAgICAgaW5pdFJ1bnRpbWUoKTsKICAgICAgcmVhZHlQcm9taXNlUmVzb2x2ZT8uKE1vZHVsZSk7CiAgICAgIE1vZHVsZVsib25SdW50aW1lSW5pdGlhbGl6ZWQiXT8uKCk7CiAgICAgIHBvc3RSdW4oKTsKICAgIH0KICAgIGlmIChNb2R1bGVbInNldFN0YXR1cyJdKSB7CiAgICAgIE1vZHVsZVsic2V0U3RhdHVzIl0oIlJ1bm5pbmcuLi4iKTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBNb2R1bGVbInNldFN0YXR1cyJdKCIiKSwgMSk7CiAgICAgICAgZG9SdW4oKTsKICAgICAgfSwgMSk7CiAgICB9IGVsc2UgewogICAgICBkb1J1bigpOwogICAgfQogIH0KICB2YXIgd2FzbUV4cG9ydHM7CiAgd2FzbUV4cG9ydHMgPSBhd2FpdCBjcmVhdGVXYXNtKCk7CiAgcnVuKCk7CiAgaWYgKHJ1bnRpbWVJbml0aWFsaXplZCkgewogICAgbW9kdWxlUnRuID0gTW9kdWxlOwogIH0gZWxzZSB7CiAgICBtb2R1bGVSdG4gPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHJlYWR5UHJvbWlzZVJlc29sdmUgPSByZXNvbHZlOwogICAgICByZWFkeVByb21pc2VSZWplY3QgPSByZWplY3Q7CiAgICB9KTsKICB9CiAgcmV0dXJuIG1vZHVsZVJ0bjsKfQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGNvbnN0IG9wZW5qcGVnID0gKE9wZW5KUEVHKTsKOy8vIC4vc3JjL2NvcmUvanB4LmpzCgoKCgpjbGFzcyBKcHhFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSnB4RXJyb3IiKTsKICB9Cn0KY2xhc3MgSnB4SW1hZ2UgewogIHN0YXRpYyAjYnVmZmVyID0gbnVsbDsKICBzdGF0aWMgI2hhbmRsZXIgPSBudWxsOwogIHN0YXRpYyAjbW9kdWxlUHJvbWlzZSA9IG51bGw7CiAgc3RhdGljICN1c2VXYXNtID0gdHJ1ZTsKICBzdGF0aWMgI3VzZVdvcmtlckZldGNoID0gdHJ1ZTsKICBzdGF0aWMgI3dhc21VcmwgPSBudWxsOwogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIGhhbmRsZXIsCiAgICB1c2VXYXNtLAogICAgdXNlV29ya2VyRmV0Y2gsCiAgICB3YXNtVXJsCiAgfSkgewogICAgdGhpcy4jdXNlV2FzbSA9IHVzZVdhc207CiAgICB0aGlzLiN1c2VXb3JrZXJGZXRjaCA9IHVzZVdvcmtlckZldGNoOwogICAgdGhpcy4jd2FzbVVybCA9IHdhc21Vcmw7CiAgICBpZiAoIXVzZVdvcmtlckZldGNoKSB7CiAgICAgIHRoaXMuI2hhbmRsZXIgPSBoYW5kbGVyOwogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgI2dldEpzTW9kdWxlKGZhbGxiYWNrQ2FsbGJhY2spIHsKICAgIGNvbnN0IHBhdGggPSBgJHt0aGlzLiN3YXNtVXJsfW9wZW5qcGVnX25vd2FzbV9mYWxsYmFjay5qc2A7CiAgICBsZXQgaW5zdGFuY2UgPSBudWxsOwogICAgdHJ5IHsKICAgICAgY29uc3QgbW9kID0gYXdhaXQgaW1wb3J0KAogICAgICAvKndlYnBhY2tJZ25vcmU6IHRydWUqLwogICAgICAvKkB2aXRlLWlnbm9yZSovCiAgICAgIHBhdGgpOwogICAgICBpbnN0YW5jZSA9IG1vZC5kZWZhdWx0KCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHdhcm4oYEpweEltYWdlI2dldEpzTW9kdWxlOiAke2V9YCk7CiAgICB9CiAgICBmYWxsYmFja0NhbGxiYWNrKGluc3RhbmNlKTsKICB9CiAgc3RhdGljIGFzeW5jICNpbnN0YW50aWF0ZVdhc20oZmFsbGJhY2tDYWxsYmFjaywgaW1wb3J0cywgc3VjY2Vzc0NhbGxiYWNrKSB7CiAgICBjb25zdCBmaWxlbmFtZSA9ICJvcGVuanBlZy53YXNtIjsKICAgIHRyeSB7CiAgICAgIGlmICghdGhpcy4jYnVmZmVyKSB7CiAgICAgICAgaWYgKHRoaXMuI3VzZVdvcmtlckZldGNoKSB7CiAgICAgICAgICB0aGlzLiNidWZmZXIgPSBhd2FpdCBmZXRjaEJpbmFyeURhdGEoYCR7dGhpcy4jd2FzbVVybH0ke2ZpbGVuYW1lfWApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiNidWZmZXIgPSBhd2FpdCB0aGlzLiNoYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiRmV0Y2hCaW5hcnlEYXRhIiwgewogICAgICAgICAgICB0eXBlOiAid2FzbUZhY3RvcnkiLAogICAgICAgICAgICBmaWxlbmFtZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZSh0aGlzLiNidWZmZXIsIGltcG9ydHMpOwogICAgICByZXR1cm4gc3VjY2Vzc0NhbGxiYWNrKHJlc3VsdHMuaW5zdGFuY2UpOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIHdhcm4oYEpweEltYWdlI2luc3RhbnRpYXRlV2FzbTogJHtyZWFzb259YCk7CiAgICAgIHRoaXMuI2dldEpzTW9kdWxlKGZhbGxiYWNrQ2FsbGJhY2spOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZmluYWxseSB7CiAgICAgIHRoaXMuI2hhbmRsZXIgPSBudWxsOwogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgZGVjb2RlKGJ5dGVzLCB7CiAgICBudW1Db21wb25lbnRzID0gNCwKICAgIGlzSW5kZXhlZENvbG9ybWFwID0gZmFsc2UsCiAgICBzbWFza0luRGF0YSA9IGZhbHNlLAogICAgcmVkdWNlUG93ZXIgPSAwCiAgfSA9IHt9KSB7CiAgICBpZiAoIXRoaXMuI21vZHVsZVByb21pc2UpIHsKICAgICAgY29uc3QgewogICAgICAgIHByb21pc2UsCiAgICAgICAgcmVzb2x2ZQogICAgICB9ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgIGNvbnN0IHByb21pc2VzID0gW3Byb21pc2VdOwogICAgICBpZiAoIXRoaXMuI3VzZVdhc20pIHsKICAgICAgICB0aGlzLiNnZXRKc01vZHVsZShyZXNvbHZlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcm9taXNlcy5wdXNoKG9wZW5qcGVnKHsKICAgICAgICAgIHdhcm46IHdhcm4sCiAgICAgICAgICBpbnN0YW50aWF0ZVdhc206IHRoaXMuI2luc3RhbnRpYXRlV2FzbS5iaW5kKHRoaXMsIHJlc29sdmUpCiAgICAgICAgfSkpOwogICAgICB9CiAgICAgIHRoaXMuI21vZHVsZVByb21pc2UgPSBQcm9taXNlLnJhY2UocHJvbWlzZXMpOwogICAgfQogICAgY29uc3QgbW9kdWxlID0gYXdhaXQgdGhpcy4jbW9kdWxlUHJvbWlzZTsKICAgIGlmICghbW9kdWxlKSB7CiAgICAgIHRocm93IG5ldyBKcHhFcnJvcigiT3BlbkpQRUcgZmFpbGVkIHRvIGluaXRpYWxpemUiKTsKICAgIH0KICAgIGxldCBwdHI7CiAgICB0cnkgewogICAgICBjb25zdCBzaXplID0gYnl0ZXMubGVuZ3RoOwogICAgICBwdHIgPSBtb2R1bGUuX21hbGxvYyhzaXplKTsKICAgICAgbW9kdWxlLndyaXRlQXJyYXlUb01lbW9yeShieXRlcywgcHRyKTsKICAgICAgY29uc3QgcmV0ID0gbW9kdWxlLl9qcDJfZGVjb2RlKHB0ciwgc2l6ZSwgbnVtQ29tcG9uZW50cyA+IDAgPyBudW1Db21wb25lbnRzIDogMCwgISFpc0luZGV4ZWRDb2xvcm1hcCwgISFzbWFza0luRGF0YSwgcmVkdWNlUG93ZXIpOwogICAgICBpZiAocmV0KSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgZXJyb3JNZXNzYWdlcwogICAgICAgIH0gPSBtb2R1bGU7CiAgICAgICAgaWYgKGVycm9yTWVzc2FnZXMpIHsKICAgICAgICAgIGRlbGV0ZSBtb2R1bGUuZXJyb3JNZXNzYWdlczsKICAgICAgICAgIHRocm93IG5ldyBKcHhFcnJvcihlcnJvck1lc3NhZ2VzKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKCJVbmtub3duIGVycm9yIik7CiAgICAgIH0KICAgICAgY29uc3QgewogICAgICAgIGltYWdlRGF0YQogICAgICB9ID0gbW9kdWxlOwogICAgICBtb2R1bGUuaW1hZ2VEYXRhID0gbnVsbDsKICAgICAgcmV0dXJuIGltYWdlRGF0YTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmIChwdHIpIHsKICAgICAgICBtb2R1bGUuX2ZyZWUocHRyKTsKICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgY2xlYW51cCgpIHsKICAgIHRoaXMuI21vZHVsZVByb21pc2UgPSBudWxsOwogIH0KICBzdGF0aWMgcGFyc2VJbWFnZVByb3BlcnRpZXMoc3RyZWFtKSB7CiAgICBsZXQgbmV3Qnl0ZSA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICB3aGlsZSAobmV3Qnl0ZSA+PSAwKSB7CiAgICAgIGNvbnN0IG9sZEJ5dGUgPSBuZXdCeXRlOwogICAgICBuZXdCeXRlID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgY29uc3QgY29kZSA9IG9sZEJ5dGUgPDwgOCB8IG5ld0J5dGU7CiAgICAgIGlmIChjb2RlID09PSAweGZmNTEpIHsKICAgICAgICBzdHJlYW0uc2tpcCg0KTsKICAgICAgICBjb25zdCBYc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgY29uc3QgWXNpeiA9IHN0cmVhbS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgIGNvbnN0IFhPc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgY29uc3QgWU9zaXogPSBzdHJlYW0uZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICBzdHJlYW0uc2tpcCgxNik7CiAgICAgICAgY29uc3QgQ3NpeiA9IHN0cmVhbS5nZXRVaW50MTYoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgd2lkdGg6IFhzaXogLSBYT3NpeiwKICAgICAgICAgIGhlaWdodDogWXNpeiAtIFlPc2l6LAogICAgICAgICAgYml0c1BlckNvbXBvbmVudDogOCwKICAgICAgICAgIGNvbXBvbmVudHNDb3VudDogQ3NpegogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBKcHhFcnJvcigiTm8gc2l6ZSBtYXJrZXIgZm91bmQgaW4gSlBYIHN0cmVhbSIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvb3BlcmF0b3JfbGlzdC5qcwoKZnVuY3Rpb24gYWRkU3RhdGUocGFyZW50U3RhdGUsIHBhdHRlcm4sIGNoZWNrRm4sIGl0ZXJhdGVGbiwgcHJvY2Vzc0ZuKSB7CiAgbGV0IHN0YXRlID0gcGFyZW50U3RhdGU7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gcGF0dGVybi5sZW5ndGggLSAxOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgaXRlbSA9IHBhdHRlcm5baV07CiAgICBzdGF0ZSA9IHN0YXRlW2l0ZW1dIHx8PSBbXTsKICB9CiAgc3RhdGVbcGF0dGVybi5hdCgtMSldID0gewogICAgY2hlY2tGbiwKICAgIGl0ZXJhdGVGbiwKICAgIHByb2Nlc3NGbgogIH07Cn0KY29uc3QgSW5pdGlhbFN0YXRlID0gW107CmFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW09QUy5zYXZlLCBPUFMudHJhbnNmb3JtLCBPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3QsIE9QUy5yZXN0b3JlXSwgbnVsbCwgZnVuY3Rpb24gaXRlcmF0ZUlubGluZUltYWdlR3JvdXAoY29udGV4dCwgaSkgewogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXk7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGNvbnRleHQuaUN1cnIgLSAzOwogIGNvbnN0IHBvcyA9IChpIC0gaUZpcnN0U2F2ZSkgJSA0OwogIHN3aXRjaCAocG9zKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuc2F2ZTsKICAgIGNhc2UgMToKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy50cmFuc2Zvcm07CiAgICBjYXNlIDI6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q7CiAgICBjYXNlIDM6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMucmVzdG9yZTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKGBpdGVyYXRlSW5saW5lSW1hZ2VHcm91cCAtIGludmFsaWQgcG9zOiAke3Bvc31gKTsKfSwgZnVuY3Rpb24gZm91bmRJbmxpbmVJbWFnZUdyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBNSU5fSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0sgPSAxMDsKICBjb25zdCBNQVhfSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0sgPSAyMDA7CiAgY29uc3QgTUFYX1dJRFRIID0gMTAwMDsKICBjb25zdCBJTUFHRV9QQURESU5HID0gMTsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdFBJSVhPID0gY3VyciAtIDE7CiAgY29uc3QgY291bnQgPSBNYXRoLm1pbihNYXRoLmZsb29yKChpIC0gaUZpcnN0U2F2ZSkgLyA0KSwgTUFYX0lNQUdFU19JTl9JTkxJTkVfSU1BR0VTX0JMT0NLKTsKICBpZiAoY291bnQgPCBNSU5fSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0spIHsKICAgIHJldHVybiBpIC0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgfQogIGxldCBtYXhYID0gMDsKICBjb25zdCBtYXAgPSBbXTsKICBsZXQgbWF4TGluZUhlaWdodCA9IDA7CiAgbGV0IGN1cnJlbnRYID0gSU1BR0VfUEFERElORywKICAgIGN1cnJlbnRZID0gSU1BR0VfUEFERElORzsKICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyspIHsKICAgIGNvbnN0IHRyYW5zZm9ybSA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm0gKyAocSA8PCAyKV07CiAgICBjb25zdCBpbWcgPSBhcmdzQXJyYXlbaUZpcnN0UElJWE8gKyAocSA8PCAyKV1bMF07CiAgICBpZiAoY3VycmVudFggKyBpbWcud2lkdGggPiBNQVhfV0lEVEgpIHsKICAgICAgbWF4WCA9IE1hdGgubWF4KG1heFgsIGN1cnJlbnRYKTsKICAgICAgY3VycmVudFkgKz0gbWF4TGluZUhlaWdodCArIDIgKiBJTUFHRV9QQURESU5HOwogICAgICBjdXJyZW50WCA9IDA7CiAgICAgIG1heExpbmVIZWlnaHQgPSAwOwogICAgfQogICAgbWFwLnB1c2goewogICAgICB0cmFuc2Zvcm0sCiAgICAgIHg6IGN1cnJlbnRYLAogICAgICB5OiBjdXJyZW50WSwKICAgICAgdzogaW1nLndpZHRoLAogICAgICBoOiBpbWcuaGVpZ2h0CiAgICB9KTsKICAgIGN1cnJlbnRYICs9IGltZy53aWR0aCArIDIgKiBJTUFHRV9QQURESU5HOwogICAgbWF4TGluZUhlaWdodCA9IE1hdGgubWF4KG1heExpbmVIZWlnaHQsIGltZy5oZWlnaHQpOwogIH0KICBjb25zdCBpbWdXaWR0aCA9IE1hdGgubWF4KG1heFgsIGN1cnJlbnRYKSArIElNQUdFX1BBRERJTkc7CiAgY29uc3QgaW1nSGVpZ2h0ID0gY3VycmVudFkgKyBtYXhMaW5lSGVpZ2h0ICsgSU1BR0VfUEFERElORzsKICBjb25zdCBpbWdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW1nV2lkdGggKiBpbWdIZWlnaHQgKiA0KTsKICBjb25zdCBpbWdSb3dTaXplID0gaW1nV2lkdGggPDwgMjsKICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyspIHsKICAgIGNvbnN0IGRhdGEgPSBhcmdzQXJyYXlbaUZpcnN0UElJWE8gKyAocSA8PCAyKV1bMF0uZGF0YTsKICAgIGNvbnN0IHJvd1NpemUgPSBtYXBbcV0udyA8PCAyOwogICAgbGV0IGRhdGFPZmZzZXQgPSAwOwogICAgbGV0IG9mZnNldCA9IG1hcFtxXS54ICsgbWFwW3FdLnkgKiBpbWdXaWR0aCA8PCAyOwogICAgaW1nRGF0YS5zZXQoZGF0YS5zdWJhcnJheSgwLCByb3dTaXplKSwgb2Zmc2V0IC0gaW1nUm93U2l6ZSk7CiAgICBmb3IgKGxldCBrID0gMCwga2sgPSBtYXBbcV0uaDsgayA8IGtrOyBrKyspIHsKICAgICAgaW1nRGF0YS5zZXQoZGF0YS5zdWJhcnJheShkYXRhT2Zmc2V0LCBkYXRhT2Zmc2V0ICsgcm93U2l6ZSksIG9mZnNldCk7CiAgICAgIGRhdGFPZmZzZXQgKz0gcm93U2l6ZTsKICAgICAgb2Zmc2V0ICs9IGltZ1Jvd1NpemU7CiAgICB9CiAgICBpbWdEYXRhLnNldChkYXRhLnN1YmFycmF5KGRhdGFPZmZzZXQgLSByb3dTaXplLCBkYXRhT2Zmc2V0KSwgb2Zmc2V0KTsKICAgIHdoaWxlIChvZmZzZXQgPj0gMCkgewogICAgICBkYXRhW29mZnNldCAtIDRdID0gZGF0YVtvZmZzZXRdOwogICAgICBkYXRhW29mZnNldCAtIDNdID0gZGF0YVtvZmZzZXQgKyAxXTsKICAgICAgZGF0YVtvZmZzZXQgLSAyXSA9IGRhdGFbb2Zmc2V0ICsgMl07CiAgICAgIGRhdGFbb2Zmc2V0IC0gMV0gPSBkYXRhW29mZnNldCArIDNdOwogICAgICBkYXRhW29mZnNldCArIHJvd1NpemVdID0gZGF0YVtvZmZzZXQgKyByb3dTaXplIC0gNF07CiAgICAgIGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSArIDFdID0gZGF0YVtvZmZzZXQgKyByb3dTaXplIC0gM107CiAgICAgIGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSArIDJdID0gZGF0YVtvZmZzZXQgKyByb3dTaXplIC0gMl07CiAgICAgIGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSArIDNdID0gZGF0YVtvZmZzZXQgKyByb3dTaXplIC0gMV07CiAgICAgIG9mZnNldCAtPSBpbWdSb3dTaXplOwogICAgfQogIH0KICBjb25zdCBpbWcgPSB7CiAgICB3aWR0aDogaW1nV2lkdGgsCiAgICBoZWlnaHQ6IGltZ0hlaWdodAogIH07CiAgaWYgKGNvbnRleHQuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgIGNvbnN0IGNhbnZhcyA9IG5ldyBPZmZzY3JlZW5DYW52YXMoaW1nV2lkdGgsIGltZ0hlaWdodCk7CiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIGN0eC5wdXRJbWFnZURhdGEobmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkoaW1nRGF0YS5idWZmZXIpLCBpbWdXaWR0aCwgaW1nSGVpZ2h0KSwgMCwgMCk7CiAgICBpbWcuYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgaW1nLmRhdGEgPSBudWxsOwogIH0gZWxzZSB7CiAgICBpbWcua2luZCA9IEltYWdlS2luZC5SR0JBXzMyQlBQOwogICAgaW1nLmRhdGEgPSBpbWdEYXRhOwogIH0KICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIE9QUy5wYWludElubGluZUltYWdlWE9iamVjdEdyb3VwKTsKICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgW2ltZywgbWFwXSk7CiAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwp9KTsKYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbT1BTLnNhdmUsIE9QUy50cmFuc2Zvcm0sIE9QUy5wYWludEltYWdlTWFza1hPYmplY3QsIE9QUy5yZXN0b3JlXSwgbnVsbCwgZnVuY3Rpb24gaXRlcmF0ZUltYWdlTWFza0dyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5OwogIGNvbnN0IGlGaXJzdFNhdmUgPSBjb250ZXh0LmlDdXJyIC0gMzsKICBjb25zdCBwb3MgPSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKICBzd2l0Y2ggKHBvcykgewogICAgY2FzZSAwOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnNhdmU7CiAgICBjYXNlIDE6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMudHJhbnNmb3JtOwogICAgY2FzZSAyOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdDsKICAgIGNhc2UgMzoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5yZXN0b3JlOwogIH0KICB0aHJvdyBuZXcgRXJyb3IoYGl0ZXJhdGVJbWFnZU1hc2tHcm91cCAtIGludmFsaWQgcG9zOiAke3Bvc31gKTsKfSwgZnVuY3Rpb24gZm91bmRJbWFnZU1hc2tHcm91cChjb250ZXh0LCBpKSB7CiAgY29uc3QgTUlOX0lNQUdFU19JTl9NQVNLU19CTE9DSyA9IDEwOwogIGNvbnN0IE1BWF9JTUFHRVNfSU5fTUFTS1NfQkxPQ0sgPSAxMDA7CiAgY29uc3QgTUFYX1NBTUVfSU1BR0VTX0lOX01BU0tTX0JMT0NLID0gMTAwMDsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdFBJTVhPID0gY3VyciAtIDE7CiAgbGV0IGNvdW50ID0gTWF0aC5mbG9vcigoaSAtIGlGaXJzdFNhdmUpIC8gNCk7CiAgaWYgKGNvdW50IDwgTUlOX0lNQUdFU19JTl9NQVNLU19CTE9DSykgewogICAgcmV0dXJuIGkgLSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKICB9CiAgbGV0IGlzU2FtZUltYWdlID0gZmFsc2U7CiAgbGV0IGlUcmFuc2Zvcm0sIHRyYW5zZm9ybUFyZ3M7CiAgY29uc3QgZmlyc3RQSU1YT0FyZzAgPSBhcmdzQXJyYXlbaUZpcnN0UElNWE9dWzBdOwogIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzBdLAogICAgZmlyc3RUcmFuc2Zvcm1BcmcxID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMV0sCiAgICBmaXJzdFRyYW5zZm9ybUFyZzIgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVsyXSwKICAgIGZpcnN0VHJhbnNmb3JtQXJnMyA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzNdOwogIGlmIChmaXJzdFRyYW5zZm9ybUFyZzEgPT09IGZpcnN0VHJhbnNmb3JtQXJnMikgewogICAgaXNTYW1lSW1hZ2UgPSB0cnVlOwogICAgaVRyYW5zZm9ybSA9IGlGaXJzdFRyYW5zZm9ybSArIDQ7CiAgICBsZXQgaVBJTVhPID0gaUZpcnN0UElNWE8gKyA0OwogICAgZm9yIChsZXQgcSA9IDE7IHEgPCBjb3VudDsgcSsrLCBpVHJhbnNmb3JtICs9IDQsIGlQSU1YTyArPSA0KSB7CiAgICAgIHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaVRyYW5zZm9ybV07CiAgICAgIGlmIChhcmdzQXJyYXlbaVBJTVhPXVswXSAhPT0gZmlyc3RQSU1YT0FyZzAgfHwgdHJhbnNmb3JtQXJnc1swXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmcwIHx8IHRyYW5zZm9ybUFyZ3NbMV0gIT09IGZpcnN0VHJhbnNmb3JtQXJnMSB8fCB0cmFuc2Zvcm1BcmdzWzJdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzIgfHwgdHJhbnNmb3JtQXJnc1szXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmczKSB7CiAgICAgICAgaWYgKHEgPCBNSU5fSU1BR0VTX0lOX01BU0tTX0JMT0NLKSB7CiAgICAgICAgICBpc1NhbWVJbWFnZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb3VudCA9IHE7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIGlmIChpc1NhbWVJbWFnZSkgewogICAgY291bnQgPSBNYXRoLm1pbihjb3VudCwgTUFYX1NBTUVfSU1BR0VTX0lOX01BU0tTX0JMT0NLKTsKICAgIGNvbnN0IHBvc2l0aW9ucyA9IG5ldyBGbG9hdDMyQXJyYXkoY291bnQgKiAyKTsKICAgIGlUcmFuc2Zvcm0gPSBpRmlyc3RUcmFuc2Zvcm07CiAgICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyssIGlUcmFuc2Zvcm0gKz0gNCkgewogICAgICB0cmFuc2Zvcm1BcmdzID0gYXJnc0FycmF5W2lUcmFuc2Zvcm1dOwogICAgICBwb3NpdGlvbnNbcSA8PCAxXSA9IHRyYW5zZm9ybUFyZ3NbNF07CiAgICAgIHBvc2l0aW9uc1socSA8PCAxKSArIDFdID0gdHJhbnNmb3JtQXJnc1s1XTsKICAgIH0KICAgIGZuQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdFJlcGVhdCk7CiAgICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgW2ZpcnN0UElNWE9BcmcwLCBmaXJzdFRyYW5zZm9ybUFyZzAsIGZpcnN0VHJhbnNmb3JtQXJnMSwgZmlyc3RUcmFuc2Zvcm1BcmcyLCBmaXJzdFRyYW5zZm9ybUFyZzMsIHBvc2l0aW9uc10pOwogIH0gZWxzZSB7CiAgICBjb3VudCA9IE1hdGgubWluKGNvdW50LCBNQVhfSU1BR0VTX0lOX01BU0tTX0JMT0NLKTsKICAgIGNvbnN0IGltYWdlcyA9IFtdOwogICAgZm9yIChsZXQgcSA9IDA7IHEgPCBjb3VudDsgcSsrKSB7CiAgICAgIHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtICsgKHEgPDwgMildOwogICAgICBjb25zdCBtYXNrUGFyYW1zID0gYXJnc0FycmF5W2lGaXJzdFBJTVhPICsgKHEgPDwgMildWzBdOwogICAgICBpbWFnZXMucHVzaCh7CiAgICAgICAgZGF0YTogbWFza1BhcmFtcy5kYXRhLAogICAgICAgIHdpZHRoOiBtYXNrUGFyYW1zLndpZHRoLAogICAgICAgIGhlaWdodDogbWFza1BhcmFtcy5oZWlnaHQsCiAgICAgICAgaW50ZXJwb2xhdGU6IG1hc2tQYXJhbXMuaW50ZXJwb2xhdGUsCiAgICAgICAgY291bnQ6IG1hc2tQYXJhbXMuY291bnQsCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm1BcmdzCiAgICAgIH0pOwogICAgfQogICAgZm5BcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0R3JvdXApOwogICAgYXJnc0FycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIFtpbWFnZXNdKTsKICB9CiAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwp9KTsKYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbT1BTLnNhdmUsIE9QUy50cmFuc2Zvcm0sIE9QUy5wYWludEltYWdlWE9iamVjdCwgT1BTLnJlc3RvcmVdLCBmdW5jdGlvbiAoY29udGV4dCkgewogIGNvbnN0IGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGNvbnRleHQuaUN1cnIgLSAyOwogIHJldHVybiBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVsxXSA9PT0gMCAmJiBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVsyXSA9PT0gMDsKfSwgZnVuY3Rpb24gaXRlcmF0ZUltYWdlR3JvdXAoY29udGV4dCwgaSkgewogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBpRmlyc3RTYXZlID0gY29udGV4dC5pQ3VyciAtIDM7CiAgY29uc3QgcG9zID0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgc3dpdGNoIChwb3MpIHsKICAgIGNhc2UgMDoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5zYXZlOwogICAgY2FzZSAxOgogICAgICBpZiAoZm5BcnJheVtpXSAhPT0gT1BTLnRyYW5zZm9ybSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBpRmlyc3RUcmFuc2Zvcm0gPSBjb250ZXh0LmlDdXJyIC0gMjsKICAgICAgY29uc3QgZmlyc3RUcmFuc2Zvcm1BcmcwID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMF07CiAgICAgIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMyA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzNdOwogICAgICBpZiAoYXJnc0FycmF5W2ldWzBdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzAgfHwgYXJnc0FycmF5W2ldWzFdICE9PSAwIHx8IGFyZ3NBcnJheVtpXVsyXSAhPT0gMCB8fCBhcmdzQXJyYXlbaV1bM10gIT09IGZpcnN0VHJhbnNmb3JtQXJnMykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGNhc2UgMjoKICAgICAgaWYgKGZuQXJyYXlbaV0gIT09IE9QUy5wYWludEltYWdlWE9iamVjdCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBpRmlyc3RQSVhPID0gY29udGV4dC5pQ3VyciAtIDE7CiAgICAgIGNvbnN0IGZpcnN0UElYT0FyZzAgPSBhcmdzQXJyYXlbaUZpcnN0UElYT11bMF07CiAgICAgIGlmIChhcmdzQXJyYXlbaV1bMF0gIT09IGZpcnN0UElYT0FyZzApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICBjYXNlIDM6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMucmVzdG9yZTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKGBpdGVyYXRlSW1hZ2VHcm91cCAtIGludmFsaWQgcG9zOiAke3Bvc31gKTsKfSwgZnVuY3Rpb24gKGNvbnRleHQsIGkpIHsKICBjb25zdCBNSU5fSU1BR0VTX0lOX0JMT0NLID0gMzsKICBjb25zdCBNQVhfSU1BR0VTX0lOX0JMT0NLID0gMTAwMDsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdFBJWE8gPSBjdXJyIC0gMTsKICBjb25zdCBmaXJzdFBJWE9BcmcwID0gYXJnc0FycmF5W2lGaXJzdFBJWE9dWzBdOwogIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzBdOwogIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMyA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzNdOwogIGNvbnN0IGNvdW50ID0gTWF0aC5taW4oTWF0aC5mbG9vcigoaSAtIGlGaXJzdFNhdmUpIC8gNCksIE1BWF9JTUFHRVNfSU5fQkxPQ0spOwogIGlmIChjb3VudCA8IE1JTl9JTUFHRVNfSU5fQkxPQ0spIHsKICAgIHJldHVybiBpIC0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgfQogIGNvbnN0IHBvc2l0aW9ucyA9IG5ldyBGbG9hdDMyQXJyYXkoY291bnQgKiAyKTsKICBsZXQgaVRyYW5zZm9ybSA9IGlGaXJzdFRyYW5zZm9ybTsKICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyssIGlUcmFuc2Zvcm0gKz0gNCkgewogICAgY29uc3QgdHJhbnNmb3JtQXJncyA9IGFyZ3NBcnJheVtpVHJhbnNmb3JtXTsKICAgIHBvc2l0aW9uc1txIDw8IDFdID0gdHJhbnNmb3JtQXJnc1s0XTsKICAgIHBvc2l0aW9uc1socSA8PCAxKSArIDFdID0gdHJhbnNmb3JtQXJnc1s1XTsKICB9CiAgY29uc3QgYXJncyA9IFtmaXJzdFBJWE9BcmcwLCBmaXJzdFRyYW5zZm9ybUFyZzAsIGZpcnN0VHJhbnNmb3JtQXJnMywgcG9zaXRpb25zXTsKICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIE9QUy5wYWludEltYWdlWE9iamVjdFJlcGVhdCk7CiAgYXJnc0FycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIGFyZ3MpOwogIHJldHVybiBpRmlyc3RTYXZlICsgMTsKfSk7CmFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW09QUy5iZWdpblRleHQsIE9QUy5zZXRGb250LCBPUFMuc2V0VGV4dE1hdHJpeCwgT1BTLnNob3dUZXh0LCBPUFMuZW5kVGV4dF0sIG51bGwsIGZ1bmN0aW9uIGl0ZXJhdGVTaG93VGV4dEdyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGNvbnRleHQuaUN1cnIgLSA0OwogIGNvbnN0IHBvcyA9IChpIC0gaUZpcnN0U2F2ZSkgJSA1OwogIHN3aXRjaCAocG9zKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuYmVnaW5UZXh0OwogICAgY2FzZSAxOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnNldEZvbnQ7CiAgICBjYXNlIDI6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuc2V0VGV4dE1hdHJpeDsKICAgIGNhc2UgMzoKICAgICAgaWYgKGZuQXJyYXlbaV0gIT09IE9QUy5zaG93VGV4dCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBpRmlyc3RTZXRGb250ID0gY29udGV4dC5pQ3VyciAtIDM7CiAgICAgIGNvbnN0IGZpcnN0U2V0Rm9udEFyZzAgPSBhcmdzQXJyYXlbaUZpcnN0U2V0Rm9udF1bMF07CiAgICAgIGNvbnN0IGZpcnN0U2V0Rm9udEFyZzEgPSBhcmdzQXJyYXlbaUZpcnN0U2V0Rm9udF1bMV07CiAgICAgIGlmIChhcmdzQXJyYXlbaV1bMF0gIT09IGZpcnN0U2V0Rm9udEFyZzAgfHwgYXJnc0FycmF5W2ldWzFdICE9PSBmaXJzdFNldEZvbnRBcmcxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgY2FzZSA0OgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLmVuZFRleHQ7CiAgfQogIHRocm93IG5ldyBFcnJvcihgaXRlcmF0ZVNob3dUZXh0R3JvdXAgLSBpbnZhbGlkIHBvczogJHtwb3N9YCk7Cn0sIGZ1bmN0aW9uIChjb250ZXh0LCBpKSB7CiAgY29uc3QgTUlOX0NIQVJTX0lOX0JMT0NLID0gMzsKICBjb25zdCBNQVhfQ0hBUlNfSU5fQkxPQ0sgPSAxMDAwOwogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBjdXJyID0gY29udGV4dC5pQ3VycjsKICBjb25zdCBpRmlyc3RCZWdpblRleHQgPSBjdXJyIC0gNDsKICBjb25zdCBpRmlyc3RTZXRGb250ID0gY3VyciAtIDM7CiAgY29uc3QgaUZpcnN0U2V0VGV4dE1hdHJpeCA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdFNob3dUZXh0ID0gY3VyciAtIDE7CiAgY29uc3QgaUZpcnN0RW5kVGV4dCA9IGN1cnI7CiAgY29uc3QgZmlyc3RTZXRGb250QXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RTZXRGb250XVswXTsKICBjb25zdCBmaXJzdFNldEZvbnRBcmcxID0gYXJnc0FycmF5W2lGaXJzdFNldEZvbnRdWzFdOwogIGxldCBjb3VudCA9IE1hdGgubWluKE1hdGguZmxvb3IoKGkgLSBpRmlyc3RCZWdpblRleHQpIC8gNSksIE1BWF9DSEFSU19JTl9CTE9DSyk7CiAgaWYgKGNvdW50IDwgTUlOX0NIQVJTX0lOX0JMT0NLKSB7CiAgICByZXR1cm4gaSAtIChpIC0gaUZpcnN0QmVnaW5UZXh0KSAlIDU7CiAgfQogIGxldCBpRmlyc3QgPSBpRmlyc3RCZWdpblRleHQ7CiAgaWYgKGlGaXJzdEJlZ2luVGV4dCA+PSA0ICYmIGZuQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gNF0gPT09IGZuQXJyYXlbaUZpcnN0U2V0Rm9udF0gJiYgZm5BcnJheVtpRmlyc3RCZWdpblRleHQgLSAzXSA9PT0gZm5BcnJheVtpRmlyc3RTZXRUZXh0TWF0cml4XSAmJiBmbkFycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDJdID09PSBmbkFycmF5W2lGaXJzdFNob3dUZXh0XSAmJiBmbkFycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDFdID09PSBmbkFycmF5W2lGaXJzdEVuZFRleHRdICYmIGFyZ3NBcnJheVtpRmlyc3RCZWdpblRleHQgLSA0XVswXSA9PT0gZmlyc3RTZXRGb250QXJnMCAmJiBhcmdzQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gNF1bMV0gPT09IGZpcnN0U2V0Rm9udEFyZzEpIHsKICAgIGNvdW50Kys7CiAgICBpRmlyc3QgLT0gNTsKICB9CiAgbGV0IGlFbmRUZXh0ID0gaUZpcnN0ICsgNDsKICBmb3IgKGxldCBxID0gMTsgcSA8IGNvdW50OyBxKyspIHsKICAgIGZuQXJyYXkuc3BsaWNlKGlFbmRUZXh0LCAzKTsKICAgIGFyZ3NBcnJheS5zcGxpY2UoaUVuZFRleHQsIDMpOwogICAgaUVuZFRleHQgKz0gMjsKICB9CiAgcmV0dXJuIGlFbmRUZXh0ICsgMTsKfSk7CmFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW09QUy5zYXZlLCBPUFMudHJhbnNmb3JtLCBPUFMuY29uc3RydWN0UGF0aCwgT1BTLnJlc3RvcmVdLCBjb250ZXh0ID0+IHsKICBjb25zdCBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBpRmlyc3RDb25zdHJ1Y3RQYXRoID0gY29udGV4dC5pQ3VyciAtIDE7CiAgY29uc3Qgb3AgPSBhcmdzQXJyYXlbaUZpcnN0Q29uc3RydWN0UGF0aF1bMF07CiAgaWYgKG9wICE9PSBPUFMuc3Ryb2tlICYmIG9wICE9PSBPUFMuY2xvc2VTdHJva2UgJiYgb3AgIT09IE9QUy5maWxsU3Ryb2tlICYmIG9wICE9PSBPUFMuZW9GaWxsU3Ryb2tlICYmIG9wICE9PSBPUFMuY2xvc2VGaWxsU3Ryb2tlICYmIG9wICE9PSBPUFMuY2xvc2VFT0ZpbGxTdHJva2UpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBjb25zdCBpRmlyc3RUcmFuc2Zvcm0gPSBjb250ZXh0LmlDdXJyIC0gMjsKICBjb25zdCB0cmFuc2Zvcm0gPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXTsKICByZXR1cm4gdHJhbnNmb3JtWzBdID09PSAxICYmIHRyYW5zZm9ybVsxXSA9PT0gMCAmJiB0cmFuc2Zvcm1bMl0gPT09IDAgJiYgdHJhbnNmb3JtWzNdID09PSAxOwp9LCAoKSA9PiBmYWxzZSwgKGNvbnRleHQsIGkpID0+IHsKICBjb25zdCB7CiAgICBmbkFycmF5LAogICAgYXJnc0FycmF5CiAgfSA9IGNvbnRleHQ7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdENvbnN0cnVjdFBhdGggPSBjdXJyIC0gMTsKICBjb25zdCBhcmdzID0gYXJnc0FycmF5W2lGaXJzdENvbnN0cnVjdFBhdGhdOwogIGNvbnN0IHRyYW5zZm9ybSA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dOwogIGNvbnN0IFssIFtidWZmZXJdLCBtaW5NYXhdID0gYXJnczsKICBpZiAobWluTWF4KSB7CiAgICBVdGlsLnNjYWxlTWluTWF4KHRyYW5zZm9ybSwgbWluTWF4KTsKICAgIGZvciAobGV0IGsgPSAwLCBrayA9IGJ1ZmZlci5sZW5ndGg7IGsgPCBrazspIHsKICAgICAgc3dpdGNoIChidWZmZXJbaysrXSkgewogICAgICAgIGNhc2UgRHJhd09QUy5tb3ZlVG86CiAgICAgICAgY2FzZSBEcmF3T1BTLmxpbmVUbzoKICAgICAgICAgIFV0aWwuYXBwbHlUcmFuc2Zvcm0oYnVmZmVyLCB0cmFuc2Zvcm0sIGspOwogICAgICAgICAgayArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBEcmF3T1BTLmN1cnZlVG86CiAgICAgICAgICBVdGlsLmFwcGx5VHJhbnNmb3JtVG9CZXppZXIoYnVmZmVyLCB0cmFuc2Zvcm0sIGspOwogICAgICAgICAgayArPSA2OwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgZm5BcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgNCwgT1BTLmNvbnN0cnVjdFBhdGgpOwogIGFyZ3NBcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgNCwgYXJncyk7CiAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwp9KTsKY2xhc3MgTnVsbE9wdGltaXplciB7CiAgY29uc3RydWN0b3IocXVldWUpIHsKICAgIHRoaXMucXVldWUgPSBxdWV1ZTsKICB9CiAgX29wdGltaXplKCkge30KICBwdXNoKGZuLCBhcmdzKSB7CiAgICB0aGlzLnF1ZXVlLmZuQXJyYXkucHVzaChmbik7CiAgICB0aGlzLnF1ZXVlLmFyZ3NBcnJheS5wdXNoKGFyZ3MpOwogICAgdGhpcy5fb3B0aW1pemUoKTsKICB9CiAgZmx1c2goKSB7fQogIHJlc2V0KCkge30KfQpjbGFzcyBRdWV1ZU9wdGltaXplciBleHRlbmRzIE51bGxPcHRpbWl6ZXIgewogIGNvbnN0cnVjdG9yKHF1ZXVlKSB7CiAgICBzdXBlcihxdWV1ZSk7CiAgICB0aGlzLnN0YXRlID0gbnVsbDsKICAgIHRoaXMuY29udGV4dCA9IHsKICAgICAgaUN1cnI6IDAsCiAgICAgIGZuQXJyYXk6IHF1ZXVlLmZuQXJyYXksCiAgICAgIGFyZ3NBcnJheTogcXVldWUuYXJnc0FycmF5LAogICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZDogT3BlcmF0b3JMaXN0LmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkCiAgICB9OwogICAgdGhpcy5tYXRjaCA9IG51bGw7CiAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSAwOwogIH0KICBfb3B0aW1pemUoKSB7CiAgICBjb25zdCBmbkFycmF5ID0gdGhpcy5xdWV1ZS5mbkFycmF5OwogICAgbGV0IGkgPSB0aGlzLmxhc3RQcm9jZXNzZWQsCiAgICAgIGlpID0gZm5BcnJheS5sZW5ndGg7CiAgICBsZXQgc3RhdGUgPSB0aGlzLnN0YXRlOwogICAgbGV0IG1hdGNoID0gdGhpcy5tYXRjaDsKICAgIGlmICghc3RhdGUgJiYgIW1hdGNoICYmIGkgKyAxID09PSBpaSAmJiAhSW5pdGlhbFN0YXRlW2ZuQXJyYXlbaV1dKSB7CiAgICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9IGlpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5jb250ZXh0OwogICAgd2hpbGUgKGkgPCBpaSkgewogICAgICBpZiAobWF0Y2gpIHsKICAgICAgICBjb25zdCBpdGVyYXRlID0gKDAsIG1hdGNoLml0ZXJhdGVGbikoY29udGV4dCwgaSk7CiAgICAgICAgaWYgKGl0ZXJhdGUpIHsKICAgICAgICAgIGkrKzsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpID0gKDAsIG1hdGNoLnByb2Nlc3NGbikoY29udGV4dCwgaSArIDEpOwogICAgICAgIGlpID0gZm5BcnJheS5sZW5ndGg7CiAgICAgICAgbWF0Y2ggPSBudWxsOwogICAgICAgIHN0YXRlID0gbnVsbDsKICAgICAgICBpZiAoaSA+PSBpaSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0YXRlID0gKHN0YXRlIHx8IEluaXRpYWxTdGF0ZSlbZm5BcnJheVtpXV07CiAgICAgIGlmICghc3RhdGUgfHwgQXJyYXkuaXNBcnJheShzdGF0ZSkpIHsKICAgICAgICBpKys7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29udGV4dC5pQ3VyciA9IGk7CiAgICAgIGkrKzsKICAgICAgaWYgKHN0YXRlLmNoZWNrRm4gJiYgISgwLCBzdGF0ZS5jaGVja0ZuKShjb250ZXh0KSkgewogICAgICAgIHN0YXRlID0gbnVsbDsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBtYXRjaCA9IHN0YXRlOwogICAgICBzdGF0ZSA9IG51bGw7CiAgICB9CiAgICB0aGlzLnN0YXRlID0gc3RhdGU7CiAgICB0aGlzLm1hdGNoID0gbWF0Y2g7CiAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSBpOwogIH0KICBmbHVzaCgpIHsKICAgIHdoaWxlICh0aGlzLm1hdGNoKSB7CiAgICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMucXVldWUuZm5BcnJheS5sZW5ndGg7CiAgICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9ICgwLCB0aGlzLm1hdGNoLnByb2Nlc3NGbikodGhpcy5jb250ZXh0LCBsZW5ndGgpOwogICAgICB0aGlzLm1hdGNoID0gbnVsbDsKICAgICAgdGhpcy5zdGF0ZSA9IG51bGw7CiAgICAgIHRoaXMuX29wdGltaXplKCk7CiAgICB9CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5zdGF0ZSA9IG51bGw7CiAgICB0aGlzLm1hdGNoID0gbnVsbDsKICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9IDA7CiAgfQp9CmNsYXNzIE9wZXJhdG9yTGlzdCB7CiAgc3RhdGljIENIVU5LX1NJWkUgPSAxMDAwOwogIHN0YXRpYyBDSFVOS19TSVpFX0FCT1VUID0gdGhpcy5DSFVOS19TSVpFIC0gNTsKICBzdGF0aWMgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPSBmYWxzZTsKICBjb25zdHJ1Y3RvcihpbnRlbnQgPSAwLCBzdHJlYW1TaW5rKSB7CiAgICB0aGlzLl9zdHJlYW1TaW5rID0gc3RyZWFtU2luazsKICAgIHRoaXMuZm5BcnJheSA9IFtdOwogICAgdGhpcy5hcmdzQXJyYXkgPSBbXTsKICAgIHRoaXMub3B0aW1pemVyID0gc3RyZWFtU2luayAmJiAhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuT1BMSVNUKSA/IG5ldyBRdWV1ZU9wdGltaXplcih0aGlzKSA6IG5ldyBOdWxsT3B0aW1pemVyKHRoaXMpOwogICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl90b3RhbExlbmd0aCA9IDA7CiAgICB0aGlzLndlaWdodCA9IDA7CiAgICB0aGlzLl9yZXNvbHZlZCA9IHN0cmVhbVNpbmsgPyBudWxsIDogUHJvbWlzZS5yZXNvbHZlKCk7CiAgfQogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkCiAgfSkgewogICAgdGhpcy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuYXJnc0FycmF5Lmxlbmd0aDsKICB9CiAgZ2V0IHJlYWR5KCkgewogICAgcmV0dXJuIHRoaXMuX3Jlc29sdmVkIHx8IHRoaXMuX3N0cmVhbVNpbmsucmVhZHk7CiAgfQogIGdldCB0b3RhbExlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLl90b3RhbExlbmd0aCArIHRoaXMubGVuZ3RoOwogIH0KICBhZGRPcChmbiwgYXJncykgewogICAgdGhpcy5vcHRpbWl6ZXIucHVzaChmbiwgYXJncyk7CiAgICB0aGlzLndlaWdodCsrOwogICAgaWYgKHRoaXMuX3N0cmVhbVNpbmspIHsKICAgICAgaWYgKHRoaXMud2VpZ2h0ID49IE9wZXJhdG9yTGlzdC5DSFVOS19TSVpFKSB7CiAgICAgICAgdGhpcy5mbHVzaCgpOwogICAgICB9IGVsc2UgaWYgKHRoaXMud2VpZ2h0ID49IE9wZXJhdG9yTGlzdC5DSFVOS19TSVpFX0FCT1VUICYmIChmbiA9PT0gT1BTLnJlc3RvcmUgfHwgZm4gPT09IE9QUy5lbmRUZXh0KSkgewogICAgICAgIHRoaXMuZmx1c2goKTsKICAgICAgfQogICAgfQogIH0KICBhZGRJbWFnZU9wcyhmbiwgYXJncywgb3B0aW9uYWxDb250ZW50LCBoYXNNYXNrID0gZmFsc2UpIHsKICAgIGlmIChoYXNNYXNrKSB7CiAgICAgIHRoaXMuYWRkT3AoT1BTLnNhdmUpOwogICAgICB0aGlzLmFkZE9wKE9QUy5zZXRHU3RhdGUsIFtbWyJTTWFzayIsIGZhbHNlXV1dKTsKICAgIH0KICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmFkZE9wKE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG9wdGlvbmFsQ29udGVudF0pOwogICAgfQogICAgdGhpcy5hZGRPcChmbiwgYXJncyk7CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5hZGRPcChPUFMuZW5kTWFya2VkQ29udGVudCwgW10pOwogICAgfQogICAgaWYgKGhhc01hc2spIHsKICAgICAgdGhpcy5hZGRPcChPUFMucmVzdG9yZSk7CiAgICB9CiAgfQogIGFkZERlcGVuZGVuY3koZGVwZW5kZW5jeSkgewogICAgaWYgKHRoaXMuZGVwZW5kZW5jaWVzLmhhcyhkZXBlbmRlbmN5KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmRlcGVuZGVuY2llcy5hZGQoZGVwZW5kZW5jeSk7CiAgICB0aGlzLmFkZE9wKE9QUy5kZXBlbmRlbmN5LCBbZGVwZW5kZW5jeV0pOwogIH0KICBhZGREZXBlbmRlbmNpZXMoZGVwZW5kZW5jaWVzKSB7CiAgICBmb3IgKGNvbnN0IGRlcGVuZGVuY3kgb2YgZGVwZW5kZW5jaWVzKSB7CiAgICAgIHRoaXMuYWRkRGVwZW5kZW5jeShkZXBlbmRlbmN5KTsKICAgIH0KICB9CiAgYWRkT3BMaXN0KG9wTGlzdCkgewogICAgaWYgKCEob3BMaXN0IGluc3RhbmNlb2YgT3BlcmF0b3JMaXN0KSkgewogICAgICB3YXJuKCdhZGRPcExpc3QgLSBpZ25vcmluZyBpbnZhbGlkICJvcExpc3QiIHBhcmFtZXRlci4nKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBkZXBlbmRlbmN5IG9mIG9wTGlzdC5kZXBlbmRlbmNpZXMpIHsKICAgICAgdGhpcy5kZXBlbmRlbmNpZXMuYWRkKGRlcGVuZGVuY3kpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gb3BMaXN0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgdGhpcy5hZGRPcChvcExpc3QuZm5BcnJheVtpXSwgb3BMaXN0LmFyZ3NBcnJheVtpXSk7CiAgICB9CiAgfQogIGdldElSKCkgewogICAgcmV0dXJuIHsKICAgICAgZm5BcnJheTogdGhpcy5mbkFycmF5LAogICAgICBhcmdzQXJyYXk6IHRoaXMuYXJnc0FycmF5LAogICAgICBsZW5ndGg6IHRoaXMubGVuZ3RoCiAgICB9OwogIH0KICBnZXQgX3RyYW5zZmVycygpIHsKICAgIGNvbnN0IHRyYW5zZmVycyA9IFtdOwogICAgY29uc3QgewogICAgICBmbkFycmF5LAogICAgICBhcmdzQXJyYXksCiAgICAgIGxlbmd0aAogICAgfSA9IHRoaXM7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHN3aXRjaCAoZm5BcnJheVtpXSkgewogICAgICAgIGNhc2UgT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0OgogICAgICAgIGNhc2UgT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXA6CiAgICAgICAgY2FzZSBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0OgogICAgICAgICAgewogICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgYml0bWFwLAogICAgICAgICAgICAgIGRhdGEKICAgICAgICAgICAgfSA9IGFyZ3NBcnJheVtpXVswXTsKICAgICAgICAgICAgaWYgKGJpdG1hcCB8fCBkYXRhPy5idWZmZXIpIHsKICAgICAgICAgICAgICB0cmFuc2ZlcnMucHVzaChiaXRtYXAgfHwgZGF0YS5idWZmZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIGNhc2UgT1BTLmNvbnN0cnVjdFBhdGg6CiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IFssIFtkYXRhXSwgbWluTWF4XSA9IGFyZ3NBcnJheVtpXTsKICAgICAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgICB0cmFuc2ZlcnMucHVzaChkYXRhLmJ1ZmZlciwgbWluTWF4LmJ1ZmZlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgY2FzZSBPUFMucGFpbnRGb3JtWE9iamVjdEJlZ2luOgogICAgICAgICAgY29uc3QgW21hdHJpeCwgYmJveF0gPSBhcmdzQXJyYXlbaV07CiAgICAgICAgICBpZiAobWF0cml4KSB7CiAgICAgICAgICAgIHRyYW5zZmVycy5wdXNoKG1hdHJpeC5idWZmZXIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGJib3gpIHsKICAgICAgICAgICAgdHJhbnNmZXJzLnB1c2goYmJveC5idWZmZXIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBPUFMuc2V0VGV4dE1hdHJpeDoKICAgICAgICAgIHRyYW5zZmVycy5wdXNoKGFyZ3NBcnJheVtpXVswXS5idWZmZXIpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cmFuc2ZlcnM7CiAgfQogIGZsdXNoKGxhc3RDaHVuayA9IGZhbHNlLCBzZXBhcmF0ZUFubm90cyA9IG51bGwpIHsKICAgIHRoaXMub3B0aW1pemVyLmZsdXNoKCk7CiAgICBjb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgIHRoaXMuX3RvdGFsTGVuZ3RoICs9IGxlbmd0aDsKICAgIHRoaXMuX3N0cmVhbVNpbmsuZW5xdWV1ZSh7CiAgICAgIGZuQXJyYXk6IHRoaXMuZm5BcnJheSwKICAgICAgYXJnc0FycmF5OiB0aGlzLmFyZ3NBcnJheSwKICAgICAgbGFzdENodW5rLAogICAgICBzZXBhcmF0ZUFubm90cywKICAgICAgbGVuZ3RoCiAgICB9LCAxLCB0aGlzLl90cmFuc2ZlcnMpOwogICAgdGhpcy5kZXBlbmRlbmNpZXMuY2xlYXIoKTsKICAgIHRoaXMuZm5BcnJheS5sZW5ndGggPSAwOwogICAgdGhpcy5hcmdzQXJyYXkubGVuZ3RoID0gMDsKICAgIHRoaXMud2VpZ2h0ID0gMDsKICAgIHRoaXMub3B0aW1pemVyLnJlc2V0KCk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9iaW5hcnlfY21hcC5qcwoKZnVuY3Rpb24gaGV4VG9JbnQoYSwgc2l6ZSkgewogIGxldCBuID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgIG4gPSBuIDw8IDggfCBhW2ldOwogIH0KICByZXR1cm4gbiA+Pj4gMDsKfQpmdW5jdGlvbiBoZXhUb1N0cihhLCBzaXplKSB7CiAgaWYgKHNpemUgPT09IDEpIHsKICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGFbMF0sIGFbMV0pOwogIH0KICBpZiAoc2l6ZSA9PT0gMykgewogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYVswXSwgYVsxXSwgYVsyXSwgYVszXSk7CiAgfQogIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmEuc3ViYXJyYXkoMCwgc2l6ZSArIDEpKTsKfQpmdW5jdGlvbiBhZGRIZXgoYSwgYiwgc2l6ZSkgewogIGxldCBjID0gMDsKICBmb3IgKGxldCBpID0gc2l6ZTsgaSA+PSAwOyBpLS0pIHsKICAgIGMgKz0gYVtpXSArIGJbaV07CiAgICBhW2ldID0gYyAmIDI1NTsKICAgIGMgPj49IDg7CiAgfQp9CmZ1bmN0aW9uIGluY0hleChhLCBzaXplKSB7CiAgbGV0IGMgPSAxOwogIGZvciAobGV0IGkgPSBzaXplOyBpID49IDAgJiYgYyA+IDA7IGktLSkgewogICAgYyArPSBhW2ldOwogICAgYVtpXSA9IGMgJiAyNTU7CiAgICBjID4+PSA4OwogIH0KfQpjb25zdCBNQVhfTlVNX1NJWkUgPSAxNjsKY29uc3QgTUFYX0VOQ09ERURfTlVNX1NJWkUgPSAxOTsKY2xhc3MgQmluYXJ5Q01hcFN0cmVhbSB7CiAgY29uc3RydWN0b3IoZGF0YSkgewogICAgdGhpcy5idWZmZXIgPSBkYXRhOwogICAgdGhpcy5wb3MgPSAwOwogICAgdGhpcy5lbmQgPSBkYXRhLmxlbmd0aDsKICAgIHRoaXMudG1wQnVmID0gbmV3IFVpbnQ4QXJyYXkoTUFYX0VOQ09ERURfTlVNX1NJWkUpOwogIH0KICByZWFkQnl0ZSgpIHsKICAgIGlmICh0aGlzLnBvcyA+PSB0aGlzLmVuZCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICByZXR1cm4gdGhpcy5idWZmZXJbdGhpcy5wb3MrK107CiAgfQogIHJlYWROdW1iZXIoKSB7CiAgICBsZXQgbiA9IDA7CiAgICBsZXQgbGFzdDsKICAgIGRvIHsKICAgICAgY29uc3QgYiA9IHRoaXMucmVhZEJ5dGUoKTsKICAgICAgaWYgKGIgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJ1bmV4cGVjdGVkIEVPRiBpbiBiY21hcCIpOwogICAgICB9CiAgICAgIGxhc3QgPSAhKGIgJiAweDgwKTsKICAgICAgbiA9IG4gPDwgNyB8IGIgJiAweDdmOwogICAgfSB3aGlsZSAoIWxhc3QpOwogICAgcmV0dXJuIG47CiAgfQogIHJlYWRTaWduZWQoKSB7CiAgICBjb25zdCBuID0gdGhpcy5yZWFkTnVtYmVyKCk7CiAgICByZXR1cm4gbiAmIDEgPyB+KG4gPj4+IDEpIDogbiA+Pj4gMTsKICB9CiAgcmVhZEhleChudW0sIHNpemUpIHsKICAgIG51bS5zZXQodGhpcy5idWZmZXIuc3ViYXJyYXkodGhpcy5wb3MsIHRoaXMucG9zICsgc2l6ZSArIDEpKTsKICAgIHRoaXMucG9zICs9IHNpemUgKyAxOwogIH0KICByZWFkSGV4TnVtYmVyKG51bSwgc2l6ZSkgewogICAgbGV0IGxhc3Q7CiAgICBjb25zdCBzdGFjayA9IHRoaXMudG1wQnVmOwogICAgbGV0IHNwID0gMDsKICAgIGRvIHsKICAgICAgY29uc3QgYiA9IHRoaXMucmVhZEJ5dGUoKTsKICAgICAgaWYgKGIgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJ1bmV4cGVjdGVkIEVPRiBpbiBiY21hcCIpOwogICAgICB9CiAgICAgIGxhc3QgPSAhKGIgJiAweDgwKTsKICAgICAgc3RhY2tbc3ArK10gPSBiICYgMHg3ZjsKICAgIH0gd2hpbGUgKCFsYXN0KTsKICAgIGxldCBpID0gc2l6ZSwKICAgICAgYnVmZmVyID0gMCwKICAgICAgYnVmZmVyU2l6ZSA9IDA7CiAgICB3aGlsZSAoaSA+PSAwKSB7CiAgICAgIHdoaWxlIChidWZmZXJTaXplIDwgOCAmJiBzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgYnVmZmVyIHw9IHN0YWNrWy0tc3BdIDw8IGJ1ZmZlclNpemU7CiAgICAgICAgYnVmZmVyU2l6ZSArPSA3OwogICAgICB9CiAgICAgIG51bVtpXSA9IGJ1ZmZlciAmIDI1NTsKICAgICAgaS0tOwogICAgICBidWZmZXIgPj49IDg7CiAgICAgIGJ1ZmZlclNpemUgLT0gODsKICAgIH0KICB9CiAgcmVhZEhleFNpZ25lZChudW0sIHNpemUpIHsKICAgIHRoaXMucmVhZEhleE51bWJlcihudW0sIHNpemUpOwogICAgY29uc3Qgc2lnbiA9IG51bVtzaXplXSAmIDEgPyAyNTUgOiAwOwogICAgbGV0IGMgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc2l6ZTsgaSsrKSB7CiAgICAgIGMgPSAoYyAmIDEpIDw8IDggfCBudW1baV07CiAgICAgIG51bVtpXSA9IGMgPj4gMSBeIHNpZ247CiAgICB9CiAgfQogIHJlYWRTdHJpbmcoKSB7CiAgICBjb25zdCBsZW4gPSB0aGlzLnJlYWROdW1iZXIoKSwKICAgICAgYnVmID0gbmV3IEFycmF5KGxlbik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGJ1ZltpXSA9IHRoaXMucmVhZE51bWJlcigpOwogICAgfQogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnVmKTsKICB9Cn0KY2xhc3MgQmluYXJ5Q01hcFJlYWRlciB7CiAgYXN5bmMgcHJvY2VzcyhkYXRhLCBjTWFwLCBleHRlbmQpIHsKICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBCaW5hcnlDTWFwU3RyZWFtKGRhdGEpOwogICAgY29uc3QgaGVhZGVyID0gc3RyZWFtLnJlYWRCeXRlKCk7CiAgICBjTWFwLnZlcnRpY2FsID0gISEoaGVhZGVyICYgMSk7CiAgICBsZXQgdXNlQ01hcCA9IG51bGw7CiAgICBjb25zdCBzdGFydCA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBjb25zdCBlbmQgPSBuZXcgVWludDhBcnJheShNQVhfTlVNX1NJWkUpOwogICAgY29uc3QgY2hhciA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBjb25zdCBjaGFyQ29kZSA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBjb25zdCB0bXAgPSBuZXcgVWludDhBcnJheShNQVhfTlVNX1NJWkUpOwogICAgbGV0IGNvZGU7CiAgICBsZXQgYjsKICAgIHdoaWxlICgoYiA9IHN0cmVhbS5yZWFkQnl0ZSgpKSA+PSAwKSB7CiAgICAgIGNvbnN0IHR5cGUgPSBiID4+IDU7CiAgICAgIGlmICh0eXBlID09PSA3KSB7CiAgICAgICAgc3dpdGNoIChiICYgMHgxZikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBzdHJlYW0ucmVhZFN0cmluZygpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdXNlQ01hcCA9IHN0cmVhbS5yZWFkU3RyaW5nKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBzZXF1ZW5jZSA9ICEhKGIgJiAweDEwKTsKICAgICAgY29uc3QgZGF0YVNpemUgPSBiICYgMTU7CiAgICAgIGlmIChkYXRhU2l6ZSArIDEgPiBNQVhfTlVNX1NJWkUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkJpbmFyeUNNYXBSZWFkZXIucHJvY2VzczogSW52YWxpZCBkYXRhU2l6ZS4iKTsKICAgICAgfQogICAgICBjb25zdCB1Y3MyRGF0YVNpemUgPSAxOwogICAgICBjb25zdCBzdWJpdGVtc0NvdW50ID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgIGNNYXAuYWRkQ29kZXNwYWNlUmFuZ2UoZGF0YVNpemUgKyAxLCBoZXhUb0ludChzdGFydCwgZGF0YVNpemUpLCBoZXhUb0ludChlbmQsIGRhdGFTaXplKSk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICBpbmNIZXgoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChzdGFydCwgZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgICBjTWFwLmFkZENvZGVzcGFjZVJhbmdlKGRhdGFTaXplICsgMSwgaGV4VG9JbnQoc3RhcnQsIGRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCBkYXRhU2l6ZSkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICBpbmNIZXgoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChzdGFydCwgZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgICBzdHJlYW0ucmVhZE51bWJlcigpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhciwgZGF0YVNpemUpOwogICAgICAgICAgY29kZSA9IHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICBjTWFwLm1hcE9uZShoZXhUb0ludChjaGFyLCBkYXRhU2l6ZSksIGNvZGUpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgaW5jSGV4KGNoYXIsIGRhdGFTaXplKTsKICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICAgIGFkZEhleChjaGFyLCB0bXAsIGRhdGFTaXplKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWRTaWduZWQoKSArIChjb2RlICsgMSk7CiAgICAgICAgICAgIGNNYXAubWFwT25lKGhleFRvSW50KGNoYXIsIGRhdGFTaXplKSwgY29kZSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgY29kZSA9IHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICBjTWFwLm1hcENpZFJhbmdlKGhleFRvSW50KHN0YXJ0LCBkYXRhU2l6ZSksIGhleFRvSW50KGVuZCwgZGF0YVNpemUpLCBjb2RlKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGluY0hleChlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzdGFydC5zZXQoZW5kKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgY29kZSA9IHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICAgIGNNYXAubWFwQ2lkUmFuZ2UoaGV4VG9JbnQoc3RhcnQsIGRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCBkYXRhU2l6ZSksIGNvZGUpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhciwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICBjTWFwLm1hcE9uZShoZXhUb0ludChjaGFyLCB1Y3MyRGF0YVNpemUpLCBoZXhUb1N0cihjaGFyQ29kZSwgZGF0YVNpemUpKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGluY0hleChjaGFyLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICBpZiAoIXNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIodG1wLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICAgIGFkZEhleChjaGFyLCB0bXAsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5jSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4U2lnbmVkKHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoY2hhckNvZGUsIHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICBjTWFwLm1hcE9uZShoZXhUb0ludChjaGFyLCB1Y3MyRGF0YVNpemUpLCBoZXhUb1N0cihjaGFyQ29kZSwgZGF0YVNpemUpKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNToKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KHN0YXJ0LCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChjaGFyQ29kZSwgZGF0YVNpemUpOwogICAgICAgICAgY01hcC5tYXBCZlJhbmdlKGhleFRvSW50KHN0YXJ0LCB1Y3MyRGF0YVNpemUpLCBoZXhUb0ludChlbmQsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgaW5jSGV4KGVuZCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICAgIGFkZEhleChzdGFydCwgZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0YXJ0LnNldChlbmQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGNNYXAubWFwQmZSYW5nZShoZXhUb0ludChzdGFydCwgdWNzMkRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCB1Y3MyRGF0YVNpemUpLCBoZXhUb1N0cihjaGFyQ29kZSwgZGF0YVNpemUpKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJpbmFyeUNNYXBSZWFkZXIucHJvY2VzcyAtIHVua25vd24gdHlwZTogJHt0eXBlfWApOwogICAgICB9CiAgICB9CiAgICBpZiAodXNlQ01hcCkgewogICAgICByZXR1cm4gZXh0ZW5kKHVzZUNNYXApOwogICAgfQogICAgcmV0dXJuIGNNYXA7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9hc2NpaV84NV9zdHJlYW0uanMKCgpjbGFzcyBBc2NpaTg1U3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICBpZiAobWF5YmVMZW5ndGgpIHsKICAgICAgbWF5YmVMZW5ndGggKj0gMC44OwogICAgfQogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIHRoaXMuaW5wdXQgPSBuZXcgVWludDhBcnJheSg1KTsKICB9CiAgcmVhZEJsb2NrKCkgewogICAgY29uc3QgVElMREFfQ0hBUiA9IDB4N2U7CiAgICBjb25zdCBaX0xPV0VSX0NIQVIgPSAweDdhOwogICAgY29uc3QgRU9GID0gLTE7CiAgICBjb25zdCBzdHIgPSB0aGlzLnN0cmVhbTsKICAgIGxldCBjID0gc3RyLmdldEJ5dGUoKTsKICAgIHdoaWxlIChpc1doaXRlU3BhY2UoYykpIHsKICAgICAgYyA9IHN0ci5nZXRCeXRlKCk7CiAgICB9CiAgICBpZiAoYyA9PT0gRU9GIHx8IGMgPT09IFRJTERBX0NIQVIpIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGxldCBidWZmZXIsIGk7CiAgICBpZiAoYyA9PT0gWl9MT1dFUl9DSEFSKSB7CiAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIDQpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgNDsgKytpKSB7CiAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCArIGldID0gMDsKICAgICAgfQogICAgICB0aGlzLmJ1ZmZlckxlbmd0aCArPSA0OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgaW5wdXQgPSB0aGlzLmlucHV0OwogICAgICBpbnB1dFswXSA9IGM7CiAgICAgIGZvciAoaSA9IDE7IGkgPCA1OyArK2kpIHsKICAgICAgICBjID0gc3RyLmdldEJ5dGUoKTsKICAgICAgICB3aGlsZSAoaXNXaGl0ZVNwYWNlKGMpKSB7CiAgICAgICAgICBjID0gc3RyLmdldEJ5dGUoKTsKICAgICAgICB9CiAgICAgICAgaW5wdXRbaV0gPSBjOwogICAgICAgIGlmIChjID09PSBFT0YgfHwgYyA9PT0gVElMREFfQ0hBUikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIGkgLSAxKTsKICAgICAgdGhpcy5idWZmZXJMZW5ndGggKz0gaSAtIDE7CiAgICAgIGlmIChpIDwgNSkgewogICAgICAgIGZvciAoOyBpIDwgNTsgKytpKSB7CiAgICAgICAgICBpbnB1dFtpXSA9IDB4MjEgKyA4NDsKICAgICAgICB9CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICB9CiAgICAgIGxldCB0ID0gMDsKICAgICAgZm9yIChpID0gMDsgaSA8IDU7ICsraSkgewogICAgICAgIHQgPSB0ICogODUgKyAoaW5wdXRbaV0gLSAweDIxKTsKICAgICAgfQogICAgICBmb3IgKGkgPSAzOyBpID49IDA7IC0taSkgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGggKyBpXSA9IHQgJiAweGZmOwogICAgICAgIHQgPj49IDg7CiAgICAgIH0KICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2FzY2lpX2hleF9zdHJlYW0uanMKCmNsYXNzIEFzY2lpSGV4U3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICBpZiAobWF5YmVMZW5ndGgpIHsKICAgICAgbWF5YmVMZW5ndGggKj0gMC41OwogICAgfQogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIHRoaXMuZmlyc3REaWdpdCA9IC0xOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCBVUFNUUkVBTV9CTE9DS19TSVpFID0gODAwMDsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZXMoVVBTVFJFQU1fQkxPQ0tfU0laRSk7CiAgICBpZiAoIWJ5dGVzLmxlbmd0aCkgewogICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1heERlY29kZUxlbmd0aCA9IGJ5dGVzLmxlbmd0aCArIDEgPj4gMTsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgbWF4RGVjb2RlTGVuZ3RoKTsKICAgIGxldCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGxldCBmaXJzdERpZ2l0ID0gdGhpcy5maXJzdERpZ2l0OwogICAgZm9yIChjb25zdCBjaCBvZiBieXRlcykgewogICAgICBsZXQgZGlnaXQ7CiAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzkpIHsKICAgICAgICBkaWdpdCA9IGNoICYgMHgwZjsKICAgICAgfSBlbHNlIGlmIChjaCA+PSAweDQxICYmIGNoIDw9IDB4NDYgfHwgY2ggPj0gMHg2MSAmJiBjaCA8PSAweDY2KSB7CiAgICAgICAgZGlnaXQgPSAoY2ggJiAweDBmKSArIDk7CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4M2UpIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGZpcnN0RGlnaXQgPCAwKSB7CiAgICAgICAgZmlyc3REaWdpdCA9IGRpZ2l0OwogICAgICB9IGVsc2UgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGgrK10gPSBmaXJzdERpZ2l0IDw8IDQgfCBkaWdpdDsKICAgICAgICBmaXJzdERpZ2l0ID0gLTE7CiAgICAgIH0KICAgIH0KICAgIGlmIChmaXJzdERpZ2l0ID49IDAgJiYgdGhpcy5lb2YpIHsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCsrXSA9IGZpcnN0RGlnaXQgPDwgNDsKICAgICAgZmlyc3REaWdpdCA9IC0xOwogICAgfQogICAgdGhpcy5maXJzdERpZ2l0ID0gZmlyc3REaWdpdDsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2NpdHQuanMKCmNvbnN0IGNjaXR0RU9MID0gLTI7CmNvbnN0IGNjaXR0RU9GID0gLTE7CmNvbnN0IHR3b0RpbVBhc3MgPSAwOwpjb25zdCB0d29EaW1Ib3JpeiA9IDE7CmNvbnN0IHR3b0RpbVZlcnQwID0gMjsKY29uc3QgdHdvRGltVmVydFIxID0gMzsKY29uc3QgdHdvRGltVmVydEwxID0gNDsKY29uc3QgdHdvRGltVmVydFIyID0gNTsKY29uc3QgdHdvRGltVmVydEwyID0gNjsKY29uc3QgdHdvRGltVmVydFIzID0gNzsKY29uc3QgdHdvRGltVmVydEwzID0gODsKY29uc3QgdHdvRGltVGFibGUgPSBbWy0xLCAtMV0sIFstMSwgLTFdLCBbNywgdHdvRGltVmVydEwzXSwgWzcsIHR3b0RpbVZlcnRSM10sIFs2LCB0d29EaW1WZXJ0TDJdLCBbNiwgdHdvRGltVmVydEwyXSwgWzYsIHR3b0RpbVZlcnRSMl0sIFs2LCB0d29EaW1WZXJ0UjJdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdXTsKY29uc3Qgd2hpdGVUYWJsZTEgPSBbWy0xLCAtMV0sIFsxMiwgY2NpdHRFT0xdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMiwgMTk4NF0sIFsxMiwgMjA0OF0sIFsxMiwgMjExMl0sIFsxMiwgMjE3Nl0sIFsxMiwgMjI0MF0sIFsxMiwgMjMwNF0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMiwgMjM2OF0sIFsxMiwgMjQzMl0sIFsxMiwgMjQ5Nl0sIFsxMiwgMjU2MF1dOwpjb25zdCB3aGl0ZVRhYmxlMiA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWzgsIDI5XSwgWzgsIDI5XSwgWzgsIDMwXSwgWzgsIDMwXSwgWzgsIDQ1XSwgWzgsIDQ1XSwgWzgsIDQ2XSwgWzgsIDQ2XSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzgsIDQ3XSwgWzgsIDQ3XSwgWzgsIDQ4XSwgWzgsIDQ4XSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzgsIDMzXSwgWzgsIDMzXSwgWzgsIDM0XSwgWzgsIDM0XSwgWzgsIDM1XSwgWzgsIDM1XSwgWzgsIDM2XSwgWzgsIDM2XSwgWzgsIDM3XSwgWzgsIDM3XSwgWzgsIDM4XSwgWzgsIDM4XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzgsIDMxXSwgWzgsIDMxXSwgWzgsIDMyXSwgWzgsIDMyXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs4LCA1M10sIFs4LCA1M10sIFs4LCA1NF0sIFs4LCA1NF0sIFs3LCAyNl0sIFs3LCAyNl0sIFs3LCAyNl0sIFs3LCAyNl0sIFs4LCAzOV0sIFs4LCAzOV0sIFs4LCA0MF0sIFs4LCA0MF0sIFs4LCA0MV0sIFs4LCA0MV0sIFs4LCA0Ml0sIFs4LCA0Ml0sIFs4LCA0M10sIFs4LCA0M10sIFs4LCA0NF0sIFs4LCA0NF0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyOF0sIFs3LCAyOF0sIFs3LCAyOF0sIFs3LCAyOF0sIFs4LCA2MV0sIFs4LCA2MV0sIFs4LCA2Ml0sIFs4LCA2Ml0sIFs4LCA2M10sIFs4LCA2M10sIFs4LCAwXSwgWzgsIDBdLCBbOCwgMzIwXSwgWzgsIDMyMF0sIFs4LCAzODRdLCBbOCwgMzg0XSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzcsIDI3XSwgWzcsIDI3XSwgWzcsIDI3XSwgWzcsIDI3XSwgWzgsIDU5XSwgWzgsIDU5XSwgWzgsIDYwXSwgWzgsIDYwXSwgWzksIDE0NzJdLCBbOSwgMTUzNl0sIFs5LCAxNjAwXSwgWzksIDE3MjhdLCBbNywgMThdLCBbNywgMThdLCBbNywgMThdLCBbNywgMThdLCBbNywgMjRdLCBbNywgMjRdLCBbNywgMjRdLCBbNywgMjRdLCBbOCwgNDldLCBbOCwgNDldLCBbOCwgNTBdLCBbOCwgNTBdLCBbOCwgNTFdLCBbOCwgNTFdLCBbOCwgNTJdLCBbOCwgNTJdLCBbNywgMjVdLCBbNywgMjVdLCBbNywgMjVdLCBbNywgMjVdLCBbOCwgNTVdLCBbOCwgNTVdLCBbOCwgNTZdLCBbOCwgNTZdLCBbOCwgNTddLCBbOCwgNTddLCBbOCwgNThdLCBbOCwgNThdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbOCwgNDQ4XSwgWzgsIDQ0OF0sIFs4LCA1MTJdLCBbOCwgNTEyXSwgWzksIDcwNF0sIFs5LCA3NjhdLCBbOCwgNjQwXSwgWzgsIDY0MF0sIFs4LCA1NzZdLCBbOCwgNTc2XSwgWzksIDgzMl0sIFs5LCA4OTZdLCBbOSwgOTYwXSwgWzksIDEwMjRdLCBbOSwgMTA4OF0sIFs5LCAxMTUyXSwgWzksIDEyMTZdLCBbOSwgMTI4MF0sIFs5LCAxMzQ0XSwgWzksIDE0MDhdLCBbNywgMjU2XSwgWzcsIDI1Nl0sIFs3LCAyNTZdLCBbNywgMjU2XSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddXTsKY29uc3QgYmxhY2tUYWJsZTEgPSBbWy0xLCAtMV0sIFstMSwgLTFdLCBbMTIsIGNjaXR0RU9MXSwgWzEyLCBjY2l0dEVPTF0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTIsIDE5ODRdLCBbMTIsIDE5ODRdLCBbMTIsIDIwNDhdLCBbMTIsIDIwNDhdLCBbMTIsIDIxMTJdLCBbMTIsIDIxMTJdLCBbMTIsIDIxNzZdLCBbMTIsIDIxNzZdLCBbMTIsIDIyNDBdLCBbMTIsIDIyNDBdLCBbMTIsIDIzMDRdLCBbMTIsIDIzMDRdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTIsIDIzNjhdLCBbMTIsIDIzNjhdLCBbMTIsIDI0MzJdLCBbMTIsIDI0MzJdLCBbMTIsIDI0OTZdLCBbMTIsIDI0OTZdLCBbMTIsIDI1NjBdLCBbMTIsIDI1NjBdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMiwgNTJdLCBbMTIsIDUyXSwgWzEzLCA2NDBdLCBbMTMsIDcwNF0sIFsxMywgNzY4XSwgWzEzLCA4MzJdLCBbMTIsIDU1XSwgWzEyLCA1NV0sIFsxMiwgNTZdLCBbMTIsIDU2XSwgWzEzLCAxMjgwXSwgWzEzLCAxMzQ0XSwgWzEzLCAxNDA4XSwgWzEzLCAxNDcyXSwgWzEyLCA1OV0sIFsxMiwgNTldLCBbMTIsIDYwXSwgWzEyLCA2MF0sIFsxMywgMTUzNl0sIFsxMywgMTYwMF0sIFsxMSwgMjRdLCBbMTEsIDI0XSwgWzExLCAyNF0sIFsxMSwgMjRdLCBbMTEsIDI1XSwgWzExLCAyNV0sIFsxMSwgMjVdLCBbMTEsIDI1XSwgWzEzLCAxNjY0XSwgWzEzLCAxNzI4XSwgWzEyLCAzMjBdLCBbMTIsIDMyMF0sIFsxMiwgMzg0XSwgWzEyLCAzODRdLCBbMTIsIDQ0OF0sIFsxMiwgNDQ4XSwgWzEzLCA1MTJdLCBbMTMsIDU3Nl0sIFsxMiwgNTNdLCBbMTIsIDUzXSwgWzEyLCA1NF0sIFsxMiwgNTRdLCBbMTMsIDg5Nl0sIFsxMywgOTYwXSwgWzEzLCAxMDI0XSwgWzEzLCAxMDg4XSwgWzEzLCAxMTUyXSwgWzEzLCAxMjE2XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdXTsKY29uc3QgYmxhY2tUYWJsZTIgPSBbWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzExLCAyM10sIFsxMSwgMjNdLCBbMTIsIDUwXSwgWzEyLCA1MV0sIFsxMiwgNDRdLCBbMTIsIDQ1XSwgWzEyLCA0Nl0sIFsxMiwgNDddLCBbMTIsIDU3XSwgWzEyLCA1OF0sIFsxMiwgNjFdLCBbMTIsIDI1Nl0sIFsxMCwgMTZdLCBbMTAsIDE2XSwgWzEwLCAxNl0sIFsxMCwgMTZdLCBbMTAsIDE3XSwgWzEwLCAxN10sIFsxMCwgMTddLCBbMTAsIDE3XSwgWzEyLCA0OF0sIFsxMiwgNDldLCBbMTIsIDYyXSwgWzEyLCA2M10sIFsxMiwgMzBdLCBbMTIsIDMxXSwgWzEyLCAzMl0sIFsxMiwgMzNdLCBbMTIsIDQwXSwgWzEyLCA0MV0sIFsxMSwgMjJdLCBbMTEsIDIyXSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzEyLCAxMjhdLCBbMTIsIDE5Ml0sIFsxMiwgMjZdLCBbMTIsIDI3XSwgWzEyLCAyOF0sIFsxMiwgMjldLCBbMTEsIDE5XSwgWzExLCAxOV0sIFsxMSwgMjBdLCBbMTEsIDIwXSwgWzEyLCAzNF0sIFsxMiwgMzVdLCBbMTIsIDM2XSwgWzEyLCAzN10sIFsxMiwgMzhdLCBbMTIsIDM5XSwgWzExLCAyMV0sIFsxMSwgMjFdLCBbMTIsIDQyXSwgWzEyLCA0M10sIFsxMCwgMF0sIFsxMCwgMF0sIFsxMCwgMF0sIFsxMCwgMF0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl1dOwpjb25zdCBibGFja1RhYmxlMyA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWzYsIDldLCBbNiwgOF0sIFs1LCA3XSwgWzUsIDddLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXV07CmNsYXNzIENDSVRURmF4RGVjb2RlciB7CiAgY29uc3RydWN0b3Ioc291cmNlLCBvcHRpb25zID0ge30pIHsKICAgIGlmICh0eXBlb2Ygc291cmNlPy5uZXh0ICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQ0NJVFRGYXhEZWNvZGVyIC0gaW52YWxpZCAic291cmNlIiBwYXJhbWV0ZXIuJyk7CiAgICB9CiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsKICAgIHRoaXMuZW9mID0gZmFsc2U7CiAgICB0aGlzLmVuY29kaW5nID0gb3B0aW9ucy5LIHx8IDA7CiAgICB0aGlzLmVvbGluZSA9IG9wdGlvbnMuRW5kT2ZMaW5lIHx8IGZhbHNlOwogICAgdGhpcy5ieXRlQWxpZ24gPSBvcHRpb25zLkVuY29kZWRCeXRlQWxpZ24gfHwgZmFsc2U7CiAgICB0aGlzLmNvbHVtbnMgPSBvcHRpb25zLkNvbHVtbnMgfHwgMTcyODsKICAgIHRoaXMucm93cyA9IG9wdGlvbnMuUm93cyB8fCAwOwogICAgdGhpcy5lb2Jsb2NrID0gb3B0aW9ucy5FbmRPZkJsb2NrID8/IHRydWU7CiAgICB0aGlzLmJsYWNrID0gb3B0aW9ucy5CbGFja0lzMSB8fCBmYWxzZTsKICAgIHRoaXMuY29kaW5nTGluZSA9IG5ldyBVaW50MzJBcnJheSh0aGlzLmNvbHVtbnMgKyAxKTsKICAgIHRoaXMucmVmTGluZSA9IG5ldyBVaW50MzJBcnJheSh0aGlzLmNvbHVtbnMgKyAyKTsKICAgIHRoaXMuY29kaW5nTGluZVswXSA9IHRoaXMuY29sdW1uczsKICAgIHRoaXMuY29kaW5nUG9zID0gMDsKICAgIHRoaXMucm93ID0gMDsKICAgIHRoaXMubmV4dExpbmUyRCA9IHRoaXMuZW5jb2RpbmcgPCAwOwogICAgdGhpcy5pbnB1dEJpdHMgPSAwOwogICAgdGhpcy5pbnB1dEJ1ZiA9IDA7CiAgICB0aGlzLm91dHB1dEJpdHMgPSAwOwogICAgdGhpcy5yb3dzRG9uZSA9IGZhbHNlOwogICAgbGV0IGNvZGUxOwogICAgd2hpbGUgKChjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKSkgPT09IDApIHsKICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgIH0KICAgIGlmIChjb2RlMSA9PT0gMSkgewogICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgIH0KICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICB0aGlzLm5leHRMaW5lMkQgPSAhdGhpcy5fbG9va0JpdHMoMSk7CiAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICB9CiAgfQogIHJlYWROZXh0Q2hhcigpIHsKICAgIGlmICh0aGlzLmVvZikgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBjb25zdCByZWZMaW5lID0gdGhpcy5yZWZMaW5lOwogICAgY29uc3QgY29kaW5nTGluZSA9IHRoaXMuY29kaW5nTGluZTsKICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbHVtbnM7CiAgICBsZXQgcmVmUG9zLCBibGFja1BpeGVscywgYml0cywgaTsKICAgIGlmICh0aGlzLm91dHB1dEJpdHMgPT09IDApIHsKICAgICAgaWYgKHRoaXMucm93c0RvbmUpIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHRoaXMuZXJyID0gZmFsc2U7CiAgICAgIGxldCBjb2RlMSwgY29kZTIsIGNvZGUzOwogICAgICBpZiAodGhpcy5uZXh0TGluZTJEKSB7CiAgICAgICAgZm9yIChpID0gMDsgY29kaW5nTGluZVtpXSA8IGNvbHVtbnM7ICsraSkgewogICAgICAgICAgcmVmTGluZVtpXSA9IGNvZGluZ0xpbmVbaV07CiAgICAgICAgfQogICAgICAgIHJlZkxpbmVbaSsrXSA9IGNvbHVtbnM7CiAgICAgICAgcmVmTGluZVtpXSA9IGNvbHVtbnM7CiAgICAgICAgY29kaW5nTGluZVswXSA9IDA7CiAgICAgICAgdGhpcy5jb2RpbmdQb3MgPSAwOwogICAgICAgIHJlZlBvcyA9IDA7CiAgICAgICAgYmxhY2tQaXhlbHMgPSAwOwogICAgICAgIHdoaWxlIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgIGNvZGUxID0gdGhpcy5fZ2V0VHdvRGltQ29kZSgpOwogICAgICAgICAgc3dpdGNoIChjb2RlMSkgewogICAgICAgICAgICBjYXNlIHR3b0RpbVBhc3M6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zICsgMV0sIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBpZiAocmVmTGluZVtyZWZQb3MgKyAxXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1Ib3JpejoKICAgICAgICAgICAgICBjb2RlMSA9IGNvZGUyID0gMDsKICAgICAgICAgICAgICBpZiAoYmxhY2tQaXhlbHMpIHsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgY29kZTEgKz0gY29kZTMgPSB0aGlzLl9nZXRCbGFja0NvZGUoKTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgY29kZTIgKz0gY29kZTMgPSB0aGlzLl9nZXRXaGl0ZUNvZGUoKTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICBjb2RlMSArPSBjb2RlMyA9IHRoaXMuX2dldFdoaXRlQ29kZSgpOwogICAgICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICBjb2RlMiArPSBjb2RlMyA9IHRoaXMuX2dldEJsYWNrQ29kZSgpOwogICAgICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gKyBjb2RlMSwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSArIGNvZGUyLCBibGFja1BpeGVscyBeIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0UjM6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSArIDMsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0UjI6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSArIDIsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0UjE6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSArIDEsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0MDoKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMocmVmTGluZVtyZWZQb3NdLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydEwzOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVsc05lZyhyZWZMaW5lW3JlZlBvc10gLSAzLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICBpZiAocmVmUG9zID4gMCkgewogICAgICAgICAgICAgICAgICAtLXJlZlBvczsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0TDI6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzTmVnKHJlZkxpbmVbcmVmUG9zXSAtIDIsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIGlmIChyZWZQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgIC0tcmVmUG9zOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRMMToKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHNOZWcocmVmTGluZVtyZWZQb3NdIC0gMSwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgaWYgKHJlZlBvcyA+IDApIHsKICAgICAgICAgICAgICAgICAgLS1yZWZQb3M7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgY2NpdHRFT0Y6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvbHVtbnMsIDApOwogICAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBpbmZvKCJiYWQgMmQgY29kZSIpOwogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhjb2x1bW5zLCAwKTsKICAgICAgICAgICAgICB0aGlzLmVyciA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvZGluZ0xpbmVbMF0gPSAwOwogICAgICAgIHRoaXMuY29kaW5nUG9zID0gMDsKICAgICAgICBibGFja1BpeGVscyA9IDA7CiAgICAgICAgd2hpbGUgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgY29kZTEgPSAwOwogICAgICAgICAgaWYgKGJsYWNrUGl4ZWxzKSB7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBjb2RlMSArPSBjb2RlMyA9IHRoaXMuX2dldEJsYWNrQ29kZSgpOwogICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgY29kZTEgKz0gY29kZTMgPSB0aGlzLl9nZXRXaGl0ZUNvZGUoKTsKICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICsgY29kZTEsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBnb3RFT0wgPSBmYWxzZTsKICAgICAgaWYgKHRoaXMuYnl0ZUFsaWduKSB7CiAgICAgICAgdGhpcy5pbnB1dEJpdHMgJj0gfjc7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmVvYmxvY2sgJiYgdGhpcy5yb3cgPT09IHRoaXMucm93cyAtIDEpIHsKICAgICAgICB0aGlzLnJvd3NEb25lID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgICBpZiAodGhpcy5lb2xpbmUpIHsKICAgICAgICAgIHdoaWxlIChjb2RlMSAhPT0gY2NpdHRFT0YgJiYgY29kZTEgIT09IDEpIHsKICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdoaWxlIChjb2RlMSA9PT0gMCkgewogICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNvZGUxID09PSAxKSB7CiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICAgIGdvdEVPTCA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChjb2RlMSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmVvZiAmJiB0aGlzLmVuY29kaW5nID4gMCAmJiAhdGhpcy5yb3dzRG9uZSkgewogICAgICAgIHRoaXMubmV4dExpbmUyRCA9ICF0aGlzLl9sb29rQml0cygxKTsKICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmVvYmxvY2sgJiYgZ290RU9MICYmIHRoaXMuYnl0ZUFsaWduKSB7CiAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgaWYgKGNvZGUxID09PSAxKSB7CiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICAgICAgICB0aGlzLl9sb29rQml0cygxKTsKICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nID49IDApIHsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDQ7ICsraSkgewogICAgICAgICAgICAgIGNvZGUxID0gdGhpcy5fbG9va0JpdHMoMTIpOwogICAgICAgICAgICAgIGlmIChjb2RlMSAhPT0gMSkgewogICAgICAgICAgICAgICAgaW5mbygiYmFkIHJ0YyBjb2RlOiAiICsgY29kZTEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICAgICAgICBpZiAodGhpcy5lbmNvZGluZyA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2xvb2tCaXRzKDEpOwogICAgICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5lcnIgJiYgdGhpcy5lb2xpbmUpIHsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMyk7CiAgICAgICAgICBpZiAoY29kZTEgPT09IGNjaXR0RU9GKSB7CiAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvZGUxID4+IDEgPT09IDEpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICBpZiAodGhpcy5lbmNvZGluZyA+IDApIHsKICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgICAgICB0aGlzLm5leHRMaW5lMkQgPSAhKGNvZGUxICYgMSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMub3V0cHV0Qml0cyA9IGNvZGluZ0xpbmVbMF0gPiAwID8gY29kaW5nTGluZVt0aGlzLmNvZGluZ1BvcyA9IDBdIDogY29kaW5nTGluZVt0aGlzLmNvZGluZ1BvcyA9IDFdOwogICAgICB0aGlzLnJvdysrOwogICAgfQogICAgbGV0IGM7CiAgICBpZiAodGhpcy5vdXRwdXRCaXRzID49IDgpIHsKICAgICAgYyA9IHRoaXMuY29kaW5nUG9zICYgMSA/IDAgOiAweGZmOwogICAgICB0aGlzLm91dHB1dEJpdHMgLT0gODsKICAgICAgaWYgKHRoaXMub3V0cHV0Qml0cyA9PT0gMCAmJiBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICB0aGlzLmNvZGluZ1BvcysrOwogICAgICAgIHRoaXMub3V0cHV0Qml0cyA9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIC0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1BvcyAtIDFdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBiaXRzID0gODsKICAgICAgYyA9IDA7CiAgICAgIGRvIHsKICAgICAgICBpZiAodHlwZW9mIHRoaXMub3V0cHV0Qml0cyAhPT0gIm51bWJlciIpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignSW52YWxpZCAvQ0NJVFRGYXhEZWNvZGUgZGF0YSwgIm91dHB1dEJpdHMiIG11c3QgYmUgYSBudW1iZXIuJyk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLm91dHB1dEJpdHMgPiBiaXRzKSB7CiAgICAgICAgICBjIDw8PSBiaXRzOwogICAgICAgICAgaWYgKCEodGhpcy5jb2RpbmdQb3MgJiAxKSkgewogICAgICAgICAgICBjIHw9IDB4ZmYgPj4gOCAtIGJpdHM7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgLT0gYml0czsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjIDw8PSB0aGlzLm91dHB1dEJpdHM7CiAgICAgICAgICBpZiAoISh0aGlzLmNvZGluZ1BvcyAmIDEpKSB7CiAgICAgICAgICAgIGMgfD0gMHhmZiA+PiA4IC0gdGhpcy5vdXRwdXRCaXRzOwogICAgICAgICAgfQogICAgICAgICAgYml0cyAtPSB0aGlzLm91dHB1dEJpdHM7CiAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgPSAwOwogICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICB0aGlzLmNvZGluZ1BvcysrOwogICAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgPSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAtIGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3MgLSAxXTsKICAgICAgICAgIH0gZWxzZSBpZiAoYml0cyA+IDApIHsKICAgICAgICAgICAgYyA8PD0gYml0czsKICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlIChiaXRzKTsKICAgIH0KICAgIGlmICh0aGlzLmJsYWNrKSB7CiAgICAgIGMgXj0gMHhmZjsKICAgIH0KICAgIHJldHVybiBjOwogIH0KICBfYWRkUGl4ZWxzKGExLCBibGFja1BpeGVscykgewogICAgY29uc3QgY29kaW5nTGluZSA9IHRoaXMuY29kaW5nTGluZTsKICAgIGxldCBjb2RpbmdQb3MgPSB0aGlzLmNvZGluZ1BvczsKICAgIGlmIChhMSA+IGNvZGluZ0xpbmVbY29kaW5nUG9zXSkgewogICAgICBpZiAoYTEgPiB0aGlzLmNvbHVtbnMpIHsKICAgICAgICBpbmZvKCJyb3cgaXMgd3JvbmcgbGVuZ3RoIik7CiAgICAgICAgdGhpcy5lcnIgPSB0cnVlOwogICAgICAgIGExID0gdGhpcy5jb2x1bW5zOwogICAgICB9CiAgICAgIGlmIChjb2RpbmdQb3MgJiAxIF4gYmxhY2tQaXhlbHMpIHsKICAgICAgICArK2NvZGluZ1BvczsKICAgICAgfQogICAgICBjb2RpbmdMaW5lW2NvZGluZ1Bvc10gPSBhMTsKICAgIH0KICAgIHRoaXMuY29kaW5nUG9zID0gY29kaW5nUG9zOwogIH0KICBfYWRkUGl4ZWxzTmVnKGExLCBibGFja1BpeGVscykgewogICAgY29uc3QgY29kaW5nTGluZSA9IHRoaXMuY29kaW5nTGluZTsKICAgIGxldCBjb2RpbmdQb3MgPSB0aGlzLmNvZGluZ1BvczsKICAgIGlmIChhMSA+IGNvZGluZ0xpbmVbY29kaW5nUG9zXSkgewogICAgICBpZiAoYTEgPiB0aGlzLmNvbHVtbnMpIHsKICAgICAgICBpbmZvKCJyb3cgaXMgd3JvbmcgbGVuZ3RoIik7CiAgICAgICAgdGhpcy5lcnIgPSB0cnVlOwogICAgICAgIGExID0gdGhpcy5jb2x1bW5zOwogICAgICB9CiAgICAgIGlmIChjb2RpbmdQb3MgJiAxIF4gYmxhY2tQaXhlbHMpIHsKICAgICAgICArK2NvZGluZ1BvczsKICAgICAgfQogICAgICBjb2RpbmdMaW5lW2NvZGluZ1Bvc10gPSBhMTsKICAgIH0gZWxzZSBpZiAoYTEgPCBjb2RpbmdMaW5lW2NvZGluZ1Bvc10pIHsKICAgICAgaWYgKGExIDwgMCkgewogICAgICAgIGluZm8oImludmFsaWQgY29kZSIpOwogICAgICAgIHRoaXMuZXJyID0gdHJ1ZTsKICAgICAgICBhMSA9IDA7CiAgICAgIH0KICAgICAgd2hpbGUgKGNvZGluZ1BvcyA+IDAgJiYgYTEgPCBjb2RpbmdMaW5lW2NvZGluZ1BvcyAtIDFdKSB7CiAgICAgICAgLS1jb2RpbmdQb3M7CiAgICAgIH0KICAgICAgY29kaW5nTGluZVtjb2RpbmdQb3NdID0gYTE7CiAgICB9CiAgICB0aGlzLmNvZGluZ1BvcyA9IGNvZGluZ1BvczsKICB9CiAgX2ZpbmRUYWJsZUNvZGUoc3RhcnQsIGVuZCwgdGFibGUsIGxpbWl0KSB7CiAgICBjb25zdCBsaW1pdFZhbHVlID0gbGltaXQgfHwgMDsKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQ7ICsraSkgewogICAgICBsZXQgY29kZSA9IHRoaXMuX2xvb2tCaXRzKGkpOwogICAgICBpZiAoY29kZSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICByZXR1cm4gW3RydWUsIDEsIGZhbHNlXTsKICAgICAgfQogICAgICBpZiAoaSA8IGVuZCkgewogICAgICAgIGNvZGUgPDw9IGVuZCAtIGk7CiAgICAgIH0KICAgICAgaWYgKCFsaW1pdFZhbHVlIHx8IGNvZGUgPj0gbGltaXRWYWx1ZSkgewogICAgICAgIGNvbnN0IHAgPSB0YWJsZVtjb2RlIC0gbGltaXRWYWx1ZV07CiAgICAgICAgaWYgKHBbMF0gPT09IGkpIHsKICAgICAgICAgIHRoaXMuX2VhdEJpdHMoaSk7CiAgICAgICAgICByZXR1cm4gW3RydWUsIHBbMV0sIHRydWVdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIFtmYWxzZSwgMCwgZmFsc2VdOwogIH0KICBfZ2V0VHdvRGltQ29kZSgpIHsKICAgIGxldCBjb2RlID0gMDsKICAgIGxldCBwOwogICAgaWYgKHRoaXMuZW9ibG9jaykgewogICAgICBjb2RlID0gdGhpcy5fbG9va0JpdHMoNyk7CiAgICAgIHAgPSB0d29EaW1UYWJsZVtjb2RlXTsKICAgICAgaWYgKHA/LlswXSA+IDApIHsKICAgICAgICB0aGlzLl9lYXRCaXRzKHBbMF0pOwogICAgICAgIHJldHVybiBwWzFdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDEsIDcsIHR3b0RpbVRhYmxlKTsKICAgICAgaWYgKHJlc3VsdFswXSAmJiByZXN1bHRbMl0pIHsKICAgICAgICByZXR1cm4gcmVzdWx0WzFdOwogICAgICB9CiAgICB9CiAgICBpbmZvKCJCYWQgdHdvIGRpbSBjb2RlIik7CiAgICByZXR1cm4gY2NpdHRFT0Y7CiAgfQogIF9nZXRXaGl0ZUNvZGUoKSB7CiAgICBsZXQgY29kZSA9IDA7CiAgICBsZXQgcDsKICAgIGlmICh0aGlzLmVvYmxvY2spIHsKICAgICAgY29kZSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgaWYgKGNvZGUgPT09IGNjaXR0RU9GKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KICAgICAgcCA9IGNvZGUgPj4gNSA9PT0gMCA/IHdoaXRlVGFibGUxW2NvZGVdIDogd2hpdGVUYWJsZTJbY29kZSA+PiAzXTsKICAgICAgaWYgKHBbMF0gPiAwKSB7CiAgICAgICAgdGhpcy5fZWF0Qml0cyhwWzBdKTsKICAgICAgICByZXR1cm4gcFsxXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMSwgOSwgd2hpdGVUYWJsZTIpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDExLCAxMiwgd2hpdGVUYWJsZTEpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgfQogICAgaW5mbygiYmFkIHdoaXRlIGNvZGUiKTsKICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICByZXR1cm4gMTsKICB9CiAgX2dldEJsYWNrQ29kZSgpIHsKICAgIGxldCBjb2RlLCBwOwogICAgaWYgKHRoaXMuZW9ibG9jaykgewogICAgICBjb2RlID0gdGhpcy5fbG9va0JpdHMoMTMpOwogICAgICBpZiAoY29kZSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgICBpZiAoY29kZSA+PiA3ID09PSAwKSB7CiAgICAgICAgcCA9IGJsYWNrVGFibGUxW2NvZGVdOwogICAgICB9IGVsc2UgaWYgKGNvZGUgPj4gOSA9PT0gMCAmJiBjb2RlID4+IDcgIT09IDApIHsKICAgICAgICBwID0gYmxhY2tUYWJsZTJbKGNvZGUgPj4gMSkgLSA2NF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcCA9IGJsYWNrVGFibGUzW2NvZGUgPj4gN107CiAgICAgIH0KICAgICAgaWYgKHBbMF0gPiAwKSB7CiAgICAgICAgdGhpcy5fZWF0Qml0cyhwWzBdKTsKICAgICAgICByZXR1cm4gcFsxXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMiwgNiwgYmxhY2tUYWJsZTMpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDcsIDEyLCBibGFja1RhYmxlMiwgNjQpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDEwLCAxMywgYmxhY2tUYWJsZTEpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgfQogICAgaW5mbygiYmFkIGJsYWNrIGNvZGUiKTsKICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICByZXR1cm4gMTsKICB9CiAgX2xvb2tCaXRzKG4pIHsKICAgIGxldCBjOwogICAgd2hpbGUgKHRoaXMuaW5wdXRCaXRzIDwgbikgewogICAgICBpZiAoKGMgPSB0aGlzLnNvdXJjZS5uZXh0KCkpID09PSAtMSkgewogICAgICAgIGlmICh0aGlzLmlucHV0Qml0cyA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIGNjaXR0RU9GOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5pbnB1dEJ1ZiA8PCBuIC0gdGhpcy5pbnB1dEJpdHMgJiAweGZmZmYgPj4gMTYgLSBuOwogICAgICB9CiAgICAgIHRoaXMuaW5wdXRCdWYgPSB0aGlzLmlucHV0QnVmIDw8IDggfCBjOwogICAgICB0aGlzLmlucHV0Qml0cyArPSA4OwogICAgfQogICAgcmV0dXJuIHRoaXMuaW5wdXRCdWYgPj4gdGhpcy5pbnB1dEJpdHMgLSBuICYgMHhmZmZmID4+IDE2IC0gbjsKICB9CiAgX2VhdEJpdHMobikgewogICAgaWYgKCh0aGlzLmlucHV0Qml0cyAtPSBuKSA8IDApIHsKICAgICAgdGhpcy5pbnB1dEJpdHMgPSAwOwogICAgfQogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2NpdHRfc3RyZWFtLmpzCgoKCmNsYXNzIENDSVRURmF4U3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyZWFtID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICBpZiAoIShwYXJhbXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICBwYXJhbXMgPSBEaWN0LmVtcHR5OwogICAgfQogICAgY29uc3Qgc291cmNlID0gewogICAgICBuZXh0KCkgewogICAgICAgIHJldHVybiBzdHIuZ2V0Qnl0ZSgpOwogICAgICB9CiAgICB9OwogICAgdGhpcy5jY2l0dEZheERlY29kZXIgPSBuZXcgQ0NJVFRGYXhEZWNvZGVyKHNvdXJjZSwgewogICAgICBLOiBwYXJhbXMuZ2V0KCJLIiksCiAgICAgIEVuZE9mTGluZTogcGFyYW1zLmdldCgiRW5kT2ZMaW5lIiksCiAgICAgIEVuY29kZWRCeXRlQWxpZ246IHBhcmFtcy5nZXQoIkVuY29kZWRCeXRlQWxpZ24iKSwKICAgICAgQ29sdW1uczogcGFyYW1zLmdldCgiQ29sdW1ucyIpLAogICAgICBSb3dzOiBwYXJhbXMuZ2V0KCJSb3dzIiksCiAgICAgIEVuZE9mQmxvY2s6IHBhcmFtcy5nZXQoIkVuZE9mQmxvY2siKSwKICAgICAgQmxhY2tJczE6IHBhcmFtcy5nZXQoIkJsYWNrSXMxIikKICAgIH0pOwogIH0KICByZWFkQmxvY2soKSB7CiAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgIGNvbnN0IGMgPSB0aGlzLmNjaXR0RmF4RGVjb2Rlci5yZWFkTmV4dENoYXIoKTsKICAgICAgaWYgKGMgPT09IC0xKSB7CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmVuc3VyZUJ1ZmZlcih0aGlzLmJ1ZmZlckxlbmd0aCArIDEpOwogICAgICB0aGlzLmJ1ZmZlclt0aGlzLmJ1ZmZlckxlbmd0aCsrXSA9IGM7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9mbGF0ZV9zdHJlYW0uanMKCgoKY29uc3QgY29kZUxlbkNvZGVNYXAgPSBuZXcgSW50MzJBcnJheShbMTYsIDE3LCAxOCwgMCwgOCwgNywgOSwgNiwgMTAsIDUsIDExLCA0LCAxMiwgMywgMTMsIDIsIDE0LCAxLCAxNV0pOwpjb25zdCBsZW5ndGhEZWNvZGUgPSBuZXcgSW50MzJBcnJheShbMHgwMDAwMywgMHgwMDAwNCwgMHgwMDAwNSwgMHgwMDAwNiwgMHgwMDAwNywgMHgwMDAwOCwgMHgwMDAwOSwgMHgwMDAwYSwgMHgxMDAwYiwgMHgxMDAwZCwgMHgxMDAwZiwgMHgxMDAxMSwgMHgyMDAxMywgMHgyMDAxNywgMHgyMDAxYiwgMHgyMDAxZiwgMHgzMDAyMywgMHgzMDAyYiwgMHgzMDAzMywgMHgzMDAzYiwgMHg0MDA0MywgMHg0MDA1MywgMHg0MDA2MywgMHg0MDA3MywgMHg1MDA4MywgMHg1MDBhMywgMHg1MDBjMywgMHg1MDBlMywgMHgwMDEwMiwgMHgwMDEwMiwgMHgwMDEwMl0pOwpjb25zdCBkaXN0RGVjb2RlID0gbmV3IEludDMyQXJyYXkoWzB4MDAwMDEsIDB4MDAwMDIsIDB4MDAwMDMsIDB4MDAwMDQsIDB4MTAwMDUsIDB4MTAwMDcsIDB4MjAwMDksIDB4MjAwMGQsIDB4MzAwMTEsIDB4MzAwMTksIDB4NDAwMjEsIDB4NDAwMzEsIDB4NTAwNDEsIDB4NTAwNjEsIDB4NjAwODEsIDB4NjAwYzEsIDB4NzAxMDEsIDB4NzAxODEsIDB4ODAyMDEsIDB4ODAzMDEsIDB4OTA0MDEsIDB4OTA2MDEsIDB4YTA4MDEsIDB4YTBjMDEsIDB4YjEwMDEsIDB4YjE4MDEsIDB4YzIwMDEsIDB4YzMwMDEsIDB4ZDQwMDEsIDB4ZDYwMDFdKTsKY29uc3QgZml4ZWRMaXRDb2RlVGFiID0gW25ldyBJbnQzMkFycmF5KFsweDcwMTAwLCAweDgwMDUwLCAweDgwMDEwLCAweDgwMTE4LCAweDcwMTEwLCAweDgwMDcwLCAweDgwMDMwLCAweDkwMGMwLCAweDcwMTA4LCAweDgwMDYwLCAweDgwMDIwLCAweDkwMGEwLCAweDgwMDAwLCAweDgwMDgwLCAweDgwMDQwLCAweDkwMGUwLCAweDcwMTA0LCAweDgwMDU4LCAweDgwMDE4LCAweDkwMDkwLCAweDcwMTE0LCAweDgwMDc4LCAweDgwMDM4LCAweDkwMGQwLCAweDcwMTBjLCAweDgwMDY4LCAweDgwMDI4LCAweDkwMGIwLCAweDgwMDA4LCAweDgwMDg4LCAweDgwMDQ4LCAweDkwMGYwLCAweDcwMTAyLCAweDgwMDU0LCAweDgwMDE0LCAweDgwMTFjLCAweDcwMTEyLCAweDgwMDc0LCAweDgwMDM0LCAweDkwMGM4LCAweDcwMTBhLCAweDgwMDY0LCAweDgwMDI0LCAweDkwMGE4LCAweDgwMDA0LCAweDgwMDg0LCAweDgwMDQ0LCAweDkwMGU4LCAweDcwMTA2LCAweDgwMDVjLCAweDgwMDFjLCAweDkwMDk4LCAweDcwMTE2LCAweDgwMDdjLCAweDgwMDNjLCAweDkwMGQ4LCAweDcwMTBlLCAweDgwMDZjLCAweDgwMDJjLCAweDkwMGI4LCAweDgwMDBjLCAweDgwMDhjLCAweDgwMDRjLCAweDkwMGY4LCAweDcwMTAxLCAweDgwMDUyLCAweDgwMDEyLCAweDgwMTFhLCAweDcwMTExLCAweDgwMDcyLCAweDgwMDMyLCAweDkwMGM0LCAweDcwMTA5LCAweDgwMDYyLCAweDgwMDIyLCAweDkwMGE0LCAweDgwMDAyLCAweDgwMDgyLCAweDgwMDQyLCAweDkwMGU0LCAweDcwMTA1LCAweDgwMDVhLCAweDgwMDFhLCAweDkwMDk0LCAweDcwMTE1LCAweDgwMDdhLCAweDgwMDNhLCAweDkwMGQ0LCAweDcwMTBkLCAweDgwMDZhLCAweDgwMDJhLCAweDkwMGI0LCAweDgwMDBhLCAweDgwMDhhLCAweDgwMDRhLCAweDkwMGY0LCAweDcwMTAzLCAweDgwMDU2LCAweDgwMDE2LCAweDgwMTFlLCAweDcwMTEzLCAweDgwMDc2LCAweDgwMDM2LCAweDkwMGNjLCAweDcwMTBiLCAweDgwMDY2LCAweDgwMDI2LCAweDkwMGFjLCAweDgwMDA2LCAweDgwMDg2LCAweDgwMDQ2LCAweDkwMGVjLCAweDcwMTA3LCAweDgwMDVlLCAweDgwMDFlLCAweDkwMDljLCAweDcwMTE3LCAweDgwMDdlLCAweDgwMDNlLCAweDkwMGRjLCAweDcwMTBmLCAweDgwMDZlLCAweDgwMDJlLCAweDkwMGJjLCAweDgwMDBlLCAweDgwMDhlLCAweDgwMDRlLCAweDkwMGZjLCAweDcwMTAwLCAweDgwMDUxLCAweDgwMDExLCAweDgwMTE5LCAweDcwMTEwLCAweDgwMDcxLCAweDgwMDMxLCAweDkwMGMyLCAweDcwMTA4LCAweDgwMDYxLCAweDgwMDIxLCAweDkwMGEyLCAweDgwMDAxLCAweDgwMDgxLCAweDgwMDQxLCAweDkwMGUyLCAweDcwMTA0LCAweDgwMDU5LCAweDgwMDE5LCAweDkwMDkyLCAweDcwMTE0LCAweDgwMDc5LCAweDgwMDM5LCAweDkwMGQyLCAweDcwMTBjLCAweDgwMDY5LCAweDgwMDI5LCAweDkwMGIyLCAweDgwMDA5LCAweDgwMDg5LCAweDgwMDQ5LCAweDkwMGYyLCAweDcwMTAyLCAweDgwMDU1LCAweDgwMDE1LCAweDgwMTFkLCAweDcwMTEyLCAweDgwMDc1LCAweDgwMDM1LCAweDkwMGNhLCAweDcwMTBhLCAweDgwMDY1LCAweDgwMDI1LCAweDkwMGFhLCAweDgwMDA1LCAweDgwMDg1LCAweDgwMDQ1LCAweDkwMGVhLCAweDcwMTA2LCAweDgwMDVkLCAweDgwMDFkLCAweDkwMDlhLCAweDcwMTE2LCAweDgwMDdkLCAweDgwMDNkLCAweDkwMGRhLCAweDcwMTBlLCAweDgwMDZkLCAweDgwMDJkLCAweDkwMGJhLCAweDgwMDBkLCAweDgwMDhkLCAweDgwMDRkLCAweDkwMGZhLCAweDcwMTAxLCAweDgwMDUzLCAweDgwMDEzLCAweDgwMTFiLCAweDcwMTExLCAweDgwMDczLCAweDgwMDMzLCAweDkwMGM2LCAweDcwMTA5LCAweDgwMDYzLCAweDgwMDIzLCAweDkwMGE2LCAweDgwMDAzLCAweDgwMDgzLCAweDgwMDQzLCAweDkwMGU2LCAweDcwMTA1LCAweDgwMDViLCAweDgwMDFiLCAweDkwMDk2LCAweDcwMTE1LCAweDgwMDdiLCAweDgwMDNiLCAweDkwMGQ2LCAweDcwMTBkLCAweDgwMDZiLCAweDgwMDJiLCAweDkwMGI2LCAweDgwMDBiLCAweDgwMDhiLCAweDgwMDRiLCAweDkwMGY2LCAweDcwMTAzLCAweDgwMDU3LCAweDgwMDE3LCAweDgwMTFmLCAweDcwMTEzLCAweDgwMDc3LCAweDgwMDM3LCAweDkwMGNlLCAweDcwMTBiLCAweDgwMDY3LCAweDgwMDI3LCAweDkwMGFlLCAweDgwMDA3LCAweDgwMDg3LCAweDgwMDQ3LCAweDkwMGVlLCAweDcwMTA3LCAweDgwMDVmLCAweDgwMDFmLCAweDkwMDllLCAweDcwMTE3LCAweDgwMDdmLCAweDgwMDNmLCAweDkwMGRlLCAweDcwMTBmLCAweDgwMDZmLCAweDgwMDJmLCAweDkwMGJlLCAweDgwMDBmLCAweDgwMDhmLCAweDgwMDRmLCAweDkwMGZlLCAweDcwMTAwLCAweDgwMDUwLCAweDgwMDEwLCAweDgwMTE4LCAweDcwMTEwLCAweDgwMDcwLCAweDgwMDMwLCAweDkwMGMxLCAweDcwMTA4LCAweDgwMDYwLCAweDgwMDIwLCAweDkwMGExLCAweDgwMDAwLCAweDgwMDgwLCAweDgwMDQwLCAweDkwMGUxLCAweDcwMTA0LCAweDgwMDU4LCAweDgwMDE4LCAweDkwMDkxLCAweDcwMTE0LCAweDgwMDc4LCAweDgwMDM4LCAweDkwMGQxLCAweDcwMTBjLCAweDgwMDY4LCAweDgwMDI4LCAweDkwMGIxLCAweDgwMDA4LCAweDgwMDg4LCAweDgwMDQ4LCAweDkwMGYxLCAweDcwMTAyLCAweDgwMDU0LCAweDgwMDE0LCAweDgwMTFjLCAweDcwMTEyLCAweDgwMDc0LCAweDgwMDM0LCAweDkwMGM5LCAweDcwMTBhLCAweDgwMDY0LCAweDgwMDI0LCAweDkwMGE5LCAweDgwMDA0LCAweDgwMDg0LCAweDgwMDQ0LCAweDkwMGU5LCAweDcwMTA2LCAweDgwMDVjLCAweDgwMDFjLCAweDkwMDk5LCAweDcwMTE2LCAweDgwMDdjLCAweDgwMDNjLCAweDkwMGQ5LCAweDcwMTBlLCAweDgwMDZjLCAweDgwMDJjLCAweDkwMGI5LCAweDgwMDBjLCAweDgwMDhjLCAweDgwMDRjLCAweDkwMGY5LCAweDcwMTAxLCAweDgwMDUyLCAweDgwMDEyLCAweDgwMTFhLCAweDcwMTExLCAweDgwMDcyLCAweDgwMDMyLCAweDkwMGM1LCAweDcwMTA5LCAweDgwMDYyLCAweDgwMDIyLCAweDkwMGE1LCAweDgwMDAyLCAweDgwMDgyLCAweDgwMDQyLCAweDkwMGU1LCAweDcwMTA1LCAweDgwMDVhLCAweDgwMDFhLCAweDkwMDk1LCAweDcwMTE1LCAweDgwMDdhLCAweDgwMDNhLCAweDkwMGQ1LCAweDcwMTBkLCAweDgwMDZhLCAweDgwMDJhLCAweDkwMGI1LCAweDgwMDBhLCAweDgwMDhhLCAweDgwMDRhLCAweDkwMGY1LCAweDcwMTAzLCAweDgwMDU2LCAweDgwMDE2LCAweDgwMTFlLCAweDcwMTEzLCAweDgwMDc2LCAweDgwMDM2LCAweDkwMGNkLCAweDcwMTBiLCAweDgwMDY2LCAweDgwMDI2LCAweDkwMGFkLCAweDgwMDA2LCAweDgwMDg2LCAweDgwMDQ2LCAweDkwMGVkLCAweDcwMTA3LCAweDgwMDVlLCAweDgwMDFlLCAweDkwMDlkLCAweDcwMTE3LCAweDgwMDdlLCAweDgwMDNlLCAweDkwMGRkLCAweDcwMTBmLCAweDgwMDZlLCAweDgwMDJlLCAweDkwMGJkLCAweDgwMDBlLCAweDgwMDhlLCAweDgwMDRlLCAweDkwMGZkLCAweDcwMTAwLCAweDgwMDUxLCAweDgwMDExLCAweDgwMTE5LCAweDcwMTEwLCAweDgwMDcxLCAweDgwMDMxLCAweDkwMGMzLCAweDcwMTA4LCAweDgwMDYxLCAweDgwMDIxLCAweDkwMGEzLCAweDgwMDAxLCAweDgwMDgxLCAweDgwMDQxLCAweDkwMGUzLCAweDcwMTA0LCAweDgwMDU5LCAweDgwMDE5LCAweDkwMDkzLCAweDcwMTE0LCAweDgwMDc5LCAweDgwMDM5LCAweDkwMGQzLCAweDcwMTBjLCAweDgwMDY5LCAweDgwMDI5LCAweDkwMGIzLCAweDgwMDA5LCAweDgwMDg5LCAweDgwMDQ5LCAweDkwMGYzLCAweDcwMTAyLCAweDgwMDU1LCAweDgwMDE1LCAweDgwMTFkLCAweDcwMTEyLCAweDgwMDc1LCAweDgwMDM1LCAweDkwMGNiLCAweDcwMTBhLCAweDgwMDY1LCAweDgwMDI1LCAweDkwMGFiLCAweDgwMDA1LCAweDgwMDg1LCAweDgwMDQ1LCAweDkwMGViLCAweDcwMTA2LCAweDgwMDVkLCAweDgwMDFkLCAweDkwMDliLCAweDcwMTE2LCAweDgwMDdkLCAweDgwMDNkLCAweDkwMGRiLCAweDcwMTBlLCAweDgwMDZkLCAweDgwMDJkLCAweDkwMGJiLCAweDgwMDBkLCAweDgwMDhkLCAweDgwMDRkLCAweDkwMGZiLCAweDcwMTAxLCAweDgwMDUzLCAweDgwMDEzLCAweDgwMTFiLCAweDcwMTExLCAweDgwMDczLCAweDgwMDMzLCAweDkwMGM3LCAweDcwMTA5LCAweDgwMDYzLCAweDgwMDIzLCAweDkwMGE3LCAweDgwMDAzLCAweDgwMDgzLCAweDgwMDQzLCAweDkwMGU3LCAweDcwMTA1LCAweDgwMDViLCAweDgwMDFiLCAweDkwMDk3LCAweDcwMTE1LCAweDgwMDdiLCAweDgwMDNiLCAweDkwMGQ3LCAweDcwMTBkLCAweDgwMDZiLCAweDgwMDJiLCAweDkwMGI3LCAweDgwMDBiLCAweDgwMDhiLCAweDgwMDRiLCAweDkwMGY3LCAweDcwMTAzLCAweDgwMDU3LCAweDgwMDE3LCAweDgwMTFmLCAweDcwMTEzLCAweDgwMDc3LCAweDgwMDM3LCAweDkwMGNmLCAweDcwMTBiLCAweDgwMDY3LCAweDgwMDI3LCAweDkwMGFmLCAweDgwMDA3LCAweDgwMDg3LCAweDgwMDQ3LCAweDkwMGVmLCAweDcwMTA3LCAweDgwMDVmLCAweDgwMDFmLCAweDkwMDlmLCAweDcwMTE3LCAweDgwMDdmLCAweDgwMDNmLCAweDkwMGRmLCAweDcwMTBmLCAweDgwMDZmLCAweDgwMDJmLCAweDkwMGJmLCAweDgwMDBmLCAweDgwMDhmLCAweDgwMDRmLCAweDkwMGZmXSksIDldOwpjb25zdCBmaXhlZERpc3RDb2RlVGFiID0gW25ldyBJbnQzMkFycmF5KFsweDUwMDAwLCAweDUwMDEwLCAweDUwMDA4LCAweDUwMDE4LCAweDUwMDA0LCAweDUwMDE0LCAweDUwMDBjLCAweDUwMDFjLCAweDUwMDAyLCAweDUwMDEyLCAweDUwMDBhLCAweDUwMDFhLCAweDUwMDA2LCAweDUwMDE2LCAweDUwMDBlLCAweDAwMDAwLCAweDUwMDAxLCAweDUwMDExLCAweDUwMDA5LCAweDUwMDE5LCAweDUwMDA1LCAweDUwMDE1LCAweDUwMDBkLCAweDUwMDFkLCAweDUwMDAzLCAweDUwMDEzLCAweDUwMDBiLCAweDUwMDFiLCAweDUwMDA3LCAweDUwMDE3LCAweDUwMDBmLCAweDAwMDAwXSksIDVdOwpjbGFzcyBGbGF0ZVN0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyLCBtYXliZUxlbmd0aCkgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIGNvbnN0IGNtZiA9IHN0ci5nZXRCeXRlKCk7CiAgICBjb25zdCBmbGcgPSBzdHIuZ2V0Qnl0ZSgpOwogICAgaWYgKGNtZiA9PT0gLTEgfHwgZmxnID09PSAtMSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgaGVhZGVyIGluIGZsYXRlIHN0cmVhbTogJHtjbWZ9LCAke2ZsZ31gKTsKICAgIH0KICAgIGlmICgoY21mICYgMHgwZikgIT09IDB4MDgpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCBpbiBmbGF0ZSBzdHJlYW06ICR7Y21mfSwgJHtmbGd9YCk7CiAgICB9CiAgICBpZiAoKChjbWYgPDwgOCkgKyBmbGcpICUgMzEgIT09IDApIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBCYWQgRkNIRUNLIGluIGZsYXRlIHN0cmVhbTogJHtjbWZ9LCAke2ZsZ31gKTsKICAgIH0KICAgIGlmIChmbGcgJiAweDIwKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgRkRJQ1QgYml0IHNldCBpbiBmbGF0ZSBzdHJlYW06ICR7Y21mfSwgJHtmbGd9YCk7CiAgICB9CiAgICB0aGlzLmNvZGVTaXplID0gMDsKICAgIHRoaXMuY29kZUJ1ZiA9IDA7CiAgfQogIGFzeW5jIGdldEltYWdlRGF0YShsZW5ndGgsIF9kZWNvZGVyT3B0aW9ucykgewogICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXN5bmNHZXRCeXRlcygpOwogICAgaWYgKCFkYXRhKSB7CiAgICAgIHJldHVybiB0aGlzLmdldEJ5dGVzKGxlbmd0aCk7CiAgICB9CiAgICBpZiAoZGF0YS5sZW5ndGggPD0gbGVuZ3RoKSB7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgcmV0dXJuIGRhdGEuc3ViYXJyYXkoMCwgbGVuZ3RoKTsKICB9CiAgYXN5bmMgYXN5bmNHZXRCeXRlcygpIHsKICAgIHRoaXMuc3RyZWFtLnJlc2V0KCk7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuc3RyZWFtLmdldEJ5dGVzKCk7CiAgICB0cnkgewogICAgICBjb25zdCB7CiAgICAgICAgcmVhZGFibGUsCiAgICAgICAgd3JpdGFibGUKICAgICAgfSA9IG5ldyBEZWNvbXByZXNzaW9uU3RyZWFtKCJkZWZsYXRlIik7CiAgICAgIGNvbnN0IHdyaXRlciA9IHdyaXRhYmxlLmdldFdyaXRlcigpOwogICAgICBhd2FpdCB3cml0ZXIucmVhZHk7CiAgICAgIHdyaXRlci53cml0ZShieXRlcykudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgYXdhaXQgd3JpdGVyLnJlYWR5OwogICAgICAgIGF3YWl0IHdyaXRlci5jbG9zZSgpOwogICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgICBsZXQgdG90YWxMZW5ndGggPSAwOwogICAgICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHJlYWRhYmxlKSB7CiAgICAgICAgY2h1bmtzLnB1c2goY2h1bmspOwogICAgICAgIHRvdGFsTGVuZ3RoICs9IGNodW5rLmJ5dGVMZW5ndGg7CiAgICAgIH0KICAgICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KHRvdGFsTGVuZ3RoKTsKICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzKSB7CiAgICAgICAgZGF0YS5zZXQoY2h1bmssIG9mZnNldCk7CiAgICAgICAgb2Zmc2V0ICs9IGNodW5rLmJ5dGVMZW5ndGg7CiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGE7CiAgICB9IGNhdGNoIHsKICAgICAgdGhpcy5zdHJlYW0gPSBuZXcgU3RyZWFtKGJ5dGVzLCAyLCBieXRlcy5sZW5ndGgsIHRoaXMuc3RyZWFtLmRpY3QpOwogICAgICB0aGlzLnJlc2V0KCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICBnZXQgaXNBc3luYygpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBnZXRCaXRzKGJpdHMpIHsKICAgIGNvbnN0IHN0ciA9IHRoaXMuc3RyZWFtOwogICAgbGV0IGNvZGVTaXplID0gdGhpcy5jb2RlU2l6ZTsKICAgIGxldCBjb2RlQnVmID0gdGhpcy5jb2RlQnVmOwogICAgbGV0IGI7CiAgICB3aGlsZSAoY29kZVNpemUgPCBiaXRzKSB7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQmFkIGVuY29kaW5nIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICB9CiAgICAgIGNvZGVCdWYgfD0gYiA8PCBjb2RlU2l6ZTsKICAgICAgY29kZVNpemUgKz0gODsKICAgIH0KICAgIGIgPSBjb2RlQnVmICYgKDEgPDwgYml0cykgLSAxOwogICAgdGhpcy5jb2RlQnVmID0gY29kZUJ1ZiA+PiBiaXRzOwogICAgdGhpcy5jb2RlU2l6ZSA9IGNvZGVTaXplIC09IGJpdHM7CiAgICByZXR1cm4gYjsKICB9CiAgZ2V0Q29kZSh0YWJsZSkgewogICAgY29uc3Qgc3RyID0gdGhpcy5zdHJlYW07CiAgICBjb25zdCBjb2RlcyA9IHRhYmxlWzBdOwogICAgY29uc3QgbWF4TGVuID0gdGFibGVbMV07CiAgICBsZXQgY29kZVNpemUgPSB0aGlzLmNvZGVTaXplOwogICAgbGV0IGNvZGVCdWYgPSB0aGlzLmNvZGVCdWY7CiAgICBsZXQgYjsKICAgIHdoaWxlIChjb2RlU2l6ZSA8IG1heExlbikgewogICAgICBpZiAoKGIgPSBzdHIuZ2V0Qnl0ZSgpKSA9PT0gLTEpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjb2RlQnVmIHw9IGIgPDwgY29kZVNpemU7CiAgICAgIGNvZGVTaXplICs9IDg7CiAgICB9CiAgICBjb25zdCBjb2RlID0gY29kZXNbY29kZUJ1ZiAmICgxIDw8IG1heExlbikgLSAxXTsKICAgIGNvbnN0IGNvZGVMZW4gPSBjb2RlID4+IDE2OwogICAgY29uc3QgY29kZVZhbCA9IGNvZGUgJiAweGZmZmY7CiAgICBpZiAoY29kZUxlbiA8IDEgfHwgY29kZVNpemUgPCBjb2RlTGVuKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQmFkIGVuY29kaW5nIGluIGZsYXRlIHN0cmVhbSIpOwogICAgfQogICAgdGhpcy5jb2RlQnVmID0gY29kZUJ1ZiA+PiBjb2RlTGVuOwogICAgdGhpcy5jb2RlU2l6ZSA9IGNvZGVTaXplIC0gY29kZUxlbjsKICAgIHJldHVybiBjb2RlVmFsOwogIH0KICBnZW5lcmF0ZUh1ZmZtYW5UYWJsZShsZW5ndGhzKSB7CiAgICBjb25zdCBuID0gbGVuZ3Rocy5sZW5ndGg7CiAgICBsZXQgbWF4TGVuID0gMDsKICAgIGxldCBpOwogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBpZiAobGVuZ3Roc1tpXSA+IG1heExlbikgewogICAgICAgIG1heExlbiA9IGxlbmd0aHNbaV07CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHNpemUgPSAxIDw8IG1heExlbjsKICAgIGNvbnN0IGNvZGVzID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CiAgICBmb3IgKGxldCBsZW4gPSAxLCBjb2RlID0gMCwgc2tpcCA9IDI7IGxlbiA8PSBtYXhMZW47ICsrbGVuLCBjb2RlIDw8PSAxLCBza2lwIDw8PSAxKSB7CiAgICAgIGZvciAobGV0IHZhbCA9IDA7IHZhbCA8IG47ICsrdmFsKSB7CiAgICAgICAgaWYgKGxlbmd0aHNbdmFsXSA9PT0gbGVuKSB7CiAgICAgICAgICBsZXQgY29kZTIgPSAwOwogICAgICAgICAgbGV0IHQgPSBjb2RlOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGNvZGUyID0gY29kZTIgPDwgMSB8IHQgJiAxOwogICAgICAgICAgICB0ID4+PSAxOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChpID0gY29kZTI7IGkgPCBzaXplOyBpICs9IHNraXApIHsKICAgICAgICAgICAgY29kZXNbaV0gPSBsZW4gPDwgMTYgfCB2YWw7CiAgICAgICAgICB9CiAgICAgICAgICArK2NvZGU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gW2NvZGVzLCBtYXhMZW5dOwogIH0KICAjZW5kc1N0cmVhbU9uRXJyb3IoZXJyKSB7CiAgICBpbmZvKGVycik7CiAgICB0aGlzLmVvZiA9IHRydWU7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGxldCBidWZmZXIsIGhkciwgbGVuOwogICAgY29uc3Qgc3RyID0gdGhpcy5zdHJlYW07CiAgICB0cnkgewogICAgICBoZHIgPSB0aGlzLmdldEJpdHMoMyk7CiAgICB9IGNhdGNoIChleCkgewogICAgICB0aGlzLiNlbmRzU3RyZWFtT25FcnJvcihleC5tZXNzYWdlKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGhkciAmIDEpIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgfQogICAgaGRyID4+PSAxOwogICAgaWYgKGhkciA9PT0gMCkgewogICAgICBsZXQgYjsKICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgdGhpcy4jZW5kc1N0cmVhbU9uRXJyb3IoIkJhZCBibG9jayBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCBibG9ja0xlbiA9IGI7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRoaXMuI2VuZHNTdHJlYW1PbkVycm9yKCJCYWQgYmxvY2sgaGVhZGVyIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBibG9ja0xlbiB8PSBiIDw8IDg7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRoaXMuI2VuZHNTdHJlYW1PbkVycm9yKCJCYWQgYmxvY2sgaGVhZGVyIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgY2hlY2sgPSBiOwogICAgICBpZiAoKGIgPSBzdHIuZ2V0Qnl0ZSgpKSA9PT0gLTEpIHsKICAgICAgICB0aGlzLiNlbmRzU3RyZWFtT25FcnJvcigiQmFkIGJsb2NrIGhlYWRlciBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY2hlY2sgfD0gYiA8PCA4OwogICAgICBpZiAoY2hlY2sgIT09ICh+YmxvY2tMZW4gJiAweGZmZmYpICYmIChibG9ja0xlbiAhPT0gMCB8fCBjaGVjayAhPT0gMCkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkJhZCB1bmNvbXByZXNzZWQgYmxvY2sgbGVuZ3RoIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICB9CiAgICAgIHRoaXMuY29kZUJ1ZiA9IDA7CiAgICAgIHRoaXMuY29kZVNpemUgPSAwOwogICAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aCwKICAgICAgICBlbmQgPSBidWZmZXJMZW5ndGggKyBibG9ja0xlbjsKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoZW5kKTsKICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBlbmQ7CiAgICAgIGlmIChibG9ja0xlbiA9PT0gMCkgewogICAgICAgIGlmIChzdHIucGVla0J5dGUoKSA9PT0gLTEpIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYmxvY2sgPSBzdHIuZ2V0Qnl0ZXMoYmxvY2tMZW4pOwogICAgICAgIGJ1ZmZlci5zZXQoYmxvY2ssIGJ1ZmZlckxlbmd0aCk7CiAgICAgICAgaWYgKGJsb2NrLmxlbmd0aCA8IGJsb2NrTGVuKSB7CiAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBsaXRDb2RlVGFibGU7CiAgICBsZXQgZGlzdENvZGVUYWJsZTsKICAgIGlmIChoZHIgPT09IDEpIHsKICAgICAgbGl0Q29kZVRhYmxlID0gZml4ZWRMaXRDb2RlVGFiOwogICAgICBkaXN0Q29kZVRhYmxlID0gZml4ZWREaXN0Q29kZVRhYjsKICAgIH0gZWxzZSBpZiAoaGRyID09PSAyKSB7CiAgICAgIGNvbnN0IG51bUxpdENvZGVzID0gdGhpcy5nZXRCaXRzKDUpICsgMjU3OwogICAgICBjb25zdCBudW1EaXN0Q29kZXMgPSB0aGlzLmdldEJpdHMoNSkgKyAxOwogICAgICBjb25zdCBudW1Db2RlTGVuQ29kZXMgPSB0aGlzLmdldEJpdHMoNCkgKyA0OwogICAgICBjb25zdCBjb2RlTGVuQ29kZUxlbmd0aHMgPSBuZXcgVWludDhBcnJheShjb2RlTGVuQ29kZU1hcC5sZW5ndGgpOwogICAgICBsZXQgaTsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bUNvZGVMZW5Db2RlczsgKytpKSB7CiAgICAgICAgY29kZUxlbkNvZGVMZW5ndGhzW2NvZGVMZW5Db2RlTWFwW2ldXSA9IHRoaXMuZ2V0Qml0cygzKTsKICAgICAgfQogICAgICBjb25zdCBjb2RlTGVuQ29kZVRhYiA9IHRoaXMuZ2VuZXJhdGVIdWZmbWFuVGFibGUoY29kZUxlbkNvZGVMZW5ndGhzKTsKICAgICAgbGVuID0gMDsKICAgICAgaSA9IDA7CiAgICAgIGNvbnN0IGNvZGVzID0gbnVtTGl0Q29kZXMgKyBudW1EaXN0Q29kZXM7CiAgICAgIGNvbnN0IGNvZGVMZW5ndGhzID0gbmV3IFVpbnQ4QXJyYXkoY29kZXMpOwogICAgICBsZXQgYml0c0xlbmd0aCwgYml0c09mZnNldCwgd2hhdDsKICAgICAgd2hpbGUgKGkgPCBjb2RlcykgewogICAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLmdldENvZGUoY29kZUxlbkNvZGVUYWIpOwogICAgICAgIGlmIChjb2RlID09PSAxNikgewogICAgICAgICAgYml0c0xlbmd0aCA9IDI7CiAgICAgICAgICBiaXRzT2Zmc2V0ID0gMzsKICAgICAgICAgIHdoYXQgPSBsZW47CiAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSAxNykgewogICAgICAgICAgYml0c0xlbmd0aCA9IDM7CiAgICAgICAgICBiaXRzT2Zmc2V0ID0gMzsKICAgICAgICAgIHdoYXQgPSBsZW4gPSAwOwogICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMTgpIHsKICAgICAgICAgIGJpdHNMZW5ndGggPSA3OwogICAgICAgICAgYml0c09mZnNldCA9IDExOwogICAgICAgICAgd2hhdCA9IGxlbiA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvZGVMZW5ndGhzW2krK10gPSBsZW4gPSBjb2RlOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxldCByZXBlYXRMZW5ndGggPSB0aGlzLmdldEJpdHMoYml0c0xlbmd0aCkgKyBiaXRzT2Zmc2V0OwogICAgICAgIHdoaWxlIChyZXBlYXRMZW5ndGgtLSA+IDApIHsKICAgICAgICAgIGNvZGVMZW5ndGhzW2krK10gPSB3aGF0OwogICAgICAgIH0KICAgICAgfQogICAgICBsaXRDb2RlVGFibGUgPSB0aGlzLmdlbmVyYXRlSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzLnN1YmFycmF5KDAsIG51bUxpdENvZGVzKSk7CiAgICAgIGRpc3RDb2RlVGFibGUgPSB0aGlzLmdlbmVyYXRlSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzLnN1YmFycmF5KG51bUxpdENvZGVzLCBjb2RlcykpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbmtub3duIGJsb2NrIHR5cGUgaW4gZmxhdGUgc3RyZWFtIik7CiAgICB9CiAgICBidWZmZXIgPSB0aGlzLmJ1ZmZlcjsKICAgIGxldCBsaW1pdCA9IGJ1ZmZlciA/IGJ1ZmZlci5sZW5ndGggOiAwOwogICAgbGV0IHBvcyA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbGV0IGNvZGUxID0gdGhpcy5nZXRDb2RlKGxpdENvZGVUYWJsZSk7CiAgICAgIGlmIChjb2RlMSA8IDI1NikgewogICAgICAgIGlmIChwb3MgKyAxID49IGxpbWl0KSB7CiAgICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihwb3MgKyAxKTsKICAgICAgICAgIGxpbWl0ID0gYnVmZmVyLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IGNvZGUxOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChjb2RlMSA9PT0gMjU2KSB7CiAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBwb3M7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvZGUxIC09IDI1NzsKICAgICAgY29kZTEgPSBsZW5ndGhEZWNvZGVbY29kZTFdOwogICAgICBsZXQgY29kZTIgPSBjb2RlMSA+PiAxNjsKICAgICAgaWYgKGNvZGUyID4gMCkgewogICAgICAgIGNvZGUyID0gdGhpcy5nZXRCaXRzKGNvZGUyKTsKICAgICAgfQogICAgICBsZW4gPSAoY29kZTEgJiAweGZmZmYpICsgY29kZTI7CiAgICAgIGNvZGUxID0gdGhpcy5nZXRDb2RlKGRpc3RDb2RlVGFibGUpOwogICAgICBjb2RlMSA9IGRpc3REZWNvZGVbY29kZTFdOwogICAgICBjb2RlMiA9IGNvZGUxID4+IDE2OwogICAgICBpZiAoY29kZTIgPiAwKSB7CiAgICAgICAgY29kZTIgPSB0aGlzLmdldEJpdHMoY29kZTIpOwogICAgICB9CiAgICAgIGNvbnN0IGRpc3QgPSAoY29kZTEgJiAweGZmZmYpICsgY29kZTI7CiAgICAgIGlmIChwb3MgKyBsZW4gPj0gbGltaXQpIHsKICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihwb3MgKyBsZW4pOwogICAgICAgIGxpbWl0ID0gYnVmZmVyLmxlbmd0aDsKICAgICAgfQogICAgICBmb3IgKGxldCBrID0gMDsgayA8IGxlbjsgKytrLCArK3BvcykgewogICAgICAgIGJ1ZmZlcltwb3NdID0gYnVmZmVyW3BvcyAtIGRpc3RdOwogICAgICB9CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9hcml0aG1ldGljX2RlY29kZXIuanMKY29uc3QgUWVUYWJsZSA9IFt7CiAgcWU6IDB4NTYwMSwKICBubXBzOiAxLAogIG5scHM6IDEsCiAgc3dpdGNoRmxhZzogMQp9LCB7CiAgcWU6IDB4MzQwMSwKICBubXBzOiAyLAogIG5scHM6IDYsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTgwMSwKICBubXBzOiAzLAogIG5scHM6IDksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MGFjMSwKICBubXBzOiA0LAogIG5scHM6IDEyLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDA1MjEsCiAgbm1wczogNSwKICBubHBzOiAyOSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMjIxLAogIG5tcHM6IDM4LAogIG5scHM6IDMzLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDU2MDEsCiAgbm1wczogNywKICBubHBzOiA2LAogIHN3aXRjaEZsYWc6IDEKfSwgewogIHFlOiAweDU0MDEsCiAgbm1wczogOCwKICBubHBzOiAxNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg0ODAxLAogIG5tcHM6IDksCiAgbmxwczogMTQsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MzgwMSwKICBubXBzOiAxMCwKICBubHBzOiAxNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgzMDAxLAogIG5tcHM6IDExLAogIG5scHM6IDE3LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDI0MDEsCiAgbm1wczogMTIsCiAgbmxwczogMTgsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MWMwMSwKICBubXBzOiAxMywKICBubHBzOiAyMCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxNjAxLAogIG5tcHM6IDI5LAogIG5scHM6IDIxLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDU2MDEsCiAgbm1wczogMTUsCiAgbmxwczogMTQsCiAgc3dpdGNoRmxhZzogMQp9LCB7CiAgcWU6IDB4NTQwMSwKICBubXBzOiAxNiwKICBubHBzOiAxNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg1MTAxLAogIG5tcHM6IDE3LAogIG5scHM6IDE1LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDQ4MDEsCiAgbm1wczogMTgsCiAgbmxwczogMTYsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MzgwMSwKICBubXBzOiAxOSwKICBubHBzOiAxNywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgzNDAxLAogIG5tcHM6IDIwLAogIG5scHM6IDE4LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDMwMDEsCiAgbm1wczogMjEsCiAgbmxwczogMTksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MjgwMSwKICBubXBzOiAyMiwKICBubHBzOiAxOSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgyNDAxLAogIG5tcHM6IDIzLAogIG5scHM6IDIwLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDIyMDEsCiAgbm1wczogMjQsCiAgbmxwczogMjEsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MWMwMSwKICBubXBzOiAyNSwKICBubHBzOiAyMiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxODAxLAogIG5tcHM6IDI2LAogIG5scHM6IDIzLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDE2MDEsCiAgbm1wczogMjcsCiAgbmxwczogMjQsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTQwMSwKICBubXBzOiAyOCwKICBubHBzOiAyNSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxMjAxLAogIG5tcHM6IDI5LAogIG5scHM6IDI2LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDExMDEsCiAgbm1wczogMzAsCiAgbmxwczogMjcsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MGFjMSwKICBubXBzOiAzMSwKICBubHBzOiAyOCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwOWMxLAogIG5tcHM6IDMyLAogIG5scHM6IDI5LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDA4YTEsCiAgbm1wczogMzMsCiAgbmxwczogMzAsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDUyMSwKICBubXBzOiAzNCwKICBubHBzOiAzMSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwNDQxLAogIG5tcHM6IDM1LAogIG5scHM6IDMyLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAyYTEsCiAgbm1wczogMzYsCiAgbmxwczogMzMsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDIyMSwKICBubXBzOiAzNywKICBubHBzOiAzNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMTQxLAogIG5tcHM6IDM4LAogIG5scHM6IDM1LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAxMTEsCiAgbm1wczogMzksCiAgbmxwczogMzYsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDA4NSwKICBubXBzOiA0MCwKICBubHBzOiAzNywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDQ5LAogIG5tcHM6IDQxLAogIG5scHM6IDM4LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwMjUsCiAgbm1wczogNDIsCiAgbmxwczogMzksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDAxNSwKICBubXBzOiA0MywKICBubHBzOiA0MCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDA5LAogIG5tcHM6IDQ0LAogIG5scHM6IDQxLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwMDUsCiAgbm1wczogNDUsCiAgbmxwczogNDIsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDAwMSwKICBubXBzOiA0NSwKICBubHBzOiA0MywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg1NjAxLAogIG5tcHM6IDQ2LAogIG5scHM6IDQ2LAogIHN3aXRjaEZsYWc6IDAKfV07CmNsYXNzIEFyaXRobWV0aWNEZWNvZGVyIHsKICBjb25zdHJ1Y3RvcihkYXRhLCBzdGFydCwgZW5kKSB7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5icCA9IHN0YXJ0OwogICAgdGhpcy5kYXRhRW5kID0gZW5kOwogICAgdGhpcy5jaGlnaCA9IGRhdGFbc3RhcnRdOwogICAgdGhpcy5jbG93ID0gMDsKICAgIHRoaXMuYnl0ZUluKCk7CiAgICB0aGlzLmNoaWdoID0gdGhpcy5jaGlnaCA8PCA3ICYgMHhmZmZmIHwgdGhpcy5jbG93ID4+IDkgJiAweDdmOwogICAgdGhpcy5jbG93ID0gdGhpcy5jbG93IDw8IDcgJiAweGZmZmY7CiAgICB0aGlzLmN0IC09IDc7CiAgICB0aGlzLmEgPSAweDgwMDA7CiAgfQogIGJ5dGVJbigpIHsKICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICBsZXQgYnAgPSB0aGlzLmJwOwogICAgaWYgKGRhdGFbYnBdID09PSAweGZmKSB7CiAgICAgIGlmIChkYXRhW2JwICsgMV0gPiAweDhmKSB7CiAgICAgICAgdGhpcy5jbG93ICs9IDB4ZmYwMDsKICAgICAgICB0aGlzLmN0ID0gODsKICAgICAgfSBlbHNlIHsKICAgICAgICBicCsrOwogICAgICAgIHRoaXMuY2xvdyArPSBkYXRhW2JwXSA8PCA5OwogICAgICAgIHRoaXMuY3QgPSA3OwogICAgICAgIHRoaXMuYnAgPSBicDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgYnArKzsKICAgICAgdGhpcy5jbG93ICs9IGJwIDwgdGhpcy5kYXRhRW5kID8gZGF0YVticF0gPDwgOCA6IDB4ZmYwMDsKICAgICAgdGhpcy5jdCA9IDg7CiAgICAgIHRoaXMuYnAgPSBicDsKICAgIH0KICAgIGlmICh0aGlzLmNsb3cgPiAweGZmZmYpIHsKICAgICAgdGhpcy5jaGlnaCArPSB0aGlzLmNsb3cgPj4gMTY7CiAgICAgIHRoaXMuY2xvdyAmPSAweGZmZmY7CiAgICB9CiAgfQogIHJlYWRCaXQoY29udGV4dHMsIHBvcykgewogICAgbGV0IGN4X2luZGV4ID0gY29udGV4dHNbcG9zXSA+PiAxLAogICAgICBjeF9tcHMgPSBjb250ZXh0c1twb3NdICYgMTsKICAgIGNvbnN0IHFlVGFibGVJY3ggPSBRZVRhYmxlW2N4X2luZGV4XTsKICAgIGNvbnN0IHFlSWN4ID0gcWVUYWJsZUljeC5xZTsKICAgIGxldCBkOwogICAgbGV0IGEgPSB0aGlzLmEgLSBxZUljeDsKICAgIGlmICh0aGlzLmNoaWdoIDwgcWVJY3gpIHsKICAgICAgaWYgKGEgPCBxZUljeCkgewogICAgICAgIGEgPSBxZUljeDsKICAgICAgICBkID0gY3hfbXBzOwogICAgICAgIGN4X2luZGV4ID0gcWVUYWJsZUljeC5ubXBzOwogICAgICB9IGVsc2UgewogICAgICAgIGEgPSBxZUljeDsKICAgICAgICBkID0gMSBeIGN4X21wczsKICAgICAgICBpZiAocWVUYWJsZUljeC5zd2l0Y2hGbGFnID09PSAxKSB7CiAgICAgICAgICBjeF9tcHMgPSBkOwogICAgICAgIH0KICAgICAgICBjeF9pbmRleCA9IHFlVGFibGVJY3gubmxwczsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jaGlnaCAtPSBxZUljeDsKICAgICAgaWYgKChhICYgMHg4MDAwKSAhPT0gMCkgewogICAgICAgIHRoaXMuYSA9IGE7CiAgICAgICAgcmV0dXJuIGN4X21wczsKICAgICAgfQogICAgICBpZiAoYSA8IHFlSWN4KSB7CiAgICAgICAgZCA9IDEgXiBjeF9tcHM7CiAgICAgICAgaWYgKHFlVGFibGVJY3guc3dpdGNoRmxhZyA9PT0gMSkgewogICAgICAgICAgY3hfbXBzID0gZDsKICAgICAgICB9CiAgICAgICAgY3hfaW5kZXggPSBxZVRhYmxlSWN4Lm5scHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZCA9IGN4X21wczsKICAgICAgICBjeF9pbmRleCA9IHFlVGFibGVJY3gubm1wczsKICAgICAgfQogICAgfQogICAgZG8gewogICAgICBpZiAodGhpcy5jdCA9PT0gMCkgewogICAgICAgIHRoaXMuYnl0ZUluKCk7CiAgICAgIH0KICAgICAgYSA8PD0gMTsKICAgICAgdGhpcy5jaGlnaCA9IHRoaXMuY2hpZ2ggPDwgMSAmIDB4ZmZmZiB8IHRoaXMuY2xvdyA+PiAxNSAmIDE7CiAgICAgIHRoaXMuY2xvdyA9IHRoaXMuY2xvdyA8PCAxICYgMHhmZmZmOwogICAgICB0aGlzLmN0LS07CiAgICB9IHdoaWxlICgoYSAmIDB4ODAwMCkgPT09IDApOwogICAgdGhpcy5hID0gYTsKICAgIGNvbnRleHRzW3Bvc10gPSBjeF9pbmRleCA8PCAxIHwgY3hfbXBzOwogICAgcmV0dXJuIGQ7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9qYmlnMi5qcwoKCgoKY2xhc3MgSmJpZzJFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSmJpZzJFcnJvciIpOwogIH0KfQpjbGFzcyBDb250ZXh0Q2FjaGUgewogIGdldENvbnRleHRzKGlkKSB7CiAgICBpZiAoaWQgaW4gdGhpcykgewogICAgICByZXR1cm4gdGhpc1tpZF07CiAgICB9CiAgICByZXR1cm4gdGhpc1tpZF0gPSBuZXcgSW50OEFycmF5KDEgPDwgMTYpOwogIH0KfQpjbGFzcyBEZWNvZGluZ0NvbnRleHQgewogIGNvbnN0cnVjdG9yKGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7CiAgICB0aGlzLmVuZCA9IGVuZDsKICB9CiAgZ2V0IGRlY29kZXIoKSB7CiAgICBjb25zdCBkZWNvZGVyID0gbmV3IEFyaXRobWV0aWNEZWNvZGVyKHRoaXMuZGF0YSwgdGhpcy5zdGFydCwgdGhpcy5lbmQpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZGVjb2RlciIsIGRlY29kZXIpOwogIH0KICBnZXQgY29udGV4dENhY2hlKCkgewogICAgY29uc3QgY2FjaGUgPSBuZXcgQ29udGV4dENhY2hlKCk7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjb250ZXh0Q2FjaGUiLCBjYWNoZSk7CiAgfQp9CmZ1bmN0aW9uIGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCBwcm9jZWR1cmUsIGRlY29kZXIpIHsKICBjb25zdCBjb250ZXh0cyA9IGNvbnRleHRDYWNoZS5nZXRDb250ZXh0cyhwcm9jZWR1cmUpOwogIGxldCBwcmV2ID0gMTsKICBmdW5jdGlvbiByZWFkQml0cyhsZW5ndGgpIHsKICAgIGxldCB2ID0gMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYml0ID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBwcmV2KTsKICAgICAgcHJldiA9IHByZXYgPCAyNTYgPyBwcmV2IDw8IDEgfCBiaXQgOiAocHJldiA8PCAxIHwgYml0KSAmIDUxMSB8IDI1NjsKICAgICAgdiA9IHYgPDwgMSB8IGJpdDsKICAgIH0KICAgIHJldHVybiB2ID4+PiAwOwogIH0KICBjb25zdCBzaWduID0gcmVhZEJpdHMoMSk7CiAgY29uc3QgdmFsdWUgPSByZWFkQml0cygxKSA/IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMSkgPyByZWFkQml0cygxKSA/IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMzIpICsgNDQzNiA6IHJlYWRCaXRzKDEyKSArIDM0MCA6IHJlYWRCaXRzKDgpICsgODQgOiByZWFkQml0cyg2KSArIDIwIDogcmVhZEJpdHMoNCkgKyA0IDogcmVhZEJpdHMoMik7CiAgbGV0IHNpZ25lZFZhbHVlOwogIGlmIChzaWduID09PSAwKSB7CiAgICBzaWduZWRWYWx1ZSA9IHZhbHVlOwogIH0gZWxzZSBpZiAodmFsdWUgPiAwKSB7CiAgICBzaWduZWRWYWx1ZSA9IC12YWx1ZTsKICB9CiAgaWYgKHNpZ25lZFZhbHVlID49IE1JTl9JTlRfMzIgJiYgc2lnbmVkVmFsdWUgPD0gTUFYX0lOVF8zMikgewogICAgcmV0dXJuIHNpZ25lZFZhbHVlOwogIH0KICByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiBkZWNvZGVJQUlEKGNvbnRleHRDYWNoZSwgZGVjb2RlciwgY29kZUxlbmd0aCkgewogIGNvbnN0IGNvbnRleHRzID0gY29udGV4dENhY2hlLmdldENvbnRleHRzKCJJQUlEIik7CiAgbGV0IHByZXYgPSAxOwogIGZvciAobGV0IGkgPSAwOyBpIDwgY29kZUxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBiaXQgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIHByZXYpOwogICAgcHJldiA9IHByZXYgPDwgMSB8IGJpdDsKICB9CiAgaWYgKGNvZGVMZW5ndGggPCAzMSkgewogICAgcmV0dXJuIHByZXYgJiAoMSA8PCBjb2RlTGVuZ3RoKSAtIDE7CiAgfQogIHJldHVybiBwcmV2ICYgMHg3ZmZmZmZmZjsKfQpjb25zdCBTZWdtZW50VHlwZXMgPSBbIlN5bWJvbERpY3Rpb25hcnkiLCBudWxsLCBudWxsLCBudWxsLCAiSW50ZXJtZWRpYXRlVGV4dFJlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVUZXh0UmVnaW9uIiwgIkltbWVkaWF0ZUxvc3NsZXNzVGV4dFJlZ2lvbiIsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsICJQYXR0ZXJuRGljdGlvbmFyeSIsIG51bGwsIG51bGwsIG51bGwsICJJbnRlcm1lZGlhdGVIYWxmdG9uZVJlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVIYWxmdG9uZVJlZ2lvbiIsICJJbW1lZGlhdGVMb3NzbGVzc0hhbGZ0b25lUmVnaW9uIiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgIkludGVybWVkaWF0ZUdlbmVyaWNSZWdpb24iLCBudWxsLCAiSW1tZWRpYXRlR2VuZXJpY1JlZ2lvbiIsICJJbW1lZGlhdGVMb3NzbGVzc0dlbmVyaWNSZWdpb24iLCAiSW50ZXJtZWRpYXRlR2VuZXJpY1JlZmluZW1lbnRSZWdpb24iLCBudWxsLCAiSW1tZWRpYXRlR2VuZXJpY1JlZmluZW1lbnRSZWdpb24iLCAiSW1tZWRpYXRlTG9zc2xlc3NHZW5lcmljUmVmaW5lbWVudFJlZ2lvbiIsIG51bGwsIG51bGwsIG51bGwsIG51bGwsICJQYWdlSW5mb3JtYXRpb24iLCAiRW5kT2ZQYWdlIiwgIkVuZE9mU3RyaXBlIiwgIkVuZE9mRmlsZSIsICJQcm9maWxlcyIsICJUYWJsZXMiLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCAiRXh0ZW5zaW9uIl07CmNvbnN0IENvZGluZ1RlbXBsYXRlcyA9IFtbewogIHg6IC0xLAogIHk6IC0yCn0sIHsKICB4OiAwLAogIHk6IC0yCn0sIHsKICB4OiAxLAogIHk6IC0yCn0sIHsKICB4OiAtMiwKICB5OiAtMQp9LCB7CiAgeDogLTEsCiAgeTogLTEKfSwgewogIHg6IDAsCiAgeTogLTEKfSwgewogIHg6IDEsCiAgeTogLTEKfSwgewogIHg6IDIsCiAgeTogLTEKfSwgewogIHg6IC00LAogIHk6IDAKfSwgewogIHg6IC0zLAogIHk6IDAKfSwgewogIHg6IC0yLAogIHk6IDAKfSwgewogIHg6IC0xLAogIHk6IDAKfV0sIFt7CiAgeDogLTEsCiAgeTogLTIKfSwgewogIHg6IDAsCiAgeTogLTIKfSwgewogIHg6IDEsCiAgeTogLTIKfSwgewogIHg6IDIsCiAgeTogLTIKfSwgewogIHg6IC0yLAogIHk6IC0xCn0sIHsKICB4OiAtMSwKICB5OiAtMQp9LCB7CiAgeDogMCwKICB5OiAtMQp9LCB7CiAgeDogMSwKICB5OiAtMQp9LCB7CiAgeDogMiwKICB5OiAtMQp9LCB7CiAgeDogLTMsCiAgeTogMAp9LCB7CiAgeDogLTIsCiAgeTogMAp9LCB7CiAgeDogLTEsCiAgeTogMAp9XSwgW3sKICB4OiAtMSwKICB5OiAtMgp9LCB7CiAgeDogMCwKICB5OiAtMgp9LCB7CiAgeDogMSwKICB5OiAtMgp9LCB7CiAgeDogLTIsCiAgeTogLTEKfSwgewogIHg6IC0xLAogIHk6IC0xCn0sIHsKICB4OiAwLAogIHk6IC0xCn0sIHsKICB4OiAxLAogIHk6IC0xCn0sIHsKICB4OiAtMiwKICB5OiAwCn0sIHsKICB4OiAtMSwKICB5OiAwCn1dLCBbewogIHg6IC0zLAogIHk6IC0xCn0sIHsKICB4OiAtMiwKICB5OiAtMQp9LCB7CiAgeDogLTEsCiAgeTogLTEKfSwgewogIHg6IDAsCiAgeTogLTEKfSwgewogIHg6IDEsCiAgeTogLTEKfSwgewogIHg6IC00LAogIHk6IDAKfSwgewogIHg6IC0zLAogIHk6IDAKfSwgewogIHg6IC0yLAogIHk6IDAKfSwgewogIHg6IC0xLAogIHk6IDAKfV1dOwpjb25zdCBSZWZpbmVtZW50VGVtcGxhdGVzID0gW3sKICBjb2Rpbmc6IFt7CiAgICB4OiAwLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAxLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDAKICB9XSwKICByZWZlcmVuY2U6IFt7CiAgICB4OiAwLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAxLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDAKICB9LCB7CiAgICB4OiAwLAogICAgeTogMAogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAwCiAgfSwgewogICAgeDogLTEsCiAgICB5OiAxCiAgfSwgewogICAgeDogMCwKICAgIHk6IDEKICB9LCB7CiAgICB4OiAxLAogICAgeTogMQogIH1dCn0sIHsKICBjb2Rpbmc6IFt7CiAgICB4OiAtMSwKICAgIHk6IC0xCiAgfSwgewogICAgeDogMCwKICAgIHk6IC0xCiAgfSwgewogICAgeDogMSwKICAgIHk6IC0xCiAgfSwgewogICAgeDogLTEsCiAgICB5OiAwCiAgfV0sCiAgcmVmZXJlbmNlOiBbewogICAgeDogMCwKICAgIHk6IC0xCiAgfSwgewogICAgeDogLTEsCiAgICB5OiAwCiAgfSwgewogICAgeDogMCwKICAgIHk6IDAKICB9LCB7CiAgICB4OiAxLAogICAgeTogMAogIH0sIHsKICAgIHg6IDAsCiAgICB5OiAxCiAgfSwgewogICAgeDogMSwKICAgIHk6IDEKICB9XQp9XTsKY29uc3QgUmV1c2VkQ29udGV4dHMgPSBbMHg5YjI1LCAweDA3OTUsIDB4MDBlNSwgMHgwMTk1XTsKY29uc3QgUmVmaW5lbWVudFJldXNlZENvbnRleHRzID0gWzB4MDAyMCwgMHgwMDA4XTsKZnVuY3Rpb24gZGVjb2RlQml0bWFwVGVtcGxhdGUwKHdpZHRoLCBoZWlnaHQsIGRlY29kaW5nQ29udGV4dCkgewogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0cyA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGUuZ2V0Q29udGV4dHMoIkdCIik7CiAgY29uc3QgYml0bWFwID0gW107CiAgbGV0IGNvbnRleHRMYWJlbCwgaSwgaiwgcGl4ZWwsIHJvdywgcm93MSwgcm93MjsKICBjb25zdCBPTERfUElYRUxfTUFTSyA9IDB4N2JmNzsKICBmb3IgKGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgIHJvdyA9IGJpdG1hcFtpXSA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIHJvdzEgPSBpIDwgMSA/IHJvdyA6IGJpdG1hcFtpIC0gMV07CiAgICByb3cyID0gaSA8IDIgPyByb3cgOiBiaXRtYXBbaSAtIDJdOwogICAgY29udGV4dExhYmVsID0gcm93MlswXSA8PCAxMyB8IHJvdzJbMV0gPDwgMTIgfCByb3cyWzJdIDw8IDExIHwgcm93MVswXSA8PCA3IHwgcm93MVsxXSA8PCA2IHwgcm93MVsyXSA8PCA1IHwgcm93MVszXSA8PCA0OwogICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgcm93W2pdID0gcGl4ZWwgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgIGNvbnRleHRMYWJlbCA9IChjb250ZXh0TGFiZWwgJiBPTERfUElYRUxfTUFTSykgPDwgMSB8IChqICsgMyA8IHdpZHRoID8gcm93MltqICsgM10gPDwgMTEgOiAwKSB8IChqICsgNCA8IHdpZHRoID8gcm93MVtqICsgNF0gPDwgNCA6IDApIHwgcGl4ZWw7CiAgICB9CiAgfQogIHJldHVybiBiaXRtYXA7Cn0KZnVuY3Rpb24gZGVjb2RlQml0bWFwKG1tciwgd2lkdGgsIGhlaWdodCwgdGVtcGxhdGVJbmRleCwgcHJlZGljdGlvbiwgc2tpcCwgYXQsIGRlY29kaW5nQ29udGV4dCkgewogIGlmIChtbXIpIHsKICAgIGNvbnN0IGlucHV0ID0gbmV3IFJlYWRlcihkZWNvZGluZ0NvbnRleHQuZGF0YSwgZGVjb2RpbmdDb250ZXh0LnN0YXJ0LCBkZWNvZGluZ0NvbnRleHQuZW5kKTsKICAgIHJldHVybiBkZWNvZGVNTVJCaXRtYXAoaW5wdXQsIHdpZHRoLCBoZWlnaHQsIGZhbHNlKTsKICB9CiAgaWYgKHRlbXBsYXRlSW5kZXggPT09IDAgJiYgIXNraXAgJiYgIXByZWRpY3Rpb24gJiYgYXQubGVuZ3RoID09PSA0ICYmIGF0WzBdLnggPT09IDMgJiYgYXRbMF0ueSA9PT0gLTEgJiYgYXRbMV0ueCA9PT0gLTMgJiYgYXRbMV0ueSA9PT0gLTEgJiYgYXRbMl0ueCA9PT0gMiAmJiBhdFsyXS55ID09PSAtMiAmJiBhdFszXS54ID09PSAtMiAmJiBhdFszXS55ID09PSAtMikgewogICAgcmV0dXJuIGRlY29kZUJpdG1hcFRlbXBsYXRlMCh3aWR0aCwgaGVpZ2h0LCBkZWNvZGluZ0NvbnRleHQpOwogIH0KICBjb25zdCB1c2Vza2lwID0gISFza2lwOwogIGNvbnN0IHRlbXBsYXRlID0gQ29kaW5nVGVtcGxhdGVzW3RlbXBsYXRlSW5kZXhdLmNvbmNhdChhdCk7CiAgdGVtcGxhdGUuc29ydCgoYSwgYikgPT4gYS55IC0gYi55IHx8IGEueCAtIGIueCk7CiAgY29uc3QgdGVtcGxhdGVMZW5ndGggPSB0ZW1wbGF0ZS5sZW5ndGg7CiAgY29uc3QgdGVtcGxhdGVYID0gbmV3IEludDhBcnJheSh0ZW1wbGF0ZUxlbmd0aCk7CiAgY29uc3QgdGVtcGxhdGVZID0gbmV3IEludDhBcnJheSh0ZW1wbGF0ZUxlbmd0aCk7CiAgY29uc3QgY2hhbmdpbmdUZW1wbGF0ZUVudHJpZXMgPSBbXTsKICBsZXQgcmV1c2VNYXNrID0gMCwKICAgIG1pblggPSAwLAogICAgbWF4WCA9IDAsCiAgICBtaW5ZID0gMDsKICBsZXQgYywgazsKICBmb3IgKGsgPSAwOyBrIDwgdGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgdGVtcGxhdGVYW2tdID0gdGVtcGxhdGVba10ueDsKICAgIHRlbXBsYXRlWVtrXSA9IHRlbXBsYXRlW2tdLnk7CiAgICBtaW5YID0gTWF0aC5taW4obWluWCwgdGVtcGxhdGVba10ueCk7CiAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgdGVtcGxhdGVba10ueCk7CiAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgdGVtcGxhdGVba10ueSk7CiAgICBpZiAoayA8IHRlbXBsYXRlTGVuZ3RoIC0gMSAmJiB0ZW1wbGF0ZVtrXS55ID09PSB0ZW1wbGF0ZVtrICsgMV0ueSAmJiB0ZW1wbGF0ZVtrXS54ID09PSB0ZW1wbGF0ZVtrICsgMV0ueCAtIDEpIHsKICAgICAgcmV1c2VNYXNrIHw9IDEgPDwgdGVtcGxhdGVMZW5ndGggLSAxIC0gazsKICAgIH0gZWxzZSB7CiAgICAgIGNoYW5naW5nVGVtcGxhdGVFbnRyaWVzLnB1c2goayk7CiAgICB9CiAgfQogIGNvbnN0IGNoYW5naW5nRW50cmllc0xlbmd0aCA9IGNoYW5naW5nVGVtcGxhdGVFbnRyaWVzLmxlbmd0aDsKICBjb25zdCBjaGFuZ2luZ1RlbXBsYXRlWCA9IG5ldyBJbnQ4QXJyYXkoY2hhbmdpbmdFbnRyaWVzTGVuZ3RoKTsKICBjb25zdCBjaGFuZ2luZ1RlbXBsYXRlWSA9IG5ldyBJbnQ4QXJyYXkoY2hhbmdpbmdFbnRyaWVzTGVuZ3RoKTsKICBjb25zdCBjaGFuZ2luZ1RlbXBsYXRlQml0ID0gbmV3IFVpbnQxNkFycmF5KGNoYW5naW5nRW50cmllc0xlbmd0aCk7CiAgZm9yIChjID0gMDsgYyA8IGNoYW5naW5nRW50cmllc0xlbmd0aDsgYysrKSB7CiAgICBrID0gY2hhbmdpbmdUZW1wbGF0ZUVudHJpZXNbY107CiAgICBjaGFuZ2luZ1RlbXBsYXRlWFtjXSA9IHRlbXBsYXRlW2tdLng7CiAgICBjaGFuZ2luZ1RlbXBsYXRlWVtjXSA9IHRlbXBsYXRlW2tdLnk7CiAgICBjaGFuZ2luZ1RlbXBsYXRlQml0W2NdID0gMSA8PCB0ZW1wbGF0ZUxlbmd0aCAtIDEgLSBrOwogIH0KICBjb25zdCBzYmJfbGVmdCA9IC1taW5YOwogIGNvbnN0IHNiYl90b3AgPSAtbWluWTsKICBjb25zdCBzYmJfcmlnaHQgPSB3aWR0aCAtIG1heFg7CiAgY29uc3QgcHNldWRvUGl4ZWxDb250ZXh0ID0gUmV1c2VkQ29udGV4dHNbdGVtcGxhdGVJbmRleF07CiAgbGV0IHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBjb25zdCBkZWNvZGVyID0gZGVjb2RpbmdDb250ZXh0LmRlY29kZXI7CiAgY29uc3QgY29udGV4dHMgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlLmdldENvbnRleHRzKCJHQiIpOwogIGxldCBsdHAgPSAwLAogICAgaiwKICAgIGkwLAogICAgajAsCiAgICBjb250ZXh0TGFiZWwgPSAwLAogICAgYml0LAogICAgc2hpZnQ7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgaWYgKHByZWRpY3Rpb24pIHsKICAgICAgY29uc3Qgc2x0cCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgcHNldWRvUGl4ZWxDb250ZXh0KTsKICAgICAgbHRwIF49IHNsdHA7CiAgICAgIGlmIChsdHApIHsKICAgICAgICBiaXRtYXAucHVzaChyb3cpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICB9CiAgICByb3cgPSBuZXcgVWludDhBcnJheShyb3cpOwogICAgYml0bWFwLnB1c2gocm93KTsKICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgIGlmICh1c2Vza2lwICYmIHNraXBbaV1bal0pIHsKICAgICAgICByb3dbal0gPSAwOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChqID49IHNiYl9sZWZ0ICYmIGogPCBzYmJfcmlnaHQgJiYgaSA+PSBzYmJfdG9wKSB7CiAgICAgICAgY29udGV4dExhYmVsID0gY29udGV4dExhYmVsIDw8IDEgJiByZXVzZU1hc2s7CiAgICAgICAgZm9yIChrID0gMDsgayA8IGNoYW5naW5nRW50cmllc0xlbmd0aDsgaysrKSB7CiAgICAgICAgICBpMCA9IGkgKyBjaGFuZ2luZ1RlbXBsYXRlWVtrXTsKICAgICAgICAgIGowID0gaiArIGNoYW5naW5nVGVtcGxhdGVYW2tdOwogICAgICAgICAgYml0ID0gYml0bWFwW2kwXVtqMF07CiAgICAgICAgICBpZiAoYml0KSB7CiAgICAgICAgICAgIGJpdCA9IGNoYW5naW5nVGVtcGxhdGVCaXRba107CiAgICAgICAgICAgIGNvbnRleHRMYWJlbCB8PSBiaXQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnRleHRMYWJlbCA9IDA7CiAgICAgICAgc2hpZnQgPSB0ZW1wbGF0ZUxlbmd0aCAtIDE7CiAgICAgICAgZm9yIChrID0gMDsgayA8IHRlbXBsYXRlTGVuZ3RoOyBrKyssIHNoaWZ0LS0pIHsKICAgICAgICAgIGowID0gaiArIHRlbXBsYXRlWFtrXTsKICAgICAgICAgIGlmIChqMCA+PSAwICYmIGowIDwgd2lkdGgpIHsKICAgICAgICAgICAgaTAgPSBpICsgdGVtcGxhdGVZW2tdOwogICAgICAgICAgICBpZiAoaTAgPj0gMCkgewogICAgICAgICAgICAgIGJpdCA9IGJpdG1hcFtpMF1bajBdOwogICAgICAgICAgICAgIGlmIChiaXQpIHsKICAgICAgICAgICAgICAgIGNvbnRleHRMYWJlbCB8PSBiaXQgPDwgc2hpZnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHBpeGVsID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBjb250ZXh0TGFiZWwpOwogICAgICByb3dbal0gPSBwaXhlbDsKICAgIH0KICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVSZWZpbmVtZW50KHdpZHRoLCBoZWlnaHQsIHRlbXBsYXRlSW5kZXgsIHJlZmVyZW5jZUJpdG1hcCwgb2Zmc2V0WCwgb2Zmc2V0WSwgcHJlZGljdGlvbiwgYXQsIGRlY29kaW5nQ29udGV4dCkgewogIGxldCBjb2RpbmdUZW1wbGF0ZSA9IFJlZmluZW1lbnRUZW1wbGF0ZXNbdGVtcGxhdGVJbmRleF0uY29kaW5nOwogIGlmICh0ZW1wbGF0ZUluZGV4ID09PSAwKSB7CiAgICBjb2RpbmdUZW1wbGF0ZSA9IGNvZGluZ1RlbXBsYXRlLmNvbmNhdChbYXRbMF1dKTsKICB9CiAgY29uc3QgY29kaW5nVGVtcGxhdGVMZW5ndGggPSBjb2RpbmdUZW1wbGF0ZS5sZW5ndGg7CiAgY29uc3QgY29kaW5nVGVtcGxhdGVYID0gbmV3IEludDMyQXJyYXkoY29kaW5nVGVtcGxhdGVMZW5ndGgpOwogIGNvbnN0IGNvZGluZ1RlbXBsYXRlWSA9IG5ldyBJbnQzMkFycmF5KGNvZGluZ1RlbXBsYXRlTGVuZ3RoKTsKICBsZXQgazsKICBmb3IgKGsgPSAwOyBrIDwgY29kaW5nVGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgY29kaW5nVGVtcGxhdGVYW2tdID0gY29kaW5nVGVtcGxhdGVba10ueDsKICAgIGNvZGluZ1RlbXBsYXRlWVtrXSA9IGNvZGluZ1RlbXBsYXRlW2tdLnk7CiAgfQogIGxldCByZWZlcmVuY2VUZW1wbGF0ZSA9IFJlZmluZW1lbnRUZW1wbGF0ZXNbdGVtcGxhdGVJbmRleF0ucmVmZXJlbmNlOwogIGlmICh0ZW1wbGF0ZUluZGV4ID09PSAwKSB7CiAgICByZWZlcmVuY2VUZW1wbGF0ZSA9IHJlZmVyZW5jZVRlbXBsYXRlLmNvbmNhdChbYXRbMV1dKTsKICB9CiAgY29uc3QgcmVmZXJlbmNlVGVtcGxhdGVMZW5ndGggPSByZWZlcmVuY2VUZW1wbGF0ZS5sZW5ndGg7CiAgY29uc3QgcmVmZXJlbmNlVGVtcGxhdGVYID0gbmV3IEludDMyQXJyYXkocmVmZXJlbmNlVGVtcGxhdGVMZW5ndGgpOwogIGNvbnN0IHJlZmVyZW5jZVRlbXBsYXRlWSA9IG5ldyBJbnQzMkFycmF5KHJlZmVyZW5jZVRlbXBsYXRlTGVuZ3RoKTsKICBmb3IgKGsgPSAwOyBrIDwgcmVmZXJlbmNlVGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgcmVmZXJlbmNlVGVtcGxhdGVYW2tdID0gcmVmZXJlbmNlVGVtcGxhdGVba10ueDsKICAgIHJlZmVyZW5jZVRlbXBsYXRlWVtrXSA9IHJlZmVyZW5jZVRlbXBsYXRlW2tdLnk7CiAgfQogIGNvbnN0IHJlZmVyZW5jZVdpZHRoID0gcmVmZXJlbmNlQml0bWFwWzBdLmxlbmd0aDsKICBjb25zdCByZWZlcmVuY2VIZWlnaHQgPSByZWZlcmVuY2VCaXRtYXAubGVuZ3RoOwogIGNvbnN0IHBzZXVkb1BpeGVsQ29udGV4dCA9IFJlZmluZW1lbnRSZXVzZWRDb250ZXh0c1t0ZW1wbGF0ZUluZGV4XTsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBjb25zdCBkZWNvZGVyID0gZGVjb2RpbmdDb250ZXh0LmRlY29kZXI7CiAgY29uc3QgY29udGV4dHMgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlLmdldENvbnRleHRzKCJHUiIpOwogIGxldCBsdHAgPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgIGlmIChwcmVkaWN0aW9uKSB7CiAgICAgIGNvbnN0IHNsdHAgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIHBzZXVkb1BpeGVsQ29udGV4dCk7CiAgICAgIGx0cCBePSBzbHRwOwogICAgICBpZiAobHRwKSB7CiAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInByZWRpY3Rpb24gaXMgbm90IHN1cHBvcnRlZCIpOwogICAgICB9CiAgICB9CiAgICBjb25zdCByb3cgPSBuZXcgVWludDhBcnJheSh3aWR0aCk7CiAgICBiaXRtYXAucHVzaChyb3cpOwogICAgZm9yIChsZXQgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgIGxldCBpMCwgajA7CiAgICAgIGxldCBjb250ZXh0TGFiZWwgPSAwOwogICAgICBmb3IgKGsgPSAwOyBrIDwgY29kaW5nVGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgICAgIGkwID0gaSArIGNvZGluZ1RlbXBsYXRlWVtrXTsKICAgICAgICBqMCA9IGogKyBjb2RpbmdUZW1wbGF0ZVhba107CiAgICAgICAgaWYgKGkwIDwgMCB8fCBqMCA8IDAgfHwgajAgPj0gd2lkdGgpIHsKICAgICAgICAgIGNvbnRleHRMYWJlbCA8PD0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGV4dExhYmVsID0gY29udGV4dExhYmVsIDw8IDEgfCBiaXRtYXBbaTBdW2owXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChrID0gMDsgayA8IHJlZmVyZW5jZVRlbXBsYXRlTGVuZ3RoOyBrKyspIHsKICAgICAgICBpMCA9IGkgKyByZWZlcmVuY2VUZW1wbGF0ZVlba10gLSBvZmZzZXRZOwogICAgICAgIGowID0gaiArIHJlZmVyZW5jZVRlbXBsYXRlWFtrXSAtIG9mZnNldFg7CiAgICAgICAgaWYgKGkwIDwgMCB8fCBpMCA+PSByZWZlcmVuY2VIZWlnaHQgfHwgajAgPCAwIHx8IGowID49IHJlZmVyZW5jZVdpZHRoKSB7CiAgICAgICAgICBjb250ZXh0TGFiZWwgPDw9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnRleHRMYWJlbCA9IGNvbnRleHRMYWJlbCA8PCAxIHwgcmVmZXJlbmNlQml0bWFwW2kwXVtqMF07CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHBpeGVsID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBjb250ZXh0TGFiZWwpOwogICAgICByb3dbal0gPSBwaXhlbDsKICAgIH0KICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVTeW1ib2xEaWN0aW9uYXJ5KGh1ZmZtYW4sIHJlZmluZW1lbnQsIHN5bWJvbHMsIG51bWJlck9mTmV3U3ltYm9scywgbnVtYmVyT2ZFeHBvcnRlZFN5bWJvbHMsIGh1ZmZtYW5UYWJsZXMsIHRlbXBsYXRlSW5kZXgsIGF0LCByZWZpbmVtZW50VGVtcGxhdGVJbmRleCwgcmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIGh1ZmZtYW5JbnB1dCkgewogIGlmIChodWZmbWFuICYmIHJlZmluZW1lbnQpIHsKICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJzeW1ib2wgcmVmaW5lbWVudCB3aXRoIEh1ZmZtYW4gaXMgbm90IHN1cHBvcnRlZCIpOwogIH0KICBjb25zdCBuZXdTeW1ib2xzID0gW107CiAgbGV0IGN1cnJlbnRIZWlnaHQgPSAwOwogIGxldCBzeW1ib2xDb2RlTGVuZ3RoID0gbG9nMihzeW1ib2xzLmxlbmd0aCArIG51bWJlck9mTmV3U3ltYm9scyk7CiAgY29uc3QgZGVjb2RlciA9IGRlY29kaW5nQ29udGV4dC5kZWNvZGVyOwogIGNvbnN0IGNvbnRleHRDYWNoZSA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGU7CiAgbGV0IHRhYmxlQjEsIHN5bWJvbFdpZHRoczsKICBpZiAoaHVmZm1hbikgewogICAgdGFibGVCMSA9IGdldFN0YW5kYXJkVGFibGUoMSk7CiAgICBzeW1ib2xXaWR0aHMgPSBbXTsKICAgIHN5bWJvbENvZGVMZW5ndGggPSBNYXRoLm1heChzeW1ib2xDb2RlTGVuZ3RoLCAxKTsKICB9CiAgd2hpbGUgKG5ld1N5bWJvbHMubGVuZ3RoIDwgbnVtYmVyT2ZOZXdTeW1ib2xzKSB7CiAgICBjb25zdCBkZWx0YUhlaWdodCA9IGh1ZmZtYW4gPyBodWZmbWFuVGFibGVzLnRhYmxlRGVsdGFIZWlnaHQuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBREgiLCBkZWNvZGVyKTsKICAgIGN1cnJlbnRIZWlnaHQgKz0gZGVsdGFIZWlnaHQ7CiAgICBsZXQgY3VycmVudFdpZHRoID0gMCwKICAgICAgdG90YWxXaWR0aCA9IDA7CiAgICBjb25zdCBmaXJzdFN5bWJvbCA9IGh1ZmZtYW4gPyBzeW1ib2xXaWR0aHMubGVuZ3RoIDogMDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IGRlbHRhV2lkdGggPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy50YWJsZURlbHRhV2lkdGguZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFciLCBkZWNvZGVyKTsKICAgICAgaWYgKGRlbHRhV2lkdGggPT09IG51bGwpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjdXJyZW50V2lkdGggKz0gZGVsdGFXaWR0aDsKICAgICAgdG90YWxXaWR0aCArPSBjdXJyZW50V2lkdGg7CiAgICAgIGxldCBiaXRtYXA7CiAgICAgIGlmIChyZWZpbmVtZW50KSB7CiAgICAgICAgY29uc3QgbnVtYmVyT2ZJbnN0YW5jZXMgPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBQUkiLCBkZWNvZGVyKTsKICAgICAgICBpZiAobnVtYmVyT2ZJbnN0YW5jZXMgPiAxKSB7CiAgICAgICAgICBiaXRtYXAgPSBkZWNvZGVUZXh0UmVnaW9uKGh1ZmZtYW4sIHJlZmluZW1lbnQsIGN1cnJlbnRXaWR0aCwgY3VycmVudEhlaWdodCwgMCwgbnVtYmVyT2ZJbnN0YW5jZXMsIDEsIHN5bWJvbHMuY29uY2F0KG5ld1N5bWJvbHMpLCBzeW1ib2xDb2RlTGVuZ3RoLCAwLCAwLCAxLCAwLCBodWZmbWFuVGFibGVzLCByZWZpbmVtZW50VGVtcGxhdGVJbmRleCwgcmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIDAsIGh1ZmZtYW5JbnB1dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHN5bWJvbElkID0gZGVjb2RlSUFJRChjb250ZXh0Q2FjaGUsIGRlY29kZXIsIHN5bWJvbENvZGVMZW5ndGgpOwogICAgICAgICAgY29uc3QgcmR4ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWCIsIGRlY29kZXIpOwogICAgICAgICAgY29uc3QgcmR5ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWSIsIGRlY29kZXIpOwogICAgICAgICAgY29uc3Qgc3ltYm9sID0gc3ltYm9sSWQgPCBzeW1ib2xzLmxlbmd0aCA/IHN5bWJvbHNbc3ltYm9sSWRdIDogbmV3U3ltYm9sc1tzeW1ib2xJZCAtIHN5bWJvbHMubGVuZ3RoXTsKICAgICAgICAgIGJpdG1hcCA9IGRlY29kZVJlZmluZW1lbnQoY3VycmVudFdpZHRoLCBjdXJyZW50SGVpZ2h0LCByZWZpbmVtZW50VGVtcGxhdGVJbmRleCwgc3ltYm9sLCByZHgsIHJkeSwgZmFsc2UsIHJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgbmV3U3ltYm9scy5wdXNoKGJpdG1hcCk7CiAgICAgIH0gZWxzZSBpZiAoaHVmZm1hbikgewogICAgICAgIHN5bWJvbFdpZHRocy5wdXNoKGN1cnJlbnRXaWR0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYml0bWFwID0gZGVjb2RlQml0bWFwKGZhbHNlLCBjdXJyZW50V2lkdGgsIGN1cnJlbnRIZWlnaHQsIHRlbXBsYXRlSW5kZXgsIGZhbHNlLCBudWxsLCBhdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgICBuZXdTeW1ib2xzLnB1c2goYml0bWFwKTsKICAgICAgfQogICAgfQogICAgaWYgKGh1ZmZtYW4gJiYgIXJlZmluZW1lbnQpIHsKICAgICAgY29uc3QgYml0bWFwU2l6ZSA9IGh1ZmZtYW5UYWJsZXMudGFibGVCaXRtYXBTaXplLmRlY29kZShodWZmbWFuSW5wdXQpOwogICAgICBodWZmbWFuSW5wdXQuYnl0ZUFsaWduKCk7CiAgICAgIGxldCBjb2xsZWN0aXZlQml0bWFwOwogICAgICBpZiAoYml0bWFwU2l6ZSA9PT0gMCkgewogICAgICAgIGNvbGxlY3RpdmVCaXRtYXAgPSByZWFkVW5jb21wcmVzc2VkQml0bWFwKGh1ZmZtYW5JbnB1dCwgdG90YWxXaWR0aCwgY3VycmVudEhlaWdodCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3Qgb3JpZ2luYWxFbmQgPSBodWZmbWFuSW5wdXQuZW5kOwogICAgICAgIGNvbnN0IGJpdG1hcEVuZCA9IGh1ZmZtYW5JbnB1dC5wb3NpdGlvbiArIGJpdG1hcFNpemU7CiAgICAgICAgaHVmZm1hbklucHV0LmVuZCA9IGJpdG1hcEVuZDsKICAgICAgICBjb2xsZWN0aXZlQml0bWFwID0gZGVjb2RlTU1SQml0bWFwKGh1ZmZtYW5JbnB1dCwgdG90YWxXaWR0aCwgY3VycmVudEhlaWdodCwgZmFsc2UpOwogICAgICAgIGh1ZmZtYW5JbnB1dC5lbmQgPSBvcmlnaW5hbEVuZDsKICAgICAgICBodWZmbWFuSW5wdXQucG9zaXRpb24gPSBiaXRtYXBFbmQ7CiAgICAgIH0KICAgICAgY29uc3QgbnVtYmVyT2ZTeW1ib2xzRGVjb2RlZCA9IHN5bWJvbFdpZHRocy5sZW5ndGg7CiAgICAgIGlmIChmaXJzdFN5bWJvbCA9PT0gbnVtYmVyT2ZTeW1ib2xzRGVjb2RlZCAtIDEpIHsKICAgICAgICBuZXdTeW1ib2xzLnB1c2goY29sbGVjdGl2ZUJpdG1hcCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IGksCiAgICAgICAgICB5LAogICAgICAgICAgeE1pbiA9IDAsCiAgICAgICAgICB4TWF4LAogICAgICAgICAgYml0bWFwV2lkdGgsCiAgICAgICAgICBzeW1ib2xCaXRtYXA7CiAgICAgICAgZm9yIChpID0gZmlyc3RTeW1ib2w7IGkgPCBudW1iZXJPZlN5bWJvbHNEZWNvZGVkOyBpKyspIHsKICAgICAgICAgIGJpdG1hcFdpZHRoID0gc3ltYm9sV2lkdGhzW2ldOwogICAgICAgICAgeE1heCA9IHhNaW4gKyBiaXRtYXBXaWR0aDsKICAgICAgICAgIHN5bWJvbEJpdG1hcCA9IFtdOwogICAgICAgICAgZm9yICh5ID0gMDsgeSA8IGN1cnJlbnRIZWlnaHQ7IHkrKykgewogICAgICAgICAgICBzeW1ib2xCaXRtYXAucHVzaChjb2xsZWN0aXZlQml0bWFwW3ldLnN1YmFycmF5KHhNaW4sIHhNYXgpKTsKICAgICAgICAgIH0KICAgICAgICAgIG5ld1N5bWJvbHMucHVzaChzeW1ib2xCaXRtYXApOwogICAgICAgICAgeE1pbiA9IHhNYXg7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGNvbnN0IGV4cG9ydGVkU3ltYm9scyA9IFtdLAogICAgZmxhZ3MgPSBbXTsKICBsZXQgY3VycmVudEZsYWcgPSBmYWxzZSwKICAgIGksCiAgICBpaTsKICBjb25zdCB0b3RhbFN5bWJvbHNMZW5ndGggPSBzeW1ib2xzLmxlbmd0aCArIG51bWJlck9mTmV3U3ltYm9sczsKICB3aGlsZSAoZmxhZ3MubGVuZ3RoIDwgdG90YWxTeW1ib2xzTGVuZ3RoKSB7CiAgICBsZXQgcnVuTGVuZ3RoID0gaHVmZm1hbiA/IHRhYmxlQjEuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRVgiLCBkZWNvZGVyKTsKICAgIHdoaWxlIChydW5MZW5ndGgtLSkgewogICAgICBmbGFncy5wdXNoKGN1cnJlbnRGbGFnKTsKICAgIH0KICAgIGN1cnJlbnRGbGFnID0gIWN1cnJlbnRGbGFnOwogIH0KICBmb3IgKGkgPSAwLCBpaSA9IHN5bWJvbHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgaWYgKGZsYWdzW2ldKSB7CiAgICAgIGV4cG9ydGVkU3ltYm9scy5wdXNoKHN5bWJvbHNbaV0pOwogICAgfQogIH0KICBmb3IgKGxldCBqID0gMDsgaiA8IG51bWJlck9mTmV3U3ltYm9sczsgaSsrLCBqKyspIHsKICAgIGlmIChmbGFnc1tpXSkgewogICAgICBleHBvcnRlZFN5bWJvbHMucHVzaChuZXdTeW1ib2xzW2pdKTsKICAgIH0KICB9CiAgcmV0dXJuIGV4cG9ydGVkU3ltYm9sczsKfQpmdW5jdGlvbiBkZWNvZGVUZXh0UmVnaW9uKGh1ZmZtYW4sIHJlZmluZW1lbnQsIHdpZHRoLCBoZWlnaHQsIGRlZmF1bHRQaXhlbFZhbHVlLCBudW1iZXJPZlN5bWJvbEluc3RhbmNlcywgc3RyaXBTaXplLCBpbnB1dFN5bWJvbHMsIHN5bWJvbENvZGVMZW5ndGgsIHRyYW5zcG9zZWQsIGRzT2Zmc2V0LCByZWZlcmVuY2VDb3JuZXIsIGNvbWJpbmF0aW9uT3BlcmF0b3IsIGh1ZmZtYW5UYWJsZXMsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgbG9nU3RyaXBTaXplLCBodWZmbWFuSW5wdXQpIHsKICBpZiAoaHVmZm1hbiAmJiByZWZpbmVtZW50KSB7CiAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigicmVmaW5lbWVudCB3aXRoIEh1ZmZtYW4gaXMgbm90IHN1cHBvcnRlZCIpOwogIH0KICBjb25zdCBiaXRtYXAgPSBbXTsKICBsZXQgaSwgcm93OwogIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwogICAgaWYgKGRlZmF1bHRQaXhlbFZhbHVlKSB7CiAgICAgIHJvdy5maWxsKGRlZmF1bHRQaXhlbFZhbHVlKTsKICAgIH0KICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgfQogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0Q2FjaGUgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlOwogIGxldCBzdHJpcFQgPSBodWZmbWFuID8gLWh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVQuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiAtZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQURUIiwgZGVjb2Rlcik7CiAgbGV0IGZpcnN0UyA9IDA7CiAgaSA9IDA7CiAgd2hpbGUgKGkgPCBudW1iZXJPZlN5bWJvbEluc3RhbmNlcykgewogICAgY29uc3QgZGVsdGFUID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVQuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFQiLCBkZWNvZGVyKTsKICAgIHN0cmlwVCArPSBkZWx0YVQ7CiAgICBjb25zdCBkZWx0YUZpcnN0UyA9IGh1ZmZtYW4gPyBodWZmbWFuVGFibGVzLnRhYmxlRmlyc3RTLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQUZTIiwgZGVjb2Rlcik7CiAgICBmaXJzdFMgKz0gZGVsdGFGaXJzdFM7CiAgICBsZXQgY3VycmVudFMgPSBmaXJzdFM7CiAgICBkbyB7CiAgICAgIGxldCBjdXJyZW50VCA9IDA7CiAgICAgIGlmIChzdHJpcFNpemUgPiAxKSB7CiAgICAgICAgY3VycmVudFQgPSBodWZmbWFuID8gaHVmZm1hbklucHV0LnJlYWRCaXRzKGxvZ1N0cmlwU2l6ZSkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBSVQiLCBkZWNvZGVyKTsKICAgICAgfQogICAgICBjb25zdCB0ID0gc3RyaXBTaXplICogc3RyaXBUICsgY3VycmVudFQ7CiAgICAgIGNvbnN0IHN5bWJvbElkID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMuc3ltYm9sSURUYWJsZS5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUlBSUQoY29udGV4dENhY2hlLCBkZWNvZGVyLCBzeW1ib2xDb2RlTGVuZ3RoKTsKICAgICAgY29uc3QgYXBwbHlSZWZpbmVtZW50ID0gcmVmaW5lbWVudCAmJiAoaHVmZm1hbiA/IGh1ZmZtYW5JbnB1dC5yZWFkQml0KCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkkiLCBkZWNvZGVyKSk7CiAgICAgIGxldCBzeW1ib2xCaXRtYXAgPSBpbnB1dFN5bWJvbHNbc3ltYm9sSWRdOwogICAgICBsZXQgc3ltYm9sV2lkdGggPSBzeW1ib2xCaXRtYXBbMF0ubGVuZ3RoOwogICAgICBsZXQgc3ltYm9sSGVpZ2h0ID0gc3ltYm9sQml0bWFwLmxlbmd0aDsKICAgICAgaWYgKGFwcGx5UmVmaW5lbWVudCkgewogICAgICAgIGNvbnN0IHJkdyA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSRFciLCBkZWNvZGVyKTsKICAgICAgICBjb25zdCByZGggPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkRIIiwgZGVjb2Rlcik7CiAgICAgICAgY29uc3QgcmR4ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWCIsIGRlY29kZXIpOwogICAgICAgIGNvbnN0IHJkeSA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSRFkiLCBkZWNvZGVyKTsKICAgICAgICBzeW1ib2xXaWR0aCArPSByZHc7CiAgICAgICAgc3ltYm9sSGVpZ2h0ICs9IHJkaDsKICAgICAgICBzeW1ib2xCaXRtYXAgPSBkZWNvZGVSZWZpbmVtZW50KHN5bWJvbFdpZHRoLCBzeW1ib2xIZWlnaHQsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCBzeW1ib2xCaXRtYXAsIChyZHcgPj4gMSkgKyByZHgsIChyZGggPj4gMSkgKyByZHksIGZhbHNlLCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCk7CiAgICAgIH0KICAgICAgbGV0IGluY3JlbWVudCA9IDA7CiAgICAgIGlmICghdHJhbnNwb3NlZCkgewogICAgICAgIGlmIChyZWZlcmVuY2VDb3JuZXIgPiAxKSB7CiAgICAgICAgICBjdXJyZW50UyArPSBzeW1ib2xXaWR0aCAtIDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGluY3JlbWVudCA9IHN5bWJvbFdpZHRoIC0gMTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoIShyZWZlcmVuY2VDb3JuZXIgJiAxKSkgewogICAgICAgIGN1cnJlbnRTICs9IHN5bWJvbEhlaWdodCAtIDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW5jcmVtZW50ID0gc3ltYm9sSGVpZ2h0IC0gMTsKICAgICAgfQogICAgICBjb25zdCBvZmZzZXRUID0gdCAtIChyZWZlcmVuY2VDb3JuZXIgJiAxID8gMCA6IHN5bWJvbEhlaWdodCAtIDEpOwogICAgICBjb25zdCBvZmZzZXRTID0gY3VycmVudFMgLSAocmVmZXJlbmNlQ29ybmVyICYgMiA/IHN5bWJvbFdpZHRoIC0gMSA6IDApOwogICAgICBsZXQgczIsIHQyLCBzeW1ib2xSb3c7CiAgICAgIGlmICh0cmFuc3Bvc2VkKSB7CiAgICAgICAgZm9yIChzMiA9IDA7IHMyIDwgc3ltYm9sSGVpZ2h0OyBzMisrKSB7CiAgICAgICAgICByb3cgPSBiaXRtYXBbb2Zmc2V0UyArIHMyXTsKICAgICAgICAgIGlmICghcm93KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc3ltYm9sUm93ID0gc3ltYm9sQml0bWFwW3MyXTsKICAgICAgICAgIGNvbnN0IG1heFdpZHRoID0gTWF0aC5taW4od2lkdGggLSBvZmZzZXRULCBzeW1ib2xXaWR0aCk7CiAgICAgICAgICBzd2l0Y2ggKGNvbWJpbmF0aW9uT3BlcmF0b3IpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZvciAodDIgPSAwOyB0MiA8IG1heFdpZHRoOyB0MisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0VCArIHQyXSB8PSBzeW1ib2xSb3dbdDJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGZvciAodDIgPSAwOyB0MiA8IG1heFdpZHRoOyB0MisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0VCArIHQyXSBePSBzeW1ib2xSb3dbdDJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgb3BlcmF0b3IgJHtjb21iaW5hdGlvbk9wZXJhdG9yfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAodDIgPSAwOyB0MiA8IHN5bWJvbEhlaWdodDsgdDIrKykgewogICAgICAgICAgcm93ID0gYml0bWFwW29mZnNldFQgKyB0Ml07CiAgICAgICAgICBpZiAoIXJvdykgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHN5bWJvbFJvdyA9IHN5bWJvbEJpdG1hcFt0Ml07CiAgICAgICAgICBzd2l0Y2ggKGNvbWJpbmF0aW9uT3BlcmF0b3IpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZvciAoczIgPSAwOyBzMiA8IHN5bWJvbFdpZHRoOyBzMisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0UyArIHMyXSB8PSBzeW1ib2xSb3dbczJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGZvciAoczIgPSAwOyBzMiA8IHN5bWJvbFdpZHRoOyBzMisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0UyArIHMyXSBePSBzeW1ib2xSb3dbczJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgb3BlcmF0b3IgJHtjb21iaW5hdGlvbk9wZXJhdG9yfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGkrKzsKICAgICAgY29uc3QgZGVsdGFTID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVMuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFMiLCBkZWNvZGVyKTsKICAgICAgaWYgKGRlbHRhUyA9PT0gbnVsbCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGN1cnJlbnRTICs9IGluY3JlbWVudCArIGRlbHRhUyArIGRzT2Zmc2V0OwogICAgfSB3aGlsZSAodHJ1ZSk7CiAgfQogIHJldHVybiBiaXRtYXA7Cn0KZnVuY3Rpb24gZGVjb2RlUGF0dGVybkRpY3Rpb25hcnkobW1yLCBwYXR0ZXJuV2lkdGgsIHBhdHRlcm5IZWlnaHQsIG1heFBhdHRlcm5JbmRleCwgdGVtcGxhdGUsIGRlY29kaW5nQ29udGV4dCkgewogIGNvbnN0IGF0ID0gW107CiAgaWYgKCFtbXIpIHsKICAgIGF0LnB1c2goewogICAgICB4OiAtcGF0dGVybldpZHRoLAogICAgICB5OiAwCiAgICB9KTsKICAgIGlmICh0ZW1wbGF0ZSA9PT0gMCkgewogICAgICBhdC5wdXNoKHsKICAgICAgICB4OiAtMywKICAgICAgICB5OiAtMQogICAgICB9LCB7CiAgICAgICAgeDogMiwKICAgICAgICB5OiAtMgogICAgICB9LCB7CiAgICAgICAgeDogLTIsCiAgICAgICAgeTogLTIKICAgICAgfSk7CiAgICB9CiAgfQogIGNvbnN0IGNvbGxlY3RpdmVXaWR0aCA9IChtYXhQYXR0ZXJuSW5kZXggKyAxKSAqIHBhdHRlcm5XaWR0aDsKICBjb25zdCBjb2xsZWN0aXZlQml0bWFwID0gZGVjb2RlQml0bWFwKG1tciwgY29sbGVjdGl2ZVdpZHRoLCBwYXR0ZXJuSGVpZ2h0LCB0ZW1wbGF0ZSwgZmFsc2UsIG51bGwsIGF0LCBkZWNvZGluZ0NvbnRleHQpOwogIGNvbnN0IHBhdHRlcm5zID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbWF4UGF0dGVybkluZGV4OyBpKyspIHsKICAgIGNvbnN0IHBhdHRlcm5CaXRtYXAgPSBbXTsKICAgIGNvbnN0IHhNaW4gPSBwYXR0ZXJuV2lkdGggKiBpOwogICAgY29uc3QgeE1heCA9IHhNaW4gKyBwYXR0ZXJuV2lkdGg7CiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHBhdHRlcm5IZWlnaHQ7IHkrKykgewogICAgICBwYXR0ZXJuQml0bWFwLnB1c2goY29sbGVjdGl2ZUJpdG1hcFt5XS5zdWJhcnJheSh4TWluLCB4TWF4KSk7CiAgICB9CiAgICBwYXR0ZXJucy5wdXNoKHBhdHRlcm5CaXRtYXApOwogIH0KICByZXR1cm4gcGF0dGVybnM7Cn0KZnVuY3Rpb24gZGVjb2RlSGFsZnRvbmVSZWdpb24obW1yLCBwYXR0ZXJucywgdGVtcGxhdGUsIHJlZ2lvbldpZHRoLCByZWdpb25IZWlnaHQsIGRlZmF1bHRQaXhlbFZhbHVlLCBlbmFibGVTa2lwLCBjb21iaW5hdGlvbk9wZXJhdG9yLCBncmlkV2lkdGgsIGdyaWRIZWlnaHQsIGdyaWRPZmZzZXRYLCBncmlkT2Zmc2V0WSwgZ3JpZFZlY3RvclgsIGdyaWRWZWN0b3JZLCBkZWNvZGluZ0NvbnRleHQpIHsKICBjb25zdCBza2lwID0gbnVsbDsKICBpZiAoZW5hYmxlU2tpcCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInNraXAgaXMgbm90IHN1cHBvcnRlZCIpOwogIH0KICBpZiAoY29tYmluYXRpb25PcGVyYXRvciAhPT0gMCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoYG9wZXJhdG9yICIke2NvbWJpbmF0aW9uT3BlcmF0b3J9IiBpcyBub3Qgc3VwcG9ydGVkIGluIGhhbGZ0b25lIHJlZ2lvbmApOwogIH0KICBjb25zdCByZWdpb25CaXRtYXAgPSBbXTsKICBsZXQgaSwgaiwgcm93OwogIGZvciAoaSA9IDA7IGkgPCByZWdpb25IZWlnaHQ7IGkrKykgewogICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkocmVnaW9uV2lkdGgpOwogICAgaWYgKGRlZmF1bHRQaXhlbFZhbHVlKSB7CiAgICAgIHJvdy5maWxsKGRlZmF1bHRQaXhlbFZhbHVlKTsKICAgIH0KICAgIHJlZ2lvbkJpdG1hcC5wdXNoKHJvdyk7CiAgfQogIGNvbnN0IG51bWJlck9mUGF0dGVybnMgPSBwYXR0ZXJucy5sZW5ndGg7CiAgY29uc3QgcGF0dGVybjAgPSBwYXR0ZXJuc1swXTsKICBjb25zdCBwYXR0ZXJuV2lkdGggPSBwYXR0ZXJuMFswXS5sZW5ndGgsCiAgICBwYXR0ZXJuSGVpZ2h0ID0gcGF0dGVybjAubGVuZ3RoOwogIGNvbnN0IGJpdHNQZXJWYWx1ZSA9IGxvZzIobnVtYmVyT2ZQYXR0ZXJucyk7CiAgY29uc3QgYXQgPSBbXTsKICBpZiAoIW1tcikgewogICAgYXQucHVzaCh7CiAgICAgIHg6IHRlbXBsYXRlIDw9IDEgPyAzIDogMiwKICAgICAgeTogLTEKICAgIH0pOwogICAgaWYgKHRlbXBsYXRlID09PSAwKSB7CiAgICAgIGF0LnB1c2goewogICAgICAgIHg6IC0zLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAyLAogICAgICAgIHk6IC0yCiAgICAgIH0sIHsKICAgICAgICB4OiAtMiwKICAgICAgICB5OiAtMgogICAgICB9KTsKICAgIH0KICB9CiAgY29uc3QgZ3JheVNjYWxlQml0UGxhbmVzID0gW107CiAgbGV0IG1tcklucHV0LCBiaXRtYXA7CiAgaWYgKG1tcikgewogICAgbW1ySW5wdXQgPSBuZXcgUmVhZGVyKGRlY29kaW5nQ29udGV4dC5kYXRhLCBkZWNvZGluZ0NvbnRleHQuc3RhcnQsIGRlY29kaW5nQ29udGV4dC5lbmQpOwogIH0KICBmb3IgKGkgPSBiaXRzUGVyVmFsdWUgLSAxOyBpID49IDA7IGktLSkgewogICAgaWYgKG1tcikgewogICAgICBiaXRtYXAgPSBkZWNvZGVNTVJCaXRtYXAobW1ySW5wdXQsIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCwgdHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICBiaXRtYXAgPSBkZWNvZGVCaXRtYXAoZmFsc2UsIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCwgdGVtcGxhdGUsIGZhbHNlLCBza2lwLCBhdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgIH0KICAgIGdyYXlTY2FsZUJpdFBsYW5lc1tpXSA9IGJpdG1hcDsKICB9CiAgbGV0IG1nLCBuZywgYml0LCBwYXR0ZXJuSW5kZXgsIHBhdHRlcm5CaXRtYXAsIHgsIHksIHBhdHRlcm5Sb3csIHJlZ2lvblJvdzsKICBmb3IgKG1nID0gMDsgbWcgPCBncmlkSGVpZ2h0OyBtZysrKSB7CiAgICBmb3IgKG5nID0gMDsgbmcgPCBncmlkV2lkdGg7IG5nKyspIHsKICAgICAgYml0ID0gMDsKICAgICAgcGF0dGVybkluZGV4ID0gMDsKICAgICAgZm9yIChqID0gYml0c1BlclZhbHVlIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICBiaXQgXj0gZ3JheVNjYWxlQml0UGxhbmVzW2pdW21nXVtuZ107CiAgICAgICAgcGF0dGVybkluZGV4IHw9IGJpdCA8PCBqOwogICAgICB9CiAgICAgIHBhdHRlcm5CaXRtYXAgPSBwYXR0ZXJuc1twYXR0ZXJuSW5kZXhdOwogICAgICB4ID0gZ3JpZE9mZnNldFggKyBtZyAqIGdyaWRWZWN0b3JZICsgbmcgKiBncmlkVmVjdG9yWCA+PiA4OwogICAgICB5ID0gZ3JpZE9mZnNldFkgKyBtZyAqIGdyaWRWZWN0b3JYIC0gbmcgKiBncmlkVmVjdG9yWSA+PiA4OwogICAgICBpZiAoeCA+PSAwICYmIHggKyBwYXR0ZXJuV2lkdGggPD0gcmVnaW9uV2lkdGggJiYgeSA+PSAwICYmIHkgKyBwYXR0ZXJuSGVpZ2h0IDw9IHJlZ2lvbkhlaWdodCkgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJuSGVpZ2h0OyBpKyspIHsKICAgICAgICAgIHJlZ2lvblJvdyA9IHJlZ2lvbkJpdG1hcFt5ICsgaV07CiAgICAgICAgICBwYXR0ZXJuUm93ID0gcGF0dGVybkJpdG1hcFtpXTsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBwYXR0ZXJuV2lkdGg7IGorKykgewogICAgICAgICAgICByZWdpb25Sb3dbeCArIGpdIHw9IHBhdHRlcm5Sb3dbal07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGxldCByZWdpb25YLCByZWdpb25ZOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJuSGVpZ2h0OyBpKyspIHsKICAgICAgICAgIHJlZ2lvblkgPSB5ICsgaTsKICAgICAgICAgIGlmIChyZWdpb25ZIDwgMCB8fCByZWdpb25ZID49IHJlZ2lvbkhlaWdodCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJlZ2lvblJvdyA9IHJlZ2lvbkJpdG1hcFtyZWdpb25ZXTsKICAgICAgICAgIHBhdHRlcm5Sb3cgPSBwYXR0ZXJuQml0bWFwW2ldOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHBhdHRlcm5XaWR0aDsgaisrKSB7CiAgICAgICAgICAgIHJlZ2lvblggPSB4ICsgajsKICAgICAgICAgICAgaWYgKHJlZ2lvblggPj0gMCAmJiByZWdpb25YIDwgcmVnaW9uV2lkdGgpIHsKICAgICAgICAgICAgICByZWdpb25Sb3dbcmVnaW9uWF0gfD0gcGF0dGVyblJvd1tqXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICByZXR1cm4gcmVnaW9uQml0bWFwOwp9CmZ1bmN0aW9uIHJlYWRTZWdtZW50SGVhZGVyKGRhdGEsIHN0YXJ0KSB7CiAgY29uc3Qgc2VnbWVudEhlYWRlciA9IHt9OwogIHNlZ21lbnRIZWFkZXIubnVtYmVyID0gcmVhZFVpbnQzMihkYXRhLCBzdGFydCk7CiAgY29uc3QgZmxhZ3MgPSBkYXRhW3N0YXJ0ICsgNF07CiAgY29uc3Qgc2VnbWVudFR5cGUgPSBmbGFncyAmIDB4M2Y7CiAgaWYgKCFTZWdtZW50VHlwZXNbc2VnbWVudFR5cGVdKSB7CiAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBzZWdtZW50IHR5cGU6ICIgKyBzZWdtZW50VHlwZSk7CiAgfQogIHNlZ21lbnRIZWFkZXIudHlwZSA9IHNlZ21lbnRUeXBlOwogIHNlZ21lbnRIZWFkZXIudHlwZU5hbWUgPSBTZWdtZW50VHlwZXNbc2VnbWVudFR5cGVdOwogIHNlZ21lbnRIZWFkZXIuZGVmZXJyZWROb25SZXRhaW4gPSAhIShmbGFncyAmIDB4ODApOwogIGNvbnN0IHBhZ2VBc3NvY2lhdGlvbkZpZWxkU2l6ZSA9ICEhKGZsYWdzICYgMHg0MCk7CiAgY29uc3QgcmVmZXJyZWRGbGFncyA9IGRhdGFbc3RhcnQgKyA1XTsKICBsZXQgcmVmZXJyZWRUb0NvdW50ID0gcmVmZXJyZWRGbGFncyA+PiA1ICYgNzsKICBjb25zdCByZXRhaW5CaXRzID0gW3JlZmVycmVkRmxhZ3MgJiAzMV07CiAgbGV0IHBvc2l0aW9uID0gc3RhcnQgKyA2OwogIGlmIChyZWZlcnJlZFRvQ291bnQgPT09IDcpIHsKICAgIHJlZmVycmVkVG9Db3VudCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24gLSAxKSAmIDB4MWZmZmZmZmY7CiAgICBwb3NpdGlvbiArPSAzOwogICAgbGV0IGJ5dGVzID0gcmVmZXJyZWRUb0NvdW50ICsgOCA+PiAzOwogICAgcmV0YWluQml0c1swXSA9IGRhdGFbcG9zaXRpb24rK107CiAgICB3aGlsZSAoLS1ieXRlcyA+IDApIHsKICAgICAgcmV0YWluQml0cy5wdXNoKGRhdGFbcG9zaXRpb24rK10pOwogICAgfQogIH0gZWxzZSBpZiAocmVmZXJyZWRUb0NvdW50ID09PSA1IHx8IHJlZmVycmVkVG9Db3VudCA9PT0gNikgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgcmVmZXJyZWQtdG8gZmxhZ3MiKTsKICB9CiAgc2VnbWVudEhlYWRlci5yZXRhaW5CaXRzID0gcmV0YWluQml0czsKICBsZXQgcmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplID0gNDsKICBpZiAoc2VnbWVudEhlYWRlci5udW1iZXIgPD0gMjU2KSB7CiAgICByZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemUgPSAxOwogIH0gZWxzZSBpZiAoc2VnbWVudEhlYWRlci5udW1iZXIgPD0gNjU1MzYpIHsKICAgIHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9IDI7CiAgfQogIGNvbnN0IHJlZmVycmVkVG8gPSBbXTsKICBsZXQgaSwgaWk7CiAgZm9yIChpID0gMDsgaSA8IHJlZmVycmVkVG9Db3VudDsgaSsrKSB7CiAgICBsZXQgbnVtYmVyOwogICAgaWYgKHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9PT0gMSkgewogICAgICBudW1iZXIgPSBkYXRhW3Bvc2l0aW9uXTsKICAgIH0gZWxzZSBpZiAocmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplID09PSAyKSB7CiAgICAgIG51bWJlciA9IHJlYWRVaW50MTYoZGF0YSwgcG9zaXRpb24pOwogICAgfSBlbHNlIHsKICAgICAgbnVtYmVyID0gcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbik7CiAgICB9CiAgICByZWZlcnJlZFRvLnB1c2gobnVtYmVyKTsKICAgIHBvc2l0aW9uICs9IHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZTsKICB9CiAgc2VnbWVudEhlYWRlci5yZWZlcnJlZFRvID0gcmVmZXJyZWRUbzsKICBpZiAoIXBhZ2VBc3NvY2lhdGlvbkZpZWxkU2l6ZSkgewogICAgc2VnbWVudEhlYWRlci5wYWdlQXNzb2NpYXRpb24gPSBkYXRhW3Bvc2l0aW9uKytdOwogIH0gZWxzZSB7CiAgICBzZWdtZW50SGVhZGVyLnBhZ2VBc3NvY2lhdGlvbiA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgcG9zaXRpb24gKz0gNDsKICB9CiAgc2VnbWVudEhlYWRlci5sZW5ndGggPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICBwb3NpdGlvbiArPSA0OwogIGlmIChzZWdtZW50SGVhZGVyLmxlbmd0aCA9PT0gMHhmZmZmZmZmZikgewogICAgaWYgKHNlZ21lbnRUeXBlID09PSAzOCkgewogICAgICBjb25zdCBnZW5lcmljUmVnaW9uSW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBjb25zdCBnZW5lcmljUmVnaW9uU2VnbWVudEZsYWdzID0gZGF0YVtwb3NpdGlvbiArIFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbkZpZWxkTGVuZ3RoXTsKICAgICAgY29uc3QgZ2VuZXJpY1JlZ2lvbk1tciA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgY29uc3Qgc2VhcmNoUGF0dGVybkxlbmd0aCA9IDY7CiAgICAgIGNvbnN0IHNlYXJjaFBhdHRlcm4gPSBuZXcgVWludDhBcnJheShzZWFyY2hQYXR0ZXJuTGVuZ3RoKTsKICAgICAgaWYgKCFnZW5lcmljUmVnaW9uTW1yKSB7CiAgICAgICAgc2VhcmNoUGF0dGVyblswXSA9IDB4ZmY7CiAgICAgICAgc2VhcmNoUGF0dGVyblsxXSA9IDB4YWM7CiAgICAgIH0KICAgICAgc2VhcmNoUGF0dGVyblsyXSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCA+Pj4gMjQgJiAweGZmOwogICAgICBzZWFyY2hQYXR0ZXJuWzNdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ID4+IDE2ICYgMHhmZjsKICAgICAgc2VhcmNoUGF0dGVybls0XSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCA+PiA4ICYgMHhmZjsKICAgICAgc2VhcmNoUGF0dGVybls1XSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCAmIDB4ZmY7CiAgICAgIGZvciAoaSA9IHBvc2l0aW9uLCBpaSA9IGRhdGEubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGxldCBqID0gMDsKICAgICAgICB3aGlsZSAoaiA8IHNlYXJjaFBhdHRlcm5MZW5ndGggJiYgc2VhcmNoUGF0dGVybltqXSA9PT0gZGF0YVtpICsgal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgaWYgKGogPT09IHNlYXJjaFBhdHRlcm5MZW5ndGgpIHsKICAgICAgICAgIHNlZ21lbnRIZWFkZXIubGVuZ3RoID0gaSArIHNlYXJjaFBhdHRlcm5MZW5ndGg7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHNlZ21lbnRIZWFkZXIubGVuZ3RoID09PSAweGZmZmZmZmZmKSB7CiAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInNlZ21lbnQgZW5kIHdhcyBub3QgZm91bmQiKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgdW5rbm93biBzZWdtZW50IGxlbmd0aCIpOwogICAgfQogIH0KICBzZWdtZW50SGVhZGVyLmhlYWRlckVuZCA9IHBvc2l0aW9uOwogIHJldHVybiBzZWdtZW50SGVhZGVyOwp9CmZ1bmN0aW9uIHJlYWRTZWdtZW50cyhoZWFkZXIsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICBjb25zdCBzZWdtZW50cyA9IFtdOwogIGxldCBwb3NpdGlvbiA9IHN0YXJ0OwogIHdoaWxlIChwb3NpdGlvbiA8IGVuZCkgewogICAgY29uc3Qgc2VnbWVudEhlYWRlciA9IHJlYWRTZWdtZW50SGVhZGVyKGRhdGEsIHBvc2l0aW9uKTsKICAgIHBvc2l0aW9uID0gc2VnbWVudEhlYWRlci5oZWFkZXJFbmQ7CiAgICBjb25zdCBzZWdtZW50ID0gewogICAgICBoZWFkZXI6IHNlZ21lbnRIZWFkZXIsCiAgICAgIGRhdGEKICAgIH07CiAgICBpZiAoIWhlYWRlci5yYW5kb21BY2Nlc3MpIHsKICAgICAgc2VnbWVudC5zdGFydCA9IHBvc2l0aW9uOwogICAgICBwb3NpdGlvbiArPSBzZWdtZW50SGVhZGVyLmxlbmd0aDsKICAgICAgc2VnbWVudC5lbmQgPSBwb3NpdGlvbjsKICAgIH0KICAgIHNlZ21lbnRzLnB1c2goc2VnbWVudCk7CiAgICBpZiAoc2VnbWVudEhlYWRlci50eXBlID09PSA1MSkgewogICAgICBicmVhazsKICAgIH0KICB9CiAgaWYgKGhlYWRlci5yYW5kb21BY2Nlc3MpIHsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHNlZ21lbnRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgc2VnbWVudHNbaV0uc3RhcnQgPSBwb3NpdGlvbjsKICAgICAgcG9zaXRpb24gKz0gc2VnbWVudHNbaV0uaGVhZGVyLmxlbmd0aDsKICAgICAgc2VnbWVudHNbaV0uZW5kID0gcG9zaXRpb247CiAgICB9CiAgfQogIHJldHVybiBzZWdtZW50czsKfQpmdW5jdGlvbiByZWFkUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uKGRhdGEsIHN0YXJ0KSB7CiAgcmV0dXJuIHsKICAgIHdpZHRoOiByZWFkVWludDMyKGRhdGEsIHN0YXJ0KSwKICAgIGhlaWdodDogcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDQpLAogICAgeDogcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDgpLAogICAgeTogcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDEyKSwKICAgIGNvbWJpbmF0aW9uT3BlcmF0b3I6IGRhdGFbc3RhcnQgKyAxNl0gJiA3CiAgfTsKfQpjb25zdCBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aCA9IDE3OwpmdW5jdGlvbiBwcm9jZXNzU2VnbWVudChzZWdtZW50LCB2aXNpdG9yKSB7CiAgY29uc3QgaGVhZGVyID0gc2VnbWVudC5oZWFkZXI7CiAgY29uc3QgZGF0YSA9IHNlZ21lbnQuZGF0YSwKICAgIGVuZCA9IHNlZ21lbnQuZW5kOwogIGxldCBwb3NpdGlvbiA9IHNlZ21lbnQuc3RhcnQ7CiAgbGV0IGFyZ3MsIGF0LCBpLCBhdExlbmd0aDsKICBzd2l0Y2ggKGhlYWRlci50eXBlKSB7CiAgICBjYXNlIDA6CiAgICAgIGNvbnN0IGRpY3Rpb25hcnkgPSB7fTsKICAgICAgY29uc3QgZGljdGlvbmFyeUZsYWdzID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICAgIGRpY3Rpb25hcnkuaHVmZm1hbiA9ICEhKGRpY3Rpb25hcnlGbGFncyAmIDEpOwogICAgICBkaWN0aW9uYXJ5LnJlZmluZW1lbnQgPSAhIShkaWN0aW9uYXJ5RmxhZ3MgJiAyKTsKICAgICAgZGljdGlvbmFyeS5odWZmbWFuREhTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiAyICYgMzsKICAgICAgZGljdGlvbmFyeS5odWZmbWFuRFdTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiA0ICYgMzsKICAgICAgZGljdGlvbmFyeS5iaXRtYXBTaXplU2VsZWN0b3IgPSBkaWN0aW9uYXJ5RmxhZ3MgPj4gNiAmIDE7CiAgICAgIGRpY3Rpb25hcnkuYWdncmVnYXRpb25JbnN0YW5jZXNTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiA3ICYgMTsKICAgICAgZGljdGlvbmFyeS5iaXRtYXBDb2RpbmdDb250ZXh0VXNlZCA9ICEhKGRpY3Rpb25hcnlGbGFncyAmIDI1Nik7CiAgICAgIGRpY3Rpb25hcnkuYml0bWFwQ29kaW5nQ29udGV4dFJldGFpbmVkID0gISEoZGljdGlvbmFyeUZsYWdzICYgNTEyKTsKICAgICAgZGljdGlvbmFyeS50ZW1wbGF0ZSA9IGRpY3Rpb25hcnlGbGFncyA+PiAxMCAmIDM7CiAgICAgIGRpY3Rpb25hcnkucmVmaW5lbWVudFRlbXBsYXRlID0gZGljdGlvbmFyeUZsYWdzID4+IDEyICYgMTsKICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgaWYgKCFkaWN0aW9uYXJ5Lmh1ZmZtYW4pIHsKICAgICAgICBhdExlbmd0aCA9IGRpY3Rpb25hcnkudGVtcGxhdGUgPT09IDAgPyA0IDogMTsKICAgICAgICBhdCA9IFtdOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhdExlbmd0aDsgaSsrKSB7CiAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgeDogcmVhZEludDgoZGF0YSwgcG9zaXRpb24pLAogICAgICAgICAgICB5OiByZWFkSW50OChkYXRhLCBwb3NpdGlvbiArIDEpCiAgICAgICAgICB9KTsKICAgICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgfQogICAgICAgIGRpY3Rpb25hcnkuYXQgPSBhdDsKICAgICAgfQogICAgICBpZiAoZGljdGlvbmFyeS5yZWZpbmVtZW50ICYmICFkaWN0aW9uYXJ5LnJlZmluZW1lbnRUZW1wbGF0ZSkgewogICAgICAgIGF0ID0gW107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgICAgYXQucHVzaCh7CiAgICAgICAgICAgIHg6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uKSwKICAgICAgICAgICAgeTogcmVhZEludDgoZGF0YSwgcG9zaXRpb24gKyAxKQogICAgICAgICAgfSk7CiAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgIH0KICAgICAgICBkaWN0aW9uYXJ5LnJlZmluZW1lbnRBdCA9IGF0OwogICAgICB9CiAgICAgIGRpY3Rpb25hcnkubnVtYmVyT2ZFeHBvcnRlZFN5bWJvbHMgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgZGljdGlvbmFyeS5udW1iZXJPZk5ld1N5bWJvbHMgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgYXJncyA9IFtkaWN0aW9uYXJ5LCBoZWFkZXIubnVtYmVyLCBoZWFkZXIucmVmZXJyZWRUbywgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgIGJyZWFrOwogICAgY2FzZSA2OgogICAgY2FzZSA3OgogICAgICBjb25zdCB0ZXh0UmVnaW9uID0ge307CiAgICAgIHRleHRSZWdpb24uaW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aDsKICAgICAgY29uc3QgdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA9IHJlYWRVaW50MTYoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSAyOwogICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW4gPSAhISh0ZXh0UmVnaW9uU2VnbWVudEZsYWdzICYgMSk7CiAgICAgIHRleHRSZWdpb24ucmVmaW5lbWVudCA9ICEhKHRleHRSZWdpb25TZWdtZW50RmxhZ3MgJiAyKTsKICAgICAgdGV4dFJlZ2lvbi5sb2dTdHJpcFNpemUgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID4+IDIgJiAzOwogICAgICB0ZXh0UmVnaW9uLnN0cmlwU2l6ZSA9IDEgPDwgdGV4dFJlZ2lvbi5sb2dTdHJpcFNpemU7CiAgICAgIHRleHRSZWdpb24ucmVmZXJlbmNlQ29ybmVyID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiA0ICYgMzsKICAgICAgdGV4dFJlZ2lvbi50cmFuc3Bvc2VkID0gISEodGV4dFJlZ2lvblNlZ21lbnRGbGFncyAmIDY0KTsKICAgICAgdGV4dFJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiA3ICYgMzsKICAgICAgdGV4dFJlZ2lvbi5kZWZhdWx0UGl4ZWxWYWx1ZSA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPj4gOSAmIDE7CiAgICAgIHRleHRSZWdpb24uZHNPZmZzZXQgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzIDw8IDE3ID4+IDI3OwogICAgICB0ZXh0UmVnaW9uLnJlZmluZW1lbnRUZW1wbGF0ZSA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPj4gMTUgJiAxOwogICAgICBpZiAodGV4dFJlZ2lvbi5odWZmbWFuKSB7CiAgICAgICAgY29uc3QgdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA9IHJlYWRVaW50MTYoZGF0YSwgcG9zaXRpb24pOwogICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuRlMgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5EUyA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gMiAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuRFQgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDQgJiAzOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hblJlZmluZW1lbnREVyA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gNiAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuUmVmaW5lbWVudERIID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA+PiA4ICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50RFggPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDEwICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50RFkgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDEyICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50U2l6ZVNlbGVjdG9yID0gISEodGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyAmIDB4NDAwMCk7CiAgICAgIH0KICAgICAgaWYgKHRleHRSZWdpb24ucmVmaW5lbWVudCAmJiAhdGV4dFJlZ2lvbi5yZWZpbmVtZW50VGVtcGxhdGUpIHsKICAgICAgICBhdCA9IFtdOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICB4OiByZWFkSW50OChkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgICAgIHk6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uICsgMSkKICAgICAgICAgIH0pOwogICAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICB9CiAgICAgICAgdGV4dFJlZ2lvbi5yZWZpbmVtZW50QXQgPSBhdDsKICAgICAgfQogICAgICB0ZXh0UmVnaW9uLm51bWJlck9mU3ltYm9sSW5zdGFuY2VzID0gcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgIGFyZ3MgPSBbdGV4dFJlZ2lvbiwgaGVhZGVyLnJlZmVycmVkVG8sIGRhdGEsIHBvc2l0aW9uLCBlbmRdOwogICAgICBicmVhazsKICAgIGNhc2UgMTY6CiAgICAgIGNvbnN0IHBhdHRlcm5EaWN0aW9uYXJ5ID0ge307CiAgICAgIGNvbnN0IHBhdHRlcm5EaWN0aW9uYXJ5RmxhZ3MgPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICBwYXR0ZXJuRGljdGlvbmFyeS5tbXIgPSAhIShwYXR0ZXJuRGljdGlvbmFyeUZsYWdzICYgMSk7CiAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5LnRlbXBsYXRlID0gcGF0dGVybkRpY3Rpb25hcnlGbGFncyA+PiAxICYgMzsKICAgICAgcGF0dGVybkRpY3Rpb25hcnkucGF0dGVybldpZHRoID0gZGF0YVtwb3NpdGlvbisrXTsKICAgICAgcGF0dGVybkRpY3Rpb25hcnkucGF0dGVybkhlaWdodCA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5Lm1heFBhdHRlcm5JbmRleCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBhcmdzID0gW3BhdHRlcm5EaWN0aW9uYXJ5LCBoZWFkZXIubnVtYmVyLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDIyOgogICAgY2FzZSAyMzoKICAgICAgY29uc3QgaGFsZnRvbmVSZWdpb24gPSB7fTsKICAgICAgaGFsZnRvbmVSZWdpb24uaW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aDsKICAgICAgY29uc3QgaGFsZnRvbmVSZWdpb25GbGFncyA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgIGhhbGZ0b25lUmVnaW9uLm1tciA9ICEhKGhhbGZ0b25lUmVnaW9uRmxhZ3MgJiAxKTsKICAgICAgaGFsZnRvbmVSZWdpb24udGVtcGxhdGUgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDEgJiAzOwogICAgICBoYWxmdG9uZVJlZ2lvbi5lbmFibGVTa2lwID0gISEoaGFsZnRvbmVSZWdpb25GbGFncyAmIDgpOwogICAgICBoYWxmdG9uZVJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yID0gaGFsZnRvbmVSZWdpb25GbGFncyA+PiA0ICYgNzsKICAgICAgaGFsZnRvbmVSZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDcgJiAxOwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkV2lkdGggPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZEhlaWdodCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkT2Zmc2V0WCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pICYgMHhmZmZmZmZmZjsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZE9mZnNldFkgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKSAmIDB4ZmZmZmZmZmY7CiAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgIGhhbGZ0b25lUmVnaW9uLmdyaWRWZWN0b3JYID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgIGhhbGZ0b25lUmVnaW9uLmdyaWRWZWN0b3JZID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgIGFyZ3MgPSBbaGFsZnRvbmVSZWdpb24sIGhlYWRlci5yZWZlcnJlZFRvLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM4OgogICAgY2FzZSAzOToKICAgICAgY29uc3QgZ2VuZXJpY1JlZ2lvbiA9IHt9OwogICAgICBnZW5lcmljUmVnaW9uLmluZm8gPSByZWFkUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uRmllbGRMZW5ndGg7CiAgICAgIGNvbnN0IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICBnZW5lcmljUmVnaW9uLm1tciA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgZ2VuZXJpY1JlZ2lvbi50ZW1wbGF0ZSA9IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPj4gMSAmIDM7CiAgICAgIGdlbmVyaWNSZWdpb24ucHJlZGljdGlvbiA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiA4KTsKICAgICAgaWYgKCFnZW5lcmljUmVnaW9uLm1tcikgewogICAgICAgIGF0TGVuZ3RoID0gZ2VuZXJpY1JlZ2lvbi50ZW1wbGF0ZSA9PT0gMCA/IDQgOiAxOwogICAgICAgIGF0ID0gW107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGF0TGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICB4OiByZWFkSW50OChkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgICAgIHk6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uICsgMSkKICAgICAgICAgIH0pOwogICAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICB9CiAgICAgICAgZ2VuZXJpY1JlZ2lvbi5hdCA9IGF0OwogICAgICB9CiAgICAgIGFyZ3MgPSBbZ2VuZXJpY1JlZ2lvbiwgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgIGJyZWFrOwogICAgY2FzZSA0ODoKICAgICAgY29uc3QgcGFnZUluZm8gPSB7CiAgICAgICAgd2lkdGg6IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pLAogICAgICAgIGhlaWdodDogcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbiArIDQpLAogICAgICAgIHJlc29sdXRpb25YOiByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uICsgOCksCiAgICAgICAgcmVzb2x1dGlvblk6IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24gKyAxMikKICAgICAgfTsKICAgICAgaWYgKHBhZ2VJbmZvLmhlaWdodCA9PT0gMHhmZmZmZmZmZikgewogICAgICAgIGRlbGV0ZSBwYWdlSW5mby5oZWlnaHQ7CiAgICAgIH0KICAgICAgY29uc3QgcGFnZVNlZ21lbnRGbGFncyA9IGRhdGFbcG9zaXRpb24gKyAxNl07CiAgICAgIHJlYWRVaW50MTYoZGF0YSwgcG9zaXRpb24gKyAxNyk7CiAgICAgIHBhZ2VJbmZvLmxvc3NsZXNzID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDEpOwogICAgICBwYWdlSW5mby5yZWZpbmVtZW50ID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDIpOwogICAgICBwYWdlSW5mby5kZWZhdWx0UGl4ZWxWYWx1ZSA9IHBhZ2VTZWdtZW50RmxhZ3MgPj4gMiAmIDE7CiAgICAgIHBhZ2VJbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3IgPSBwYWdlU2VnbWVudEZsYWdzID4+IDMgJiAzOwogICAgICBwYWdlSW5mby5yZXF1aXJlc0J1ZmZlciA9ICEhKHBhZ2VTZWdtZW50RmxhZ3MgJiAzMik7CiAgICAgIHBhZ2VJbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3JPdmVycmlkZSA9ICEhKHBhZ2VTZWdtZW50RmxhZ3MgJiA2NCk7CiAgICAgIGFyZ3MgPSBbcGFnZUluZm9dOwogICAgICBicmVhazsKICAgIGNhc2UgNDk6CiAgICAgIGJyZWFrOwogICAgY2FzZSA1MDoKICAgICAgYnJlYWs7CiAgICBjYXNlIDUxOgogICAgICBicmVhazsKICAgIGNhc2UgNTM6CiAgICAgIGFyZ3MgPSBbaGVhZGVyLm51bWJlciwgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgIGJyZWFrOwogICAgY2FzZSA2MjoKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgc2VnbWVudCB0eXBlICR7aGVhZGVyLnR5cGVOYW1lfSgke2hlYWRlci50eXBlfSkgaXMgbm90IGltcGxlbWVudGVkYCk7CiAgfQogIGNvbnN0IGNhbGxiYWNrTmFtZSA9ICJvbiIgKyBoZWFkZXIudHlwZU5hbWU7CiAgaWYgKGNhbGxiYWNrTmFtZSBpbiB2aXNpdG9yKSB7CiAgICB2aXNpdG9yW2NhbGxiYWNrTmFtZV0uYXBwbHkodmlzaXRvciwgYXJncyk7CiAgfQp9CmZ1bmN0aW9uIHByb2Nlc3NTZWdtZW50cyhzZWdtZW50cywgdmlzaXRvcikgewogIGZvciAobGV0IGkgPSAwLCBpaSA9IHNlZ21lbnRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIHByb2Nlc3NTZWdtZW50KHNlZ21lbnRzW2ldLCB2aXNpdG9yKTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VKYmlnMkNodW5rcyhjaHVua3MpIHsKICBjb25zdCB2aXNpdG9yID0gbmV3IFNpbXBsZVNlZ21lbnRWaXNpdG9yKCk7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gY2h1bmtzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IGNodW5rID0gY2h1bmtzW2ldOwogICAgY29uc3Qgc2VnbWVudHMgPSByZWFkU2VnbWVudHMoe30sIGNodW5rLmRhdGEsIGNodW5rLnN0YXJ0LCBjaHVuay5lbmQpOwogICAgcHJvY2Vzc1NlZ21lbnRzKHNlZ21lbnRzLCB2aXNpdG9yKTsKICB9CiAgcmV0dXJuIHZpc2l0b3IuYnVmZmVyOwp9CmNsYXNzIFNpbXBsZVNlZ21lbnRWaXNpdG9yIHsKICBvblBhZ2VJbmZvcm1hdGlvbihpbmZvKSB7CiAgICB0aGlzLmN1cnJlbnRQYWdlSW5mbyA9IGluZm87CiAgICBjb25zdCByb3dTaXplID0gaW5mby53aWR0aCArIDcgPj4gMzsKICAgIGNvbnN0IGJ1ZmZlciA9IG5ldyBVaW50OENsYW1wZWRBcnJheShyb3dTaXplICogaW5mby5oZWlnaHQpOwogICAgaWYgKGluZm8uZGVmYXVsdFBpeGVsVmFsdWUpIHsKICAgICAgYnVmZmVyLmZpbGwoMHhmZik7CiAgICB9CiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKICB9CiAgZHJhd0JpdG1hcChyZWdpb25JbmZvLCBiaXRtYXApIHsKICAgIGNvbnN0IHBhZ2VJbmZvID0gdGhpcy5jdXJyZW50UGFnZUluZm87CiAgICBjb25zdCB3aWR0aCA9IHJlZ2lvbkluZm8ud2lkdGgsCiAgICAgIGhlaWdodCA9IHJlZ2lvbkluZm8uaGVpZ2h0OwogICAgY29uc3Qgcm93U2l6ZSA9IHBhZ2VJbmZvLndpZHRoICsgNyA+PiAzOwogICAgY29uc3QgY29tYmluYXRpb25PcGVyYXRvciA9IHBhZ2VJbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3JPdmVycmlkZSA/IHJlZ2lvbkluZm8uY29tYmluYXRpb25PcGVyYXRvciA6IHBhZ2VJbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3I7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmJ1ZmZlcjsKICAgIGNvbnN0IG1hc2swID0gMTI4ID4+IChyZWdpb25JbmZvLnggJiA3KTsKICAgIGxldCBvZmZzZXQwID0gcmVnaW9uSW5mby55ICogcm93U2l6ZSArIChyZWdpb25JbmZvLnggPj4gMyk7CiAgICBsZXQgaSwgaiwgbWFzaywgb2Zmc2V0OwogICAgc3dpdGNoIChjb21iaW5hdGlvbk9wZXJhdG9yKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgIG1hc2sgPSBtYXNrMDsKICAgICAgICAgIG9mZnNldCA9IG9mZnNldDA7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICAgICAgICBpZiAoYml0bWFwW2ldW2pdKSB7CiAgICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gfD0gbWFzazsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYXNrID4+PSAxOwogICAgICAgICAgICBpZiAoIW1hc2spIHsKICAgICAgICAgICAgICBtYXNrID0gMTI4OwogICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBvZmZzZXQwICs9IHJvd1NpemU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgICBtYXNrID0gbWFzazA7CiAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQwOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgICAgaWYgKGJpdG1hcFtpXVtqXSkgewogICAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXRdIF49IG1hc2s7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFzayA+Pj0gMTsKICAgICAgICAgICAgaWYgKCFtYXNrKSB7CiAgICAgICAgICAgICAgbWFzayA9IDEyODsKICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgb2Zmc2V0MCArPSByb3dTaXplOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgb3BlcmF0b3IgJHtjb21iaW5hdGlvbk9wZXJhdG9yfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICB9CiAgfQogIG9uSW1tZWRpYXRlR2VuZXJpY1JlZ2lvbihyZWdpb24sIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIGNvbnN0IHJlZ2lvbkluZm8gPSByZWdpb24uaW5mbzsKICAgIGNvbnN0IGRlY29kaW5nQ29udGV4dCA9IG5ldyBEZWNvZGluZ0NvbnRleHQoZGF0YSwgc3RhcnQsIGVuZCk7CiAgICBjb25zdCBiaXRtYXAgPSBkZWNvZGVCaXRtYXAocmVnaW9uLm1tciwgcmVnaW9uSW5mby53aWR0aCwgcmVnaW9uSW5mby5oZWlnaHQsIHJlZ2lvbi50ZW1wbGF0ZSwgcmVnaW9uLnByZWRpY3Rpb24sIG51bGwsIHJlZ2lvbi5hdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgIHRoaXMuZHJhd0JpdG1hcChyZWdpb25JbmZvLCBiaXRtYXApOwogIH0KICBvbkltbWVkaWF0ZUxvc3NsZXNzR2VuZXJpY1JlZ2lvbigpIHsKICAgIHRoaXMub25JbW1lZGlhdGVHZW5lcmljUmVnaW9uKC4uLmFyZ3VtZW50cyk7CiAgfQogIG9uU3ltYm9sRGljdGlvbmFyeShkaWN0aW9uYXJ5LCBjdXJyZW50U2VnbWVudCwgcmVmZXJyZWRTZWdtZW50cywgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgbGV0IGh1ZmZtYW5UYWJsZXMsIGh1ZmZtYW5JbnB1dDsKICAgIGlmIChkaWN0aW9uYXJ5Lmh1ZmZtYW4pIHsKICAgICAgaHVmZm1hblRhYmxlcyA9IGdldFN5bWJvbERpY3Rpb25hcnlIdWZmbWFuVGFibGVzKGRpY3Rpb25hcnksIHJlZmVycmVkU2VnbWVudHMsIHRoaXMuY3VzdG9tVGFibGVzKTsKICAgICAgaHVmZm1hbklucHV0ID0gbmV3IFJlYWRlcihkYXRhLCBzdGFydCwgZW5kKTsKICAgIH0KICAgIGxldCBzeW1ib2xzID0gdGhpcy5zeW1ib2xzOwogICAgaWYgKCFzeW1ib2xzKSB7CiAgICAgIHRoaXMuc3ltYm9scyA9IHN5bWJvbHMgPSB7fTsKICAgIH0KICAgIGNvbnN0IGlucHV0U3ltYm9scyA9IFtdOwogICAgZm9yIChjb25zdCByZWZlcnJlZFNlZ21lbnQgb2YgcmVmZXJyZWRTZWdtZW50cykgewogICAgICBjb25zdCByZWZlcnJlZFN5bWJvbHMgPSBzeW1ib2xzW3JlZmVycmVkU2VnbWVudF07CiAgICAgIGlmIChyZWZlcnJlZFN5bWJvbHMpIHsKICAgICAgICBpbnB1dFN5bWJvbHMucHVzaCguLi5yZWZlcnJlZFN5bWJvbHMpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgc3ltYm9sc1tjdXJyZW50U2VnbWVudF0gPSBkZWNvZGVTeW1ib2xEaWN0aW9uYXJ5KGRpY3Rpb25hcnkuaHVmZm1hbiwgZGljdGlvbmFyeS5yZWZpbmVtZW50LCBpbnB1dFN5bWJvbHMsIGRpY3Rpb25hcnkubnVtYmVyT2ZOZXdTeW1ib2xzLCBkaWN0aW9uYXJ5Lm51bWJlck9mRXhwb3J0ZWRTeW1ib2xzLCBodWZmbWFuVGFibGVzLCBkaWN0aW9uYXJ5LnRlbXBsYXRlLCBkaWN0aW9uYXJ5LmF0LCBkaWN0aW9uYXJ5LnJlZmluZW1lbnRUZW1wbGF0ZSwgZGljdGlvbmFyeS5yZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgaHVmZm1hbklucHV0KTsKICB9CiAgb25JbW1lZGlhdGVUZXh0UmVnaW9uKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgY29uc3QgcmVnaW9uSW5mbyA9IHJlZ2lvbi5pbmZvOwogICAgbGV0IGh1ZmZtYW5UYWJsZXMsIGh1ZmZtYW5JbnB1dDsKICAgIGNvbnN0IHN5bWJvbHMgPSB0aGlzLnN5bWJvbHM7CiAgICBjb25zdCBpbnB1dFN5bWJvbHMgPSBbXTsKICAgIGZvciAoY29uc3QgcmVmZXJyZWRTZWdtZW50IG9mIHJlZmVycmVkU2VnbWVudHMpIHsKICAgICAgY29uc3QgcmVmZXJyZWRTeW1ib2xzID0gc3ltYm9sc1tyZWZlcnJlZFNlZ21lbnRdOwogICAgICBpZiAocmVmZXJyZWRTeW1ib2xzKSB7CiAgICAgICAgaW5wdXRTeW1ib2xzLnB1c2goLi4ucmVmZXJyZWRTeW1ib2xzKTsKICAgICAgfQogICAgfQogICAgY29uc3Qgc3ltYm9sQ29kZUxlbmd0aCA9IGxvZzIoaW5wdXRTeW1ib2xzLmxlbmd0aCk7CiAgICBpZiAocmVnaW9uLmh1ZmZtYW4pIHsKICAgICAgaHVmZm1hbklucHV0ID0gbmV3IFJlYWRlcihkYXRhLCBzdGFydCwgZW5kKTsKICAgICAgaHVmZm1hblRhYmxlcyA9IGdldFRleHRSZWdpb25IdWZmbWFuVGFibGVzKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgdGhpcy5jdXN0b21UYWJsZXMsIGlucHV0U3ltYm9scy5sZW5ndGgsIGh1ZmZtYW5JbnB1dCk7CiAgICB9CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgY29uc3QgYml0bWFwID0gZGVjb2RlVGV4dFJlZ2lvbihyZWdpb24uaHVmZm1hbiwgcmVnaW9uLnJlZmluZW1lbnQsIHJlZ2lvbkluZm8ud2lkdGgsIHJlZ2lvbkluZm8uaGVpZ2h0LCByZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUsIHJlZ2lvbi5udW1iZXJPZlN5bWJvbEluc3RhbmNlcywgcmVnaW9uLnN0cmlwU2l6ZSwgaW5wdXRTeW1ib2xzLCBzeW1ib2xDb2RlTGVuZ3RoLCByZWdpb24udHJhbnNwb3NlZCwgcmVnaW9uLmRzT2Zmc2V0LCByZWdpb24ucmVmZXJlbmNlQ29ybmVyLCByZWdpb24uY29tYmluYXRpb25PcGVyYXRvciwgaHVmZm1hblRhYmxlcywgcmVnaW9uLnJlZmluZW1lbnRUZW1wbGF0ZSwgcmVnaW9uLnJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0LCByZWdpb24ubG9nU3RyaXBTaXplLCBodWZmbWFuSW5wdXQpOwogICAgdGhpcy5kcmF3Qml0bWFwKHJlZ2lvbkluZm8sIGJpdG1hcCk7CiAgfQogIG9uSW1tZWRpYXRlTG9zc2xlc3NUZXh0UmVnaW9uKCkgewogICAgdGhpcy5vbkltbWVkaWF0ZVRleHRSZWdpb24oLi4uYXJndW1lbnRzKTsKICB9CiAgb25QYXR0ZXJuRGljdGlvbmFyeShkaWN0aW9uYXJ5LCBjdXJyZW50U2VnbWVudCwgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgbGV0IHBhdHRlcm5zID0gdGhpcy5wYXR0ZXJuczsKICAgIGlmICghcGF0dGVybnMpIHsKICAgICAgdGhpcy5wYXR0ZXJucyA9IHBhdHRlcm5zID0ge307CiAgICB9CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgcGF0dGVybnNbY3VycmVudFNlZ21lbnRdID0gZGVjb2RlUGF0dGVybkRpY3Rpb25hcnkoZGljdGlvbmFyeS5tbXIsIGRpY3Rpb25hcnkucGF0dGVybldpZHRoLCBkaWN0aW9uYXJ5LnBhdHRlcm5IZWlnaHQsIGRpY3Rpb25hcnkubWF4UGF0dGVybkluZGV4LCBkaWN0aW9uYXJ5LnRlbXBsYXRlLCBkZWNvZGluZ0NvbnRleHQpOwogIH0KICBvbkltbWVkaWF0ZUhhbGZ0b25lUmVnaW9uKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgY29uc3QgcGF0dGVybnMgPSB0aGlzLnBhdHRlcm5zW3JlZmVycmVkU2VnbWVudHNbMF1dOwogICAgY29uc3QgcmVnaW9uSW5mbyA9IHJlZ2lvbi5pbmZvOwogICAgY29uc3QgZGVjb2RpbmdDb250ZXh0ID0gbmV3IERlY29kaW5nQ29udGV4dChkYXRhLCBzdGFydCwgZW5kKTsKICAgIGNvbnN0IGJpdG1hcCA9IGRlY29kZUhhbGZ0b25lUmVnaW9uKHJlZ2lvbi5tbXIsIHBhdHRlcm5zLCByZWdpb24udGVtcGxhdGUsIHJlZ2lvbkluZm8ud2lkdGgsIHJlZ2lvbkluZm8uaGVpZ2h0LCByZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUsIHJlZ2lvbi5lbmFibGVTa2lwLCByZWdpb24uY29tYmluYXRpb25PcGVyYXRvciwgcmVnaW9uLmdyaWRXaWR0aCwgcmVnaW9uLmdyaWRIZWlnaHQsIHJlZ2lvbi5ncmlkT2Zmc2V0WCwgcmVnaW9uLmdyaWRPZmZzZXRZLCByZWdpb24uZ3JpZFZlY3RvclgsIHJlZ2lvbi5ncmlkVmVjdG9yWSwgZGVjb2RpbmdDb250ZXh0KTsKICAgIHRoaXMuZHJhd0JpdG1hcChyZWdpb25JbmZvLCBiaXRtYXApOwogIH0KICBvbkltbWVkaWF0ZUxvc3NsZXNzSGFsZnRvbmVSZWdpb24oKSB7CiAgICB0aGlzLm9uSW1tZWRpYXRlSGFsZnRvbmVSZWdpb24oLi4uYXJndW1lbnRzKTsKICB9CiAgb25UYWJsZXMoY3VycmVudFNlZ21lbnQsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIGxldCBjdXN0b21UYWJsZXMgPSB0aGlzLmN1c3RvbVRhYmxlczsKICAgIGlmICghY3VzdG9tVGFibGVzKSB7CiAgICAgIHRoaXMuY3VzdG9tVGFibGVzID0gY3VzdG9tVGFibGVzID0ge307CiAgICB9CiAgICBjdXN0b21UYWJsZXNbY3VycmVudFNlZ21lbnRdID0gZGVjb2RlVGFibGVzU2VnbWVudChkYXRhLCBzdGFydCwgZW5kKTsKICB9Cn0KY2xhc3MgSHVmZm1hbkxpbmUgewogIGNvbnN0cnVjdG9yKGxpbmVEYXRhKSB7CiAgICBpZiAobGluZURhdGEubGVuZ3RoID09PSAyKSB7CiAgICAgIHRoaXMuaXNPT0IgPSB0cnVlOwogICAgICB0aGlzLnJhbmdlTG93ID0gMDsKICAgICAgdGhpcy5wcmVmaXhMZW5ndGggPSBsaW5lRGF0YVswXTsKICAgICAgdGhpcy5yYW5nZUxlbmd0aCA9IDA7CiAgICAgIHRoaXMucHJlZml4Q29kZSA9IGxpbmVEYXRhWzFdOwogICAgICB0aGlzLmlzTG93ZXJSYW5nZSA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5pc09PQiA9IGZhbHNlOwogICAgICB0aGlzLnJhbmdlTG93ID0gbGluZURhdGFbMF07CiAgICAgIHRoaXMucHJlZml4TGVuZ3RoID0gbGluZURhdGFbMV07CiAgICAgIHRoaXMucmFuZ2VMZW5ndGggPSBsaW5lRGF0YVsyXTsKICAgICAgdGhpcy5wcmVmaXhDb2RlID0gbGluZURhdGFbM107CiAgICAgIHRoaXMuaXNMb3dlclJhbmdlID0gbGluZURhdGFbNF0gPT09ICJsb3dlciI7CiAgICB9CiAgfQp9CmNsYXNzIEh1ZmZtYW5UcmVlTm9kZSB7CiAgY29uc3RydWN0b3IobGluZSkgewogICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgaWYgKGxpbmUpIHsKICAgICAgdGhpcy5pc0xlYWYgPSB0cnVlOwogICAgICB0aGlzLnJhbmdlTGVuZ3RoID0gbGluZS5yYW5nZUxlbmd0aDsKICAgICAgdGhpcy5yYW5nZUxvdyA9IGxpbmUucmFuZ2VMb3c7CiAgICAgIHRoaXMuaXNMb3dlclJhbmdlID0gbGluZS5pc0xvd2VyUmFuZ2U7CiAgICAgIHRoaXMuaXNPT0IgPSBsaW5lLmlzT09COwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5pc0xlYWYgPSBmYWxzZTsKICAgIH0KICB9CiAgYnVpbGRUcmVlKGxpbmUsIHNoaWZ0KSB7CiAgICBjb25zdCBiaXQgPSBsaW5lLnByZWZpeENvZGUgPj4gc2hpZnQgJiAxOwogICAgaWYgKHNoaWZ0IDw9IDApIHsKICAgICAgdGhpcy5jaGlsZHJlbltiaXRdID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShsaW5lKTsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBub2RlID0gdGhpcy5jaGlsZHJlbltiaXRdOwogICAgICBpZiAoIW5vZGUpIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2JpdF0gPSBub2RlID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShudWxsKTsKICAgICAgfQogICAgICBub2RlLmJ1aWxkVHJlZShsaW5lLCBzaGlmdCAtIDEpOwogICAgfQogIH0KICBkZWNvZGVOb2RlKHJlYWRlcikgewogICAgaWYgKHRoaXMuaXNMZWFmKSB7CiAgICAgIGlmICh0aGlzLmlzT09CKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgaHRPZmZzZXQgPSByZWFkZXIucmVhZEJpdHModGhpcy5yYW5nZUxlbmd0aCk7CiAgICAgIHJldHVybiB0aGlzLnJhbmdlTG93ICsgKHRoaXMuaXNMb3dlclJhbmdlID8gLWh0T2Zmc2V0IDogaHRPZmZzZXQpOwogICAgfQogICAgY29uc3Qgbm9kZSA9IHRoaXMuY2hpbGRyZW5bcmVhZGVyLnJlYWRCaXQoKV07CiAgICBpZiAoIW5vZGUpIHsKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBkYXRhIik7CiAgICB9CiAgICByZXR1cm4gbm9kZS5kZWNvZGVOb2RlKHJlYWRlcik7CiAgfQp9CmNsYXNzIEh1ZmZtYW5UYWJsZSB7CiAgY29uc3RydWN0b3IobGluZXMsIHByZWZpeENvZGVzRG9uZSkgewogICAgaWYgKCFwcmVmaXhDb2Rlc0RvbmUpIHsKICAgICAgdGhpcy5hc3NpZ25QcmVmaXhDb2RlcyhsaW5lcyk7CiAgICB9CiAgICB0aGlzLnJvb3ROb2RlID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShudWxsKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGxpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldOwogICAgICBpZiAobGluZS5wcmVmaXhMZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5yb290Tm9kZS5idWlsZFRyZWUobGluZSwgbGluZS5wcmVmaXhMZW5ndGggLSAxKTsKICAgICAgfQogICAgfQogIH0KICBkZWNvZGUocmVhZGVyKSB7CiAgICByZXR1cm4gdGhpcy5yb290Tm9kZS5kZWNvZGVOb2RlKHJlYWRlcik7CiAgfQogIGFzc2lnblByZWZpeENvZGVzKGxpbmVzKSB7CiAgICBjb25zdCBsaW5lc0xlbmd0aCA9IGxpbmVzLmxlbmd0aDsKICAgIGxldCBwcmVmaXhMZW5ndGhNYXggPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lc0xlbmd0aDsgaSsrKSB7CiAgICAgIHByZWZpeExlbmd0aE1heCA9IE1hdGgubWF4KHByZWZpeExlbmd0aE1heCwgbGluZXNbaV0ucHJlZml4TGVuZ3RoKTsKICAgIH0KICAgIGNvbnN0IGhpc3RvZ3JhbSA9IG5ldyBVaW50MzJBcnJheShwcmVmaXhMZW5ndGhNYXggKyAxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXNMZW5ndGg7IGkrKykgewogICAgICBoaXN0b2dyYW1bbGluZXNbaV0ucHJlZml4TGVuZ3RoXSsrOwogICAgfQogICAgbGV0IGN1cnJlbnRMZW5ndGggPSAxLAogICAgICBmaXJzdENvZGUgPSAwLAogICAgICBjdXJyZW50Q29kZSwKICAgICAgY3VycmVudFRlbXAsCiAgICAgIGxpbmU7CiAgICBoaXN0b2dyYW1bMF0gPSAwOwogICAgd2hpbGUgKGN1cnJlbnRMZW5ndGggPD0gcHJlZml4TGVuZ3RoTWF4KSB7CiAgICAgIGZpcnN0Q29kZSA9IGZpcnN0Q29kZSArIGhpc3RvZ3JhbVtjdXJyZW50TGVuZ3RoIC0gMV0gPDwgMTsKICAgICAgY3VycmVudENvZGUgPSBmaXJzdENvZGU7CiAgICAgIGN1cnJlbnRUZW1wID0gMDsKICAgICAgd2hpbGUgKGN1cnJlbnRUZW1wIDwgbGluZXNMZW5ndGgpIHsKICAgICAgICBsaW5lID0gbGluZXNbY3VycmVudFRlbXBdOwogICAgICAgIGlmIChsaW5lLnByZWZpeExlbmd0aCA9PT0gY3VycmVudExlbmd0aCkgewogICAgICAgICAgbGluZS5wcmVmaXhDb2RlID0gY3VycmVudENvZGU7CiAgICAgICAgICBjdXJyZW50Q29kZSsrOwogICAgICAgIH0KICAgICAgICBjdXJyZW50VGVtcCsrOwogICAgICB9CiAgICAgIGN1cnJlbnRMZW5ndGgrKzsKICAgIH0KICB9Cn0KZnVuY3Rpb24gZGVjb2RlVGFibGVzU2VnbWVudChkYXRhLCBzdGFydCwgZW5kKSB7CiAgY29uc3QgZmxhZ3MgPSBkYXRhW3N0YXJ0XTsKICBjb25zdCBsb3dlc3RWYWx1ZSA9IHJlYWRVaW50MzIoZGF0YSwgc3RhcnQgKyAxKSAmIDB4ZmZmZmZmZmY7CiAgY29uc3QgaGlnaGVzdFZhbHVlID0gcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDUpICYgMHhmZmZmZmZmZjsKICBjb25zdCByZWFkZXIgPSBuZXcgUmVhZGVyKGRhdGEsIHN0YXJ0ICsgOSwgZW5kKTsKICBjb25zdCBwcmVmaXhTaXplQml0cyA9IChmbGFncyA+PiAxICYgNykgKyAxOwogIGNvbnN0IHJhbmdlU2l6ZUJpdHMgPSAoZmxhZ3MgPj4gNCAmIDcpICsgMTsKICBjb25zdCBsaW5lcyA9IFtdOwogIGxldCBwcmVmaXhMZW5ndGgsCiAgICByYW5nZUxlbmd0aCwKICAgIGN1cnJlbnRSYW5nZUxvdyA9IGxvd2VzdFZhbHVlOwogIGRvIHsKICAgIHByZWZpeExlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhwcmVmaXhTaXplQml0cyk7CiAgICByYW5nZUxlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhyYW5nZVNpemVCaXRzKTsKICAgIGxpbmVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtjdXJyZW50UmFuZ2VMb3csIHByZWZpeExlbmd0aCwgcmFuZ2VMZW5ndGgsIDBdKSk7CiAgICBjdXJyZW50UmFuZ2VMb3cgKz0gMSA8PCByYW5nZUxlbmd0aDsKICB9IHdoaWxlIChjdXJyZW50UmFuZ2VMb3cgPCBoaWdoZXN0VmFsdWUpOwogIHByZWZpeExlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhwcmVmaXhTaXplQml0cyk7CiAgbGluZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2xvd2VzdFZhbHVlIC0gMSwgcHJlZml4TGVuZ3RoLCAzMiwgMCwgImxvd2VyIl0pKTsKICBwcmVmaXhMZW5ndGggPSByZWFkZXIucmVhZEJpdHMocHJlZml4U2l6ZUJpdHMpOwogIGxpbmVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtoaWdoZXN0VmFsdWUsIHByZWZpeExlbmd0aCwgMzIsIDBdKSk7CiAgaWYgKGZsYWdzICYgMSkgewogICAgcHJlZml4TGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKHByZWZpeFNpemVCaXRzKTsKICAgIGxpbmVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtwcmVmaXhMZW5ndGgsIDBdKSk7CiAgfQogIHJldHVybiBuZXcgSHVmZm1hblRhYmxlKGxpbmVzLCBmYWxzZSk7Cn0KY29uc3Qgc3RhbmRhcmRUYWJsZXNDYWNoZSA9IHt9OwpmdW5jdGlvbiBnZXRTdGFuZGFyZFRhYmxlKG51bWJlcikgewogIGxldCB0YWJsZSA9IHN0YW5kYXJkVGFibGVzQ2FjaGVbbnVtYmVyXTsKICBpZiAodGFibGUpIHsKICAgIHJldHVybiB0YWJsZTsKICB9CiAgbGV0IGxpbmVzOwogIHN3aXRjaCAobnVtYmVyKSB7CiAgICBjYXNlIDE6CiAgICAgIGxpbmVzID0gW1swLCAxLCA0LCAweDBdLCBbMTYsIDIsIDgsIDB4Ml0sIFsyNzIsIDMsIDE2LCAweDZdLCBbNjU4MDgsIDMsIDMyLCAweDddXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDI6CiAgICAgIGxpbmVzID0gW1swLCAxLCAwLCAweDBdLCBbMSwgMiwgMCwgMHgyXSwgWzIsIDMsIDAsIDB4Nl0sIFszLCA0LCAzLCAweGVdLCBbMTEsIDUsIDYsIDB4MWVdLCBbNzUsIDYsIDMyLCAweDNlXSwgWzYsIDB4M2ZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgIGxpbmVzID0gW1stMjU2LCA4LCA4LCAweGZlXSwgWzAsIDEsIDAsIDB4MF0sIFsxLCAyLCAwLCAweDJdLCBbMiwgMywgMCwgMHg2XSwgWzMsIDQsIDMsIDB4ZV0sIFsxMSwgNSwgNiwgMHgxZV0sIFstMjU3LCA4LCAzMiwgMHhmZiwgImxvd2VyIl0sIFs3NSwgNywgMzIsIDB4N2VdLCBbNiwgMHgzZV1dOwogICAgICBicmVhazsKICAgIGNhc2UgNDoKICAgICAgbGluZXMgPSBbWzEsIDEsIDAsIDB4MF0sIFsyLCAyLCAwLCAweDJdLCBbMywgMywgMCwgMHg2XSwgWzQsIDQsIDMsIDB4ZV0sIFsxMiwgNSwgNiwgMHgxZV0sIFs3NiwgNSwgMzIsIDB4MWZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDU6CiAgICAgIGxpbmVzID0gW1stMjU1LCA3LCA4LCAweDdlXSwgWzEsIDEsIDAsIDB4MF0sIFsyLCAyLCAwLCAweDJdLCBbMywgMywgMCwgMHg2XSwgWzQsIDQsIDMsIDB4ZV0sIFsxMiwgNSwgNiwgMHgxZV0sIFstMjU2LCA3LCAzMiwgMHg3ZiwgImxvd2VyIl0sIFs3NiwgNiwgMzIsIDB4M2VdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDY6CiAgICAgIGxpbmVzID0gW1stMjA0OCwgNSwgMTAsIDB4MWNdLCBbLTEwMjQsIDQsIDksIDB4OF0sIFstNTEyLCA0LCA4LCAweDldLCBbLTI1NiwgNCwgNywgMHhhXSwgWy0xMjgsIDUsIDYsIDB4MWRdLCBbLTY0LCA1LCA1LCAweDFlXSwgWy0zMiwgNCwgNSwgMHhiXSwgWzAsIDIsIDcsIDB4MF0sIFsxMjgsIDMsIDcsIDB4Ml0sIFsyNTYsIDMsIDgsIDB4M10sIFs1MTIsIDQsIDksIDB4Y10sIFsxMDI0LCA0LCAxMCwgMHhkXSwgWy0yMDQ5LCA2LCAzMiwgMHgzZSwgImxvd2VyIl0sIFsyMDQ4LCA2LCAzMiwgMHgzZl1dOwogICAgICBicmVhazsKICAgIGNhc2UgNzoKICAgICAgbGluZXMgPSBbWy0xMDI0LCA0LCA5LCAweDhdLCBbLTUxMiwgMywgOCwgMHgwXSwgWy0yNTYsIDQsIDcsIDB4OV0sIFstMTI4LCA1LCA2LCAweDFhXSwgWy02NCwgNSwgNSwgMHgxYl0sIFstMzIsIDQsIDUsIDB4YV0sIFswLCA0LCA1LCAweGJdLCBbMzIsIDUsIDUsIDB4MWNdLCBbNjQsIDUsIDYsIDB4MWRdLCBbMTI4LCA0LCA3LCAweGNdLCBbMjU2LCAzLCA4LCAweDFdLCBbNTEyLCAzLCA5LCAweDJdLCBbMTAyNCwgMywgMTAsIDB4M10sIFstMTAyNSwgNSwgMzIsIDB4MWUsICJsb3dlciJdLCBbMjA0OCwgNSwgMzIsIDB4MWZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDg6CiAgICAgIGxpbmVzID0gW1stMTUsIDgsIDMsIDB4ZmNdLCBbLTcsIDksIDEsIDB4MWZjXSwgWy01LCA4LCAxLCAweGZkXSwgWy0zLCA5LCAwLCAweDFmZF0sIFstMiwgNywgMCwgMHg3Y10sIFstMSwgNCwgMCwgMHhhXSwgWzAsIDIsIDEsIDB4MF0sIFsyLCA1LCAwLCAweDFhXSwgWzMsIDYsIDAsIDB4M2FdLCBbNCwgMywgNCwgMHg0XSwgWzIwLCA2LCAxLCAweDNiXSwgWzIyLCA0LCA0LCAweGJdLCBbMzgsIDQsIDUsIDB4Y10sIFs3MCwgNSwgNiwgMHgxYl0sIFsxMzQsIDUsIDcsIDB4MWNdLCBbMjYyLCA2LCA3LCAweDNjXSwgWzM5MCwgNywgOCwgMHg3ZF0sIFs2NDYsIDYsIDEwLCAweDNkXSwgWy0xNiwgOSwgMzIsIDB4MWZlLCAibG93ZXIiXSwgWzE2NzAsIDksIDMyLCAweDFmZl0sIFsyLCAweDFdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDk6CiAgICAgIGxpbmVzID0gW1stMzEsIDgsIDQsIDB4ZmNdLCBbLTE1LCA5LCAyLCAweDFmY10sIFstMTEsIDgsIDIsIDB4ZmRdLCBbLTcsIDksIDEsIDB4MWZkXSwgWy01LCA3LCAxLCAweDdjXSwgWy0zLCA0LCAxLCAweGFdLCBbLTEsIDMsIDEsIDB4Ml0sIFsxLCAzLCAxLCAweDNdLCBbMywgNSwgMSwgMHgxYV0sIFs1LCA2LCAxLCAweDNhXSwgWzcsIDMsIDUsIDB4NF0sIFszOSwgNiwgMiwgMHgzYl0sIFs0MywgNCwgNSwgMHhiXSwgWzc1LCA0LCA2LCAweGNdLCBbMTM5LCA1LCA3LCAweDFiXSwgWzI2NywgNSwgOCwgMHgxY10sIFs1MjMsIDYsIDgsIDB4M2NdLCBbNzc5LCA3LCA5LCAweDdkXSwgWzEyOTEsIDYsIDExLCAweDNkXSwgWy0zMiwgOSwgMzIsIDB4MWZlLCAibG93ZXIiXSwgWzMzMzksIDksIDMyLCAweDFmZl0sIFsyLCAweDBdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDEwOgogICAgICBsaW5lcyA9IFtbLTIxLCA3LCA0LCAweDdhXSwgWy01LCA4LCAwLCAweGZjXSwgWy00LCA3LCAwLCAweDdiXSwgWy0zLCA1LCAwLCAweDE4XSwgWy0yLCAyLCAyLCAweDBdLCBbMiwgNSwgMCwgMHgxOV0sIFszLCA2LCAwLCAweDM2XSwgWzQsIDcsIDAsIDB4N2NdLCBbNSwgOCwgMCwgMHhmZF0sIFs2LCAyLCA2LCAweDFdLCBbNzAsIDUsIDUsIDB4MWFdLCBbMTAyLCA2LCA1LCAweDM3XSwgWzEzNCwgNiwgNiwgMHgzOF0sIFsxOTgsIDYsIDcsIDB4MzldLCBbMzI2LCA2LCA4LCAweDNhXSwgWzU4MiwgNiwgOSwgMHgzYl0sIFsxMDk0LCA2LCAxMCwgMHgzY10sIFsyMTE4LCA3LCAxMSwgMHg3ZF0sIFstMjIsIDgsIDMyLCAweGZlLCAibG93ZXIiXSwgWzQxNjYsIDgsIDMyLCAweGZmXSwgWzIsIDB4Ml1dOwogICAgICBicmVhazsKICAgIGNhc2UgMTE6CiAgICAgIGxpbmVzID0gW1sxLCAxLCAwLCAweDBdLCBbMiwgMiwgMSwgMHgyXSwgWzQsIDQsIDAsIDB4Y10sIFs1LCA0LCAxLCAweGRdLCBbNywgNSwgMSwgMHgxY10sIFs5LCA1LCAyLCAweDFkXSwgWzEzLCA2LCAyLCAweDNjXSwgWzE3LCA3LCAyLCAweDdhXSwgWzIxLCA3LCAzLCAweDdiXSwgWzI5LCA3LCA0LCAweDdjXSwgWzQ1LCA3LCA1LCAweDdkXSwgWzc3LCA3LCA2LCAweDdlXSwgWzE0MSwgNywgMzIsIDB4N2ZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDEyOgogICAgICBsaW5lcyA9IFtbMSwgMSwgMCwgMHgwXSwgWzIsIDIsIDAsIDB4Ml0sIFszLCAzLCAxLCAweDZdLCBbNSwgNSwgMCwgMHgxY10sIFs2LCA1LCAxLCAweDFkXSwgWzgsIDYsIDEsIDB4M2NdLCBbMTAsIDcsIDAsIDB4N2FdLCBbMTEsIDcsIDEsIDB4N2JdLCBbMTMsIDcsIDIsIDB4N2NdLCBbMTcsIDcsIDMsIDB4N2RdLCBbMjUsIDcsIDQsIDB4N2VdLCBbNDEsIDgsIDUsIDB4ZmVdLCBbNzMsIDgsIDMyLCAweGZmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxMzoKICAgICAgbGluZXMgPSBbWzEsIDEsIDAsIDB4MF0sIFsyLCAzLCAwLCAweDRdLCBbMywgNCwgMCwgMHhjXSwgWzQsIDUsIDAsIDB4MWNdLCBbNSwgNCwgMSwgMHhkXSwgWzcsIDMsIDMsIDB4NV0sIFsxNSwgNiwgMSwgMHgzYV0sIFsxNywgNiwgMiwgMHgzYl0sIFsyMSwgNiwgMywgMHgzY10sIFsyOSwgNiwgNCwgMHgzZF0sIFs0NSwgNiwgNSwgMHgzZV0sIFs3NywgNywgNiwgMHg3ZV0sIFsxNDEsIDcsIDMyLCAweDdmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxNDoKICAgICAgbGluZXMgPSBbWy0yLCAzLCAwLCAweDRdLCBbLTEsIDMsIDAsIDB4NV0sIFswLCAxLCAwLCAweDBdLCBbMSwgMywgMCwgMHg2XSwgWzIsIDMsIDAsIDB4N11dOwogICAgICBicmVhazsKICAgIGNhc2UgMTU6CiAgICAgIGxpbmVzID0gW1stMjQsIDcsIDQsIDB4N2NdLCBbLTgsIDYsIDIsIDB4M2NdLCBbLTQsIDUsIDEsIDB4MWNdLCBbLTIsIDQsIDAsIDB4Y10sIFstMSwgMywgMCwgMHg0XSwgWzAsIDEsIDAsIDB4MF0sIFsxLCAzLCAwLCAweDVdLCBbMiwgNCwgMCwgMHhkXSwgWzMsIDUsIDEsIDB4MWRdLCBbNSwgNiwgMiwgMHgzZF0sIFs5LCA3LCA0LCAweDdkXSwgWy0yNSwgNywgMzIsIDB4N2UsICJsb3dlciJdLCBbMjUsIDcsIDMyLCAweDdmXV07CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoYHN0YW5kYXJkIHRhYmxlIEIuJHtudW1iZXJ9IGRvZXMgbm90IGV4aXN0YCk7CiAgfQogIGZvciAobGV0IGkgPSAwLCBpaSA9IGxpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGxpbmVzW2ldID0gbmV3IEh1ZmZtYW5MaW5lKGxpbmVzW2ldKTsKICB9CiAgdGFibGUgPSBuZXcgSHVmZm1hblRhYmxlKGxpbmVzLCB0cnVlKTsKICBzdGFuZGFyZFRhYmxlc0NhY2hlW251bWJlcl0gPSB0YWJsZTsKICByZXR1cm4gdGFibGU7Cn0KY2xhc3MgUmVhZGVyIHsKICBjb25zdHJ1Y3RvcihkYXRhLCBzdGFydCwgZW5kKSB7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5zdGFydCA9IHN0YXJ0OwogICAgdGhpcy5lbmQgPSBlbmQ7CiAgICB0aGlzLnBvc2l0aW9uID0gc3RhcnQ7CiAgICB0aGlzLnNoaWZ0ID0gLTE7CiAgICB0aGlzLmN1cnJlbnRCeXRlID0gMDsKICB9CiAgcmVhZEJpdCgpIHsKICAgIGlmICh0aGlzLnNoaWZ0IDwgMCkgewogICAgICBpZiAodGhpcy5wb3NpdGlvbiA+PSB0aGlzLmVuZCkgewogICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJlbmQgb2YgZGF0YSB3aGlsZSByZWFkaW5nIGJpdCIpOwogICAgICB9CiAgICAgIHRoaXMuY3VycmVudEJ5dGUgPSB0aGlzLmRhdGFbdGhpcy5wb3NpdGlvbisrXTsKICAgICAgdGhpcy5zaGlmdCA9IDc7CiAgICB9CiAgICBjb25zdCBiaXQgPSB0aGlzLmN1cnJlbnRCeXRlID4+IHRoaXMuc2hpZnQgJiAxOwogICAgdGhpcy5zaGlmdC0tOwogICAgcmV0dXJuIGJpdDsKICB9CiAgcmVhZEJpdHMobnVtQml0cykgewogICAgbGV0IHJlc3VsdCA9IDAsCiAgICAgIGk7CiAgICBmb3IgKGkgPSBudW1CaXRzIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgcmVzdWx0IHw9IHRoaXMucmVhZEJpdCgpIDw8IGk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBieXRlQWxpZ24oKSB7CiAgICB0aGlzLnNoaWZ0ID0gLTE7CiAgfQogIG5leHQoKSB7CiAgICBpZiAodGhpcy5wb3NpdGlvbiA+PSB0aGlzLmVuZCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICByZXR1cm4gdGhpcy5kYXRhW3RoaXMucG9zaXRpb24rK107CiAgfQp9CmZ1bmN0aW9uIGdldEN1c3RvbUh1ZmZtYW5UYWJsZShpbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKSB7CiAgbGV0IGN1cnJlbnRJbmRleCA9IDA7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gcmVmZXJyZWRUby5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCB0YWJsZSA9IGN1c3RvbVRhYmxlc1tyZWZlcnJlZFRvW2ldXTsKICAgIGlmICh0YWJsZSkgewogICAgICBpZiAoaW5kZXggPT09IGN1cnJlbnRJbmRleCkgewogICAgICAgIHJldHVybiB0YWJsZTsKICAgICAgfQogICAgICBjdXJyZW50SW5kZXgrKzsKICAgIH0KICB9CiAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImNhbid0IGZpbmQgY3VzdG9tIEh1ZmZtYW4gdGFibGUiKTsKfQpmdW5jdGlvbiBnZXRUZXh0UmVnaW9uSHVmZm1hblRhYmxlcyh0ZXh0UmVnaW9uLCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMsIG51bWJlck9mU3ltYm9scywgcmVhZGVyKSB7CiAgY29uc3QgY29kZXMgPSBbXTsKICBmb3IgKGxldCBpID0gMDsgaSA8PSAzNDsgaSsrKSB7CiAgICBjb25zdCBjb2RlTGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKDQpOwogICAgY29kZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2ksIGNvZGVMZW5ndGgsIDAsIDBdKSk7CiAgfQogIGNvbnN0IHJ1bkNvZGVzVGFibGUgPSBuZXcgSHVmZm1hblRhYmxlKGNvZGVzLCBmYWxzZSk7CiAgY29kZXMubGVuZ3RoID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mU3ltYm9sczspIHsKICAgIGNvbnN0IGNvZGVMZW5ndGggPSBydW5Db2Rlc1RhYmxlLmRlY29kZShyZWFkZXIpOwogICAgaWYgKGNvZGVMZW5ndGggPj0gMzIpIHsKICAgICAgbGV0IHJlcGVhdGVkTGVuZ3RoLCBudW1iZXJPZlJlcGVhdHMsIGo7CiAgICAgIHN3aXRjaCAoY29kZUxlbmd0aCkgewogICAgICAgIGNhc2UgMzI6CiAgICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigibm8gcHJldmlvdXMgdmFsdWUgaW4gc3ltYm9sIElEIHRhYmxlIik7CiAgICAgICAgICB9CiAgICAgICAgICBudW1iZXJPZlJlcGVhdHMgPSByZWFkZXIucmVhZEJpdHMoMikgKyAzOwogICAgICAgICAgcmVwZWF0ZWRMZW5ndGggPSBjb2Rlc1tpIC0gMV0ucHJlZml4TGVuZ3RoOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzMzoKICAgICAgICAgIG51bWJlck9mUmVwZWF0cyA9IHJlYWRlci5yZWFkQml0cygzKSArIDM7CiAgICAgICAgICByZXBlYXRlZExlbmd0aCA9IDA7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM0OgogICAgICAgICAgbnVtYmVyT2ZSZXBlYXRzID0gcmVhZGVyLnJlYWRCaXRzKDcpICsgMTE7CiAgICAgICAgICByZXBlYXRlZExlbmd0aCA9IDA7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgY29kZSBsZW5ndGggaW4gc3ltYm9sIElEIHRhYmxlIik7CiAgICAgIH0KICAgICAgZm9yIChqID0gMDsgaiA8IG51bWJlck9mUmVwZWF0czsgaisrKSB7CiAgICAgICAgY29kZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2ksIHJlcGVhdGVkTGVuZ3RoLCAwLCAwXSkpOwogICAgICAgIGkrKzsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29kZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2ksIGNvZGVMZW5ndGgsIDAsIDBdKSk7CiAgICAgIGkrKzsKICAgIH0KICB9CiAgcmVhZGVyLmJ5dGVBbGlnbigpOwogIGNvbnN0IHN5bWJvbElEVGFibGUgPSBuZXcgSHVmZm1hblRhYmxlKGNvZGVzLCBmYWxzZSk7CiAgbGV0IGN1c3RvbUluZGV4ID0gMCwKICAgIHRhYmxlRmlyc3RTLAogICAgdGFibGVEZWx0YVMsCiAgICB0YWJsZURlbHRhVDsKICBzd2l0Y2ggKHRleHRSZWdpb24uaHVmZm1hbkZTKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICAgIHRhYmxlRmlyc3RTID0gZ2V0U3RhbmRhcmRUYWJsZSh0ZXh0UmVnaW9uLmh1ZmZtYW5GUyArIDYpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGFibGVGaXJzdFMgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBGUyBzZWxlY3RvciIpOwogIH0KICBzd2l0Y2ggKHRleHRSZWdpb24uaHVmZm1hbkRTKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICBjYXNlIDI6CiAgICAgIHRhYmxlRGVsdGFTID0gZ2V0U3RhbmRhcmRUYWJsZSh0ZXh0UmVnaW9uLmh1ZmZtYW5EUyArIDgpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGFibGVEZWx0YVMgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBEUyBzZWxlY3RvciIpOwogIH0KICBzd2l0Y2ggKHRleHRSZWdpb24uaHVmZm1hbkRUKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICBjYXNlIDI6CiAgICAgIHRhYmxlRGVsdGFUID0gZ2V0U3RhbmRhcmRUYWJsZSh0ZXh0UmVnaW9uLmh1ZmZtYW5EVCArIDExKTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgIHRhYmxlRGVsdGFUID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgICBjdXN0b21JbmRleCsrOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gRFQgc2VsZWN0b3IiKTsKICB9CiAgaWYgKHRleHRSZWdpb24ucmVmaW5lbWVudCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInJlZmluZW1lbnQgd2l0aCBIdWZmbWFuIGlzIG5vdCBzdXBwb3J0ZWQiKTsKICB9CiAgcmV0dXJuIHsKICAgIHN5bWJvbElEVGFibGUsCiAgICB0YWJsZUZpcnN0UywKICAgIHRhYmxlRGVsdGFTLAogICAgdGFibGVEZWx0YVQKICB9Owp9CmZ1bmN0aW9uIGdldFN5bWJvbERpY3Rpb25hcnlIdWZmbWFuVGFibGVzKGRpY3Rpb25hcnksIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcykgewogIGxldCBjdXN0b21JbmRleCA9IDAsCiAgICB0YWJsZURlbHRhSGVpZ2h0LAogICAgdGFibGVEZWx0YVdpZHRoOwogIHN3aXRjaCAoZGljdGlvbmFyeS5odWZmbWFuREhTZWxlY3RvcikgewogICAgY2FzZSAwOgogICAgY2FzZSAxOgogICAgICB0YWJsZURlbHRhSGVpZ2h0ID0gZ2V0U3RhbmRhcmRUYWJsZShkaWN0aW9uYXJ5Lmh1ZmZtYW5ESFNlbGVjdG9yICsgNCk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAzOgogICAgICB0YWJsZURlbHRhSGVpZ2h0ID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgICBjdXN0b21JbmRleCsrOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gREggc2VsZWN0b3IiKTsKICB9CiAgc3dpdGNoIChkaWN0aW9uYXJ5Lmh1ZmZtYW5EV1NlbGVjdG9yKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICAgIHRhYmxlRGVsdGFXaWR0aCA9IGdldFN0YW5kYXJkVGFibGUoZGljdGlvbmFyeS5odWZmbWFuRFdTZWxlY3RvciArIDIpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGFibGVEZWx0YVdpZHRoID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgICBjdXN0b21JbmRleCsrOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gRFcgc2VsZWN0b3IiKTsKICB9CiAgbGV0IHRhYmxlQml0bWFwU2l6ZSwgdGFibGVBZ2dyZWdhdGVJbnN0YW5jZXM7CiAgaWYgKGRpY3Rpb25hcnkuYml0bWFwU2l6ZVNlbGVjdG9yKSB7CiAgICB0YWJsZUJpdG1hcFNpemUgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICBjdXN0b21JbmRleCsrOwogIH0gZWxzZSB7CiAgICB0YWJsZUJpdG1hcFNpemUgPSBnZXRTdGFuZGFyZFRhYmxlKDEpOwogIH0KICBpZiAoZGljdGlvbmFyeS5hZ2dyZWdhdGlvbkluc3RhbmNlc1NlbGVjdG9yKSB7CiAgICB0YWJsZUFnZ3JlZ2F0ZUluc3RhbmNlcyA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICB9IGVsc2UgewogICAgdGFibGVBZ2dyZWdhdGVJbnN0YW5jZXMgPSBnZXRTdGFuZGFyZFRhYmxlKDEpOwogIH0KICByZXR1cm4gewogICAgdGFibGVEZWx0YUhlaWdodCwKICAgIHRhYmxlRGVsdGFXaWR0aCwKICAgIHRhYmxlQml0bWFwU2l6ZSwKICAgIHRhYmxlQWdncmVnYXRlSW5zdGFuY2VzCiAgfTsKfQpmdW5jdGlvbiByZWFkVW5jb21wcmVzc2VkQml0bWFwKHJlYWRlciwgd2lkdGgsIGhlaWdodCkgewogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKICAgIGNvbnN0IHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgcm93W3hdID0gcmVhZGVyLnJlYWRCaXQoKTsKICAgIH0KICAgIHJlYWRlci5ieXRlQWxpZ24oKTsKICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVNTVJCaXRtYXAoaW5wdXQsIHdpZHRoLCBoZWlnaHQsIGVuZE9mQmxvY2spIHsKICBjb25zdCBwYXJhbXMgPSB7CiAgICBLOiAtMSwKICAgIENvbHVtbnM6IHdpZHRoLAogICAgUm93czogaGVpZ2h0LAogICAgQmxhY2tJczE6IHRydWUsCiAgICBFbmRPZkJsb2NrOiBlbmRPZkJsb2NrCiAgfTsKICBjb25zdCBkZWNvZGVyID0gbmV3IENDSVRURmF4RGVjb2RlcihpbnB1dCwgcGFyYW1zKTsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBsZXQgY3VycmVudEJ5dGUsCiAgICBlb2YgPSBmYWxzZTsKICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CiAgICBjb25zdCByb3cgPSBuZXcgVWludDhBcnJheSh3aWR0aCk7CiAgICBiaXRtYXAucHVzaChyb3cpOwogICAgbGV0IHNoaWZ0ID0gLTE7CiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgaWYgKHNoaWZ0IDwgMCkgewogICAgICAgIGN1cnJlbnRCeXRlID0gZGVjb2Rlci5yZWFkTmV4dENoYXIoKTsKICAgICAgICBpZiAoY3VycmVudEJ5dGUgPT09IC0xKSB7CiAgICAgICAgICBjdXJyZW50Qnl0ZSA9IDA7CiAgICAgICAgICBlb2YgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBzaGlmdCA9IDc7CiAgICAgIH0KICAgICAgcm93W3hdID0gY3VycmVudEJ5dGUgPj4gc2hpZnQgJiAxOwogICAgICBzaGlmdC0tOwogICAgfQogIH0KICBpZiAoZW5kT2ZCbG9jayAmJiAhZW9mKSB7CiAgICBjb25zdCBsb29rRm9yRU9GTGltaXQgPSA1OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb29rRm9yRU9GTGltaXQ7IGkrKykgewogICAgICBpZiAoZGVjb2Rlci5yZWFkTmV4dENoYXIoKSA9PT0gLTEpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gYml0bWFwOwp9CmNsYXNzIEpiaWcySW1hZ2UgewogIHBhcnNlQ2h1bmtzKGNodW5rcykgewogICAgcmV0dXJuIHBhcnNlSmJpZzJDaHVua3MoY2h1bmtzKTsKICB9CiAgcGFyc2UoZGF0YSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgaW1wbGVtZW50ZWQ6IEpiaWcySW1hZ2UucGFyc2UiKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2piaWcyX3N0cmVhbS5qcwoKCgoKCmNsYXNzIEpiaWcyU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5kaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICB0aGlzLm1heWJlTGVuZ3RoID0gbWF5YmVMZW5ndGg7CiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtczsKICB9CiAgZ2V0IGJ5dGVzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYnl0ZXMiLCB0aGlzLnN0cmVhbS5nZXRCeXRlcyh0aGlzLm1heWJlTGVuZ3RoKSk7CiAgfQogIGVuc3VyZUJ1ZmZlcihyZXF1ZXN0ZWQpIHt9CiAgcmVhZEJsb2NrKCkgewogICAgdGhpcy5kZWNvZGVJbWFnZSgpOwogIH0KICBkZWNvZGVJbWFnZShieXRlcykgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgIH0KICAgIGJ5dGVzIHx8PSB0aGlzLmJ5dGVzOwogICAgY29uc3QgamJpZzJJbWFnZSA9IG5ldyBKYmlnMkltYWdlKCk7CiAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgIGlmICh0aGlzLnBhcmFtcyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgZ2xvYmFsc1N0cmVhbSA9IHRoaXMucGFyYW1zLmdldCgiSkJJRzJHbG9iYWxzIik7CiAgICAgIGlmIChnbG9iYWxzU3RyZWFtIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnN0IGdsb2JhbHMgPSBnbG9iYWxzU3RyZWFtLmdldEJ5dGVzKCk7CiAgICAgICAgY2h1bmtzLnB1c2goewogICAgICAgICAgZGF0YTogZ2xvYmFscywKICAgICAgICAgIHN0YXJ0OiAwLAogICAgICAgICAgZW5kOiBnbG9iYWxzLmxlbmd0aAogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBjaHVua3MucHVzaCh7CiAgICAgIGRhdGE6IGJ5dGVzLAogICAgICBzdGFydDogMCwKICAgICAgZW5kOiBieXRlcy5sZW5ndGgKICAgIH0pOwogICAgY29uc3QgZGF0YSA9IGpiaWcySW1hZ2UucGFyc2VDaHVua3MoY2h1bmtzKTsKICAgIGNvbnN0IGRhdGFMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YUxlbmd0aDsgaSsrKSB7CiAgICAgIGRhdGFbaV0gXj0gMHhmZjsKICAgIH0KICAgIHRoaXMuYnVmZmVyID0gZGF0YTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZGF0YUxlbmd0aDsKICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICB9CiAgZ2V0IGNhbkFzeW5jRGVjb2RlSW1hZ2VGcm9tQnVmZmVyKCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtLmlzQXN5bmM7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9qcHhfc3RyZWFtLmpzCgoKCmNsYXNzIEpweFN0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKSB7CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMuZGljdCA9IHN0cmVhbS5kaWN0OwogICAgdGhpcy5tYXliZUxlbmd0aCA9IG1heWJlTGVuZ3RoOwogICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7CiAgfQogIGdldCBieXRlcygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImJ5dGVzIiwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZXModGhpcy5tYXliZUxlbmd0aCkpOwogIH0KICBlbnN1cmVCdWZmZXIocmVxdWVzdGVkKSB7fQogIHJlYWRCbG9jayhkZWNvZGVyT3B0aW9ucykgewogICAgdW5yZWFjaGFibGUoIkpweFN0cmVhbS5yZWFkQmxvY2siKTsKICB9CiAgZ2V0IGlzQXN5bmNEZWNvZGVyKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGFzeW5jIGRlY29kZUltYWdlKGJ5dGVzLCBkZWNvZGVyT3B0aW9ucykgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgIH0KICAgIGJ5dGVzIHx8PSB0aGlzLmJ5dGVzOwogICAgdGhpcy5idWZmZXIgPSBhd2FpdCBKcHhJbWFnZS5kZWNvZGUoYnl0ZXMsIGRlY29kZXJPcHRpb25zKTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXIubGVuZ3RoOwogICAgdGhpcy5lb2YgPSB0cnVlOwogICAgcmV0dXJuIHRoaXMuYnVmZmVyOwogIH0KICBnZXQgY2FuQXN5bmNEZWNvZGVJbWFnZUZyb21CdWZmZXIoKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW0uaXNBc3luYzsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2x6d19zdHJlYW0uanMKCmNsYXNzIExaV1N0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyLCBtYXliZUxlbmd0aCwgZWFybHlDaGFuZ2UpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyZWFtID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICB0aGlzLmNhY2hlZERhdGEgPSAwOwogICAgdGhpcy5iaXRzQ2FjaGVkID0gMDsKICAgIGNvbnN0IG1heEx6d0RpY3Rpb25hcnlTaXplID0gNDA5NjsKICAgIGNvbnN0IGx6d1N0YXRlID0gewogICAgICBlYXJseUNoYW5nZSwKICAgICAgY29kZUxlbmd0aDogOSwKICAgICAgbmV4dENvZGU6IDI1OCwKICAgICAgZGljdGlvbmFyeVZhbHVlczogbmV3IFVpbnQ4QXJyYXkobWF4THp3RGljdGlvbmFyeVNpemUpLAogICAgICBkaWN0aW9uYXJ5TGVuZ3RoczogbmV3IFVpbnQxNkFycmF5KG1heEx6d0RpY3Rpb25hcnlTaXplKSwKICAgICAgZGljdGlvbmFyeVByZXZDb2RlczogbmV3IFVpbnQxNkFycmF5KG1heEx6d0RpY3Rpb25hcnlTaXplKSwKICAgICAgY3VycmVudFNlcXVlbmNlOiBuZXcgVWludDhBcnJheShtYXhMendEaWN0aW9uYXJ5U2l6ZSksCiAgICAgIGN1cnJlbnRTZXF1ZW5jZUxlbmd0aDogMAogICAgfTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyArK2kpIHsKICAgICAgbHp3U3RhdGUuZGljdGlvbmFyeVZhbHVlc1tpXSA9IGk7CiAgICAgIGx6d1N0YXRlLmRpY3Rpb25hcnlMZW5ndGhzW2ldID0gMTsKICAgIH0KICAgIHRoaXMubHp3U3RhdGUgPSBsendTdGF0ZTsKICB9CiAgcmVhZEJpdHMobikgewogICAgbGV0IGJpdHNDYWNoZWQgPSB0aGlzLmJpdHNDYWNoZWQ7CiAgICBsZXQgY2FjaGVkRGF0YSA9IHRoaXMuY2FjaGVkRGF0YTsKICAgIHdoaWxlIChiaXRzQ2FjaGVkIDwgbikgewogICAgICBjb25zdCBjID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICBpZiAoYyA9PT0gLTEpIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY2FjaGVkRGF0YSA9IGNhY2hlZERhdGEgPDwgOCB8IGM7CiAgICAgIGJpdHNDYWNoZWQgKz0gODsKICAgIH0KICAgIHRoaXMuYml0c0NhY2hlZCA9IGJpdHNDYWNoZWQgLT0gbjsKICAgIHRoaXMuY2FjaGVkRGF0YSA9IGNhY2hlZERhdGE7CiAgICB0aGlzLmxhc3RDb2RlID0gbnVsbDsKICAgIHJldHVybiBjYWNoZWREYXRhID4+PiBiaXRzQ2FjaGVkICYgKDEgPDwgbikgLSAxOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCBibG9ja1NpemUgPSA1MTIsCiAgICAgIGRlY29kZWRTaXplRGVsdGEgPSBibG9ja1NpemU7CiAgICBsZXQgZXN0aW1hdGVkRGVjb2RlZFNpemUgPSBibG9ja1NpemUgKiAyOwogICAgbGV0IGksIGosIHE7CiAgICBjb25zdCBsendTdGF0ZSA9IHRoaXMubHp3U3RhdGU7CiAgICBpZiAoIWx6d1N0YXRlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGVhcmx5Q2hhbmdlID0gbHp3U3RhdGUuZWFybHlDaGFuZ2U7CiAgICBsZXQgbmV4dENvZGUgPSBsendTdGF0ZS5uZXh0Q29kZTsKICAgIGNvbnN0IGRpY3Rpb25hcnlWYWx1ZXMgPSBsendTdGF0ZS5kaWN0aW9uYXJ5VmFsdWVzOwogICAgY29uc3QgZGljdGlvbmFyeUxlbmd0aHMgPSBsendTdGF0ZS5kaWN0aW9uYXJ5TGVuZ3RoczsKICAgIGNvbnN0IGRpY3Rpb25hcnlQcmV2Q29kZXMgPSBsendTdGF0ZS5kaWN0aW9uYXJ5UHJldkNvZGVzOwogICAgbGV0IGNvZGVMZW5ndGggPSBsendTdGF0ZS5jb2RlTGVuZ3RoOwogICAgbGV0IHByZXZDb2RlID0gbHp3U3RhdGUucHJldkNvZGU7CiAgICBjb25zdCBjdXJyZW50U2VxdWVuY2UgPSBsendTdGF0ZS5jdXJyZW50U2VxdWVuY2U7CiAgICBsZXQgY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gbHp3U3RhdGUuY3VycmVudFNlcXVlbmNlTGVuZ3RoOwogICAgbGV0IGRlY29kZWRMZW5ndGggPSAwOwogICAgbGV0IGN1cnJlbnRCdWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGxldCBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcih0aGlzLmJ1ZmZlckxlbmd0aCArIGVzdGltYXRlZERlY29kZWRTaXplKTsKICAgIGZvciAoaSA9IDA7IGkgPCBibG9ja1NpemU7IGkrKykgewogICAgICBjb25zdCBjb2RlID0gdGhpcy5yZWFkQml0cyhjb2RlTGVuZ3RoKTsKICAgICAgY29uc3QgaGFzUHJldiA9IGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA+IDA7CiAgICAgIGlmIChjb2RlIDwgMjU2KSB7CiAgICAgICAgY3VycmVudFNlcXVlbmNlWzBdID0gY29kZTsKICAgICAgICBjdXJyZW50U2VxdWVuY2VMZW5ndGggPSAxOwogICAgICB9IGVsc2UgaWYgKGNvZGUgPj0gMjU4KSB7CiAgICAgICAgaWYgKGNvZGUgPCBuZXh0Q29kZSkgewogICAgICAgICAgY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gZGljdGlvbmFyeUxlbmd0aHNbY29kZV07CiAgICAgICAgICBmb3IgKGogPSBjdXJyZW50U2VxdWVuY2VMZW5ndGggLSAxLCBxID0gY29kZTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgICAgY3VycmVudFNlcXVlbmNlW2pdID0gZGljdGlvbmFyeVZhbHVlc1txXTsKICAgICAgICAgICAgcSA9IGRpY3Rpb25hcnlQcmV2Q29kZXNbcV07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRTZXF1ZW5jZVtjdXJyZW50U2VxdWVuY2VMZW5ndGgrK10gPSBjdXJyZW50U2VxdWVuY2VbMF07CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDI1NikgewogICAgICAgIGNvZGVMZW5ndGggPSA5OwogICAgICAgIG5leHRDb2RlID0gMjU4OwogICAgICAgIGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA9IDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIGRlbGV0ZSB0aGlzLmx6d1N0YXRlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChoYXNQcmV2KSB7CiAgICAgICAgZGljdGlvbmFyeVByZXZDb2Rlc1tuZXh0Q29kZV0gPSBwcmV2Q29kZTsKICAgICAgICBkaWN0aW9uYXJ5TGVuZ3Roc1tuZXh0Q29kZV0gPSBkaWN0aW9uYXJ5TGVuZ3Roc1twcmV2Q29kZV0gKyAxOwogICAgICAgIGRpY3Rpb25hcnlWYWx1ZXNbbmV4dENvZGVdID0gY3VycmVudFNlcXVlbmNlWzBdOwogICAgICAgIG5leHRDb2RlKys7CiAgICAgICAgY29kZUxlbmd0aCA9IG5leHRDb2RlICsgZWFybHlDaGFuZ2UgJiBuZXh0Q29kZSArIGVhcmx5Q2hhbmdlIC0gMSA/IGNvZGVMZW5ndGggOiBNYXRoLm1pbihNYXRoLmxvZyhuZXh0Q29kZSArIGVhcmx5Q2hhbmdlKSAvIDAuNjkzMTQ3MTgwNTU5OTQ1MyArIDEsIDEyKSB8IDA7CiAgICAgIH0KICAgICAgcHJldkNvZGUgPSBjb2RlOwogICAgICBkZWNvZGVkTGVuZ3RoICs9IGN1cnJlbnRTZXF1ZW5jZUxlbmd0aDsKICAgICAgaWYgKGVzdGltYXRlZERlY29kZWRTaXplIDwgZGVjb2RlZExlbmd0aCkgewogICAgICAgIGRvIHsKICAgICAgICAgIGVzdGltYXRlZERlY29kZWRTaXplICs9IGRlY29kZWRTaXplRGVsdGE7CiAgICAgICAgfSB3aGlsZSAoZXN0aW1hdGVkRGVjb2RlZFNpemUgPCBkZWNvZGVkTGVuZ3RoKTsKICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcih0aGlzLmJ1ZmZlckxlbmd0aCArIGVzdGltYXRlZERlY29kZWRTaXplKTsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgY3VycmVudFNlcXVlbmNlTGVuZ3RoOyBqKyspIHsKICAgICAgICBidWZmZXJbY3VycmVudEJ1ZmZlckxlbmd0aCsrXSA9IGN1cnJlbnRTZXF1ZW5jZVtqXTsKICAgICAgfQogICAgfQogICAgbHp3U3RhdGUubmV4dENvZGUgPSBuZXh0Q29kZTsKICAgIGx6d1N0YXRlLmNvZGVMZW5ndGggPSBjb2RlTGVuZ3RoOwogICAgbHp3U3RhdGUucHJldkNvZGUgPSBwcmV2Q29kZTsKICAgIGx6d1N0YXRlLmN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA9IGN1cnJlbnRTZXF1ZW5jZUxlbmd0aDsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gY3VycmVudEJ1ZmZlckxlbmd0aDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3ByZWRpY3Rvcl9zdHJlYW0uanMKCgoKY2xhc3MgUHJlZGljdG9yU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIGlmICghKHBhcmFtcyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBzdHI7CiAgICB9CiAgICBjb25zdCBwcmVkaWN0b3IgPSB0aGlzLnByZWRpY3RvciA9IHBhcmFtcy5nZXQoIlByZWRpY3RvciIpIHx8IDE7CiAgICBpZiAocHJlZGljdG9yIDw9IDEpIHsKICAgICAgcmV0dXJuIHN0cjsKICAgIH0KICAgIGlmIChwcmVkaWN0b3IgIT09IDIgJiYgKHByZWRpY3RvciA8IDEwIHx8IHByZWRpY3RvciA+IDE1KSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYFVuc3VwcG9ydGVkIHByZWRpY3RvcjogJHtwcmVkaWN0b3J9YCk7CiAgICB9CiAgICB0aGlzLnJlYWRCbG9jayA9IHByZWRpY3RvciA9PT0gMiA/IHRoaXMucmVhZEJsb2NrVGlmZiA6IHRoaXMucmVhZEJsb2NrUG5nOwogICAgdGhpcy5zdHJlYW0gPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzID0gcGFyYW1zLmdldCgiQ29sb3JzIikgfHwgMTsKICAgIGNvbnN0IGJpdHMgPSB0aGlzLmJpdHMgPSBwYXJhbXMuZ2V0KCJCUEMiLCAiQml0c1BlckNvbXBvbmVudCIpIHx8IDg7CiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5jb2x1bW5zID0gcGFyYW1zLmdldCgiQ29sdW1ucyIpIHx8IDE7CiAgICB0aGlzLnBpeEJ5dGVzID0gY29sb3JzICogYml0cyArIDcgPj4gMzsKICAgIHRoaXMucm93Qnl0ZXMgPSBjb2x1bW5zICogY29sb3JzICogYml0cyArIDcgPj4gMzsKICAgIHJldHVybiB0aGlzOwogIH0KICByZWFkQmxvY2tUaWZmKCkgewogICAgY29uc3Qgcm93Qnl0ZXMgPSB0aGlzLnJvd0J5dGVzOwogICAgY29uc3QgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihidWZmZXJMZW5ndGggKyByb3dCeXRlcyk7CiAgICBjb25zdCBiaXRzID0gdGhpcy5iaXRzOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCByYXdCeXRlcyA9IHRoaXMuc3RyZWFtLmdldEJ5dGVzKHJvd0J5dGVzKTsKICAgIHRoaXMuZW9mID0gIXJhd0J5dGVzLmxlbmd0aDsKICAgIGlmICh0aGlzLmVvZikgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgaW5idWYgPSAwLAogICAgICBvdXRidWYgPSAwOwogICAgbGV0IGluYml0cyA9IDAsCiAgICAgIG91dGJpdHMgPSAwOwogICAgbGV0IHBvcyA9IGJ1ZmZlckxlbmd0aDsKICAgIGxldCBpOwogICAgaWYgKGJpdHMgPT09IDEgJiYgY29sb3JzID09PSAxKSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgbGV0IGMgPSByYXdCeXRlc1tpXSBeIGluYnVmOwogICAgICAgIGMgXj0gYyA+PiAxOwogICAgICAgIGMgXj0gYyA+PiAyOwogICAgICAgIGMgXj0gYyA+PiA0OwogICAgICAgIGluYnVmID0gKGMgJiAxKSA8PCA3OwogICAgICAgIGJ1ZmZlcltwb3MrK10gPSBjOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGJpdHMgPT09IDgpIHsKICAgICAgZm9yIChpID0gMDsgaSA8IGNvbG9yczsgKytpKSB7CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IHJhd0J5dGVzW2ldOwogICAgICB9CiAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgIGJ1ZmZlcltwb3NdID0gYnVmZmVyW3BvcyAtIGNvbG9yc10gKyByYXdCeXRlc1tpXTsKICAgICAgICBwb3MrKzsKICAgICAgfQogICAgfSBlbHNlIGlmIChiaXRzID09PSAxNikgewogICAgICBjb25zdCBieXRlc1BlclBpeGVsID0gY29sb3JzICogMjsKICAgICAgZm9yIChpID0gMDsgaSA8IGJ5dGVzUGVyUGl4ZWw7ICsraSkgewogICAgICAgIGJ1ZmZlcltwb3MrK10gPSByYXdCeXRlc1tpXTsKICAgICAgfQogICAgICBmb3IgKDsgaSA8IHJvd0J5dGVzOyBpICs9IDIpIHsKICAgICAgICBjb25zdCBzdW0gPSAoKHJhd0J5dGVzW2ldICYgMHhmZikgPDwgOCkgKyAocmF3Qnl0ZXNbaSArIDFdICYgMHhmZikgKyAoKGJ1ZmZlcltwb3MgLSBieXRlc1BlclBpeGVsXSAmIDB4ZmYpIDw8IDgpICsgKGJ1ZmZlcltwb3MgLSBieXRlc1BlclBpeGVsICsgMV0gJiAweGZmKTsKICAgICAgICBidWZmZXJbcG9zKytdID0gc3VtID4+IDggJiAweGZmOwogICAgICAgIGJ1ZmZlcltwb3MrK10gPSBzdW0gJiAweGZmOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBjb21wQXJyYXkgPSBuZXcgVWludDhBcnJheShjb2xvcnMgKyAxKTsKICAgICAgY29uc3QgYml0TWFzayA9ICgxIDw8IGJpdHMpIC0gMTsKICAgICAgbGV0IGogPSAwLAogICAgICAgIGsgPSBidWZmZXJMZW5ndGg7CiAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbHVtbnM7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb2x1bW5zOyArK2kpIHsKICAgICAgICBmb3IgKGxldCBrayA9IDA7IGtrIDwgY29sb3JzOyArK2trKSB7CiAgICAgICAgICBpZiAoaW5iaXRzIDwgYml0cykgewogICAgICAgICAgICBpbmJ1ZiA9IGluYnVmIDw8IDggfCByYXdCeXRlc1tqKytdICYgMHhmZjsKICAgICAgICAgICAgaW5iaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICBjb21wQXJyYXlba2tdID0gY29tcEFycmF5W2trXSArIChpbmJ1ZiA+PiBpbmJpdHMgLSBiaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICBpbmJpdHMgLT0gYml0czsKICAgICAgICAgIG91dGJ1ZiA9IG91dGJ1ZiA8PCBiaXRzIHwgY29tcEFycmF5W2trXTsKICAgICAgICAgIG91dGJpdHMgKz0gYml0czsKICAgICAgICAgIGlmIChvdXRiaXRzID49IDgpIHsKICAgICAgICAgICAgYnVmZmVyW2srK10gPSBvdXRidWYgPj4gb3V0Yml0cyAtIDggJiAweGZmOwogICAgICAgICAgICBvdXRiaXRzIC09IDg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChvdXRiaXRzID4gMCkgewogICAgICAgIGJ1ZmZlcltrKytdID0gKG91dGJ1ZiA8PCA4IC0gb3V0Yml0cykgKyAoaW5idWYgJiAoMSA8PCA4IC0gb3V0Yml0cykgLSAxKTsKICAgICAgfQogICAgfQogICAgdGhpcy5idWZmZXJMZW5ndGggKz0gcm93Qnl0ZXM7CiAgfQogIHJlYWRCbG9ja1BuZygpIHsKICAgIGNvbnN0IHJvd0J5dGVzID0gdGhpcy5yb3dCeXRlczsKICAgIGNvbnN0IHBpeEJ5dGVzID0gdGhpcy5waXhCeXRlczsKICAgIGNvbnN0IHByZWRpY3RvciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgIGNvbnN0IHJhd0J5dGVzID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZXMocm93Qnl0ZXMpOwogICAgdGhpcy5lb2YgPSAhcmF3Qnl0ZXMubGVuZ3RoOwogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgcm93Qnl0ZXMpOwogICAgbGV0IHByZXZSb3cgPSBidWZmZXIuc3ViYXJyYXkoYnVmZmVyTGVuZ3RoIC0gcm93Qnl0ZXMsIGJ1ZmZlckxlbmd0aCk7CiAgICBpZiAocHJldlJvdy5sZW5ndGggPT09IDApIHsKICAgICAgcHJldlJvdyA9IG5ldyBVaW50OEFycmF5KHJvd0J5dGVzKTsKICAgIH0KICAgIGxldCBpLAogICAgICBqID0gYnVmZmVyTGVuZ3RoLAogICAgICB1cCwKICAgICAgYzsKICAgIHN3aXRjaCAocHJlZGljdG9yKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2orK10gPSByYXdCeXRlc1tpXTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGl4Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2orK10gPSByYXdCeXRlc1tpXTsKICAgICAgICB9CiAgICAgICAgZm9yICg7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICBidWZmZXJbal0gPSBidWZmZXJbaiAtIHBpeEJ5dGVzXSArIHJhd0J5dGVzW2ldICYgMHhmZjsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2orK10gPSBwcmV2Um93W2ldICsgcmF3Qnl0ZXNbaV0gJiAweGZmOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwaXhCeXRlczsgKytpKSB7CiAgICAgICAgICBidWZmZXJbaisrXSA9IChwcmV2Um93W2ldID4+IDEpICsgcmF3Qnl0ZXNbaV07CiAgICAgICAgfQogICAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2pdID0gKHByZXZSb3dbaV0gKyBidWZmZXJbaiAtIHBpeEJ5dGVzXSA+PiAxKSArIHJhd0J5dGVzW2ldICYgMHhmZjsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgNDoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGl4Qnl0ZXM7ICsraSkgewogICAgICAgICAgdXAgPSBwcmV2Um93W2ldOwogICAgICAgICAgYyA9IHJhd0J5dGVzW2ldOwogICAgICAgICAgYnVmZmVyW2orK10gPSB1cCArIGM7CiAgICAgICAgfQogICAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgdXAgPSBwcmV2Um93W2ldOwogICAgICAgICAgY29uc3QgdXBMZWZ0ID0gcHJldlJvd1tpIC0gcGl4Qnl0ZXNdOwogICAgICAgICAgY29uc3QgbGVmdCA9IGJ1ZmZlcltqIC0gcGl4Qnl0ZXNdOwogICAgICAgICAgY29uc3QgcCA9IGxlZnQgKyB1cCAtIHVwTGVmdDsKICAgICAgICAgIGxldCBwYSA9IHAgLSBsZWZ0OwogICAgICAgICAgaWYgKHBhIDwgMCkgewogICAgICAgICAgICBwYSA9IC1wYTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBwYiA9IHAgLSB1cDsKICAgICAgICAgIGlmIChwYiA8IDApIHsKICAgICAgICAgICAgcGIgPSAtcGI7CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgcGMgPSBwIC0gdXBMZWZ0OwogICAgICAgICAgaWYgKHBjIDwgMCkgewogICAgICAgICAgICBwYyA9IC1wYzsKICAgICAgICAgIH0KICAgICAgICAgIGMgPSByYXdCeXRlc1tpXTsKICAgICAgICAgIGlmIChwYSA8PSBwYiAmJiBwYSA8PSBwYykgewogICAgICAgICAgICBidWZmZXJbaisrXSA9IGxlZnQgKyBjOwogICAgICAgICAgfSBlbHNlIGlmIChwYiA8PSBwYykgewogICAgICAgICAgICBidWZmZXJbaisrXSA9IHVwICsgYzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gdXBMZWZ0ICsgYzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbnN1cHBvcnRlZCBwcmVkaWN0b3I6ICR7cHJlZGljdG9yfWApOwogICAgfQogICAgdGhpcy5idWZmZXJMZW5ndGggKz0gcm93Qnl0ZXM7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9ydW5fbGVuZ3RoX3N0cmVhbS5qcwoKY2xhc3MgUnVuTGVuZ3RoU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0cmVhbSA9IHN0cjsKICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCByZXBlYXRIZWFkZXIgPSB0aGlzLnN0cmVhbS5nZXRCeXRlcygyKTsKICAgIGlmICghcmVwZWF0SGVhZGVyIHx8IHJlcGVhdEhlYWRlci5sZW5ndGggPCAyIHx8IHJlcGVhdEhlYWRlclswXSA9PT0gMTI4KSB7CiAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGJ1ZmZlcjsKICAgIGxldCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGxldCBuID0gcmVwZWF0SGVhZGVyWzBdOwogICAgaWYgKG4gPCAxMjgpIHsKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgbiArIDEpOwogICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoKytdID0gcmVwZWF0SGVhZGVyWzFdOwogICAgICBpZiAobiA+IDApIHsKICAgICAgICBjb25zdCBzb3VyY2UgPSB0aGlzLnN0cmVhbS5nZXRCeXRlcyhuKTsKICAgICAgICBidWZmZXIuc2V0KHNvdXJjZSwgYnVmZmVyTGVuZ3RoKTsKICAgICAgICBidWZmZXJMZW5ndGggKz0gbjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbiA9IDI1NyAtIG47CiAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIG4gKyAxKTsKICAgICAgYnVmZmVyLmZpbGwocmVwZWF0SGVhZGVyWzFdLCBidWZmZXJMZW5ndGgsIGJ1ZmZlckxlbmd0aCArIG4pOwogICAgICBidWZmZXJMZW5ndGggKz0gbjsKICAgIH0KICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvcGFyc2VyLmpzCgoKCgoKCgoKCgoKCgoKY29uc3QgTUFYX0xFTkdUSF9UT19DQUNIRSA9IDEwMDA7CmZ1bmN0aW9uIGdldElubGluZUltYWdlQ2FjaGVLZXkoYnl0ZXMpIHsKICBjb25zdCBzdHJCdWYgPSBbXSwKICAgIGlpID0gYnl0ZXMubGVuZ3RoOwogIGxldCBpID0gMDsKICB3aGlsZSAoaSA8IGlpIC0gMSkgewogICAgc3RyQnVmLnB1c2goYnl0ZXNbaSsrXSA8PCA4IHwgYnl0ZXNbaSsrXSk7CiAgfQogIGlmIChpIDwgaWkpIHsKICAgIHN0ckJ1Zi5wdXNoKGJ5dGVzW2ldKTsKICB9CiAgcmV0dXJuIGlpICsgIl8iICsgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBzdHJCdWYpOwp9CmNsYXNzIFBhcnNlciB7CiAgY29uc3RydWN0b3IoewogICAgbGV4ZXIsCiAgICB4cmVmLAogICAgYWxsb3dTdHJlYW1zID0gZmFsc2UsCiAgICByZWNvdmVyeU1vZGUgPSBmYWxzZQogIH0pIHsKICAgIHRoaXMubGV4ZXIgPSBsZXhlcjsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLmFsbG93U3RyZWFtcyA9IGFsbG93U3RyZWFtczsKICAgIHRoaXMucmVjb3ZlcnlNb2RlID0gcmVjb3ZlcnlNb2RlOwogICAgdGhpcy5pbWFnZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuX2ltYWdlSWQgPSAwOwogICAgdGhpcy5yZWZpbGwoKTsKICB9CiAgcmVmaWxsKCkgewogICAgdGhpcy5idWYxID0gdGhpcy5sZXhlci5nZXRPYmooKTsKICAgIHRoaXMuYnVmMiA9IHRoaXMubGV4ZXIuZ2V0T2JqKCk7CiAgfQogIHNoaWZ0KCkgewogICAgaWYgKHRoaXMuYnVmMiBpbnN0YW5jZW9mIENtZCAmJiB0aGlzLmJ1ZjIuY21kID09PSAiSUQiKSB7CiAgICAgIHRoaXMuYnVmMSA9IHRoaXMuYnVmMjsKICAgICAgdGhpcy5idWYyID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYnVmMSA9IHRoaXMuYnVmMjsKICAgICAgdGhpcy5idWYyID0gdGhpcy5sZXhlci5nZXRPYmooKTsKICAgIH0KICB9CiAgdHJ5U2hpZnQoKSB7CiAgICB0cnkgewogICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAoZSBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIGdldE9iaihjaXBoZXJUcmFuc2Zvcm0gPSBudWxsKSB7CiAgICBjb25zdCBidWYxID0gdGhpcy5idWYxOwogICAgdGhpcy5zaGlmdCgpOwogICAgaWYgKGJ1ZjEgaW5zdGFuY2VvZiBDbWQpIHsKICAgICAgc3dpdGNoIChidWYxLmNtZCkgewogICAgICAgIGNhc2UgIkJJIjoKICAgICAgICAgIHJldHVybiB0aGlzLm1ha2VJbmxpbmVJbWFnZShjaXBoZXJUcmFuc2Zvcm0pOwogICAgICAgIGNhc2UgIlsiOgogICAgICAgICAgY29uc3QgYXJyYXkgPSBbXTsKICAgICAgICAgIHdoaWxlICghaXNDbWQodGhpcy5idWYxLCAiXSIpICYmIHRoaXMuYnVmMSAhPT0gRU9GKSB7CiAgICAgICAgICAgIGFycmF5LnB1c2godGhpcy5nZXRPYmooY2lwaGVyVHJhbnNmb3JtKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5idWYxID09PSBFT0YpIHsKICAgICAgICAgICAgaWYgKHRoaXMucmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBQYXJzZXJFT0ZFeGNlcHRpb24oIkVuZCBvZiBmaWxlIGluc2lkZSBhcnJheS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgIHJldHVybiBhcnJheTsKICAgICAgICBjYXNlICI8PCI6CiAgICAgICAgICBjb25zdCBkaWN0ID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgICAgICAgIHdoaWxlICghaXNDbWQodGhpcy5idWYxLCAiPj4iKSAmJiB0aGlzLmJ1ZjEgIT09IEVPRikgewogICAgICAgICAgICBpZiAoISh0aGlzLmJ1ZjEgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICAgICAgICAgIGluZm8oIk1hbGZvcm1lZCBkaWN0aW9uYXJ5OiBrZXkgbXVzdCBiZSBhIG5hbWUgb2JqZWN0Iik7CiAgICAgICAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGtleSA9IHRoaXMuYnVmMS5uYW1lOwogICAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZjEgPT09IEVPRikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRpY3Quc2V0KGtleSwgdGhpcy5nZXRPYmooY2lwaGVyVHJhbnNmb3JtKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5idWYxID09PSBFT0YpIHsKICAgICAgICAgICAgaWYgKHRoaXMucmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRpY3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IFBhcnNlckVPRkV4Y2VwdGlvbigiRW5kIG9mIGZpbGUgaW5zaWRlIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNDbWQodGhpcy5idWYyLCAic3RyZWFtIikpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWxsb3dTdHJlYW1zID8gdGhpcy5tYWtlU3RyZWFtKGRpY3QsIGNpcGhlclRyYW5zZm9ybSkgOiBkaWN0OwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgICAgcmV0dXJuIGRpY3Q7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBidWYxOwogICAgICB9CiAgICB9CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihidWYxKSkgewogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcih0aGlzLmJ1ZjEpICYmIGlzQ21kKHRoaXMuYnVmMiwgIlIiKSkgewogICAgICAgIGNvbnN0IHJlZiA9IFJlZi5nZXQoYnVmMSwgdGhpcy5idWYxKTsKICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgIHJldHVybiByZWY7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZjE7CiAgICB9CiAgICBpZiAodHlwZW9mIGJ1ZjEgPT09ICJzdHJpbmciKSB7CiAgICAgIGlmIChjaXBoZXJUcmFuc2Zvcm0pIHsKICAgICAgICByZXR1cm4gY2lwaGVyVHJhbnNmb3JtLmRlY3J5cHRTdHJpbmcoYnVmMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZjE7CiAgICB9CiAgICByZXR1cm4gYnVmMTsKICB9CiAgZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBFID0gMHg0NSwKICAgICAgSSA9IDB4NDksCiAgICAgIFNQQUNFID0gMHgyMCwKICAgICAgTEYgPSAweGEsCiAgICAgIENSID0gMHhkLAogICAgICBOVUwgPSAweDA7CiAgICBjb25zdCB7CiAgICAgICAga25vd25Db21tYW5kcwogICAgICB9ID0gdGhpcy5sZXhlciwKICAgICAgc3RhcnRQb3MgPSBzdHJlYW0ucG9zLAogICAgICBuID0gMTU7CiAgICBsZXQgc3RhdGUgPSAwLAogICAgICBjaCwKICAgICAgbWF5YmVFSVBvczsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKHN0YXRlID09PSAwKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gRSA/IDEgOiAwOwogICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAxKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gSSA/IDIgOiAwOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChjaCA9PT0gU1BBQ0UgfHwgY2ggPT09IExGIHx8IGNoID09PSBDUikgewogICAgICAgICAgbWF5YmVFSVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgICBjb25zdCBmb2xsb3dpbmdCeXRlcyA9IHN0cmVhbS5wZWVrQnl0ZXMobik7CiAgICAgICAgICBjb25zdCBpaSA9IGZvbGxvd2luZ0J5dGVzLmxlbmd0aDsKICAgICAgICAgIGlmIChpaSA9PT0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBjaCA9IGZvbGxvd2luZ0J5dGVzW2ldOwogICAgICAgICAgICBpZiAoY2ggPT09IE5VTCAmJiBmb2xsb3dpbmdCeXRlc1tpICsgMV0gIT09IE5VTCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaCAhPT0gTEYgJiYgY2ggIT09IENSICYmIChjaCA8IFNQQUNFIHx8IGNoID4gMHg3ZikpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IDA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZSAhPT0gMikgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgha25vd25Db21tYW5kcykgewogICAgICAgICAgICB3YXJuKCJmaW5kRGVmYXVsdElubGluZVN0cmVhbUVuZCAtIGBsZXhlci5rbm93bkNvbW1hbmRzYCBpcyB1bmRlZmluZWQuIik7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgdG1wTGV4ZXIgPSBuZXcgTGV4ZXIobmV3IFN0cmVhbShzdHJlYW0ucGVla0J5dGVzKDUgKiBuKSksIGtub3duQ29tbWFuZHMpOwogICAgICAgICAgdG1wTGV4ZXIuX2hleFN0cmluZ1dhcm4gPSAoKSA9PiB7fTsKICAgICAgICAgIGxldCBudW1BcmdzID0gMDsKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIGNvbnN0IG5leHRPYmogPSB0bXBMZXhlci5nZXRPYmooKTsKICAgICAgICAgICAgaWYgKG5leHRPYmogPT09IEVPRikgewogICAgICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV4dE9iaiBpbnN0YW5jZW9mIENtZCkgewogICAgICAgICAgICAgIGNvbnN0IGtub3duQ29tbWFuZCA9IGtub3duQ29tbWFuZHNbbmV4dE9iai5jbWRdOwogICAgICAgICAgICAgIGlmICgha25vd25Db21tYW5kKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IDA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtub3duQ29tbWFuZC52YXJpYWJsZUFyZ3MgPyBudW1BcmdzIDw9IGtub3duQ29tbWFuZC5udW1BcmdzIDogbnVtQXJncyA9PT0ga25vd25Db21tYW5kLm51bUFyZ3MpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBudW1BcmdzID0gMDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBudW1BcmdzKys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChjaCA9PT0gLTEpIHsKICAgICAgd2FybigiZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQ6ICIgKyAiUmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBzdHJlYW0gd2l0aG91dCBmaW5kaW5nIGEgdmFsaWQgRUkgbWFya2VyIik7CiAgICAgIGlmIChtYXliZUVJUG9zKSB7CiAgICAgICAgd2FybignLi4uIHRyeWluZyB0byByZWNvdmVyIGJ5IHVzaW5nIHRoZSBsYXN0ICJFSSIgb2NjdXJyZW5jZS4nKTsKICAgICAgICBzdHJlYW0uc2tpcCgtKHN0cmVhbS5wb3MgLSBtYXliZUVJUG9zKSk7CiAgICAgIH0KICAgIH0KICAgIGxldCBlbmRPZmZzZXQgPSA0OwogICAgc3RyZWFtLnNraXAoLWVuZE9mZnNldCk7CiAgICBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgc3RyZWFtLnNraXAoZW5kT2Zmc2V0KTsKICAgIGlmICghaXNXaGl0ZVNwYWNlKGNoKSkgewogICAgICBlbmRPZmZzZXQtLTsKICAgIH0KICAgIHJldHVybiBzdHJlYW0ucG9zIC0gZW5kT2Zmc2V0IC0gc3RhcnRQb3M7CiAgfQogIGZpbmREQ1REZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgZm91bmRFT0kgPSBmYWxzZSwKICAgICAgYiwKICAgICAgbWFya2VyTGVuZ3RoOwogICAgd2hpbGUgKChiID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChiICE9PSAweGZmKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChzdHJlYW0uZ2V0Qnl0ZSgpKSB7CiAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmOgogICAgICAgICAgc3RyZWFtLnNraXAoLTEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGQ5OgogICAgICAgICAgZm91bmRFT0kgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGMwOgogICAgICAgIGNhc2UgMHhjMToKICAgICAgICBjYXNlIDB4YzI6CiAgICAgICAgY2FzZSAweGMzOgogICAgICAgIGNhc2UgMHhjNToKICAgICAgICBjYXNlIDB4YzY6CiAgICAgICAgY2FzZSAweGM3OgogICAgICAgIGNhc2UgMHhjOToKICAgICAgICBjYXNlIDB4Y2E6CiAgICAgICAgY2FzZSAweGNiOgogICAgICAgIGNhc2UgMHhjZDoKICAgICAgICBjYXNlIDB4Y2U6CiAgICAgICAgY2FzZSAweGNmOgogICAgICAgIGNhc2UgMHhjNDoKICAgICAgICBjYXNlIDB4Y2M6CiAgICAgICAgY2FzZSAweGRhOgogICAgICAgIGNhc2UgMHhkYjoKICAgICAgICBjYXNlIDB4ZGM6CiAgICAgICAgY2FzZSAweGRkOgogICAgICAgIGNhc2UgMHhkZToKICAgICAgICBjYXNlIDB4ZGY6CiAgICAgICAgY2FzZSAweGUwOgogICAgICAgIGNhc2UgMHhlMToKICAgICAgICBjYXNlIDB4ZTI6CiAgICAgICAgY2FzZSAweGUzOgogICAgICAgIGNhc2UgMHhlNDoKICAgICAgICBjYXNlIDB4ZTU6CiAgICAgICAgY2FzZSAweGU2OgogICAgICAgIGNhc2UgMHhlNzoKICAgICAgICBjYXNlIDB4ZTg6CiAgICAgICAgY2FzZSAweGU5OgogICAgICAgIGNhc2UgMHhlYToKICAgICAgICBjYXNlIDB4ZWI6CiAgICAgICAgY2FzZSAweGVjOgogICAgICAgIGNhc2UgMHhlZDoKICAgICAgICBjYXNlIDB4ZWU6CiAgICAgICAgY2FzZSAweGVmOgogICAgICAgIGNhc2UgMHhmZToKICAgICAgICAgIG1hcmtlckxlbmd0aCA9IHN0cmVhbS5nZXRVaW50MTYoKTsKICAgICAgICAgIGlmIChtYXJrZXJMZW5ndGggPiAyKSB7CiAgICAgICAgICAgIHN0cmVhbS5za2lwKG1hcmtlckxlbmd0aCAtIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RyZWFtLnNraXAoLTIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGZvdW5kRU9JKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGxlbmd0aCA9IHN0cmVhbS5wb3MgLSBzdGFydFBvczsKICAgIGlmIChiID09PSAtMSkgewogICAgICB3YXJuKCJJbmxpbmUgRENURGVjb2RlIGltYWdlIHN0cmVhbTogIiArICJFT0kgbWFya2VyIG5vdCBmb3VuZCwgc2VhcmNoaW5nIGZvciAvRUkvIGluc3RlYWQuIik7CiAgICAgIHN0cmVhbS5za2lwKC1sZW5ndGgpOwogICAgICByZXR1cm4gdGhpcy5maW5kRGVmYXVsdElubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgfQogICAgdGhpcy5pbmxpbmVTdHJlYW1Ta2lwRUkoc3RyZWFtKTsKICAgIHJldHVybiBsZW5ndGg7CiAgfQogIGZpbmRBU0NJSTg1RGVjb2RlSW5saW5lU3RyZWFtRW5kKHN0cmVhbSkgewogICAgY29uc3QgVElMREUgPSAweDdlLAogICAgICBHVCA9IDB4M2U7CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChjaCA9PT0gVElMREUpIHsKICAgICAgICBjb25zdCB0aWxkZVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgY2ggPSBzdHJlYW0ucGVla0J5dGUoKTsKICAgICAgICB3aGlsZSAoaXNXaGl0ZVNwYWNlKGNoKSkgewogICAgICAgICAgc3RyZWFtLnNraXAoKTsKICAgICAgICAgIGNoID0gc3RyZWFtLnBlZWtCeXRlKCk7CiAgICAgICAgfQogICAgICAgIGlmIChjaCA9PT0gR1QpIHsKICAgICAgICAgIHN0cmVhbS5za2lwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5wb3MgPiB0aWxkZVBvcykgewogICAgICAgICAgY29uc3QgbWF5YmVFSSA9IHN0cmVhbS5wZWVrQnl0ZXMoMik7CiAgICAgICAgICBpZiAobWF5YmVFSVswXSA9PT0gMHg0NSAmJiBtYXliZUVJWzFdID09PSAweDQ5KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3QgbGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwogICAgaWYgKGNoID09PSAtMSkgewogICAgICB3YXJuKCJJbmxpbmUgQVNDSUk4NURlY29kZSBpbWFnZSBzdHJlYW06ICIgKyAiRU9EIG1hcmtlciBub3QgZm91bmQsIHNlYXJjaGluZyBmb3IgL0VJLyBpbnN0ZWFkLiIpOwogICAgICBzdHJlYW0uc2tpcCgtbGVuZ3RoKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgIH0KICAgIHRoaXMuaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSk7CiAgICByZXR1cm4gbGVuZ3RoOwogIH0KICBmaW5kQVNDSUlIZXhEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBHVCA9IDB4M2U7CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChjaCA9PT0gR1QpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgY29uc3QgbGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwogICAgaWYgKGNoID09PSAtMSkgewogICAgICB3YXJuKCJJbmxpbmUgQVNDSUlIZXhEZWNvZGUgaW1hZ2Ugc3RyZWFtOiAiICsgIkVPRCBtYXJrZXIgbm90IGZvdW5kLCBzZWFyY2hpbmcgZm9yIC9FSS8gaW5zdGVhZC4iKTsKICAgICAgc3RyZWFtLnNraXAoLWxlbmd0aCk7CiAgICAgIHJldHVybiB0aGlzLmZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICB9CiAgICB0aGlzLmlubGluZVN0cmVhbVNraXBFSShzdHJlYW0pOwogICAgcmV0dXJuIGxlbmd0aDsKICB9CiAgaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSkgewogICAgY29uc3QgRSA9IDB4NDUsCiAgICAgIEkgPSAweDQ5OwogICAgbGV0IHN0YXRlID0gMCwKICAgICAgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChzdGF0ZSA9PT0gMCkgewogICAgICAgIHN0YXRlID0gY2ggPT09IEUgPyAxIDogMDsKICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gMSkgewogICAgICAgIHN0YXRlID0gY2ggPT09IEkgPyAyIDogMDsKICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gMikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIG1ha2VJbmxpbmVJbWFnZShjaXBoZXJUcmFuc2Zvcm0pIHsKICAgIGNvbnN0IGxleGVyID0gdGhpcy5sZXhlcjsKICAgIGNvbnN0IHN0cmVhbSA9IGxleGVyLnN0cmVhbTsKICAgIGNvbnN0IGRpY3RNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgbGV0IGRpY3RMZW5ndGg7CiAgICB3aGlsZSAoIWlzQ21kKHRoaXMuYnVmMSwgIklEIikgJiYgdGhpcy5idWYxICE9PSBFT0YpIHsKICAgICAgaWYgKCEodGhpcy5idWYxIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkRpY3Rpb25hcnkga2V5IG11c3QgYmUgYSBuYW1lIG9iamVjdCIpOwogICAgICB9CiAgICAgIGNvbnN0IGtleSA9IHRoaXMuYnVmMS5uYW1lOwogICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgIGlmICh0aGlzLmJ1ZjEgPT09IEVPRikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGRpY3RNYXBba2V5XSA9IHRoaXMuZ2V0T2JqKGNpcGhlclRyYW5zZm9ybSk7CiAgICB9CiAgICBpZiAobGV4ZXIuYmVnaW5JbmxpbmVJbWFnZVBvcyAhPT0gLTEpIHsKICAgICAgZGljdExlbmd0aCA9IHN0cmVhbS5wb3MgLSBsZXhlci5iZWdpbklubGluZUltYWdlUG9zOwogICAgfQogICAgY29uc3QgZmlsdGVyID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZGljdE1hcC5GIHx8IGRpY3RNYXAuRmlsdGVyKTsKICAgIGxldCBmaWx0ZXJOYW1lOwogICAgaWYgKGZpbHRlciBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgZmlsdGVyTmFtZSA9IGZpbHRlci5uYW1lOwogICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHsKICAgICAgY29uc3QgZmlsdGVyWmVybyA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZpbHRlclswXSk7CiAgICAgIGlmIChmaWx0ZXJaZXJvIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGZpbHRlck5hbWUgPSBmaWx0ZXJaZXJvLm5hbWU7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICAgIGxldCBsZW5ndGg7CiAgICBzd2l0Y2ggKGZpbHRlck5hbWUpIHsKICAgICAgY2FzZSAiRENUIjoKICAgICAgY2FzZSAiRENURGVjb2RlIjoKICAgICAgICBsZW5ndGggPSB0aGlzLmZpbmREQ1REZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiQTg1IjoKICAgICAgY2FzZSAiQVNDSUk4NURlY29kZSI6CiAgICAgICAgbGVuZ3RoID0gdGhpcy5maW5kQVNDSUk4NURlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJBSHgiOgogICAgICBjYXNlICJBU0NJSUhleERlY29kZSI6CiAgICAgICAgbGVuZ3RoID0gdGhpcy5maW5kQVNDSUlIZXhEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBsZW5ndGggPSB0aGlzLmZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICB9CiAgICBsZXQgY2FjaGVLZXk7CiAgICBpZiAobGVuZ3RoIDwgTUFYX0xFTkdUSF9UT19DQUNIRSAmJiBkaWN0TGVuZ3RoID4gMCkgewogICAgICBjb25zdCBpbml0aWFsU3RyZWFtUG9zID0gc3RyZWFtLnBvczsKICAgICAgc3RyZWFtLnBvcyA9IGxleGVyLmJlZ2luSW5saW5lSW1hZ2VQb3M7CiAgICAgIGNhY2hlS2V5ID0gZ2V0SW5saW5lSW1hZ2VDYWNoZUtleShzdHJlYW0uZ2V0Qnl0ZXMoZGljdExlbmd0aCArIGxlbmd0aCkpOwogICAgICBzdHJlYW0ucG9zID0gaW5pdGlhbFN0cmVhbVBvczsKICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IHRoaXMuaW1hZ2VDYWNoZVtjYWNoZUtleV07CiAgICAgIGlmIChjYWNoZUVudHJ5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLmJ1ZjIgPSBDbWQuZ2V0KCJFSSIpOwogICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICBjYWNoZUVudHJ5LnJlc2V0KCk7CiAgICAgICAgcmV0dXJuIGNhY2hlRW50cnk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgZm9yIChjb25zdCBrZXkgaW4gZGljdE1hcCkgewogICAgICBkaWN0LnNldChrZXksIGRpY3RNYXBba2V5XSk7CiAgICB9CiAgICBsZXQgaW1hZ2VTdHJlYW0gPSBzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydFBvcywgbGVuZ3RoLCBkaWN0KTsKICAgIGlmIChjaXBoZXJUcmFuc2Zvcm0pIHsKICAgICAgaW1hZ2VTdHJlYW0gPSBjaXBoZXJUcmFuc2Zvcm0uY3JlYXRlU3RyZWFtKGltYWdlU3RyZWFtLCBsZW5ndGgpOwogICAgfQogICAgaW1hZ2VTdHJlYW0gPSB0aGlzLmZpbHRlcihpbWFnZVN0cmVhbSwgZGljdCwgbGVuZ3RoKTsKICAgIGltYWdlU3RyZWFtLmRpY3QgPSBkaWN0OwogICAgaWYgKGNhY2hlS2V5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaW1hZ2VTdHJlYW0uY2FjaGVLZXkgPSBgaW5saW5lX2ltZ18keysrdGhpcy5faW1hZ2VJZH1gOwogICAgICB0aGlzLmltYWdlQ2FjaGVbY2FjaGVLZXldID0gaW1hZ2VTdHJlYW07CiAgICB9CiAgICB0aGlzLmJ1ZjIgPSBDbWQuZ2V0KCJFSSIpOwogICAgdGhpcy5zaGlmdCgpOwogICAgcmV0dXJuIGltYWdlU3RyZWFtOwogIH0KICAjZmluZFN0cmVhbUxlbmd0aChzdGFydFBvcykgewogICAgY29uc3QgewogICAgICBzdHJlYW0KICAgIH0gPSB0aGlzLmxleGVyOwogICAgc3RyZWFtLnBvcyA9IHN0YXJ0UG9zOwogICAgY29uc3QgU0NBTl9CTE9DS19MRU5HVEggPSAyMDQ4OwogICAgY29uc3Qgc2lnbmF0dXJlTGVuZ3RoID0gImVuZHN0cmVhbSIubGVuZ3RoOwogICAgY29uc3QgRU5EX1NJR05BVFVSRSA9IG5ldyBVaW50OEFycmF5KFsweDY1LCAweDZlLCAweDY0XSk7CiAgICBjb25zdCBlbmRMZW5ndGggPSBFTkRfU0lHTkFUVVJFLmxlbmd0aDsKICAgIGNvbnN0IFBBUlRJQUxfU0lHTkFUVVJFID0gW25ldyBVaW50OEFycmF5KFsweDczLCAweDc0LCAweDcyLCAweDY1LCAweDYxLCAweDZkXSksIG5ldyBVaW50OEFycmF5KFsweDczLCAweDc0LCAweDY1LCAweDYxLCAweDZkXSksIG5ldyBVaW50OEFycmF5KFsweDczLCAweDc0LCAweDcyLCAweDY1LCAweDYxXSldOwogICAgY29uc3Qgbm9ybWFsTGVuZ3RoID0gc2lnbmF0dXJlTGVuZ3RoIC0gZW5kTGVuZ3RoOwogICAgd2hpbGUgKHN0cmVhbS5wb3MgPCBzdHJlYW0uZW5kKSB7CiAgICAgIGNvbnN0IHNjYW5CeXRlcyA9IHN0cmVhbS5wZWVrQnl0ZXMoU0NBTl9CTE9DS19MRU5HVEgpOwogICAgICBjb25zdCBzY2FuTGVuZ3RoID0gc2NhbkJ5dGVzLmxlbmd0aCAtIHNpZ25hdHVyZUxlbmd0aDsKICAgICAgaWYgKHNjYW5MZW5ndGggPD0gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGxldCBwb3MgPSAwOwogICAgICB3aGlsZSAocG9zIDwgc2Nhbkxlbmd0aCkgewogICAgICAgIGxldCBqID0gMDsKICAgICAgICB3aGlsZSAoaiA8IGVuZExlbmd0aCAmJiBzY2FuQnl0ZXNbcG9zICsgal0gPT09IEVORF9TSUdOQVRVUkVbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgaWYgKGogPj0gZW5kTGVuZ3RoKSB7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBQQVJUSUFMX1NJR05BVFVSRSkgewogICAgICAgICAgICBjb25zdCBwYXJ0TGVuID0gcGFydC5sZW5ndGg7CiAgICAgICAgICAgIGxldCBrID0gMDsKICAgICAgICAgICAgd2hpbGUgKGsgPCBwYXJ0TGVuICYmIHNjYW5CeXRlc1twb3MgKyBqICsga10gPT09IHBhcnRba10pIHsKICAgICAgICAgICAgICBrKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGsgPj0gbm9ybWFsTGVuZ3RoKSB7CiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChrID49IHBhcnRMZW4pIHsKICAgICAgICAgICAgICBjb25zdCBsYXN0Qnl0ZSA9IHNjYW5CeXRlc1twb3MgKyBqICsga107CiAgICAgICAgICAgICAgaWYgKGlzV2hpdGVTcGFjZShsYXN0Qnl0ZSkpIHsKICAgICAgICAgICAgICAgIGluZm8oYEZvdW5kICIke2J5dGVzVG9TdHJpbmcoWy4uLkVORF9TSUdOQVRVUkUsIC4uLnBhcnRdKX0iIHdoZW4gYCArICJzZWFyY2hpbmcgZm9yIGVuZHN0cmVhbSBjb21tYW5kLiIpOwogICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGZvdW5kKSB7CiAgICAgICAgICAgIHN0cmVhbS5wb3MgKz0gcG9zOwogICAgICAgICAgICByZXR1cm4gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwb3MrKzsKICAgICAgfQogICAgICBzdHJlYW0ucG9zICs9IHNjYW5MZW5ndGg7CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIG1ha2VTdHJlYW0oZGljdCwgY2lwaGVyVHJhbnNmb3JtKSB7CiAgICBjb25zdCBsZXhlciA9IHRoaXMubGV4ZXI7CiAgICBsZXQgc3RyZWFtID0gbGV4ZXIuc3RyZWFtOwogICAgbGV4ZXIuc2tpcFRvTmV4dExpbmUoKTsKICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLnBvcyAtIDE7CiAgICBsZXQgbGVuZ3RoID0gZGljdC5nZXQoIkxlbmd0aCIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGxlbmd0aCkpIHsKICAgICAgaW5mbyhgQmFkIGxlbmd0aCAiJHtsZW5ndGggJiYgbGVuZ3RoLnRvU3RyaW5nKCl9IiBpbiBzdHJlYW0uYCk7CiAgICAgIGxlbmd0aCA9IDA7CiAgICB9CiAgICBzdHJlYW0ucG9zID0gc3RhcnRQb3MgKyBsZW5ndGg7CiAgICBsZXhlci5uZXh0Q2hhcigpOwogICAgaWYgKHRoaXMudHJ5U2hpZnQoKSAmJiBpc0NtZCh0aGlzLmJ1ZjIsICJlbmRzdHJlYW0iKSkgewogICAgICB0aGlzLnNoaWZ0KCk7CiAgICB9IGVsc2UgewogICAgICBsZW5ndGggPSB0aGlzLiNmaW5kU3RyZWFtTGVuZ3RoKHN0YXJ0UG9zKTsKICAgICAgaWYgKGxlbmd0aCA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk1pc3NpbmcgZW5kc3RyZWFtIGNvbW1hbmQuIik7CiAgICAgIH0KICAgICAgbGV4ZXIubmV4dENoYXIoKTsKICAgICAgdGhpcy5zaGlmdCgpOwogICAgICB0aGlzLnNoaWZ0KCk7CiAgICB9CiAgICB0aGlzLnNoaWZ0KCk7CiAgICBzdHJlYW0gPSBzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydFBvcywgbGVuZ3RoLCBkaWN0KTsKICAgIGlmIChjaXBoZXJUcmFuc2Zvcm0pIHsKICAgICAgc3RyZWFtID0gY2lwaGVyVHJhbnNmb3JtLmNyZWF0ZVN0cmVhbShzdHJlYW0sIGxlbmd0aCk7CiAgICB9CiAgICBzdHJlYW0gPSB0aGlzLmZpbHRlcihzdHJlYW0sIGRpY3QsIGxlbmd0aCk7CiAgICBzdHJlYW0uZGljdCA9IGRpY3Q7CiAgICByZXR1cm4gc3RyZWFtOwogIH0KICBmaWx0ZXIoc3RyZWFtLCBkaWN0LCBsZW5ndGgpIHsKICAgIGxldCBmaWx0ZXIgPSBkaWN0LmdldCgiRiIsICJGaWx0ZXIiKTsKICAgIGxldCBwYXJhbXMgPSBkaWN0LmdldCgiRFAiLCAiRGVjb2RlUGFybXMiKTsKICAgIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtcykpIHsKICAgICAgICB3YXJuKCIvRGVjb2RlUGFybXMgc2hvdWxkIG5vdCBiZSBhbiBBcnJheSwgd2hlbiAvRmlsdGVyIGlzIGEgTmFtZS4iKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5tYWtlRmlsdGVyKHN0cmVhbSwgZmlsdGVyLm5hbWUsIGxlbmd0aCwgcGFyYW1zKTsKICAgIH0KICAgIGxldCBtYXliZUxlbmd0aCA9IGxlbmd0aDsKICAgIGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHsKICAgICAgY29uc3QgZmlsdGVyQXJyYXkgPSBmaWx0ZXI7CiAgICAgIGNvbnN0IHBhcmFtc0FycmF5ID0gcGFyYW1zOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmaWx0ZXJBcnJheS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgZmlsdGVyID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZmlsdGVyQXJyYXlbaV0pOwogICAgICAgIGlmICghKGZpbHRlciBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEJhZCBmaWx0ZXIgbmFtZSAiJHtmaWx0ZXJ9ImApOwogICAgICAgIH0KICAgICAgICBwYXJhbXMgPSBudWxsOwogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtc0FycmF5KSAmJiBpIGluIHBhcmFtc0FycmF5KSB7CiAgICAgICAgICBwYXJhbXMgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihwYXJhbXNBcnJheVtpXSk7CiAgICAgICAgfQogICAgICAgIHN0cmVhbSA9IHRoaXMubWFrZUZpbHRlcihzdHJlYW0sIGZpbHRlci5uYW1lLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICBtYXliZUxlbmd0aCA9IG51bGw7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdHJlYW07CiAgfQogIG1ha2VGaWx0ZXIoc3RyZWFtLCBuYW1lLCBtYXliZUxlbmd0aCwgcGFyYW1zKSB7CiAgICBpZiAobWF5YmVMZW5ndGggPT09IDApIHsKICAgICAgd2FybihgRW1wdHkgIiR7bmFtZX0iIHN0cmVhbS5gKTsKICAgICAgcmV0dXJuIG5ldyBOdWxsU3RyZWFtKCk7CiAgICB9CiAgICB0cnkgewogICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICBjYXNlICJGbCI6CiAgICAgICAgY2FzZSAiRmxhdGVEZWNvZGUiOgogICAgICAgICAgaWYgKHBhcmFtcykgewogICAgICAgICAgICByZXR1cm4gbmV3IFByZWRpY3RvclN0cmVhbShuZXcgRmxhdGVTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCksIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBGbGF0ZVN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICBjYXNlICJMWlciOgogICAgICAgIGNhc2UgIkxaV0RlY29kZSI6CiAgICAgICAgICBsZXQgZWFybHlDaGFuZ2UgPSAxOwogICAgICAgICAgaWYgKHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhcygiRWFybHlDaGFuZ2UiKSkgewogICAgICAgICAgICAgIGVhcmx5Q2hhbmdlID0gcGFyYW1zLmdldCgiRWFybHlDaGFuZ2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IFByZWRpY3RvclN0cmVhbShuZXcgTFpXU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIGVhcmx5Q2hhbmdlKSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IExaV1N0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBlYXJseUNoYW5nZSk7CiAgICAgICAgY2FzZSAiRENUIjoKICAgICAgICBjYXNlICJEQ1REZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBKcGVnU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgY2FzZSAiSlBYIjoKICAgICAgICBjYXNlICJKUFhEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBKcHhTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICBjYXNlICJBODUiOgogICAgICAgIGNhc2UgIkFTQ0lJODVEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBBc2NpaTg1U3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpOwogICAgICAgIGNhc2UgIkFIeCI6CiAgICAgICAgY2FzZSAiQVNDSUlIZXhEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBBc2NpaUhleFN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICBjYXNlICJDQ0YiOgogICAgICAgIGNhc2UgIkNDSVRURmF4RGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgQ0NJVFRGYXhTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICBjYXNlICJSTCI6CiAgICAgICAgY2FzZSAiUnVuTGVuZ3RoRGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgUnVuTGVuZ3RoU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpOwogICAgICAgIGNhc2UgIkpCSUcyRGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgSmJpZzJTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgfQogICAgICB3YXJuKGBGaWx0ZXIgIiR7bmFtZX0iIGlzIG5vdCBzdXBwb3J0ZWQuYCk7CiAgICAgIHJldHVybiBzdHJlYW07CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oYEludmFsaWQgc3RyZWFtOiAiJHtleH0iYCk7CiAgICAgIHJldHVybiBuZXcgTnVsbFN0cmVhbSgpOwogICAgfQogIH0KfQpjb25zdCBzcGVjaWFsQ2hhcnMgPSBbMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMSwgMCwgMSwgMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMiwgMCwgMCwgMiwgMiwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07CmZ1bmN0aW9uIHRvSGV4RGlnaXQoY2gpIHsKICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5KSB7CiAgICByZXR1cm4gY2ggJiAweDBmOwogIH0KICBpZiAoY2ggPj0gMHg0MSAmJiBjaCA8PSAweDQ2IHx8IGNoID49IDB4NjEgJiYgY2ggPD0gMHg2NikgewogICAgcmV0dXJuIChjaCAmIDB4MGYpICsgOTsKICB9CiAgcmV0dXJuIC0xOwp9CmNsYXNzIExleGVyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGtub3duQ29tbWFuZHMgPSBudWxsKSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMubmV4dENoYXIoKTsKICAgIHRoaXMuc3RyQnVmID0gW107CiAgICB0aGlzLmtub3duQ29tbWFuZHMgPSBrbm93bkNvbW1hbmRzOwogICAgdGhpcy5faGV4U3RyaW5nTnVtV2FybiA9IDA7CiAgICB0aGlzLmJlZ2luSW5saW5lSW1hZ2VQb3MgPSAtMTsKICB9CiAgbmV4dENoYXIoKSB7CiAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2hhciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICB9CiAgcGVla0NoYXIoKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW0ucGVla0J5dGUoKTsKICB9CiAgZ2V0TnVtYmVyKCkgewogICAgbGV0IGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgIGxldCBlTm90YXRpb24gPSBmYWxzZTsKICAgIGxldCBkaXZpZGVCeSA9IDA7CiAgICBsZXQgc2lnbiA9IDE7CiAgICBpZiAoY2ggPT09IDB4MmQpIHsKICAgICAgc2lnbiA9IC0xOwogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgaWYgKGNoID09PSAweDJkKSB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MmIpIHsKICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgZG8gewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICB9IHdoaWxlIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCk7CiAgICB9CiAgICBpZiAoY2ggPT09IDB4MmUpIHsKICAgICAgZGl2aWRlQnkgPSAxMDsKICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBpZiAoY2ggPCAweDMwIHx8IGNoID4gMHgzOSkgewogICAgICBjb25zdCBtc2cgPSBgSW52YWxpZCBudW1iZXI6ICR7U3RyaW5nLmZyb21DaGFyQ29kZShjaCl9IChjaGFyQ29kZSAke2NofSlgOwogICAgICBpZiAoaXNXaGl0ZVNwYWNlKGNoKSB8fCBjaCA9PT0gMHgyOCB8fCBjaCA9PT0gMHgzYyB8fCBjaCA9PT0gLTEpIHsKICAgICAgICBpbmZvKGBMZXhlci5nZXROdW1iZXIgLSAiJHttc2d9Ii5gKTsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IobXNnKTsKICAgIH0KICAgIGxldCBiYXNlVmFsdWUgPSBjaCAtIDB4MzA7CiAgICBsZXQgcG93ZXJWYWx1ZSA9IDA7CiAgICBsZXQgcG93ZXJWYWx1ZVNpZ24gPSAxOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCkgewogICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5KSB7CiAgICAgICAgY29uc3QgY3VycmVudERpZ2l0ID0gY2ggLSAweDMwOwogICAgICAgIGlmIChlTm90YXRpb24pIHsKICAgICAgICAgIHBvd2VyVmFsdWUgPSBwb3dlclZhbHVlICogMTAgKyBjdXJyZW50RGlnaXQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChkaXZpZGVCeSAhPT0gMCkgewogICAgICAgICAgICBkaXZpZGVCeSAqPSAxMDsKICAgICAgICAgIH0KICAgICAgICAgIGJhc2VWYWx1ZSA9IGJhc2VWYWx1ZSAqIDEwICsgY3VycmVudERpZ2l0OwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyZSkgewogICAgICAgIGlmIChkaXZpZGVCeSA9PT0gMCkgewogICAgICAgICAgZGl2aWRlQnkgPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MmQpIHsKICAgICAgICB3YXJuKCJCYWRseSBmb3JtYXR0ZWQgbnVtYmVyOiBtaW51cyBzaWduIGluIHRoZSBtaWRkbGUiKTsKICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHg0NSB8fCBjaCA9PT0gMHg2NSkgewogICAgICAgIGNoID0gdGhpcy5wZWVrQ2hhcigpOwogICAgICAgIGlmIChjaCA9PT0gMHgyYiB8fCBjaCA9PT0gMHgyZCkgewogICAgICAgICAgcG93ZXJWYWx1ZVNpZ24gPSBjaCA9PT0gMHgyZCA/IC0xIDogMTsKICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICB9IGVsc2UgaWYgKGNoIDwgMHgzMCB8fCBjaCA+IDB4MzkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBlTm90YXRpb24gPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAoZGl2aWRlQnkgIT09IDApIHsKICAgICAgYmFzZVZhbHVlIC89IGRpdmlkZUJ5OwogICAgfQogICAgaWYgKGVOb3RhdGlvbikgewogICAgICBiYXNlVmFsdWUgKj0gMTAgKiogKHBvd2VyVmFsdWVTaWduICogcG93ZXJWYWx1ZSk7CiAgICB9CiAgICByZXR1cm4gc2lnbiAqIGJhc2VWYWx1ZTsKICB9CiAgZ2V0U3RyaW5nKCkgewogICAgbGV0IG51bVBhcmVuID0gMTsKICAgIGxldCBkb25lID0gZmFsc2U7CiAgICBjb25zdCBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgbGV0IGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbGV0IGNoYXJCdWZmZXJlZCA9IGZhbHNlOwogICAgICBzd2l0Y2ggKGNoIHwgMCkgewogICAgICAgIGNhc2UgLTE6CiAgICAgICAgICB3YXJuKCJVbnRlcm1pbmF0ZWQgc3RyaW5nIik7CiAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHgyODoKICAgICAgICAgICsrbnVtUGFyZW47CiAgICAgICAgICBzdHJCdWYucHVzaCgiKCIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDI5OgogICAgICAgICAgaWYgKC0tbnVtUGFyZW4gPT09IDApIHsKICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIpIik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4NWM6CiAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIHN3aXRjaCAoY2gpIHsKICAgICAgICAgICAgY2FzZSAtMToKICAgICAgICAgICAgICB3YXJuKCJVbnRlcm1pbmF0ZWQgc3RyaW5nIik7CiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHg2ZToKICAgICAgICAgICAgICBzdHJCdWYucHVzaCgiXG4iKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDcyOgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcciIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4NzQ6CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIlx0Iik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHg2MjoKICAgICAgICAgICAgICBzdHJCdWYucHVzaCgiXGIiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDY2OgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcZiIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4NWM6CiAgICAgICAgICAgIGNhc2UgMHgyODoKICAgICAgICAgICAgY2FzZSAweDI5OgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDMwOgogICAgICAgICAgICBjYXNlIDB4MzE6CiAgICAgICAgICAgIGNhc2UgMHgzMjoKICAgICAgICAgICAgY2FzZSAweDMzOgogICAgICAgICAgICBjYXNlIDB4MzQ6CiAgICAgICAgICAgIGNhc2UgMHgzNToKICAgICAgICAgICAgY2FzZSAweDM2OgogICAgICAgICAgICBjYXNlIDB4Mzc6CiAgICAgICAgICAgICAgbGV0IHggPSBjaCAmIDB4MGY7CiAgICAgICAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgY2hhckJ1ZmZlcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM3KSB7CiAgICAgICAgICAgICAgICB4ID0gKHggPDwgMykgKyAoY2ggJiAweDBmKTsKICAgICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgICAgaWYgKGNoID49IDB4MzAgJiYgY2ggPD0gMHgzNykgewogICAgICAgICAgICAgICAgICBjaGFyQnVmZmVyZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgeCA9ICh4IDw8IDMpICsgKGNoICYgMHgwZik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoeCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MGQ6CiAgICAgICAgICAgICAgaWYgKHRoaXMucGVla0NoYXIoKSA9PT0gMHgwYSkgewogICAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDBhOgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoZG9uZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmICghY2hhckJ1ZmZlcmVkKSB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdHJCdWYuam9pbigiIik7CiAgfQogIGdldE5hbWUoKSB7CiAgICBsZXQgY2gsIHByZXZpb3VzQ2g7CiAgICBjb25zdCBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCAmJiAhc3BlY2lhbENoYXJzW2NoXSkgewogICAgICBpZiAoY2ggPT09IDB4MjMpIHsKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICBpZiAoc3BlY2lhbENoYXJzW2NoXSkgewogICAgICAgICAgd2FybigiTGV4ZXJfZ2V0TmFtZTogIiArICJOVU1CRVIgU0lHTiAoIykgc2hvdWxkIGJlIGZvbGxvd2VkIGJ5IGEgaGV4YWRlY2ltYWwgbnVtYmVyLiIpOwogICAgICAgICAgc3RyQnVmLnB1c2goIiMiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb25zdCB4ID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgaWYgKHggIT09IC0xKSB7CiAgICAgICAgICBwcmV2aW91c0NoID0gY2g7CiAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIGNvbnN0IHgyID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgICBpZiAoeDIgPT09IC0xKSB7CiAgICAgICAgICAgIHdhcm4oYExleGVyX2dldE5hbWU6IElsbGVnYWwgZGlnaXQgKCR7U3RyaW5nLmZyb21DaGFyQ29kZShjaCl9KSBgICsgImluIGhleGFkZWNpbWFsIG51bWJlci4iKTsKICAgICAgICAgICAgc3RyQnVmLnB1c2goIiMiLCBTdHJpbmcuZnJvbUNoYXJDb2RlKHByZXZpb3VzQ2gpKTsKICAgICAgICAgICAgaWYgKHNwZWNpYWxDaGFyc1tjaF0pIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSh4IDw8IDQgfCB4MikpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJCdWYucHVzaCgiIyIsIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICB9CiAgICB9CiAgICBpZiAoc3RyQnVmLmxlbmd0aCA+IDEyNykgewogICAgICB3YXJuKGBOYW1lIHRva2VuIGlzIGxvbmdlciB0aGFuIGFsbG93ZWQgYnkgdGhlIHNwZWM6ICR7c3RyQnVmLmxlbmd0aH1gKTsKICAgIH0KICAgIHJldHVybiBOYW1lLmdldChzdHJCdWYuam9pbigiIikpOwogIH0KICBfaGV4U3RyaW5nV2FybihjaCkgewogICAgY29uc3QgTUFYX0hFWF9TVFJJTkdfTlVNX1dBUk4gPSA1OwogICAgaWYgKHRoaXMuX2hleFN0cmluZ051bVdhcm4rKyA9PT0gTUFYX0hFWF9TVFJJTkdfTlVNX1dBUk4pIHsKICAgICAgd2FybigiZ2V0SGV4U3RyaW5nIC0gaWdub3JpbmcgYWRkaXRpb25hbCBpbnZhbGlkIGNoYXJhY3RlcnMuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9oZXhTdHJpbmdOdW1XYXJuID4gTUFYX0hFWF9TVFJJTkdfTlVNX1dBUk4pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgd2FybihgZ2V0SGV4U3RyaW5nIC0gaWdub3JpbmcgaW52YWxpZCBjaGFyYWN0ZXI6ICR7Y2h9YCk7CiAgfQogIGdldEhleFN0cmluZygpIHsKICAgIGNvbnN0IHN0ckJ1ZiA9IHRoaXMuc3RyQnVmOwogICAgc3RyQnVmLmxlbmd0aCA9IDA7CiAgICBsZXQgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgbGV0IGZpcnN0RGlnaXQgPSAtMSwKICAgICAgZGlnaXQgPSAtMTsKICAgIHRoaXMuX2hleFN0cmluZ051bVdhcm4gPSAwOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKGNoIDwgMCkgewogICAgICAgIHdhcm4oIlVudGVybWluYXRlZCBoZXggc3RyaW5nIik7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4M2UpIHsKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoc3BlY2lhbENoYXJzW2NoXSA9PT0gMSkgewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGRpZ2l0ID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgaWYgKGRpZ2l0ID09PSAtMSkgewogICAgICAgICAgdGhpcy5faGV4U3RyaW5nV2FybihjaCk7CiAgICAgICAgfSBlbHNlIGlmIChmaXJzdERpZ2l0ID09PSAtMSkgewogICAgICAgICAgZmlyc3REaWdpdCA9IGRpZ2l0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGZpcnN0RGlnaXQgPDwgNCB8IGRpZ2l0KSk7CiAgICAgICAgICBmaXJzdERpZ2l0ID0gLTE7CiAgICAgICAgfQogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICB9CiAgICB9CiAgICBpZiAoZmlyc3REaWdpdCAhPT0gLTEpIHsKICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShmaXJzdERpZ2l0IDw8IDQpKTsKICAgIH0KICAgIHJldHVybiBzdHJCdWYuam9pbigiIik7CiAgfQogIGdldE9iaigpIHsKICAgIGxldCBjb21tZW50ID0gZmFsc2U7CiAgICBsZXQgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKGNoIDwgMCkgewogICAgICAgIHJldHVybiBFT0Y7CiAgICAgIH0KICAgICAgaWYgKGNvbW1lbnQpIHsKICAgICAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgICAgIGNvbW1lbnQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MjUpIHsKICAgICAgICBjb21tZW50ID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChzcGVjaWFsQ2hhcnNbY2hdICE9PSAxKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBzd2l0Y2ggKGNoIHwgMCkgewogICAgICBjYXNlIDB4MzA6CiAgICAgIGNhc2UgMHgzMToKICAgICAgY2FzZSAweDMyOgogICAgICBjYXNlIDB4MzM6CiAgICAgIGNhc2UgMHgzNDoKICAgICAgY2FzZSAweDM1OgogICAgICBjYXNlIDB4MzY6CiAgICAgIGNhc2UgMHgzNzoKICAgICAgY2FzZSAweDM4OgogICAgICBjYXNlIDB4Mzk6CiAgICAgIGNhc2UgMHgyYjoKICAgICAgY2FzZSAweDJkOgogICAgICBjYXNlIDB4MmU6CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TnVtYmVyKCk7CiAgICAgIGNhc2UgMHgyODoKICAgICAgICByZXR1cm4gdGhpcy5nZXRTdHJpbmcoKTsKICAgICAgY2FzZSAweDJmOgogICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKTsKICAgICAgY2FzZSAweDViOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gQ21kLmdldCgiWyIpOwogICAgICBjYXNlIDB4NWQ6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBDbWQuZ2V0KCJdIik7CiAgICAgIGNhc2UgMHgzYzoKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICBpZiAoY2ggPT09IDB4M2MpIHsKICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIHJldHVybiBDbWQuZ2V0KCI8PCIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5nZXRIZXhTdHJpbmcoKTsKICAgICAgY2FzZSAweDNlOgogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGlmIChjaCA9PT0gMHgzZSkgewogICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgcmV0dXJuIENtZC5nZXQoIj4+Iik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBDbWQuZ2V0KCI+Iik7CiAgICAgIGNhc2UgMHg3YjoKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgcmV0dXJuIENtZC5nZXQoInsiKTsKICAgICAgY2FzZSAweDdkOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gQ21kLmdldCgifSIpOwogICAgICBjYXNlIDB4Mjk6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSWxsZWdhbCBjaGFyYWN0ZXI6ICR7Y2h9YCk7CiAgICB9CiAgICBsZXQgc3RyID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICBpZiAoY2ggPCAweDIwIHx8IGNoID4gMHg3ZikgewogICAgICBjb25zdCBuZXh0Q2ggPSB0aGlzLnBlZWtDaGFyKCk7CiAgICAgIGlmIChuZXh0Q2ggPj0gMHgyMCAmJiBuZXh0Q2ggPD0gMHg3ZikgewogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gQ21kLmdldChzdHIpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBrbm93bkNvbW1hbmRzID0gdGhpcy5rbm93bkNvbW1hbmRzOwogICAgbGV0IGtub3duQ29tbWFuZEZvdW5kID0ga25vd25Db21tYW5kcz8uW3N0cl0gIT09IHVuZGVmaW5lZDsKICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDAgJiYgIXNwZWNpYWxDaGFyc1tjaF0pIHsKICAgICAgY29uc3QgcG9zc2libGVDb21tYW5kID0gc3RyICsgU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICAgIGlmIChrbm93bkNvbW1hbmRGb3VuZCAmJiBrbm93bkNvbW1hbmRzW3Bvc3NpYmxlQ29tbWFuZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChzdHIubGVuZ3RoID09PSAxMjgpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYENvbW1hbmQgdG9rZW4gdG9vIGxvbmc6ICR7c3RyLmxlbmd0aH1gKTsKICAgICAgfQogICAgICBzdHIgPSBwb3NzaWJsZUNvbW1hbmQ7CiAgICAgIGtub3duQ29tbWFuZEZvdW5kID0ga25vd25Db21tYW5kcz8uW3N0cl0gIT09IHVuZGVmaW5lZDsKICAgIH0KICAgIGlmIChzdHIgPT09ICJ0cnVlIikgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChzdHIgPT09ICJmYWxzZSIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHN0ciA9PT0gIm51bGwiKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKHN0ciA9PT0gIkJJIikgewogICAgICB0aGlzLmJlZ2luSW5saW5lSW1hZ2VQb3MgPSB0aGlzLnN0cmVhbS5wb3M7CiAgICB9CiAgICByZXR1cm4gQ21kLmdldChzdHIpOwogIH0KICBza2lwVG9OZXh0TGluZSgpIHsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICB3aGlsZSAoY2ggPj0gMCkgewogICAgICBpZiAoY2ggPT09IDB4MGQpIHsKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICBpZiAoY2ggPT09IDB4MGEpIHsKICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MGEpIHsKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgfQp9CmNsYXNzIExpbmVhcml6YXRpb24gewogIHN0YXRpYyBjcmVhdGUoc3RyZWFtKSB7CiAgICBmdW5jdGlvbiBnZXRJbnQobGluRGljdCwgbmFtZSwgYWxsb3daZXJvVmFsdWUgPSBmYWxzZSkgewogICAgICBjb25zdCBvYmogPSBsaW5EaWN0LmdldChuYW1lKTsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSAmJiAoYWxsb3daZXJvVmFsdWUgPyBvYmogPj0gMCA6IG9iaiA+IDApKSB7CiAgICAgICAgcmV0dXJuIG9iajsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAiJHtuYW1lfSIgcGFyYW1ldGVyIGluIHRoZSBsaW5lYXJpemF0aW9uIGAgKyAiZGljdGlvbmFyeSBpcyBpbnZhbGlkLiIpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0SGludHMobGluRGljdCkgewogICAgICBjb25zdCBoaW50cyA9IGxpbkRpY3QuZ2V0KCJIIik7CiAgICAgIGxldCBoaW50c0xlbmd0aDsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaGludHMpICYmICgoaGludHNMZW5ndGggPSBoaW50cy5sZW5ndGgpID09PSAyIHx8IGhpbnRzTGVuZ3RoID09PSA0KSkgewogICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBoaW50c0xlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgY29uc3QgaGludCA9IGhpbnRzW2luZGV4XTsKICAgICAgICAgIGlmICghKE51bWJlci5pc0ludGVnZXIoaGludCkgJiYgaGludCA+IDApKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSGludCAoJHtpbmRleH0pIGluIHRoZSBsaW5lYXJpemF0aW9uIGRpY3Rpb25hcnkgaXMgaW52YWxpZC5gKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhpbnRzOwogICAgICB9CiAgICAgIHRocm93IG5ldyBFcnJvcigiSGludCBhcnJheSBpbiB0aGUgbGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGlzIGludmFsaWQuIik7CiAgICB9CiAgICBjb25zdCBwYXJzZXIgPSBuZXcgUGFyc2VyKHsKICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0pLAogICAgICB4cmVmOiBudWxsCiAgICB9KTsKICAgIGNvbnN0IG9iajEgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBjb25zdCBvYmoyID0gcGFyc2VyLmdldE9iaigpOwogICAgY29uc3Qgb2JqMyA9IHBhcnNlci5nZXRPYmooKTsKICAgIGNvbnN0IGxpbkRpY3QgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBsZXQgb2JqLCBsZW5ndGg7CiAgICBpZiAoIShOdW1iZXIuaXNJbnRlZ2VyKG9iajEpICYmIE51bWJlci5pc0ludGVnZXIob2JqMikgJiYgaXNDbWQob2JqMywgIm9iaiIpICYmIGxpbkRpY3QgaW5zdGFuY2VvZiBEaWN0ICYmIHR5cGVvZiAob2JqID0gbGluRGljdC5nZXQoIkxpbmVhcml6ZWQiKSkgPT09ICJudW1iZXIiICYmIG9iaiA+IDApKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSBlbHNlIGlmICgobGVuZ3RoID0gZ2V0SW50KGxpbkRpY3QsICJMIikpICE9PSBzdHJlYW0ubGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlICJMIiBwYXJhbWV0ZXIgaW4gdGhlIGxpbmVhcml6YXRpb24gZGljdGlvbmFyeSAnICsgImRvZXMgbm90IGVxdWFsIHRoZSBzdHJlYW0gbGVuZ3RoLiIpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgbGVuZ3RoLAogICAgICBoaW50czogZ2V0SGludHMobGluRGljdCksCiAgICAgIG9iamVjdE51bWJlckZpcnN0OiBnZXRJbnQobGluRGljdCwgIk8iKSwKICAgICAgZW5kRmlyc3Q6IGdldEludChsaW5EaWN0LCAiRSIpLAogICAgICBudW1QYWdlczogZ2V0SW50KGxpbkRpY3QsICJOIiksCiAgICAgIG1haW5YUmVmRW50cmllc09mZnNldDogZ2V0SW50KGxpbkRpY3QsICJUIiksCiAgICAgIHBhZ2VGaXJzdDogbGluRGljdC5oYXMoIlAiKSA/IGdldEludChsaW5EaWN0LCAiUCIsIHRydWUpIDogMAogICAgfTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NtYXAuanMKCgoKCgoKCmNvbnN0IEJVSUxUX0lOX0NNQVBTID0gWyJBZG9iZS1HQjEtVUNTMiIsICJBZG9iZS1DTlMxLVVDUzIiLCAiQWRvYmUtSmFwYW4xLVVDUzIiLCAiQWRvYmUtS29yZWExLVVDUzIiLCAiNzgtRVVDLUgiLCAiNzgtRVVDLVYiLCAiNzgtSCIsICI3OC1SS1NKLUgiLCAiNzgtUktTSi1WIiwgIjc4LVYiLCAiNzhtcy1SS1NKLUgiLCAiNzhtcy1SS1NKLVYiLCAiODNwdi1SS1NKLUgiLCAiOTBtcy1SS1NKLUgiLCAiOTBtcy1SS1NKLVYiLCAiOTBtc3AtUktTSi1IIiwgIjkwbXNwLVJLU0otViIsICI5MHB2LVJLU0otSCIsICI5MHB2LVJLU0otViIsICJBZGQtSCIsICJBZGQtUktTSi1IIiwgIkFkZC1SS1NKLVYiLCAiQWRkLVYiLCAiQWRvYmUtQ05TMS0wIiwgIkFkb2JlLUNOUzEtMSIsICJBZG9iZS1DTlMxLTIiLCAiQWRvYmUtQ05TMS0zIiwgIkFkb2JlLUNOUzEtNCIsICJBZG9iZS1DTlMxLTUiLCAiQWRvYmUtQ05TMS02IiwgIkFkb2JlLUdCMS0wIiwgIkFkb2JlLUdCMS0xIiwgIkFkb2JlLUdCMS0yIiwgIkFkb2JlLUdCMS0zIiwgIkFkb2JlLUdCMS00IiwgIkFkb2JlLUdCMS01IiwgIkFkb2JlLUphcGFuMS0wIiwgIkFkb2JlLUphcGFuMS0xIiwgIkFkb2JlLUphcGFuMS0yIiwgIkFkb2JlLUphcGFuMS0zIiwgIkFkb2JlLUphcGFuMS00IiwgIkFkb2JlLUphcGFuMS01IiwgIkFkb2JlLUphcGFuMS02IiwgIkFkb2JlLUtvcmVhMS0wIiwgIkFkb2JlLUtvcmVhMS0xIiwgIkFkb2JlLUtvcmVhMS0yIiwgIkI1LUgiLCAiQjUtViIsICJCNXBjLUgiLCAiQjVwYy1WIiwgIkNOUy1FVUMtSCIsICJDTlMtRVVDLVYiLCAiQ05TMS1IIiwgIkNOUzEtViIsICJDTlMyLUgiLCAiQ05TMi1WIiwgIkVUSEstQjUtSCIsICJFVEhLLUI1LVYiLCAiRVRlbi1CNS1IIiwgIkVUZW4tQjUtViIsICJFVGVubXMtQjUtSCIsICJFVGVubXMtQjUtViIsICJFVUMtSCIsICJFVUMtViIsICJFeHQtSCIsICJFeHQtUktTSi1IIiwgIkV4dC1SS1NKLVYiLCAiRXh0LVYiLCAiR0ItRVVDLUgiLCAiR0ItRVVDLVYiLCAiR0ItSCIsICJHQi1WIiwgIkdCSy1FVUMtSCIsICJHQkstRVVDLVYiLCAiR0JLMkstSCIsICJHQksySy1WIiwgIkdCS3AtRVVDLUgiLCAiR0JLcC1FVUMtViIsICJHQlQtRVVDLUgiLCAiR0JULUVVQy1WIiwgIkdCVC1IIiwgIkdCVC1WIiwgIkdCVHBjLUVVQy1IIiwgIkdCVHBjLUVVQy1WIiwgIkdCcGMtRVVDLUgiLCAiR0JwYy1FVUMtViIsICJIIiwgIkhLZGxhLUI1LUgiLCAiSEtkbGEtQjUtViIsICJIS2RsYi1CNS1IIiwgIkhLZGxiLUI1LVYiLCAiSEtnY2NzLUI1LUgiLCAiSEtnY2NzLUI1LVYiLCAiSEttMzE0LUI1LUgiLCAiSEttMzE0LUI1LVYiLCAiSEttNDcxLUI1LUgiLCAiSEttNDcxLUI1LVYiLCAiSEtzY3MtQjUtSCIsICJIS3Njcy1CNS1WIiwgIkhhbmtha3UiLCAiSGlyYWdhbmEiLCAiS1NDLUVVQy1IIiwgIktTQy1FVUMtViIsICJLU0MtSCIsICJLU0MtSm9oYWItSCIsICJLU0MtSm9oYWItViIsICJLU0MtViIsICJLU0Ntcy1VSEMtSCIsICJLU0Ntcy1VSEMtSFctSCIsICJLU0Ntcy1VSEMtSFctViIsICJLU0Ntcy1VSEMtViIsICJLU0NwYy1FVUMtSCIsICJLU0NwYy1FVUMtViIsICJLYXRha2FuYSIsICJOV1AtSCIsICJOV1AtViIsICJSS1NKLUgiLCAiUktTSi1WIiwgIlJvbWFuIiwgIlVuaUNOUy1VQ1MyLUgiLCAiVW5pQ05TLVVDUzItViIsICJVbmlDTlMtVVRGMTYtSCIsICJVbmlDTlMtVVRGMTYtViIsICJVbmlDTlMtVVRGMzItSCIsICJVbmlDTlMtVVRGMzItViIsICJVbmlDTlMtVVRGOC1IIiwgIlVuaUNOUy1VVEY4LVYiLCAiVW5pR0ItVUNTMi1IIiwgIlVuaUdCLVVDUzItViIsICJVbmlHQi1VVEYxNi1IIiwgIlVuaUdCLVVURjE2LVYiLCAiVW5pR0ItVVRGMzItSCIsICJVbmlHQi1VVEYzMi1WIiwgIlVuaUdCLVVURjgtSCIsICJVbmlHQi1VVEY4LVYiLCAiVW5pSklTLVVDUzItSCIsICJVbmlKSVMtVUNTMi1IVy1IIiwgIlVuaUpJUy1VQ1MyLUhXLVYiLCAiVW5pSklTLVVDUzItViIsICJVbmlKSVMtVVRGMTYtSCIsICJVbmlKSVMtVVRGMTYtViIsICJVbmlKSVMtVVRGMzItSCIsICJVbmlKSVMtVVRGMzItViIsICJVbmlKSVMtVVRGOC1IIiwgIlVuaUpJUy1VVEY4LVYiLCAiVW5pSklTMjAwNC1VVEYxNi1IIiwgIlVuaUpJUzIwMDQtVVRGMTYtViIsICJVbmlKSVMyMDA0LVVURjMyLUgiLCAiVW5pSklTMjAwNC1VVEYzMi1WIiwgIlVuaUpJUzIwMDQtVVRGOC1IIiwgIlVuaUpJUzIwMDQtVVRGOC1WIiwgIlVuaUpJU1Byby1VQ1MyLUhXLVYiLCAiVW5pSklTUHJvLVVDUzItViIsICJVbmlKSVNQcm8tVVRGOC1WIiwgIlVuaUpJU1gwMjEzLVVURjMyLUgiLCAiVW5pSklTWDAyMTMtVVRGMzItViIsICJVbmlKSVNYMDIxMzIwMDQtVVRGMzItSCIsICJVbmlKSVNYMDIxMzIwMDQtVVRGMzItViIsICJVbmlLUy1VQ1MyLUgiLCAiVW5pS1MtVUNTMi1WIiwgIlVuaUtTLVVURjE2LUgiLCAiVW5pS1MtVVRGMTYtViIsICJVbmlLUy1VVEYzMi1IIiwgIlVuaUtTLVVURjMyLVYiLCAiVW5pS1MtVVRGOC1IIiwgIlVuaUtTLVVURjgtViIsICJWIiwgIldQLVN5bWJvbCJdOwpjb25zdCBNQVhfTUFQX1JBTkdFID0gMiAqKiAyNCAtIDE7CmNsYXNzIENNYXAgewogIGNvbnN0cnVjdG9yKGJ1aWx0SW5DTWFwID0gZmFsc2UpIHsKICAgIHRoaXMuY29kZXNwYWNlUmFuZ2VzID0gW1tdLCBbXSwgW10sIFtdXTsKICAgIHRoaXMubnVtQ29kZXNwYWNlUmFuZ2VzID0gMDsKICAgIHRoaXMuX21hcCA9IFtdOwogICAgdGhpcy5uYW1lID0gIiI7CiAgICB0aGlzLnZlcnRpY2FsID0gZmFsc2U7CiAgICB0aGlzLnVzZUNNYXAgPSBudWxsOwogICAgdGhpcy5idWlsdEluQ01hcCA9IGJ1aWx0SW5DTWFwOwogIH0KICBhZGRDb2Rlc3BhY2VSYW5nZShuLCBsb3csIGhpZ2gpIHsKICAgIHRoaXMuY29kZXNwYWNlUmFuZ2VzW24gLSAxXS5wdXNoKGxvdywgaGlnaCk7CiAgICB0aGlzLm51bUNvZGVzcGFjZVJhbmdlcysrOwogIH0KICBtYXBDaWRSYW5nZShsb3csIGhpZ2gsIGRzdExvdykgewogICAgaWYgKGhpZ2ggLSBsb3cgPiBNQVhfTUFQX1JBTkdFKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigibWFwQ2lkUmFuZ2UgLSBpZ25vcmluZyBkYXRhIGFib3ZlIE1BWF9NQVBfUkFOR0UuIik7CiAgICB9CiAgICB3aGlsZSAobG93IDw9IGhpZ2gpIHsKICAgICAgdGhpcy5fbWFwW2xvdysrXSA9IGRzdExvdysrOwogICAgfQogIH0KICBtYXBCZlJhbmdlKGxvdywgaGlnaCwgZHN0TG93KSB7CiAgICBpZiAoaGlnaCAtIGxvdyA+IE1BWF9NQVBfUkFOR0UpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJtYXBCZlJhbmdlIC0gaWdub3JpbmcgZGF0YSBhYm92ZSBNQVhfTUFQX1JBTkdFLiIpOwogICAgfQogICAgY29uc3QgbGFzdEJ5dGUgPSBkc3RMb3cubGVuZ3RoIC0gMTsKICAgIHdoaWxlIChsb3cgPD0gaGlnaCkgewogICAgICB0aGlzLl9tYXBbbG93KytdID0gZHN0TG93OwogICAgICBjb25zdCBuZXh0Q2hhckNvZGUgPSBkc3RMb3cuY2hhckNvZGVBdChsYXN0Qnl0ZSkgKyAxOwogICAgICBpZiAobmV4dENoYXJDb2RlID4gMHhmZikgewogICAgICAgIGRzdExvdyA9IGRzdExvdy5zdWJzdHJpbmcoMCwgbGFzdEJ5dGUgLSAxKSArIFN0cmluZy5mcm9tQ2hhckNvZGUoZHN0TG93LmNoYXJDb2RlQXQobGFzdEJ5dGUgLSAxKSArIDEpICsgIlx4MDAiOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGRzdExvdyA9IGRzdExvdy5zdWJzdHJpbmcoMCwgbGFzdEJ5dGUpICsgU3RyaW5nLmZyb21DaGFyQ29kZShuZXh0Q2hhckNvZGUpOwogICAgfQogIH0KICBtYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KSB7CiAgICBpZiAoaGlnaCAtIGxvdyA+IE1BWF9NQVBfUkFOR0UpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJtYXBCZlJhbmdlVG9BcnJheSAtIGlnbm9yaW5nIGRhdGEgYWJvdmUgTUFYX01BUF9SQU5HRS4iKTsKICAgIH0KICAgIGNvbnN0IGlpID0gYXJyYXkubGVuZ3RoOwogICAgbGV0IGkgPSAwOwogICAgd2hpbGUgKGxvdyA8PSBoaWdoICYmIGkgPCBpaSkgewogICAgICB0aGlzLl9tYXBbbG93XSA9IGFycmF5W2krK107CiAgICAgICsrbG93OwogICAgfQogIH0KICBtYXBPbmUoc3JjLCBkc3QpIHsKICAgIHRoaXMuX21hcFtzcmNdID0gZHN0OwogIH0KICBsb29rdXAoY29kZSkgewogICAgcmV0dXJuIHRoaXMuX21hcFtjb2RlXTsKICB9CiAgY29udGFpbnMoY29kZSkgewogICAgcmV0dXJuIHRoaXMuX21hcFtjb2RlXSAhPT0gdW5kZWZpbmVkOwogIH0KICBmb3JFYWNoKGNhbGxiYWNrKSB7CiAgICBjb25zdCBtYXAgPSB0aGlzLl9tYXA7CiAgICBjb25zdCBsZW5ndGggPSBtYXAubGVuZ3RoOwogICAgaWYgKGxlbmd0aCA8PSAweDEwMDAwKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobWFwW2ldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNhbGxiYWNrKGksIG1hcFtpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGkgaW4gbWFwKSB7CiAgICAgICAgY2FsbGJhY2soaSwgbWFwW2ldKTsKICAgICAgfQogICAgfQogIH0KICBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICBjb25zdCBtYXAgPSB0aGlzLl9tYXA7CiAgICBpZiAobWFwLmxlbmd0aCA8PSAweDEwMDAwKSB7CiAgICAgIHJldHVybiBtYXAuaW5kZXhPZih2YWx1ZSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIG1hcCkgewogICAgICBpZiAobWFwW2NoYXJDb2RlXSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gY2hhckNvZGUgfCAwOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIGdldE1hcCgpIHsKICAgIHJldHVybiB0aGlzLl9tYXA7CiAgfQogIHJlYWRDaGFyQ29kZShzdHIsIG9mZnNldCwgb3V0KSB7CiAgICBsZXQgYyA9IDA7CiAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZXMgPSB0aGlzLmNvZGVzcGFjZVJhbmdlczsKICAgIGZvciAobGV0IG4gPSAwLCBubiA9IGNvZGVzcGFjZVJhbmdlcy5sZW5ndGg7IG4gPCBubjsgbisrKSB7CiAgICAgIGMgPSAoYyA8PCA4IHwgc3RyLmNoYXJDb2RlQXQob2Zmc2V0ICsgbikpID4+PiAwOwogICAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZSA9IGNvZGVzcGFjZVJhbmdlc1tuXTsKICAgICAgZm9yIChsZXQgayA9IDAsIGtrID0gY29kZXNwYWNlUmFuZ2UubGVuZ3RoOyBrIDwga2s7KSB7CiAgICAgICAgY29uc3QgbG93ID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBjb25zdCBoaWdoID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBpZiAoYyA+PSBsb3cgJiYgYyA8PSBoaWdoKSB7CiAgICAgICAgICBvdXQuY2hhcmNvZGUgPSBjOwogICAgICAgICAgb3V0Lmxlbmd0aCA9IG4gKyAxOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgb3V0LmNoYXJjb2RlID0gMDsKICAgIG91dC5sZW5ndGggPSAxOwogIH0KICBnZXRDaGFyQ29kZUxlbmd0aChjaGFyQ29kZSkgewogICAgY29uc3QgY29kZXNwYWNlUmFuZ2VzID0gdGhpcy5jb2Rlc3BhY2VSYW5nZXM7CiAgICBmb3IgKGxldCBuID0gMCwgbm4gPSBjb2Rlc3BhY2VSYW5nZXMubGVuZ3RoOyBuIDwgbm47IG4rKykgewogICAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZSA9IGNvZGVzcGFjZVJhbmdlc1tuXTsKICAgICAgZm9yIChsZXQgayA9IDAsIGtrID0gY29kZXNwYWNlUmFuZ2UubGVuZ3RoOyBrIDwga2s7KSB7CiAgICAgICAgY29uc3QgbG93ID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBjb25zdCBoaWdoID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBpZiAoY2hhckNvZGUgPj0gbG93ICYmIGNoYXJDb2RlIDw9IGhpZ2gpIHsKICAgICAgICAgIHJldHVybiBuICsgMTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAxOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX21hcC5sZW5ndGg7CiAgfQogIGdldCBpc0lkZW50aXR5Q01hcCgpIHsKICAgIGlmICghKHRoaXMubmFtZSA9PT0gIklkZW50aXR5LUgiIHx8IHRoaXMubmFtZSA9PT0gIklkZW50aXR5LVYiKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5fbWFwLmxlbmd0aCAhPT0gMHgxMDAwMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDB4MTAwMDA7IGkrKykgewogICAgICBpZiAodGhpcy5fbWFwW2ldICE9PSBpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgSWRlbnRpdHlDTWFwIGV4dGVuZHMgQ01hcCB7CiAgY29uc3RydWN0b3IodmVydGljYWwsIG4pIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnZlcnRpY2FsID0gdmVydGljYWw7CiAgICB0aGlzLmFkZENvZGVzcGFjZVJhbmdlKG4sIDAsIDB4ZmZmZik7CiAgfQogIG1hcENpZFJhbmdlKGxvdywgaGlnaCwgZHN0TG93KSB7CiAgICB1bnJlYWNoYWJsZSgic2hvdWxkIG5vdCBjYWxsIG1hcENpZFJhbmdlIik7CiAgfQogIG1hcEJmUmFuZ2UobG93LCBoaWdoLCBkc3RMb3cpIHsKICAgIHVucmVhY2hhYmxlKCJzaG91bGQgbm90IGNhbGwgbWFwQmZSYW5nZSIpOwogIH0KICBtYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KSB7CiAgICB1bnJlYWNoYWJsZSgic2hvdWxkIG5vdCBjYWxsIG1hcEJmUmFuZ2VUb0FycmF5Iik7CiAgfQogIG1hcE9uZShzcmMsIGRzdCkgewogICAgdW5yZWFjaGFibGUoInNob3VsZCBub3QgY2FsbCBtYXBDaWRPbmUiKTsKICB9CiAgbG9va3VwKGNvZGUpIHsKICAgIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKGNvZGUpICYmIGNvZGUgPD0gMHhmZmZmID8gY29kZSA6IHVuZGVmaW5lZDsKICB9CiAgY29udGFpbnMoY29kZSkgewogICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIoY29kZSkgJiYgY29kZSA8PSAweGZmZmY7CiAgfQogIGZvckVhY2goY2FsbGJhY2spIHsKICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDB4ZmZmZjsgaSsrKSB7CiAgICAgIGNhbGxiYWNrKGksIGkpOwogICAgfQogIH0KICBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkgJiYgdmFsdWUgPD0gMHhmZmZmID8gdmFsdWUgOiAtMTsKICB9CiAgZ2V0TWFwKCkgewogICAgY29uc3QgbWFwID0gbmV3IEFycmF5KDB4MTAwMDApOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gMHhmZmZmOyBpKyspIHsKICAgICAgbWFwW2ldID0gaTsKICAgIH0KICAgIHJldHVybiBtYXA7CiAgfQogIGdldCBsZW5ndGgoKSB7CiAgICByZXR1cm4gMHgxMDAwMDsKICB9CiAgZ2V0IGlzSWRlbnRpdHlDTWFwKCkgewogICAgdW5yZWFjaGFibGUoInNob3VsZCBub3QgYWNjZXNzIC5pc0lkZW50aXR5Q01hcCIpOwogIH0KfQpmdW5jdGlvbiBzdHJUb0ludChzdHIpIHsKICBsZXQgYSA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHsKICAgIGEgPSBhIDw8IDggfCBzdHIuY2hhckNvZGVBdChpKTsKICB9CiAgcmV0dXJuIGEgPj4+IDA7Cn0KZnVuY3Rpb24gZXhwZWN0U3RyaW5nKG9iaikgewogIGlmICh0eXBlb2Ygb2JqICE9PSAic3RyaW5nIikgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJNYWxmb3JtZWQgQ01hcDogZXhwZWN0ZWQgc3RyaW5nLiIpOwogIH0KfQpmdW5jdGlvbiBleHBlY3RJbnQob2JqKSB7CiAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTWFsZm9ybWVkIENNYXA6IGV4cGVjdGVkIGludC4iKTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VCZkNoYXIoY01hcCwgbGV4ZXIpIHsKICB3aGlsZSAodHJ1ZSkgewogICAgbGV0IG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKG9iaiA9PT0gRU9GKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKGlzQ21kKG9iaiwgImVuZGJmY2hhciIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3Qgc3JjID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBkc3QgPSBvYmo7CiAgICBjTWFwLm1hcE9uZShzcmMsIGRzdCk7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlQmZSYW5nZShjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoaXNDbWQob2JqLCAiZW5kYmZyYW5nZSIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3QgbG93ID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBoaWdoID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSB8fCB0eXBlb2Ygb2JqID09PSAic3RyaW5nIikgewogICAgICBjb25zdCBkc3RMb3cgPSBOdW1iZXIuaXNJbnRlZ2VyKG9iaikgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKG9iaikgOiBvYmo7CiAgICAgIGNNYXAubWFwQmZSYW5nZShsb3csIGhpZ2gsIGRzdExvdyk7CiAgICB9IGVsc2UgaWYgKGlzQ21kKG9iaiwgIlsiKSkgewogICAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgICAgY29uc3QgYXJyYXkgPSBbXTsKICAgICAgd2hpbGUgKCFpc0NtZChvYmosICJdIikgJiYgb2JqICE9PSBFT0YpIHsKICAgICAgICBhcnJheS5wdXNoKG9iaik7CiAgICAgICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICAgIH0KICAgICAgY01hcC5tYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KTsKICAgIH0gZWxzZSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgYmYgcmFuZ2UuIik7Cn0KZnVuY3Rpb24gcGFyc2VDaWRDaGFyKGNNYXAsIGxleGVyKSB7CiAgd2hpbGUgKHRydWUpIHsKICAgIGxldCBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGlmIChvYmogPT09IEVPRikgewogICAgICBicmVhazsKICAgIH0KICAgIGlmIChpc0NtZChvYmosICJlbmRjaWRjaGFyIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBzcmMgPSBzdHJUb0ludChvYmopOwogICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBleHBlY3RJbnQob2JqKTsKICAgIGNvbnN0IGRzdCA9IG9iajsKICAgIGNNYXAubWFwT25lKHNyYywgZHN0KTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VDaWRSYW5nZShjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoaXNDbWQob2JqLCAiZW5kY2lkcmFuZ2UiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgIGNvbnN0IGxvdyA9IHN0clRvSW50KG9iaik7CiAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3QgaGlnaCA9IHN0clRvSW50KG9iaik7CiAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGV4cGVjdEludChvYmopOwogICAgY29uc3QgZHN0TG93ID0gb2JqOwogICAgY01hcC5tYXBDaWRSYW5nZShsb3csIGhpZ2gsIGRzdExvdyk7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlQ29kZXNwYWNlUmFuZ2UoY01hcCwgbGV4ZXIpIHsKICB3aGlsZSAodHJ1ZSkgewogICAgbGV0IG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKG9iaiA9PT0gRU9GKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKGlzQ21kKG9iaiwgImVuZGNvZGVzcGFjZXJhbmdlIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHR5cGVvZiBvYmogIT09ICJzdHJpbmciKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgbG93ID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKHR5cGVvZiBvYmogIT09ICJzdHJpbmciKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgaGlnaCA9IHN0clRvSW50KG9iaik7CiAgICBjTWFwLmFkZENvZGVzcGFjZVJhbmdlKG9iai5sZW5ndGgsIGxvdywgaGlnaCk7CiAgfQogIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBjb2Rlc3BhY2UgcmFuZ2UuIik7Cn0KZnVuY3Rpb24gcGFyc2VXTW9kZShjTWFwLCBsZXhlcikgewogIGNvbnN0IG9iaiA9IGxleGVyLmdldE9iaigpOwogIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgIGNNYXAudmVydGljYWwgPSAhIW9iajsKICB9Cn0KZnVuY3Rpb24gcGFyc2VDTWFwTmFtZShjTWFwLCBsZXhlcikgewogIGNvbnN0IG9iaiA9IGxleGVyLmdldE9iaigpOwogIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lKSB7CiAgICBjTWFwLm5hbWUgPSBvYmoubmFtZTsKICB9Cn0KYXN5bmMgZnVuY3Rpb24gcGFyc2VDTWFwKGNNYXAsIGxleGVyLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKSB7CiAgbGV0IHByZXZpb3VzLCBlbWJlZGRlZFVzZUNNYXA7CiAgb2JqTG9vcDogd2hpbGUgKHRydWUpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgICBicmVhazsKICAgICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgaWYgKG9iai5uYW1lID09PSAiV01vZGUiKSB7CiAgICAgICAgICBwYXJzZVdNb2RlKGNNYXAsIGxleGVyKTsKICAgICAgICB9IGVsc2UgaWYgKG9iai5uYW1lID09PSAiQ01hcE5hbWUiKSB7CiAgICAgICAgICBwYXJzZUNNYXBOYW1lKGNNYXAsIGxleGVyKTsKICAgICAgICB9CiAgICAgICAgcHJldmlvdXMgPSBvYmo7CiAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgQ21kKSB7CiAgICAgICAgc3dpdGNoIChvYmouY21kKSB7CiAgICAgICAgICBjYXNlICJlbmRjbWFwIjoKICAgICAgICAgICAgYnJlYWsgb2JqTG9vcDsKICAgICAgICAgIGNhc2UgInVzZWNtYXAiOgogICAgICAgICAgICBpZiAocHJldmlvdXMgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgZW1iZWRkZWRVc2VDTWFwID0gcHJldmlvdXMubmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImJlZ2luY29kZXNwYWNlcmFuZ2UiOgogICAgICAgICAgICBwYXJzZUNvZGVzcGFjZVJhbmdlKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJiZWdpbmJmY2hhciI6CiAgICAgICAgICAgIHBhcnNlQmZDaGFyKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJiZWdpbmNpZGNoYXIiOgogICAgICAgICAgICBwYXJzZUNpZENoYXIoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImJlZ2luYmZyYW5nZSI6CiAgICAgICAgICAgIHBhcnNlQmZSYW5nZShjTWFwLCBsZXhlcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYmVnaW5jaWRyYW5nZSI6CiAgICAgICAgICAgIHBhcnNlQ2lkUmFuZ2UoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybigiSW52YWxpZCBjTWFwIGRhdGE6ICIgKyBleCk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogIH0KICBpZiAoIXVzZUNNYXAgJiYgZW1iZWRkZWRVc2VDTWFwKSB7CiAgICB1c2VDTWFwID0gZW1iZWRkZWRVc2VDTWFwOwogIH0KICBpZiAodXNlQ01hcCkgewogICAgcmV0dXJuIGV4dGVuZENNYXAoY01hcCwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCk7CiAgfQogIHJldHVybiBjTWFwOwp9CmFzeW5jIGZ1bmN0aW9uIGV4dGVuZENNYXAoY01hcCwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCkgewogIGNNYXAudXNlQ01hcCA9IGF3YWl0IGNyZWF0ZUJ1aWx0SW5DTWFwKHVzZUNNYXAsIGZldGNoQnVpbHRJbkNNYXApOwogIGlmIChjTWFwLm51bUNvZGVzcGFjZVJhbmdlcyA9PT0gMCkgewogICAgY29uc3QgdXNlQ29kZXNwYWNlUmFuZ2VzID0gY01hcC51c2VDTWFwLmNvZGVzcGFjZVJhbmdlczsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlQ29kZXNwYWNlUmFuZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNNYXAuY29kZXNwYWNlUmFuZ2VzW2ldID0gdXNlQ29kZXNwYWNlUmFuZ2VzW2ldLnNsaWNlKCk7CiAgICB9CiAgICBjTWFwLm51bUNvZGVzcGFjZVJhbmdlcyA9IGNNYXAudXNlQ01hcC5udW1Db2Rlc3BhY2VSYW5nZXM7CiAgfQogIGNNYXAudXNlQ01hcC5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICBpZiAoIWNNYXAuY29udGFpbnMoa2V5KSkgewogICAgICBjTWFwLm1hcE9uZShrZXksIHZhbHVlKTsKICAgIH0KICB9KTsKICByZXR1cm4gY01hcDsKfQphc3luYyBmdW5jdGlvbiBjcmVhdGVCdWlsdEluQ01hcChuYW1lLCBmZXRjaEJ1aWx0SW5DTWFwKSB7CiAgaWYgKG5hbWUgPT09ICJJZGVudGl0eS1IIikgewogICAgcmV0dXJuIG5ldyBJZGVudGl0eUNNYXAoZmFsc2UsIDIpOwogIH0gZWxzZSBpZiAobmFtZSA9PT0gIklkZW50aXR5LVYiKSB7CiAgICByZXR1cm4gbmV3IElkZW50aXR5Q01hcCh0cnVlLCAyKTsKICB9CiAgaWYgKCFCVUlMVF9JTl9DTUFQUy5pbmNsdWRlcyhuYW1lKSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIENNYXAgbmFtZTogIiArIG5hbWUpOwogIH0KICBpZiAoIWZldGNoQnVpbHRJbkNNYXApIHsKICAgIHRocm93IG5ldyBFcnJvcigiQnVpbHQtaW4gQ01hcCBwYXJhbWV0ZXJzIGFyZSBub3QgcHJvdmlkZWQuIik7CiAgfQogIGNvbnN0IHsKICAgIGNNYXBEYXRhLAogICAgaXNDb21wcmVzc2VkCiAgfSA9IGF3YWl0IGZldGNoQnVpbHRJbkNNYXAobmFtZSk7CiAgY29uc3QgY01hcCA9IG5ldyBDTWFwKHRydWUpOwogIGlmIChpc0NvbXByZXNzZWQpIHsKICAgIHJldHVybiBuZXcgQmluYXJ5Q01hcFJlYWRlcigpLnByb2Nlc3MoY01hcERhdGEsIGNNYXAsIHVzZUNNYXAgPT4gZXh0ZW5kQ01hcChjTWFwLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKSk7CiAgfQogIGNvbnN0IGxleGVyID0gbmV3IExleGVyKG5ldyBTdHJlYW0oY01hcERhdGEpKTsKICByZXR1cm4gcGFyc2VDTWFwKGNNYXAsIGxleGVyLCBmZXRjaEJ1aWx0SW5DTWFwLCBudWxsKTsKfQpjbGFzcyBDTWFwRmFjdG9yeSB7CiAgc3RhdGljIGFzeW5jIGNyZWF0ZSh7CiAgICBlbmNvZGluZywKICAgIGZldGNoQnVpbHRJbkNNYXAsCiAgICB1c2VDTWFwCiAgfSkgewogICAgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgTmFtZSkgewogICAgICByZXR1cm4gY3JlYXRlQnVpbHRJbkNNYXAoZW5jb2RpbmcubmFtZSwgZmV0Y2hCdWlsdEluQ01hcCk7CiAgICB9IGVsc2UgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICBjb25zdCBwYXJzZWRDTWFwID0gYXdhaXQgcGFyc2VDTWFwKG5ldyBDTWFwKCksIG5ldyBMZXhlcihlbmNvZGluZyksIGZldGNoQnVpbHRJbkNNYXAsIHVzZUNNYXApOwogICAgICBpZiAocGFyc2VkQ01hcC5pc0lkZW50aXR5Q01hcCkgewogICAgICAgIHJldHVybiBjcmVhdGVCdWlsdEluQ01hcChwYXJzZWRDTWFwLm5hbWUsIGZldGNoQnVpbHRJbkNNYXApOwogICAgICB9CiAgICAgIHJldHVybiBwYXJzZWRDTWFwOwogICAgfQogICAgdGhyb3cgbmV3IEVycm9yKCJFbmNvZGluZyByZXF1aXJlZC4iKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2VuY29kaW5ncy5qcwpjb25zdCBFeHBlcnRFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICIiLCAiZG9sbGFyb2xkc3R5bGUiLCAiZG9sbGFyc3VwZXJpb3IiLCAiYW1wZXJzYW5kc21hbGwiLCAiQWN1dGVzbWFsbCIsICJwYXJlbmxlZnRzdXBlcmlvciIsICJwYXJlbnJpZ2h0c3VwZXJpb3IiLCAidHdvZG90ZW5sZWFkZXIiLCAib25lZG90ZW5sZWFkZXIiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJmcmFjdGlvbiIsICJ6ZXJvb2xkc3R5bGUiLCAib25lb2xkc3R5bGUiLCAidHdvb2xkc3R5bGUiLCAidGhyZWVvbGRzdHlsZSIsICJmb3Vyb2xkc3R5bGUiLCAiZml2ZW9sZHN0eWxlIiwgInNpeG9sZHN0eWxlIiwgInNldmVub2xkc3R5bGUiLCAiZWlnaHRvbGRzdHlsZSIsICJuaW5lb2xkc3R5bGUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImNvbW1hc3VwZXJpb3IiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICJwZXJpb2RzdXBlcmlvciIsICJxdWVzdGlvbnNtYWxsIiwgIiIsICJhc3VwZXJpb3IiLCAiYnN1cGVyaW9yIiwgImNlbnRzdXBlcmlvciIsICJkc3VwZXJpb3IiLCAiZXN1cGVyaW9yIiwgIiIsICIiLCAiIiwgImlzdXBlcmlvciIsICIiLCAiIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICIiLCAiIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgIiIsICJmZiIsICJmaSIsICJmbCIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgIiIsICJwYXJlbnJpZ2h0aW5mZXJpb3IiLCAiQ2lyY3VtZmxleHNtYWxsIiwgImh5cGhlbnN1cGVyaW9yIiwgIkdyYXZlc21hbGwiLCAiQXNtYWxsIiwgIkJzbWFsbCIsICJDc21hbGwiLCAiRHNtYWxsIiwgIkVzbWFsbCIsICJGc21hbGwiLCAiR3NtYWxsIiwgIkhzbWFsbCIsICJJc21hbGwiLCAiSnNtYWxsIiwgIktzbWFsbCIsICJMc21hbGwiLCAiTXNtYWxsIiwgIk5zbWFsbCIsICJPc21hbGwiLCAiUHNtYWxsIiwgIlFzbWFsbCIsICJSc21hbGwiLCAiU3NtYWxsIiwgIlRzbWFsbCIsICJVc21hbGwiLCAiVnNtYWxsIiwgIldzbWFsbCIsICJYc21hbGwiLCAiWXNtYWxsIiwgIlpzbWFsbCIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiVGlsZGVzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICIiLCAiIiwgIlNjYXJvbnNtYWxsIiwgIlpjYXJvbnNtYWxsIiwgIkRpZXJlc2lzc21hbGwiLCAiQnJldmVzbWFsbCIsICJDYXJvbnNtYWxsIiwgIiIsICJEb3RhY2NlbnRzbWFsbCIsICIiLCAiIiwgIk1hY3JvbnNtYWxsIiwgIiIsICIiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5pbmZlcmlvciIsICIiLCAiIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAiIiwgIiIsICIiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgIiIsICIiLCAiemVyb3N1cGVyaW9yIiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciIsICJBZ3JhdmVzbWFsbCIsICJBYWN1dGVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkFyaW5nc21hbGwiLCAiQUVzbWFsbCIsICJDY2VkaWxsYXNtYWxsIiwgIkVncmF2ZXNtYWxsIiwgIkVhY3V0ZXNtYWxsIiwgIkVjaXJjdW1mbGV4c21hbGwiLCAiRWRpZXJlc2lzc21hbGwiLCAiSWdyYXZlc21hbGwiLCAiSWFjdXRlc21hbGwiLCAiSWNpcmN1bWZsZXhzbWFsbCIsICJJZGllcmVzaXNzbWFsbCIsICJFdGhzbWFsbCIsICJOdGlsZGVzbWFsbCIsICJPZ3JhdmVzbWFsbCIsICJPYWN1dGVzbWFsbCIsICJPY2lyY3VtZmxleHNtYWxsIiwgIk90aWxkZXNtYWxsIiwgIk9kaWVyZXNpc3NtYWxsIiwgIk9Fc21hbGwiLCAiT3NsYXNoc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICJZYWN1dGVzbWFsbCIsICJUaG9ybnNtYWxsIiwgIllkaWVyZXNpc3NtYWxsIl07CmNvbnN0IE1hY0V4cGVydEVuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImV4Y2xhbXNtYWxsIiwgIkh1bmdhcnVtbGF1dHNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiIiwgInRocmVlcXVhcnRlcnNlbWRhc2giLCAiIiwgInF1ZXN0aW9uc21hbGwiLCAiIiwgIiIsICIiLCAiIiwgIkV0aHNtYWxsIiwgIiIsICIiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgImZmIiwgImZpIiwgImZsIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAiIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJDaXJjdW1mbGV4c21hbGwiLCAiaHlwaGVuaW5mZXJpb3IiLCAiR3JhdmVzbWFsbCIsICJBc21hbGwiLCAiQnNtYWxsIiwgIkNzbWFsbCIsICJEc21hbGwiLCAiRXNtYWxsIiwgIkZzbWFsbCIsICJHc21hbGwiLCAiSHNtYWxsIiwgIklzbWFsbCIsICJKc21hbGwiLCAiS3NtYWxsIiwgIkxzbWFsbCIsICJNc21hbGwiLCAiTnNtYWxsIiwgIk9zbWFsbCIsICJQc21hbGwiLCAiUXNtYWxsIiwgIlJzbWFsbCIsICJTc21hbGwiLCAiVHNtYWxsIiwgIlVzbWFsbCIsICJWc21hbGwiLCAiV3NtYWxsIiwgIlhzbWFsbCIsICJZc21hbGwiLCAiWnNtYWxsIiwgImNvbG9ubW9uZXRhcnkiLCAib25lZml0dGVkIiwgInJ1cGlhaCIsICJUaWxkZXNtYWxsIiwgIiIsICIiLCAiYXN1cGVyaW9yIiwgImNlbnRzdXBlcmlvciIsICIiLCAiIiwgIiIsICIiLCAiQWFjdXRlc21hbGwiLCAiQWdyYXZlc21hbGwiLCAiQWNpcmN1bWZsZXhzbWFsbCIsICJBZGllcmVzaXNzbWFsbCIsICJBdGlsZGVzbWFsbCIsICJBcmluZ3NtYWxsIiwgIkNjZWRpbGxhc21hbGwiLCAiRWFjdXRlc21hbGwiLCAiRWdyYXZlc21hbGwiLCAiRWNpcmN1bWZsZXhzbWFsbCIsICJFZGllcmVzaXNzbWFsbCIsICJJYWN1dGVzbWFsbCIsICJJZ3JhdmVzbWFsbCIsICJJY2lyY3VtZmxleHNtYWxsIiwgIklkaWVyZXNpc3NtYWxsIiwgIk50aWxkZXNtYWxsIiwgIk9hY3V0ZXNtYWxsIiwgIk9ncmF2ZXNtYWxsIiwgIk9jaXJjdW1mbGV4c21hbGwiLCAiT2RpZXJlc2lzc21hbGwiLCAiT3RpbGRlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICIiLCAiZWlnaHRzdXBlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJzaXhpbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiU2Nhcm9uc21hbGwiLCAiIiwgImNlbnRpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICIiLCAiRGllcmVzaXNzbWFsbCIsICIiLCAiQ2Fyb25zbWFsbCIsICJvc3VwZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgIiIsICJjb21tYWluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgIllhY3V0ZXNtYWxsIiwgIiIsICJkb2xsYXJpbmZlcmlvciIsICIiLCAiIiwgIlRob3Juc21hbGwiLCAiIiwgIm5pbmVpbmZlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAiWmNhcm9uc21hbGwiLCAiQUVzbWFsbCIsICJPc2xhc2hzbWFsbCIsICJxdWVzdGlvbmRvd25zbWFsbCIsICJvbmVpbmZlcmlvciIsICJMc2xhc2hzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJDZWRpbGxhc21hbGwiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJPRXNtYWxsIiwgImZpZ3VyZWRhc2giLCAiaHlwaGVuc3VwZXJpb3IiLCAiIiwgIiIsICIiLCAiIiwgImV4Y2xhbWRvd25zbWFsbCIsICIiLCAiWWRpZXJlc2lzc21hbGwiLCAiIiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvc3VwZXJpb3IiLCAiIiwgImVzdXBlcmlvciIsICJyc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgIiIsICIiLCAiaXN1cGVyaW9yIiwgInNzdXBlcmlvciIsICJkc3VwZXJpb3IiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJsc3VwZXJpb3IiLCAiT2dvbmVrc21hbGwiLCAiQnJldmVzbWFsbCIsICJNYWNyb25zbWFsbCIsICJic3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJjb21tYXN1cGVyaW9yIiwgInBlcmlvZHN1cGVyaW9yIiwgIkRvdGFjY2VudHNtYWxsIiwgIlJpbmdzbWFsbCIsICIiLCAiIiwgIiIsICIiXTsKY29uc3QgTWFjUm9tYW5FbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW0iLCAicXVvdGVkYmwiLCAibnVtYmVyc2lnbiIsICJkb2xsYXIiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAicXVvdGVzaW5nbGUiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgImdyYXZlIiwgImEiLCAiYiIsICJjIiwgImQiLCAiZSIsICJmIiwgImciLCAiaCIsICJpIiwgImoiLCAiayIsICJsIiwgIm0iLCAibiIsICJvIiwgInAiLCAicSIsICJyIiwgInMiLCAidCIsICJ1IiwgInYiLCAidyIsICJ4IiwgInkiLCAieiIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAiYXNjaWl0aWxkZSIsICIiLCAiQWRpZXJlc2lzIiwgIkFyaW5nIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJOdGlsZGUiLCAiT2RpZXJlc2lzIiwgIlVkaWVyZXNpcyIsICJhYWN1dGUiLCAiYWdyYXZlIiwgImFjaXJjdW1mbGV4IiwgImFkaWVyZXNpcyIsICJhdGlsZGUiLCAiYXJpbmciLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVncmF2ZSIsICJlY2lyY3VtZmxleCIsICJlZGllcmVzaXMiLCAiaWFjdXRlIiwgImlncmF2ZSIsICJpY2lyY3VtZmxleCIsICJpZGllcmVzaXMiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvZ3JhdmUiLCAib2NpcmN1bWZsZXgiLCAib2RpZXJlc2lzIiwgIm90aWxkZSIsICJ1YWN1dGUiLCAidWdyYXZlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJkYWdnZXIiLCAiZGVncmVlIiwgImNlbnQiLCAic3RlcmxpbmciLCAic2VjdGlvbiIsICJidWxsZXQiLCAicGFyYWdyYXBoIiwgImdlcm1hbmRibHMiLCAicmVnaXN0ZXJlZCIsICJjb3B5cmlnaHQiLCAidHJhZGVtYXJrIiwgImFjdXRlIiwgImRpZXJlc2lzIiwgIm5vdGVxdWFsIiwgIkFFIiwgIk9zbGFzaCIsICJpbmZpbml0eSIsICJwbHVzbWludXMiLCAibGVzc2VxdWFsIiwgImdyZWF0ZXJlcXVhbCIsICJ5ZW4iLCAibXUiLCAicGFydGlhbGRpZmYiLCAic3VtbWF0aW9uIiwgInByb2R1Y3QiLCAicGkiLCAiaW50ZWdyYWwiLCAib3JkZmVtaW5pbmUiLCAib3JkbWFzY3VsaW5lIiwgIk9tZWdhIiwgImFlIiwgIm9zbGFzaCIsICJxdWVzdGlvbmRvd24iLCAiZXhjbGFtZG93biIsICJsb2dpY2Fsbm90IiwgInJhZGljYWwiLCAiZmxvcmluIiwgImFwcHJveGVxdWFsIiwgIkRlbHRhIiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAic3BhY2UiLCAiQWdyYXZlIiwgIkF0aWxkZSIsICJPdGlsZGUiLCAiT0UiLCAib2UiLCAiZW5kYXNoIiwgImVtZGFzaCIsICJxdW90ZWRibGxlZnQiLCAicXVvdGVkYmxyaWdodCIsICJxdW90ZWxlZnQiLCAicXVvdGVyaWdodCIsICJkaXZpZGUiLCAibG96ZW5nZSIsICJ5ZGllcmVzaXMiLCAiWWRpZXJlc2lzIiwgImZyYWN0aW9uIiwgImN1cnJlbmN5IiwgImd1aWxzaW5nbGxlZnQiLCAiZ3VpbHNpbmdscmlnaHQiLCAiZmkiLCAiZmwiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJwZXJ0aG91c2FuZCIsICJBY2lyY3VtZmxleCIsICJFY2lyY3VtZmxleCIsICJBYWN1dGUiLCAiRWRpZXJlc2lzIiwgIkVncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIklncmF2ZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiYXBwbGUiLCAiT2dyYXZlIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZ3JhdmUiLCAiZG90bGVzc2kiLCAiY2lyY3VtZmxleCIsICJ0aWxkZSIsICJtYWNyb24iLCAiYnJldmUiLCAiZG90YWNjZW50IiwgInJpbmciLCAiY2VkaWxsYSIsICJodW5nYXJ1bWxhdXQiLCAib2dvbmVrIiwgImNhcm9uIl07CmNvbnN0IFN0YW5kYXJkRW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3RlcmlnaHQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgInF1b3RlbGVmdCIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgImV4Y2xhbWRvd24iLCAiY2VudCIsICJzdGVybGluZyIsICJmcmFjdGlvbiIsICJ5ZW4iLCAiZmxvcmluIiwgInNlY3Rpb24iLCAiY3VycmVuY3kiLCAicXVvdGVzaW5nbGUiLCAicXVvdGVkYmxsZWZ0IiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICIiLCAiZW5kYXNoIiwgImRhZ2dlciIsICJkYWdnZXJkYmwiLCAicGVyaW9kY2VudGVyZWQiLCAiIiwgInBhcmFncmFwaCIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInF1b3RlZGJscmlnaHQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAicGVydGhvdXNhbmQiLCAiIiwgInF1ZXN0aW9uZG93biIsICIiLCAiZ3JhdmUiLCAiYWN1dGUiLCAiY2lyY3VtZmxleCIsICJ0aWxkZSIsICJtYWNyb24iLCAiYnJldmUiLCAiZG90YWNjZW50IiwgImRpZXJlc2lzIiwgIiIsICJyaW5nIiwgImNlZGlsbGEiLCAiIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiZW1kYXNoIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJBRSIsICIiLCAib3JkZmVtaW5pbmUiLCAiIiwgIiIsICIiLCAiIiwgIkxzbGFzaCIsICJPc2xhc2giLCAiT0UiLCAib3JkbWFzY3VsaW5lIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiYWUiLCAiIiwgIiIsICIiLCAiZG90bGVzc2kiLCAiIiwgIiIsICJsc2xhc2giLCAib3NsYXNoIiwgIm9lIiwgImdlcm1hbmRibHMiLCAiIiwgIiIsICIiLCAiIl07CmNvbnN0IFdpbkFuc2lFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW0iLCAicXVvdGVkYmwiLCAibnVtYmVyc2lnbiIsICJkb2xsYXIiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAicXVvdGVzaW5nbGUiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgImdyYXZlIiwgImEiLCAiYiIsICJjIiwgImQiLCAiZSIsICJmIiwgImciLCAiaCIsICJpIiwgImoiLCAiayIsICJsIiwgIm0iLCAibiIsICJvIiwgInAiLCAicSIsICJyIiwgInMiLCAidCIsICJ1IiwgInYiLCAidyIsICJ4IiwgInkiLCAieiIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAiYXNjaWl0aWxkZSIsICJidWxsZXQiLCAiRXVybyIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAiZmxvcmluIiwgInF1b3RlZGJsYmFzZSIsICJlbGxpcHNpcyIsICJkYWdnZXIiLCAiZGFnZ2VyZGJsIiwgImNpcmN1bWZsZXgiLCAicGVydGhvdXNhbmQiLCAiU2Nhcm9uIiwgImd1aWxzaW5nbGxlZnQiLCAiT0UiLCAiYnVsbGV0IiwgIlpjYXJvbiIsICJidWxsZXQiLCAiYnVsbGV0IiwgInF1b3RlbGVmdCIsICJxdW90ZXJpZ2h0IiwgInF1b3RlZGJsbGVmdCIsICJxdW90ZWRibHJpZ2h0IiwgImJ1bGxldCIsICJlbmRhc2giLCAiZW1kYXNoIiwgInRpbGRlIiwgInRyYWRlbWFyayIsICJzY2Fyb24iLCAiZ3VpbHNpbmdscmlnaHQiLCAib2UiLCAiYnVsbGV0IiwgInpjYXJvbiIsICJZZGllcmVzaXMiLCAic3BhY2UiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImN1cnJlbmN5IiwgInllbiIsICJicm9rZW5iYXIiLCAic2VjdGlvbiIsICJkaWVyZXNpcyIsICJjb3B5cmlnaHQiLCAib3JkZmVtaW5pbmUiLCAiZ3VpbGxlbW90bGVmdCIsICJsb2dpY2Fsbm90IiwgImh5cGhlbiIsICJyZWdpc3RlcmVkIiwgIm1hY3JvbiIsICJkZWdyZWUiLCAicGx1c21pbnVzIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiYWN1dGUiLCAibXUiLCAicGFyYWdyYXBoIiwgInBlcmlvZGNlbnRlcmVkIiwgImNlZGlsbGEiLCAib25lc3VwZXJpb3IiLCAib3JkbWFzY3VsaW5lIiwgImd1aWxsZW1vdHJpZ2h0IiwgIm9uZXF1YXJ0ZXIiLCAib25laGFsZiIsICJ0aHJlZXF1YXJ0ZXJzIiwgInF1ZXN0aW9uZG93biIsICJBZ3JhdmUiLCAiQWFjdXRlIiwgIkFjaXJjdW1mbGV4IiwgIkF0aWxkZSIsICJBZGllcmVzaXMiLCAiQXJpbmciLCAiQUUiLCAiQ2NlZGlsbGEiLCAiRWdyYXZlIiwgIkVhY3V0ZSIsICJFY2lyY3VtZmxleCIsICJFZGllcmVzaXMiLCAiSWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiRXRoIiwgIk50aWxkZSIsICJPZ3JhdmUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgIk90aWxkZSIsICJPZGllcmVzaXMiLCAibXVsdGlwbHkiLCAiT3NsYXNoIiwgIlVncmF2ZSIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWRpZXJlc2lzIiwgIllhY3V0ZSIsICJUaG9ybiIsICJnZXJtYW5kYmxzIiwgImFncmF2ZSIsICJhYWN1dGUiLCAiYWNpcmN1bWZsZXgiLCAiYXRpbGRlIiwgImFkaWVyZXNpcyIsICJhcmluZyIsICJhZSIsICJjY2VkaWxsYSIsICJlZ3JhdmUiLCAiZWFjdXRlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJpZ3JhdmUiLCAiaWFjdXRlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJldGgiLCAibnRpbGRlIiwgIm9ncmF2ZSIsICJvYWN1dGUiLCAib2NpcmN1bWZsZXgiLCAib3RpbGRlIiwgIm9kaWVyZXNpcyIsICJkaXZpZGUiLCAib3NsYXNoIiwgInVncmF2ZSIsICJ1YWN1dGUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgInlhY3V0ZSIsICJ0aG9ybiIsICJ5ZGllcmVzaXMiXTsKY29uc3QgU3ltYm9sU2V0RW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtIiwgInVuaXZlcnNhbCIsICJudW1iZXJzaWduIiwgImV4aXN0ZW50aWFsIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInN1Y2h0aGF0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrbWF0aCIsICJwbHVzIiwgImNvbW1hIiwgIm1pbnVzIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiY29uZ3J1ZW50IiwgIkFscGhhIiwgIkJldGEiLCAiQ2hpIiwgIkRlbHRhIiwgIkVwc2lsb24iLCAiUGhpIiwgIkdhbW1hIiwgIkV0YSIsICJJb3RhIiwgInRoZXRhMSIsICJLYXBwYSIsICJMYW1iZGEiLCAiTXUiLCAiTnUiLCAiT21pY3JvbiIsICJQaSIsICJUaGV0YSIsICJSaG8iLCAiU2lnbWEiLCAiVGF1IiwgIlVwc2lsb24iLCAic2lnbWExIiwgIk9tZWdhIiwgIlhpIiwgIlBzaSIsICJaZXRhIiwgImJyYWNrZXRsZWZ0IiwgInRoZXJlZm9yZSIsICJicmFja2V0cmlnaHQiLCAicGVycGVuZGljdWxhciIsICJ1bmRlcnNjb3JlIiwgInJhZGljYWxleCIsICJhbHBoYSIsICJiZXRhIiwgImNoaSIsICJkZWx0YSIsICJlcHNpbG9uIiwgInBoaSIsICJnYW1tYSIsICJldGEiLCAiaW90YSIsICJwaGkxIiwgImthcHBhIiwgImxhbWJkYSIsICJtdSIsICJudSIsICJvbWljcm9uIiwgInBpIiwgInRoZXRhIiwgInJobyIsICJzaWdtYSIsICJ0YXUiLCAidXBzaWxvbiIsICJvbWVnYTEiLCAib21lZ2EiLCAieGkiLCAicHNpIiwgInpldGEiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgInNpbWlsYXIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiRXVybyIsICJVcHNpbG9uMSIsICJtaW51dGUiLCAibGVzc2VxdWFsIiwgImZyYWN0aW9uIiwgImluZmluaXR5IiwgImZsb3JpbiIsICJjbHViIiwgImRpYW1vbmQiLCAiaGVhcnQiLCAic3BhZGUiLCAiYXJyb3dib3RoIiwgImFycm93bGVmdCIsICJhcnJvd3VwIiwgImFycm93cmlnaHQiLCAiYXJyb3dkb3duIiwgImRlZ3JlZSIsICJwbHVzbWludXMiLCAic2Vjb25kIiwgImdyZWF0ZXJlcXVhbCIsICJtdWx0aXBseSIsICJwcm9wb3J0aW9uYWwiLCAicGFydGlhbGRpZmYiLCAiYnVsbGV0IiwgImRpdmlkZSIsICJub3RlcXVhbCIsICJlcXVpdmFsZW5jZSIsICJhcHByb3hlcXVhbCIsICJlbGxpcHNpcyIsICJhcnJvd3ZlcnRleCIsICJhcnJvd2hvcml6ZXgiLCAiY2FycmlhZ2VyZXR1cm4iLCAiYWxlcGgiLCAiSWZyYWt0dXIiLCAiUmZyYWt0dXIiLCAid2VpZXJzdHJhc3MiLCAiY2lyY2xlbXVsdGlwbHkiLCAiY2lyY2xlcGx1cyIsICJlbXB0eXNldCIsICJpbnRlcnNlY3Rpb24iLCAidW5pb24iLCAicHJvcGVyc3VwZXJzZXQiLCAicmVmbGV4c3VwZXJzZXQiLCAibm90c3Vic2V0IiwgInByb3BlcnN1YnNldCIsICJyZWZsZXhzdWJzZXQiLCAiZWxlbWVudCIsICJub3RlbGVtZW50IiwgImFuZ2xlIiwgImdyYWRpZW50IiwgInJlZ2lzdGVyc2VyaWYiLCAiY29weXJpZ2h0c2VyaWYiLCAidHJhZGVtYXJrc2VyaWYiLCAicHJvZHVjdCIsICJyYWRpY2FsIiwgImRvdG1hdGgiLCAibG9naWNhbG5vdCIsICJsb2dpY2FsYW5kIiwgImxvZ2ljYWxvciIsICJhcnJvd2RibGJvdGgiLCAiYXJyb3dkYmxsZWZ0IiwgImFycm93ZGJsdXAiLCAiYXJyb3dkYmxyaWdodCIsICJhcnJvd2RibGRvd24iLCAibG96ZW5nZSIsICJhbmdsZWxlZnQiLCAicmVnaXN0ZXJzYW5zIiwgImNvcHlyaWdodHNhbnMiLCAidHJhZGVtYXJrc2FucyIsICJzdW1tYXRpb24iLCAicGFyZW5sZWZ0dHAiLCAicGFyZW5sZWZ0ZXgiLCAicGFyZW5sZWZ0YnQiLCAiYnJhY2tldGxlZnR0cCIsICJicmFja2V0bGVmdGV4IiwgImJyYWNrZXRsZWZ0YnQiLCAiYnJhY2VsZWZ0dHAiLCAiYnJhY2VsZWZ0bWlkIiwgImJyYWNlbGVmdGJ0IiwgImJyYWNlZXgiLCAiIiwgImFuZ2xlcmlnaHQiLCAiaW50ZWdyYWwiLCAiaW50ZWdyYWx0cCIsICJpbnRlZ3JhbGV4IiwgImludGVncmFsYnQiLCAicGFyZW5yaWdodHRwIiwgInBhcmVucmlnaHRleCIsICJwYXJlbnJpZ2h0YnQiLCAiYnJhY2tldHJpZ2h0dHAiLCAiYnJhY2tldHJpZ2h0ZXgiLCAiYnJhY2tldHJpZ2h0YnQiLCAiYnJhY2VyaWdodHRwIiwgImJyYWNlcmlnaHRtaWQiLCAiYnJhY2VyaWdodGJ0IiwgIiJdOwpjb25zdCBaYXBmRGluZ2JhdHNFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJhMSIsICJhMiIsICJhMjAyIiwgImEzIiwgImE0IiwgImE1IiwgImExMTkiLCAiYTExOCIsICJhMTE3IiwgImExMSIsICJhMTIiLCAiYTEzIiwgImExNCIsICJhMTUiLCAiYTE2IiwgImExMDUiLCAiYTE3IiwgImExOCIsICJhMTkiLCAiYTIwIiwgImEyMSIsICJhMjIiLCAiYTIzIiwgImEyNCIsICJhMjUiLCAiYTI2IiwgImEyNyIsICJhMjgiLCAiYTYiLCAiYTciLCAiYTgiLCAiYTkiLCAiYTEwIiwgImEyOSIsICJhMzAiLCAiYTMxIiwgImEzMiIsICJhMzMiLCAiYTM0IiwgImEzNSIsICJhMzYiLCAiYTM3IiwgImEzOCIsICJhMzkiLCAiYTQwIiwgImE0MSIsICJhNDIiLCAiYTQzIiwgImE0NCIsICJhNDUiLCAiYTQ2IiwgImE0NyIsICJhNDgiLCAiYTQ5IiwgImE1MCIsICJhNTEiLCAiYTUyIiwgImE1MyIsICJhNTQiLCAiYTU1IiwgImE1NiIsICJhNTciLCAiYTU4IiwgImE1OSIsICJhNjAiLCAiYTYxIiwgImE2MiIsICJhNjMiLCAiYTY0IiwgImE2NSIsICJhNjYiLCAiYTY3IiwgImE2OCIsICJhNjkiLCAiYTcwIiwgImE3MSIsICJhNzIiLCAiYTczIiwgImE3NCIsICJhMjAzIiwgImE3NSIsICJhMjA0IiwgImE3NiIsICJhNzciLCAiYTc4IiwgImE3OSIsICJhODEiLCAiYTgyIiwgImE4MyIsICJhODQiLCAiYTk3IiwgImE5OCIsICJhOTkiLCAiYTEwMCIsICIiLCAiYTg5IiwgImE5MCIsICJhOTMiLCAiYTk0IiwgImE5MSIsICJhOTIiLCAiYTIwNSIsICJhODUiLCAiYTIwNiIsICJhODYiLCAiYTg3IiwgImE4OCIsICJhOTUiLCAiYTk2IiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJhMTAxIiwgImExMDIiLCAiYTEwMyIsICJhMTA0IiwgImExMDYiLCAiYTEwNyIsICJhMTA4IiwgImExMTIiLCAiYTExMSIsICJhMTEwIiwgImExMDkiLCAiYTEyMCIsICJhMTIxIiwgImExMjIiLCAiYTEyMyIsICJhMTI0IiwgImExMjUiLCAiYTEyNiIsICJhMTI3IiwgImExMjgiLCAiYTEyOSIsICJhMTMwIiwgImExMzEiLCAiYTEzMiIsICJhMTMzIiwgImExMzQiLCAiYTEzNSIsICJhMTM2IiwgImExMzciLCAiYTEzOCIsICJhMTM5IiwgImExNDAiLCAiYTE0MSIsICJhMTQyIiwgImExNDMiLCAiYTE0NCIsICJhMTQ1IiwgImExNDYiLCAiYTE0NyIsICJhMTQ4IiwgImExNDkiLCAiYTE1MCIsICJhMTUxIiwgImExNTIiLCAiYTE1MyIsICJhMTU0IiwgImExNTUiLCAiYTE1NiIsICJhMTU3IiwgImExNTgiLCAiYTE1OSIsICJhMTYwIiwgImExNjEiLCAiYTE2MyIsICJhMTY0IiwgImExOTYiLCAiYTE2NSIsICJhMTkyIiwgImExNjYiLCAiYTE2NyIsICJhMTY4IiwgImExNjkiLCAiYTE3MCIsICJhMTcxIiwgImExNzIiLCAiYTE3MyIsICJhMTYyIiwgImExNzQiLCAiYTE3NSIsICJhMTc2IiwgImExNzciLCAiYTE3OCIsICJhMTc5IiwgImExOTMiLCAiYTE4MCIsICJhMTk5IiwgImExODEiLCAiYTIwMCIsICJhMTgyIiwgIiIsICJhMjAxIiwgImExODMiLCAiYTE4NCIsICJhMTk3IiwgImExODUiLCAiYTE5NCIsICJhMTk4IiwgImExODYiLCAiYTE5NSIsICJhMTg3IiwgImExODgiLCAiYTE4OSIsICJhMTkwIiwgImExOTEiLCAiIl07CmZ1bmN0aW9uIGdldEVuY29kaW5nKGVuY29kaW5nTmFtZSkgewogIHN3aXRjaCAoZW5jb2RpbmdOYW1lKSB7CiAgICBjYXNlICJXaW5BbnNpRW5jb2RpbmciOgogICAgICByZXR1cm4gV2luQW5zaUVuY29kaW5nOwogICAgY2FzZSAiU3RhbmRhcmRFbmNvZGluZyI6CiAgICAgIHJldHVybiBTdGFuZGFyZEVuY29kaW5nOwogICAgY2FzZSAiTWFjUm9tYW5FbmNvZGluZyI6CiAgICAgIHJldHVybiBNYWNSb21hbkVuY29kaW5nOwogICAgY2FzZSAiU3ltYm9sU2V0RW5jb2RpbmciOgogICAgICByZXR1cm4gU3ltYm9sU2V0RW5jb2Rpbmc7CiAgICBjYXNlICJaYXBmRGluZ2JhdHNFbmNvZGluZyI6CiAgICAgIHJldHVybiBaYXBmRGluZ2JhdHNFbmNvZGluZzsKICAgIGNhc2UgIkV4cGVydEVuY29kaW5nIjoKICAgICAgcmV0dXJuIEV4cGVydEVuY29kaW5nOwogICAgY2FzZSAiTWFjRXhwZXJ0RW5jb2RpbmciOgogICAgICByZXR1cm4gTWFjRXhwZXJ0RW5jb2Rpbmc7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2dseXBobGlzdC5qcwoKY29uc3QgZ2V0R2x5cGhzVW5pY29kZSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuQSA9IDB4MDA0MTsKICB0LkFFID0gMHgwMGM2OwogIHQuQUVhY3V0ZSA9IDB4MDFmYzsKICB0LkFFbWFjcm9uID0gMHgwMWUyOwogIHQuQUVzbWFsbCA9IDB4ZjdlNjsKICB0LkFhY3V0ZSA9IDB4MDBjMTsKICB0LkFhY3V0ZXNtYWxsID0gMHhmN2UxOwogIHQuQWJyZXZlID0gMHgwMTAyOwogIHQuQWJyZXZlYWN1dGUgPSAweDFlYWU7CiAgdC5BYnJldmVjeXJpbGxpYyA9IDB4MDRkMDsKICB0LkFicmV2ZWRvdGJlbG93ID0gMHgxZWI2OwogIHQuQWJyZXZlZ3JhdmUgPSAweDFlYjA7CiAgdC5BYnJldmVob29rYWJvdmUgPSAweDFlYjI7CiAgdC5BYnJldmV0aWxkZSA9IDB4MWViNDsKICB0LkFjYXJvbiA9IDB4MDFjZDsKICB0LkFjaXJjbGUgPSAweDI0YjY7CiAgdC5BY2lyY3VtZmxleCA9IDB4MDBjMjsKICB0LkFjaXJjdW1mbGV4YWN1dGUgPSAweDFlYTQ7CiAgdC5BY2lyY3VtZmxleGRvdGJlbG93ID0gMHgxZWFjOwogIHQuQWNpcmN1bWZsZXhncmF2ZSA9IDB4MWVhNjsKICB0LkFjaXJjdW1mbGV4aG9va2Fib3ZlID0gMHgxZWE4OwogIHQuQWNpcmN1bWZsZXhzbWFsbCA9IDB4ZjdlMjsKICB0LkFjaXJjdW1mbGV4dGlsZGUgPSAweDFlYWE7CiAgdC5BY3V0ZSA9IDB4ZjZjOTsKICB0LkFjdXRlc21hbGwgPSAweGY3YjQ7CiAgdC5BY3lyaWxsaWMgPSAweDA0MTA7CiAgdC5BZGJsZ3JhdmUgPSAweDAyMDA7CiAgdC5BZGllcmVzaXMgPSAweDAwYzQ7CiAgdC5BZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkMjsKICB0LkFkaWVyZXNpc21hY3JvbiA9IDB4MDFkZTsKICB0LkFkaWVyZXNpc3NtYWxsID0gMHhmN2U0OwogIHQuQWRvdGJlbG93ID0gMHgxZWEwOwogIHQuQWRvdG1hY3JvbiA9IDB4MDFlMDsKICB0LkFncmF2ZSA9IDB4MDBjMDsKICB0LkFncmF2ZXNtYWxsID0gMHhmN2UwOwogIHQuQWhvb2thYm92ZSA9IDB4MWVhMjsKICB0LkFpZWN5cmlsbGljID0gMHgwNGQ0OwogIHQuQWludmVydGVkYnJldmUgPSAweDAyMDI7CiAgdC5BbHBoYSA9IDB4MDM5MTsKICB0LkFscGhhdG9ub3MgPSAweDAzODY7CiAgdC5BbWFjcm9uID0gMHgwMTAwOwogIHQuQW1vbm9zcGFjZSA9IDB4ZmYyMTsKICB0LkFvZ29uZWsgPSAweDAxMDQ7CiAgdC5BcmluZyA9IDB4MDBjNTsKICB0LkFyaW5nYWN1dGUgPSAweDAxZmE7CiAgdC5BcmluZ2JlbG93ID0gMHgxZTAwOwogIHQuQXJpbmdzbWFsbCA9IDB4ZjdlNTsKICB0LkFzbWFsbCA9IDB4Zjc2MTsKICB0LkF0aWxkZSA9IDB4MDBjMzsKICB0LkF0aWxkZXNtYWxsID0gMHhmN2UzOwogIHQuQXliYXJtZW5pYW4gPSAweDA1MzE7CiAgdC5CID0gMHgwMDQyOwogIHQuQmNpcmNsZSA9IDB4MjRiNzsKICB0LkJkb3RhY2NlbnQgPSAweDFlMDI7CiAgdC5CZG90YmVsb3cgPSAweDFlMDQ7CiAgdC5CZWN5cmlsbGljID0gMHgwNDExOwogIHQuQmVuYXJtZW5pYW4gPSAweDA1MzI7CiAgdC5CZXRhID0gMHgwMzkyOwogIHQuQmhvb2sgPSAweDAxODE7CiAgdC5CbGluZWJlbG93ID0gMHgxZTA2OwogIHQuQm1vbm9zcGFjZSA9IDB4ZmYyMjsKICB0LkJyZXZlc21hbGwgPSAweGY2ZjQ7CiAgdC5Cc21hbGwgPSAweGY3NjI7CiAgdC5CdG9wYmFyID0gMHgwMTgyOwogIHQuQyA9IDB4MDA0MzsKICB0LkNhYXJtZW5pYW4gPSAweDA1M2U7CiAgdC5DYWN1dGUgPSAweDAxMDY7CiAgdC5DYXJvbiA9IDB4ZjZjYTsKICB0LkNhcm9uc21hbGwgPSAweGY2ZjU7CiAgdC5DY2Fyb24gPSAweDAxMGM7CiAgdC5DY2VkaWxsYSA9IDB4MDBjNzsKICB0LkNjZWRpbGxhYWN1dGUgPSAweDFlMDg7CiAgdC5DY2VkaWxsYXNtYWxsID0gMHhmN2U3OwogIHQuQ2NpcmNsZSA9IDB4MjRiODsKICB0LkNjaXJjdW1mbGV4ID0gMHgwMTA4OwogIHQuQ2RvdCA9IDB4MDEwYTsKICB0LkNkb3RhY2NlbnQgPSAweDAxMGE7CiAgdC5DZWRpbGxhc21hbGwgPSAweGY3Yjg7CiAgdC5DaGFhcm1lbmlhbiA9IDB4MDU0OTsKICB0LkNoZWFia2hhc2lhbmN5cmlsbGljID0gMHgwNGJjOwogIHQuQ2hlY3lyaWxsaWMgPSAweDA0Mjc7CiAgdC5DaGVkZXNjZW5kZXJhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRiZTsKICB0LkNoZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGI2OwogIHQuQ2hlZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRmNDsKICB0LkNoZWhhcm1lbmlhbiA9IDB4MDU0MzsKICB0LkNoZWtoYWthc3NpYW5jeXJpbGxpYyA9IDB4MDRjYjsKICB0LkNoZXZlcnRpY2Fsc3Ryb2tlY3lyaWxsaWMgPSAweDA0Yjg7CiAgdC5DaGkgPSAweDAzYTc7CiAgdC5DaG9vayA9IDB4MDE4NzsKICB0LkNpcmN1bWZsZXhzbWFsbCA9IDB4ZjZmNjsKICB0LkNtb25vc3BhY2UgPSAweGZmMjM7CiAgdC5Db2FybWVuaWFuID0gMHgwNTUxOwogIHQuQ3NtYWxsID0gMHhmNzYzOwogIHQuRCA9IDB4MDA0NDsKICB0LkRaID0gMHgwMWYxOwogIHQuRFpjYXJvbiA9IDB4MDFjNDsKICB0LkRhYXJtZW5pYW4gPSAweDA1MzQ7CiAgdC5EYWZyaWNhbiA9IDB4MDE4OTsKICB0LkRjYXJvbiA9IDB4MDEwZTsKICB0LkRjZWRpbGxhID0gMHgxZTEwOwogIHQuRGNpcmNsZSA9IDB4MjRiOTsKICB0LkRjaXJjdW1mbGV4YmVsb3cgPSAweDFlMTI7CiAgdC5EY3JvYXQgPSAweDAxMTA7CiAgdC5EZG90YWNjZW50ID0gMHgxZTBhOwogIHQuRGRvdGJlbG93ID0gMHgxZTBjOwogIHQuRGVjeXJpbGxpYyA9IDB4MDQxNDsKICB0LkRlaWNvcHRpYyA9IDB4MDNlZTsKICB0LkRlbHRhID0gMHgyMjA2OwogIHQuRGVsdGFncmVlayA9IDB4MDM5NDsKICB0LkRob29rID0gMHgwMThhOwogIHQuRGllcmVzaXMgPSAweGY2Y2I7CiAgdC5EaWVyZXNpc0FjdXRlID0gMHhmNmNjOwogIHQuRGllcmVzaXNHcmF2ZSA9IDB4ZjZjZDsKICB0LkRpZXJlc2lzc21hbGwgPSAweGY3YTg7CiAgdC5EaWdhbW1hZ3JlZWsgPSAweDAzZGM7CiAgdC5EamVjeXJpbGxpYyA9IDB4MDQwMjsKICB0LkRsaW5lYmVsb3cgPSAweDFlMGU7CiAgdC5EbW9ub3NwYWNlID0gMHhmZjI0OwogIHQuRG90YWNjZW50c21hbGwgPSAweGY2Zjc7CiAgdC5Ec2xhc2ggPSAweDAxMTA7CiAgdC5Ec21hbGwgPSAweGY3NjQ7CiAgdC5EdG9wYmFyID0gMHgwMThiOwogIHQuRHogPSAweDAxZjI7CiAgdC5EemNhcm9uID0gMHgwMWM1OwogIHQuRHplYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0ZTA7CiAgdC5EemVjeXJpbGxpYyA9IDB4MDQwNTsKICB0LkR6aGVjeXJpbGxpYyA9IDB4MDQwZjsKICB0LkUgPSAweDAwNDU7CiAgdC5FYWN1dGUgPSAweDAwYzk7CiAgdC5FYWN1dGVzbWFsbCA9IDB4ZjdlOTsKICB0LkVicmV2ZSA9IDB4MDExNDsKICB0LkVjYXJvbiA9IDB4MDExYTsKICB0LkVjZWRpbGxhYnJldmUgPSAweDFlMWM7CiAgdC5FY2hhcm1lbmlhbiA9IDB4MDUzNTsKICB0LkVjaXJjbGUgPSAweDI0YmE7CiAgdC5FY2lyY3VtZmxleCA9IDB4MDBjYTsKICB0LkVjaXJjdW1mbGV4YWN1dGUgPSAweDFlYmU7CiAgdC5FY2lyY3VtZmxleGJlbG93ID0gMHgxZTE4OwogIHQuRWNpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVjNjsKICB0LkVjaXJjdW1mbGV4Z3JhdmUgPSAweDFlYzA7CiAgdC5FY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVjMjsKICB0LkVjaXJjdW1mbGV4c21hbGwgPSAweGY3ZWE7CiAgdC5FY2lyY3VtZmxleHRpbGRlID0gMHgxZWM0OwogIHQuRWN5cmlsbGljID0gMHgwNDA0OwogIHQuRWRibGdyYXZlID0gMHgwMjA0OwogIHQuRWRpZXJlc2lzID0gMHgwMGNiOwogIHQuRWRpZXJlc2lzc21hbGwgPSAweGY3ZWI7CiAgdC5FZG90ID0gMHgwMTE2OwogIHQuRWRvdGFjY2VudCA9IDB4MDExNjsKICB0LkVkb3RiZWxvdyA9IDB4MWViODsKICB0LkVmY3lyaWxsaWMgPSAweDA0MjQ7CiAgdC5FZ3JhdmUgPSAweDAwYzg7CiAgdC5FZ3JhdmVzbWFsbCA9IDB4ZjdlODsKICB0LkVoYXJtZW5pYW4gPSAweDA1Mzc7CiAgdC5FaG9va2Fib3ZlID0gMHgxZWJhOwogIHQuRWlnaHRyb21hbiA9IDB4MjE2NzsKICB0LkVpbnZlcnRlZGJyZXZlID0gMHgwMjA2OwogIHQuRWlvdGlmaWVkY3lyaWxsaWMgPSAweDA0NjQ7CiAgdC5FbGN5cmlsbGljID0gMHgwNDFiOwogIHQuRWxldmVucm9tYW4gPSAweDIxNmE7CiAgdC5FbWFjcm9uID0gMHgwMTEyOwogIHQuRW1hY3JvbmFjdXRlID0gMHgxZTE2OwogIHQuRW1hY3JvbmdyYXZlID0gMHgxZTE0OwogIHQuRW1jeXJpbGxpYyA9IDB4MDQxYzsKICB0LkVtb25vc3BhY2UgPSAweGZmMjU7CiAgdC5FbmN5cmlsbGljID0gMHgwNDFkOwogIHQuRW5kZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhMjsKICB0LkVuZyA9IDB4MDE0YTsKICB0LkVuZ2hlY3lyaWxsaWMgPSAweDA0YTQ7CiAgdC5Fbmhvb2tjeXJpbGxpYyA9IDB4MDRjNzsKICB0LkVvZ29uZWsgPSAweDAxMTg7CiAgdC5Fb3BlbiA9IDB4MDE5MDsKICB0LkVwc2lsb24gPSAweDAzOTU7CiAgdC5FcHNpbG9udG9ub3MgPSAweDAzODg7CiAgdC5FcmN5cmlsbGljID0gMHgwNDIwOwogIHQuRXJldmVyc2VkID0gMHgwMThlOwogIHQuRXJldmVyc2VkY3lyaWxsaWMgPSAweDA0MmQ7CiAgdC5Fc2N5cmlsbGljID0gMHgwNDIxOwogIHQuRXNkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhYTsKICB0LkVzaCA9IDB4MDFhOTsKICB0LkVzbWFsbCA9IDB4Zjc2NTsKICB0LkV0YSA9IDB4MDM5NzsKICB0LkV0YXJtZW5pYW4gPSAweDA1Mzg7CiAgdC5FdGF0b25vcyA9IDB4MDM4OTsKICB0LkV0aCA9IDB4MDBkMDsKICB0LkV0aHNtYWxsID0gMHhmN2YwOwogIHQuRXRpbGRlID0gMHgxZWJjOwogIHQuRXRpbGRlYmVsb3cgPSAweDFlMWE7CiAgdC5FdXJvID0gMHgyMGFjOwogIHQuRXpoID0gMHgwMWI3OwogIHQuRXpoY2Fyb24gPSAweDAxZWU7CiAgdC5FemhyZXZlcnNlZCA9IDB4MDFiODsKICB0LkYgPSAweDAwNDY7CiAgdC5GY2lyY2xlID0gMHgyNGJiOwogIHQuRmRvdGFjY2VudCA9IDB4MWUxZTsKICB0LkZlaGFybWVuaWFuID0gMHgwNTU2OwogIHQuRmVpY29wdGljID0gMHgwM2U0OwogIHQuRmhvb2sgPSAweDAxOTE7CiAgdC5GaXRhY3lyaWxsaWMgPSAweDA0NzI7CiAgdC5GaXZlcm9tYW4gPSAweDIxNjQ7CiAgdC5GbW9ub3NwYWNlID0gMHhmZjI2OwogIHQuRm91cnJvbWFuID0gMHgyMTYzOwogIHQuRnNtYWxsID0gMHhmNzY2OwogIHQuRyA9IDB4MDA0NzsKICB0LkdCc3F1YXJlID0gMHgzMzg3OwogIHQuR2FjdXRlID0gMHgwMWY0OwogIHQuR2FtbWEgPSAweDAzOTM7CiAgdC5HYW1tYWFmcmljYW4gPSAweDAxOTQ7CiAgdC5HYW5naWFjb3B0aWMgPSAweDAzZWE7CiAgdC5HYnJldmUgPSAweDAxMWU7CiAgdC5HY2Fyb24gPSAweDAxZTY7CiAgdC5HY2VkaWxsYSA9IDB4MDEyMjsKICB0LkdjaXJjbGUgPSAweDI0YmM7CiAgdC5HY2lyY3VtZmxleCA9IDB4MDExYzsKICB0Lkdjb21tYWFjY2VudCA9IDB4MDEyMjsKICB0Lkdkb3QgPSAweDAxMjA7CiAgdC5HZG90YWNjZW50ID0gMHgwMTIwOwogIHQuR2VjeXJpbGxpYyA9IDB4MDQxMzsKICB0LkdoYWRhcm1lbmlhbiA9IDB4MDU0MjsKICB0LkdoZW1pZGRsZWhvb2tjeXJpbGxpYyA9IDB4MDQ5NDsKICB0LkdoZXN0cm9rZWN5cmlsbGljID0gMHgwNDkyOwogIHQuR2hldXB0dXJuY3lyaWxsaWMgPSAweDA0OTA7CiAgdC5HaG9vayA9IDB4MDE5MzsKICB0LkdpbWFybWVuaWFuID0gMHgwNTMzOwogIHQuR2plY3lyaWxsaWMgPSAweDA0MDM7CiAgdC5HbWFjcm9uID0gMHgxZTIwOwogIHQuR21vbm9zcGFjZSA9IDB4ZmYyNzsKICB0LkdyYXZlID0gMHhmNmNlOwogIHQuR3JhdmVzbWFsbCA9IDB4Zjc2MDsKICB0LkdzbWFsbCA9IDB4Zjc2NzsKICB0LkdzbWFsbGhvb2sgPSAweDAyOWI7CiAgdC5Hc3Ryb2tlID0gMHgwMWU0OwogIHQuSCA9IDB4MDA0ODsKICB0LkgxODUzMyA9IDB4MjVjZjsKICB0LkgxODU0MyA9IDB4MjVhYTsKICB0LkgxODU1MSA9IDB4MjVhYjsKICB0LkgyMjA3MyA9IDB4MjVhMTsKICB0LkhQc3F1YXJlID0gMHgzM2NiOwogIHQuSGFhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRhODsKICB0LkhhZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0YjI7CiAgdC5IYXJkc2lnbmN5cmlsbGljID0gMHgwNDJhOwogIHQuSGJhciA9IDB4MDEyNjsKICB0LkhicmV2ZWJlbG93ID0gMHgxZTJhOwogIHQuSGNlZGlsbGEgPSAweDFlMjg7CiAgdC5IY2lyY2xlID0gMHgyNGJkOwogIHQuSGNpcmN1bWZsZXggPSAweDAxMjQ7CiAgdC5IZGllcmVzaXMgPSAweDFlMjY7CiAgdC5IZG90YWNjZW50ID0gMHgxZTIyOwogIHQuSGRvdGJlbG93ID0gMHgxZTI0OwogIHQuSG1vbm9zcGFjZSA9IDB4ZmYyODsKICB0LkhvYXJtZW5pYW4gPSAweDA1NDA7CiAgdC5Ib3JpY29wdGljID0gMHgwM2U4OwogIHQuSHNtYWxsID0gMHhmNzY4OwogIHQuSHVuZ2FydW1sYXV0ID0gMHhmNmNmOwogIHQuSHVuZ2FydW1sYXV0c21hbGwgPSAweGY2Zjg7CiAgdC5IenNxdWFyZSA9IDB4MzM5MDsKICB0LkkgPSAweDAwNDk7CiAgdC5JQWN5cmlsbGljID0gMHgwNDJmOwogIHQuSUogPSAweDAxMzI7CiAgdC5JVWN5cmlsbGljID0gMHgwNDJlOwogIHQuSWFjdXRlID0gMHgwMGNkOwogIHQuSWFjdXRlc21hbGwgPSAweGY3ZWQ7CiAgdC5JYnJldmUgPSAweDAxMmM7CiAgdC5JY2Fyb24gPSAweDAxY2Y7CiAgdC5JY2lyY2xlID0gMHgyNGJlOwogIHQuSWNpcmN1bWZsZXggPSAweDAwY2U7CiAgdC5JY2lyY3VtZmxleHNtYWxsID0gMHhmN2VlOwogIHQuSWN5cmlsbGljID0gMHgwNDA2OwogIHQuSWRibGdyYXZlID0gMHgwMjA4OwogIHQuSWRpZXJlc2lzID0gMHgwMGNmOwogIHQuSWRpZXJlc2lzYWN1dGUgPSAweDFlMmU7CiAgdC5JZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRlNDsKICB0LklkaWVyZXNpc3NtYWxsID0gMHhmN2VmOwogIHQuSWRvdCA9IDB4MDEzMDsKICB0Lklkb3RhY2NlbnQgPSAweDAxMzA7CiAgdC5JZG90YmVsb3cgPSAweDFlY2E7CiAgdC5JZWJyZXZlY3lyaWxsaWMgPSAweDA0ZDY7CiAgdC5JZWN5cmlsbGljID0gMHgwNDE1OwogIHQuSWZyYWt0dXIgPSAweDIxMTE7CiAgdC5JZ3JhdmUgPSAweDAwY2M7CiAgdC5JZ3JhdmVzbWFsbCA9IDB4ZjdlYzsKICB0Lklob29rYWJvdmUgPSAweDFlYzg7CiAgdC5JaWN5cmlsbGljID0gMHgwNDE4OwogIHQuSWludmVydGVkYnJldmUgPSAweDAyMGE7CiAgdC5JaXNob3J0Y3lyaWxsaWMgPSAweDA0MTk7CiAgdC5JbWFjcm9uID0gMHgwMTJhOwogIHQuSW1hY3JvbmN5cmlsbGljID0gMHgwNGUyOwogIHQuSW1vbm9zcGFjZSA9IDB4ZmYyOTsKICB0LkluaWFybWVuaWFuID0gMHgwNTNiOwogIHQuSW9jeXJpbGxpYyA9IDB4MDQwMTsKICB0LklvZ29uZWsgPSAweDAxMmU7CiAgdC5Jb3RhID0gMHgwMzk5OwogIHQuSW90YWFmcmljYW4gPSAweDAxOTY7CiAgdC5Jb3RhZGllcmVzaXMgPSAweDAzYWE7CiAgdC5Jb3RhdG9ub3MgPSAweDAzOGE7CiAgdC5Jc21hbGwgPSAweGY3Njk7CiAgdC5Jc3Ryb2tlID0gMHgwMTk3OwogIHQuSXRpbGRlID0gMHgwMTI4OwogIHQuSXRpbGRlYmVsb3cgPSAweDFlMmM7CiAgdC5JemhpdHNhY3lyaWxsaWMgPSAweDA0NzQ7CiAgdC5JemhpdHNhZGJsZ3JhdmVjeXJpbGxpYyA9IDB4MDQ3NjsKICB0LkogPSAweDAwNGE7CiAgdC5KYWFybWVuaWFuID0gMHgwNTQxOwogIHQuSmNpcmNsZSA9IDB4MjRiZjsKICB0LkpjaXJjdW1mbGV4ID0gMHgwMTM0OwogIHQuSmVjeXJpbGxpYyA9IDB4MDQwODsKICB0LkpoZWhhcm1lbmlhbiA9IDB4MDU0YjsKICB0Lkptb25vc3BhY2UgPSAweGZmMmE7CiAgdC5Kc21hbGwgPSAweGY3NmE7CiAgdC5LID0gMHgwMDRiOwogIHQuS0JzcXVhcmUgPSAweDMzODU7CiAgdC5LS3NxdWFyZSA9IDB4MzNjZDsKICB0LkthYmFzaGtpcmN5cmlsbGljID0gMHgwNGEwOwogIHQuS2FjdXRlID0gMHgxZTMwOwogIHQuS2FjeXJpbGxpYyA9IDB4MDQxYTsKICB0LkthZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OWE7CiAgdC5LYWhvb2tjeXJpbGxpYyA9IDB4MDRjMzsKICB0LkthcHBhID0gMHgwMzlhOwogIHQuS2FzdHJva2VjeXJpbGxpYyA9IDB4MDQ5ZTsKICB0LkthdmVydGljYWxzdHJva2VjeXJpbGxpYyA9IDB4MDQ5YzsKICB0LktjYXJvbiA9IDB4MDFlODsKICB0LktjZWRpbGxhID0gMHgwMTM2OwogIHQuS2NpcmNsZSA9IDB4MjRjMDsKICB0Lktjb21tYWFjY2VudCA9IDB4MDEzNjsKICB0Lktkb3RiZWxvdyA9IDB4MWUzMjsKICB0LktlaGFybWVuaWFuID0gMHgwNTU0OwogIHQuS2VuYXJtZW5pYW4gPSAweDA1M2Y7CiAgdC5LaGFjeXJpbGxpYyA9IDB4MDQyNTsKICB0LktoZWljb3B0aWMgPSAweDAzZTY7CiAgdC5LaG9vayA9IDB4MDE5ODsKICB0LktqZWN5cmlsbGljID0gMHgwNDBjOwogIHQuS2xpbmViZWxvdyA9IDB4MWUzNDsKICB0Lkttb25vc3BhY2UgPSAweGZmMmI7CiAgdC5Lb3BwYWN5cmlsbGljID0gMHgwNDgwOwogIHQuS29wcGFncmVlayA9IDB4MDNkZTsKICB0LktzaWN5cmlsbGljID0gMHgwNDZlOwogIHQuS3NtYWxsID0gMHhmNzZiOwogIHQuTCA9IDB4MDA0YzsKICB0LkxKID0gMHgwMWM3OwogIHQuTEwgPSAweGY2YmY7CiAgdC5MYWN1dGUgPSAweDAxMzk7CiAgdC5MYW1iZGEgPSAweDAzOWI7CiAgdC5MY2Fyb24gPSAweDAxM2Q7CiAgdC5MY2VkaWxsYSA9IDB4MDEzYjsKICB0LkxjaXJjbGUgPSAweDI0YzE7CiAgdC5MY2lyY3VtZmxleGJlbG93ID0gMHgxZTNjOwogIHQuTGNvbW1hYWNjZW50ID0gMHgwMTNiOwogIHQuTGRvdCA9IDB4MDEzZjsKICB0Lkxkb3RhY2NlbnQgPSAweDAxM2Y7CiAgdC5MZG90YmVsb3cgPSAweDFlMzY7CiAgdC5MZG90YmVsb3dtYWNyb24gPSAweDFlMzg7CiAgdC5MaXduYXJtZW5pYW4gPSAweDA1M2M7CiAgdC5MaiA9IDB4MDFjODsKICB0LkxqZWN5cmlsbGljID0gMHgwNDA5OwogIHQuTGxpbmViZWxvdyA9IDB4MWUzYTsKICB0Lkxtb25vc3BhY2UgPSAweGZmMmM7CiAgdC5Mc2xhc2ggPSAweDAxNDE7CiAgdC5Mc2xhc2hzbWFsbCA9IDB4ZjZmOTsKICB0LkxzbWFsbCA9IDB4Zjc2YzsKICB0Lk0gPSAweDAwNGQ7CiAgdC5NQnNxdWFyZSA9IDB4MzM4NjsKICB0Lk1hY3JvbiA9IDB4ZjZkMDsKICB0Lk1hY3JvbnNtYWxsID0gMHhmN2FmOwogIHQuTWFjdXRlID0gMHgxZTNlOwogIHQuTWNpcmNsZSA9IDB4MjRjMjsKICB0Lk1kb3RhY2NlbnQgPSAweDFlNDA7CiAgdC5NZG90YmVsb3cgPSAweDFlNDI7CiAgdC5NZW5hcm1lbmlhbiA9IDB4MDU0NDsKICB0Lk1tb25vc3BhY2UgPSAweGZmMmQ7CiAgdC5Nc21hbGwgPSAweGY3NmQ7CiAgdC5NdHVybmVkID0gMHgwMTljOwogIHQuTXUgPSAweDAzOWM7CiAgdC5OID0gMHgwMDRlOwogIHQuTkogPSAweDAxY2E7CiAgdC5OYWN1dGUgPSAweDAxNDM7CiAgdC5OY2Fyb24gPSAweDAxNDc7CiAgdC5OY2VkaWxsYSA9IDB4MDE0NTsKICB0Lk5jaXJjbGUgPSAweDI0YzM7CiAgdC5OY2lyY3VtZmxleGJlbG93ID0gMHgxZTRhOwogIHQuTmNvbW1hYWNjZW50ID0gMHgwMTQ1OwogIHQuTmRvdGFjY2VudCA9IDB4MWU0NDsKICB0Lk5kb3RiZWxvdyA9IDB4MWU0NjsKICB0Lk5ob29rbGVmdCA9IDB4MDE5ZDsKICB0Lk5pbmVyb21hbiA9IDB4MjE2ODsKICB0Lk5qID0gMHgwMWNiOwogIHQuTmplY3lyaWxsaWMgPSAweDA0MGE7CiAgdC5ObGluZWJlbG93ID0gMHgxZTQ4OwogIHQuTm1vbm9zcGFjZSA9IDB4ZmYyZTsKICB0Lk5vd2FybWVuaWFuID0gMHgwNTQ2OwogIHQuTnNtYWxsID0gMHhmNzZlOwogIHQuTnRpbGRlID0gMHgwMGQxOwogIHQuTnRpbGRlc21hbGwgPSAweGY3ZjE7CiAgdC5OdSA9IDB4MDM5ZDsKICB0Lk8gPSAweDAwNGY7CiAgdC5PRSA9IDB4MDE1MjsKICB0Lk9Fc21hbGwgPSAweGY2ZmE7CiAgdC5PYWN1dGUgPSAweDAwZDM7CiAgdC5PYWN1dGVzbWFsbCA9IDB4ZjdmMzsKICB0Lk9iYXJyZWRjeXJpbGxpYyA9IDB4MDRlODsKICB0Lk9iYXJyZWRkaWVyZXNpc2N5cmlsbGljID0gMHgwNGVhOwogIHQuT2JyZXZlID0gMHgwMTRlOwogIHQuT2Nhcm9uID0gMHgwMWQxOwogIHQuT2NlbnRlcmVkdGlsZGUgPSAweDAxOWY7CiAgdC5PY2lyY2xlID0gMHgyNGM0OwogIHQuT2NpcmN1bWZsZXggPSAweDAwZDQ7CiAgdC5PY2lyY3VtZmxleGFjdXRlID0gMHgxZWQwOwogIHQuT2NpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVkODsKICB0Lk9jaXJjdW1mbGV4Z3JhdmUgPSAweDFlZDI7CiAgdC5PY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVkNDsKICB0Lk9jaXJjdW1mbGV4c21hbGwgPSAweGY3ZjQ7CiAgdC5PY2lyY3VtZmxleHRpbGRlID0gMHgxZWQ2OwogIHQuT2N5cmlsbGljID0gMHgwNDFlOwogIHQuT2RibGFjdXRlID0gMHgwMTUwOwogIHQuT2RibGdyYXZlID0gMHgwMjBjOwogIHQuT2RpZXJlc2lzID0gMHgwMGQ2OwogIHQuT2RpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZTY7CiAgdC5PZGllcmVzaXNzbWFsbCA9IDB4ZjdmNjsKICB0Lk9kb3RiZWxvdyA9IDB4MWVjYzsKICB0Lk9nb25la3NtYWxsID0gMHhmNmZiOwogIHQuT2dyYXZlID0gMHgwMGQyOwogIHQuT2dyYXZlc21hbGwgPSAweGY3ZjI7CiAgdC5PaGFybWVuaWFuID0gMHgwNTU1OwogIHQuT2htID0gMHgyMTI2OwogIHQuT2hvb2thYm92ZSA9IDB4MWVjZTsKICB0Lk9ob3JuID0gMHgwMWEwOwogIHQuT2hvcm5hY3V0ZSA9IDB4MWVkYTsKICB0Lk9ob3JuZG90YmVsb3cgPSAweDFlZTI7CiAgdC5PaG9ybmdyYXZlID0gMHgxZWRjOwogIHQuT2hvcm5ob29rYWJvdmUgPSAweDFlZGU7CiAgdC5PaG9ybnRpbGRlID0gMHgxZWUwOwogIHQuT2h1bmdhcnVtbGF1dCA9IDB4MDE1MDsKICB0Lk9pID0gMHgwMWEyOwogIHQuT2ludmVydGVkYnJldmUgPSAweDAyMGU7CiAgdC5PbWFjcm9uID0gMHgwMTRjOwogIHQuT21hY3JvbmFjdXRlID0gMHgxZTUyOwogIHQuT21hY3JvbmdyYXZlID0gMHgxZTUwOwogIHQuT21lZ2EgPSAweDIxMjY7CiAgdC5PbWVnYWN5cmlsbGljID0gMHgwNDYwOwogIHQuT21lZ2FncmVlayA9IDB4MDNhOTsKICB0Lk9tZWdhcm91bmRjeXJpbGxpYyA9IDB4MDQ3YTsKICB0Lk9tZWdhdGl0bG9jeXJpbGxpYyA9IDB4MDQ3YzsKICB0Lk9tZWdhdG9ub3MgPSAweDAzOGY7CiAgdC5PbWljcm9uID0gMHgwMzlmOwogIHQuT21pY3JvbnRvbm9zID0gMHgwMzhjOwogIHQuT21vbm9zcGFjZSA9IDB4ZmYyZjsKICB0Lk9uZXJvbWFuID0gMHgyMTYwOwogIHQuT29nb25layA9IDB4MDFlYTsKICB0Lk9vZ29uZWttYWNyb24gPSAweDAxZWM7CiAgdC5Pb3BlbiA9IDB4MDE4NjsKICB0Lk9zbGFzaCA9IDB4MDBkODsKICB0Lk9zbGFzaGFjdXRlID0gMHgwMWZlOwogIHQuT3NsYXNoc21hbGwgPSAweGY3Zjg7CiAgdC5Pc21hbGwgPSAweGY3NmY7CiAgdC5Pc3Ryb2tlYWN1dGUgPSAweDAxZmU7CiAgdC5PdGN5cmlsbGljID0gMHgwNDdlOwogIHQuT3RpbGRlID0gMHgwMGQ1OwogIHQuT3RpbGRlYWN1dGUgPSAweDFlNGM7CiAgdC5PdGlsZGVkaWVyZXNpcyA9IDB4MWU0ZTsKICB0Lk90aWxkZXNtYWxsID0gMHhmN2Y1OwogIHQuUCA9IDB4MDA1MDsKICB0LlBhY3V0ZSA9IDB4MWU1NDsKICB0LlBjaXJjbGUgPSAweDI0YzU7CiAgdC5QZG90YWNjZW50ID0gMHgxZTU2OwogIHQuUGVjeXJpbGxpYyA9IDB4MDQxZjsKICB0LlBlaGFybWVuaWFuID0gMHgwNTRhOwogIHQuUGVtaWRkbGVob29rY3lyaWxsaWMgPSAweDA0YTY7CiAgdC5QaGkgPSAweDAzYTY7CiAgdC5QaG9vayA9IDB4MDFhNDsKICB0LlBpID0gMHgwM2EwOwogIHQuUGl3cmFybWVuaWFuID0gMHgwNTUzOwogIHQuUG1vbm9zcGFjZSA9IDB4ZmYzMDsKICB0LlBzaSA9IDB4MDNhODsKICB0LlBzaWN5cmlsbGljID0gMHgwNDcwOwogIHQuUHNtYWxsID0gMHhmNzcwOwogIHQuUSA9IDB4MDA1MTsKICB0LlFjaXJjbGUgPSAweDI0YzY7CiAgdC5RbW9ub3NwYWNlID0gMHhmZjMxOwogIHQuUXNtYWxsID0gMHhmNzcxOwogIHQuUiA9IDB4MDA1MjsKICB0LlJhYXJtZW5pYW4gPSAweDA1NGM7CiAgdC5SYWN1dGUgPSAweDAxNTQ7CiAgdC5SY2Fyb24gPSAweDAxNTg7CiAgdC5SY2VkaWxsYSA9IDB4MDE1NjsKICB0LlJjaXJjbGUgPSAweDI0Yzc7CiAgdC5SY29tbWFhY2NlbnQgPSAweDAxNTY7CiAgdC5SZGJsZ3JhdmUgPSAweDAyMTA7CiAgdC5SZG90YWNjZW50ID0gMHgxZTU4OwogIHQuUmRvdGJlbG93ID0gMHgxZTVhOwogIHQuUmRvdGJlbG93bWFjcm9uID0gMHgxZTVjOwogIHQuUmVoYXJtZW5pYW4gPSAweDA1NTA7CiAgdC5SZnJha3R1ciA9IDB4MjExYzsKICB0LlJobyA9IDB4MDNhMTsKICB0LlJpbmdzbWFsbCA9IDB4ZjZmYzsKICB0LlJpbnZlcnRlZGJyZXZlID0gMHgwMjEyOwogIHQuUmxpbmViZWxvdyA9IDB4MWU1ZTsKICB0LlJtb25vc3BhY2UgPSAweGZmMzI7CiAgdC5Sc21hbGwgPSAweGY3NzI7CiAgdC5Sc21hbGxpbnZlcnRlZCA9IDB4MDI4MTsKICB0LlJzbWFsbGludmVydGVkc3VwZXJpb3IgPSAweDAyYjY7CiAgdC5TID0gMHgwMDUzOwogIHQuU0YwMTAwMDAgPSAweDI1MGM7CiAgdC5TRjAyMDAwMCA9IDB4MjUxNDsKICB0LlNGMDMwMDAwID0gMHgyNTEwOwogIHQuU0YwNDAwMDAgPSAweDI1MTg7CiAgdC5TRjA1MDAwMCA9IDB4MjUzYzsKICB0LlNGMDYwMDAwID0gMHgyNTJjOwogIHQuU0YwNzAwMDAgPSAweDI1MzQ7CiAgdC5TRjA4MDAwMCA9IDB4MjUxYzsKICB0LlNGMDkwMDAwID0gMHgyNTI0OwogIHQuU0YxMDAwMDAgPSAweDI1MDA7CiAgdC5TRjExMDAwMCA9IDB4MjUwMjsKICB0LlNGMTkwMDAwID0gMHgyNTYxOwogIHQuU0YyMDAwMDAgPSAweDI1NjI7CiAgdC5TRjIxMDAwMCA9IDB4MjU1NjsKICB0LlNGMjIwMDAwID0gMHgyNTU1OwogIHQuU0YyMzAwMDAgPSAweDI1NjM7CiAgdC5TRjI0MDAwMCA9IDB4MjU1MTsKICB0LlNGMjUwMDAwID0gMHgyNTU3OwogIHQuU0YyNjAwMDAgPSAweDI1NWQ7CiAgdC5TRjI3MDAwMCA9IDB4MjU1YzsKICB0LlNGMjgwMDAwID0gMHgyNTViOwogIHQuU0YzNjAwMDAgPSAweDI1NWU7CiAgdC5TRjM3MDAwMCA9IDB4MjU1ZjsKICB0LlNGMzgwMDAwID0gMHgyNTVhOwogIHQuU0YzOTAwMDAgPSAweDI1NTQ7CiAgdC5TRjQwMDAwMCA9IDB4MjU2OTsKICB0LlNGNDEwMDAwID0gMHgyNTY2OwogIHQuU0Y0MjAwMDAgPSAweDI1NjA7CiAgdC5TRjQzMDAwMCA9IDB4MjU1MDsKICB0LlNGNDQwMDAwID0gMHgyNTZjOwogIHQuU0Y0NTAwMDAgPSAweDI1Njc7CiAgdC5TRjQ2MDAwMCA9IDB4MjU2ODsKICB0LlNGNDcwMDAwID0gMHgyNTY0OwogIHQuU0Y0ODAwMDAgPSAweDI1NjU7CiAgdC5TRjQ5MDAwMCA9IDB4MjU1OTsKICB0LlNGNTAwMDAwID0gMHgyNTU4OwogIHQuU0Y1MTAwMDAgPSAweDI1NTI7CiAgdC5TRjUyMDAwMCA9IDB4MjU1MzsKICB0LlNGNTMwMDAwID0gMHgyNTZiOwogIHQuU0Y1NDAwMDAgPSAweDI1NmE7CiAgdC5TYWN1dGUgPSAweDAxNWE7CiAgdC5TYWN1dGVkb3RhY2NlbnQgPSAweDFlNjQ7CiAgdC5TYW1waWdyZWVrID0gMHgwM2UwOwogIHQuU2Nhcm9uID0gMHgwMTYwOwogIHQuU2Nhcm9uZG90YWNjZW50ID0gMHgxZTY2OwogIHQuU2Nhcm9uc21hbGwgPSAweGY2ZmQ7CiAgdC5TY2VkaWxsYSA9IDB4MDE1ZTsKICB0LlNjaHdhID0gMHgwMThmOwogIHQuU2Nod2FjeXJpbGxpYyA9IDB4MDRkODsKICB0LlNjaHdhZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkYTsKICB0LlNjaXJjbGUgPSAweDI0Yzg7CiAgdC5TY2lyY3VtZmxleCA9IDB4MDE1YzsKICB0LlNjb21tYWFjY2VudCA9IDB4MDIxODsKICB0LlNkb3RhY2NlbnQgPSAweDFlNjA7CiAgdC5TZG90YmVsb3cgPSAweDFlNjI7CiAgdC5TZG90YmVsb3dkb3RhY2NlbnQgPSAweDFlNjg7CiAgdC5TZWhhcm1lbmlhbiA9IDB4MDU0ZDsKICB0LlNldmVucm9tYW4gPSAweDIxNjY7CiAgdC5TaGFhcm1lbmlhbiA9IDB4MDU0NzsKICB0LlNoYWN5cmlsbGljID0gMHgwNDI4OwogIHQuU2hjaGFjeXJpbGxpYyA9IDB4MDQyOTsKICB0LlNoZWljb3B0aWMgPSAweDAzZTI7CiAgdC5TaGhhY3lyaWxsaWMgPSAweDA0YmE7CiAgdC5TaGltYWNvcHRpYyA9IDB4MDNlYzsKICB0LlNpZ21hID0gMHgwM2EzOwogIHQuU2l4cm9tYW4gPSAweDIxNjU7CiAgdC5TbW9ub3NwYWNlID0gMHhmZjMzOwogIHQuU29mdHNpZ25jeXJpbGxpYyA9IDB4MDQyYzsKICB0LlNzbWFsbCA9IDB4Zjc3MzsKICB0LlN0aWdtYWdyZWVrID0gMHgwM2RhOwogIHQuVCA9IDB4MDA1NDsKICB0LlRhdSA9IDB4MDNhNDsKICB0LlRiYXIgPSAweDAxNjY7CiAgdC5UY2Fyb24gPSAweDAxNjQ7CiAgdC5UY2VkaWxsYSA9IDB4MDE2MjsKICB0LlRjaXJjbGUgPSAweDI0Yzk7CiAgdC5UY2lyY3VtZmxleGJlbG93ID0gMHgxZTcwOwogIHQuVGNvbW1hYWNjZW50ID0gMHgwMTYyOwogIHQuVGRvdGFjY2VudCA9IDB4MWU2YTsKICB0LlRkb3RiZWxvdyA9IDB4MWU2YzsKICB0LlRlY3lyaWxsaWMgPSAweDA0MjI7CiAgdC5UZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFjOwogIHQuVGVucm9tYW4gPSAweDIxNjk7CiAgdC5UZXRzZWN5cmlsbGljID0gMHgwNGI0OwogIHQuVGhldGEgPSAweDAzOTg7CiAgdC5UaG9vayA9IDB4MDFhYzsKICB0LlRob3JuID0gMHgwMGRlOwogIHQuVGhvcm5zbWFsbCA9IDB4ZjdmZTsKICB0LlRocmVlcm9tYW4gPSAweDIxNjI7CiAgdC5UaWxkZXNtYWxsID0gMHhmNmZlOwogIHQuVGl3bmFybWVuaWFuID0gMHgwNTRmOwogIHQuVGxpbmViZWxvdyA9IDB4MWU2ZTsKICB0LlRtb25vc3BhY2UgPSAweGZmMzQ7CiAgdC5Ub2FybWVuaWFuID0gMHgwNTM5OwogIHQuVG9uZWZpdmUgPSAweDAxYmM7CiAgdC5Ub25lc2l4ID0gMHgwMTg0OwogIHQuVG9uZXR3byA9IDB4MDFhNzsKICB0LlRyZXRyb2ZsZXhob29rID0gMHgwMWFlOwogIHQuVHNlY3lyaWxsaWMgPSAweDA0MjY7CiAgdC5Uc2hlY3lyaWxsaWMgPSAweDA0MGI7CiAgdC5Uc21hbGwgPSAweGY3NzQ7CiAgdC5Ud2VsdmVyb21hbiA9IDB4MjE2YjsKICB0LlR3b3JvbWFuID0gMHgyMTYxOwogIHQuVSA9IDB4MDA1NTsKICB0LlVhY3V0ZSA9IDB4MDBkYTsKICB0LlVhY3V0ZXNtYWxsID0gMHhmN2ZhOwogIHQuVWJyZXZlID0gMHgwMTZjOwogIHQuVWNhcm9uID0gMHgwMWQzOwogIHQuVWNpcmNsZSA9IDB4MjRjYTsKICB0LlVjaXJjdW1mbGV4ID0gMHgwMGRiOwogIHQuVWNpcmN1bWZsZXhiZWxvdyA9IDB4MWU3NjsKICB0LlVjaXJjdW1mbGV4c21hbGwgPSAweGY3ZmI7CiAgdC5VY3lyaWxsaWMgPSAweDA0MjM7CiAgdC5VZGJsYWN1dGUgPSAweDAxNzA7CiAgdC5VZGJsZ3JhdmUgPSAweDAyMTQ7CiAgdC5VZGllcmVzaXMgPSAweDAwZGM7CiAgdC5VZGllcmVzaXNhY3V0ZSA9IDB4MDFkNzsKICB0LlVkaWVyZXNpc2JlbG93ID0gMHgxZTcyOwogIHQuVWRpZXJlc2lzY2Fyb24gPSAweDAxZDk7CiAgdC5VZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRmMDsKICB0LlVkaWVyZXNpc2dyYXZlID0gMHgwMWRiOwogIHQuVWRpZXJlc2lzbWFjcm9uID0gMHgwMWQ1OwogIHQuVWRpZXJlc2lzc21hbGwgPSAweGY3ZmM7CiAgdC5VZG90YmVsb3cgPSAweDFlZTQ7CiAgdC5VZ3JhdmUgPSAweDAwZDk7CiAgdC5VZ3JhdmVzbWFsbCA9IDB4ZjdmOTsKICB0LlVob29rYWJvdmUgPSAweDFlZTY7CiAgdC5VaG9ybiA9IDB4MDFhZjsKICB0LlVob3JuYWN1dGUgPSAweDFlZTg7CiAgdC5VaG9ybmRvdGJlbG93ID0gMHgxZWYwOwogIHQuVWhvcm5ncmF2ZSA9IDB4MWVlYTsKICB0LlVob3JuaG9va2Fib3ZlID0gMHgxZWVjOwogIHQuVWhvcm50aWxkZSA9IDB4MWVlZTsKICB0LlVodW5nYXJ1bWxhdXQgPSAweDAxNzA7CiAgdC5VaHVuZ2FydW1sYXV0Y3lyaWxsaWMgPSAweDA0ZjI7CiAgdC5VaW52ZXJ0ZWRicmV2ZSA9IDB4MDIxNjsKICB0LlVrY3lyaWxsaWMgPSAweDA0Nzg7CiAgdC5VbWFjcm9uID0gMHgwMTZhOwogIHQuVW1hY3JvbmN5cmlsbGljID0gMHgwNGVlOwogIHQuVW1hY3JvbmRpZXJlc2lzID0gMHgxZTdhOwogIHQuVW1vbm9zcGFjZSA9IDB4ZmYzNTsKICB0LlVvZ29uZWsgPSAweDAxNzI7CiAgdC5VcHNpbG9uID0gMHgwM2E1OwogIHQuVXBzaWxvbjEgPSAweDAzZDI7CiAgdC5VcHNpbG9uYWN1dGVob29rc3ltYm9sZ3JlZWsgPSAweDAzZDM7CiAgdC5VcHNpbG9uYWZyaWNhbiA9IDB4MDFiMTsKICB0LlVwc2lsb25kaWVyZXNpcyA9IDB4MDNhYjsKICB0LlVwc2lsb25kaWVyZXNpc2hvb2tzeW1ib2xncmVlayA9IDB4MDNkNDsKICB0LlVwc2lsb25ob29rc3ltYm9sID0gMHgwM2QyOwogIHQuVXBzaWxvbnRvbm9zID0gMHgwMzhlOwogIHQuVXJpbmcgPSAweDAxNmU7CiAgdC5Vc2hvcnRjeXJpbGxpYyA9IDB4MDQwZTsKICB0LlVzbWFsbCA9IDB4Zjc3NTsKICB0LlVzdHJhaWdodGN5cmlsbGljID0gMHgwNGFlOwogIHQuVXN0cmFpZ2h0c3Ryb2tlY3lyaWxsaWMgPSAweDA0YjA7CiAgdC5VdGlsZGUgPSAweDAxNjg7CiAgdC5VdGlsZGVhY3V0ZSA9IDB4MWU3ODsKICB0LlV0aWxkZWJlbG93ID0gMHgxZTc0OwogIHQuViA9IDB4MDA1NjsKICB0LlZjaXJjbGUgPSAweDI0Y2I7CiAgdC5WZG90YmVsb3cgPSAweDFlN2U7CiAgdC5WZWN5cmlsbGljID0gMHgwNDEyOwogIHQuVmV3YXJtZW5pYW4gPSAweDA1NGU7CiAgdC5WaG9vayA9IDB4MDFiMjsKICB0LlZtb25vc3BhY2UgPSAweGZmMzY7CiAgdC5Wb2FybWVuaWFuID0gMHgwNTQ4OwogIHQuVnNtYWxsID0gMHhmNzc2OwogIHQuVnRpbGRlID0gMHgxZTdjOwogIHQuVyA9IDB4MDA1NzsKICB0LldhY3V0ZSA9IDB4MWU4MjsKICB0LldjaXJjbGUgPSAweDI0Y2M7CiAgdC5XY2lyY3VtZmxleCA9IDB4MDE3NDsKICB0LldkaWVyZXNpcyA9IDB4MWU4NDsKICB0Lldkb3RhY2NlbnQgPSAweDFlODY7CiAgdC5XZG90YmVsb3cgPSAweDFlODg7CiAgdC5XZ3JhdmUgPSAweDFlODA7CiAgdC5XbW9ub3NwYWNlID0gMHhmZjM3OwogIHQuV3NtYWxsID0gMHhmNzc3OwogIHQuWCA9IDB4MDA1ODsKICB0LlhjaXJjbGUgPSAweDI0Y2Q7CiAgdC5YZGllcmVzaXMgPSAweDFlOGM7CiAgdC5YZG90YWNjZW50ID0gMHgxZThhOwogIHQuWGVoYXJtZW5pYW4gPSAweDA1M2Q7CiAgdC5YaSA9IDB4MDM5ZTsKICB0Llhtb25vc3BhY2UgPSAweGZmMzg7CiAgdC5Yc21hbGwgPSAweGY3Nzg7CiAgdC5ZID0gMHgwMDU5OwogIHQuWWFjdXRlID0gMHgwMGRkOwogIHQuWWFjdXRlc21hbGwgPSAweGY3ZmQ7CiAgdC5ZYXRjeXJpbGxpYyA9IDB4MDQ2MjsKICB0LlljaXJjbGUgPSAweDI0Y2U7CiAgdC5ZY2lyY3VtZmxleCA9IDB4MDE3NjsKICB0LllkaWVyZXNpcyA9IDB4MDE3ODsKICB0LllkaWVyZXNpc3NtYWxsID0gMHhmN2ZmOwogIHQuWWRvdGFjY2VudCA9IDB4MWU4ZTsKICB0Lllkb3RiZWxvdyA9IDB4MWVmNDsKICB0LlllcmljeXJpbGxpYyA9IDB4MDQyYjsKICB0LlllcnVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY4OwogIHQuWWdyYXZlID0gMHgxZWYyOwogIHQuWWhvb2sgPSAweDAxYjM7CiAgdC5ZaG9va2Fib3ZlID0gMHgxZWY2OwogIHQuWWlhcm1lbmlhbiA9IDB4MDU0NTsKICB0LllpY3lyaWxsaWMgPSAweDA0MDc7CiAgdC5ZaXduYXJtZW5pYW4gPSAweDA1NTI7CiAgdC5ZbW9ub3NwYWNlID0gMHhmZjM5OwogIHQuWXNtYWxsID0gMHhmNzc5OwogIHQuWXRpbGRlID0gMHgxZWY4OwogIHQuWXVzYmlnY3lyaWxsaWMgPSAweDA0NmE7CiAgdC5ZdXNiaWdpb3RpZmllZGN5cmlsbGljID0gMHgwNDZjOwogIHQuWXVzbGl0dGxlY3lyaWxsaWMgPSAweDA0NjY7CiAgdC5ZdXNsaXR0bGVpb3RpZmllZGN5cmlsbGljID0gMHgwNDY4OwogIHQuWiA9IDB4MDA1YTsKICB0LlphYXJtZW5pYW4gPSAweDA1MzY7CiAgdC5aYWN1dGUgPSAweDAxNzk7CiAgdC5aY2Fyb24gPSAweDAxN2Q7CiAgdC5aY2Fyb25zbWFsbCA9IDB4ZjZmZjsKICB0LlpjaXJjbGUgPSAweDI0Y2Y7CiAgdC5aY2lyY3VtZmxleCA9IDB4MWU5MDsKICB0Llpkb3QgPSAweDAxN2I7CiAgdC5aZG90YWNjZW50ID0gMHgwMTdiOwogIHQuWmRvdGJlbG93ID0gMHgxZTkyOwogIHQuWmVjeXJpbGxpYyA9IDB4MDQxNzsKICB0LlplZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OTg7CiAgdC5aZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZGU7CiAgdC5aZXRhID0gMHgwMzk2OwogIHQuWmhlYXJtZW5pYW4gPSAweDA1M2E7CiAgdC5aaGVicmV2ZWN5cmlsbGljID0gMHgwNGMxOwogIHQuWmhlY3lyaWxsaWMgPSAweDA0MTY7CiAgdC5aaGVkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDQ5NjsKICB0LlpoZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZGM7CiAgdC5abGluZWJlbG93ID0gMHgxZTk0OwogIHQuWm1vbm9zcGFjZSA9IDB4ZmYzYTsKICB0LlpzbWFsbCA9IDB4Zjc3YTsKICB0LlpzdHJva2UgPSAweDAxYjU7CiAgdC5hID0gMHgwMDYxOwogIHQuYWFiZW5nYWxpID0gMHgwOTg2OwogIHQuYWFjdXRlID0gMHgwMGUxOwogIHQuYWFkZXZhID0gMHgwOTA2OwogIHQuYWFndWphcmF0aSA9IDB4MGE4NjsKICB0LmFhZ3VybXVraGkgPSAweDBhMDY7CiAgdC5hYW1hdHJhZ3VybXVraGkgPSAweDBhM2U7CiAgdC5hYXJ1c3F1YXJlID0gMHgzMzAzOwogIHQuYWF2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWJlOwogIHQuYWF2b3dlbHNpZ25kZXZhID0gMHgwOTNlOwogIHQuYWF2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFiZTsKICB0LmFiYnJldmlhdGlvbm1hcmthcm1lbmlhbiA9IDB4MDU1ZjsKICB0LmFiYnJldmlhdGlvbnNpZ25kZXZhID0gMHgwOTcwOwogIHQuYWJlbmdhbGkgPSAweDA5ODU7CiAgdC5hYm9wb21vZm8gPSAweDMxMWE7CiAgdC5hYnJldmUgPSAweDAxMDM7CiAgdC5hYnJldmVhY3V0ZSA9IDB4MWVhZjsKICB0LmFicmV2ZWN5cmlsbGljID0gMHgwNGQxOwogIHQuYWJyZXZlZG90YmVsb3cgPSAweDFlYjc7CiAgdC5hYnJldmVncmF2ZSA9IDB4MWViMTsKICB0LmFicmV2ZWhvb2thYm92ZSA9IDB4MWViMzsKICB0LmFicmV2ZXRpbGRlID0gMHgxZWI1OwogIHQuYWNhcm9uID0gMHgwMWNlOwogIHQuYWNpcmNsZSA9IDB4MjRkMDsKICB0LmFjaXJjdW1mbGV4ID0gMHgwMGUyOwogIHQuYWNpcmN1bWZsZXhhY3V0ZSA9IDB4MWVhNTsKICB0LmFjaXJjdW1mbGV4ZG90YmVsb3cgPSAweDFlYWQ7CiAgdC5hY2lyY3VtZmxleGdyYXZlID0gMHgxZWE3OwogIHQuYWNpcmN1bWZsZXhob29rYWJvdmUgPSAweDFlYTk7CiAgdC5hY2lyY3VtZmxleHRpbGRlID0gMHgxZWFiOwogIHQuYWN1dGUgPSAweDAwYjQ7CiAgdC5hY3V0ZWJlbG93Y21iID0gMHgwMzE3OwogIHQuYWN1dGVjbWIgPSAweDAzMDE7CiAgdC5hY3V0ZWNvbWIgPSAweDAzMDE7CiAgdC5hY3V0ZWRldmEgPSAweDA5NTQ7CiAgdC5hY3V0ZWxvd21vZCA9IDB4MDJjZjsKICB0LmFjdXRldG9uZWNtYiA9IDB4MDM0MTsKICB0LmFjeXJpbGxpYyA9IDB4MDQzMDsKICB0LmFkYmxncmF2ZSA9IDB4MDIwMTsKICB0LmFkZGFrZ3VybXVraGkgPSAweDBhNzE7CiAgdC5hZGV2YSA9IDB4MDkwNTsKICB0LmFkaWVyZXNpcyA9IDB4MDBlNDsKICB0LmFkaWVyZXNpc2N5cmlsbGljID0gMHgwNGQzOwogIHQuYWRpZXJlc2lzbWFjcm9uID0gMHgwMWRmOwogIHQuYWRvdGJlbG93ID0gMHgxZWExOwogIHQuYWRvdG1hY3JvbiA9IDB4MDFlMTsKICB0LmFlID0gMHgwMGU2OwogIHQuYWVhY3V0ZSA9IDB4MDFmZDsKICB0LmFla29yZWFuID0gMHgzMTUwOwogIHQuYWVtYWNyb24gPSAweDAxZTM7CiAgdC5hZmlpMDAyMDggPSAweDIwMTU7CiAgdC5hZmlpMDg5NDEgPSAweDIwYTQ7CiAgdC5hZmlpMTAwMTcgPSAweDA0MTA7CiAgdC5hZmlpMTAwMTggPSAweDA0MTE7CiAgdC5hZmlpMTAwMTkgPSAweDA0MTI7CiAgdC5hZmlpMTAwMjAgPSAweDA0MTM7CiAgdC5hZmlpMTAwMjEgPSAweDA0MTQ7CiAgdC5hZmlpMTAwMjIgPSAweDA0MTU7CiAgdC5hZmlpMTAwMjMgPSAweDA0MDE7CiAgdC5hZmlpMTAwMjQgPSAweDA0MTY7CiAgdC5hZmlpMTAwMjUgPSAweDA0MTc7CiAgdC5hZmlpMTAwMjYgPSAweDA0MTg7CiAgdC5hZmlpMTAwMjcgPSAweDA0MTk7CiAgdC5hZmlpMTAwMjggPSAweDA0MWE7CiAgdC5hZmlpMTAwMjkgPSAweDA0MWI7CiAgdC5hZmlpMTAwMzAgPSAweDA0MWM7CiAgdC5hZmlpMTAwMzEgPSAweDA0MWQ7CiAgdC5hZmlpMTAwMzIgPSAweDA0MWU7CiAgdC5hZmlpMTAwMzMgPSAweDA0MWY7CiAgdC5hZmlpMTAwMzQgPSAweDA0MjA7CiAgdC5hZmlpMTAwMzUgPSAweDA0MjE7CiAgdC5hZmlpMTAwMzYgPSAweDA0MjI7CiAgdC5hZmlpMTAwMzcgPSAweDA0MjM7CiAgdC5hZmlpMTAwMzggPSAweDA0MjQ7CiAgdC5hZmlpMTAwMzkgPSAweDA0MjU7CiAgdC5hZmlpMTAwNDAgPSAweDA0MjY7CiAgdC5hZmlpMTAwNDEgPSAweDA0Mjc7CiAgdC5hZmlpMTAwNDIgPSAweDA0Mjg7CiAgdC5hZmlpMTAwNDMgPSAweDA0Mjk7CiAgdC5hZmlpMTAwNDQgPSAweDA0MmE7CiAgdC5hZmlpMTAwNDUgPSAweDA0MmI7CiAgdC5hZmlpMTAwNDYgPSAweDA0MmM7CiAgdC5hZmlpMTAwNDcgPSAweDA0MmQ7CiAgdC5hZmlpMTAwNDggPSAweDA0MmU7CiAgdC5hZmlpMTAwNDkgPSAweDA0MmY7CiAgdC5hZmlpMTAwNTAgPSAweDA0OTA7CiAgdC5hZmlpMTAwNTEgPSAweDA0MDI7CiAgdC5hZmlpMTAwNTIgPSAweDA0MDM7CiAgdC5hZmlpMTAwNTMgPSAweDA0MDQ7CiAgdC5hZmlpMTAwNTQgPSAweDA0MDU7CiAgdC5hZmlpMTAwNTUgPSAweDA0MDY7CiAgdC5hZmlpMTAwNTYgPSAweDA0MDc7CiAgdC5hZmlpMTAwNTcgPSAweDA0MDg7CiAgdC5hZmlpMTAwNTggPSAweDA0MDk7CiAgdC5hZmlpMTAwNTkgPSAweDA0MGE7CiAgdC5hZmlpMTAwNjAgPSAweDA0MGI7CiAgdC5hZmlpMTAwNjEgPSAweDA0MGM7CiAgdC5hZmlpMTAwNjIgPSAweDA0MGU7CiAgdC5hZmlpMTAwNjMgPSAweGY2YzQ7CiAgdC5hZmlpMTAwNjQgPSAweGY2YzU7CiAgdC5hZmlpMTAwNjUgPSAweDA0MzA7CiAgdC5hZmlpMTAwNjYgPSAweDA0MzE7CiAgdC5hZmlpMTAwNjcgPSAweDA0MzI7CiAgdC5hZmlpMTAwNjggPSAweDA0MzM7CiAgdC5hZmlpMTAwNjkgPSAweDA0MzQ7CiAgdC5hZmlpMTAwNzAgPSAweDA0MzU7CiAgdC5hZmlpMTAwNzEgPSAweDA0NTE7CiAgdC5hZmlpMTAwNzIgPSAweDA0MzY7CiAgdC5hZmlpMTAwNzMgPSAweDA0Mzc7CiAgdC5hZmlpMTAwNzQgPSAweDA0Mzg7CiAgdC5hZmlpMTAwNzUgPSAweDA0Mzk7CiAgdC5hZmlpMTAwNzYgPSAweDA0M2E7CiAgdC5hZmlpMTAwNzcgPSAweDA0M2I7CiAgdC5hZmlpMTAwNzggPSAweDA0M2M7CiAgdC5hZmlpMTAwNzkgPSAweDA0M2Q7CiAgdC5hZmlpMTAwODAgPSAweDA0M2U7CiAgdC5hZmlpMTAwODEgPSAweDA0M2Y7CiAgdC5hZmlpMTAwODIgPSAweDA0NDA7CiAgdC5hZmlpMTAwODMgPSAweDA0NDE7CiAgdC5hZmlpMTAwODQgPSAweDA0NDI7CiAgdC5hZmlpMTAwODUgPSAweDA0NDM7CiAgdC5hZmlpMTAwODYgPSAweDA0NDQ7CiAgdC5hZmlpMTAwODcgPSAweDA0NDU7CiAgdC5hZmlpMTAwODggPSAweDA0NDY7CiAgdC5hZmlpMTAwODkgPSAweDA0NDc7CiAgdC5hZmlpMTAwOTAgPSAweDA0NDg7CiAgdC5hZmlpMTAwOTEgPSAweDA0NDk7CiAgdC5hZmlpMTAwOTIgPSAweDA0NGE7CiAgdC5hZmlpMTAwOTMgPSAweDA0NGI7CiAgdC5hZmlpMTAwOTQgPSAweDA0NGM7CiAgdC5hZmlpMTAwOTUgPSAweDA0NGQ7CiAgdC5hZmlpMTAwOTYgPSAweDA0NGU7CiAgdC5hZmlpMTAwOTcgPSAweDA0NGY7CiAgdC5hZmlpMTAwOTggPSAweDA0OTE7CiAgdC5hZmlpMTAwOTkgPSAweDA0NTI7CiAgdC5hZmlpMTAxMDAgPSAweDA0NTM7CiAgdC5hZmlpMTAxMDEgPSAweDA0NTQ7CiAgdC5hZmlpMTAxMDIgPSAweDA0NTU7CiAgdC5hZmlpMTAxMDMgPSAweDA0NTY7CiAgdC5hZmlpMTAxMDQgPSAweDA0NTc7CiAgdC5hZmlpMTAxMDUgPSAweDA0NTg7CiAgdC5hZmlpMTAxMDYgPSAweDA0NTk7CiAgdC5hZmlpMTAxMDcgPSAweDA0NWE7CiAgdC5hZmlpMTAxMDggPSAweDA0NWI7CiAgdC5hZmlpMTAxMDkgPSAweDA0NWM7CiAgdC5hZmlpMTAxMTAgPSAweDA0NWU7CiAgdC5hZmlpMTAxNDUgPSAweDA0MGY7CiAgdC5hZmlpMTAxNDYgPSAweDA0NjI7CiAgdC5hZmlpMTAxNDcgPSAweDA0NzI7CiAgdC5hZmlpMTAxNDggPSAweDA0NzQ7CiAgdC5hZmlpMTAxOTIgPSAweGY2YzY7CiAgdC5hZmlpMTAxOTMgPSAweDA0NWY7CiAgdC5hZmlpMTAxOTQgPSAweDA0NjM7CiAgdC5hZmlpMTAxOTUgPSAweDA0NzM7CiAgdC5hZmlpMTAxOTYgPSAweDA0NzU7CiAgdC5hZmlpMTA4MzEgPSAweGY2Yzc7CiAgdC5hZmlpMTA4MzIgPSAweGY2Yzg7CiAgdC5hZmlpMTA4NDYgPSAweDA0ZDk7CiAgdC5hZmlpMjk5ID0gMHgyMDBlOwogIHQuYWZpaTMwMCA9IDB4MjAwZjsKICB0LmFmaWkzMDEgPSAweDIwMGQ7CiAgdC5hZmlpNTczODEgPSAweDA2NmE7CiAgdC5hZmlpNTczODggPSAweDA2MGM7CiAgdC5hZmlpNTczOTIgPSAweDA2NjA7CiAgdC5hZmlpNTczOTMgPSAweDA2NjE7CiAgdC5hZmlpNTczOTQgPSAweDA2NjI7CiAgdC5hZmlpNTczOTUgPSAweDA2NjM7CiAgdC5hZmlpNTczOTYgPSAweDA2NjQ7CiAgdC5hZmlpNTczOTcgPSAweDA2NjU7CiAgdC5hZmlpNTczOTggPSAweDA2NjY7CiAgdC5hZmlpNTczOTkgPSAweDA2Njc7CiAgdC5hZmlpNTc0MDAgPSAweDA2Njg7CiAgdC5hZmlpNTc0MDEgPSAweDA2Njk7CiAgdC5hZmlpNTc0MDMgPSAweDA2MWI7CiAgdC5hZmlpNTc0MDcgPSAweDA2MWY7CiAgdC5hZmlpNTc0MDkgPSAweDA2MjE7CiAgdC5hZmlpNTc0MTAgPSAweDA2MjI7CiAgdC5hZmlpNTc0MTEgPSAweDA2MjM7CiAgdC5hZmlpNTc0MTIgPSAweDA2MjQ7CiAgdC5hZmlpNTc0MTMgPSAweDA2MjU7CiAgdC5hZmlpNTc0MTQgPSAweDA2MjY7CiAgdC5hZmlpNTc0MTUgPSAweDA2Mjc7CiAgdC5hZmlpNTc0MTYgPSAweDA2Mjg7CiAgdC5hZmlpNTc0MTcgPSAweDA2Mjk7CiAgdC5hZmlpNTc0MTggPSAweDA2MmE7CiAgdC5hZmlpNTc0MTkgPSAweDA2MmI7CiAgdC5hZmlpNTc0MjAgPSAweDA2MmM7CiAgdC5hZmlpNTc0MjEgPSAweDA2MmQ7CiAgdC5hZmlpNTc0MjIgPSAweDA2MmU7CiAgdC5hZmlpNTc0MjMgPSAweDA2MmY7CiAgdC5hZmlpNTc0MjQgPSAweDA2MzA7CiAgdC5hZmlpNTc0MjUgPSAweDA2MzE7CiAgdC5hZmlpNTc0MjYgPSAweDA2MzI7CiAgdC5hZmlpNTc0MjcgPSAweDA2MzM7CiAgdC5hZmlpNTc0MjggPSAweDA2MzQ7CiAgdC5hZmlpNTc0MjkgPSAweDA2MzU7CiAgdC5hZmlpNTc0MzAgPSAweDA2MzY7CiAgdC5hZmlpNTc0MzEgPSAweDA2Mzc7CiAgdC5hZmlpNTc0MzIgPSAweDA2Mzg7CiAgdC5hZmlpNTc0MzMgPSAweDA2Mzk7CiAgdC5hZmlpNTc0MzQgPSAweDA2M2E7CiAgdC5hZmlpNTc0NDAgPSAweDA2NDA7CiAgdC5hZmlpNTc0NDEgPSAweDA2NDE7CiAgdC5hZmlpNTc0NDIgPSAweDA2NDI7CiAgdC5hZmlpNTc0NDMgPSAweDA2NDM7CiAgdC5hZmlpNTc0NDQgPSAweDA2NDQ7CiAgdC5hZmlpNTc0NDUgPSAweDA2NDU7CiAgdC5hZmlpNTc0NDYgPSAweDA2NDY7CiAgdC5hZmlpNTc0NDggPSAweDA2NDg7CiAgdC5hZmlpNTc0NDkgPSAweDA2NDk7CiAgdC5hZmlpNTc0NTAgPSAweDA2NGE7CiAgdC5hZmlpNTc0NTEgPSAweDA2NGI7CiAgdC5hZmlpNTc0NTIgPSAweDA2NGM7CiAgdC5hZmlpNTc0NTMgPSAweDA2NGQ7CiAgdC5hZmlpNTc0NTQgPSAweDA2NGU7CiAgdC5hZmlpNTc0NTUgPSAweDA2NGY7CiAgdC5hZmlpNTc0NTYgPSAweDA2NTA7CiAgdC5hZmlpNTc0NTcgPSAweDA2NTE7CiAgdC5hZmlpNTc0NTggPSAweDA2NTI7CiAgdC5hZmlpNTc0NzAgPSAweDA2NDc7CiAgdC5hZmlpNTc1MDUgPSAweDA2YTQ7CiAgdC5hZmlpNTc1MDYgPSAweDA2N2U7CiAgdC5hZmlpNTc1MDcgPSAweDA2ODY7CiAgdC5hZmlpNTc1MDggPSAweDA2OTg7CiAgdC5hZmlpNTc1MDkgPSAweDA2YWY7CiAgdC5hZmlpNTc1MTEgPSAweDA2Nzk7CiAgdC5hZmlpNTc1MTIgPSAweDA2ODg7CiAgdC5hZmlpNTc1MTMgPSAweDA2OTE7CiAgdC5hZmlpNTc1MTQgPSAweDA2YmE7CiAgdC5hZmlpNTc1MTkgPSAweDA2ZDI7CiAgdC5hZmlpNTc1MzQgPSAweDA2ZDU7CiAgdC5hZmlpNTc2MzYgPSAweDIwYWE7CiAgdC5hZmlpNTc2NDUgPSAweDA1YmU7CiAgdC5hZmlpNTc2NTggPSAweDA1YzM7CiAgdC5hZmlpNTc2NjQgPSAweDA1ZDA7CiAgdC5hZmlpNTc2NjUgPSAweDA1ZDE7CiAgdC5hZmlpNTc2NjYgPSAweDA1ZDI7CiAgdC5hZmlpNTc2NjcgPSAweDA1ZDM7CiAgdC5hZmlpNTc2NjggPSAweDA1ZDQ7CiAgdC5hZmlpNTc2NjkgPSAweDA1ZDU7CiAgdC5hZmlpNTc2NzAgPSAweDA1ZDY7CiAgdC5hZmlpNTc2NzEgPSAweDA1ZDc7CiAgdC5hZmlpNTc2NzIgPSAweDA1ZDg7CiAgdC5hZmlpNTc2NzMgPSAweDA1ZDk7CiAgdC5hZmlpNTc2NzQgPSAweDA1ZGE7CiAgdC5hZmlpNTc2NzUgPSAweDA1ZGI7CiAgdC5hZmlpNTc2NzYgPSAweDA1ZGM7CiAgdC5hZmlpNTc2NzcgPSAweDA1ZGQ7CiAgdC5hZmlpNTc2NzggPSAweDA1ZGU7CiAgdC5hZmlpNTc2NzkgPSAweDA1ZGY7CiAgdC5hZmlpNTc2ODAgPSAweDA1ZTA7CiAgdC5hZmlpNTc2ODEgPSAweDA1ZTE7CiAgdC5hZmlpNTc2ODIgPSAweDA1ZTI7CiAgdC5hZmlpNTc2ODMgPSAweDA1ZTM7CiAgdC5hZmlpNTc2ODQgPSAweDA1ZTQ7CiAgdC5hZmlpNTc2ODUgPSAweDA1ZTU7CiAgdC5hZmlpNTc2ODYgPSAweDA1ZTY7CiAgdC5hZmlpNTc2ODcgPSAweDA1ZTc7CiAgdC5hZmlpNTc2ODggPSAweDA1ZTg7CiAgdC5hZmlpNTc2ODkgPSAweDA1ZTk7CiAgdC5hZmlpNTc2OTAgPSAweDA1ZWE7CiAgdC5hZmlpNTc2OTQgPSAweGZiMmE7CiAgdC5hZmlpNTc2OTUgPSAweGZiMmI7CiAgdC5hZmlpNTc3MDAgPSAweGZiNGI7CiAgdC5hZmlpNTc3MDUgPSAweGZiMWY7CiAgdC5hZmlpNTc3MTYgPSAweDA1ZjA7CiAgdC5hZmlpNTc3MTcgPSAweDA1ZjE7CiAgdC5hZmlpNTc3MTggPSAweDA1ZjI7CiAgdC5hZmlpNTc3MjMgPSAweGZiMzU7CiAgdC5hZmlpNTc3OTMgPSAweDA1YjQ7CiAgdC5hZmlpNTc3OTQgPSAweDA1YjU7CiAgdC5hZmlpNTc3OTUgPSAweDA1YjY7CiAgdC5hZmlpNTc3OTYgPSAweDA1YmI7CiAgdC5hZmlpNTc3OTcgPSAweDA1Yjg7CiAgdC5hZmlpNTc3OTggPSAweDA1Yjc7CiAgdC5hZmlpNTc3OTkgPSAweDA1YjA7CiAgdC5hZmlpNTc4MDAgPSAweDA1YjI7CiAgdC5hZmlpNTc4MDEgPSAweDA1YjE7CiAgdC5hZmlpNTc4MDIgPSAweDA1YjM7CiAgdC5hZmlpNTc4MDMgPSAweDA1YzI7CiAgdC5hZmlpNTc4MDQgPSAweDA1YzE7CiAgdC5hZmlpNTc4MDYgPSAweDA1Yjk7CiAgdC5hZmlpNTc4MDcgPSAweDA1YmM7CiAgdC5hZmlpNTc4MzkgPSAweDA1YmQ7CiAgdC5hZmlpNTc4NDEgPSAweDA1YmY7CiAgdC5hZmlpNTc4NDIgPSAweDA1YzA7CiAgdC5hZmlpNTc5MjkgPSAweDAyYmM7CiAgdC5hZmlpNjEyNDggPSAweDIxMDU7CiAgdC5hZmlpNjEyODkgPSAweDIxMTM7CiAgdC5hZmlpNjEzNTIgPSAweDIxMTY7CiAgdC5hZmlpNjE1NzMgPSAweDIwMmM7CiAgdC5hZmlpNjE1NzQgPSAweDIwMmQ7CiAgdC5hZmlpNjE1NzUgPSAweDIwMmU7CiAgdC5hZmlpNjE2NjQgPSAweDIwMGM7CiAgdC5hZmlpNjMxNjcgPSAweDA2NmQ7CiAgdC5hZmlpNjQ5MzcgPSAweDAyYmQ7CiAgdC5hZ3JhdmUgPSAweDAwZTA7CiAgdC5hZ3VqYXJhdGkgPSAweDBhODU7CiAgdC5hZ3VybXVraGkgPSAweDBhMDU7CiAgdC5haGlyYWdhbmEgPSAweDMwNDI7CiAgdC5haG9va2Fib3ZlID0gMHgxZWEzOwogIHQuYWliZW5nYWxpID0gMHgwOTkwOwogIHQuYWlib3BvbW9mbyA9IDB4MzExZTsKICB0LmFpZGV2YSA9IDB4MDkxMDsKICB0LmFpZWN5cmlsbGljID0gMHgwNGQ1OwogIHQuYWlndWphcmF0aSA9IDB4MGE5MDsKICB0LmFpZ3VybXVraGkgPSAweDBhMTA7CiAgdC5haW1hdHJhZ3VybXVraGkgPSAweDBhNDg7CiAgdC5haW5hcmFiaWMgPSAweDA2Mzk7CiAgdC5haW5maW5hbGFyYWJpYyA9IDB4ZmVjYTsKICB0LmFpbmluaXRpYWxhcmFiaWMgPSAweGZlY2I7CiAgdC5haW5tZWRpYWxhcmFiaWMgPSAweGZlY2M7CiAgdC5haW52ZXJ0ZWRicmV2ZSA9IDB4MDIwMzsKICB0LmFpdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljODsKICB0LmFpdm93ZWxzaWduZGV2YSA9IDB4MDk0ODsKICB0LmFpdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzg7CiAgdC5ha2F0YWthbmEgPSAweDMwYTI7CiAgdC5ha2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzE7CiAgdC5ha29yZWFuID0gMHgzMTRmOwogIHQuYWxlZiA9IDB4MDVkMDsKICB0LmFsZWZhcmFiaWMgPSAweDA2Mjc7CiAgdC5hbGVmZGFnZXNoaGVicmV3ID0gMHhmYjMwOwogIHQuYWxlZmZpbmFsYXJhYmljID0gMHhmZThlOwogIHQuYWxlZmhhbXphYWJvdmVhcmFiaWMgPSAweDA2MjM7CiAgdC5hbGVmaGFtemFhYm92ZWZpbmFsYXJhYmljID0gMHhmZTg0OwogIHQuYWxlZmhhbXphYmVsb3dhcmFiaWMgPSAweDA2MjU7CiAgdC5hbGVmaGFtemFiZWxvd2ZpbmFsYXJhYmljID0gMHhmZTg4OwogIHQuYWxlZmhlYnJldyA9IDB4MDVkMDsKICB0LmFsZWZsYW1lZGhlYnJldyA9IDB4ZmI0ZjsKICB0LmFsZWZtYWRkYWFib3ZlYXJhYmljID0gMHgwNjIyOwogIHQuYWxlZm1hZGRhYWJvdmVmaW5hbGFyYWJpYyA9IDB4ZmU4MjsKICB0LmFsZWZtYWtzdXJhYXJhYmljID0gMHgwNjQ5OwogIHQuYWxlZm1ha3N1cmFmaW5hbGFyYWJpYyA9IDB4ZmVmMDsKICB0LmFsZWZtYWtzdXJhaW5pdGlhbGFyYWJpYyA9IDB4ZmVmMzsKICB0LmFsZWZtYWtzdXJhbWVkaWFsYXJhYmljID0gMHhmZWY0OwogIHQuYWxlZnBhdGFoaGVicmV3ID0gMHhmYjJlOwogIHQuYWxlZnFhbWF0c2hlYnJldyA9IDB4ZmIyZjsKICB0LmFsZXBoID0gMHgyMTM1OwogIHQuYWxsZXF1YWwgPSAweDIyNGM7CiAgdC5hbHBoYSA9IDB4MDNiMTsKICB0LmFscGhhdG9ub3MgPSAweDAzYWM7CiAgdC5hbWFjcm9uID0gMHgwMTAxOwogIHQuYW1vbm9zcGFjZSA9IDB4ZmY0MTsKICB0LmFtcGVyc2FuZCA9IDB4MDAyNjsKICB0LmFtcGVyc2FuZG1vbm9zcGFjZSA9IDB4ZmYwNjsKICB0LmFtcGVyc2FuZHNtYWxsID0gMHhmNzI2OwogIHQuYW1zcXVhcmUgPSAweDMzYzI7CiAgdC5hbmJvcG9tb2ZvID0gMHgzMTIyOwogIHQuYW5nYm9wb21vZm8gPSAweDMxMjQ7CiAgdC5hbmdicmFja2V0bGVmdCA9IDB4MzAwODsKICB0LmFuZ2JyYWNrZXRyaWdodCA9IDB4MzAwOTsKICB0LmFuZ2toYW5raHV0aGFpID0gMHgwZTVhOwogIHQuYW5nbGUgPSAweDIyMjA7CiAgdC5hbmdsZWJyYWNrZXRsZWZ0ID0gMHgzMDA4OwogIHQuYW5nbGVicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTNmOwogIHQuYW5nbGVicmFja2V0cmlnaHQgPSAweDMwMDk7CiAgdC5hbmdsZWJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTQwOwogIHQuYW5nbGVsZWZ0ID0gMHgyMzI5OwogIHQuYW5nbGVyaWdodCA9IDB4MjMyYTsKICB0LmFuZ3N0cm9tID0gMHgyMTJiOwogIHQuYW5vdGVsZWlhID0gMHgwMzg3OwogIHQuYW51ZGF0dGFkZXZhID0gMHgwOTUyOwogIHQuYW51c3ZhcmFiZW5nYWxpID0gMHgwOTgyOwogIHQuYW51c3ZhcmFkZXZhID0gMHgwOTAyOwogIHQuYW51c3ZhcmFndWphcmF0aSA9IDB4MGE4MjsKICB0LmFvZ29uZWsgPSAweDAxMDU7CiAgdC5hcGFhdG9zcXVhcmUgPSAweDMzMDA7CiAgdC5hcGFyZW4gPSAweDI0OWM7CiAgdC5hcG9zdHJvcGhlYXJtZW5pYW4gPSAweDA1NWE7CiAgdC5hcG9zdHJvcGhlbW9kID0gMHgwMmJjOwogIHQuYXBwbGUgPSAweGY4ZmY7CiAgdC5hcHByb2FjaGVzID0gMHgyMjUwOwogIHQuYXBwcm94ZXF1YWwgPSAweDIyNDg7CiAgdC5hcHByb3hlcXVhbG9yaW1hZ2UgPSAweDIyNTI7CiAgdC5hcHByb3hpbWF0ZWx5ZXF1YWwgPSAweDIyNDU7CiAgdC5hcmFlYWVrb3JlYW4gPSAweDMxOGU7CiAgdC5hcmFlYWtvcmVhbiA9IDB4MzE4ZDsKICB0LmFyYyA9IDB4MjMxMjsKICB0LmFyaWdodGhhbGZyaW5nID0gMHgxZTlhOwogIHQuYXJpbmcgPSAweDAwZTU7CiAgdC5hcmluZ2FjdXRlID0gMHgwMWZiOwogIHQuYXJpbmdiZWxvdyA9IDB4MWUwMTsKICB0LmFycm93Ym90aCA9IDB4MjE5NDsKICB0LmFycm93ZGFzaGRvd24gPSAweDIxZTM7CiAgdC5hcnJvd2Rhc2hsZWZ0ID0gMHgyMWUwOwogIHQuYXJyb3dkYXNocmlnaHQgPSAweDIxZTI7CiAgdC5hcnJvd2Rhc2h1cCA9IDB4MjFlMTsKICB0LmFycm93ZGJsYm90aCA9IDB4MjFkNDsKICB0LmFycm93ZGJsZG93biA9IDB4MjFkMzsKICB0LmFycm93ZGJsbGVmdCA9IDB4MjFkMDsKICB0LmFycm93ZGJscmlnaHQgPSAweDIxZDI7CiAgdC5hcnJvd2RibHVwID0gMHgyMWQxOwogIHQuYXJyb3dkb3duID0gMHgyMTkzOwogIHQuYXJyb3dkb3dubGVmdCA9IDB4MjE5OTsKICB0LmFycm93ZG93bnJpZ2h0ID0gMHgyMTk4OwogIHQuYXJyb3dkb3dud2hpdGUgPSAweDIxZTk7CiAgdC5hcnJvd2hlYWRkb3dubW9kID0gMHgwMmM1OwogIHQuYXJyb3doZWFkbGVmdG1vZCA9IDB4MDJjMjsKICB0LmFycm93aGVhZHJpZ2h0bW9kID0gMHgwMmMzOwogIHQuYXJyb3doZWFkdXBtb2QgPSAweDAyYzQ7CiAgdC5hcnJvd2hvcml6ZXggPSAweGY4ZTc7CiAgdC5hcnJvd2xlZnQgPSAweDIxOTA7CiAgdC5hcnJvd2xlZnRkYmwgPSAweDIxZDA7CiAgdC5hcnJvd2xlZnRkYmxzdHJva2UgPSAweDIxY2Q7CiAgdC5hcnJvd2xlZnRvdmVycmlnaHQgPSAweDIxYzY7CiAgdC5hcnJvd2xlZnR3aGl0ZSA9IDB4MjFlNjsKICB0LmFycm93cmlnaHQgPSAweDIxOTI7CiAgdC5hcnJvd3JpZ2h0ZGJsc3Ryb2tlID0gMHgyMWNmOwogIHQuYXJyb3dyaWdodGhlYXZ5ID0gMHgyNzllOwogIHQuYXJyb3dyaWdodG92ZXJsZWZ0ID0gMHgyMWM0OwogIHQuYXJyb3dyaWdodHdoaXRlID0gMHgyMWU4OwogIHQuYXJyb3d0YWJsZWZ0ID0gMHgyMWU0OwogIHQuYXJyb3d0YWJyaWdodCA9IDB4MjFlNTsKICB0LmFycm93dXAgPSAweDIxOTE7CiAgdC5hcnJvd3VwZG4gPSAweDIxOTU7CiAgdC5hcnJvd3VwZG5ic2UgPSAweDIxYTg7CiAgdC5hcnJvd3VwZG93bmJhc2UgPSAweDIxYTg7CiAgdC5hcnJvd3VwbGVmdCA9IDB4MjE5NjsKICB0LmFycm93dXBsZWZ0b2Zkb3duID0gMHgyMWM1OwogIHQuYXJyb3d1cHJpZ2h0ID0gMHgyMTk3OwogIHQuYXJyb3d1cHdoaXRlID0gMHgyMWU3OwogIHQuYXJyb3d2ZXJ0ZXggPSAweGY4ZTY7CiAgdC5hc2NpaWNpcmN1bSA9IDB4MDA1ZTsKICB0LmFzY2lpY2lyY3VtbW9ub3NwYWNlID0gMHhmZjNlOwogIHQuYXNjaWl0aWxkZSA9IDB4MDA3ZTsKICB0LmFzY2lpdGlsZGVtb25vc3BhY2UgPSAweGZmNWU7CiAgdC5hc2NyaXB0ID0gMHgwMjUxOwogIHQuYXNjcmlwdHR1cm5lZCA9IDB4MDI1MjsKICB0LmFzbWFsbGhpcmFnYW5hID0gMHgzMDQxOwogIHQuYXNtYWxsa2F0YWthbmEgPSAweDMwYTE7CiAgdC5hc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2NzsKICB0LmFzdGVyaXNrID0gMHgwMDJhOwogIHQuYXN0ZXJpc2thbHRvbmVhcmFiaWMgPSAweDA2NmQ7CiAgdC5hc3Rlcmlza2FyYWJpYyA9IDB4MDY2ZDsKICB0LmFzdGVyaXNrbWF0aCA9IDB4MjIxNzsKICB0LmFzdGVyaXNrbW9ub3NwYWNlID0gMHhmZjBhOwogIHQuYXN0ZXJpc2tzbWFsbCA9IDB4ZmU2MTsKICB0LmFzdGVyaXNtID0gMHgyMDQyOwogIHQuYXN1cGVyaW9yID0gMHhmNmU5OwogIHQuYXN5bXB0b3RpY2FsbHllcXVhbCA9IDB4MjI0MzsKICB0LmF0ID0gMHgwMDQwOwogIHQuYXRpbGRlID0gMHgwMGUzOwogIHQuYXRtb25vc3BhY2UgPSAweGZmMjA7CiAgdC5hdHNtYWxsID0gMHhmZTZiOwogIHQuYXR1cm5lZCA9IDB4MDI1MDsKICB0LmF1YmVuZ2FsaSA9IDB4MDk5NDsKICB0LmF1Ym9wb21vZm8gPSAweDMxMjA7CiAgdC5hdWRldmEgPSAweDA5MTQ7CiAgdC5hdWd1amFyYXRpID0gMHgwYTk0OwogIHQuYXVndXJtdWtoaSA9IDB4MGExNDsKICB0LmF1bGVuZ3RobWFya2JlbmdhbGkgPSAweDA5ZDc7CiAgdC5hdW1hdHJhZ3VybXVraGkgPSAweDBhNGM7CiAgdC5hdXZvd2Vsc2lnbmJlbmdhbGkgPSAweDA5Y2M7CiAgdC5hdXZvd2Vsc2lnbmRldmEgPSAweDA5NGM7CiAgdC5hdXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWNjOwogIHQuYXZhZ3JhaGFkZXZhID0gMHgwOTNkOwogIHQuYXliYXJtZW5pYW4gPSAweDA1NjE7CiAgdC5heWluID0gMHgwNWUyOwogIHQuYXlpbmFsdG9uZWhlYnJldyA9IDB4ZmIyMDsKICB0LmF5aW5oZWJyZXcgPSAweDA1ZTI7CiAgdC5iID0gMHgwMDYyOwogIHQuYmFiZW5nYWxpID0gMHgwOWFjOwogIHQuYmFja3NsYXNoID0gMHgwMDVjOwogIHQuYmFja3NsYXNobW9ub3NwYWNlID0gMHhmZjNjOwogIHQuYmFkZXZhID0gMHgwOTJjOwogIHQuYmFndWphcmF0aSA9IDB4MGFhYzsKICB0LmJhZ3VybXVraGkgPSAweDBhMmM7CiAgdC5iYWhpcmFnYW5hID0gMHgzMDcwOwogIHQuYmFodHRoYWkgPSAweDBlM2Y7CiAgdC5iYWthdGFrYW5hID0gMHgzMGQwOwogIHQuYmFyID0gMHgwMDdjOwogIHQuYmFybW9ub3NwYWNlID0gMHhmZjVjOwogIHQuYmJvcG9tb2ZvID0gMHgzMTA1OwogIHQuYmNpcmNsZSA9IDB4MjRkMTsKICB0LmJkb3RhY2NlbnQgPSAweDFlMDM7CiAgdC5iZG90YmVsb3cgPSAweDFlMDU7CiAgdC5iZWFtZWRzaXh0ZWVudGhub3RlcyA9IDB4MjY2YzsKICB0LmJlY2F1c2UgPSAweDIyMzU7CiAgdC5iZWN5cmlsbGljID0gMHgwNDMxOwogIHQuYmVoYXJhYmljID0gMHgwNjI4OwogIHQuYmVoZmluYWxhcmFiaWMgPSAweGZlOTA7CiAgdC5iZWhpbml0aWFsYXJhYmljID0gMHhmZTkxOwogIHQuYmVoaXJhZ2FuYSA9IDB4MzA3OTsKICB0LmJlaG1lZGlhbGFyYWJpYyA9IDB4ZmU5MjsKICB0LmJlaG1lZW1pbml0aWFsYXJhYmljID0gMHhmYzlmOwogIHQuYmVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzA4OwogIHQuYmVobm9vbmZpbmFsYXJhYmljID0gMHhmYzZkOwogIHQuYmVrYXRha2FuYSA9IDB4MzBkOTsKICB0LmJlbmFybWVuaWFuID0gMHgwNTYyOwogIHQuYmV0ID0gMHgwNWQxOwogIHQuYmV0YSA9IDB4MDNiMjsKICB0LmJldGFzeW1ib2xncmVlayA9IDB4MDNkMDsKICB0LmJldGRhZ2VzaCA9IDB4ZmIzMTsKICB0LmJldGRhZ2VzaGhlYnJldyA9IDB4ZmIzMTsKICB0LmJldGhlYnJldyA9IDB4MDVkMTsKICB0LmJldHJhZmVoZWJyZXcgPSAweGZiNGM7CiAgdC5iaGFiZW5nYWxpID0gMHgwOWFkOwogIHQuYmhhZGV2YSA9IDB4MDkyZDsKICB0LmJoYWd1amFyYXRpID0gMHgwYWFkOwogIHQuYmhhZ3VybXVraGkgPSAweDBhMmQ7CiAgdC5iaG9vayA9IDB4MDI1MzsKICB0LmJpaGlyYWdhbmEgPSAweDMwNzM7CiAgdC5iaWthdGFrYW5hID0gMHgzMGQzOwogIHQuYmlsYWJpYWxjbGljayA9IDB4MDI5ODsKICB0LmJpbmRpZ3VybXVraGkgPSAweDBhMDI7CiAgdC5iaXJ1c3F1YXJlID0gMHgzMzMxOwogIHQuYmxhY2tjaXJjbGUgPSAweDI1Y2Y7CiAgdC5ibGFja2RpYW1vbmQgPSAweDI1YzY7CiAgdC5ibGFja2Rvd25wb2ludGluZ3RyaWFuZ2xlID0gMHgyNWJjOwogIHQuYmxhY2tsZWZ0cG9pbnRpbmdwb2ludGVyID0gMHgyNWM0OwogIHQuYmxhY2tsZWZ0cG9pbnRpbmd0cmlhbmdsZSA9IDB4MjVjMDsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRsZWZ0ID0gMHgzMDEwOwogIHQuYmxhY2tsZW50aWN1bGFyYnJhY2tldGxlZnR2ZXJ0aWNhbCA9IDB4ZmUzYjsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRyaWdodCA9IDB4MzAxMTsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTNjOwogIHQuYmxhY2tsb3dlcmxlZnR0cmlhbmdsZSA9IDB4MjVlMzsKICB0LmJsYWNrbG93ZXJyaWdodHRyaWFuZ2xlID0gMHgyNWUyOwogIHQuYmxhY2tyZWN0YW5nbGUgPSAweDI1YWM7CiAgdC5ibGFja3JpZ2h0cG9pbnRpbmdwb2ludGVyID0gMHgyNWJhOwogIHQuYmxhY2tyaWdodHBvaW50aW5ndHJpYW5nbGUgPSAweDI1YjY7CiAgdC5ibGFja3NtYWxsc3F1YXJlID0gMHgyNWFhOwogIHQuYmxhY2tzbWlsaW5nZmFjZSA9IDB4MjYzYjsKICB0LmJsYWNrc3F1YXJlID0gMHgyNWEwOwogIHQuYmxhY2tzdGFyID0gMHgyNjA1OwogIHQuYmxhY2t1cHBlcmxlZnR0cmlhbmdsZSA9IDB4MjVlNDsKICB0LmJsYWNrdXBwZXJyaWdodHRyaWFuZ2xlID0gMHgyNWU1OwogIHQuYmxhY2t1cHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjViNDsKICB0LmJsYWNrdXBwb2ludGluZ3RyaWFuZ2xlID0gMHgyNWIyOwogIHQuYmxhbmsgPSAweDI0MjM7CiAgdC5ibGluZWJlbG93ID0gMHgxZTA3OwogIHQuYmxvY2sgPSAweDI1ODg7CiAgdC5ibW9ub3NwYWNlID0gMHhmZjQyOwogIHQuYm9iYWltYWl0aGFpID0gMHgwZTFhOwogIHQuYm9oaXJhZ2FuYSA9IDB4MzA3YzsKICB0LmJva2F0YWthbmEgPSAweDMwZGM7CiAgdC5icGFyZW4gPSAweDI0OWQ7CiAgdC5icXNxdWFyZSA9IDB4MzNjMzsKICB0LmJyYWNlZXggPSAweGY4ZjQ7CiAgdC5icmFjZWxlZnQgPSAweDAwN2I7CiAgdC5icmFjZWxlZnRidCA9IDB4ZjhmMzsKICB0LmJyYWNlbGVmdG1pZCA9IDB4ZjhmMjsKICB0LmJyYWNlbGVmdG1vbm9zcGFjZSA9IDB4ZmY1YjsKICB0LmJyYWNlbGVmdHNtYWxsID0gMHhmZTViOwogIHQuYnJhY2VsZWZ0dHAgPSAweGY4ZjE7CiAgdC5icmFjZWxlZnR2ZXJ0aWNhbCA9IDB4ZmUzNzsKICB0LmJyYWNlcmlnaHQgPSAweDAwN2Q7CiAgdC5icmFjZXJpZ2h0YnQgPSAweGY4ZmU7CiAgdC5icmFjZXJpZ2h0bWlkID0gMHhmOGZkOwogIHQuYnJhY2VyaWdodG1vbm9zcGFjZSA9IDB4ZmY1ZDsKICB0LmJyYWNlcmlnaHRzbWFsbCA9IDB4ZmU1YzsKICB0LmJyYWNlcmlnaHR0cCA9IDB4ZjhmYzsKICB0LmJyYWNlcmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzODsKICB0LmJyYWNrZXRsZWZ0ID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRidCA9IDB4ZjhmMDsKICB0LmJyYWNrZXRsZWZ0ZXggPSAweGY4ZWY7CiAgdC5icmFja2V0bGVmdG1vbm9zcGFjZSA9IDB4ZmYzYjsKICB0LmJyYWNrZXRsZWZ0dHAgPSAweGY4ZWU7CiAgdC5icmFja2V0cmlnaHQgPSAweDAwNWQ7CiAgdC5icmFja2V0cmlnaHRidCA9IDB4ZjhmYjsKICB0LmJyYWNrZXRyaWdodGV4ID0gMHhmOGZhOwogIHQuYnJhY2tldHJpZ2h0bW9ub3NwYWNlID0gMHhmZjNkOwogIHQuYnJhY2tldHJpZ2h0dHAgPSAweGY4Zjk7CiAgdC5icmV2ZSA9IDB4MDJkODsKICB0LmJyZXZlYmVsb3djbWIgPSAweDAzMmU7CiAgdC5icmV2ZWNtYiA9IDB4MDMwNjsKICB0LmJyZXZlaW52ZXJ0ZWRiZWxvd2NtYiA9IDB4MDMyZjsKICB0LmJyZXZlaW52ZXJ0ZWRjbWIgPSAweDAzMTE7CiAgdC5icmV2ZWludmVydGVkZG91YmxlY21iID0gMHgwMzYxOwogIHQuYnJpZGdlYmVsb3djbWIgPSAweDAzMmE7CiAgdC5icmlkZ2VpbnZlcnRlZGJlbG93Y21iID0gMHgwMzNhOwogIHQuYnJva2VuYmFyID0gMHgwMGE2OwogIHQuYnN0cm9rZSA9IDB4MDE4MDsKICB0LmJzdXBlcmlvciA9IDB4ZjZlYTsKICB0LmJ0b3BiYXIgPSAweDAxODM7CiAgdC5idWhpcmFnYW5hID0gMHgzMDc2OwogIHQuYnVrYXRha2FuYSA9IDB4MzBkNjsKICB0LmJ1bGxldCA9IDB4MjAyMjsKICB0LmJ1bGxldGludmVyc2UgPSAweDI1ZDg7CiAgdC5idWxsZXRvcGVyYXRvciA9IDB4MjIxOTsKICB0LmJ1bGxzZXllID0gMHgyNWNlOwogIHQuYyA9IDB4MDA2MzsKICB0LmNhYXJtZW5pYW4gPSAweDA1NmU7CiAgdC5jYWJlbmdhbGkgPSAweDA5OWE7CiAgdC5jYWN1dGUgPSAweDAxMDc7CiAgdC5jYWRldmEgPSAweDA5MWE7CiAgdC5jYWd1amFyYXRpID0gMHgwYTlhOwogIHQuY2FndXJtdWtoaSA9IDB4MGExYTsKICB0LmNhbHNxdWFyZSA9IDB4MzM4ODsKICB0LmNhbmRyYWJpbmR1YmVuZ2FsaSA9IDB4MDk4MTsKICB0LmNhbmRyYWJpbmR1Y21iID0gMHgwMzEwOwogIHQuY2FuZHJhYmluZHVkZXZhID0gMHgwOTAxOwogIHQuY2FuZHJhYmluZHVndWphcmF0aSA9IDB4MGE4MTsKICB0LmNhcHNsb2NrID0gMHgyMWVhOwogIHQuY2FyZW9mID0gMHgyMTA1OwogIHQuY2Fyb24gPSAweDAyYzc7CiAgdC5jYXJvbmJlbG93Y21iID0gMHgwMzJjOwogIHQuY2Fyb25jbWIgPSAweDAzMGM7CiAgdC5jYXJyaWFnZXJldHVybiA9IDB4MjFiNTsKICB0LmNib3BvbW9mbyA9IDB4MzExODsKICB0LmNjYXJvbiA9IDB4MDEwZDsKICB0LmNjZWRpbGxhID0gMHgwMGU3OwogIHQuY2NlZGlsbGFhY3V0ZSA9IDB4MWUwOTsKICB0LmNjaXJjbGUgPSAweDI0ZDI7CiAgdC5jY2lyY3VtZmxleCA9IDB4MDEwOTsKICB0LmNjdXJsID0gMHgwMjU1OwogIHQuY2RvdCA9IDB4MDEwYjsKICB0LmNkb3RhY2NlbnQgPSAweDAxMGI7CiAgdC5jZHNxdWFyZSA9IDB4MzNjNTsKICB0LmNlZGlsbGEgPSAweDAwYjg7CiAgdC5jZWRpbGxhY21iID0gMHgwMzI3OwogIHQuY2VudCA9IDB4MDBhMjsKICB0LmNlbnRpZ3JhZGUgPSAweDIxMDM7CiAgdC5jZW50aW5mZXJpb3IgPSAweGY2ZGY7CiAgdC5jZW50bW9ub3NwYWNlID0gMHhmZmUwOwogIHQuY2VudG9sZHN0eWxlID0gMHhmN2EyOwogIHQuY2VudHN1cGVyaW9yID0gMHhmNmUwOwogIHQuY2hhYXJtZW5pYW4gPSAweDA1Nzk7CiAgdC5jaGFiZW5nYWxpID0gMHgwOTliOwogIHQuY2hhZGV2YSA9IDB4MDkxYjsKICB0LmNoYWd1amFyYXRpID0gMHgwYTliOwogIHQuY2hhZ3VybXVraGkgPSAweDBhMWI7CiAgdC5jaGJvcG9tb2ZvID0gMHgzMTE0OwogIHQuY2hlYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0YmQ7CiAgdC5jaGVja21hcmsgPSAweDI3MTM7CiAgdC5jaGVjeXJpbGxpYyA9IDB4MDQ0NzsKICB0LmNoZWRlc2NlbmRlcmFia2hhc2lhbmN5cmlsbGljID0gMHgwNGJmOwogIHQuY2hlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0Yjc7CiAgdC5jaGVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY1OwogIHQuY2hlaGFybWVuaWFuID0gMHgwNTczOwogIHQuY2hla2hha2Fzc2lhbmN5cmlsbGljID0gMHgwNGNjOwogIHQuY2hldmVydGljYWxzdHJva2VjeXJpbGxpYyA9IDB4MDRiOTsKICB0LmNoaSA9IDB4MDNjNzsKICB0LmNoaWV1Y2hhY2lyY2xla29yZWFuID0gMHgzMjc3OwogIHQuY2hpZXVjaGFwYXJlbmtvcmVhbiA9IDB4MzIxNzsKICB0LmNoaWV1Y2hjaXJjbGVrb3JlYW4gPSAweDMyNjk7CiAgdC5jaGlldWNoa29yZWFuID0gMHgzMTRhOwogIHQuY2hpZXVjaHBhcmVua29yZWFuID0gMHgzMjA5OwogIHQuY2hvY2hhbmd0aGFpID0gMHgwZTBhOwogIHQuY2hvY2hhbnRoYWkgPSAweDBlMDg7CiAgdC5jaG9jaGluZ3RoYWkgPSAweDBlMDk7CiAgdC5jaG9jaG9ldGhhaSA9IDB4MGUwYzsKICB0LmNob29rID0gMHgwMTg4OwogIHQuY2lldWNhY2lyY2xla29yZWFuID0gMHgzMjc2OwogIHQuY2lldWNhcGFyZW5rb3JlYW4gPSAweDMyMTY7CiAgdC5jaWV1Y2NpcmNsZWtvcmVhbiA9IDB4MzI2ODsKICB0LmNpZXVja29yZWFuID0gMHgzMTQ4OwogIHQuY2lldWNwYXJlbmtvcmVhbiA9IDB4MzIwODsKICB0LmNpZXVjdXBhcmVua29yZWFuID0gMHgzMjFjOwogIHQuY2lyY2xlID0gMHgyNWNiOwogIHQuY2lyY2xlY29weXJ0ID0gMHgwMGE5OwogIHQuY2lyY2xlbXVsdGlwbHkgPSAweDIyOTc7CiAgdC5jaXJjbGVvdCA9IDB4MjI5OTsKICB0LmNpcmNsZXBsdXMgPSAweDIyOTU7CiAgdC5jaXJjbGVwb3N0YWxtYXJrID0gMHgzMDM2OwogIHQuY2lyY2xld2l0aGxlZnRoYWxmYmxhY2sgPSAweDI1ZDA7CiAgdC5jaXJjbGV3aXRocmlnaHRoYWxmYmxhY2sgPSAweDI1ZDE7CiAgdC5jaXJjdW1mbGV4ID0gMHgwMmM2OwogIHQuY2lyY3VtZmxleGJlbG93Y21iID0gMHgwMzJkOwogIHQuY2lyY3VtZmxleGNtYiA9IDB4MDMwMjsKICB0LmNsZWFyID0gMHgyMzI3OwogIHQuY2xpY2thbHZlb2xhciA9IDB4MDFjMjsKICB0LmNsaWNrZGVudGFsID0gMHgwMWMwOwogIHQuY2xpY2tsYXRlcmFsID0gMHgwMWMxOwogIHQuY2xpY2tyZXRyb2ZsZXggPSAweDAxYzM7CiAgdC5jbHViID0gMHgyNjYzOwogIHQuY2x1YnN1aXRibGFjayA9IDB4MjY2MzsKICB0LmNsdWJzdWl0d2hpdGUgPSAweDI2Njc7CiAgdC5jbWN1YmVkc3F1YXJlID0gMHgzM2E0OwogIHQuY21vbm9zcGFjZSA9IDB4ZmY0MzsKICB0LmNtc3F1YXJlZHNxdWFyZSA9IDB4MzNhMDsKICB0LmNvYXJtZW5pYW4gPSAweDA1ODE7CiAgdC5jb2xvbiA9IDB4MDAzYTsKICB0LmNvbG9ubW9uZXRhcnkgPSAweDIwYTE7CiAgdC5jb2xvbm1vbm9zcGFjZSA9IDB4ZmYxYTsKICB0LmNvbG9uc2lnbiA9IDB4MjBhMTsKICB0LmNvbG9uc21hbGwgPSAweGZlNTU7CiAgdC5jb2xvbnRyaWFuZ3VsYXJoYWxmbW9kID0gMHgwMmQxOwogIHQuY29sb250cmlhbmd1bGFybW9kID0gMHgwMmQwOwogIHQuY29tbWEgPSAweDAwMmM7CiAgdC5jb21tYWFib3ZlY21iID0gMHgwMzEzOwogIHQuY29tbWFhYm92ZXJpZ2h0Y21iID0gMHgwMzE1OwogIHQuY29tbWFhY2NlbnQgPSAweGY2YzM7CiAgdC5jb21tYWFyYWJpYyA9IDB4MDYwYzsKICB0LmNvbW1hYXJtZW5pYW4gPSAweDA1NWQ7CiAgdC5jb21tYWluZmVyaW9yID0gMHhmNmUxOwogIHQuY29tbWFtb25vc3BhY2UgPSAweGZmMGM7CiAgdC5jb21tYXJldmVyc2VkYWJvdmVjbWIgPSAweDAzMTQ7CiAgdC5jb21tYXJldmVyc2VkbW9kID0gMHgwMmJkOwogIHQuY29tbWFzbWFsbCA9IDB4ZmU1MDsKICB0LmNvbW1hc3VwZXJpb3IgPSAweGY2ZTI7CiAgdC5jb21tYXR1cm5lZGFib3ZlY21iID0gMHgwMzEyOwogIHQuY29tbWF0dXJuZWRtb2QgPSAweDAyYmI7CiAgdC5jb21wYXNzID0gMHgyNjNjOwogIHQuY29uZ3J1ZW50ID0gMHgyMjQ1OwogIHQuY29udG91cmludGVncmFsID0gMHgyMjJlOwogIHQuY29udHJvbCA9IDB4MjMwMzsKICB0LmNvbnRyb2xBQ0sgPSAweDAwMDY7CiAgdC5jb250cm9sQkVMID0gMHgwMDA3OwogIHQuY29udHJvbEJTID0gMHgwMDA4OwogIHQuY29udHJvbENBTiA9IDB4MDAxODsKICB0LmNvbnRyb2xDUiA9IDB4MDAwZDsKICB0LmNvbnRyb2xEQzEgPSAweDAwMTE7CiAgdC5jb250cm9sREMyID0gMHgwMDEyOwogIHQuY29udHJvbERDMyA9IDB4MDAxMzsKICB0LmNvbnRyb2xEQzQgPSAweDAwMTQ7CiAgdC5jb250cm9sREVMID0gMHgwMDdmOwogIHQuY29udHJvbERMRSA9IDB4MDAxMDsKICB0LmNvbnRyb2xFTSA9IDB4MDAxOTsKICB0LmNvbnRyb2xFTlEgPSAweDAwMDU7CiAgdC5jb250cm9sRU9UID0gMHgwMDA0OwogIHQuY29udHJvbEVTQyA9IDB4MDAxYjsKICB0LmNvbnRyb2xFVEIgPSAweDAwMTc7CiAgdC5jb250cm9sRVRYID0gMHgwMDAzOwogIHQuY29udHJvbEZGID0gMHgwMDBjOwogIHQuY29udHJvbEZTID0gMHgwMDFjOwogIHQuY29udHJvbEdTID0gMHgwMDFkOwogIHQuY29udHJvbEhUID0gMHgwMDA5OwogIHQuY29udHJvbExGID0gMHgwMDBhOwogIHQuY29udHJvbE5BSyA9IDB4MDAxNTsKICB0LmNvbnRyb2xOVUxMID0gMHgwMDAwOwogIHQuY29udHJvbFJTID0gMHgwMDFlOwogIHQuY29udHJvbFNJID0gMHgwMDBmOwogIHQuY29udHJvbFNPID0gMHgwMDBlOwogIHQuY29udHJvbFNPVCA9IDB4MDAwMjsKICB0LmNvbnRyb2xTVFggPSAweDAwMDE7CiAgdC5jb250cm9sU1VCID0gMHgwMDFhOwogIHQuY29udHJvbFNZTiA9IDB4MDAxNjsKICB0LmNvbnRyb2xVUyA9IDB4MDAxZjsKICB0LmNvbnRyb2xWVCA9IDB4MDAwYjsKICB0LmNvcHlyaWdodCA9IDB4MDBhOTsKICB0LmNvcHlyaWdodHNhbnMgPSAweGY4ZTk7CiAgdC5jb3B5cmlnaHRzZXJpZiA9IDB4ZjZkOTsKICB0LmNvcm5lcmJyYWNrZXRsZWZ0ID0gMHgzMDBjOwogIHQuY29ybmVyYnJhY2tldGxlZnRoYWxmd2lkdGggPSAweGZmNjI7CiAgdC5jb3JuZXJicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTQxOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0ID0gMHgzMDBkOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0aGFsZndpZHRoID0gMHhmZjYzOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0dmVydGljYWwgPSAweGZlNDI7CiAgdC5jb3Jwb3JhdGlvbnNxdWFyZSA9IDB4MzM3ZjsKICB0LmNvc3F1YXJlID0gMHgzM2M3OwogIHQuY292ZXJrZ3NxdWFyZSA9IDB4MzNjNjsKICB0LmNwYXJlbiA9IDB4MjQ5ZTsKICB0LmNydXplaXJvID0gMHgyMGEyOwogIHQuY3N0cmV0Y2hlZCA9IDB4MDI5NzsKICB0LmN1cmx5YW5kID0gMHgyMmNmOwogIHQuY3VybHlvciA9IDB4MjJjZTsKICB0LmN1cnJlbmN5ID0gMHgwMGE0OwogIHQuY3lyQnJldmUgPSAweGY2ZDE7CiAgdC5jeXJGbGV4ID0gMHhmNmQyOwogIHQuY3lyYnJldmUgPSAweGY2ZDQ7CiAgdC5jeXJmbGV4ID0gMHhmNmQ1OwogIHQuZCA9IDB4MDA2NDsKICB0LmRhYXJtZW5pYW4gPSAweDA1NjQ7CiAgdC5kYWJlbmdhbGkgPSAweDA5YTY7CiAgdC5kYWRhcmFiaWMgPSAweDA2MzY7CiAgdC5kYWRldmEgPSAweDA5MjY7CiAgdC5kYWRmaW5hbGFyYWJpYyA9IDB4ZmViZTsKICB0LmRhZGluaXRpYWxhcmFiaWMgPSAweGZlYmY7CiAgdC5kYWRtZWRpYWxhcmFiaWMgPSAweGZlYzA7CiAgdC5kYWdlc2ggPSAweDA1YmM7CiAgdC5kYWdlc2hoZWJyZXcgPSAweDA1YmM7CiAgdC5kYWdnZXIgPSAweDIwMjA7CiAgdC5kYWdnZXJkYmwgPSAweDIwMjE7CiAgdC5kYWd1amFyYXRpID0gMHgwYWE2OwogIHQuZGFndXJtdWtoaSA9IDB4MGEyNjsKICB0LmRhaGlyYWdhbmEgPSAweDMwNjA7CiAgdC5kYWthdGFrYW5hID0gMHgzMGMwOwogIHQuZGFsYXJhYmljID0gMHgwNjJmOwogIHQuZGFsZXQgPSAweDA1ZDM7CiAgdC5kYWxldGRhZ2VzaCA9IDB4ZmIzMzsKICB0LmRhbGV0ZGFnZXNoaGVicmV3ID0gMHhmYjMzOwogIHQuZGFsZXRoZWJyZXcgPSAweDA1ZDM7CiAgdC5kYWxmaW5hbGFyYWJpYyA9IDB4ZmVhYTsKICB0LmRhbW1hYXJhYmljID0gMHgwNjRmOwogIHQuZGFtbWFsb3dhcmFiaWMgPSAweDA2NGY7CiAgdC5kYW1tYXRhbmFsdG9uZWFyYWJpYyA9IDB4MDY0YzsKICB0LmRhbW1hdGFuYXJhYmljID0gMHgwNjRjOwogIHQuZGFuZGEgPSAweDA5NjQ7CiAgdC5kYXJnYWhlYnJldyA9IDB4MDVhNzsKICB0LmRhcmdhbGVmdGhlYnJldyA9IDB4MDVhNzsKICB0LmRhc2lhcG5ldW1hdGFjeXJpbGxpY2NtYiA9IDB4MDQ4NTsKICB0LmRibEdyYXZlID0gMHhmNmQzOwogIHQuZGJsYW5nbGVicmFja2V0bGVmdCA9IDB4MzAwYTsKICB0LmRibGFuZ2xlYnJhY2tldGxlZnR2ZXJ0aWNhbCA9IDB4ZmUzZDsKICB0LmRibGFuZ2xlYnJhY2tldHJpZ2h0ID0gMHgzMDBiOwogIHQuZGJsYW5nbGVicmFja2V0cmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzZTsKICB0LmRibGFyY2hpbnZlcnRlZGJlbG93Y21iID0gMHgwMzJiOwogIHQuZGJsYXJyb3dsZWZ0ID0gMHgyMWQ0OwogIHQuZGJsYXJyb3dyaWdodCA9IDB4MjFkMjsKICB0LmRibGRhbmRhID0gMHgwOTY1OwogIHQuZGJsZ3JhdmUgPSAweGY2ZDY7CiAgdC5kYmxncmF2ZWNtYiA9IDB4MDMwZjsKICB0LmRibGludGVncmFsID0gMHgyMjJjOwogIHQuZGJsbG93bGluZSA9IDB4MjAxNzsKICB0LmRibGxvd2xpbmVjbWIgPSAweDAzMzM7CiAgdC5kYmxvdmVybGluZWNtYiA9IDB4MDMzZjsKICB0LmRibHByaW1lbW9kID0gMHgwMmJhOwogIHQuZGJsdmVydGljYWxiYXIgPSAweDIwMTY7CiAgdC5kYmx2ZXJ0aWNhbGxpbmVhYm92ZWNtYiA9IDB4MDMwZTsKICB0LmRib3BvbW9mbyA9IDB4MzEwOTsKICB0LmRic3F1YXJlID0gMHgzM2M4OwogIHQuZGNhcm9uID0gMHgwMTBmOwogIHQuZGNlZGlsbGEgPSAweDFlMTE7CiAgdC5kY2lyY2xlID0gMHgyNGQzOwogIHQuZGNpcmN1bWZsZXhiZWxvdyA9IDB4MWUxMzsKICB0LmRjcm9hdCA9IDB4MDExMTsKICB0LmRkYWJlbmdhbGkgPSAweDA5YTE7CiAgdC5kZGFkZXZhID0gMHgwOTIxOwogIHQuZGRhZ3VqYXJhdGkgPSAweDBhYTE7CiAgdC5kZGFndXJtdWtoaSA9IDB4MGEyMTsKICB0LmRkYWxhcmFiaWMgPSAweDA2ODg7CiAgdC5kZGFsZmluYWxhcmFiaWMgPSAweGZiODk7CiAgdC5kZGRoYWRldmEgPSAweDA5NWM7CiAgdC5kZGhhYmVuZ2FsaSA9IDB4MDlhMjsKICB0LmRkaGFkZXZhID0gMHgwOTIyOwogIHQuZGRoYWd1amFyYXRpID0gMHgwYWEyOwogIHQuZGRoYWd1cm11a2hpID0gMHgwYTIyOwogIHQuZGRvdGFjY2VudCA9IDB4MWUwYjsKICB0LmRkb3RiZWxvdyA9IDB4MWUwZDsKICB0LmRlY2ltYWxzZXBhcmF0b3JhcmFiaWMgPSAweDA2NmI7CiAgdC5kZWNpbWFsc2VwYXJhdG9ycGVyc2lhbiA9IDB4MDY2YjsKICB0LmRlY3lyaWxsaWMgPSAweDA0MzQ7CiAgdC5kZWdyZWUgPSAweDAwYjA7CiAgdC5kZWhpaGVicmV3ID0gMHgwNWFkOwogIHQuZGVoaXJhZ2FuYSA9IDB4MzA2NzsKICB0LmRlaWNvcHRpYyA9IDB4MDNlZjsKICB0LmRla2F0YWthbmEgPSAweDMwYzc7CiAgdC5kZWxldGVsZWZ0ID0gMHgyMzJiOwogIHQuZGVsZXRlcmlnaHQgPSAweDIzMjY7CiAgdC5kZWx0YSA9IDB4MDNiNDsKICB0LmRlbHRhdHVybmVkID0gMHgwMThkOwogIHQuZGVub21pbmF0b3JtaW51c29uZW51bWVyYXRvcmJlbmdhbGkgPSAweDA5Zjg7CiAgdC5kZXpoID0gMHgwMmE0OwogIHQuZGhhYmVuZ2FsaSA9IDB4MDlhNzsKICB0LmRoYWRldmEgPSAweDA5Mjc7CiAgdC5kaGFndWphcmF0aSA9IDB4MGFhNzsKICB0LmRoYWd1cm11a2hpID0gMHgwYTI3OwogIHQuZGhvb2sgPSAweDAyNTc7CiAgdC5kaWFseXRpa2F0b25vcyA9IDB4MDM4NTsKICB0LmRpYWx5dGlrYXRvbm9zY21iID0gMHgwMzQ0OwogIHQuZGlhbW9uZCA9IDB4MjY2NjsKICB0LmRpYW1vbmRzdWl0d2hpdGUgPSAweDI2NjI7CiAgdC5kaWVyZXNpcyA9IDB4MDBhODsKICB0LmRpZXJlc2lzYWN1dGUgPSAweGY2ZDc7CiAgdC5kaWVyZXNpc2JlbG93Y21iID0gMHgwMzI0OwogIHQuZGllcmVzaXNjbWIgPSAweDAzMDg7CiAgdC5kaWVyZXNpc2dyYXZlID0gMHhmNmQ4OwogIHQuZGllcmVzaXN0b25vcyA9IDB4MDM4NTsKICB0LmRpaGlyYWdhbmEgPSAweDMwNjI7CiAgdC5kaWthdGFrYW5hID0gMHgzMGMyOwogIHQuZGl0dG9tYXJrID0gMHgzMDAzOwogIHQuZGl2aWRlID0gMHgwMGY3OwogIHQuZGl2aWRlcyA9IDB4MjIyMzsKICB0LmRpdmlzaW9uc2xhc2ggPSAweDIyMTU7CiAgdC5kamVjeXJpbGxpYyA9IDB4MDQ1MjsKICB0LmRrc2hhZGUgPSAweDI1OTM7CiAgdC5kbGluZWJlbG93ID0gMHgxZTBmOwogIHQuZGxzcXVhcmUgPSAweDMzOTc7CiAgdC5kbWFjcm9uID0gMHgwMTExOwogIHQuZG1vbm9zcGFjZSA9IDB4ZmY0NDsKICB0LmRuYmxvY2sgPSAweDI1ODQ7CiAgdC5kb2NoYWRhdGhhaSA9IDB4MGUwZTsKICB0LmRvZGVrdGhhaSA9IDB4MGUxNDsKICB0LmRvaGlyYWdhbmEgPSAweDMwNjk7CiAgdC5kb2thdGFrYW5hID0gMHgzMGM5OwogIHQuZG9sbGFyID0gMHgwMDI0OwogIHQuZG9sbGFyaW5mZXJpb3IgPSAweGY2ZTM7CiAgdC5kb2xsYXJtb25vc3BhY2UgPSAweGZmMDQ7CiAgdC5kb2xsYXJvbGRzdHlsZSA9IDB4ZjcyNDsKICB0LmRvbGxhcnNtYWxsID0gMHhmZTY5OwogIHQuZG9sbGFyc3VwZXJpb3IgPSAweGY2ZTQ7CiAgdC5kb25nID0gMHgyMGFiOwogIHQuZG9ydXNxdWFyZSA9IDB4MzMyNjsKICB0LmRvdGFjY2VudCA9IDB4MDJkOTsKICB0LmRvdGFjY2VudGNtYiA9IDB4MDMwNzsKICB0LmRvdGJlbG93Y21iID0gMHgwMzIzOwogIHQuZG90YmVsb3djb21iID0gMHgwMzIzOwogIHQuZG90a2F0YWthbmEgPSAweDMwZmI7CiAgdC5kb3RsZXNzaSA9IDB4MDEzMTsKICB0LmRvdGxlc3NqID0gMHhmNmJlOwogIHQuZG90bGVzc2pzdHJva2Vob29rID0gMHgwMjg0OwogIHQuZG90bWF0aCA9IDB4MjJjNTsKICB0LmRvdHRlZGNpcmNsZSA9IDB4MjVjYzsKICB0LmRvdWJsZXlvZHBhdGFoID0gMHhmYjFmOwogIHQuZG91YmxleW9kcGF0YWhoZWJyZXcgPSAweGZiMWY7CiAgdC5kb3dudGFja2JlbG93Y21iID0gMHgwMzFlOwogIHQuZG93bnRhY2ttb2QgPSAweDAyZDU7CiAgdC5kcGFyZW4gPSAweDI0OWY7CiAgdC5kc3VwZXJpb3IgPSAweGY2ZWI7CiAgdC5kdGFpbCA9IDB4MDI1NjsKICB0LmR0b3BiYXIgPSAweDAxOGM7CiAgdC5kdWhpcmFnYW5hID0gMHgzMDY1OwogIHQuZHVrYXRha2FuYSA9IDB4MzBjNTsKICB0LmR6ID0gMHgwMWYzOwogIHQuZHphbHRvbmUgPSAweDAyYTM7CiAgdC5kemNhcm9uID0gMHgwMWM2OwogIHQuZHpjdXJsID0gMHgwMmE1OwogIHQuZHplYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0ZTE7CiAgdC5kemVjeXJpbGxpYyA9IDB4MDQ1NTsKICB0LmR6aGVjeXJpbGxpYyA9IDB4MDQ1ZjsKICB0LmUgPSAweDAwNjU7CiAgdC5lYWN1dGUgPSAweDAwZTk7CiAgdC5lYXJ0aCA9IDB4MjY0MTsKICB0LmViZW5nYWxpID0gMHgwOThmOwogIHQuZWJvcG9tb2ZvID0gMHgzMTFjOwogIHQuZWJyZXZlID0gMHgwMTE1OwogIHQuZWNhbmRyYWRldmEgPSAweDA5MGQ7CiAgdC5lY2FuZHJhZ3VqYXJhdGkgPSAweDBhOGQ7CiAgdC5lY2FuZHJhdm93ZWxzaWduZGV2YSA9IDB4MDk0NTsKICB0LmVjYW5kcmF2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjNTsKICB0LmVjYXJvbiA9IDB4MDExYjsKICB0LmVjZWRpbGxhYnJldmUgPSAweDFlMWQ7CiAgdC5lY2hhcm1lbmlhbiA9IDB4MDU2NTsKICB0LmVjaHlpd25hcm1lbmlhbiA9IDB4MDU4NzsKICB0LmVjaXJjbGUgPSAweDI0ZDQ7CiAgdC5lY2lyY3VtZmxleCA9IDB4MDBlYTsKICB0LmVjaXJjdW1mbGV4YWN1dGUgPSAweDFlYmY7CiAgdC5lY2lyY3VtZmxleGJlbG93ID0gMHgxZTE5OwogIHQuZWNpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVjNzsKICB0LmVjaXJjdW1mbGV4Z3JhdmUgPSAweDFlYzE7CiAgdC5lY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVjMzsKICB0LmVjaXJjdW1mbGV4dGlsZGUgPSAweDFlYzU7CiAgdC5lY3lyaWxsaWMgPSAweDA0NTQ7CiAgdC5lZGJsZ3JhdmUgPSAweDAyMDU7CiAgdC5lZGV2YSA9IDB4MDkwZjsKICB0LmVkaWVyZXNpcyA9IDB4MDBlYjsKICB0LmVkb3QgPSAweDAxMTc7CiAgdC5lZG90YWNjZW50ID0gMHgwMTE3OwogIHQuZWRvdGJlbG93ID0gMHgxZWI5OwogIHQuZWVndXJtdWtoaSA9IDB4MGEwZjsKICB0LmVlbWF0cmFndXJtdWtoaSA9IDB4MGE0NzsKICB0LmVmY3lyaWxsaWMgPSAweDA0NDQ7CiAgdC5lZ3JhdmUgPSAweDAwZTg7CiAgdC5lZ3VqYXJhdGkgPSAweDBhOGY7CiAgdC5laGFybWVuaWFuID0gMHgwNTY3OwogIHQuZWhib3BvbW9mbyA9IDB4MzExZDsKICB0LmVoaXJhZ2FuYSA9IDB4MzA0ODsKICB0LmVob29rYWJvdmUgPSAweDFlYmI7CiAgdC5laWJvcG9tb2ZvID0gMHgzMTFmOwogIHQuZWlnaHQgPSAweDAwMzg7CiAgdC5laWdodGFyYWJpYyA9IDB4MDY2ODsKICB0LmVpZ2h0YmVuZ2FsaSA9IDB4MDllZTsKICB0LmVpZ2h0Y2lyY2xlID0gMHgyNDY3OwogIHQuZWlnaHRjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzkxOwogIHQuZWlnaHRkZXZhID0gMHgwOTZlOwogIHQuZWlnaHRlZW5jaXJjbGUgPSAweDI0NzE7CiAgdC5laWdodGVlbnBhcmVuID0gMHgyNDg1OwogIHQuZWlnaHRlZW5wZXJpb2QgPSAweDI0OTk7CiAgdC5laWdodGd1amFyYXRpID0gMHgwYWVlOwogIHQuZWlnaHRndXJtdWtoaSA9IDB4MGE2ZTsKICB0LmVpZ2h0aGFja2FyYWJpYyA9IDB4MDY2ODsKICB0LmVpZ2h0aGFuZ3pob3UgPSAweDMwMjg7CiAgdC5laWdodGhub3RlYmVhbWVkID0gMHgyNjZiOwogIHQuZWlnaHRpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI3OwogIHQuZWlnaHRpbmZlcmlvciA9IDB4MjA4ODsKICB0LmVpZ2h0bW9ub3NwYWNlID0gMHhmZjE4OwogIHQuZWlnaHRvbGRzdHlsZSA9IDB4ZjczODsKICB0LmVpZ2h0cGFyZW4gPSAweDI0N2I7CiAgdC5laWdodHBlcmlvZCA9IDB4MjQ4ZjsKICB0LmVpZ2h0cGVyc2lhbiA9IDB4MDZmODsKICB0LmVpZ2h0cm9tYW4gPSAweDIxNzc7CiAgdC5laWdodHN1cGVyaW9yID0gMHgyMDc4OwogIHQuZWlnaHR0aGFpID0gMHgwZTU4OwogIHQuZWludmVydGVkYnJldmUgPSAweDAyMDc7CiAgdC5laW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2NTsKICB0LmVrYXRha2FuYSA9IDB4MzBhODsKICB0LmVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3NDsKICB0LmVrb25rYXJndXJtdWtoaSA9IDB4MGE3NDsKICB0LmVrb3JlYW4gPSAweDMxNTQ7CiAgdC5lbGN5cmlsbGljID0gMHgwNDNiOwogIHQuZWxlbWVudCA9IDB4MjIwODsKICB0LmVsZXZlbmNpcmNsZSA9IDB4MjQ2YTsKICB0LmVsZXZlbnBhcmVuID0gMHgyNDdlOwogIHQuZWxldmVucGVyaW9kID0gMHgyNDkyOwogIHQuZWxldmVucm9tYW4gPSAweDIxN2E7CiAgdC5lbGxpcHNpcyA9IDB4MjAyNjsKICB0LmVsbGlwc2lzdmVydGljYWwgPSAweDIyZWU7CiAgdC5lbWFjcm9uID0gMHgwMTEzOwogIHQuZW1hY3JvbmFjdXRlID0gMHgxZTE3OwogIHQuZW1hY3JvbmdyYXZlID0gMHgxZTE1OwogIHQuZW1jeXJpbGxpYyA9IDB4MDQzYzsKICB0LmVtZGFzaCA9IDB4MjAxNDsKICB0LmVtZGFzaHZlcnRpY2FsID0gMHhmZTMxOwogIHQuZW1vbm9zcGFjZSA9IDB4ZmY0NTsKICB0LmVtcGhhc2lzbWFya2FybWVuaWFuID0gMHgwNTViOwogIHQuZW1wdHlzZXQgPSAweDIyMDU7CiAgdC5lbmJvcG9tb2ZvID0gMHgzMTIzOwogIHQuZW5jeXJpbGxpYyA9IDB4MDQzZDsKICB0LmVuZGFzaCA9IDB4MjAxMzsKICB0LmVuZGFzaHZlcnRpY2FsID0gMHhmZTMyOwogIHQuZW5kZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhMzsKICB0LmVuZyA9IDB4MDE0YjsKICB0LmVuZ2JvcG9tb2ZvID0gMHgzMTI1OwogIHQuZW5naGVjeXJpbGxpYyA9IDB4MDRhNTsKICB0LmVuaG9va2N5cmlsbGljID0gMHgwNGM4OwogIHQuZW5zcGFjZSA9IDB4MjAwMjsKICB0LmVvZ29uZWsgPSAweDAxMTk7CiAgdC5lb2tvcmVhbiA9IDB4MzE1MzsKICB0LmVvcGVuID0gMHgwMjViOwogIHQuZW9wZW5jbG9zZWQgPSAweDAyOWE7CiAgdC5lb3BlbnJldmVyc2VkID0gMHgwMjVjOwogIHQuZW9wZW5yZXZlcnNlZGNsb3NlZCA9IDB4MDI1ZTsKICB0LmVvcGVucmV2ZXJzZWRob29rID0gMHgwMjVkOwogIHQuZXBhcmVuID0gMHgyNGEwOwogIHQuZXBzaWxvbiA9IDB4MDNiNTsKICB0LmVwc2lsb250b25vcyA9IDB4MDNhZDsKICB0LmVxdWFsID0gMHgwMDNkOwogIHQuZXF1YWxtb25vc3BhY2UgPSAweGZmMWQ7CiAgdC5lcXVhbHNtYWxsID0gMHhmZTY2OwogIHQuZXF1YWxzdXBlcmlvciA9IDB4MjA3YzsKICB0LmVxdWl2YWxlbmNlID0gMHgyMjYxOwogIHQuZXJib3BvbW9mbyA9IDB4MzEyNjsKICB0LmVyY3lyaWxsaWMgPSAweDA0NDA7CiAgdC5lcmV2ZXJzZWQgPSAweDAyNTg7CiAgdC5lcmV2ZXJzZWRjeXJpbGxpYyA9IDB4MDQ0ZDsKICB0LmVzY3lyaWxsaWMgPSAweDA0NDE7CiAgdC5lc2Rlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFiOwogIHQuZXNoID0gMHgwMjgzOwogIHQuZXNoY3VybCA9IDB4MDI4NjsKICB0LmVzaG9ydGRldmEgPSAweDA5MGU7CiAgdC5lc2hvcnR2b3dlbHNpZ25kZXZhID0gMHgwOTQ2OwogIHQuZXNocmV2ZXJzZWRsb29wID0gMHgwMWFhOwogIHQuZXNoc3F1YXRyZXZlcnNlZCA9IDB4MDI4NTsKICB0LmVzbWFsbGhpcmFnYW5hID0gMHgzMDQ3OwogIHQuZXNtYWxsa2F0YWthbmEgPSAweDMwYTc7CiAgdC5lc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YTsKICB0LmVzdGltYXRlZCA9IDB4MjEyZTsKICB0LmVzdXBlcmlvciA9IDB4ZjZlYzsKICB0LmV0YSA9IDB4MDNiNzsKICB0LmV0YXJtZW5pYW4gPSAweDA1Njg7CiAgdC5ldGF0b25vcyA9IDB4MDNhZTsKICB0LmV0aCA9IDB4MDBmMDsKICB0LmV0aWxkZSA9IDB4MWViZDsKICB0LmV0aWxkZWJlbG93ID0gMHgxZTFiOwogIHQuZXRuYWh0YWZvdWtoaGVicmV3ID0gMHgwNTkxOwogIHQuZXRuYWh0YWZvdWtobGVmdGhlYnJldyA9IDB4MDU5MTsKICB0LmV0bmFodGFoZWJyZXcgPSAweDA1OTE7CiAgdC5ldG5haHRhbGVmdGhlYnJldyA9IDB4MDU5MTsKICB0LmV0dXJuZWQgPSAweDAxZGQ7CiAgdC5ldWtvcmVhbiA9IDB4MzE2MTsKICB0LmV1cm8gPSAweDIwYWM7CiAgdC5ldm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljNzsKICB0LmV2b3dlbHNpZ25kZXZhID0gMHgwOTQ3OwogIHQuZXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWM3OwogIHQuZXhjbGFtID0gMHgwMDIxOwogIHQuZXhjbGFtYXJtZW5pYW4gPSAweDA1NWM7CiAgdC5leGNsYW1kYmwgPSAweDIwM2M7CiAgdC5leGNsYW1kb3duID0gMHgwMGExOwogIHQuZXhjbGFtZG93bnNtYWxsID0gMHhmN2ExOwogIHQuZXhjbGFtbW9ub3NwYWNlID0gMHhmZjAxOwogIHQuZXhjbGFtc21hbGwgPSAweGY3MjE7CiAgdC5leGlzdGVudGlhbCA9IDB4MjIwMzsKICB0LmV6aCA9IDB4MDI5MjsKICB0LmV6aGNhcm9uID0gMHgwMWVmOwogIHQuZXpoY3VybCA9IDB4MDI5MzsKICB0LmV6aHJldmVyc2VkID0gMHgwMWI5OwogIHQuZXpodGFpbCA9IDB4MDFiYTsKICB0LmYgPSAweDAwNjY7CiAgdC5mYWRldmEgPSAweDA5NWU7CiAgdC5mYWd1cm11a2hpID0gMHgwYTVlOwogIHQuZmFocmVuaGVpdCA9IDB4MjEwOTsKICB0LmZhdGhhYXJhYmljID0gMHgwNjRlOwogIHQuZmF0aGFsb3dhcmFiaWMgPSAweDA2NGU7CiAgdC5mYXRoYXRhbmFyYWJpYyA9IDB4MDY0YjsKICB0LmZib3BvbW9mbyA9IDB4MzEwODsKICB0LmZjaXJjbGUgPSAweDI0ZDU7CiAgdC5mZG90YWNjZW50ID0gMHgxZTFmOwogIHQuZmVoYXJhYmljID0gMHgwNjQxOwogIHQuZmVoYXJtZW5pYW4gPSAweDA1ODY7CiAgdC5mZWhmaW5hbGFyYWJpYyA9IDB4ZmVkMjsKICB0LmZlaGluaXRpYWxhcmFiaWMgPSAweGZlZDM7CiAgdC5mZWhtZWRpYWxhcmFiaWMgPSAweGZlZDQ7CiAgdC5mZWljb3B0aWMgPSAweDAzZTU7CiAgdC5mZW1hbGUgPSAweDI2NDA7CiAgdC5mZiA9IDB4ZmIwMDsKICB0LmZfZiA9IDB4ZmIwMDsKICB0LmZmaSA9IDB4ZmIwMzsKICB0LmZfZl9pID0gMHhmYjAzOwogIHQuZmZsID0gMHhmYjA0OwogIHQuZl9mX2wgPSAweGZiMDQ7CiAgdC5maSA9IDB4ZmIwMTsKICB0LmZfaSA9IDB4ZmIwMTsKICB0LmZpZnRlZW5jaXJjbGUgPSAweDI0NmU7CiAgdC5maWZ0ZWVucGFyZW4gPSAweDI0ODI7CiAgdC5maWZ0ZWVucGVyaW9kID0gMHgyNDk2OwogIHQuZmlndXJlZGFzaCA9IDB4MjAxMjsKICB0LmZpbGxlZGJveCA9IDB4MjVhMDsKICB0LmZpbGxlZHJlY3QgPSAweDI1YWM7CiAgdC5maW5hbGthZiA9IDB4MDVkYTsKICB0LmZpbmFsa2FmZGFnZXNoID0gMHhmYjNhOwogIHQuZmluYWxrYWZkYWdlc2hoZWJyZXcgPSAweGZiM2E7CiAgdC5maW5hbGthZmhlYnJldyA9IDB4MDVkYTsKICB0LmZpbmFsbWVtID0gMHgwNWRkOwogIHQuZmluYWxtZW1oZWJyZXcgPSAweDA1ZGQ7CiAgdC5maW5hbG51biA9IDB4MDVkZjsKICB0LmZpbmFsbnVuaGVicmV3ID0gMHgwNWRmOwogIHQuZmluYWxwZSA9IDB4MDVlMzsKICB0LmZpbmFscGVoZWJyZXcgPSAweDA1ZTM7CiAgdC5maW5hbHRzYWRpID0gMHgwNWU1OwogIHQuZmluYWx0c2FkaWhlYnJldyA9IDB4MDVlNTsKICB0LmZpcnN0dG9uZWNoaW5lc2UgPSAweDAyYzk7CiAgdC5maXNoZXllID0gMHgyNWM5OwogIHQuZml0YWN5cmlsbGljID0gMHgwNDczOwogIHQuZml2ZSA9IDB4MDAzNTsKICB0LmZpdmVhcmFiaWMgPSAweDA2NjU7CiAgdC5maXZlYmVuZ2FsaSA9IDB4MDllYjsKICB0LmZpdmVjaXJjbGUgPSAweDI0NjQ7CiAgdC5maXZlY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc4ZTsKICB0LmZpdmVkZXZhID0gMHgwOTZiOwogIHQuZml2ZWVpZ2h0aHMgPSAweDIxNWQ7CiAgdC5maXZlZ3VqYXJhdGkgPSAweDBhZWI7CiAgdC5maXZlZ3VybXVraGkgPSAweDBhNmI7CiAgdC5maXZlaGFja2FyYWJpYyA9IDB4MDY2NTsKICB0LmZpdmVoYW5nemhvdSA9IDB4MzAyNTsKICB0LmZpdmVpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI0OwogIHQuZml2ZWluZmVyaW9yID0gMHgyMDg1OwogIHQuZml2ZW1vbm9zcGFjZSA9IDB4ZmYxNTsKICB0LmZpdmVvbGRzdHlsZSA9IDB4ZjczNTsKICB0LmZpdmVwYXJlbiA9IDB4MjQ3ODsKICB0LmZpdmVwZXJpb2QgPSAweDI0OGM7CiAgdC5maXZlcGVyc2lhbiA9IDB4MDZmNTsKICB0LmZpdmVyb21hbiA9IDB4MjE3NDsKICB0LmZpdmVzdXBlcmlvciA9IDB4MjA3NTsKICB0LmZpdmV0aGFpID0gMHgwZTU1OwogIHQuZmwgPSAweGZiMDI7CiAgdC5mX2wgPSAweGZiMDI7CiAgdC5mbG9yaW4gPSAweDAxOTI7CiAgdC5mbW9ub3NwYWNlID0gMHhmZjQ2OwogIHQuZm1zcXVhcmUgPSAweDMzOTk7CiAgdC5mb2ZhbnRoYWkgPSAweDBlMWY7CiAgdC5mb2ZhdGhhaSA9IDB4MGUxZDsKICB0LmZvbmdtYW50aGFpID0gMHgwZTRmOwogIHQuZm9yYWxsID0gMHgyMjAwOwogIHQuZm91ciA9IDB4MDAzNDsKICB0LmZvdXJhcmFiaWMgPSAweDA2NjQ7CiAgdC5mb3VyYmVuZ2FsaSA9IDB4MDllYTsKICB0LmZvdXJjaXJjbGUgPSAweDI0NjM7CiAgdC5mb3VyY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc4ZDsKICB0LmZvdXJkZXZhID0gMHgwOTZhOwogIHQuZm91cmd1amFyYXRpID0gMHgwYWVhOwogIHQuZm91cmd1cm11a2hpID0gMHgwYTZhOwogIHQuZm91cmhhY2thcmFiaWMgPSAweDA2NjQ7CiAgdC5mb3VyaGFuZ3pob3UgPSAweDMwMjQ7CiAgdC5mb3VyaWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyMzsKICB0LmZvdXJpbmZlcmlvciA9IDB4MjA4NDsKICB0LmZvdXJtb25vc3BhY2UgPSAweGZmMTQ7CiAgdC5mb3VybnVtZXJhdG9yYmVuZ2FsaSA9IDB4MDlmNzsKICB0LmZvdXJvbGRzdHlsZSA9IDB4ZjczNDsKICB0LmZvdXJwYXJlbiA9IDB4MjQ3NzsKICB0LmZvdXJwZXJpb2QgPSAweDI0OGI7CiAgdC5mb3VycGVyc2lhbiA9IDB4MDZmNDsKICB0LmZvdXJyb21hbiA9IDB4MjE3MzsKICB0LmZvdXJzdXBlcmlvciA9IDB4MjA3NDsKICB0LmZvdXJ0ZWVuY2lyY2xlID0gMHgyNDZkOwogIHQuZm91cnRlZW5wYXJlbiA9IDB4MjQ4MTsKICB0LmZvdXJ0ZWVucGVyaW9kID0gMHgyNDk1OwogIHQuZm91cnRoYWkgPSAweDBlNTQ7CiAgdC5mb3VydGh0b25lY2hpbmVzZSA9IDB4MDJjYjsKICB0LmZwYXJlbiA9IDB4MjRhMTsKICB0LmZyYWN0aW9uID0gMHgyMDQ0OwogIHQuZnJhbmMgPSAweDIwYTM7CiAgdC5nID0gMHgwMDY3OwogIHQuZ2FiZW5nYWxpID0gMHgwOTk3OwogIHQuZ2FjdXRlID0gMHgwMWY1OwogIHQuZ2FkZXZhID0gMHgwOTE3OwogIHQuZ2FmYXJhYmljID0gMHgwNmFmOwogIHQuZ2FmZmluYWxhcmFiaWMgPSAweGZiOTM7CiAgdC5nYWZpbml0aWFsYXJhYmljID0gMHhmYjk0OwogIHQuZ2FmbWVkaWFsYXJhYmljID0gMHhmYjk1OwogIHQuZ2FndWphcmF0aSA9IDB4MGE5NzsKICB0LmdhZ3VybXVraGkgPSAweDBhMTc7CiAgdC5nYWhpcmFnYW5hID0gMHgzMDRjOwogIHQuZ2FrYXRha2FuYSA9IDB4MzBhYzsKICB0LmdhbW1hID0gMHgwM2IzOwogIHQuZ2FtbWFsYXRpbnNtYWxsID0gMHgwMjYzOwogIHQuZ2FtbWFzdXBlcmlvciA9IDB4MDJlMDsKICB0LmdhbmdpYWNvcHRpYyA9IDB4MDNlYjsKICB0Lmdib3BvbW9mbyA9IDB4MzEwZDsKICB0LmdicmV2ZSA9IDB4MDExZjsKICB0LmdjYXJvbiA9IDB4MDFlNzsKICB0LmdjZWRpbGxhID0gMHgwMTIzOwogIHQuZ2NpcmNsZSA9IDB4MjRkNjsKICB0LmdjaXJjdW1mbGV4ID0gMHgwMTFkOwogIHQuZ2NvbW1hYWNjZW50ID0gMHgwMTIzOwogIHQuZ2RvdCA9IDB4MDEyMTsKICB0Lmdkb3RhY2NlbnQgPSAweDAxMjE7CiAgdC5nZWN5cmlsbGljID0gMHgwNDMzOwogIHQuZ2VoaXJhZ2FuYSA9IDB4MzA1MjsKICB0Lmdla2F0YWthbmEgPSAweDMwYjI7CiAgdC5nZW9tZXRyaWNhbGx5ZXF1YWwgPSAweDIyNTE7CiAgdC5nZXJlc2hhY2NlbnRoZWJyZXcgPSAweDA1OWM7CiAgdC5nZXJlc2hoZWJyZXcgPSAweDA1ZjM7CiAgdC5nZXJlc2htdXFkYW1oZWJyZXcgPSAweDA1OWQ7CiAgdC5nZXJtYW5kYmxzID0gMHgwMGRmOwogIHQuZ2Vyc2hheWltYWNjZW50aGVicmV3ID0gMHgwNTllOwogIHQuZ2Vyc2hheWltaGVicmV3ID0gMHgwNWY0OwogIHQuZ2V0YW1hcmsgPSAweDMwMTM7CiAgdC5naGFiZW5nYWxpID0gMHgwOTk4OwogIHQuZ2hhZGFybWVuaWFuID0gMHgwNTcyOwogIHQuZ2hhZGV2YSA9IDB4MDkxODsKICB0LmdoYWd1amFyYXRpID0gMHgwYTk4OwogIHQuZ2hhZ3VybXVraGkgPSAweDBhMTg7CiAgdC5naGFpbmFyYWJpYyA9IDB4MDYzYTsKICB0LmdoYWluZmluYWxhcmFiaWMgPSAweGZlY2U7CiAgdC5naGFpbmluaXRpYWxhcmFiaWMgPSAweGZlY2Y7CiAgdC5naGFpbm1lZGlhbGFyYWJpYyA9IDB4ZmVkMDsKICB0LmdoZW1pZGRsZWhvb2tjeXJpbGxpYyA9IDB4MDQ5NTsKICB0LmdoZXN0cm9rZWN5cmlsbGljID0gMHgwNDkzOwogIHQuZ2hldXB0dXJuY3lyaWxsaWMgPSAweDA0OTE7CiAgdC5naGhhZGV2YSA9IDB4MDk1YTsKICB0LmdoaGFndXJtdWtoaSA9IDB4MGE1YTsKICB0Lmdob29rID0gMHgwMjYwOwogIHQuZ2h6c3F1YXJlID0gMHgzMzkzOwogIHQuZ2loaXJhZ2FuYSA9IDB4MzA0ZTsKICB0Lmdpa2F0YWthbmEgPSAweDMwYWU7CiAgdC5naW1hcm1lbmlhbiA9IDB4MDU2MzsKICB0LmdpbWVsID0gMHgwNWQyOwogIHQuZ2ltZWxkYWdlc2ggPSAweGZiMzI7CiAgdC5naW1lbGRhZ2VzaGhlYnJldyA9IDB4ZmIzMjsKICB0LmdpbWVsaGVicmV3ID0gMHgwNWQyOwogIHQuZ2plY3lyaWxsaWMgPSAweDA0NTM7CiAgdC5nbG90dGFsaW52ZXJ0ZWRzdHJva2UgPSAweDAxYmU7CiAgdC5nbG90dGFsc3RvcCA9IDB4MDI5NDsKICB0Lmdsb3R0YWxzdG9waW52ZXJ0ZWQgPSAweDAyOTY7CiAgdC5nbG90dGFsc3RvcG1vZCA9IDB4MDJjMDsKICB0Lmdsb3R0YWxzdG9wcmV2ZXJzZWQgPSAweDAyOTU7CiAgdC5nbG90dGFsc3RvcHJldmVyc2VkbW9kID0gMHgwMmMxOwogIHQuZ2xvdHRhbHN0b3ByZXZlcnNlZHN1cGVyaW9yID0gMHgwMmU0OwogIHQuZ2xvdHRhbHN0b3BzdHJva2UgPSAweDAyYTE7CiAgdC5nbG90dGFsc3RvcHN0cm9rZXJldmVyc2VkID0gMHgwMmEyOwogIHQuZ21hY3JvbiA9IDB4MWUyMTsKICB0Lmdtb25vc3BhY2UgPSAweGZmNDc7CiAgdC5nb2hpcmFnYW5hID0gMHgzMDU0OwogIHQuZ29rYXRha2FuYSA9IDB4MzBiNDsKICB0LmdwYXJlbiA9IDB4MjRhMjsKICB0LmdwYXNxdWFyZSA9IDB4MzNhYzsKICB0LmdyYWRpZW50ID0gMHgyMjA3OwogIHQuZ3JhdmUgPSAweDAwNjA7CiAgdC5ncmF2ZWJlbG93Y21iID0gMHgwMzE2OwogIHQuZ3JhdmVjbWIgPSAweDAzMDA7CiAgdC5ncmF2ZWNvbWIgPSAweDAzMDA7CiAgdC5ncmF2ZWRldmEgPSAweDA5NTM7CiAgdC5ncmF2ZWxvd21vZCA9IDB4MDJjZTsKICB0LmdyYXZlbW9ub3NwYWNlID0gMHhmZjQwOwogIHQuZ3JhdmV0b25lY21iID0gMHgwMzQwOwogIHQuZ3JlYXRlciA9IDB4MDAzZTsKICB0LmdyZWF0ZXJlcXVhbCA9IDB4MjI2NTsKICB0LmdyZWF0ZXJlcXVhbG9ybGVzcyA9IDB4MjJkYjsKICB0LmdyZWF0ZXJtb25vc3BhY2UgPSAweGZmMWU7CiAgdC5ncmVhdGVyb3JlcXVpdmFsZW50ID0gMHgyMjczOwogIHQuZ3JlYXRlcm9ybGVzcyA9IDB4MjI3NzsKICB0LmdyZWF0ZXJvdmVyZXF1YWwgPSAweDIyNjc7CiAgdC5ncmVhdGVyc21hbGwgPSAweGZlNjU7CiAgdC5nc2NyaXB0ID0gMHgwMjYxOwogIHQuZ3N0cm9rZSA9IDB4MDFlNTsKICB0Lmd1aGlyYWdhbmEgPSAweDMwNTA7CiAgdC5ndWlsbGVtb3RsZWZ0ID0gMHgwMGFiOwogIHQuZ3VpbGxlbW90cmlnaHQgPSAweDAwYmI7CiAgdC5ndWlsc2luZ2xsZWZ0ID0gMHgyMDM5OwogIHQuZ3VpbHNpbmdscmlnaHQgPSAweDIwM2E7CiAgdC5ndWthdGFrYW5hID0gMHgzMGIwOwogIHQuZ3VyYW11c3F1YXJlID0gMHgzMzE4OwogIHQuZ3lzcXVhcmUgPSAweDMzYzk7CiAgdC5oID0gMHgwMDY4OwogIHQuaGFhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRhOTsKICB0LmhhYWx0b25lYXJhYmljID0gMHgwNmMxOwogIHQuaGFiZW5nYWxpID0gMHgwOWI5OwogIHQuaGFkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRiMzsKICB0LmhhZGV2YSA9IDB4MDkzOTsKICB0LmhhZ3VqYXJhdGkgPSAweDBhYjk7CiAgdC5oYWd1cm11a2hpID0gMHgwYTM5OwogIHQuaGFoYXJhYmljID0gMHgwNjJkOwogIHQuaGFoZmluYWxhcmFiaWMgPSAweGZlYTI7CiAgdC5oYWhpbml0aWFsYXJhYmljID0gMHhmZWEzOwogIHQuaGFoaXJhZ2FuYSA9IDB4MzA2ZjsKICB0LmhhaG1lZGlhbGFyYWJpYyA9IDB4ZmVhNDsKICB0LmhhaXR1c3F1YXJlID0gMHgzMzJhOwogIHQuaGFrYXRha2FuYSA9IDB4MzBjZjsKICB0Lmhha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOGE7CiAgdC5oYWxhbnRndXJtdWtoaSA9IDB4MGE0ZDsKICB0LmhhbXphYXJhYmljID0gMHgwNjIxOwogIHQuaGFtemFsb3dhcmFiaWMgPSAweDA2MjE7CiAgdC5oYW5ndWxmaWxsZXIgPSAweDMxNjQ7CiAgdC5oYXJkc2lnbmN5cmlsbGljID0gMHgwNDRhOwogIHQuaGFycG9vbmxlZnRiYXJidXAgPSAweDIxYmM7CiAgdC5oYXJwb29ucmlnaHRiYXJidXAgPSAweDIxYzA7CiAgdC5oYXNxdWFyZSA9IDB4MzNjYTsKICB0LmhhdGFmcGF0YWggPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMTYgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMjMgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMmYgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoaGVicmV3ID0gMHgwNWIyOwogIHQuaGF0YWZwYXRhaG5hcnJvd2hlYnJldyA9IDB4MDViMjsKICB0LmhhdGFmcGF0YWhxdWFydGVyaGVicmV3ID0gMHgwNWIyOwogIHQuaGF0YWZwYXRhaHdpZGVoZWJyZXcgPSAweDA1YjI7CiAgdC5oYXRhZnFhbWF0cyA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzMWIgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0czI4ID0gMHgwNWIzOwogIHQuaGF0YWZxYW1hdHMzNCA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzaGVicmV3ID0gMHgwNWIzOwogIHQuaGF0YWZxYW1hdHNuYXJyb3doZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0c3F1YXJ0ZXJoZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0c3dpZGVoZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnNlZ29sID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDE3ID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDI0ID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDMwID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbGhlYnJldyA9IDB4MDViMTsKICB0LmhhdGFmc2Vnb2xuYXJyb3doZWJyZXcgPSAweDA1YjE7CiAgdC5oYXRhZnNlZ29scXVhcnRlcmhlYnJldyA9IDB4MDViMTsKICB0LmhhdGFmc2Vnb2x3aWRlaGVicmV3ID0gMHgwNWIxOwogIHQuaGJhciA9IDB4MDEyNzsKICB0Lmhib3BvbW9mbyA9IDB4MzEwZjsKICB0LmhicmV2ZWJlbG93ID0gMHgxZTJiOwogIHQuaGNlZGlsbGEgPSAweDFlMjk7CiAgdC5oY2lyY2xlID0gMHgyNGQ3OwogIHQuaGNpcmN1bWZsZXggPSAweDAxMjU7CiAgdC5oZGllcmVzaXMgPSAweDFlMjc7CiAgdC5oZG90YWNjZW50ID0gMHgxZTIzOwogIHQuaGRvdGJlbG93ID0gMHgxZTI1OwogIHQuaGUgPSAweDA1ZDQ7CiAgdC5oZWFydCA9IDB4MjY2NTsKICB0LmhlYXJ0c3VpdGJsYWNrID0gMHgyNjY1OwogIHQuaGVhcnRzdWl0d2hpdGUgPSAweDI2NjE7CiAgdC5oZWRhZ2VzaCA9IDB4ZmIzNDsKICB0LmhlZGFnZXNoaGVicmV3ID0gMHhmYjM0OwogIHQuaGVoYWx0b25lYXJhYmljID0gMHgwNmMxOwogIHQuaGVoYXJhYmljID0gMHgwNjQ3OwogIHQuaGVoZWJyZXcgPSAweDA1ZDQ7CiAgdC5oZWhmaW5hbGFsdG9uZWFyYWJpYyA9IDB4ZmJhNzsKICB0LmhlaGZpbmFsYWx0dHdvYXJhYmljID0gMHhmZWVhOwogIHQuaGVoZmluYWxhcmFiaWMgPSAweGZlZWE7CiAgdC5oZWhoYW16YWFib3ZlZmluYWxhcmFiaWMgPSAweGZiYTU7CiAgdC5oZWhoYW16YWFib3ZlaXNvbGF0ZWRhcmFiaWMgPSAweGZiYTQ7CiAgdC5oZWhpbml0aWFsYWx0b25lYXJhYmljID0gMHhmYmE4OwogIHQuaGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmVlYjsKICB0LmhlaGlyYWdhbmEgPSAweDMwNzg7CiAgdC5oZWhtZWRpYWxhbHRvbmVhcmFiaWMgPSAweGZiYTk7CiAgdC5oZWhtZWRpYWxhcmFiaWMgPSAweGZlZWM7CiAgdC5oZWlzZWllcmFzcXVhcmUgPSAweDMzN2I7CiAgdC5oZWthdGFrYW5hID0gMHgzMGQ4OwogIHQuaGVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4ZDsKICB0Lmhla3V0YWFydXNxdWFyZSA9IDB4MzMzNjsKICB0Lmhlbmdob29rID0gMHgwMjY3OwogIHQuaGVydXR1c3F1YXJlID0gMHgzMzM5OwogIHQuaGV0ID0gMHgwNWQ3OwogIHQuaGV0aGVicmV3ID0gMHgwNWQ3OwogIHQuaGhvb2sgPSAweDAyNjY7CiAgdC5oaG9va3N1cGVyaW9yID0gMHgwMmIxOwogIHQuaGlldWhhY2lyY2xla29yZWFuID0gMHgzMjdiOwogIHQuaGlldWhhcGFyZW5rb3JlYW4gPSAweDMyMWI7CiAgdC5oaWV1aGNpcmNsZWtvcmVhbiA9IDB4MzI2ZDsKICB0LmhpZXVoa29yZWFuID0gMHgzMTRlOwogIHQuaGlldWhwYXJlbmtvcmVhbiA9IDB4MzIwZDsKICB0LmhpaGlyYWdhbmEgPSAweDMwNzI7CiAgdC5oaWthdGFrYW5hID0gMHgzMGQyOwogIHQuaGlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4YjsKICB0LmhpcmlxID0gMHgwNWI0OwogIHQuaGlyaXExNCA9IDB4MDViNDsKICB0LmhpcmlxMjEgPSAweDA1YjQ7CiAgdC5oaXJpcTJkID0gMHgwNWI0OwogIHQuaGlyaXFoZWJyZXcgPSAweDA1YjQ7CiAgdC5oaXJpcW5hcnJvd2hlYnJldyA9IDB4MDViNDsKICB0LmhpcmlxcXVhcnRlcmhlYnJldyA9IDB4MDViNDsKICB0Lmhpcmlxd2lkZWhlYnJldyA9IDB4MDViNDsKICB0LmhsaW5lYmVsb3cgPSAweDFlOTY7CiAgdC5obW9ub3NwYWNlID0gMHhmZjQ4OwogIHQuaG9hcm1lbmlhbiA9IDB4MDU3MDsKICB0LmhvaGlwdGhhaSA9IDB4MGUyYjsKICB0LmhvaGlyYWdhbmEgPSAweDMwN2I7CiAgdC5ob2thdGFrYW5hID0gMHgzMGRiOwogIHQuaG9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4ZTsKICB0LmhvbGFtID0gMHgwNWI5OwogIHQuaG9sYW0xOSA9IDB4MDViOTsKICB0LmhvbGFtMjYgPSAweDA1Yjk7CiAgdC5ob2xhbTMyID0gMHgwNWI5OwogIHQuaG9sYW1oZWJyZXcgPSAweDA1Yjk7CiAgdC5ob2xhbW5hcnJvd2hlYnJldyA9IDB4MDViOTsKICB0LmhvbGFtcXVhcnRlcmhlYnJldyA9IDB4MDViOTsKICB0LmhvbGFtd2lkZWhlYnJldyA9IDB4MDViOTsKICB0Lmhvbm9raHVrdGhhaSA9IDB4MGUyZTsKICB0Lmhvb2thYm92ZWNvbWIgPSAweDAzMDk7CiAgdC5ob29rY21iID0gMHgwMzA5OwogIHQuaG9va3BhbGF0YWxpemVkYmVsb3djbWIgPSAweDAzMjE7CiAgdC5ob29rcmV0cm9mbGV4YmVsb3djbWIgPSAweDAzMjI7CiAgdC5ob29uc3F1YXJlID0gMHgzMzQyOwogIHQuaG9yaWNvcHRpYyA9IDB4MDNlOTsKICB0Lmhvcml6b250YWxiYXIgPSAweDIwMTU7CiAgdC5ob3JuY21iID0gMHgwMzFiOwogIHQuaG90c3ByaW5ncyA9IDB4MjY2ODsKICB0LmhvdXNlID0gMHgyMzAyOwogIHQuaHBhcmVuID0gMHgyNGEzOwogIHQuaHN1cGVyaW9yID0gMHgwMmIwOwogIHQuaHR1cm5lZCA9IDB4MDI2NTsKICB0Lmh1aGlyYWdhbmEgPSAweDMwNzU7CiAgdC5odWlpdG9zcXVhcmUgPSAweDMzMzM7CiAgdC5odWthdGFrYW5hID0gMHgzMGQ1OwogIHQuaHVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4YzsKICB0Lmh1bmdhcnVtbGF1dCA9IDB4MDJkZDsKICB0Lmh1bmdhcnVtbGF1dGNtYiA9IDB4MDMwYjsKICB0Lmh2ID0gMHgwMTk1OwogIHQuaHlwaGVuID0gMHgwMDJkOwogIHQuaHlwaGVuaW5mZXJpb3IgPSAweGY2ZTU7CiAgdC5oeXBoZW5tb25vc3BhY2UgPSAweGZmMGQ7CiAgdC5oeXBoZW5zbWFsbCA9IDB4ZmU2MzsKICB0Lmh5cGhlbnN1cGVyaW9yID0gMHhmNmU2OwogIHQuaHlwaGVudHdvID0gMHgyMDEwOwogIHQuaSA9IDB4MDA2OTsKICB0LmlhY3V0ZSA9IDB4MDBlZDsKICB0LmlhY3lyaWxsaWMgPSAweDA0NGY7CiAgdC5pYmVuZ2FsaSA9IDB4MDk4NzsKICB0Lmlib3BvbW9mbyA9IDB4MzEyNzsKICB0LmlicmV2ZSA9IDB4MDEyZDsKICB0LmljYXJvbiA9IDB4MDFkMDsKICB0LmljaXJjbGUgPSAweDI0ZDg7CiAgdC5pY2lyY3VtZmxleCA9IDB4MDBlZTsKICB0LmljeXJpbGxpYyA9IDB4MDQ1NjsKICB0LmlkYmxncmF2ZSA9IDB4MDIwOTsKICB0LmlkZW9ncmFwaGVhcnRoY2lyY2xlID0gMHgzMjhmOwogIHQuaWRlb2dyYXBoZmlyZWNpcmNsZSA9IDB4MzI4YjsKICB0LmlkZW9ncmFwaGljYWxsaWFuY2VwYXJlbiA9IDB4MzIzZjsKICB0LmlkZW9ncmFwaGljY2FsbHBhcmVuID0gMHgzMjNhOwogIHQuaWRlb2dyYXBoaWNjZW50cmVjaXJjbGUgPSAweDMyYTU7CiAgdC5pZGVvZ3JhcGhpY2Nsb3NlID0gMHgzMDA2OwogIHQuaWRlb2dyYXBoaWNjb21tYSA9IDB4MzAwMTsKICB0LmlkZW9ncmFwaGljY29tbWFsZWZ0ID0gMHhmZjY0OwogIHQuaWRlb2dyYXBoaWNjb25ncmF0dWxhdGlvbnBhcmVuID0gMHgzMjM3OwogIHQuaWRlb2dyYXBoaWNjb3JyZWN0Y2lyY2xlID0gMHgzMmEzOwogIHQuaWRlb2dyYXBoaWNlYXJ0aHBhcmVuID0gMHgzMjJmOwogIHQuaWRlb2dyYXBoaWNlbnRlcnByaXNlcGFyZW4gPSAweDMyM2Q7CiAgdC5pZGVvZ3JhcGhpY2V4Y2VsbGVudGNpcmNsZSA9IDB4MzI5ZDsKICB0LmlkZW9ncmFwaGljZmVzdGl2YWxwYXJlbiA9IDB4MzI0MDsKICB0LmlkZW9ncmFwaGljZmluYW5jaWFsY2lyY2xlID0gMHgzMjk2OwogIHQuaWRlb2dyYXBoaWNmaW5hbmNpYWxwYXJlbiA9IDB4MzIzNjsKICB0LmlkZW9ncmFwaGljZmlyZXBhcmVuID0gMHgzMjJiOwogIHQuaWRlb2dyYXBoaWNoYXZlcGFyZW4gPSAweDMyMzI7CiAgdC5pZGVvZ3JhcGhpY2hpZ2hjaXJjbGUgPSAweDMyYTQ7CiAgdC5pZGVvZ3JhcGhpY2l0ZXJhdGlvbm1hcmsgPSAweDMwMDU7CiAgdC5pZGVvZ3JhcGhpY2xhYm9yY2lyY2xlID0gMHgzMjk4OwogIHQuaWRlb2dyYXBoaWNsYWJvcnBhcmVuID0gMHgzMjM4OwogIHQuaWRlb2dyYXBoaWNsZWZ0Y2lyY2xlID0gMHgzMmE3OwogIHQuaWRlb2dyYXBoaWNsb3djaXJjbGUgPSAweDMyYTY7CiAgdC5pZGVvZ3JhcGhpY21lZGljaW5lY2lyY2xlID0gMHgzMmE5OwogIHQuaWRlb2dyYXBoaWNtZXRhbHBhcmVuID0gMHgzMjJlOwogIHQuaWRlb2dyYXBoaWNtb29ucGFyZW4gPSAweDMyMmE7CiAgdC5pZGVvZ3JhcGhpY25hbWVwYXJlbiA9IDB4MzIzNDsKICB0LmlkZW9ncmFwaGljcGVyaW9kID0gMHgzMDAyOwogIHQuaWRlb2dyYXBoaWNwcmludGNpcmNsZSA9IDB4MzI5ZTsKICB0LmlkZW9ncmFwaGljcmVhY2hwYXJlbiA9IDB4MzI0MzsKICB0LmlkZW9ncmFwaGljcmVwcmVzZW50cGFyZW4gPSAweDMyMzk7CiAgdC5pZGVvZ3JhcGhpY3Jlc291cmNlcGFyZW4gPSAweDMyM2U7CiAgdC5pZGVvZ3JhcGhpY3JpZ2h0Y2lyY2xlID0gMHgzMmE4OwogIHQuaWRlb2dyYXBoaWNzZWNyZXRjaXJjbGUgPSAweDMyOTk7CiAgdC5pZGVvZ3JhcGhpY3NlbGZwYXJlbiA9IDB4MzI0MjsKICB0LmlkZW9ncmFwaGljc29jaWV0eXBhcmVuID0gMHgzMjMzOwogIHQuaWRlb2dyYXBoaWNzcGFjZSA9IDB4MzAwMDsKICB0LmlkZW9ncmFwaGljc3BlY2lhbHBhcmVuID0gMHgzMjM1OwogIHQuaWRlb2dyYXBoaWNzdG9ja3BhcmVuID0gMHgzMjMxOwogIHQuaWRlb2dyYXBoaWNzdHVkeXBhcmVuID0gMHgzMjNiOwogIHQuaWRlb2dyYXBoaWNzdW5wYXJlbiA9IDB4MzIzMDsKICB0LmlkZW9ncmFwaGljc3VwZXJ2aXNlcGFyZW4gPSAweDMyM2M7CiAgdC5pZGVvZ3JhcGhpY3dhdGVycGFyZW4gPSAweDMyMmM7CiAgdC5pZGVvZ3JhcGhpY3dvb2RwYXJlbiA9IDB4MzIyZDsKICB0LmlkZW9ncmFwaGljemVybyA9IDB4MzAwNzsKICB0LmlkZW9ncmFwaG1ldGFsY2lyY2xlID0gMHgzMjhlOwogIHQuaWRlb2dyYXBobW9vbmNpcmNsZSA9IDB4MzI4YTsKICB0LmlkZW9ncmFwaG5hbWVjaXJjbGUgPSAweDMyOTQ7CiAgdC5pZGVvZ3JhcGhzdW5jaXJjbGUgPSAweDMyOTA7CiAgdC5pZGVvZ3JhcGh3YXRlcmNpcmNsZSA9IDB4MzI4YzsKICB0LmlkZW9ncmFwaHdvb2RjaXJjbGUgPSAweDMyOGQ7CiAgdC5pZGV2YSA9IDB4MDkwNzsKICB0LmlkaWVyZXNpcyA9IDB4MDBlZjsKICB0LmlkaWVyZXNpc2FjdXRlID0gMHgxZTJmOwogIHQuaWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZTU7CiAgdC5pZG90YmVsb3cgPSAweDFlY2I7CiAgdC5pZWJyZXZlY3lyaWxsaWMgPSAweDA0ZDc7CiAgdC5pZWN5cmlsbGljID0gMHgwNDM1OwogIHQuaWV1bmdhY2lyY2xla29yZWFuID0gMHgzMjc1OwogIHQuaWV1bmdhcGFyZW5rb3JlYW4gPSAweDMyMTU7CiAgdC5pZXVuZ2NpcmNsZWtvcmVhbiA9IDB4MzI2NzsKICB0LmlldW5na29yZWFuID0gMHgzMTQ3OwogIHQuaWV1bmdwYXJlbmtvcmVhbiA9IDB4MzIwNzsKICB0LmlncmF2ZSA9IDB4MDBlYzsKICB0LmlndWphcmF0aSA9IDB4MGE4NzsKICB0LmlndXJtdWtoaSA9IDB4MGEwNzsKICB0LmloaXJhZ2FuYSA9IDB4MzA0NDsKICB0Lmlob29rYWJvdmUgPSAweDFlYzk7CiAgdC5paWJlbmdhbGkgPSAweDA5ODg7CiAgdC5paWN5cmlsbGljID0gMHgwNDM4OwogIHQuaWlkZXZhID0gMHgwOTA4OwogIHQuaWlndWphcmF0aSA9IDB4MGE4ODsKICB0LmlpZ3VybXVraGkgPSAweDBhMDg7CiAgdC5paW1hdHJhZ3VybXVraGkgPSAweDBhNDA7CiAgdC5paW52ZXJ0ZWRicmV2ZSA9IDB4MDIwYjsKICB0Lmlpc2hvcnRjeXJpbGxpYyA9IDB4MDQzOTsKICB0Lmlpdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljMDsKICB0Lmlpdm93ZWxzaWduZGV2YSA9IDB4MDk0MDsKICB0Lmlpdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzA7CiAgdC5paiA9IDB4MDEzMzsKICB0LmlrYXRha2FuYSA9IDB4MzBhNDsKICB0LmlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3MjsKICB0Lmlrb3JlYW4gPSAweDMxNjM7CiAgdC5pbGRlID0gMHgwMmRjOwogIHQuaWx1eWhlYnJldyA9IDB4MDVhYzsKICB0LmltYWNyb24gPSAweDAxMmI7CiAgdC5pbWFjcm9uY3lyaWxsaWMgPSAweDA0ZTM7CiAgdC5pbWFnZW9yYXBwcm94aW1hdGVseWVxdWFsID0gMHgyMjUzOwogIHQuaW1hdHJhZ3VybXVraGkgPSAweDBhM2Y7CiAgdC5pbW9ub3NwYWNlID0gMHhmZjQ5OwogIHQuaW5jcmVtZW50ID0gMHgyMjA2OwogIHQuaW5maW5pdHkgPSAweDIyMWU7CiAgdC5pbmlhcm1lbmlhbiA9IDB4MDU2YjsKICB0LmludGVncmFsID0gMHgyMjJiOwogIHQuaW50ZWdyYWxib3R0b20gPSAweDIzMjE7CiAgdC5pbnRlZ3JhbGJ0ID0gMHgyMzIxOwogIHQuaW50ZWdyYWxleCA9IDB4ZjhmNTsKICB0LmludGVncmFsdG9wID0gMHgyMzIwOwogIHQuaW50ZWdyYWx0cCA9IDB4MjMyMDsKICB0LmludGVyc2VjdGlvbiA9IDB4MjIyOTsKICB0LmludGlzcXVhcmUgPSAweDMzMDU7CiAgdC5pbnZidWxsZXQgPSAweDI1ZDg7CiAgdC5pbnZjaXJjbGUgPSAweDI1ZDk7CiAgdC5pbnZzbWlsZWZhY2UgPSAweDI2M2I7CiAgdC5pb2N5cmlsbGljID0gMHgwNDUxOwogIHQuaW9nb25layA9IDB4MDEyZjsKICB0LmlvdGEgPSAweDAzYjk7CiAgdC5pb3RhZGllcmVzaXMgPSAweDAzY2E7CiAgdC5pb3RhZGllcmVzaXN0b25vcyA9IDB4MDM5MDsKICB0LmlvdGFsYXRpbiA9IDB4MDI2OTsKICB0LmlvdGF0b25vcyA9IDB4MDNhZjsKICB0LmlwYXJlbiA9IDB4MjRhNDsKICB0LmlyaWd1cm11a2hpID0gMHgwYTcyOwogIHQuaXNtYWxsaGlyYWdhbmEgPSAweDMwNDM7CiAgdC5pc21hbGxrYXRha2FuYSA9IDB4MzBhMzsKICB0LmlzbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjY4OwogIHQuaXNzaGFyYmVuZ2FsaSA9IDB4MDlmYTsKICB0LmlzdHJva2UgPSAweDAyNjg7CiAgdC5pc3VwZXJpb3IgPSAweGY2ZWQ7CiAgdC5pdGVyYXRpb25oaXJhZ2FuYSA9IDB4MzA5ZDsKICB0Lml0ZXJhdGlvbmthdGFrYW5hID0gMHgzMGZkOwogIHQuaXRpbGRlID0gMHgwMTI5OwogIHQuaXRpbGRlYmVsb3cgPSAweDFlMmQ7CiAgdC5pdWJvcG9tb2ZvID0gMHgzMTI5OwogIHQuaXVjeXJpbGxpYyA9IDB4MDQ0ZTsKICB0Lml2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWJmOwogIHQuaXZvd2Vsc2lnbmRldmEgPSAweDA5M2Y7CiAgdC5pdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYmY7CiAgdC5pemhpdHNhY3lyaWxsaWMgPSAweDA0NzU7CiAgdC5pemhpdHNhZGJsZ3JhdmVjeXJpbGxpYyA9IDB4MDQ3NzsKICB0LmogPSAweDAwNmE7CiAgdC5qYWFybWVuaWFuID0gMHgwNTcxOwogIHQuamFiZW5nYWxpID0gMHgwOTljOwogIHQuamFkZXZhID0gMHgwOTFjOwogIHQuamFndWphcmF0aSA9IDB4MGE5YzsKICB0LmphZ3VybXVraGkgPSAweDBhMWM7CiAgdC5qYm9wb21vZm8gPSAweDMxMTA7CiAgdC5qY2Fyb24gPSAweDAxZjA7CiAgdC5qY2lyY2xlID0gMHgyNGQ5OwogIHQuamNpcmN1bWZsZXggPSAweDAxMzU7CiAgdC5qY3Jvc3NlZHRhaWwgPSAweDAyOWQ7CiAgdC5qZG90bGVzc3N0cm9rZSA9IDB4MDI1ZjsKICB0LmplY3lyaWxsaWMgPSAweDA0NTg7CiAgdC5qZWVtYXJhYmljID0gMHgwNjJjOwogIHQuamVlbWZpbmFsYXJhYmljID0gMHhmZTllOwogIHQuamVlbWluaXRpYWxhcmFiaWMgPSAweGZlOWY7CiAgdC5qZWVtbWVkaWFsYXJhYmljID0gMHhmZWEwOwogIHQuamVoYXJhYmljID0gMHgwNjk4OwogIHQuamVoZmluYWxhcmFiaWMgPSAweGZiOGI7CiAgdC5qaGFiZW5nYWxpID0gMHgwOTlkOwogIHQuamhhZGV2YSA9IDB4MDkxZDsKICB0LmpoYWd1amFyYXRpID0gMHgwYTlkOwogIHQuamhhZ3VybXVraGkgPSAweDBhMWQ7CiAgdC5qaGVoYXJtZW5pYW4gPSAweDA1N2I7CiAgdC5qaXMgPSAweDMwMDQ7CiAgdC5qbW9ub3NwYWNlID0gMHhmZjRhOwogIHQuanBhcmVuID0gMHgyNGE1OwogIHQuanN1cGVyaW9yID0gMHgwMmIyOwogIHQuayA9IDB4MDA2YjsKICB0LmthYmFzaGtpcmN5cmlsbGljID0gMHgwNGExOwogIHQua2FiZW5nYWxpID0gMHgwOTk1OwogIHQua2FjdXRlID0gMHgxZTMxOwogIHQua2FjeXJpbGxpYyA9IDB4MDQzYTsKICB0LmthZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OWI7CiAgdC5rYWRldmEgPSAweDA5MTU7CiAgdC5rYWYgPSAweDA1ZGI7CiAgdC5rYWZhcmFiaWMgPSAweDA2NDM7CiAgdC5rYWZkYWdlc2ggPSAweGZiM2I7CiAgdC5rYWZkYWdlc2hoZWJyZXcgPSAweGZiM2I7CiAgdC5rYWZmaW5hbGFyYWJpYyA9IDB4ZmVkYTsKICB0LmthZmhlYnJldyA9IDB4MDVkYjsKICB0LmthZmluaXRpYWxhcmFiaWMgPSAweGZlZGI7CiAgdC5rYWZtZWRpYWxhcmFiaWMgPSAweGZlZGM7CiAgdC5rYWZyYWZlaGVicmV3ID0gMHhmYjRkOwogIHQua2FndWphcmF0aSA9IDB4MGE5NTsKICB0LmthZ3VybXVraGkgPSAweDBhMTU7CiAgdC5rYWhpcmFnYW5hID0gMHgzMDRiOwogIHQua2Fob29rY3lyaWxsaWMgPSAweDA0YzQ7CiAgdC5rYWthdGFrYW5hID0gMHgzMGFiOwogIHQua2FrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3NjsKICB0LmthcHBhID0gMHgwM2JhOwogIHQua2FwcGFzeW1ib2xncmVlayA9IDB4MDNmMDsKICB0LmthcHllb3VubWlldW1rb3JlYW4gPSAweDMxNzE7CiAgdC5rYXB5ZW91bnBoaWV1cGhrb3JlYW4gPSAweDMxODQ7CiAgdC5rYXB5ZW91bnBpZXVwa29yZWFuID0gMHgzMTc4OwogIHQua2FweWVvdW5zc2FuZ3BpZXVwa29yZWFuID0gMHgzMTc5OwogIHQua2Fyb3JpaXNxdWFyZSA9IDB4MzMwZDsKICB0Lmthc2hpZGFhdXRvYXJhYmljID0gMHgwNjQwOwogIHQua2FzaGlkYWF1dG9ub3NpZGViZWFyaW5nYXJhYmljID0gMHgwNjQwOwogIHQua2FzbWFsbGthdGFrYW5hID0gMHgzMGY1OwogIHQua2FzcXVhcmUgPSAweDMzODQ7CiAgdC5rYXNyYWFyYWJpYyA9IDB4MDY1MDsKICB0Lmthc3JhdGFuYXJhYmljID0gMHgwNjRkOwogIHQua2FzdHJva2VjeXJpbGxpYyA9IDB4MDQ5ZjsKICB0LmthdGFoaXJhcHJvbG9uZ21hcmtoYWxmd2lkdGggPSAweGZmNzA7CiAgdC5rYXZlcnRpY2Fsc3Ryb2tlY3lyaWxsaWMgPSAweDA0OWQ7CiAgdC5rYm9wb21vZm8gPSAweDMxMGU7CiAgdC5rY2Fsc3F1YXJlID0gMHgzMzg5OwogIHQua2Nhcm9uID0gMHgwMWU5OwogIHQua2NlZGlsbGEgPSAweDAxMzc7CiAgdC5rY2lyY2xlID0gMHgyNGRhOwogIHQua2NvbW1hYWNjZW50ID0gMHgwMTM3OwogIHQua2RvdGJlbG93ID0gMHgxZTMzOwogIHQua2VoYXJtZW5pYW4gPSAweDA1ODQ7CiAgdC5rZWhpcmFnYW5hID0gMHgzMDUxOwogIHQua2VrYXRha2FuYSA9IDB4MzBiMTsKICB0Lmtla2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzk7CiAgdC5rZW5hcm1lbmlhbiA9IDB4MDU2ZjsKICB0Lmtlc21hbGxrYXRha2FuYSA9IDB4MzBmNjsKICB0LmtncmVlbmxhbmRpYyA9IDB4MDEzODsKICB0LmtoYWJlbmdhbGkgPSAweDA5OTY7CiAgdC5raGFjeXJpbGxpYyA9IDB4MDQ0NTsKICB0LmtoYWRldmEgPSAweDA5MTY7CiAgdC5raGFndWphcmF0aSA9IDB4MGE5NjsKICB0LmtoYWd1cm11a2hpID0gMHgwYTE2OwogIHQua2hhaGFyYWJpYyA9IDB4MDYyZTsKICB0LmtoYWhmaW5hbGFyYWJpYyA9IDB4ZmVhNjsKICB0LmtoYWhpbml0aWFsYXJhYmljID0gMHhmZWE3OwogIHQua2hhaG1lZGlhbGFyYWJpYyA9IDB4ZmVhODsKICB0LmtoZWljb3B0aWMgPSAweDAzZTc7CiAgdC5raGhhZGV2YSA9IDB4MDk1OTsKICB0LmtoaGFndXJtdWtoaSA9IDB4MGE1OTsKICB0LmtoaWV1a2hhY2lyY2xla29yZWFuID0gMHgzMjc4OwogIHQua2hpZXVraGFwYXJlbmtvcmVhbiA9IDB4MzIxODsKICB0LmtoaWV1a2hjaXJjbGVrb3JlYW4gPSAweDMyNmE7CiAgdC5raGlldWtoa29yZWFuID0gMHgzMTRiOwogIHQua2hpZXVraHBhcmVua29yZWFuID0gMHgzMjBhOwogIHQua2hva2hhaXRoYWkgPSAweDBlMDI7CiAgdC5raG9raG9udGhhaSA9IDB4MGUwNTsKICB0Lmtob2todWF0dGhhaSA9IDB4MGUwMzsKICB0Lmtob2tod2FpdGhhaSA9IDB4MGUwNDsKICB0Lmtob211dHRoYWkgPSAweDBlNWI7CiAgdC5raG9vayA9IDB4MDE5OTsKICB0Lmtob3Jha2hhbmd0aGFpID0gMHgwZTA2OwogIHQua2h6c3F1YXJlID0gMHgzMzkxOwogIHQua2loaXJhZ2FuYSA9IDB4MzA0ZDsKICB0Lmtpa2F0YWthbmEgPSAweDMwYWQ7CiAgdC5raWthdGFrYW5haGFsZndpZHRoID0gMHhmZjc3OwogIHQua2lyb2d1cmFtdXNxdWFyZSA9IDB4MzMxNTsKICB0Lmtpcm9tZWV0b3J1c3F1YXJlID0gMHgzMzE2OwogIHQua2lyb3NxdWFyZSA9IDB4MzMxNDsKICB0LmtpeWVva2FjaXJjbGVrb3JlYW4gPSAweDMyNmU7CiAgdC5raXllb2thcGFyZW5rb3JlYW4gPSAweDMyMGU7CiAgdC5raXllb2tjaXJjbGVrb3JlYW4gPSAweDMyNjA7CiAgdC5raXllb2trb3JlYW4gPSAweDMxMzE7CiAgdC5raXllb2twYXJlbmtvcmVhbiA9IDB4MzIwMDsKICB0LmtpeWVva3Npb3Nrb3JlYW4gPSAweDMxMzM7CiAgdC5ramVjeXJpbGxpYyA9IDB4MDQ1YzsKICB0LmtsaW5lYmVsb3cgPSAweDFlMzU7CiAgdC5rbHNxdWFyZSA9IDB4MzM5ODsKICB0LmttY3ViZWRzcXVhcmUgPSAweDMzYTY7CiAgdC5rbW9ub3NwYWNlID0gMHhmZjRiOwogIHQua21zcXVhcmVkc3F1YXJlID0gMHgzM2EyOwogIHQua29oaXJhZ2FuYSA9IDB4MzA1MzsKICB0LmtvaG1zcXVhcmUgPSAweDMzYzA7CiAgdC5rb2thaXRoYWkgPSAweDBlMDE7CiAgdC5rb2thdGFrYW5hID0gMHgzMGIzOwogIHQua29rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3YTsKICB0Lmtvb3Bvc3F1YXJlID0gMHgzMzFlOwogIHQua29wcGFjeXJpbGxpYyA9IDB4MDQ4MTsKICB0LmtvcmVhbnN0YW5kYXJkc3ltYm9sID0gMHgzMjdmOwogIHQua29yb25pc2NtYiA9IDB4MDM0MzsKICB0LmtwYXJlbiA9IDB4MjRhNjsKICB0LmtwYXNxdWFyZSA9IDB4MzNhYTsKICB0LmtzaWN5cmlsbGljID0gMHgwNDZmOwogIHQua3RzcXVhcmUgPSAweDMzY2Y7CiAgdC5rdHVybmVkID0gMHgwMjllOwogIHQua3VoaXJhZ2FuYSA9IDB4MzA0ZjsKICB0Lmt1a2F0YWthbmEgPSAweDMwYWY7CiAgdC5rdWthdGFrYW5haGFsZndpZHRoID0gMHhmZjc4OwogIHQua3ZzcXVhcmUgPSAweDMzYjg7CiAgdC5rd3NxdWFyZSA9IDB4MzNiZTsKICB0LmwgPSAweDAwNmM7CiAgdC5sYWJlbmdhbGkgPSAweDA5YjI7CiAgdC5sYWN1dGUgPSAweDAxM2E7CiAgdC5sYWRldmEgPSAweDA5MzI7CiAgdC5sYWd1amFyYXRpID0gMHgwYWIyOwogIHQubGFndXJtdWtoaSA9IDB4MGEzMjsKICB0Lmxha2toYW5neWFvdGhhaSA9IDB4MGU0NTsKICB0LmxhbWFsZWZmaW5hbGFyYWJpYyA9IDB4ZmVmYzsKICB0LmxhbWFsZWZoYW16YWFib3ZlZmluYWxhcmFiaWMgPSAweGZlZjg7CiAgdC5sYW1hbGVmaGFtemFhYm92ZWlzb2xhdGVkYXJhYmljID0gMHhmZWY3OwogIHQubGFtYWxlZmhhbXphYmVsb3dmaW5hbGFyYWJpYyA9IDB4ZmVmYTsKICB0LmxhbWFsZWZoYW16YWJlbG93aXNvbGF0ZWRhcmFiaWMgPSAweGZlZjk7CiAgdC5sYW1hbGVmaXNvbGF0ZWRhcmFiaWMgPSAweGZlZmI7CiAgdC5sYW1hbGVmbWFkZGFhYm92ZWZpbmFsYXJhYmljID0gMHhmZWY2OwogIHQubGFtYWxlZm1hZGRhYWJvdmVpc29sYXRlZGFyYWJpYyA9IDB4ZmVmNTsKICB0LmxhbWFyYWJpYyA9IDB4MDY0NDsKICB0LmxhbWJkYSA9IDB4MDNiYjsKICB0LmxhbWJkYXN0cm9rZSA9IDB4MDE5YjsKICB0LmxhbWVkID0gMHgwNWRjOwogIHQubGFtZWRkYWdlc2ggPSAweGZiM2M7CiAgdC5sYW1lZGRhZ2VzaGhlYnJldyA9IDB4ZmIzYzsKICB0LmxhbWVkaGVicmV3ID0gMHgwNWRjOwogIHQubGFtZmluYWxhcmFiaWMgPSAweGZlZGU7CiAgdC5sYW1oYWhpbml0aWFsYXJhYmljID0gMHhmY2NhOwogIHQubGFtaW5pdGlhbGFyYWJpYyA9IDB4ZmVkZjsKICB0LmxhbWplZW1pbml0aWFsYXJhYmljID0gMHhmY2M5OwogIHQubGFta2hhaGluaXRpYWxhcmFiaWMgPSAweGZjY2I7CiAgdC5sYW1sYW1oZWhpc29sYXRlZGFyYWJpYyA9IDB4ZmRmMjsKICB0LmxhbW1lZGlhbGFyYWJpYyA9IDB4ZmVlMDsKICB0LmxhbW1lZW1oYWhpbml0aWFsYXJhYmljID0gMHhmZDg4OwogIHQubGFtbWVlbWluaXRpYWxhcmFiaWMgPSAweGZjY2M7CiAgdC5sYXJnZWNpcmNsZSA9IDB4MjVlZjsKICB0LmxiYXIgPSAweDAxOWE7CiAgdC5sYmVsdCA9IDB4MDI2YzsKICB0Lmxib3BvbW9mbyA9IDB4MzEwYzsKICB0LmxjYXJvbiA9IDB4MDEzZTsKICB0LmxjZWRpbGxhID0gMHgwMTNjOwogIHQubGNpcmNsZSA9IDB4MjRkYjsKICB0LmxjaXJjdW1mbGV4YmVsb3cgPSAweDFlM2Q7CiAgdC5sY29tbWFhY2NlbnQgPSAweDAxM2M7CiAgdC5sZG90ID0gMHgwMTQwOwogIHQubGRvdGFjY2VudCA9IDB4MDE0MDsKICB0Lmxkb3RiZWxvdyA9IDB4MWUzNzsKICB0Lmxkb3RiZWxvd21hY3JvbiA9IDB4MWUzOTsKICB0LmxlZnRhbmdsZWFib3ZlY21iID0gMHgwMzFhOwogIHQubGVmdHRhY2tiZWxvd2NtYiA9IDB4MDMxODsKICB0Lmxlc3MgPSAweDAwM2M7CiAgdC5sZXNzZXF1YWwgPSAweDIyNjQ7CiAgdC5sZXNzZXF1YWxvcmdyZWF0ZXIgPSAweDIyZGE7CiAgdC5sZXNzbW9ub3NwYWNlID0gMHhmZjFjOwogIHQubGVzc29yZXF1aXZhbGVudCA9IDB4MjI3MjsKICB0Lmxlc3NvcmdyZWF0ZXIgPSAweDIyNzY7CiAgdC5sZXNzb3ZlcmVxdWFsID0gMHgyMjY2OwogIHQubGVzc3NtYWxsID0gMHhmZTY0OwogIHQubGV6aCA9IDB4MDI2ZTsKICB0LmxmYmxvY2sgPSAweDI1OGM7CiAgdC5saG9va3JldHJvZmxleCA9IDB4MDI2ZDsKICB0LmxpcmEgPSAweDIwYTQ7CiAgdC5saXduYXJtZW5pYW4gPSAweDA1NmM7CiAgdC5saiA9IDB4MDFjOTsKICB0LmxqZWN5cmlsbGljID0gMHgwNDU5OwogIHQubGwgPSAweGY2YzA7CiAgdC5sbGFkZXZhID0gMHgwOTMzOwogIHQubGxhZ3VqYXJhdGkgPSAweDBhYjM7CiAgdC5sbGluZWJlbG93ID0gMHgxZTNiOwogIHQubGxsYWRldmEgPSAweDA5MzQ7CiAgdC5sbHZvY2FsaWNiZW5nYWxpID0gMHgwOWUxOwogIHQubGx2b2NhbGljZGV2YSA9IDB4MDk2MTsKICB0Lmxsdm9jYWxpY3Zvd2Vsc2lnbmJlbmdhbGkgPSAweDA5ZTM7CiAgdC5sbHZvY2FsaWN2b3dlbHNpZ25kZXZhID0gMHgwOTYzOwogIHQubG1pZGRsZXRpbGRlID0gMHgwMjZiOwogIHQubG1vbm9zcGFjZSA9IDB4ZmY0YzsKICB0Lmxtc3F1YXJlID0gMHgzM2QwOwogIHQubG9jaHVsYXRoYWkgPSAweDBlMmM7CiAgdC5sb2dpY2FsYW5kID0gMHgyMjI3OwogIHQubG9naWNhbG5vdCA9IDB4MDBhYzsKICB0LmxvZ2ljYWxub3RyZXZlcnNlZCA9IDB4MjMxMDsKICB0LmxvZ2ljYWxvciA9IDB4MjIyODsKICB0LmxvbGluZ3RoYWkgPSAweDBlMjU7CiAgdC5sb25ncyA9IDB4MDE3ZjsKICB0Lmxvd2xpbmVjZW50ZXJsaW5lID0gMHhmZTRlOwogIHQubG93bGluZWNtYiA9IDB4MDMzMjsKICB0Lmxvd2xpbmVkYXNoZWQgPSAweGZlNGQ7CiAgdC5sb3plbmdlID0gMHgyNWNhOwogIHQubHBhcmVuID0gMHgyNGE3OwogIHQubHNsYXNoID0gMHgwMTQyOwogIHQubHNxdWFyZSA9IDB4MjExMzsKICB0LmxzdXBlcmlvciA9IDB4ZjZlZTsKICB0Lmx0c2hhZGUgPSAweDI1OTE7CiAgdC5sdXRoYWkgPSAweDBlMjY7CiAgdC5sdm9jYWxpY2JlbmdhbGkgPSAweDA5OGM7CiAgdC5sdm9jYWxpY2RldmEgPSAweDA5MGM7CiAgdC5sdm9jYWxpY3Zvd2Vsc2lnbmJlbmdhbGkgPSAweDA5ZTI7CiAgdC5sdm9jYWxpY3Zvd2Vsc2lnbmRldmEgPSAweDA5NjI7CiAgdC5seHNxdWFyZSA9IDB4MzNkMzsKICB0Lm0gPSAweDAwNmQ7CiAgdC5tYWJlbmdhbGkgPSAweDA5YWU7CiAgdC5tYWNyb24gPSAweDAwYWY7CiAgdC5tYWNyb25iZWxvd2NtYiA9IDB4MDMzMTsKICB0Lm1hY3JvbmNtYiA9IDB4MDMwNDsKICB0Lm1hY3Jvbmxvd21vZCA9IDB4MDJjZDsKICB0Lm1hY3Jvbm1vbm9zcGFjZSA9IDB4ZmZlMzsKICB0Lm1hY3V0ZSA9IDB4MWUzZjsKICB0Lm1hZGV2YSA9IDB4MDkyZTsKICB0Lm1hZ3VqYXJhdGkgPSAweDBhYWU7CiAgdC5tYWd1cm11a2hpID0gMHgwYTJlOwogIHQubWFoYXBha2hoZWJyZXcgPSAweDA1YTQ7CiAgdC5tYWhhcGFraGxlZnRoZWJyZXcgPSAweDA1YTQ7CiAgdC5tYWhpcmFnYW5hID0gMHgzMDdlOwogIHQubWFpY2hhdHRhd2Fsb3dsZWZ0dGhhaSA9IDB4Zjg5NTsKICB0Lm1haWNoYXR0YXdhbG93cmlnaHR0aGFpID0gMHhmODk0OwogIHQubWFpY2hhdHRhd2F0aGFpID0gMHgwZTRiOwogIHQubWFpY2hhdHRhd2F1cHBlcmxlZnR0aGFpID0gMHhmODkzOwogIHQubWFpZWtsb3dsZWZ0dGhhaSA9IDB4Zjg4YzsKICB0Lm1haWVrbG93cmlnaHR0aGFpID0gMHhmODhiOwogIHQubWFpZWt0aGFpID0gMHgwZTQ4OwogIHQubWFpZWt1cHBlcmxlZnR0aGFpID0gMHhmODhhOwogIHQubWFpaGFuYWthdGxlZnR0aGFpID0gMHhmODg0OwogIHQubWFpaGFuYWthdHRoYWkgPSAweDBlMzE7CiAgdC5tYWl0YWlraHVsZWZ0dGhhaSA9IDB4Zjg4OTsKICB0Lm1haXRhaWtodXRoYWkgPSAweDBlNDc7CiAgdC5tYWl0aG9sb3dsZWZ0dGhhaSA9IDB4Zjg4ZjsKICB0Lm1haXRob2xvd3JpZ2h0dGhhaSA9IDB4Zjg4ZTsKICB0Lm1haXRob3RoYWkgPSAweDBlNDk7CiAgdC5tYWl0aG91cHBlcmxlZnR0aGFpID0gMHhmODhkOwogIHQubWFpdHJpbG93bGVmdHRoYWkgPSAweGY4OTI7CiAgdC5tYWl0cmlsb3dyaWdodHRoYWkgPSAweGY4OTE7CiAgdC5tYWl0cml0aGFpID0gMHgwZTRhOwogIHQubWFpdHJpdXBwZXJsZWZ0dGhhaSA9IDB4Zjg5MDsKICB0Lm1haXlhbW9rdGhhaSA9IDB4MGU0NjsKICB0Lm1ha2F0YWthbmEgPSAweDMwZGU7CiAgdC5tYWthdGFrYW5haGFsZndpZHRoID0gMHhmZjhmOwogIHQubWFsZSA9IDB4MjY0MjsKICB0Lm1hbnN5b25zcXVhcmUgPSAweDMzNDc7CiAgdC5tYXFhZmhlYnJldyA9IDB4MDViZTsKICB0Lm1hcnMgPSAweDI2NDI7CiAgdC5tYXNvcmFjaXJjbGVoZWJyZXcgPSAweDA1YWY7CiAgdC5tYXNxdWFyZSA9IDB4MzM4MzsKICB0Lm1ib3BvbW9mbyA9IDB4MzEwNzsKICB0Lm1ic3F1YXJlID0gMHgzM2Q0OwogIHQubWNpcmNsZSA9IDB4MjRkYzsKICB0Lm1jdWJlZHNxdWFyZSA9IDB4MzNhNTsKICB0Lm1kb3RhY2NlbnQgPSAweDFlNDE7CiAgdC5tZG90YmVsb3cgPSAweDFlNDM7CiAgdC5tZWVtYXJhYmljID0gMHgwNjQ1OwogIHQubWVlbWZpbmFsYXJhYmljID0gMHhmZWUyOwogIHQubWVlbWluaXRpYWxhcmFiaWMgPSAweGZlZTM7CiAgdC5tZWVtbWVkaWFsYXJhYmljID0gMHhmZWU0OwogIHQubWVlbW1lZW1pbml0aWFsYXJhYmljID0gMHhmY2QxOwogIHQubWVlbW1lZW1pc29sYXRlZGFyYWJpYyA9IDB4ZmM0ODsKICB0Lm1lZXRvcnVzcXVhcmUgPSAweDMzNGQ7CiAgdC5tZWhpcmFnYW5hID0gMHgzMDgxOwogIHQubWVpemllcmFzcXVhcmUgPSAweDMzN2U7CiAgdC5tZWthdGFrYW5hID0gMHgzMGUxOwogIHQubWVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5MjsKICB0Lm1lbSA9IDB4MDVkZTsKICB0Lm1lbWRhZ2VzaCA9IDB4ZmIzZTsKICB0Lm1lbWRhZ2VzaGhlYnJldyA9IDB4ZmIzZTsKICB0Lm1lbWhlYnJldyA9IDB4MDVkZTsKICB0Lm1lbmFybWVuaWFuID0gMHgwNTc0OwogIHQubWVya2hhaGVicmV3ID0gMHgwNWE1OwogIHQubWVya2hha2VmdWxhaGVicmV3ID0gMHgwNWE2OwogIHQubWVya2hha2VmdWxhbGVmdGhlYnJldyA9IDB4MDVhNjsKICB0Lm1lcmtoYWxlZnRoZWJyZXcgPSAweDA1YTU7CiAgdC5taG9vayA9IDB4MDI3MTsKICB0Lm1oenNxdWFyZSA9IDB4MzM5MjsKICB0Lm1pZGRsZWRvdGthdGFrYW5haGFsZndpZHRoID0gMHhmZjY1OwogIHQubWlkZG90ID0gMHgwMGI3OwogIHQubWlldW1hY2lyY2xla29yZWFuID0gMHgzMjcyOwogIHQubWlldW1hcGFyZW5rb3JlYW4gPSAweDMyMTI7CiAgdC5taWV1bWNpcmNsZWtvcmVhbiA9IDB4MzI2NDsKICB0Lm1pZXVta29yZWFuID0gMHgzMTQxOwogIHQubWlldW1wYW5zaW9za29yZWFuID0gMHgzMTcwOwogIHQubWlldW1wYXJlbmtvcmVhbiA9IDB4MzIwNDsKICB0Lm1pZXVtcGlldXBrb3JlYW4gPSAweDMxNmU7CiAgdC5taWV1bXNpb3Nrb3JlYW4gPSAweDMxNmY7CiAgdC5taWhpcmFnYW5hID0gMHgzMDdmOwogIHQubWlrYXRha2FuYSA9IDB4MzBkZjsKICB0Lm1pa2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTA7CiAgdC5taW51cyA9IDB4MjIxMjsKICB0Lm1pbnVzYmVsb3djbWIgPSAweDAzMjA7CiAgdC5taW51c2NpcmNsZSA9IDB4MjI5NjsKICB0Lm1pbnVzbW9kID0gMHgwMmQ3OwogIHQubWludXNwbHVzID0gMHgyMjEzOwogIHQubWludXRlID0gMHgyMDMyOwogIHQubWlyaWJhYXJ1c3F1YXJlID0gMHgzMzRhOwogIHQubWlyaXNxdWFyZSA9IDB4MzM0OTsKICB0Lm1sb25nbGVndHVybmVkID0gMHgwMjcwOwogIHQubWxzcXVhcmUgPSAweDMzOTY7CiAgdC5tbWN1YmVkc3F1YXJlID0gMHgzM2EzOwogIHQubW1vbm9zcGFjZSA9IDB4ZmY0ZDsKICB0Lm1tc3F1YXJlZHNxdWFyZSA9IDB4MzM5ZjsKICB0Lm1vaGlyYWdhbmEgPSAweDMwODI7CiAgdC5tb2htc3F1YXJlID0gMHgzM2MxOwogIHQubW9rYXRha2FuYSA9IDB4MzBlMjsKICB0Lm1va2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTM7CiAgdC5tb2xzcXVhcmUgPSAweDMzZDY7CiAgdC5tb21hdGhhaSA9IDB4MGUyMTsKICB0Lm1vdmVyc3NxdWFyZSA9IDB4MzNhNzsKICB0Lm1vdmVyc3NxdWFyZWRzcXVhcmUgPSAweDMzYTg7CiAgdC5tcGFyZW4gPSAweDI0YTg7CiAgdC5tcGFzcXVhcmUgPSAweDMzYWI7CiAgdC5tc3NxdWFyZSA9IDB4MzNiMzsKICB0Lm1zdXBlcmlvciA9IDB4ZjZlZjsKICB0Lm10dXJuZWQgPSAweDAyNmY7CiAgdC5tdSA9IDB4MDBiNTsKICB0Lm11MSA9IDB4MDBiNTsKICB0Lm11YXNxdWFyZSA9IDB4MzM4MjsKICB0Lm11Y2hncmVhdGVyID0gMHgyMjZiOwogIHQubXVjaGxlc3MgPSAweDIyNmE7CiAgdC5tdWZzcXVhcmUgPSAweDMzOGM7CiAgdC5tdWdyZWVrID0gMHgwM2JjOwogIHQubXVnc3F1YXJlID0gMHgzMzhkOwogIHQubXVoaXJhZ2FuYSA9IDB4MzA4MDsKICB0Lm11a2F0YWthbmEgPSAweDMwZTA7CiAgdC5tdWthdGFrYW5haGFsZndpZHRoID0gMHhmZjkxOwogIHQubXVsc3F1YXJlID0gMHgzMzk1OwogIHQubXVsdGlwbHkgPSAweDAwZDc7CiAgdC5tdW1zcXVhcmUgPSAweDMzOWI7CiAgdC5tdW5haGhlYnJldyA9IDB4MDVhMzsKICB0Lm11bmFobGVmdGhlYnJldyA9IDB4MDVhMzsKICB0Lm11c2ljYWxub3RlID0gMHgyNjZhOwogIHQubXVzaWNhbG5vdGVkYmwgPSAweDI2NmI7CiAgdC5tdXNpY2ZsYXRzaWduID0gMHgyNjZkOwogIHQubXVzaWNzaGFycHNpZ24gPSAweDI2NmY7CiAgdC5tdXNzcXVhcmUgPSAweDMzYjI7CiAgdC5tdXZzcXVhcmUgPSAweDMzYjY7CiAgdC5tdXdzcXVhcmUgPSAweDMzYmM7CiAgdC5tdm1lZ2FzcXVhcmUgPSAweDMzYjk7CiAgdC5tdnNxdWFyZSA9IDB4MzNiNzsKICB0Lm13bWVnYXNxdWFyZSA9IDB4MzNiZjsKICB0Lm13c3F1YXJlID0gMHgzM2JkOwogIHQubiA9IDB4MDA2ZTsKICB0Lm5hYmVuZ2FsaSA9IDB4MDlhODsKICB0Lm5hYmxhID0gMHgyMjA3OwogIHQubmFjdXRlID0gMHgwMTQ0OwogIHQubmFkZXZhID0gMHgwOTI4OwogIHQubmFndWphcmF0aSA9IDB4MGFhODsKICB0Lm5hZ3VybXVraGkgPSAweDBhMjg7CiAgdC5uYWhpcmFnYW5hID0gMHgzMDZhOwogIHQubmFrYXRha2FuYSA9IDB4MzBjYTsKICB0Lm5ha2F0YWthbmFoYWxmd2lkdGggPSAweGZmODU7CiAgdC5uYXBvc3Ryb3BoZSA9IDB4MDE0OTsKICB0Lm5hc3F1YXJlID0gMHgzMzgxOwogIHQubmJvcG9tb2ZvID0gMHgzMTBiOwogIHQubmJzcGFjZSA9IDB4MDBhMDsKICB0Lm5jYXJvbiA9IDB4MDE0ODsKICB0Lm5jZWRpbGxhID0gMHgwMTQ2OwogIHQubmNpcmNsZSA9IDB4MjRkZDsKICB0Lm5jaXJjdW1mbGV4YmVsb3cgPSAweDFlNGI7CiAgdC5uY29tbWFhY2NlbnQgPSAweDAxNDY7CiAgdC5uZG90YWNjZW50ID0gMHgxZTQ1OwogIHQubmRvdGJlbG93ID0gMHgxZTQ3OwogIHQubmVoaXJhZ2FuYSA9IDB4MzA2ZDsKICB0Lm5la2F0YWthbmEgPSAweDMwY2Q7CiAgdC5uZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjg4OwogIHQubmV3c2hlcWVsc2lnbiA9IDB4MjBhYTsKICB0Lm5mc3F1YXJlID0gMHgzMzhiOwogIHQubmdhYmVuZ2FsaSA9IDB4MDk5OTsKICB0Lm5nYWRldmEgPSAweDA5MTk7CiAgdC5uZ2FndWphcmF0aSA9IDB4MGE5OTsKICB0Lm5nYWd1cm11a2hpID0gMHgwYTE5OwogIHQubmdvbmd1dGhhaSA9IDB4MGUwNzsKICB0Lm5oaXJhZ2FuYSA9IDB4MzA5MzsKICB0Lm5ob29rbGVmdCA9IDB4MDI3MjsKICB0Lm5ob29rcmV0cm9mbGV4ID0gMHgwMjczOwogIHQubmlldW5hY2lyY2xla29yZWFuID0gMHgzMjZmOwogIHQubmlldW5hcGFyZW5rb3JlYW4gPSAweDMyMGY7CiAgdC5uaWV1bmNpZXVja29yZWFuID0gMHgzMTM1OwogIHQubmlldW5jaXJjbGVrb3JlYW4gPSAweDMyNjE7CiAgdC5uaWV1bmhpZXVoa29yZWFuID0gMHgzMTM2OwogIHQubmlldW5rb3JlYW4gPSAweDMxMzQ7CiAgdC5uaWV1bnBhbnNpb3Nrb3JlYW4gPSAweDMxNjg7CiAgdC5uaWV1bnBhcmVua29yZWFuID0gMHgzMjAxOwogIHQubmlldW5zaW9za29yZWFuID0gMHgzMTY3OwogIHQubmlldW50aWtldXRrb3JlYW4gPSAweDMxNjY7CiAgdC5uaWhpcmFnYW5hID0gMHgzMDZiOwogIHQubmlrYXRha2FuYSA9IDB4MzBjYjsKICB0Lm5pa2F0YWthbmFoYWxmd2lkdGggPSAweGZmODY7CiAgdC5uaWtoYWhpdGxlZnR0aGFpID0gMHhmODk5OwogIHQubmlraGFoaXR0aGFpID0gMHgwZTRkOwogIHQubmluZSA9IDB4MDAzOTsKICB0Lm5pbmVhcmFiaWMgPSAweDA2Njk7CiAgdC5uaW5lYmVuZ2FsaSA9IDB4MDllZjsKICB0Lm5pbmVjaXJjbGUgPSAweDI0Njg7CiAgdC5uaW5lY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc5MjsKICB0Lm5pbmVkZXZhID0gMHgwOTZmOwogIHQubmluZWd1amFyYXRpID0gMHgwYWVmOwogIHQubmluZWd1cm11a2hpID0gMHgwYTZmOwogIHQubmluZWhhY2thcmFiaWMgPSAweDA2Njk7CiAgdC5uaW5laGFuZ3pob3UgPSAweDMwMjk7CiAgdC5uaW5laWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyODsKICB0Lm5pbmVpbmZlcmlvciA9IDB4MjA4OTsKICB0Lm5pbmVtb25vc3BhY2UgPSAweGZmMTk7CiAgdC5uaW5lb2xkc3R5bGUgPSAweGY3Mzk7CiAgdC5uaW5lcGFyZW4gPSAweDI0N2M7CiAgdC5uaW5lcGVyaW9kID0gMHgyNDkwOwogIHQubmluZXBlcnNpYW4gPSAweDA2Zjk7CiAgdC5uaW5lcm9tYW4gPSAweDIxNzg7CiAgdC5uaW5lc3VwZXJpb3IgPSAweDIwNzk7CiAgdC5uaW5ldGVlbmNpcmNsZSA9IDB4MjQ3MjsKICB0Lm5pbmV0ZWVucGFyZW4gPSAweDI0ODY7CiAgdC5uaW5ldGVlbnBlcmlvZCA9IDB4MjQ5YTsKICB0Lm5pbmV0aGFpID0gMHgwZTU5OwogIHQubmogPSAweDAxY2M7CiAgdC5uamVjeXJpbGxpYyA9IDB4MDQ1YTsKICB0Lm5rYXRha2FuYSA9IDB4MzBmMzsKICB0Lm5rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5ZDsKICB0Lm5sZWdyaWdodGxvbmcgPSAweDAxOWU7CiAgdC5ubGluZWJlbG93ID0gMHgxZTQ5OwogIHQubm1vbm9zcGFjZSA9IDB4ZmY0ZTsKICB0Lm5tc3F1YXJlID0gMHgzMzlhOwogIHQubm5hYmVuZ2FsaSA9IDB4MDlhMzsKICB0Lm5uYWRldmEgPSAweDA5MjM7CiAgdC5ubmFndWphcmF0aSA9IDB4MGFhMzsKICB0Lm5uYWd1cm11a2hpID0gMHgwYTIzOwogIHQubm5uYWRldmEgPSAweDA5Mjk7CiAgdC5ub2hpcmFnYW5hID0gMHgzMDZlOwogIHQubm9rYXRha2FuYSA9IDB4MzBjZTsKICB0Lm5va2F0YWthbmFoYWxmd2lkdGggPSAweGZmODk7CiAgdC5ub25icmVha2luZ3NwYWNlID0gMHgwMGEwOwogIHQubm9uZW50aGFpID0gMHgwZTEzOwogIHQubm9udXRoYWkgPSAweDBlMTk7CiAgdC5ub29uYXJhYmljID0gMHgwNjQ2OwogIHQubm9vbmZpbmFsYXJhYmljID0gMHhmZWU2OwogIHQubm9vbmdodW5uYWFyYWJpYyA9IDB4MDZiYTsKICB0Lm5vb25naHVubmFmaW5hbGFyYWJpYyA9IDB4ZmI5ZjsKICB0Lm5vb25pbml0aWFsYXJhYmljID0gMHhmZWU3OwogIHQubm9vbmplZW1pbml0aWFsYXJhYmljID0gMHhmY2QyOwogIHQubm9vbmplZW1pc29sYXRlZGFyYWJpYyA9IDB4ZmM0YjsKICB0Lm5vb25tZWRpYWxhcmFiaWMgPSAweGZlZTg7CiAgdC5ub29ubWVlbWluaXRpYWxhcmFiaWMgPSAweGZjZDU7CiAgdC5ub29ubWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzRlOwogIHQubm9vbm5vb25maW5hbGFyYWJpYyA9IDB4ZmM4ZDsKICB0Lm5vdGNvbnRhaW5zID0gMHgyMjBjOwogIHQubm90ZWxlbWVudCA9IDB4MjIwOTsKICB0Lm5vdGVsZW1lbnRvZiA9IDB4MjIwOTsKICB0Lm5vdGVxdWFsID0gMHgyMjYwOwogIHQubm90Z3JlYXRlciA9IDB4MjI2ZjsKICB0Lm5vdGdyZWF0ZXJub3JlcXVhbCA9IDB4MjI3MTsKICB0Lm5vdGdyZWF0ZXJub3JsZXNzID0gMHgyMjc5OwogIHQubm90aWRlbnRpY2FsID0gMHgyMjYyOwogIHQubm90bGVzcyA9IDB4MjI2ZTsKICB0Lm5vdGxlc3Nub3JlcXVhbCA9IDB4MjI3MDsKICB0Lm5vdHBhcmFsbGVsID0gMHgyMjI2OwogIHQubm90cHJlY2VkZXMgPSAweDIyODA7CiAgdC5ub3RzdWJzZXQgPSAweDIyODQ7CiAgdC5ub3RzdWNjZWVkcyA9IDB4MjI4MTsKICB0Lm5vdHN1cGVyc2V0ID0gMHgyMjg1OwogIHQubm93YXJtZW5pYW4gPSAweDA1NzY7CiAgdC5ucGFyZW4gPSAweDI0YTk7CiAgdC5uc3NxdWFyZSA9IDB4MzNiMTsKICB0Lm5zdXBlcmlvciA9IDB4MjA3ZjsKICB0Lm50aWxkZSA9IDB4MDBmMTsKICB0Lm51ID0gMHgwM2JkOwogIHQubnVoaXJhZ2FuYSA9IDB4MzA2YzsKICB0Lm51a2F0YWthbmEgPSAweDMwY2M7CiAgdC5udWthdGFrYW5haGFsZndpZHRoID0gMHhmZjg3OwogIHQubnVrdGFiZW5nYWxpID0gMHgwOWJjOwogIHQubnVrdGFkZXZhID0gMHgwOTNjOwogIHQubnVrdGFndWphcmF0aSA9IDB4MGFiYzsKICB0Lm51a3RhZ3VybXVraGkgPSAweDBhM2M7CiAgdC5udW1iZXJzaWduID0gMHgwMDIzOwogIHQubnVtYmVyc2lnbm1vbm9zcGFjZSA9IDB4ZmYwMzsKICB0Lm51bWJlcnNpZ25zbWFsbCA9IDB4ZmU1ZjsKICB0Lm51bWVyYWxzaWduZ3JlZWsgPSAweDAzNzQ7CiAgdC5udW1lcmFsc2lnbmxvd2VyZ3JlZWsgPSAweDAzNzU7CiAgdC5udW1lcm8gPSAweDIxMTY7CiAgdC5udW4gPSAweDA1ZTA7CiAgdC5udW5kYWdlc2ggPSAweGZiNDA7CiAgdC5udW5kYWdlc2hoZWJyZXcgPSAweGZiNDA7CiAgdC5udW5oZWJyZXcgPSAweDA1ZTA7CiAgdC5udnNxdWFyZSA9IDB4MzNiNTsKICB0Lm53c3F1YXJlID0gMHgzM2JiOwogIHQubnlhYmVuZ2FsaSA9IDB4MDk5ZTsKICB0Lm55YWRldmEgPSAweDA5MWU7CiAgdC5ueWFndWphcmF0aSA9IDB4MGE5ZTsKICB0Lm55YWd1cm11a2hpID0gMHgwYTFlOwogIHQubyA9IDB4MDA2ZjsKICB0Lm9hY3V0ZSA9IDB4MDBmMzsKICB0Lm9hbmd0aGFpID0gMHgwZTJkOwogIHQub2JhcnJlZCA9IDB4MDI3NTsKICB0Lm9iYXJyZWRjeXJpbGxpYyA9IDB4MDRlOTsKICB0Lm9iYXJyZWRkaWVyZXNpc2N5cmlsbGljID0gMHgwNGViOwogIHQub2JlbmdhbGkgPSAweDA5OTM7CiAgdC5vYm9wb21vZm8gPSAweDMxMWI7CiAgdC5vYnJldmUgPSAweDAxNGY7CiAgdC5vY2FuZHJhZGV2YSA9IDB4MDkxMTsKICB0Lm9jYW5kcmFndWphcmF0aSA9IDB4MGE5MTsKICB0Lm9jYW5kcmF2b3dlbHNpZ25kZXZhID0gMHgwOTQ5OwogIHQub2NhbmRyYXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWM5OwogIHQub2Nhcm9uID0gMHgwMWQyOwogIHQub2NpcmNsZSA9IDB4MjRkZTsKICB0Lm9jaXJjdW1mbGV4ID0gMHgwMGY0OwogIHQub2NpcmN1bWZsZXhhY3V0ZSA9IDB4MWVkMTsKICB0Lm9jaXJjdW1mbGV4ZG90YmVsb3cgPSAweDFlZDk7CiAgdC5vY2lyY3VtZmxleGdyYXZlID0gMHgxZWQzOwogIHQub2NpcmN1bWZsZXhob29rYWJvdmUgPSAweDFlZDU7CiAgdC5vY2lyY3VtZmxleHRpbGRlID0gMHgxZWQ3OwogIHQub2N5cmlsbGljID0gMHgwNDNlOwogIHQub2RibGFjdXRlID0gMHgwMTUxOwogIHQub2RibGdyYXZlID0gMHgwMjBkOwogIHQub2RldmEgPSAweDA5MTM7CiAgdC5vZGllcmVzaXMgPSAweDAwZjY7CiAgdC5vZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRlNzsKICB0Lm9kb3RiZWxvdyA9IDB4MWVjZDsKICB0Lm9lID0gMHgwMTUzOwogIHQub2Vrb3JlYW4gPSAweDMxNWE7CiAgdC5vZ29uZWsgPSAweDAyZGI7CiAgdC5vZ29uZWtjbWIgPSAweDAzMjg7CiAgdC5vZ3JhdmUgPSAweDAwZjI7CiAgdC5vZ3VqYXJhdGkgPSAweDBhOTM7CiAgdC5vaGFybWVuaWFuID0gMHgwNTg1OwogIHQub2hpcmFnYW5hID0gMHgzMDRhOwogIHQub2hvb2thYm92ZSA9IDB4MWVjZjsKICB0Lm9ob3JuID0gMHgwMWExOwogIHQub2hvcm5hY3V0ZSA9IDB4MWVkYjsKICB0Lm9ob3JuZG90YmVsb3cgPSAweDFlZTM7CiAgdC5vaG9ybmdyYXZlID0gMHgxZWRkOwogIHQub2hvcm5ob29rYWJvdmUgPSAweDFlZGY7CiAgdC5vaG9ybnRpbGRlID0gMHgxZWUxOwogIHQub2h1bmdhcnVtbGF1dCA9IDB4MDE1MTsKICB0Lm9pID0gMHgwMWEzOwogIHQub2ludmVydGVkYnJldmUgPSAweDAyMGY7CiAgdC5va2F0YWthbmEgPSAweDMwYWE7CiAgdC5va2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzU7CiAgdC5va29yZWFuID0gMHgzMTU3OwogIHQub2xlaGVicmV3ID0gMHgwNWFiOwogIHQub21hY3JvbiA9IDB4MDE0ZDsKICB0Lm9tYWNyb25hY3V0ZSA9IDB4MWU1MzsKICB0Lm9tYWNyb25ncmF2ZSA9IDB4MWU1MTsKICB0Lm9tZGV2YSA9IDB4MDk1MDsKICB0Lm9tZWdhID0gMHgwM2M5OwogIHQub21lZ2ExID0gMHgwM2Q2OwogIHQub21lZ2FjeXJpbGxpYyA9IDB4MDQ2MTsKICB0Lm9tZWdhbGF0aW5jbG9zZWQgPSAweDAyNzc7CiAgdC5vbWVnYXJvdW5kY3lyaWxsaWMgPSAweDA0N2I7CiAgdC5vbWVnYXRpdGxvY3lyaWxsaWMgPSAweDA0N2Q7CiAgdC5vbWVnYXRvbm9zID0gMHgwM2NlOwogIHQub21ndWphcmF0aSA9IDB4MGFkMDsKICB0Lm9taWNyb24gPSAweDAzYmY7CiAgdC5vbWljcm9udG9ub3MgPSAweDAzY2M7CiAgdC5vbW9ub3NwYWNlID0gMHhmZjRmOwogIHQub25lID0gMHgwMDMxOwogIHQub25lYXJhYmljID0gMHgwNjYxOwogIHQub25lYmVuZ2FsaSA9IDB4MDllNzsKICB0Lm9uZWNpcmNsZSA9IDB4MjQ2MDsKICB0Lm9uZWNpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OGE7CiAgdC5vbmVkZXZhID0gMHgwOTY3OwogIHQub25lZG90ZW5sZWFkZXIgPSAweDIwMjQ7CiAgdC5vbmVlaWdodGggPSAweDIxNWI7CiAgdC5vbmVmaXR0ZWQgPSAweGY2ZGM7CiAgdC5vbmVndWphcmF0aSA9IDB4MGFlNzsKICB0Lm9uZWd1cm11a2hpID0gMHgwYTY3OwogIHQub25laGFja2FyYWJpYyA9IDB4MDY2MTsKICB0Lm9uZWhhbGYgPSAweDAwYmQ7CiAgdC5vbmVoYW5nemhvdSA9IDB4MzAyMTsKICB0Lm9uZWlkZW9ncmFwaGljcGFyZW4gPSAweDMyMjA7CiAgdC5vbmVpbmZlcmlvciA9IDB4MjA4MTsKICB0Lm9uZW1vbm9zcGFjZSA9IDB4ZmYxMTsKICB0Lm9uZW51bWVyYXRvcmJlbmdhbGkgPSAweDA5ZjQ7CiAgdC5vbmVvbGRzdHlsZSA9IDB4ZjczMTsKICB0Lm9uZXBhcmVuID0gMHgyNDc0OwogIHQub25lcGVyaW9kID0gMHgyNDg4OwogIHQub25lcGVyc2lhbiA9IDB4MDZmMTsKICB0Lm9uZXF1YXJ0ZXIgPSAweDAwYmM7CiAgdC5vbmVyb21hbiA9IDB4MjE3MDsKICB0Lm9uZXN1cGVyaW9yID0gMHgwMGI5OwogIHQub25ldGhhaSA9IDB4MGU1MTsKICB0Lm9uZXRoaXJkID0gMHgyMTUzOwogIHQub29nb25layA9IDB4MDFlYjsKICB0Lm9vZ29uZWttYWNyb24gPSAweDAxZWQ7CiAgdC5vb2d1cm11a2hpID0gMHgwYTEzOwogIHQub29tYXRyYWd1cm11a2hpID0gMHgwYTRiOwogIHQub29wZW4gPSAweDAyNTQ7CiAgdC5vcGFyZW4gPSAweDI0YWE7CiAgdC5vcGVuYnVsbGV0ID0gMHgyNWU2OwogIHQub3B0aW9uID0gMHgyMzI1OwogIHQub3JkZmVtaW5pbmUgPSAweDAwYWE7CiAgdC5vcmRtYXNjdWxpbmUgPSAweDAwYmE7CiAgdC5vcnRob2dvbmFsID0gMHgyMjFmOwogIHQub3Nob3J0ZGV2YSA9IDB4MDkxMjsKICB0Lm9zaG9ydHZvd2Vsc2lnbmRldmEgPSAweDA5NGE7CiAgdC5vc2xhc2ggPSAweDAwZjg7CiAgdC5vc2xhc2hhY3V0ZSA9IDB4MDFmZjsKICB0Lm9zbWFsbGhpcmFnYW5hID0gMHgzMDQ5OwogIHQub3NtYWxsa2F0YWthbmEgPSAweDMwYTk7CiAgdC5vc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YjsKICB0Lm9zdHJva2VhY3V0ZSA9IDB4MDFmZjsKICB0Lm9zdXBlcmlvciA9IDB4ZjZmMDsKICB0Lm90Y3lyaWxsaWMgPSAweDA0N2Y7CiAgdC5vdGlsZGUgPSAweDAwZjU7CiAgdC5vdGlsZGVhY3V0ZSA9IDB4MWU0ZDsKICB0Lm90aWxkZWRpZXJlc2lzID0gMHgxZTRmOwogIHQub3Vib3BvbW9mbyA9IDB4MzEyMTsKICB0Lm92ZXJsaW5lID0gMHgyMDNlOwogIHQub3ZlcmxpbmVjZW50ZXJsaW5lID0gMHhmZTRhOwogIHQub3ZlcmxpbmVjbWIgPSAweDAzMDU7CiAgdC5vdmVybGluZWRhc2hlZCA9IDB4ZmU0OTsKICB0Lm92ZXJsaW5lZGJsd2F2eSA9IDB4ZmU0YzsKICB0Lm92ZXJsaW5ld2F2eSA9IDB4ZmU0YjsKICB0Lm92ZXJzY29yZSA9IDB4MDBhZjsKICB0Lm92b3dlbHNpZ25iZW5nYWxpID0gMHgwOWNiOwogIHQub3Zvd2Vsc2lnbmRldmEgPSAweDA5NGI7CiAgdC5vdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhY2I7CiAgdC5wID0gMHgwMDcwOwogIHQucGFhbXBzc3F1YXJlID0gMHgzMzgwOwogIHQucGFhc2VudG9zcXVhcmUgPSAweDMzMmI7CiAgdC5wYWJlbmdhbGkgPSAweDA5YWE7CiAgdC5wYWN1dGUgPSAweDFlNTU7CiAgdC5wYWRldmEgPSAweDA5MmE7CiAgdC5wYWdlZG93biA9IDB4MjFkZjsKICB0LnBhZ2V1cCA9IDB4MjFkZTsKICB0LnBhZ3VqYXJhdGkgPSAweDBhYWE7CiAgdC5wYWd1cm11a2hpID0gMHgwYTJhOwogIHQucGFoaXJhZ2FuYSA9IDB4MzA3MTsKICB0LnBhaXlhbm5vaXRoYWkgPSAweDBlMmY7CiAgdC5wYWthdGFrYW5hID0gMHgzMGQxOwogIHQucGFsYXRhbGl6YXRpb25jeXJpbGxpY2NtYiA9IDB4MDQ4NDsKICB0LnBhbG9jaGthY3lyaWxsaWMgPSAweDA0YzA7CiAgdC5wYW5zaW9za29yZWFuID0gMHgzMTdmOwogIHQucGFyYWdyYXBoID0gMHgwMGI2OwogIHQucGFyYWxsZWwgPSAweDIyMjU7CiAgdC5wYXJlbmxlZnQgPSAweDAwMjg7CiAgdC5wYXJlbmxlZnRhbHRvbmVhcmFiaWMgPSAweGZkM2U7CiAgdC5wYXJlbmxlZnRidCA9IDB4ZjhlZDsKICB0LnBhcmVubGVmdGV4ID0gMHhmOGVjOwogIHQucGFyZW5sZWZ0aW5mZXJpb3IgPSAweDIwOGQ7CiAgdC5wYXJlbmxlZnRtb25vc3BhY2UgPSAweGZmMDg7CiAgdC5wYXJlbmxlZnRzbWFsbCA9IDB4ZmU1OTsKICB0LnBhcmVubGVmdHN1cGVyaW9yID0gMHgyMDdkOwogIHQucGFyZW5sZWZ0dHAgPSAweGY4ZWI7CiAgdC5wYXJlbmxlZnR2ZXJ0aWNhbCA9IDB4ZmUzNTsKICB0LnBhcmVucmlnaHQgPSAweDAwMjk7CiAgdC5wYXJlbnJpZ2h0YWx0b25lYXJhYmljID0gMHhmZDNmOwogIHQucGFyZW5yaWdodGJ0ID0gMHhmOGY4OwogIHQucGFyZW5yaWdodGV4ID0gMHhmOGY3OwogIHQucGFyZW5yaWdodGluZmVyaW9yID0gMHgyMDhlOwogIHQucGFyZW5yaWdodG1vbm9zcGFjZSA9IDB4ZmYwOTsKICB0LnBhcmVucmlnaHRzbWFsbCA9IDB4ZmU1YTsKICB0LnBhcmVucmlnaHRzdXBlcmlvciA9IDB4MjA3ZTsKICB0LnBhcmVucmlnaHR0cCA9IDB4ZjhmNjsKICB0LnBhcmVucmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzNjsKICB0LnBhcnRpYWxkaWZmID0gMHgyMjAyOwogIHQucGFzZXFoZWJyZXcgPSAweDA1YzA7CiAgdC5wYXNodGFoZWJyZXcgPSAweDA1OTk7CiAgdC5wYXNxdWFyZSA9IDB4MzNhOTsKICB0LnBhdGFoID0gMHgwNWI3OwogIHQucGF0YWgxMSA9IDB4MDViNzsKICB0LnBhdGFoMWQgPSAweDA1Yjc7CiAgdC5wYXRhaDJhID0gMHgwNWI3OwogIHQucGF0YWhoZWJyZXcgPSAweDA1Yjc7CiAgdC5wYXRhaG5hcnJvd2hlYnJldyA9IDB4MDViNzsKICB0LnBhdGFocXVhcnRlcmhlYnJldyA9IDB4MDViNzsKICB0LnBhdGFod2lkZWhlYnJldyA9IDB4MDViNzsKICB0LnBhemVyaGVicmV3ID0gMHgwNWExOwogIHQucGJvcG9tb2ZvID0gMHgzMTA2OwogIHQucGNpcmNsZSA9IDB4MjRkZjsKICB0LnBkb3RhY2NlbnQgPSAweDFlNTc7CiAgdC5wZSA9IDB4MDVlNDsKICB0LnBlY3lyaWxsaWMgPSAweDA0M2Y7CiAgdC5wZWRhZ2VzaCA9IDB4ZmI0NDsKICB0LnBlZGFnZXNoaGVicmV3ID0gMHhmYjQ0OwogIHQucGVlemlzcXVhcmUgPSAweDMzM2I7CiAgdC5wZWZpbmFsZGFnZXNoaGVicmV3ID0gMHhmYjQzOwogIHQucGVoYXJhYmljID0gMHgwNjdlOwogIHQucGVoYXJtZW5pYW4gPSAweDA1N2E7CiAgdC5wZWhlYnJldyA9IDB4MDVlNDsKICB0LnBlaGZpbmFsYXJhYmljID0gMHhmYjU3OwogIHQucGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmI1ODsKICB0LnBlaGlyYWdhbmEgPSAweDMwN2E7CiAgdC5wZWhtZWRpYWxhcmFiaWMgPSAweGZiNTk7CiAgdC5wZWthdGFrYW5hID0gMHgzMGRhOwogIHQucGVtaWRkbGVob29rY3lyaWxsaWMgPSAweDA0YTc7CiAgdC5wZXJhZmVoZWJyZXcgPSAweGZiNGU7CiAgdC5wZXJjZW50ID0gMHgwMDI1OwogIHQucGVyY2VudGFyYWJpYyA9IDB4MDY2YTsKICB0LnBlcmNlbnRtb25vc3BhY2UgPSAweGZmMDU7CiAgdC5wZXJjZW50c21hbGwgPSAweGZlNmE7CiAgdC5wZXJpb2QgPSAweDAwMmU7CiAgdC5wZXJpb2Rhcm1lbmlhbiA9IDB4MDU4OTsKICB0LnBlcmlvZGNlbnRlcmVkID0gMHgwMGI3OwogIHQucGVyaW9kaGFsZndpZHRoID0gMHhmZjYxOwogIHQucGVyaW9kaW5mZXJpb3IgPSAweGY2ZTc7CiAgdC5wZXJpb2Rtb25vc3BhY2UgPSAweGZmMGU7CiAgdC5wZXJpb2RzbWFsbCA9IDB4ZmU1MjsKICB0LnBlcmlvZHN1cGVyaW9yID0gMHhmNmU4OwogIHQucGVyaXNwb21lbmlncmVla2NtYiA9IDB4MDM0MjsKICB0LnBlcnBlbmRpY3VsYXIgPSAweDIyYTU7CiAgdC5wZXJ0aG91c2FuZCA9IDB4MjAzMDsKICB0LnBlc2V0YSA9IDB4MjBhNzsKICB0LnBmc3F1YXJlID0gMHgzMzhhOwogIHQucGhhYmVuZ2FsaSA9IDB4MDlhYjsKICB0LnBoYWRldmEgPSAweDA5MmI7CiAgdC5waGFndWphcmF0aSA9IDB4MGFhYjsKICB0LnBoYWd1cm11a2hpID0gMHgwYTJiOwogIHQucGhpID0gMHgwM2M2OwogIHQucGhpMSA9IDB4MDNkNTsKICB0LnBoaWV1cGhhY2lyY2xla29yZWFuID0gMHgzMjdhOwogIHQucGhpZXVwaGFwYXJlbmtvcmVhbiA9IDB4MzIxYTsKICB0LnBoaWV1cGhjaXJjbGVrb3JlYW4gPSAweDMyNmM7CiAgdC5waGlldXBoa29yZWFuID0gMHgzMTRkOwogIHQucGhpZXVwaHBhcmVua29yZWFuID0gMHgzMjBjOwogIHQucGhpbGF0aW4gPSAweDAyNzg7CiAgdC5waGludGh1dGhhaSA9IDB4MGUzYTsKICB0LnBoaXN5bWJvbGdyZWVrID0gMHgwM2Q1OwogIHQucGhvb2sgPSAweDAxYTU7CiAgdC5waG9waGFudGhhaSA9IDB4MGUxZTsKICB0LnBob3BodW5ndGhhaSA9IDB4MGUxYzsKICB0LnBob3NhbXBoYW90aGFpID0gMHgwZTIwOwogIHQucGkgPSAweDAzYzA7CiAgdC5waWV1cGFjaXJjbGVrb3JlYW4gPSAweDMyNzM7CiAgdC5waWV1cGFwYXJlbmtvcmVhbiA9IDB4MzIxMzsKICB0LnBpZXVwY2lldWNrb3JlYW4gPSAweDMxNzY7CiAgdC5waWV1cGNpcmNsZWtvcmVhbiA9IDB4MzI2NTsKICB0LnBpZXVwa2l5ZW9ra29yZWFuID0gMHgzMTcyOwogIHQucGlldXBrb3JlYW4gPSAweDMxNDI7CiAgdC5waWV1cHBhcmVua29yZWFuID0gMHgzMjA1OwogIHQucGlldXBzaW9za2l5ZW9ra29yZWFuID0gMHgzMTc0OwogIHQucGlldXBzaW9za29yZWFuID0gMHgzMTQ0OwogIHQucGlldXBzaW9zdGlrZXV0a29yZWFuID0gMHgzMTc1OwogIHQucGlldXB0aGlldXRoa29yZWFuID0gMHgzMTc3OwogIHQucGlldXB0aWtldXRrb3JlYW4gPSAweDMxNzM7CiAgdC5waWhpcmFnYW5hID0gMHgzMDc0OwogIHQucGlrYXRha2FuYSA9IDB4MzBkNDsKICB0LnBpc3ltYm9sZ3JlZWsgPSAweDAzZDY7CiAgdC5waXdyYXJtZW5pYW4gPSAweDA1ODM7CiAgdC5wbGFuY2tvdmVyMnBpID0gMHgyMTBmOwogIHQucGxhbmNrb3ZlcjJwaTEgPSAweDIxMGY7CiAgdC5wbHVzID0gMHgwMDJiOwogIHQucGx1c2JlbG93Y21iID0gMHgwMzFmOwogIHQucGx1c2NpcmNsZSA9IDB4MjI5NTsKICB0LnBsdXNtaW51cyA9IDB4MDBiMTsKICB0LnBsdXNtb2QgPSAweDAyZDY7CiAgdC5wbHVzbW9ub3NwYWNlID0gMHhmZjBiOwogIHQucGx1c3NtYWxsID0gMHhmZTYyOwogIHQucGx1c3N1cGVyaW9yID0gMHgyMDdhOwogIHQucG1vbm9zcGFjZSA9IDB4ZmY1MDsKICB0LnBtc3F1YXJlID0gMHgzM2Q4OwogIHQucG9oaXJhZ2FuYSA9IDB4MzA3ZDsKICB0LnBvaW50aW5naW5kZXhkb3dud2hpdGUgPSAweDI2MWY7CiAgdC5wb2ludGluZ2luZGV4bGVmdHdoaXRlID0gMHgyNjFjOwogIHQucG9pbnRpbmdpbmRleHJpZ2h0d2hpdGUgPSAweDI2MWU7CiAgdC5wb2ludGluZ2luZGV4dXB3aGl0ZSA9IDB4MjYxZDsKICB0LnBva2F0YWthbmEgPSAweDMwZGQ7CiAgdC5wb3BsYXRoYWkgPSAweDBlMWI7CiAgdC5wb3N0YWxtYXJrID0gMHgzMDEyOwogIHQucG9zdGFsbWFya2ZhY2UgPSAweDMwMjA7CiAgdC5wcGFyZW4gPSAweDI0YWI7CiAgdC5wcmVjZWRlcyA9IDB4MjI3YTsKICB0LnByZXNjcmlwdGlvbiA9IDB4MjExZTsKICB0LnByaW1lbW9kID0gMHgwMmI5OwogIHQucHJpbWVyZXZlcnNlZCA9IDB4MjAzNTsKICB0LnByb2R1Y3QgPSAweDIyMGY7CiAgdC5wcm9qZWN0aXZlID0gMHgyMzA1OwogIHQucHJvbG9uZ2Vka2FuYSA9IDB4MzBmYzsKICB0LnByb3BlbGxvciA9IDB4MjMxODsKICB0LnByb3BlcnN1YnNldCA9IDB4MjI4MjsKICB0LnByb3BlcnN1cGVyc2V0ID0gMHgyMjgzOwogIHQucHJvcG9ydGlvbiA9IDB4MjIzNzsKICB0LnByb3BvcnRpb25hbCA9IDB4MjIxZDsKICB0LnBzaSA9IDB4MDNjODsKICB0LnBzaWN5cmlsbGljID0gMHgwNDcxOwogIHQucHNpbGlwbmV1bWF0YWN5cmlsbGljY21iID0gMHgwNDg2OwogIHQucHNzcXVhcmUgPSAweDMzYjA7CiAgdC5wdWhpcmFnYW5hID0gMHgzMDc3OwogIHQucHVrYXRha2FuYSA9IDB4MzBkNzsKICB0LnB2c3F1YXJlID0gMHgzM2I0OwogIHQucHdzcXVhcmUgPSAweDMzYmE7CiAgdC5xID0gMHgwMDcxOwogIHQucWFkZXZhID0gMHgwOTU4OwogIHQucWFkbWFoZWJyZXcgPSAweDA1YTg7CiAgdC5xYWZhcmFiaWMgPSAweDA2NDI7CiAgdC5xYWZmaW5hbGFyYWJpYyA9IDB4ZmVkNjsKICB0LnFhZmluaXRpYWxhcmFiaWMgPSAweGZlZDc7CiAgdC5xYWZtZWRpYWxhcmFiaWMgPSAweGZlZDg7CiAgdC5xYW1hdHMgPSAweDA1Yjg7CiAgdC5xYW1hdHMxMCA9IDB4MDViODsKICB0LnFhbWF0czFhID0gMHgwNWI4OwogIHQucWFtYXRzMWMgPSAweDA1Yjg7CiAgdC5xYW1hdHMyNyA9IDB4MDViODsKICB0LnFhbWF0czI5ID0gMHgwNWI4OwogIHQucWFtYXRzMzMgPSAweDA1Yjg7CiAgdC5xYW1hdHNkZSA9IDB4MDViODsKICB0LnFhbWF0c2hlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c25hcnJvd2hlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c3FhdGFuaGVicmV3ID0gMHgwNWI4OwogIHQucWFtYXRzcWF0YW5uYXJyb3doZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxYXRhbnF1YXJ0ZXJoZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxYXRhbndpZGVoZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxdWFydGVyaGVicmV3ID0gMHgwNWI4OwogIHQucWFtYXRzd2lkZWhlYnJldyA9IDB4MDViODsKICB0LnFhcm5leXBhcmFoZWJyZXcgPSAweDA1OWY7CiAgdC5xYm9wb21vZm8gPSAweDMxMTE7CiAgdC5xY2lyY2xlID0gMHgyNGUwOwogIHQucWhvb2sgPSAweDAyYTA7CiAgdC5xbW9ub3NwYWNlID0gMHhmZjUxOwogIHQucW9mID0gMHgwNWU3OwogIHQucW9mZGFnZXNoID0gMHhmYjQ3OwogIHQucW9mZGFnZXNoaGVicmV3ID0gMHhmYjQ3OwogIHQucW9maGVicmV3ID0gMHgwNWU3OwogIHQucXBhcmVuID0gMHgyNGFjOwogIHQucXVhcnRlcm5vdGUgPSAweDI2Njk7CiAgdC5xdWJ1dHMgPSAweDA1YmI7CiAgdC5xdWJ1dHMxOCA9IDB4MDViYjsKICB0LnF1YnV0czI1ID0gMHgwNWJiOwogIHQucXVidXRzMzEgPSAweDA1YmI7CiAgdC5xdWJ1dHNoZWJyZXcgPSAweDA1YmI7CiAgdC5xdWJ1dHNuYXJyb3doZWJyZXcgPSAweDA1YmI7CiAgdC5xdWJ1dHNxdWFydGVyaGVicmV3ID0gMHgwNWJiOwogIHQucXVidXRzd2lkZWhlYnJldyA9IDB4MDViYjsKICB0LnF1ZXN0aW9uID0gMHgwMDNmOwogIHQucXVlc3Rpb25hcmFiaWMgPSAweDA2MWY7CiAgdC5xdWVzdGlvbmFybWVuaWFuID0gMHgwNTVlOwogIHQucXVlc3Rpb25kb3duID0gMHgwMGJmOwogIHQucXVlc3Rpb25kb3duc21hbGwgPSAweGY3YmY7CiAgdC5xdWVzdGlvbmdyZWVrID0gMHgwMzdlOwogIHQucXVlc3Rpb25tb25vc3BhY2UgPSAweGZmMWY7CiAgdC5xdWVzdGlvbnNtYWxsID0gMHhmNzNmOwogIHQucXVvdGVkYmwgPSAweDAwMjI7CiAgdC5xdW90ZWRibGJhc2UgPSAweDIwMWU7CiAgdC5xdW90ZWRibGxlZnQgPSAweDIwMWM7CiAgdC5xdW90ZWRibG1vbm9zcGFjZSA9IDB4ZmYwMjsKICB0LnF1b3RlZGJscHJpbWUgPSAweDMwMWU7CiAgdC5xdW90ZWRibHByaW1lcmV2ZXJzZWQgPSAweDMwMWQ7CiAgdC5xdW90ZWRibHJpZ2h0ID0gMHgyMDFkOwogIHQucXVvdGVsZWZ0ID0gMHgyMDE4OwogIHQucXVvdGVsZWZ0cmV2ZXJzZWQgPSAweDIwMWI7CiAgdC5xdW90ZXJldmVyc2VkID0gMHgyMDFiOwogIHQucXVvdGVyaWdodCA9IDB4MjAxOTsKICB0LnF1b3RlcmlnaHRuID0gMHgwMTQ5OwogIHQucXVvdGVzaW5nbGJhc2UgPSAweDIwMWE7CiAgdC5xdW90ZXNpbmdsZSA9IDB4MDAyNzsKICB0LnF1b3Rlc2luZ2xlbW9ub3NwYWNlID0gMHhmZjA3OwogIHQuciA9IDB4MDA3MjsKICB0LnJhYXJtZW5pYW4gPSAweDA1N2M7CiAgdC5yYWJlbmdhbGkgPSAweDA5YjA7CiAgdC5yYWN1dGUgPSAweDAxNTU7CiAgdC5yYWRldmEgPSAweDA5MzA7CiAgdC5yYWRpY2FsID0gMHgyMjFhOwogIHQucmFkaWNhbGV4ID0gMHhmOGU1OwogIHQucmFkb3ZlcnNzcXVhcmUgPSAweDMzYWU7CiAgdC5yYWRvdmVyc3NxdWFyZWRzcXVhcmUgPSAweDMzYWY7CiAgdC5yYWRzcXVhcmUgPSAweDMzYWQ7CiAgdC5yYWZlID0gMHgwNWJmOwogIHQucmFmZWhlYnJldyA9IDB4MDViZjsKICB0LnJhZ3VqYXJhdGkgPSAweDBhYjA7CiAgdC5yYWd1cm11a2hpID0gMHgwYTMwOwogIHQucmFoaXJhZ2FuYSA9IDB4MzA4OTsKICB0LnJha2F0YWthbmEgPSAweDMwZTk7CiAgdC5yYWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk3OwogIHQucmFsb3dlcmRpYWdvbmFsYmVuZ2FsaSA9IDB4MDlmMTsKICB0LnJhbWlkZGxlZGlhZ29uYWxiZW5nYWxpID0gMHgwOWYwOwogIHQucmFtc2hvcm4gPSAweDAyNjQ7CiAgdC5yYXRpbyA9IDB4MjIzNjsKICB0LnJib3BvbW9mbyA9IDB4MzExNjsKICB0LnJjYXJvbiA9IDB4MDE1OTsKICB0LnJjZWRpbGxhID0gMHgwMTU3OwogIHQucmNpcmNsZSA9IDB4MjRlMTsKICB0LnJjb21tYWFjY2VudCA9IDB4MDE1NzsKICB0LnJkYmxncmF2ZSA9IDB4MDIxMTsKICB0LnJkb3RhY2NlbnQgPSAweDFlNTk7CiAgdC5yZG90YmVsb3cgPSAweDFlNWI7CiAgdC5yZG90YmVsb3dtYWNyb24gPSAweDFlNWQ7CiAgdC5yZWZlcmVuY2VtYXJrID0gMHgyMDNiOwogIHQucmVmbGV4c3Vic2V0ID0gMHgyMjg2OwogIHQucmVmbGV4c3VwZXJzZXQgPSAweDIyODc7CiAgdC5yZWdpc3RlcmVkID0gMHgwMGFlOwogIHQucmVnaXN0ZXJzYW5zID0gMHhmOGU4OwogIHQucmVnaXN0ZXJzZXJpZiA9IDB4ZjZkYTsKICB0LnJlaGFyYWJpYyA9IDB4MDYzMTsKICB0LnJlaGFybWVuaWFuID0gMHgwNTgwOwogIHQucmVoZmluYWxhcmFiaWMgPSAweGZlYWU7CiAgdC5yZWhpcmFnYW5hID0gMHgzMDhjOwogIHQucmVrYXRha2FuYSA9IDB4MzBlYzsKICB0LnJla2F0YWthbmFoYWxmd2lkdGggPSAweGZmOWE7CiAgdC5yZXNoID0gMHgwNWU4OwogIHQucmVzaGRhZ2VzaGhlYnJldyA9IDB4ZmI0ODsKICB0LnJlc2hoZWJyZXcgPSAweDA1ZTg7CiAgdC5yZXZlcnNlZHRpbGRlID0gMHgyMjNkOwogIHQucmV2aWFoZWJyZXcgPSAweDA1OTc7CiAgdC5yZXZpYW11Z3Jhc2hoZWJyZXcgPSAweDA1OTc7CiAgdC5yZXZsb2dpY2Fsbm90ID0gMHgyMzEwOwogIHQucmZpc2hob29rID0gMHgwMjdlOwogIHQucmZpc2hob29rcmV2ZXJzZWQgPSAweDAyN2Y7CiAgdC5yaGFiZW5nYWxpID0gMHgwOWRkOwogIHQucmhhZGV2YSA9IDB4MDk1ZDsKICB0LnJobyA9IDB4MDNjMTsKICB0LnJob29rID0gMHgwMjdkOwogIHQucmhvb2t0dXJuZWQgPSAweDAyN2I7CiAgdC5yaG9va3R1cm5lZHN1cGVyaW9yID0gMHgwMmI1OwogIHQucmhvc3ltYm9sZ3JlZWsgPSAweDAzZjE7CiAgdC5yaG90aWNob29rbW9kID0gMHgwMmRlOwogIHQucmlldWxhY2lyY2xla29yZWFuID0gMHgzMjcxOwogIHQucmlldWxhcGFyZW5rb3JlYW4gPSAweDMyMTE7CiAgdC5yaWV1bGNpcmNsZWtvcmVhbiA9IDB4MzI2MzsKICB0LnJpZXVsaGlldWhrb3JlYW4gPSAweDMxNDA7CiAgdC5yaWV1bGtpeWVva2tvcmVhbiA9IDB4MzEzYTsKICB0LnJpZXVsa2l5ZW9rc2lvc2tvcmVhbiA9IDB4MzE2OTsKICB0LnJpZXVsa29yZWFuID0gMHgzMTM5OwogIHQucmlldWxtaWV1bWtvcmVhbiA9IDB4MzEzYjsKICB0LnJpZXVscGFuc2lvc2tvcmVhbiA9IDB4MzE2YzsKICB0LnJpZXVscGFyZW5rb3JlYW4gPSAweDMyMDM7CiAgdC5yaWV1bHBoaWV1cGhrb3JlYW4gPSAweDMxM2Y7CiAgdC5yaWV1bHBpZXVwa29yZWFuID0gMHgzMTNjOwogIHQucmlldWxwaWV1cHNpb3Nrb3JlYW4gPSAweDMxNmI7CiAgdC5yaWV1bHNpb3Nrb3JlYW4gPSAweDMxM2Q7CiAgdC5yaWV1bHRoaWV1dGhrb3JlYW4gPSAweDMxM2U7CiAgdC5yaWV1bHRpa2V1dGtvcmVhbiA9IDB4MzE2YTsKICB0LnJpZXVseWVvcmluaGlldWhrb3JlYW4gPSAweDMxNmQ7CiAgdC5yaWdodGFuZ2xlID0gMHgyMjFmOwogIHQucmlnaHR0YWNrYmVsb3djbWIgPSAweDAzMTk7CiAgdC5yaWdodHRyaWFuZ2xlID0gMHgyMmJmOwogIHQucmloaXJhZ2FuYSA9IDB4MzA4YTsKICB0LnJpa2F0YWthbmEgPSAweDMwZWE7CiAgdC5yaWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk4OwogIHQucmluZyA9IDB4MDJkYTsKICB0LnJpbmdiZWxvd2NtYiA9IDB4MDMyNTsKICB0LnJpbmdjbWIgPSAweDAzMGE7CiAgdC5yaW5naGFsZmxlZnQgPSAweDAyYmY7CiAgdC5yaW5naGFsZmxlZnRhcm1lbmlhbiA9IDB4MDU1OTsKICB0LnJpbmdoYWxmbGVmdGJlbG93Y21iID0gMHgwMzFjOwogIHQucmluZ2hhbGZsZWZ0Y2VudGVyZWQgPSAweDAyZDM7CiAgdC5yaW5naGFsZnJpZ2h0ID0gMHgwMmJlOwogIHQucmluZ2hhbGZyaWdodGJlbG93Y21iID0gMHgwMzM5OwogIHQucmluZ2hhbGZyaWdodGNlbnRlcmVkID0gMHgwMmQyOwogIHQucmludmVydGVkYnJldmUgPSAweDAyMTM7CiAgdC5yaXR0b3J1c3F1YXJlID0gMHgzMzUxOwogIHQucmxpbmViZWxvdyA9IDB4MWU1ZjsKICB0LnJsb25nbGVnID0gMHgwMjdjOwogIHQucmxvbmdsZWd0dXJuZWQgPSAweDAyN2E7CiAgdC5ybW9ub3NwYWNlID0gMHhmZjUyOwogIHQucm9oaXJhZ2FuYSA9IDB4MzA4ZDsKICB0LnJva2F0YWthbmEgPSAweDMwZWQ7CiAgdC5yb2thdGFrYW5haGFsZndpZHRoID0gMHhmZjliOwogIHQucm9ydWF0aGFpID0gMHgwZTIzOwogIHQucnBhcmVuID0gMHgyNGFkOwogIHQucnJhYmVuZ2FsaSA9IDB4MDlkYzsKICB0LnJyYWRldmEgPSAweDA5MzE7CiAgdC5ycmFndXJtdWtoaSA9IDB4MGE1YzsKICB0LnJyZWhhcmFiaWMgPSAweDA2OTE7CiAgdC5ycmVoZmluYWxhcmFiaWMgPSAweGZiOGQ7CiAgdC5ycnZvY2FsaWNiZW5nYWxpID0gMHgwOWUwOwogIHQucnJ2b2NhbGljZGV2YSA9IDB4MDk2MDsKICB0LnJydm9jYWxpY2d1amFyYXRpID0gMHgwYWUwOwogIHQucnJ2b2NhbGljdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljNDsKICB0LnJydm9jYWxpY3Zvd2Vsc2lnbmRldmEgPSAweDA5NDQ7CiAgdC5ycnZvY2FsaWN2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjNDsKICB0LnJzdXBlcmlvciA9IDB4ZjZmMTsKICB0LnJ0YmxvY2sgPSAweDI1OTA7CiAgdC5ydHVybmVkID0gMHgwMjc5OwogIHQucnR1cm5lZHN1cGVyaW9yID0gMHgwMmI0OwogIHQucnVoaXJhZ2FuYSA9IDB4MzA4YjsKICB0LnJ1a2F0YWthbmEgPSAweDMwZWI7CiAgdC5ydWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk5OwogIHQucnVwZWVtYXJrYmVuZ2FsaSA9IDB4MDlmMjsKICB0LnJ1cGVlc2lnbmJlbmdhbGkgPSAweDA5ZjM7CiAgdC5ydXBpYWggPSAweGY2ZGQ7CiAgdC5ydXRoYWkgPSAweDBlMjQ7CiAgdC5ydm9jYWxpY2JlbmdhbGkgPSAweDA5OGI7CiAgdC5ydm9jYWxpY2RldmEgPSAweDA5MGI7CiAgdC5ydm9jYWxpY2d1amFyYXRpID0gMHgwYThiOwogIHQucnZvY2FsaWN2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMzOwogIHQucnZvY2FsaWN2b3dlbHNpZ25kZXZhID0gMHgwOTQzOwogIHQucnZvY2FsaWN2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjMzsKICB0LnMgPSAweDAwNzM7CiAgdC5zYWJlbmdhbGkgPSAweDA5Yjg7CiAgdC5zYWN1dGUgPSAweDAxNWI7CiAgdC5zYWN1dGVkb3RhY2NlbnQgPSAweDFlNjU7CiAgdC5zYWRhcmFiaWMgPSAweDA2MzU7CiAgdC5zYWRldmEgPSAweDA5Mzg7CiAgdC5zYWRmaW5hbGFyYWJpYyA9IDB4ZmViYTsKICB0LnNhZGluaXRpYWxhcmFiaWMgPSAweGZlYmI7CiAgdC5zYWRtZWRpYWxhcmFiaWMgPSAweGZlYmM7CiAgdC5zYWd1amFyYXRpID0gMHgwYWI4OwogIHQuc2FndXJtdWtoaSA9IDB4MGEzODsKICB0LnNhaGlyYWdhbmEgPSAweDMwNTU7CiAgdC5zYWthdGFrYW5hID0gMHgzMGI1OwogIHQuc2FrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3YjsKICB0LnNhbGxhbGxhaG91YWxheWhld2FzYWxsYW1hcmFiaWMgPSAweGZkZmE7CiAgdC5zYW1la2ggPSAweDA1ZTE7CiAgdC5zYW1la2hkYWdlc2ggPSAweGZiNDE7CiAgdC5zYW1la2hkYWdlc2hoZWJyZXcgPSAweGZiNDE7CiAgdC5zYW1la2hoZWJyZXcgPSAweDA1ZTE7CiAgdC5zYXJhYWF0aGFpID0gMHgwZTMyOwogIHQuc2FyYWFldGhhaSA9IDB4MGU0MTsKICB0LnNhcmFhaW1haW1hbGFpdGhhaSA9IDB4MGU0NDsKICB0LnNhcmFhaW1haW11YW50aGFpID0gMHgwZTQzOwogIHQuc2FyYWFtdGhhaSA9IDB4MGUzMzsKICB0LnNhcmFhdGhhaSA9IDB4MGUzMDsKICB0LnNhcmFldGhhaSA9IDB4MGU0MDsKICB0LnNhcmFpaWxlZnR0aGFpID0gMHhmODg2OwogIHQuc2FyYWlpdGhhaSA9IDB4MGUzNTsKICB0LnNhcmFpbGVmdHRoYWkgPSAweGY4ODU7CiAgdC5zYXJhaXRoYWkgPSAweDBlMzQ7CiAgdC5zYXJhb3RoYWkgPSAweDBlNDI7CiAgdC5zYXJhdWVlbGVmdHRoYWkgPSAweGY4ODg7CiAgdC5zYXJhdWVldGhhaSA9IDB4MGUzNzsKICB0LnNhcmF1ZWxlZnR0aGFpID0gMHhmODg3OwogIHQuc2FyYXVldGhhaSA9IDB4MGUzNjsKICB0LnNhcmF1dGhhaSA9IDB4MGUzODsKICB0LnNhcmF1dXRoYWkgPSAweDBlMzk7CiAgdC5zYm9wb21vZm8gPSAweDMxMTk7CiAgdC5zY2Fyb24gPSAweDAxNjE7CiAgdC5zY2Fyb25kb3RhY2NlbnQgPSAweDFlNjc7CiAgdC5zY2VkaWxsYSA9IDB4MDE1ZjsKICB0LnNjaHdhID0gMHgwMjU5OwogIHQuc2Nod2FjeXJpbGxpYyA9IDB4MDRkOTsKICB0LnNjaHdhZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkYjsKICB0LnNjaHdhaG9vayA9IDB4MDI1YTsKICB0LnNjaXJjbGUgPSAweDI0ZTI7CiAgdC5zY2lyY3VtZmxleCA9IDB4MDE1ZDsKICB0LnNjb21tYWFjY2VudCA9IDB4MDIxOTsKICB0LnNkb3RhY2NlbnQgPSAweDFlNjE7CiAgdC5zZG90YmVsb3cgPSAweDFlNjM7CiAgdC5zZG90YmVsb3dkb3RhY2NlbnQgPSAweDFlNjk7CiAgdC5zZWFndWxsYmVsb3djbWIgPSAweDAzM2M7CiAgdC5zZWNvbmQgPSAweDIwMzM7CiAgdC5zZWNvbmR0b25lY2hpbmVzZSA9IDB4MDJjYTsKICB0LnNlY3Rpb24gPSAweDAwYTc7CiAgdC5zZWVuYXJhYmljID0gMHgwNjMzOwogIHQuc2VlbmZpbmFsYXJhYmljID0gMHhmZWIyOwogIHQuc2VlbmluaXRpYWxhcmFiaWMgPSAweGZlYjM7CiAgdC5zZWVubWVkaWFsYXJhYmljID0gMHhmZWI0OwogIHQuc2Vnb2wgPSAweDA1YjY7CiAgdC5zZWdvbDEzID0gMHgwNWI2OwogIHQuc2Vnb2wxZiA9IDB4MDViNjsKICB0LnNlZ29sMmMgPSAweDA1YjY7CiAgdC5zZWdvbGhlYnJldyA9IDB4MDViNjsKICB0LnNlZ29sbmFycm93aGVicmV3ID0gMHgwNWI2OwogIHQuc2Vnb2xxdWFydGVyaGVicmV3ID0gMHgwNWI2OwogIHQuc2Vnb2x0YWhlYnJldyA9IDB4MDU5MjsKICB0LnNlZ29sd2lkZWhlYnJldyA9IDB4MDViNjsKICB0LnNlaGFybWVuaWFuID0gMHgwNTdkOwogIHQuc2VoaXJhZ2FuYSA9IDB4MzA1YjsKICB0LnNla2F0YWthbmEgPSAweDMwYmI7CiAgdC5zZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjdlOwogIHQuc2VtaWNvbG9uID0gMHgwMDNiOwogIHQuc2VtaWNvbG9uYXJhYmljID0gMHgwNjFiOwogIHQuc2VtaWNvbG9ubW9ub3NwYWNlID0gMHhmZjFiOwogIHQuc2VtaWNvbG9uc21hbGwgPSAweGZlNTQ7CiAgdC5zZW1pdm9pY2VkbWFya2thbmEgPSAweDMwOWM7CiAgdC5zZW1pdm9pY2VkbWFya2thbmFoYWxmd2lkdGggPSAweGZmOWY7CiAgdC5zZW50aXNxdWFyZSA9IDB4MzMyMjsKICB0LnNlbnRvc3F1YXJlID0gMHgzMzIzOwogIHQuc2V2ZW4gPSAweDAwMzc7CiAgdC5zZXZlbmFyYWJpYyA9IDB4MDY2NzsKICB0LnNldmVuYmVuZ2FsaSA9IDB4MDllZDsKICB0LnNldmVuY2lyY2xlID0gMHgyNDY2OwogIHQuc2V2ZW5jaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzkwOwogIHQuc2V2ZW5kZXZhID0gMHgwOTZkOwogIHQuc2V2ZW5laWdodGhzID0gMHgyMTVlOwogIHQuc2V2ZW5ndWphcmF0aSA9IDB4MGFlZDsKICB0LnNldmVuZ3VybXVraGkgPSAweDBhNmQ7CiAgdC5zZXZlbmhhY2thcmFiaWMgPSAweDA2Njc7CiAgdC5zZXZlbmhhbmd6aG91ID0gMHgzMDI3OwogIHQuc2V2ZW5pZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI2OwogIHQuc2V2ZW5pbmZlcmlvciA9IDB4MjA4NzsKICB0LnNldmVubW9ub3NwYWNlID0gMHhmZjE3OwogIHQuc2V2ZW5vbGRzdHlsZSA9IDB4ZjczNzsKICB0LnNldmVucGFyZW4gPSAweDI0N2E7CiAgdC5zZXZlbnBlcmlvZCA9IDB4MjQ4ZTsKICB0LnNldmVucGVyc2lhbiA9IDB4MDZmNzsKICB0LnNldmVucm9tYW4gPSAweDIxNzY7CiAgdC5zZXZlbnN1cGVyaW9yID0gMHgyMDc3OwogIHQuc2V2ZW50ZWVuY2lyY2xlID0gMHgyNDcwOwogIHQuc2V2ZW50ZWVucGFyZW4gPSAweDI0ODQ7CiAgdC5zZXZlbnRlZW5wZXJpb2QgPSAweDI0OTg7CiAgdC5zZXZlbnRoYWkgPSAweDBlNTc7CiAgdC5zZnRoeXBoZW4gPSAweDAwYWQ7CiAgdC5zaGFhcm1lbmlhbiA9IDB4MDU3NzsKICB0LnNoYWJlbmdhbGkgPSAweDA5YjY7CiAgdC5zaGFjeXJpbGxpYyA9IDB4MDQ0ODsKICB0LnNoYWRkYWFyYWJpYyA9IDB4MDY1MTsKICB0LnNoYWRkYWRhbW1hYXJhYmljID0gMHhmYzYxOwogIHQuc2hhZGRhZGFtbWF0YW5hcmFiaWMgPSAweGZjNWU7CiAgdC5zaGFkZGFmYXRoYWFyYWJpYyA9IDB4ZmM2MDsKICB0LnNoYWRkYWthc3JhYXJhYmljID0gMHhmYzYyOwogIHQuc2hhZGRha2FzcmF0YW5hcmFiaWMgPSAweGZjNWY7CiAgdC5zaGFkZSA9IDB4MjU5MjsKICB0LnNoYWRlZGFyayA9IDB4MjU5MzsKICB0LnNoYWRlbGlnaHQgPSAweDI1OTE7CiAgdC5zaGFkZW1lZGl1bSA9IDB4MjU5MjsKICB0LnNoYWRldmEgPSAweDA5MzY7CiAgdC5zaGFndWphcmF0aSA9IDB4MGFiNjsKICB0LnNoYWd1cm11a2hpID0gMHgwYTM2OwogIHQuc2hhbHNoZWxldGhlYnJldyA9IDB4MDU5MzsKICB0LnNoYm9wb21vZm8gPSAweDMxMTU7CiAgdC5zaGNoYWN5cmlsbGljID0gMHgwNDQ5OwogIHQuc2hlZW5hcmFiaWMgPSAweDA2MzQ7CiAgdC5zaGVlbmZpbmFsYXJhYmljID0gMHhmZWI2OwogIHQuc2hlZW5pbml0aWFsYXJhYmljID0gMHhmZWI3OwogIHQuc2hlZW5tZWRpYWxhcmFiaWMgPSAweGZlYjg7CiAgdC5zaGVpY29wdGljID0gMHgwM2UzOwogIHQuc2hlcWVsID0gMHgyMGFhOwogIHQuc2hlcWVsaGVicmV3ID0gMHgyMGFhOwogIHQuc2hldmEgPSAweDA1YjA7CiAgdC5zaGV2YTExNSA9IDB4MDViMDsKICB0LnNoZXZhMTUgPSAweDA1YjA7CiAgdC5zaGV2YTIyID0gMHgwNWIwOwogIHQuc2hldmEyZSA9IDB4MDViMDsKICB0LnNoZXZhaGVicmV3ID0gMHgwNWIwOwogIHQuc2hldmFuYXJyb3doZWJyZXcgPSAweDA1YjA7CiAgdC5zaGV2YXF1YXJ0ZXJoZWJyZXcgPSAweDA1YjA7CiAgdC5zaGV2YXdpZGVoZWJyZXcgPSAweDA1YjA7CiAgdC5zaGhhY3lyaWxsaWMgPSAweDA0YmI7CiAgdC5zaGltYWNvcHRpYyA9IDB4MDNlZDsKICB0LnNoaW4gPSAweDA1ZTk7CiAgdC5zaGluZGFnZXNoID0gMHhmYjQ5OwogIHQuc2hpbmRhZ2VzaGhlYnJldyA9IDB4ZmI0OTsKICB0LnNoaW5kYWdlc2hzaGluZG90ID0gMHhmYjJjOwogIHQuc2hpbmRhZ2VzaHNoaW5kb3RoZWJyZXcgPSAweGZiMmM7CiAgdC5zaGluZGFnZXNoc2luZG90ID0gMHhmYjJkOwogIHQuc2hpbmRhZ2VzaHNpbmRvdGhlYnJldyA9IDB4ZmIyZDsKICB0LnNoaW5kb3RoZWJyZXcgPSAweDA1YzE7CiAgdC5zaGluaGVicmV3ID0gMHgwNWU5OwogIHQuc2hpbnNoaW5kb3QgPSAweGZiMmE7CiAgdC5zaGluc2hpbmRvdGhlYnJldyA9IDB4ZmIyYTsKICB0LnNoaW5zaW5kb3QgPSAweGZiMmI7CiAgdC5zaGluc2luZG90aGVicmV3ID0gMHhmYjJiOwogIHQuc2hvb2sgPSAweDAyODI7CiAgdC5zaWdtYSA9IDB4MDNjMzsKICB0LnNpZ21hMSA9IDB4MDNjMjsKICB0LnNpZ21hZmluYWwgPSAweDAzYzI7CiAgdC5zaWdtYWx1bmF0ZXN5bWJvbGdyZWVrID0gMHgwM2YyOwogIHQuc2loaXJhZ2FuYSA9IDB4MzA1NzsKICB0LnNpa2F0YWthbmEgPSAweDMwYjc7CiAgdC5zaWthdGFrYW5haGFsZndpZHRoID0gMHhmZjdjOwogIHQuc2lsdXFoZWJyZXcgPSAweDA1YmQ7CiAgdC5zaWx1cWxlZnRoZWJyZXcgPSAweDA1YmQ7CiAgdC5zaW1pbGFyID0gMHgyMjNjOwogIHQuc2luZG90aGVicmV3ID0gMHgwNWMyOwogIHQuc2lvc2FjaXJjbGVrb3JlYW4gPSAweDMyNzQ7CiAgdC5zaW9zYXBhcmVua29yZWFuID0gMHgzMjE0OwogIHQuc2lvc2NpZXVja29yZWFuID0gMHgzMTdlOwogIHQuc2lvc2NpcmNsZWtvcmVhbiA9IDB4MzI2NjsKICB0LnNpb3NraXllb2trb3JlYW4gPSAweDMxN2E7CiAgdC5zaW9za29yZWFuID0gMHgzMTQ1OwogIHQuc2lvc25pZXVua29yZWFuID0gMHgzMTdiOwogIHQuc2lvc3BhcmVua29yZWFuID0gMHgzMjA2OwogIHQuc2lvc3BpZXVwa29yZWFuID0gMHgzMTdkOwogIHQuc2lvc3Rpa2V1dGtvcmVhbiA9IDB4MzE3YzsKICB0LnNpeCA9IDB4MDAzNjsKICB0LnNpeGFyYWJpYyA9IDB4MDY2NjsKICB0LnNpeGJlbmdhbGkgPSAweDA5ZWM7CiAgdC5zaXhjaXJjbGUgPSAweDI0NjU7CiAgdC5zaXhjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzhmOwogIHQuc2l4ZGV2YSA9IDB4MDk2YzsKICB0LnNpeGd1amFyYXRpID0gMHgwYWVjOwogIHQuc2l4Z3VybXVraGkgPSAweDBhNmM7CiAgdC5zaXhoYWNrYXJhYmljID0gMHgwNjY2OwogIHQuc2l4aGFuZ3pob3UgPSAweDMwMjY7CiAgdC5zaXhpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI1OwogIHQuc2l4aW5mZXJpb3IgPSAweDIwODY7CiAgdC5zaXhtb25vc3BhY2UgPSAweGZmMTY7CiAgdC5zaXhvbGRzdHlsZSA9IDB4ZjczNjsKICB0LnNpeHBhcmVuID0gMHgyNDc5OwogIHQuc2l4cGVyaW9kID0gMHgyNDhkOwogIHQuc2l4cGVyc2lhbiA9IDB4MDZmNjsKICB0LnNpeHJvbWFuID0gMHgyMTc1OwogIHQuc2l4c3VwZXJpb3IgPSAweDIwNzY7CiAgdC5zaXh0ZWVuY2lyY2xlID0gMHgyNDZmOwogIHQuc2l4dGVlbmN1cnJlbmN5ZGVub21pbmF0b3JiZW5nYWxpID0gMHgwOWY5OwogIHQuc2l4dGVlbnBhcmVuID0gMHgyNDgzOwogIHQuc2l4dGVlbnBlcmlvZCA9IDB4MjQ5NzsKICB0LnNpeHRoYWkgPSAweDBlNTY7CiAgdC5zbGFzaCA9IDB4MDAyZjsKICB0LnNsYXNobW9ub3NwYWNlID0gMHhmZjBmOwogIHQuc2xvbmcgPSAweDAxN2Y7CiAgdC5zbG9uZ2RvdGFjY2VudCA9IDB4MWU5YjsKICB0LnNtaWxlZmFjZSA9IDB4MjYzYTsKICB0LnNtb25vc3BhY2UgPSAweGZmNTM7CiAgdC5zb2ZwYXN1cWhlYnJldyA9IDB4MDVjMzsKICB0LnNvZnRoeXBoZW4gPSAweDAwYWQ7CiAgdC5zb2Z0c2lnbmN5cmlsbGljID0gMHgwNDRjOwogIHQuc29oaXJhZ2FuYSA9IDB4MzA1ZDsKICB0LnNva2F0YWthbmEgPSAweDMwYmQ7CiAgdC5zb2thdGFrYW5haGFsZndpZHRoID0gMHhmZjdmOwogIHQuc29saWR1c2xvbmdvdmVybGF5Y21iID0gMHgwMzM4OwogIHQuc29saWR1c3Nob3J0b3ZlcmxheWNtYiA9IDB4MDMzNzsKICB0LnNvcnVzaXRoYWkgPSAweDBlMjk7CiAgdC5zb3NhbGF0aGFpID0gMHgwZTI4OwogIHQuc29zb3RoYWkgPSAweDBlMGI7CiAgdC5zb3N1YXRoYWkgPSAweDBlMmE7CiAgdC5zcGFjZSA9IDB4MDAyMDsKICB0LnNwYWNlaGFja2FyYWJpYyA9IDB4MDAyMDsKICB0LnNwYWRlID0gMHgyNjYwOwogIHQuc3BhZGVzdWl0YmxhY2sgPSAweDI2NjA7CiAgdC5zcGFkZXN1aXR3aGl0ZSA9IDB4MjY2NDsKICB0LnNwYXJlbiA9IDB4MjRhZTsKICB0LnNxdWFyZWJlbG93Y21iID0gMHgwMzNiOwogIHQuc3F1YXJlY2MgPSAweDMzYzQ7CiAgdC5zcXVhcmVjbSA9IDB4MzM5ZDsKICB0LnNxdWFyZWRpYWdvbmFsY3Jvc3NoYXRjaGZpbGwgPSAweDI1YTk7CiAgdC5zcXVhcmVob3Jpem9udGFsZmlsbCA9IDB4MjVhNDsKICB0LnNxdWFyZWtnID0gMHgzMzhmOwogIHQuc3F1YXJla20gPSAweDMzOWU7CiAgdC5zcXVhcmVrbWNhcGl0YWwgPSAweDMzY2U7CiAgdC5zcXVhcmVsbiA9IDB4MzNkMTsKICB0LnNxdWFyZWxvZyA9IDB4MzNkMjsKICB0LnNxdWFyZW1nID0gMHgzMzhlOwogIHQuc3F1YXJlbWlsID0gMHgzM2Q1OwogIHQuc3F1YXJlbW0gPSAweDMzOWM7CiAgdC5zcXVhcmVtc3F1YXJlZCA9IDB4MzNhMTsKICB0LnNxdWFyZW9ydGhvZ29uYWxjcm9zc2hhdGNoZmlsbCA9IDB4MjVhNjsKICB0LnNxdWFyZXVwcGVybGVmdHRvbG93ZXJyaWdodGZpbGwgPSAweDI1YTc7CiAgdC5zcXVhcmV1cHBlcnJpZ2h0dG9sb3dlcmxlZnRmaWxsID0gMHgyNWE4OwogIHQuc3F1YXJldmVydGljYWxmaWxsID0gMHgyNWE1OwogIHQuc3F1YXJld2hpdGV3aXRoc21hbGxibGFjayA9IDB4MjVhMzsKICB0LnNyc3F1YXJlID0gMHgzM2RiOwogIHQuc3NhYmVuZ2FsaSA9IDB4MDliNzsKICB0LnNzYWRldmEgPSAweDA5Mzc7CiAgdC5zc2FndWphcmF0aSA9IDB4MGFiNzsKICB0LnNzYW5nY2lldWNrb3JlYW4gPSAweDMxNDk7CiAgdC5zc2FuZ2hpZXVoa29yZWFuID0gMHgzMTg1OwogIHQuc3NhbmdpZXVuZ2tvcmVhbiA9IDB4MzE4MDsKICB0LnNzYW5na2l5ZW9ra29yZWFuID0gMHgzMTMyOwogIHQuc3NhbmduaWV1bmtvcmVhbiA9IDB4MzE2NTsKICB0LnNzYW5ncGlldXBrb3JlYW4gPSAweDMxNDM7CiAgdC5zc2FuZ3Npb3Nrb3JlYW4gPSAweDMxNDY7CiAgdC5zc2FuZ3Rpa2V1dGtvcmVhbiA9IDB4MzEzODsKICB0LnNzdXBlcmlvciA9IDB4ZjZmMjsKICB0LnN0ZXJsaW5nID0gMHgwMGEzOwogIHQuc3Rlcmxpbmdtb25vc3BhY2UgPSAweGZmZTE7CiAgdC5zdHJva2Vsb25nb3ZlcmxheWNtYiA9IDB4MDMzNjsKICB0LnN0cm9rZXNob3J0b3ZlcmxheWNtYiA9IDB4MDMzNTsKICB0LnN1YnNldCA9IDB4MjI4MjsKICB0LnN1YnNldG5vdGVxdWFsID0gMHgyMjhhOwogIHQuc3Vic2V0b3JlcXVhbCA9IDB4MjI4NjsKICB0LnN1Y2NlZWRzID0gMHgyMjdiOwogIHQuc3VjaHRoYXQgPSAweDIyMGI7CiAgdC5zdWhpcmFnYW5hID0gMHgzMDU5OwogIHQuc3VrYXRha2FuYSA9IDB4MzBiOTsKICB0LnN1a2F0YWthbmFoYWxmd2lkdGggPSAweGZmN2Q7CiAgdC5zdWt1bmFyYWJpYyA9IDB4MDY1MjsKICB0LnN1bW1hdGlvbiA9IDB4MjIxMTsKICB0LnN1biA9IDB4MjYzYzsKICB0LnN1cGVyc2V0ID0gMHgyMjgzOwogIHQuc3VwZXJzZXRub3RlcXVhbCA9IDB4MjI4YjsKICB0LnN1cGVyc2V0b3JlcXVhbCA9IDB4MjI4NzsKICB0LnN2c3F1YXJlID0gMHgzM2RjOwogIHQuc3lvdXdhZXJhc3F1YXJlID0gMHgzMzdjOwogIHQudCA9IDB4MDA3NDsKICB0LnRhYmVuZ2FsaSA9IDB4MDlhNDsKICB0LnRhY2tkb3duID0gMHgyMmE0OwogIHQudGFja2xlZnQgPSAweDIyYTM7CiAgdC50YWRldmEgPSAweDA5MjQ7CiAgdC50YWd1amFyYXRpID0gMHgwYWE0OwogIHQudGFndXJtdWtoaSA9IDB4MGEyNDsKICB0LnRhaGFyYWJpYyA9IDB4MDYzNzsKICB0LnRhaGZpbmFsYXJhYmljID0gMHhmZWMyOwogIHQudGFoaW5pdGlhbGFyYWJpYyA9IDB4ZmVjMzsKICB0LnRhaGlyYWdhbmEgPSAweDMwNWY7CiAgdC50YWhtZWRpYWxhcmFiaWMgPSAweGZlYzQ7CiAgdC50YWlzeW91ZXJhc3F1YXJlID0gMHgzMzdkOwogIHQudGFrYXRha2FuYSA9IDB4MzBiZjsKICB0LnRha2F0YWthbmFoYWxmd2lkdGggPSAweGZmODA7CiAgdC50YXR3ZWVsYXJhYmljID0gMHgwNjQwOwogIHQudGF1ID0gMHgwM2M0OwogIHQudGF2ID0gMHgwNWVhOwogIHQudGF2ZGFnZXMgPSAweGZiNGE7CiAgdC50YXZkYWdlc2ggPSAweGZiNGE7CiAgdC50YXZkYWdlc2hoZWJyZXcgPSAweGZiNGE7CiAgdC50YXZoZWJyZXcgPSAweDA1ZWE7CiAgdC50YmFyID0gMHgwMTY3OwogIHQudGJvcG9tb2ZvID0gMHgzMTBhOwogIHQudGNhcm9uID0gMHgwMTY1OwogIHQudGNjdXJsID0gMHgwMmE4OwogIHQudGNlZGlsbGEgPSAweDAxNjM7CiAgdC50Y2hlaGFyYWJpYyA9IDB4MDY4NjsKICB0LnRjaGVoZmluYWxhcmFiaWMgPSAweGZiN2I7CiAgdC50Y2hlaGluaXRpYWxhcmFiaWMgPSAweGZiN2M7CiAgdC50Y2hlaG1lZGlhbGFyYWJpYyA9IDB4ZmI3ZDsKICB0LnRjaXJjbGUgPSAweDI0ZTM7CiAgdC50Y2lyY3VtZmxleGJlbG93ID0gMHgxZTcxOwogIHQudGNvbW1hYWNjZW50ID0gMHgwMTYzOwogIHQudGRpZXJlc2lzID0gMHgxZTk3OwogIHQudGRvdGFjY2VudCA9IDB4MWU2YjsKICB0LnRkb3RiZWxvdyA9IDB4MWU2ZDsKICB0LnRlY3lyaWxsaWMgPSAweDA0NDI7CiAgdC50ZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFkOwogIHQudGVoYXJhYmljID0gMHgwNjJhOwogIHQudGVoZmluYWxhcmFiaWMgPSAweGZlOTY7CiAgdC50ZWhoYWhpbml0aWFsYXJhYmljID0gMHhmY2EyOwogIHQudGVoaGFoaXNvbGF0ZWRhcmFiaWMgPSAweGZjMGM7CiAgdC50ZWhpbml0aWFsYXJhYmljID0gMHhmZTk3OwogIHQudGVoaXJhZ2FuYSA9IDB4MzA2NjsKICB0LnRlaGplZW1pbml0aWFsYXJhYmljID0gMHhmY2ExOwogIHQudGVoamVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzBiOwogIHQudGVobWFyYnV0YWFyYWJpYyA9IDB4MDYyOTsKICB0LnRlaG1hcmJ1dGFmaW5hbGFyYWJpYyA9IDB4ZmU5NDsKICB0LnRlaG1lZGlhbGFyYWJpYyA9IDB4ZmU5ODsKICB0LnRlaG1lZW1pbml0aWFsYXJhYmljID0gMHhmY2E0OwogIHQudGVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzBlOwogIHQudGVobm9vbmZpbmFsYXJhYmljID0gMHhmYzczOwogIHQudGVrYXRha2FuYSA9IDB4MzBjNjsKICB0LnRla2F0YWthbmFoYWxmd2lkdGggPSAweGZmODM7CiAgdC50ZWxlcGhvbmUgPSAweDIxMjE7CiAgdC50ZWxlcGhvbmVibGFjayA9IDB4MjYwZTsKICB0LnRlbGlzaGFnZWRvbGFoZWJyZXcgPSAweDA1YTA7CiAgdC50ZWxpc2hhcWV0YW5haGVicmV3ID0gMHgwNWE5OwogIHQudGVuY2lyY2xlID0gMHgyNDY5OwogIHQudGVuaWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyOTsKICB0LnRlbnBhcmVuID0gMHgyNDdkOwogIHQudGVucGVyaW9kID0gMHgyNDkxOwogIHQudGVucm9tYW4gPSAweDIxNzk7CiAgdC50ZXNoID0gMHgwMmE3OwogIHQudGV0ID0gMHgwNWQ4OwogIHQudGV0ZGFnZXNoID0gMHhmYjM4OwogIHQudGV0ZGFnZXNoaGVicmV3ID0gMHhmYjM4OwogIHQudGV0aGVicmV3ID0gMHgwNWQ4OwogIHQudGV0c2VjeXJpbGxpYyA9IDB4MDRiNTsKICB0LnRldmlyaGVicmV3ID0gMHgwNTliOwogIHQudGV2aXJsZWZ0aGVicmV3ID0gMHgwNTliOwogIHQudGhhYmVuZ2FsaSA9IDB4MDlhNTsKICB0LnRoYWRldmEgPSAweDA5MjU7CiAgdC50aGFndWphcmF0aSA9IDB4MGFhNTsKICB0LnRoYWd1cm11a2hpID0gMHgwYTI1OwogIHQudGhhbGFyYWJpYyA9IDB4MDYzMDsKICB0LnRoYWxmaW5hbGFyYWJpYyA9IDB4ZmVhYzsKICB0LnRoYW50aGFraGF0bG93bGVmdHRoYWkgPSAweGY4OTg7CiAgdC50aGFudGhha2hhdGxvd3JpZ2h0dGhhaSA9IDB4Zjg5NzsKICB0LnRoYW50aGFraGF0dGhhaSA9IDB4MGU0YzsKICB0LnRoYW50aGFraGF0dXBwZXJsZWZ0dGhhaSA9IDB4Zjg5NjsKICB0LnRoZWhhcmFiaWMgPSAweDA2MmI7CiAgdC50aGVoZmluYWxhcmFiaWMgPSAweGZlOWE7CiAgdC50aGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmU5YjsKICB0LnRoZWhtZWRpYWxhcmFiaWMgPSAweGZlOWM7CiAgdC50aGVyZWV4aXN0cyA9IDB4MjIwMzsKICB0LnRoZXJlZm9yZSA9IDB4MjIzNDsKICB0LnRoZXRhID0gMHgwM2I4OwogIHQudGhldGExID0gMHgwM2QxOwogIHQudGhldGFzeW1ib2xncmVlayA9IDB4MDNkMTsKICB0LnRoaWV1dGhhY2lyY2xla29yZWFuID0gMHgzMjc5OwogIHQudGhpZXV0aGFwYXJlbmtvcmVhbiA9IDB4MzIxOTsKICB0LnRoaWV1dGhjaXJjbGVrb3JlYW4gPSAweDMyNmI7CiAgdC50aGlldXRoa29yZWFuID0gMHgzMTRjOwogIHQudGhpZXV0aHBhcmVua29yZWFuID0gMHgzMjBiOwogIHQudGhpcnRlZW5jaXJjbGUgPSAweDI0NmM7CiAgdC50aGlydGVlbnBhcmVuID0gMHgyNDgwOwogIHQudGhpcnRlZW5wZXJpb2QgPSAweDI0OTQ7CiAgdC50aG9uYW5nbW9udGhvdGhhaSA9IDB4MGUxMTsKICB0LnRob29rID0gMHgwMWFkOwogIHQudGhvcGh1dGhhb3RoYWkgPSAweDBlMTI7CiAgdC50aG9ybiA9IDB4MDBmZTsKICB0LnRob3RoYWhhbnRoYWkgPSAweDBlMTc7CiAgdC50aG90aGFudGhhaSA9IDB4MGUxMDsKICB0LnRob3Rob25ndGhhaSA9IDB4MGUxODsKICB0LnRob3RodW5ndGhhaSA9IDB4MGUxNjsKICB0LnRob3VzYW5kY3lyaWxsaWMgPSAweDA0ODI7CiAgdC50aG91c2FuZHNzZXBhcmF0b3JhcmFiaWMgPSAweDA2NmM7CiAgdC50aG91c2FuZHNzZXBhcmF0b3JwZXJzaWFuID0gMHgwNjZjOwogIHQudGhyZWUgPSAweDAwMzM7CiAgdC50aHJlZWFyYWJpYyA9IDB4MDY2MzsKICB0LnRocmVlYmVuZ2FsaSA9IDB4MDllOTsKICB0LnRocmVlY2lyY2xlID0gMHgyNDYyOwogIHQudGhyZWVjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzhjOwogIHQudGhyZWVkZXZhID0gMHgwOTY5OwogIHQudGhyZWVlaWdodGhzID0gMHgyMTVjOwogIHQudGhyZWVndWphcmF0aSA9IDB4MGFlOTsKICB0LnRocmVlZ3VybXVraGkgPSAweDBhNjk7CiAgdC50aHJlZWhhY2thcmFiaWMgPSAweDA2NjM7CiAgdC50aHJlZWhhbmd6aG91ID0gMHgzMDIzOwogIHQudGhyZWVpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjIyOwogIHQudGhyZWVpbmZlcmlvciA9IDB4MjA4MzsKICB0LnRocmVlbW9ub3NwYWNlID0gMHhmZjEzOwogIHQudGhyZWVudW1lcmF0b3JiZW5nYWxpID0gMHgwOWY2OwogIHQudGhyZWVvbGRzdHlsZSA9IDB4ZjczMzsKICB0LnRocmVlcGFyZW4gPSAweDI0NzY7CiAgdC50aHJlZXBlcmlvZCA9IDB4MjQ4YTsKICB0LnRocmVlcGVyc2lhbiA9IDB4MDZmMzsKICB0LnRocmVlcXVhcnRlcnMgPSAweDAwYmU7CiAgdC50aHJlZXF1YXJ0ZXJzZW1kYXNoID0gMHhmNmRlOwogIHQudGhyZWVyb21hbiA9IDB4MjE3MjsKICB0LnRocmVlc3VwZXJpb3IgPSAweDAwYjM7CiAgdC50aHJlZXRoYWkgPSAweDBlNTM7CiAgdC50aHpzcXVhcmUgPSAweDMzOTQ7CiAgdC50aWhpcmFnYW5hID0gMHgzMDYxOwogIHQudGlrYXRha2FuYSA9IDB4MzBjMTsKICB0LnRpa2F0YWthbmFoYWxmd2lkdGggPSAweGZmODE7CiAgdC50aWtldXRhY2lyY2xla29yZWFuID0gMHgzMjcwOwogIHQudGlrZXV0YXBhcmVua29yZWFuID0gMHgzMjEwOwogIHQudGlrZXV0Y2lyY2xla29yZWFuID0gMHgzMjYyOwogIHQudGlrZXV0a29yZWFuID0gMHgzMTM3OwogIHQudGlrZXV0cGFyZW5rb3JlYW4gPSAweDMyMDI7CiAgdC50aWxkZSA9IDB4MDJkYzsKICB0LnRpbGRlYmVsb3djbWIgPSAweDAzMzA7CiAgdC50aWxkZWNtYiA9IDB4MDMwMzsKICB0LnRpbGRlY29tYiA9IDB4MDMwMzsKICB0LnRpbGRlZG91YmxlY21iID0gMHgwMzYwOwogIHQudGlsZGVvcGVyYXRvciA9IDB4MjIzYzsKICB0LnRpbGRlb3ZlcmxheWNtYiA9IDB4MDMzNDsKICB0LnRpbGRldmVydGljYWxjbWIgPSAweDAzM2U7CiAgdC50aW1lc2NpcmNsZSA9IDB4MjI5NzsKICB0LnRpcGVoYWhlYnJldyA9IDB4MDU5NjsKICB0LnRpcGVoYWxlZnRoZWJyZXcgPSAweDA1OTY7CiAgdC50aXBwaWd1cm11a2hpID0gMHgwYTcwOwogIHQudGl0bG9jeXJpbGxpY2NtYiA9IDB4MDQ4MzsKICB0LnRpd25hcm1lbmlhbiA9IDB4MDU3ZjsKICB0LnRsaW5lYmVsb3cgPSAweDFlNmY7CiAgdC50bW9ub3NwYWNlID0gMHhmZjU0OwogIHQudG9hcm1lbmlhbiA9IDB4MDU2OTsKICB0LnRvaGlyYWdhbmEgPSAweDMwNjg7CiAgdC50b2thdGFrYW5hID0gMHgzMGM4OwogIHQudG9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4NDsKICB0LnRvbmViYXJleHRyYWhpZ2htb2QgPSAweDAyZTU7CiAgdC50b25lYmFyZXh0cmFsb3dtb2QgPSAweDAyZTk7CiAgdC50b25lYmFyaGlnaG1vZCA9IDB4MDJlNjsKICB0LnRvbmViYXJsb3dtb2QgPSAweDAyZTg7CiAgdC50b25lYmFybWlkbW9kID0gMHgwMmU3OwogIHQudG9uZWZpdmUgPSAweDAxYmQ7CiAgdC50b25lc2l4ID0gMHgwMTg1OwogIHQudG9uZXR3byA9IDB4MDFhODsKICB0LnRvbm9zID0gMHgwMzg0OwogIHQudG9uc3F1YXJlID0gMHgzMzI3OwogIHQudG9wYXRha3RoYWkgPSAweDBlMGY7CiAgdC50b3J0b2lzZXNoZWxsYnJhY2tldGxlZnQgPSAweDMwMTQ7CiAgdC50b3J0b2lzZXNoZWxsYnJhY2tldGxlZnRzbWFsbCA9IDB4ZmU1ZDsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTM5OwogIHQudG9ydG9pc2VzaGVsbGJyYWNrZXRyaWdodCA9IDB4MzAxNTsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0cmlnaHRzbWFsbCA9IDB4ZmU1ZTsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0cmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzYTsKICB0LnRvdGFvdGhhaSA9IDB4MGUxNTsKICB0LnRwYWxhdGFsaG9vayA9IDB4MDFhYjsKICB0LnRwYXJlbiA9IDB4MjRhZjsKICB0LnRyYWRlbWFyayA9IDB4MjEyMjsKICB0LnRyYWRlbWFya3NhbnMgPSAweGY4ZWE7CiAgdC50cmFkZW1hcmtzZXJpZiA9IDB4ZjZkYjsKICB0LnRyZXRyb2ZsZXhob29rID0gMHgwMjg4OwogIHQudHJpYWdkbiA9IDB4MjViYzsKICB0LnRyaWFnbGYgPSAweDI1YzQ7CiAgdC50cmlhZ3J0ID0gMHgyNWJhOwogIHQudHJpYWd1cCA9IDB4MjViMjsKICB0LnRzID0gMHgwMmE2OwogIHQudHNhZGkgPSAweDA1ZTY7CiAgdC50c2FkaWRhZ2VzaCA9IDB4ZmI0NjsKICB0LnRzYWRpZGFnZXNoaGVicmV3ID0gMHhmYjQ2OwogIHQudHNhZGloZWJyZXcgPSAweDA1ZTY7CiAgdC50c2VjeXJpbGxpYyA9IDB4MDQ0NjsKICB0LnRzZXJlID0gMHgwNWI1OwogIHQudHNlcmUxMiA9IDB4MDViNTsKICB0LnRzZXJlMWUgPSAweDA1YjU7CiAgdC50c2VyZTJiID0gMHgwNWI1OwogIHQudHNlcmVoZWJyZXcgPSAweDA1YjU7CiAgdC50c2VyZW5hcnJvd2hlYnJldyA9IDB4MDViNTsKICB0LnRzZXJlcXVhcnRlcmhlYnJldyA9IDB4MDViNTsKICB0LnRzZXJld2lkZWhlYnJldyA9IDB4MDViNTsKICB0LnRzaGVjeXJpbGxpYyA9IDB4MDQ1YjsKICB0LnRzdXBlcmlvciA9IDB4ZjZmMzsKICB0LnR0YWJlbmdhbGkgPSAweDA5OWY7CiAgdC50dGFkZXZhID0gMHgwOTFmOwogIHQudHRhZ3VqYXJhdGkgPSAweDBhOWY7CiAgdC50dGFndXJtdWtoaSA9IDB4MGExZjsKICB0LnR0ZWhhcmFiaWMgPSAweDA2Nzk7CiAgdC50dGVoZmluYWxhcmFiaWMgPSAweGZiNjc7CiAgdC50dGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmI2ODsKICB0LnR0ZWhtZWRpYWxhcmFiaWMgPSAweGZiNjk7CiAgdC50dGhhYmVuZ2FsaSA9IDB4MDlhMDsKICB0LnR0aGFkZXZhID0gMHgwOTIwOwogIHQudHRoYWd1amFyYXRpID0gMHgwYWEwOwogIHQudHRoYWd1cm11a2hpID0gMHgwYTIwOwogIHQudHR1cm5lZCA9IDB4MDI4NzsKICB0LnR1aGlyYWdhbmEgPSAweDMwNjQ7CiAgdC50dWthdGFrYW5hID0gMHgzMGM0OwogIHQudHVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4MjsKICB0LnR1c21hbGxoaXJhZ2FuYSA9IDB4MzA2MzsKICB0LnR1c21hbGxrYXRha2FuYSA9IDB4MzBjMzsKICB0LnR1c21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2ZjsKICB0LnR3ZWx2ZWNpcmNsZSA9IDB4MjQ2YjsKICB0LnR3ZWx2ZXBhcmVuID0gMHgyNDdmOwogIHQudHdlbHZlcGVyaW9kID0gMHgyNDkzOwogIHQudHdlbHZlcm9tYW4gPSAweDIxN2I7CiAgdC50d2VudHljaXJjbGUgPSAweDI0NzM7CiAgdC50d2VudHloYW5nemhvdSA9IDB4NTM0NDsKICB0LnR3ZW50eXBhcmVuID0gMHgyNDg3OwogIHQudHdlbnR5cGVyaW9kID0gMHgyNDliOwogIHQudHdvID0gMHgwMDMyOwogIHQudHdvYXJhYmljID0gMHgwNjYyOwogIHQudHdvYmVuZ2FsaSA9IDB4MDllODsKICB0LnR3b2NpcmNsZSA9IDB4MjQ2MTsKICB0LnR3b2NpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OGI7CiAgdC50d29kZXZhID0gMHgwOTY4OwogIHQudHdvZG90ZW5sZWFkZXIgPSAweDIwMjU7CiAgdC50d29kb3RsZWFkZXIgPSAweDIwMjU7CiAgdC50d29kb3RsZWFkZXJ2ZXJ0aWNhbCA9IDB4ZmUzMDsKICB0LnR3b2d1amFyYXRpID0gMHgwYWU4OwogIHQudHdvZ3VybXVraGkgPSAweDBhNjg7CiAgdC50d29oYWNrYXJhYmljID0gMHgwNjYyOwogIHQudHdvaGFuZ3pob3UgPSAweDMwMjI7CiAgdC50d29pZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjIxOwogIHQudHdvaW5mZXJpb3IgPSAweDIwODI7CiAgdC50d29tb25vc3BhY2UgPSAweGZmMTI7CiAgdC50d29udW1lcmF0b3JiZW5nYWxpID0gMHgwOWY1OwogIHQudHdvb2xkc3R5bGUgPSAweGY3MzI7CiAgdC50d29wYXJlbiA9IDB4MjQ3NTsKICB0LnR3b3BlcmlvZCA9IDB4MjQ4OTsKICB0LnR3b3BlcnNpYW4gPSAweDA2ZjI7CiAgdC50d29yb21hbiA9IDB4MjE3MTsKICB0LnR3b3N0cm9rZSA9IDB4MDFiYjsKICB0LnR3b3N1cGVyaW9yID0gMHgwMGIyOwogIHQudHdvdGhhaSA9IDB4MGU1MjsKICB0LnR3b3RoaXJkcyA9IDB4MjE1NDsKICB0LnUgPSAweDAwNzU7CiAgdC51YWN1dGUgPSAweDAwZmE7CiAgdC51YmFyID0gMHgwMjg5OwogIHQudWJlbmdhbGkgPSAweDA5ODk7CiAgdC51Ym9wb21vZm8gPSAweDMxMjg7CiAgdC51YnJldmUgPSAweDAxNmQ7CiAgdC51Y2Fyb24gPSAweDAxZDQ7CiAgdC51Y2lyY2xlID0gMHgyNGU0OwogIHQudWNpcmN1bWZsZXggPSAweDAwZmI7CiAgdC51Y2lyY3VtZmxleGJlbG93ID0gMHgxZTc3OwogIHQudWN5cmlsbGljID0gMHgwNDQzOwogIHQudWRhdHRhZGV2YSA9IDB4MDk1MTsKICB0LnVkYmxhY3V0ZSA9IDB4MDE3MTsKICB0LnVkYmxncmF2ZSA9IDB4MDIxNTsKICB0LnVkZXZhID0gMHgwOTA5OwogIHQudWRpZXJlc2lzID0gMHgwMGZjOwogIHQudWRpZXJlc2lzYWN1dGUgPSAweDAxZDg7CiAgdC51ZGllcmVzaXNiZWxvdyA9IDB4MWU3MzsKICB0LnVkaWVyZXNpc2Nhcm9uID0gMHgwMWRhOwogIHQudWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZjE7CiAgdC51ZGllcmVzaXNncmF2ZSA9IDB4MDFkYzsKICB0LnVkaWVyZXNpc21hY3JvbiA9IDB4MDFkNjsKICB0LnVkb3RiZWxvdyA9IDB4MWVlNTsKICB0LnVncmF2ZSA9IDB4MDBmOTsKICB0LnVndWphcmF0aSA9IDB4MGE4OTsKICB0LnVndXJtdWtoaSA9IDB4MGEwOTsKICB0LnVoaXJhZ2FuYSA9IDB4MzA0NjsKICB0LnVob29rYWJvdmUgPSAweDFlZTc7CiAgdC51aG9ybiA9IDB4MDFiMDsKICB0LnVob3JuYWN1dGUgPSAweDFlZTk7CiAgdC51aG9ybmRvdGJlbG93ID0gMHgxZWYxOwogIHQudWhvcm5ncmF2ZSA9IDB4MWVlYjsKICB0LnVob3JuaG9va2Fib3ZlID0gMHgxZWVkOwogIHQudWhvcm50aWxkZSA9IDB4MWVlZjsKICB0LnVodW5nYXJ1bWxhdXQgPSAweDAxNzE7CiAgdC51aHVuZ2FydW1sYXV0Y3lyaWxsaWMgPSAweDA0ZjM7CiAgdC51aW52ZXJ0ZWRicmV2ZSA9IDB4MDIxNzsKICB0LnVrYXRha2FuYSA9IDB4MzBhNjsKICB0LnVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3MzsKICB0LnVrY3lyaWxsaWMgPSAweDA0Nzk7CiAgdC51a29yZWFuID0gMHgzMTVjOwogIHQudW1hY3JvbiA9IDB4MDE2YjsKICB0LnVtYWNyb25jeXJpbGxpYyA9IDB4MDRlZjsKICB0LnVtYWNyb25kaWVyZXNpcyA9IDB4MWU3YjsKICB0LnVtYXRyYWd1cm11a2hpID0gMHgwYTQxOwogIHQudW1vbm9zcGFjZSA9IDB4ZmY1NTsKICB0LnVuZGVyc2NvcmUgPSAweDAwNWY7CiAgdC51bmRlcnNjb3JlZGJsID0gMHgyMDE3OwogIHQudW5kZXJzY29yZW1vbm9zcGFjZSA9IDB4ZmYzZjsKICB0LnVuZGVyc2NvcmV2ZXJ0aWNhbCA9IDB4ZmUzMzsKICB0LnVuZGVyc2NvcmV3YXZ5ID0gMHhmZTRmOwogIHQudW5pb24gPSAweDIyMmE7CiAgdC51bml2ZXJzYWwgPSAweDIyMDA7CiAgdC51b2dvbmVrID0gMHgwMTczOwogIHQudXBhcmVuID0gMHgyNGIwOwogIHQudXBibG9jayA9IDB4MjU4MDsKICB0LnVwcGVyZG90aGVicmV3ID0gMHgwNWM0OwogIHQudXBzaWxvbiA9IDB4MDNjNTsKICB0LnVwc2lsb25kaWVyZXNpcyA9IDB4MDNjYjsKICB0LnVwc2lsb25kaWVyZXNpc3Rvbm9zID0gMHgwM2IwOwogIHQudXBzaWxvbmxhdGluID0gMHgwMjhhOwogIHQudXBzaWxvbnRvbm9zID0gMHgwM2NkOwogIHQudXB0YWNrYmVsb3djbWIgPSAweDAzMWQ7CiAgdC51cHRhY2ttb2QgPSAweDAyZDQ7CiAgdC51cmFndXJtdWtoaSA9IDB4MGE3MzsKICB0LnVyaW5nID0gMHgwMTZmOwogIHQudXNob3J0Y3lyaWxsaWMgPSAweDA0NWU7CiAgdC51c21hbGxoaXJhZ2FuYSA9IDB4MzA0NTsKICB0LnVzbWFsbGthdGFrYW5hID0gMHgzMGE1OwogIHQudXNtYWxsa2F0YWthbmFoYWxmd2lkdGggPSAweGZmNjk7CiAgdC51c3RyYWlnaHRjeXJpbGxpYyA9IDB4MDRhZjsKICB0LnVzdHJhaWdodHN0cm9rZWN5cmlsbGljID0gMHgwNGIxOwogIHQudXRpbGRlID0gMHgwMTY5OwogIHQudXRpbGRlYWN1dGUgPSAweDFlNzk7CiAgdC51dGlsZGViZWxvdyA9IDB4MWU3NTsKICB0LnV1YmVuZ2FsaSA9IDB4MDk4YTsKICB0LnV1ZGV2YSA9IDB4MDkwYTsKICB0LnV1Z3VqYXJhdGkgPSAweDBhOGE7CiAgdC51dWd1cm11a2hpID0gMHgwYTBhOwogIHQudXVtYXRyYWd1cm11a2hpID0gMHgwYTQyOwogIHQudXV2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMyOwogIHQudXV2b3dlbHNpZ25kZXZhID0gMHgwOTQyOwogIHQudXV2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjMjsKICB0LnV2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMxOwogIHQudXZvd2Vsc2lnbmRldmEgPSAweDA5NDE7CiAgdC51dm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzE7CiAgdC52ID0gMHgwMDc2OwogIHQudmFkZXZhID0gMHgwOTM1OwogIHQudmFndWphcmF0aSA9IDB4MGFiNTsKICB0LnZhZ3VybXVraGkgPSAweDBhMzU7CiAgdC52YWthdGFrYW5hID0gMHgzMGY3OwogIHQudmF2ID0gMHgwNWQ1OwogIHQudmF2ZGFnZXNoID0gMHhmYjM1OwogIHQudmF2ZGFnZXNoNjUgPSAweGZiMzU7CiAgdC52YXZkYWdlc2hoZWJyZXcgPSAweGZiMzU7CiAgdC52YXZoZWJyZXcgPSAweDA1ZDU7CiAgdC52YXZob2xhbSA9IDB4ZmI0YjsKICB0LnZhdmhvbGFtaGVicmV3ID0gMHhmYjRiOwogIHQudmF2dmF2aGVicmV3ID0gMHgwNWYwOwogIHQudmF2eW9kaGVicmV3ID0gMHgwNWYxOwogIHQudmNpcmNsZSA9IDB4MjRlNTsKICB0LnZkb3RiZWxvdyA9IDB4MWU3ZjsKICB0LnZlY3lyaWxsaWMgPSAweDA0MzI7CiAgdC52ZWhhcmFiaWMgPSAweDA2YTQ7CiAgdC52ZWhmaW5hbGFyYWJpYyA9IDB4ZmI2YjsKICB0LnZlaGluaXRpYWxhcmFiaWMgPSAweGZiNmM7CiAgdC52ZWhtZWRpYWxhcmFiaWMgPSAweGZiNmQ7CiAgdC52ZWthdGFrYW5hID0gMHgzMGY5OwogIHQudmVudXMgPSAweDI2NDA7CiAgdC52ZXJ0aWNhbGJhciA9IDB4MDA3YzsKICB0LnZlcnRpY2FsbGluZWFib3ZlY21iID0gMHgwMzBkOwogIHQudmVydGljYWxsaW5lYmVsb3djbWIgPSAweDAzMjk7CiAgdC52ZXJ0aWNhbGxpbmVsb3dtb2QgPSAweDAyY2M7CiAgdC52ZXJ0aWNhbGxpbmVtb2QgPSAweDAyYzg7CiAgdC52ZXdhcm1lbmlhbiA9IDB4MDU3ZTsKICB0LnZob29rID0gMHgwMjhiOwogIHQudmlrYXRha2FuYSA9IDB4MzBmODsKICB0LnZpcmFtYWJlbmdhbGkgPSAweDA5Y2Q7CiAgdC52aXJhbWFkZXZhID0gMHgwOTRkOwogIHQudmlyYW1hZ3VqYXJhdGkgPSAweDBhY2Q7CiAgdC52aXNhcmdhYmVuZ2FsaSA9IDB4MDk4MzsKICB0LnZpc2FyZ2FkZXZhID0gMHgwOTAzOwogIHQudmlzYXJnYWd1amFyYXRpID0gMHgwYTgzOwogIHQudm1vbm9zcGFjZSA9IDB4ZmY1NjsKICB0LnZvYXJtZW5pYW4gPSAweDA1Nzg7CiAgdC52b2ljZWRpdGVyYXRpb25oaXJhZ2FuYSA9IDB4MzA5ZTsKICB0LnZvaWNlZGl0ZXJhdGlvbmthdGFrYW5hID0gMHgzMGZlOwogIHQudm9pY2VkbWFya2thbmEgPSAweDMwOWI7CiAgdC52b2ljZWRtYXJra2FuYWhhbGZ3aWR0aCA9IDB4ZmY5ZTsKICB0LnZva2F0YWthbmEgPSAweDMwZmE7CiAgdC52cGFyZW4gPSAweDI0YjE7CiAgdC52dGlsZGUgPSAweDFlN2Q7CiAgdC52dHVybmVkID0gMHgwMjhjOwogIHQudnVoaXJhZ2FuYSA9IDB4MzA5NDsKICB0LnZ1a2F0YWthbmEgPSAweDMwZjQ7CiAgdC53ID0gMHgwMDc3OwogIHQud2FjdXRlID0gMHgxZTgzOwogIHQud2Fla29yZWFuID0gMHgzMTU5OwogIHQud2FoaXJhZ2FuYSA9IDB4MzA4ZjsKICB0Lndha2F0YWthbmEgPSAweDMwZWY7CiAgdC53YWthdGFrYW5haGFsZndpZHRoID0gMHhmZjljOwogIHQud2Frb3JlYW4gPSAweDMxNTg7CiAgdC53YXNtYWxsaGlyYWdhbmEgPSAweDMwOGU7CiAgdC53YXNtYWxsa2F0YWthbmEgPSAweDMwZWU7CiAgdC53YXR0b3NxdWFyZSA9IDB4MzM1NzsKICB0LndhdmVkYXNoID0gMHgzMDFjOwogIHQud2F2eXVuZGVyc2NvcmV2ZXJ0aWNhbCA9IDB4ZmUzNDsKICB0Lndhd2FyYWJpYyA9IDB4MDY0ODsKICB0Lndhd2ZpbmFsYXJhYmljID0gMHhmZWVlOwogIHQud2F3aGFtemFhYm92ZWFyYWJpYyA9IDB4MDYyNDsKICB0Lndhd2hhbXphYWJvdmVmaW5hbGFyYWJpYyA9IDB4ZmU4NjsKICB0Lndic3F1YXJlID0gMHgzM2RkOwogIHQud2NpcmNsZSA9IDB4MjRlNjsKICB0LndjaXJjdW1mbGV4ID0gMHgwMTc1OwogIHQud2RpZXJlc2lzID0gMHgxZTg1OwogIHQud2RvdGFjY2VudCA9IDB4MWU4NzsKICB0Lndkb3RiZWxvdyA9IDB4MWU4OTsKICB0LndlaGlyYWdhbmEgPSAweDMwOTE7CiAgdC53ZWllcnN0cmFzcyA9IDB4MjExODsKICB0Lndla2F0YWthbmEgPSAweDMwZjE7CiAgdC53ZWtvcmVhbiA9IDB4MzE1ZTsKICB0Lndlb2tvcmVhbiA9IDB4MzE1ZDsKICB0LndncmF2ZSA9IDB4MWU4MTsKICB0LndoaXRlYnVsbGV0ID0gMHgyNWU2OwogIHQud2hpdGVjaXJjbGUgPSAweDI1Y2I7CiAgdC53aGl0ZWNpcmNsZWludmVyc2UgPSAweDI1ZDk7CiAgdC53aGl0ZWNvcm5lcmJyYWNrZXRsZWZ0ID0gMHgzMDBlOwogIHQud2hpdGVjb3JuZXJicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTQzOwogIHQud2hpdGVjb3JuZXJicmFja2V0cmlnaHQgPSAweDMwMGY7CiAgdC53aGl0ZWNvcm5lcmJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTQ0OwogIHQud2hpdGVkaWFtb25kID0gMHgyNWM3OwogIHQud2hpdGVkaWFtb25kY29udGFpbmluZ2JsYWNrc21hbGxkaWFtb25kID0gMHgyNWM4OwogIHQud2hpdGVkb3ducG9pbnRpbmdzbWFsbHRyaWFuZ2xlID0gMHgyNWJmOwogIHQud2hpdGVkb3ducG9pbnRpbmd0cmlhbmdsZSA9IDB4MjViZDsKICB0LndoaXRlbGVmdHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjVjMzsKICB0LndoaXRlbGVmdHBvaW50aW5ndHJpYW5nbGUgPSAweDI1YzE7CiAgdC53aGl0ZWxlbnRpY3VsYXJicmFja2V0bGVmdCA9IDB4MzAxNjsKICB0LndoaXRlbGVudGljdWxhcmJyYWNrZXRyaWdodCA9IDB4MzAxNzsKICB0LndoaXRlcmlnaHRwb2ludGluZ3NtYWxsdHJpYW5nbGUgPSAweDI1Yjk7CiAgdC53aGl0ZXJpZ2h0cG9pbnRpbmd0cmlhbmdsZSA9IDB4MjViNzsKICB0LndoaXRlc21hbGxzcXVhcmUgPSAweDI1YWI7CiAgdC53aGl0ZXNtaWxpbmdmYWNlID0gMHgyNjNhOwogIHQud2hpdGVzcXVhcmUgPSAweDI1YTE7CiAgdC53aGl0ZXN0YXIgPSAweDI2MDY7CiAgdC53aGl0ZXRlbGVwaG9uZSA9IDB4MjYwZjsKICB0LndoaXRldG9ydG9pc2VzaGVsbGJyYWNrZXRsZWZ0ID0gMHgzMDE4OwogIHQud2hpdGV0b3J0b2lzZXNoZWxsYnJhY2tldHJpZ2h0ID0gMHgzMDE5OwogIHQud2hpdGV1cHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjViNTsKICB0LndoaXRldXBwb2ludGluZ3RyaWFuZ2xlID0gMHgyNWIzOwogIHQud2loaXJhZ2FuYSA9IDB4MzA5MDsKICB0Lndpa2F0YWthbmEgPSAweDMwZjA7CiAgdC53aWtvcmVhbiA9IDB4MzE1ZjsKICB0Lndtb25vc3BhY2UgPSAweGZmNTc7CiAgdC53b2hpcmFnYW5hID0gMHgzMDkyOwogIHQud29rYXRha2FuYSA9IDB4MzBmMjsKICB0Lndva2F0YWthbmFoYWxmd2lkdGggPSAweGZmNjY7CiAgdC53b24gPSAweDIwYTk7CiAgdC53b25tb25vc3BhY2UgPSAweGZmZTY7CiAgdC53b3dhZW50aGFpID0gMHgwZTI3OwogIHQud3BhcmVuID0gMHgyNGIyOwogIHQud3JpbmcgPSAweDFlOTg7CiAgdC53c3VwZXJpb3IgPSAweDAyYjc7CiAgdC53dHVybmVkID0gMHgwMjhkOwogIHQud3lubiA9IDB4MDFiZjsKICB0LnggPSAweDAwNzg7CiAgdC54YWJvdmVjbWIgPSAweDAzM2Q7CiAgdC54Ym9wb21vZm8gPSAweDMxMTI7CiAgdC54Y2lyY2xlID0gMHgyNGU3OwogIHQueGRpZXJlc2lzID0gMHgxZThkOwogIHQueGRvdGFjY2VudCA9IDB4MWU4YjsKICB0LnhlaGFybWVuaWFuID0gMHgwNTZkOwogIHQueGkgPSAweDAzYmU7CiAgdC54bW9ub3NwYWNlID0gMHhmZjU4OwogIHQueHBhcmVuID0gMHgyNGIzOwogIHQueHN1cGVyaW9yID0gMHgwMmUzOwogIHQueSA9IDB4MDA3OTsKICB0LnlhYWRvc3F1YXJlID0gMHgzMzRlOwogIHQueWFiZW5nYWxpID0gMHgwOWFmOwogIHQueWFjdXRlID0gMHgwMGZkOwogIHQueWFkZXZhID0gMHgwOTJmOwogIHQueWFla29yZWFuID0gMHgzMTUyOwogIHQueWFndWphcmF0aSA9IDB4MGFhZjsKICB0LnlhZ3VybXVraGkgPSAweDBhMmY7CiAgdC55YWhpcmFnYW5hID0gMHgzMDg0OwogIHQueWFrYXRha2FuYSA9IDB4MzBlNDsKICB0Lnlha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTQ7CiAgdC55YWtvcmVhbiA9IDB4MzE1MTsKICB0LnlhbWFra2FudGhhaSA9IDB4MGU0ZTsKICB0Lnlhc21hbGxoaXJhZ2FuYSA9IDB4MzA4MzsKICB0Lnlhc21hbGxrYXRha2FuYSA9IDB4MzBlMzsKICB0Lnlhc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YzsKICB0LnlhdGN5cmlsbGljID0gMHgwNDYzOwogIHQueWNpcmNsZSA9IDB4MjRlODsKICB0LnljaXJjdW1mbGV4ID0gMHgwMTc3OwogIHQueWRpZXJlc2lzID0gMHgwMGZmOwogIHQueWRvdGFjY2VudCA9IDB4MWU4ZjsKICB0Lnlkb3RiZWxvdyA9IDB4MWVmNTsKICB0LnllaGFyYWJpYyA9IDB4MDY0YTsKICB0LnllaGJhcnJlZWFyYWJpYyA9IDB4MDZkMjsKICB0LnllaGJhcnJlZWZpbmFsYXJhYmljID0gMHhmYmFmOwogIHQueWVoZmluYWxhcmFiaWMgPSAweGZlZjI7CiAgdC55ZWhoYW16YWFib3ZlYXJhYmljID0gMHgwNjI2OwogIHQueWVoaGFtemFhYm92ZWZpbmFsYXJhYmljID0gMHhmZThhOwogIHQueWVoaGFtemFhYm92ZWluaXRpYWxhcmFiaWMgPSAweGZlOGI7CiAgdC55ZWhoYW16YWFib3ZlbWVkaWFsYXJhYmljID0gMHhmZThjOwogIHQueWVoaW5pdGlhbGFyYWJpYyA9IDB4ZmVmMzsKICB0LnllaG1lZGlhbGFyYWJpYyA9IDB4ZmVmNDsKICB0LnllaG1lZW1pbml0aWFsYXJhYmljID0gMHhmY2RkOwogIHQueWVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzU4OwogIHQueWVobm9vbmZpbmFsYXJhYmljID0gMHhmYzk0OwogIHQueWVodGhyZWVkb3RzYmVsb3dhcmFiaWMgPSAweDA2ZDE7CiAgdC55ZWtvcmVhbiA9IDB4MzE1NjsKICB0LnllbiA9IDB4MDBhNTsKICB0Lnllbm1vbm9zcGFjZSA9IDB4ZmZlNTsKICB0Lnllb2tvcmVhbiA9IDB4MzE1NTsKICB0Lnllb3JpbmhpZXVoa29yZWFuID0gMHgzMTg2OwogIHQueWVyYWhiZW55b21vaGVicmV3ID0gMHgwNWFhOwogIHQueWVyYWhiZW55b21vbGVmdGhlYnJldyA9IDB4MDVhYTsKICB0LnllcmljeXJpbGxpYyA9IDB4MDQ0YjsKICB0LnllcnVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY5OwogIHQueWVzaWV1bmdrb3JlYW4gPSAweDMxODE7CiAgdC55ZXNpZXVuZ3BhbnNpb3Nrb3JlYW4gPSAweDMxODM7CiAgdC55ZXNpZXVuZ3Npb3Nrb3JlYW4gPSAweDMxODI7CiAgdC55ZXRpdmhlYnJldyA9IDB4MDU5YTsKICB0LnlncmF2ZSA9IDB4MWVmMzsKICB0Lnlob29rID0gMHgwMWI0OwogIHQueWhvb2thYm92ZSA9IDB4MWVmNzsKICB0LnlpYXJtZW5pYW4gPSAweDA1NzU7CiAgdC55aWN5cmlsbGljID0gMHgwNDU3OwogIHQueWlrb3JlYW4gPSAweDMxNjI7CiAgdC55aW55YW5nID0gMHgyNjJmOwogIHQueWl3bmFybWVuaWFuID0gMHgwNTgyOwogIHQueW1vbm9zcGFjZSA9IDB4ZmY1OTsKICB0LnlvZCA9IDB4MDVkOTsKICB0LnlvZGRhZ2VzaCA9IDB4ZmIzOTsKICB0LnlvZGRhZ2VzaGhlYnJldyA9IDB4ZmIzOTsKICB0LnlvZGhlYnJldyA9IDB4MDVkOTsKICB0LnlvZHlvZGhlYnJldyA9IDB4MDVmMjsKICB0LnlvZHlvZHBhdGFoaGVicmV3ID0gMHhmYjFmOwogIHQueW9oaXJhZ2FuYSA9IDB4MzA4ODsKICB0LnlvaWtvcmVhbiA9IDB4MzE4OTsKICB0Lnlva2F0YWthbmEgPSAweDMwZTg7CiAgdC55b2thdGFrYW5haGFsZndpZHRoID0gMHhmZjk2OwogIHQueW9rb3JlYW4gPSAweDMxNWI7CiAgdC55b3NtYWxsaGlyYWdhbmEgPSAweDMwODc7CiAgdC55b3NtYWxsa2F0YWthbmEgPSAweDMwZTc7CiAgdC55b3NtYWxsa2F0YWthbmFoYWxmd2lkdGggPSAweGZmNmU7CiAgdC55b3RncmVlayA9IDB4MDNmMzsKICB0LnlveWFla29yZWFuID0gMHgzMTg4OwogIHQueW95YWtvcmVhbiA9IDB4MzE4NzsKICB0LnlveWFrdGhhaSA9IDB4MGUyMjsKICB0LnlveWluZ3RoYWkgPSAweDBlMGQ7CiAgdC55cGFyZW4gPSAweDI0YjQ7CiAgdC55cG9nZWdyYW1tZW5pID0gMHgwMzdhOwogIHQueXBvZ2VncmFtbWVuaWdyZWVrY21iID0gMHgwMzQ1OwogIHQueXIgPSAweDAxYTY7CiAgdC55cmluZyA9IDB4MWU5OTsKICB0LnlzdXBlcmlvciA9IDB4MDJiODsKICB0Lnl0aWxkZSA9IDB4MWVmOTsKICB0Lnl0dXJuZWQgPSAweDAyOGU7CiAgdC55dWhpcmFnYW5hID0gMHgzMDg2OwogIHQueXVpa29yZWFuID0gMHgzMThjOwogIHQueXVrYXRha2FuYSA9IDB4MzBlNjsKICB0Lnl1a2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTU7CiAgdC55dWtvcmVhbiA9IDB4MzE2MDsKICB0Lnl1c2JpZ2N5cmlsbGljID0gMHgwNDZiOwogIHQueXVzYmlnaW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2ZDsKICB0Lnl1c2xpdHRsZWN5cmlsbGljID0gMHgwNDY3OwogIHQueXVzbGl0dGxlaW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2OTsKICB0Lnl1c21hbGxoaXJhZ2FuYSA9IDB4MzA4NTsKICB0Lnl1c21hbGxrYXRha2FuYSA9IDB4MzBlNTsKICB0Lnl1c21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2ZDsKICB0Lnl1eWVrb3JlYW4gPSAweDMxOGI7CiAgdC55dXllb2tvcmVhbiA9IDB4MzE4YTsKICB0Lnl5YWJlbmdhbGkgPSAweDA5ZGY7CiAgdC55eWFkZXZhID0gMHgwOTVmOwogIHQueiA9IDB4MDA3YTsKICB0LnphYXJtZW5pYW4gPSAweDA1NjY7CiAgdC56YWN1dGUgPSAweDAxN2E7CiAgdC56YWRldmEgPSAweDA5NWI7CiAgdC56YWd1cm11a2hpID0gMHgwYTViOwogIHQuemFoYXJhYmljID0gMHgwNjM4OwogIHQuemFoZmluYWxhcmFiaWMgPSAweGZlYzY7CiAgdC56YWhpbml0aWFsYXJhYmljID0gMHhmZWM3OwogIHQuemFoaXJhZ2FuYSA9IDB4MzA1NjsKICB0LnphaG1lZGlhbGFyYWJpYyA9IDB4ZmVjODsKICB0LnphaW5hcmFiaWMgPSAweDA2MzI7CiAgdC56YWluZmluYWxhcmFiaWMgPSAweGZlYjA7CiAgdC56YWthdGFrYW5hID0gMHgzMGI2OwogIHQuemFxZWZnYWRvbGhlYnJldyA9IDB4MDU5NTsKICB0LnphcWVmcWF0YW5oZWJyZXcgPSAweDA1OTQ7CiAgdC56YXJxYWhlYnJldyA9IDB4MDU5ODsKICB0LnpheWluID0gMHgwNWQ2OwogIHQuemF5aW5kYWdlc2ggPSAweGZiMzY7CiAgdC56YXlpbmRhZ2VzaGhlYnJldyA9IDB4ZmIzNjsKICB0LnpheWluaGVicmV3ID0gMHgwNWQ2OwogIHQuemJvcG9tb2ZvID0gMHgzMTE3OwogIHQuemNhcm9uID0gMHgwMTdlOwogIHQuemNpcmNsZSA9IDB4MjRlOTsKICB0LnpjaXJjdW1mbGV4ID0gMHgxZTkxOwogIHQuemN1cmwgPSAweDAyOTE7CiAgdC56ZG90ID0gMHgwMTdjOwogIHQuemRvdGFjY2VudCA9IDB4MDE3YzsKICB0Lnpkb3RiZWxvdyA9IDB4MWU5MzsKICB0LnplY3lyaWxsaWMgPSAweDA0Mzc7CiAgdC56ZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNDk5OwogIHQuemVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGRmOwogIHQuemVoaXJhZ2FuYSA9IDB4MzA1YzsKICB0Lnpla2F0YWthbmEgPSAweDMwYmM7CiAgdC56ZXJvID0gMHgwMDMwOwogIHQuemVyb2FyYWJpYyA9IDB4MDY2MDsKICB0Lnplcm9iZW5nYWxpID0gMHgwOWU2OwogIHQuemVyb2RldmEgPSAweDA5NjY7CiAgdC56ZXJvZ3VqYXJhdGkgPSAweDBhZTY7CiAgdC56ZXJvZ3VybXVraGkgPSAweDBhNjY7CiAgdC56ZXJvaGFja2FyYWJpYyA9IDB4MDY2MDsKICB0Lnplcm9pbmZlcmlvciA9IDB4MjA4MDsKICB0Lnplcm9tb25vc3BhY2UgPSAweGZmMTA7CiAgdC56ZXJvb2xkc3R5bGUgPSAweGY3MzA7CiAgdC56ZXJvcGVyc2lhbiA9IDB4MDZmMDsKICB0Lnplcm9zdXBlcmlvciA9IDB4MjA3MDsKICB0Lnplcm90aGFpID0gMHgwZTUwOwogIHQuemVyb3dpZHRoam9pbmVyID0gMHhmZWZmOwogIHQuemVyb3dpZHRobm9uam9pbmVyID0gMHgyMDBjOwogIHQuemVyb3dpZHRoc3BhY2UgPSAweDIwMGI7CiAgdC56ZXRhID0gMHgwM2I2OwogIHQuemhib3BvbW9mbyA9IDB4MzExMzsKICB0LnpoZWFybWVuaWFuID0gMHgwNTZhOwogIHQuemhlYnJldmVjeXJpbGxpYyA9IDB4MDRjMjsKICB0LnpoZWN5cmlsbGljID0gMHgwNDM2OwogIHQuemhlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OTc7CiAgdC56aGVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGRkOwogIHQuemloaXJhZ2FuYSA9IDB4MzA1ODsKICB0Lnppa2F0YWthbmEgPSAweDMwYjg7CiAgdC56aW5vcmhlYnJldyA9IDB4MDVhZTsKICB0LnpsaW5lYmVsb3cgPSAweDFlOTU7CiAgdC56bW9ub3NwYWNlID0gMHhmZjVhOwogIHQuem9oaXJhZ2FuYSA9IDB4MzA1ZTsKICB0Lnpva2F0YWthbmEgPSAweDMwYmU7CiAgdC56cGFyZW4gPSAweDI0YjU7CiAgdC56cmV0cm9mbGV4aG9vayA9IDB4MDI5MDsKICB0LnpzdHJva2UgPSAweDAxYjY7CiAgdC56dWhpcmFnYW5hID0gMHgzMDVhOwogIHQuenVrYXRha2FuYSA9IDB4MzBiYTsKICB0WyIubm90ZGVmIl0gPSAweDAwMDA7CiAgdC5hbmdicmFja2V0bGVmdGJpZyA9IDB4MjMyOTsKICB0LmFuZ2JyYWNrZXRsZWZ0QmlnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldGxlZnRiaWdnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldGxlZnRCaWdnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldHJpZ2h0QmlnID0gMHgyMzJhOwogIHQuYW5nYnJhY2tldHJpZ2h0YmlnID0gMHgyMzJhOwogIHQuYW5nYnJhY2tldHJpZ2h0QmlnZyA9IDB4MjMyYTsKICB0LmFuZ2JyYWNrZXRyaWdodGJpZ2cgPSAweDIzMmE7CiAgdC5hcnJvd2hvb2tsZWZ0ID0gMHgyMWFhOwogIHQuYXJyb3dob29rcmlnaHQgPSAweDIxYTk7CiAgdC5hcnJvd2xlZnR0b3BoYWxmID0gMHgyMWJjOwogIHQuYXJyb3dsZWZ0Ym90aGFsZiA9IDB4MjFiZDsKICB0LmFycm93bm9ydGhlYXN0ID0gMHgyMTk3OwogIHQuYXJyb3dub3J0aHdlc3QgPSAweDIxOTY7CiAgdC5hcnJvd3JpZ2h0dG9waGFsZiA9IDB4MjFjMDsKICB0LmFycm93cmlnaHRib3RoYWxmID0gMHgyMWMxOwogIHQuYXJyb3dzb3V0aGVhc3QgPSAweDIxOTg7CiAgdC5hcnJvd3NvdXRod2VzdCA9IDB4MjE5OTsKICB0LmJhY2tzbGFzaGJpZyA9IDB4MjIxNjsKICB0LmJhY2tzbGFzaEJpZyA9IDB4MjIxNjsKICB0LmJhY2tzbGFzaEJpZ2cgPSAweDIyMTY7CiAgdC5iYWNrc2xhc2hiaWdnID0gMHgyMjE2OwogIHQuYmFyZGJsID0gMHgyMDE2OwogIHQuYnJhY2VodGlwZG93bmxlZnQgPSAweGZlMzc7CiAgdC5icmFjZWh0aXBkb3ducmlnaHQgPSAweGZlMzc7CiAgdC5icmFjZWh0aXB1cGxlZnQgPSAweGZlMzg7CiAgdC5icmFjZWh0aXB1cHJpZ2h0ID0gMHhmZTM4OwogIHQuYnJhY2VsZWZ0QmlnID0gMHgwMDdiOwogIHQuYnJhY2VsZWZ0YmlnID0gMHgwMDdiOwogIHQuYnJhY2VsZWZ0YmlnZyA9IDB4MDA3YjsKICB0LmJyYWNlbGVmdEJpZ2cgPSAweDAwN2I7CiAgdC5icmFjZXJpZ2h0QmlnID0gMHgwMDdkOwogIHQuYnJhY2VyaWdodGJpZyA9IDB4MDA3ZDsKICB0LmJyYWNlcmlnaHRiaWdnID0gMHgwMDdkOwogIHQuYnJhY2VyaWdodEJpZ2cgPSAweDAwN2Q7CiAgdC5icmFja2V0bGVmdGJpZyA9IDB4MDA1YjsKICB0LmJyYWNrZXRsZWZ0QmlnID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRiaWdnID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRCaWdnID0gMHgwMDViOwogIHQuYnJhY2tldHJpZ2h0QmlnID0gMHgwMDVkOwogIHQuYnJhY2tldHJpZ2h0YmlnID0gMHgwMDVkOwogIHQuYnJhY2tldHJpZ2h0YmlnZyA9IDB4MDA1ZDsKICB0LmJyYWNrZXRyaWdodEJpZ2cgPSAweDAwNWQ7CiAgdC5jZWlsaW5nbGVmdGJpZyA9IDB4MjMwODsKICB0LmNlaWxpbmdsZWZ0QmlnID0gMHgyMzA4OwogIHQuY2VpbGluZ2xlZnRCaWdnID0gMHgyMzA4OwogIHQuY2VpbGluZ2xlZnRiaWdnID0gMHgyMzA4OwogIHQuY2VpbGluZ3JpZ2h0YmlnID0gMHgyMzA5OwogIHQuY2VpbGluZ3JpZ2h0QmlnID0gMHgyMzA5OwogIHQuY2VpbGluZ3JpZ2h0YmlnZyA9IDB4MjMwOTsKICB0LmNlaWxpbmdyaWdodEJpZ2cgPSAweDIzMDk7CiAgdC5jaXJjbGVkb3RkaXNwbGF5ID0gMHgyMjk5OwogIHQuY2lyY2xlZG90dGV4dCA9IDB4MjI5OTsKICB0LmNpcmNsZW11bHRpcGx5ZGlzcGxheSA9IDB4MjI5NzsKICB0LmNpcmNsZW11bHRpcGx5dGV4dCA9IDB4MjI5NzsKICB0LmNpcmNsZXBsdXNkaXNwbGF5ID0gMHgyMjk1OwogIHQuY2lyY2xlcGx1c3RleHQgPSAweDIyOTU7CiAgdC5jb250aW50ZWdyYWxkaXNwbGF5ID0gMHgyMjJlOwogIHQuY29udGludGVncmFsdGV4dCA9IDB4MjIyZTsKICB0LmNvcHJvZHVjdGRpc3BsYXkgPSAweDIyMTA7CiAgdC5jb3Byb2R1Y3R0ZXh0ID0gMHgyMjEwOwogIHQuZmxvb3JsZWZ0QmlnID0gMHgyMzBhOwogIHQuZmxvb3JsZWZ0YmlnID0gMHgyMzBhOwogIHQuZmxvb3JsZWZ0YmlnZyA9IDB4MjMwYTsKICB0LmZsb29ybGVmdEJpZ2cgPSAweDIzMGE7CiAgdC5mbG9vcnJpZ2h0YmlnID0gMHgyMzBiOwogIHQuZmxvb3JyaWdodEJpZyA9IDB4MjMwYjsKICB0LmZsb29ycmlnaHRCaWdnID0gMHgyMzBiOwogIHQuZmxvb3JyaWdodGJpZ2cgPSAweDIzMGI7CiAgdC5oYXR3aWRlID0gMHgwMzAyOwogIHQuaGF0d2lkZXIgPSAweDAzMDI7CiAgdC5oYXR3aWRlc3QgPSAweDAzMDI7CiAgdC5pbnRlcmNhbCA9IDB4MWQ0MDsKICB0LmludGVncmFsZGlzcGxheSA9IDB4MjIyYjsKICB0LmludGVncmFsdGV4dCA9IDB4MjIyYjsKICB0LmludGVyc2VjdGlvbmRpc3BsYXkgPSAweDIyYzI7CiAgdC5pbnRlcnNlY3Rpb250ZXh0ID0gMHgyMmMyOwogIHQubG9naWNhbGFuZGRpc3BsYXkgPSAweDIyMjc7CiAgdC5sb2dpY2FsYW5kdGV4dCA9IDB4MjIyNzsKICB0LmxvZ2ljYWxvcmRpc3BsYXkgPSAweDIyMjg7CiAgdC5sb2dpY2Fsb3J0ZXh0ID0gMHgyMjI4OwogIHQucGFyZW5sZWZ0QmlnID0gMHgwMDI4OwogIHQucGFyZW5sZWZ0YmlnID0gMHgwMDI4OwogIHQucGFyZW5sZWZ0QmlnZyA9IDB4MDAyODsKICB0LnBhcmVubGVmdGJpZ2cgPSAweDAwMjg7CiAgdC5wYXJlbnJpZ2h0QmlnID0gMHgwMDI5OwogIHQucGFyZW5yaWdodGJpZyA9IDB4MDAyOTsKICB0LnBhcmVucmlnaHRCaWdnID0gMHgwMDI5OwogIHQucGFyZW5yaWdodGJpZ2cgPSAweDAwMjk7CiAgdC5wcmltZSA9IDB4MjAzMjsKICB0LnByb2R1Y3RkaXNwbGF5ID0gMHgyMjBmOwogIHQucHJvZHVjdHRleHQgPSAweDIyMGY7CiAgdC5yYWRpY2FsYmlnID0gMHgyMjFhOwogIHQucmFkaWNhbEJpZyA9IDB4MjIxYTsKICB0LnJhZGljYWxCaWdnID0gMHgyMjFhOwogIHQucmFkaWNhbGJpZ2cgPSAweDIyMWE7CiAgdC5yYWRpY2FsYnQgPSAweDIyMWE7CiAgdC5yYWRpY2FsdHAgPSAweDIyMWE7CiAgdC5yYWRpY2FsdmVydGV4ID0gMHgyMjFhOwogIHQuc2xhc2hiaWcgPSAweDAwMmY7CiAgdC5zbGFzaEJpZyA9IDB4MDAyZjsKICB0LnNsYXNoQmlnZyA9IDB4MDAyZjsKICB0LnNsYXNoYmlnZyA9IDB4MDAyZjsKICB0LnN1bW1hdGlvbmRpc3BsYXkgPSAweDIyMTE7CiAgdC5zdW1tYXRpb250ZXh0ID0gMHgyMjExOwogIHQudGlsZGV3aWRlID0gMHgwMmRjOwogIHQudGlsZGV3aWRlciA9IDB4MDJkYzsKICB0LnRpbGRld2lkZXN0ID0gMHgwMmRjOwogIHQudW5pb25kaXNwbGF5ID0gMHgyMmMzOwogIHQudW5pb25tdWx0aWRpc3BsYXkgPSAweDIyOGU7CiAgdC51bmlvbm11bHRpdGV4dCA9IDB4MjI4ZTsKICB0LnVuaW9uc3FkaXNwbGF5ID0gMHgyMjk0OwogIHQudW5pb25zcXRleHQgPSAweDIyOTQ7CiAgdC51bmlvbnRleHQgPSAweDIyYzM7CiAgdC52ZXh0ZW5kZG91YmxlID0gMHgyMjI1OwogIHQudmV4dGVuZHNpbmdsZSA9IDB4MjIyMzsKfSk7CmNvbnN0IGdldERpbmdiYXRzR2x5cGhzVW5pY29kZSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuc3BhY2UgPSAweDAwMjA7CiAgdC5hMSA9IDB4MjcwMTsKICB0LmEyID0gMHgyNzAyOwogIHQuYTIwMiA9IDB4MjcwMzsKICB0LmEzID0gMHgyNzA0OwogIHQuYTQgPSAweDI2MGU7CiAgdC5hNSA9IDB4MjcwNjsKICB0LmExMTkgPSAweDI3MDc7CiAgdC5hMTE4ID0gMHgyNzA4OwogIHQuYTExNyA9IDB4MjcwOTsKICB0LmExMSA9IDB4MjYxYjsKICB0LmExMiA9IDB4MjYxZTsKICB0LmExMyA9IDB4MjcwYzsKICB0LmExNCA9IDB4MjcwZDsKICB0LmExNSA9IDB4MjcwZTsKICB0LmExNiA9IDB4MjcwZjsKICB0LmExMDUgPSAweDI3MTA7CiAgdC5hMTcgPSAweDI3MTE7CiAgdC5hMTggPSAweDI3MTI7CiAgdC5hMTkgPSAweDI3MTM7CiAgdC5hMjAgPSAweDI3MTQ7CiAgdC5hMjEgPSAweDI3MTU7CiAgdC5hMjIgPSAweDI3MTY7CiAgdC5hMjMgPSAweDI3MTc7CiAgdC5hMjQgPSAweDI3MTg7CiAgdC5hMjUgPSAweDI3MTk7CiAgdC5hMjYgPSAweDI3MWE7CiAgdC5hMjcgPSAweDI3MWI7CiAgdC5hMjggPSAweDI3MWM7CiAgdC5hNiA9IDB4MjcxZDsKICB0LmE3ID0gMHgyNzFlOwogIHQuYTggPSAweDI3MWY7CiAgdC5hOSA9IDB4MjcyMDsKICB0LmExMCA9IDB4MjcyMTsKICB0LmEyOSA9IDB4MjcyMjsKICB0LmEzMCA9IDB4MjcyMzsKICB0LmEzMSA9IDB4MjcyNDsKICB0LmEzMiA9IDB4MjcyNTsKICB0LmEzMyA9IDB4MjcyNjsKICB0LmEzNCA9IDB4MjcyNzsKICB0LmEzNSA9IDB4MjYwNTsKICB0LmEzNiA9IDB4MjcyOTsKICB0LmEzNyA9IDB4MjcyYTsKICB0LmEzOCA9IDB4MjcyYjsKICB0LmEzOSA9IDB4MjcyYzsKICB0LmE0MCA9IDB4MjcyZDsKICB0LmE0MSA9IDB4MjcyZTsKICB0LmE0MiA9IDB4MjcyZjsKICB0LmE0MyA9IDB4MjczMDsKICB0LmE0NCA9IDB4MjczMTsKICB0LmE0NSA9IDB4MjczMjsKICB0LmE0NiA9IDB4MjczMzsKICB0LmE0NyA9IDB4MjczNDsKICB0LmE0OCA9IDB4MjczNTsKICB0LmE0OSA9IDB4MjczNjsKICB0LmE1MCA9IDB4MjczNzsKICB0LmE1MSA9IDB4MjczODsKICB0LmE1MiA9IDB4MjczOTsKICB0LmE1MyA9IDB4MjczYTsKICB0LmE1NCA9IDB4MjczYjsKICB0LmE1NSA9IDB4MjczYzsKICB0LmE1NiA9IDB4MjczZDsKICB0LmE1NyA9IDB4MjczZTsKICB0LmE1OCA9IDB4MjczZjsKICB0LmE1OSA9IDB4Mjc0MDsKICB0LmE2MCA9IDB4Mjc0MTsKICB0LmE2MSA9IDB4Mjc0MjsKICB0LmE2MiA9IDB4Mjc0MzsKICB0LmE2MyA9IDB4Mjc0NDsKICB0LmE2NCA9IDB4Mjc0NTsKICB0LmE2NSA9IDB4Mjc0NjsKICB0LmE2NiA9IDB4Mjc0NzsKICB0LmE2NyA9IDB4Mjc0ODsKICB0LmE2OCA9IDB4Mjc0OTsKICB0LmE2OSA9IDB4Mjc0YTsKICB0LmE3MCA9IDB4Mjc0YjsKICB0LmE3MSA9IDB4MjVjZjsKICB0LmE3MiA9IDB4Mjc0ZDsKICB0LmE3MyA9IDB4MjVhMDsKICB0LmE3NCA9IDB4Mjc0ZjsKICB0LmEyMDMgPSAweDI3NTA7CiAgdC5hNzUgPSAweDI3NTE7CiAgdC5hMjA0ID0gMHgyNzUyOwogIHQuYTc2ID0gMHgyNWIyOwogIHQuYTc3ID0gMHgyNWJjOwogIHQuYTc4ID0gMHgyNWM2OwogIHQuYTc5ID0gMHgyNzU2OwogIHQuYTgxID0gMHgyNWQ3OwogIHQuYTgyID0gMHgyNzU4OwogIHQuYTgzID0gMHgyNzU5OwogIHQuYTg0ID0gMHgyNzVhOwogIHQuYTk3ID0gMHgyNzViOwogIHQuYTk4ID0gMHgyNzVjOwogIHQuYTk5ID0gMHgyNzVkOwogIHQuYTEwMCA9IDB4Mjc1ZTsKICB0LmExMDEgPSAweDI3NjE7CiAgdC5hMTAyID0gMHgyNzYyOwogIHQuYTEwMyA9IDB4Mjc2MzsKICB0LmExMDQgPSAweDI3NjQ7CiAgdC5hMTA2ID0gMHgyNzY1OwogIHQuYTEwNyA9IDB4Mjc2NjsKICB0LmExMDggPSAweDI3Njc7CiAgdC5hMTEyID0gMHgyNjYzOwogIHQuYTExMSA9IDB4MjY2NjsKICB0LmExMTAgPSAweDI2NjU7CiAgdC5hMTA5ID0gMHgyNjYwOwogIHQuYTEyMCA9IDB4MjQ2MDsKICB0LmExMjEgPSAweDI0NjE7CiAgdC5hMTIyID0gMHgyNDYyOwogIHQuYTEyMyA9IDB4MjQ2MzsKICB0LmExMjQgPSAweDI0NjQ7CiAgdC5hMTI1ID0gMHgyNDY1OwogIHQuYTEyNiA9IDB4MjQ2NjsKICB0LmExMjcgPSAweDI0Njc7CiAgdC5hMTI4ID0gMHgyNDY4OwogIHQuYTEyOSA9IDB4MjQ2OTsKICB0LmExMzAgPSAweDI3NzY7CiAgdC5hMTMxID0gMHgyNzc3OwogIHQuYTEzMiA9IDB4Mjc3ODsKICB0LmExMzMgPSAweDI3Nzk7CiAgdC5hMTM0ID0gMHgyNzdhOwogIHQuYTEzNSA9IDB4Mjc3YjsKICB0LmExMzYgPSAweDI3N2M7CiAgdC5hMTM3ID0gMHgyNzdkOwogIHQuYTEzOCA9IDB4Mjc3ZTsKICB0LmExMzkgPSAweDI3N2Y7CiAgdC5hMTQwID0gMHgyNzgwOwogIHQuYTE0MSA9IDB4Mjc4MTsKICB0LmExNDIgPSAweDI3ODI7CiAgdC5hMTQzID0gMHgyNzgzOwogIHQuYTE0NCA9IDB4Mjc4NDsKICB0LmExNDUgPSAweDI3ODU7CiAgdC5hMTQ2ID0gMHgyNzg2OwogIHQuYTE0NyA9IDB4Mjc4NzsKICB0LmExNDggPSAweDI3ODg7CiAgdC5hMTQ5ID0gMHgyNzg5OwogIHQuYTE1MCA9IDB4Mjc4YTsKICB0LmExNTEgPSAweDI3OGI7CiAgdC5hMTUyID0gMHgyNzhjOwogIHQuYTE1MyA9IDB4Mjc4ZDsKICB0LmExNTQgPSAweDI3OGU7CiAgdC5hMTU1ID0gMHgyNzhmOwogIHQuYTE1NiA9IDB4Mjc5MDsKICB0LmExNTcgPSAweDI3OTE7CiAgdC5hMTU4ID0gMHgyNzkyOwogIHQuYTE1OSA9IDB4Mjc5MzsKICB0LmExNjAgPSAweDI3OTQ7CiAgdC5hMTYxID0gMHgyMTkyOwogIHQuYTE2MyA9IDB4MjE5NDsKICB0LmExNjQgPSAweDIxOTU7CiAgdC5hMTk2ID0gMHgyNzk4OwogIHQuYTE2NSA9IDB4Mjc5OTsKICB0LmExOTIgPSAweDI3OWE7CiAgdC5hMTY2ID0gMHgyNzliOwogIHQuYTE2NyA9IDB4Mjc5YzsKICB0LmExNjggPSAweDI3OWQ7CiAgdC5hMTY5ID0gMHgyNzllOwogIHQuYTE3MCA9IDB4Mjc5ZjsKICB0LmExNzEgPSAweDI3YTA7CiAgdC5hMTcyID0gMHgyN2ExOwogIHQuYTE3MyA9IDB4MjdhMjsKICB0LmExNjIgPSAweDI3YTM7CiAgdC5hMTc0ID0gMHgyN2E0OwogIHQuYTE3NSA9IDB4MjdhNTsKICB0LmExNzYgPSAweDI3YTY7CiAgdC5hMTc3ID0gMHgyN2E3OwogIHQuYTE3OCA9IDB4MjdhODsKICB0LmExNzkgPSAweDI3YTk7CiAgdC5hMTkzID0gMHgyN2FhOwogIHQuYTE4MCA9IDB4MjdhYjsKICB0LmExOTkgPSAweDI3YWM7CiAgdC5hMTgxID0gMHgyN2FkOwogIHQuYTIwMCA9IDB4MjdhZTsKICB0LmExODIgPSAweDI3YWY7CiAgdC5hMjAxID0gMHgyN2IxOwogIHQuYTE4MyA9IDB4MjdiMjsKICB0LmExODQgPSAweDI3YjM7CiAgdC5hMTk3ID0gMHgyN2I0OwogIHQuYTE4NSA9IDB4MjdiNTsKICB0LmExOTQgPSAweDI3YjY7CiAgdC5hMTk4ID0gMHgyN2I3OwogIHQuYTE4NiA9IDB4MjdiODsKICB0LmExOTUgPSAweDI3Yjk7CiAgdC5hMTg3ID0gMHgyN2JhOwogIHQuYTE4OCA9IDB4MjdiYjsKICB0LmExODkgPSAweDI3YmM7CiAgdC5hMTkwID0gMHgyN2JkOwogIHQuYTE5MSA9IDB4MjdiZTsKICB0LmE4OSA9IDB4Mjc2ODsKICB0LmE5MCA9IDB4Mjc2OTsKICB0LmE5MyA9IDB4Mjc2YTsKICB0LmE5NCA9IDB4Mjc2YjsKICB0LmE5MSA9IDB4Mjc2YzsKICB0LmE5MiA9IDB4Mjc2ZDsKICB0LmEyMDUgPSAweDI3NmU7CiAgdC5hODUgPSAweDI3NmY7CiAgdC5hMjA2ID0gMHgyNzcwOwogIHQuYTg2ID0gMHgyNzcxOwogIHQuYTg3ID0gMHgyNzcyOwogIHQuYTg4ID0gMHgyNzczOwogIHQuYTk1ID0gMHgyNzc0OwogIHQuYTk2ID0gMHgyNzc1OwogIHRbIi5ub3RkZWYiXSA9IDB4MDAwMDsKfSk7Cgo7Ly8gLi9zcmMvY29yZS91bmljb2RlLmpzCgpjb25zdCBnZXRTcGVjaWFsUFVBU3ltYm9scyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHRbNjM3MjFdID0gMHgwMGE5OwogIHRbNjMxOTNdID0gMHgwMGE5OwogIHRbNjM3MjBdID0gMHgwMGFlOwogIHRbNjMxOTRdID0gMHgwMGFlOwogIHRbNjM3MjJdID0gMHgyMTIyOwogIHRbNjMxOTVdID0gMHgyMTIyOwogIHRbNjM3MjldID0gMHgyM2E3OwogIHRbNjM3MzBdID0gMHgyM2E4OwogIHRbNjM3MzFdID0gMHgyM2E5OwogIHRbNjM3NDBdID0gMHgyM2FiOwogIHRbNjM3NDFdID0gMHgyM2FjOwogIHRbNjM3NDJdID0gMHgyM2FkOwogIHRbNjM3MjZdID0gMHgyM2ExOwogIHRbNjM3MjddID0gMHgyM2EyOwogIHRbNjM3MjhdID0gMHgyM2EzOwogIHRbNjM3MzddID0gMHgyM2E0OwogIHRbNjM3MzhdID0gMHgyM2E1OwogIHRbNjM3MzldID0gMHgyM2E2OwogIHRbNjM3MjNdID0gMHgyMzliOwogIHRbNjM3MjRdID0gMHgyMzljOwogIHRbNjM3MjVdID0gMHgyMzlkOwogIHRbNjM3MzRdID0gMHgyMzllOwogIHRbNjM3MzVdID0gMHgyMzlmOwogIHRbNjM3MzZdID0gMHgyM2EwOwp9KTsKZnVuY3Rpb24gbWFwU3BlY2lhbFVuaWNvZGVWYWx1ZXMoY29kZSkgewogIGlmIChjb2RlID49IDB4ZmZmMCAmJiBjb2RlIDw9IDB4ZmZmZikgewogICAgcmV0dXJuIDA7CiAgfSBlbHNlIGlmIChjb2RlID49IDB4ZjYwMCAmJiBjb2RlIDw9IDB4ZjhmZikgewogICAgcmV0dXJuIGdldFNwZWNpYWxQVUFTeW1ib2xzKClbY29kZV0gfHwgY29kZTsKICB9IGVsc2UgaWYgKGNvZGUgPT09IDB4MDBhZCkgewogICAgcmV0dXJuIDB4MDAyZDsKICB9CiAgcmV0dXJuIGNvZGU7Cn0KZnVuY3Rpb24gZ2V0VW5pY29kZUZvckdseXBoKG5hbWUsIGdseXBoc1VuaWNvZGVNYXApIHsKICBsZXQgdW5pY29kZSA9IGdseXBoc1VuaWNvZGVNYXBbbmFtZV07CiAgaWYgKHVuaWNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIHVuaWNvZGU7CiAgfQogIGlmICghbmFtZSkgewogICAgcmV0dXJuIC0xOwogIH0KICBpZiAobmFtZVswXSA9PT0gInUiKSB7CiAgICBjb25zdCBuYW1lTGVuID0gbmFtZS5sZW5ndGg7CiAgICBsZXQgaGV4U3RyOwogICAgaWYgKG5hbWVMZW4gPT09IDcgJiYgbmFtZVsxXSA9PT0gIm4iICYmIG5hbWVbMl0gPT09ICJpIikgewogICAgICBoZXhTdHIgPSBuYW1lLnN1YnN0cmluZygzKTsKICAgIH0gZWxzZSBpZiAobmFtZUxlbiA+PSA1ICYmIG5hbWVMZW4gPD0gNykgewogICAgICBoZXhTdHIgPSBuYW1lLnN1YnN0cmluZygxKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIGlmIChoZXhTdHIgPT09IGhleFN0ci50b1VwcGVyQ2FzZSgpKSB7CiAgICAgIHVuaWNvZGUgPSBwYXJzZUludChoZXhTdHIsIDE2KTsKICAgICAgaWYgKHVuaWNvZGUgPj0gMCkgewogICAgICAgIHJldHVybiB1bmljb2RlOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiAtMTsKfQpjb25zdCBVbmljb2RlUmFuZ2VzID0gW1sweDAwMDAsIDB4MDA3Zl0sIFsweDAwODAsIDB4MDBmZl0sIFsweDAxMDAsIDB4MDE3Zl0sIFsweDAxODAsIDB4MDI0Zl0sIFsweDAyNTAsIDB4MDJhZiwgMHgxZDAwLCAweDFkN2YsIDB4MWQ4MCwgMHgxZGJmXSwgWzB4MDJiMCwgMHgwMmZmLCAweGE3MDAsIDB4YTcxZl0sIFsweDAzMDAsIDB4MDM2ZiwgMHgxZGMwLCAweDFkZmZdLCBbMHgwMzcwLCAweDAzZmZdLCBbMHgyYzgwLCAweDJjZmZdLCBbMHgwNDAwLCAweDA0ZmYsIDB4MDUwMCwgMHgwNTJmLCAweDJkZTAsIDB4MmRmZiwgMHhhNjQwLCAweGE2OWZdLCBbMHgwNTMwLCAweDA1OGZdLCBbMHgwNTkwLCAweDA1ZmZdLCBbMHhhNTAwLCAweGE2M2ZdLCBbMHgwNjAwLCAweDA2ZmYsIDB4MDc1MCwgMHgwNzdmXSwgWzB4MDdjMCwgMHgwN2ZmXSwgWzB4MDkwMCwgMHgwOTdmXSwgWzB4MDk4MCwgMHgwOWZmXSwgWzB4MGEwMCwgMHgwYTdmXSwgWzB4MGE4MCwgMHgwYWZmXSwgWzB4MGIwMCwgMHgwYjdmXSwgWzB4MGI4MCwgMHgwYmZmXSwgWzB4MGMwMCwgMHgwYzdmXSwgWzB4MGM4MCwgMHgwY2ZmXSwgWzB4MGQwMCwgMHgwZDdmXSwgWzB4MGUwMCwgMHgwZTdmXSwgWzB4MGU4MCwgMHgwZWZmXSwgWzB4MTBhMCwgMHgxMGZmLCAweDJkMDAsIDB4MmQyZl0sIFsweDFiMDAsIDB4MWI3Zl0sIFsweDExMDAsIDB4MTFmZl0sIFsweDFlMDAsIDB4MWVmZiwgMHgyYzYwLCAweDJjN2YsIDB4YTcyMCwgMHhhN2ZmXSwgWzB4MWYwMCwgMHgxZmZmXSwgWzB4MjAwMCwgMHgyMDZmLCAweDJlMDAsIDB4MmU3Zl0sIFsweDIwNzAsIDB4MjA5Zl0sIFsweDIwYTAsIDB4MjBjZl0sIFsweDIwZDAsIDB4MjBmZl0sIFsweDIxMDAsIDB4MjE0Zl0sIFsweDIxNTAsIDB4MjE4Zl0sIFsweDIxOTAsIDB4MjFmZiwgMHgyN2YwLCAweDI3ZmYsIDB4MjkwMCwgMHgyOTdmLCAweDJiMDAsIDB4MmJmZl0sIFsweDIyMDAsIDB4MjJmZiwgMHgyYTAwLCAweDJhZmYsIDB4MjdjMCwgMHgyN2VmLCAweDI5ODAsIDB4MjlmZl0sIFsweDIzMDAsIDB4MjNmZl0sIFsweDI0MDAsIDB4MjQzZl0sIFsweDI0NDAsIDB4MjQ1Zl0sIFsweDI0NjAsIDB4MjRmZl0sIFsweDI1MDAsIDB4MjU3Zl0sIFsweDI1ODAsIDB4MjU5Zl0sIFsweDI1YTAsIDB4MjVmZl0sIFsweDI2MDAsIDB4MjZmZl0sIFsweDI3MDAsIDB4MjdiZl0sIFsweDMwMDAsIDB4MzAzZl0sIFsweDMwNDAsIDB4MzA5Zl0sIFsweDMwYTAsIDB4MzBmZiwgMHgzMWYwLCAweDMxZmZdLCBbMHgzMTAwLCAweDMxMmYsIDB4MzFhMCwgMHgzMWJmXSwgWzB4MzEzMCwgMHgzMThmXSwgWzB4YTg0MCwgMHhhODdmXSwgWzB4MzIwMCwgMHgzMmZmXSwgWzB4MzMwMCwgMHgzM2ZmXSwgWzB4YWMwMCwgMHhkN2FmXSwgWzB4ZDgwMCwgMHhkZmZmXSwgWzB4MTA5MDAsIDB4MTA5MWZdLCBbMHg0ZTAwLCAweDlmZmYsIDB4MmU4MCwgMHgyZWZmLCAweDJmMDAsIDB4MmZkZiwgMHgyZmYwLCAweDJmZmYsIDB4MzQwMCwgMHg0ZGJmLCAweDIwMDAwLCAweDJhNmRmLCAweDMxOTAsIDB4MzE5Zl0sIFsweGUwMDAsIDB4ZjhmZl0sIFsweDMxYzAsIDB4MzFlZiwgMHhmOTAwLCAweGZhZmYsIDB4MmY4MDAsIDB4MmZhMWZdLCBbMHhmYjAwLCAweGZiNGZdLCBbMHhmYjUwLCAweGZkZmZdLCBbMHhmZTIwLCAweGZlMmZdLCBbMHhmZTEwLCAweGZlMWZdLCBbMHhmZTUwLCAweGZlNmZdLCBbMHhmZTcwLCAweGZlZmZdLCBbMHhmZjAwLCAweGZmZWZdLCBbMHhmZmYwLCAweGZmZmZdLCBbMHgwZjAwLCAweDBmZmZdLCBbMHgwNzAwLCAweDA3NGZdLCBbMHgwNzgwLCAweDA3YmZdLCBbMHgwZDgwLCAweDBkZmZdLCBbMHgxMDAwLCAweDEwOWZdLCBbMHgxMjAwLCAweDEzN2YsIDB4MTM4MCwgMHgxMzlmLCAweDJkODAsIDB4MmRkZl0sIFsweDEzYTAsIDB4MTNmZl0sIFsweDE0MDAsIDB4MTY3Zl0sIFsweDE2ODAsIDB4MTY5Zl0sIFsweDE2YTAsIDB4MTZmZl0sIFsweDE3ODAsIDB4MTdmZl0sIFsweDE4MDAsIDB4MThhZl0sIFsweDI4MDAsIDB4MjhmZl0sIFsweGEwMDAsIDB4YTQ4Zl0sIFsweDE3MDAsIDB4MTcxZiwgMHgxNzIwLCAweDE3M2YsIDB4MTc0MCwgMHgxNzVmLCAweDE3NjAsIDB4MTc3Zl0sIFsweDEwMzAwLCAweDEwMzJmXSwgWzB4MTAzMzAsIDB4MTAzNGZdLCBbMHgxMDQwMCwgMHgxMDQ0Zl0sIFsweDFkMDAwLCAweDFkMGZmLCAweDFkMTAwLCAweDFkMWZmLCAweDFkMjAwLCAweDFkMjRmXSwgWzB4MWQ0MDAsIDB4MWQ3ZmZdLCBbMHhmZjAwMCwgMHhmZmZmZF0sIFsweGZlMDAsIDB4ZmUwZiwgMHhlMDEwMCwgMHhlMDFlZl0sIFsweGUwMDAwLCAweGUwMDdmXSwgWzB4MTkwMCwgMHgxOTRmXSwgWzB4MTk1MCwgMHgxOTdmXSwgWzB4MTk4MCwgMHgxOWRmXSwgWzB4MWEwMCwgMHgxYTFmXSwgWzB4MmMwMCwgMHgyYzVmXSwgWzB4MmQzMCwgMHgyZDdmXSwgWzB4NGRjMCwgMHg0ZGZmXSwgWzB4YTgwMCwgMHhhODJmXSwgWzB4MTAwMDAsIDB4MTAwN2YsIDB4MTAwODAsIDB4MTAwZmYsIDB4MTAxMDAsIDB4MTAxM2ZdLCBbMHgxMDE0MCwgMHgxMDE4Zl0sIFsweDEwMzgwLCAweDEwMzlmXSwgWzB4MTAzYTAsIDB4MTAzZGZdLCBbMHgxMDQ1MCwgMHgxMDQ3Zl0sIFsweDEwNDgwLCAweDEwNGFmXSwgWzB4MTA4MDAsIDB4MTA4M2ZdLCBbMHgxMGEwMCwgMHgxMGE1Zl0sIFsweDFkMzAwLCAweDFkMzVmXSwgWzB4MTIwMDAsIDB4MTIzZmYsIDB4MTI0MDAsIDB4MTI0N2ZdLCBbMHgxZDM2MCwgMHgxZDM3Zl0sIFsweDFiODAsIDB4MWJiZl0sIFsweDFjMDAsIDB4MWM0Zl0sIFsweDFjNTAsIDB4MWM3Zl0sIFsweGE4ODAsIDB4YThkZl0sIFsweGE5MDAsIDB4YTkyZl0sIFsweGE5MzAsIDB4YTk1Zl0sIFsweGFhMDAsIDB4YWE1Zl0sIFsweDEwMTkwLCAweDEwMWNmXSwgWzB4MTAxZDAsIDB4MTAxZmZdLCBbMHgxMDJhMCwgMHgxMDJkZiwgMHgxMDI4MCwgMHgxMDI5ZiwgMHgxMDkyMCwgMHgxMDkzZl0sIFsweDFmMDMwLCAweDFmMDlmLCAweDFmMDAwLCAweDFmMDJmXV07CmZ1bmN0aW9uIGdldFVuaWNvZGVSYW5nZUZvcih2YWx1ZSwgbGFzdFBvc2l0aW9uID0gLTEpIHsKICBpZiAobGFzdFBvc2l0aW9uICE9PSAtMSkgewogICAgY29uc3QgcmFuZ2UgPSBVbmljb2RlUmFuZ2VzW2xhc3RQb3NpdGlvbl07CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSByYW5nZS5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIGlmICh2YWx1ZSA+PSByYW5nZVtpXSAmJiB2YWx1ZSA8PSByYW5nZVtpICsgMV0pIHsKICAgICAgICByZXR1cm4gbGFzdFBvc2l0aW9uOwogICAgICB9CiAgICB9CiAgfQogIGZvciAobGV0IGkgPSAwLCBpaSA9IFVuaWNvZGVSYW5nZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgcmFuZ2UgPSBVbmljb2RlUmFuZ2VzW2ldOwogICAgZm9yIChsZXQgaiA9IDAsIGpqID0gcmFuZ2UubGVuZ3RoOyBqIDwgamo7IGogKz0gMikgewogICAgICBpZiAodmFsdWUgPj0gcmFuZ2Vbal0gJiYgdmFsdWUgPD0gcmFuZ2VbaiArIDFdKSB7CiAgICAgICAgcmV0dXJuIGk7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIC0xOwp9CmNvbnN0IFNwZWNpYWxDaGFyUmVnRXhwID0gbmV3IFJlZ0V4cCgiXihcXHMpfChcXHB7TW59KXwoXFxwe0NmfSkkIiwgInUiKTsKY29uc3QgQ2F0ZWdvcnlDYWNoZSA9IG5ldyBNYXAoKTsKZnVuY3Rpb24gZ2V0Q2hhclVuaWNvZGVDYXRlZ29yeShjaGFyKSB7CiAgY29uc3QgY2FjaGVkQ2F0ZWdvcnkgPSBDYXRlZ29yeUNhY2hlLmdldChjaGFyKTsKICBpZiAoY2FjaGVkQ2F0ZWdvcnkpIHsKICAgIHJldHVybiBjYWNoZWRDYXRlZ29yeTsKICB9CiAgY29uc3QgZ3JvdXBzID0gY2hhci5tYXRjaChTcGVjaWFsQ2hhclJlZ0V4cCk7CiAgY29uc3QgY2F0ZWdvcnkgPSB7CiAgICBpc1doaXRlc3BhY2U6ICEhZ3JvdXBzPy5bMV0sCiAgICBpc1plcm9XaWR0aERpYWNyaXRpYzogISFncm91cHM/LlsyXSwKICAgIGlzSW52aXNpYmxlRm9ybWF0TWFyazogISFncm91cHM/LlszXQogIH07CiAgQ2F0ZWdvcnlDYWNoZS5zZXQoY2hhciwgY2F0ZWdvcnkpOwogIHJldHVybiBjYXRlZ29yeTsKfQpmdW5jdGlvbiBjbGVhclVuaWNvZGVDYWNoZXMoKSB7CiAgQ2F0ZWdvcnlDYWNoZS5jbGVhcigpOwp9Cgo7Ly8gLi9zcmMvY29yZS9mb250c191dGlscy5qcwoKCgoKCmNvbnN0IFNFQUNfQU5BTFlTSVNfRU5BQkxFRCA9IHRydWU7CmNvbnN0IEZvbnRGbGFncyA9IHsKICBGaXhlZFBpdGNoOiAxLAogIFNlcmlmOiAyLAogIFN5bWJvbGljOiA0LAogIFNjcmlwdDogOCwKICBOb25zeW1ib2xpYzogMzIsCiAgSXRhbGljOiA2NCwKICBBbGxDYXA6IDY1NTM2LAogIFNtYWxsQ2FwOiAxMzEwNzIsCiAgRm9yY2VCb2xkOiAyNjIxNDQKfTsKY29uc3QgTWFjU3RhbmRhcmRHbHlwaE9yZGVyaW5nID0gWyIubm90ZGVmIiwgIi5udWxsIiwgIm5vbm1hcmtpbmdyZXR1cm4iLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3Rlc2luZ2xlIiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJncmF2ZSIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiQWRpZXJlc2lzIiwgIkFyaW5nIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJOdGlsZGUiLCAiT2RpZXJlc2lzIiwgIlVkaWVyZXNpcyIsICJhYWN1dGUiLCAiYWdyYXZlIiwgImFjaXJjdW1mbGV4IiwgImFkaWVyZXNpcyIsICJhdGlsZGUiLCAiYXJpbmciLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVncmF2ZSIsICJlY2lyY3VtZmxleCIsICJlZGllcmVzaXMiLCAiaWFjdXRlIiwgImlncmF2ZSIsICJpY2lyY3VtZmxleCIsICJpZGllcmVzaXMiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvZ3JhdmUiLCAib2NpcmN1bWZsZXgiLCAib2RpZXJlc2lzIiwgIm90aWxkZSIsICJ1YWN1dGUiLCAidWdyYXZlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJkYWdnZXIiLCAiZGVncmVlIiwgImNlbnQiLCAic3RlcmxpbmciLCAic2VjdGlvbiIsICJidWxsZXQiLCAicGFyYWdyYXBoIiwgImdlcm1hbmRibHMiLCAicmVnaXN0ZXJlZCIsICJjb3B5cmlnaHQiLCAidHJhZGVtYXJrIiwgImFjdXRlIiwgImRpZXJlc2lzIiwgIm5vdGVxdWFsIiwgIkFFIiwgIk9zbGFzaCIsICJpbmZpbml0eSIsICJwbHVzbWludXMiLCAibGVzc2VxdWFsIiwgImdyZWF0ZXJlcXVhbCIsICJ5ZW4iLCAibXUiLCAicGFydGlhbGRpZmYiLCAic3VtbWF0aW9uIiwgInByb2R1Y3QiLCAicGkiLCAiaW50ZWdyYWwiLCAib3JkZmVtaW5pbmUiLCAib3JkbWFzY3VsaW5lIiwgIk9tZWdhIiwgImFlIiwgIm9zbGFzaCIsICJxdWVzdGlvbmRvd24iLCAiZXhjbGFtZG93biIsICJsb2dpY2Fsbm90IiwgInJhZGljYWwiLCAiZmxvcmluIiwgImFwcHJveGVxdWFsIiwgIkRlbHRhIiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAibm9uYnJlYWtpbmdzcGFjZSIsICJBZ3JhdmUiLCAiQXRpbGRlIiwgIk90aWxkZSIsICJPRSIsICJvZSIsICJlbmRhc2giLCAiZW1kYXNoIiwgInF1b3RlZGJsbGVmdCIsICJxdW90ZWRibHJpZ2h0IiwgInF1b3RlbGVmdCIsICJxdW90ZXJpZ2h0IiwgImRpdmlkZSIsICJsb3plbmdlIiwgInlkaWVyZXNpcyIsICJZZGllcmVzaXMiLCAiZnJhY3Rpb24iLCAiY3VycmVuY3kiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJkYWdnZXJkYmwiLCAicGVyaW9kY2VudGVyZWQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInBlcnRob3VzYW5kIiwgIkFjaXJjdW1mbGV4IiwgIkVjaXJjdW1mbGV4IiwgIkFhY3V0ZSIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk9hY3V0ZSIsICJPY2lyY3VtZmxleCIsICJhcHBsZSIsICJPZ3JhdmUiLCAiVWFjdXRlIiwgIlVjaXJjdW1mbGV4IiwgIlVncmF2ZSIsICJkb3RsZXNzaSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiTHNsYXNoIiwgImxzbGFzaCIsICJTY2Fyb24iLCAic2Nhcm9uIiwgIlpjYXJvbiIsICJ6Y2Fyb24iLCAiYnJva2VuYmFyIiwgIkV0aCIsICJldGgiLCAiWWFjdXRlIiwgInlhY3V0ZSIsICJUaG9ybiIsICJ0aG9ybiIsICJtaW51cyIsICJtdWx0aXBseSIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgIm9uZWhhbGYiLCAib25lcXVhcnRlciIsICJ0aHJlZXF1YXJ0ZXJzIiwgImZyYW5jIiwgIkdicmV2ZSIsICJnYnJldmUiLCAiSWRvdGFjY2VudCIsICJTY2VkaWxsYSIsICJzY2VkaWxsYSIsICJDYWN1dGUiLCAiY2FjdXRlIiwgIkNjYXJvbiIsICJjY2Fyb24iLCAiZGNyb2F0Il07CmZ1bmN0aW9uIHJlY292ZXJHbHlwaE5hbWUobmFtZSwgZ2x5cGhzVW5pY29kZU1hcCkgewogIGlmIChnbHlwaHNVbmljb2RlTWFwW25hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiBuYW1lOwogIH0KICBjb25zdCB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKG5hbWUsIGdseXBoc1VuaWNvZGVNYXApOwogIGlmICh1bmljb2RlICE9PSAtMSkgewogICAgZm9yIChjb25zdCBrZXkgaW4gZ2x5cGhzVW5pY29kZU1hcCkgewogICAgICBpZiAoZ2x5cGhzVW5pY29kZU1hcFtrZXldID09PSB1bmljb2RlKSB7CiAgICAgICAgcmV0dXJuIGtleTsKICAgICAgfQogICAgfQogIH0KICBpbmZvKCJVbmFibGUgdG8gcmVjb3ZlciBhIHN0YW5kYXJkIGdseXBoIG5hbWUgZm9yOiAiICsgbmFtZSk7CiAgcmV0dXJuIG5hbWU7Cn0KZnVuY3Rpb24gdHlwZTFGb250R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMsIGJ1aWx0SW5FbmNvZGluZywgZ2x5cGhOYW1lcykgewogIGNvbnN0IGNoYXJDb2RlVG9HbHlwaElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBsZXQgZ2x5cGhJZCwgY2hhckNvZGUsIGJhc2VFbmNvZGluZzsKICBjb25zdCBpc1N5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU3ltYm9saWMpOwogIGlmIChwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250KSB7CiAgICBiYXNlRW5jb2RpbmcgPSBidWlsdEluRW5jb2Rpbmc7CiAgICBmb3IgKGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCBiYXNlRW5jb2RpbmcubGVuZ3RoOyBjaGFyQ29kZSsrKSB7CiAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoYmFzZUVuY29kaW5nW2NoYXJDb2RlXSk7CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgPj0gMCA/IGdseXBoSWQgOiAwOwogICAgfQogIH0gZWxzZSBpZiAocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lKSB7CiAgICBiYXNlRW5jb2RpbmcgPSBnZXRFbmNvZGluZyhwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUpOwogICAgZm9yIChjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgYmFzZUVuY29kaW5nLmxlbmd0aDsgY2hhckNvZGUrKykgewogICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKGJhc2VFbmNvZGluZ1tjaGFyQ29kZV0pOwogICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkID49IDAgPyBnbHlwaElkIDogMDsKICAgIH0KICB9IGVsc2UgaWYgKGlzU3ltYm9saWNGb250KSB7CiAgICBmb3IgKGNoYXJDb2RlIGluIGJ1aWx0SW5FbmNvZGluZykgewogICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBidWlsdEluRW5jb2RpbmdbY2hhckNvZGVdOwogICAgfQogIH0gZWxzZSB7CiAgICBiYXNlRW5jb2RpbmcgPSBTdGFuZGFyZEVuY29kaW5nOwogICAgZm9yIChjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgYmFzZUVuY29kaW5nLmxlbmd0aDsgY2hhckNvZGUrKykgewogICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKGJhc2VFbmNvZGluZ1tjaGFyQ29kZV0pOwogICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkID49IDAgPyBnbHlwaElkIDogMDsKICAgIH0KICB9CiAgY29uc3QgZGlmZmVyZW5jZXMgPSBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzOwogIGxldCBnbHlwaHNVbmljb2RlTWFwOwogIGlmIChkaWZmZXJlbmNlcykgewogICAgZm9yIChjaGFyQ29kZSBpbiBkaWZmZXJlbmNlcykgewogICAgICBjb25zdCBnbHlwaE5hbWUgPSBkaWZmZXJlbmNlc1tjaGFyQ29kZV07CiAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoZ2x5cGhOYW1lKTsKICAgICAgaWYgKGdseXBoSWQgPT09IC0xKSB7CiAgICAgICAgaWYgKCFnbHlwaHNVbmljb2RlTWFwKSB7CiAgICAgICAgICBnbHlwaHNVbmljb2RlTWFwID0gZ2V0R2x5cGhzVW5pY29kZSgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBzdGFuZGFyZEdseXBoTmFtZSA9IHJlY292ZXJHbHlwaE5hbWUoZ2x5cGhOYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgICAgICBpZiAoc3RhbmRhcmRHbHlwaE5hbWUgIT09IGdseXBoTmFtZSkgewogICAgICAgICAgZ2x5cGhJZCA9IGdseXBoTmFtZXMuaW5kZXhPZihzdGFuZGFyZEdseXBoTmFtZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgPj0gMCA/IGdseXBoSWQgOiAwOwogICAgfQogIH0KICByZXR1cm4gY2hhckNvZGVUb0dseXBoSWQ7Cn0KZnVuY3Rpb24gbm9ybWFsaXplRm9udE5hbWUobmFtZSkgewogIHJldHVybiBuYW1lLnJlcGxhY2VBbGwoL1ssX10vZywgIi0iKS5yZXBsYWNlQWxsKC9ccy9nLCAiIik7Cn0KY29uc3QgZ2V0VmVydGljYWxQcmVzZW50YXRpb25Gb3JtID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KHQgPT4gewogIHRbMHgyMDEzXSA9IDB4ZmUzMjsKICB0WzB4MjAxNF0gPSAweGZlMzE7CiAgdFsweDIwMjVdID0gMHhmZTMwOwogIHRbMHgyMDI2XSA9IDB4ZmUxOTsKICB0WzB4MzAwMV0gPSAweGZlMTE7CiAgdFsweDMwMDJdID0gMHhmZTEyOwogIHRbMHgzMDA4XSA9IDB4ZmUzZjsKICB0WzB4MzAwOV0gPSAweGZlNDA7CiAgdFsweDMwMGFdID0gMHhmZTNkOwogIHRbMHgzMDBiXSA9IDB4ZmUzZTsKICB0WzB4MzAwY10gPSAweGZlNDE7CiAgdFsweDMwMGRdID0gMHhmZTQyOwogIHRbMHgzMDBlXSA9IDB4ZmU0MzsKICB0WzB4MzAwZl0gPSAweGZlNDQ7CiAgdFsweDMwMTBdID0gMHhmZTNiOwogIHRbMHgzMDExXSA9IDB4ZmUzYzsKICB0WzB4MzAxNF0gPSAweGZlMzk7CiAgdFsweDMwMTVdID0gMHhmZTNhOwogIHRbMHgzMDE2XSA9IDB4ZmUxNzsKICB0WzB4MzAxN10gPSAweGZlMTg7CiAgdFsweGZlNGZdID0gMHhmZTM0OwogIHRbMHhmZjAxXSA9IDB4ZmUxNTsKICB0WzB4ZmYwOF0gPSAweGZlMzU7CiAgdFsweGZmMDldID0gMHhmZTM2OwogIHRbMHhmZjBjXSA9IDB4ZmUxMDsKICB0WzB4ZmYxYV0gPSAweGZlMTM7CiAgdFsweGZmMWJdID0gMHhmZTE0OwogIHRbMHhmZjFmXSA9IDB4ZmUxNjsKICB0WzB4ZmYzYl0gPSAweGZlNDc7CiAgdFsweGZmM2RdID0gMHhmZTQ4OwogIHRbMHhmZjNmXSA9IDB4ZmUzMzsKICB0WzB4ZmY1Yl0gPSAweGZlMzc7CiAgdFsweGZmNWRdID0gMHhmZTM4Owp9KTsKY29uc3QgTUFYX1NJWkVfVE9fQ09NUElMRSA9IDEwMDA7CmZ1bmN0aW9uIGNvbXBpbGVUeXBlM0dseXBoKHsKICBkYXRhOiBpbWcsCiAgd2lkdGgsCiAgaGVpZ2h0Cn0pIHsKICBpZiAod2lkdGggPiBNQVhfU0laRV9UT19DT01QSUxFIHx8IGhlaWdodCA+IE1BWF9TSVpFX1RPX0NPTVBJTEUpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBQT0lOVF9UT19QUk9DRVNTX0xJTUlUID0gMTAwMDsKICBjb25zdCBQT0lOVF9UWVBFUyA9IG5ldyBVaW50OEFycmF5KFswLCAyLCA0LCAwLCAxLCAwLCA1LCA0LCA4LCAxMCwgMCwgOCwgMCwgMiwgMSwgMF0pOwogIGNvbnN0IHdpZHRoMSA9IHdpZHRoICsgMTsKICBjb25zdCBwb2ludHMgPSBuZXcgVWludDhBcnJheSh3aWR0aDEgKiAoaGVpZ2h0ICsgMSkpOwogIGxldCBpLCBqLCBqMDsKICBjb25zdCBsaW5lU2l6ZSA9IHdpZHRoICsgNyAmIH43OwogIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShsaW5lU2l6ZSAqIGhlaWdodCk7CiAgbGV0IHBvcyA9IDA7CiAgZm9yIChjb25zdCBlbGVtIG9mIGltZykgewogICAgbGV0IG1hc2sgPSAxMjg7CiAgICB3aGlsZSAobWFzayA+IDApIHsKICAgICAgZGF0YVtwb3MrK10gPSBlbGVtICYgbWFzayA/IDAgOiAyNTU7CiAgICAgIG1hc2sgPj49IDE7CiAgICB9CiAgfQogIGxldCBjb3VudCA9IDA7CiAgcG9zID0gMDsKICBpZiAoZGF0YVtwb3NdICE9PSAwKSB7CiAgICBwb2ludHNbMF0gPSAxOwogICAgKytjb3VudDsKICB9CiAgZm9yIChqID0gMTsgaiA8IHdpZHRoOyBqKyspIHsKICAgIGlmIChkYXRhW3Bvc10gIT09IGRhdGFbcG9zICsgMV0pIHsKICAgICAgcG9pbnRzW2pdID0gZGF0YVtwb3NdID8gMiA6IDE7CiAgICAgICsrY291bnQ7CiAgICB9CiAgICBwb3MrKzsKICB9CiAgaWYgKGRhdGFbcG9zXSAhPT0gMCkgewogICAgcG9pbnRzW2pdID0gMjsKICAgICsrY291bnQ7CiAgfQogIGZvciAoaSA9IDE7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgcG9zID0gaSAqIGxpbmVTaXplOwogICAgajAgPSBpICogd2lkdGgxOwogICAgaWYgKGRhdGFbcG9zIC0gbGluZVNpemVdICE9PSBkYXRhW3Bvc10pIHsKICAgICAgcG9pbnRzW2owXSA9IGRhdGFbcG9zXSA/IDEgOiA4OwogICAgICArK2NvdW50OwogICAgfQogICAgbGV0IHN1bSA9IChkYXRhW3Bvc10gPyA0IDogMCkgKyAoZGF0YVtwb3MgLSBsaW5lU2l6ZV0gPyA4IDogMCk7CiAgICBmb3IgKGogPSAxOyBqIDwgd2lkdGg7IGorKykgewogICAgICBzdW0gPSAoc3VtID4+IDIpICsgKGRhdGFbcG9zICsgMV0gPyA0IDogMCkgKyAoZGF0YVtwb3MgLSBsaW5lU2l6ZSArIDFdID8gOCA6IDApOwogICAgICBpZiAoUE9JTlRfVFlQRVNbc3VtXSkgewogICAgICAgIHBvaW50c1tqMCArIGpdID0gUE9JTlRfVFlQRVNbc3VtXTsKICAgICAgICArK2NvdW50OwogICAgICB9CiAgICAgIHBvcysrOwogICAgfQogICAgaWYgKGRhdGFbcG9zIC0gbGluZVNpemVdICE9PSBkYXRhW3Bvc10pIHsKICAgICAgcG9pbnRzW2owICsgal0gPSBkYXRhW3Bvc10gPyAyIDogNDsKICAgICAgKytjb3VudDsKICAgIH0KICAgIGlmIChjb3VudCA+IFBPSU5UX1RPX1BST0NFU1NfTElNSVQpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQogIHBvcyA9IGxpbmVTaXplICogKGhlaWdodCAtIDEpOwogIGowID0gaSAqIHdpZHRoMTsKICBpZiAoZGF0YVtwb3NdICE9PSAwKSB7CiAgICBwb2ludHNbajBdID0gODsKICAgICsrY291bnQ7CiAgfQogIGZvciAoaiA9IDE7IGogPCB3aWR0aDsgaisrKSB7CiAgICBpZiAoZGF0YVtwb3NdICE9PSBkYXRhW3BvcyArIDFdKSB7CiAgICAgIHBvaW50c1tqMCArIGpdID0gZGF0YVtwb3NdID8gNCA6IDg7CiAgICAgICsrY291bnQ7CiAgICB9CiAgICBwb3MrKzsKICB9CiAgaWYgKGRhdGFbcG9zXSAhPT0gMCkgewogICAgcG9pbnRzW2owICsgal0gPSA0OwogICAgKytjb3VudDsKICB9CiAgaWYgKGNvdW50ID4gUE9JTlRfVE9fUFJPQ0VTU19MSU1JVCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IHN0ZXBzID0gbmV3IEludDMyQXJyYXkoWzAsIHdpZHRoMSwgLTEsIDAsIC13aWR0aDEsIDAsIDAsIDAsIDFdKTsKICBjb25zdCBwYXRoQnVmID0gW107CiAgY29uc3QgewogICAgYSwKICAgIGIsCiAgICBjLAogICAgZCwKICAgIGUsCiAgICBmCiAgfSA9IG5ldyBET01NYXRyaXgoKS5zY2FsZVNlbGYoMSAvIHdpZHRoLCAtMSAvIGhlaWdodCkudHJhbnNsYXRlU2VsZigwLCAtaGVpZ2h0KTsKICBmb3IgKGkgPSAwOyBjb3VudCAmJiBpIDw9IGhlaWdodDsgaSsrKSB7CiAgICBsZXQgcCA9IGkgKiB3aWR0aDE7CiAgICBjb25zdCBlbmQgPSBwICsgd2lkdGg7CiAgICB3aGlsZSAocCA8IGVuZCAmJiAhcG9pbnRzW3BdKSB7CiAgICAgIHArKzsKICAgIH0KICAgIGlmIChwID09PSBlbmQpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgeCA9IHAgJSB3aWR0aDE7CiAgICBsZXQgeSA9IGk7CiAgICBwYXRoQnVmLnB1c2goRHJhd09QUy5tb3ZlVG8sIGEgKiB4ICsgYyAqIHkgKyBlLCBiICogeCArIGQgKiB5ICsgZik7CiAgICBjb25zdCBwMCA9IHA7CiAgICBsZXQgdHlwZSA9IHBvaW50c1twXTsKICAgIGRvIHsKICAgICAgY29uc3Qgc3RlcCA9IHN0ZXBzW3R5cGVdOwogICAgICBkbyB7CiAgICAgICAgcCArPSBzdGVwOwogICAgICB9IHdoaWxlICghcG9pbnRzW3BdKTsKICAgICAgY29uc3QgcHAgPSBwb2ludHNbcF07CiAgICAgIGlmIChwcCAhPT0gNSAmJiBwcCAhPT0gMTApIHsKICAgICAgICB0eXBlID0gcHA7CiAgICAgICAgcG9pbnRzW3BdID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0eXBlID0gcHAgJiAweDMzICogdHlwZSA+PiA0OwogICAgICAgIHBvaW50c1twXSAmPSB0eXBlID4+IDIgfCB0eXBlIDw8IDI7CiAgICAgIH0KICAgICAgeCA9IHAgJSB3aWR0aDE7CiAgICAgIHkgPSBwIC8gd2lkdGgxIHwgMDsKICAgICAgcGF0aEJ1Zi5wdXNoKERyYXdPUFMubGluZVRvLCBhICogeCArIGMgKiB5ICsgZSwgYiAqIHggKyBkICogeSArIGYpOwogICAgICBpZiAoIXBvaW50c1twXSkgewogICAgICAgIC0tY291bnQ7CiAgICAgIH0KICAgIH0gd2hpbGUgKHAwICE9PSBwKTsKICAgIC0taTsKICB9CiAgcmV0dXJuIFtPUFMucmF3RmlsbFBhdGgsIFtuZXcgRmxvYXQzMkFycmF5KHBhdGhCdWYpXSwgbmV3IEZsb2F0MzJBcnJheShbMCwgMCwgd2lkdGgsIGhlaWdodF0pXTsKfQoKOy8vIC4vc3JjL2NvcmUvY2hhcnNldHMuanMKY29uc3QgSVNPQWRvYmVDaGFyc2V0ID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXJpZ2h0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJxdW90ZWxlZnQiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgImV4Y2xhbWRvd24iLCAiY2VudCIsICJzdGVybGluZyIsICJmcmFjdGlvbiIsICJ5ZW4iLCAiZmxvcmluIiwgInNlY3Rpb24iLCAiY3VycmVuY3kiLCAicXVvdGVzaW5nbGUiLCAicXVvdGVkYmxsZWZ0IiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJlbmRhc2giLCAiZGFnZ2VyIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICJwYXJhZ3JhcGgiLCAiYnVsbGV0IiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJxdW90ZWRibHJpZ2h0IiwgImd1aWxsZW1vdHJpZ2h0IiwgImVsbGlwc2lzIiwgInBlcnRob3VzYW5kIiwgInF1ZXN0aW9uZG93biIsICJncmF2ZSIsICJhY3V0ZSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAiZGllcmVzaXMiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiZW1kYXNoIiwgIkFFIiwgIm9yZGZlbWluaW5lIiwgIkxzbGFzaCIsICJPc2xhc2giLCAiT0UiLCAib3JkbWFzY3VsaW5lIiwgImFlIiwgImRvdGxlc3NpIiwgImxzbGFzaCIsICJvc2xhc2giLCAib2UiLCAiZ2VybWFuZGJscyIsICJvbmVzdXBlcmlvciIsICJsb2dpY2Fsbm90IiwgIm11IiwgInRyYWRlbWFyayIsICJFdGgiLCAib25laGFsZiIsICJwbHVzbWludXMiLCAiVGhvcm4iLCAib25lcXVhcnRlciIsICJkaXZpZGUiLCAiYnJva2VuYmFyIiwgImRlZ3JlZSIsICJ0aG9ybiIsICJ0aHJlZXF1YXJ0ZXJzIiwgInR3b3N1cGVyaW9yIiwgInJlZ2lzdGVyZWQiLCAibWludXMiLCAiZXRoIiwgIm11bHRpcGx5IiwgInRocmVlc3VwZXJpb3IiLCAiY29weXJpZ2h0IiwgIkFhY3V0ZSIsICJBY2lyY3VtZmxleCIsICJBZGllcmVzaXMiLCAiQWdyYXZlIiwgIkFyaW5nIiwgIkF0aWxkZSIsICJDY2VkaWxsYSIsICJFYWN1dGUiLCAiRWNpcmN1bWZsZXgiLCAiRWRpZXJlc2lzIiwgIkVncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIklncmF2ZSIsICJOdGlsZGUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgIk9kaWVyZXNpcyIsICJPZ3JhdmUiLCAiT3RpbGRlIiwgIlNjYXJvbiIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWRpZXJlc2lzIiwgIlVncmF2ZSIsICJZYWN1dGUiLCAiWWRpZXJlc2lzIiwgIlpjYXJvbiIsICJhYWN1dGUiLCAiYWNpcmN1bWZsZXgiLCAiYWRpZXJlc2lzIiwgImFncmF2ZSIsICJhcmluZyIsICJhdGlsZGUiLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJlZ3JhdmUiLCAiaWFjdXRlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJpZ3JhdmUiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvY2lyY3VtZmxleCIsICJvZGllcmVzaXMiLCAib2dyYXZlIiwgIm90aWxkZSIsICJzY2Fyb24iLCAidWFjdXRlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJ1Z3JhdmUiLCAieWFjdXRlIiwgInlkaWVyZXNpcyIsICJ6Y2Fyb24iXTsKY29uc3QgRXhwZXJ0Q2hhcnNldCA9IFsiLm5vdGRlZiIsICJzcGFjZSIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgInF1ZXN0aW9uc21hbGwiLCAiYXN1cGVyaW9yIiwgImJzdXBlcmlvciIsICJjZW50c3VwZXJpb3IiLCAiZHN1cGVyaW9yIiwgImVzdXBlcmlvciIsICJpc3VwZXJpb3IiLCAibHN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJuc3VwZXJpb3IiLCAib3N1cGVyaW9yIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgImZmIiwgImZpIiwgImZsIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5zdXBlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICJTY2Fyb25zbWFsbCIsICJaY2Fyb25zbWFsbCIsICJEaWVyZXNpc3NtYWxsIiwgIkJyZXZlc21hbGwiLCAiQ2Fyb25zbWFsbCIsICJEb3RhY2NlbnRzbWFsbCIsICJNYWNyb25zbWFsbCIsICJmaWd1cmVkYXNoIiwgImh5cGhlbmluZmVyaW9yIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImZvdXJzdXBlcmlvciIsICJmaXZlc3VwZXJpb3IiLCAic2l4c3VwZXJpb3IiLCAic2V2ZW5zdXBlcmlvciIsICJlaWdodHN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAib25laW5mZXJpb3IiLCAidHdvaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiZWlnaHRpbmZlcmlvciIsICJuaW5laW5mZXJpb3IiLCAiY2VudGluZmVyaW9yIiwgImRvbGxhcmluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgImNvbW1haW5mZXJpb3IiLCAiQWdyYXZlc21hbGwiLCAiQWFjdXRlc21hbGwiLCAiQWNpcmN1bWZsZXhzbWFsbCIsICJBdGlsZGVzbWFsbCIsICJBZGllcmVzaXNzbWFsbCIsICJBcmluZ3NtYWxsIiwgIkFFc21hbGwiLCAiQ2NlZGlsbGFzbWFsbCIsICJFZ3JhdmVzbWFsbCIsICJFYWN1dGVzbWFsbCIsICJFY2lyY3VtZmxleHNtYWxsIiwgIkVkaWVyZXNpc3NtYWxsIiwgIklncmF2ZXNtYWxsIiwgIklhY3V0ZXNtYWxsIiwgIkljaXJjdW1mbGV4c21hbGwiLCAiSWRpZXJlc2lzc21hbGwiLCAiRXRoc21hbGwiLCAiTnRpbGRlc21hbGwiLCAiT2dyYXZlc21hbGwiLCAiT2FjdXRlc21hbGwiLCAiT2NpcmN1bWZsZXhzbWFsbCIsICJPdGlsZGVzbWFsbCIsICJPZGllcmVzaXNzbWFsbCIsICJPRXNtYWxsIiwgIk9zbGFzaHNtYWxsIiwgIlVncmF2ZXNtYWxsIiwgIlVhY3V0ZXNtYWxsIiwgIlVjaXJjdW1mbGV4c21hbGwiLCAiVWRpZXJlc2lzc21hbGwiLCAiWWFjdXRlc21hbGwiLCAiVGhvcm5zbWFsbCIsICJZZGllcmVzaXNzbWFsbCJdOwpjb25zdCBFeHBlcnRTdWJzZXRDaGFyc2V0ID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImRvbGxhcm9sZHN0eWxlIiwgImRvbGxhcnN1cGVyaW9yIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgImFzdXBlcmlvciIsICJic3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgImRzdXBlcmlvciIsICJlc3VwZXJpb3IiLCAiaXN1cGVyaW9yIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICJyc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgInRzdXBlcmlvciIsICJmZiIsICJmaSIsICJmbCIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJoeXBoZW5zdXBlcmlvciIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiY2VudG9sZHN0eWxlIiwgImZpZ3VyZWRhc2giLCAiaHlwaGVuaW5mZXJpb3IiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImZvdXJzdXBlcmlvciIsICJmaXZlc3VwZXJpb3IiLCAic2l4c3VwZXJpb3IiLCAic2V2ZW5zdXBlcmlvciIsICJlaWdodHN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAib25laW5mZXJpb3IiLCAidHdvaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiZWlnaHRpbmZlcmlvciIsICJuaW5laW5mZXJpb3IiLCAiY2VudGluZmVyaW9yIiwgImRvbGxhcmluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgImNvbW1haW5mZXJpb3IiXTsKCjsvLyAuL3NyYy9jb3JlL2NmZl9wYXJzZXIuanMKCgoKCmNvbnN0IE1BWF9TVUJSX05FU1RJTkcgPSAxMDsKY29uc3QgQ0ZGU3RhbmRhcmRTdHJpbmdzID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXJpZ2h0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJxdW90ZWxlZnQiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgImV4Y2xhbWRvd24iLCAiY2VudCIsICJzdGVybGluZyIsICJmcmFjdGlvbiIsICJ5ZW4iLCAiZmxvcmluIiwgInNlY3Rpb24iLCAiY3VycmVuY3kiLCAicXVvdGVzaW5nbGUiLCAicXVvdGVkYmxsZWZ0IiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJlbmRhc2giLCAiZGFnZ2VyIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICJwYXJhZ3JhcGgiLCAiYnVsbGV0IiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJxdW90ZWRibHJpZ2h0IiwgImd1aWxsZW1vdHJpZ2h0IiwgImVsbGlwc2lzIiwgInBlcnRob3VzYW5kIiwgInF1ZXN0aW9uZG93biIsICJncmF2ZSIsICJhY3V0ZSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAiZGllcmVzaXMiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiZW1kYXNoIiwgIkFFIiwgIm9yZGZlbWluaW5lIiwgIkxzbGFzaCIsICJPc2xhc2giLCAiT0UiLCAib3JkbWFzY3VsaW5lIiwgImFlIiwgImRvdGxlc3NpIiwgImxzbGFzaCIsICJvc2xhc2giLCAib2UiLCAiZ2VybWFuZGJscyIsICJvbmVzdXBlcmlvciIsICJsb2dpY2Fsbm90IiwgIm11IiwgInRyYWRlbWFyayIsICJFdGgiLCAib25laGFsZiIsICJwbHVzbWludXMiLCAiVGhvcm4iLCAib25lcXVhcnRlciIsICJkaXZpZGUiLCAiYnJva2VuYmFyIiwgImRlZ3JlZSIsICJ0aG9ybiIsICJ0aHJlZXF1YXJ0ZXJzIiwgInR3b3N1cGVyaW9yIiwgInJlZ2lzdGVyZWQiLCAibWludXMiLCAiZXRoIiwgIm11bHRpcGx5IiwgInRocmVlc3VwZXJpb3IiLCAiY29weXJpZ2h0IiwgIkFhY3V0ZSIsICJBY2lyY3VtZmxleCIsICJBZGllcmVzaXMiLCAiQWdyYXZlIiwgIkFyaW5nIiwgIkF0aWxkZSIsICJDY2VkaWxsYSIsICJFYWN1dGUiLCAiRWNpcmN1bWZsZXgiLCAiRWRpZXJlc2lzIiwgIkVncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIklncmF2ZSIsICJOdGlsZGUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgIk9kaWVyZXNpcyIsICJPZ3JhdmUiLCAiT3RpbGRlIiwgIlNjYXJvbiIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWRpZXJlc2lzIiwgIlVncmF2ZSIsICJZYWN1dGUiLCAiWWRpZXJlc2lzIiwgIlpjYXJvbiIsICJhYWN1dGUiLCAiYWNpcmN1bWZsZXgiLCAiYWRpZXJlc2lzIiwgImFncmF2ZSIsICJhcmluZyIsICJhdGlsZGUiLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJlZ3JhdmUiLCAiaWFjdXRlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJpZ3JhdmUiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvY2lyY3VtZmxleCIsICJvZGllcmVzaXMiLCAib2dyYXZlIiwgIm90aWxkZSIsICJzY2Fyb24iLCAidWFjdXRlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJ1Z3JhdmUiLCAieWFjdXRlIiwgInlkaWVyZXNpcyIsICJ6Y2Fyb24iLCAiZXhjbGFtc21hbGwiLCAiSHVuZ2FydW1sYXV0c21hbGwiLCAiZG9sbGFyb2xkc3R5bGUiLCAiZG9sbGFyc3VwZXJpb3IiLCAiYW1wZXJzYW5kc21hbGwiLCAiQWN1dGVzbWFsbCIsICJwYXJlbmxlZnRzdXBlcmlvciIsICJwYXJlbnJpZ2h0c3VwZXJpb3IiLCAidHdvZG90ZW5sZWFkZXIiLCAib25lZG90ZW5sZWFkZXIiLCAiemVyb29sZHN0eWxlIiwgIm9uZW9sZHN0eWxlIiwgInR3b29sZHN0eWxlIiwgInRocmVlb2xkc3R5bGUiLCAiZm91cm9sZHN0eWxlIiwgImZpdmVvbGRzdHlsZSIsICJzaXhvbGRzdHlsZSIsICJzZXZlbm9sZHN0eWxlIiwgImVpZ2h0b2xkc3R5bGUiLCAibmluZW9sZHN0eWxlIiwgImNvbW1hc3VwZXJpb3IiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICJwZXJpb2RzdXBlcmlvciIsICJxdWVzdGlvbnNtYWxsIiwgImFzdXBlcmlvciIsICJic3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgImRzdXBlcmlvciIsICJlc3VwZXJpb3IiLCAiaXN1cGVyaW9yIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICJyc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgInRzdXBlcmlvciIsICJmZiIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJDaXJjdW1mbGV4c21hbGwiLCAiaHlwaGVuc3VwZXJpb3IiLCAiR3JhdmVzbWFsbCIsICJBc21hbGwiLCAiQnNtYWxsIiwgIkNzbWFsbCIsICJEc21hbGwiLCAiRXNtYWxsIiwgIkZzbWFsbCIsICJHc21hbGwiLCAiSHNtYWxsIiwgIklzbWFsbCIsICJKc21hbGwiLCAiS3NtYWxsIiwgIkxzbWFsbCIsICJNc21hbGwiLCAiTnNtYWxsIiwgIk9zbWFsbCIsICJQc21hbGwiLCAiUXNtYWxsIiwgIlJzbWFsbCIsICJTc21hbGwiLCAiVHNtYWxsIiwgIlVzbWFsbCIsICJWc21hbGwiLCAiV3NtYWxsIiwgIlhzbWFsbCIsICJZc21hbGwiLCAiWnNtYWxsIiwgImNvbG9ubW9uZXRhcnkiLCAib25lZml0dGVkIiwgInJ1cGlhaCIsICJUaWxkZXNtYWxsIiwgImV4Y2xhbWRvd25zbWFsbCIsICJjZW50b2xkc3R5bGUiLCAiTHNsYXNoc21hbGwiLCAiU2Nhcm9uc21hbGwiLCAiWmNhcm9uc21hbGwiLCAiRGllcmVzaXNzbWFsbCIsICJCcmV2ZXNtYWxsIiwgIkNhcm9uc21hbGwiLCAiRG90YWNjZW50c21hbGwiLCAiTWFjcm9uc21hbGwiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5pbmZlcmlvciIsICJPZ29uZWtzbWFsbCIsICJSaW5nc21hbGwiLCAiQ2VkaWxsYXNtYWxsIiwgInF1ZXN0aW9uZG93bnNtYWxsIiwgIm9uZWVpZ2h0aCIsICJ0aHJlZWVpZ2h0aHMiLCAiZml2ZWVpZ2h0aHMiLCAic2V2ZW5laWdodGhzIiwgIm9uZXRoaXJkIiwgInR3b3RoaXJkcyIsICJ6ZXJvc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciIsICJBZ3JhdmVzbWFsbCIsICJBYWN1dGVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkFyaW5nc21hbGwiLCAiQUVzbWFsbCIsICJDY2VkaWxsYXNtYWxsIiwgIkVncmF2ZXNtYWxsIiwgIkVhY3V0ZXNtYWxsIiwgIkVjaXJjdW1mbGV4c21hbGwiLCAiRWRpZXJlc2lzc21hbGwiLCAiSWdyYXZlc21hbGwiLCAiSWFjdXRlc21hbGwiLCAiSWNpcmN1bWZsZXhzbWFsbCIsICJJZGllcmVzaXNzbWFsbCIsICJFdGhzbWFsbCIsICJOdGlsZGVzbWFsbCIsICJPZ3JhdmVzbWFsbCIsICJPYWN1dGVzbWFsbCIsICJPY2lyY3VtZmxleHNtYWxsIiwgIk90aWxkZXNtYWxsIiwgIk9kaWVyZXNpc3NtYWxsIiwgIk9Fc21hbGwiLCAiT3NsYXNoc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICJZYWN1dGVzbWFsbCIsICJUaG9ybnNtYWxsIiwgIllkaWVyZXNpc3NtYWxsIiwgIjAwMS4wMDAiLCAiMDAxLjAwMSIsICIwMDEuMDAyIiwgIjAwMS4wMDMiLCAiQmxhY2siLCAiQm9sZCIsICJCb29rIiwgIkxpZ2h0IiwgIk1lZGl1bSIsICJSZWd1bGFyIiwgIlJvbWFuIiwgIlNlbWlib2xkIl07CmNvbnN0IE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HUyA9IDM5MTsKY29uc3QgQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhID0gW251bGwsIHsKICBpZDogImhzdGVtIiwKICBtaW46IDIsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZSwKICBzdGVtOiB0cnVlCn0sIG51bGwsIHsKICBpZDogInZzdGVtIiwKICBtaW46IDIsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZSwKICBzdGVtOiB0cnVlCn0sIHsKICBpZDogInZtb3ZldG8iLAogIG1pbjogMSwKICBzdGFja0NsZWFyaW5nOiB0cnVlCn0sIHsKICBpZDogInJsaW5ldG8iLAogIG1pbjogMiwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImhsaW5ldG8iLAogIG1pbjogMSwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogInZsaW5ldG8iLAogIG1pbjogMSwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogInJyY3VydmV0byIsCiAgbWluOiA2LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgbnVsbCwgewogIGlkOiAiY2FsbHN1YnIiLAogIG1pbjogMQp9LCB7CiAgaWQ6ICJyZXR1cm4iLAogIG1pbjogMAp9LCBudWxsLCBudWxsLCB7CiAgaWQ6ICJlbmRjaGFyIiwKICBtaW46IDAsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZQp9LCBudWxsLCBudWxsLCBudWxsLCB7CiAgaWQ6ICJoc3RlbWhtIiwKICBtaW46IDIsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZSwKICBzdGVtOiB0cnVlCn0sIHsKICBpZDogImhpbnRtYXNrIiwKICBtaW46IDAsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZQp9LCB7CiAgaWQ6ICJjbnRybWFzayIsCiAgbWluOiAwLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgewogIGlkOiAicm1vdmV0byIsCiAgbWluOiAyLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgewogIGlkOiAiaG1vdmV0byIsCiAgbWluOiAxLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgewogIGlkOiAidnN0ZW1obSIsCiAgbWluOiAyLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgc3RlbTogdHJ1ZQp9LCB7CiAgaWQ6ICJyY3VydmVsaW5lIiwKICBtaW46IDgsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJybGluZWN1cnZlIiwKICBtaW46IDgsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJ2dmN1cnZldG8iLAogIG1pbjogNCwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImhoY3VydmV0byIsCiAgbWluOiA0LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgbnVsbCwgewogIGlkOiAiY2FsbGdzdWJyIiwKICBtaW46IDEKfSwgewogIGlkOiAidmhjdXJ2ZXRvIiwKICBtaW46IDQsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJodmN1cnZldG8iLAogIG1pbjogNCwKICByZXNldFN0YWNrOiB0cnVlCn1dOwpjb25zdCBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGExMiA9IFtudWxsLCBudWxsLCBudWxsLCB7CiAgaWQ6ICJhbmQiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMQp9LCB7CiAgaWQ6ICJvciIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xCn0sIHsKICBpZDogIm5vdCIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IDAKfSwgbnVsbCwgbnVsbCwgbnVsbCwgewogIGlkOiAiYWJzIiwKICBtaW46IDEsCiAgc3RhY2tEZWx0YTogMAp9LCB7CiAgaWQ6ICJhZGQiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMSwKICBzdGFja0ZuKHN0YWNrLCBpbmRleCkgewogICAgc3RhY2tbaW5kZXggLSAyXSA9IHN0YWNrW2luZGV4IC0gMl0gKyBzdGFja1tpbmRleCAtIDFdOwogIH0KfSwgewogIGlkOiAic3ViIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEsCiAgc3RhY2tGbihzdGFjaywgaW5kZXgpIHsKICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdIC0gc3RhY2tbaW5kZXggLSAxXTsKICB9Cn0sIHsKICBpZDogImRpdiIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xLAogIHN0YWNrRm4oc3RhY2ssIGluZGV4KSB7CiAgICBzdGFja1tpbmRleCAtIDJdID0gc3RhY2tbaW5kZXggLSAyXSAvIHN0YWNrW2luZGV4IC0gMV07CiAgfQp9LCBudWxsLCB7CiAgaWQ6ICJuZWciLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAwLAogIHN0YWNrRm4oc3RhY2ssIGluZGV4KSB7CiAgICBzdGFja1tpbmRleCAtIDFdID0gLXN0YWNrW2luZGV4IC0gMV07CiAgfQp9LCB7CiAgaWQ6ICJlcSIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xCn0sIG51bGwsIG51bGwsIHsKICBpZDogImRyb3AiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAtMQp9LCBudWxsLCB7CiAgaWQ6ICJwdXQiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMgp9LCB7CiAgaWQ6ICJnZXQiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAwCn0sIHsKICBpZDogImlmZWxzZSIsCiAgbWluOiA0LAogIHN0YWNrRGVsdGE6IC0zCn0sIHsKICBpZDogInJhbmRvbSIsCiAgbWluOiAwLAogIHN0YWNrRGVsdGE6IDEKfSwgewogIGlkOiAibXVsIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEsCiAgc3RhY2tGbihzdGFjaywgaW5kZXgpIHsKICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdICogc3RhY2tbaW5kZXggLSAxXTsKICB9Cn0sIG51bGwsIHsKICBpZDogInNxcnQiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAwCn0sIHsKICBpZDogImR1cCIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IDEKfSwgewogIGlkOiAiZXhjaCIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IDAKfSwgewogIGlkOiAiaW5kZXgiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAwCn0sIHsKICBpZDogInJvbGwiLAogIG1pbjogMywKICBzdGFja0RlbHRhOiAtMgp9LCBudWxsLCBudWxsLCBudWxsLCB7CiAgaWQ6ICJoZmxleCIsCiAgbWluOiA3LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAiZmxleCIsCiAgbWluOiAxMywKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImhmbGV4MSIsCiAgbWluOiA5LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAiZmxleDEiLAogIG1pbjogMTEsCiAgcmVzZXRTdGFjazogdHJ1ZQp9XTsKY2xhc3MgQ0ZGUGFyc2VyIHsKICBjb25zdHJ1Y3RvcihmaWxlLCBwcm9wZXJ0aWVzLCBzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICB0aGlzLmJ5dGVzID0gZmlsZS5nZXRCeXRlcygpOwogICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKICAgIHRoaXMuc2VhY0FuYWx5c2lzRW5hYmxlZCA9ICEhc2VhY0FuYWx5c2lzRW5hYmxlZDsKICB9CiAgcGFyc2UoKSB7CiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzOwogICAgY29uc3QgY2ZmID0gbmV3IENGRigpOwogICAgdGhpcy5jZmYgPSBjZmY7CiAgICBjb25zdCBoZWFkZXIgPSB0aGlzLnBhcnNlSGVhZGVyKCk7CiAgICBjb25zdCBuYW1lSW5kZXggPSB0aGlzLnBhcnNlSW5kZXgoaGVhZGVyLmVuZFBvcyk7CiAgICBjb25zdCB0b3BEaWN0SW5kZXggPSB0aGlzLnBhcnNlSW5kZXgobmFtZUluZGV4LmVuZFBvcyk7CiAgICBjb25zdCBzdHJpbmdJbmRleCA9IHRoaXMucGFyc2VJbmRleCh0b3BEaWN0SW5kZXguZW5kUG9zKTsKICAgIGNvbnN0IGdsb2JhbFN1YnJJbmRleCA9IHRoaXMucGFyc2VJbmRleChzdHJpbmdJbmRleC5lbmRQb3MpOwogICAgY29uc3QgdG9wRGljdFBhcnNlZCA9IHRoaXMucGFyc2VEaWN0KHRvcERpY3RJbmRleC5vYmouZ2V0KDApKTsKICAgIGNvbnN0IHRvcERpY3QgPSB0aGlzLmNyZWF0ZURpY3QoQ0ZGVG9wRGljdCwgdG9wRGljdFBhcnNlZCwgY2ZmLnN0cmluZ3MpOwogICAgY2ZmLmhlYWRlciA9IGhlYWRlci5vYmo7CiAgICBjZmYubmFtZXMgPSB0aGlzLnBhcnNlTmFtZUluZGV4KG5hbWVJbmRleC5vYmopOwogICAgY2ZmLnN0cmluZ3MgPSB0aGlzLnBhcnNlU3RyaW5nSW5kZXgoc3RyaW5nSW5kZXgub2JqKTsKICAgIGNmZi50b3BEaWN0ID0gdG9wRGljdDsKICAgIGNmZi5nbG9iYWxTdWJySW5kZXggPSBnbG9iYWxTdWJySW5kZXgub2JqOwogICAgdGhpcy5wYXJzZVByaXZhdGVEaWN0KGNmZi50b3BEaWN0KTsKICAgIGNmZi5pc0NJREZvbnQgPSB0b3BEaWN0Lmhhc05hbWUoIlJPUyIpOwogICAgY29uc3QgY2hhclN0cmluZ09mZnNldCA9IHRvcERpY3QuZ2V0QnlOYW1lKCJDaGFyU3RyaW5ncyIpOwogICAgY29uc3QgY2hhclN0cmluZ0luZGV4ID0gdGhpcy5wYXJzZUluZGV4KGNoYXJTdHJpbmdPZmZzZXQpLm9iajsKICAgIGNmZi5jaGFyU3RyaW5nQ291bnQgPSBjaGFyU3RyaW5nSW5kZXguY291bnQ7CiAgICBjb25zdCBmb250TWF0cml4ID0gdG9wRGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKTsKICAgIGlmIChmb250TWF0cml4KSB7CiAgICAgIHByb3BlcnRpZXMuZm9udE1hdHJpeCA9IGZvbnRNYXRyaXg7CiAgICB9CiAgICBjb25zdCBmb250QkJveCA9IHRvcERpY3QuZ2V0QnlOYW1lKCJGb250QkJveCIpOwogICAgaWYgKGZvbnRCQm94KSB7CiAgICAgIHByb3BlcnRpZXMuYXNjZW50ID0gTWF0aC5tYXgoZm9udEJCb3hbM10sIGZvbnRCQm94WzFdKTsKICAgICAgcHJvcGVydGllcy5kZXNjZW50ID0gTWF0aC5taW4oZm9udEJCb3hbMV0sIGZvbnRCQm94WzNdKTsKICAgICAgcHJvcGVydGllcy5hc2NlbnRTY2FsZWQgPSB0cnVlOwogICAgfQogICAgbGV0IGNoYXJzZXQsIGVuY29kaW5nOwogICAgaWYgKGNmZi5pc0NJREZvbnQpIHsKICAgICAgY29uc3QgZmRBcnJheUluZGV4ID0gdGhpcy5wYXJzZUluZGV4KHRvcERpY3QuZ2V0QnlOYW1lKCJGREFycmF5IikpLm9iajsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZmRBcnJheUluZGV4LmNvdW50OyBpIDwgaWk7ICsraSkgewogICAgICAgIGNvbnN0IGRpY3RSYXcgPSBmZEFycmF5SW5kZXguZ2V0KGkpOwogICAgICAgIGNvbnN0IGZvbnREaWN0ID0gdGhpcy5jcmVhdGVEaWN0KENGRlRvcERpY3QsIHRoaXMucGFyc2VEaWN0KGRpY3RSYXcpLCBjZmYuc3RyaW5ncyk7CiAgICAgICAgdGhpcy5wYXJzZVByaXZhdGVEaWN0KGZvbnREaWN0KTsKICAgICAgICBjZmYuZmRBcnJheS5wdXNoKGZvbnREaWN0KTsKICAgICAgfQogICAgICBlbmNvZGluZyA9IG51bGw7CiAgICAgIGNoYXJzZXQgPSB0aGlzLnBhcnNlQ2hhcnNldHModG9wRGljdC5nZXRCeU5hbWUoImNoYXJzZXQiKSwgY2hhclN0cmluZ0luZGV4LmNvdW50LCBjZmYuc3RyaW5ncywgdHJ1ZSk7CiAgICAgIGNmZi5mZFNlbGVjdCA9IHRoaXMucGFyc2VGRFNlbGVjdCh0b3BEaWN0LmdldEJ5TmFtZSgiRkRTZWxlY3QiKSwgY2hhclN0cmluZ0luZGV4LmNvdW50KTsKICAgIH0gZWxzZSB7CiAgICAgIGNoYXJzZXQgPSB0aGlzLnBhcnNlQ2hhcnNldHModG9wRGljdC5nZXRCeU5hbWUoImNoYXJzZXQiKSwgY2hhclN0cmluZ0luZGV4LmNvdW50LCBjZmYuc3RyaW5ncywgZmFsc2UpOwogICAgICBlbmNvZGluZyA9IHRoaXMucGFyc2VFbmNvZGluZyh0b3BEaWN0LmdldEJ5TmFtZSgiRW5jb2RpbmciKSwgcHJvcGVydGllcywgY2ZmLnN0cmluZ3MsIGNoYXJzZXQuY2hhcnNldCk7CiAgICB9CiAgICBjZmYuY2hhcnNldCA9IGNoYXJzZXQ7CiAgICBjZmYuZW5jb2RpbmcgPSBlbmNvZGluZzsKICAgIGNvbnN0IGNoYXJTdHJpbmdzQW5kU2VhY3MgPSB0aGlzLnBhcnNlQ2hhclN0cmluZ3MoewogICAgICBjaGFyU3RyaW5nczogY2hhclN0cmluZ0luZGV4LAogICAgICBsb2NhbFN1YnJJbmRleDogdG9wRGljdC5wcml2YXRlRGljdC5zdWJyc0luZGV4LAogICAgICBnbG9iYWxTdWJySW5kZXg6IGdsb2JhbFN1YnJJbmRleC5vYmosCiAgICAgIGZkU2VsZWN0OiBjZmYuZmRTZWxlY3QsCiAgICAgIGZkQXJyYXk6IGNmZi5mZEFycmF5LAogICAgICBwcml2YXRlRGljdDogdG9wRGljdC5wcml2YXRlRGljdAogICAgfSk7CiAgICBjZmYuY2hhclN0cmluZ3MgPSBjaGFyU3RyaW5nc0FuZFNlYWNzLmNoYXJTdHJpbmdzOwogICAgY2ZmLnNlYWNzID0gY2hhclN0cmluZ3NBbmRTZWFjcy5zZWFjczsKICAgIGNmZi53aWR0aHMgPSBjaGFyU3RyaW5nc0FuZFNlYWNzLndpZHRoczsKICAgIHJldHVybiBjZmY7CiAgfQogIHBhcnNlSGVhZGVyKCkgewogICAgbGV0IGJ5dGVzID0gdGhpcy5ieXRlczsKICAgIGNvbnN0IGJ5dGVzTGVuZ3RoID0gYnl0ZXMubGVuZ3RoOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICB3aGlsZSAob2Zmc2V0IDwgYnl0ZXNMZW5ndGggJiYgYnl0ZXNbb2Zmc2V0XSAhPT0gMSkgewogICAgICArK29mZnNldDsKICAgIH0KICAgIGlmIChvZmZzZXQgPj0gYnl0ZXNMZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIENGRiBoZWFkZXIiKTsKICAgIH0KICAgIGlmIChvZmZzZXQgIT09IDApIHsKICAgICAgaW5mbygiY2ZmIGRhdGEgaXMgc2hpZnRlZCIpOwogICAgICBieXRlcyA9IGJ5dGVzLnN1YmFycmF5KG9mZnNldCk7CiAgICAgIHRoaXMuYnl0ZXMgPSBieXRlczsKICAgIH0KICAgIGNvbnN0IG1ham9yID0gYnl0ZXNbMF07CiAgICBjb25zdCBtaW5vciA9IGJ5dGVzWzFdOwogICAgY29uc3QgaGRyU2l6ZSA9IGJ5dGVzWzJdOwogICAgY29uc3Qgb2ZmU2l6ZSA9IGJ5dGVzWzNdOwogICAgY29uc3QgaGVhZGVyID0gbmV3IENGRkhlYWRlcihtYWpvciwgbWlub3IsIGhkclNpemUsIG9mZlNpemUpOwogICAgcmV0dXJuIHsKICAgICAgb2JqOiBoZWFkZXIsCiAgICAgIGVuZFBvczogaGRyU2l6ZQogICAgfTsKICB9CiAgcGFyc2VEaWN0KGRpY3QpIHsKICAgIGxldCBwb3MgPSAwOwogICAgZnVuY3Rpb24gcGFyc2VPcGVyYW5kKCkgewogICAgICBsZXQgdmFsdWUgPSBkaWN0W3BvcysrXTsKICAgICAgaWYgKHZhbHVlID09PSAzMCkgewogICAgICAgIHJldHVybiBwYXJzZUZsb2F0T3BlcmFuZCgpOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAyOCkgewogICAgICAgIHZhbHVlID0gcmVhZEludDE2KGRpY3QsIHBvcyk7CiAgICAgICAgcG9zICs9IDI7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAyOSkgewogICAgICAgIHZhbHVlID0gZGljdFtwb3MrK107CiAgICAgICAgdmFsdWUgPSB2YWx1ZSA8PCA4IHwgZGljdFtwb3MrK107CiAgICAgICAgdmFsdWUgPSB2YWx1ZSA8PCA4IHwgZGljdFtwb3MrK107CiAgICAgICAgdmFsdWUgPSB2YWx1ZSA8PCA4IHwgZGljdFtwb3MrK107CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDMyICYmIHZhbHVlIDw9IDI0NikgewogICAgICAgIHJldHVybiB2YWx1ZSAtIDEzOTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAyNDcgJiYgdmFsdWUgPD0gMjUwKSB7CiAgICAgICAgcmV0dXJuICh2YWx1ZSAtIDI0NykgKiAyNTYgKyBkaWN0W3BvcysrXSArIDEwODsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAyNTEgJiYgdmFsdWUgPD0gMjU0KSB7CiAgICAgICAgcmV0dXJuIC0oKHZhbHVlIC0gMjUxKSAqIDI1NikgLSBkaWN0W3BvcysrXSAtIDEwODsKICAgICAgfQogICAgICB3YXJuKCdDRkZQYXJzZXJfcGFyc2VEaWN0OiAiJyArIHZhbHVlICsgJyIgaXMgYSByZXNlcnZlZCBjb21tYW5kLicpOwogICAgICByZXR1cm4gTmFOOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VGbG9hdE9wZXJhbmQoKSB7CiAgICAgIGxldCBzdHIgPSAiIjsKICAgICAgY29uc3QgZW9mID0gMTU7CiAgICAgIGNvbnN0IGxvb2t1cCA9IFsiMCIsICIxIiwgIjIiLCAiMyIsICI0IiwgIjUiLCAiNiIsICI3IiwgIjgiLCAiOSIsICIuIiwgIkUiLCAiRS0iLCBudWxsLCAiLSJdOwogICAgICBjb25zdCBsZW5ndGggPSBkaWN0Lmxlbmd0aDsKICAgICAgd2hpbGUgKHBvcyA8IGxlbmd0aCkgewogICAgICAgIGNvbnN0IGIgPSBkaWN0W3BvcysrXTsKICAgICAgICBjb25zdCBiMSA9IGIgPj4gNDsKICAgICAgICBjb25zdCBiMiA9IGIgJiAxNTsKICAgICAgICBpZiAoYjEgPT09IGVvZikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN0ciArPSBsb29rdXBbYjFdOwogICAgICAgIGlmIChiMiA9PT0gZW9mKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc3RyICs9IGxvb2t1cFtiMl07CiAgICAgIH0KICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoc3RyKTsKICAgIH0KICAgIGxldCBvcGVyYW5kcyA9IFtdOwogICAgY29uc3QgZW50cmllcyA9IFtdOwogICAgcG9zID0gMDsKICAgIGNvbnN0IGVuZCA9IGRpY3QubGVuZ3RoOwogICAgd2hpbGUgKHBvcyA8IGVuZCkgewogICAgICBsZXQgYiA9IGRpY3RbcG9zXTsKICAgICAgaWYgKGIgPD0gMjEpIHsKICAgICAgICBpZiAoYiA9PT0gMTIpIHsKICAgICAgICAgIGIgPSBiIDw8IDggfCBkaWN0WysrcG9zXTsKICAgICAgICB9CiAgICAgICAgZW50cmllcy5wdXNoKFtiLCBvcGVyYW5kc10pOwogICAgICAgIG9wZXJhbmRzID0gW107CiAgICAgICAgKytwb3M7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3BlcmFuZHMucHVzaChwYXJzZU9wZXJhbmQoKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbnRyaWVzOwogIH0KICBwYXJzZUluZGV4KHBvcykgewogICAgY29uc3QgY2ZmSW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5ieXRlczsKICAgIGNvbnN0IGNvdW50ID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICBjb25zdCBvZmZzZXRzID0gW107CiAgICBsZXQgZW5kID0gcG9zOwogICAgbGV0IGksIGlpOwogICAgaWYgKGNvdW50ICE9PSAwKSB7CiAgICAgIGNvbnN0IG9mZnNldFNpemUgPSBieXRlc1twb3MrK107CiAgICAgIGNvbnN0IHN0YXJ0UG9zID0gcG9zICsgKGNvdW50ICsgMSkgKiBvZmZzZXRTaXplIC0gMTsKICAgICAgZm9yIChpID0gMCwgaWkgPSBjb3VudCArIDE7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBvZmZzZXRTaXplOyArK2opIHsKICAgICAgICAgIG9mZnNldCA8PD0gODsKICAgICAgICAgIG9mZnNldCArPSBieXRlc1twb3MrK107CiAgICAgICAgfQogICAgICAgIG9mZnNldHMucHVzaChzdGFydFBvcyArIG9mZnNldCk7CiAgICAgIH0KICAgICAgZW5kID0gb2Zmc2V0c1tjb3VudF07CiAgICB9CiAgICBmb3IgKGkgPSAwLCBpaSA9IG9mZnNldHMubGVuZ3RoIC0gMTsgaSA8IGlpOyArK2kpIHsKICAgICAgY29uc3Qgb2Zmc2V0U3RhcnQgPSBvZmZzZXRzW2ldOwogICAgICBjb25zdCBvZmZzZXRFbmQgPSBvZmZzZXRzW2kgKyAxXTsKICAgICAgY2ZmSW5kZXguYWRkKGJ5dGVzLnN1YmFycmF5KG9mZnNldFN0YXJ0LCBvZmZzZXRFbmQpKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG9iajogY2ZmSW5kZXgsCiAgICAgIGVuZFBvczogZW5kCiAgICB9OwogIH0KICBwYXJzZU5hbWVJbmRleChpbmRleCkgewogICAgY29uc3QgbmFtZXMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGluZGV4LmNvdW50OyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBuYW1lID0gaW5kZXguZ2V0KGkpOwogICAgICBuYW1lcy5wdXNoKGJ5dGVzVG9TdHJpbmcobmFtZSkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzOwogIH0KICBwYXJzZVN0cmluZ0luZGV4KGluZGV4KSB7CiAgICBjb25zdCBzdHJpbmdzID0gbmV3IENGRlN0cmluZ3MoKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGluZGV4LmNvdW50OyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBkYXRhID0gaW5kZXguZ2V0KGkpOwogICAgICBzdHJpbmdzLmFkZChieXRlc1RvU3RyaW5nKGRhdGEpKTsKICAgIH0KICAgIHJldHVybiBzdHJpbmdzOwogIH0KICBjcmVhdGVEaWN0KFR5cGUsIGRpY3QsIHN0cmluZ3MpIHsKICAgIGNvbnN0IGNmZkRpY3QgPSBuZXcgVHlwZShzdHJpbmdzKTsKICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGRpY3QpIHsKICAgICAgY2ZmRGljdC5zZXRCeUtleShrZXksIHZhbHVlKTsKICAgIH0KICAgIHJldHVybiBjZmZEaWN0OwogIH0KICBwYXJzZUNoYXJTdHJpbmcoc3RhdGUsIGRhdGEsIGxvY2FsU3VickluZGV4LCBnbG9iYWxTdWJySW5kZXgpIHsKICAgIGlmICghZGF0YSB8fCBzdGF0ZS5jYWxsRGVwdGggPiBNQVhfU1VCUl9ORVNUSU5HKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGxldCBzdGFja1NpemUgPSBzdGF0ZS5zdGFja1NpemU7CiAgICBjb25zdCBzdGFjayA9IHN0YXRlLnN0YWNrOwogICAgbGV0IGxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7KSB7CiAgICAgIGNvbnN0IHZhbHVlID0gZGF0YVtqKytdOwogICAgICBsZXQgdmFsaWRhdGlvbkNvbW1hbmQgPSBudWxsOwogICAgICBpZiAodmFsdWUgPT09IDEyKSB7CiAgICAgICAgY29uc3QgcSA9IGRhdGFbaisrXTsKICAgICAgICBpZiAocSA9PT0gMCkgewogICAgICAgICAgZGF0YVtqIC0gMl0gPSAxMzk7CiAgICAgICAgICBkYXRhW2ogLSAxXSA9IDIyOwogICAgICAgICAgc3RhY2tTaXplID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGExMltxXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDI4KSB7CiAgICAgICAgc3RhY2tbc3RhY2tTaXplXSA9IHJlYWRJbnQxNihkYXRhLCBqKTsKICAgICAgICBqICs9IDI7CiAgICAgICAgc3RhY2tTaXplKys7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDE0KSB7CiAgICAgICAgaWYgKHN0YWNrU2l6ZSA+PSA0KSB7CiAgICAgICAgICBzdGFja1NpemUgLT0gNDsKICAgICAgICAgIGlmICh0aGlzLnNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgICAgICAgICAgc3RhdGUuc2VhYyA9IHN0YWNrLnNsaWNlKHN0YWNrU2l6ZSwgc3RhY2tTaXplICsgNCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbdmFsdWVdOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDMyICYmIHZhbHVlIDw9IDI0NikgewogICAgICAgIHN0YWNrW3N0YWNrU2l6ZV0gPSB2YWx1ZSAtIDEzOTsKICAgICAgICBzdGFja1NpemUrKzsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAyNDcgJiYgdmFsdWUgPD0gMjU0KSB7CiAgICAgICAgc3RhY2tbc3RhY2tTaXplXSA9IHZhbHVlIDwgMjUxID8gKHZhbHVlIC0gMjQ3IDw8IDgpICsgZGF0YVtqXSArIDEwOCA6IC0odmFsdWUgLSAyNTEgPDwgOCkgLSBkYXRhW2pdIC0gMTA4OwogICAgICAgIGorKzsKICAgICAgICBzdGFja1NpemUrKzsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMjU1KSB7CiAgICAgICAgc3RhY2tbc3RhY2tTaXplXSA9IChkYXRhW2pdIDw8IDI0IHwgZGF0YVtqICsgMV0gPDwgMTYgfCBkYXRhW2ogKyAyXSA8PCA4IHwgZGF0YVtqICsgM10pIC8gNjU1MzY7CiAgICAgICAgaiArPSA0OwogICAgICAgIHN0YWNrU2l6ZSsrOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxOSB8fCB2YWx1ZSA9PT0gMjApIHsKICAgICAgICBzdGF0ZS5oaW50cyArPSBzdGFja1NpemUgPj4gMTsKICAgICAgICBpZiAoc3RhdGUuaGludHMgPT09IDApIHsKICAgICAgICAgIGRhdGEuY29weVdpdGhpbihqIC0gMSwgaiwgLTEpOwogICAgICAgICAgaiAtPSAxOwogICAgICAgICAgbGVuZ3RoIC09IDE7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaiArPSBzdGF0ZS5oaW50cyArIDcgPj4gMzsKICAgICAgICBzdGFja1NpemUgJT0gMjsKICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDEwIHx8IHZhbHVlID09PSAyOSkgewogICAgICAgIGNvbnN0IHN1YnJzSW5kZXggPSB2YWx1ZSA9PT0gMTAgPyBsb2NhbFN1YnJJbmRleCA6IGdsb2JhbFN1YnJJbmRleDsKICAgICAgICBpZiAoIXN1YnJzSW5kZXgpIHsKICAgICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhW3ZhbHVlXTsKICAgICAgICAgIHdhcm4oIk1pc3Npbmcgc3VicnNJbmRleCBmb3IgIiArIHZhbGlkYXRpb25Db21tYW5kLmlkKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgbGV0IGJpYXMgPSAzMjc2ODsKICAgICAgICBpZiAoc3VicnNJbmRleC5jb3VudCA8IDEyNDApIHsKICAgICAgICAgIGJpYXMgPSAxMDc7CiAgICAgICAgfSBlbHNlIGlmIChzdWJyc0luZGV4LmNvdW50IDwgMzM5MDApIHsKICAgICAgICAgIGJpYXMgPSAxMTMxOwogICAgICAgIH0KICAgICAgICBjb25zdCBzdWJyTnVtYmVyID0gc3RhY2tbLS1zdGFja1NpemVdICsgYmlhczsKICAgICAgICBpZiAoc3Vick51bWJlciA8IDAgfHwgc3Vick51bWJlciA+PSBzdWJyc0luZGV4LmNvdW50IHx8IGlzTmFOKHN1YnJOdW1iZXIpKSB7CiAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgICAgICB3YXJuKCJPdXQgb2YgYm91bmRzIHN1YnJJbmRleCBmb3IgIiArIHZhbGlkYXRpb25Db21tYW5kLmlkKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgc3RhdGUuc3RhY2tTaXplID0gc3RhY2tTaXplOwogICAgICAgIHN0YXRlLmNhbGxEZXB0aCsrOwogICAgICAgIGNvbnN0IHZhbGlkID0gdGhpcy5wYXJzZUNoYXJTdHJpbmcoc3RhdGUsIHN1YnJzSW5kZXguZ2V0KHN1YnJOdW1iZXIpLCBsb2NhbFN1YnJJbmRleCwgZ2xvYmFsU3VickluZGV4KTsKICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHN0YXRlLmNhbGxEZXB0aC0tOwogICAgICAgIHN0YWNrU2l6ZSA9IHN0YXRlLnN0YWNrU2l6ZTsKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMTEpIHsKICAgICAgICBzdGF0ZS5zdGFja1NpemUgPSBzdGFja1NpemU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDAgJiYgaiA9PT0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBkYXRhW2ogLSAxXSA9IDE0OwogICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhWzE0XTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gOSkgewogICAgICAgIGRhdGEuY29weVdpdGhpbihqIC0gMSwgaiwgLTEpOwogICAgICAgIGogLT0gMTsKICAgICAgICBsZW5ndGggLT0gMTsKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgIH0KICAgICAgaWYgKHZhbGlkYXRpb25Db21tYW5kKSB7CiAgICAgICAgaWYgKHZhbGlkYXRpb25Db21tYW5kLnN0ZW0pIHsKICAgICAgICAgIHN0YXRlLmhpbnRzICs9IHN0YWNrU2l6ZSA+PiAxOwogICAgICAgICAgaWYgKHZhbHVlID09PSAzIHx8IHZhbHVlID09PSAyMykgewogICAgICAgICAgICBzdGF0ZS5oYXNWU3RlbXMgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5oYXNWU3RlbXMgJiYgKHZhbHVlID09PSAxIHx8IHZhbHVlID09PSAxOCkpIHsKICAgICAgICAgICAgd2FybigiQ0ZGIHN0ZW0gaGludHMgYXJlIGluIHdyb25nIG9yZGVyIik7CiAgICAgICAgICAgIGRhdGFbaiAtIDFdID0gdmFsdWUgPT09IDEgPyAzIDogMjM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzdGFja1NpemUgPCB2YWxpZGF0aW9uQ29tbWFuZC5taW4pIHsKICAgICAgICAgIHdhcm4oIk5vdCBlbm91Z2ggcGFyYW1ldGVycyBmb3IgIiArIHZhbGlkYXRpb25Db21tYW5kLmlkICsgIjsgYWN0dWFsOiAiICsgc3RhY2tTaXplICsgIiwgZXhwZWN0ZWQ6ICIgKyB2YWxpZGF0aW9uQ29tbWFuZC5taW4pOwogICAgICAgICAgaWYgKHN0YWNrU2l6ZSA9PT0gMCkgewogICAgICAgICAgICBkYXRhW2ogLSAxXSA9IDE0OwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlLmZpcnN0U3RhY2tDbGVhcmluZyAmJiB2YWxpZGF0aW9uQ29tbWFuZC5zdGFja0NsZWFyaW5nKSB7CiAgICAgICAgICBzdGF0ZS5maXJzdFN0YWNrQ2xlYXJpbmcgPSBmYWxzZTsKICAgICAgICAgIHN0YWNrU2l6ZSAtPSB2YWxpZGF0aW9uQ29tbWFuZC5taW47CiAgICAgICAgICBpZiAoc3RhY2tTaXplID49IDIgJiYgdmFsaWRhdGlvbkNvbW1hbmQuc3RlbSkgewogICAgICAgICAgICBzdGFja1NpemUgJT0gMjsKICAgICAgICAgIH0gZWxzZSBpZiAoc3RhY2tTaXplID4gMSkgewogICAgICAgICAgICB3YXJuKCJGb3VuZCB0b28gbWFueSBwYXJhbWV0ZXJzIGZvciBzdGFjay1jbGVhcmluZyBjb21tYW5kIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhY2tTaXplID4gMCkgewogICAgICAgICAgICBzdGF0ZS53aWR0aCA9IHN0YWNrW3N0YWNrU2l6ZSAtIDFdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoInN0YWNrRGVsdGEiIGluIHZhbGlkYXRpb25Db21tYW5kKSB7CiAgICAgICAgICBpZiAoInN0YWNrRm4iIGluIHZhbGlkYXRpb25Db21tYW5kKSB7CiAgICAgICAgICAgIHZhbGlkYXRpb25Db21tYW5kLnN0YWNrRm4oc3RhY2ssIHN0YWNrU2l6ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFja1NpemUgKz0gdmFsaWRhdGlvbkNvbW1hbmQuc3RhY2tEZWx0YTsKICAgICAgICB9IGVsc2UgaWYgKHZhbGlkYXRpb25Db21tYW5kLnN0YWNrQ2xlYXJpbmcgfHwgdmFsaWRhdGlvbkNvbW1hbmQucmVzZXRTdGFjaykgewogICAgICAgICAgc3RhY2tTaXplID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChsZW5ndGggPCBkYXRhLmxlbmd0aCkgewogICAgICBkYXRhLmZpbGwoMTQsIGxlbmd0aCk7CiAgICB9CiAgICBzdGF0ZS5zdGFja1NpemUgPSBzdGFja1NpemU7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcGFyc2VDaGFyU3RyaW5ncyh7CiAgICBjaGFyU3RyaW5ncywKICAgIGxvY2FsU3VickluZGV4LAogICAgZ2xvYmFsU3VickluZGV4LAogICAgZmRTZWxlY3QsCiAgICBmZEFycmF5LAogICAgcHJpdmF0ZURpY3QKICB9KSB7CiAgICBjb25zdCBzZWFjcyA9IFtdOwogICAgY29uc3Qgd2lkdGhzID0gW107CiAgICBjb25zdCBjb3VudCA9IGNoYXJTdHJpbmdzLmNvdW50OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIGNvbnN0IGNoYXJzdHJpbmcgPSBjaGFyU3RyaW5ncy5nZXQoaSk7CiAgICAgIGNvbnN0IHN0YXRlID0gewogICAgICAgIGNhbGxEZXB0aDogMCwKICAgICAgICBzdGFja1NpemU6IDAsCiAgICAgICAgc3RhY2s6IFtdLAogICAgICAgIGhpbnRzOiAwLAogICAgICAgIGZpcnN0U3RhY2tDbGVhcmluZzogdHJ1ZSwKICAgICAgICBzZWFjOiBudWxsLAogICAgICAgIHdpZHRoOiBudWxsLAogICAgICAgIGhhc1ZTdGVtczogZmFsc2UKICAgICAgfTsKICAgICAgbGV0IHZhbGlkID0gdHJ1ZTsKICAgICAgbGV0IGxvY2FsU3ViclRvVXNlID0gbnVsbDsKICAgICAgbGV0IHByaXZhdGVEaWN0VG9Vc2UgPSBwcml2YXRlRGljdDsKICAgICAgaWYgKGZkU2VsZWN0ICYmIGZkQXJyYXkubGVuZ3RoKSB7CiAgICAgICAgY29uc3QgZmRJbmRleCA9IGZkU2VsZWN0LmdldEZESW5kZXgoaSk7CiAgICAgICAgaWYgKGZkSW5kZXggPT09IC0xKSB7CiAgICAgICAgICB3YXJuKCJHbHlwaCBpbmRleCBpcyBub3QgaW4gZmQgc2VsZWN0LiIpOwogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGZkSW5kZXggPj0gZmRBcnJheS5sZW5ndGgpIHsKICAgICAgICAgIHdhcm4oIkludmFsaWQgZmQgaW5kZXggZm9yIGdseXBoIGluZGV4LiIpOwogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICBwcml2YXRlRGljdFRvVXNlID0gZmRBcnJheVtmZEluZGV4XS5wcml2YXRlRGljdDsKICAgICAgICAgIGxvY2FsU3ViclRvVXNlID0gcHJpdmF0ZURpY3RUb1VzZS5zdWJyc0luZGV4OwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChsb2NhbFN1YnJJbmRleCkgewogICAgICAgIGxvY2FsU3ViclRvVXNlID0gbG9jYWxTdWJySW5kZXg7CiAgICAgIH0KICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgdmFsaWQgPSB0aGlzLnBhcnNlQ2hhclN0cmluZyhzdGF0ZSwgY2hhcnN0cmluZywgbG9jYWxTdWJyVG9Vc2UsIGdsb2JhbFN1YnJJbmRleCk7CiAgICAgIH0KICAgICAgaWYgKHN0YXRlLndpZHRoICE9PSBudWxsKSB7CiAgICAgICAgY29uc3Qgbm9taW5hbFdpZHRoID0gcHJpdmF0ZURpY3RUb1VzZS5nZXRCeU5hbWUoIm5vbWluYWxXaWR0aFgiKTsKICAgICAgICB3aWR0aHNbaV0gPSBub21pbmFsV2lkdGggKyBzdGF0ZS53aWR0aDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBkZWZhdWx0V2lkdGggPSBwcml2YXRlRGljdFRvVXNlLmdldEJ5TmFtZSgiZGVmYXVsdFdpZHRoWCIpOwogICAgICAgIHdpZHRoc1tpXSA9IGRlZmF1bHRXaWR0aDsKICAgICAgfQogICAgICBpZiAoc3RhdGUuc2VhYyAhPT0gbnVsbCkgewogICAgICAgIHNlYWNzW2ldID0gc3RhdGUuc2VhYzsKICAgICAgfQogICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgY2hhclN0cmluZ3Muc2V0KGksIG5ldyBVaW50OEFycmF5KFsxNF0pKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgY2hhclN0cmluZ3MsCiAgICAgIHNlYWNzLAogICAgICB3aWR0aHMKICAgIH07CiAgfQogIGVtcHR5UHJpdmF0ZURpY3Rpb25hcnkocGFyZW50RGljdCkgewogICAgY29uc3QgcHJpdmF0ZURpY3QgPSB0aGlzLmNyZWF0ZURpY3QoQ0ZGUHJpdmF0ZURpY3QsIFtdLCBwYXJlbnREaWN0LnN0cmluZ3MpOwogICAgcGFyZW50RGljdC5zZXRCeUtleSgxOCwgWzAsIDBdKTsKICAgIHBhcmVudERpY3QucHJpdmF0ZURpY3QgPSBwcml2YXRlRGljdDsKICB9CiAgcGFyc2VQcml2YXRlRGljdChwYXJlbnREaWN0KSB7CiAgICBpZiAoIXBhcmVudERpY3QuaGFzTmFtZSgiUHJpdmF0ZSIpKSB7CiAgICAgIHRoaXMuZW1wdHlQcml2YXRlRGljdGlvbmFyeShwYXJlbnREaWN0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcHJpdmF0ZU9mZnNldCA9IHBhcmVudERpY3QuZ2V0QnlOYW1lKCJQcml2YXRlIik7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJpdmF0ZU9mZnNldCkgfHwgcHJpdmF0ZU9mZnNldC5sZW5ndGggIT09IDIpIHsKICAgICAgcGFyZW50RGljdC5yZW1vdmVCeU5hbWUoIlByaXZhdGUiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc2l6ZSA9IHByaXZhdGVPZmZzZXRbMF07CiAgICBjb25zdCBvZmZzZXQgPSBwcml2YXRlT2Zmc2V0WzFdOwogICAgaWYgKHNpemUgPT09IDAgfHwgb2Zmc2V0ID49IHRoaXMuYnl0ZXMubGVuZ3RoKSB7CiAgICAgIHRoaXMuZW1wdHlQcml2YXRlRGljdGlvbmFyeShwYXJlbnREaWN0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcHJpdmF0ZURpY3RFbmQgPSBvZmZzZXQgKyBzaXplOwogICAgY29uc3QgZGljdERhdGEgPSB0aGlzLmJ5dGVzLnN1YmFycmF5KG9mZnNldCwgcHJpdmF0ZURpY3RFbmQpOwogICAgY29uc3QgZGljdCA9IHRoaXMucGFyc2VEaWN0KGRpY3REYXRhKTsKICAgIGNvbnN0IHByaXZhdGVEaWN0ID0gdGhpcy5jcmVhdGVEaWN0KENGRlByaXZhdGVEaWN0LCBkaWN0LCBwYXJlbnREaWN0LnN0cmluZ3MpOwogICAgcGFyZW50RGljdC5wcml2YXRlRGljdCA9IHByaXZhdGVEaWN0OwogICAgaWYgKHByaXZhdGVEaWN0LmdldEJ5TmFtZSgiRXhwYW5zaW9uRmFjdG9yIikgPT09IDApIHsKICAgICAgcHJpdmF0ZURpY3Quc2V0QnlOYW1lKCJFeHBhbnNpb25GYWN0b3IiLCAwLjA2KTsKICAgIH0KICAgIGlmICghcHJpdmF0ZURpY3QuZ2V0QnlOYW1lKCJTdWJycyIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN1YnJzT2Zmc2V0ID0gcHJpdmF0ZURpY3QuZ2V0QnlOYW1lKCJTdWJycyIpOwogICAgY29uc3QgcmVsYXRpdmVPZmZzZXQgPSBvZmZzZXQgKyBzdWJyc09mZnNldDsKICAgIGlmIChzdWJyc09mZnNldCA9PT0gMCB8fCByZWxhdGl2ZU9mZnNldCA+PSB0aGlzLmJ5dGVzLmxlbmd0aCkgewogICAgICB0aGlzLmVtcHR5UHJpdmF0ZURpY3Rpb25hcnkocGFyZW50RGljdCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN1YnJzSW5kZXggPSB0aGlzLnBhcnNlSW5kZXgocmVsYXRpdmVPZmZzZXQpOwogICAgcHJpdmF0ZURpY3Quc3VicnNJbmRleCA9IHN1YnJzSW5kZXgub2JqOwogIH0KICBwYXJzZUNoYXJzZXRzKHBvcywgbGVuZ3RoLCBzdHJpbmdzLCBjaWQpIHsKICAgIGlmIChwb3MgPT09IDApIHsKICAgICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KHRydWUsIENGRkNoYXJzZXRQcmVkZWZpbmVkVHlwZXMuSVNPX0FET0JFLCBJU09BZG9iZUNoYXJzZXQpOwogICAgfSBlbHNlIGlmIChwb3MgPT09IDEpIHsKICAgICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KHRydWUsIENGRkNoYXJzZXRQcmVkZWZpbmVkVHlwZXMuRVhQRVJULCBFeHBlcnRDaGFyc2V0KTsKICAgIH0gZWxzZSBpZiAocG9zID09PSAyKSB7CiAgICAgIHJldHVybiBuZXcgQ0ZGQ2hhcnNldCh0cnVlLCBDRkZDaGFyc2V0UHJlZGVmaW5lZFR5cGVzLkVYUEVSVF9TVUJTRVQsIEV4cGVydFN1YnNldENoYXJzZXQpOwogICAgfQogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgY29uc3Qgc3RhcnQgPSBwb3M7CiAgICBjb25zdCBmb3JtYXQgPSBieXRlc1twb3MrK107CiAgICBjb25zdCBjaGFyc2V0ID0gW2NpZCA/IDAgOiAiLm5vdGRlZiJdOwogICAgbGV0IGlkLCBjb3VudCwgaTsKICAgIGxlbmd0aCAtPSAxOwogICAgc3dpdGNoIChmb3JtYXQpIHsKICAgICAgY2FzZSAwOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgaWQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGNoYXJzZXQucHVzaChjaWQgPyBpZCA6IHN0cmluZ3MuZ2V0KGlkKSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDE6CiAgICAgICAgd2hpbGUgKGNoYXJzZXQubGVuZ3RoIDw9IGxlbmd0aCkgewogICAgICAgICAgaWQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGNvdW50ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8PSBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNoYXJzZXQucHVzaChjaWQgPyBpZCsrIDogc3RyaW5ncy5nZXQoaWQrKykpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIHdoaWxlIChjaGFyc2V0Lmxlbmd0aCA8PSBsZW5ndGgpIHsKICAgICAgICAgIGlkID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgICBjb3VudCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8PSBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNoYXJzZXQucHVzaChjaWQgPyBpZCsrIDogc3RyaW5ncy5nZXQoaWQrKykpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gY2hhcnNldCBmb3JtYXQiKTsKICAgIH0KICAgIGNvbnN0IGVuZCA9IHBvczsKICAgIGNvbnN0IHJhdyA9IGJ5dGVzLnN1YmFycmF5KHN0YXJ0LCBlbmQpOwogICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KGZhbHNlLCBmb3JtYXQsIGNoYXJzZXQsIHJhdyk7CiAgfQogIHBhcnNlRW5jb2RpbmcocG9zLCBwcm9wZXJ0aWVzLCBzdHJpbmdzLCBjaGFyc2V0KSB7CiAgICBjb25zdCBlbmNvZGluZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBsZXQgcHJlZGVmaW5lZCA9IGZhbHNlOwogICAgbGV0IGZvcm1hdCwgaSwgaWk7CiAgICBsZXQgcmF3ID0gbnVsbDsKICAgIGZ1bmN0aW9uIHJlYWRTdXBwbGVtZW50KCkgewogICAgICBjb25zdCBzdXBwbGVtZW50c0NvdW50ID0gYnl0ZXNbcG9zKytdOwogICAgICBmb3IgKGkgPSAwOyBpIDwgc3VwcGxlbWVudHNDb3VudDsgaSsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IGJ5dGVzW3BvcysrXTsKICAgICAgICBjb25zdCBzaWQgPSAoYnl0ZXNbcG9zKytdIDw8IDgpICsgKGJ5dGVzW3BvcysrXSAmIDB4ZmYpOwogICAgICAgIGVuY29kaW5nW2NvZGVdID0gY2hhcnNldC5pbmRleE9mKHN0cmluZ3MuZ2V0KHNpZCkpOwogICAgICB9CiAgICB9CiAgICBpZiAocG9zID09PSAwIHx8IHBvcyA9PT0gMSkgewogICAgICBwcmVkZWZpbmVkID0gdHJ1ZTsKICAgICAgZm9ybWF0ID0gcG9zOwogICAgICBjb25zdCBiYXNlRW5jb2RpbmcgPSBwb3MgPyBFeHBlcnRFbmNvZGluZyA6IFN0YW5kYXJkRW5jb2Rpbmc7CiAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hhcnNldC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgaW5kZXggPSBiYXNlRW5jb2RpbmcuaW5kZXhPZihjaGFyc2V0W2ldKTsKICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICBlbmNvZGluZ1tpbmRleF0gPSBpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZGF0YVN0YXJ0ID0gcG9zOwogICAgICBmb3JtYXQgPSBieXRlc1twb3MrK107CiAgICAgIHN3aXRjaCAoZm9ybWF0ICYgMHg3ZikgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGNvbnN0IGdseXBoc0NvdW50ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgZm9yIChpID0gMTsgaSA8PSBnbHlwaHNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGVuY29kaW5nW2J5dGVzW3BvcysrXV0gPSBpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgY29uc3QgcmFuZ2VzQ291bnQgPSBieXRlc1twb3MrK107CiAgICAgICAgICBsZXQgZ2lkID0gMTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByYW5nZXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgICBjb25zdCBsZWZ0ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgICBmb3IgKGxldCBqID0gc3RhcnQ7IGogPD0gc3RhcnQgKyBsZWZ0OyBqKyspIHsKICAgICAgICAgICAgICBlbmNvZGluZ1tqXSA9IGdpZCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIGVuY29kaW5nIGZvcm1hdDogJHtmb3JtYXR9IGluIENGRmApOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGFFbmQgPSBwb3M7CiAgICAgIGlmIChmb3JtYXQgJiAweDgwKSB7CiAgICAgICAgYnl0ZXNbZGF0YVN0YXJ0XSAmPSAweDdmOwogICAgICAgIHJlYWRTdXBwbGVtZW50KCk7CiAgICAgIH0KICAgICAgcmF3ID0gYnl0ZXMuc3ViYXJyYXkoZGF0YVN0YXJ0LCBkYXRhRW5kKTsKICAgIH0KICAgIGZvcm1hdCAmPSAweDdmOwogICAgcmV0dXJuIG5ldyBDRkZFbmNvZGluZyhwcmVkZWZpbmVkLCBmb3JtYXQsIGVuY29kaW5nLCByYXcpOwogIH0KICBwYXJzZUZEU2VsZWN0KHBvcywgbGVuZ3RoKSB7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBmb3JtYXQgPSBieXRlc1twb3MrK107CiAgICBjb25zdCBmZFNlbGVjdCA9IFtdOwogICAgbGV0IGk7CiAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICBjYXNlIDA6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBjb25zdCBpZCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGZkU2VsZWN0LnB1c2goaWQpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIGNvbnN0IHJhbmdlc0NvdW50ID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJhbmdlc0NvdW50OyArK2kpIHsKICAgICAgICAgIGxldCBmaXJzdCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgaWYgKGkgPT09IDAgJiYgZmlyc3QgIT09IDApIHsKICAgICAgICAgICAgd2FybigicGFyc2VGRFNlbGVjdDogVGhlIGZpcnN0IHJhbmdlIG11c3QgaGF2ZSBhIGZpcnN0IEdJRCBvZiAwIiArICIgLS0gdHJ5aW5nIHRvIHJlY292ZXIuIik7CiAgICAgICAgICAgIGZpcnN0ID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGZkSW5kZXggPSBieXRlc1twb3MrK107CiAgICAgICAgICBjb25zdCBuZXh0ID0gYnl0ZXNbcG9zXSA8PCA4IHwgYnl0ZXNbcG9zICsgMV07CiAgICAgICAgICBmb3IgKGxldCBqID0gZmlyc3Q7IGogPCBuZXh0OyArK2opIHsKICAgICAgICAgICAgZmRTZWxlY3QucHVzaChmZEluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcG9zICs9IDI7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBwYXJzZUZEU2VsZWN0OiBVbmtub3duIGZvcm1hdCAiJHtmb3JtYXR9Ii5gKTsKICAgIH0KICAgIGlmIChmZFNlbGVjdC5sZW5ndGggIT09IGxlbmd0aCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoInBhcnNlRkRTZWxlY3Q6IEludmFsaWQgZm9udCBkYXRhLiIpOwogICAgfQogICAgcmV0dXJuIG5ldyBDRkZGRFNlbGVjdChmb3JtYXQsIGZkU2VsZWN0KTsKICB9Cn0KY2xhc3MgQ0ZGIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuaGVhZGVyID0gbnVsbDsKICAgIHRoaXMubmFtZXMgPSBbXTsKICAgIHRoaXMudG9wRGljdCA9IG51bGw7CiAgICB0aGlzLnN0cmluZ3MgPSBuZXcgQ0ZGU3RyaW5ncygpOwogICAgdGhpcy5nbG9iYWxTdWJySW5kZXggPSBudWxsOwogICAgdGhpcy5lbmNvZGluZyA9IG51bGw7CiAgICB0aGlzLmNoYXJzZXQgPSBudWxsOwogICAgdGhpcy5jaGFyU3RyaW5ncyA9IG51bGw7CiAgICB0aGlzLmZkQXJyYXkgPSBbXTsKICAgIHRoaXMuZmRTZWxlY3QgPSBudWxsOwogICAgdGhpcy5pc0NJREZvbnQgPSBmYWxzZTsKICAgIHRoaXMuY2hhclN0cmluZ0NvdW50ID0gMDsKICB9CiAgZHVwbGljYXRlRmlyc3RHbHlwaCgpIHsKICAgIGlmICh0aGlzLmNoYXJTdHJpbmdzLmNvdW50ID49IDY1NTM1KSB7CiAgICAgIHdhcm4oIk5vdCBlbm91Z2ggc3BhY2UgaW4gY2hhcnN0cmluZ3MgdG8gZHVwbGljYXRlIGZpcnN0IGdseXBoLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBnbHlwaFplcm8gPSB0aGlzLmNoYXJTdHJpbmdzLmdldCgwKTsKICAgIHRoaXMuY2hhclN0cmluZ3MuYWRkKGdseXBoWmVybyk7CiAgICBpZiAodGhpcy5pc0NJREZvbnQpIHsKICAgICAgdGhpcy5mZFNlbGVjdC5mZFNlbGVjdC5wdXNoKHRoaXMuZmRTZWxlY3QuZmRTZWxlY3RbMF0pOwogICAgfQogIH0KICBoYXNHbHlwaElkKGlkKSB7CiAgICBpZiAoaWQgPCAwIHx8IGlkID49IHRoaXMuY2hhclN0cmluZ3MuY291bnQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgZ2x5cGggPSB0aGlzLmNoYXJTdHJpbmdzLmdldChpZCk7CiAgICByZXR1cm4gZ2x5cGgubGVuZ3RoID4gMDsKICB9Cn0KY2xhc3MgQ0ZGSGVhZGVyIHsKICBjb25zdHJ1Y3RvcihtYWpvciwgbWlub3IsIGhkclNpemUsIG9mZlNpemUpIHsKICAgIHRoaXMubWFqb3IgPSBtYWpvcjsKICAgIHRoaXMubWlub3IgPSBtaW5vcjsKICAgIHRoaXMuaGRyU2l6ZSA9IGhkclNpemU7CiAgICB0aGlzLm9mZlNpemUgPSBvZmZTaXplOwogIH0KfQpjbGFzcyBDRkZTdHJpbmdzIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuc3RyaW5ncyA9IFtdOwogIH0KICBnZXQoaW5kZXgpIHsKICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4IDw9IE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HUyAtIDEpIHsKICAgICAgcmV0dXJuIENGRlN0YW5kYXJkU3RyaW5nc1tpbmRleF07CiAgICB9CiAgICBpZiAoaW5kZXggLSBOVU1fU1RBTkRBUkRfQ0ZGX1NUUklOR1MgPD0gdGhpcy5zdHJpbmdzLmxlbmd0aCkgewogICAgICByZXR1cm4gdGhpcy5zdHJpbmdzW2luZGV4IC0gTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTXTsKICAgIH0KICAgIHJldHVybiBDRkZTdGFuZGFyZFN0cmluZ3NbMF07CiAgfQogIGdldFNJRChzdHIpIHsKICAgIGxldCBpbmRleCA9IENGRlN0YW5kYXJkU3RyaW5ncy5pbmRleE9mKHN0cik7CiAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgIHJldHVybiBpbmRleDsKICAgIH0KICAgIGluZGV4ID0gdGhpcy5zdHJpbmdzLmluZGV4T2Yoc3RyKTsKICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgcmV0dXJuIGluZGV4ICsgTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTOwogICAgfQogICAgcmV0dXJuIC0xOwogIH0KICBhZGQodmFsdWUpIHsKICAgIHRoaXMuc3RyaW5ncy5wdXNoKHZhbHVlKTsKICB9CiAgZ2V0IGNvdW50KCkgewogICAgcmV0dXJuIHRoaXMuc3RyaW5ncy5sZW5ndGg7CiAgfQp9CmNsYXNzIENGRkluZGV4IHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgdGhpcy5sZW5ndGggPSAwOwogIH0KICBhZGQoZGF0YSkgewogICAgdGhpcy5sZW5ndGggKz0gZGF0YS5sZW5ndGg7CiAgICB0aGlzLm9iamVjdHMucHVzaChkYXRhKTsKICB9CiAgc2V0KGluZGV4LCBkYXRhKSB7CiAgICB0aGlzLmxlbmd0aCArPSBkYXRhLmxlbmd0aCAtIHRoaXMub2JqZWN0c1tpbmRleF0ubGVuZ3RoOwogICAgdGhpcy5vYmplY3RzW2luZGV4XSA9IGRhdGE7CiAgfQogIGdldChpbmRleCkgewogICAgcmV0dXJuIHRoaXMub2JqZWN0c1tpbmRleF07CiAgfQogIGdldCBjb3VudCgpIHsKICAgIHJldHVybiB0aGlzLm9iamVjdHMubGVuZ3RoOwogIH0KfQpjbGFzcyBDRkZEaWN0IHsKICBjb25zdHJ1Y3Rvcih0YWJsZXMsIHN0cmluZ3MpIHsKICAgIHRoaXMua2V5VG9OYW1lTWFwID0gdGFibGVzLmtleVRvTmFtZU1hcDsKICAgIHRoaXMubmFtZVRvS2V5TWFwID0gdGFibGVzLm5hbWVUb0tleU1hcDsKICAgIHRoaXMuZGVmYXVsdHMgPSB0YWJsZXMuZGVmYXVsdHM7CiAgICB0aGlzLnR5cGVzID0gdGFibGVzLnR5cGVzOwogICAgdGhpcy5vcGNvZGVzID0gdGFibGVzLm9wY29kZXM7CiAgICB0aGlzLm9yZGVyID0gdGFibGVzLm9yZGVyOwogICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczsKICAgIHRoaXMudmFsdWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB9CiAgc2V0QnlLZXkoa2V5LCB2YWx1ZSkgewogICAgaWYgKCEoa2V5IGluIHRoaXMua2V5VG9OYW1lTWFwKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZm9yIChjb25zdCB2YWwgb2YgdmFsdWUpIHsKICAgICAgaWYgKGlzTmFOKHZhbCkpIHsKICAgICAgICB3YXJuKGBJbnZhbGlkIENGRkRpY3QgdmFsdWU6ICIke3ZhbHVlfSIgZm9yIGtleSAiJHtrZXl9Ii5gKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgY29uc3QgdHlwZSA9IHRoaXMudHlwZXNba2V5XTsKICAgIGlmICh0eXBlID09PSAibnVtIiB8fCB0eXBlID09PSAic2lkIiB8fCB0eXBlID09PSAib2Zmc2V0IikgewogICAgICB2YWx1ZSA9IHZhbHVlWzBdOwogICAgfQogICAgdGhpcy52YWx1ZXNba2V5XSA9IHZhbHVlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIHNldEJ5TmFtZShuYW1lLCB2YWx1ZSkgewogICAgaWYgKCEobmFtZSBpbiB0aGlzLm5hbWVUb0tleU1hcCkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGRpY3Rpb25hcnkgbmFtZSAiJHtuYW1lfSJgKTsKICAgIH0KICAgIHRoaXMudmFsdWVzW3RoaXMubmFtZVRvS2V5TWFwW25hbWVdXSA9IHZhbHVlOwogIH0KICBoYXNOYW1lKG5hbWUpIHsKICAgIHJldHVybiB0aGlzLm5hbWVUb0tleU1hcFtuYW1lXSBpbiB0aGlzLnZhbHVlczsKICB9CiAgZ2V0QnlOYW1lKG5hbWUpIHsKICAgIGlmICghKG5hbWUgaW4gdGhpcy5uYW1lVG9LZXlNYXApKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBkaWN0aW9uYXJ5IG5hbWUgJHtuYW1lfSJgKTsKICAgIH0KICAgIGNvbnN0IGtleSA9IHRoaXMubmFtZVRvS2V5TWFwW25hbWVdOwogICAgaWYgKCEoa2V5IGluIHRoaXMudmFsdWVzKSkgewogICAgICByZXR1cm4gdGhpcy5kZWZhdWx0c1trZXldOwogICAgfQogICAgcmV0dXJuIHRoaXMudmFsdWVzW2tleV07CiAgfQogIHJlbW92ZUJ5TmFtZShuYW1lKSB7CiAgICBkZWxldGUgdGhpcy52YWx1ZXNbdGhpcy5uYW1lVG9LZXlNYXBbbmFtZV1dOwogIH0KICBzdGF0aWMgY3JlYXRlVGFibGVzKGxheW91dCkgewogICAgY29uc3QgdGFibGVzID0gewogICAgICBrZXlUb05hbWVNYXA6IHt9LAogICAgICBuYW1lVG9LZXlNYXA6IHt9LAogICAgICBkZWZhdWx0czoge30sCiAgICAgIHR5cGVzOiB7fSwKICAgICAgb3Bjb2Rlczoge30sCiAgICAgIG9yZGVyOiBbXQogICAgfTsKICAgIGZvciAoY29uc3QgZW50cnkgb2YgbGF5b3V0KSB7CiAgICAgIGNvbnN0IGtleSA9IEFycmF5LmlzQXJyYXkoZW50cnlbMF0pID8gKGVudHJ5WzBdWzBdIDw8IDgpICsgZW50cnlbMF1bMV0gOiBlbnRyeVswXTsKICAgICAgdGFibGVzLmtleVRvTmFtZU1hcFtrZXldID0gZW50cnlbMV07CiAgICAgIHRhYmxlcy5uYW1lVG9LZXlNYXBbZW50cnlbMV1dID0ga2V5OwogICAgICB0YWJsZXMudHlwZXNba2V5XSA9IGVudHJ5WzJdOwogICAgICB0YWJsZXMuZGVmYXVsdHNba2V5XSA9IGVudHJ5WzNdOwogICAgICB0YWJsZXMub3Bjb2Rlc1trZXldID0gQXJyYXkuaXNBcnJheShlbnRyeVswXSkgPyBlbnRyeVswXSA6IFtlbnRyeVswXV07CiAgICAgIHRhYmxlcy5vcmRlci5wdXNoKGtleSk7CiAgICB9CiAgICByZXR1cm4gdGFibGVzOwogIH0KfQpjb25zdCBDRkZUb3BEaWN0TGF5b3V0ID0gW1tbMTIsIDMwXSwgIlJPUyIsIFsic2lkIiwgInNpZCIsICJudW0iXSwgbnVsbF0sIFtbMTIsIDIwXSwgIlN5bnRoZXRpY0Jhc2UiLCAibnVtIiwgbnVsbF0sIFswLCAidmVyc2lvbiIsICJzaWQiLCBudWxsXSwgWzEsICJOb3RpY2UiLCAic2lkIiwgbnVsbF0sIFtbMTIsIDBdLCAiQ29weXJpZ2h0IiwgInNpZCIsIG51bGxdLCBbMiwgIkZ1bGxOYW1lIiwgInNpZCIsIG51bGxdLCBbMywgIkZhbWlseU5hbWUiLCAic2lkIiwgbnVsbF0sIFs0LCAiV2VpZ2h0IiwgInNpZCIsIG51bGxdLCBbWzEyLCAxXSwgImlzRml4ZWRQaXRjaCIsICJudW0iLCAwXSwgW1sxMiwgMl0sICJJdGFsaWNBbmdsZSIsICJudW0iLCAwXSwgW1sxMiwgM10sICJVbmRlcmxpbmVQb3NpdGlvbiIsICJudW0iLCAtMTAwXSwgW1sxMiwgNF0sICJVbmRlcmxpbmVUaGlja25lc3MiLCAibnVtIiwgNTBdLCBbWzEyLCA1XSwgIlBhaW50VHlwZSIsICJudW0iLCAwXSwgW1sxMiwgNl0sICJDaGFyc3RyaW5nVHlwZSIsICJudW0iLCAyXSwgW1sxMiwgN10sICJGb250TWF0cml4IiwgWyJudW0iLCAibnVtIiwgIm51bSIsICJudW0iLCAibnVtIiwgIm51bSJdLCBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXV0sIFsxMywgIlVuaXF1ZUlEIiwgIm51bSIsIG51bGxdLCBbNSwgIkZvbnRCQm94IiwgWyJudW0iLCAibnVtIiwgIm51bSIsICJudW0iXSwgWzAsIDAsIDAsIDBdXSwgW1sxMiwgOF0sICJTdHJva2VXaWR0aCIsICJudW0iLCAwXSwgWzE0LCAiWFVJRCIsICJhcnJheSIsIG51bGxdLCBbMTUsICJjaGFyc2V0IiwgIm9mZnNldCIsIDBdLCBbMTYsICJFbmNvZGluZyIsICJvZmZzZXQiLCAwXSwgWzE3LCAiQ2hhclN0cmluZ3MiLCAib2Zmc2V0IiwgMF0sIFsxOCwgIlByaXZhdGUiLCBbIm9mZnNldCIsICJvZmZzZXQiXSwgbnVsbF0sIFtbMTIsIDIxXSwgIlBvc3RTY3JpcHQiLCAic2lkIiwgbnVsbF0sIFtbMTIsIDIyXSwgIkJhc2VGb250TmFtZSIsICJzaWQiLCBudWxsXSwgW1sxMiwgMjNdLCAiQmFzZUZvbnRCbGVuZCIsICJkZWx0YSIsIG51bGxdLCBbWzEyLCAzMV0sICJDSURGb250VmVyc2lvbiIsICJudW0iLCAwXSwgW1sxMiwgMzJdLCAiQ0lERm9udFJldmlzaW9uIiwgIm51bSIsIDBdLCBbWzEyLCAzM10sICJDSURGb250VHlwZSIsICJudW0iLCAwXSwgW1sxMiwgMzRdLCAiQ0lEQ291bnQiLCAibnVtIiwgODcyMF0sIFtbMTIsIDM1XSwgIlVJREJhc2UiLCAibnVtIiwgbnVsbF0sIFtbMTIsIDM3XSwgIkZEU2VsZWN0IiwgIm9mZnNldCIsIG51bGxdLCBbWzEyLCAzNl0sICJGREFycmF5IiwgIm9mZnNldCIsIG51bGxdLCBbWzEyLCAzOF0sICJGb250TmFtZSIsICJzaWQiLCBudWxsXV07CmNsYXNzIENGRlRvcERpY3QgZXh0ZW5kcyBDRkZEaWN0IHsKICBzdGF0aWMgZ2V0IHRhYmxlcygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInRhYmxlcyIsIHRoaXMuY3JlYXRlVGFibGVzKENGRlRvcERpY3RMYXlvdXQpKTsKICB9CiAgY29uc3RydWN0b3Ioc3RyaW5ncykgewogICAgc3VwZXIoQ0ZGVG9wRGljdC50YWJsZXMsIHN0cmluZ3MpOwogICAgdGhpcy5wcml2YXRlRGljdCA9IG51bGw7CiAgfQp9CmNvbnN0IENGRlByaXZhdGVEaWN0TGF5b3V0ID0gW1s2LCAiQmx1ZVZhbHVlcyIsICJkZWx0YSIsIG51bGxdLCBbNywgIk90aGVyQmx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgWzgsICJGYW1pbHlCbHVlcyIsICJkZWx0YSIsIG51bGxdLCBbOSwgIkZhbWlseU90aGVyQmx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgW1sxMiwgOV0sICJCbHVlU2NhbGUiLCAibnVtIiwgMC4wMzk2MjVdLCBbWzEyLCAxMF0sICJCbHVlU2hpZnQiLCAibnVtIiwgN10sIFtbMTIsIDExXSwgIkJsdWVGdXp6IiwgIm51bSIsIDFdLCBbMTAsICJTdGRIVyIsICJudW0iLCBudWxsXSwgWzExLCAiU3RkVlciLCAibnVtIiwgbnVsbF0sIFtbMTIsIDEyXSwgIlN0ZW1TbmFwSCIsICJkZWx0YSIsIG51bGxdLCBbWzEyLCAxM10sICJTdGVtU25hcFYiLCAiZGVsdGEiLCBudWxsXSwgW1sxMiwgMTRdLCAiRm9yY2VCb2xkIiwgIm51bSIsIDBdLCBbWzEyLCAxN10sICJMYW5ndWFnZUdyb3VwIiwgIm51bSIsIDBdLCBbWzEyLCAxOF0sICJFeHBhbnNpb25GYWN0b3IiLCAibnVtIiwgMC4wNl0sIFtbMTIsIDE5XSwgImluaXRpYWxSYW5kb21TZWVkIiwgIm51bSIsIDBdLCBbMjAsICJkZWZhdWx0V2lkdGhYIiwgIm51bSIsIDBdLCBbMjEsICJub21pbmFsV2lkdGhYIiwgIm51bSIsIDBdLCBbMTksICJTdWJycyIsICJvZmZzZXQiLCBudWxsXV07CmNsYXNzIENGRlByaXZhdGVEaWN0IGV4dGVuZHMgQ0ZGRGljdCB7CiAgc3RhdGljIGdldCB0YWJsZXMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ0YWJsZXMiLCB0aGlzLmNyZWF0ZVRhYmxlcyhDRkZQcml2YXRlRGljdExheW91dCkpOwogIH0KICBjb25zdHJ1Y3RvcihzdHJpbmdzKSB7CiAgICBzdXBlcihDRkZQcml2YXRlRGljdC50YWJsZXMsIHN0cmluZ3MpOwogICAgdGhpcy5zdWJyc0luZGV4ID0gbnVsbDsKICB9Cn0KY29uc3QgQ0ZGQ2hhcnNldFByZWRlZmluZWRUeXBlcyA9IHsKICBJU09fQURPQkU6IDAsCiAgRVhQRVJUOiAxLAogIEVYUEVSVF9TVUJTRVQ6IDIKfTsKY2xhc3MgQ0ZGQ2hhcnNldCB7CiAgY29uc3RydWN0b3IocHJlZGVmaW5lZCwgZm9ybWF0LCBjaGFyc2V0LCByYXcpIHsKICAgIHRoaXMucHJlZGVmaW5lZCA9IHByZWRlZmluZWQ7CiAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKICAgIHRoaXMuY2hhcnNldCA9IGNoYXJzZXQ7CiAgICB0aGlzLnJhdyA9IHJhdzsKICB9Cn0KY2xhc3MgQ0ZGRW5jb2RpbmcgewogIGNvbnN0cnVjdG9yKHByZWRlZmluZWQsIGZvcm1hdCwgZW5jb2RpbmcsIHJhdykgewogICAgdGhpcy5wcmVkZWZpbmVkID0gcHJlZGVmaW5lZDsKICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwogICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwogICAgdGhpcy5yYXcgPSByYXc7CiAgfQp9CmNsYXNzIENGRkZEU2VsZWN0IHsKICBjb25zdHJ1Y3Rvcihmb3JtYXQsIGZkU2VsZWN0KSB7CiAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKICAgIHRoaXMuZmRTZWxlY3QgPSBmZFNlbGVjdDsKICB9CiAgZ2V0RkRJbmRleChnbHlwaEluZGV4KSB7CiAgICBpZiAoZ2x5cGhJbmRleCA8IDAgfHwgZ2x5cGhJbmRleCA+PSB0aGlzLmZkU2VsZWN0Lmxlbmd0aCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICByZXR1cm4gdGhpcy5mZFNlbGVjdFtnbHlwaEluZGV4XTsKICB9Cn0KY2xhc3MgQ0ZGT2Zmc2V0VHJhY2tlciB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLm9mZnNldHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIH0KICBpc1RyYWNraW5nKGtleSkgewogICAgcmV0dXJuIGtleSBpbiB0aGlzLm9mZnNldHM7CiAgfQogIHRyYWNrKGtleSwgbG9jYXRpb24pIHsKICAgIGlmIChrZXkgaW4gdGhpcy5vZmZzZXRzKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgQWxyZWFkeSB0cmFja2luZyBsb2NhdGlvbiBvZiAke2tleX1gKTsKICAgIH0KICAgIHRoaXMub2Zmc2V0c1trZXldID0gbG9jYXRpb247CiAgfQogIG9mZnNldCh2YWx1ZSkgewogICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5vZmZzZXRzKSB7CiAgICAgIHRoaXMub2Zmc2V0c1trZXldICs9IHZhbHVlOwogICAgfQogIH0KICBzZXRFbnRyeUxvY2F0aW9uKGtleSwgdmFsdWVzLCBvdXRwdXQpIHsKICAgIGlmICghKGtleSBpbiB0aGlzLm9mZnNldHMpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgTm90IHRyYWNraW5nIGxvY2F0aW9uIG9mICR7a2V5fWApOwogICAgfQogICAgY29uc3QgZGF0YSA9IG91dHB1dC5kYXRhOwogICAgY29uc3QgZGF0YU9mZnNldCA9IHRoaXMub2Zmc2V0c1trZXldOwogICAgY29uc3Qgc2l6ZSA9IDU7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB2YWx1ZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBvZmZzZXQwID0gaSAqIHNpemUgKyBkYXRhT2Zmc2V0OwogICAgICBjb25zdCBvZmZzZXQxID0gb2Zmc2V0MCArIDE7CiAgICAgIGNvbnN0IG9mZnNldDIgPSBvZmZzZXQwICsgMjsKICAgICAgY29uc3Qgb2Zmc2V0MyA9IG9mZnNldDAgKyAzOwogICAgICBjb25zdCBvZmZzZXQ0ID0gb2Zmc2V0MCArIDQ7CiAgICAgIGlmIChkYXRhW29mZnNldDBdICE9PSAweDFkIHx8IGRhdGFbb2Zmc2V0MV0gIT09IDAgfHwgZGF0YVtvZmZzZXQyXSAhPT0gMCB8fCBkYXRhW29mZnNldDNdICE9PSAwIHx8IGRhdGFbb2Zmc2V0NF0gIT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIndyaXRpbmcgdG8gYW4gb2Zmc2V0IHRoYXQgaXMgbm90IGVtcHR5Iik7CiAgICAgIH0KICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaV07CiAgICAgIGRhdGFbb2Zmc2V0MF0gPSAweDFkOwogICAgICBkYXRhW29mZnNldDFdID0gdmFsdWUgPj4gMjQgJiAweGZmOwogICAgICBkYXRhW29mZnNldDJdID0gdmFsdWUgPj4gMTYgJiAweGZmOwogICAgICBkYXRhW29mZnNldDNdID0gdmFsdWUgPj4gOCAmIDB4ZmY7CiAgICAgIGRhdGFbb2Zmc2V0NF0gPSB2YWx1ZSAmIDB4ZmY7CiAgICB9CiAgfQp9CmNsYXNzIENGRkNvbXBpbGVyIHsKICBjb25zdHJ1Y3RvcihjZmYpIHsKICAgIHRoaXMuY2ZmID0gY2ZmOwogIH0KICBjb21waWxlKCkgewogICAgY29uc3QgY2ZmID0gdGhpcy5jZmY7CiAgICBjb25zdCBvdXRwdXQgPSB7CiAgICAgIGRhdGE6IFtdLAogICAgICBsZW5ndGg6IDAsCiAgICAgIGFkZChkYXRhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuZGF0YS5wdXNoKC4uLmRhdGEpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5kYXRhLmNvbmNhdChkYXRhKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoOwogICAgICB9CiAgICB9OwogICAgY29uc3QgaGVhZGVyID0gdGhpcy5jb21waWxlSGVhZGVyKGNmZi5oZWFkZXIpOwogICAgb3V0cHV0LmFkZChoZWFkZXIpOwogICAgY29uc3QgbmFtZUluZGV4ID0gdGhpcy5jb21waWxlTmFtZUluZGV4KGNmZi5uYW1lcyk7CiAgICBvdXRwdXQuYWRkKG5hbWVJbmRleCk7CiAgICBpZiAoY2ZmLmlzQ0lERm9udCkgewogICAgICBpZiAoY2ZmLnRvcERpY3QuaGFzTmFtZSgiRm9udE1hdHJpeCIpKSB7CiAgICAgICAgY29uc3QgYmFzZSA9IGNmZi50b3BEaWN0LmdldEJ5TmFtZSgiRm9udE1hdHJpeCIpOwogICAgICAgIGNmZi50b3BEaWN0LnJlbW92ZUJ5TmFtZSgiRm9udE1hdHJpeCIpOwogICAgICAgIGZvciAoY29uc3Qgc3ViRGljdCBvZiBjZmYuZmRBcnJheSkgewogICAgICAgICAgbGV0IG1hdHJpeCA9IGJhc2Uuc2xpY2UoMCk7CiAgICAgICAgICBpZiAoc3ViRGljdC5oYXNOYW1lKCJGb250TWF0cml4IikpIHsKICAgICAgICAgICAgbWF0cml4ID0gVXRpbC50cmFuc2Zvcm0obWF0cml4LCBzdWJEaWN0LmdldEJ5TmFtZSgiRm9udE1hdHJpeCIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHN1YkRpY3Quc2V0QnlOYW1lKCJGb250TWF0cml4IiwgbWF0cml4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHh1aWQgPSBjZmYudG9wRGljdC5nZXRCeU5hbWUoIlhVSUQiKTsKICAgIGlmICh4dWlkPy5sZW5ndGggPiAxNikgewogICAgICBjZmYudG9wRGljdC5yZW1vdmVCeU5hbWUoIlhVSUQiKTsKICAgIH0KICAgIGNmZi50b3BEaWN0LnNldEJ5TmFtZSgiY2hhcnNldCIsIDApOwogICAgbGV0IGNvbXBpbGVkID0gdGhpcy5jb21waWxlVG9wRGljdHMoW2NmZi50b3BEaWN0XSwgb3V0cHV0Lmxlbmd0aCwgY2ZmLmlzQ0lERm9udCk7CiAgICBvdXRwdXQuYWRkKGNvbXBpbGVkLm91dHB1dCk7CiAgICBjb25zdCB0b3BEaWN0VHJhY2tlciA9IGNvbXBpbGVkLnRyYWNrZXJzWzBdOwogICAgY29uc3Qgc3RyaW5nSW5kZXggPSB0aGlzLmNvbXBpbGVTdHJpbmdJbmRleChjZmYuc3RyaW5ncy5zdHJpbmdzKTsKICAgIG91dHB1dC5hZGQoc3RyaW5nSW5kZXgpOwogICAgY29uc3QgZ2xvYmFsU3VickluZGV4ID0gdGhpcy5jb21waWxlSW5kZXgoY2ZmLmdsb2JhbFN1YnJJbmRleCk7CiAgICBvdXRwdXQuYWRkKGdsb2JhbFN1YnJJbmRleCk7CiAgICBpZiAoY2ZmLmVuY29kaW5nICYmIGNmZi50b3BEaWN0Lmhhc05hbWUoIkVuY29kaW5nIikpIHsKICAgICAgaWYgKGNmZi5lbmNvZGluZy5wcmVkZWZpbmVkKSB7CiAgICAgICAgdG9wRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiRW5jb2RpbmciLCBbY2ZmLmVuY29kaW5nLmZvcm1hdF0sIG91dHB1dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZW5jb2RpbmcgPSB0aGlzLmNvbXBpbGVFbmNvZGluZyhjZmYuZW5jb2RpbmcpOwogICAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkVuY29kaW5nIiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgICAgIG91dHB1dC5hZGQoZW5jb2RpbmcpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjaGFyc2V0ID0gdGhpcy5jb21waWxlQ2hhcnNldChjZmYuY2hhcnNldCwgY2ZmLmNoYXJTdHJpbmdzLmNvdW50LCBjZmYuc3RyaW5ncywgY2ZmLmlzQ0lERm9udCk7CiAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJjaGFyc2V0IiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgb3V0cHV0LmFkZChjaGFyc2V0KTsKICAgIGNvbnN0IGNoYXJTdHJpbmdzID0gdGhpcy5jb21waWxlQ2hhclN0cmluZ3MoY2ZmLmNoYXJTdHJpbmdzKTsKICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkNoYXJTdHJpbmdzIiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgb3V0cHV0LmFkZChjaGFyU3RyaW5ncyk7CiAgICBpZiAoY2ZmLmlzQ0lERm9udCkgewogICAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJGRFNlbGVjdCIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgICAgY29uc3QgZmRTZWxlY3QgPSB0aGlzLmNvbXBpbGVGRFNlbGVjdChjZmYuZmRTZWxlY3QpOwogICAgICBvdXRwdXQuYWRkKGZkU2VsZWN0KTsKICAgICAgY29tcGlsZWQgPSB0aGlzLmNvbXBpbGVUb3BEaWN0cyhjZmYuZmRBcnJheSwgb3V0cHV0Lmxlbmd0aCwgdHJ1ZSk7CiAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkZEQXJyYXkiLCBbb3V0cHV0Lmxlbmd0aF0sIG91dHB1dCk7CiAgICAgIG91dHB1dC5hZGQoY29tcGlsZWQub3V0cHV0KTsKICAgICAgY29uc3QgZm9udERpY3RUcmFja2VycyA9IGNvbXBpbGVkLnRyYWNrZXJzOwogICAgICB0aGlzLmNvbXBpbGVQcml2YXRlRGljdHMoY2ZmLmZkQXJyYXksIGZvbnREaWN0VHJhY2tlcnMsIG91dHB1dCk7CiAgICB9CiAgICB0aGlzLmNvbXBpbGVQcml2YXRlRGljdHMoW2NmZi50b3BEaWN0XSwgW3RvcERpY3RUcmFja2VyXSwgb3V0cHV0KTsKICAgIG91dHB1dC5hZGQoWzBdKTsKICAgIHJldHVybiBvdXRwdXQuZGF0YTsKICB9CiAgZW5jb2RlTnVtYmVyKHZhbHVlKSB7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlSW50ZWdlcih2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5lbmNvZGVGbG9hdCh2YWx1ZSk7CiAgfQogIHN0YXRpYyBnZXQgRW5jb2RlRmxvYXRSZWdFeHAoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJFbmNvZGVGbG9hdFJlZ0V4cCIsIC9cLihcZCo/KSg/Ojl7NSwyMH18MHs1LDIwfSlcZHswLDJ9KD86ZSguKyl8JCkvKTsKICB9CiAgZW5jb2RlRmxvYXQobnVtKSB7CiAgICBsZXQgdmFsdWUgPSBudW0udG9TdHJpbmcoKTsKICAgIGNvbnN0IG0gPSBDRkZDb21waWxlci5FbmNvZGVGbG9hdFJlZ0V4cC5leGVjKHZhbHVlKTsKICAgIGlmIChtKSB7CiAgICAgIGNvbnN0IGVwc2lsb24gPSBwYXJzZUZsb2F0KCIxZSIgKyAoKG1bMl0gPyArbVsyXSA6IDApICsgbVsxXS5sZW5ndGgpKTsKICAgICAgdmFsdWUgPSAoTWF0aC5yb3VuZChudW0gKiBlcHNpbG9uKSAvIGVwc2lsb24pLnRvU3RyaW5nKCk7CiAgICB9CiAgICBsZXQgbmliYmxlcyA9ICIiOwogICAgbGV0IGksIGlpOwogICAgZm9yIChpID0gMCwgaWkgPSB2YWx1ZS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IGEgPSB2YWx1ZVtpXTsKICAgICAgaWYgKGEgPT09ICJlIikgewogICAgICAgIG5pYmJsZXMgKz0gdmFsdWVbKytpXSA9PT0gIi0iID8gImMiIDogImIiOwogICAgICB9IGVsc2UgaWYgKGEgPT09ICIuIikgewogICAgICAgIG5pYmJsZXMgKz0gImEiOwogICAgICB9IGVsc2UgaWYgKGEgPT09ICItIikgewogICAgICAgIG5pYmJsZXMgKz0gImUiOwogICAgICB9IGVsc2UgewogICAgICAgIG5pYmJsZXMgKz0gYTsKICAgICAgfQogICAgfQogICAgbmliYmxlcyArPSBuaWJibGVzLmxlbmd0aCAmIDEgPyAiZiIgOiAiZmYiOwogICAgY29uc3Qgb3V0ID0gWzMwXTsKICAgIGZvciAoaSA9IDAsIGlpID0gbmliYmxlcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIG91dC5wdXNoKHBhcnNlSW50KG5pYmJsZXMuc3Vic3RyaW5nKGksIGkgKyAyKSwgMTYpKTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIGVuY29kZUludGVnZXIodmFsdWUpIHsKICAgIGxldCBjb2RlOwogICAgaWYgKHZhbHVlID49IC0xMDcgJiYgdmFsdWUgPD0gMTA3KSB7CiAgICAgIGNvZGUgPSBbdmFsdWUgKyAxMzldOwogICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAxMDggJiYgdmFsdWUgPD0gMTEzMSkgewogICAgICB2YWx1ZSAtPSAxMDg7CiAgICAgIGNvZGUgPSBbKHZhbHVlID4+IDgpICsgMjQ3LCB2YWx1ZSAmIDB4ZmZdOwogICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAtMTEzMSAmJiB2YWx1ZSA8PSAtMTA4KSB7CiAgICAgIHZhbHVlID0gLXZhbHVlIC0gMTA4OwogICAgICBjb2RlID0gWyh2YWx1ZSA+PiA4KSArIDI1MSwgdmFsdWUgJiAweGZmXTsKICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gLTMyNzY4ICYmIHZhbHVlIDw9IDMyNzY3KSB7CiAgICAgIGNvZGUgPSBbMHgxYywgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZl07CiAgICB9IGVsc2UgewogICAgICBjb2RlID0gWzB4MWQsIHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmXTsKICAgIH0KICAgIHJldHVybiBjb2RlOwogIH0KICBjb21waWxlSGVhZGVyKGhlYWRlcikgewogICAgcmV0dXJuIFtoZWFkZXIubWFqb3IsIGhlYWRlci5taW5vciwgNCwgaGVhZGVyLm9mZlNpemVdOwogIH0KICBjb21waWxlTmFtZUluZGV4KG5hbWVzKSB7CiAgICBjb25zdCBuYW1lSW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykgewogICAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1pbihuYW1lLmxlbmd0aCwgMTI3KTsKICAgICAgbGV0IHNhbml0aXplZE5hbWUgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7IGorKykgewogICAgICAgIGxldCBjaGFyID0gbmFtZVtqXTsKICAgICAgICBpZiAoY2hhciA8ICIhIiB8fCBjaGFyID4gIn4iIHx8IGNoYXIgPT09ICJbIiB8fCBjaGFyID09PSAiXSIgfHwgY2hhciA9PT0gIigiIHx8IGNoYXIgPT09ICIpIiB8fCBjaGFyID09PSAieyIgfHwgY2hhciA9PT0gIn0iIHx8IGNoYXIgPT09ICI8IiB8fCBjaGFyID09PSAiPiIgfHwgY2hhciA9PT0gIi8iIHx8IGNoYXIgPT09ICIlIikgewogICAgICAgICAgY2hhciA9ICJfIjsKICAgICAgICB9CiAgICAgICAgc2FuaXRpemVkTmFtZVtqXSA9IGNoYXI7CiAgICAgIH0KICAgICAgc2FuaXRpemVkTmFtZSA9IHNhbml0aXplZE5hbWUuam9pbigiIik7CiAgICAgIGlmIChzYW5pdGl6ZWROYW1lID09PSAiIikgewogICAgICAgIHNhbml0aXplZE5hbWUgPSAiQmFkX0ZvbnRfTmFtZSI7CiAgICAgIH0KICAgICAgbmFtZUluZGV4LmFkZChzdHJpbmdUb0J5dGVzKHNhbml0aXplZE5hbWUpKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVJbmRleChuYW1lSW5kZXgpOwogIH0KICBjb21waWxlVG9wRGljdHMoZGljdHMsIGxlbmd0aCwgcmVtb3ZlQ2lkS2V5cykgewogICAgY29uc3QgZm9udERpY3RUcmFja2VycyA9IFtdOwogICAgbGV0IGZkQXJyYXlJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgZm9yIChjb25zdCBmb250RGljdCBvZiBkaWN0cykgewogICAgICBpZiAocmVtb3ZlQ2lkS2V5cykgewogICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiQ0lERm9udFZlcnNpb24iKTsKICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIkNJREZvbnRSZXZpc2lvbiIpOwogICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiQ0lERm9udFR5cGUiKTsKICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIkNJRENvdW50Iik7CiAgICAgICAgZm9udERpY3QucmVtb3ZlQnlOYW1lKCJVSURCYXNlIik7CiAgICAgIH0KICAgICAgY29uc3QgZm9udERpY3RUcmFja2VyID0gbmV3IENGRk9mZnNldFRyYWNrZXIoKTsKICAgICAgY29uc3QgZm9udERpY3REYXRhID0gdGhpcy5jb21waWxlRGljdChmb250RGljdCwgZm9udERpY3RUcmFja2VyKTsKICAgICAgZm9udERpY3RUcmFja2Vycy5wdXNoKGZvbnREaWN0VHJhY2tlcik7CiAgICAgIGZkQXJyYXlJbmRleC5hZGQoZm9udERpY3REYXRhKTsKICAgICAgZm9udERpY3RUcmFja2VyLm9mZnNldChsZW5ndGgpOwogICAgfQogICAgZmRBcnJheUluZGV4ID0gdGhpcy5jb21waWxlSW5kZXgoZmRBcnJheUluZGV4LCBmb250RGljdFRyYWNrZXJzKTsKICAgIHJldHVybiB7CiAgICAgIHRyYWNrZXJzOiBmb250RGljdFRyYWNrZXJzLAogICAgICBvdXRwdXQ6IGZkQXJyYXlJbmRleAogICAgfTsKICB9CiAgY29tcGlsZVByaXZhdGVEaWN0cyhkaWN0cywgdHJhY2tlcnMsIG91dHB1dCkgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZGljdHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBmb250RGljdCA9IGRpY3RzW2ldOwogICAgICBjb25zdCBwcml2YXRlRGljdCA9IGZvbnREaWN0LnByaXZhdGVEaWN0OwogICAgICBpZiAoIXByaXZhdGVEaWN0IHx8ICFmb250RGljdC5oYXNOYW1lKCJQcml2YXRlIikpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlRoZXJlIG11c3QgYmUgYSBwcml2YXRlIGRpY3Rpb25hcnkuIik7CiAgICAgIH0KICAgICAgY29uc3QgcHJpdmF0ZURpY3RUcmFja2VyID0gbmV3IENGRk9mZnNldFRyYWNrZXIoKTsKICAgICAgY29uc3QgcHJpdmF0ZURpY3REYXRhID0gdGhpcy5jb21waWxlRGljdChwcml2YXRlRGljdCwgcHJpdmF0ZURpY3RUcmFja2VyKTsKICAgICAgbGV0IG91dHB1dExlbmd0aCA9IG91dHB1dC5sZW5ndGg7CiAgICAgIHByaXZhdGVEaWN0VHJhY2tlci5vZmZzZXQob3V0cHV0TGVuZ3RoKTsKICAgICAgaWYgKCFwcml2YXRlRGljdERhdGEubGVuZ3RoKSB7CiAgICAgICAgb3V0cHV0TGVuZ3RoID0gMDsKICAgICAgfQogICAgICB0cmFja2Vyc1tpXS5zZXRFbnRyeUxvY2F0aW9uKCJQcml2YXRlIiwgW3ByaXZhdGVEaWN0RGF0YS5sZW5ndGgsIG91dHB1dExlbmd0aF0sIG91dHB1dCk7CiAgICAgIG91dHB1dC5hZGQocHJpdmF0ZURpY3REYXRhKTsKICAgICAgaWYgKHByaXZhdGVEaWN0LnN1YnJzSW5kZXggJiYgcHJpdmF0ZURpY3QuaGFzTmFtZSgiU3VicnMiKSkgewogICAgICAgIGNvbnN0IHN1YnJzID0gdGhpcy5jb21waWxlSW5kZXgocHJpdmF0ZURpY3Quc3VicnNJbmRleCk7CiAgICAgICAgcHJpdmF0ZURpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIlN1YnJzIiwgW3ByaXZhdGVEaWN0RGF0YS5sZW5ndGhdLCBvdXRwdXQpOwogICAgICAgIG91dHB1dC5hZGQoc3VicnMpOwogICAgICB9CiAgICB9CiAgfQogIGNvbXBpbGVEaWN0KGRpY3QsIG9mZnNldFRyYWNrZXIpIHsKICAgIGNvbnN0IG91dCA9IFtdOwogICAgZm9yIChjb25zdCBrZXkgb2YgZGljdC5vcmRlcikgewogICAgICBpZiAoIShrZXkgaW4gZGljdC52YWx1ZXMpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IHZhbHVlcyA9IGRpY3QudmFsdWVzW2tleV07CiAgICAgIGxldCB0eXBlcyA9IGRpY3QudHlwZXNba2V5XTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHR5cGVzKSkgewogICAgICAgIHR5cGVzID0gW3R5cGVzXTsKICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWVzKSkgewogICAgICAgIHZhbHVlcyA9IFt2YWx1ZXNdOwogICAgICB9CiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gdHlwZXMubGVuZ3RoOyBqIDwgamo7ICsraikgewogICAgICAgIGNvbnN0IHR5cGUgPSB0eXBlc1tqXTsKICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlc1tqXTsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgIm51bSI6CiAgICAgICAgICBjYXNlICJzaWQiOgogICAgICAgICAgICBvdXQucHVzaCguLi50aGlzLmVuY29kZU51bWJlcih2YWx1ZSkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIm9mZnNldCI6CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBkaWN0LmtleVRvTmFtZU1hcFtrZXldOwogICAgICAgICAgICBpZiAoIW9mZnNldFRyYWNrZXIuaXNUcmFja2luZyhuYW1lKSkgewogICAgICAgICAgICAgIG9mZnNldFRyYWNrZXIudHJhY2sobmFtZSwgb3V0Lmxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0LnB1c2goMHgxZCwgMCwgMCwgMCwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYXJyYXkiOgogICAgICAgICAgY2FzZSAiZGVsdGEiOgogICAgICAgICAgICBvdXQucHVzaCguLi50aGlzLmVuY29kZU51bWJlcih2YWx1ZSkpOwogICAgICAgICAgICBmb3IgKGxldCBrID0gMSwga2sgPSB2YWx1ZXMubGVuZ3RoOyBrIDwga2s7ICsraykgewogICAgICAgICAgICAgIG91dC5wdXNoKC4uLnRoaXMuZW5jb2RlTnVtYmVyKHZhbHVlc1trXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIGRhdGEgdHlwZSBvZiAke3R5cGV9YCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIG91dC5wdXNoKC4uLmRpY3Qub3Bjb2Rlc1trZXldKTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIGNvbXBpbGVTdHJpbmdJbmRleChzdHJpbmdzKSB7CiAgICBjb25zdCBzdHJpbmdJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgZm9yIChjb25zdCBzdHJpbmcgb2Ygc3RyaW5ncykgewogICAgICBzdHJpbmdJbmRleC5hZGQoc3RyaW5nVG9CeXRlcyhzdHJpbmcpKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVJbmRleChzdHJpbmdJbmRleCk7CiAgfQogIGNvbXBpbGVDaGFyU3RyaW5ncyhjaGFyU3RyaW5ncykgewogICAgY29uc3QgY2hhclN0cmluZ3NJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGFyU3RyaW5ncy5jb3VudDsgaSsrKSB7CiAgICAgIGNvbnN0IGdseXBoID0gY2hhclN0cmluZ3MuZ2V0KGkpOwogICAgICBpZiAoZ2x5cGgubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY2hhclN0cmluZ3NJbmRleC5hZGQobmV3IFVpbnQ4QXJyYXkoWzB4OGIsIDB4MGVdKSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY2hhclN0cmluZ3NJbmRleC5hZGQoZ2x5cGgpOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29tcGlsZUluZGV4KGNoYXJTdHJpbmdzSW5kZXgpOwogIH0KICBjb21waWxlQ2hhcnNldChjaGFyc2V0LCBudW1HbHlwaHMsIHN0cmluZ3MsIGlzQ0lERm9udCkgewogICAgbGV0IG91dDsKICAgIGNvbnN0IG51bUdseXBoc0xlc3NOb3REZWYgPSBudW1HbHlwaHMgLSAxOwogICAgaWYgKGlzQ0lERm9udCkgewogICAgICBjb25zdCBuTGVmdCA9IG51bUdseXBoc0xlc3NOb3REZWYgLSAxOwogICAgICBvdXQgPSBuZXcgVWludDhBcnJheShbMiwgMCwgMSwgbkxlZnQgPj4gOCAmIDB4ZmYsIG5MZWZ0ICYgMHhmZl0pOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgbGVuZ3RoID0gMSArIG51bUdseXBoc0xlc3NOb3REZWYgKiAyOwogICAgICBvdXQgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgICBvdXRbMF0gPSAwOwogICAgICBsZXQgY2hhcnNldEluZGV4ID0gMDsKICAgICAgY29uc3QgbnVtQ2hhcnNldHMgPSBjaGFyc2V0LmNoYXJzZXQubGVuZ3RoOwogICAgICBsZXQgd2FybmVkID0gZmFsc2U7CiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgb3V0Lmxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgbGV0IHNpZCA9IDA7CiAgICAgICAgaWYgKGNoYXJzZXRJbmRleCA8IG51bUNoYXJzZXRzKSB7CiAgICAgICAgICBjb25zdCBuYW1lID0gY2hhcnNldC5jaGFyc2V0W2NoYXJzZXRJbmRleCsrXTsKICAgICAgICAgIHNpZCA9IHN0cmluZ3MuZ2V0U0lEKG5hbWUpOwogICAgICAgICAgaWYgKHNpZCA9PT0gLTEpIHsKICAgICAgICAgICAgc2lkID0gMDsKICAgICAgICAgICAgaWYgKCF3YXJuZWQpIHsKICAgICAgICAgICAgICB3YXJuZWQgPSB0cnVlOwogICAgICAgICAgICAgIHdhcm4oYENvdWxkbid0IGZpbmQgJHtuYW1lfSBpbiBDRkYgc3RyaW5nc2ApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG91dFtpXSA9IHNpZCA+PiA4ICYgMHhmZjsKICAgICAgICBvdXRbaSArIDFdID0gc2lkICYgMHhmZjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMuY29tcGlsZVR5cGVkQXJyYXkob3V0KTsKICB9CiAgY29tcGlsZUVuY29kaW5nKGVuY29kaW5nKSB7CiAgICByZXR1cm4gdGhpcy5jb21waWxlVHlwZWRBcnJheShlbmNvZGluZy5yYXcpOwogIH0KICBjb21waWxlRkRTZWxlY3QoZmRTZWxlY3QpIHsKICAgIGNvbnN0IGZvcm1hdCA9IGZkU2VsZWN0LmZvcm1hdDsKICAgIGxldCBvdXQsIGk7CiAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICBjYXNlIDA6CiAgICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoMSArIGZkU2VsZWN0LmZkU2VsZWN0Lmxlbmd0aCk7CiAgICAgICAgb3V0WzBdID0gZm9ybWF0OwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBmZFNlbGVjdC5mZFNlbGVjdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgb3V0W2kgKyAxXSA9IGZkU2VsZWN0LmZkU2VsZWN0W2ldOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIGNvbnN0IHN0YXJ0ID0gMDsKICAgICAgICBsZXQgbGFzdEZEID0gZmRTZWxlY3QuZmRTZWxlY3RbMF07CiAgICAgICAgY29uc3QgcmFuZ2VzID0gW2Zvcm1hdCwgMCwgMCwgc3RhcnQgPj4gOCAmIDB4ZmYsIHN0YXJ0ICYgMHhmZiwgbGFzdEZEXTsKICAgICAgICBmb3IgKGkgPSAxOyBpIDwgZmRTZWxlY3QuZmRTZWxlY3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRGRCA9IGZkU2VsZWN0LmZkU2VsZWN0W2ldOwogICAgICAgICAgaWYgKGN1cnJlbnRGRCAhPT0gbGFzdEZEKSB7CiAgICAgICAgICAgIHJhbmdlcy5wdXNoKGkgPj4gOCAmIDB4ZmYsIGkgJiAweGZmLCBjdXJyZW50RkQpOwogICAgICAgICAgICBsYXN0RkQgPSBjdXJyZW50RkQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IG51bVJhbmdlcyA9IChyYW5nZXMubGVuZ3RoIC0gMykgLyAzOwogICAgICAgIHJhbmdlc1sxXSA9IG51bVJhbmdlcyA+PiA4ICYgMHhmZjsKICAgICAgICByYW5nZXNbMl0gPSBudW1SYW5nZXMgJiAweGZmOwogICAgICAgIHJhbmdlcy5wdXNoKGkgPj4gOCAmIDB4ZmYsIGkgJiAweGZmKTsKICAgICAgICBvdXQgPSBuZXcgVWludDhBcnJheShyYW5nZXMpOwogICAgICAgIGJyZWFrOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29tcGlsZVR5cGVkQXJyYXkob3V0KTsKICB9CiAgY29tcGlsZVR5cGVkQXJyYXkoZGF0YSkgewogICAgcmV0dXJuIEFycmF5LmZyb20oZGF0YSk7CiAgfQogIGNvbXBpbGVJbmRleChpbmRleCwgdHJhY2tlcnMgPSBbXSkgewogICAgY29uc3Qgb2JqZWN0cyA9IGluZGV4Lm9iamVjdHM7CiAgICBjb25zdCBjb3VudCA9IG9iamVjdHMubGVuZ3RoOwogICAgaWYgKGNvdW50ID09PSAwKSB7CiAgICAgIHJldHVybiBbMCwgMF07CiAgICB9CiAgICBjb25zdCBkYXRhID0gW2NvdW50ID4+IDggJiAweGZmLCBjb3VudCAmIDB4ZmZdOwogICAgbGV0IGxhc3RPZmZzZXQgPSAxLAogICAgICBpOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgbGFzdE9mZnNldCArPSBvYmplY3RzW2ldLmxlbmd0aDsKICAgIH0KICAgIGxldCBvZmZzZXRTaXplOwogICAgaWYgKGxhc3RPZmZzZXQgPCAweDEwMCkgewogICAgICBvZmZzZXRTaXplID0gMTsKICAgIH0gZWxzZSBpZiAobGFzdE9mZnNldCA8IDB4MTAwMDApIHsKICAgICAgb2Zmc2V0U2l6ZSA9IDI7CiAgICB9IGVsc2UgaWYgKGxhc3RPZmZzZXQgPCAweDEwMDAwMDApIHsKICAgICAgb2Zmc2V0U2l6ZSA9IDM7CiAgICB9IGVsc2UgewogICAgICBvZmZzZXRTaXplID0gNDsKICAgIH0KICAgIGRhdGEucHVzaChvZmZzZXRTaXplKTsKICAgIGxldCByZWxhdGl2ZU9mZnNldCA9IDE7CiAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQgKyAxOyBpKyspIHsKICAgICAgaWYgKG9mZnNldFNpemUgPT09IDEpIHsKICAgICAgICBkYXRhLnB1c2gocmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgfSBlbHNlIGlmIChvZmZzZXRTaXplID09PSAyKSB7CiAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ID4+IDggJiAweGZmLCByZWxhdGl2ZU9mZnNldCAmIDB4ZmYpOwogICAgICB9IGVsc2UgaWYgKG9mZnNldFNpemUgPT09IDMpIHsKICAgICAgICBkYXRhLnB1c2gocmVsYXRpdmVPZmZzZXQgPj4gMTYgJiAweGZmLCByZWxhdGl2ZU9mZnNldCA+PiA4ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkYXRhLnB1c2gocmVsYXRpdmVPZmZzZXQgPj4+IDI0ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgPj4gMTYgJiAweGZmLCByZWxhdGl2ZU9mZnNldCA+PiA4ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgfQogICAgICBpZiAob2JqZWN0c1tpXSkgewogICAgICAgIHJlbGF0aXZlT2Zmc2V0ICs9IG9iamVjdHNbaV0ubGVuZ3RoOwogICAgICB9CiAgICB9CiAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICBpZiAodHJhY2tlcnNbaV0pIHsKICAgICAgICB0cmFja2Vyc1tpXS5vZmZzZXQoZGF0YS5sZW5ndGgpOwogICAgICB9CiAgICAgIGRhdGEucHVzaCguLi5vYmplY3RzW2ldKTsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvc3RhbmRhcmRfZm9udHMuanMKCgpjb25zdCBnZXRTdGRGb250TWFwID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdFsiVGltZXMtUm9tYW4iXSA9ICJUaW1lcy1Sb21hbiI7CiAgdC5IZWx2ZXRpY2EgPSAiSGVsdmV0aWNhIjsKICB0LkNvdXJpZXIgPSAiQ291cmllciI7CiAgdC5TeW1ib2wgPSAiU3ltYm9sIjsKICB0WyJUaW1lcy1Cb2xkIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiSGVsdmV0aWNhLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQ291cmllci1Cb2xkIl0gPSAiQ291cmllci1Cb2xkIjsKICB0LlphcGZEaW5nYmF0cyA9ICJaYXBmRGluZ2JhdHMiOwogIHRbIlRpbWVzLUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdFsiSGVsdmV0aWNhLU9ibGlxdWUiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQ291cmllci1PYmxpcXVlIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0WyJUaW1lcy1Cb2xkSXRhbGljIl0gPSAiVGltZXMtQm9sZEl0YWxpYyI7CiAgdFsiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJDb3VyaWVyLUJvbGRPYmxpcXVlIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdC5BcmlhbE5hcnJvdyA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsTmFycm93LUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWxOYXJyb3ctQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQXJpYWxOYXJyb3ctSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHQuQXJpYWxCbGFjayA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsQmxhY2stQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbEJsYWNrLUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsQmxhY2stSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkFyaWFsLUJsYWNrIl0gPSAiSGVsdmV0aWNhIjsKICB0WyJBcmlhbC1CbGFjay1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkFyaWFsLUJsYWNrLUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsLUJsYWNrLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkFyaWFsID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWwtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbC1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbC1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5BcmlhbE1UID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01UIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbC1Cb2xkTVQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWwtSXRhbGljTVQiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01ULUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsLUJvbGRNVC1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkFyaWFsLUl0YWxpY01ULUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkFyaWFsVW5pY29kZU1TID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWxVbmljb2RlTVMtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbFVuaWNvZGVNUy1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbFVuaWNvZGVNUy1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQ291cmllci1Cb2xkSXRhbGljIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ291cmllci1JdGFsaWMiXSA9ICJDb3VyaWVyLU9ibGlxdWUiOwogIHQuQ291cmllck5ldyA9ICJDb3VyaWVyIjsKICB0WyJDb3VyaWVyTmV3LUJvbGQiXSA9ICJDb3VyaWVyLUJvbGQiOwogIHRbIkNvdXJpZXJOZXctQm9sZEl0YWxpYyJdID0gIkNvdXJpZXItQm9sZE9ibGlxdWUiOwogIHRbIkNvdXJpZXJOZXctSXRhbGljIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0WyJDb3VyaWVyTmV3UFMtQm9sZEl0YWxpY01UIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ291cmllck5ld1BTLUJvbGRNVCJdID0gIkNvdXJpZXItQm9sZCI7CiAgdFsiQ291cmllck5ld1BTLUl0YWxpY01UIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0LkNvdXJpZXJOZXdQU01UID0gIkNvdXJpZXIiOwogIHRbIkhlbHZldGljYS1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJIZWx2ZXRpY2EtSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkhlbHZldGljYUxUU3RkLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiU3ltYm9sLUJvbGQiXSA9ICJTeW1ib2wiOwogIHRbIlN5bWJvbC1Cb2xkSXRhbGljIl0gPSAiU3ltYm9sIjsKICB0WyJTeW1ib2wtSXRhbGljIl0gPSAiU3ltYm9sIjsKICB0LlRpbWVzTmV3Um9tYW4gPSAiVGltZXMtUm9tYW4iOwogIHRbIlRpbWVzTmV3Um9tYW4tQm9sZCJdID0gIlRpbWVzLUJvbGQiOwogIHRbIlRpbWVzTmV3Um9tYW4tQm9sZEl0YWxpYyJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogIHRbIlRpbWVzTmV3Um9tYW4tSXRhbGljIl0gPSAiVGltZXMtSXRhbGljIjsKICB0LlRpbWVzTmV3Um9tYW5QUyA9ICJUaW1lcy1Sb21hbiI7CiAgdFsiVGltZXNOZXdSb21hblBTLUJvbGQiXSA9ICJUaW1lcy1Cb2xkIjsKICB0WyJUaW1lc05ld1JvbWFuUFMtQm9sZEl0YWxpYyJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogIHRbIlRpbWVzTmV3Um9tYW5QUy1Cb2xkSXRhbGljTVQiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICB0WyJUaW1lc05ld1JvbWFuUFMtQm9sZE1UIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiVGltZXNOZXdSb21hblBTLUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdFsiVGltZXNOZXdSb21hblBTLUl0YWxpY01UIl0gPSAiVGltZXMtSXRhbGljIjsKICB0LlRpbWVzTmV3Um9tYW5QU01UID0gIlRpbWVzLVJvbWFuIjsKICB0WyJUaW1lc05ld1JvbWFuUFNNVC1Cb2xkIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiVGltZXNOZXdSb21hblBTTVQtQm9sZEl0YWxpYyJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogIHRbIlRpbWVzTmV3Um9tYW5QU01ULUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7Cn0pOwpjb25zdCBnZXRGb250TmFtZVRvRmlsZU1hcCA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuQ291cmllciA9ICJGb3hpdEZpeGVkLnBmYiI7CiAgdFsiQ291cmllci1Cb2xkIl0gPSAiRm94aXRGaXhlZEJvbGQucGZiIjsKICB0WyJDb3VyaWVyLUJvbGRPYmxpcXVlIl0gPSAiRm94aXRGaXhlZEJvbGRJdGFsaWMucGZiIjsKICB0WyJDb3VyaWVyLU9ibGlxdWUiXSA9ICJGb3hpdEZpeGVkSXRhbGljLnBmYiI7CiAgdC5IZWx2ZXRpY2EgPSAiTGliZXJhdGlvblNhbnMtUmVndWxhci50dGYiOwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSAiTGliZXJhdGlvblNhbnMtQm9sZC50dGYiOwogIHRbIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSJdID0gIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMudHRmIjsKICB0WyJIZWx2ZXRpY2EtT2JsaXF1ZSJdID0gIkxpYmVyYXRpb25TYW5zLUl0YWxpYy50dGYiOwogIHRbIlRpbWVzLVJvbWFuIl0gPSAiRm94aXRTZXJpZi5wZmIiOwogIHRbIlRpbWVzLUJvbGQiXSA9ICJGb3hpdFNlcmlmQm9sZC5wZmIiOwogIHRbIlRpbWVzLUJvbGRJdGFsaWMiXSA9ICJGb3hpdFNlcmlmQm9sZEl0YWxpYy5wZmIiOwogIHRbIlRpbWVzLUl0YWxpYyJdID0gIkZveGl0U2VyaWZJdGFsaWMucGZiIjsKICB0LlN5bWJvbCA9ICJGb3hpdFN5bWJvbC5wZmIiOwogIHQuWmFwZkRpbmdiYXRzID0gIkZveGl0RGluZ2JhdHMucGZiIjsKICB0WyJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyIl0gPSAiTGliZXJhdGlvblNhbnMtUmVndWxhci50dGYiOwogIHRbIkxpYmVyYXRpb25TYW5zLUJvbGQiXSA9ICJMaWJlcmF0aW9uU2Fucy1Cb2xkLnR0ZiI7CiAgdFsiTGliZXJhdGlvblNhbnMtSXRhbGljIl0gPSAiTGliZXJhdGlvblNhbnMtSXRhbGljLnR0ZiI7CiAgdFsiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyJdID0gIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMudHRmIjsKfSk7CmNvbnN0IGdldE5vblN0ZEZvbnRNYXAgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0LkNhbGlicmkgPSAiSGVsdmV0aWNhIjsKICB0WyJDYWxpYnJpLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQ2FsaWJyaS1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJDYWxpYnJpLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkNlbnR1cnlHb3RoaWMgPSAiSGVsdmV0aWNhIjsKICB0WyJDZW50dXJ5R290aGljLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQ2VudHVyeUdvdGhpYy1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJDZW50dXJ5R290aGljLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkNvbWljU2Fuc01TID0gIkNvbWljIFNhbnMgTVMiOwogIHRbIkNvbWljU2Fuc01TLUJvbGQiXSA9ICJDb21pYyBTYW5zIE1TLUJvbGQiOwogIHRbIkNvbWljU2Fuc01TLUJvbGRJdGFsaWMiXSA9ICJDb21pYyBTYW5zIE1TLUJvbGRJdGFsaWMiOwogIHRbIkNvbWljU2Fuc01TLUl0YWxpYyJdID0gIkNvbWljIFNhbnMgTVMtSXRhbGljIjsKICB0LkdpbGxTYW5zTVQgPSAiSGVsdmV0aWNhIjsKICB0WyJHaWxsU2Fuc01ULUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiR2lsbFNhbnNNVC1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJHaWxsU2Fuc01ULUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkltcGFjdCA9ICJIZWx2ZXRpY2EiOwogIHRbIkl0Y1N5bWJvbC1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkl0Y1N5bWJvbC1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJJdGNTeW1ib2wtQm9vayJdID0gIkhlbHZldGljYSI7CiAgdFsiSXRjU3ltYm9sLUJvb2tJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiSXRjU3ltYm9sLU1lZGl1bSJdID0gIkhlbHZldGljYSI7CiAgdFsiSXRjU3ltYm9sLU1lZGl1bUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0Lkx1Y2lkYUNvbnNvbGUgPSAiQ291cmllciI7CiAgdFsiTHVjaWRhQ29uc29sZS1Cb2xkIl0gPSAiQ291cmllci1Cb2xkIjsKICB0WyJMdWNpZGFDb25zb2xlLUJvbGRJdGFsaWMiXSA9ICJDb3VyaWVyLUJvbGRPYmxpcXVlIjsKICB0WyJMdWNpZGFDb25zb2xlLUl0YWxpYyJdID0gIkNvdXJpZXItT2JsaXF1ZSI7CiAgdFsiTHVjaWRhU2Fucy1EZW1pIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIk1TLUdvdGhpYyJdID0gIk1TIEdvdGhpYyI7CiAgdFsiTVMtR290aGljLUJvbGQiXSA9ICJNUyBHb3RoaWMtQm9sZCI7CiAgdFsiTVMtR290aGljLUJvbGRJdGFsaWMiXSA9ICJNUyBHb3RoaWMtQm9sZEl0YWxpYyI7CiAgdFsiTVMtR290aGljLUl0YWxpYyJdID0gIk1TIEdvdGhpYy1JdGFsaWMiOwogIHRbIk1TLU1pbmNobyJdID0gIk1TIE1pbmNobyI7CiAgdFsiTVMtTWluY2hvLUJvbGQiXSA9ICJNUyBNaW5jaG8tQm9sZCI7CiAgdFsiTVMtTWluY2hvLUJvbGRJdGFsaWMiXSA9ICJNUyBNaW5jaG8tQm9sZEl0YWxpYyI7CiAgdFsiTVMtTWluY2hvLUl0YWxpYyJdID0gIk1TIE1pbmNoby1JdGFsaWMiOwogIHRbIk1TLVBHb3RoaWMiXSA9ICJNUyBQR290aGljIjsKICB0WyJNUy1QR290aGljLUJvbGQiXSA9ICJNUyBQR290aGljLUJvbGQiOwogIHRbIk1TLVBHb3RoaWMtQm9sZEl0YWxpYyJdID0gIk1TIFBHb3RoaWMtQm9sZEl0YWxpYyI7CiAgdFsiTVMtUEdvdGhpYy1JdGFsaWMiXSA9ICJNUyBQR290aGljLUl0YWxpYyI7CiAgdFsiTVMtUE1pbmNobyJdID0gIk1TIFBNaW5jaG8iOwogIHRbIk1TLVBNaW5jaG8tQm9sZCJdID0gIk1TIFBNaW5jaG8tQm9sZCI7CiAgdFsiTVMtUE1pbmNoby1Cb2xkSXRhbGljIl0gPSAiTVMgUE1pbmNoby1Cb2xkSXRhbGljIjsKICB0WyJNUy1QTWluY2hvLUl0YWxpYyJdID0gIk1TIFBNaW5jaG8tSXRhbGljIjsKICB0Lk51cHRpYWxTY3JpcHQgPSAiVGltZXMtSXRhbGljIjsKICB0LlNlZ29lVUlTeW1ib2wgPSAiSGVsdmV0aWNhIjsKfSk7CmNvbnN0IGdldFNlcmlmRm9udHMgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WyJBZG9iZSBKZW5zb24iXSA9IHRydWU7CiAgdFsiQWRvYmUgVGV4dCJdID0gdHJ1ZTsKICB0LkFsYmVydHVzID0gdHJ1ZTsKICB0LkFsZHVzID0gdHJ1ZTsKICB0LkFsZXhhbmRyaWEgPSB0cnVlOwogIHQuQWxnZXJpYW4gPSB0cnVlOwogIHRbIkFtZXJpY2FuIFR5cGV3cml0ZXIiXSA9IHRydWU7CiAgdC5BbnRpcXVhID0gdHJ1ZTsKICB0LkFwZXggPSB0cnVlOwogIHQuQXJubyA9IHRydWU7CiAgdC5Bc3RlciA9IHRydWU7CiAgdC5BdXJvcmEgPSB0cnVlOwogIHQuQmFza2VydmlsbGUgPSB0cnVlOwogIHQuQmVsbCA9IHRydWU7CiAgdC5CZW1ibyA9IHRydWU7CiAgdFsiQmVtYm8gU2Nob29sYm9vayJdID0gdHJ1ZTsKICB0LkJlbmd1aWF0ID0gdHJ1ZTsKICB0WyJCZXJrZWxleSBPbGQgU3R5bGUiXSA9IHRydWU7CiAgdFsiQmVybmhhcmQgTW9kZXJuIl0gPSB0cnVlOwogIHRbIkJlcnRob2xkIENpdHkiXSA9IHRydWU7CiAgdC5Cb2RvbmkgPSB0cnVlOwogIHRbIkJhdWVyIEJvZG9uaSJdID0gdHJ1ZTsKICB0WyJCb29rIEFudGlxdWEiXSA9IHRydWU7CiAgdC5Cb29rbWFuID0gdHJ1ZTsKICB0WyJCb3JkZWF1eCBSb21hbiJdID0gdHJ1ZTsKICB0WyJDYWxpZm9ybmlhbiBGQiJdID0gdHJ1ZTsKICB0LkNhbGlzdG8gPSB0cnVlOwogIHQuQ2FsdmVydCA9IHRydWU7CiAgdC5DYXBpdGFscyA9IHRydWU7CiAgdC5DYW1icmlhID0gdHJ1ZTsKICB0LkNhcnRpZXIgPSB0cnVlOwogIHQuQ2FzbG9uID0gdHJ1ZTsKICB0LkNhdHVsbCA9IHRydWU7CiAgdC5DZW50YXVyID0gdHJ1ZTsKICB0WyJDZW50dXJ5IE9sZCBTdHlsZSJdID0gdHJ1ZTsKICB0WyJDZW50dXJ5IFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdC5DaGFwYXJyYWwgPSB0cnVlOwogIHRbIkNoYXJpcyBTSUwiXSA9IHRydWU7CiAgdC5DaGVsdGVuaGFtID0gdHJ1ZTsKICB0WyJDaG9sbGEgU2xhYiJdID0gdHJ1ZTsKICB0LkNsYXJlbmRvbiA9IHRydWU7CiAgdC5DbGVhcmZhY2UgPSB0cnVlOwogIHQuQ29jaGluID0gdHJ1ZTsKICB0LkNvbG9ubmEgPSB0cnVlOwogIHRbIkNvbXB1dGVyIE1vZGVybiJdID0gdHJ1ZTsKICB0WyJDb25jcmV0ZSBSb21hbiJdID0gdHJ1ZTsKICB0LkNvbnN0YW50aWEgPSB0cnVlOwogIHRbIkNvb3BlciBCbGFjayJdID0gdHJ1ZTsKICB0LkNvcm9uYSA9IHRydWU7CiAgdC5FY290eXBlID0gdHJ1ZTsKICB0LkVneXB0aWVubmUgPSB0cnVlOwogIHQuRWxlcGhhbnQgPSB0cnVlOwogIHQuRXhjZWxzaW9yID0gdHJ1ZTsKICB0LkZhaXJmaWVsZCA9IHRydWU7CiAgdFsiRkYgU2NhbGEiXSA9IHRydWU7CiAgdC5Gb2xrYXJkID0gdHJ1ZTsKICB0LkZvb3RsaWdodCA9IHRydWU7CiAgdC5GcmVlU2VyaWYgPSB0cnVlOwogIHRbIkZyaXogUXVhZHJhdGEiXSA9IHRydWU7CiAgdC5HYXJhbW9uZCA9IHRydWU7CiAgdC5HZW50aXVtID0gdHJ1ZTsKICB0Lkdlb3JnaWEgPSB0cnVlOwogIHQuR2xvdWNlc3RlciA9IHRydWU7CiAgdFsiR291ZHkgT2xkIFN0eWxlIl0gPSB0cnVlOwogIHRbIkdvdWR5IFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdFsiR291ZHkgUHJvIEZvbnQiXSA9IHRydWU7CiAgdC5HcmFuam9uID0gdHJ1ZTsKICB0WyJHdWFyZGlhbiBFZ3lwdGlhbiJdID0gdHJ1ZTsKICB0LkhlYXRoZXIgPSB0cnVlOwogIHQuSGVyY3VsZXMgPSB0cnVlOwogIHRbIkhpZ2ggVG93ZXIgVGV4dCJdID0gdHJ1ZTsKICB0Lkhpcm9zaGlnZSA9IHRydWU7CiAgdFsiSG9lZmxlciBUZXh0Il0gPSB0cnVlOwogIHRbIkh1bWFuYSBTZXJpZiJdID0gdHJ1ZTsKICB0LkltcHJpbnQgPSB0cnVlOwogIHRbIklvbmljIE5vLiA1Il0gPSB0cnVlOwogIHQuSmFuc29uID0gdHJ1ZTsKICB0LkpvYW5uYSA9IHRydWU7CiAgdC5Lb3Jpbm5hID0gdHJ1ZTsKICB0LkxleGljb24gPSB0cnVlOwogIHQuTGliZXJhdGlvblNlcmlmID0gdHJ1ZTsKICB0WyJMaWJlcmF0aW9uIFNlcmlmIl0gPSB0cnVlOwogIHRbIkxpbnV4IExpYmVydGluZSJdID0gdHJ1ZTsKICB0LkxpdGVyYXR1cm5heWEgPSB0cnVlOwogIHQuTHVjaWRhID0gdHJ1ZTsKICB0WyJMdWNpZGEgQnJpZ2h0Il0gPSB0cnVlOwogIHQuTWVsaW9yID0gdHJ1ZTsKICB0Lk1lbXBoaXMgPSB0cnVlOwogIHQuTWlsbGVyID0gdHJ1ZTsKICB0Lk1pbmlvbiA9IHRydWU7CiAgdC5Nb2Rlcm4gPSB0cnVlOwogIHRbIk1vbmEgTGlzYSJdID0gdHJ1ZTsKICB0WyJNcnMgRWF2ZXMiXSA9IHRydWU7CiAgdFsiTVMgU2VyaWYiXSA9IHRydWU7CiAgdFsiTXVzZW8gU2xhYiJdID0gdHJ1ZTsKICB0WyJOZXcgWW9yayJdID0gdHJ1ZTsKICB0WyJOaW1idXMgUm9tYW4iXSA9IHRydWU7CiAgdFsiTlBTIFJhd2xpbnNvbiBSb2Fkd2F5Il0gPSB0cnVlOwogIHQuTnVwdGlhbFNjcmlwdCA9IHRydWU7CiAgdC5QYWxhdGlubyA9IHRydWU7CiAgdC5QZXJwZXR1YSA9IHRydWU7CiAgdC5QbGFudGluID0gdHJ1ZTsKICB0WyJQbGFudGluIFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdC5QbGF5YmlsbCA9IHRydWU7CiAgdFsiUG9vciBSaWNoYXJkIl0gPSB0cnVlOwogIHRbIlJhd2xpbnNvbiBSb2Fkd2F5Il0gPSB0cnVlOwogIHQuUmVuYXVsdCA9IHRydWU7CiAgdC5SZXF1aWVtID0gdHJ1ZTsKICB0LlJvY2t3ZWxsID0gdHJ1ZTsKICB0LlJvbWFuID0gdHJ1ZTsKICB0WyJSb3RpcyBTZXJpZiJdID0gdHJ1ZTsKICB0LlNhYm9uID0gdHJ1ZTsKICB0LlNjYWxhID0gdHJ1ZTsKICB0LlNlYWd1bGwgPSB0cnVlOwogIHQuU2lzdGluYSA9IHRydWU7CiAgdC5Tb3V2ZW5pciA9IHRydWU7CiAgdC5TVElYID0gdHJ1ZTsKICB0WyJTdG9uZSBJbmZvcm1hbCJdID0gdHJ1ZTsKICB0WyJTdG9uZSBTZXJpZiJdID0gdHJ1ZTsKICB0LlN5bGZhZW4gPSB0cnVlOwogIHQuVGltZXMgPSB0cnVlOwogIHQuVHJhamFuID0gdHJ1ZTsKICB0WyJUcmluaXTDqSJdID0gdHJ1ZTsKICB0WyJUcnVtcCBNZWRpYWV2YWwiXSA9IHRydWU7CiAgdC5VdG9waWEgPSB0cnVlOwogIHRbIlZhbGUgVHlwZSJdID0gdHJ1ZTsKICB0WyJCaXRzdHJlYW0gVmVyYSJdID0gdHJ1ZTsKICB0WyJWZXJhIFNlcmlmIl0gPSB0cnVlOwogIHQuVmVyc2FpbGxlcyA9IHRydWU7CiAgdC5XYW50ZWQgPSB0cnVlOwogIHQuV2Vpc3MgPSB0cnVlOwogIHRbIldpZGUgTGF0aW4iXSA9IHRydWU7CiAgdC5XaW5kc29yID0gdHJ1ZTsKICB0LlhJVFMgPSB0cnVlOwp9KTsKY29uc3QgZ2V0U3ltYm9sc0ZvbnRzID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdC5EaW5nYmF0cyA9IHRydWU7CiAgdC5TeW1ib2wgPSB0cnVlOwogIHQuWmFwZkRpbmdiYXRzID0gdHJ1ZTsKICB0LldpbmdkaW5ncyA9IHRydWU7CiAgdFsiV2luZ2RpbmdzLUJvbGQiXSA9IHRydWU7CiAgdFsiV2luZ2RpbmdzLVJlZ3VsYXIiXSA9IHRydWU7Cn0pOwpjb25zdCBnZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WzJdID0gMTA7CiAgdFszXSA9IDMyOwogIHRbNF0gPSAzMzsKICB0WzVdID0gMzQ7CiAgdFs2XSA9IDM1OwogIHRbN10gPSAzNjsKICB0WzhdID0gMzc7CiAgdFs5XSA9IDM4OwogIHRbMTBdID0gMzk7CiAgdFsxMV0gPSA0MDsKICB0WzEyXSA9IDQxOwogIHRbMTNdID0gNDI7CiAgdFsxNF0gPSA0MzsKICB0WzE1XSA9IDQ0OwogIHRbMTZdID0gNDU7CiAgdFsxN10gPSA0NjsKICB0WzE4XSA9IDQ3OwogIHRbMTldID0gNDg7CiAgdFsyMF0gPSA0OTsKICB0WzIxXSA9IDUwOwogIHRbMjJdID0gNTE7CiAgdFsyM10gPSA1MjsKICB0WzI0XSA9IDUzOwogIHRbMjVdID0gNTQ7CiAgdFsyNl0gPSA1NTsKICB0WzI3XSA9IDU2OwogIHRbMjhdID0gNTc7CiAgdFsyOV0gPSA1ODsKICB0WzMwXSA9IDg5NDsKICB0WzMxXSA9IDYwOwogIHRbMzJdID0gNjE7CiAgdFszM10gPSA2MjsKICB0WzM0XSA9IDYzOwogIHRbMzVdID0gNjQ7CiAgdFszNl0gPSA2NTsKICB0WzM3XSA9IDY2OwogIHRbMzhdID0gNjc7CiAgdFszOV0gPSA2ODsKICB0WzQwXSA9IDY5OwogIHRbNDFdID0gNzA7CiAgdFs0Ml0gPSA3MTsKICB0WzQzXSA9IDcyOwogIHRbNDRdID0gNzM7CiAgdFs0NV0gPSA3NDsKICB0WzQ2XSA9IDc1OwogIHRbNDddID0gNzY7CiAgdFs0OF0gPSA3NzsKICB0WzQ5XSA9IDc4OwogIHRbNTBdID0gNzk7CiAgdFs1MV0gPSA4MDsKICB0WzUyXSA9IDgxOwogIHRbNTNdID0gODI7CiAgdFs1NF0gPSA4MzsKICB0WzU1XSA9IDg0OwogIHRbNTZdID0gODU7CiAgdFs1N10gPSA4NjsKICB0WzU4XSA9IDg3OwogIHRbNTldID0gODg7CiAgdFs2MF0gPSA4OTsKICB0WzYxXSA9IDkwOwogIHRbNjJdID0gOTE7CiAgdFs2M10gPSA5MjsKICB0WzY0XSA9IDkzOwogIHRbNjVdID0gOTQ7CiAgdFs2Nl0gPSA5NTsKICB0WzY3XSA9IDk2OwogIHRbNjhdID0gOTc7CiAgdFs2OV0gPSA5ODsKICB0WzcwXSA9IDk5OwogIHRbNzFdID0gMTAwOwogIHRbNzJdID0gMTAxOwogIHRbNzNdID0gMTAyOwogIHRbNzRdID0gMTAzOwogIHRbNzVdID0gMTA0OwogIHRbNzZdID0gMTA1OwogIHRbNzddID0gMTA2OwogIHRbNzhdID0gMTA3OwogIHRbNzldID0gMTA4OwogIHRbODBdID0gMTA5OwogIHRbODFdID0gMTEwOwogIHRbODJdID0gMTExOwogIHRbODNdID0gMTEyOwogIHRbODRdID0gMTEzOwogIHRbODVdID0gMTE0OwogIHRbODZdID0gMTE1OwogIHRbODddID0gMTE2OwogIHRbODhdID0gMTE3OwogIHRbODldID0gMTE4OwogIHRbOTBdID0gMTE5OwogIHRbOTFdID0gMTIwOwogIHRbOTJdID0gMTIxOwogIHRbOTNdID0gMTIyOwogIHRbOTRdID0gMTIzOwogIHRbOTVdID0gMTI0OwogIHRbOTZdID0gMTI1OwogIHRbOTddID0gMTI2OwogIHRbOThdID0gMTk2OwogIHRbOTldID0gMTk3OwogIHRbMTAwXSA9IDE5OTsKICB0WzEwMV0gPSAyMDE7CiAgdFsxMDJdID0gMjA5OwogIHRbMTAzXSA9IDIxNDsKICB0WzEwNF0gPSAyMjA7CiAgdFsxMDVdID0gMjI1OwogIHRbMTA2XSA9IDIyNDsKICB0WzEwN10gPSAyMjY7CiAgdFsxMDhdID0gMjI4OwogIHRbMTA5XSA9IDIyNzsKICB0WzExMF0gPSAyMjk7CiAgdFsxMTFdID0gMjMxOwogIHRbMTEyXSA9IDIzMzsKICB0WzExM10gPSAyMzI7CiAgdFsxMTRdID0gMjM0OwogIHRbMTE1XSA9IDIzNTsKICB0WzExNl0gPSAyMzc7CiAgdFsxMTddID0gMjM2OwogIHRbMTE4XSA9IDIzODsKICB0WzExOV0gPSAyMzk7CiAgdFsxMjBdID0gMjQxOwogIHRbMTIxXSA9IDI0MzsKICB0WzEyMl0gPSAyNDI7CiAgdFsxMjNdID0gMjQ0OwogIHRbMTI0XSA9IDI0NjsKICB0WzEyNV0gPSAyNDU7CiAgdFsxMjZdID0gMjUwOwogIHRbMTI3XSA9IDI0OTsKICB0WzEyOF0gPSAyNTE7CiAgdFsxMjldID0gMjUyOwogIHRbMTMwXSA9IDgyMjQ7CiAgdFsxMzFdID0gMTc2OwogIHRbMTMyXSA9IDE2MjsKICB0WzEzM10gPSAxNjM7CiAgdFsxMzRdID0gMTY3OwogIHRbMTM1XSA9IDgyMjY7CiAgdFsxMzZdID0gMTgyOwogIHRbMTM3XSA9IDIyMzsKICB0WzEzOF0gPSAxNzQ7CiAgdFsxMzldID0gMTY5OwogIHRbMTQwXSA9IDg0ODI7CiAgdFsxNDFdID0gMTgwOwogIHRbMTQyXSA9IDE2ODsKICB0WzE0M10gPSA4ODAwOwogIHRbMTQ0XSA9IDE5ODsKICB0WzE0NV0gPSAyMTY7CiAgdFsxNDZdID0gODczNDsKICB0WzE0N10gPSAxNzc7CiAgdFsxNDhdID0gODgwNDsKICB0WzE0OV0gPSA4ODA1OwogIHRbMTUwXSA9IDE2NTsKICB0WzE1MV0gPSAxODE7CiAgdFsxNTJdID0gODcwNjsKICB0WzE1M10gPSA4NzIxOwogIHRbMTU0XSA9IDg3MTk7CiAgdFsxNTZdID0gODc0NzsKICB0WzE1N10gPSAxNzA7CiAgdFsxNThdID0gMTg2OwogIHRbMTU5XSA9IDg0ODY7CiAgdFsxNjBdID0gMjMwOwogIHRbMTYxXSA9IDI0ODsKICB0WzE2Ml0gPSAxOTE7CiAgdFsxNjNdID0gMTYxOwogIHRbMTY0XSA9IDE3MjsKICB0WzE2NV0gPSA4NzMwOwogIHRbMTY2XSA9IDQwMjsKICB0WzE2N10gPSA4Nzc2OwogIHRbMTY4XSA9IDg3MTA7CiAgdFsxNjldID0gMTcxOwogIHRbMTcwXSA9IDE4NzsKICB0WzE3MV0gPSA4MjMwOwogIHRbMTc5XSA9IDgyMjA7CiAgdFsxODBdID0gODIyMTsKICB0WzE4MV0gPSA4MjE2OwogIHRbMTgyXSA9IDgyMTc7CiAgdFsyMDBdID0gMTkzOwogIHRbMjAzXSA9IDIwNTsKICB0WzIwN10gPSAyMTE7CiAgdFsyMTBdID0gMjE4OwogIHRbMjIzXSA9IDcxMTsKICB0WzIyNF0gPSAzMjE7CiAgdFsyMjVdID0gMzIyOwogIHRbMjI2XSA9IDM1MjsKICB0WzIyN10gPSAzNTM7CiAgdFsyMjhdID0gMzgxOwogIHRbMjI5XSA9IDM4MjsKICB0WzIzM10gPSAyMjE7CiAgdFsyMzRdID0gMjUzOwogIHRbMjUyXSA9IDI2MzsKICB0WzI1M10gPSAyNjg7CiAgdFsyNTRdID0gMjY5OwogIHRbMjU4XSA9IDI1ODsKICB0WzI2MF0gPSAyNjA7CiAgdFsyNjFdID0gMjYxOwogIHRbMjY1XSA9IDI4MDsKICB0WzI2Nl0gPSAyODE7CiAgdFsyNjddID0gMjgyOwogIHRbMjY4XSA9IDI4MzsKICB0WzI2OV0gPSAzMTM7CiAgdFsyNzVdID0gMzIzOwogIHRbMjc2XSA9IDMyNDsKICB0WzI3OF0gPSAzMjg7CiAgdFsyODNdID0gMzQ0OwogIHRbMjg0XSA9IDM0NTsKICB0WzI4NV0gPSAzNDY7CiAgdFsyODZdID0gMzQ3OwogIHRbMjkyXSA9IDM2NzsKICB0WzI5NV0gPSAzNzc7CiAgdFsyOTZdID0gMzc4OwogIHRbMjk4XSA9IDM4MDsKICB0WzMwNV0gPSA5NjM7CiAgdFszMDZdID0gOTY0OwogIHRbMzA3XSA9IDk2NjsKICB0WzMwOF0gPSA4MjE1OwogIHRbMzA5XSA9IDgyNTI7CiAgdFszMTBdID0gODMxOTsKICB0WzMxMV0gPSA4MzU5OwogIHRbMzEyXSA9IDg1OTI7CiAgdFszMTNdID0gODU5MzsKICB0WzMzN10gPSA5NTUyOwogIHRbNDkzXSA9IDEwMzk7CiAgdFs0OTRdID0gMTA0MDsKICB0WzU3MF0gPSAxMDQwOwogIHRbNTcxXSA9IDEwNDE7CiAgdFs1NzJdID0gMTA0MjsKICB0WzU3M10gPSAxMDQzOwogIHRbNTc0XSA9IDEwNDQ7CiAgdFs1NzVdID0gMTA0NTsKICB0WzU3Nl0gPSAxMDQ2OwogIHRbNTc3XSA9IDEwNDc7CiAgdFs1NzhdID0gMTA0ODsKICB0WzU3OV0gPSAxMDQ5OwogIHRbNTgwXSA9IDEwNTA7CiAgdFs1ODFdID0gMTA1MTsKICB0WzU4Ml0gPSAxMDUyOwogIHRbNTgzXSA9IDEwNTM7CiAgdFs1ODRdID0gMTA1NDsKICB0WzU4NV0gPSAxMDU1OwogIHRbNTg2XSA9IDEwNTY7CiAgdFs1ODddID0gMTA1NzsKICB0WzU4OF0gPSAxMDU4OwogIHRbNTg5XSA9IDEwNTk7CiAgdFs1OTBdID0gMTA2MDsKICB0WzU5MV0gPSAxMDYxOwogIHRbNTkyXSA9IDEwNjI7CiAgdFs1OTNdID0gMTA2MzsKICB0WzU5NF0gPSAxMDY0OwogIHRbNTk1XSA9IDEwNjU7CiAgdFs1OTZdID0gMTA2NjsKICB0WzU5N10gPSAxMDY3OwogIHRbNTk4XSA9IDEwNjg7CiAgdFs1OTldID0gMTA2OTsKICB0WzYwMF0gPSAxMDcwOwogIHRbNjAxXSA9IDEwNzE7CiAgdFs2MDJdID0gMTA3MjsKICB0WzYwM10gPSAxMDczOwogIHRbNjA0XSA9IDEwNzQ7CiAgdFs2MDVdID0gMTA3NTsKICB0WzYwNl0gPSAxMDc2OwogIHRbNjA3XSA9IDEwNzc7CiAgdFs2MDhdID0gMTA3ODsKICB0WzYwOV0gPSAxMDc5OwogIHRbNjEwXSA9IDEwODA7CiAgdFs2MTFdID0gMTA4MTsKICB0WzYxMl0gPSAxMDgyOwogIHRbNjEzXSA9IDEwODM7CiAgdFs2MTRdID0gMTA4NDsKICB0WzYxNV0gPSAxMDg1OwogIHRbNjE2XSA9IDEwODY7CiAgdFs2MTddID0gMTA4NzsKICB0WzYxOF0gPSAxMDg4OwogIHRbNjE5XSA9IDEwODk7CiAgdFs2MjBdID0gMTA5MDsKICB0WzYyMV0gPSAxMDkxOwogIHRbNjIyXSA9IDEwOTI7CiAgdFs2MjNdID0gMTA5MzsKICB0WzYyNF0gPSAxMDk0OwogIHRbNjI1XSA9IDEwOTU7CiAgdFs2MjZdID0gMTA5NjsKICB0WzYyN10gPSAxMDk3OwogIHRbNjI4XSA9IDEwOTg7CiAgdFs2MjldID0gMTA5OTsKICB0WzYzMF0gPSAxMTAwOwogIHRbNjMxXSA9IDExMDE7CiAgdFs2MzJdID0gMTEwMjsKICB0WzYzM10gPSAxMTAzOwogIHRbNjcyXSA9IDE0ODg7CiAgdFs2NzNdID0gMTQ4OTsKICB0WzY3NF0gPSAxNDkwOwogIHRbNjc1XSA9IDE0OTE7CiAgdFs2NzZdID0gMTQ5MjsKICB0WzY3N10gPSAxNDkzOwogIHRbNjc4XSA9IDE0OTQ7CiAgdFs2NzldID0gMTQ5NTsKICB0WzY4MF0gPSAxNDk2OwogIHRbNjgxXSA9IDE0OTc7CiAgdFs2ODJdID0gMTQ5ODsKICB0WzY4M10gPSAxNDk5OwogIHRbNjg0XSA9IDE1MDA7CiAgdFs2ODVdID0gMTUwMTsKICB0WzY4Nl0gPSAxNTAyOwogIHRbNjg3XSA9IDE1MDM7CiAgdFs2ODhdID0gMTUwNDsKICB0WzY4OV0gPSAxNTA1OwogIHRbNjkwXSA9IDE1MDY7CiAgdFs2OTFdID0gMTUwNzsKICB0WzY5Ml0gPSAxNTA4OwogIHRbNjkzXSA9IDE1MDk7CiAgdFs2OTRdID0gMTUxMDsKICB0WzY5NV0gPSAxNTExOwogIHRbNjk2XSA9IDE1MTI7CiAgdFs2OTddID0gMTUxMzsKICB0WzY5OF0gPSAxNTE0OwogIHRbNzA1XSA9IDE1MjQ7CiAgdFs3MDZdID0gODM2MjsKICB0WzcxMF0gPSA2NDI4ODsKICB0WzcxMV0gPSA2NDI5ODsKICB0Wzc1OV0gPSAxNjE3OwogIHRbNzYxXSA9IDE3NzY7CiAgdFs3NjNdID0gMTc3ODsKICB0Wzc3NV0gPSAxNjUyOwogIHRbNzc3XSA9IDE3NjQ7CiAgdFs3NzhdID0gMTc4MDsKICB0Wzc3OV0gPSAxNzgxOwogIHRbNzgwXSA9IDE3ODI7CiAgdFs3ODJdID0gNzcxOwogIHRbNzgzXSA9IDY0NzI2OwogIHRbNzg2XSA9IDgzNjM7CiAgdFs3ODhdID0gODUzMjsKICB0Wzc5MF0gPSA3Njg7CiAgdFs3OTFdID0gNzY5OwogIHRbNzkyXSA9IDc2ODsKICB0Wzc5NV0gPSA4MDM7CiAgdFs3OTddID0gNjQzMzY7CiAgdFs3OThdID0gNjQzMzc7CiAgdFs3OTldID0gNjQzNDI7CiAgdFs4MDBdID0gNjQzNDM7CiAgdFs4MDFdID0gNjQzNDQ7CiAgdFs4MDJdID0gNjQzNDU7CiAgdFs4MDNdID0gNjQzNjI7CiAgdFs4MDRdID0gNjQzNjM7CiAgdFs4MDVdID0gNjQzNjQ7CiAgdFsyNDI0XSA9IDc4MjE7CiAgdFsyNDI1XSA9IDc4MjI7CiAgdFsyNDI2XSA9IDc4MjM7CiAgdFsyNDI3XSA9IDc4MjQ7CiAgdFsyNDI4XSA9IDc4MjU7CiAgdFsyNDI5XSA9IDc4MjY7CiAgdFsyNDMwXSA9IDc4Mjc7CiAgdFsyNDMzXSA9IDc2ODI7CiAgdFsyNjc4XSA9IDgwNDU7CiAgdFsyNjc5XSA9IDgwNDY7CiAgdFsyODMwXSA9IDE1NTI7CiAgdFsyODM4XSA9IDY4NjsKICB0WzI4NDBdID0gNzUxOwogIHRbMjg0Ml0gPSA3NTM7CiAgdFsyODQzXSA9IDc1NDsKICB0WzI4NDRdID0gNzU1OwogIHRbMjg0Nl0gPSA3NTc7CiAgdFsyODU2XSA9IDc2NzsKICB0WzI4NTddID0gODQ4OwogIHRbMjg1OF0gPSA4NDk7CiAgdFsyODYyXSA9IDg1MzsKICB0WzI4NjNdID0gODU0OwogIHRbMjg2NF0gPSA4NTU7CiAgdFsyODY1XSA9IDg2MTsKICB0WzI4NjZdID0gODYyOwogIHRbMjkwNl0gPSA3NDYwOwogIHRbMjkwOF0gPSA3NDYyOwogIHRbMjkwOV0gPSA3NDYzOwogIHRbMjkxMF0gPSA3NDY0OwogIHRbMjkxMl0gPSA3NDY2OwogIHRbMjkxM10gPSA3NDY3OwogIHRbMjkxNF0gPSA3NDY4OwogIHRbMjkxNl0gPSA3NDcwOwogIHRbMjkxN10gPSA3NDcxOwogIHRbMjkxOF0gPSA3NDcyOwogIHRbMjkyMF0gPSA3NDc0OwogIHRbMjkyMV0gPSA3NDc1OwogIHRbMjkyMl0gPSA3NDc2OwogIHRbMjkyNF0gPSA3NDc4OwogIHRbMjkyNV0gPSA3NDc5OwogIHRbMjkyNl0gPSA3NDgwOwogIHRbMjkyOF0gPSA3NDgyOwogIHRbMjkyOV0gPSA3NDgzOwogIHRbMjkzMF0gPSA3NDg0OwogIHRbMjkzMl0gPSA3NDg2OwogIHRbMjkzM10gPSA3NDg3OwogIHRbMjkzNF0gPSA3NDg4OwogIHRbMjkzNl0gPSA3NDkwOwogIHRbMjkzN10gPSA3NDkxOwogIHRbMjkzOF0gPSA3NDkyOwogIHRbMjk0MF0gPSA3NDk0OwogIHRbMjk0MV0gPSA3NDk1OwogIHRbMjk0Ml0gPSA3NDk2OwogIHRbMjk0NF0gPSA3NDk4OwogIHRbMjk0Nl0gPSA3NTAwOwogIHRbMjk0OF0gPSA3NTAyOwogIHRbMjk1MF0gPSA3NTA0OwogIHRbMjk1MV0gPSA3NTA1OwogIHRbMjk1Ml0gPSA3NTA2OwogIHRbMjk1NF0gPSA3NTA4OwogIHRbMjk1NV0gPSA3NTA5OwogIHRbMjk1Nl0gPSA3NTEwOwogIHRbMjk1OF0gPSA3NTEyOwogIHRbMjk1OV0gPSA3NTEzOwogIHRbMjk2MF0gPSA3NTE0OwogIHRbMjk2Ml0gPSA3NTE2OwogIHRbMjk2M10gPSA3NTE3OwogIHRbMjk2NF0gPSA3NTE4OwogIHRbMjk2Nl0gPSA3NTIwOwogIHRbMjk2N10gPSA3NTIxOwogIHRbMjk2OF0gPSA3NTIyOwogIHRbMjk3MF0gPSA3NTI0OwogIHRbMjk3MV0gPSA3NTI1OwogIHRbMjk3Ml0gPSA3NTI2OwogIHRbMjk3NF0gPSA3NTI4OwogIHRbMjk3NV0gPSA3NTI5OwogIHRbMjk3Nl0gPSA3NTMwOwogIHRbMjk3OF0gPSAxNTM3OwogIHRbMjk3OV0gPSAxNTM4OwogIHRbMjk4MF0gPSAxNTM5OwogIHRbMjk4Ml0gPSAxNTQ5OwogIHRbMjk4M10gPSAxNTUxOwogIHRbMjk4NF0gPSAxNTUyOwogIHRbMjk4Nl0gPSAxNTU0OwogIHRbMjk4N10gPSAxNTU1OwogIHRbMjk4OF0gPSAxNTU2OwogIHRbMjk5MF0gPSAxNjIzOwogIHRbMjk5MV0gPSAxNjI0OwogIHRbMjk5NV0gPSAxNzc1OwogIHRbMjk5OV0gPSAxNzkxOwogIHRbMzAwMl0gPSA2NDI5MDsKICB0WzMwMDNdID0gNjQyOTE7CiAgdFszMDA0XSA9IDY0MjkyOwogIHRbMzAwNl0gPSA2NDI5NDsKICB0WzMwMDddID0gNjQyOTU7CiAgdFszMDA4XSA9IDY0Mjk2OwogIHRbMzAxMV0gPSAxOTAwOwogIHRbMzAxNF0gPSA4MjIzOwogIHRbMzAxNV0gPSA4MjQ0OwogIHRbMzAxN10gPSA3NTMyOwogIHRbMzAxOF0gPSA3NTMzOwogIHRbMzAxOV0gPSA3NTM0OwogIHRbMzA3NV0gPSA3NTkwOwogIHRbMzA3Nl0gPSA3NTkxOwogIHRbMzA3OV0gPSA3NTk0OwogIHRbMzA4MF0gPSA3NTk1OwogIHRbMzA4M10gPSA3NTk4OwogIHRbMzA4NF0gPSA3NTk5OwogIHRbMzA4N10gPSA3NjAyOwogIHRbMzA4OF0gPSA3NjAzOwogIHRbMzA5MV0gPSA3NjA2OwogIHRbMzA5Ml0gPSA3NjA3OwogIHRbMzA5NV0gPSA3NjEwOwogIHRbMzA5Nl0gPSA3NjExOwogIHRbMzA5OV0gPSA3NjE0OwogIHRbMzEwMF0gPSA3NjE1OwogIHRbMzEwM10gPSA3NjE4OwogIHRbMzEwNF0gPSA3NjE5OwogIHRbMzEwN10gPSA4MzM3OwogIHRbMzEwOF0gPSA4MzM4OwogIHRbMzExNl0gPSAxODg0OwogIHRbMzExOV0gPSAxODg1OwogIHRbMzEyMF0gPSAxODg1OwogIHRbMzEyM10gPSAxODg2OwogIHRbMzEyNF0gPSAxODg2OwogIHRbMzEyN10gPSAxODg3OwogIHRbMzEyOF0gPSAxODg3OwogIHRbMzEzMV0gPSAxODg4OwogIHRbMzEzMl0gPSAxODg4OwogIHRbMzEzNV0gPSAxODg5OwogIHRbMzEzNl0gPSAxODg5OwogIHRbMzEzOV0gPSAxODkwOwogIHRbMzE0MF0gPSAxODkwOwogIHRbMzE0M10gPSAxODkxOwogIHRbMzE0NF0gPSAxODkxOwogIHRbMzE0N10gPSAxODkyOwogIHRbMzE0OF0gPSAxODkyOwogIHRbMzE1M10gPSA1ODA7CiAgdFszMTU0XSA9IDU4MTsKICB0WzMxNTddID0gNTg0OwogIHRbMzE1OF0gPSA1ODU7CiAgdFszMTYxXSA9IDU4ODsKICB0WzMxNjJdID0gNTg5OwogIHRbMzE2NV0gPSA4OTE7CiAgdFszMTY2XSA9IDg5MjsKICB0WzMxNjldID0gMTI3NDsKICB0WzMxNzBdID0gMTI3NTsKICB0WzMxNzNdID0gMTI3ODsKICB0WzMxNzRdID0gMTI3OTsKICB0WzMxODFdID0gNzYyMjsKICB0WzMxODJdID0gNzYyMzsKICB0WzMyODJdID0gMTE3OTk7CiAgdFszMzE2XSA9IDU3ODsKICB0WzMzNzldID0gNDI3ODU7CiAgdFszMzkzXSA9IDExNTk7CiAgdFszNDE2XSA9IDgzNzc7Cn0pOwpjb25zdCBnZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckFyaWFsQmxhY2sgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WzIyN10gPSAzMjI7CiAgdFsyNjRdID0gMjYxOwogIHRbMjkxXSA9IDM0NjsKfSk7CmNvbnN0IGdldFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQ2FsaWJyaSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHRbMV0gPSAzMjsKICB0WzRdID0gNjU7CiAgdFs1XSA9IDE5MjsKICB0WzZdID0gMTkzOwogIHRbOV0gPSAxOTY7CiAgdFsxN10gPSA2NjsKICB0WzE4XSA9IDY3OwogIHRbMjFdID0gMjY4OwogIHRbMjRdID0gNjg7CiAgdFsyOF0gPSA2OTsKICB0WzI5XSA9IDIwMDsKICB0WzMwXSA9IDIwMTsKICB0WzMyXSA9IDI4MjsKICB0WzM4XSA9IDcwOwogIHRbMzldID0gNzE7CiAgdFs0NF0gPSA3MjsKICB0WzQ3XSA9IDczOwogIHRbNDhdID0gMjA0OwogIHRbNDldID0gMjA1OwogIHRbNThdID0gNzQ7CiAgdFs2MF0gPSA3NTsKICB0WzYyXSA9IDc2OwogIHRbNjhdID0gNzc7CiAgdFs2OV0gPSA3ODsKICB0Wzc1XSA9IDc5OwogIHRbNzZdID0gMjEwOwogIHRbODBdID0gMjE0OwogIHRbODddID0gODA7CiAgdFs4OV0gPSA4MTsKICB0WzkwXSA9IDgyOwogIHRbOTJdID0gMzQ0OwogIHRbOTRdID0gODM7CiAgdFs5N10gPSAzNTI7CiAgdFsxMDBdID0gODQ7CiAgdFsxMDRdID0gODU7CiAgdFsxMDldID0gMjIwOwogIHRbMTE1XSA9IDg2OwogIHRbMTE2XSA9IDg3OwogIHRbMTIxXSA9IDg4OwogIHRbMTIyXSA9IDg5OwogIHRbMTI0XSA9IDIyMTsKICB0WzEyN10gPSA5MDsKICB0WzEyOV0gPSAzODE7CiAgdFsyNThdID0gOTc7CiAgdFsyNTldID0gMjI0OwogIHRbMjYwXSA9IDIyNTsKICB0WzI2M10gPSAyMjg7CiAgdFsyNjhdID0gMjYxOwogIHRbMjcxXSA9IDk4OwogIHRbMjcyXSA9IDk5OwogIHRbMjczXSA9IDI2MzsKICB0WzI3NV0gPSAyNjk7CiAgdFsyODJdID0gMTAwOwogIHRbMjg2XSA9IDEwMTsKICB0WzI4N10gPSAyMzI7CiAgdFsyODhdID0gMjMzOwogIHRbMjkwXSA9IDI4MzsKICB0WzI5NV0gPSAyODE7CiAgdFsyOTZdID0gMTAyOwogIHRbMzM2XSA9IDEwMzsKICB0WzM0Nl0gPSAxMDQ7CiAgdFszNDldID0gMTA1OwogIHRbMzUwXSA9IDIzNjsKICB0WzM1MV0gPSAyMzc7CiAgdFszNjFdID0gMTA2OwogIHRbMzY0XSA9IDEwNzsKICB0WzM2N10gPSAxMDg7CiAgdFszNzFdID0gMzIyOwogIHRbMzczXSA9IDEwOTsKICB0WzM3NF0gPSAxMTA7CiAgdFszODFdID0gMTExOwogIHRbMzgyXSA9IDI0MjsKICB0WzM4M10gPSAyNDM7CiAgdFszODZdID0gMjQ2OwogIHRbMzkzXSA9IDExMjsKICB0WzM5NV0gPSAxMTM7CiAgdFszOTZdID0gMTE0OwogIHRbMzk4XSA9IDM0NTsKICB0WzQwMF0gPSAxMTU7CiAgdFs0MDFdID0gMzQ3OwogIHRbNDAzXSA9IDM1MzsKICB0WzQxMF0gPSAxMTY7CiAgdFs0MzddID0gMTE3OwogIHRbNDQyXSA9IDI1MjsKICB0WzQ0OF0gPSAxMTg7CiAgdFs0NDldID0gMTE5OwogIHRbNDU0XSA9IDEyMDsKICB0WzQ1NV0gPSAxMjE7CiAgdFs0NTddID0gMjUzOwogIHRbNDYwXSA9IDEyMjsKICB0WzQ2Ml0gPSAzODI7CiAgdFs0NjNdID0gMzgwOwogIHRbODUzXSA9IDQ0OwogIHRbODU1XSA9IDU4OwogIHRbODU2XSA9IDQ2OwogIHRbODc2XSA9IDQ3OwogIHRbODc4XSA9IDQ1OwogIHRbODgyXSA9IDQ1OwogIHRbODk0XSA9IDQwOwogIHRbODk1XSA9IDQxOwogIHRbODk2XSA9IDkxOwogIHRbODk3XSA9IDkzOwogIHRbOTIzXSA9IDY0OwogIHRbOTQwXSA9IDE2MzsKICB0WzEwMDRdID0gNDg7CiAgdFsxMDA1XSA9IDQ5OwogIHRbMTAwNl0gPSA1MDsKICB0WzEwMDddID0gNTE7CiAgdFsxMDA4XSA9IDUyOwogIHRbMTAwOV0gPSA1MzsKICB0WzEwMTBdID0gNTQ7CiAgdFsxMDExXSA9IDU1OwogIHRbMTAxMl0gPSA1NjsKICB0WzEwMTNdID0gNTc7CiAgdFsxMDgxXSA9IDM3OwogIHRbMTA4NV0gPSA0MzsKICB0WzEwODZdID0gNDU7Cn0pOwpmdW5jdGlvbiBnZXRTdGFuZGFyZEZvbnROYW1lKG5hbWUpIHsKICBjb25zdCBmb250TmFtZSA9IG5vcm1hbGl6ZUZvbnROYW1lKG5hbWUpOwogIGNvbnN0IHN0ZEZvbnRNYXAgPSBnZXRTdGRGb250TWFwKCk7CiAgcmV0dXJuIHN0ZEZvbnRNYXBbZm9udE5hbWVdOwp9CmZ1bmN0aW9uIGlzS25vd25Gb250TmFtZShuYW1lKSB7CiAgY29uc3QgZm9udE5hbWUgPSBub3JtYWxpemVGb250TmFtZShuYW1lKTsKICByZXR1cm4gISEoZ2V0U3RkRm9udE1hcCgpW2ZvbnROYW1lXSB8fCBnZXROb25TdGRGb250TWFwKClbZm9udE5hbWVdIHx8IGdldFNlcmlmRm9udHMoKVtmb250TmFtZV0gfHwgZ2V0U3ltYm9sc0ZvbnRzKClbZm9udE5hbWVdKTsKfQoKOy8vIC4vc3JjL2NvcmUvdG9fdW5pY29kZV9tYXAuanMKCmNsYXNzIFRvVW5pY29kZU1hcCB7CiAgY29uc3RydWN0b3IoY21hcCA9IFtdKSB7CiAgICB0aGlzLl9tYXAgPSBjbWFwOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX21hcC5sZW5ndGg7CiAgfQogIGZvckVhY2goY2FsbGJhY2spIHsKICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gdGhpcy5fbWFwKSB7CiAgICAgIGNhbGxiYWNrKGNoYXJDb2RlLCB0aGlzLl9tYXBbY2hhckNvZGVdLmNvZGVQb2ludEF0KDApKTsKICAgIH0KICB9CiAgaGFzKGkpIHsKICAgIHJldHVybiB0aGlzLl9tYXBbaV0gIT09IHVuZGVmaW5lZDsKICB9CiAgZ2V0KGkpIHsKICAgIHJldHVybiB0aGlzLl9tYXBbaV07CiAgfQogIGNoYXJDb2RlT2YodmFsdWUpIHsKICAgIGNvbnN0IG1hcCA9IHRoaXMuX21hcDsKICAgIGlmIChtYXAubGVuZ3RoIDw9IDB4MTAwMDApIHsKICAgICAgcmV0dXJuIG1hcC5pbmRleE9mKHZhbHVlKTsKICAgIH0KICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gbWFwKSB7CiAgICAgIGlmIChtYXBbY2hhckNvZGVdID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybiBjaGFyQ29kZSB8IDA7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CiAgYW1lbmQobWFwKSB7CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIG1hcCkgewogICAgICB0aGlzLl9tYXBbY2hhckNvZGVdID0gbWFwW2NoYXJDb2RlXTsKICAgIH0KICB9Cn0KY2xhc3MgSWRlbnRpdHlUb1VuaWNvZGVNYXAgewogIGNvbnN0cnVjdG9yKGZpcnN0Q2hhciwgbGFzdENoYXIpIHsKICAgIHRoaXMuZmlyc3RDaGFyID0gZmlyc3RDaGFyOwogICAgdGhpcy5sYXN0Q2hhciA9IGxhc3RDaGFyOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMubGFzdENoYXIgKyAxIC0gdGhpcy5maXJzdENoYXI7CiAgfQogIGZvckVhY2goY2FsbGJhY2spIHsKICAgIGZvciAobGV0IGkgPSB0aGlzLmZpcnN0Q2hhciwgaWkgPSB0aGlzLmxhc3RDaGFyOyBpIDw9IGlpOyBpKyspIHsKICAgICAgY2FsbGJhY2soaSwgaSk7CiAgICB9CiAgfQogIGhhcyhpKSB7CiAgICByZXR1cm4gdGhpcy5maXJzdENoYXIgPD0gaSAmJiBpIDw9IHRoaXMubGFzdENoYXI7CiAgfQogIGdldChpKSB7CiAgICBpZiAodGhpcy5maXJzdENoYXIgPD0gaSAmJiBpIDw9IHRoaXMubGFzdENoYXIpIHsKICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoaSk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBjaGFyQ29kZU9mKHYpIHsKICAgIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKHYpICYmIHYgPj0gdGhpcy5maXJzdENoYXIgJiYgdiA8PSB0aGlzLmxhc3RDaGFyID8gdiA6IC0xOwogIH0KICBhbWVuZChtYXApIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgYW1lbmQoKSIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2ZmX2ZvbnQuanMKCgoKY2xhc3MgQ0ZGRm9udCB7CiAgY29uc3RydWN0b3IoZmlsZSwgcHJvcGVydGllcykgewogICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKICAgIGNvbnN0IHBhcnNlciA9IG5ldyBDRkZQYXJzZXIoZmlsZSwgcHJvcGVydGllcywgU0VBQ19BTkFMWVNJU19FTkFCTEVEKTsKICAgIHRoaXMuY2ZmID0gcGFyc2VyLnBhcnNlKCk7CiAgICB0aGlzLmNmZi5kdXBsaWNhdGVGaXJzdEdseXBoKCk7CiAgICBjb25zdCBjb21waWxlciA9IG5ldyBDRkZDb21waWxlcih0aGlzLmNmZik7CiAgICB0aGlzLnNlYWNzID0gdGhpcy5jZmYuc2VhY3M7CiAgICB0cnkgewogICAgICB0aGlzLmRhdGEgPSBjb21waWxlci5jb21waWxlKCk7CiAgICB9IGNhdGNoIHsKICAgICAgd2FybigiRmFpbGVkIHRvIGNvbXBpbGUgZm9udCAiICsgcHJvcGVydGllcy5sb2FkZWROYW1lKTsKICAgICAgdGhpcy5kYXRhID0gZmlsZTsKICAgIH0KICAgIHRoaXMuX2NyZWF0ZUJ1aWx0SW5FbmNvZGluZygpOwogIH0KICBnZXQgbnVtR2x5cGhzKCkgewogICAgcmV0dXJuIHRoaXMuY2ZmLmNoYXJTdHJpbmdzLmNvdW50OwogIH0KICBnZXRDaGFyc2V0KCkgewogICAgcmV0dXJuIHRoaXMuY2ZmLmNoYXJzZXQuY2hhcnNldDsKICB9CiAgZ2V0R2x5cGhNYXBwaW5nKCkgewogICAgY29uc3QgY2ZmID0gdGhpcy5jZmY7CiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzOwogICAgY29uc3QgewogICAgICBjaWRUb0dpZE1hcCwKICAgICAgY01hcAogICAgfSA9IHByb3BlcnRpZXM7CiAgICBjb25zdCBjaGFyc2V0cyA9IGNmZi5jaGFyc2V0LmNoYXJzZXQ7CiAgICBsZXQgY2hhckNvZGVUb0dseXBoSWQ7CiAgICBsZXQgZ2x5cGhJZDsKICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICBsZXQgaW52Q2lkVG9HaWRNYXA7CiAgICAgIGlmIChjaWRUb0dpZE1hcD8ubGVuZ3RoID4gMCkgewogICAgICAgIGludkNpZFRvR2lkTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaWRUb0dpZE1hcC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBnaWQgPSBjaWRUb0dpZE1hcFtpXTsKICAgICAgICAgIGlmIChnaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpbnZDaWRUb0dpZE1hcFtnaWRdID0gaTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBsZXQgY2hhckNvZGU7CiAgICAgIGlmIChjZmYuaXNDSURGb250KSB7CiAgICAgICAgZm9yIChnbHlwaElkID0gMDsgZ2x5cGhJZCA8IGNoYXJzZXRzLmxlbmd0aDsgZ2x5cGhJZCsrKSB7CiAgICAgICAgICBjb25zdCBjaWQgPSBjaGFyc2V0c1tnbHlwaElkXTsKICAgICAgICAgIGNoYXJDb2RlID0gY01hcC5jaGFyQ29kZU9mKGNpZCk7CiAgICAgICAgICBpZiAoaW52Q2lkVG9HaWRNYXA/LltjaGFyQ29kZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjaGFyQ29kZSA9IGludkNpZFRvR2lkTWFwW2NoYXJDb2RlXTsKICAgICAgICAgIH0KICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoZ2x5cGhJZCA9IDA7IGdseXBoSWQgPCBjZmYuY2hhclN0cmluZ3MuY291bnQ7IGdseXBoSWQrKykgewogICAgICAgICAgY2hhckNvZGUgPSBjTWFwLmNoYXJDb2RlT2YoZ2x5cGhJZCk7CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2hhckNvZGVUb0dseXBoSWQ7CiAgICB9CiAgICBsZXQgZW5jb2RpbmcgPSBjZmYuZW5jb2RpbmcgPyBjZmYuZW5jb2RpbmcuZW5jb2RpbmcgOiBudWxsOwogICAgaWYgKHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQpIHsKICAgICAgZW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZzsKICAgIH0KICAgIGNoYXJDb2RlVG9HbHlwaElkID0gdHlwZTFGb250R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMsIGVuY29kaW5nLCBjaGFyc2V0cyk7CiAgICByZXR1cm4gY2hhckNvZGVUb0dseXBoSWQ7CiAgfQogIGhhc0dseXBoSWQoaWQpIHsKICAgIHJldHVybiB0aGlzLmNmZi5oYXNHbHlwaElkKGlkKTsKICB9CiAgX2NyZWF0ZUJ1aWx0SW5FbmNvZGluZygpIHsKICAgIGNvbnN0IHsKICAgICAgY2hhcnNldCwKICAgICAgZW5jb2RpbmcKICAgIH0gPSB0aGlzLmNmZjsKICAgIGlmICghY2hhcnNldCB8fCAhZW5jb2RpbmcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY2hhcnNldHMgPSBjaGFyc2V0LmNoYXJzZXQsCiAgICAgIGVuY29kaW5ncyA9IGVuY29kaW5nLmVuY29kaW5nOwogICAgY29uc3QgbWFwID0gW107CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGVuY29kaW5ncykgewogICAgICBjb25zdCBnbHlwaElkID0gZW5jb2RpbmdzW2NoYXJDb2RlXTsKICAgICAgaWYgKGdseXBoSWQgPj0gMCkgewogICAgICAgIGNvbnN0IGdseXBoTmFtZSA9IGNoYXJzZXRzW2dseXBoSWRdOwogICAgICAgIGlmIChnbHlwaE5hbWUpIHsKICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBnbHlwaE5hbWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAobWFwLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5wcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZyA9IG1hcDsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ZvbnRfcmVuZGVyZXIuanMKCgoKCgoKZnVuY3Rpb24gZ2V0RmxvYXQyMTQoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIHJlYWRJbnQxNihkYXRhLCBvZmZzZXQpIC8gMTYzODQ7Cn0KZnVuY3Rpb24gZ2V0U3Vicm91dGluZUJpYXMoc3VicnMpIHsKICBjb25zdCBudW1TdWJycyA9IHN1YnJzLmxlbmd0aDsKICBsZXQgYmlhcyA9IDMyNzY4OwogIGlmIChudW1TdWJycyA8IDEyNDApIHsKICAgIGJpYXMgPSAxMDc7CiAgfSBlbHNlIGlmIChudW1TdWJycyA8IDMzOTAwKSB7CiAgICBiaWFzID0gMTEzMTsKICB9CiAgcmV0dXJuIGJpYXM7Cn0KZnVuY3Rpb24gcGFyc2VDbWFwKGRhdGEsIHN0YXJ0LCBlbmQpIHsKICBjb25zdCBvZmZzZXQgPSByZWFkVWludDE2KGRhdGEsIHN0YXJ0ICsgMikgPT09IDEgPyByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgOCkgOiByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgMTYpOwogIGNvbnN0IGZvcm1hdCA9IHJlYWRVaW50MTYoZGF0YSwgc3RhcnQgKyBvZmZzZXQpOwogIGxldCByYW5nZXMsIHAsIGk7CiAgaWYgKGZvcm1hdCA9PT0gNCkgewogICAgcmVhZFVpbnQxNihkYXRhLCBzdGFydCArIG9mZnNldCArIDIpOwogICAgY29uc3Qgc2VnQ291bnQgPSByZWFkVWludDE2KGRhdGEsIHN0YXJ0ICsgb2Zmc2V0ICsgNikgPj4gMTsKICAgIHAgPSBzdGFydCArIG9mZnNldCArIDE0OwogICAgcmFuZ2VzID0gW107CiAgICBmb3IgKGkgPSAwOyBpIDwgc2VnQ291bnQ7IGkrKywgcCArPSAyKSB7CiAgICAgIHJhbmdlc1tpXSA9IHsKICAgICAgICBlbmQ6IHJlYWRVaW50MTYoZGF0YSwgcCkKICAgICAgfTsKICAgIH0KICAgIHAgKz0gMjsKICAgIGZvciAoaSA9IDA7IGkgPCBzZWdDb3VudDsgaSsrLCBwICs9IDIpIHsKICAgICAgcmFuZ2VzW2ldLnN0YXJ0ID0gcmVhZFVpbnQxNihkYXRhLCBwKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBzZWdDb3VudDsgaSsrLCBwICs9IDIpIHsKICAgICAgcmFuZ2VzW2ldLmlkRGVsdGEgPSByZWFkVWludDE2KGRhdGEsIHApOwogICAgfQogICAgZm9yIChpID0gMDsgaSA8IHNlZ0NvdW50OyBpKyssIHAgKz0gMikgewogICAgICBsZXQgaWRPZmZzZXQgPSByZWFkVWludDE2KGRhdGEsIHApOwogICAgICBpZiAoaWRPZmZzZXQgPT09IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICByYW5nZXNbaV0uaWRzID0gW107CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJhbmdlc1tpXS5lbmQgLSByYW5nZXNbaV0uc3RhcnQgKyAxOyBqIDwgamo7IGorKykgewogICAgICAgIHJhbmdlc1tpXS5pZHNbal0gPSByZWFkVWludDE2KGRhdGEsIHAgKyBpZE9mZnNldCk7CiAgICAgICAgaWRPZmZzZXQgKz0gMjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJhbmdlczsKICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gMTIpIHsKICAgIGNvbnN0IGdyb3VwcyA9IHJlYWRVaW50MzIoZGF0YSwgc3RhcnQgKyBvZmZzZXQgKyAxMik7CiAgICBwID0gc3RhcnQgKyBvZmZzZXQgKyAxNjsKICAgIHJhbmdlcyA9IFtdOwogICAgZm9yIChpID0gMDsgaSA8IGdyb3VwczsgaSsrKSB7CiAgICAgIHN0YXJ0ID0gcmVhZFVpbnQzMihkYXRhLCBwKTsKICAgICAgcmFuZ2VzLnB1c2goewogICAgICAgIHN0YXJ0LAogICAgICAgIGVuZDogcmVhZFVpbnQzMihkYXRhLCBwICsgNCksCiAgICAgICAgaWREZWx0YTogcmVhZFVpbnQzMihkYXRhLCBwICsgOCkgLSBzdGFydAogICAgICB9KTsKICAgICAgcCArPSAxMjsKICAgIH0KICAgIHJldHVybiByYW5nZXM7CiAgfQogIHRocm93IG5ldyBGb3JtYXRFcnJvcihgdW5zdXBwb3J0ZWQgY21hcDogJHtmb3JtYXR9YCk7Cn0KZnVuY3Rpb24gcGFyc2VDZmYoZGF0YSwgc3RhcnQsIGVuZCwgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogIGNvbnN0IHByb3BlcnRpZXMgPSB7fTsKICBjb25zdCBwYXJzZXIgPSBuZXcgQ0ZGUGFyc2VyKG5ldyBTdHJlYW0oZGF0YSwgc3RhcnQsIGVuZCAtIHN0YXJ0KSwgcHJvcGVydGllcywgc2VhY0FuYWx5c2lzRW5hYmxlZCk7CiAgY29uc3QgY2ZmID0gcGFyc2VyLnBhcnNlKCk7CiAgcmV0dXJuIHsKICAgIGdseXBoczogY2ZmLmNoYXJTdHJpbmdzLm9iamVjdHMsCiAgICBzdWJyczogY2ZmLnRvcERpY3QucHJpdmF0ZURpY3Q/LnN1YnJzSW5kZXg/Lm9iamVjdHMsCiAgICBnc3VicnM6IGNmZi5nbG9iYWxTdWJySW5kZXg/Lm9iamVjdHMsCiAgICBpc0NGRkNJREZvbnQ6IGNmZi5pc0NJREZvbnQsCiAgICBmZFNlbGVjdDogY2ZmLmZkU2VsZWN0LAogICAgZmRBcnJheTogY2ZmLmZkQXJyYXkKICB9Owp9CmZ1bmN0aW9uIHBhcnNlR2x5ZlRhYmxlKGdseWYsIGxvY2EsIGlzR2x5cGhMb2NhdGlvbnNMb25nKSB7CiAgbGV0IGl0ZW1TaXplLCBpdGVtRGVjb2RlOwogIGlmIChpc0dseXBoTG9jYXRpb25zTG9uZykgewogICAgaXRlbVNpemUgPSA0OwogICAgaXRlbURlY29kZSA9IHJlYWRVaW50MzI7CiAgfSBlbHNlIHsKICAgIGl0ZW1TaXplID0gMjsKICAgIGl0ZW1EZWNvZGUgPSAoZGF0YSwgb2Zmc2V0KSA9PiAyICogcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogIH0KICBjb25zdCBnbHlwaHMgPSBbXTsKICBsZXQgc3RhcnRPZmZzZXQgPSBpdGVtRGVjb2RlKGxvY2EsIDApOwogIGZvciAobGV0IGogPSBpdGVtU2l6ZTsgaiA8IGxvY2EubGVuZ3RoOyBqICs9IGl0ZW1TaXplKSB7CiAgICBjb25zdCBlbmRPZmZzZXQgPSBpdGVtRGVjb2RlKGxvY2EsIGopOwogICAgZ2x5cGhzLnB1c2goZ2x5Zi5zdWJhcnJheShzdGFydE9mZnNldCwgZW5kT2Zmc2V0KSk7CiAgICBzdGFydE9mZnNldCA9IGVuZE9mZnNldDsKICB9CiAgcmV0dXJuIGdseXBoczsKfQpmdW5jdGlvbiBsb29rdXBDbWFwKHJhbmdlcywgdW5pY29kZSkgewogIGNvbnN0IGNvZGUgPSB1bmljb2RlLmNvZGVQb2ludEF0KDApOwogIGxldCBnaWQgPSAwLAogICAgbCA9IDAsCiAgICByID0gcmFuZ2VzLmxlbmd0aCAtIDE7CiAgd2hpbGUgKGwgPCByKSB7CiAgICBjb25zdCBjID0gbCArIHIgKyAxID4+IDE7CiAgICBpZiAoY29kZSA8IHJhbmdlc1tjXS5zdGFydCkgewogICAgICByID0gYyAtIDE7CiAgICB9IGVsc2UgewogICAgICBsID0gYzsKICAgIH0KICB9CiAgaWYgKHJhbmdlc1tsXS5zdGFydCA8PSBjb2RlICYmIGNvZGUgPD0gcmFuZ2VzW2xdLmVuZCkgewogICAgZ2lkID0gcmFuZ2VzW2xdLmlkRGVsdGEgKyAocmFuZ2VzW2xdLmlkcyA/IHJhbmdlc1tsXS5pZHNbY29kZSAtIHJhbmdlc1tsXS5zdGFydF0gOiBjb2RlKSAmIDB4ZmZmZjsKICB9CiAgcmV0dXJuIHsKICAgIGNoYXJDb2RlOiBjb2RlLAogICAgZ2x5cGhJZDogZ2lkCiAgfTsKfQpmdW5jdGlvbiBjb21waWxlR2x5Zihjb2RlLCBjbWRzLCBmb250KSB7CiAgZnVuY3Rpb24gbW92ZVRvKHgsIHkpIHsKICAgIGlmIChmaXJzdFBvaW50KSB7CiAgICAgIGNtZHMuYWRkKERyYXdPUFMubGluZVRvLCBmaXJzdFBvaW50KTsKICAgIH0KICAgIGZpcnN0UG9pbnQgPSBbeCwgeV07CiAgICBjbWRzLmFkZChEcmF3T1BTLm1vdmVUbywgW3gsIHldKTsKICB9CiAgZnVuY3Rpb24gbGluZVRvKHgsIHkpIHsKICAgIGNtZHMuYWRkKERyYXdPUFMubGluZVRvLCBbeCwgeV0pOwogIH0KICBmdW5jdGlvbiBxdWFkcmF0aWNDdXJ2ZVRvKHhhLCB5YSwgeCwgeSkgewogICAgY21kcy5hZGQoRHJhd09QUy5xdWFkcmF0aWNDdXJ2ZVRvLCBbeGEsIHlhLCB4LCB5XSk7CiAgfQogIGxldCBpID0gMDsKICBjb25zdCBudW1iZXJPZkNvbnRvdXJzID0gcmVhZEludDE2KGNvZGUsIGkpOwogIGxldCBmbGFnczsKICBsZXQgZmlyc3RQb2ludCA9IG51bGw7CiAgbGV0IHggPSAwLAogICAgeSA9IDA7CiAgaSArPSAxMDsKICBpZiAobnVtYmVyT2ZDb250b3VycyA8IDApIHsKICAgIGRvIHsKICAgICAgZmxhZ3MgPSByZWFkVWludDE2KGNvZGUsIGkpOwogICAgICBjb25zdCBnbHlwaEluZGV4ID0gcmVhZFVpbnQxNihjb2RlLCBpICsgMik7CiAgICAgIGkgKz0gNDsKICAgICAgbGV0IGFyZzEsIGFyZzI7CiAgICAgIGlmIChmbGFncyAmIDB4MDEpIHsKICAgICAgICBpZiAoZmxhZ3MgJiAweDAyKSB7CiAgICAgICAgICBhcmcxID0gcmVhZEludDE2KGNvZGUsIGkpOwogICAgICAgICAgYXJnMiA9IHJlYWRJbnQxNihjb2RlLCBpICsgMik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFyZzEgPSByZWFkVWludDE2KGNvZGUsIGkpOwogICAgICAgICAgYXJnMiA9IHJlYWRVaW50MTYoY29kZSwgaSArIDIpOwogICAgICAgIH0KICAgICAgICBpICs9IDQ7CiAgICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiAweDAyKSB7CiAgICAgICAgYXJnMSA9IHJlYWRJbnQ4KGNvZGUsIGkrKyk7CiAgICAgICAgYXJnMiA9IHJlYWRJbnQ4KGNvZGUsIGkrKyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXJnMSA9IGNvZGVbaSsrXTsKICAgICAgICBhcmcyID0gY29kZVtpKytdOwogICAgICB9CiAgICAgIGlmIChmbGFncyAmIDB4MDIpIHsKICAgICAgICB4ID0gYXJnMTsKICAgICAgICB5ID0gYXJnMjsKICAgICAgfSBlbHNlIHsKICAgICAgICB4ID0gMDsKICAgICAgICB5ID0gMDsKICAgICAgfQogICAgICBsZXQgc2NhbGVYID0gMSwKICAgICAgICBzY2FsZVkgPSAxLAogICAgICAgIHNjYWxlMDEgPSAwLAogICAgICAgIHNjYWxlMTAgPSAwOwogICAgICBpZiAoZmxhZ3MgJiAweDA4KSB7CiAgICAgICAgc2NhbGVYID0gc2NhbGVZID0gZ2V0RmxvYXQyMTQoY29kZSwgaSk7CiAgICAgICAgaSArPSAyOwogICAgICB9IGVsc2UgaWYgKGZsYWdzICYgMHg0MCkgewogICAgICAgIHNjYWxlWCA9IGdldEZsb2F0MjE0KGNvZGUsIGkpOwogICAgICAgIHNjYWxlWSA9IGdldEZsb2F0MjE0KGNvZGUsIGkgKyAyKTsKICAgICAgICBpICs9IDQ7CiAgICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiAweDgwKSB7CiAgICAgICAgc2NhbGVYID0gZ2V0RmxvYXQyMTQoY29kZSwgaSk7CiAgICAgICAgc2NhbGUwMSA9IGdldEZsb2F0MjE0KGNvZGUsIGkgKyAyKTsKICAgICAgICBzY2FsZTEwID0gZ2V0RmxvYXQyMTQoY29kZSwgaSArIDQpOwogICAgICAgIHNjYWxlWSA9IGdldEZsb2F0MjE0KGNvZGUsIGkgKyA2KTsKICAgICAgICBpICs9IDg7CiAgICAgIH0KICAgICAgY29uc3Qgc3ViZ2x5cGggPSBmb250LmdseXBoc1tnbHlwaEluZGV4XTsKICAgICAgaWYgKHN1YmdseXBoKSB7CiAgICAgICAgY21kcy5zYXZlKCk7CiAgICAgICAgY21kcy50cmFuc2Zvcm0oW3NjYWxlWCwgc2NhbGUwMSwgc2NhbGUxMCwgc2NhbGVZLCB4LCB5XSk7CiAgICAgICAgaWYgKCEoZmxhZ3MgJiAweDAyKSkge30KICAgICAgICBjb21waWxlR2x5ZihzdWJnbHlwaCwgY21kcywgZm9udCk7CiAgICAgICAgY21kcy5yZXN0b3JlKCk7CiAgICAgIH0KICAgIH0gd2hpbGUgKGZsYWdzICYgMHgyMCk7CiAgfSBlbHNlIHsKICAgIGNvbnN0IGVuZFB0c09mQ29udG91cnMgPSBbXTsKICAgIGxldCBqLCBqajsKICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZkNvbnRvdXJzOyBqKyspIHsKICAgICAgZW5kUHRzT2ZDb250b3Vycy5wdXNoKHJlYWRVaW50MTYoY29kZSwgaSkpOwogICAgICBpICs9IDI7CiAgICB9CiAgICBjb25zdCBpbnN0cnVjdGlvbkxlbmd0aCA9IHJlYWRVaW50MTYoY29kZSwgaSk7CiAgICBpICs9IDIgKyBpbnN0cnVjdGlvbkxlbmd0aDsKICAgIGNvbnN0IG51bWJlck9mUG9pbnRzID0gZW5kUHRzT2ZDb250b3Vycy5hdCgtMSkgKyAxOwogICAgY29uc3QgcG9pbnRzID0gW107CiAgICB3aGlsZSAocG9pbnRzLmxlbmd0aCA8IG51bWJlck9mUG9pbnRzKSB7CiAgICAgIGZsYWdzID0gY29kZVtpKytdOwogICAgICBsZXQgcmVwZWF0ID0gMTsKICAgICAgaWYgKGZsYWdzICYgMHgwOCkgewogICAgICAgIHJlcGVhdCArPSBjb2RlW2krK107CiAgICAgIH0KICAgICAgd2hpbGUgKHJlcGVhdC0tID4gMCkgewogICAgICAgIHBvaW50cy5wdXNoKHsKICAgICAgICAgIGZsYWdzCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZlBvaW50czsgaisrKSB7CiAgICAgIHN3aXRjaCAocG9pbnRzW2pdLmZsYWdzICYgMHgxMikgewogICAgICAgIGNhc2UgMHgwMDoKICAgICAgICAgIHggKz0gcmVhZEludDE2KGNvZGUsIGkpOwogICAgICAgICAgaSArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDAyOgogICAgICAgICAgeCAtPSBjb2RlW2krK107CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4MTI6CiAgICAgICAgICB4ICs9IGNvZGVbaSsrXTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHBvaW50c1tqXS54ID0geDsKICAgIH0KICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZlBvaW50czsgaisrKSB7CiAgICAgIHN3aXRjaCAocG9pbnRzW2pdLmZsYWdzICYgMHgyNCkgewogICAgICAgIGNhc2UgMHgwMDoKICAgICAgICAgIHkgKz0gcmVhZEludDE2KGNvZGUsIGkpOwogICAgICAgICAgaSArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgeSAtPSBjb2RlW2krK107CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4MjQ6CiAgICAgICAgICB5ICs9IGNvZGVbaSsrXTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHBvaW50c1tqXS55ID0geTsKICAgIH0KICAgIGxldCBzdGFydFBvaW50ID0gMDsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1iZXJPZkNvbnRvdXJzOyBpKyspIHsKICAgICAgY29uc3QgZW5kUG9pbnQgPSBlbmRQdHNPZkNvbnRvdXJzW2ldOwogICAgICBjb25zdCBjb250b3VyID0gcG9pbnRzLnNsaWNlKHN0YXJ0UG9pbnQsIGVuZFBvaW50ICsgMSk7CiAgICAgIGlmIChjb250b3VyWzBdLmZsYWdzICYgMSkgewogICAgICAgIGNvbnRvdXIucHVzaChjb250b3VyWzBdKTsKICAgICAgfSBlbHNlIGlmIChjb250b3VyLmF0KC0xKS5mbGFncyAmIDEpIHsKICAgICAgICBjb250b3VyLnVuc2hpZnQoY29udG91ci5hdCgtMSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHAgPSB7CiAgICAgICAgICBmbGFnczogMSwKICAgICAgICAgIHg6IChjb250b3VyWzBdLnggKyBjb250b3VyLmF0KC0xKS54KSAvIDIsCiAgICAgICAgICB5OiAoY29udG91clswXS55ICsgY29udG91ci5hdCgtMSkueSkgLyAyCiAgICAgICAgfTsKICAgICAgICBjb250b3VyLnVuc2hpZnQocCk7CiAgICAgICAgY29udG91ci5wdXNoKHApOwogICAgICB9CiAgICAgIG1vdmVUbyhjb250b3VyWzBdLngsIGNvbnRvdXJbMF0ueSk7CiAgICAgIGZvciAoaiA9IDEsIGpqID0gY29udG91ci5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgaWYgKGNvbnRvdXJbal0uZmxhZ3MgJiAxKSB7CiAgICAgICAgICBsaW5lVG8oY29udG91cltqXS54LCBjb250b3VyW2pdLnkpOwogICAgICAgIH0gZWxzZSBpZiAoY29udG91cltqICsgMV0uZmxhZ3MgJiAxKSB7CiAgICAgICAgICBxdWFkcmF0aWNDdXJ2ZVRvKGNvbnRvdXJbal0ueCwgY29udG91cltqXS55LCBjb250b3VyW2ogKyAxXS54LCBjb250b3VyW2ogKyAxXS55KTsKICAgICAgICAgIGorKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhZHJhdGljQ3VydmVUbyhjb250b3VyW2pdLngsIGNvbnRvdXJbal0ueSwgKGNvbnRvdXJbal0ueCArIGNvbnRvdXJbaiArIDFdLngpIC8gMiwgKGNvbnRvdXJbal0ueSArIGNvbnRvdXJbaiArIDFdLnkpIC8gMik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0YXJ0UG9pbnQgPSBlbmRQb2ludCArIDE7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGNvbXBpbGVDaGFyU3RyaW5nKGNoYXJTdHJpbmdDb2RlLCBjbWRzLCBmb250LCBnbHlwaElkKSB7CiAgZnVuY3Rpb24gbW92ZVRvKHgsIHkpIHsKICAgIGlmIChmaXJzdFBvaW50KSB7CiAgICAgIGNtZHMuYWRkKERyYXdPUFMubGluZVRvLCBmaXJzdFBvaW50KTsKICAgIH0KICAgIGZpcnN0UG9pbnQgPSBbeCwgeV07CiAgICBjbWRzLmFkZChEcmF3T1BTLm1vdmVUbywgW3gsIHldKTsKICB9CiAgZnVuY3Rpb24gbGluZVRvKHgsIHkpIHsKICAgIGNtZHMuYWRkKERyYXdPUFMubGluZVRvLCBbeCwgeV0pOwogIH0KICBmdW5jdGlvbiBiZXppZXJDdXJ2ZVRvKHgxLCB5MSwgeDIsIHkyLCB4LCB5KSB7CiAgICBjbWRzLmFkZChEcmF3T1BTLmN1cnZlVG8sIFt4MSwgeTEsIHgyLCB5MiwgeCwgeV0pOwogIH0KICBjb25zdCBzdGFjayA9IFtdOwogIGxldCB4ID0gMCwKICAgIHkgPSAwOwogIGxldCBzdGVtcyA9IDA7CiAgbGV0IGZpcnN0UG9pbnQgPSBudWxsOwogIGZ1bmN0aW9uIHBhcnNlKGNvZGUpIHsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlIChpIDwgY29kZS5sZW5ndGgpIHsKICAgICAgbGV0IHN0YWNrQ2xlYW4gPSBmYWxzZTsKICAgICAgbGV0IHYgPSBjb2RlW2krK107CiAgICAgIGxldCB4YSwgeGIsIHlhLCB5YiwgeTEsIHkyLCB5Mywgbiwgc3VickNvZGU7CiAgICAgIHN3aXRjaCAodikgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIHN0ZW1zICs9IHN0YWNrLmxlbmd0aCA+PiAxOwogICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgeSArPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG1vdmVUbyh4LCB5KTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeCArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNjoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDc6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA4OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICBuID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdWJyQ29kZSA9IG51bGw7CiAgICAgICAgICBpZiAoZm9udC5pc0NGRkNJREZvbnQpIHsKICAgICAgICAgICAgY29uc3QgZmRJbmRleCA9IGZvbnQuZmRTZWxlY3QuZ2V0RkRJbmRleChnbHlwaElkKTsKICAgICAgICAgICAgaWYgKGZkSW5kZXggPj0gMCAmJiBmZEluZGV4IDwgZm9udC5mZEFycmF5Lmxlbmd0aCkgewogICAgICAgICAgICAgIGNvbnN0IGZvbnREaWN0ID0gZm9udC5mZEFycmF5W2ZkSW5kZXhdOwogICAgICAgICAgICAgIGxldCBzdWJyczsKICAgICAgICAgICAgICBpZiAoZm9udERpY3QucHJpdmF0ZURpY3Q/LnN1YnJzSW5kZXgpIHsKICAgICAgICAgICAgICAgIHN1YnJzID0gZm9udERpY3QucHJpdmF0ZURpY3Quc3VicnNJbmRleC5vYmplY3RzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc3VicnMpIHsKICAgICAgICAgICAgICAgIG4gKz0gZ2V0U3Vicm91dGluZUJpYXMoc3VicnMpOwogICAgICAgICAgICAgICAgc3VickNvZGUgPSBzdWJyc1tuXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgd2FybigiSW52YWxpZCBmZCBpbmRleCBmb3IgZ2x5cGggaW5kZXguIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1YnJDb2RlID0gZm9udC5zdWJyc1tuICsgZm9udC5zdWJyc0JpYXNdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN1YnJDb2RlKSB7CiAgICAgICAgICAgIHBhcnNlKHN1YnJDb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTE6CiAgICAgICAgICByZXR1cm47CiAgICAgICAgY2FzZSAxMjoKICAgICAgICAgIHYgPSBjb2RlW2krK107CiAgICAgICAgICBzd2l0Y2ggKHYpIHsKICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkxID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5LCB4YiwgeTEsIHgsIHkxKTsKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeTEsIHhiLCB5LCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzY6CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5MSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkyID0geTEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeTEsIHhiLCB5MiwgeCwgeTIpOwogICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeTMgPSB5MiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5MiwgeGIsIHkzLCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICBjb25zdCB4MCA9IHgsCiAgICAgICAgICAgICAgICB5MCA9IHk7CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiOwogICAgICAgICAgICAgIHkgPSB5YjsKICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoeCAtIHgwKSA+IE1hdGguYWJzKHkgLSB5MCkpIHsKICAgICAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYHVua25vd24gb3BlcmF0b3I6IDEyICR7dn1gKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID49IDQpIHsKICAgICAgICAgICAgY29uc3QgYWNoYXIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgY29uc3QgYmNoYXIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgeSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICB4ID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGNtZHMuc2F2ZSgpOwogICAgICAgICAgICBjbWRzLnRyYW5zbGF0ZSh4LCB5KTsKICAgICAgICAgICAgbGV0IGNtYXAgPSBsb29rdXBDbWFwKGZvbnQuY21hcCwgU3RyaW5nLmZyb21DaGFyQ29kZShmb250LmdseXBoTmFtZU1hcFtTdGFuZGFyZEVuY29kaW5nW2FjaGFyXV0pKTsKICAgICAgICAgICAgY29tcGlsZUNoYXJTdHJpbmcoZm9udC5nbHlwaHNbY21hcC5nbHlwaElkXSwgY21kcywgZm9udCwgY21hcC5nbHlwaElkKTsKICAgICAgICAgICAgY21kcy5yZXN0b3JlKCk7CiAgICAgICAgICAgIGNtYXAgPSBsb29rdXBDbWFwKGZvbnQuY21hcCwgU3RyaW5nLmZyb21DaGFyQ29kZShmb250LmdseXBoTmFtZU1hcFtTdGFuZGFyZEVuY29kaW5nW2JjaGFyXV0pKTsKICAgICAgICAgICAgY29tcGlsZUNoYXJTdHJpbmcoZm9udC5nbHlwaHNbY21hcC5nbHlwaElkXSwgY21kcywgZm9udCwgY21hcC5nbHlwaElkKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICBjYXNlIDE4OgogICAgICAgICAgc3RlbXMgKz0gc3RhY2subGVuZ3RoID4+IDE7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTk6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIGkgKz0gc3RlbXMgKyA3ID4+IDM7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjA6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIGkgKz0gc3RlbXMgKyA3ID4+IDM7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjE6CiAgICAgICAgICB5ICs9IHN0YWNrLnBvcCgpOwogICAgICAgICAgeCArPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG1vdmVUbyh4LCB5KTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyMjoKICAgICAgICAgIHggKz0gc3RhY2sucG9wKCk7CiAgICAgICAgICBtb3ZlVG8oeCwgeSk7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjM6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNDoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAyKSB7CiAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI1OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDYpIHsKICAgICAgICAgICAgeCArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI2OgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCAlIDIpIHsKICAgICAgICAgICAgeCArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeGEgPSB4OwogICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YjsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI3OgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCAlIDIpIHsKICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWEgPSB5OwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHkgPSB5YjsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI4OgogICAgICAgICAgc3RhY2sucHVzaChyZWFkSW50MTYoY29kZSwgaSkpOwogICAgICAgICAgaSArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOToKICAgICAgICAgIG4gPSBzdGFjay5wb3AoKSArIGZvbnQuZ3N1YnJzQmlhczsKICAgICAgICAgIHN1YnJDb2RlID0gZm9udC5nc3VicnNbbl07CiAgICAgICAgICBpZiAoc3VickNvZGUpIHsKICAgICAgICAgICAgcGFyc2Uoc3VickNvZGUpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzMDoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHhhID0geDsKICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ID0geWIgKyAoc3RhY2subGVuZ3RoID09PSAxID8gc3RhY2suc2hpZnQoKSA6IDApOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHlhID0geTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGIgKyAoc3RhY2subGVuZ3RoID09PSAxID8gc3RhY2suc2hpZnQoKSA6IDApOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzE6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YSA9IHk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB4YSA9IHg7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKHYgPCAzMikgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYHVua25vd24gb3BlcmF0b3I6ICR7dn1gKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2IDwgMjQ3KSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2godiAtIDEzOSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHYgPCAyNTEpIHsKICAgICAgICAgICAgc3RhY2sucHVzaCgodiAtIDI0NykgKiAyNTYgKyBjb2RlW2krK10gKyAxMDgpOwogICAgICAgICAgfSBlbHNlIGlmICh2IDwgMjU1KSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goLSh2IC0gMjUxKSAqIDI1NiAtIGNvZGVbaSsrXSAtIDEwOCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFjay5wdXNoKChjb2RlW2ldIDw8IDI0IHwgY29kZVtpICsgMV0gPDwgMTYgfCBjb2RlW2kgKyAyXSA8PCA4IHwgY29kZVtpICsgM10pIC8gNjU1MzYpOwogICAgICAgICAgICBpICs9IDQ7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoc3RhY2tDbGVhbikgewogICAgICAgIHN0YWNrLmxlbmd0aCA9IDA7CiAgICAgIH0KICAgIH0KICB9CiAgcGFyc2UoY2hhclN0cmluZ0NvZGUpOwp9CmNvbnN0IE5PT1AgPSAiIjsKY2xhc3MgQ29tbWFuZHMgewogIGNtZHMgPSBbXTsKICB0cmFuc2Zvcm1TdGFjayA9IFtdOwogIGN1cnJlbnRUcmFuc2Zvcm0gPSBbMSwgMCwgMCwgMSwgMCwgMF07CiAgYWRkKGNtZCwgYXJncykgewogICAgaWYgKGFyZ3MpIHsKICAgICAgY29uc3QgewogICAgICAgIGN1cnJlbnRUcmFuc2Zvcm0KICAgICAgfSA9IHRoaXM7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGFyZ3MubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgIFV0aWwuYXBwbHlUcmFuc2Zvcm0oYXJncywgY3VycmVudFRyYW5zZm9ybSwgaSk7CiAgICAgIH0KICAgICAgdGhpcy5jbWRzLnB1c2goY21kLCAuLi5hcmdzKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY21kcy5wdXNoKGNtZCk7CiAgICB9CiAgfQogIHRyYW5zZm9ybSh0cmFuc2YpIHsKICAgIHRoaXMuY3VycmVudFRyYW5zZm9ybSA9IFV0aWwudHJhbnNmb3JtKHRoaXMuY3VycmVudFRyYW5zZm9ybSwgdHJhbnNmKTsKICB9CiAgdHJhbnNsYXRlKHgsIHkpIHsKICAgIHRoaXMudHJhbnNmb3JtKFsxLCAwLCAwLCAxLCB4LCB5XSk7CiAgfQogIHNhdmUoKSB7CiAgICB0aGlzLnRyYW5zZm9ybVN0YWNrLnB1c2godGhpcy5jdXJyZW50VHJhbnNmb3JtLnNsaWNlKCkpOwogIH0KICByZXN0b3JlKCkgewogICAgdGhpcy5jdXJyZW50VHJhbnNmb3JtID0gdGhpcy50cmFuc2Zvcm1TdGFjay5wb3AoKSB8fCBbMSwgMCwgMCwgMSwgMCwgMF07CiAgfQogIGdldFBhdGgoKSB7CiAgICByZXR1cm4gbmV3IChGZWF0dXJlVGVzdC5pc0Zsb2F0MTZBcnJheVN1cHBvcnRlZCA/IEZsb2F0MTZBcnJheSA6IEZsb2F0MzJBcnJheSkodGhpcy5jbWRzKTsKICB9Cn0KY2xhc3MgQ29tcGlsZWRGb250IHsKICBjb25zdHJ1Y3Rvcihmb250TWF0cml4KSB7CiAgICB0aGlzLmZvbnRNYXRyaXggPSBmb250TWF0cml4OwogICAgdGhpcy5jb21waWxlZEdseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIH0KICBnZXRQYXRoSnModW5pY29kZSkgewogICAgY29uc3QgewogICAgICBjaGFyQ29kZSwKICAgICAgZ2x5cGhJZAogICAgfSA9IGxvb2t1cENtYXAodGhpcy5jbWFwLCB1bmljb2RlKTsKICAgIGxldCBmbiA9IHRoaXMuY29tcGlsZWRHbHlwaHNbZ2x5cGhJZF0sCiAgICAgIGNvbXBpbGVFeDsKICAgIGlmIChmbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHRyeSB7CiAgICAgICAgZm4gPSB0aGlzLmNvbXBpbGVHbHlwaCh0aGlzLmdseXBoc1tnbHlwaElkXSwgZ2x5cGhJZCk7CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgZm4gPSBOT09QOwogICAgICAgIGNvbXBpbGVFeCA9IGV4OwogICAgICB9CiAgICAgIHRoaXMuY29tcGlsZWRHbHlwaHNbZ2x5cGhJZF0gPSBmbjsKICAgIH0KICAgIHRoaXMuY29tcGlsZWRDaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPz89IGdseXBoSWQ7CiAgICBpZiAoY29tcGlsZUV4KSB7CiAgICAgIHRocm93IGNvbXBpbGVFeDsKICAgIH0KICAgIHJldHVybiBmbjsKICB9CiAgY29tcGlsZUdseXBoKGNvZGUsIGdseXBoSWQpIHsKICAgIGlmICghY29kZT8ubGVuZ3RoIHx8IGNvZGVbMF0gPT09IDE0KSB7CiAgICAgIHJldHVybiBOT09QOwogICAgfQogICAgbGV0IGZvbnRNYXRyaXggPSB0aGlzLmZvbnRNYXRyaXg7CiAgICBpZiAodGhpcy5pc0NGRkNJREZvbnQpIHsKICAgICAgY29uc3QgZmRJbmRleCA9IHRoaXMuZmRTZWxlY3QuZ2V0RkRJbmRleChnbHlwaElkKTsKICAgICAgaWYgKGZkSW5kZXggPj0gMCAmJiBmZEluZGV4IDwgdGhpcy5mZEFycmF5Lmxlbmd0aCkgewogICAgICAgIGNvbnN0IGZvbnREaWN0ID0gdGhpcy5mZEFycmF5W2ZkSW5kZXhdOwogICAgICAgIGZvbnRNYXRyaXggPSBmb250RGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKSB8fCBGT05UX0lERU5USVRZX01BVFJJWDsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJJbnZhbGlkIGZkIGluZGV4IGZvciBnbHlwaCBpbmRleC4iKTsKICAgICAgfQogICAgfQogICAgYXNzZXJ0KGlzTnVtYmVyQXJyYXkoZm9udE1hdHJpeCwgNiksICJFeHBlY3RlZCBhIHZhbGlkIGZvbnRNYXRyaXguIik7CiAgICBjb25zdCBjbWRzID0gbmV3IENvbW1hbmRzKCk7CiAgICBjbWRzLnRyYW5zZm9ybShmb250TWF0cml4LnNsaWNlKCkpOwogICAgdGhpcy5jb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMsIGdseXBoSWQpOwogICAgY21kcy5hZGQoRHJhd09QUy5jbG9zZVBhdGgpOwogICAgcmV0dXJuIGNtZHMuZ2V0UGF0aCgpOwogIH0KICBjb21waWxlR2x5cGhJbXBsKCkgewogICAgdW5yZWFjaGFibGUoIkNoaWxkcmVuIGNsYXNzZXMgc2hvdWxkIGltcGxlbWVudCB0aGlzLiIpOwogIH0KICBoYXNCdWlsdFBhdGgodW5pY29kZSkgewogICAgY29uc3QgewogICAgICBjaGFyQ29kZSwKICAgICAgZ2x5cGhJZAogICAgfSA9IGxvb2t1cENtYXAodGhpcy5jbWFwLCB1bmljb2RlKTsKICAgIHJldHVybiB0aGlzLmNvbXBpbGVkR2x5cGhzW2dseXBoSWRdICE9PSB1bmRlZmluZWQgJiYgdGhpcy5jb21waWxlZENoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSAhPT0gdW5kZWZpbmVkOwogIH0KfQpjbGFzcyBUcnVlVHlwZUNvbXBpbGVkIGV4dGVuZHMgQ29tcGlsZWRGb250IHsKICBjb25zdHJ1Y3RvcihnbHlwaHMsIGNtYXAsIGZvbnRNYXRyaXgpIHsKICAgIHN1cGVyKGZvbnRNYXRyaXggfHwgWzAuMDAwNDg4LCAwLCAwLCAwLjAwMDQ4OCwgMCwgMF0pOwogICAgdGhpcy5nbHlwaHMgPSBnbHlwaHM7CiAgICB0aGlzLmNtYXAgPSBjbWFwOwogIH0KICBjb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMpIHsKICAgIGNvbXBpbGVHbHlmKGNvZGUsIGNtZHMsIHRoaXMpOwogIH0KfQpjbGFzcyBUeXBlMkNvbXBpbGVkIGV4dGVuZHMgQ29tcGlsZWRGb250IHsKICBjb25zdHJ1Y3RvcihjZmZJbmZvLCBjbWFwLCBmb250TWF0cml4KSB7CiAgICBzdXBlcihmb250TWF0cml4IHx8IFswLjAwMSwgMCwgMCwgMC4wMDEsIDAsIDBdKTsKICAgIHRoaXMuZ2x5cGhzID0gY2ZmSW5mby5nbHlwaHM7CiAgICB0aGlzLmdzdWJycyA9IGNmZkluZm8uZ3N1YnJzIHx8IFtdOwogICAgdGhpcy5zdWJycyA9IGNmZkluZm8uc3VicnMgfHwgW107CiAgICB0aGlzLmNtYXAgPSBjbWFwOwogICAgdGhpcy5nbHlwaE5hbWVNYXAgPSBnZXRHbHlwaHNVbmljb2RlKCk7CiAgICB0aGlzLmdzdWJyc0JpYXMgPSBnZXRTdWJyb3V0aW5lQmlhcyh0aGlzLmdzdWJycyk7CiAgICB0aGlzLnN1YnJzQmlhcyA9IGdldFN1YnJvdXRpbmVCaWFzKHRoaXMuc3VicnMpOwogICAgdGhpcy5pc0NGRkNJREZvbnQgPSBjZmZJbmZvLmlzQ0ZGQ0lERm9udDsKICAgIHRoaXMuZmRTZWxlY3QgPSBjZmZJbmZvLmZkU2VsZWN0OwogICAgdGhpcy5mZEFycmF5ID0gY2ZmSW5mby5mZEFycmF5OwogIH0KICBjb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMsIGdseXBoSWQpIHsKICAgIGNvbXBpbGVDaGFyU3RyaW5nKGNvZGUsIGNtZHMsIHRoaXMsIGdseXBoSWQpOwogIH0KfQpjbGFzcyBGb250UmVuZGVyZXJGYWN0b3J5IHsKICBzdGF0aWMgY3JlYXRlKGZvbnQsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShmb250LmRhdGEpOwogICAgbGV0IGNtYXAsIGdseWYsIGxvY2EsIGNmZiwgaW5kZXhUb0xvY0Zvcm1hdCwgdW5pdHNQZXJFbTsKICAgIGNvbnN0IG51bVRhYmxlcyA9IHJlYWRVaW50MTYoZGF0YSwgNCk7CiAgICBmb3IgKGxldCBpID0gMCwgcCA9IDEyOyBpIDwgbnVtVGFibGVzOyBpKyssIHAgKz0gMTYpIHsKICAgICAgY29uc3QgdGFnID0gYnl0ZXNUb1N0cmluZyhkYXRhLnN1YmFycmF5KHAsIHAgKyA0KSk7CiAgICAgIGNvbnN0IG9mZnNldCA9IHJlYWRVaW50MzIoZGF0YSwgcCArIDgpOwogICAgICBjb25zdCBsZW5ndGggPSByZWFkVWludDMyKGRhdGEsIHAgKyAxMik7CiAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgY2FzZSAiY21hcCI6CiAgICAgICAgICBjbWFwID0gcGFyc2VDbWFwKGRhdGEsIG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImdseWYiOgogICAgICAgICAgZ2x5ZiA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibG9jYSI6CiAgICAgICAgICBsb2NhID0gZGF0YS5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJoZWFkIjoKICAgICAgICAgIHVuaXRzUGVyRW0gPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCArIDE4KTsKICAgICAgICAgIGluZGV4VG9Mb2NGb3JtYXQgPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCArIDUwKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkNGRiAiOgogICAgICAgICAgY2ZmID0gcGFyc2VDZmYoZGF0YSwgb2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgsIHNlYWNBbmFseXNpc0VuYWJsZWQpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChnbHlmKSB7CiAgICAgIGNvbnN0IGZvbnRNYXRyaXggPSAhdW5pdHNQZXJFbSA/IGZvbnQuZm9udE1hdHJpeCA6IFsxIC8gdW5pdHNQZXJFbSwgMCwgMCwgMSAvIHVuaXRzUGVyRW0sIDAsIDBdOwogICAgICByZXR1cm4gbmV3IFRydWVUeXBlQ29tcGlsZWQocGFyc2VHbHlmVGFibGUoZ2x5ZiwgbG9jYSwgaW5kZXhUb0xvY0Zvcm1hdCksIGNtYXAsIGZvbnRNYXRyaXgpOwogICAgfQogICAgcmV0dXJuIG5ldyBUeXBlMkNvbXBpbGVkKGNmZiwgY21hcCwgZm9udC5mb250TWF0cml4KTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL21ldHJpY3MuanMKCmNvbnN0IGdldE1ldHJpY3MgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0LkNvdXJpZXIgPSA2MDA7CiAgdFsiQ291cmllci1Cb2xkIl0gPSA2MDA7CiAgdFsiQ291cmllci1Cb2xkT2JsaXF1ZSJdID0gNjAwOwogIHRbIkNvdXJpZXItT2JsaXF1ZSJdID0gNjAwOwogIHQuSGVsdmV0aWNhID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjc4OwogICAgdC5leGNsYW0gPSAyNzg7CiAgICB0LnF1b3RlZGJsID0gMzU1OwogICAgdC5udW1iZXJzaWduID0gNTU2OwogICAgdC5kb2xsYXIgPSA1NTY7CiAgICB0LnBlcmNlbnQgPSA4ODk7CiAgICB0LmFtcGVyc2FuZCA9IDY2NzsKICAgIHQucXVvdGVyaWdodCA9IDIyMjsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3RlcmlzayA9IDM4OTsKICAgIHQucGx1cyA9IDU4NDsKICAgIHQuY29tbWEgPSAyNzg7CiAgICB0Lmh5cGhlbiA9IDMzMzsKICAgIHQucGVyaW9kID0gMjc4OwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDU1NjsKICAgIHQub25lID0gNTU2OwogICAgdC50d28gPSA1NTY7CiAgICB0LnRocmVlID0gNTU2OwogICAgdC5mb3VyID0gNTU2OwogICAgdC5maXZlID0gNTU2OwogICAgdC5zaXggPSA1NTY7CiAgICB0LnNldmVuID0gNTU2OwogICAgdC5laWdodCA9IDU1NjsKICAgIHQubmluZSA9IDU1NjsKICAgIHQuY29sb24gPSAyNzg7CiAgICB0LnNlbWljb2xvbiA9IDI3ODsKICAgIHQubGVzcyA9IDU4NDsKICAgIHQuZXF1YWwgPSA1ODQ7CiAgICB0LmdyZWF0ZXIgPSA1ODQ7CiAgICB0LnF1ZXN0aW9uID0gNTU2OwogICAgdC5hdCA9IDEwMTU7CiAgICB0LkEgPSA2Njc7CiAgICB0LkIgPSA2Njc7CiAgICB0LkMgPSA3MjI7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2Njc7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3Nzg7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAyNzg7CiAgICB0LkogPSA1MDA7CiAgICB0LksgPSA2Njc7CiAgICB0LkwgPSA1NTY7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3Nzg7CiAgICB0LlAgPSA2Njc7CiAgICB0LlEgPSA3Nzg7CiAgICB0LlIgPSA3MjI7CiAgICB0LlMgPSA2Njc7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2Njc7CiAgICB0LlcgPSA5NDQ7CiAgICB0LlggPSA2Njc7CiAgICB0LlkgPSA2Njc7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMjc4OwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDI3ODsKICAgIHQuYXNjaWljaXJjdW0gPSA0Njk7CiAgICB0LnVuZGVyc2NvcmUgPSA1NTY7CiAgICB0LnF1b3RlbGVmdCA9IDIyMjsKICAgIHQuYSA9IDU1NjsKICAgIHQuYiA9IDU1NjsKICAgIHQuYyA9IDUwMDsKICAgIHQuZCA9IDU1NjsKICAgIHQuZSA9IDU1NjsKICAgIHQuZiA9IDI3ODsKICAgIHQuZyA9IDU1NjsKICAgIHQuaCA9IDU1NjsKICAgIHQuaSA9IDIyMjsKICAgIHQuaiA9IDIyMjsKICAgIHQuayA9IDUwMDsKICAgIHQubCA9IDIyMjsKICAgIHQubSA9IDgzMzsKICAgIHQubiA9IDU1NjsKICAgIHQubyA9IDU1NjsKICAgIHQucCA9IDU1NjsKICAgIHQucSA9IDU1NjsKICAgIHQuciA9IDMzMzsKICAgIHQucyA9IDUwMDsKICAgIHQudCA9IDI3ODsKICAgIHQudSA9IDU1NjsKICAgIHQudiA9IDUwMDsKICAgIHQudyA9IDcyMjsKICAgIHQueCA9IDUwMDsKICAgIHQueSA9IDUwMDsKICAgIHQueiA9IDUwMDsKICAgIHQuYnJhY2VsZWZ0ID0gMzM0OwogICAgdC5iYXIgPSAyNjA7CiAgICB0LmJyYWNlcmlnaHQgPSAzMzQ7CiAgICB0LmFzY2lpdGlsZGUgPSA1ODQ7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1NTY7CiAgICB0LnN0ZXJsaW5nID0gNTU2OwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTU2OwogICAgdC5mbG9yaW4gPSA1NTY7CiAgICB0LnNlY3Rpb24gPSA1NTY7CiAgICB0LmN1cnJlbmN5ID0gNTU2OwogICAgdC5xdW90ZXNpbmdsZSA9IDE5MTsKICAgIHQucXVvdGVkYmxsZWZ0ID0gMzMzOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTU2OwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1MDA7CiAgICB0LmZsID0gNTAwOwogICAgdC5lbmRhc2ggPSA1NTY7CiAgICB0LmRhZ2dlciA9IDU1NjsKICAgIHQuZGFnZ2VyZGJsID0gNTU2OwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI3ODsKICAgIHQucGFyYWdyYXBoID0gNTM3OwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMjIyOwogICAgdC5xdW90ZWRibGJhc2UgPSAzMzM7CiAgICB0LnF1b3RlZGJscmlnaHQgPSAzMzM7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTU2OwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNjExOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gMTAwMDsKICAgIHQub3JkZmVtaW5pbmUgPSAzNzA7CiAgICB0LkxzbGFzaCA9IDU1NjsKICAgIHQuT3NsYXNoID0gNzc4OwogICAgdC5PRSA9IDEwMDA7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDM2NTsKICAgIHQuYWUgPSA4ODk7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyMjI7CiAgICB0Lm9zbGFzaCA9IDYxMTsKICAgIHQub2UgPSA5NDQ7CiAgICB0Lmdlcm1hbmRibHMgPSA2MTE7CiAgICB0LklkaWVyZXNpcyA9IDI3ODsKICAgIHQuZWFjdXRlID0gNTU2OwogICAgdC5hYnJldmUgPSA1NTY7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LmVjYXJvbiA9IDU1NjsKICAgIHQuWWRpZXJlc2lzID0gNjY3OwogICAgdC5kaXZpZGUgPSA1ODQ7CiAgICB0LllhY3V0ZSA9IDY2NzsKICAgIHQuQWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFhY3V0ZSA9IDU1NjsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDUwMDsKICAgIHQuc2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5lY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDU1NjsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNTU2OwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDczNzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNTAwOwogICAgdC5hcmluZyA9IDU1NjsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyMjI7CiAgICB0LmFncmF2ZSA9IDU1NjsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5DYWN1dGUgPSA3MjI7CiAgICB0LmF0aWxkZSA9IDU1NjsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gNTAwOwogICAgdC5zY2VkaWxsYSA9IDUwMDsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDcxOwogICAgdC5SY2Fyb24gPSA3MjI7CiAgICB0Lkdjb21tYWFjY2VudCA9IDc3ODsKICAgIHQudWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5BbWFjcm9uID0gNjY3OwogICAgdC5yY2Fyb24gPSAzMzM7CiAgICB0LmNjZWRpbGxhID0gNTAwOwogICAgdC5aZG90YWNjZW50ID0gNjExOwogICAgdC5UaG9ybiA9IDY2NzsKICAgIHQuT21hY3JvbiA9IDc3ODsKICAgIHQuUmFjdXRlID0gNzIyOwogICAgdC5TYWN1dGUgPSA2Njc7CiAgICB0LmRjYXJvbiA9IDY0MzsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA1NTY7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9ncmF2ZSA9IDc3ODsKICAgIHQuQWdyYXZlID0gNjY3OwogICAgdC5BYnJldmUgPSA2Njc7CiAgICB0Lm11bHRpcGx5ID0gNTg0OwogICAgdC51YWN1dGUgPSA1NTY7CiAgICB0LlRjYXJvbiA9IDYxMTsKICAgIHQucGFydGlhbGRpZmYgPSA0NzY7CiAgICB0LnlkaWVyZXNpcyA9IDUwMDsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDU1NjsKICAgIHQuZWRpZXJlc2lzID0gNTU2OwogICAgdC5jYWN1dGUgPSA1MDA7CiAgICB0Lm5hY3V0ZSA9IDU1NjsKICAgIHQudW1hY3JvbiA9IDU1NjsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAyNzg7CiAgICB0LnBsdXNtaW51cyA9IDU4NDsKICAgIHQuYnJva2VuYmFyID0gMjYwOwogICAgdC5yZWdpc3RlcmVkID0gNzM3OwogICAgdC5HYnJldmUgPSA3Nzg7CiAgICB0Lklkb3RhY2NlbnQgPSAyNzg7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSAzMzM7CiAgICB0Lm9tYWNyb24gPSA1NTY7CiAgICB0LlphY3V0ZSA9IDYxMTsKICAgIHQuWmNhcm9uID0gNjExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA3MjI7CiAgICB0Lmxjb21tYWFjY2VudCA9IDIyMjsKICAgIHQudGNhcm9uID0gMzE3OwogICAgdC5lb2dvbmVrID0gNTU2OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA2Njc7CiAgICB0LkFkaWVyZXNpcyA9IDY2NzsKICAgIHQuZWdyYXZlID0gNTU2OwogICAgdC56YWN1dGUgPSA1MDA7CiAgICB0LmlvZ29uZWsgPSAyMjI7CiAgICB0Lk9hY3V0ZSA9IDc3ODsKICAgIHQub2FjdXRlID0gNTU2OwogICAgdC5hbWFjcm9uID0gNTU2OwogICAgdC5zYWN1dGUgPSA1MDA7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3Nzg7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNTU2OwogICAgdC50d29zdXBlcmlvciA9IDMzMzsKICAgIHQuT2RpZXJlc2lzID0gNzc4OwogICAgdC5tdSA9IDU1NjsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNTU2OwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA1NTY7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA4MzQ7CiAgICB0LlNjZWRpbGxhID0gNjY3OwogICAgdC5sY2Fyb24gPSAyOTk7CiAgICB0Lktjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuTGFjdXRlID0gNTU2OwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNTU2OwogICAgdC5JZ3JhdmUgPSAyNzg7CiAgICB0LkltYWNyb24gPSAyNzg7CiAgICB0LkxjYXJvbiA9IDU1NjsKICAgIHQub25laGFsZiA9IDgzNDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDU1NjsKICAgIHQubnRpbGRlID0gNTU2OwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA1NTY7CiAgICB0LmdicmV2ZSA9IDU1NjsKICAgIHQub25lcXVhcnRlciA9IDgzNDsKICAgIHQuU2Nhcm9uID0gNjY3OwogICAgdC5TY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3Nzg7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNTU2OwogICAgdC5DY2Fyb24gPSA3MjI7CiAgICB0LnVncmF2ZSA9IDU1NjsKICAgIHQucmFkaWNhbCA9IDQ1MzsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzMzM7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNTU2OwogICAgdC5SY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0Lkxjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuQXRpbGRlID0gNjY3OwogICAgdC5Bb2dvbmVrID0gNjY3OwogICAgdC5BcmluZyA9IDY2NzsKICAgIHQuT3RpbGRlID0gNzc4OwogICAgdC56ZG90YWNjZW50ID0gNTAwOwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAyNzg7CiAgICB0Lmtjb21tYWFjY2VudCA9IDUwMDsKICAgIHQubWludXMgPSA1ODQ7CiAgICB0LkljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5uY2Fyb24gPSA1NTY7CiAgICB0LnRjb21tYWFjY2VudCA9IDI3ODsKICAgIHQubG9naWNhbG5vdCA9IDU4NDsKICAgIHQub2RpZXJlc2lzID0gNTU2OwogICAgdC51ZGllcmVzaXMgPSA1NTY7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LmV0aCA9IDU1NjsKICAgIHQuemNhcm9uID0gNTAwOwogICAgdC5uY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzMzOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTU2OwogIH0pOwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNzg7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQucXVvdGVkYmwgPSA0NzQ7CiAgICB0Lm51bWJlcnNpZ24gPSA1NTY7CiAgICB0LmRvbGxhciA9IDU1NjsKICAgIHQucGVyY2VudCA9IDg4OTsKICAgIHQuYW1wZXJzYW5kID0gNzIyOwogICAgdC5xdW90ZXJpZ2h0ID0gMjc4OwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gMzg5OwogICAgdC5wbHVzID0gNTg0OwogICAgdC5jb21tYSA9IDI3ODsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNzg7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTU2OwogICAgdC5vbmUgPSA1NTY7CiAgICB0LnR3byA9IDU1NjsKICAgIHQudGhyZWUgPSA1NTY7CiAgICB0LmZvdXIgPSA1NTY7CiAgICB0LmZpdmUgPSA1NTY7CiAgICB0LnNpeCA9IDU1NjsKICAgIHQuc2V2ZW4gPSA1NTY7CiAgICB0LmVpZ2h0ID0gNTU2OwogICAgdC5uaW5lID0gNTU2OwogICAgdC5jb2xvbiA9IDMzMzsKICAgIHQuc2VtaWNvbG9uID0gMzMzOwogICAgdC5sZXNzID0gNTg0OwogICAgdC5lcXVhbCA9IDU4NDsKICAgIHQuZ3JlYXRlciA9IDU4NDsKICAgIHQucXVlc3Rpb24gPSA2MTE7CiAgICB0LmF0ID0gOTc1OwogICAgdC5BID0gNzIyOwogICAgdC5CID0gNzIyOwogICAgdC5DID0gNzIyOwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjY3OwogICAgdC5GID0gNjExOwogICAgdC5HID0gNzc4OwogICAgdC5IID0gNzIyOwogICAgdC5JID0gMjc4OwogICAgdC5KID0gNTU2OwogICAgdC5LID0gNzIyOwogICAgdC5MID0gNjExOwogICAgdC5NID0gODMzOwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzc4OwogICAgdC5QID0gNjY3OwogICAgdC5RID0gNzc4OwogICAgdC5SID0gNzIyOwogICAgdC5TID0gNjY3OwogICAgdC5UID0gNjExOwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNjY3OwogICAgdC5XID0gOTQ0OwogICAgdC5YID0gNjY3OwogICAgdC5ZID0gNjY3OwogICAgdC5aID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDMzMzsKICAgIHQuYmFja3NsYXNoID0gMjc4OwogICAgdC5icmFja2V0cmlnaHQgPSAzMzM7CiAgICB0LmFzY2lpY2lyY3VtID0gNTg0OwogICAgdC51bmRlcnNjb3JlID0gNTU2OwogICAgdC5xdW90ZWxlZnQgPSAyNzg7CiAgICB0LmEgPSA1NTY7CiAgICB0LmIgPSA2MTE7CiAgICB0LmMgPSA1NTY7CiAgICB0LmQgPSA2MTE7CiAgICB0LmUgPSA1NTY7CiAgICB0LmYgPSAzMzM7CiAgICB0LmcgPSA2MTE7CiAgICB0LmggPSA2MTE7CiAgICB0LmkgPSAyNzg7CiAgICB0LmogPSAyNzg7CiAgICB0LmsgPSA1NTY7CiAgICB0LmwgPSAyNzg7CiAgICB0Lm0gPSA4ODk7CiAgICB0Lm4gPSA2MTE7CiAgICB0Lm8gPSA2MTE7CiAgICB0LnAgPSA2MTE7CiAgICB0LnEgPSA2MTE7CiAgICB0LnIgPSAzODk7CiAgICB0LnMgPSA1NTY7CiAgICB0LnQgPSAzMzM7CiAgICB0LnUgPSA2MTE7CiAgICB0LnYgPSA1NTY7CiAgICB0LncgPSA3Nzg7CiAgICB0LnggPSA1NTY7CiAgICB0LnkgPSA1NTY7CiAgICB0LnogPSA1MDA7CiAgICB0LmJyYWNlbGVmdCA9IDM4OTsKICAgIHQuYmFyID0gMjgwOwogICAgdC5icmFjZXJpZ2h0ID0gMzg5OwogICAgdC5hc2NpaXRpbGRlID0gNTg0OwogICAgdC5leGNsYW1kb3duID0gMzMzOwogICAgdC5jZW50ID0gNTU2OwogICAgdC5zdGVybGluZyA9IDU1NjsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LnllbiA9IDU1NjsKICAgIHQuZmxvcmluID0gNTU2OwogICAgdC5zZWN0aW9uID0gNTU2OwogICAgdC5jdXJyZW5jeSA9IDU1NjsKICAgIHQucXVvdGVzaW5nbGUgPSAyMzg7CiAgICB0LnF1b3RlZGJsbGVmdCA9IDUwMDsKICAgIHQuZ3VpbGxlbW90bGVmdCA9IDU1NjsKICAgIHQuZ3VpbHNpbmdsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbHNpbmdscmlnaHQgPSAzMzM7CiAgICB0LmZpID0gNjExOwogICAgdC5mbCA9IDYxMTsKICAgIHQuZW5kYXNoID0gNTU2OwogICAgdC5kYWdnZXIgPSA1NTY7CiAgICB0LmRhZ2dlcmRibCA9IDU1NjsKICAgIHQucGVyaW9kY2VudGVyZWQgPSAyNzg7CiAgICB0LnBhcmFncmFwaCA9IDU1NjsKICAgIHQuYnVsbGV0ID0gMzUwOwogICAgdC5xdW90ZXNpbmdsYmFzZSA9IDI3ODsKICAgIHQucXVvdGVkYmxiYXNlID0gNTAwOwogICAgdC5xdW90ZWRibHJpZ2h0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RyaWdodCA9IDU1NjsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDYxMTsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSAxMDAwOwogICAgdC5BRSA9IDEwMDA7CiAgICB0Lm9yZGZlbWluaW5lID0gMzcwOwogICAgdC5Mc2xhc2ggPSA2MTE7CiAgICB0Lk9zbGFzaCA9IDc3ODsKICAgIHQuT0UgPSAxMDAwOwogICAgdC5vcmRtYXNjdWxpbmUgPSAzNjU7CiAgICB0LmFlID0gODg5OwogICAgdC5kb3RsZXNzaSA9IDI3ODsKICAgIHQubHNsYXNoID0gMjc4OwogICAgdC5vc2xhc2ggPSA2MTE7CiAgICB0Lm9lID0gOTQ0OwogICAgdC5nZXJtYW5kYmxzID0gNjExOwogICAgdC5JZGllcmVzaXMgPSAyNzg7CiAgICB0LmVhY3V0ZSA9IDU1NjsKICAgIHQuYWJyZXZlID0gNTU2OwogICAgdC51aHVuZ2FydW1sYXV0ID0gNjExOwogICAgdC5lY2Fyb24gPSA1NTY7CiAgICB0LllkaWVyZXNpcyA9IDY2NzsKICAgIHQuZGl2aWRlID0gNTg0OwogICAgdC5ZYWN1dGUgPSA2Njc7CiAgICB0LkFjaXJjdW1mbGV4ID0gNzIyOwogICAgdC5hYWN1dGUgPSA1NTY7CiAgICB0LlVjaXJjdW1mbGV4ID0gNzIyOwogICAgdC55YWN1dGUgPSA1NTY7CiAgICB0LnNjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuZWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LlVyaW5nID0gNzIyOwogICAgdC5VZGllcmVzaXMgPSA3MjI7CiAgICB0LmFvZ29uZWsgPSA1NTY7CiAgICB0LlVhY3V0ZSA9IDcyMjsKICAgIHQudW9nb25layA9IDYxMTsKICAgIHQuRWRpZXJlc2lzID0gNjY3OwogICAgdC5EY3JvYXQgPSA3MjI7CiAgICB0LmNvbW1hYWNjZW50ID0gMjUwOwogICAgdC5jb3B5cmlnaHQgPSA3Mzc7CiAgICB0LkVtYWNyb24gPSA2Njc7CiAgICB0LmNjYXJvbiA9IDU1NjsKICAgIHQuYXJpbmcgPSA1NTY7CiAgICB0Lk5jb21tYWFjY2VudCA9IDcyMjsKICAgIHQubGFjdXRlID0gMjc4OwogICAgdC5hZ3JhdmUgPSA1NTY7CiAgICB0LlRjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQ2FjdXRlID0gNzIyOwogICAgdC5hdGlsZGUgPSA1NTY7CiAgICB0LkVkb3RhY2NlbnQgPSA2Njc7CiAgICB0LnNjYXJvbiA9IDU1NjsKICAgIHQuc2NlZGlsbGEgPSA1NTY7CiAgICB0LmlhY3V0ZSA9IDI3ODsKICAgIHQubG96ZW5nZSA9IDQ5NDsKICAgIHQuUmNhcm9uID0gNzIyOwogICAgdC5HY29tbWFhY2NlbnQgPSA3Nzg7CiAgICB0LnVjaXJjdW1mbGV4ID0gNjExOwogICAgdC5hY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuQW1hY3JvbiA9IDcyMjsKICAgIHQucmNhcm9uID0gMzg5OwogICAgdC5jY2VkaWxsYSA9IDU1NjsKICAgIHQuWmRvdGFjY2VudCA9IDYxMTsKICAgIHQuVGhvcm4gPSA2Njc7CiAgICB0Lk9tYWNyb24gPSA3Nzg7CiAgICB0LlJhY3V0ZSA9IDcyMjsKICAgIHQuU2FjdXRlID0gNjY3OwogICAgdC5kY2Fyb24gPSA3NDM7CiAgICB0LlVtYWNyb24gPSA3MjI7CiAgICB0LnVyaW5nID0gNjExOwogICAgdC50aHJlZXN1cGVyaW9yID0gMzMzOwogICAgdC5PZ3JhdmUgPSA3Nzg7CiAgICB0LkFncmF2ZSA9IDcyMjsKICAgIHQuQWJyZXZlID0gNzIyOwogICAgdC5tdWx0aXBseSA9IDU4NDsKICAgIHQudWFjdXRlID0gNjExOwogICAgdC5UY2Fyb24gPSA2MTE7CiAgICB0LnBhcnRpYWxkaWZmID0gNDk0OwogICAgdC55ZGllcmVzaXMgPSA1NTY7CiAgICB0Lk5hY3V0ZSA9IDcyMjsKICAgIHQuaWNpcmN1bWZsZXggPSAyNzg7CiAgICB0LkVjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hZGllcmVzaXMgPSA1NTY7CiAgICB0LmVkaWVyZXNpcyA9IDU1NjsKICAgIHQuY2FjdXRlID0gNTU2OwogICAgdC5uYWN1dGUgPSA2MTE7CiAgICB0LnVtYWNyb24gPSA2MTE7CiAgICB0Lk5jYXJvbiA9IDcyMjsKICAgIHQuSWFjdXRlID0gMjc4OwogICAgdC5wbHVzbWludXMgPSA1ODQ7CiAgICB0LmJyb2tlbmJhciA9IDI4MDsKICAgIHQucmVnaXN0ZXJlZCA9IDczNzsKICAgIHQuR2JyZXZlID0gNzc4OwogICAgdC5JZG90YWNjZW50ID0gMjc4OwogICAgdC5zdW1tYXRpb24gPSA2MDA7CiAgICB0LkVncmF2ZSA9IDY2NzsKICAgIHQucmFjdXRlID0gMzg5OwogICAgdC5vbWFjcm9uID0gNjExOwogICAgdC5aYWN1dGUgPSA2MTE7CiAgICB0LlpjYXJvbiA9IDYxMTsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5FdGggPSA3MjI7CiAgICB0LkNjZWRpbGxhID0gNzIyOwogICAgdC5sY29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LnRjYXJvbiA9IDM4OTsKICAgIHQuZW9nb25layA9IDU1NjsKICAgIHQuVW9nb25layA9IDcyMjsKICAgIHQuQWFjdXRlID0gNzIyOwogICAgdC5BZGllcmVzaXMgPSA3MjI7CiAgICB0LmVncmF2ZSA9IDU1NjsKICAgIHQuemFjdXRlID0gNTAwOwogICAgdC5pb2dvbmVrID0gMjc4OwogICAgdC5PYWN1dGUgPSA3Nzg7CiAgICB0Lm9hY3V0ZSA9IDYxMTsKICAgIHQuYW1hY3JvbiA9IDU1NjsKICAgIHQuc2FjdXRlID0gNTU2OwogICAgdC5pZGllcmVzaXMgPSAyNzg7CiAgICB0Lk9jaXJjdW1mbGV4ID0gNzc4OwogICAgdC5VZ3JhdmUgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC50aG9ybiA9IDYxMTsKICAgIHQudHdvc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9kaWVyZXNpcyA9IDc3ODsKICAgIHQubXUgPSA2MTE7CiAgICB0LmlncmF2ZSA9IDI3ODsKICAgIHQub2h1bmdhcnVtbGF1dCA9IDYxMTsKICAgIHQuRW9nb25layA9IDY2NzsKICAgIHQuZGNyb2F0ID0gNjExOwogICAgdC50aHJlZXF1YXJ0ZXJzID0gODM0OwogICAgdC5TY2VkaWxsYSA9IDY2NzsKICAgIHQubGNhcm9uID0gNDAwOwogICAgdC5LY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LkxhY3V0ZSA9IDYxMTsKICAgIHQudHJhZGVtYXJrID0gMTAwMDsKICAgIHQuZWRvdGFjY2VudCA9IDU1NjsKICAgIHQuSWdyYXZlID0gMjc4OwogICAgdC5JbWFjcm9uID0gMjc4OwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA4MzQ7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA2MTE7CiAgICB0Lm50aWxkZSA9IDYxMTsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjY3OwogICAgdC5lbWFjcm9uID0gNTU2OwogICAgdC5nYnJldmUgPSA2MTE7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA4MzQ7CiAgICB0LlNjYXJvbiA9IDY2NzsKICAgIHQuU2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzc4OwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDYxMTsKICAgIHQuQ2Nhcm9uID0gNzIyOwogICAgdC51Z3JhdmUgPSA2MTE7CiAgICB0LnJhZGljYWwgPSA1NDk7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzg5OwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDYxMTsKICAgIHQuUmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkF0aWxkZSA9IDcyMjsKICAgIHQuQW9nb25layA9IDcyMjsKICAgIHQuQXJpbmcgPSA3MjI7CiAgICB0Lk90aWxkZSA9IDc3ODsKICAgIHQuemRvdGFjY2VudCA9IDUwMDsKICAgIHQuRWNhcm9uID0gNjY3OwogICAgdC5Jb2dvbmVrID0gMjc4OwogICAgdC5rY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lm1pbnVzID0gNTg0OwogICAgdC5JY2lyY3VtZmxleCA9IDI3ODsKICAgIHQubmNhcm9uID0gNjExOwogICAgdC50Y29tbWFhY2NlbnQgPSAzMzM7CiAgICB0LmxvZ2ljYWxub3QgPSA1ODQ7CiAgICB0Lm9kaWVyZXNpcyA9IDYxMTsKICAgIHQudWRpZXJlc2lzID0gNjExOwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNjExOwogICAgdC5ldGggPSA2MTE7CiAgICB0LnpjYXJvbiA9IDUwMDsKICAgIHQubmNvbW1hYWNjZW50ID0gNjExOwogICAgdC5vbmVzdXBlcmlvciA9IDMzMzsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDU1NjsKICB9KTsKICB0WyJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI3ODsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDQ3NDsKICAgIHQubnVtYmVyc2lnbiA9IDU1NjsKICAgIHQuZG9sbGFyID0gNTU2OwogICAgdC5wZXJjZW50ID0gODg5OwogICAgdC5hbXBlcnNhbmQgPSA3MjI7CiAgICB0LnF1b3RlcmlnaHQgPSAyNzg7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSAzODk7CiAgICB0LnBsdXMgPSA1ODQ7CiAgICB0LmNvbW1hID0gMjc4OwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI3ODsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1NTY7CiAgICB0Lm9uZSA9IDU1NjsKICAgIHQudHdvID0gNTU2OwogICAgdC50aHJlZSA9IDU1NjsKICAgIHQuZm91ciA9IDU1NjsKICAgIHQuZml2ZSA9IDU1NjsKICAgIHQuc2l4ID0gNTU2OwogICAgdC5zZXZlbiA9IDU1NjsKICAgIHQuZWlnaHQgPSA1NTY7CiAgICB0Lm5pbmUgPSA1NTY7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA1ODQ7CiAgICB0LmVxdWFsID0gNTg0OwogICAgdC5ncmVhdGVyID0gNTg0OwogICAgdC5xdWVzdGlvbiA9IDYxMTsKICAgIHQuYXQgPSA5NzU7CiAgICB0LkEgPSA3MjI7CiAgICB0LkIgPSA3MjI7CiAgICB0LkMgPSA3MjI7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2Njc7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3Nzg7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAyNzg7CiAgICB0LkogPSA1NTY7CiAgICB0LksgPSA3MjI7CiAgICB0LkwgPSA2MTE7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3Nzg7CiAgICB0LlAgPSA2Njc7CiAgICB0LlEgPSA3Nzg7CiAgICB0LlIgPSA3MjI7CiAgICB0LlMgPSA2Njc7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2Njc7CiAgICB0LlcgPSA5NDQ7CiAgICB0LlggPSA2Njc7CiAgICB0LlkgPSA2Njc7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA1ODQ7CiAgICB0LnVuZGVyc2NvcmUgPSA1NTY7CiAgICB0LnF1b3RlbGVmdCA9IDI3ODsKICAgIHQuYSA9IDU1NjsKICAgIHQuYiA9IDYxMTsKICAgIHQuYyA9IDU1NjsKICAgIHQuZCA9IDYxMTsKICAgIHQuZSA9IDU1NjsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDYxMTsKICAgIHQuaCA9IDYxMTsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDU1NjsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDg4OTsKICAgIHQubiA9IDYxMTsKICAgIHQubyA9IDYxMTsKICAgIHQucCA9IDYxMTsKICAgIHQucSA9IDYxMTsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDU1NjsKICAgIHQudCA9IDMzMzsKICAgIHQudSA9IDYxMTsKICAgIHQudiA9IDU1NjsKICAgIHQudyA9IDc3ODsKICAgIHQueCA9IDU1NjsKICAgIHQueSA9IDU1NjsKICAgIHQueiA9IDUwMDsKICAgIHQuYnJhY2VsZWZ0ID0gMzg5OwogICAgdC5iYXIgPSAyODA7CiAgICB0LmJyYWNlcmlnaHQgPSAzODk7CiAgICB0LmFzY2lpdGlsZGUgPSA1ODQ7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1NTY7CiAgICB0LnN0ZXJsaW5nID0gNTU2OwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTU2OwogICAgdC5mbG9yaW4gPSA1NTY7CiAgICB0LnNlY3Rpb24gPSA1NTY7CiAgICB0LmN1cnJlbmN5ID0gNTU2OwogICAgdC5xdW90ZXNpbmdsZSA9IDIzODsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTU2OwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA2MTE7CiAgICB0LmZsID0gNjExOwogICAgdC5lbmRhc2ggPSA1NTY7CiAgICB0LmRhZ2dlciA9IDU1NjsKICAgIHQuZGFnZ2VyZGJsID0gNTU2OwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI3ODsKICAgIHQucGFyYWdyYXBoID0gNTU2OwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMjc4OwogICAgdC5xdW90ZWRibGJhc2UgPSA1MDA7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTU2OwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNjExOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gMTAwMDsKICAgIHQub3JkZmVtaW5pbmUgPSAzNzA7CiAgICB0LkxzbGFzaCA9IDYxMTsKICAgIHQuT3NsYXNoID0gNzc4OwogICAgdC5PRSA9IDEwMDA7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDM2NTsKICAgIHQuYWUgPSA4ODk7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyNzg7CiAgICB0Lm9zbGFzaCA9IDYxMTsKICAgIHQub2UgPSA5NDQ7CiAgICB0Lmdlcm1hbmRibHMgPSA2MTE7CiAgICB0LklkaWVyZXNpcyA9IDI3ODsKICAgIHQuZWFjdXRlID0gNTU2OwogICAgdC5hYnJldmUgPSA1NTY7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA2MTE7CiAgICB0LmVjYXJvbiA9IDU1NjsKICAgIHQuWWRpZXJlc2lzID0gNjY3OwogICAgdC5kaXZpZGUgPSA1ODQ7CiAgICB0LllhY3V0ZSA9IDY2NzsKICAgIHQuQWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LmFhY3V0ZSA9IDU1NjsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDU1NjsKICAgIHQuc2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5lY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDU1NjsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNjExOwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDczNzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNTU2OwogICAgdC5hcmluZyA9IDU1NjsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyNzg7CiAgICB0LmFncmF2ZSA9IDU1NjsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5DYWN1dGUgPSA3MjI7CiAgICB0LmF0aWxkZSA9IDU1NjsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gNTU2OwogICAgdC5zY2VkaWxsYSA9IDU1NjsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDk0OwogICAgdC5SY2Fyb24gPSA3MjI7CiAgICB0Lkdjb21tYWFjY2VudCA9IDc3ODsKICAgIHQudWNpcmN1bWZsZXggPSA2MTE7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5BbWFjcm9uID0gNzIyOwogICAgdC5yY2Fyb24gPSAzODk7CiAgICB0LmNjZWRpbGxhID0gNTU2OwogICAgdC5aZG90YWNjZW50ID0gNjExOwogICAgdC5UaG9ybiA9IDY2NzsKICAgIHQuT21hY3JvbiA9IDc3ODsKICAgIHQuUmFjdXRlID0gNzIyOwogICAgdC5TYWN1dGUgPSA2Njc7CiAgICB0LmRjYXJvbiA9IDc0MzsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA2MTE7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9ncmF2ZSA9IDc3ODsKICAgIHQuQWdyYXZlID0gNzIyOwogICAgdC5BYnJldmUgPSA3MjI7CiAgICB0Lm11bHRpcGx5ID0gNTg0OwogICAgdC51YWN1dGUgPSA2MTE7CiAgICB0LlRjYXJvbiA9IDYxMTsKICAgIHQucGFydGlhbGRpZmYgPSA0OTQ7CiAgICB0LnlkaWVyZXNpcyA9IDU1NjsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDU1NjsKICAgIHQuZWRpZXJlc2lzID0gNTU2OwogICAgdC5jYWN1dGUgPSA1NTY7CiAgICB0Lm5hY3V0ZSA9IDYxMTsKICAgIHQudW1hY3JvbiA9IDYxMTsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAyNzg7CiAgICB0LnBsdXNtaW51cyA9IDU4NDsKICAgIHQuYnJva2VuYmFyID0gMjgwOwogICAgdC5yZWdpc3RlcmVkID0gNzM3OwogICAgdC5HYnJldmUgPSA3Nzg7CiAgICB0Lklkb3RhY2NlbnQgPSAyNzg7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSAzODk7CiAgICB0Lm9tYWNyb24gPSA2MTE7CiAgICB0LlphY3V0ZSA9IDYxMTsKICAgIHQuWmNhcm9uID0gNjExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA3MjI7CiAgICB0Lmxjb21tYWFjY2VudCA9IDI3ODsKICAgIHQudGNhcm9uID0gMzg5OwogICAgdC5lb2dvbmVrID0gNTU2OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA3MjI7CiAgICB0LkFkaWVyZXNpcyA9IDcyMjsKICAgIHQuZWdyYXZlID0gNTU2OwogICAgdC56YWN1dGUgPSA1MDA7CiAgICB0LmlvZ29uZWsgPSAyNzg7CiAgICB0Lk9hY3V0ZSA9IDc3ODsKICAgIHQub2FjdXRlID0gNjExOwogICAgdC5hbWFjcm9uID0gNTU2OwogICAgdC5zYWN1dGUgPSA1NTY7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3Nzg7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNjExOwogICAgdC50d29zdXBlcmlvciA9IDMzMzsKICAgIHQuT2RpZXJlc2lzID0gNzc4OwogICAgdC5tdSA9IDYxMTsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNjExOwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA2MTE7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA4MzQ7CiAgICB0LlNjZWRpbGxhID0gNjY3OwogICAgdC5sY2Fyb24gPSA0MDA7CiAgICB0Lktjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGFjdXRlID0gNjExOwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNTU2OwogICAgdC5JZ3JhdmUgPSAyNzg7CiAgICB0LkltYWNyb24gPSAyNzg7CiAgICB0LkxjYXJvbiA9IDYxMTsKICAgIHQub25laGFsZiA9IDgzNDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDYxMTsKICAgIHQubnRpbGRlID0gNjExOwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA1NTY7CiAgICB0LmdicmV2ZSA9IDYxMTsKICAgIHQub25lcXVhcnRlciA9IDgzNDsKICAgIHQuU2Nhcm9uID0gNjY3OwogICAgdC5TY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3Nzg7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNjExOwogICAgdC5DY2Fyb24gPSA3MjI7CiAgICB0LnVncmF2ZSA9IDYxMTsKICAgIHQucmFkaWNhbCA9IDU0OTsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzODk7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNjExOwogICAgdC5SY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0Lkxjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQXRpbGRlID0gNzIyOwogICAgdC5Bb2dvbmVrID0gNzIyOwogICAgdC5BcmluZyA9IDcyMjsKICAgIHQuT3RpbGRlID0gNzc4OwogICAgdC56ZG90YWNjZW50ID0gNTAwOwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAyNzg7CiAgICB0Lmtjb21tYWFjY2VudCA9IDU1NjsKICAgIHQubWludXMgPSA1ODQ7CiAgICB0LkljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5uY2Fyb24gPSA2MTE7CiAgICB0LnRjb21tYWFjY2VudCA9IDMzMzsKICAgIHQubG9naWNhbG5vdCA9IDU4NDsKICAgIHQub2RpZXJlc2lzID0gNjExOwogICAgdC51ZGllcmVzaXMgPSA2MTE7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LmV0aCA9IDYxMTsKICAgIHQuemNhcm9uID0gNTAwOwogICAgdC5uY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzMzOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTU2OwogIH0pOwogIHRbIkhlbHZldGljYS1PYmxpcXVlIl0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNzg7CiAgICB0LmV4Y2xhbSA9IDI3ODsKICAgIHQucXVvdGVkYmwgPSAzNTU7CiAgICB0Lm51bWJlcnNpZ24gPSA1NTY7CiAgICB0LmRvbGxhciA9IDU1NjsKICAgIHQucGVyY2VudCA9IDg4OTsKICAgIHQuYW1wZXJzYW5kID0gNjY3OwogICAgdC5xdW90ZXJpZ2h0ID0gMjIyOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gMzg5OwogICAgdC5wbHVzID0gNTg0OwogICAgdC5jb21tYSA9IDI3ODsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNzg7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTU2OwogICAgdC5vbmUgPSA1NTY7CiAgICB0LnR3byA9IDU1NjsKICAgIHQudGhyZWUgPSA1NTY7CiAgICB0LmZvdXIgPSA1NTY7CiAgICB0LmZpdmUgPSA1NTY7CiAgICB0LnNpeCA9IDU1NjsKICAgIHQuc2V2ZW4gPSA1NTY7CiAgICB0LmVpZ2h0ID0gNTU2OwogICAgdC5uaW5lID0gNTU2OwogICAgdC5jb2xvbiA9IDI3ODsKICAgIHQuc2VtaWNvbG9uID0gMjc4OwogICAgdC5sZXNzID0gNTg0OwogICAgdC5lcXVhbCA9IDU4NDsKICAgIHQuZ3JlYXRlciA9IDU4NDsKICAgIHQucXVlc3Rpb24gPSA1NTY7CiAgICB0LmF0ID0gMTAxNTsKICAgIHQuQSA9IDY2NzsKICAgIHQuQiA9IDY2NzsKICAgIHQuQyA9IDcyMjsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDc3ODsKICAgIHQuSCA9IDcyMjsKICAgIHQuSSA9IDI3ODsKICAgIHQuSiA9IDUwMDsKICAgIHQuSyA9IDY2NzsKICAgIHQuTCA9IDU1NjsKICAgIHQuTSA9IDgzMzsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDc3ODsKICAgIHQuUCA9IDY2NzsKICAgIHQuUSA9IDc3ODsKICAgIHQuUiA9IDcyMjsKICAgIHQuUyA9IDY2NzsKICAgIHQuVCA9IDYxMTsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDY2NzsKICAgIHQuVyA9IDk0NDsKICAgIHQuWCA9IDY2NzsKICAgIHQuWSA9IDY2NzsKICAgIHQuWiA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAyNzg7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMjc4OwogICAgdC5hc2NpaWNpcmN1bSA9IDQ2OTsKICAgIHQudW5kZXJzY29yZSA9IDU1NjsKICAgIHQucXVvdGVsZWZ0ID0gMjIyOwogICAgdC5hID0gNTU2OwogICAgdC5iID0gNTU2OwogICAgdC5jID0gNTAwOwogICAgdC5kID0gNTU2OwogICAgdC5lID0gNTU2OwogICAgdC5mID0gMjc4OwogICAgdC5nID0gNTU2OwogICAgdC5oID0gNTU2OwogICAgdC5pID0gMjIyOwogICAgdC5qID0gMjIyOwogICAgdC5rID0gNTAwOwogICAgdC5sID0gMjIyOwogICAgdC5tID0gODMzOwogICAgdC5uID0gNTU2OwogICAgdC5vID0gNTU2OwogICAgdC5wID0gNTU2OwogICAgdC5xID0gNTU2OwogICAgdC5yID0gMzMzOwogICAgdC5zID0gNTAwOwogICAgdC50ID0gMjc4OwogICAgdC51ID0gNTU2OwogICAgdC52ID0gNTAwOwogICAgdC53ID0gNzIyOwogICAgdC54ID0gNTAwOwogICAgdC55ID0gNTAwOwogICAgdC56ID0gNTAwOwogICAgdC5icmFjZWxlZnQgPSAzMzQ7CiAgICB0LmJhciA9IDI2MDsKICAgIHQuYnJhY2VyaWdodCA9IDMzNDsKICAgIHQuYXNjaWl0aWxkZSA9IDU4NDsKICAgIHQuZXhjbGFtZG93biA9IDMzMzsKICAgIHQuY2VudCA9IDU1NjsKICAgIHQuc3RlcmxpbmcgPSA1NTY7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1NTY7CiAgICB0LmZsb3JpbiA9IDU1NjsKICAgIHQuc2VjdGlvbiA9IDU1NjsKICAgIHQuY3VycmVuY3kgPSA1NTY7CiAgICB0LnF1b3Rlc2luZ2xlID0gMTkxOwogICAgdC5xdW90ZWRibGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1NTY7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDUwMDsKICAgIHQuZmwgPSA1MDA7CiAgICB0LmVuZGFzaCA9IDU1NjsKICAgIHQuZGFnZ2VyID0gNTU2OwogICAgdC5kYWdnZXJkYmwgPSA1NTY7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjc4OwogICAgdC5wYXJhZ3JhcGggPSA1Mzc7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAyMjI7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDMzMzsKICAgIHQucXVvdGVkYmxyaWdodCA9IDMzMzsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1NTY7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA2MTE7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSAxMDAwOwogICAgdC5vcmRmZW1pbmluZSA9IDM3MDsKICAgIHQuTHNsYXNoID0gNTU2OwogICAgdC5Pc2xhc2ggPSA3Nzg7CiAgICB0Lk9FID0gMTAwMDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzY1OwogICAgdC5hZSA9IDg4OTsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDIyMjsKICAgIHQub3NsYXNoID0gNjExOwogICAgdC5vZSA9IDk0NDsKICAgIHQuZ2VybWFuZGJscyA9IDYxMTsKICAgIHQuSWRpZXJlc2lzID0gMjc4OwogICAgdC5lYWN1dGUgPSA1NTY7CiAgICB0LmFicmV2ZSA9IDU1NjsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuZWNhcm9uID0gNTU2OwogICAgdC5ZZGllcmVzaXMgPSA2Njc7CiAgICB0LmRpdmlkZSA9IDU4NDsKICAgIHQuWWFjdXRlID0gNjY3OwogICAgdC5BY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWFjdXRlID0gNTU2OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTU2OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1NTY7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzM3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA1MDA7CiAgICB0LmFyaW5nID0gNTU2OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDIyMjsKICAgIHQuYWdyYXZlID0gNTU2OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDcyMjsKICAgIHQuYXRpbGRlID0gNTU2OwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSA1MDA7CiAgICB0LnNjZWRpbGxhID0gNTAwOwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDcyMjsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC51Y2lyY3VtZmxleCA9IDU1NjsKICAgIHQuYWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LkFtYWNyb24gPSA2Njc7CiAgICB0LnJjYXJvbiA9IDMzMzsKICAgIHQuY2NlZGlsbGEgPSA1MDA7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNjY3OwogICAgdC5PbWFjcm9uID0gNzc4OwogICAgdC5SYWN1dGUgPSA3MjI7CiAgICB0LlNhY3V0ZSA9IDY2NzsKICAgIHQuZGNhcm9uID0gNjQzOwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDU1NjsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMzMzsKICAgIHQuT2dyYXZlID0gNzc4OwogICAgdC5BZ3JhdmUgPSA2Njc7CiAgICB0LkFicmV2ZSA9IDY2NzsKICAgIHQubXVsdGlwbHkgPSA1ODQ7CiAgICB0LnVhY3V0ZSA9IDU1NjsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTU2OwogICAgdC5lZGllcmVzaXMgPSA1NTY7CiAgICB0LmNhY3V0ZSA9IDUwMDsKICAgIHQubmFjdXRlID0gNTU2OwogICAgdC51bWFjcm9uID0gNTU2OwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDI3ODsKICAgIHQucGx1c21pbnVzID0gNTg0OwogICAgdC5icm9rZW5iYXIgPSAyNjA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3Mzc7CiAgICB0LkdicmV2ZSA9IDc3ODsKICAgIHQuSWRvdGFjY2VudCA9IDI3ODsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDMzMzsKICAgIHQub21hY3JvbiA9IDU1NjsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDcyMjsKICAgIHQubGNvbW1hYWNjZW50ID0gMjIyOwogICAgdC50Y2Fyb24gPSAzMTc7CiAgICB0LmVvZ29uZWsgPSA1NTY7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDY2NzsKICAgIHQuQWRpZXJlc2lzID0gNjY3OwogICAgdC5lZ3JhdmUgPSA1NTY7CiAgICB0LnphY3V0ZSA9IDUwMDsKICAgIHQuaW9nb25layA9IDIyMjsKICAgIHQuT2FjdXRlID0gNzc4OwogICAgdC5vYWN1dGUgPSA1NTY7CiAgICB0LmFtYWNyb24gPSA1NTY7CiAgICB0LnNhY3V0ZSA9IDUwMDsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDc3ODsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1NTY7CiAgICB0LnR3b3N1cGVyaW9yID0gMzMzOwogICAgdC5PZGllcmVzaXMgPSA3Nzg7CiAgICB0Lm11ID0gNTU2OwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDU1NjsKICAgIHQudGhyZWVxdWFydGVycyA9IDgzNDsKICAgIHQuU2NlZGlsbGEgPSA2Njc7CiAgICB0LmxjYXJvbiA9IDI5OTsKICAgIHQuS2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MYWN1dGUgPSA1NTY7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA1NTY7CiAgICB0LklncmF2ZSA9IDI3ODsKICAgIHQuSW1hY3JvbiA9IDI3ODsKICAgIHQuTGNhcm9uID0gNTU2OwogICAgdC5vbmVoYWxmID0gODM0OwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNTU2OwogICAgdC5udGlsZGUgPSA1NTY7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDU1NjsKICAgIHQuZ2JyZXZlID0gNTU2OwogICAgdC5vbmVxdWFydGVyID0gODM0OwogICAgdC5TY2Fyb24gPSA2Njc7CiAgICB0LlNjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDc3ODsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA1NTY7CiAgICB0LkNjYXJvbiA9IDcyMjsKICAgIHQudWdyYXZlID0gNTU2OwogICAgdC5yYWRpY2FsID0gNDUzOwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDMzMzsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA1NTY7CiAgICB0LlJjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGNvbW1hYWNjZW50ID0gNTU2OwogICAgdC5BdGlsZGUgPSA2Njc7CiAgICB0LkFvZ29uZWsgPSA2Njc7CiAgICB0LkFyaW5nID0gNjY3OwogICAgdC5PdGlsZGUgPSA3Nzg7CiAgICB0Lnpkb3RhY2NlbnQgPSA1MDA7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDI3ODsKICAgIHQua2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5taW51cyA9IDU4NDsKICAgIHQuSWNpcmN1bWZsZXggPSAyNzg7CiAgICB0Lm5jYXJvbiA9IDU1NjsKICAgIHQudGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC5sb2dpY2Fsbm90ID0gNTg0OwogICAgdC5vZGllcmVzaXMgPSA1NTY7CiAgICB0LnVkaWVyZXNpcyA9IDU1NjsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuZXRoID0gNTU2OwogICAgdC56Y2Fyb24gPSA1MDA7CiAgICB0Lm5jb21tYWFjY2VudCA9IDU1NjsKICAgIHQub25lc3VwZXJpb3IgPSAzMzM7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1NTY7CiAgfSk7CiAgdC5TeW1ib2wgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNTA7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQudW5pdmVyc2FsID0gNzEzOwogICAgdC5udW1iZXJzaWduID0gNTAwOwogICAgdC5leGlzdGVudGlhbCA9IDU0OTsKICAgIHQucGVyY2VudCA9IDgzMzsKICAgIHQuYW1wZXJzYW5kID0gNzc4OwogICAgdC5zdWNodGhhdCA9IDQzOTsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3Rlcmlza21hdGggPSA1MDA7CiAgICB0LnBsdXMgPSA1NDk7CiAgICB0LmNvbW1hID0gMjUwOwogICAgdC5taW51cyA9IDU0OTsKICAgIHQucGVyaW9kID0gMjUwOwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDUwMDsKICAgIHQub25lID0gNTAwOwogICAgdC50d28gPSA1MDA7CiAgICB0LnRocmVlID0gNTAwOwogICAgdC5mb3VyID0gNTAwOwogICAgdC5maXZlID0gNTAwOwogICAgdC5zaXggPSA1MDA7CiAgICB0LnNldmVuID0gNTAwOwogICAgdC5laWdodCA9IDUwMDsKICAgIHQubmluZSA9IDUwMDsKICAgIHQuY29sb24gPSAyNzg7CiAgICB0LnNlbWljb2xvbiA9IDI3ODsKICAgIHQubGVzcyA9IDU0OTsKICAgIHQuZXF1YWwgPSA1NDk7CiAgICB0LmdyZWF0ZXIgPSA1NDk7CiAgICB0LnF1ZXN0aW9uID0gNDQ0OwogICAgdC5jb25ncnVlbnQgPSA1NDk7CiAgICB0LkFscGhhID0gNzIyOwogICAgdC5CZXRhID0gNjY3OwogICAgdC5DaGkgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC5FcHNpbG9uID0gNjExOwogICAgdC5QaGkgPSA3NjM7CiAgICB0LkdhbW1hID0gNjAzOwogICAgdC5FdGEgPSA3MjI7CiAgICB0LklvdGEgPSAzMzM7CiAgICB0LnRoZXRhMSA9IDYzMTsKICAgIHQuS2FwcGEgPSA3MjI7CiAgICB0LkxhbWJkYSA9IDY4NjsKICAgIHQuTXUgPSA4ODk7CiAgICB0Lk51ID0gNzIyOwogICAgdC5PbWljcm9uID0gNzIyOwogICAgdC5QaSA9IDc2ODsKICAgIHQuVGhldGEgPSA3NDE7CiAgICB0LlJobyA9IDU1NjsKICAgIHQuU2lnbWEgPSA1OTI7CiAgICB0LlRhdSA9IDYxMTsKICAgIHQuVXBzaWxvbiA9IDY5MDsKICAgIHQuc2lnbWExID0gNDM5OwogICAgdC5PbWVnYSA9IDc2ODsKICAgIHQuWGkgPSA2NDU7CiAgICB0LlBzaSA9IDc5NTsKICAgIHQuWmV0YSA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAzMzM7CiAgICB0LnRoZXJlZm9yZSA9IDg2MzsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMzMzOwogICAgdC5wZXJwZW5kaWN1bGFyID0gNjU4OwogICAgdC51bmRlcnNjb3JlID0gNTAwOwogICAgdC5yYWRpY2FsZXggPSA1MDA7CiAgICB0LmFscGhhID0gNjMxOwogICAgdC5iZXRhID0gNTQ5OwogICAgdC5jaGkgPSA1NDk7CiAgICB0LmRlbHRhID0gNDk0OwogICAgdC5lcHNpbG9uID0gNDM5OwogICAgdC5waGkgPSA1MjE7CiAgICB0LmdhbW1hID0gNDExOwogICAgdC5ldGEgPSA2MDM7CiAgICB0LmlvdGEgPSAzMjk7CiAgICB0LnBoaTEgPSA2MDM7CiAgICB0LmthcHBhID0gNTQ5OwogICAgdC5sYW1iZGEgPSA1NDk7CiAgICB0Lm11ID0gNTc2OwogICAgdC5udSA9IDUyMTsKICAgIHQub21pY3JvbiA9IDU0OTsKICAgIHQucGkgPSA1NDk7CiAgICB0LnRoZXRhID0gNTIxOwogICAgdC5yaG8gPSA1NDk7CiAgICB0LnNpZ21hID0gNjAzOwogICAgdC50YXUgPSA0Mzk7CiAgICB0LnVwc2lsb24gPSA1NzY7CiAgICB0Lm9tZWdhMSA9IDcxMzsKICAgIHQub21lZ2EgPSA2ODY7CiAgICB0LnhpID0gNDkzOwogICAgdC5wc2kgPSA2ODY7CiAgICB0LnpldGEgPSA0OTQ7CiAgICB0LmJyYWNlbGVmdCA9IDQ4MDsKICAgIHQuYmFyID0gMjAwOwogICAgdC5icmFjZXJpZ2h0ID0gNDgwOwogICAgdC5zaW1pbGFyID0gNTQ5OwogICAgdC5FdXJvID0gNzUwOwogICAgdC5VcHNpbG9uMSA9IDYyMDsKICAgIHQubWludXRlID0gMjQ3OwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC5pbmZpbml0eSA9IDcxMzsKICAgIHQuZmxvcmluID0gNTAwOwogICAgdC5jbHViID0gNzUzOwogICAgdC5kaWFtb25kID0gNzUzOwogICAgdC5oZWFydCA9IDc1MzsKICAgIHQuc3BhZGUgPSA3NTM7CiAgICB0LmFycm93Ym90aCA9IDEwNDI7CiAgICB0LmFycm93bGVmdCA9IDk4NzsKICAgIHQuYXJyb3d1cCA9IDYwMzsKICAgIHQuYXJyb3dyaWdodCA9IDk4NzsKICAgIHQuYXJyb3dkb3duID0gNjAzOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0LnBsdXNtaW51cyA9IDU0OTsKICAgIHQuc2Vjb25kID0gNDExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0Lm11bHRpcGx5ID0gNTQ5OwogICAgdC5wcm9wb3J0aW9uYWwgPSA3MTM7CiAgICB0LnBhcnRpYWxkaWZmID0gNDk0OwogICAgdC5idWxsZXQgPSA0NjA7CiAgICB0LmRpdmlkZSA9IDU0OTsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0LmVxdWl2YWxlbmNlID0gNTQ5OwogICAgdC5hcHByb3hlcXVhbCA9IDU0OTsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5hcnJvd3ZlcnRleCA9IDYwMzsKICAgIHQuYXJyb3dob3JpemV4ID0gMTAwMDsKICAgIHQuY2FycmlhZ2VyZXR1cm4gPSA2NTg7CiAgICB0LmFsZXBoID0gODIzOwogICAgdC5JZnJha3R1ciA9IDY4NjsKICAgIHQuUmZyYWt0dXIgPSA3OTU7CiAgICB0LndlaWVyc3RyYXNzID0gOTg3OwogICAgdC5jaXJjbGVtdWx0aXBseSA9IDc2ODsKICAgIHQuY2lyY2xlcGx1cyA9IDc2ODsKICAgIHQuZW1wdHlzZXQgPSA4MjM7CiAgICB0LmludGVyc2VjdGlvbiA9IDc2ODsKICAgIHQudW5pb24gPSA3Njg7CiAgICB0LnByb3BlcnN1cGVyc2V0ID0gNzEzOwogICAgdC5yZWZsZXhzdXBlcnNldCA9IDcxMzsKICAgIHQubm90c3Vic2V0ID0gNzEzOwogICAgdC5wcm9wZXJzdWJzZXQgPSA3MTM7CiAgICB0LnJlZmxleHN1YnNldCA9IDcxMzsKICAgIHQuZWxlbWVudCA9IDcxMzsKICAgIHQubm90ZWxlbWVudCA9IDcxMzsKICAgIHQuYW5nbGUgPSA3Njg7CiAgICB0LmdyYWRpZW50ID0gNzEzOwogICAgdC5yZWdpc3RlcnNlcmlmID0gNzkwOwogICAgdC5jb3B5cmlnaHRzZXJpZiA9IDc5MDsKICAgIHQudHJhZGVtYXJrc2VyaWYgPSA4OTA7CiAgICB0LnByb2R1Y3QgPSA4MjM7CiAgICB0LnJhZGljYWwgPSA1NDk7CiAgICB0LmRvdG1hdGggPSAyNTA7CiAgICB0LmxvZ2ljYWxub3QgPSA3MTM7CiAgICB0LmxvZ2ljYWxhbmQgPSA2MDM7CiAgICB0LmxvZ2ljYWxvciA9IDYwMzsKICAgIHQuYXJyb3dkYmxib3RoID0gMTA0MjsKICAgIHQuYXJyb3dkYmxsZWZ0ID0gOTg3OwogICAgdC5hcnJvd2RibHVwID0gNjAzOwogICAgdC5hcnJvd2RibHJpZ2h0ID0gOTg3OwogICAgdC5hcnJvd2RibGRvd24gPSA2MDM7CiAgICB0LmxvemVuZ2UgPSA0OTQ7CiAgICB0LmFuZ2xlbGVmdCA9IDMyOTsKICAgIHQucmVnaXN0ZXJzYW5zID0gNzkwOwogICAgdC5jb3B5cmlnaHRzYW5zID0gNzkwOwogICAgdC50cmFkZW1hcmtzYW5zID0gNzg2OwogICAgdC5zdW1tYXRpb24gPSA3MTM7CiAgICB0LnBhcmVubGVmdHRwID0gMzg0OwogICAgdC5wYXJlbmxlZnRleCA9IDM4NDsKICAgIHQucGFyZW5sZWZ0YnQgPSAzODQ7CiAgICB0LmJyYWNrZXRsZWZ0dHAgPSAzODQ7CiAgICB0LmJyYWNrZXRsZWZ0ZXggPSAzODQ7CiAgICB0LmJyYWNrZXRsZWZ0YnQgPSAzODQ7CiAgICB0LmJyYWNlbGVmdHRwID0gNDk0OwogICAgdC5icmFjZWxlZnRtaWQgPSA0OTQ7CiAgICB0LmJyYWNlbGVmdGJ0ID0gNDk0OwogICAgdC5icmFjZWV4ID0gNDk0OwogICAgdC5hbmdsZXJpZ2h0ID0gMzI5OwogICAgdC5pbnRlZ3JhbCA9IDI3NDsKICAgIHQuaW50ZWdyYWx0cCA9IDY4NjsKICAgIHQuaW50ZWdyYWxleCA9IDY4NjsKICAgIHQuaW50ZWdyYWxidCA9IDY4NjsKICAgIHQucGFyZW5yaWdodHRwID0gMzg0OwogICAgdC5wYXJlbnJpZ2h0ZXggPSAzODQ7CiAgICB0LnBhcmVucmlnaHRidCA9IDM4NDsKICAgIHQuYnJhY2tldHJpZ2h0dHAgPSAzODQ7CiAgICB0LmJyYWNrZXRyaWdodGV4ID0gMzg0OwogICAgdC5icmFja2V0cmlnaHRidCA9IDM4NDsKICAgIHQuYnJhY2VyaWdodHRwID0gNDk0OwogICAgdC5icmFjZXJpZ2h0bWlkID0gNDk0OwogICAgdC5icmFjZXJpZ2h0YnQgPSA0OTQ7CiAgICB0LmFwcGxlID0gNzkwOwogIH0pOwogIHRbIlRpbWVzLVJvbWFuIl0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNTA7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQucXVvdGVkYmwgPSA0MDg7CiAgICB0Lm51bWJlcnNpZ24gPSA1MDA7CiAgICB0LmRvbGxhciA9IDUwMDsKICAgIHQucGVyY2VudCA9IDgzMzsKICAgIHQuYW1wZXJzYW5kID0gNzc4OwogICAgdC5xdW90ZXJpZ2h0ID0gMzMzOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gNTAwOwogICAgdC5wbHVzID0gNTY0OwogICAgdC5jb21tYSA9IDI1MDsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNTA7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTAwOwogICAgdC5vbmUgPSA1MDA7CiAgICB0LnR3byA9IDUwMDsKICAgIHQudGhyZWUgPSA1MDA7CiAgICB0LmZvdXIgPSA1MDA7CiAgICB0LmZpdmUgPSA1MDA7CiAgICB0LnNpeCA9IDUwMDsKICAgIHQuc2V2ZW4gPSA1MDA7CiAgICB0LmVpZ2h0ID0gNTAwOwogICAgdC5uaW5lID0gNTAwOwogICAgdC5jb2xvbiA9IDI3ODsKICAgIHQuc2VtaWNvbG9uID0gMjc4OwogICAgdC5sZXNzID0gNTY0OwogICAgdC5lcXVhbCA9IDU2NDsKICAgIHQuZ3JlYXRlciA9IDU2NDsKICAgIHQucXVlc3Rpb24gPSA0NDQ7CiAgICB0LmF0ID0gOTIxOwogICAgdC5BID0gNzIyOwogICAgdC5CID0gNjY3OwogICAgdC5DID0gNjY3OwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjExOwogICAgdC5GID0gNTU2OwogICAgdC5HID0gNzIyOwogICAgdC5IID0gNzIyOwogICAgdC5JID0gMzMzOwogICAgdC5KID0gMzg5OwogICAgdC5LID0gNzIyOwogICAgdC5MID0gNjExOwogICAgdC5NID0gODg5OwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzIyOwogICAgdC5QID0gNTU2OwogICAgdC5RID0gNzIyOwogICAgdC5SID0gNjY3OwogICAgdC5TID0gNTU2OwogICAgdC5UID0gNjExOwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNzIyOwogICAgdC5XID0gOTQ0OwogICAgdC5YID0gNzIyOwogICAgdC5ZID0gNzIyOwogICAgdC5aID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDMzMzsKICAgIHQuYmFja3NsYXNoID0gMjc4OwogICAgdC5icmFja2V0cmlnaHQgPSAzMzM7CiAgICB0LmFzY2lpY2lyY3VtID0gNDY5OwogICAgdC51bmRlcnNjb3JlID0gNTAwOwogICAgdC5xdW90ZWxlZnQgPSAzMzM7CiAgICB0LmEgPSA0NDQ7CiAgICB0LmIgPSA1MDA7CiAgICB0LmMgPSA0NDQ7CiAgICB0LmQgPSA1MDA7CiAgICB0LmUgPSA0NDQ7CiAgICB0LmYgPSAzMzM7CiAgICB0LmcgPSA1MDA7CiAgICB0LmggPSA1MDA7CiAgICB0LmkgPSAyNzg7CiAgICB0LmogPSAyNzg7CiAgICB0LmsgPSA1MDA7CiAgICB0LmwgPSAyNzg7CiAgICB0Lm0gPSA3Nzg7CiAgICB0Lm4gPSA1MDA7CiAgICB0Lm8gPSA1MDA7CiAgICB0LnAgPSA1MDA7CiAgICB0LnEgPSA1MDA7CiAgICB0LnIgPSAzMzM7CiAgICB0LnMgPSAzODk7CiAgICB0LnQgPSAyNzg7CiAgICB0LnUgPSA1MDA7CiAgICB0LnYgPSA1MDA7CiAgICB0LncgPSA3MjI7CiAgICB0LnggPSA1MDA7CiAgICB0LnkgPSA1MDA7CiAgICB0LnogPSA0NDQ7CiAgICB0LmJyYWNlbGVmdCA9IDQ4MDsKICAgIHQuYmFyID0gMjAwOwogICAgdC5icmFjZXJpZ2h0ID0gNDgwOwogICAgdC5hc2NpaXRpbGRlID0gNTQxOwogICAgdC5leGNsYW1kb3duID0gMzMzOwogICAgdC5jZW50ID0gNTAwOwogICAgdC5zdGVybGluZyA9IDUwMDsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LnllbiA9IDUwMDsKICAgIHQuZmxvcmluID0gNTAwOwogICAgdC5zZWN0aW9uID0gNTAwOwogICAgdC5jdXJyZW5jeSA9IDUwMDsKICAgIHQucXVvdGVzaW5nbGUgPSAxODA7CiAgICB0LnF1b3RlZGJsbGVmdCA9IDQ0NDsKICAgIHQuZ3VpbGxlbW90bGVmdCA9IDUwMDsKICAgIHQuZ3VpbHNpbmdsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbHNpbmdscmlnaHQgPSAzMzM7CiAgICB0LmZpID0gNTU2OwogICAgdC5mbCA9IDU1NjsKICAgIHQuZW5kYXNoID0gNTAwOwogICAgdC5kYWdnZXIgPSA1MDA7CiAgICB0LmRhZ2dlcmRibCA9IDUwMDsKICAgIHQucGVyaW9kY2VudGVyZWQgPSAyNTA7CiAgICB0LnBhcmFncmFwaCA9IDQ1MzsKICAgIHQuYnVsbGV0ID0gMzUwOwogICAgdC5xdW90ZXNpbmdsYmFzZSA9IDMzMzsKICAgIHQucXVvdGVkYmxiYXNlID0gNDQ0OwogICAgdC5xdW90ZWRibHJpZ2h0ID0gNDQ0OwogICAgdC5ndWlsbGVtb3RyaWdodCA9IDUwMDsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDQ0NDsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSAxMDAwOwogICAgdC5BRSA9IDg4OTsKICAgIHQub3JkZmVtaW5pbmUgPSAyNzY7CiAgICB0LkxzbGFzaCA9IDYxMTsKICAgIHQuT3NsYXNoID0gNzIyOwogICAgdC5PRSA9IDg4OTsKICAgIHQub3JkbWFzY3VsaW5lID0gMzEwOwogICAgdC5hZSA9IDY2NzsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDcyMjsKICAgIHQuZ2VybWFuZGJscyA9IDUwMDsKICAgIHQuSWRpZXJlc2lzID0gMzMzOwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDQ0NDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA3MjI7CiAgICB0LmRpdmlkZSA9IDU2NDsKICAgIHQuWWFjdXRlID0gNzIyOwogICAgdC5BY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuYWFjdXRlID0gNDQ0OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNDQ0OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1MDA7CiAgICB0LkVkaWVyZXNpcyA9IDYxMTsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzYwOwogICAgdC5FbWFjcm9uID0gNjExOwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNDQ0OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNDQ0OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDY2NzsKICAgIHQuYXRpbGRlID0gNDQ0OwogICAgdC5FZG90YWNjZW50ID0gNjExOwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDY2NzsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC51Y2lyY3VtZmxleCA9IDUwMDsKICAgIHQuYWNpcmN1bWZsZXggPSA0NDQ7CiAgICB0LkFtYWNyb24gPSA3MjI7CiAgICB0LnJjYXJvbiA9IDMzMzsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNTU2OwogICAgdC5PbWFjcm9uID0gNzIyOwogICAgdC5SYWN1dGUgPSA2Njc7CiAgICB0LlNhY3V0ZSA9IDU1NjsKICAgIHQuZGNhcm9uID0gNTg4OwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDUwMDsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzIyOwogICAgdC5BZ3JhdmUgPSA3MjI7CiAgICB0LkFicmV2ZSA9IDcyMjsKICAgIHQubXVsdGlwbHkgPSA1NjQ7CiAgICB0LnVhY3V0ZSA9IDUwMDsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWRpZXJlc2lzID0gNDQ0OwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTAwOwogICAgdC51bWFjcm9uID0gNTAwOwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDMzMzsKICAgIHQucGx1c21pbnVzID0gNTY0OwogICAgdC5icm9rZW5iYXIgPSAyMDA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NjA7CiAgICB0LkdicmV2ZSA9IDcyMjsKICAgIHQuSWRvdGFjY2VudCA9IDMzMzsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2MTE7CiAgICB0LnJhY3V0ZSA9IDMzMzsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDY2NzsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzMjY7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDcyMjsKICAgIHQuQWRpZXJlc2lzID0gNzIyOwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDQ0NDsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzIyOwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA0NDQ7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1MDA7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3MjI7CiAgICB0Lm11ID0gNTAwOwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2MTE7CiAgICB0LmRjcm9hdCA9IDUwMDsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1NTY7CiAgICB0LmxjYXJvbiA9IDM0NDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MYWN1dGUgPSA2MTE7CiAgICB0LnRyYWRlbWFyayA9IDk4MDsKICAgIHQuZWRvdGFjY2VudCA9IDQ0NDsKICAgIHQuSWdyYXZlID0gMzMzOwogICAgdC5JbWFjcm9uID0gMzMzOwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA3NTA7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1MDA7CiAgICB0Lm50aWxkZSA9IDUwMDsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjExOwogICAgdC5lbWFjcm9uID0gNDQ0OwogICAgdC5nYnJldmUgPSA1MDA7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA3NTA7CiAgICB0LlNjYXJvbiA9IDU1NjsKICAgIHQuU2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDUwMDsKICAgIHQuQ2Nhcm9uID0gNjY3OwogICAgdC51Z3JhdmUgPSA1MDA7CiAgICB0LnJhZGljYWwgPSA0NTM7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDUwMDsKICAgIHQuUmNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkF0aWxkZSA9IDcyMjsKICAgIHQuQW9nb25layA9IDcyMjsKICAgIHQuQXJpbmcgPSA3MjI7CiAgICB0Lk90aWxkZSA9IDcyMjsKICAgIHQuemRvdGFjY2VudCA9IDQ0NDsKICAgIHQuRWNhcm9uID0gNjExOwogICAgdC5Jb2dvbmVrID0gMzMzOwogICAgdC5rY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm1pbnVzID0gNTY0OwogICAgdC5JY2lyY3VtZmxleCA9IDMzMzsKICAgIHQubmNhcm9uID0gNTAwOwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA1NjQ7CiAgICB0Lm9kaWVyZXNpcyA9IDUwMDsKICAgIHQudWRpZXJlc2lzID0gNTAwOwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5ldGggPSA1MDA7CiAgICB0LnpjYXJvbiA9IDQ0NDsKICAgIHQubmNvbW1hYWNjZW50ID0gNTAwOwogICAgdC5vbmVzdXBlcmlvciA9IDMwMDsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDUwMDsKICB9KTsKICB0WyJUaW1lcy1Cb2xkIl0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNTA7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQucXVvdGVkYmwgPSA1NTU7CiAgICB0Lm51bWJlcnNpZ24gPSA1MDA7CiAgICB0LmRvbGxhciA9IDUwMDsKICAgIHQucGVyY2VudCA9IDEwMDA7CiAgICB0LmFtcGVyc2FuZCA9IDgzMzsKICAgIHQucXVvdGVyaWdodCA9IDMzMzsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3RlcmlzayA9IDUwMDsKICAgIHQucGx1cyA9IDU3MDsKICAgIHQuY29tbWEgPSAyNTA7CiAgICB0Lmh5cGhlbiA9IDMzMzsKICAgIHQucGVyaW9kID0gMjUwOwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDUwMDsKICAgIHQub25lID0gNTAwOwogICAgdC50d28gPSA1MDA7CiAgICB0LnRocmVlID0gNTAwOwogICAgdC5mb3VyID0gNTAwOwogICAgdC5maXZlID0gNTAwOwogICAgdC5zaXggPSA1MDA7CiAgICB0LnNldmVuID0gNTAwOwogICAgdC5laWdodCA9IDUwMDsKICAgIHQubmluZSA9IDUwMDsKICAgIHQuY29sb24gPSAzMzM7CiAgICB0LnNlbWljb2xvbiA9IDMzMzsKICAgIHQubGVzcyA9IDU3MDsKICAgIHQuZXF1YWwgPSA1NzA7CiAgICB0LmdyZWF0ZXIgPSA1NzA7CiAgICB0LnF1ZXN0aW9uID0gNTAwOwogICAgdC5hdCA9IDkzMDsKICAgIHQuQSA9IDcyMjsKICAgIHQuQiA9IDY2NzsKICAgIHQuQyA9IDcyMjsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDc3ODsKICAgIHQuSCA9IDc3ODsKICAgIHQuSSA9IDM4OTsKICAgIHQuSiA9IDUwMDsKICAgIHQuSyA9IDc3ODsKICAgIHQuTCA9IDY2NzsKICAgIHQuTSA9IDk0NDsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDc3ODsKICAgIHQuUCA9IDYxMTsKICAgIHQuUSA9IDc3ODsKICAgIHQuUiA9IDcyMjsKICAgIHQuUyA9IDU1NjsKICAgIHQuVCA9IDY2NzsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDcyMjsKICAgIHQuVyA9IDEwMDA7CiAgICB0LlggPSA3MjI7CiAgICB0LlkgPSA3MjI7CiAgICB0LlogPSA2Njc7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA1ODE7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnF1b3RlbGVmdCA9IDMzMzsKICAgIHQuYSA9IDUwMDsKICAgIHQuYiA9IDU1NjsKICAgIHQuYyA9IDQ0NDsKICAgIHQuZCA9IDU1NjsKICAgIHQuZSA9IDQ0NDsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDUwMDsKICAgIHQuaCA9IDU1NjsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDMzMzsKICAgIHQuayA9IDU1NjsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDgzMzsKICAgIHQubiA9IDU1NjsKICAgIHQubyA9IDUwMDsKICAgIHQucCA9IDU1NjsKICAgIHQucSA9IDU1NjsKICAgIHQuciA9IDQ0NDsKICAgIHQucyA9IDM4OTsKICAgIHQudCA9IDMzMzsKICAgIHQudSA9IDU1NjsKICAgIHQudiA9IDUwMDsKICAgIHQudyA9IDcyMjsKICAgIHQueCA9IDUwMDsKICAgIHQueSA9IDUwMDsKICAgIHQueiA9IDQ0NDsKICAgIHQuYnJhY2VsZWZ0ID0gMzk0OwogICAgdC5iYXIgPSAyMjA7CiAgICB0LmJyYWNlcmlnaHQgPSAzOTQ7CiAgICB0LmFzY2lpdGlsZGUgPSA1MjA7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1MDA7CiAgICB0LnN0ZXJsaW5nID0gNTAwOwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTAwOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LnNlY3Rpb24gPSA1MDA7CiAgICB0LmN1cnJlbmN5ID0gNTAwOwogICAgdC5xdW90ZXNpbmdsZSA9IDI3ODsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTAwOwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1NTY7CiAgICB0LmZsID0gNTU2OwogICAgdC5lbmRhc2ggPSA1MDA7CiAgICB0LmRhZ2dlciA9IDUwMDsKICAgIHQuZGFnZ2VyZGJsID0gNTAwOwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI1MDsKICAgIHQucGFyYWdyYXBoID0gNTQwOwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibGJhc2UgPSA1MDA7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTAwOwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNTAwOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gMTAwMDsKICAgIHQub3JkZmVtaW5pbmUgPSAzMDA7CiAgICB0LkxzbGFzaCA9IDY2NzsKICAgIHQuT3NsYXNoID0gNzc4OwogICAgdC5PRSA9IDEwMDA7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDMzMDsKICAgIHQuYWUgPSA3MjI7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyNzg7CiAgICB0Lm9zbGFzaCA9IDUwMDsKICAgIHQub2UgPSA3MjI7CiAgICB0Lmdlcm1hbmRibHMgPSA1NTY7CiAgICB0LklkaWVyZXNpcyA9IDM4OTsKICAgIHQuZWFjdXRlID0gNDQ0OwogICAgdC5hYnJldmUgPSA1MDA7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LmVjYXJvbiA9IDQ0NDsKICAgIHQuWWRpZXJlc2lzID0gNzIyOwogICAgdC5kaXZpZGUgPSA1NzA7CiAgICB0LllhY3V0ZSA9IDcyMjsKICAgIHQuQWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LmFhY3V0ZSA9IDUwMDsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDUwMDsKICAgIHQuc2NvbW1hYWNjZW50ID0gMzg5OwogICAgdC5lY2lyY3VtZmxleCA9IDQ0NDsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDUwMDsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNTU2OwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDc0NzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNDQ0OwogICAgdC5hcmluZyA9IDUwMDsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyNzg7CiAgICB0LmFncmF2ZSA9IDUwMDsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5DYWN1dGUgPSA3MjI7CiAgICB0LmF0aWxkZSA9IDUwMDsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gMzg5OwogICAgdC5zY2VkaWxsYSA9IDM4OTsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDk0OwogICAgdC5SY2Fyb24gPSA3MjI7CiAgICB0Lkdjb21tYWFjY2VudCA9IDc3ODsKICAgIHQudWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTAwOwogICAgdC5BbWFjcm9uID0gNzIyOwogICAgdC5yY2Fyb24gPSA0NDQ7CiAgICB0LmNjZWRpbGxhID0gNDQ0OwogICAgdC5aZG90YWNjZW50ID0gNjY3OwogICAgdC5UaG9ybiA9IDYxMTsKICAgIHQuT21hY3JvbiA9IDc3ODsKICAgIHQuUmFjdXRlID0gNzIyOwogICAgdC5TYWN1dGUgPSA1NTY7CiAgICB0LmRjYXJvbiA9IDY3MjsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA1NTY7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMDA7CiAgICB0Lk9ncmF2ZSA9IDc3ODsKICAgIHQuQWdyYXZlID0gNzIyOwogICAgdC5BYnJldmUgPSA3MjI7CiAgICB0Lm11bHRpcGx5ID0gNTcwOwogICAgdC51YWN1dGUgPSA1NTY7CiAgICB0LlRjYXJvbiA9IDY2NzsKICAgIHQucGFydGlhbGRpZmYgPSA0OTQ7CiAgICB0LnlkaWVyZXNpcyA9IDUwMDsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDUwMDsKICAgIHQuZWRpZXJlc2lzID0gNDQ0OwogICAgdC5jYWN1dGUgPSA0NDQ7CiAgICB0Lm5hY3V0ZSA9IDU1NjsKICAgIHQudW1hY3JvbiA9IDU1NjsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAzODk7CiAgICB0LnBsdXNtaW51cyA9IDU3MDsKICAgIHQuYnJva2VuYmFyID0gMjIwOwogICAgdC5yZWdpc3RlcmVkID0gNzQ3OwogICAgdC5HYnJldmUgPSA3Nzg7CiAgICB0Lklkb3RhY2NlbnQgPSAzODk7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSA0NDQ7CiAgICB0Lm9tYWNyb24gPSA1MDA7CiAgICB0LlphY3V0ZSA9IDY2NzsKICAgIHQuWmNhcm9uID0gNjY3OwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA3MjI7CiAgICB0Lmxjb21tYWFjY2VudCA9IDI3ODsKICAgIHQudGNhcm9uID0gNDE2OwogICAgdC5lb2dvbmVrID0gNDQ0OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA3MjI7CiAgICB0LkFkaWVyZXNpcyA9IDcyMjsKICAgIHQuZWdyYXZlID0gNDQ0OwogICAgdC56YWN1dGUgPSA0NDQ7CiAgICB0LmlvZ29uZWsgPSAyNzg7CiAgICB0Lk9hY3V0ZSA9IDc3ODsKICAgIHQub2FjdXRlID0gNTAwOwogICAgdC5hbWFjcm9uID0gNTAwOwogICAgdC5zYWN1dGUgPSAzODk7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3Nzg7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNTU2OwogICAgdC50d29zdXBlcmlvciA9IDMwMDsKICAgIHQuT2RpZXJlc2lzID0gNzc4OwogICAgdC5tdSA9IDU1NjsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNTAwOwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA1NTY7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA3NTA7CiAgICB0LlNjZWRpbGxhID0gNTU2OwogICAgdC5sY2Fyb24gPSAzOTQ7CiAgICB0Lktjb21tYWFjY2VudCA9IDc3ODsKICAgIHQuTGFjdXRlID0gNjY3OwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNDQ0OwogICAgdC5JZ3JhdmUgPSAzODk7CiAgICB0LkltYWNyb24gPSAzODk7CiAgICB0LkxjYXJvbiA9IDY2NzsKICAgIHQub25laGFsZiA9IDc1MDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDUwMDsKICAgIHQubnRpbGRlID0gNTU2OwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA0NDQ7CiAgICB0LmdicmV2ZSA9IDUwMDsKICAgIHQub25lcXVhcnRlciA9IDc1MDsKICAgIHQuU2Nhcm9uID0gNTU2OwogICAgdC5TY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3Nzg7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNTAwOwogICAgdC5DY2Fyb24gPSA3MjI7CiAgICB0LnVncmF2ZSA9IDU1NjsKICAgIHQucmFkaWNhbCA9IDU0OTsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSA0NDQ7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNTAwOwogICAgdC5SY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0Lkxjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuQXRpbGRlID0gNzIyOwogICAgdC5Bb2dvbmVrID0gNzIyOwogICAgdC5BcmluZyA9IDcyMjsKICAgIHQuT3RpbGRlID0gNzc4OwogICAgdC56ZG90YWNjZW50ID0gNDQ0OwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAzODk7CiAgICB0Lmtjb21tYWFjY2VudCA9IDU1NjsKICAgIHQubWludXMgPSA1NzA7CiAgICB0LkljaXJjdW1mbGV4ID0gMzg5OwogICAgdC5uY2Fyb24gPSA1NTY7CiAgICB0LnRjb21tYWFjY2VudCA9IDMzMzsKICAgIHQubG9naWNhbG5vdCA9IDU3MDsKICAgIHQub2RpZXJlc2lzID0gNTAwOwogICAgdC51ZGllcmVzaXMgPSA1NTY7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmV0aCA9IDUwMDsKICAgIHQuemNhcm9uID0gNDQ0OwogICAgdC5uY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzAwOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTAwOwogIH0pOwogIHRbIlRpbWVzLUJvbGRJdGFsaWMiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzg5OwogICAgdC5xdW90ZWRibCA9IDU1NTsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZG9sbGFyID0gNTAwOwogICAgdC5wZXJjZW50ID0gODMzOwogICAgdC5hbXBlcnNhbmQgPSA3Nzg7CiAgICB0LnF1b3RlcmlnaHQgPSAzMzM7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSA1MDA7CiAgICB0LnBsdXMgPSA1NzA7CiAgICB0LmNvbW1hID0gMjUwOwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI1MDsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1MDA7CiAgICB0Lm9uZSA9IDUwMDsKICAgIHQudHdvID0gNTAwOwogICAgdC50aHJlZSA9IDUwMDsKICAgIHQuZm91ciA9IDUwMDsKICAgIHQuZml2ZSA9IDUwMDsKICAgIHQuc2l4ID0gNTAwOwogICAgdC5zZXZlbiA9IDUwMDsKICAgIHQuZWlnaHQgPSA1MDA7CiAgICB0Lm5pbmUgPSA1MDA7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA1NzA7CiAgICB0LmVxdWFsID0gNTcwOwogICAgdC5ncmVhdGVyID0gNTcwOwogICAgdC5xdWVzdGlvbiA9IDUwMDsKICAgIHQuYXQgPSA4MzI7CiAgICB0LkEgPSA2Njc7CiAgICB0LkIgPSA2Njc7CiAgICB0LkMgPSA2Njc7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2Njc7CiAgICB0LkYgPSA2Njc7CiAgICB0LkcgPSA3MjI7CiAgICB0LkggPSA3Nzg7CiAgICB0LkkgPSAzODk7CiAgICB0LkogPSA1MDA7CiAgICB0LksgPSA2Njc7CiAgICB0LkwgPSA2MTE7CiAgICB0Lk0gPSA4ODk7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3MjI7CiAgICB0LlAgPSA2MTE7CiAgICB0LlEgPSA3MjI7CiAgICB0LlIgPSA2Njc7CiAgICB0LlMgPSA1NTY7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2Njc7CiAgICB0LlcgPSA4ODk7CiAgICB0LlggPSA2Njc7CiAgICB0LlkgPSA2MTE7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA1NzA7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnF1b3RlbGVmdCA9IDMzMzsKICAgIHQuYSA9IDUwMDsKICAgIHQuYiA9IDUwMDsKICAgIHQuYyA9IDQ0NDsKICAgIHQuZCA9IDUwMDsKICAgIHQuZSA9IDQ0NDsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDUwMDsKICAgIHQuaCA9IDU1NjsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDUwMDsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDc3ODsKICAgIHQubiA9IDU1NjsKICAgIHQubyA9IDUwMDsKICAgIHQucCA9IDUwMDsKICAgIHQucSA9IDUwMDsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDM4OTsKICAgIHQudCA9IDI3ODsKICAgIHQudSA9IDU1NjsKICAgIHQudiA9IDQ0NDsKICAgIHQudyA9IDY2NzsKICAgIHQueCA9IDUwMDsKICAgIHQueSA9IDQ0NDsKICAgIHQueiA9IDM4OTsKICAgIHQuYnJhY2VsZWZ0ID0gMzQ4OwogICAgdC5iYXIgPSAyMjA7CiAgICB0LmJyYWNlcmlnaHQgPSAzNDg7CiAgICB0LmFzY2lpdGlsZGUgPSA1NzA7CiAgICB0LmV4Y2xhbWRvd24gPSAzODk7CiAgICB0LmNlbnQgPSA1MDA7CiAgICB0LnN0ZXJsaW5nID0gNTAwOwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTAwOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LnNlY3Rpb24gPSA1MDA7CiAgICB0LmN1cnJlbmN5ID0gNTAwOwogICAgdC5xdW90ZXNpbmdsZSA9IDI3ODsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTAwOwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1NTY7CiAgICB0LmZsID0gNTU2OwogICAgdC5lbmRhc2ggPSA1MDA7CiAgICB0LmRhZ2dlciA9IDUwMDsKICAgIHQuZGFnZ2VyZGJsID0gNTAwOwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI1MDsKICAgIHQucGFyYWdyYXBoID0gNTAwOwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibGJhc2UgPSA1MDA7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTAwOwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNTAwOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gOTQ0OwogICAgdC5vcmRmZW1pbmluZSA9IDI2NjsKICAgIHQuTHNsYXNoID0gNjExOwogICAgdC5Pc2xhc2ggPSA3MjI7CiAgICB0Lk9FID0gOTQ0OwogICAgdC5vcmRtYXNjdWxpbmUgPSAzMDA7CiAgICB0LmFlID0gNzIyOwogICAgdC5kb3RsZXNzaSA9IDI3ODsKICAgIHQubHNsYXNoID0gMjc4OwogICAgdC5vc2xhc2ggPSA1MDA7CiAgICB0Lm9lID0gNzIyOwogICAgdC5nZXJtYW5kYmxzID0gNTAwOwogICAgdC5JZGllcmVzaXMgPSAzODk7CiAgICB0LmVhY3V0ZSA9IDQ0NDsKICAgIHQuYWJyZXZlID0gNTAwOwogICAgdC51aHVuZ2FydW1sYXV0ID0gNTU2OwogICAgdC5lY2Fyb24gPSA0NDQ7CiAgICB0LllkaWVyZXNpcyA9IDYxMTsKICAgIHQuZGl2aWRlID0gNTcwOwogICAgdC5ZYWN1dGUgPSA2MTE7CiAgICB0LkFjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hYWN1dGUgPSA1MDA7CiAgICB0LlVjaXJjdW1mbGV4ID0gNzIyOwogICAgdC55YWN1dGUgPSA0NDQ7CiAgICB0LnNjb21tYWFjY2VudCA9IDM4OTsKICAgIHQuZWNpcmN1bWZsZXggPSA0NDQ7CiAgICB0LlVyaW5nID0gNzIyOwogICAgdC5VZGllcmVzaXMgPSA3MjI7CiAgICB0LmFvZ29uZWsgPSA1MDA7CiAgICB0LlVhY3V0ZSA9IDcyMjsKICAgIHQudW9nb25layA9IDU1NjsKICAgIHQuRWRpZXJlc2lzID0gNjY3OwogICAgdC5EY3JvYXQgPSA3MjI7CiAgICB0LmNvbW1hYWNjZW50ID0gMjUwOwogICAgdC5jb3B5cmlnaHQgPSA3NDc7CiAgICB0LkVtYWNyb24gPSA2Njc7CiAgICB0LmNjYXJvbiA9IDQ0NDsKICAgIHQuYXJpbmcgPSA1MDA7CiAgICB0Lk5jb21tYWFjY2VudCA9IDcyMjsKICAgIHQubGFjdXRlID0gMjc4OwogICAgdC5hZ3JhdmUgPSA1MDA7CiAgICB0LlRjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQ2FjdXRlID0gNjY3OwogICAgdC5hdGlsZGUgPSA1MDA7CiAgICB0LkVkb3RhY2NlbnQgPSA2Njc7CiAgICB0LnNjYXJvbiA9IDM4OTsKICAgIHQuc2NlZGlsbGEgPSAzODk7CiAgICB0LmlhY3V0ZSA9IDI3ODsKICAgIHQubG96ZW5nZSA9IDQ5NDsKICAgIHQuUmNhcm9uID0gNjY3OwogICAgdC5HY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LnVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5hY2lyY3VtZmxleCA9IDUwMDsKICAgIHQuQW1hY3JvbiA9IDY2NzsKICAgIHQucmNhcm9uID0gMzg5OwogICAgdC5jY2VkaWxsYSA9IDQ0NDsKICAgIHQuWmRvdGFjY2VudCA9IDYxMTsKICAgIHQuVGhvcm4gPSA2MTE7CiAgICB0Lk9tYWNyb24gPSA3MjI7CiAgICB0LlJhY3V0ZSA9IDY2NzsKICAgIHQuU2FjdXRlID0gNTU2OwogICAgdC5kY2Fyb24gPSA2MDg7CiAgICB0LlVtYWNyb24gPSA3MjI7CiAgICB0LnVyaW5nID0gNTU2OwogICAgdC50aHJlZXN1cGVyaW9yID0gMzAwOwogICAgdC5PZ3JhdmUgPSA3MjI7CiAgICB0LkFncmF2ZSA9IDY2NzsKICAgIHQuQWJyZXZlID0gNjY3OwogICAgdC5tdWx0aXBseSA9IDU3MDsKICAgIHQudWFjdXRlID0gNTU2OwogICAgdC5UY2Fyb24gPSA2MTE7CiAgICB0LnBhcnRpYWxkaWZmID0gNDk0OwogICAgdC55ZGllcmVzaXMgPSA0NDQ7CiAgICB0Lk5hY3V0ZSA9IDcyMjsKICAgIHQuaWNpcmN1bWZsZXggPSAyNzg7CiAgICB0LkVjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hZGllcmVzaXMgPSA1MDA7CiAgICB0LmVkaWVyZXNpcyA9IDQ0NDsKICAgIHQuY2FjdXRlID0gNDQ0OwogICAgdC5uYWN1dGUgPSA1NTY7CiAgICB0LnVtYWNyb24gPSA1NTY7CiAgICB0Lk5jYXJvbiA9IDcyMjsKICAgIHQuSWFjdXRlID0gMzg5OwogICAgdC5wbHVzbWludXMgPSA1NzA7CiAgICB0LmJyb2tlbmJhciA9IDIyMDsKICAgIHQucmVnaXN0ZXJlZCA9IDc0NzsKICAgIHQuR2JyZXZlID0gNzIyOwogICAgdC5JZG90YWNjZW50ID0gMzg5OwogICAgdC5zdW1tYXRpb24gPSA2MDA7CiAgICB0LkVncmF2ZSA9IDY2NzsKICAgIHQucmFjdXRlID0gMzg5OwogICAgdC5vbWFjcm9uID0gNTAwOwogICAgdC5aYWN1dGUgPSA2MTE7CiAgICB0LlpjYXJvbiA9IDYxMTsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5FdGggPSA3MjI7CiAgICB0LkNjZWRpbGxhID0gNjY3OwogICAgdC5sY29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LnRjYXJvbiA9IDM2NjsKICAgIHQuZW9nb25layA9IDQ0NDsKICAgIHQuVW9nb25layA9IDcyMjsKICAgIHQuQWFjdXRlID0gNjY3OwogICAgdC5BZGllcmVzaXMgPSA2Njc7CiAgICB0LmVncmF2ZSA9IDQ0NDsKICAgIHQuemFjdXRlID0gMzg5OwogICAgdC5pb2dvbmVrID0gMjc4OwogICAgdC5PYWN1dGUgPSA3MjI7CiAgICB0Lm9hY3V0ZSA9IDUwMDsKICAgIHQuYW1hY3JvbiA9IDUwMDsKICAgIHQuc2FjdXRlID0gMzg5OwogICAgdC5pZGllcmVzaXMgPSAyNzg7CiAgICB0Lk9jaXJjdW1mbGV4ID0gNzIyOwogICAgdC5VZ3JhdmUgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC50aG9ybiA9IDUwMDsKICAgIHQudHdvc3VwZXJpb3IgPSAzMDA7CiAgICB0Lk9kaWVyZXNpcyA9IDcyMjsKICAgIHQubXUgPSA1NzY7CiAgICB0LmlncmF2ZSA9IDI3ODsKICAgIHQub2h1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuRW9nb25layA9IDY2NzsKICAgIHQuZGNyb2F0ID0gNTAwOwogICAgdC50aHJlZXF1YXJ0ZXJzID0gNzUwOwogICAgdC5TY2VkaWxsYSA9IDU1NjsKICAgIHQubGNhcm9uID0gMzgyOwogICAgdC5LY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LkxhY3V0ZSA9IDYxMTsKICAgIHQudHJhZGVtYXJrID0gMTAwMDsKICAgIHQuZWRvdGFjY2VudCA9IDQ0NDsKICAgIHQuSWdyYXZlID0gMzg5OwogICAgdC5JbWFjcm9uID0gMzg5OwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA3NTA7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1MDA7CiAgICB0Lm50aWxkZSA9IDU1NjsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjY3OwogICAgdC5lbWFjcm9uID0gNDQ0OwogICAgdC5nYnJldmUgPSA1MDA7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA3NTA7CiAgICB0LlNjYXJvbiA9IDU1NjsKICAgIHQuU2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDUwMDsKICAgIHQuQ2Nhcm9uID0gNjY3OwogICAgdC51Z3JhdmUgPSA1NTY7CiAgICB0LnJhZGljYWwgPSA1NDk7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzg5OwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDUwMDsKICAgIHQuUmNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkF0aWxkZSA9IDY2NzsKICAgIHQuQW9nb25layA9IDY2NzsKICAgIHQuQXJpbmcgPSA2Njc7CiAgICB0Lk90aWxkZSA9IDcyMjsKICAgIHQuemRvdGFjY2VudCA9IDM4OTsKICAgIHQuRWNhcm9uID0gNjY3OwogICAgdC5Jb2dvbmVrID0gMzg5OwogICAgdC5rY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm1pbnVzID0gNjA2OwogICAgdC5JY2lyY3VtZmxleCA9IDM4OTsKICAgIHQubmNhcm9uID0gNTU2OwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA2MDY7CiAgICB0Lm9kaWVyZXNpcyA9IDUwMDsKICAgIHQudWRpZXJlc2lzID0gNTU2OwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5ldGggPSA1MDA7CiAgICB0LnpjYXJvbiA9IDM4OTsKICAgIHQubmNvbW1hYWNjZW50ID0gNTU2OwogICAgdC5vbmVzdXBlcmlvciA9IDMwMDsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDUwMDsKICB9KTsKICB0WyJUaW1lcy1JdGFsaWMiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDQyMDsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZG9sbGFyID0gNTAwOwogICAgdC5wZXJjZW50ID0gODMzOwogICAgdC5hbXBlcnNhbmQgPSA3Nzg7CiAgICB0LnF1b3RlcmlnaHQgPSAzMzM7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSA1MDA7CiAgICB0LnBsdXMgPSA2NzU7CiAgICB0LmNvbW1hID0gMjUwOwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI1MDsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1MDA7CiAgICB0Lm9uZSA9IDUwMDsKICAgIHQudHdvID0gNTAwOwogICAgdC50aHJlZSA9IDUwMDsKICAgIHQuZm91ciA9IDUwMDsKICAgIHQuZml2ZSA9IDUwMDsKICAgIHQuc2l4ID0gNTAwOwogICAgdC5zZXZlbiA9IDUwMDsKICAgIHQuZWlnaHQgPSA1MDA7CiAgICB0Lm5pbmUgPSA1MDA7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA2NzU7CiAgICB0LmVxdWFsID0gNjc1OwogICAgdC5ncmVhdGVyID0gNjc1OwogICAgdC5xdWVzdGlvbiA9IDUwMDsKICAgIHQuYXQgPSA5MjA7CiAgICB0LkEgPSA2MTE7CiAgICB0LkIgPSA2MTE7CiAgICB0LkMgPSA2Njc7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2MTE7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3MjI7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAzMzM7CiAgICB0LkogPSA0NDQ7CiAgICB0LksgPSA2Njc7CiAgICB0LkwgPSA1NTY7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA2Njc7CiAgICB0Lk8gPSA3MjI7CiAgICB0LlAgPSA2MTE7CiAgICB0LlEgPSA3MjI7CiAgICB0LlIgPSA2MTE7CiAgICB0LlMgPSA1MDA7CiAgICB0LlQgPSA1NTY7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2MTE7CiAgICB0LlcgPSA4MzM7CiAgICB0LlggPSA2MTE7CiAgICB0LlkgPSA1NTY7CiAgICB0LlogPSA1NTY7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzg5OwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDM4OTsKICAgIHQuYXNjaWljaXJjdW0gPSA0MjI7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnF1b3RlbGVmdCA9IDMzMzsKICAgIHQuYSA9IDUwMDsKICAgIHQuYiA9IDUwMDsKICAgIHQuYyA9IDQ0NDsKICAgIHQuZCA9IDUwMDsKICAgIHQuZSA9IDQ0NDsKICAgIHQuZiA9IDI3ODsKICAgIHQuZyA9IDUwMDsKICAgIHQuaCA9IDUwMDsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDQ0NDsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDcyMjsKICAgIHQubiA9IDUwMDsKICAgIHQubyA9IDUwMDsKICAgIHQucCA9IDUwMDsKICAgIHQucSA9IDUwMDsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDM4OTsKICAgIHQudCA9IDI3ODsKICAgIHQudSA9IDUwMDsKICAgIHQudiA9IDQ0NDsKICAgIHQudyA9IDY2NzsKICAgIHQueCA9IDQ0NDsKICAgIHQueSA9IDQ0NDsKICAgIHQueiA9IDM4OTsKICAgIHQuYnJhY2VsZWZ0ID0gNDAwOwogICAgdC5iYXIgPSAyNzU7CiAgICB0LmJyYWNlcmlnaHQgPSA0MDA7CiAgICB0LmFzY2lpdGlsZGUgPSA1NDE7CiAgICB0LmV4Y2xhbWRvd24gPSAzODk7CiAgICB0LmNlbnQgPSA1MDA7CiAgICB0LnN0ZXJsaW5nID0gNTAwOwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTAwOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LnNlY3Rpb24gPSA1MDA7CiAgICB0LmN1cnJlbmN5ID0gNTAwOwogICAgdC5xdW90ZXNpbmdsZSA9IDIxNDsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTU2OwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTAwOwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1MDA7CiAgICB0LmZsID0gNTAwOwogICAgdC5lbmRhc2ggPSA1MDA7CiAgICB0LmRhZ2dlciA9IDUwMDsKICAgIHQuZGFnZ2VyZGJsID0gNTAwOwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI1MDsKICAgIHQucGFyYWdyYXBoID0gNTIzOwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibGJhc2UgPSA1NTY7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1NTY7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTAwOwogICAgdC5lbGxpcHNpcyA9IDg4OTsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA1MDA7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gODg5OwogICAgdC5BRSA9IDg4OTsKICAgIHQub3JkZmVtaW5pbmUgPSAyNzY7CiAgICB0LkxzbGFzaCA9IDU1NjsKICAgIHQuT3NsYXNoID0gNzIyOwogICAgdC5PRSA9IDk0NDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzEwOwogICAgdC5hZSA9IDY2NzsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDY2NzsKICAgIHQuZ2VybWFuZGJscyA9IDUwMDsKICAgIHQuSWRpZXJlc2lzID0gMzMzOwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDUwMDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA1NTY7CiAgICB0LmRpdmlkZSA9IDY3NTsKICAgIHQuWWFjdXRlID0gNTU2OwogICAgdC5BY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWFjdXRlID0gNTAwOwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNDQ0OwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTAwOwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1MDA7CiAgICB0LkVkaWVyZXNpcyA9IDYxMTsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzYwOwogICAgdC5FbWFjcm9uID0gNjExOwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNTAwOwogICAgdC5OY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNTAwOwogICAgdC5UY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LkNhY3V0ZSA9IDY2NzsKICAgIHQuYXRpbGRlID0gNTAwOwogICAgdC5FZG90YWNjZW50ID0gNjExOwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDYxMTsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC51Y2lyY3VtZmxleCA9IDUwMDsKICAgIHQuYWNpcmN1bWZsZXggPSA1MDA7CiAgICB0LkFtYWNyb24gPSA2MTE7CiAgICB0LnJjYXJvbiA9IDM4OTsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA1NTY7CiAgICB0LlRob3JuID0gNjExOwogICAgdC5PbWFjcm9uID0gNzIyOwogICAgdC5SYWN1dGUgPSA2MTE7CiAgICB0LlNhY3V0ZSA9IDUwMDsKICAgIHQuZGNhcm9uID0gNTQ0OwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDUwMDsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzIyOwogICAgdC5BZ3JhdmUgPSA2MTE7CiAgICB0LkFicmV2ZSA9IDYxMTsKICAgIHQubXVsdGlwbHkgPSA2NzU7CiAgICB0LnVhY3V0ZSA9IDUwMDsKICAgIHQuVGNhcm9uID0gNTU2OwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNDQ0OwogICAgdC5OYWN1dGUgPSA2Njc7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWRpZXJlc2lzID0gNTAwOwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTAwOwogICAgdC51bWFjcm9uID0gNTAwOwogICAgdC5OY2Fyb24gPSA2Njc7CiAgICB0LklhY3V0ZSA9IDMzMzsKICAgIHQucGx1c21pbnVzID0gNjc1OwogICAgdC5icm9rZW5iYXIgPSAyNzU7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NjA7CiAgICB0LkdicmV2ZSA9IDcyMjsKICAgIHQuSWRvdGFjY2VudCA9IDMzMzsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2MTE7CiAgICB0LnJhY3V0ZSA9IDM4OTsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNTU2OwogICAgdC5aY2Fyb24gPSA1NTY7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDY2NzsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzMDA7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDYxMTsKICAgIHQuQWRpZXJlc2lzID0gNjExOwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDM4OTsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzIyOwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA1MDA7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1MDA7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3MjI7CiAgICB0Lm11ID0gNTAwOwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2MTE7CiAgICB0LmRjcm9hdCA9IDUwMDsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1MDA7CiAgICB0LmxjYXJvbiA9IDMwMDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MYWN1dGUgPSA1NTY7CiAgICB0LnRyYWRlbWFyayA9IDk4MDsKICAgIHQuZWRvdGFjY2VudCA9IDQ0NDsKICAgIHQuSWdyYXZlID0gMzMzOwogICAgdC5JbWFjcm9uID0gMzMzOwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA3NTA7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1MDA7CiAgICB0Lm50aWxkZSA9IDUwMDsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjExOwogICAgdC5lbWFjcm9uID0gNDQ0OwogICAgdC5nYnJldmUgPSA1MDA7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA3NTA7CiAgICB0LlNjYXJvbiA9IDUwMDsKICAgIHQuU2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDUwMDsKICAgIHQuQ2Nhcm9uID0gNjY3OwogICAgdC51Z3JhdmUgPSA1MDA7CiAgICB0LnJhZGljYWwgPSA0NTM7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzg5OwogICAgdC5OdGlsZGUgPSA2Njc7CiAgICB0Lm90aWxkZSA9IDUwMDsKICAgIHQuUmNvbW1hYWNjZW50ID0gNjExOwogICAgdC5MY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LkF0aWxkZSA9IDYxMTsKICAgIHQuQW9nb25layA9IDYxMTsKICAgIHQuQXJpbmcgPSA2MTE7CiAgICB0Lk90aWxkZSA9IDcyMjsKICAgIHQuemRvdGFjY2VudCA9IDM4OTsKICAgIHQuRWNhcm9uID0gNjExOwogICAgdC5Jb2dvbmVrID0gMzMzOwogICAgdC5rY29tbWFhY2NlbnQgPSA0NDQ7CiAgICB0Lm1pbnVzID0gNjc1OwogICAgdC5JY2lyY3VtZmxleCA9IDMzMzsKICAgIHQubmNhcm9uID0gNTAwOwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA2NzU7CiAgICB0Lm9kaWVyZXNpcyA9IDUwMDsKICAgIHQudWRpZXJlc2lzID0gNTAwOwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5ldGggPSA1MDA7CiAgICB0LnpjYXJvbiA9IDM4OTsKICAgIHQubmNvbW1hYWNjZW50ID0gNTAwOwogICAgdC5vbmVzdXBlcmlvciA9IDMwMDsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDUwMDsKICB9KTsKICB0LlphcGZEaW5nYmF0cyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI3ODsKICAgIHQuYTEgPSA5NzQ7CiAgICB0LmEyID0gOTYxOwogICAgdC5hMjAyID0gOTc0OwogICAgdC5hMyA9IDk4MDsKICAgIHQuYTQgPSA3MTk7CiAgICB0LmE1ID0gNzg5OwogICAgdC5hMTE5ID0gNzkwOwogICAgdC5hMTE4ID0gNzkxOwogICAgdC5hMTE3ID0gNjkwOwogICAgdC5hMTEgPSA5NjA7CiAgICB0LmExMiA9IDkzOTsKICAgIHQuYTEzID0gNTQ5OwogICAgdC5hMTQgPSA4NTU7CiAgICB0LmExNSA9IDkxMTsKICAgIHQuYTE2ID0gOTMzOwogICAgdC5hMTA1ID0gOTExOwogICAgdC5hMTcgPSA5NDU7CiAgICB0LmExOCA9IDk3NDsKICAgIHQuYTE5ID0gNzU1OwogICAgdC5hMjAgPSA4NDY7CiAgICB0LmEyMSA9IDc2MjsKICAgIHQuYTIyID0gNzYxOwogICAgdC5hMjMgPSA1NzE7CiAgICB0LmEyNCA9IDY3NzsKICAgIHQuYTI1ID0gNzYzOwogICAgdC5hMjYgPSA3NjA7CiAgICB0LmEyNyA9IDc1OTsKICAgIHQuYTI4ID0gNzU0OwogICAgdC5hNiA9IDQ5NDsKICAgIHQuYTcgPSA1NTI7CiAgICB0LmE4ID0gNTM3OwogICAgdC5hOSA9IDU3NzsKICAgIHQuYTEwID0gNjkyOwogICAgdC5hMjkgPSA3ODY7CiAgICB0LmEzMCA9IDc4ODsKICAgIHQuYTMxID0gNzg4OwogICAgdC5hMzIgPSA3OTA7CiAgICB0LmEzMyA9IDc5MzsKICAgIHQuYTM0ID0gNzk0OwogICAgdC5hMzUgPSA4MTY7CiAgICB0LmEzNiA9IDgyMzsKICAgIHQuYTM3ID0gNzg5OwogICAgdC5hMzggPSA4NDE7CiAgICB0LmEzOSA9IDgyMzsKICAgIHQuYTQwID0gODMzOwogICAgdC5hNDEgPSA4MTY7CiAgICB0LmE0MiA9IDgzMTsKICAgIHQuYTQzID0gOTIzOwogICAgdC5hNDQgPSA3NDQ7CiAgICB0LmE0NSA9IDcyMzsKICAgIHQuYTQ2ID0gNzQ5OwogICAgdC5hNDcgPSA3OTA7CiAgICB0LmE0OCA9IDc5MjsKICAgIHQuYTQ5ID0gNjk1OwogICAgdC5hNTAgPSA3NzY7CiAgICB0LmE1MSA9IDc2ODsKICAgIHQuYTUyID0gNzkyOwogICAgdC5hNTMgPSA3NTk7CiAgICB0LmE1NCA9IDcwNzsKICAgIHQuYTU1ID0gNzA4OwogICAgdC5hNTYgPSA2ODI7CiAgICB0LmE1NyA9IDcwMTsKICAgIHQuYTU4ID0gODI2OwogICAgdC5hNTkgPSA4MTU7CiAgICB0LmE2MCA9IDc4OTsKICAgIHQuYTYxID0gNzg5OwogICAgdC5hNjIgPSA3MDc7CiAgICB0LmE2MyA9IDY4NzsKICAgIHQuYTY0ID0gNjk2OwogICAgdC5hNjUgPSA2ODk7CiAgICB0LmE2NiA9IDc4NjsKICAgIHQuYTY3ID0gNzg3OwogICAgdC5hNjggPSA3MTM7CiAgICB0LmE2OSA9IDc5MTsKICAgIHQuYTcwID0gNzg1OwogICAgdC5hNzEgPSA3OTE7CiAgICB0LmE3MiA9IDg3MzsKICAgIHQuYTczID0gNzYxOwogICAgdC5hNzQgPSA3NjI7CiAgICB0LmEyMDMgPSA3NjI7CiAgICB0LmE3NSA9IDc1OTsKICAgIHQuYTIwNCA9IDc1OTsKICAgIHQuYTc2ID0gODkyOwogICAgdC5hNzcgPSA4OTI7CiAgICB0LmE3OCA9IDc4ODsKICAgIHQuYTc5ID0gNzg0OwogICAgdC5hODEgPSA0Mzg7CiAgICB0LmE4MiA9IDEzODsKICAgIHQuYTgzID0gMjc3OwogICAgdC5hODQgPSA0MTU7CiAgICB0LmE5NyA9IDM5MjsKICAgIHQuYTk4ID0gMzkyOwogICAgdC5hOTkgPSA2Njg7CiAgICB0LmExMDAgPSA2Njg7CiAgICB0LmE4OSA9IDM5MDsKICAgIHQuYTkwID0gMzkwOwogICAgdC5hOTMgPSAzMTc7CiAgICB0LmE5NCA9IDMxNzsKICAgIHQuYTkxID0gMjc2OwogICAgdC5hOTIgPSAyNzY7CiAgICB0LmEyMDUgPSA1MDk7CiAgICB0LmE4NSA9IDUwOTsKICAgIHQuYTIwNiA9IDQxMDsKICAgIHQuYTg2ID0gNDEwOwogICAgdC5hODcgPSAyMzQ7CiAgICB0LmE4OCA9IDIzNDsKICAgIHQuYTk1ID0gMzM0OwogICAgdC5hOTYgPSAzMzQ7CiAgICB0LmExMDEgPSA3MzI7CiAgICB0LmExMDIgPSA1NDQ7CiAgICB0LmExMDMgPSA1NDQ7CiAgICB0LmExMDQgPSA5MTA7CiAgICB0LmExMDYgPSA2Njc7CiAgICB0LmExMDcgPSA3NjA7CiAgICB0LmExMDggPSA3NjA7CiAgICB0LmExMTIgPSA3NzY7CiAgICB0LmExMTEgPSA1OTU7CiAgICB0LmExMTAgPSA2OTQ7CiAgICB0LmExMDkgPSA2MjY7CiAgICB0LmExMjAgPSA3ODg7CiAgICB0LmExMjEgPSA3ODg7CiAgICB0LmExMjIgPSA3ODg7CiAgICB0LmExMjMgPSA3ODg7CiAgICB0LmExMjQgPSA3ODg7CiAgICB0LmExMjUgPSA3ODg7CiAgICB0LmExMjYgPSA3ODg7CiAgICB0LmExMjcgPSA3ODg7CiAgICB0LmExMjggPSA3ODg7CiAgICB0LmExMjkgPSA3ODg7CiAgICB0LmExMzAgPSA3ODg7CiAgICB0LmExMzEgPSA3ODg7CiAgICB0LmExMzIgPSA3ODg7CiAgICB0LmExMzMgPSA3ODg7CiAgICB0LmExMzQgPSA3ODg7CiAgICB0LmExMzUgPSA3ODg7CiAgICB0LmExMzYgPSA3ODg7CiAgICB0LmExMzcgPSA3ODg7CiAgICB0LmExMzggPSA3ODg7CiAgICB0LmExMzkgPSA3ODg7CiAgICB0LmExNDAgPSA3ODg7CiAgICB0LmExNDEgPSA3ODg7CiAgICB0LmExNDIgPSA3ODg7CiAgICB0LmExNDMgPSA3ODg7CiAgICB0LmExNDQgPSA3ODg7CiAgICB0LmExNDUgPSA3ODg7CiAgICB0LmExNDYgPSA3ODg7CiAgICB0LmExNDcgPSA3ODg7CiAgICB0LmExNDggPSA3ODg7CiAgICB0LmExNDkgPSA3ODg7CiAgICB0LmExNTAgPSA3ODg7CiAgICB0LmExNTEgPSA3ODg7CiAgICB0LmExNTIgPSA3ODg7CiAgICB0LmExNTMgPSA3ODg7CiAgICB0LmExNTQgPSA3ODg7CiAgICB0LmExNTUgPSA3ODg7CiAgICB0LmExNTYgPSA3ODg7CiAgICB0LmExNTcgPSA3ODg7CiAgICB0LmExNTggPSA3ODg7CiAgICB0LmExNTkgPSA3ODg7CiAgICB0LmExNjAgPSA4OTQ7CiAgICB0LmExNjEgPSA4Mzg7CiAgICB0LmExNjMgPSAxMDE2OwogICAgdC5hMTY0ID0gNDU4OwogICAgdC5hMTk2ID0gNzQ4OwogICAgdC5hMTY1ID0gOTI0OwogICAgdC5hMTkyID0gNzQ4OwogICAgdC5hMTY2ID0gOTE4OwogICAgdC5hMTY3ID0gOTI3OwogICAgdC5hMTY4ID0gOTI4OwogICAgdC5hMTY5ID0gOTI4OwogICAgdC5hMTcwID0gODM0OwogICAgdC5hMTcxID0gODczOwogICAgdC5hMTcyID0gODI4OwogICAgdC5hMTczID0gOTI0OwogICAgdC5hMTYyID0gOTI0OwogICAgdC5hMTc0ID0gOTE3OwogICAgdC5hMTc1ID0gOTMwOwogICAgdC5hMTc2ID0gOTMxOwogICAgdC5hMTc3ID0gNDYzOwogICAgdC5hMTc4ID0gODgzOwogICAgdC5hMTc5ID0gODM2OwogICAgdC5hMTkzID0gODM2OwogICAgdC5hMTgwID0gODY3OwogICAgdC5hMTk5ID0gODY3OwogICAgdC5hMTgxID0gNjk2OwogICAgdC5hMjAwID0gNjk2OwogICAgdC5hMTgyID0gODc0OwogICAgdC5hMjAxID0gODc0OwogICAgdC5hMTgzID0gNzYwOwogICAgdC5hMTg0ID0gOTQ2OwogICAgdC5hMTk3ID0gNzcxOwogICAgdC5hMTg1ID0gODY1OwogICAgdC5hMTk0ID0gNzcxOwogICAgdC5hMTk4ID0gODg4OwogICAgdC5hMTg2ID0gOTY3OwogICAgdC5hMTk1ID0gODg4OwogICAgdC5hMTg3ID0gODMxOwogICAgdC5hMTg4ID0gODczOwogICAgdC5hMTg5ID0gOTI3OwogICAgdC5hMTkwID0gOTcwOwogICAgdC5hMTkxID0gOTE4OwogIH0pOwp9KTsKY29uc3QgZ2V0Rm9udEJhc2ljTWV0cmljcyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuQ291cmllciA9IHsKICAgIGFzY2VudDogNjI5LAogICAgZGVzY2VudDogLTE1NywKICAgIGNhcEhlaWdodDogNTYyLAogICAgeEhlaWdodDogLTQyNgogIH07CiAgdFsiQ291cmllci1Cb2xkIl0gPSB7CiAgICBhc2NlbnQ6IDYyOSwKICAgIGRlc2NlbnQ6IC0xNTcsCiAgICBjYXBIZWlnaHQ6IDU2MiwKICAgIHhIZWlnaHQ6IDQzOQogIH07CiAgdFsiQ291cmllci1PYmxpcXVlIl0gPSB7CiAgICBhc2NlbnQ6IDYyOSwKICAgIGRlc2NlbnQ6IC0xNTcsCiAgICBjYXBIZWlnaHQ6IDU2MiwKICAgIHhIZWlnaHQ6IDQyNgogIH07CiAgdFsiQ291cmllci1Cb2xkT2JsaXF1ZSJdID0gewogICAgYXNjZW50OiA2MjksCiAgICBkZXNjZW50OiAtMTU3LAogICAgY2FwSGVpZ2h0OiA1NjIsCiAgICB4SGVpZ2h0OiA0MjYKICB9OwogIHQuSGVsdmV0aWNhID0gewogICAgYXNjZW50OiA3MTgsCiAgICBkZXNjZW50OiAtMjA3LAogICAgY2FwSGVpZ2h0OiA3MTgsCiAgICB4SGVpZ2h0OiA1MjMKICB9OwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSB7CiAgICBhc2NlbnQ6IDcxOCwKICAgIGRlc2NlbnQ6IC0yMDcsCiAgICBjYXBIZWlnaHQ6IDcxOCwKICAgIHhIZWlnaHQ6IDUzMgogIH07CiAgdFsiSGVsdmV0aWNhLU9ibGlxdWUiXSA9IHsKICAgIGFzY2VudDogNzE4LAogICAgZGVzY2VudDogLTIwNywKICAgIGNhcEhlaWdodDogNzE4LAogICAgeEhlaWdodDogNTIzCiAgfTsKICB0WyJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiXSA9IHsKICAgIGFzY2VudDogNzE4LAogICAgZGVzY2VudDogLTIwNywKICAgIGNhcEhlaWdodDogNzE4LAogICAgeEhlaWdodDogNTMyCiAgfTsKICB0WyJUaW1lcy1Sb21hbiJdID0gewogICAgYXNjZW50OiA2ODMsCiAgICBkZXNjZW50OiAtMjE3LAogICAgY2FwSGVpZ2h0OiA2NjIsCiAgICB4SGVpZ2h0OiA0NTAKICB9OwogIHRbIlRpbWVzLUJvbGQiXSA9IHsKICAgIGFzY2VudDogNjgzLAogICAgZGVzY2VudDogLTIxNywKICAgIGNhcEhlaWdodDogNjc2LAogICAgeEhlaWdodDogNDYxCiAgfTsKICB0WyJUaW1lcy1JdGFsaWMiXSA9IHsKICAgIGFzY2VudDogNjgzLAogICAgZGVzY2VudDogLTIxNywKICAgIGNhcEhlaWdodDogNjUzLAogICAgeEhlaWdodDogNDQxCiAgfTsKICB0WyJUaW1lcy1Cb2xkSXRhbGljIl0gPSB7CiAgICBhc2NlbnQ6IDY4MywKICAgIGRlc2NlbnQ6IC0yMTcsCiAgICBjYXBIZWlnaHQ6IDY2OSwKICAgIHhIZWlnaHQ6IDQ2MgogIH07CiAgdC5TeW1ib2wgPSB7CiAgICBhc2NlbnQ6IE1hdGguTmFOLAogICAgZGVzY2VudDogTWF0aC5OYU4sCiAgICBjYXBIZWlnaHQ6IE1hdGguTmFOLAogICAgeEhlaWdodDogTWF0aC5OYU4KICB9OwogIHQuWmFwZkRpbmdiYXRzID0gewogICAgYXNjZW50OiBNYXRoLk5hTiwKICAgIGRlc2NlbnQ6IE1hdGguTmFOLAogICAgY2FwSGVpZ2h0OiBNYXRoLk5hTiwKICAgIHhIZWlnaHQ6IE1hdGguTmFOCiAgfTsKfSk7Cgo7Ly8gLi9zcmMvY29yZS9nbHlmLmpzCmNvbnN0IE9OX0NVUlZFX1BPSU5UID0gMSA8PCAwOwpjb25zdCBYX1NIT1JUX1ZFQ1RPUiA9IDEgPDwgMTsKY29uc3QgWV9TSE9SVF9WRUNUT1IgPSAxIDw8IDI7CmNvbnN0IFJFUEVBVF9GTEFHID0gMSA8PCAzOwpjb25zdCBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IgPSAxIDw8IDQ7CmNvbnN0IFlfSVNfU0FNRV9PUl9QT1NJVElWRV9ZX1NIT1JUX1ZFQ1RPUiA9IDEgPDwgNTsKY29uc3QgT1ZFUkxBUF9TSU1QTEUgPSAxIDw8IDY7CmNvbnN0IEFSR18xX0FORF8yX0FSRV9XT1JEUyA9IDEgPDwgMDsKY29uc3QgQVJHU19BUkVfWFlfVkFMVUVTID0gMSA8PCAxOwpjb25zdCBXRV9IQVZFX0FfU0NBTEUgPSAxIDw8IDM7CmNvbnN0IE1PUkVfQ09NUE9ORU5UUyA9IDEgPDwgNTsKY29uc3QgV0VfSEFWRV9BTl9YX0FORF9ZX1NDQUxFID0gMSA8PCA2Owpjb25zdCBXRV9IQVZFX0FfVFdPX0JZX1RXTyA9IDEgPDwgNzsKY29uc3QgV0VfSEFWRV9JTlNUUlVDVElPTlMgPSAxIDw8IDg7CmNsYXNzIEdseWZUYWJsZSB7CiAgY29uc3RydWN0b3IoewogICAgZ2x5ZlRhYmxlLAogICAgaXNHbHlwaExvY2F0aW9uc0xvbmcsCiAgICBsb2NhVGFibGUsCiAgICBudW1HbHlwaHMKICB9KSB7CiAgICB0aGlzLmdseXBocyA9IFtdOwogICAgY29uc3QgbG9jYSA9IG5ldyBEYXRhVmlldyhsb2NhVGFibGUuYnVmZmVyLCBsb2NhVGFibGUuYnl0ZU9mZnNldCwgbG9jYVRhYmxlLmJ5dGVMZW5ndGgpOwogICAgY29uc3QgZ2x5ZiA9IG5ldyBEYXRhVmlldyhnbHlmVGFibGUuYnVmZmVyLCBnbHlmVGFibGUuYnl0ZU9mZnNldCwgZ2x5ZlRhYmxlLmJ5dGVMZW5ndGgpOwogICAgY29uc3Qgb2Zmc2V0U2l6ZSA9IGlzR2x5cGhMb2NhdGlvbnNMb25nID8gNCA6IDI7CiAgICBsZXQgcHJldiA9IGlzR2x5cGhMb2NhdGlvbnNMb25nID8gbG9jYS5nZXRVaW50MzIoMCkgOiAyICogbG9jYS5nZXRVaW50MTYoMCk7CiAgICBsZXQgcG9zID0gMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtR2x5cGhzOyBpKyspIHsKICAgICAgcG9zICs9IG9mZnNldFNpemU7CiAgICAgIGNvbnN0IG5leHQgPSBpc0dseXBoTG9jYXRpb25zTG9uZyA/IGxvY2EuZ2V0VWludDMyKHBvcykgOiAyICogbG9jYS5nZXRVaW50MTYocG9zKTsKICAgICAgaWYgKG5leHQgPT09IHByZXYpIHsKICAgICAgICB0aGlzLmdseXBocy5wdXNoKG5ldyBHbHlwaCh7fSkpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGdseXBoID0gR2x5cGgucGFyc2UocHJldiwgZ2x5Zik7CiAgICAgIHRoaXMuZ2x5cGhzLnB1c2goZ2x5cGgpOwogICAgICBwcmV2ID0gbmV4dDsKICAgIH0KICB9CiAgZ2V0U2l6ZSgpIHsKICAgIHJldHVybiBNYXRoLnN1bVByZWNpc2UodGhpcy5nbHlwaHMubWFwKGcgPT4gZy5nZXRTaXplKCkgKyAzICYgfjMpKTsKICB9CiAgd3JpdGUoKSB7CiAgICBjb25zdCB0b3RhbFNpemUgPSB0aGlzLmdldFNpemUoKTsKICAgIGNvbnN0IGdseWZUYWJsZSA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIodG90YWxTaXplKSk7CiAgICBjb25zdCBpc0xvY2F0aW9uTG9uZyA9IHRvdGFsU2l6ZSA+IDB4MWZmZmU7CiAgICBjb25zdCBvZmZzZXRTaXplID0gaXNMb2NhdGlvbkxvbmcgPyA0IDogMjsKICAgIGNvbnN0IGxvY2FUYWJsZSA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoKHRoaXMuZ2x5cGhzLmxlbmd0aCArIDEpICogb2Zmc2V0U2l6ZSkpOwogICAgaWYgKGlzTG9jYXRpb25Mb25nKSB7CiAgICAgIGxvY2FUYWJsZS5zZXRVaW50MzIoMCwgMCk7CiAgICB9IGVsc2UgewogICAgICBsb2NhVGFibGUuc2V0VWludDE2KDAsIDApOwogICAgfQogICAgbGV0IHBvcyA9IDA7CiAgICBsZXQgbG9jYUluZGV4ID0gMDsKICAgIGZvciAoY29uc3QgZ2x5cGggb2YgdGhpcy5nbHlwaHMpIHsKICAgICAgcG9zICs9IGdseXBoLndyaXRlKHBvcywgZ2x5ZlRhYmxlKTsKICAgICAgcG9zID0gcG9zICsgMyAmIH4zOwogICAgICBsb2NhSW5kZXggKz0gb2Zmc2V0U2l6ZTsKICAgICAgaWYgKGlzTG9jYXRpb25Mb25nKSB7CiAgICAgICAgbG9jYVRhYmxlLnNldFVpbnQzMihsb2NhSW5kZXgsIHBvcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9jYVRhYmxlLnNldFVpbnQxNihsb2NhSW5kZXgsIHBvcyA+PiAxKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgaXNMb2NhdGlvbkxvbmcsCiAgICAgIGxvY2E6IG5ldyBVaW50OEFycmF5KGxvY2FUYWJsZS5idWZmZXIpLAogICAgICBnbHlmOiBuZXcgVWludDhBcnJheShnbHlmVGFibGUuYnVmZmVyKQogICAgfTsKICB9CiAgc2NhbGUoZmFjdG9ycykgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5nbHlwaHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICB0aGlzLmdseXBoc1tpXS5zY2FsZShmYWN0b3JzW2ldKTsKICAgIH0KICB9Cn0KY2xhc3MgR2x5cGggewogIGNvbnN0cnVjdG9yKHsKICAgIGhlYWRlciA9IG51bGwsCiAgICBzaW1wbGUgPSBudWxsLAogICAgY29tcG9zaXRlcyA9IG51bGwKICB9KSB7CiAgICB0aGlzLmhlYWRlciA9IGhlYWRlcjsKICAgIHRoaXMuc2ltcGxlID0gc2ltcGxlOwogICAgdGhpcy5jb21wb3NpdGVzID0gY29tcG9zaXRlczsKICB9CiAgc3RhdGljIHBhcnNlKHBvcywgZ2x5ZikgewogICAgY29uc3QgW3JlYWQsIGhlYWRlcl0gPSBHbHlwaEhlYWRlci5wYXJzZShwb3MsIGdseWYpOwogICAgcG9zICs9IHJlYWQ7CiAgICBpZiAoaGVhZGVyLm51bWJlck9mQ29udG91cnMgPCAwKSB7CiAgICAgIGNvbnN0IGNvbXBvc2l0ZXMgPSBbXTsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBjb25zdCBbbiwgY29tcG9zaXRlXSA9IENvbXBvc2l0ZUdseXBoLnBhcnNlKHBvcywgZ2x5Zik7CiAgICAgICAgcG9zICs9IG47CiAgICAgICAgY29tcG9zaXRlcy5wdXNoKGNvbXBvc2l0ZSk7CiAgICAgICAgaWYgKCEoY29tcG9zaXRlLmZsYWdzICYgTU9SRV9DT01QT05FTlRTKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXcgR2x5cGgoewogICAgICAgIGhlYWRlciwKICAgICAgICBjb21wb3NpdGVzCiAgICAgIH0pOwogICAgfQogICAgY29uc3Qgc2ltcGxlID0gU2ltcGxlR2x5cGgucGFyc2UocG9zLCBnbHlmLCBoZWFkZXIubnVtYmVyT2ZDb250b3Vycyk7CiAgICByZXR1cm4gbmV3IEdseXBoKHsKICAgICAgaGVhZGVyLAogICAgICBzaW1wbGUKICAgIH0pOwogIH0KICBnZXRTaXplKCkgewogICAgaWYgKCF0aGlzLmhlYWRlcikgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGNvbnN0IHNpemUgPSB0aGlzLnNpbXBsZSA/IHRoaXMuc2ltcGxlLmdldFNpemUoKSA6IE1hdGguc3VtUHJlY2lzZSh0aGlzLmNvbXBvc2l0ZXMubWFwKGMgPT4gYy5nZXRTaXplKCkpKTsKICAgIHJldHVybiB0aGlzLmhlYWRlci5nZXRTaXplKCkgKyBzaXplOwogIH0KICB3cml0ZShwb3MsIGJ1ZikgewogICAgaWYgKCF0aGlzLmhlYWRlcikgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGNvbnN0IHNwb3MgPSBwb3M7CiAgICBwb3MgKz0gdGhpcy5oZWFkZXIud3JpdGUocG9zLCBidWYpOwogICAgaWYgKHRoaXMuc2ltcGxlKSB7CiAgICAgIHBvcyArPSB0aGlzLnNpbXBsZS53cml0ZShwb3MsIGJ1Zik7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGNvbXBvc2l0ZSBvZiB0aGlzLmNvbXBvc2l0ZXMpIHsKICAgICAgICBwb3MgKz0gY29tcG9zaXRlLndyaXRlKHBvcywgYnVmKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBvcyAtIHNwb3M7CiAgfQogIHNjYWxlKGZhY3RvcikgewogICAgaWYgKCF0aGlzLmhlYWRlcikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB4TWlkZGxlID0gKHRoaXMuaGVhZGVyLnhNaW4gKyB0aGlzLmhlYWRlci54TWF4KSAvIDI7CiAgICB0aGlzLmhlYWRlci5zY2FsZSh4TWlkZGxlLCBmYWN0b3IpOwogICAgaWYgKHRoaXMuc2ltcGxlKSB7CiAgICAgIHRoaXMuc2ltcGxlLnNjYWxlKHhNaWRkbGUsIGZhY3Rvcik7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGNvbXBvc2l0ZSBvZiB0aGlzLmNvbXBvc2l0ZXMpIHsKICAgICAgICBjb21wb3NpdGUuc2NhbGUoeE1pZGRsZSwgZmFjdG9yKTsKICAgICAgfQogICAgfQogIH0KfQpjbGFzcyBHbHlwaEhlYWRlciB7CiAgY29uc3RydWN0b3IoewogICAgbnVtYmVyT2ZDb250b3VycywKICAgIHhNaW4sCiAgICB5TWluLAogICAgeE1heCwKICAgIHlNYXgKICB9KSB7CiAgICB0aGlzLm51bWJlck9mQ29udG91cnMgPSBudW1iZXJPZkNvbnRvdXJzOwogICAgdGhpcy54TWluID0geE1pbjsKICAgIHRoaXMueU1pbiA9IHlNaW47CiAgICB0aGlzLnhNYXggPSB4TWF4OwogICAgdGhpcy55TWF4ID0geU1heDsKICB9CiAgc3RhdGljIHBhcnNlKHBvcywgZ2x5ZikgewogICAgcmV0dXJuIFsxMCwgbmV3IEdseXBoSGVhZGVyKHsKICAgICAgbnVtYmVyT2ZDb250b3VyczogZ2x5Zi5nZXRJbnQxNihwb3MpLAogICAgICB4TWluOiBnbHlmLmdldEludDE2KHBvcyArIDIpLAogICAgICB5TWluOiBnbHlmLmdldEludDE2KHBvcyArIDQpLAogICAgICB4TWF4OiBnbHlmLmdldEludDE2KHBvcyArIDYpLAogICAgICB5TWF4OiBnbHlmLmdldEludDE2KHBvcyArIDgpCiAgICB9KV07CiAgfQogIGdldFNpemUoKSB7CiAgICByZXR1cm4gMTA7CiAgfQogIHdyaXRlKHBvcywgYnVmKSB7CiAgICBidWYuc2V0SW50MTYocG9zLCB0aGlzLm51bWJlck9mQ29udG91cnMpOwogICAgYnVmLnNldEludDE2KHBvcyArIDIsIHRoaXMueE1pbik7CiAgICBidWYuc2V0SW50MTYocG9zICsgNCwgdGhpcy55TWluKTsKICAgIGJ1Zi5zZXRJbnQxNihwb3MgKyA2LCB0aGlzLnhNYXgpOwogICAgYnVmLnNldEludDE2KHBvcyArIDgsIHRoaXMueU1heCk7CiAgICByZXR1cm4gMTA7CiAgfQogIHNjYWxlKHgsIGZhY3RvcikgewogICAgdGhpcy54TWluID0gTWF0aC5yb3VuZCh4ICsgKHRoaXMueE1pbiAtIHgpICogZmFjdG9yKTsKICAgIHRoaXMueE1heCA9IE1hdGgucm91bmQoeCArICh0aGlzLnhNYXggLSB4KSAqIGZhY3Rvcik7CiAgfQp9CmNsYXNzIENvbnRvdXIgewogIGNvbnN0cnVjdG9yKHsKICAgIGZsYWdzLAogICAgeENvb3JkaW5hdGVzLAogICAgeUNvb3JkaW5hdGVzCiAgfSkgewogICAgdGhpcy54Q29vcmRpbmF0ZXMgPSB4Q29vcmRpbmF0ZXM7CiAgICB0aGlzLnlDb29yZGluYXRlcyA9IHlDb29yZGluYXRlczsKICAgIHRoaXMuZmxhZ3MgPSBmbGFnczsKICB9Cn0KY2xhc3MgU2ltcGxlR2x5cGggewogIGNvbnN0cnVjdG9yKHsKICAgIGNvbnRvdXJzLAogICAgaW5zdHJ1Y3Rpb25zCiAgfSkgewogICAgdGhpcy5jb250b3VycyA9IGNvbnRvdXJzOwogICAgdGhpcy5pbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnM7CiAgfQogIHN0YXRpYyBwYXJzZShwb3MsIGdseWYsIG51bWJlck9mQ29udG91cnMpIHsKICAgIGNvbnN0IGVuZFB0c09mQ29udG91cnMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZDb250b3VyczsgaSsrKSB7CiAgICAgIGNvbnN0IGVuZFB0ID0gZ2x5Zi5nZXRVaW50MTYocG9zKTsKICAgICAgcG9zICs9IDI7CiAgICAgIGVuZFB0c09mQ29udG91cnMucHVzaChlbmRQdCk7CiAgICB9CiAgICBjb25zdCBudW1iZXJPZlB0ID0gZW5kUHRzT2ZDb250b3Vyc1tudW1iZXJPZkNvbnRvdXJzIC0gMV0gKyAxOwogICAgY29uc3QgaW5zdHJ1Y3Rpb25MZW5ndGggPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgcG9zICs9IDI7CiAgICBjb25zdCBpbnN0cnVjdGlvbnMgPSBuZXcgVWludDhBcnJheShnbHlmKS5zbGljZShwb3MsIHBvcyArIGluc3RydWN0aW9uTGVuZ3RoKTsKICAgIHBvcyArPSBpbnN0cnVjdGlvbkxlbmd0aDsKICAgIGNvbnN0IGZsYWdzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mUHQ7IHBvcysrLCBpKyspIHsKICAgICAgbGV0IGZsYWcgPSBnbHlmLmdldFVpbnQ4KHBvcyk7CiAgICAgIGZsYWdzLnB1c2goZmxhZyk7CiAgICAgIGlmIChmbGFnICYgUkVQRUFUX0ZMQUcpIHsKICAgICAgICBjb25zdCBjb3VudCA9IGdseWYuZ2V0VWludDgoKytwb3MpOwogICAgICAgIGZsYWcgXj0gUkVQRUFUX0ZMQUc7CiAgICAgICAgZm9yIChsZXQgbSA9IDA7IG0gPCBjb3VudDsgbSsrKSB7CiAgICAgICAgICBmbGFncy5wdXNoKGZsYWcpOwogICAgICAgIH0KICAgICAgICBpICs9IGNvdW50OwogICAgICB9CiAgICB9CiAgICBjb25zdCBhbGxYQ29vcmRpbmF0ZXMgPSBbXTsKICAgIGxldCB4Q29vcmRpbmF0ZXMgPSBbXTsKICAgIGxldCB5Q29vcmRpbmF0ZXMgPSBbXTsKICAgIGxldCBwb2ludEZsYWdzID0gW107CiAgICBjb25zdCBjb250b3VycyA9IFtdOwogICAgbGV0IGVuZFB0c09mQ29udG91cnNJbmRleCA9IDA7CiAgICBsZXQgbGFzdENvb3JkaW5hdGUgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZlB0OyBpKyspIHsKICAgICAgY29uc3QgZmxhZyA9IGZsYWdzW2ldOwogICAgICBpZiAoZmxhZyAmIFhfU0hPUlRfVkVDVE9SKSB7CiAgICAgICAgY29uc3QgeCA9IGdseWYuZ2V0VWludDgocG9zKyspOwogICAgICAgIGxhc3RDb29yZGluYXRlICs9IGZsYWcgJiBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IgPyB4IDogLXg7CiAgICAgICAgeENvb3JkaW5hdGVzLnB1c2gobGFzdENvb3JkaW5hdGUpOwogICAgICB9IGVsc2UgaWYgKGZsYWcgJiBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IpIHsKICAgICAgICB4Q29vcmRpbmF0ZXMucHVzaChsYXN0Q29vcmRpbmF0ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGFzdENvb3JkaW5hdGUgKz0gZ2x5Zi5nZXRJbnQxNihwb3MpOwogICAgICAgIHBvcyArPSAyOwogICAgICAgIHhDb29yZGluYXRlcy5wdXNoKGxhc3RDb29yZGluYXRlKTsKICAgICAgfQogICAgICBpZiAoZW5kUHRzT2ZDb250b3Vyc1tlbmRQdHNPZkNvbnRvdXJzSW5kZXhdID09PSBpKSB7CiAgICAgICAgZW5kUHRzT2ZDb250b3Vyc0luZGV4Kys7CiAgICAgICAgYWxsWENvb3JkaW5hdGVzLnB1c2goeENvb3JkaW5hdGVzKTsKICAgICAgICB4Q29vcmRpbmF0ZXMgPSBbXTsKICAgICAgfQogICAgfQogICAgbGFzdENvb3JkaW5hdGUgPSAwOwogICAgZW5kUHRzT2ZDb250b3Vyc0luZGV4ID0gMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZQdDsgaSsrKSB7CiAgICAgIGNvbnN0IGZsYWcgPSBmbGFnc1tpXTsKICAgICAgaWYgKGZsYWcgJiBZX1NIT1JUX1ZFQ1RPUikgewogICAgICAgIGNvbnN0IHkgPSBnbHlmLmdldFVpbnQ4KHBvcysrKTsKICAgICAgICBsYXN0Q29vcmRpbmF0ZSArPSBmbGFnICYgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SID8geSA6IC15OwogICAgICAgIHlDb29yZGluYXRlcy5wdXNoKGxhc3RDb29yZGluYXRlKTsKICAgICAgfSBlbHNlIGlmIChmbGFnICYgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SKSB7CiAgICAgICAgeUNvb3JkaW5hdGVzLnB1c2gobGFzdENvb3JkaW5hdGUpOwogICAgICB9IGVsc2UgewogICAgICAgIGxhc3RDb29yZGluYXRlICs9IGdseWYuZ2V0SW50MTYocG9zKTsKICAgICAgICBwb3MgKz0gMjsKICAgICAgICB5Q29vcmRpbmF0ZXMucHVzaChsYXN0Q29vcmRpbmF0ZSk7CiAgICAgIH0KICAgICAgcG9pbnRGbGFncy5wdXNoKGZsYWcgJiBPTl9DVVJWRV9QT0lOVCB8IGZsYWcgJiBPVkVSTEFQX1NJTVBMRSk7CiAgICAgIGlmIChlbmRQdHNPZkNvbnRvdXJzW2VuZFB0c09mQ29udG91cnNJbmRleF0gPT09IGkpIHsKICAgICAgICB4Q29vcmRpbmF0ZXMgPSBhbGxYQ29vcmRpbmF0ZXNbZW5kUHRzT2ZDb250b3Vyc0luZGV4XTsKICAgICAgICBlbmRQdHNPZkNvbnRvdXJzSW5kZXgrKzsKICAgICAgICBjb250b3Vycy5wdXNoKG5ldyBDb250b3VyKHsKICAgICAgICAgIGZsYWdzOiBwb2ludEZsYWdzLAogICAgICAgICAgeENvb3JkaW5hdGVzLAogICAgICAgICAgeUNvb3JkaW5hdGVzCiAgICAgICAgfSkpOwogICAgICAgIHlDb29yZGluYXRlcyA9IFtdOwogICAgICAgIHBvaW50RmxhZ3MgPSBbXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5ldyBTaW1wbGVHbHlwaCh7CiAgICAgIGNvbnRvdXJzLAogICAgICBpbnN0cnVjdGlvbnMKICAgIH0pOwogIH0KICBnZXRTaXplKCkgewogICAgbGV0IHNpemUgPSB0aGlzLmNvbnRvdXJzLmxlbmd0aCAqIDIgKyAyICsgdGhpcy5pbnN0cnVjdGlvbnMubGVuZ3RoOwogICAgbGV0IGxhc3RYID0gMDsKICAgIGxldCBsYXN0WSA9IDA7CiAgICBmb3IgKGNvbnN0IGNvbnRvdXIgb2YgdGhpcy5jb250b3VycykgewogICAgICBzaXplICs9IGNvbnRvdXIuZmxhZ3MubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjb250b3VyLnhDb29yZGluYXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgeCA9IGNvbnRvdXIueENvb3JkaW5hdGVzW2ldOwogICAgICAgIGNvbnN0IHkgPSBjb250b3VyLnlDb29yZGluYXRlc1tpXTsKICAgICAgICBsZXQgYWJzID0gTWF0aC5hYnMoeCAtIGxhc3RYKTsKICAgICAgICBpZiAoYWJzID4gMjU1KSB7CiAgICAgICAgICBzaXplICs9IDI7CiAgICAgICAgfSBlbHNlIGlmIChhYnMgPiAwKSB7CiAgICAgICAgICBzaXplICs9IDE7CiAgICAgICAgfQogICAgICAgIGxhc3RYID0geDsKICAgICAgICBhYnMgPSBNYXRoLmFicyh5IC0gbGFzdFkpOwogICAgICAgIGlmIChhYnMgPiAyNTUpIHsKICAgICAgICAgIHNpemUgKz0gMjsKICAgICAgICB9IGVsc2UgaWYgKGFicyA+IDApIHsKICAgICAgICAgIHNpemUgKz0gMTsKICAgICAgICB9CiAgICAgICAgbGFzdFkgPSB5OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2l6ZTsKICB9CiAgd3JpdGUocG9zLCBidWYpIHsKICAgIGNvbnN0IHNwb3MgPSBwb3M7CiAgICBjb25zdCB4Q29vcmRpbmF0ZXMgPSBbXTsKICAgIGNvbnN0IHlDb29yZGluYXRlcyA9IFtdOwogICAgY29uc3QgZmxhZ3MgPSBbXTsKICAgIGxldCBsYXN0WCA9IDA7CiAgICBsZXQgbGFzdFkgPSAwOwogICAgZm9yIChjb25zdCBjb250b3VyIG9mIHRoaXMuY29udG91cnMpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY29udG91ci54Q29vcmRpbmF0ZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGxldCBmbGFnID0gY29udG91ci5mbGFnc1tpXTsKICAgICAgICBjb25zdCB4ID0gY29udG91ci54Q29vcmRpbmF0ZXNbaV07CiAgICAgICAgbGV0IGRlbHRhID0geCAtIGxhc3RYOwogICAgICAgIGlmIChkZWx0YSA9PT0gMCkgewogICAgICAgICAgZmxhZyB8PSBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1I7CiAgICAgICAgICB4Q29vcmRpbmF0ZXMucHVzaCgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgYWJzID0gTWF0aC5hYnMoZGVsdGEpOwogICAgICAgICAgaWYgKGFicyA8PSAyNTUpIHsKICAgICAgICAgICAgZmxhZyB8PSBkZWx0YSA+PSAwID8gWF9TSE9SVF9WRUNUT1IgfCBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IgOiBYX1NIT1JUX1ZFQ1RPUjsKICAgICAgICAgICAgeENvb3JkaW5hdGVzLnB1c2goYWJzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHhDb29yZGluYXRlcy5wdXNoKGRlbHRhKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGFzdFggPSB4OwogICAgICAgIGNvbnN0IHkgPSBjb250b3VyLnlDb29yZGluYXRlc1tpXTsKICAgICAgICBkZWx0YSA9IHkgLSBsYXN0WTsKICAgICAgICBpZiAoZGVsdGEgPT09IDApIHsKICAgICAgICAgIGZsYWcgfD0gWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SOwogICAgICAgICAgeUNvb3JkaW5hdGVzLnB1c2goMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGFicyA9IE1hdGguYWJzKGRlbHRhKTsKICAgICAgICAgIGlmIChhYnMgPD0gMjU1KSB7CiAgICAgICAgICAgIGZsYWcgfD0gZGVsdGEgPj0gMCA/IFlfU0hPUlRfVkVDVE9SIHwgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SIDogWV9TSE9SVF9WRUNUT1I7CiAgICAgICAgICAgIHlDb29yZGluYXRlcy5wdXNoKGFicyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB5Q29vcmRpbmF0ZXMucHVzaChkZWx0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxhc3RZID0geTsKICAgICAgICBmbGFncy5wdXNoKGZsYWcpOwogICAgICB9CiAgICAgIGJ1Zi5zZXRVaW50MTYocG9zLCB4Q29vcmRpbmF0ZXMubGVuZ3RoIC0gMSk7CiAgICAgIHBvcyArPSAyOwogICAgfQogICAgYnVmLnNldFVpbnQxNihwb3MsIHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aCk7CiAgICBwb3MgKz0gMjsKICAgIGlmICh0aGlzLmluc3RydWN0aW9ucy5sZW5ndGgpIHsKICAgICAgbmV3IFVpbnQ4QXJyYXkoYnVmLmJ1ZmZlciwgMCwgYnVmLmJ1ZmZlci5ieXRlTGVuZ3RoKS5zZXQodGhpcy5pbnN0cnVjdGlvbnMsIHBvcyk7CiAgICAgIHBvcyArPSB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGg7CiAgICB9CiAgICBmb3IgKGNvbnN0IGZsYWcgb2YgZmxhZ3MpIHsKICAgICAgYnVmLnNldFVpbnQ4KHBvcysrLCBmbGFnKTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHhDb29yZGluYXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHggPSB4Q29vcmRpbmF0ZXNbaV07CiAgICAgIGNvbnN0IGZsYWcgPSBmbGFnc1tpXTsKICAgICAgaWYgKGZsYWcgJiBYX1NIT1JUX1ZFQ1RPUikgewogICAgICAgIGJ1Zi5zZXRVaW50OChwb3MrKywgeCk7CiAgICAgIH0gZWxzZSBpZiAoIShmbGFnICYgWF9JU19TQU1FX09SX1BPU0lUSVZFX1hfU0hPUlRfVkVDVE9SKSkgewogICAgICAgIGJ1Zi5zZXRJbnQxNihwb3MsIHgpOwogICAgICAgIHBvcyArPSAyOwogICAgICB9CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB5Q29vcmRpbmF0ZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCB5ID0geUNvb3JkaW5hdGVzW2ldOwogICAgICBjb25zdCBmbGFnID0gZmxhZ3NbaV07CiAgICAgIGlmIChmbGFnICYgWV9TSE9SVF9WRUNUT1IpIHsKICAgICAgICBidWYuc2V0VWludDgocG9zKyssIHkpOwogICAgICB9IGVsc2UgaWYgKCEoZmxhZyAmIFlfSVNfU0FNRV9PUl9QT1NJVElWRV9ZX1NIT1JUX1ZFQ1RPUikpIHsKICAgICAgICBidWYuc2V0SW50MTYocG9zLCB5KTsKICAgICAgICBwb3MgKz0gMjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBvcyAtIHNwb3M7CiAgfQogIHNjYWxlKHgsIGZhY3RvcikgewogICAgZm9yIChjb25zdCBjb250b3VyIG9mIHRoaXMuY29udG91cnMpIHsKICAgICAgaWYgKGNvbnRvdXIueENvb3JkaW5hdGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNvbnRvdXIueENvb3JkaW5hdGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb250b3VyLnhDb29yZGluYXRlc1tpXSA9IE1hdGgucm91bmQoeCArIChjb250b3VyLnhDb29yZGluYXRlc1tpXSAtIHgpICogZmFjdG9yKTsKICAgICAgfQogICAgfQogIH0KfQpjbGFzcyBDb21wb3NpdGVHbHlwaCB7CiAgY29uc3RydWN0b3IoewogICAgZmxhZ3MsCiAgICBnbHlwaEluZGV4LAogICAgYXJndW1lbnQxLAogICAgYXJndW1lbnQyLAogICAgdHJhbnNmLAogICAgaW5zdHJ1Y3Rpb25zCiAgfSkgewogICAgdGhpcy5mbGFncyA9IGZsYWdzOwogICAgdGhpcy5nbHlwaEluZGV4ID0gZ2x5cGhJbmRleDsKICAgIHRoaXMuYXJndW1lbnQxID0gYXJndW1lbnQxOwogICAgdGhpcy5hcmd1bWVudDIgPSBhcmd1bWVudDI7CiAgICB0aGlzLnRyYW5zZiA9IHRyYW5zZjsKICAgIHRoaXMuaW5zdHJ1Y3Rpb25zID0gaW5zdHJ1Y3Rpb25zOwogIH0KICBzdGF0aWMgcGFyc2UocG9zLCBnbHlmKSB7CiAgICBjb25zdCBzcG9zID0gcG9zOwogICAgY29uc3QgdHJhbnNmID0gW107CiAgICBsZXQgZmxhZ3MgPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgY29uc3QgZ2x5cGhJbmRleCA9IGdseWYuZ2V0VWludDE2KHBvcyArIDIpOwogICAgcG9zICs9IDQ7CiAgICBsZXQgYXJndW1lbnQxLCBhcmd1bWVudDI7CiAgICBpZiAoZmxhZ3MgJiBBUkdfMV9BTkRfMl9BUkVfV09SRFMpIHsKICAgICAgaWYgKGZsYWdzICYgQVJHU19BUkVfWFlfVkFMVUVTKSB7CiAgICAgICAgYXJndW1lbnQxID0gZ2x5Zi5nZXRJbnQxNihwb3MpOwogICAgICAgIGFyZ3VtZW50MiA9IGdseWYuZ2V0SW50MTYocG9zICsgMik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXJndW1lbnQxID0gZ2x5Zi5nZXRVaW50MTYocG9zKTsKICAgICAgICBhcmd1bWVudDIgPSBnbHlmLmdldFVpbnQxNihwb3MgKyAyKTsKICAgICAgfQogICAgICBwb3MgKz0gNDsKICAgICAgZmxhZ3MgXj0gQVJHXzFfQU5EXzJfQVJFX1dPUkRTOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGZsYWdzICYgQVJHU19BUkVfWFlfVkFMVUVTKSB7CiAgICAgICAgYXJndW1lbnQxID0gZ2x5Zi5nZXRJbnQ4KHBvcyk7CiAgICAgICAgYXJndW1lbnQyID0gZ2x5Zi5nZXRJbnQ4KHBvcyArIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIGFyZ3VtZW50MSA9IGdseWYuZ2V0VWludDgocG9zKTsKICAgICAgICBhcmd1bWVudDIgPSBnbHlmLmdldFVpbnQ4KHBvcyArIDEpOwogICAgICB9CiAgICAgIHBvcyArPSAyOwogICAgfQogICAgaWYgKGZsYWdzICYgV0VfSEFWRV9BX1NDQUxFKSB7CiAgICAgIHRyYW5zZi5wdXNoKGdseWYuZ2V0VWludDE2KHBvcykpOwogICAgICBwb3MgKz0gMjsKICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiBXRV9IQVZFX0FOX1hfQU5EX1lfU0NBTEUpIHsKICAgICAgdHJhbnNmLnB1c2goZ2x5Zi5nZXRVaW50MTYocG9zKSwgZ2x5Zi5nZXRVaW50MTYocG9zICsgMikpOwogICAgICBwb3MgKz0gNDsKICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiBXRV9IQVZFX0FfVFdPX0JZX1RXTykgewogICAgICB0cmFuc2YucHVzaChnbHlmLmdldFVpbnQxNihwb3MpLCBnbHlmLmdldFVpbnQxNihwb3MgKyAyKSwgZ2x5Zi5nZXRVaW50MTYocG9zICsgNCksIGdseWYuZ2V0VWludDE2KHBvcyArIDYpKTsKICAgICAgcG9zICs9IDg7CiAgICB9CiAgICBsZXQgaW5zdHJ1Y3Rpb25zID0gbnVsbDsKICAgIGlmIChmbGFncyAmIFdFX0hBVkVfSU5TVFJVQ1RJT05TKSB7CiAgICAgIGNvbnN0IGluc3RydWN0aW9uTGVuZ3RoID0gZ2x5Zi5nZXRVaW50MTYocG9zKTsKICAgICAgcG9zICs9IDI7CiAgICAgIGluc3RydWN0aW9ucyA9IG5ldyBVaW50OEFycmF5KGdseWYpLnNsaWNlKHBvcywgcG9zICsgaW5zdHJ1Y3Rpb25MZW5ndGgpOwogICAgICBwb3MgKz0gaW5zdHJ1Y3Rpb25MZW5ndGg7CiAgICB9CiAgICByZXR1cm4gW3BvcyAtIHNwb3MsIG5ldyBDb21wb3NpdGVHbHlwaCh7CiAgICAgIGZsYWdzLAogICAgICBnbHlwaEluZGV4LAogICAgICBhcmd1bWVudDEsCiAgICAgIGFyZ3VtZW50MiwKICAgICAgdHJhbnNmLAogICAgICBpbnN0cnVjdGlvbnMKICAgIH0pXTsKICB9CiAgZ2V0U2l6ZSgpIHsKICAgIGxldCBzaXplID0gMiArIDIgKyB0aGlzLnRyYW5zZi5sZW5ndGggKiAyOwogICAgaWYgKHRoaXMuZmxhZ3MgJiBXRV9IQVZFX0lOU1RSVUNUSU9OUykgewogICAgICBzaXplICs9IDIgKyB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGg7CiAgICB9CiAgICBzaXplICs9IDI7CiAgICBpZiAodGhpcy5mbGFncyAmIDIpIHsKICAgICAgaWYgKCEodGhpcy5hcmd1bWVudDEgPj0gLTEyOCAmJiB0aGlzLmFyZ3VtZW50MSA8PSAxMjcgJiYgdGhpcy5hcmd1bWVudDIgPj0gLTEyOCAmJiB0aGlzLmFyZ3VtZW50MiA8PSAxMjcpKSB7CiAgICAgICAgc2l6ZSArPSAyOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCEodGhpcy5hcmd1bWVudDEgPj0gMCAmJiB0aGlzLmFyZ3VtZW50MSA8PSAyNTUgJiYgdGhpcy5hcmd1bWVudDIgPj0gMCAmJiB0aGlzLmFyZ3VtZW50MiA8PSAyNTUpKSB7CiAgICAgIHNpemUgKz0gMjsKICAgIH0KICAgIHJldHVybiBzaXplOwogIH0KICB3cml0ZShwb3MsIGJ1ZikgewogICAgY29uc3Qgc3BvcyA9IHBvczsKICAgIGlmICh0aGlzLmZsYWdzICYgQVJHU19BUkVfWFlfVkFMVUVTKSB7CiAgICAgIGlmICghKHRoaXMuYXJndW1lbnQxID49IC0xMjggJiYgdGhpcy5hcmd1bWVudDEgPD0gMTI3ICYmIHRoaXMuYXJndW1lbnQyID49IC0xMjggJiYgdGhpcy5hcmd1bWVudDIgPD0gMTI3KSkgewogICAgICAgIHRoaXMuZmxhZ3MgfD0gQVJHXzFfQU5EXzJfQVJFX1dPUkRTOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCEodGhpcy5hcmd1bWVudDEgPj0gMCAmJiB0aGlzLmFyZ3VtZW50MSA8PSAyNTUgJiYgdGhpcy5hcmd1bWVudDIgPj0gMCAmJiB0aGlzLmFyZ3VtZW50MiA8PSAyNTUpKSB7CiAgICAgIHRoaXMuZmxhZ3MgfD0gQVJHXzFfQU5EXzJfQVJFX1dPUkRTOwogICAgfQogICAgYnVmLnNldFVpbnQxNihwb3MsIHRoaXMuZmxhZ3MpOwogICAgYnVmLnNldFVpbnQxNihwb3MgKyAyLCB0aGlzLmdseXBoSW5kZXgpOwogICAgcG9zICs9IDQ7CiAgICBpZiAodGhpcy5mbGFncyAmIEFSR18xX0FORF8yX0FSRV9XT1JEUykgewogICAgICBpZiAodGhpcy5mbGFncyAmIEFSR1NfQVJFX1hZX1ZBTFVFUykgewogICAgICAgIGJ1Zi5zZXRJbnQxNihwb3MsIHRoaXMuYXJndW1lbnQxKTsKICAgICAgICBidWYuc2V0SW50MTYocG9zICsgMiwgdGhpcy5hcmd1bWVudDIpOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1Zi5zZXRVaW50MTYocG9zLCB0aGlzLmFyZ3VtZW50MSk7CiAgICAgICAgYnVmLnNldFVpbnQxNihwb3MgKyAyLCB0aGlzLmFyZ3VtZW50Mik7CiAgICAgIH0KICAgICAgcG9zICs9IDQ7CiAgICB9IGVsc2UgewogICAgICBidWYuc2V0VWludDgocG9zLCB0aGlzLmFyZ3VtZW50MSk7CiAgICAgIGJ1Zi5zZXRVaW50OChwb3MgKyAxLCB0aGlzLmFyZ3VtZW50Mik7CiAgICAgIHBvcyArPSAyOwogICAgfQogICAgaWYgKHRoaXMuZmxhZ3MgJiBXRV9IQVZFX0lOU1RSVUNUSU9OUykgewogICAgICBidWYuc2V0VWludDE2KHBvcywgdGhpcy5pbnN0cnVjdGlvbnMubGVuZ3RoKTsKICAgICAgcG9zICs9IDI7CiAgICAgIGlmICh0aGlzLmluc3RydWN0aW9ucy5sZW5ndGgpIHsKICAgICAgICBuZXcgVWludDhBcnJheShidWYuYnVmZmVyLCAwLCBidWYuYnVmZmVyLmJ5dGVMZW5ndGgpLnNldCh0aGlzLmluc3RydWN0aW9ucywgcG9zKTsKICAgICAgICBwb3MgKz0gdGhpcy5pbnN0cnVjdGlvbnMubGVuZ3RoOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcG9zIC0gc3BvczsKICB9CiAgc2NhbGUoeCwgZmFjdG9yKSB7fQp9Cgo7Ly8gLi9zcmMvY29yZS9vcGVudHlwZV9maWxlX2J1aWxkZXIuanMKCgpmdW5jdGlvbiB3cml0ZUludDE2KGRlc3QsIG9mZnNldCwgbnVtKSB7CiAgZGVzdFtvZmZzZXRdID0gbnVtID4+IDggJiAweGZmOwogIGRlc3Rbb2Zmc2V0ICsgMV0gPSBudW0gJiAweGZmOwp9CmZ1bmN0aW9uIHdyaXRlSW50MzIoZGVzdCwgb2Zmc2V0LCBudW0pIHsKICBkZXN0W29mZnNldF0gPSBudW0gPj4gMjQgJiAweGZmOwogIGRlc3Rbb2Zmc2V0ICsgMV0gPSBudW0gPj4gMTYgJiAweGZmOwogIGRlc3Rbb2Zmc2V0ICsgMl0gPSBudW0gPj4gOCAmIDB4ZmY7CiAgZGVzdFtvZmZzZXQgKyAzXSA9IG51bSAmIDB4ZmY7Cn0KZnVuY3Rpb24gd3JpdGVEYXRhKGRlc3QsIG9mZnNldCwgZGF0YSkgewogIGlmIChkYXRhIGluc3RhbmNlb2YgVWludDhBcnJheSkgewogICAgZGVzdC5zZXQoZGF0YSwgb2Zmc2V0KTsKICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGRlc3Rbb2Zmc2V0KytdID0gZGF0YS5jaGFyQ29kZUF0KGkpICYgMHhmZjsKICAgIH0KICB9IGVsc2UgewogICAgZm9yIChjb25zdCBudW0gb2YgZGF0YSkgewogICAgICBkZXN0W29mZnNldCsrXSA9IG51bSAmIDB4ZmY7CiAgICB9CiAgfQp9CmNvbnN0IE9URl9IRUFERVJfU0laRSA9IDEyOwpjb25zdCBPVEZfVEFCTEVfRU5UUllfU0laRSA9IDE2OwpjbGFzcyBPcGVuVHlwZUZpbGVCdWlsZGVyIHsKICBjb25zdHJ1Y3RvcihzZm50KSB7CiAgICB0aGlzLnNmbnQgPSBzZm50OwogICAgdGhpcy50YWJsZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIH0KICBzdGF0aWMgZ2V0U2VhcmNoUGFyYW1zKGVudHJpZXNDb3VudCwgZW50cnlTaXplKSB7CiAgICBsZXQgbWF4UG93ZXIyID0gMSwKICAgICAgbG9nMiA9IDA7CiAgICB3aGlsZSAoKG1heFBvd2VyMiBeIGVudHJpZXNDb3VudCkgPiBtYXhQb3dlcjIpIHsKICAgICAgbWF4UG93ZXIyIDw8PSAxOwogICAgICBsb2cyKys7CiAgICB9CiAgICBjb25zdCBzZWFyY2hSYW5nZSA9IG1heFBvd2VyMiAqIGVudHJ5U2l6ZTsKICAgIHJldHVybiB7CiAgICAgIHJhbmdlOiBzZWFyY2hSYW5nZSwKICAgICAgZW50cnk6IGxvZzIsCiAgICAgIHJhbmdlU2hpZnQ6IGVudHJ5U2l6ZSAqIGVudHJpZXNDb3VudCAtIHNlYXJjaFJhbmdlCiAgICB9OwogIH0KICB0b0FycmF5KCkgewogICAgbGV0IHNmbnQgPSB0aGlzLnNmbnQ7CiAgICBjb25zdCB0YWJsZXMgPSB0aGlzLnRhYmxlczsKICAgIGNvbnN0IHRhYmxlc05hbWVzID0gT2JqZWN0LmtleXModGFibGVzKTsKICAgIHRhYmxlc05hbWVzLnNvcnQoKTsKICAgIGNvbnN0IG51bVRhYmxlcyA9IHRhYmxlc05hbWVzLmxlbmd0aDsKICAgIGxldCBpLCBqLCBqaiwgdGFibGUsIHRhYmxlTmFtZTsKICAgIGxldCBvZmZzZXQgPSBPVEZfSEVBREVSX1NJWkUgKyBudW1UYWJsZXMgKiBPVEZfVEFCTEVfRU5UUllfU0laRTsKICAgIGNvbnN0IHRhYmxlT2Zmc2V0cyA9IFtvZmZzZXRdOwogICAgZm9yIChpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgIHRhYmxlID0gdGFibGVzW3RhYmxlc05hbWVzW2ldXTsKICAgICAgY29uc3QgcGFkZGVkTGVuZ3RoID0gKHRhYmxlLmxlbmd0aCArIDMgJiB+MykgPj4+IDA7CiAgICAgIG9mZnNldCArPSBwYWRkZWRMZW5ndGg7CiAgICAgIHRhYmxlT2Zmc2V0cy5wdXNoKG9mZnNldCk7CiAgICB9CiAgICBjb25zdCBmaWxlID0gbmV3IFVpbnQ4QXJyYXkob2Zmc2V0KTsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1UYWJsZXM7IGkrKykgewogICAgICB0YWJsZSA9IHRhYmxlc1t0YWJsZXNOYW1lc1tpXV07CiAgICAgIHdyaXRlRGF0YShmaWxlLCB0YWJsZU9mZnNldHNbaV0sIHRhYmxlKTsKICAgIH0KICAgIGlmIChzZm50ID09PSAidHJ1ZSIpIHsKICAgICAgc2ZudCA9IHN0cmluZzMyKDB4MDAwMTAwMDApOwogICAgfQogICAgZmlsZVswXSA9IHNmbnQuY2hhckNvZGVBdCgwKSAmIDB4ZmY7CiAgICBmaWxlWzFdID0gc2ZudC5jaGFyQ29kZUF0KDEpICYgMHhmZjsKICAgIGZpbGVbMl0gPSBzZm50LmNoYXJDb2RlQXQoMikgJiAweGZmOwogICAgZmlsZVszXSA9IHNmbnQuY2hhckNvZGVBdCgzKSAmIDB4ZmY7CiAgICB3cml0ZUludDE2KGZpbGUsIDQsIG51bVRhYmxlcyk7CiAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBPcGVuVHlwZUZpbGVCdWlsZGVyLmdldFNlYXJjaFBhcmFtcyhudW1UYWJsZXMsIDE2KTsKICAgIHdyaXRlSW50MTYoZmlsZSwgNiwgc2VhcmNoUGFyYW1zLnJhbmdlKTsKICAgIHdyaXRlSW50MTYoZmlsZSwgOCwgc2VhcmNoUGFyYW1zLmVudHJ5KTsKICAgIHdyaXRlSW50MTYoZmlsZSwgMTAsIHNlYXJjaFBhcmFtcy5yYW5nZVNoaWZ0KTsKICAgIG9mZnNldCA9IE9URl9IRUFERVJfU0laRTsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1UYWJsZXM7IGkrKykgewogICAgICB0YWJsZU5hbWUgPSB0YWJsZXNOYW1lc1tpXTsKICAgICAgZmlsZVtvZmZzZXRdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMCkgJiAweGZmOwogICAgICBmaWxlW29mZnNldCArIDFdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMSkgJiAweGZmOwogICAgICBmaWxlW29mZnNldCArIDJdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMikgJiAweGZmOwogICAgICBmaWxlW29mZnNldCArIDNdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMykgJiAweGZmOwogICAgICBsZXQgY2hlY2tzdW0gPSAwOwogICAgICBmb3IgKGogPSB0YWJsZU9mZnNldHNbaV0sIGpqID0gdGFibGVPZmZzZXRzW2kgKyAxXTsgaiA8IGpqOyBqICs9IDQpIHsKICAgICAgICBjb25zdCBxdWFkID0gcmVhZFVpbnQzMihmaWxlLCBqKTsKICAgICAgICBjaGVja3N1bSA9IGNoZWNrc3VtICsgcXVhZCA+Pj4gMDsKICAgICAgfQogICAgICB3cml0ZUludDMyKGZpbGUsIG9mZnNldCArIDQsIGNoZWNrc3VtKTsKICAgICAgd3JpdGVJbnQzMihmaWxlLCBvZmZzZXQgKyA4LCB0YWJsZU9mZnNldHNbaV0pOwogICAgICB3cml0ZUludDMyKGZpbGUsIG9mZnNldCArIDEyLCB0YWJsZXNbdGFibGVOYW1lXS5sZW5ndGgpOwogICAgICBvZmZzZXQgKz0gT1RGX1RBQkxFX0VOVFJZX1NJWkU7CiAgICB9CiAgICByZXR1cm4gZmlsZTsKICB9CiAgYWRkVGFibGUodGFnLCBkYXRhKSB7CiAgICBpZiAodGFnIGluIHRoaXMudGFibGVzKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVGFibGUgIiArIHRhZyArICIgYWxyZWFkeSBleGlzdHMiKTsKICAgIH0KICAgIHRoaXMudGFibGVzW3RhZ10gPSBkYXRhOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvdHlwZTFfcGFyc2VyLmpzCgoKCgpjb25zdCBISU5USU5HX0VOQUJMRUQgPSBmYWxzZTsKY29uc3QgQ09NTUFORF9NQVAgPSB7CiAgaHN0ZW06IFsxXSwKICB2c3RlbTogWzNdLAogIHZtb3ZldG86IFs0XSwKICBybGluZXRvOiBbNV0sCiAgaGxpbmV0bzogWzZdLAogIHZsaW5ldG86IFs3XSwKICBycmN1cnZldG86IFs4XSwKICBjYWxsc3VicjogWzEwXSwKICBmbGV4OiBbMTIsIDM1XSwKICBkcm9wOiBbMTIsIDE4XSwKICBlbmRjaGFyOiBbMTRdLAogIHJtb3ZldG86IFsyMV0sCiAgaG1vdmV0bzogWzIyXSwKICB2aGN1cnZldG86IFszMF0sCiAgaHZjdXJ2ZXRvOiBbMzFdCn07CmNsYXNzIFR5cGUxQ2hhclN0cmluZyB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLndpZHRoID0gMDsKICAgIHRoaXMubHNiID0gMDsKICAgIHRoaXMuZmxleGluZyA9IGZhbHNlOwogICAgdGhpcy5vdXRwdXQgPSBbXTsKICAgIHRoaXMuc3RhY2sgPSBbXTsKICB9CiAgY29udmVydChlbmNvZGVkLCBzdWJycywgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgY29uc3QgY291bnQgPSBlbmNvZGVkLmxlbmd0aDsKICAgIGxldCBlcnJvciA9IGZhbHNlOwogICAgbGV0IHd4LCBzYngsIHN1YnJOdW1iZXI7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgbGV0IHZhbHVlID0gZW5jb2RlZFtpXTsKICAgICAgaWYgKHZhbHVlIDwgMzIpIHsKICAgICAgICBpZiAodmFsdWUgPT09IDEyKSB7CiAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSA8PCA4KSArIGVuY29kZWRbKytpXTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAuaHN0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgaWYgKCFISU5USU5HX0VOQUJMRUQpIHsKICAgICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLnZzdGVtKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGlmICh0aGlzLmZsZXhpbmcpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZHkgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaCgwLCBkeSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDEsIENPTU1BTkRfTUFQLnZtb3ZldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLnJsaW5ldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDEsIENPTU1BTkRfTUFQLmhsaW5ldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDEsIENPTU1BTkRfTUFQLnZsaW5ldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDYsIENPTU1BTkRfTUFQLnJyY3VydmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWJyTnVtYmVyID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgaWYgKCFzdWJyc1tzdWJyTnVtYmVyXSkgewogICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuY29udmVydChzdWJyc1tzdWJyTnVtYmVyXSwgc3VicnMsIHNlYWNBbmFseXNpc0VuYWJsZWQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgIHJldHVybiBlcnJvcjsKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd3ggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBzYnggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICB0aGlzLmxzYiA9IHNieDsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHd4OwogICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2god3gsIHNieCk7CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC5obW92ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICB0aGlzLm91dHB1dC5wdXNoKENPTU1BTkRfTUFQLmVuZGNoYXJbMF0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgIGlmICh0aGlzLmZsZXhpbmcpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAucm1vdmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgaWYgKHRoaXMuZmxleGluZykgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaCgwKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAuaG1vdmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDQsIENPTU1BTkRfTUFQLnZoY3VydmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDQsIENPTU1BTkRfTUFQLmh2Y3VydmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAwOgogICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAxOgogICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAudnN0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMjoKICAgICAgICAgICAgaWYgKCFISU5USU5HX0VOQUJMRUQpIHsKICAgICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLmhzdGVtKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDY6CiAgICAgICAgICAgIGlmIChzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICAgICAgICAgICAgY29uc3QgYXNiID0gdGhpcy5zdGFjay5hdCgtNSk7CiAgICAgICAgICAgICAgdGhpcy5zZWFjID0gdGhpcy5zdGFjay5zcGxpY2UoLTQsIDQpOwogICAgICAgICAgICAgIHRoaXMuc2VhY1swXSArPSB0aGlzLmxzYiAtIGFzYjsKICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMCwgQ09NTUFORF9NQVAuZW5kY2hhcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDQsIENPTU1BTkRfTUFQLmVuZGNoYXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyA3OgogICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCA0KSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIHd4ID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgY29uc3Qgc2J5ID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgc2J4ID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgdGhpcy5sc2IgPSBzYng7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3eDsKICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKHd4LCBzYngsIHNieSk7CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgzLCBDT01NQU5EX01BUC5ybW92ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDEyOgogICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG51bTIgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBjb25zdCBudW0xID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKG51bTEgLyBudW0yKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDE2OgogICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnJOdW1iZXIgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBjb25zdCBudW1BcmdzID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgaWYgKHN1YnJOdW1iZXIgPT09IDAgJiYgbnVtQXJncyA9PT0gMykgewogICAgICAgICAgICAgIGNvbnN0IGZsZXhBcmdzID0gdGhpcy5zdGFjay5zcGxpY2UoLTE3LCAxNyk7CiAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKGZsZXhBcmdzWzJdICsgZmxleEFyZ3NbMF0sIGZsZXhBcmdzWzNdICsgZmxleEFyZ3NbMV0sIGZsZXhBcmdzWzRdLCBmbGV4QXJnc1s1XSwgZmxleEFyZ3NbNl0sIGZsZXhBcmdzWzddLCBmbGV4QXJnc1s4XSwgZmxleEFyZ3NbOV0sIGZsZXhBcmdzWzEwXSwgZmxleEFyZ3NbMTFdLCBmbGV4QXJnc1sxMl0sIGZsZXhBcmdzWzEzXSwgZmxleEFyZ3NbMTRdKTsKICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMTMsIENPTU1BTkRfTUFQLmZsZXgsIHRydWUpOwogICAgICAgICAgICAgIHRoaXMuZmxleGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaChmbGV4QXJnc1sxNV0sIGZsZXhBcmdzWzE2XSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Vick51bWJlciA9PT0gMSAmJiBudW1BcmdzID09PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5mbGV4aW5nID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMTc6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAzMzoKICAgICAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHdhcm4oJ1Vua25vd24gdHlwZSAxIGNoYXJzdHJpbmcgY29tbWFuZCBvZiAiJyArIHZhbHVlICsgJyInKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgaWYgKHZhbHVlIDw9IDI0NikgewogICAgICAgIHZhbHVlIC09IDEzOTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8PSAyNTApIHsKICAgICAgICB2YWx1ZSA9ICh2YWx1ZSAtIDI0NykgKiAyNTYgKyBlbmNvZGVkWysraV0gKyAxMDg7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPD0gMjU0KSB7CiAgICAgICAgdmFsdWUgPSAtKCh2YWx1ZSAtIDI1MSkgKiAyNTYpIC0gZW5jb2RlZFsrK2ldIC0gMTA4OwogICAgICB9IGVsc2UgewogICAgICAgIHZhbHVlID0gKGVuY29kZWRbKytpXSAmIDB4ZmYpIDw8IDI0IHwgKGVuY29kZWRbKytpXSAmIDB4ZmYpIDw8IDE2IHwgKGVuY29kZWRbKytpXSAmIDB4ZmYpIDw8IDggfCAoZW5jb2RlZFsrK2ldICYgMHhmZikgPDwgMDsKICAgICAgfQogICAgICB0aGlzLnN0YWNrLnB1c2godmFsdWUpOwogICAgfQogICAgcmV0dXJuIGVycm9yOwogIH0KICBleGVjdXRlQ29tbWFuZChob3dNYW55QXJncywgY29tbWFuZCwga2VlcFN0YWNrKSB7CiAgICBjb25zdCBzdGFja0xlbmd0aCA9IHRoaXMuc3RhY2subGVuZ3RoOwogICAgaWYgKGhvd01hbnlBcmdzID4gc3RhY2tMZW5ndGgpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBjb25zdCBzdGFydCA9IHN0YWNrTGVuZ3RoIC0gaG93TWFueUFyZ3M7CiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBzdGFja0xlbmd0aDsgaSsrKSB7CiAgICAgIGxldCB2YWx1ZSA9IHRoaXMuc3RhY2tbaV07CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSkgewogICAgICAgIHRoaXMub3V0cHV0LnB1c2goMjgsIHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhbHVlID0gNjU1MzYgKiB2YWx1ZSB8IDA7CiAgICAgICAgdGhpcy5vdXRwdXQucHVzaCgyNTUsIHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKICAgICAgfQogICAgfQogICAgdGhpcy5vdXRwdXQucHVzaCguLi5jb21tYW5kKTsKICAgIGlmIChrZWVwU3RhY2spIHsKICAgICAgdGhpcy5zdGFjay5zcGxpY2Uoc3RhcnQsIGhvd01hbnlBcmdzKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuc3RhY2subGVuZ3RoID0gMDsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9Cn0KY29uc3QgRUVYRUNfRU5DUllQVF9LRVkgPSA1NTY2NTsKY29uc3QgQ0hBUl9TVFJTX0VOQ1JZUFRfS0VZID0gNDMzMDsKZnVuY3Rpb24gaXNIZXhEaWdpdChjb2RlKSB7CiAgcmV0dXJuIGNvZGUgPj0gNDggJiYgY29kZSA8PSA1NyB8fCBjb2RlID49IDY1ICYmIGNvZGUgPD0gNzAgfHwgY29kZSA+PSA5NyAmJiBjb2RlIDw9IDEwMjsKfQpmdW5jdGlvbiBkZWNyeXB0KGRhdGEsIGtleSwgZGlzY2FyZE51bWJlcikgewogIGlmIChkaXNjYXJkTnVtYmVyID49IGRhdGEubGVuZ3RoKSB7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgfQogIGNvbnN0IGMxID0gNTI4NDUsCiAgICBjMiA9IDIyNzE5OwogIGxldCByID0ga2V5IHwgMCwKICAgIGksCiAgICBqOwogIGZvciAoaSA9IDA7IGkgPCBkaXNjYXJkTnVtYmVyOyBpKyspIHsKICAgIHIgPSAoZGF0YVtpXSArIHIpICogYzEgKyBjMiAmICgxIDw8IDE2KSAtIDE7CiAgfQogIGNvbnN0IGNvdW50ID0gZGF0YS5sZW5ndGggLSBkaXNjYXJkTnVtYmVyOwogIGNvbnN0IGRlY3J5cHRlZCA9IG5ldyBVaW50OEFycmF5KGNvdW50KTsKICBmb3IgKGkgPSBkaXNjYXJkTnVtYmVyLCBqID0gMDsgaiA8IGNvdW50OyBpKyssIGorKykgewogICAgY29uc3QgdmFsdWUgPSBkYXRhW2ldOwogICAgZGVjcnlwdGVkW2pdID0gdmFsdWUgXiByID4+IDg7CiAgICByID0gKHZhbHVlICsgcikgKiBjMSArIGMyICYgKDEgPDwgMTYpIC0gMTsKICB9CiAgcmV0dXJuIGRlY3J5cHRlZDsKfQpmdW5jdGlvbiBkZWNyeXB0QXNjaWkoZGF0YSwga2V5LCBkaXNjYXJkTnVtYmVyKSB7CiAgY29uc3QgYzEgPSA1Mjg0NSwKICAgIGMyID0gMjI3MTk7CiAgbGV0IHIgPSBrZXkgfCAwOwogIGNvbnN0IGNvdW50ID0gZGF0YS5sZW5ndGgsCiAgICBtYXliZUxlbmd0aCA9IGNvdW50ID4+PiAxOwogIGNvbnN0IGRlY3J5cHRlZCA9IG5ldyBVaW50OEFycmF5KG1heWJlTGVuZ3RoKTsKICBsZXQgaSwgajsKICBmb3IgKGkgPSAwLCBqID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgIGNvbnN0IGRpZ2l0MSA9IGRhdGFbaV07CiAgICBpZiAoIWlzSGV4RGlnaXQoZGlnaXQxKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGkrKzsKICAgIGxldCBkaWdpdDI7CiAgICB3aGlsZSAoaSA8IGNvdW50ICYmICFpc0hleERpZ2l0KGRpZ2l0MiA9IGRhdGFbaV0pKSB7CiAgICAgIGkrKzsKICAgIH0KICAgIGlmIChpIDwgY291bnQpIHsKICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUludChTdHJpbmcuZnJvbUNoYXJDb2RlKGRpZ2l0MSwgZGlnaXQyKSwgMTYpOwogICAgICBkZWNyeXB0ZWRbaisrXSA9IHZhbHVlIF4gciA+PiA4OwogICAgICByID0gKHZhbHVlICsgcikgKiBjMSArIGMyICYgKDEgPDwgMTYpIC0gMTsKICAgIH0KICB9CiAgcmV0dXJuIGRlY3J5cHRlZC5zbGljZShkaXNjYXJkTnVtYmVyLCBqKTsKfQpmdW5jdGlvbiBpc1NwZWNpYWwoYykgewogIHJldHVybiBjID09PSAweDJmIHx8IGMgPT09IDB4NWIgfHwgYyA9PT0gMHg1ZCB8fCBjID09PSAweDdiIHx8IGMgPT09IDB4N2QgfHwgYyA9PT0gMHgyOCB8fCBjID09PSAweDI5Owp9CmNsYXNzIFR5cGUxUGFyc2VyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGVuY3J5cHRlZCwgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgaWYgKGVuY3J5cHRlZCkgewogICAgICBjb25zdCBkYXRhID0gc3RyZWFtLmdldEJ5dGVzKCk7CiAgICAgIGNvbnN0IGlzQmluYXJ5ID0gISgoaXNIZXhEaWdpdChkYXRhWzBdKSB8fCBpc1doaXRlU3BhY2UoZGF0YVswXSkpICYmIGlzSGV4RGlnaXQoZGF0YVsxXSkgJiYgaXNIZXhEaWdpdChkYXRhWzJdKSAmJiBpc0hleERpZ2l0KGRhdGFbM10pICYmIGlzSGV4RGlnaXQoZGF0YVs0XSkgJiYgaXNIZXhEaWdpdChkYXRhWzVdKSAmJiBpc0hleERpZ2l0KGRhdGFbNl0pICYmIGlzSGV4RGlnaXQoZGF0YVs3XSkpOwogICAgICBzdHJlYW0gPSBuZXcgU3RyZWFtKGlzQmluYXJ5ID8gZGVjcnlwdChkYXRhLCBFRVhFQ19FTkNSWVBUX0tFWSwgNCkgOiBkZWNyeXB0QXNjaWkoZGF0YSwgRUVYRUNfRU5DUllQVF9LRVksIDQpKTsKICAgIH0KICAgIHRoaXMuc2VhY0FuYWx5c2lzRW5hYmxlZCA9ICEhc2VhY0FuYWx5c2lzRW5hYmxlZDsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5uZXh0Q2hhcigpOwogIH0KICByZWFkTnVtYmVyQXJyYXkoKSB7CiAgICB0aGlzLmdldFRva2VuKCk7CiAgICBjb25zdCBhcnJheSA9IFtdOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbiA9PT0gIl0iIHx8IHRva2VuID09PSAifSIpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBhcnJheS5wdXNoKHBhcnNlRmxvYXQodG9rZW4gfHwgMCkpOwogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KICByZWFkTnVtYmVyKCkgewogICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICByZXR1cm4gcGFyc2VGbG9hdCh0b2tlbiB8fCAwKTsKICB9CiAgcmVhZEludCgpIHsKICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgcmV0dXJuIHBhcnNlSW50KHRva2VuIHx8IDAsIDEwKSB8IDA7CiAgfQogIHJlYWRCb29sZWFuKCkgewogICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICByZXR1cm4gdG9rZW4gPT09ICJ0cnVlIiA/IDEgOiAwOwogIH0KICBuZXh0Q2hhcigpIHsKICAgIHJldHVybiB0aGlzLmN1cnJlbnRDaGFyID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpOwogIH0KICBwcmV2Q2hhcigpIHsKICAgIHRoaXMuc3RyZWFtLnNraXAoLTIpOwogICAgcmV0dXJuIHRoaXMuY3VycmVudENoYXIgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgfQogIGdldFRva2VuKCkgewogICAgbGV0IGNvbW1lbnQgPSBmYWxzZTsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoY2ggPT09IC0xKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKGNvbW1lbnQpIHsKICAgICAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgICAgIGNvbW1lbnQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MjUpIHsKICAgICAgICBjb21tZW50ID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmICghaXNXaGl0ZVNwYWNlKGNoKSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgfQogICAgaWYgKGlzU3BlY2lhbChjaCkpIHsKICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICB9CiAgICBsZXQgdG9rZW4gPSAiIjsKICAgIGRvIHsKICAgICAgdG9rZW4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgfSB3aGlsZSAoY2ggPj0gMCAmJiAhaXNXaGl0ZVNwYWNlKGNoKSAmJiAhaXNTcGVjaWFsKGNoKSk7CiAgICByZXR1cm4gdG9rZW47CiAgfQogIHJlYWRDaGFyU3RyaW5ncyhieXRlcywgbGVuSVYpIHsKICAgIGlmIChsZW5JViA9PT0gLTEpIHsKICAgICAgcmV0dXJuIGJ5dGVzOwogICAgfQogICAgcmV0dXJuIGRlY3J5cHQoYnl0ZXMsIENIQVJfU1RSU19FTkNSWVBUX0tFWSwgbGVuSVYpOwogIH0KICBleHRyYWN0Rm9udFByb2dyYW0ocHJvcGVydGllcykgewogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW07CiAgICBjb25zdCBzdWJycyA9IFtdLAogICAgICBjaGFyc3RyaW5ncyA9IFtdOwogICAgY29uc3QgcHJpdmF0ZURhdGEgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgcHJpdmF0ZURhdGEubGVuSVYgPSA0OwogICAgY29uc3QgcHJvZ3JhbSA9IHsKICAgICAgc3VicnM6IFtdLAogICAgICBjaGFyc3RyaW5nczogW10sCiAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICBwcml2YXRlRGF0YQogICAgICB9CiAgICB9OwogICAgbGV0IHRva2VuLCBsZW5ndGgsIGRhdGEsIGxlbklWOwogICAgd2hpbGUgKCh0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKSkgIT09IG51bGwpIHsKICAgICAgaWYgKHRva2VuICE9PSAiLyIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgc3dpdGNoICh0b2tlbikgewogICAgICAgIGNhc2UgIkNoYXJTdHJpbmdzIjoKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4gPT09ICJlbmQiKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRva2VuICE9PSAiLyIpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBnbHlwaCA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgZGF0YSA9IGxlbmd0aCA+IDAgPyBzdHJlYW0uZ2V0Qnl0ZXMobGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KDApOwogICAgICAgICAgICBsZW5JViA9IHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YS5sZW5JVjsKICAgICAgICAgICAgY29uc3QgZW5jb2RlZCA9IHRoaXMucmVhZENoYXJTdHJpbmdzKGRhdGEsIGxlbklWKTsKICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgaWYgKHRva2VuID09PSAibm9hY2Nlc3MiKSB7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRva2VuID09PSAiLyIpIHsKICAgICAgICAgICAgICB0aGlzLnByZXZDaGFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hhcnN0cmluZ3MucHVzaCh7CiAgICAgICAgICAgICAgZ2x5cGgsCiAgICAgICAgICAgICAgZW5jb2RlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlN1YnJzIjoKICAgICAgICAgIHRoaXMucmVhZEludCgpOwogICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgd2hpbGUgKHRoaXMuZ2V0VG9rZW4oKSA9PT0gImR1cCIpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnJlYWRJbnQoKTsKICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgZGF0YSA9IGxlbmd0aCA+IDAgPyBzdHJlYW0uZ2V0Qnl0ZXMobGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KDApOwogICAgICAgICAgICBsZW5JViA9IHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YS5sZW5JVjsKICAgICAgICAgICAgY29uc3QgZW5jb2RlZCA9IHRoaXMucmVhZENoYXJTdHJpbmdzKGRhdGEsIGxlbklWKTsKICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgaWYgKHRva2VuID09PSAibm9hY2Nlc3MiKSB7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnJzW2luZGV4XSA9IGVuY29kZWQ7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCbHVlVmFsdWVzIjoKICAgICAgICBjYXNlICJPdGhlckJsdWVzIjoKICAgICAgICBjYXNlICJGYW1pbHlCbHVlcyI6CiAgICAgICAgY2FzZSAiRmFtaWx5T3RoZXJCbHVlcyI6CiAgICAgICAgICBjb25zdCBibHVlQXJyYXkgPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgaWYgKGJsdWVBcnJheS5sZW5ndGggPiAwICYmIGJsdWVBcnJheS5sZW5ndGggJSAyID09PSAwICYmIEhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gYmx1ZUFycmF5OwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiU3RlbVNuYXBIIjoKICAgICAgICBjYXNlICJTdGVtU25hcFYiOgogICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IHRoaXMucmVhZE51bWJlckFycmF5KCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTdGRIVyI6CiAgICAgICAgY2FzZSAiU3RkVlciOgogICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IHRoaXMucmVhZE51bWJlckFycmF5KClbMF07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCbHVlU2hpZnQiOgogICAgICAgIGNhc2UgImxlbklWIjoKICAgICAgICBjYXNlICJCbHVlRnV6eiI6CiAgICAgICAgY2FzZSAiQmx1ZVNjYWxlIjoKICAgICAgICBjYXNlICJMYW5ndWFnZUdyb3VwIjoKICAgICAgICAgIHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YVt0b2tlbl0gPSB0aGlzLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkV4cGFuc2lvbkZhY3RvciI6CiAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkTnVtYmVyKCkgfHwgMC4wNjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZvcmNlQm9sZCI6CiAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkQm9vbGVhbigpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgewogICAgICBlbmNvZGVkLAogICAgICBnbHlwaAogICAgfSBvZiBjaGFyc3RyaW5ncykgewogICAgICBjb25zdCBjaGFyU3RyaW5nID0gbmV3IFR5cGUxQ2hhclN0cmluZygpOwogICAgICBjb25zdCBlcnJvciA9IGNoYXJTdHJpbmcuY29udmVydChlbmNvZGVkLCBzdWJycywgdGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkKTsKICAgICAgbGV0IG91dHB1dCA9IGNoYXJTdHJpbmcub3V0cHV0OwogICAgICBpZiAoZXJyb3IpIHsKICAgICAgICBvdXRwdXQgPSBbMTRdOwogICAgICB9CiAgICAgIGNvbnN0IGNoYXJTdHJpbmdPYmplY3QgPSB7CiAgICAgICAgZ2x5cGhOYW1lOiBnbHlwaCwKICAgICAgICBjaGFyc3RyaW5nOiBvdXRwdXQsCiAgICAgICAgd2lkdGg6IGNoYXJTdHJpbmcud2lkdGgsCiAgICAgICAgbHNiOiBjaGFyU3RyaW5nLmxzYiwKICAgICAgICBzZWFjOiBjaGFyU3RyaW5nLnNlYWMKICAgICAgfTsKICAgICAgaWYgKGdseXBoID09PSAiLm5vdGRlZiIpIHsKICAgICAgICBwcm9ncmFtLmNoYXJzdHJpbmdzLnVuc2hpZnQoY2hhclN0cmluZ09iamVjdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvZ3JhbS5jaGFyc3RyaW5ncy5wdXNoKGNoYXJTdHJpbmdPYmplY3QpOwogICAgICB9CiAgICAgIGlmIChwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZykgewogICAgICAgIGNvbnN0IGluZGV4ID0gcHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcuaW5kZXhPZihnbHlwaCk7CiAgICAgICAgaWYgKGluZGV4ID4gLTEgJiYgcHJvcGVydGllcy53aWR0aHNbaW5kZXhdID09PSB1bmRlZmluZWQgJiYgaW5kZXggPj0gcHJvcGVydGllcy5maXJzdENoYXIgJiYgaW5kZXggPD0gcHJvcGVydGllcy5sYXN0Q2hhcikgewogICAgICAgICAgcHJvcGVydGllcy53aWR0aHNbaW5kZXhdID0gY2hhclN0cmluZy53aWR0aDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwcm9ncmFtOwogIH0KICBleHRyYWN0Rm9udEhlYWRlcihwcm9wZXJ0aWVzKSB7CiAgICBsZXQgdG9rZW47CiAgICB3aGlsZSAoKHRva2VuID0gdGhpcy5nZXRUb2tlbigpKSAhPT0gbnVsbCkgewogICAgICBpZiAodG9rZW4gIT09ICIvIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICBzd2l0Y2ggKHRva2VuKSB7CiAgICAgICAgY2FzZSAiRm9udE1hdHJpeCI6CiAgICAgICAgICBjb25zdCBtYXRyaXggPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgcHJvcGVydGllcy5mb250TWF0cml4ID0gbWF0cml4OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRW5jb2RpbmciOgogICAgICAgICAgY29uc3QgZW5jb2RpbmdBcmcgPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICBsZXQgZW5jb2Rpbmc7CiAgICAgICAgICBpZiAoIS9eXGQrJC8udGVzdChlbmNvZGluZ0FyZykpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBnZXRFbmNvZGluZyhlbmNvZGluZ0FyZyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbmNvZGluZyA9IFtdOwogICAgICAgICAgICBjb25zdCBzaXplID0gcGFyc2VJbnQoZW5jb2RpbmdBcmcsIDEwKSB8IDA7CiAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaXplOyBqKyspIHsKICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICB3aGlsZSAodG9rZW4gIT09ICJkdXAiICYmIHRva2VuICE9PSAiZGVmIikgewogICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodG9rZW4gPT09ICJkZWYiKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnJlYWRJbnQoKTsKICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgY29uc3QgZ2x5cGggPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgZW5jb2RpbmdbaW5kZXhdID0gZ2x5cGg7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZyA9IGVuY29kaW5nOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRm9udEJCb3giOgogICAgICAgICAgY29uc3QgZm9udEJCb3ggPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgcHJvcGVydGllcy5hc2NlbnQgPSBNYXRoLm1heChmb250QkJveFszXSwgZm9udEJCb3hbMV0pOwogICAgICAgICAgcHJvcGVydGllcy5kZXNjZW50ID0gTWF0aC5taW4oZm9udEJCb3hbMV0sIGZvbnRCQm94WzNdKTsKICAgICAgICAgIHByb3BlcnRpZXMuYXNjZW50U2NhbGVkID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS90eXBlMV9mb250LmpzCgoKCgoKCmZ1bmN0aW9uIGZpbmRCbG9jayhzdHJlYW1CeXRlcywgc2lnbmF0dXJlLCBzdGFydEluZGV4KSB7CiAgY29uc3Qgc3RyZWFtQnl0ZXNMZW5ndGggPSBzdHJlYW1CeXRlcy5sZW5ndGg7CiAgY29uc3Qgc2lnbmF0dXJlTGVuZ3RoID0gc2lnbmF0dXJlLmxlbmd0aDsKICBjb25zdCBzY2FuTGVuZ3RoID0gc3RyZWFtQnl0ZXNMZW5ndGggLSBzaWduYXR1cmVMZW5ndGg7CiAgbGV0IGkgPSBzdGFydEluZGV4LAogICAgZm91bmQgPSBmYWxzZTsKICB3aGlsZSAoaSA8IHNjYW5MZW5ndGgpIHsKICAgIGxldCBqID0gMDsKICAgIHdoaWxlIChqIDwgc2lnbmF0dXJlTGVuZ3RoICYmIHN0cmVhbUJ5dGVzW2kgKyBqXSA9PT0gc2lnbmF0dXJlW2pdKSB7CiAgICAgIGorKzsKICAgIH0KICAgIGlmIChqID49IHNpZ25hdHVyZUxlbmd0aCkgewogICAgICBpICs9IGo7CiAgICAgIHdoaWxlIChpIDwgc3RyZWFtQnl0ZXNMZW5ndGggJiYgaXNXaGl0ZVNwYWNlKHN0cmVhbUJ5dGVzW2ldKSkgewogICAgICAgIGkrKzsKICAgICAgfQogICAgICBmb3VuZCA9IHRydWU7CiAgICAgIGJyZWFrOwogICAgfQogICAgaSsrOwogIH0KICByZXR1cm4gewogICAgZm91bmQsCiAgICBsZW5ndGg6IGkKICB9Owp9CmZ1bmN0aW9uIGdldEhlYWRlckJsb2NrKHN0cmVhbSwgc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgY29uc3QgRUVYRUNfU0lHTkFUVVJFID0gWzB4NjUsIDB4NjUsIDB4NzgsIDB4NjUsIDB4NjNdOwogIGNvbnN0IHN0cmVhbVN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICBsZXQgaGVhZGVyQnl0ZXMsIGhlYWRlckJ5dGVzTGVuZ3RoLCBibG9jazsKICB0cnkgewogICAgaGVhZGVyQnl0ZXMgPSBzdHJlYW0uZ2V0Qnl0ZXMoc3VnZ2VzdGVkTGVuZ3RoKTsKICAgIGhlYWRlckJ5dGVzTGVuZ3RoID0gaGVhZGVyQnl0ZXMubGVuZ3RoOwogIH0gY2F0Y2gge30KICBpZiAoaGVhZGVyQnl0ZXNMZW5ndGggPT09IHN1Z2dlc3RlZExlbmd0aCkgewogICAgYmxvY2sgPSBmaW5kQmxvY2soaGVhZGVyQnl0ZXMsIEVFWEVDX1NJR05BVFVSRSwgc3VnZ2VzdGVkTGVuZ3RoIC0gMiAqIEVFWEVDX1NJR05BVFVSRS5sZW5ndGgpOwogICAgaWYgKGJsb2NrLmZvdW5kICYmIGJsb2NrLmxlbmd0aCA9PT0gc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3RyZWFtOiBuZXcgU3RyZWFtKGhlYWRlckJ5dGVzKSwKICAgICAgICBsZW5ndGg6IHN1Z2dlc3RlZExlbmd0aAogICAgICB9OwogICAgfQogIH0KICB3YXJuKCdJbnZhbGlkICJMZW5ndGgxIiBwcm9wZXJ0eSBpbiBUeXBlMSBmb250IC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogIHN0cmVhbS5wb3MgPSBzdHJlYW1TdGFydFBvczsKICBjb25zdCBTQ0FOX0JMT0NLX0xFTkdUSCA9IDIwNDg7CiAgbGV0IGFjdHVhbExlbmd0aDsKICB3aGlsZSAodHJ1ZSkgewogICAgY29uc3Qgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhTQ0FOX0JMT0NLX0xFTkdUSCk7CiAgICBibG9jayA9IGZpbmRCbG9jayhzY2FuQnl0ZXMsIEVFWEVDX1NJR05BVFVSRSwgMCk7CiAgICBpZiAoYmxvY2subGVuZ3RoID09PSAwKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgc3RyZWFtLnBvcyArPSBibG9jay5sZW5ndGg7CiAgICBpZiAoYmxvY2suZm91bmQpIHsKICAgICAgYWN0dWFsTGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0cmVhbVN0YXJ0UG9zOwogICAgICBicmVhazsKICAgIH0KICB9CiAgc3RyZWFtLnBvcyA9IHN0cmVhbVN0YXJ0UG9zOwogIGlmIChhY3R1YWxMZW5ndGgpIHsKICAgIHJldHVybiB7CiAgICAgIHN0cmVhbTogbmV3IFN0cmVhbShzdHJlYW0uZ2V0Qnl0ZXMoYWN0dWFsTGVuZ3RoKSksCiAgICAgIGxlbmd0aDogYWN0dWFsTGVuZ3RoCiAgICB9OwogIH0KICB3YXJuKCdVbmFibGUgdG8gcmVjb3ZlciAiTGVuZ3RoMSIgcHJvcGVydHkgaW4gVHlwZTEgZm9udCAtLSB1c2luZyBhcyBpcy4nKTsKICByZXR1cm4gewogICAgc3RyZWFtOiBuZXcgU3RyZWFtKHN0cmVhbS5nZXRCeXRlcyhzdWdnZXN0ZWRMZW5ndGgpKSwKICAgIGxlbmd0aDogc3VnZ2VzdGVkTGVuZ3RoCiAgfTsKfQpmdW5jdGlvbiBnZXRFZXhlY0Jsb2NrKHN0cmVhbSwgc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgY29uc3QgZWV4ZWNCeXRlcyA9IHN0cmVhbS5nZXRCeXRlcygpOwogIGlmIChlZXhlY0J5dGVzLmxlbmd0aCA9PT0gMCkgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJnZXRFZXhlY0Jsb2NrIC0gbm8gZm9udCBwcm9ncmFtIGZvdW5kLiIpOwogIH0KICByZXR1cm4gewogICAgc3RyZWFtOiBuZXcgU3RyZWFtKGVleGVjQnl0ZXMpLAogICAgbGVuZ3RoOiBlZXhlY0J5dGVzLmxlbmd0aAogIH07Cn0KY2xhc3MgVHlwZTFGb250IHsKICBjb25zdHJ1Y3RvcihuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCBQRkJfSEVBREVSX1NJWkUgPSA2OwogICAgbGV0IGhlYWRlckJsb2NrTGVuZ3RoID0gcHJvcGVydGllcy5sZW5ndGgxOwogICAgbGV0IGVleGVjQmxvY2tMZW5ndGggPSBwcm9wZXJ0aWVzLmxlbmd0aDI7CiAgICBsZXQgcGZiSGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoUEZCX0hFQURFUl9TSVpFKTsKICAgIGNvbnN0IHBmYkhlYWRlclByZXNlbnQgPSBwZmJIZWFkZXJbMF0gPT09IDB4ODAgJiYgcGZiSGVhZGVyWzFdID09PSAweDAxOwogICAgaWYgKHBmYkhlYWRlclByZXNlbnQpIHsKICAgICAgZmlsZS5za2lwKFBGQl9IRUFERVJfU0laRSk7CiAgICAgIGhlYWRlckJsb2NrTGVuZ3RoID0gcGZiSGVhZGVyWzVdIDw8IDI0IHwgcGZiSGVhZGVyWzRdIDw8IDE2IHwgcGZiSGVhZGVyWzNdIDw8IDggfCBwZmJIZWFkZXJbMl07CiAgICB9CiAgICBjb25zdCBoZWFkZXJCbG9jayA9IGdldEhlYWRlckJsb2NrKGZpbGUsIGhlYWRlckJsb2NrTGVuZ3RoKTsKICAgIGNvbnN0IGhlYWRlckJsb2NrUGFyc2VyID0gbmV3IFR5cGUxUGFyc2VyKGhlYWRlckJsb2NrLnN0cmVhbSwgZmFsc2UsIFNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICBoZWFkZXJCbG9ja1BhcnNlci5leHRyYWN0Rm9udEhlYWRlcihwcm9wZXJ0aWVzKTsKICAgIGlmIChwZmJIZWFkZXJQcmVzZW50KSB7CiAgICAgIHBmYkhlYWRlciA9IGZpbGUuZ2V0Qnl0ZXMoUEZCX0hFQURFUl9TSVpFKTsKICAgICAgZWV4ZWNCbG9ja0xlbmd0aCA9IHBmYkhlYWRlcls1XSA8PCAyNCB8IHBmYkhlYWRlcls0XSA8PCAxNiB8IHBmYkhlYWRlclszXSA8PCA4IHwgcGZiSGVhZGVyWzJdOwogICAgfQogICAgY29uc3QgZWV4ZWNCbG9jayA9IGdldEVleGVjQmxvY2soZmlsZSwgZWV4ZWNCbG9ja0xlbmd0aCk7CiAgICBjb25zdCBlZXhlY0Jsb2NrUGFyc2VyID0gbmV3IFR5cGUxUGFyc2VyKGVleGVjQmxvY2suc3RyZWFtLCB0cnVlLCBTRUFDX0FOQUxZU0lTX0VOQUJMRUQpOwogICAgY29uc3QgZGF0YSA9IGVleGVjQmxvY2tQYXJzZXIuZXh0cmFjdEZvbnRQcm9ncmFtKHByb3BlcnRpZXMpOwogICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YS5wcm9wZXJ0aWVzKSB7CiAgICAgIHByb3BlcnRpZXNba2V5XSA9IGRhdGEucHJvcGVydGllc1trZXldOwogICAgfQogICAgY29uc3QgY2hhcnN0cmluZ3MgPSBkYXRhLmNoYXJzdHJpbmdzOwogICAgY29uc3QgdHlwZTJDaGFyc3RyaW5ncyA9IHRoaXMuZ2V0VHlwZTJDaGFyc3RyaW5ncyhjaGFyc3RyaW5ncyk7CiAgICBjb25zdCBzdWJycyA9IHRoaXMuZ2V0VHlwZTJTdWJycyhkYXRhLnN1YnJzKTsKICAgIHRoaXMuY2hhcnN0cmluZ3MgPSBjaGFyc3RyaW5nczsKICAgIHRoaXMuZGF0YSA9IHRoaXMud3JhcChuYW1lLCB0eXBlMkNoYXJzdHJpbmdzLCB0aGlzLmNoYXJzdHJpbmdzLCBzdWJycywgcHJvcGVydGllcyk7CiAgICB0aGlzLnNlYWNzID0gdGhpcy5nZXRTZWFjcyhkYXRhLmNoYXJzdHJpbmdzKTsKICB9CiAgZ2V0IG51bUdseXBocygpIHsKICAgIHJldHVybiB0aGlzLmNoYXJzdHJpbmdzLmxlbmd0aCArIDE7CiAgfQogIGdldENoYXJzZXQoKSB7CiAgICBjb25zdCBjaGFyc2V0ID0gWyIubm90ZGVmIl07CiAgICBmb3IgKGNvbnN0IHsKICAgICAgZ2x5cGhOYW1lCiAgICB9IG9mIHRoaXMuY2hhcnN0cmluZ3MpIHsKICAgICAgY2hhcnNldC5wdXNoKGdseXBoTmFtZSk7CiAgICB9CiAgICByZXR1cm4gY2hhcnNldDsKICB9CiAgZ2V0R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IGNoYXJzdHJpbmdzID0gdGhpcy5jaGFyc3RyaW5nczsKICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICBjb25zdCBjaGFyQ29kZVRvR2x5cGhJZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGZvciAobGV0IGdseXBoSWQgPSAwLCBjaGFyc3RyaW5nc0xlbiA9IGNoYXJzdHJpbmdzLmxlbmd0aDsgZ2x5cGhJZCA8IGNoYXJzdHJpbmdzTGVuOyBnbHlwaElkKyspIHsKICAgICAgICBjb25zdCBjaGFyQ29kZSA9IHByb3BlcnRpZXMuY01hcC5jaGFyQ29kZU9mKGdseXBoSWQpOwogICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgKyAxOwogICAgICB9CiAgICAgIHJldHVybiBjaGFyQ29kZVRvR2x5cGhJZDsKICAgIH0KICAgIGNvbnN0IGdseXBoTmFtZXMgPSBbIi5ub3RkZWYiXTsKICAgIGxldCBidWlsdEluRW5jb2RpbmcsIGdseXBoSWQ7CiAgICBmb3IgKGdseXBoSWQgPSAwOyBnbHlwaElkIDwgY2hhcnN0cmluZ3MubGVuZ3RoOyBnbHlwaElkKyspIHsKICAgICAgZ2x5cGhOYW1lcy5wdXNoKGNoYXJzdHJpbmdzW2dseXBoSWRdLmdseXBoTmFtZSk7CiAgICB9CiAgICBjb25zdCBlbmNvZGluZyA9IHByb3BlcnRpZXMuYnVpbHRJbkVuY29kaW5nOwogICAgaWYgKGVuY29kaW5nKSB7CiAgICAgIGJ1aWx0SW5FbmNvZGluZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gZW5jb2RpbmcpIHsKICAgICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKGVuY29kaW5nW2NoYXJDb2RlXSk7CiAgICAgICAgaWYgKGdseXBoSWQgPj0gMCkgewogICAgICAgICAgYnVpbHRJbkVuY29kaW5nW2NoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHlwZTFGb250R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMsIGJ1aWx0SW5FbmNvZGluZywgZ2x5cGhOYW1lcyk7CiAgfQogIGhhc0dseXBoSWQoaWQpIHsKICAgIGlmIChpZCA8IDAgfHwgaWQgPj0gdGhpcy5udW1HbHlwaHMpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKGlkID09PSAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgY29uc3QgZ2x5cGggPSB0aGlzLmNoYXJzdHJpbmdzW2lkIC0gMV07CiAgICByZXR1cm4gZ2x5cGguY2hhcnN0cmluZy5sZW5ndGggPiAwOwogIH0KICBnZXRTZWFjcyhjaGFyc3RyaW5ncykgewogICAgY29uc3Qgc2VhY01hcCA9IFtdOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY2hhcnN0cmluZ3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBjaGFyc3RyaW5nID0gY2hhcnN0cmluZ3NbaV07CiAgICAgIGlmIChjaGFyc3RyaW5nLnNlYWMpIHsKICAgICAgICBzZWFjTWFwW2kgKyAxXSA9IGNoYXJzdHJpbmcuc2VhYzsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNlYWNNYXA7CiAgfQogIGdldFR5cGUyQ2hhcnN0cmluZ3ModHlwZTFDaGFyc3RyaW5ncykgewogICAgY29uc3QgdHlwZTJDaGFyc3RyaW5ncyA9IFtdOwogICAgZm9yIChjb25zdCB0eXBlMUNoYXJzdHJpbmcgb2YgdHlwZTFDaGFyc3RyaW5ncykgewogICAgICB0eXBlMkNoYXJzdHJpbmdzLnB1c2godHlwZTFDaGFyc3RyaW5nLmNoYXJzdHJpbmcpOwogICAgfQogICAgcmV0dXJuIHR5cGUyQ2hhcnN0cmluZ3M7CiAgfQogIGdldFR5cGUyU3VicnModHlwZTFTdWJycykgewogICAgbGV0IGJpYXMgPSAwOwogICAgY29uc3QgY291bnQgPSB0eXBlMVN1YnJzLmxlbmd0aDsKICAgIGlmIChjb3VudCA8IDExMzMpIHsKICAgICAgYmlhcyA9IDEwNzsKICAgIH0gZWxzZSBpZiAoY291bnQgPCAzMzc2OSkgewogICAgICBiaWFzID0gMTEzMTsKICAgIH0gZWxzZSB7CiAgICAgIGJpYXMgPSAzMjc2ODsKICAgIH0KICAgIGNvbnN0IHR5cGUyU3VicnMgPSBbXTsKICAgIGxldCBpOwogICAgZm9yIChpID0gMDsgaSA8IGJpYXM7IGkrKykgewogICAgICB0eXBlMlN1YnJzLnB1c2goWzB4MGJdKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIHR5cGUyU3VicnMucHVzaCh0eXBlMVN1YnJzW2ldKTsKICAgIH0KICAgIHJldHVybiB0eXBlMlN1YnJzOwogIH0KICB3cmFwKG5hbWUsIGdseXBocywgY2hhcnN0cmluZ3MsIHN1YnJzLCBwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCBjZmYgPSBuZXcgQ0ZGKCk7CiAgICBjZmYuaGVhZGVyID0gbmV3IENGRkhlYWRlcigxLCAwLCA0LCA0KTsKICAgIGNmZi5uYW1lcyA9IFtuYW1lXTsKICAgIGNvbnN0IHRvcERpY3QgPSBuZXcgQ0ZGVG9wRGljdCgpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoInZlcnNpb24iLCAzOTEpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIk5vdGljZSIsIDM5Mik7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiRnVsbE5hbWUiLCAzOTMpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIkZhbWlseU5hbWUiLCAzOTQpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIldlaWdodCIsIDM5NSk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiRW5jb2RpbmciLCBudWxsKTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJGb250TWF0cml4IiwgcHJvcGVydGllcy5mb250TWF0cml4KTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJGb250QkJveCIsIHByb3BlcnRpZXMuYmJveCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiY2hhcnNldCIsIG51bGwpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIkNoYXJTdHJpbmdzIiwgbnVsbCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiUHJpdmF0ZSIsIG51bGwpOwogICAgY2ZmLnRvcERpY3QgPSB0b3BEaWN0OwogICAgY29uc3Qgc3RyaW5ncyA9IG5ldyBDRkZTdHJpbmdzKCk7CiAgICBzdHJpbmdzLmFkZCgiVmVyc2lvbiAwLjExIik7CiAgICBzdHJpbmdzLmFkZCgiU2VlIG9yaWdpbmFsIG5vdGljZSIpOwogICAgc3RyaW5ncy5hZGQobmFtZSk7CiAgICBzdHJpbmdzLmFkZChuYW1lKTsKICAgIHN0cmluZ3MuYWRkKCJNZWRpdW0iKTsKICAgIGNmZi5zdHJpbmdzID0gc3RyaW5nczsKICAgIGNmZi5nbG9iYWxTdWJySW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGNvbnN0IGNvdW50ID0gZ2x5cGhzLmxlbmd0aDsKICAgIGNvbnN0IGNoYXJzZXRBcnJheSA9IFsiLm5vdGRlZiJdOwogICAgbGV0IGksIGlpOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgY29uc3QgZ2x5cGhOYW1lID0gY2hhcnN0cmluZ3NbaV0uZ2x5cGhOYW1lOwogICAgICBjb25zdCBpbmRleCA9IENGRlN0YW5kYXJkU3RyaW5ncy5pbmRleE9mKGdseXBoTmFtZSk7CiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICBzdHJpbmdzLmFkZChnbHlwaE5hbWUpOwogICAgICB9CiAgICAgIGNoYXJzZXRBcnJheS5wdXNoKGdseXBoTmFtZSk7CiAgICB9CiAgICBjZmYuY2hhcnNldCA9IG5ldyBDRkZDaGFyc2V0KGZhbHNlLCAwLCBjaGFyc2V0QXJyYXkpOwogICAgY29uc3QgY2hhclN0cmluZ3NJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgY2hhclN0cmluZ3NJbmRleC5hZGQoWzB4OGIsIDB4MGVdKTsKICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIGNoYXJTdHJpbmdzSW5kZXguYWRkKGdseXBoc1tpXSk7CiAgICB9CiAgICBjZmYuY2hhclN0cmluZ3MgPSBjaGFyU3RyaW5nc0luZGV4OwogICAgY29uc3QgcHJpdmF0ZURpY3QgPSBuZXcgQ0ZGUHJpdmF0ZURpY3QoKTsKICAgIHByaXZhdGVEaWN0LnNldEJ5TmFtZSgiU3VicnMiLCBudWxsKTsKICAgIGNvbnN0IGZpZWxkcyA9IFsiQmx1ZVZhbHVlcyIsICJPdGhlckJsdWVzIiwgIkZhbWlseUJsdWVzIiwgIkZhbWlseU90aGVyQmx1ZXMiLCAiU3RlbVNuYXBIIiwgIlN0ZW1TbmFwViIsICJCbHVlU2hpZnQiLCAiQmx1ZUZ1enoiLCAiQmx1ZVNjYWxlIiwgIkxhbmd1YWdlR3JvdXAiLCAiRXhwYW5zaW9uRmFjdG9yIiwgIkZvcmNlQm9sZCIsICJTdGRIVyIsICJTdGRWVyJdOwogICAgZm9yIChpID0gMCwgaWkgPSBmaWVsZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBmaWVsZCA9IGZpZWxkc1tpXTsKICAgICAgaWYgKCEoZmllbGQgaW4gcHJvcGVydGllcy5wcml2YXRlRGF0YSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IHByb3BlcnRpZXMucHJpdmF0ZURhdGFbZmllbGRdOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICBmb3IgKGxldCBqID0gdmFsdWUubGVuZ3RoIC0gMTsgaiA+IDA7IGotLSkgewogICAgICAgICAgdmFsdWVbal0gLT0gdmFsdWVbaiAtIDFdOwogICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRlRGljdC5zZXRCeU5hbWUoZmllbGQsIHZhbHVlKTsKICAgIH0KICAgIGNmZi50b3BEaWN0LnByaXZhdGVEaWN0ID0gcHJpdmF0ZURpY3Q7CiAgICBjb25zdCBzdWJySW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAoaSA9IDAsIGlpID0gc3VicnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBzdWJySW5kZXguYWRkKHN1YnJzW2ldKTsKICAgIH0KICAgIHByaXZhdGVEaWN0LnN1YnJzSW5kZXggPSBzdWJySW5kZXg7CiAgICBjb25zdCBjb21waWxlciA9IG5ldyBDRkZDb21waWxlcihjZmYpOwogICAgcmV0dXJuIGNvbXBpbGVyLmNvbXBpbGUoKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ZvbnRzLmpzCgoKCgoKCgoKCgoKCgoKCgpjb25zdCBQUklWQVRFX1VTRV9BUkVBUyA9IFtbMHhlMDAwLCAweGY4ZmZdLCBbMHgxMDAwMDAsIDB4MTBmZmZkXV07CmNvbnN0IFBERl9HTFlQSF9TUEFDRV9VTklUUyA9IDEwMDA7CmNvbnN0IEVYUE9SVF9EQVRBX1BST1BFUlRJRVMgPSBbImFzY2VudCIsICJiYm94IiwgImJsYWNrIiwgImJvbGQiLCAiY2hhclByb2NPcGVyYXRvckxpc3QiLCAiY3NzRm9udEluZm8iLCAiZGF0YSIsICJkZWZhdWx0Vk1ldHJpY3MiLCAiZGVmYXVsdFdpZHRoIiwgImRlc2NlbnQiLCAiZGlzYWJsZUZvbnRGYWNlIiwgImZhbGxiYWNrTmFtZSIsICJmb250RXh0cmFQcm9wZXJ0aWVzIiwgImZvbnRNYXRyaXgiLCAiaXNJbnZhbGlkUERGanNGb250IiwgImlzVHlwZTNGb250IiwgIml0YWxpYyIsICJsb2FkZWROYW1lIiwgIm1pbWV0eXBlIiwgIm1pc3NpbmdGaWxlIiwgIm5hbWUiLCAicmVtZWFzdXJlIiwgInN5c3RlbUZvbnRJbmZvIiwgInZlcnRpY2FsIl07CmNvbnN0IEVYUE9SVF9EQVRBX0VYVFJBX1BST1BFUlRJRVMgPSBbImNNYXAiLCAiY29tcG9zaXRlIiwgImRlZmF1bHRFbmNvZGluZyIsICJkaWZmZXJlbmNlcyIsICJpc01vbm9zcGFjZSIsICJpc1NlcmlmRm9udCIsICJpc1N5bWJvbGljRm9udCIsICJzZWFjTWFwIiwgInN1YnR5cGUiLCAidG9Gb250Q2hhciIsICJ0b1VuaWNvZGUiLCAidHlwZSIsICJ2bWV0cmljcyIsICJ3aWR0aHMiXTsKZnVuY3Rpb24gYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpIHsKICBpZiAoIXByb3BlcnRpZXMuZm9udE1hdHJpeCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5mb250TWF0cml4WzBdID09PSBGT05UX0lERU5USVRZX01BVFJJWFswXSkgewogICAgcmV0dXJuOwogIH0KICBjb25zdCBzY2FsZSA9IDAuMDAxIC8gcHJvcGVydGllcy5mb250TWF0cml4WzBdOwogIGNvbnN0IGdseXBoc1dpZHRocyA9IHByb3BlcnRpZXMud2lkdGhzOwogIGZvciAoY29uc3QgZ2x5cGggaW4gZ2x5cGhzV2lkdGhzKSB7CiAgICBnbHlwaHNXaWR0aHNbZ2x5cGhdICo9IHNjYWxlOwogIH0KICBwcm9wZXJ0aWVzLmRlZmF1bHRXaWR0aCAqPSBzY2FsZTsKfQpmdW5jdGlvbiBhZGp1c3RUcnVlVHlwZVRvVW5pY29kZShwcm9wZXJ0aWVzLCBpc1N5bWJvbGljRm9udCwgbmFtZVJlY29yZHMpIHsKICBpZiAocHJvcGVydGllcy5pc0ludGVybmFsRm9udCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5oYXNFbmNvZGluZykgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCkgewogICAgcmV0dXJuOwogIH0KICBpZiAoIWlzU3ltYm9saWNGb250KSB7CiAgICByZXR1cm47CiAgfQogIGlmIChuYW1lUmVjb3Jkcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nID09PSBXaW5BbnNpRW5jb2RpbmcpIHsKICAgIHJldHVybjsKICB9CiAgZm9yIChjb25zdCByIG9mIG5hbWVSZWNvcmRzKSB7CiAgICBpZiAoIWlzV2luTmFtZVJlY29yZChyKSkgewogICAgICByZXR1cm47CiAgICB9CiAgfQogIGNvbnN0IGVuY29kaW5nID0gV2luQW5zaUVuY29kaW5nOwogIGNvbnN0IHRvVW5pY29kZSA9IFtdLAogICAgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGVuY29kaW5nKSB7CiAgICBjb25zdCBnbHlwaE5hbWUgPSBlbmNvZGluZ1tjaGFyQ29kZV07CiAgICBpZiAoZ2x5cGhOYW1lID09PSAiIikgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IHVuaWNvZGUgPSBnbHlwaHNVbmljb2RlTWFwW2dseXBoTmFtZV07CiAgICBpZiAodW5pY29kZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgdG9Vbmljb2RlW2NoYXJDb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgfQogIGlmICh0b1VuaWNvZGUubGVuZ3RoID4gMCkgewogICAgcHJvcGVydGllcy50b1VuaWNvZGUuYW1lbmQodG9Vbmljb2RlKTsKICB9Cn0KZnVuY3Rpb24gYWRqdXN0VHlwZTFUb1VuaWNvZGUocHJvcGVydGllcywgYnVpbHRJbkVuY29kaW5nKSB7CiAgaWYgKHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgaWYgKGJ1aWx0SW5FbmNvZGluZyA9PT0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgdG9Vbmljb2RlID0gW10sCiAgICBnbHlwaHNVbmljb2RlTWFwID0gZ2V0R2x5cGhzVW5pY29kZSgpOwogIGZvciAoY29uc3QgY2hhckNvZGUgaW4gYnVpbHRJbkVuY29kaW5nKSB7CiAgICBpZiAocHJvcGVydGllcy5oYXNFbmNvZGluZykgewogICAgICBpZiAocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lIHx8IHByb3BlcnRpZXMuZGlmZmVyZW5jZXNbY2hhckNvZGVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQogICAgY29uc3QgZ2x5cGhOYW1lID0gYnVpbHRJbkVuY29kaW5nW2NoYXJDb2RlXTsKICAgIGNvbnN0IHVuaWNvZGUgPSBnZXRVbmljb2RlRm9yR2x5cGgoZ2x5cGhOYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgIGlmICh1bmljb2RlICE9PSAtMSkgewogICAgICB0b1VuaWNvZGVbY2hhckNvZGVdID0gU3RyaW5nLmZyb21DaGFyQ29kZSh1bmljb2RlKTsKICAgIH0KICB9CiAgaWYgKHRvVW5pY29kZS5sZW5ndGggPiAwKSB7CiAgICBwcm9wZXJ0aWVzLnRvVW5pY29kZS5hbWVuZCh0b1VuaWNvZGUpOwogIH0KfQpmdW5jdGlvbiBhbWVuZEZhbGxiYWNrVG9Vbmljb2RlKHByb3BlcnRpZXMpIHsKICBpZiAoIXByb3BlcnRpZXMuZmFsbGJhY2tUb1VuaWNvZGUpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgdG9Vbmljb2RlID0gW107CiAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBwcm9wZXJ0aWVzLmZhbGxiYWNrVG9Vbmljb2RlKSB7CiAgICBpZiAocHJvcGVydGllcy50b1VuaWNvZGUuaGFzKGNoYXJDb2RlKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIHRvVW5pY29kZVtjaGFyQ29kZV0gPSBwcm9wZXJ0aWVzLmZhbGxiYWNrVG9Vbmljb2RlW2NoYXJDb2RlXTsKICB9CiAgaWYgKHRvVW5pY29kZS5sZW5ndGggPiAwKSB7CiAgICBwcm9wZXJ0aWVzLnRvVW5pY29kZS5hbWVuZCh0b1VuaWNvZGUpOwogIH0KfQpjbGFzcyBmb250c19HbHlwaCB7CiAgY29uc3RydWN0b3Iob3JpZ2luYWxDaGFyQ29kZSwgZm9udENoYXIsIHVuaWNvZGUsIGFjY2VudCwgd2lkdGgsIHZtZXRyaWMsIG9wZXJhdG9yTGlzdElkLCBpc1NwYWNlLCBpc0luRm9udCkgewogICAgdGhpcy5vcmlnaW5hbENoYXJDb2RlID0gb3JpZ2luYWxDaGFyQ29kZTsKICAgIHRoaXMuZm9udENoYXIgPSBmb250Q2hhcjsKICAgIHRoaXMudW5pY29kZSA9IHVuaWNvZGU7CiAgICB0aGlzLmFjY2VudCA9IGFjY2VudDsKICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICAgIHRoaXMudm1ldHJpYyA9IHZtZXRyaWM7CiAgICB0aGlzLm9wZXJhdG9yTGlzdElkID0gb3BlcmF0b3JMaXN0SWQ7CiAgICB0aGlzLmlzU3BhY2UgPSBpc1NwYWNlOwogICAgdGhpcy5pc0luRm9udCA9IGlzSW5Gb250OwogIH0KICBnZXQgY2F0ZWdvcnkoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjYXRlZ29yeSIsIGdldENoYXJVbmljb2RlQ2F0ZWdvcnkodGhpcy51bmljb2RlKSwgdHJ1ZSk7CiAgfQp9CmZ1bmN0aW9uIGludDE2KGIwLCBiMSkgewogIHJldHVybiAoYjAgPDwgOCkgKyBiMTsKfQpmdW5jdGlvbiB3cml0ZVNpZ25lZEludDE2KGJ5dGVzLCBpbmRleCwgdmFsdWUpIHsKICBieXRlc1tpbmRleCArIDFdID0gdmFsdWU7CiAgYnl0ZXNbaW5kZXhdID0gdmFsdWUgPj4+IDg7Cn0KZnVuY3Rpb24gc2lnbmVkSW50MTYoYjAsIGIxKSB7CiAgY29uc3QgdmFsdWUgPSAoYjAgPDwgOCkgKyBiMTsKICByZXR1cm4gdmFsdWUgJiAxIDw8IDE1ID8gdmFsdWUgLSAweDEwMDAwIDogdmFsdWU7Cn0KZnVuY3Rpb24gd3JpdGVVaW50MzIoYnl0ZXMsIGluZGV4LCB2YWx1ZSkgewogIGJ5dGVzW2luZGV4ICsgM10gPSB2YWx1ZSAmIDB4ZmY7CiAgYnl0ZXNbaW5kZXggKyAyXSA9IHZhbHVlID4+PiA4OwogIGJ5dGVzW2luZGV4ICsgMV0gPSB2YWx1ZSA+Pj4gMTY7CiAgYnl0ZXNbaW5kZXhdID0gdmFsdWUgPj4+IDI0Owp9CmZ1bmN0aW9uIGludDMyKGIwLCBiMSwgYjIsIGIzKSB7CiAgcmV0dXJuIChiMCA8PCAyNCkgKyAoYjEgPDwgMTYpICsgKGIyIDw8IDgpICsgYjM7Cn0KZnVuY3Rpb24gc3RyaW5nMTYodmFsdWUpIHsKICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKfQpmdW5jdGlvbiBzYWZlU3RyaW5nMTYodmFsdWUpIHsKICBpZiAodmFsdWUgPiAweDdmZmYpIHsKICAgIHZhbHVlID0gMHg3ZmZmOwogIH0gZWxzZSBpZiAodmFsdWUgPCAtMHg4MDAwKSB7CiAgICB2YWx1ZSA9IC0weDgwMDA7CiAgfQogIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwp9CmZ1bmN0aW9uIGlzVHJ1ZVR5cGVGaWxlKGZpbGUpIHsKICBjb25zdCBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKICByZXR1cm4gcmVhZFVpbnQzMihoZWFkZXIsIDApID09PSAweDAwMDEwMDAwIHx8IGJ5dGVzVG9TdHJpbmcoaGVhZGVyKSA9PT0gInRydWUiOwp9CmZ1bmN0aW9uIGlzVHJ1ZVR5cGVDb2xsZWN0aW9uRmlsZShmaWxlKSB7CiAgY29uc3QgaGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoNCk7CiAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoaGVhZGVyKSA9PT0gInR0Y2YiOwp9CmZ1bmN0aW9uIGlzT3BlblR5cGVGaWxlKGZpbGUpIHsKICBjb25zdCBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKICByZXR1cm4gYnl0ZXNUb1N0cmluZyhoZWFkZXIpID09PSAiT1RUTyI7Cn0KZnVuY3Rpb24gaXNUeXBlMUZpbGUoZmlsZSkgewogIGNvbnN0IGhlYWRlciA9IGZpbGUucGVla0J5dGVzKDIpOwogIGlmIChoZWFkZXJbMF0gPT09IDB4MjUgJiYgaGVhZGVyWzFdID09PSAweDIxKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgaWYgKGhlYWRlclswXSA9PT0gMHg4MCAmJiBoZWFkZXJbMV0gPT09IDB4MDEpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICByZXR1cm4gZmFsc2U7Cn0KZnVuY3Rpb24gaXNDRkZGaWxlKGZpbGUpIHsKICBjb25zdCBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKICBpZiAoaGVhZGVyWzBdID49IDEgJiYgaGVhZGVyWzNdID49IDEgJiYgaGVhZGVyWzNdIDw9IDQpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICByZXR1cm4gZmFsc2U7Cn0KZnVuY3Rpb24gZ2V0Rm9udEZpbGVUeXBlKGZpbGUsIHsKICB0eXBlLAogIHN1YnR5cGUsCiAgY29tcG9zaXRlCn0pIHsKICBsZXQgZmlsZVR5cGUsIGZpbGVTdWJ0eXBlOwogIGlmIChpc1RydWVUeXBlRmlsZShmaWxlKSB8fCBpc1RydWVUeXBlQ29sbGVjdGlvbkZpbGUoZmlsZSkpIHsKICAgIGZpbGVUeXBlID0gY29tcG9zaXRlID8gIkNJREZvbnRUeXBlMiIgOiAiVHJ1ZVR5cGUiOwogIH0gZWxzZSBpZiAoaXNPcGVuVHlwZUZpbGUoZmlsZSkpIHsKICAgIGZpbGVUeXBlID0gY29tcG9zaXRlID8gIkNJREZvbnRUeXBlMiIgOiAiT3BlblR5cGUiOwogIH0gZWxzZSBpZiAoaXNUeXBlMUZpbGUoZmlsZSkpIHsKICAgIGlmIChjb21wb3NpdGUpIHsKICAgICAgZmlsZVR5cGUgPSAiQ0lERm9udFR5cGUwIjsKICAgIH0gZWxzZSB7CiAgICAgIGZpbGVUeXBlID0gdHlwZSA9PT0gIk1NVHlwZTEiID8gIk1NVHlwZTEiIDogIlR5cGUxIjsKICAgIH0KICB9IGVsc2UgaWYgKGlzQ0ZGRmlsZShmaWxlKSkgewogICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICBmaWxlVHlwZSA9ICJDSURGb250VHlwZTAiOwogICAgICBmaWxlU3VidHlwZSA9ICJDSURGb250VHlwZTBDIjsKICAgIH0gZWxzZSB7CiAgICAgIGZpbGVUeXBlID0gdHlwZSA9PT0gIk1NVHlwZTEiID8gIk1NVHlwZTEiIDogIlR5cGUxIjsKICAgICAgZmlsZVN1YnR5cGUgPSAiVHlwZTFDIjsKICAgIH0KICB9IGVsc2UgewogICAgd2FybigiZ2V0Rm9udEZpbGVUeXBlOiBVbmFibGUgdG8gZGV0ZWN0IGNvcnJlY3QgZm9udCBmaWxlIFR5cGUvU3VidHlwZS4iKTsKICAgIGZpbGVUeXBlID0gdHlwZTsKICAgIGZpbGVTdWJ0eXBlID0gc3VidHlwZTsKICB9CiAgcmV0dXJuIFtmaWxlVHlwZSwgZmlsZVN1YnR5cGVdOwp9CmZ1bmN0aW9uIGFwcGx5U3RhbmRhcmRGb250R2x5cGhNYXAobWFwLCBnbHlwaE1hcCkgewogIGZvciAoY29uc3QgY2hhckNvZGUgaW4gZ2x5cGhNYXApIHsKICAgIG1hcFsrY2hhckNvZGVdID0gZ2x5cGhNYXBbY2hhckNvZGVdOwogIH0KfQpmdW5jdGlvbiBidWlsZFRvRm9udENoYXIoZW5jb2RpbmcsIGdseXBoc1VuaWNvZGVNYXAsIGRpZmZlcmVuY2VzKSB7CiAgY29uc3QgdG9Gb250Q2hhciA9IFtdOwogIGxldCB1bmljb2RlOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IGVuY29kaW5nLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIHVuaWNvZGUgPSBnZXRVbmljb2RlRm9yR2x5cGgoZW5jb2RpbmdbaV0sIGdseXBoc1VuaWNvZGVNYXApOwogICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgIHRvRm9udENoYXJbaV0gPSB1bmljb2RlOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGRpZmZlcmVuY2VzKSB7CiAgICB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKGRpZmZlcmVuY2VzW2NoYXJDb2RlXSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgdG9Gb250Q2hhclsrY2hhckNvZGVdID0gdW5pY29kZTsKICAgIH0KICB9CiAgcmV0dXJuIHRvRm9udENoYXI7Cn0KZnVuY3Rpb24gaXNNYWNOYW1lUmVjb3JkKHIpIHsKICByZXR1cm4gci5wbGF0Zm9ybSA9PT0gMSAmJiByLmVuY29kaW5nID09PSAwICYmIHIubGFuZ3VhZ2UgPT09IDA7Cn0KZnVuY3Rpb24gaXNXaW5OYW1lUmVjb3JkKHIpIHsKICByZXR1cm4gci5wbGF0Zm9ybSA9PT0gMyAmJiByLmVuY29kaW5nID09PSAxICYmIHIubGFuZ3VhZ2UgPT09IDB4NDA5Owp9CmZ1bmN0aW9uIGNvbnZlcnRDaWRTdHJpbmcoY2hhckNvZGUsIGNpZCwgc2hvdWxkVGhyb3cgPSBmYWxzZSkgewogIHN3aXRjaCAoY2lkLmxlbmd0aCkgewogICAgY2FzZSAxOgogICAgICByZXR1cm4gY2lkLmNoYXJDb2RlQXQoMCk7CiAgICBjYXNlIDI6CiAgICAgIHJldHVybiBjaWQuY2hhckNvZGVBdCgwKSA8PCA4IHwgY2lkLmNoYXJDb2RlQXQoMSk7CiAgfQogIGNvbnN0IG1zZyA9IGBVbnN1cHBvcnRlZCBDSUQgc3RyaW5nIChjaGFyQ29kZSAke2NoYXJDb2RlfSk6ICIke2NpZH0iLmA7CiAgaWYgKHNob3VsZFRocm93KSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IobXNnKTsKICB9CiAgd2Fybihtc2cpOwogIHJldHVybiBjaWQ7Cn0KZnVuY3Rpb24gYWRqdXN0TWFwcGluZyhjaGFyQ29kZVRvR2x5cGhJZCwgaGFzR2x5cGgsIG5ld0dseXBoWmVyb0lkLCB0b1VuaWNvZGUpIHsKICBjb25zdCBuZXdNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGNvbnN0IHRvVW5pY29kZUV4dHJhTWFwID0gbmV3IE1hcCgpOwogIGNvbnN0IHRvRm9udENoYXIgPSBbXTsKICBjb25zdCB1c2VkR2x5cGhJZHMgPSBuZXcgU2V0KCk7CiAgbGV0IHByaXZhdGVVc2VBcmVhSW5kZXggPSAwOwogIGNvbnN0IHByaXZhdGVVc2VPZmZldFN0YXJ0ID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMF07CiAgbGV0IG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUgPSBwcml2YXRlVXNlT2ZmZXRTdGFydDsKICBsZXQgcHJpdmF0ZVVzZU9mZmV0RW5kID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMV07CiAgY29uc3QgaXNJblByaXZhdGVBcmVhID0gY29kZSA9PiBQUklWQVRFX1VTRV9BUkVBU1swXVswXSA8PSBjb2RlICYmIGNvZGUgPD0gUFJJVkFURV9VU0VfQVJFQVNbMF1bMV0gfHwgUFJJVkFURV9VU0VfQVJFQVNbMV1bMF0gPD0gY29kZSAmJiBjb2RlIDw9IFBSSVZBVEVfVVNFX0FSRUFTWzFdWzFdOwogIGxldCBMSUdBVFVSRV9UT19VTklDT0RFID0gbnVsbDsKICBmb3IgKGNvbnN0IG9yaWdpbmFsQ2hhckNvZGUgaW4gY2hhckNvZGVUb0dseXBoSWQpIHsKICAgIGxldCBnbHlwaElkID0gY2hhckNvZGVUb0dseXBoSWRbb3JpZ2luYWxDaGFyQ29kZV07CiAgICBpZiAoIWhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUgPiBwcml2YXRlVXNlT2ZmZXRFbmQpIHsKICAgICAgcHJpdmF0ZVVzZUFyZWFJbmRleCsrOwogICAgICBpZiAocHJpdmF0ZVVzZUFyZWFJbmRleCA+PSBQUklWQVRFX1VTRV9BUkVBUy5sZW5ndGgpIHsKICAgICAgICB3YXJuKCJSYW4gb3V0IG9mIHNwYWNlIGluIGZvbnQgcHJpdmF0ZSB1c2UgYXJlYS4iKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBuZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMF07CiAgICAgIHByaXZhdGVVc2VPZmZldEVuZCA9IFBSSVZBVEVfVVNFX0FSRUFTW3ByaXZhdGVVc2VBcmVhSW5kZXhdWzFdOwogICAgfQogICAgY29uc3QgZm9udENoYXJDb2RlID0gbmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZSsrOwogICAgaWYgKGdseXBoSWQgPT09IDApIHsKICAgICAgZ2x5cGhJZCA9IG5ld0dseXBoWmVyb0lkOwogICAgfQogICAgbGV0IHVuaWNvZGUgPSB0b1VuaWNvZGUuZ2V0KG9yaWdpbmFsQ2hhckNvZGUpOwogICAgaWYgKHR5cGVvZiB1bmljb2RlID09PSAic3RyaW5nIikgewogICAgICBpZiAodW5pY29kZS5sZW5ndGggPT09IDEpIHsKICAgICAgICB1bmljb2RlID0gdW5pY29kZS5jb2RlUG9pbnRBdCgwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIUxJR0FUVVJFX1RPX1VOSUNPREUpIHsKICAgICAgICAgIExJR0FUVVJFX1RPX1VOSUNPREUgPSBuZXcgTWFwKCk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMHhmYjAwOyBpIDw9IDB4ZmI0ZjsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpLm5vcm1hbGl6ZSgiTkZLRCIpOwogICAgICAgICAgICBpZiAobm9ybWFsaXplZC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgTElHQVRVUkVfVE9fVU5JQ09ERS5zZXQobm9ybWFsaXplZCwgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdW5pY29kZSA9IExJR0FUVVJFX1RPX1VOSUNPREUuZ2V0KHVuaWNvZGUpIHx8IHVuaWNvZGUuY29kZVBvaW50QXQoMCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh1bmljb2RlICYmICFpc0luUHJpdmF0ZUFyZWEodW5pY29kZSkgJiYgIXVzZWRHbHlwaElkcy5oYXMoZ2x5cGhJZCkpIHsKICAgICAgdG9Vbmljb2RlRXh0cmFNYXAuc2V0KHVuaWNvZGUsIGdseXBoSWQpOwogICAgICB1c2VkR2x5cGhJZHMuYWRkKGdseXBoSWQpOwogICAgfQogICAgbmV3TWFwW2ZvbnRDaGFyQ29kZV0gPSBnbHlwaElkOwogICAgdG9Gb250Q2hhcltvcmlnaW5hbENoYXJDb2RlXSA9IGZvbnRDaGFyQ29kZTsKICB9CiAgcmV0dXJuIHsKICAgIHRvRm9udENoYXIsCiAgICBjaGFyQ29kZVRvR2x5cGhJZDogbmV3TWFwLAogICAgdG9Vbmljb2RlRXh0cmFNYXAsCiAgICBuZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlCiAgfTsKfQpmdW5jdGlvbiBnZXRSYW5nZXMoZ2x5cGhzLCB0b1VuaWNvZGVFeHRyYU1hcCwgbnVtR2x5cGhzKSB7CiAgY29uc3QgY29kZXMgPSBbXTsKICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGdseXBocykgewogICAgaWYgKGdseXBoc1tjaGFyQ29kZV0gPj0gbnVtR2x5cGhzKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29kZXMucHVzaCh7CiAgICAgIGZvbnRDaGFyQ29kZTogY2hhckNvZGUgfCAwLAogICAgICBnbHlwaElkOiBnbHlwaHNbY2hhckNvZGVdCiAgICB9KTsKICB9CiAgaWYgKHRvVW5pY29kZUV4dHJhTWFwKSB7CiAgICBmb3IgKGNvbnN0IFt1bmljb2RlLCBnbHlwaElkXSBvZiB0b1VuaWNvZGVFeHRyYU1hcCkgewogICAgICBpZiAoZ2x5cGhJZCA+PSBudW1HbHlwaHMpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb2Rlcy5wdXNoKHsKICAgICAgICBmb250Q2hhckNvZGU6IHVuaWNvZGUsCiAgICAgICAgZ2x5cGhJZAogICAgICB9KTsKICAgIH0KICB9CiAgaWYgKGNvZGVzLmxlbmd0aCA9PT0gMCkgewogICAgY29kZXMucHVzaCh7CiAgICAgIGZvbnRDaGFyQ29kZTogMCwKICAgICAgZ2x5cGhJZDogMAogICAgfSk7CiAgfQogIGNvZGVzLnNvcnQoKGEsIGIpID0+IGEuZm9udENoYXJDb2RlIC0gYi5mb250Q2hhckNvZGUpOwogIGNvbnN0IHJhbmdlcyA9IFtdOwogIGNvbnN0IGxlbmd0aCA9IGNvZGVzLmxlbmd0aDsKICBmb3IgKGxldCBuID0gMDsgbiA8IGxlbmd0aDspIHsKICAgIGNvbnN0IHN0YXJ0ID0gY29kZXNbbl0uZm9udENoYXJDb2RlOwogICAgY29uc3QgY29kZUluZGljZXMgPSBbY29kZXNbbl0uZ2x5cGhJZF07CiAgICArK247CiAgICBsZXQgZW5kID0gc3RhcnQ7CiAgICB3aGlsZSAobiA8IGxlbmd0aCAmJiBlbmQgKyAxID09PSBjb2Rlc1tuXS5mb250Q2hhckNvZGUpIHsKICAgICAgY29kZUluZGljZXMucHVzaChjb2Rlc1tuXS5nbHlwaElkKTsKICAgICAgKytlbmQ7CiAgICAgICsrbjsKICAgICAgaWYgKGVuZCA9PT0gMHhmZmZmKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJhbmdlcy5wdXNoKFtzdGFydCwgZW5kLCBjb2RlSW5kaWNlc10pOwogIH0KICByZXR1cm4gcmFuZ2VzOwp9CmZ1bmN0aW9uIGNyZWF0ZUNtYXBUYWJsZShnbHlwaHMsIHRvVW5pY29kZUV4dHJhTWFwLCBudW1HbHlwaHMpIHsKICBjb25zdCByYW5nZXMgPSBnZXRSYW5nZXMoZ2x5cGhzLCB0b1VuaWNvZGVFeHRyYU1hcCwgbnVtR2x5cGhzKTsKICBjb25zdCBudW1UYWJsZXMgPSByYW5nZXMuYXQoLTEpWzFdID4gMHhmZmZmID8gMiA6IDE7CiAgbGV0IGNtYXAgPSAiXHgwMFx4MDAiICsgc3RyaW5nMTYobnVtVGFibGVzKSArICJceDAwXHgwMyIgKyAiXHgwMFx4MDEiICsgc3RyaW5nMzIoNCArIG51bVRhYmxlcyAqIDgpOwogIGxldCBpLCBpaSwgaiwgamo7CiAgZm9yIChpID0gcmFuZ2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICBpZiAocmFuZ2VzW2ldWzBdIDw9IDB4ZmZmZikgewogICAgICBicmVhazsKICAgIH0KICB9CiAgY29uc3QgYm1wTGVuZ3RoID0gaSArIDE7CiAgaWYgKHJhbmdlc1tpXVswXSA8IDB4ZmZmZiAmJiByYW5nZXNbaV1bMV0gPT09IDB4ZmZmZikgewogICAgcmFuZ2VzW2ldWzFdID0gMHhmZmZlOwogIH0KICBjb25zdCB0cmFpbGluZ1Jhbmdlc0NvdW50ID0gcmFuZ2VzW2ldWzFdIDwgMHhmZmZmID8gMSA6IDA7CiAgY29uc3Qgc2VnQ291bnQgPSBibXBMZW5ndGggKyB0cmFpbGluZ1Jhbmdlc0NvdW50OwogIGNvbnN0IHNlYXJjaFBhcmFtcyA9IE9wZW5UeXBlRmlsZUJ1aWxkZXIuZ2V0U2VhcmNoUGFyYW1zKHNlZ0NvdW50LCAyKTsKICBsZXQgc3RhcnRDb3VudCA9ICIiOwogIGxldCBlbmRDb3VudCA9ICIiOwogIGxldCBpZERlbHRhcyA9ICIiOwogIGxldCBpZFJhbmdlT2Zmc2V0cyA9ICIiOwogIGxldCBnbHlwaHNJZHMgPSAiIjsKICBsZXQgYmlhcyA9IDA7CiAgbGV0IHJhbmdlLCBzdGFydCwgZW5kLCBjb2RlczsKICBmb3IgKGkgPSAwLCBpaSA9IGJtcExlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIHJhbmdlID0gcmFuZ2VzW2ldOwogICAgc3RhcnQgPSByYW5nZVswXTsKICAgIGVuZCA9IHJhbmdlWzFdOwogICAgc3RhcnRDb3VudCArPSBzdHJpbmcxNihzdGFydCk7CiAgICBlbmRDb3VudCArPSBzdHJpbmcxNihlbmQpOwogICAgY29kZXMgPSByYW5nZVsyXTsKICAgIGxldCBjb250aWd1b3VzID0gdHJ1ZTsKICAgIGZvciAoaiA9IDEsIGpqID0gY29kZXMubGVuZ3RoOyBqIDwgamo7ICsraikgewogICAgICBpZiAoY29kZXNbal0gIT09IGNvZGVzW2ogLSAxXSArIDEpIHsKICAgICAgICBjb250aWd1b3VzID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmICghY29udGlndW91cykgewogICAgICBjb25zdCBvZmZzZXQgPSAoc2VnQ291bnQgLSBpKSAqIDIgKyBiaWFzICogMjsKICAgICAgYmlhcyArPSBlbmQgLSBzdGFydCArIDE7CiAgICAgIGlkRGVsdGFzICs9IHN0cmluZzE2KDApOwogICAgICBpZFJhbmdlT2Zmc2V0cyArPSBzdHJpbmcxNihvZmZzZXQpOwogICAgICBmb3IgKGogPSAwLCBqaiA9IGNvZGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgICBnbHlwaHNJZHMgKz0gc3RyaW5nMTYoY29kZXNbal0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBzdGFydENvZGUgPSBjb2Rlc1swXTsKICAgICAgaWREZWx0YXMgKz0gc3RyaW5nMTYoc3RhcnRDb2RlIC0gc3RhcnQgJiAweGZmZmYpOwogICAgICBpZFJhbmdlT2Zmc2V0cyArPSBzdHJpbmcxNigwKTsKICAgIH0KICB9CiAgaWYgKHRyYWlsaW5nUmFuZ2VzQ291bnQgPiAwKSB7CiAgICBlbmRDb3VudCArPSAiXHhGRlx4RkYiOwogICAgc3RhcnRDb3VudCArPSAiXHhGRlx4RkYiOwogICAgaWREZWx0YXMgKz0gIlx4MDBceDAxIjsKICAgIGlkUmFuZ2VPZmZzZXRzICs9ICJceDAwXHgwMCI7CiAgfQogIGNvbnN0IGZvcm1hdDMxNCA9ICJceDAwXHgwMCIgKyBzdHJpbmcxNigyICogc2VnQ291bnQpICsgc3RyaW5nMTYoc2VhcmNoUGFyYW1zLnJhbmdlKSArIHN0cmluZzE2KHNlYXJjaFBhcmFtcy5lbnRyeSkgKyBzdHJpbmcxNihzZWFyY2hQYXJhbXMucmFuZ2VTaGlmdCkgKyBlbmRDb3VudCArICJceDAwXHgwMCIgKyBzdGFydENvdW50ICsgaWREZWx0YXMgKyBpZFJhbmdlT2Zmc2V0cyArIGdseXBoc0lkczsKICBsZXQgZm9ybWF0MzEwMTIgPSAiIjsKICBsZXQgaGVhZGVyMzEwMTIgPSAiIjsKICBpZiAobnVtVGFibGVzID4gMSkgewogICAgY21hcCArPSAiXHgwMFx4MDMiICsgIlx4MDBceDBBIiArIHN0cmluZzMyKDQgKyBudW1UYWJsZXMgKiA4ICsgNCArIGZvcm1hdDMxNC5sZW5ndGgpOwogICAgZm9ybWF0MzEwMTIgPSAiIjsKICAgIGZvciAoaSA9IDAsIGlpID0gcmFuZ2VzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgcmFuZ2UgPSByYW5nZXNbaV07CiAgICAgIHN0YXJ0ID0gcmFuZ2VbMF07CiAgICAgIGNvZGVzID0gcmFuZ2VbMl07CiAgICAgIGxldCBjb2RlID0gY29kZXNbMF07CiAgICAgIGZvciAoaiA9IDEsIGpqID0gY29kZXMubGVuZ3RoOyBqIDwgamo7ICsraikgewogICAgICAgIGlmIChjb2Rlc1tqXSAhPT0gY29kZXNbaiAtIDFdICsgMSkgewogICAgICAgICAgZW5kID0gcmFuZ2VbMF0gKyBqIC0gMTsKICAgICAgICAgIGZvcm1hdDMxMDEyICs9IHN0cmluZzMyKHN0YXJ0KSArIHN0cmluZzMyKGVuZCkgKyBzdHJpbmczMihjb2RlKTsKICAgICAgICAgIHN0YXJ0ID0gZW5kICsgMTsKICAgICAgICAgIGNvZGUgPSBjb2Rlc1tqXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9ybWF0MzEwMTIgKz0gc3RyaW5nMzIoc3RhcnQpICsgc3RyaW5nMzIocmFuZ2VbMV0pICsgc3RyaW5nMzIoY29kZSk7CiAgICB9CiAgICBoZWFkZXIzMTAxMiA9ICJceDAwXHgwQyIgKyAiXHgwMFx4MDAiICsgc3RyaW5nMzIoZm9ybWF0MzEwMTIubGVuZ3RoICsgMTYpICsgIlx4MDBceDAwXHgwMFx4MDAiICsgc3RyaW5nMzIoZm9ybWF0MzEwMTIubGVuZ3RoIC8gMTIpOwogIH0KICByZXR1cm4gY21hcCArICJceDAwXHgwNCIgKyBzdHJpbmcxNihmb3JtYXQzMTQubGVuZ3RoICsgNCkgKyBmb3JtYXQzMTQgKyBoZWFkZXIzMTAxMiArIGZvcm1hdDMxMDEyOwp9CmZ1bmN0aW9uIHZhbGlkYXRlT1MyVGFibGUob3MyLCBmaWxlKSB7CiAgZmlsZS5wb3MgPSAoZmlsZS5zdGFydCB8fCAwKSArIG9zMi5vZmZzZXQ7CiAgY29uc3QgdmVyc2lvbiA9IGZpbGUuZ2V0VWludDE2KCk7CiAgZmlsZS5za2lwKDYwKTsKICBjb25zdCBzZWxlY3Rpb24gPSBmaWxlLmdldFVpbnQxNigpOwogIGlmICh2ZXJzaW9uIDwgNCAmJiBzZWxlY3Rpb24gJiAweDAzMDApIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3QgZmlyc3RDaGFyID0gZmlsZS5nZXRVaW50MTYoKTsKICBjb25zdCBsYXN0Q2hhciA9IGZpbGUuZ2V0VWludDE2KCk7CiAgaWYgKGZpcnN0Q2hhciA+IGxhc3RDaGFyKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGZpbGUuc2tpcCg2KTsKICBjb25zdCB1c1dpbkFzY2VudCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgaWYgKHVzV2luQXNjZW50ID09PSAwKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIG9zMi5kYXRhWzhdID0gb3MyLmRhdGFbOV0gPSAwOwogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGNyZWF0ZU9TMlRhYmxlKHByb3BlcnRpZXMsIGNoYXJzdHJpbmdzLCBvdmVycmlkZSkgewogIG92ZXJyaWRlIHx8PSB7CiAgICB1bml0c1BlckVtOiAwLAogICAgeU1heDogMCwKICAgIHlNaW46IDAsCiAgICBhc2NlbnQ6IDAsCiAgICBkZXNjZW50OiAwCiAgfTsKICBsZXQgdWxVbmljb2RlUmFuZ2UxID0gMDsKICBsZXQgdWxVbmljb2RlUmFuZ2UyID0gMDsKICBsZXQgdWxVbmljb2RlUmFuZ2UzID0gMDsKICBsZXQgdWxVbmljb2RlUmFuZ2U0ID0gMDsKICBsZXQgZmlyc3RDaGFySW5kZXggPSBudWxsOwogIGxldCBsYXN0Q2hhckluZGV4ID0gMDsKICBsZXQgcG9zaXRpb24gPSAtMTsKICBpZiAoY2hhcnN0cmluZ3MpIHsKICAgIGZvciAobGV0IGNvZGUgaW4gY2hhcnN0cmluZ3MpIHsKICAgICAgY29kZSB8PSAwOwogICAgICBpZiAoZmlyc3RDaGFySW5kZXggPiBjb2RlIHx8ICFmaXJzdENoYXJJbmRleCkgewogICAgICAgIGZpcnN0Q2hhckluZGV4ID0gY29kZTsKICAgICAgfQogICAgICBpZiAobGFzdENoYXJJbmRleCA8IGNvZGUpIHsKICAgICAgICBsYXN0Q2hhckluZGV4ID0gY29kZTsKICAgICAgfQogICAgICBwb3NpdGlvbiA9IGdldFVuaWNvZGVSYW5nZUZvcihjb2RlLCBwb3NpdGlvbik7CiAgICAgIGlmIChwb3NpdGlvbiA8IDMyKSB7CiAgICAgICAgdWxVbmljb2RlUmFuZ2UxIHw9IDEgPDwgcG9zaXRpb247CiAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCA2NCkgewogICAgICAgIHVsVW5pY29kZVJhbmdlMiB8PSAxIDw8IHBvc2l0aW9uIC0gMzI7CiAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCA5NikgewogICAgICAgIHVsVW5pY29kZVJhbmdlMyB8PSAxIDw8IHBvc2l0aW9uIC0gNjQ7CiAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCAxMjMpIHsKICAgICAgICB1bFVuaWNvZGVSYW5nZTQgfD0gMSA8PCBwb3NpdGlvbiAtIDk2OwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVW5pY29kZSByYW5nZXMgQml0cyA+IDEyMyBhcmUgcmVzZXJ2ZWQgZm9yIGludGVybmFsIHVzYWdlIik7CiAgICAgIH0KICAgIH0KICAgIGlmIChsYXN0Q2hhckluZGV4ID4gMHhmZmZmKSB7CiAgICAgIGxhc3RDaGFySW5kZXggPSAweGZmZmY7CiAgICB9CiAgfSBlbHNlIHsKICAgIGZpcnN0Q2hhckluZGV4ID0gMDsKICAgIGxhc3RDaGFySW5kZXggPSAyNTU7CiAgfQogIGNvbnN0IGJib3ggPSBwcm9wZXJ0aWVzLmJib3ggfHwgWzAsIDAsIDAsIDBdOwogIGNvbnN0IHVuaXRzUGVyRW0gPSBvdmVycmlkZS51bml0c1BlckVtIHx8IChwcm9wZXJ0aWVzLmZvbnRNYXRyaXggPyAxIC8gTWF0aC5tYXgoLi4ucHJvcGVydGllcy5mb250TWF0cml4LnNsaWNlKDAsIDQpLm1hcChNYXRoLmFicykpIDogMTAwMCk7CiAgY29uc3Qgc2NhbGUgPSBwcm9wZXJ0aWVzLmFzY2VudFNjYWxlZCA/IDEuMCA6IHVuaXRzUGVyRW0gLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgY29uc3QgdHlwb0FzY2VudCA9IG92ZXJyaWRlLmFzY2VudCB8fCBNYXRoLnJvdW5kKHNjYWxlICogKHByb3BlcnRpZXMuYXNjZW50IHx8IGJib3hbM10pKTsKICBsZXQgdHlwb0Rlc2NlbnQgPSBvdmVycmlkZS5kZXNjZW50IHx8IE1hdGgucm91bmQoc2NhbGUgKiAocHJvcGVydGllcy5kZXNjZW50IHx8IGJib3hbMV0pKTsKICBpZiAodHlwb0Rlc2NlbnQgPiAwICYmIHByb3BlcnRpZXMuZGVzY2VudCA+IDAgJiYgYmJveFsxXSA8IDApIHsKICAgIHR5cG9EZXNjZW50ID0gLXR5cG9EZXNjZW50OwogIH0KICBjb25zdCB3aW5Bc2NlbnQgPSBvdmVycmlkZS55TWF4IHx8IHR5cG9Bc2NlbnQ7CiAgY29uc3Qgd2luRGVzY2VudCA9IC1vdmVycmlkZS55TWluIHx8IC10eXBvRGVzY2VudDsKICByZXR1cm4gIlx4MDBceDAzIiArICJceDAyXHgyNCIgKyAiXHgwMVx4RjQiICsgIlx4MDBceDA1IiArICJceDAwXHgwMCIgKyAiXHgwMlx4OEEiICsgIlx4MDJceEJCIiArICJceDAwXHgwMCIgKyAiXHgwMFx4OEMiICsgIlx4MDJceDhBIiArICJceDAyXHhCQiIgKyAiXHgwMFx4MDAiICsgIlx4MDFceERGIiArICJceDAwXHgzMSIgKyAiXHgwMVx4MDIiICsgIlx4MDBceDAwIiArICJceDAwXHgwMFx4MDYiICsgU3RyaW5nLmZyb21DaGFyQ29kZShwcm9wZXJ0aWVzLmZpeGVkUGl0Y2ggPyAweDA5IDogMHgwMCkgKyAiXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwIiArIHN0cmluZzMyKHVsVW5pY29kZVJhbmdlMSkgKyBzdHJpbmczMih1bFVuaWNvZGVSYW5nZTIpICsgc3RyaW5nMzIodWxVbmljb2RlUmFuZ2UzKSArIHN0cmluZzMyKHVsVW5pY29kZVJhbmdlNCkgKyAiXHgyQVx4MzJceDMxXHgyQSIgKyBzdHJpbmcxNihwcm9wZXJ0aWVzLml0YWxpY0FuZ2xlID8gMSA6IDApICsgc3RyaW5nMTYoZmlyc3RDaGFySW5kZXggfHwgcHJvcGVydGllcy5maXJzdENoYXIpICsgc3RyaW5nMTYobGFzdENoYXJJbmRleCB8fCBwcm9wZXJ0aWVzLmxhc3RDaGFyKSArIHN0cmluZzE2KHR5cG9Bc2NlbnQpICsgc3RyaW5nMTYodHlwb0Rlc2NlbnQpICsgIlx4MDBceDY0IiArIHN0cmluZzE2KHdpbkFzY2VudCkgKyBzdHJpbmcxNih3aW5EZXNjZW50KSArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArIHN0cmluZzE2KHByb3BlcnRpZXMueEhlaWdodCkgKyBzdHJpbmcxNihwcm9wZXJ0aWVzLmNhcEhlaWdodCkgKyBzdHJpbmcxNigwKSArIHN0cmluZzE2KGZpcnN0Q2hhckluZGV4IHx8IHByb3BlcnRpZXMuZmlyc3RDaGFyKSArICJceDAwXHgwMyI7Cn0KZnVuY3Rpb24gY3JlYXRlUG9zdFRhYmxlKHByb3BlcnRpZXMpIHsKICBjb25zdCBhbmdsZSA9IE1hdGguZmxvb3IocHJvcGVydGllcy5pdGFsaWNBbmdsZSAqIDIgKiogMTYpOwogIHJldHVybiAiXHgwMFx4MDNceDAwXHgwMCIgKyBzdHJpbmczMihhbmdsZSkgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArIHN0cmluZzMyKHByb3BlcnRpZXMuZml4ZWRQaXRjaCA/IDEgOiAwKSArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIjsKfQpmdW5jdGlvbiBjcmVhdGVQb3N0c2NyaXB0TmFtZShuYW1lKSB7CiAgcmV0dXJuIG5hbWUucmVwbGFjZUFsbCgvW15ceDIxLVx4N0VdfFtbXF0oKXt9PD4vJV0vZywgIiIpLnNsaWNlKDAsIDYzKTsKfQpmdW5jdGlvbiBjcmVhdGVOYW1lVGFibGUobmFtZSwgcHJvdG8pIHsKICBpZiAoIXByb3RvKSB7CiAgICBwcm90byA9IFtbXSwgW11dOwogIH0KICBjb25zdCBzdHJpbmdzID0gW3Byb3RvWzBdWzBdIHx8ICJPcmlnaW5hbCBsaWNlbmNlIiwgcHJvdG9bMF1bMV0gfHwgbmFtZSwgcHJvdG9bMF1bMl0gfHwgIlVua25vd24iLCBwcm90b1swXVszXSB8fCAidW5pcXVlSUQiLCBwcm90b1swXVs0XSB8fCBuYW1lLCBwcm90b1swXVs1XSB8fCAiVmVyc2lvbiAwLjExIiwgcHJvdG9bMF1bNl0gfHwgY3JlYXRlUG9zdHNjcmlwdE5hbWUobmFtZSksIHByb3RvWzBdWzddIHx8ICJVbmtub3duIiwgcHJvdG9bMF1bOF0gfHwgIlVua25vd24iLCBwcm90b1swXVs5XSB8fCAiVW5rbm93biJdOwogIGNvbnN0IHN0cmluZ3NVbmljb2RlID0gW107CiAgbGV0IGksIGlpLCBqLCBqaiwgc3RyOwogIGZvciAoaSA9IDAsIGlpID0gc3RyaW5ncy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBzdHIgPSBwcm90b1sxXVtpXSB8fCBzdHJpbmdzW2ldOwogICAgY29uc3Qgc3RyQnVmVW5pY29kZSA9IFtdOwogICAgZm9yIChqID0gMCwgamogPSBzdHIubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICBzdHJCdWZVbmljb2RlLnB1c2goc3RyaW5nMTYoc3RyLmNoYXJDb2RlQXQoaikpKTsKICAgIH0KICAgIHN0cmluZ3NVbmljb2RlLnB1c2goc3RyQnVmVW5pY29kZS5qb2luKCIiKSk7CiAgfQogIGNvbnN0IG5hbWVzID0gW3N0cmluZ3MsIHN0cmluZ3NVbmljb2RlXTsKICBjb25zdCBwbGF0Zm9ybXMgPSBbIlx4MDBceDAxIiwgIlx4MDBceDAzIl07CiAgY29uc3QgZW5jb2RpbmdzID0gWyJceDAwXHgwMCIsICJceDAwXHgwMSJdOwogIGNvbnN0IGxhbmd1YWdlcyA9IFsiXHgwMFx4MDAiLCAiXHgwNFx4MDkiXTsKICBjb25zdCBuYW1lc1JlY29yZENvdW50ID0gc3RyaW5ncy5sZW5ndGggKiBwbGF0Zm9ybXMubGVuZ3RoOwogIGxldCBuYW1lVGFibGUgPSAiXHgwMFx4MDAiICsgc3RyaW5nMTYobmFtZXNSZWNvcmRDb3VudCkgKyBzdHJpbmcxNihuYW1lc1JlY29yZENvdW50ICogMTIgKyA2KTsKICBsZXQgc3RyT2Zmc2V0ID0gMDsKICBmb3IgKGkgPSAwLCBpaSA9IHBsYXRmb3Jtcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBzdHJzID0gbmFtZXNbaV07CiAgICBmb3IgKGogPSAwLCBqaiA9IHN0cnMubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICBzdHIgPSBzdHJzW2pdOwogICAgICBjb25zdCBuYW1lUmVjb3JkID0gcGxhdGZvcm1zW2ldICsgZW5jb2RpbmdzW2ldICsgbGFuZ3VhZ2VzW2ldICsgc3RyaW5nMTYoaikgKyBzdHJpbmcxNihzdHIubGVuZ3RoKSArIHN0cmluZzE2KHN0ck9mZnNldCk7CiAgICAgIG5hbWVUYWJsZSArPSBuYW1lUmVjb3JkOwogICAgICBzdHJPZmZzZXQgKz0gc3RyLmxlbmd0aDsKICAgIH0KICB9CiAgbmFtZVRhYmxlICs9IHN0cmluZ3Muam9pbigiIikgKyBzdHJpbmdzVW5pY29kZS5qb2luKCIiKTsKICByZXR1cm4gbmFtZVRhYmxlOwp9CmNsYXNzIEZvbnQgewogIGNvbnN0cnVjdG9yKG5hbWUsIGZpbGUsIHByb3BlcnRpZXMsIGV2YWx1YXRvck9wdGlvbnMpIHsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLnBzTmFtZSA9IG51bGw7CiAgICB0aGlzLm1pbWV0eXBlID0gbnVsbDsKICAgIHRoaXMuZGlzYWJsZUZvbnRGYWNlID0gZXZhbHVhdG9yT3B0aW9ucy5kaXNhYmxlRm9udEZhY2U7CiAgICB0aGlzLmZvbnRFeHRyYVByb3BlcnRpZXMgPSBldmFsdWF0b3JPcHRpb25zLmZvbnRFeHRyYVByb3BlcnRpZXM7CiAgICB0aGlzLmxvYWRlZE5hbWUgPSBwcm9wZXJ0aWVzLmxvYWRlZE5hbWU7CiAgICB0aGlzLmlzVHlwZTNGb250ID0gcHJvcGVydGllcy5pc1R5cGUzRm9udDsKICAgIHRoaXMubWlzc2luZ0ZpbGUgPSBmYWxzZTsKICAgIHRoaXMuY3NzRm9udEluZm8gPSBwcm9wZXJ0aWVzLmNzc0ZvbnRJbmZvOwogICAgdGhpcy5fY2hhcnNDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLl9nbHlwaENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGxldCBpc1NlcmlmRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU2VyaWYpOwogICAgaWYgKCFpc1NlcmlmRm9udCAmJiAhcHJvcGVydGllcy5pc1NpbXVsYXRlZEZsYWdzKSB7CiAgICAgIGNvbnN0IHN0ZEZvbnRNYXAgPSBnZXRTdGRGb250TWFwKCksCiAgICAgICAgbm9uU3RkRm9udE1hcCA9IGdldE5vblN0ZEZvbnRNYXAoKSwKICAgICAgICBzZXJpZkZvbnRzID0gZ2V0U2VyaWZGb250cygpOwogICAgICBmb3IgKGNvbnN0IG5hbWVQYXJ0IG9mIG5hbWUuc3BsaXQoIisiKSkgewogICAgICAgIGxldCBmb250TmFtZSA9IG5hbWVQYXJ0LnJlcGxhY2VBbGwoL1ssX10vZywgIi0iKTsKICAgICAgICBmb250TmFtZSA9IHN0ZEZvbnRNYXBbZm9udE5hbWVdIHx8IG5vblN0ZEZvbnRNYXBbZm9udE5hbWVdIHx8IGZvbnROYW1lOwogICAgICAgIGZvbnROYW1lID0gZm9udE5hbWUuc3BsaXQoIi0iLCAxKVswXTsKICAgICAgICBpZiAoc2VyaWZGb250c1tmb250TmFtZV0pIHsKICAgICAgICAgIGlzU2VyaWZGb250ID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy5pc1NlcmlmRm9udCA9IGlzU2VyaWZGb250OwogICAgdGhpcy5pc1N5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU3ltYm9saWMpOwogICAgdGhpcy5pc01vbm9zcGFjZSA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuRml4ZWRQaXRjaCk7CiAgICBsZXQgewogICAgICB0eXBlLAogICAgICBzdWJ0eXBlCiAgICB9ID0gcHJvcGVydGllczsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB0aGlzLnN1YnR5cGUgPSBzdWJ0eXBlOwogICAgdGhpcy5zeXN0ZW1Gb250SW5mbyA9IHByb3BlcnRpZXMuc3lzdGVtRm9udEluZm87CiAgICBjb25zdCBtYXRjaGVzID0gbmFtZS5tYXRjaCgvXkludmFsaWRQREZqc0ZvbnRfKC4qKV9cZCskLyk7CiAgICB0aGlzLmlzSW52YWxpZFBERmpzRm9udCA9ICEhbWF0Y2hlczsKICAgIGlmICh0aGlzLmlzSW52YWxpZFBERmpzRm9udCkgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9IG1hdGNoZXNbMV07CiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNb25vc3BhY2UpIHsKICAgICAgdGhpcy5mYWxsYmFja05hbWUgPSAibW9ub3NwYWNlIjsKICAgIH0gZWxzZSBpZiAodGhpcy5pc1NlcmlmRm9udCkgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9ICJzZXJpZiI7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9ICJzYW5zLXNlcmlmIjsKICAgIH0KICAgIGlmICh0aGlzLnN5c3RlbUZvbnRJbmZvPy5ndWVzc0ZhbGxiYWNrKSB7CiAgICAgIHRoaXMuc3lzdGVtRm9udEluZm8uZ3Vlc3NGYWxsYmFjayA9IGZhbHNlOwogICAgICB0aGlzLnN5c3RlbUZvbnRJbmZvLmNzcyArPSBgLCR7dGhpcy5mYWxsYmFja05hbWV9YDsKICAgIH0KICAgIHRoaXMuZGlmZmVyZW5jZXMgPSBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzOwogICAgdGhpcy53aWR0aHMgPSBwcm9wZXJ0aWVzLndpZHRoczsKICAgIHRoaXMuZGVmYXVsdFdpZHRoID0gcHJvcGVydGllcy5kZWZhdWx0V2lkdGg7CiAgICB0aGlzLmNvbXBvc2l0ZSA9IHByb3BlcnRpZXMuY29tcG9zaXRlOwogICAgdGhpcy5jTWFwID0gcHJvcGVydGllcy5jTWFwOwogICAgdGhpcy5jYXBIZWlnaHQgPSBwcm9wZXJ0aWVzLmNhcEhlaWdodCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgIHRoaXMuYXNjZW50ID0gcHJvcGVydGllcy5hc2NlbnQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICB0aGlzLmRlc2NlbnQgPSBwcm9wZXJ0aWVzLmRlc2NlbnQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICB0aGlzLmxpbmVIZWlnaHQgPSB0aGlzLmFzY2VudCAtIHRoaXMuZGVzY2VudDsKICAgIHRoaXMuZm9udE1hdHJpeCA9IHByb3BlcnRpZXMuZm9udE1hdHJpeDsKICAgIHRoaXMuYmJveCA9IHByb3BlcnRpZXMuYmJveDsKICAgIHRoaXMuZGVmYXVsdEVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmc7CiAgICB0aGlzLnRvVW5pY29kZSA9IHByb3BlcnRpZXMudG9Vbmljb2RlOwogICAgdGhpcy50b0ZvbnRDaGFyID0gW107CiAgICBpZiAocHJvcGVydGllcy50eXBlID09PSAiVHlwZTMiKSB7CiAgICAgIGZvciAobGV0IGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCAyNTY7IGNoYXJDb2RlKyspIHsKICAgICAgICB0aGlzLnRvRm9udENoYXJbY2hhckNvZGVdID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV0gfHwgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmdbY2hhckNvZGVdOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuY2lkRW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmNpZEVuY29kaW5nIHx8ICIiOwogICAgdGhpcy52ZXJ0aWNhbCA9ICEhcHJvcGVydGllcy52ZXJ0aWNhbDsKICAgIGlmICh0aGlzLnZlcnRpY2FsKSB7CiAgICAgIHRoaXMudm1ldHJpY3MgPSBwcm9wZXJ0aWVzLnZtZXRyaWNzOwogICAgICB0aGlzLmRlZmF1bHRWTWV0cmljcyA9IHByb3BlcnRpZXMuZGVmYXVsdFZNZXRyaWNzOwogICAgfQogICAgaWYgKCFmaWxlIHx8IGZpbGUuaXNFbXB0eSkgewogICAgICBpZiAoZmlsZSkgewogICAgICAgIHdhcm4oJ0ZvbnQgZmlsZSBpcyBlbXB0eSBpbiAiJyArIG5hbWUgKyAnIiAoJyArIHRoaXMubG9hZGVkTmFtZSArICIpIik7CiAgICAgIH0KICAgICAgdGhpcy5mYWxsYmFja1RvU3lzdGVtRm9udChwcm9wZXJ0aWVzKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgW3R5cGUsIHN1YnR5cGVdID0gZ2V0Rm9udEZpbGVUeXBlKGZpbGUsIHByb3BlcnRpZXMpOwogICAgaWYgKHR5cGUgIT09IHRoaXMudHlwZSB8fCBzdWJ0eXBlICE9PSB0aGlzLnN1YnR5cGUpIHsKICAgICAgaW5mbygiSW5jb25zaXN0ZW50IGZvbnQgZmlsZSBUeXBlL1N1YlR5cGUsIGV4cGVjdGVkOiAiICsgYCR7dGhpcy50eXBlfS8ke3RoaXMuc3VidHlwZX0gYnV0IGZvdW5kOiAke3R5cGV9LyR7c3VidHlwZX0uYCk7CiAgICB9CiAgICBsZXQgZGF0YTsKICAgIHRyeSB7CiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgIk1NVHlwZTEiOgogICAgICAgICAgaW5mbygiTU1UeXBlMSBmb250ICgiICsgbmFtZSArICIpLCBmYWxsaW5nIGJhY2sgdG8gVHlwZTEuIik7CiAgICAgICAgY2FzZSAiVHlwZTEiOgogICAgICAgIGNhc2UgIkNJREZvbnRUeXBlMCI6CiAgICAgICAgICB0aGlzLm1pbWV0eXBlID0gImZvbnQvb3BlbnR5cGUiOwogICAgICAgICAgY29uc3QgY2ZmID0gc3VidHlwZSA9PT0gIlR5cGUxQyIgfHwgc3VidHlwZSA9PT0gIkNJREZvbnRUeXBlMEMiID8gbmV3IENGRkZvbnQoZmlsZSwgcHJvcGVydGllcykgOiBuZXcgVHlwZTFGb250KG5hbWUsIGZpbGUsIHByb3BlcnRpZXMpOwogICAgICAgICAgYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpOwogICAgICAgICAgZGF0YSA9IHRoaXMuY29udmVydChuYW1lLCBjZmYsIHByb3BlcnRpZXMpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiT3BlblR5cGUiOgogICAgICAgIGNhc2UgIlRydWVUeXBlIjoKICAgICAgICBjYXNlICJDSURGb250VHlwZTIiOgogICAgICAgICAgdGhpcy5taW1ldHlwZSA9ICJmb250L29wZW50eXBlIjsKICAgICAgICAgIGRhdGEgPSB0aGlzLmNoZWNrQW5kUmVwYWlyKG5hbWUsIGZpbGUsIHByb3BlcnRpZXMpOwogICAgICAgICAgYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpOwogICAgICAgICAgaWYgKHRoaXMuaXNPcGVuVHlwZSkgewogICAgICAgICAgICB0eXBlID0gIk9wZW5UeXBlIjsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEZvbnQgJHt0eXBlfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2FybihlKTsKICAgICAgdGhpcy5mYWxsYmFja1RvU3lzdGVtRm9udChwcm9wZXJ0aWVzKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgYW1lbmRGYWxsYmFja1RvVW5pY29kZShwcm9wZXJ0aWVzKTsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy5zdWJ0eXBlID0gc3VidHlwZTsKICAgIHRoaXMuZm9udE1hdHJpeCA9IHByb3BlcnRpZXMuZm9udE1hdHJpeDsKICAgIHRoaXMud2lkdGhzID0gcHJvcGVydGllcy53aWR0aHM7CiAgICB0aGlzLmRlZmF1bHRXaWR0aCA9IHByb3BlcnRpZXMuZGVmYXVsdFdpZHRoOwogICAgdGhpcy50b1VuaWNvZGUgPSBwcm9wZXJ0aWVzLnRvVW5pY29kZTsKICAgIHRoaXMuc2VhY01hcCA9IHByb3BlcnRpZXMuc2VhY01hcDsKICB9CiAgZ2V0IHJlbmRlcmVyKCkgewogICAgY29uc3QgcmVuZGVyZXIgPSBGb250UmVuZGVyZXJGYWN0b3J5LmNyZWF0ZSh0aGlzLCBTRUFDX0FOQUxZU0lTX0VOQUJMRUQpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicmVuZGVyZXIiLCByZW5kZXJlcik7CiAgfQogIGV4cG9ydERhdGEoKSB7CiAgICBjb25zdCBkYXRhID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAoY29uc3QgcHJvcCBvZiBFWFBPUlRfREFUQV9QUk9QRVJUSUVTKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gdGhpc1twcm9wXTsKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBkYXRhW3Byb3BdID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpcy5mb250RXh0cmFQcm9wZXJ0aWVzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgZGF0YQogICAgICB9OwogICAgfQogICAgY29uc3QgZXh0cmEgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZm9yIChjb25zdCBwcm9wIG9mIEVYUE9SVF9EQVRBX0VYVFJBX1BST1BFUlRJRVMpIHsKICAgICAgY29uc3QgdmFsdWUgPSB0aGlzW3Byb3BdOwogICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGV4dHJhW3Byb3BdID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgIGRhdGEsCiAgICAgIGV4dHJhCiAgICB9OwogIH0KICBmYWxsYmFja1RvU3lzdGVtRm9udChwcm9wZXJ0aWVzKSB7CiAgICB0aGlzLm1pc3NpbmdGaWxlID0gdHJ1ZTsKICAgIGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgdHlwZQogICAgfSA9IHRoaXM7CiAgICBsZXQgZm9udE5hbWUgPSBub3JtYWxpemVGb250TmFtZShuYW1lKTsKICAgIGNvbnN0IHN0ZEZvbnRNYXAgPSBnZXRTdGRGb250TWFwKCksCiAgICAgIG5vblN0ZEZvbnRNYXAgPSBnZXROb25TdGRGb250TWFwKCk7CiAgICBjb25zdCBpc1N0YW5kYXJkRm9udCA9ICEhc3RkRm9udE1hcFtmb250TmFtZV07CiAgICBjb25zdCBpc01hcHBlZFRvU3RhbmRhcmRGb250ID0gISEobm9uU3RkRm9udE1hcFtmb250TmFtZV0gJiYgc3RkRm9udE1hcFtub25TdGRGb250TWFwW2ZvbnROYW1lXV0pOwogICAgZm9udE5hbWUgPSBzdGRGb250TWFwW2ZvbnROYW1lXSB8fCBub25TdGRGb250TWFwW2ZvbnROYW1lXSB8fCBmb250TmFtZTsKICAgIGNvbnN0IGZvbnRCYXNpY01ldHJpY3NNYXAgPSBnZXRGb250QmFzaWNNZXRyaWNzKCk7CiAgICBjb25zdCBtZXRyaWNzID0gZm9udEJhc2ljTWV0cmljc01hcFtmb250TmFtZV07CiAgICBpZiAobWV0cmljcykgewogICAgICBpZiAoaXNOYU4odGhpcy5hc2NlbnQpKSB7CiAgICAgICAgdGhpcy5hc2NlbnQgPSBtZXRyaWNzLmFzY2VudCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgICAgfQogICAgICBpZiAoaXNOYU4odGhpcy5kZXNjZW50KSkgewogICAgICAgIHRoaXMuZGVzY2VudCA9IG1ldHJpY3MuZGVzY2VudCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgICAgfQogICAgICBpZiAoaXNOYU4odGhpcy5jYXBIZWlnaHQpKSB7CiAgICAgICAgdGhpcy5jYXBIZWlnaHQgPSBtZXRyaWNzLmNhcEhlaWdodCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgICAgfQogICAgfQogICAgdGhpcy5ib2xkID0gL2JvbGQvZ2kudGVzdChmb250TmFtZSk7CiAgICB0aGlzLml0YWxpYyA9IC9vYmxpcXVlfGl0YWxpYy9naS50ZXN0KGZvbnROYW1lKTsKICAgIHRoaXMuYmxhY2sgPSAvQmxhY2svZy50ZXN0KG5hbWUpOwogICAgY29uc3QgaXNOYXJyb3cgPSAvTmFycm93L2cudGVzdChuYW1lKTsKICAgIHRoaXMucmVtZWFzdXJlID0gKCFpc1N0YW5kYXJkRm9udCB8fCBpc05hcnJvdykgJiYgT2JqZWN0LmtleXModGhpcy53aWR0aHMpLmxlbmd0aCA+IDA7CiAgICBpZiAoKGlzU3RhbmRhcmRGb250IHx8IGlzTWFwcGVkVG9TdGFuZGFyZEZvbnQpICYmIHR5cGUgPT09ICJDSURGb250VHlwZTIiICYmIHRoaXMuY2lkRW5jb2Rpbmcuc3RhcnRzV2l0aCgiSWRlbnRpdHktIikpIHsKICAgICAgY29uc3QgY2lkVG9HaWRNYXAgPSBwcm9wZXJ0aWVzLmNpZFRvR2lkTWFwOwogICAgICBjb25zdCBtYXAgPSBbXTsKICAgICAgYXBwbHlTdGFuZGFyZEZvbnRHbHlwaE1hcChtYXAsIGdldEdseXBoTWFwRm9yU3RhbmRhcmRGb250cygpKTsKICAgICAgaWYgKC9BcmlhbC0/QmxhY2svaS50ZXN0KG5hbWUpKSB7CiAgICAgICAgYXBwbHlTdGFuZGFyZEZvbnRHbHlwaE1hcChtYXAsIGdldFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQXJpYWxCbGFjaygpKTsKICAgICAgfSBlbHNlIGlmICgvQ2FsaWJyaS9pLnRlc3QobmFtZSkpIHsKICAgICAgICBhcHBseVN0YW5kYXJkRm9udEdseXBoTWFwKG1hcCwgZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JDYWxpYnJpKCkpOwogICAgICB9CiAgICAgIGlmIChjaWRUb0dpZE1hcCkgewogICAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gbWFwKSB7CiAgICAgICAgICBjb25zdCBjaWQgPSBtYXBbY2hhckNvZGVdOwogICAgICAgICAgaWYgKGNpZFRvR2lkTWFwW2NpZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBtYXBbK2NoYXJDb2RlXSA9IGNpZFRvR2lkTWFwW2NpZF07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjaWRUb0dpZE1hcC5sZW5ndGggIT09IHRoaXMudG9Vbmljb2RlLmxlbmd0aCAmJiBwcm9wZXJ0aWVzLmhhc0luY2x1ZGVkVG9Vbmljb2RlTWFwICYmIHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgICAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpIHsKICAgICAgICAgICAgY29uc3QgY2lkID0gbWFwW2NoYXJDb2RlXTsKICAgICAgICAgICAgaWYgKGNpZFRvR2lkTWFwW2NpZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIG1hcFsrY2hhckNvZGVdID0gdW5pY29kZUNoYXJDb2RlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCEodGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCkpIHsKICAgICAgICB0aGlzLnRvVW5pY29kZS5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgdW5pY29kZUNoYXJDb2RlKSB7CiAgICAgICAgICBtYXBbK2NoYXJDb2RlXSA9IHVuaWNvZGVDaGFyQ29kZTsKICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLnRvRm9udENoYXIgPSBtYXA7CiAgICAgIHRoaXMudG9Vbmljb2RlID0gbmV3IFRvVW5pY29kZU1hcChtYXApOwogICAgfSBlbHNlIGlmICgvU3ltYm9sL2kudGVzdChmb250TmFtZSkpIHsKICAgICAgdGhpcy50b0ZvbnRDaGFyID0gYnVpbGRUb0ZvbnRDaGFyKFN5bWJvbFNldEVuY29kaW5nLCBnZXRHbHlwaHNVbmljb2RlKCksIHRoaXMuZGlmZmVyZW5jZXMpOwogICAgfSBlbHNlIGlmICgvRGluZ2JhdHMvaS50ZXN0KGZvbnROYW1lKSkgewogICAgICB0aGlzLnRvRm9udENoYXIgPSBidWlsZFRvRm9udENoYXIoWmFwZkRpbmdiYXRzRW5jb2RpbmcsIGdldERpbmdiYXRzR2x5cGhzVW5pY29kZSgpLCB0aGlzLmRpZmZlcmVuY2VzKTsKICAgIH0gZWxzZSBpZiAoaXNTdGFuZGFyZEZvbnQgfHwgaXNNYXBwZWRUb1N0YW5kYXJkRm9udCkgewogICAgICBjb25zdCBtYXAgPSBidWlsZFRvRm9udENoYXIodGhpcy5kZWZhdWx0RW5jb2RpbmcsIGdldEdseXBoc1VuaWNvZGUoKSwgdGhpcy5kaWZmZXJlbmNlcyk7CiAgICAgIGlmICh0eXBlID09PSAiQ0lERm9udFR5cGUyIiAmJiAhdGhpcy5jaWRFbmNvZGluZy5zdGFydHNXaXRoKCJJZGVudGl0eS0iKSAmJiAhKHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApKSB7CiAgICAgICAgdGhpcy50b1VuaWNvZGUuZm9yRWFjaChmdW5jdGlvbiAoY2hhckNvZGUsIHVuaWNvZGVDaGFyQ29kZSkgewogICAgICAgICAgbWFwWytjaGFyQ29kZV0gPSB1bmljb2RlQ2hhckNvZGU7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy50b0ZvbnRDaGFyID0gbWFwOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICAgICAgY29uc3QgbWFwID0gW107CiAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpID0+IHsKICAgICAgICBpZiAoIXRoaXMuY29tcG9zaXRlKSB7CiAgICAgICAgICBjb25zdCBnbHlwaE5hbWUgPSB0aGlzLmRpZmZlcmVuY2VzW2NoYXJDb2RlXSB8fCB0aGlzLmRlZmF1bHRFbmNvZGluZ1tjaGFyQ29kZV07CiAgICAgICAgICBjb25zdCB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICAgICAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgICAgICAgdW5pY29kZUNoYXJDb2RlID0gdW5pY29kZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbWFwWytjaGFyQ29kZV0gPSB1bmljb2RlQ2hhckNvZGU7CiAgICAgIH0pOwogICAgICBpZiAodGhpcy5jb21wb3NpdGUgJiYgdGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCkgewogICAgICAgIGlmICgvVGFob21hfFZlcmRhbmEvaS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICBhcHBseVN0YW5kYXJkRm9udEdseXBoTWFwKG1hcCwgZ2V0R2x5cGhNYXBGb3JTdGFuZGFyZEZvbnRzKCkpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnRvRm9udENoYXIgPSBtYXA7CiAgICB9CiAgICBhbWVuZEZhbGxiYWNrVG9Vbmljb2RlKHByb3BlcnRpZXMpOwogICAgdGhpcy5sb2FkZWROYW1lID0gZm9udE5hbWUuc3BsaXQoIi0iLCAxKVswXTsKICB9CiAgY2hlY2tBbmRSZXBhaXIobmFtZSwgZm9udCwgcHJvcGVydGllcykgewogICAgY29uc3QgVkFMSURfVEFCTEVTID0gWyJPUy8yIiwgImNtYXAiLCAiaGVhZCIsICJoaGVhIiwgImhtdHgiLCAibWF4cCIsICJuYW1lIiwgInBvc3QiLCAibG9jYSIsICJnbHlmIiwgImZwZ20iLCAicHJlcCIsICJjdnQgIiwgIkNGRiAiXTsKICAgIGZ1bmN0aW9uIHJlYWRUYWJsZXMoZmlsZSwgbnVtVGFibGVzKSB7CiAgICAgIGNvbnN0IHRhYmxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHRhYmxlc1siT1MvMiJdID0gbnVsbDsKICAgICAgdGFibGVzLmNtYXAgPSBudWxsOwogICAgICB0YWJsZXMuaGVhZCA9IG51bGw7CiAgICAgIHRhYmxlcy5oaGVhID0gbnVsbDsKICAgICAgdGFibGVzLmhtdHggPSBudWxsOwogICAgICB0YWJsZXMubWF4cCA9IG51bGw7CiAgICAgIHRhYmxlcy5uYW1lID0gbnVsbDsKICAgICAgdGFibGVzLnBvc3QgPSBudWxsOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgICAgY29uc3QgdGFibGUgPSByZWFkVGFibGVFbnRyeShmaWxlKTsKICAgICAgICBpZiAoIVZBTElEX1RBQkxFUy5pbmNsdWRlcyh0YWJsZS50YWcpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRhYmxlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRhYmxlc1t0YWJsZS50YWddID0gdGFibGU7CiAgICAgIH0KICAgICAgcmV0dXJuIHRhYmxlczsKICAgIH0KICAgIGZ1bmN0aW9uIHJlYWRUYWJsZUVudHJ5KGZpbGUpIHsKICAgICAgY29uc3QgdGFnID0gZmlsZS5nZXRTdHJpbmcoNCk7CiAgICAgIGNvbnN0IGNoZWNrc3VtID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICBjb25zdCBvZmZzZXQgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgIGNvbnN0IGxlbmd0aCA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgY29uc3QgcHJldmlvdXNQb3NpdGlvbiA9IGZpbGUucG9zOwogICAgICBmaWxlLnBvcyA9IGZpbGUuc3RhcnQgfHwgMDsKICAgICAgZmlsZS5za2lwKG9mZnNldCk7CiAgICAgIGNvbnN0IGRhdGEgPSBmaWxlLmdldEJ5dGVzKGxlbmd0aCk7CiAgICAgIGZpbGUucG9zID0gcHJldmlvdXNQb3NpdGlvbjsKICAgICAgaWYgKHRhZyA9PT0gImhlYWQiKSB7CiAgICAgICAgZGF0YVs4XSA9IGRhdGFbOV0gPSBkYXRhWzEwXSA9IGRhdGFbMTFdID0gMDsKICAgICAgICBkYXRhWzE3XSB8PSAweDIwOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgdGFnLAogICAgICAgIGNoZWNrc3VtLAogICAgICAgIGxlbmd0aCwKICAgICAgICBvZmZzZXQsCiAgICAgICAgZGF0YQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gcmVhZE9wZW5UeXBlSGVhZGVyKHR0ZikgewogICAgICByZXR1cm4gewogICAgICAgIHZlcnNpb246IHR0Zi5nZXRTdHJpbmcoNCksCiAgICAgICAgbnVtVGFibGVzOiB0dGYuZ2V0VWludDE2KCksCiAgICAgICAgc2VhcmNoUmFuZ2U6IHR0Zi5nZXRVaW50MTYoKSwKICAgICAgICBlbnRyeVNlbGVjdG9yOiB0dGYuZ2V0VWludDE2KCksCiAgICAgICAgcmFuZ2VTaGlmdDogdHRmLmdldFVpbnQxNigpCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiByZWFkVHJ1ZVR5cGVDb2xsZWN0aW9uSGVhZGVyKHR0YykgewogICAgICBjb25zdCB0dGNUYWcgPSB0dGMuZ2V0U3RyaW5nKDQpOwogICAgICBhc3NlcnQodHRjVGFnID09PSAidHRjZiIsICJNdXN0IGJlIGEgVHJ1ZVR5cGUgQ29sbGVjdGlvbiBmb250LiIpOwogICAgICBjb25zdCBtYWpvclZlcnNpb24gPSB0dGMuZ2V0VWludDE2KCk7CiAgICAgIGNvbnN0IG1pbm9yVmVyc2lvbiA9IHR0Yy5nZXRVaW50MTYoKTsKICAgICAgY29uc3QgbnVtRm9udHMgPSB0dGMuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgY29uc3Qgb2Zmc2V0VGFibGUgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Gb250czsgaSsrKSB7CiAgICAgICAgb2Zmc2V0VGFibGUucHVzaCh0dGMuZ2V0SW50MzIoKSA+Pj4gMCk7CiAgICAgIH0KICAgICAgY29uc3QgaGVhZGVyID0gewogICAgICAgIHR0Y1RhZywKICAgICAgICBtYWpvclZlcnNpb24sCiAgICAgICAgbWlub3JWZXJzaW9uLAogICAgICAgIG51bUZvbnRzLAogICAgICAgIG9mZnNldFRhYmxlCiAgICAgIH07CiAgICAgIHN3aXRjaCAobWFqb3JWZXJzaW9uKSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIGhlYWRlcjsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBoZWFkZXIuZHNpZ1RhZyA9IHR0Yy5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgaGVhZGVyLmRzaWdMZW5ndGggPSB0dGMuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgIGhlYWRlci5kc2lnT2Zmc2V0ID0gdHRjLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICByZXR1cm4gaGVhZGVyOwogICAgICB9CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBUcnVlVHlwZSBDb2xsZWN0aW9uIG1ham9yVmVyc2lvbjogJHttYWpvclZlcnNpb259LmApOwogICAgfQogICAgZnVuY3Rpb24gcmVhZFRydWVUeXBlQ29sbGVjdGlvbkRhdGEodHRjLCBmb250TmFtZSkgewogICAgICBjb25zdCB7CiAgICAgICAgbnVtRm9udHMsCiAgICAgICAgb2Zmc2V0VGFibGUKICAgICAgfSA9IHJlYWRUcnVlVHlwZUNvbGxlY3Rpb25IZWFkZXIodHRjKTsKICAgICAgY29uc3QgZm9udE5hbWVQYXJ0cyA9IGZvbnROYW1lLnNwbGl0KCIrIik7CiAgICAgIGxldCBmYWxsYmFja0RhdGE7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRm9udHM7IGkrKykgewogICAgICAgIHR0Yy5wb3MgPSAodHRjLnN0YXJ0IHx8IDApICsgb2Zmc2V0VGFibGVbaV07CiAgICAgICAgY29uc3QgcG90ZW50aWFsSGVhZGVyID0gcmVhZE9wZW5UeXBlSGVhZGVyKHR0Yyk7CiAgICAgICAgY29uc3QgcG90ZW50aWFsVGFibGVzID0gcmVhZFRhYmxlcyh0dGMsIHBvdGVudGlhbEhlYWRlci5udW1UYWJsZXMpOwogICAgICAgIGlmICghcG90ZW50aWFsVGFibGVzLm5hbWUpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignVHJ1ZVR5cGUgQ29sbGVjdGlvbiBmb250IG11c3QgY29udGFpbiBhICJuYW1lIiB0YWJsZS4nKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgW25hbWVUYWJsZV0gPSByZWFkTmFtZVRhYmxlKHBvdGVudGlhbFRhYmxlcy5uYW1lKTsKICAgICAgICBmb3IgKGxldCBqID0gMCwgamogPSBuYW1lVGFibGUubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgZm9yIChsZXQgayA9IDAsIGtrID0gbmFtZVRhYmxlW2pdLmxlbmd0aDsgayA8IGtrOyBrKyspIHsKICAgICAgICAgICAgY29uc3QgbmFtZUVudHJ5ID0gbmFtZVRhYmxlW2pdW2tdPy5yZXBsYWNlQWxsKC9ccy9nLCAiIik7CiAgICAgICAgICAgIGlmICghbmFtZUVudHJ5KSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5hbWVFbnRyeSA9PT0gZm9udE5hbWUpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaGVhZGVyOiBwb3RlbnRpYWxIZWFkZXIsCiAgICAgICAgICAgICAgICB0YWJsZXM6IHBvdGVudGlhbFRhYmxlcwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZvbnROYW1lUGFydHMubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBmb250TmFtZVBhcnRzKSB7CiAgICAgICAgICAgICAgaWYgKG5hbWVFbnRyeSA9PT0gcGFydCkgewogICAgICAgICAgICAgICAgZmFsbGJhY2tEYXRhID0gewogICAgICAgICAgICAgICAgICBuYW1lOiBwYXJ0LAogICAgICAgICAgICAgICAgICBoZWFkZXI6IHBvdGVudGlhbEhlYWRlciwKICAgICAgICAgICAgICAgICAgdGFibGVzOiBwb3RlbnRpYWxUYWJsZXMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChmYWxsYmFja0RhdGEpIHsKICAgICAgICB3YXJuKGBUcnVlVHlwZSBDb2xsZWN0aW9uIGRvZXMgbm90IGNvbnRhaW4gIiR7Zm9udE5hbWV9IiBmb250LCBgICsgYGZhbGxpbmcgYmFjayB0byAiJHtmYWxsYmFja0RhdGEubmFtZX0iIGZvbnQgaW5zdGVhZC5gKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaGVhZGVyOiBmYWxsYmFja0RhdGEuaGVhZGVyLAogICAgICAgICAgdGFibGVzOiBmYWxsYmFja0RhdGEudGFibGVzCiAgICAgICAgfTsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYFRydWVUeXBlIENvbGxlY3Rpb24gZG9lcyBub3QgY29udGFpbiAiJHtmb250TmFtZX0iIGZvbnQuYCk7CiAgICB9CiAgICBmdW5jdGlvbiByZWFkQ21hcFRhYmxlKGNtYXAsIGZpbGUsIGlzU3ltYm9saWNGb250LCBoYXNFbmNvZGluZykgewogICAgICBpZiAoIWNtYXApIHsKICAgICAgICB3YXJuKCJObyBjbWFwIHRhYmxlIGF2YWlsYWJsZS4iKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcGxhdGZvcm1JZDogLTEsCiAgICAgICAgICBlbmNvZGluZ0lkOiAtMSwKICAgICAgICAgIG1hcHBpbmdzOiBbXSwKICAgICAgICAgIGhhc1Nob3J0Q21hcDogZmFsc2UKICAgICAgICB9OwogICAgICB9CiAgICAgIGxldCBzZWdtZW50OwogICAgICBsZXQgc3RhcnQgPSAoZmlsZS5zdGFydCB8fCAwKSArIGNtYXAub2Zmc2V0OwogICAgICBmaWxlLnBvcyA9IHN0YXJ0OwogICAgICBmaWxlLnNraXAoMik7CiAgICAgIGNvbnN0IG51bVRhYmxlcyA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgIGxldCBwb3RlbnRpYWxUYWJsZTsKICAgICAgbGV0IGNhbkJyZWFrID0gZmFsc2U7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgICBjb25zdCBwbGF0Zm9ybUlkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBjb25zdCBlbmNvZGluZ0lkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBjb25zdCBvZmZzZXQgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgbGV0IHVzZVRhYmxlID0gZmFsc2U7CiAgICAgICAgaWYgKHBvdGVudGlhbFRhYmxlPy5wbGF0Zm9ybUlkID09PSBwbGF0Zm9ybUlkICYmIHBvdGVudGlhbFRhYmxlPy5lbmNvZGluZ0lkID09PSBlbmNvZGluZ0lkKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHBsYXRmb3JtSWQgPT09IDAgJiYgKGVuY29kaW5nSWQgPT09IDAgfHwgZW5jb2RpbmdJZCA9PT0gMSB8fCBlbmNvZGluZ0lkID09PSAzKSkgewogICAgICAgICAgdXNlVGFibGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAocGxhdGZvcm1JZCA9PT0gMSAmJiBlbmNvZGluZ0lkID09PSAwKSB7CiAgICAgICAgICB1c2VUYWJsZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChwbGF0Zm9ybUlkID09PSAzICYmIGVuY29kaW5nSWQgPT09IDEgJiYgKGhhc0VuY29kaW5nIHx8ICFwb3RlbnRpYWxUYWJsZSkpIHsKICAgICAgICAgIHVzZVRhYmxlID0gdHJ1ZTsKICAgICAgICAgIGlmICghaXNTeW1ib2xpY0ZvbnQpIHsKICAgICAgICAgICAgY2FuQnJlYWsgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaXNTeW1ib2xpY0ZvbnQgJiYgcGxhdGZvcm1JZCA9PT0gMyAmJiBlbmNvZGluZ0lkID09PSAwKSB7CiAgICAgICAgICB1c2VUYWJsZSA9IHRydWU7CiAgICAgICAgICBsZXQgY29ycmVjdGx5U29ydGVkID0gdHJ1ZTsKICAgICAgICAgIGlmIChpIDwgbnVtVGFibGVzIC0gMSkgewogICAgICAgICAgICBjb25zdCBuZXh0Qnl0ZXMgPSBmaWxlLnBlZWtCeXRlcygyKSwKICAgICAgICAgICAgICBuZXh0UGxhdGZvcm1JZCA9IGludDE2KG5leHRCeXRlc1swXSwgbmV4dEJ5dGVzWzFdKTsKICAgICAgICAgICAgaWYgKG5leHRQbGF0Zm9ybUlkIDwgcGxhdGZvcm1JZCkgewogICAgICAgICAgICAgIGNvcnJlY3RseVNvcnRlZCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29ycmVjdGx5U29ydGVkKSB7CiAgICAgICAgICAgIGNhbkJyZWFrID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHVzZVRhYmxlKSB7CiAgICAgICAgICBwb3RlbnRpYWxUYWJsZSA9IHsKICAgICAgICAgICAgcGxhdGZvcm1JZCwKICAgICAgICAgICAgZW5jb2RpbmdJZCwKICAgICAgICAgICAgb2Zmc2V0CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAoY2FuQnJlYWspIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocG90ZW50aWFsVGFibGUpIHsKICAgICAgICBmaWxlLnBvcyA9IHN0YXJ0ICsgcG90ZW50aWFsVGFibGUub2Zmc2V0OwogICAgICB9CiAgICAgIGlmICghcG90ZW50aWFsVGFibGUgfHwgZmlsZS5wZWVrQnl0ZSgpID09PSAtMSkgewogICAgICAgIHdhcm4oIkNvdWxkIG5vdCBmaW5kIGEgcHJlZmVycmVkIGNtYXAgdGFibGUuIik7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHBsYXRmb3JtSWQ6IC0xLAogICAgICAgICAgZW5jb2RpbmdJZDogLTEsCiAgICAgICAgICBtYXBwaW5nczogW10sCiAgICAgICAgICBoYXNTaG9ydENtYXA6IGZhbHNlCiAgICAgICAgfTsKICAgICAgfQogICAgICBjb25zdCBmb3JtYXQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICBsZXQgaGFzU2hvcnRDbWFwID0gZmFsc2U7CiAgICAgIGNvbnN0IG1hcHBpbmdzID0gW107CiAgICAgIGxldCBqLCBnbHlwaElkOwogICAgICBpZiAoZm9ybWF0ID09PSAwKSB7CiAgICAgICAgZmlsZS5za2lwKDIgKyAyKTsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgMjU2OyBqKyspIHsKICAgICAgICAgIGNvbnN0IGluZGV4ID0gZmlsZS5nZXRCeXRlKCk7CiAgICAgICAgICBpZiAoIWluZGV4KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgIGNoYXJDb2RlOiBqLAogICAgICAgICAgICBnbHlwaElkOiBpbmRleAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGhhc1Nob3J0Q21hcCA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAyKSB7CiAgICAgICAgZmlsZS5za2lwKDIgKyAyKTsKICAgICAgICBjb25zdCBzdWJIZWFkZXJLZXlzID0gW107CiAgICAgICAgbGV0IG1heFN1YkhlYWRlcktleSA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7IGkrKykgewogICAgICAgICAgY29uc3Qgc3ViSGVhZGVyS2V5ID0gZmlsZS5nZXRVaW50MTYoKSA+PiAzOwogICAgICAgICAgc3ViSGVhZGVyS2V5cy5wdXNoKHN1YkhlYWRlcktleSk7CiAgICAgICAgICBtYXhTdWJIZWFkZXJLZXkgPSBNYXRoLm1heChzdWJIZWFkZXJLZXksIG1heFN1YkhlYWRlcktleSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN1YkhlYWRlcnMgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBtYXhTdWJIZWFkZXJLZXk7IGkrKykgewogICAgICAgICAgc3ViSGVhZGVycy5wdXNoKHsKICAgICAgICAgICAgZmlyc3RDb2RlOiBmaWxlLmdldFVpbnQxNigpLAogICAgICAgICAgICBlbnRyeUNvdW50OiBmaWxlLmdldFVpbnQxNigpLAogICAgICAgICAgICBpZERlbHRhOiBzaWduZWRJbnQxNihmaWxlLmdldEJ5dGUoKSwgZmlsZS5nZXRCeXRlKCkpLAogICAgICAgICAgICBpZFJhbmdlUG9zOiBmaWxlLnBvcyArIGZpbGUuZ2V0VWludDE2KCkKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgaSsrKSB7CiAgICAgICAgICBpZiAoc3ViSGVhZGVyS2V5c1tpXSA9PT0gMCkgewogICAgICAgICAgICBmaWxlLnBvcyA9IHN1YkhlYWRlcnNbMF0uaWRSYW5nZVBvcyArIDIgKiBpOwogICAgICAgICAgICBnbHlwaElkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgICAgY2hhckNvZGU6IGksCiAgICAgICAgICAgICAgZ2x5cGhJZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSBzdWJIZWFkZXJzW3N1YkhlYWRlcktleXNbaV1dOwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcy5lbnRyeUNvdW50OyBqKyspIHsKICAgICAgICAgICAgICBjb25zdCBjaGFyQ29kZSA9IChpIDw8IDgpICsgaiArIHMuZmlyc3RDb2RlOwogICAgICAgICAgICAgIGZpbGUucG9zID0gcy5pZFJhbmdlUG9zICsgMiAqIGo7CiAgICAgICAgICAgICAgZ2x5cGhJZCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgICAgICAgaWYgKGdseXBoSWQgIT09IDApIHsKICAgICAgICAgICAgICAgIGdseXBoSWQgPSAoZ2x5cGhJZCArIHMuaWREZWx0YSkgJSA2NTUzNjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgICAgICBjaGFyQ29kZSwKICAgICAgICAgICAgICAgIGdseXBoSWQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09IDQpIHsKICAgICAgICBmaWxlLnNraXAoMiArIDIpOwogICAgICAgIGNvbnN0IHNlZ0NvdW50ID0gZmlsZS5nZXRVaW50MTYoKSA+PiAxOwogICAgICAgIGZpbGUuc2tpcCg2KTsKICAgICAgICBjb25zdCBzZWdtZW50cyA9IFtdOwogICAgICAgIGxldCBzZWdJbmRleDsKICAgICAgICBmb3IgKHNlZ0luZGV4ID0gMDsgc2VnSW5kZXggPCBzZWdDb3VudDsgc2VnSW5kZXgrKykgewogICAgICAgICAgc2VnbWVudHMucHVzaCh7CiAgICAgICAgICAgIGVuZDogZmlsZS5nZXRVaW50MTYoKQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGZpbGUuc2tpcCgyKTsKICAgICAgICBmb3IgKHNlZ0luZGV4ID0gMDsgc2VnSW5kZXggPCBzZWdDb3VudDsgc2VnSW5kZXgrKykgewogICAgICAgICAgc2VnbWVudHNbc2VnSW5kZXhdLnN0YXJ0ID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICB9CiAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgIHNlZ21lbnRzW3NlZ0luZGV4XS5kZWx0YSA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgfQogICAgICAgIGxldCBvZmZzZXRzQ291bnQgPSAwLAogICAgICAgICAgb2Zmc2V0SW5kZXg7CiAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgIHNlZ21lbnQgPSBzZWdtZW50c1tzZWdJbmRleF07CiAgICAgICAgICBjb25zdCByYW5nZU9mZnNldCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgICBpZiAoIXJhbmdlT2Zmc2V0KSB7CiAgICAgICAgICAgIHNlZ21lbnQub2Zmc2V0SW5kZXggPSAtMTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBvZmZzZXRJbmRleCA9IChyYW5nZU9mZnNldCA+PiAxKSAtIChzZWdDb3VudCAtIHNlZ0luZGV4KTsKICAgICAgICAgIHNlZ21lbnQub2Zmc2V0SW5kZXggPSBvZmZzZXRJbmRleDsKICAgICAgICAgIG9mZnNldHNDb3VudCA9IE1hdGgubWF4KG9mZnNldHNDb3VudCwgb2Zmc2V0SW5kZXggKyBzZWdtZW50LmVuZCAtIHNlZ21lbnQuc3RhcnQgKyAxKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgb2Zmc2V0cyA9IFtdOwogICAgICAgIGZvciAoaiA9IDA7IGogPCBvZmZzZXRzQ291bnQ7IGorKykgewogICAgICAgICAgb2Zmc2V0cy5wdXNoKGZpbGUuZ2V0VWludDE2KCkpOwogICAgICAgIH0KICAgICAgICBmb3IgKHNlZ0luZGV4ID0gMDsgc2VnSW5kZXggPCBzZWdDb3VudDsgc2VnSW5kZXgrKykgewogICAgICAgICAgc2VnbWVudCA9IHNlZ21lbnRzW3NlZ0luZGV4XTsKICAgICAgICAgIHN0YXJ0ID0gc2VnbWVudC5zdGFydDsKICAgICAgICAgIGNvbnN0IGVuZCA9IHNlZ21lbnQuZW5kOwogICAgICAgICAgY29uc3QgZGVsdGEgPSBzZWdtZW50LmRlbHRhOwogICAgICAgICAgb2Zmc2V0SW5kZXggPSBzZWdtZW50Lm9mZnNldEluZGV4OwogICAgICAgICAgZm9yIChqID0gc3RhcnQ7IGogPD0gZW5kOyBqKyspIHsKICAgICAgICAgICAgaWYgKGogPT09IDB4ZmZmZikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdseXBoSWQgPSBvZmZzZXRJbmRleCA8IDAgPyBqIDogb2Zmc2V0c1tvZmZzZXRJbmRleCArIGogLSBzdGFydF07CiAgICAgICAgICAgIGdseXBoSWQgPSBnbHlwaElkICsgZGVsdGEgJiAweGZmZmY7CiAgICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICAgIGNoYXJDb2RlOiBqLAogICAgICAgICAgICAgIGdseXBoSWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gNikgewogICAgICAgIGZpbGUuc2tpcCgyICsgMik7CiAgICAgICAgY29uc3QgZmlyc3RDb2RlID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBjb25zdCBlbnRyeUNvdW50ID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgZW50cnlDb3VudDsgaisrKSB7CiAgICAgICAgICBnbHlwaElkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICAgIGNvbnN0IGNoYXJDb2RlID0gZmlyc3RDb2RlICsgajsKICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICBjaGFyQ29kZSwKICAgICAgICAgICAgZ2x5cGhJZAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gMTIpIHsKICAgICAgICBmaWxlLnNraXAoMiArIDQgKyA0KTsKICAgICAgICBjb25zdCBuR3JvdXBzID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgIGZvciAoaiA9IDA7IGogPCBuR3JvdXBzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHN0YXJ0Q2hhckNvZGUgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICBjb25zdCBlbmRDaGFyQ29kZSA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgIGxldCBnbHlwaENvZGUgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICBmb3IgKGxldCBjaGFyQ29kZSA9IHN0YXJ0Q2hhckNvZGU7IGNoYXJDb2RlIDw9IGVuZENoYXJDb2RlOyBjaGFyQ29kZSsrKSB7CiAgICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICAgIGNoYXJDb2RlLAogICAgICAgICAgICAgIGdseXBoSWQ6IGdseXBoQ29kZSsrCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJjbWFwIHRhYmxlIGhhcyB1bnN1cHBvcnRlZCBmb3JtYXQ6ICIgKyBmb3JtYXQpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwbGF0Zm9ybUlkOiAtMSwKICAgICAgICAgIGVuY29kaW5nSWQ6IC0xLAogICAgICAgICAgbWFwcGluZ3M6IFtdLAogICAgICAgICAgaGFzU2hvcnRDbWFwOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0KICAgICAgbWFwcGluZ3Muc29ydCgoYSwgYikgPT4gYS5jaGFyQ29kZSAtIGIuY2hhckNvZGUpOwogICAgICBjb25zdCBmaW5hbE1hcHBpbmdzID0gW10sCiAgICAgICAgc2VlbkNoYXJDb2RlcyA9IG5ldyBTZXQoKTsKICAgICAgZm9yIChjb25zdCBtYXAgb2YgbWFwcGluZ3MpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBjaGFyQ29kZQogICAgICAgIH0gPSBtYXA7CiAgICAgICAgaWYgKHNlZW5DaGFyQ29kZXMuaGFzKGNoYXJDb2RlKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHNlZW5DaGFyQ29kZXMuYWRkKGNoYXJDb2RlKTsKICAgICAgICBmaW5hbE1hcHBpbmdzLnB1c2gobWFwKTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIHBsYXRmb3JtSWQ6IHBvdGVudGlhbFRhYmxlLnBsYXRmb3JtSWQsCiAgICAgICAgZW5jb2RpbmdJZDogcG90ZW50aWFsVGFibGUuZW5jb2RpbmdJZCwKICAgICAgICBtYXBwaW5nczogZmluYWxNYXBwaW5ncywKICAgICAgICBoYXNTaG9ydENtYXAKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHNhbml0aXplTWV0cmljcyhmaWxlLCBoZWFkZXIsIG1ldHJpY3MsIGhlYWRUYWJsZSwgbnVtR2x5cGhzLCBkdXBGaXJzdEVudHJ5KSB7CiAgICAgIGlmICghaGVhZGVyKSB7CiAgICAgICAgaWYgKG1ldHJpY3MpIHsKICAgICAgICAgIG1ldHJpY3MuZGF0YSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmaWxlLnBvcyA9IChmaWxlLnN0YXJ0IHx8IDApICsgaGVhZGVyLm9mZnNldDsKICAgICAgZmlsZS5wb3MgKz0gNDsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgY29uc3QgY2FyZXRPZmZzZXQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICBmaWxlLnBvcyArPSA4OwogICAgICBmaWxlLnBvcyArPSAyOwogICAgICBsZXQgbnVtT2ZNZXRyaWNzID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgaWYgKGNhcmV0T2Zmc2V0ICE9PSAwKSB7CiAgICAgICAgY29uc3QgbWFjU3R5bGUgPSBpbnQxNihoZWFkVGFibGUuZGF0YVs0NF0sIGhlYWRUYWJsZS5kYXRhWzQ1XSk7CiAgICAgICAgaWYgKCEobWFjU3R5bGUgJiAyKSkgewogICAgICAgICAgaGVhZGVyLmRhdGFbMjJdID0gMDsKICAgICAgICAgIGhlYWRlci5kYXRhWzIzXSA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChudW1PZk1ldHJpY3MgPiBudW1HbHlwaHMpIHsKICAgICAgICBpbmZvKGBUaGUgbnVtT2ZNZXRyaWNzICgke251bU9mTWV0cmljc30pIHNob3VsZCBub3QgYmUgYCArIGBncmVhdGVyIHRoYW4gdGhlIG51bUdseXBocyAoJHtudW1HbHlwaHN9KS5gKTsKICAgICAgICBudW1PZk1ldHJpY3MgPSBudW1HbHlwaHM7CiAgICAgICAgaGVhZGVyLmRhdGFbMzRdID0gKG51bU9mTWV0cmljcyAmIDB4ZmYwMCkgPj4gODsKICAgICAgICBoZWFkZXIuZGF0YVszNV0gPSBudW1PZk1ldHJpY3MgJiAweDAwZmY7CiAgICAgIH0KICAgICAgY29uc3QgbnVtT2ZTaWRlYmVhcmluZ3MgPSBudW1HbHlwaHMgLSBudW1PZk1ldHJpY3M7CiAgICAgIGNvbnN0IG51bU1pc3NpbmcgPSBudW1PZlNpZGViZWFyaW5ncyAtIChtZXRyaWNzLmxlbmd0aCAtIG51bU9mTWV0cmljcyAqIDQgPj4gMSk7CiAgICAgIGlmIChudW1NaXNzaW5nID4gMCkgewogICAgICAgIGNvbnN0IGVudHJpZXMgPSBuZXcgVWludDhBcnJheShtZXRyaWNzLmxlbmd0aCArIG51bU1pc3NpbmcgKiAyKTsKICAgICAgICBlbnRyaWVzLnNldChtZXRyaWNzLmRhdGEpOwogICAgICAgIGlmIChkdXBGaXJzdEVudHJ5KSB7CiAgICAgICAgICBlbnRyaWVzW21ldHJpY3MubGVuZ3RoXSA9IG1ldHJpY3MuZGF0YVsyXTsKICAgICAgICAgIGVudHJpZXNbbWV0cmljcy5sZW5ndGggKyAxXSA9IG1ldHJpY3MuZGF0YVszXTsKICAgICAgICB9CiAgICAgICAgbWV0cmljcy5kYXRhID0gZW50cmllczsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2FuaXRpemVHbHlwaChzb3VyY2UsIHNvdXJjZVN0YXJ0LCBzb3VyY2VFbmQsIGRlc3QsIGRlc3RTdGFydCwgaGludHNWYWxpZCkgewogICAgICBjb25zdCBnbHlwaFByb2ZpbGUgPSB7CiAgICAgICAgbGVuZ3RoOiAwLAogICAgICAgIHNpemVPZkluc3RydWN0aW9uczogMAogICAgICB9OwogICAgICBpZiAoc291cmNlU3RhcnQgPCAwIHx8IHNvdXJjZVN0YXJ0ID49IHNvdXJjZS5sZW5ndGggfHwgc291cmNlRW5kID4gc291cmNlLmxlbmd0aCB8fCBzb3VyY2VFbmQgLSBzb3VyY2VTdGFydCA8PSAxMikgewogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgY29uc3QgZ2x5ZiA9IHNvdXJjZS5zdWJhcnJheShzb3VyY2VTdGFydCwgc291cmNlRW5kKTsKICAgICAgY29uc3QgeE1pbiA9IHNpZ25lZEludDE2KGdseWZbMl0sIGdseWZbM10pOwogICAgICBjb25zdCB5TWluID0gc2lnbmVkSW50MTYoZ2x5Zls0XSwgZ2x5Zls1XSk7CiAgICAgIGNvbnN0IHhNYXggPSBzaWduZWRJbnQxNihnbHlmWzZdLCBnbHlmWzddKTsKICAgICAgY29uc3QgeU1heCA9IHNpZ25lZEludDE2KGdseWZbOF0sIGdseWZbOV0pOwogICAgICBpZiAoeE1pbiA+IHhNYXgpIHsKICAgICAgICB3cml0ZVNpZ25lZEludDE2KGdseWYsIDIsIHhNYXgpOwogICAgICAgIHdyaXRlU2lnbmVkSW50MTYoZ2x5ZiwgNiwgeE1pbik7CiAgICAgIH0KICAgICAgaWYgKHlNaW4gPiB5TWF4KSB7CiAgICAgICAgd3JpdGVTaWduZWRJbnQxNihnbHlmLCA0LCB5TWF4KTsKICAgICAgICB3cml0ZVNpZ25lZEludDE2KGdseWYsIDgsIHlNaW4pOwogICAgICB9CiAgICAgIGNvbnN0IGNvbnRvdXJzQ291bnQgPSBzaWduZWRJbnQxNihnbHlmWzBdLCBnbHlmWzFdKTsKICAgICAgaWYgKGNvbnRvdXJzQ291bnQgPCAwKSB7CiAgICAgICAgaWYgKGNvbnRvdXJzQ291bnQgPCAtMSkgewogICAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgICB9CiAgICAgICAgZGVzdC5zZXQoZ2x5ZiwgZGVzdFN0YXJ0KTsKICAgICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5Zi5sZW5ndGg7CiAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgfQogICAgICBsZXQgaSwKICAgICAgICBqID0gMTAsCiAgICAgICAgZmxhZ3NDb3VudCA9IDA7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb250b3Vyc0NvdW50OyBpKyspIHsKICAgICAgICBjb25zdCBlbmRQb2ludCA9IGdseWZbal0gPDwgOCB8IGdseWZbaiArIDFdOwogICAgICAgIGZsYWdzQ291bnQgPSBlbmRQb2ludCArIDE7CiAgICAgICAgaiArPSAyOwogICAgICB9CiAgICAgIGNvbnN0IGluc3RydWN0aW9uc1N0YXJ0ID0gajsKICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zTGVuZ3RoID0gZ2x5ZltqXSA8PCA4IHwgZ2x5ZltqICsgMV07CiAgICAgIGdseXBoUHJvZmlsZS5zaXplT2ZJbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnNMZW5ndGg7CiAgICAgIGogKz0gMiArIGluc3RydWN0aW9uc0xlbmd0aDsKICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zRW5kID0gajsKICAgICAgbGV0IGNvb3JkaW5hdGVzTGVuZ3RoID0gMDsKICAgICAgZm9yIChpID0gMDsgaSA8IGZsYWdzQ291bnQ7IGkrKykgewogICAgICAgIGNvbnN0IGZsYWcgPSBnbHlmW2orK107CiAgICAgICAgaWYgKGZsYWcgJiAweGMwKSB7CiAgICAgICAgICBnbHlmW2ogLSAxXSA9IGZsYWcgJiAweDNmOwogICAgICAgIH0KICAgICAgICBsZXQgeExlbmd0aCA9IDI7CiAgICAgICAgaWYgKGZsYWcgJiAyKSB7CiAgICAgICAgICB4TGVuZ3RoID0gMTsKICAgICAgICB9IGVsc2UgaWYgKGZsYWcgJiAxNikgewogICAgICAgICAgeExlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICAgIGxldCB5TGVuZ3RoID0gMjsKICAgICAgICBpZiAoZmxhZyAmIDQpIHsKICAgICAgICAgIHlMZW5ndGggPSAxOwogICAgICAgIH0gZWxzZSBpZiAoZmxhZyAmIDMyKSB7CiAgICAgICAgICB5TGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgICAgY29uc3QgeHlMZW5ndGggPSB4TGVuZ3RoICsgeUxlbmd0aDsKICAgICAgICBjb29yZGluYXRlc0xlbmd0aCArPSB4eUxlbmd0aDsKICAgICAgICBpZiAoZmxhZyAmIDgpIHsKICAgICAgICAgIGNvbnN0IHJlcGVhdCA9IGdseWZbaisrXTsKICAgICAgICAgIGlmIChyZXBlYXQgPT09IDApIHsKICAgICAgICAgICAgZ2x5ZltqIC0gMV0gXj0gODsKICAgICAgICAgIH0KICAgICAgICAgIGkgKz0gcmVwZWF0OwogICAgICAgICAgY29vcmRpbmF0ZXNMZW5ndGggKz0gcmVwZWF0ICogeHlMZW5ndGg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjb29yZGluYXRlc0xlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgbGV0IGdseXBoRGF0YUxlbmd0aCA9IGogKyBjb29yZGluYXRlc0xlbmd0aDsKICAgICAgaWYgKGdseXBoRGF0YUxlbmd0aCA+IGdseWYubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgfQogICAgICBpZiAoIWhpbnRzVmFsaWQgJiYgaW5zdHJ1Y3Rpb25zTGVuZ3RoID4gMCkgewogICAgICAgIGRlc3Quc2V0KGdseWYuc3ViYXJyYXkoMCwgaW5zdHJ1Y3Rpb25zU3RhcnQpLCBkZXN0U3RhcnQpOwogICAgICAgIGRlc3Quc2V0KFswLCAwXSwgZGVzdFN0YXJ0ICsgaW5zdHJ1Y3Rpb25zU3RhcnQpOwogICAgICAgIGRlc3Quc2V0KGdseWYuc3ViYXJyYXkoaW5zdHJ1Y3Rpb25zRW5kLCBnbHlwaERhdGFMZW5ndGgpLCBkZXN0U3RhcnQgKyBpbnN0cnVjdGlvbnNTdGFydCArIDIpOwogICAgICAgIGdseXBoRGF0YUxlbmd0aCAtPSBpbnN0cnVjdGlvbnNMZW5ndGg7CiAgICAgICAgaWYgKGdseWYubGVuZ3RoIC0gZ2x5cGhEYXRhTGVuZ3RoID4gMykgewogICAgICAgICAgZ2x5cGhEYXRhTGVuZ3RoID0gZ2x5cGhEYXRhTGVuZ3RoICsgMyAmIH4zOwogICAgICAgIH0KICAgICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5cGhEYXRhTGVuZ3RoOwogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgaWYgKGdseWYubGVuZ3RoIC0gZ2x5cGhEYXRhTGVuZ3RoID4gMykgewogICAgICAgIGdseXBoRGF0YUxlbmd0aCA9IGdseXBoRGF0YUxlbmd0aCArIDMgJiB+MzsKICAgICAgICBkZXN0LnNldChnbHlmLnN1YmFycmF5KDAsIGdseXBoRGF0YUxlbmd0aCksIGRlc3RTdGFydCk7CiAgICAgICAgZ2x5cGhQcm9maWxlLmxlbmd0aCA9IGdseXBoRGF0YUxlbmd0aDsKICAgICAgICByZXR1cm4gZ2x5cGhQcm9maWxlOwogICAgICB9CiAgICAgIGRlc3Quc2V0KGdseWYsIGRlc3RTdGFydCk7CiAgICAgIGdseXBoUHJvZmlsZS5sZW5ndGggPSBnbHlmLmxlbmd0aDsKICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNhbml0aXplSGVhZChoZWFkLCBudW1HbHlwaHMsIGxvY2FMZW5ndGgpIHsKICAgICAgY29uc3QgZGF0YSA9IGhlYWQuZGF0YTsKICAgICAgY29uc3QgdmVyc2lvbiA9IGludDMyKGRhdGFbMF0sIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10pOwogICAgICBpZiAodmVyc2lvbiA+PiAxNiAhPT0gMSkgewogICAgICAgIGluZm8oIkF0dGVtcHRpbmcgdG8gZml4IGludmFsaWQgdmVyc2lvbiBpbiBoZWFkIHRhYmxlOiAiICsgdmVyc2lvbik7CiAgICAgICAgZGF0YVswXSA9IDA7CiAgICAgICAgZGF0YVsxXSA9IDE7CiAgICAgICAgZGF0YVsyXSA9IDA7CiAgICAgICAgZGF0YVszXSA9IDA7CiAgICAgIH0KICAgICAgY29uc3QgaW5kZXhUb0xvY0Zvcm1hdCA9IGludDE2KGRhdGFbNTBdLCBkYXRhWzUxXSk7CiAgICAgIGlmIChpbmRleFRvTG9jRm9ybWF0IDwgMCB8fCBpbmRleFRvTG9jRm9ybWF0ID4gMSkgewogICAgICAgIGluZm8oIkF0dGVtcHRpbmcgdG8gZml4IGludmFsaWQgaW5kZXhUb0xvY0Zvcm1hdCBpbiBoZWFkIHRhYmxlOiAiICsgaW5kZXhUb0xvY0Zvcm1hdCk7CiAgICAgICAgY29uc3QgbnVtR2x5cGhzUGx1c09uZSA9IG51bUdseXBocyArIDE7CiAgICAgICAgaWYgKGxvY2FMZW5ndGggPT09IG51bUdseXBoc1BsdXNPbmUgPDwgMSkgewogICAgICAgICAgZGF0YVs1MF0gPSAwOwogICAgICAgICAgZGF0YVs1MV0gPSAwOwogICAgICAgIH0gZWxzZSBpZiAobG9jYUxlbmd0aCA9PT0gbnVtR2x5cGhzUGx1c09uZSA8PCAyKSB7CiAgICAgICAgICBkYXRhWzUwXSA9IDA7CiAgICAgICAgICBkYXRhWzUxXSA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQ291bGQgbm90IGZpeCBpbmRleFRvTG9jRm9ybWF0OiAiICsgaW5kZXhUb0xvY0Zvcm1hdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzYW5pdGl6ZUdseXBoTG9jYXRpb25zKGxvY2EsIGdseWYsIG51bUdseXBocywgaXNHbHlwaExvY2F0aW9uc0xvbmcsIGhpbnRzVmFsaWQsIGR1cEZpcnN0RW50cnksIG1heFNpemVPZkluc3RydWN0aW9ucykgewogICAgICBsZXQgaXRlbVNpemUsIGl0ZW1EZWNvZGUsIGl0ZW1FbmNvZGU7CiAgICAgIGlmIChpc0dseXBoTG9jYXRpb25zTG9uZykgewogICAgICAgIGl0ZW1TaXplID0gNDsKICAgICAgICBpdGVtRGVjb2RlID0gZnVuY3Rpb24gZm9udEl0ZW1EZWNvZGVMb25nKGRhdGEsIG9mZnNldCkgewogICAgICAgICAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdOwogICAgICAgIH07CiAgICAgICAgaXRlbUVuY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRW5jb2RlTG9uZyhkYXRhLCBvZmZzZXQsIHZhbHVlKSB7CiAgICAgICAgICBkYXRhW29mZnNldF0gPSB2YWx1ZSA+Pj4gMjQgJiAweGZmOwogICAgICAgICAgZGF0YVtvZmZzZXQgKyAxXSA9IHZhbHVlID4+IDE2ICYgMHhmZjsKICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgMl0gPSB2YWx1ZSA+PiA4ICYgMHhmZjsKICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgM10gPSB2YWx1ZSAmIDB4ZmY7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpdGVtU2l6ZSA9IDI7CiAgICAgICAgaXRlbURlY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRGVjb2RlKGRhdGEsIG9mZnNldCkgewogICAgICAgICAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCA5IHwgZGF0YVtvZmZzZXQgKyAxXSA8PCAxOwogICAgICAgIH07CiAgICAgICAgaXRlbUVuY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRW5jb2RlKGRhdGEsIG9mZnNldCwgdmFsdWUpIHsKICAgICAgICAgIGRhdGFbb2Zmc2V0XSA9IHZhbHVlID4+IDkgJiAweGZmOwogICAgICAgICAgZGF0YVtvZmZzZXQgKyAxXSA9IHZhbHVlID4+IDEgJiAweGZmOwogICAgICAgIH07CiAgICAgIH0KICAgICAgY29uc3QgbnVtR2x5cGhzT3V0ID0gZHVwRmlyc3RFbnRyeSA/IG51bUdseXBocyArIDEgOiBudW1HbHlwaHM7CiAgICAgIGNvbnN0IGxvY2FEYXRhU2l6ZSA9IGl0ZW1TaXplICogKDEgKyBudW1HbHlwaHNPdXQpOwogICAgICBjb25zdCBsb2NhRGF0YSA9IG5ldyBVaW50OEFycmF5KGxvY2FEYXRhU2l6ZSk7CiAgICAgIGxvY2FEYXRhLnNldChsb2NhLmRhdGEuc3ViYXJyYXkoMCwgbG9jYURhdGFTaXplKSk7CiAgICAgIGxvY2EuZGF0YSA9IGxvY2FEYXRhOwogICAgICBjb25zdCBvbGRHbHlmRGF0YSA9IGdseWYuZGF0YTsKICAgICAgY29uc3Qgb2xkR2x5ZkRhdGFMZW5ndGggPSBvbGRHbHlmRGF0YS5sZW5ndGg7CiAgICAgIGNvbnN0IG5ld0dseWZEYXRhID0gbmV3IFVpbnQ4QXJyYXkob2xkR2x5ZkRhdGFMZW5ndGgpOwogICAgICBsZXQgaSwgajsKICAgICAgY29uc3QgbG9jYUVudHJpZXMgPSBbXTsKICAgICAgZm9yIChpID0gMCwgaiA9IDA7IGkgPCBudW1HbHlwaHMgKyAxOyBpKyssIGogKz0gaXRlbVNpemUpIHsKICAgICAgICBsZXQgb2Zmc2V0ID0gaXRlbURlY29kZShsb2NhRGF0YSwgaik7CiAgICAgICAgaWYgKG9mZnNldCA+IG9sZEdseWZEYXRhTGVuZ3RoKSB7CiAgICAgICAgICBvZmZzZXQgPSBvbGRHbHlmRGF0YUxlbmd0aDsKICAgICAgICB9CiAgICAgICAgbG9jYUVudHJpZXMucHVzaCh7CiAgICAgICAgICBpbmRleDogaSwKICAgICAgICAgIG9mZnNldCwKICAgICAgICAgIGVuZE9mZnNldDogMAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGxvY2FFbnRyaWVzLnNvcnQoKGEsIGIpID0+IGEub2Zmc2V0IC0gYi5vZmZzZXQpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtR2x5cGhzOyBpKyspIHsKICAgICAgICBsb2NhRW50cmllc1tpXS5lbmRPZmZzZXQgPSBsb2NhRW50cmllc1tpICsgMV0ub2Zmc2V0OwogICAgICB9CiAgICAgIGxvY2FFbnRyaWVzLnNvcnQoKGEsIGIpID0+IGEuaW5kZXggLSBiLmluZGV4KTsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bUdseXBoczsgaSsrKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgb2Zmc2V0LAogICAgICAgICAgZW5kT2Zmc2V0CiAgICAgICAgfSA9IGxvY2FFbnRyaWVzW2ldOwogICAgICAgIGlmIChvZmZzZXQgIT09IDAgfHwgZW5kT2Zmc2V0ICE9PSAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV4dE9mZnNldCA9IGxvY2FFbnRyaWVzW2kgKyAxXS5vZmZzZXQ7CiAgICAgICAgaWYgKG5leHRPZmZzZXQgPT09IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsb2NhRW50cmllc1tpXS5lbmRPZmZzZXQgPSBuZXh0T2Zmc2V0OwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNvbnN0IGxhc3QgPSBsb2NhRW50cmllcy5hdCgtMik7CiAgICAgIGlmIChsYXN0Lm9mZnNldCAhPT0gMCAmJiBsYXN0LmVuZE9mZnNldCA9PT0gMCkgewogICAgICAgIGxhc3QuZW5kT2Zmc2V0ID0gb2xkR2x5ZkRhdGFMZW5ndGg7CiAgICAgIH0KICAgICAgY29uc3QgbWlzc2luZ0dseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGxldCB3cml0ZU9mZnNldCA9IDA7CiAgICAgIGl0ZW1FbmNvZGUobG9jYURhdGEsIDAsIHdyaXRlT2Zmc2V0KTsKICAgICAgZm9yIChpID0gMCwgaiA9IGl0ZW1TaXplOyBpIDwgbnVtR2x5cGhzOyBpKyssIGogKz0gaXRlbVNpemUpIHsKICAgICAgICBjb25zdCBnbHlwaFByb2ZpbGUgPSBzYW5pdGl6ZUdseXBoKG9sZEdseWZEYXRhLCBsb2NhRW50cmllc1tpXS5vZmZzZXQsIGxvY2FFbnRyaWVzW2ldLmVuZE9mZnNldCwgbmV3R2x5ZkRhdGEsIHdyaXRlT2Zmc2V0LCBoaW50c1ZhbGlkKTsKICAgICAgICBjb25zdCBuZXdMZW5ndGggPSBnbHlwaFByb2ZpbGUubGVuZ3RoOwogICAgICAgIGlmIChuZXdMZW5ndGggPT09IDApIHsKICAgICAgICAgIG1pc3NpbmdHbHlwaHNbaV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2x5cGhQcm9maWxlLnNpemVPZkluc3RydWN0aW9ucyA+IG1heFNpemVPZkluc3RydWN0aW9ucykgewogICAgICAgICAgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zID0gZ2x5cGhQcm9maWxlLnNpemVPZkluc3RydWN0aW9uczsKICAgICAgICB9CiAgICAgICAgd3JpdGVPZmZzZXQgKz0gbmV3TGVuZ3RoOwogICAgICAgIGl0ZW1FbmNvZGUobG9jYURhdGEsIGosIHdyaXRlT2Zmc2V0KTsKICAgICAgfQogICAgICBpZiAod3JpdGVPZmZzZXQgPT09IDApIHsKICAgICAgICBjb25zdCBzaW1wbGVHbHlwaCA9IG5ldyBVaW50OEFycmF5KFswLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA0OSwgMF0pOwogICAgICAgIGZvciAoaSA9IDAsIGogPSBpdGVtU2l6ZTsgaSA8IG51bUdseXBoc091dDsgaSsrLCBqICs9IGl0ZW1TaXplKSB7CiAgICAgICAgICBpdGVtRW5jb2RlKGxvY2FEYXRhLCBqLCBzaW1wbGVHbHlwaC5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBnbHlmLmRhdGEgPSBzaW1wbGVHbHlwaDsKICAgICAgfSBlbHNlIGlmIChkdXBGaXJzdEVudHJ5KSB7CiAgICAgICAgY29uc3QgZmlyc3RFbnRyeUxlbmd0aCA9IGl0ZW1EZWNvZGUobG9jYURhdGEsIGl0ZW1TaXplKTsKICAgICAgICBpZiAobmV3R2x5ZkRhdGEubGVuZ3RoID4gZmlyc3RFbnRyeUxlbmd0aCArIHdyaXRlT2Zmc2V0KSB7CiAgICAgICAgICBnbHlmLmRhdGEgPSBuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCBmaXJzdEVudHJ5TGVuZ3RoICsgd3JpdGVPZmZzZXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnbHlmLmRhdGEgPSBuZXcgVWludDhBcnJheShmaXJzdEVudHJ5TGVuZ3RoICsgd3JpdGVPZmZzZXQpOwogICAgICAgICAgZ2x5Zi5kYXRhLnNldChuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCB3cml0ZU9mZnNldCkpOwogICAgICAgIH0KICAgICAgICBnbHlmLmRhdGEuc2V0KG5ld0dseWZEYXRhLnN1YmFycmF5KDAsIGZpcnN0RW50cnlMZW5ndGgpLCB3cml0ZU9mZnNldCk7CiAgICAgICAgaXRlbUVuY29kZShsb2NhLmRhdGEsIGxvY2FEYXRhLmxlbmd0aCAtIGl0ZW1TaXplLCB3cml0ZU9mZnNldCArIGZpcnN0RW50cnlMZW5ndGgpOwogICAgICB9IGVsc2UgewogICAgICAgIGdseWYuZGF0YSA9IG5ld0dseWZEYXRhLnN1YmFycmF5KDAsIHdyaXRlT2Zmc2V0KTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIG1pc3NpbmdHbHlwaHMsCiAgICAgICAgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiByZWFkUG9zdFNjcmlwdFRhYmxlKHBvc3QsIHByb3BlcnRpZXNPYmosIG1heHBOdW1HbHlwaHMpIHsKICAgICAgY29uc3Qgc3RhcnQgPSAoZm9udC5zdGFydCB8fCAwKSArIHBvc3Qub2Zmc2V0OwogICAgICBmb250LnBvcyA9IHN0YXJ0OwogICAgICBjb25zdCBsZW5ndGggPSBwb3N0Lmxlbmd0aCwKICAgICAgICBlbmQgPSBzdGFydCArIGxlbmd0aDsKICAgICAgY29uc3QgdmVyc2lvbiA9IGZvbnQuZ2V0SW50MzIoKTsKICAgICAgZm9udC5za2lwKDI4KTsKICAgICAgbGV0IGdseXBoTmFtZXM7CiAgICAgIGxldCB2YWxpZCA9IHRydWU7CiAgICAgIGxldCBpOwogICAgICBzd2l0Y2ggKHZlcnNpb24pIHsKICAgICAgICBjYXNlIDB4MDAwMTAwMDA6CiAgICAgICAgICBnbHlwaE5hbWVzID0gTWFjU3RhbmRhcmRHbHlwaE9yZGVyaW5nOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDAwMDIwMDAwOgogICAgICAgICAgY29uc3QgbnVtR2x5cGhzID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgICAgIGlmIChudW1HbHlwaHMgIT09IG1heHBOdW1HbHlwaHMpIHsKICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBnbHlwaE5hbWVJbmRleGVzID0gW107CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtR2x5cGhzOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICBpZiAoaW5kZXggPj0gMzI3NjgpIHsKICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdseXBoTmFtZUluZGV4ZXMucHVzaChpbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgY3VzdG9tTmFtZXMgPSBbXSwKICAgICAgICAgICAgc3RyQnVmID0gW107CiAgICAgICAgICB3aGlsZSAoZm9udC5wb3MgPCBlbmQpIHsKICAgICAgICAgICAgY29uc3Qgc3RyaW5nTGVuZ3RoID0gZm9udC5nZXRCeXRlKCk7CiAgICAgICAgICAgIHN0ckJ1Zi5sZW5ndGggPSBzdHJpbmdMZW5ndGg7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdHJpbmdMZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIHN0ckJ1ZltpXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZm9udC5nZXRCeXRlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1c3RvbU5hbWVzLnB1c2goc3RyQnVmLmpvaW4oIiIpKTsKICAgICAgICAgIH0KICAgICAgICAgIGdseXBoTmFtZXMgPSBbXTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1HbHlwaHM7ICsraSkgewogICAgICAgICAgICBjb25zdCBqID0gZ2x5cGhOYW1lSW5kZXhlc1tpXTsKICAgICAgICAgICAgaWYgKGogPCAyNTgpIHsKICAgICAgICAgICAgICBnbHlwaE5hbWVzLnB1c2goTWFjU3RhbmRhcmRHbHlwaE9yZGVyaW5nW2pdKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBnbHlwaE5hbWVzLnB1c2goY3VzdG9tTmFtZXNbaiAtIDI1OF0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDAwMDMwMDAwOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHdhcm4oIlVua25vd24vdW5zdXBwb3J0ZWQgcG9zdCB0YWJsZSB2ZXJzaW9uICIgKyB2ZXJzaW9uKTsKICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICBpZiAocHJvcGVydGllc09iai5kZWZhdWx0RW5jb2RpbmcpIHsKICAgICAgICAgICAgZ2x5cGhOYW1lcyA9IHByb3BlcnRpZXNPYmouZGVmYXVsdEVuY29kaW5nOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcHJvcGVydGllc09iai5nbHlwaE5hbWVzID0gZ2x5cGhOYW1lczsKICAgICAgcmV0dXJuIHZhbGlkOwogICAgfQogICAgZnVuY3Rpb24gcmVhZE5hbWVUYWJsZShuYW1lVGFibGUpIHsKICAgICAgY29uc3Qgc3RhcnQgPSAoZm9udC5zdGFydCB8fCAwKSArIG5hbWVUYWJsZS5vZmZzZXQ7CiAgICAgIGZvbnQucG9zID0gc3RhcnQ7CiAgICAgIGNvbnN0IG5hbWVzID0gW1tdLCBbXV0sCiAgICAgICAgcmVjb3JkcyA9IFtdOwogICAgICBjb25zdCBsZW5ndGggPSBuYW1lVGFibGUubGVuZ3RoLAogICAgICAgIGVuZCA9IHN0YXJ0ICsgbGVuZ3RoOwogICAgICBjb25zdCBmb3JtYXQgPSBmb250LmdldFVpbnQxNigpOwogICAgICBjb25zdCBGT1JNQVRfMF9IRUFERVJfTEVOR1RIID0gNjsKICAgICAgaWYgKGZvcm1hdCAhPT0gMCB8fCBsZW5ndGggPCBGT1JNQVRfMF9IRUFERVJfTEVOR1RIKSB7CiAgICAgICAgcmV0dXJuIFtuYW1lcywgcmVjb3Jkc107CiAgICAgIH0KICAgICAgY29uc3QgbnVtUmVjb3JkcyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgIGNvbnN0IHN0cmluZ3NTdGFydCA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgIGNvbnN0IE5BTUVfUkVDT1JEX0xFTkdUSCA9IDEyOwogICAgICBsZXQgaSwgaWk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1SZWNvcmRzICYmIGZvbnQucG9zICsgTkFNRV9SRUNPUkRfTEVOR1RIIDw9IGVuZDsgaSsrKSB7CiAgICAgICAgY29uc3QgciA9IHsKICAgICAgICAgIHBsYXRmb3JtOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgZW5jb2Rpbmc6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICBsYW5ndWFnZTogZm9udC5nZXRVaW50MTYoKSwKICAgICAgICAgIG5hbWU6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICBsZW5ndGg6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICBvZmZzZXQ6IGZvbnQuZ2V0VWludDE2KCkKICAgICAgICB9OwogICAgICAgIGlmIChpc01hY05hbWVSZWNvcmQocikgfHwgaXNXaW5OYW1lUmVjb3JkKHIpKSB7CiAgICAgICAgICByZWNvcmRzLnB1c2gocik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAoaSA9IDAsIGlpID0gcmVjb3Jkcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgcmVjb3JkID0gcmVjb3Jkc1tpXTsKICAgICAgICBpZiAocmVjb3JkLmxlbmd0aCA8PSAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcG9zID0gc3RhcnQgKyBzdHJpbmdzU3RhcnQgKyByZWNvcmQub2Zmc2V0OwogICAgICAgIGlmIChwb3MgKyByZWNvcmQubGVuZ3RoID4gZW5kKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZm9udC5wb3MgPSBwb3M7CiAgICAgICAgY29uc3QgbmFtZUluZGV4ID0gcmVjb3JkLm5hbWU7CiAgICAgICAgaWYgKHJlY29yZC5lbmNvZGluZykgewogICAgICAgICAgbGV0IHN0ciA9ICIiOwogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gcmVjb3JkLmxlbmd0aDsgaiA8IGpqOyBqICs9IDIpIHsKICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZm9udC5nZXRVaW50MTYoKSk7CiAgICAgICAgICB9CiAgICAgICAgICBuYW1lc1sxXVtuYW1lSW5kZXhdID0gc3RyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuYW1lc1swXVtuYW1lSW5kZXhdID0gZm9udC5nZXRTdHJpbmcocmVjb3JkLmxlbmd0aCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBbbmFtZXMsIHJlY29yZHNdOwogICAgfQogICAgY29uc3QgVFRPcHNTdGFja0RlbHRhcyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAtMiwgLTIsIC0yLCAtMiwgMCwgMCwgLTIsIC01LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIDAsIDAsIC0xLCAwLCAtMSwgLTEsIC0xLCAtMSwgMSwgLTEsIC05OTksIDAsIDEsIDAsIC0xLCAtMiwgMCwgLTEsIC0yLCAtMSwgLTEsIDAsIC0xLCAtMSwgMCwgMCwgLTk5OSwgLTk5OSwgLTEsIC0xLCAtMSwgLTEsIC0yLCAtOTk5LCAtMiwgLTIsIC05OTksIDAsIC0yLCAtMiwgMCwgMCwgLTIsIDAsIC0yLCAwLCAwLCAwLCAtMiwgLTEsIC0xLCAxLCAxLCAwLCAwLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgMCwgMCwgLTEsIDAsIC0xLCAtMSwgMCwgLTk5OSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgLTIsIC05OTksIC05OTksIC05OTksIC05OTksIC05OTksIC0xLCAtMSwgLTIsIC0yLCAwLCAwLCAwLCAwLCAtMSwgLTEsIC05OTksIC0yLCAtMiwgMCwgMCwgLTEsIC0yLCAtMiwgMCwgMCwgMCwgLTEsIC0xLCAtMSwgLTJdOwogICAgZnVuY3Rpb24gc2FuaXRpemVUVFByb2dyYW0odGFibGUsIHR0Q29udGV4dCkgewogICAgICBsZXQgZGF0YSA9IHRhYmxlLmRhdGE7CiAgICAgIGxldCBpID0gMCwKICAgICAgICBqLAogICAgICAgIG4sCiAgICAgICAgYiwKICAgICAgICBmdW5jSWQsCiAgICAgICAgcGMsCiAgICAgICAgbGFzdEVuZGYgPSAwLAogICAgICAgIGxhc3REZWZmID0gMDsKICAgICAgY29uc3Qgc3RhY2sgPSBbXTsKICAgICAgY29uc3QgY2FsbHN0YWNrID0gW107CiAgICAgIGNvbnN0IGZ1bmN0aW9uc0NhbGxlZCA9IFtdOwogICAgICBsZXQgdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zID0gdHRDb250ZXh0LnRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9uczsKICAgICAgbGV0IGluRkRFRiA9IGZhbHNlLAogICAgICAgIGlmTGV2ZWwgPSAwLAogICAgICAgIGluRUxTRSA9IDA7CiAgICAgIGZvciAobGV0IGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTspIHsKICAgICAgICBjb25zdCBvcCA9IGRhdGFbaSsrXTsKICAgICAgICBpZiAob3AgPT09IDB4NDApIHsKICAgICAgICAgIG4gPSBkYXRhW2krK107CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICBpICs9IG47CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgc3RhY2sucHVzaChkYXRhW2krK10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHg0MSkgewogICAgICAgICAgbiA9IGRhdGFbaSsrXTsKICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgIGkgKz0gbiAqIDI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgYiA9IGRhdGFbaSsrXTsKICAgICAgICAgICAgICBzdGFjay5wdXNoKGIgPDwgOCB8IGRhdGFbaSsrXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKChvcCAmIDB4ZjgpID09PSAweGIwKSB7CiAgICAgICAgICBuID0gb3AgLSAweGIwICsgMTsKICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgIGkgKz0gbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBuOyBqKyspIHsKICAgICAgICAgICAgICBzdGFjay5wdXNoKGRhdGFbaSsrXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKChvcCAmIDB4ZjgpID09PSAweGI4KSB7CiAgICAgICAgICBuID0gb3AgLSAweGI4ICsgMTsKICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgIGkgKz0gbiAqIDI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgYiA9IGRhdGFbaSsrXTsKICAgICAgICAgICAgICBzdGFjay5wdXNoKHNpZ25lZEludDE2KGIsIGRhdGFbaSsrXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgyYiAmJiAhdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zKSB7CiAgICAgICAgICBpZiAoIWluRkRFRiAmJiAhaW5FTFNFKSB7CiAgICAgICAgICAgIGZ1bmNJZCA9IHN0YWNrLmF0KC0xKTsKICAgICAgICAgICAgaWYgKGlzTmFOKGZ1bmNJZCkpIHsKICAgICAgICAgICAgICBpbmZvKCJUVDogQ0FMTCBlbXB0eSBzdGFjayAob3IgaW52YWxpZCBlbnRyeSkuIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdHRDb250ZXh0LmZ1bmN0aW9uc1VzZWRbZnVuY0lkXSA9IHRydWU7CiAgICAgICAgICAgICAgaWYgKGZ1bmNJZCBpbiB0dENvbnRleHQuZnVuY3Rpb25zU3RhY2tEZWx0YXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1N0YWNrTGVuZ3RoID0gc3RhY2subGVuZ3RoICsgdHRDb250ZXh0LmZ1bmN0aW9uc1N0YWNrRGVsdGFzW2Z1bmNJZF07CiAgICAgICAgICAgICAgICBpZiAobmV3U3RhY2tMZW5ndGggPCAwKSB7CiAgICAgICAgICAgICAgICAgIHdhcm4oIlRUOiBDQUxMIGludmFsaWQgZnVuY3Rpb25zIHN0YWNrIGRlbHRhLiIpOwogICAgICAgICAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGFjay5sZW5ndGggPSBuZXdTdGFja0xlbmd0aDsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZ1bmNJZCBpbiB0dENvbnRleHQuZnVuY3Rpb25zRGVmaW5lZCAmJiAhZnVuY3Rpb25zQ2FsbGVkLmluY2x1ZGVzKGZ1bmNJZCkpIHsKICAgICAgICAgICAgICAgIGNhbGxzdGFjay5wdXNoKHsKICAgICAgICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICAgICAgc3RhY2tUb3A6IHN0YWNrLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZnVuY3Rpb25zQ2FsbGVkLnB1c2goZnVuY0lkKTsKICAgICAgICAgICAgICAgIHBjID0gdHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWRbZnVuY0lkXTsKICAgICAgICAgICAgICAgIGlmICghcGMpIHsKICAgICAgICAgICAgICAgICAgd2FybigiVFQ6IENBTEwgbm9uLWV4aXN0ZW50IGZ1bmN0aW9uIik7CiAgICAgICAgICAgICAgICAgIHR0Q29udGV4dC5oaW50c1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGEgPSBwYy5kYXRhOwogICAgICAgICAgICAgICAgaSA9IHBjLmk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgyYyAmJiAhdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zKSB7CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICB3YXJuKCJUVDogbmVzdGVkIEZERUZzIG5vdCBhbGxvd2VkIik7CiAgICAgICAgICAgIHRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9ucyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpbkZERUYgPSB0cnVlOwogICAgICAgICAgbGFzdERlZmYgPSBpOwogICAgICAgICAgZnVuY0lkID0gc3RhY2sucG9wKCk7CiAgICAgICAgICB0dENvbnRleHQuZnVuY3Rpb25zRGVmaW5lZFtmdW5jSWRdID0gewogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4MmQpIHsKICAgICAgICAgIGlmIChpbkZERUYpIHsKICAgICAgICAgICAgaW5GREVGID0gZmFsc2U7CiAgICAgICAgICAgIGxhc3RFbmRmID0gaTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBjID0gY2FsbHN0YWNrLnBvcCgpOwogICAgICAgICAgICBpZiAoIXBjKSB7CiAgICAgICAgICAgICAgd2FybigiVFQ6IEVOREYgYmFkIHN0YWNrIik7CiAgICAgICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY0lkID0gZnVuY3Rpb25zQ2FsbGVkLnBvcCgpOwogICAgICAgICAgICBkYXRhID0gcGMuZGF0YTsKICAgICAgICAgICAgaSA9IHBjLmk7CiAgICAgICAgICAgIHR0Q29udGV4dC5mdW5jdGlvbnNTdGFja0RlbHRhc1tmdW5jSWRdID0gc3RhY2subGVuZ3RoIC0gcGMuc3RhY2tUb3A7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHg4OSkgewogICAgICAgICAgaWYgKGluRkRFRiB8fCBpbkVMU0UpIHsKICAgICAgICAgICAgd2FybigiVFQ6IG5lc3RlZCBJREVGcyBub3QgYWxsb3dlZCIpOwogICAgICAgICAgICB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaW5GREVGID0gdHJ1ZTsKICAgICAgICAgIGxhc3REZWZmID0gaTsKICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDU4KSB7CiAgICAgICAgICArK2lmTGV2ZWw7CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgxYikgewogICAgICAgICAgaW5FTFNFID0gaWZMZXZlbDsKICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDU5KSB7CiAgICAgICAgICBpZiAoaW5FTFNFID09PSBpZkxldmVsKSB7CiAgICAgICAgICAgIGluRUxTRSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICAtLWlmTGV2ZWw7CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgxYykgewogICAgICAgICAgaWYgKCFpbkZERUYgJiYgIWluRUxTRSkgewogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBzdGFjay5hdCgtMSk7CiAgICAgICAgICAgIGlmIChvZmZzZXQgPiAwKSB7CiAgICAgICAgICAgICAgaSArPSBvZmZzZXQgLSAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghaW5GREVGICYmICFpbkVMU0UpIHsKICAgICAgICAgIGxldCBzdGFja0RlbHRhID0gMDsKICAgICAgICAgIGlmIChvcCA8PSAweDhlKSB7CiAgICAgICAgICAgIHN0YWNrRGVsdGEgPSBUVE9wc1N0YWNrRGVsdGFzW29wXTsKICAgICAgICAgIH0gZWxzZSBpZiAob3AgPj0gMHhjMCAmJiBvcCA8PSAweGRmKSB7CiAgICAgICAgICAgIHN0YWNrRGVsdGEgPSAtMTsKICAgICAgICAgIH0gZWxzZSBpZiAob3AgPj0gMHhlMCkgewogICAgICAgICAgICBzdGFja0RlbHRhID0gLTI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3AgPj0gMHg3MSAmJiBvcCA8PSAweDc1KSB7CiAgICAgICAgICAgIG4gPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgaWYgKCFpc05hTihuKSkgewogICAgICAgICAgICAgIHN0YWNrRGVsdGEgPSAtbiAqIDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzdGFja0RlbHRhIDwgMCAmJiBzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICBzdGFja0RlbHRhKys7CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoc3RhY2tEZWx0YSA+IDApIHsKICAgICAgICAgICAgc3RhY2sucHVzaChOYU4pOwogICAgICAgICAgICBzdGFja0RlbHRhLS07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHR0Q29udGV4dC50b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnM7CiAgICAgIGNvbnN0IGNvbnRlbnQgPSBbZGF0YV07CiAgICAgIGlmIChpID4gZGF0YS5sZW5ndGgpIHsKICAgICAgICBjb250ZW50LnB1c2gobmV3IFVpbnQ4QXJyYXkoaSAtIGRhdGEubGVuZ3RoKSk7CiAgICAgIH0KICAgICAgaWYgKGxhc3REZWZmID4gbGFzdEVuZGYpIHsKICAgICAgICB3YXJuKCJUVDogY29tcGxlbWVudGluZyBhIG1pc3NpbmcgZnVuY3Rpb24gdGFpbCIpOwogICAgICAgIGNvbnRlbnQucHVzaChuZXcgVWludDhBcnJheShbMHgyMiwgMHgyZF0pKTsKICAgICAgfQogICAgICBmb2xkVFRUYWJsZSh0YWJsZSwgY29udGVudCk7CiAgICB9CiAgICBmdW5jdGlvbiBjaGVja0ludmFsaWRGdW5jdGlvbnModHRDb250ZXh0LCBtYXhGdW5jdGlvbkRlZnMpIHsKICAgICAgaWYgKHR0Q29udGV4dC50b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkLmxlbmd0aCA+IG1heEZ1bmN0aW9uRGVmcykgewogICAgICAgIHdhcm4oIlRUOiBtb3JlIGZ1bmN0aW9ucyBkZWZpbmVkIHRoYW4gZXhwZWN0ZWQiKTsKICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmb3IgKGxldCBqID0gMCwgamogPSB0dENvbnRleHQuZnVuY3Rpb25zVXNlZC5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgaWYgKGogPiBtYXhGdW5jdGlvbkRlZnMpIHsKICAgICAgICAgIHdhcm4oIlRUOiBpbnZhbGlkIGZ1bmN0aW9uIGlkOiAiICsgaik7CiAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodHRDb250ZXh0LmZ1bmN0aW9uc1VzZWRbal0gJiYgIXR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkW2pdKSB7CiAgICAgICAgICB3YXJuKCJUVDogdW5kZWZpbmVkIGZ1bmN0aW9uOiAiICsgaik7CiAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZm9sZFRUVGFibGUodGFibGUsIGNvbnRlbnQpIHsKICAgICAgaWYgKGNvbnRlbnQubGVuZ3RoID4gMSkgewogICAgICAgIGxldCBuZXdMZW5ndGggPSAwOwogICAgICAgIGxldCBqLCBqajsKICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGNvbnRlbnQubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgbmV3TGVuZ3RoICs9IGNvbnRlbnRbal0ubGVuZ3RoOwogICAgICAgIH0KICAgICAgICBuZXdMZW5ndGggPSBuZXdMZW5ndGggKyAzICYgfjM7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKICAgICAgICBsZXQgcG9zID0gMDsKICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGNvbnRlbnQubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgcmVzdWx0LnNldChjb250ZW50W2pdLCBwb3MpOwogICAgICAgICAgcG9zICs9IGNvbnRlbnRbal0ubGVuZ3RoOwogICAgICAgIH0KICAgICAgICB0YWJsZS5kYXRhID0gcmVzdWx0OwogICAgICAgIHRhYmxlLmxlbmd0aCA9IG5ld0xlbmd0aDsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2FuaXRpemVUVFByb2dyYW1zKGZwZ20sIHByZXAsIGN2dCwgbWF4RnVuY3Rpb25EZWZzKSB7CiAgICAgIGNvbnN0IHR0Q29udGV4dCA9IHsKICAgICAgICBmdW5jdGlvbnNEZWZpbmVkOiBbXSwKICAgICAgICBmdW5jdGlvbnNVc2VkOiBbXSwKICAgICAgICBmdW5jdGlvbnNTdGFja0RlbHRhczogW10sCiAgICAgICAgdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zOiBmYWxzZSwKICAgICAgICBoaW50c1ZhbGlkOiB0cnVlCiAgICAgIH07CiAgICAgIGlmIChmcGdtKSB7CiAgICAgICAgc2FuaXRpemVUVFByb2dyYW0oZnBnbSwgdHRDb250ZXh0KTsKICAgICAgfQogICAgICBpZiAocHJlcCkgewogICAgICAgIHNhbml0aXplVFRQcm9ncmFtKHByZXAsIHR0Q29udGV4dCk7CiAgICAgIH0KICAgICAgaWYgKGZwZ20pIHsKICAgICAgICBjaGVja0ludmFsaWRGdW5jdGlvbnModHRDb250ZXh0LCBtYXhGdW5jdGlvbkRlZnMpOwogICAgICB9CiAgICAgIGlmIChjdnQgJiYgY3Z0Lmxlbmd0aCAmIDEpIHsKICAgICAgICBjb25zdCBjdnREYXRhID0gbmV3IFVpbnQ4QXJyYXkoY3Z0Lmxlbmd0aCArIDEpOwogICAgICAgIGN2dERhdGEuc2V0KGN2dC5kYXRhKTsKICAgICAgICBjdnQuZGF0YSA9IGN2dERhdGE7CiAgICAgIH0KICAgICAgcmV0dXJuIHR0Q29udGV4dC5oaW50c1ZhbGlkOwogICAgfQogICAgZm9udCA9IG5ldyBTdHJlYW0obmV3IFVpbnQ4QXJyYXkoZm9udC5nZXRCeXRlcygpKSk7CiAgICBsZXQgaGVhZGVyLCB0YWJsZXM7CiAgICBpZiAoaXNUcnVlVHlwZUNvbGxlY3Rpb25GaWxlKGZvbnQpKSB7CiAgICAgIGNvbnN0IHR0Y0RhdGEgPSByZWFkVHJ1ZVR5cGVDb2xsZWN0aW9uRGF0YShmb250LCB0aGlzLm5hbWUpOwogICAgICBoZWFkZXIgPSB0dGNEYXRhLmhlYWRlcjsKICAgICAgdGFibGVzID0gdHRjRGF0YS50YWJsZXM7CiAgICB9IGVsc2UgewogICAgICBoZWFkZXIgPSByZWFkT3BlblR5cGVIZWFkZXIoZm9udCk7CiAgICAgIHRhYmxlcyA9IHJlYWRUYWJsZXMoZm9udCwgaGVhZGVyLm51bVRhYmxlcyk7CiAgICB9CiAgICBjb25zdCBpc1RydWVUeXBlID0gIXRhYmxlc1siQ0ZGICJdOwogICAgaWYgKCFpc1RydWVUeXBlKSB7CiAgICAgIGlmIChoZWFkZXIudmVyc2lvbiA9PT0gIk9UVE8iICYmICFwcm9wZXJ0aWVzLmNvbXBvc2l0ZSB8fCAhdGFibGVzLmhlYWQgfHwgIXRhYmxlcy5oaGVhIHx8ICF0YWJsZXMubWF4cCB8fCAhdGFibGVzLnBvc3QpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0KG5hbWUsIG5ldyBDRkZGb250KG5ldyBTdHJlYW0odGFibGVzWyJDRkYgIl0uZGF0YSksIHByb3BlcnRpZXMpLCBwcm9wZXJ0aWVzKTsKICAgICAgfQogICAgICBkZWxldGUgdGFibGVzLmdseWY7CiAgICAgIGRlbGV0ZSB0YWJsZXMubG9jYTsKICAgICAgZGVsZXRlIHRhYmxlcy5mcGdtOwogICAgICBkZWxldGUgdGFibGVzLnByZXA7CiAgICAgIGRlbGV0ZSB0YWJsZXNbImN2dCAiXTsKICAgICAgdGhpcy5pc09wZW5UeXBlID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghdGFibGVzLmxvY2EpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoJ1JlcXVpcmVkICJsb2NhIiB0YWJsZSBpcyBub3QgZm91bmQnKTsKICAgICAgfQogICAgICBpZiAoIXRhYmxlcy5nbHlmKSB7CiAgICAgICAgd2FybignUmVxdWlyZWQgImdseWYiIHRhYmxlIGlzIG5vdCBmb3VuZCAtLSB0cnlpbmcgdG8gcmVjb3Zlci4nKTsKICAgICAgICB0YWJsZXMuZ2x5ZiA9IHsKICAgICAgICAgIHRhZzogImdseWYiLAogICAgICAgICAgZGF0YTogbmV3IFVpbnQ4QXJyYXkoMCkKICAgICAgICB9OwogICAgICB9CiAgICAgIHRoaXMuaXNPcGVuVHlwZSA9IGZhbHNlOwogICAgfQogICAgaWYgKCF0YWJsZXMubWF4cCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoJ1JlcXVpcmVkICJtYXhwIiB0YWJsZSBpcyBub3QgZm91bmQnKTsKICAgIH0KICAgIGxldCBudW1HbHlwaHNGcm9tQ0ZGOwogICAgaWYgKCFpc1RydWVUeXBlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IENGRlBhcnNlcihuZXcgU3RyZWFtKHRhYmxlc1siQ0ZGICJdLmRhdGEpLCBwcm9wZXJ0aWVzLCBTRUFDX0FOQUxZU0lTX0VOQUJMRUQpOwogICAgICAgIGNvbnN0IGNmZiA9IHBhcnNlci5wYXJzZSgpOwogICAgICAgIGNmZi5kdXBsaWNhdGVGaXJzdEdseXBoKCk7CiAgICAgICAgY29uc3QgY29tcGlsZXIgPSBuZXcgQ0ZGQ29tcGlsZXIoY2ZmKTsKICAgICAgICB0YWJsZXNbIkNGRiAiXS5kYXRhID0gY29tcGlsZXIuY29tcGlsZSgpOwogICAgICAgIG51bUdseXBoc0Zyb21DRkYgPSBjZmYuY2hhclN0cmluZ0NvdW50OwogICAgICB9IGNhdGNoIHsKICAgICAgICB3YXJuKCJGYWlsZWQgdG8gY29tcGlsZSBmb250ICIgKyBwcm9wZXJ0aWVzLmxvYWRlZE5hbWUpOwogICAgICB9CiAgICB9CiAgICBmb250LnBvcyA9IChmb250LnN0YXJ0IHx8IDApICsgdGFibGVzLm1heHAub2Zmc2V0OwogICAgbGV0IHZlcnNpb24gPSBmb250LmdldEludDMyKCk7CiAgICBjb25zdCBudW1HbHlwaHMgPSBudW1HbHlwaHNGcm9tQ0ZGID8/IGZvbnQuZ2V0VWludDE2KCk7CiAgICBpZiAodmVyc2lvbiA9PT0gMHgwMDAwNTAwMCAmJiB0YWJsZXMubWF4cC5sZW5ndGggIT09IDYpIHsKICAgICAgdGFibGVzLm1heHAuZGF0YSA9IHRhYmxlcy5tYXhwLmRhdGEuc3ViYXJyYXkoMCwgNik7CiAgICAgIHRhYmxlcy5tYXhwLmxlbmd0aCA9IDY7CiAgICB9CiAgICBpZiAodmVyc2lvbiAhPT0gMHgwMDAxMDAwMCAmJiB2ZXJzaW9uICE9PSAweDAwMDA1MDAwKSB7CiAgICAgIGlmICh0YWJsZXMubWF4cC5sZW5ndGggPT09IDYpIHsKICAgICAgICB2ZXJzaW9uID0gMHgwMDA1MDAwOwogICAgICB9IGVsc2UgaWYgKHRhYmxlcy5tYXhwLmxlbmd0aCA+PSAzMikgewogICAgICAgIHZlcnNpb24gPSAweDAwMDEwMDAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgIm1heHAiIHRhYmxlIGhhcyBhIHdyb25nIHZlcnNpb24gbnVtYmVyYCk7CiAgICAgIH0KICAgICAgd3JpdGVVaW50MzIodGFibGVzLm1heHAuZGF0YSwgMCwgdmVyc2lvbik7CiAgICB9CiAgICBsZXQgaXNHbHlwaExvY2F0aW9uc0xvbmcgPSBpbnQxNih0YWJsZXMuaGVhZC5kYXRhWzUwXSwgdGFibGVzLmhlYWQuZGF0YVs1MV0pOwogICAgaWYgKHRhYmxlcy5sb2NhKSB7CiAgICAgIGNvbnN0IGxvY2FMZW5ndGggPSBpc0dseXBoTG9jYXRpb25zTG9uZyA/IChudW1HbHlwaHMgKyAxKSAqIDQgOiAobnVtR2x5cGhzICsgMSkgKiAyOwogICAgICBpZiAodGFibGVzLmxvY2EubGVuZ3RoICE9PSBsb2NhTGVuZ3RoKSB7CiAgICAgICAgd2FybigiSW5jb3JyZWN0ICdsb2NhJyB0YWJsZSBsZW5ndGggLS0gYXR0ZW1wdGluZyB0byBmaXggaXQuIik7CiAgICAgICAgY29uc3Qgc29ydGVkVGFibGVzID0gT2JqZWN0LnZhbHVlcyh0YWJsZXMpLmZpbHRlcihCb29sZWFuKS5zb3J0KChhLCBiKSA9PiBhLm9mZnNldCAtIGIub2Zmc2V0KTsKICAgICAgICBjb25zdCBsb2NhSW5kZXggPSBzb3J0ZWRUYWJsZXMuaW5kZXhPZih0YWJsZXMubG9jYSk7CiAgICAgICAgY29uc3QgbmV4dFRhYmxlID0gc29ydGVkVGFibGVzW2xvY2FJbmRleCArIDFdIHx8IG51bGw7CiAgICAgICAgaWYgKG5leHRUYWJsZSAmJiB0YWJsZXMubG9jYS5vZmZzZXQgKyBsb2NhTGVuZ3RoIDwgbmV4dFRhYmxlLm9mZnNldCkgewogICAgICAgICAgY29uc3QgcHJldmlvdXNQb3MgPSBmb250LnBvczsKICAgICAgICAgIGZvbnQucG9zID0gZm9udC5zdGFydCB8fCAwOwogICAgICAgICAgZm9udC5za2lwKHRhYmxlcy5sb2NhLm9mZnNldCk7CiAgICAgICAgICB0YWJsZXMubG9jYS5kYXRhID0gZm9udC5nZXRCeXRlcyhsb2NhTGVuZ3RoKTsKICAgICAgICAgIHRhYmxlcy5sb2NhLmxlbmd0aCA9IGxvY2FMZW5ndGg7CiAgICAgICAgICBmb250LnBvcyA9IHByZXZpb3VzUG9zOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKHByb3BlcnRpZXMuc2NhbGVGYWN0b3JzPy5sZW5ndGggPT09IG51bUdseXBocyAmJiBpc1RydWVUeXBlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBzY2FsZUZhY3RvcnMKICAgICAgfSA9IHByb3BlcnRpZXM7CiAgICAgIGNvbnN0IGdseXBocyA9IG5ldyBHbHlmVGFibGUoewogICAgICAgIGdseWZUYWJsZTogdGFibGVzLmdseWYuZGF0YSwKICAgICAgICBpc0dseXBoTG9jYXRpb25zTG9uZywKICAgICAgICBsb2NhVGFibGU6IHRhYmxlcy5sb2NhLmRhdGEsCiAgICAgICAgbnVtR2x5cGhzCiAgICAgIH0pOwogICAgICBnbHlwaHMuc2NhbGUoc2NhbGVGYWN0b3JzKTsKICAgICAgY29uc3QgewogICAgICAgIGdseWYsCiAgICAgICAgbG9jYSwKICAgICAgICBpc0xvY2F0aW9uTG9uZwogICAgICB9ID0gZ2x5cGhzLndyaXRlKCk7CiAgICAgIHRhYmxlcy5nbHlmLmRhdGEgPSBnbHlmOwogICAgICB0YWJsZXMubG9jYS5kYXRhID0gbG9jYTsKICAgICAgaWYgKGlzTG9jYXRpb25Mb25nICE9PSAhIWlzR2x5cGhMb2NhdGlvbnNMb25nKSB7CiAgICAgICAgdGFibGVzLmhlYWQuZGF0YVs1MF0gPSAwOwogICAgICAgIGlzR2x5cGhMb2NhdGlvbnNMb25nID0gdGFibGVzLmhlYWQuZGF0YVs1MV0gPSBpc0xvY2F0aW9uTG9uZyA/IDEgOiAwOwogICAgICB9CiAgICAgIGNvbnN0IG1ldHJpY3MgPSB0YWJsZXMuaG10eC5kYXRhOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUdseXBoczsgaSsrKSB7CiAgICAgICAgY29uc3QgaiA9IDQgKiBpOwogICAgICAgIGNvbnN0IGFkdmFuY2VXaWR0aCA9IE1hdGgucm91bmQoc2NhbGVGYWN0b3JzW2ldICogaW50MTYobWV0cmljc1tqXSwgbWV0cmljc1tqICsgMV0pKTsKICAgICAgICBtZXRyaWNzW2pdID0gYWR2YW5jZVdpZHRoID4+IDggJiAweGZmOwogICAgICAgIG1ldHJpY3NbaiArIDFdID0gYWR2YW5jZVdpZHRoICYgMHhmZjsKICAgICAgICBjb25zdCBsc2IgPSBNYXRoLnJvdW5kKHNjYWxlRmFjdG9yc1tpXSAqIHNpZ25lZEludDE2KG1ldHJpY3NbaiArIDJdLCBtZXRyaWNzW2ogKyAzXSkpOwogICAgICAgIHdyaXRlU2lnbmVkSW50MTYobWV0cmljcywgaiArIDIsIGxzYik7CiAgICAgIH0KICAgIH0KICAgIGxldCBudW1HbHlwaHNPdXQgPSBudW1HbHlwaHMgKyAxOwogICAgbGV0IGR1cEZpcnN0RW50cnkgPSB0cnVlOwogICAgaWYgKG51bUdseXBoc091dCA+IDB4ZmZmZikgewogICAgICBkdXBGaXJzdEVudHJ5ID0gZmFsc2U7CiAgICAgIG51bUdseXBoc091dCA9IG51bUdseXBoczsKICAgICAgd2FybigiTm90IGVub3VnaCBzcGFjZSBpbiBnbHlmcyB0byBkdXBsaWNhdGUgZmlyc3QgZ2x5cGguIik7CiAgICB9CiAgICBsZXQgbWF4RnVuY3Rpb25EZWZzID0gMDsKICAgIGxldCBtYXhTaXplT2ZJbnN0cnVjdGlvbnMgPSAwOwogICAgaWYgKHZlcnNpb24gPj0gMHgwMDAxMDAwMCAmJiB0YWJsZXMubWF4cC5sZW5ndGggPj0gMzIpIHsKICAgICAgZm9udC5wb3MgKz0gODsKICAgICAgY29uc3QgbWF4Wm9uZXMgPSBmb250LmdldFVpbnQxNigpOwogICAgICBpZiAobWF4Wm9uZXMgPiAyKSB7CiAgICAgICAgdGFibGVzLm1heHAuZGF0YVsxNF0gPSAwOwogICAgICAgIHRhYmxlcy5tYXhwLmRhdGFbMTVdID0gMjsKICAgICAgfQogICAgICBmb250LnBvcyArPSA0OwogICAgICBtYXhGdW5jdGlvbkRlZnMgPSBmb250LmdldFVpbnQxNigpOwogICAgICBmb250LnBvcyArPSA0OwogICAgICBtYXhTaXplT2ZJbnN0cnVjdGlvbnMgPSBmb250LmdldFVpbnQxNigpOwogICAgfQogICAgdGFibGVzLm1heHAuZGF0YVs0XSA9IG51bUdseXBoc091dCA+PiA4OwogICAgdGFibGVzLm1heHAuZGF0YVs1XSA9IG51bUdseXBoc091dCAmIDI1NTsKICAgIGNvbnN0IGhpbnRzVmFsaWQgPSBzYW5pdGl6ZVRUUHJvZ3JhbXModGFibGVzLmZwZ20sIHRhYmxlcy5wcmVwLCB0YWJsZXNbImN2dCAiXSwgbWF4RnVuY3Rpb25EZWZzKTsKICAgIGlmICghaGludHNWYWxpZCkgewogICAgICBkZWxldGUgdGFibGVzLmZwZ207CiAgICAgIGRlbGV0ZSB0YWJsZXMucHJlcDsKICAgICAgZGVsZXRlIHRhYmxlc1siY3Z0ICJdOwogICAgfQogICAgc2FuaXRpemVNZXRyaWNzKGZvbnQsIHRhYmxlcy5oaGVhLCB0YWJsZXMuaG10eCwgdGFibGVzLmhlYWQsIG51bUdseXBoc091dCwgZHVwRmlyc3RFbnRyeSk7CiAgICBpZiAoIXRhYmxlcy5oZWFkKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignUmVxdWlyZWQgImhlYWQiIHRhYmxlIGlzIG5vdCBmb3VuZCcpOwogICAgfQogICAgc2FuaXRpemVIZWFkKHRhYmxlcy5oZWFkLCBudW1HbHlwaHMsIGlzVHJ1ZVR5cGUgPyB0YWJsZXMubG9jYS5sZW5ndGggOiAwKTsKICAgIGxldCBtaXNzaW5nR2x5cGhzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmIChpc1RydWVUeXBlKSB7CiAgICAgIGNvbnN0IGdseXBoc0luZm8gPSBzYW5pdGl6ZUdseXBoTG9jYXRpb25zKHRhYmxlcy5sb2NhLCB0YWJsZXMuZ2x5ZiwgbnVtR2x5cGhzLCBpc0dseXBoTG9jYXRpb25zTG9uZywgaGludHNWYWxpZCwgZHVwRmlyc3RFbnRyeSwgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zKTsKICAgICAgbWlzc2luZ0dseXBocyA9IGdseXBoc0luZm8ubWlzc2luZ0dseXBoczsKICAgICAgaWYgKHZlcnNpb24gPj0gMHgwMDAxMDAwMCAmJiB0YWJsZXMubWF4cC5sZW5ndGggPj0gMzIpIHsKICAgICAgICB0YWJsZXMubWF4cC5kYXRhWzI2XSA9IGdseXBoc0luZm8ubWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zID4+IDg7CiAgICAgICAgdGFibGVzLm1heHAuZGF0YVsyN10gPSBnbHlwaHNJbmZvLm1heFNpemVPZkluc3RydWN0aW9ucyAmIDI1NTsKICAgICAgfQogICAgfQogICAgaWYgKCF0YWJsZXMuaGhlYSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoJ1JlcXVpcmVkICJoaGVhIiB0YWJsZSBpcyBub3QgZm91bmQnKTsKICAgIH0KICAgIGlmICh0YWJsZXMuaGhlYS5kYXRhWzEwXSA9PT0gMCAmJiB0YWJsZXMuaGhlYS5kYXRhWzExXSA9PT0gMCkgewogICAgICB0YWJsZXMuaGhlYS5kYXRhWzEwXSA9IDB4ZmY7CiAgICAgIHRhYmxlcy5oaGVhLmRhdGFbMTFdID0gMHhmZjsKICAgIH0KICAgIGNvbnN0IG1ldHJpY3NPdmVycmlkZSA9IHsKICAgICAgdW5pdHNQZXJFbTogaW50MTYodGFibGVzLmhlYWQuZGF0YVsxOF0sIHRhYmxlcy5oZWFkLmRhdGFbMTldKSwKICAgICAgeU1heDogc2lnbmVkSW50MTYodGFibGVzLmhlYWQuZGF0YVs0Ml0sIHRhYmxlcy5oZWFkLmRhdGFbNDNdKSwKICAgICAgeU1pbjogc2lnbmVkSW50MTYodGFibGVzLmhlYWQuZGF0YVszOF0sIHRhYmxlcy5oZWFkLmRhdGFbMzldKSwKICAgICAgYXNjZW50OiBzaWduZWRJbnQxNih0YWJsZXMuaGhlYS5kYXRhWzRdLCB0YWJsZXMuaGhlYS5kYXRhWzVdKSwKICAgICAgZGVzY2VudDogc2lnbmVkSW50MTYodGFibGVzLmhoZWEuZGF0YVs2XSwgdGFibGVzLmhoZWEuZGF0YVs3XSksCiAgICAgIGxpbmVHYXA6IHNpZ25lZEludDE2KHRhYmxlcy5oaGVhLmRhdGFbOF0sIHRhYmxlcy5oaGVhLmRhdGFbOV0pCiAgICB9OwogICAgdGhpcy5hc2NlbnQgPSBtZXRyaWNzT3ZlcnJpZGUuYXNjZW50IC8gbWV0cmljc092ZXJyaWRlLnVuaXRzUGVyRW07CiAgICB0aGlzLmRlc2NlbnQgPSBtZXRyaWNzT3ZlcnJpZGUuZGVzY2VudCAvIG1ldHJpY3NPdmVycmlkZS51bml0c1BlckVtOwogICAgdGhpcy5saW5lR2FwID0gbWV0cmljc092ZXJyaWRlLmxpbmVHYXAgLyBtZXRyaWNzT3ZlcnJpZGUudW5pdHNQZXJFbTsKICAgIGlmICh0aGlzLmNzc0ZvbnRJbmZvPy5saW5lSGVpZ2h0KSB7CiAgICAgIHRoaXMubGluZUhlaWdodCA9IHRoaXMuY3NzRm9udEluZm8ubWV0cmljcy5saW5lSGVpZ2h0OwogICAgICB0aGlzLmxpbmVHYXAgPSB0aGlzLmNzc0ZvbnRJbmZvLm1ldHJpY3MubGluZUdhcDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubGluZUhlaWdodCA9IHRoaXMuYXNjZW50IC0gdGhpcy5kZXNjZW50ICsgdGhpcy5saW5lR2FwOwogICAgfQogICAgaWYgKHRhYmxlcy5wb3N0KSB7CiAgICAgIHJlYWRQb3N0U2NyaXB0VGFibGUodGFibGVzLnBvc3QsIHByb3BlcnRpZXMsIG51bUdseXBocyk7CiAgICB9CiAgICB0YWJsZXMucG9zdCA9IHsKICAgICAgdGFnOiAicG9zdCIsCiAgICAgIGRhdGE6IGNyZWF0ZVBvc3RUYWJsZShwcm9wZXJ0aWVzKQogICAgfTsKICAgIGNvbnN0IGNoYXJDb2RlVG9HbHlwaElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZ1bmN0aW9uIGhhc0dseXBoKGdseXBoSWQpIHsKICAgICAgcmV0dXJuICFtaXNzaW5nR2x5cGhzW2dseXBoSWRdOwogICAgfQogICAgaWYgKHByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgIGNvbnN0IGNpZFRvR2lkTWFwID0gcHJvcGVydGllcy5jaWRUb0dpZE1hcCB8fCBbXTsKICAgICAgY29uc3QgaXNDaWRUb0dpZE1hcEVtcHR5ID0gY2lkVG9HaWRNYXAubGVuZ3RoID09PSAwOwogICAgICBwcm9wZXJ0aWVzLmNNYXAuZm9yRWFjaChmdW5jdGlvbiAoY2hhckNvZGUsIGNpZCkgewogICAgICAgIGlmICh0eXBlb2YgY2lkID09PSAic3RyaW5nIikgewogICAgICAgICAgY2lkID0gY29udmVydENpZFN0cmluZyhjaGFyQ29kZSwgY2lkLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNpZCA+IDB4ZmZmZikgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJNYXggc2l6ZSBvZiBDSUQgaXMgNjUsNTM1Iik7CiAgICAgICAgfQogICAgICAgIGxldCBnbHlwaElkID0gLTE7CiAgICAgICAgaWYgKGlzQ2lkVG9HaWRNYXBFbXB0eSkgewogICAgICAgICAgZ2x5cGhJZCA9IGNpZDsKICAgICAgICB9IGVsc2UgaWYgKGNpZFRvR2lkTWFwW2NpZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZ2x5cGhJZCA9IGNpZFRvR2lkTWFwW2NpZF07CiAgICAgICAgfQogICAgICAgIGlmIChnbHlwaElkID49IDAgJiYgZ2x5cGhJZCA8IG51bUdseXBocyAmJiBoYXNHbHlwaChnbHlwaElkKSkgewogICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgY21hcFRhYmxlID0gcmVhZENtYXBUYWJsZSh0YWJsZXMuY21hcCwgZm9udCwgdGhpcy5pc1N5bWJvbGljRm9udCwgcHJvcGVydGllcy5oYXNFbmNvZGluZyk7CiAgICAgIGNvbnN0IGNtYXBQbGF0Zm9ybUlkID0gY21hcFRhYmxlLnBsYXRmb3JtSWQ7CiAgICAgIGNvbnN0IGNtYXBFbmNvZGluZ0lkID0gY21hcFRhYmxlLmVuY29kaW5nSWQ7CiAgICAgIGNvbnN0IGNtYXBNYXBwaW5ncyA9IGNtYXBUYWJsZS5tYXBwaW5nczsKICAgICAgbGV0IGJhc2VFbmNvZGluZyA9IFtdLAogICAgICAgIGZvcmNlUG9zdFRhYmxlID0gZmFsc2U7CiAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc0VuY29kaW5nICYmIChwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUgPT09ICJNYWNSb21hbkVuY29kaW5nIiB8fCBwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUgPT09ICJXaW5BbnNpRW5jb2RpbmciKSkgewogICAgICAgIGJhc2VFbmNvZGluZyA9IGdldEVuY29kaW5nKHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSk7CiAgICAgIH0KICAgICAgaWYgKHByb3BlcnRpZXMuaGFzRW5jb2RpbmcgJiYgIXRoaXMuaXNTeW1ib2xpY0ZvbnQgJiYgKGNtYXBQbGF0Zm9ybUlkID09PSAzICYmIGNtYXBFbmNvZGluZ0lkID09PSAxIHx8IGNtYXBQbGF0Zm9ybUlkID09PSAxICYmIGNtYXBFbmNvZGluZ0lkID09PSAwKSkgewogICAgICAgIGNvbnN0IGdseXBoc1VuaWNvZGVNYXAgPSBnZXRHbHlwaHNVbmljb2RlKCk7CiAgICAgICAgZm9yIChsZXQgY2hhckNvZGUgPSAwOyBjaGFyQ29kZSA8IDI1NjsgY2hhckNvZGUrKykgewogICAgICAgICAgbGV0IGdseXBoTmFtZTsKICAgICAgICAgIGlmICh0aGlzLmRpZmZlcmVuY2VzW2NoYXJDb2RlXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGdseXBoTmFtZSA9IHRoaXMuZGlmZmVyZW5jZXNbY2hhckNvZGVdOwogICAgICAgICAgfSBlbHNlIGlmIChiYXNlRW5jb2RpbmcubGVuZ3RoICYmIGJhc2VFbmNvZGluZ1tjaGFyQ29kZV0gIT09ICIiKSB7CiAgICAgICAgICAgIGdseXBoTmFtZSA9IGJhc2VFbmNvZGluZ1tjaGFyQ29kZV07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBnbHlwaE5hbWUgPSBTdGFuZGFyZEVuY29kaW5nW2NoYXJDb2RlXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghZ2x5cGhOYW1lKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgc3RhbmRhcmRHbHlwaE5hbWUgPSByZWNvdmVyR2x5cGhOYW1lKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICAgICAgICBsZXQgdW5pY29kZU9yQ2hhckNvZGU7CiAgICAgICAgICBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDMgJiYgY21hcEVuY29kaW5nSWQgPT09IDEpIHsKICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSBnbHlwaHNVbmljb2RlTWFwW3N0YW5kYXJkR2x5cGhOYW1lXTsKICAgICAgICAgIH0gZWxzZSBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDEgJiYgY21hcEVuY29kaW5nSWQgPT09IDApIHsKICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSBNYWNSb21hbkVuY29kaW5nLmluZGV4T2Yoc3RhbmRhcmRHbHlwaE5hbWUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHVuaWNvZGVPckNoYXJDb2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYgKCFwcm9wZXJ0aWVzLmdseXBoTmFtZXMgJiYgcHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCAmJiAhKHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApKSB7CiAgICAgICAgICAgICAgY29uc3QgdW5pY29kZSA9IHRoaXMudG9Vbmljb2RlLmdldChjaGFyQ29kZSk7CiAgICAgICAgICAgICAgaWYgKHVuaWNvZGUpIHsKICAgICAgICAgICAgICAgIHVuaWNvZGVPckNoYXJDb2RlID0gdW5pY29kZS5jb2RlUG9pbnRBdCgwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVuaWNvZGVPckNoYXJDb2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZm9yIChjb25zdCBtYXBwaW5nIG9mIGNtYXBNYXBwaW5ncykgewogICAgICAgICAgICBpZiAobWFwcGluZy5jaGFyQ29kZSAhPT0gdW5pY29kZU9yQ2hhckNvZGUpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBtYXBwaW5nLmdseXBoSWQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjbWFwUGxhdGZvcm1JZCA9PT0gMCkgewogICAgICAgIGZvciAoY29uc3QgbWFwcGluZyBvZiBjbWFwTWFwcGluZ3MpIHsKICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW21hcHBpbmcuY2hhckNvZGVdID0gbWFwcGluZy5nbHlwaElkOwogICAgICAgIH0KICAgICAgICBmb3JjZVBvc3RUYWJsZSA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDMgJiYgY21hcEVuY29kaW5nSWQgPT09IDApIHsKICAgICAgICBmb3IgKGNvbnN0IG1hcHBpbmcgb2YgY21hcE1hcHBpbmdzKSB7CiAgICAgICAgICBsZXQgY2hhckNvZGUgPSBtYXBwaW5nLmNoYXJDb2RlOwogICAgICAgICAgaWYgKGNoYXJDb2RlID49IDB4ZjAwMCAmJiBjaGFyQ29kZSA8PSAweGYwZmYpIHsKICAgICAgICAgICAgY2hhckNvZGUgJj0gMHhmZjsKICAgICAgICAgIH0KICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IG1hcHBpbmcuZ2x5cGhJZDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBtYXBwaW5nIG9mIGNtYXBNYXBwaW5ncykgewogICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbbWFwcGluZy5jaGFyQ29kZV0gPSBtYXBwaW5nLmdseXBoSWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwcm9wZXJ0aWVzLmdseXBoTmFtZXMgJiYgKGJhc2VFbmNvZGluZy5sZW5ndGggfHwgdGhpcy5kaWZmZXJlbmNlcy5sZW5ndGgpKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICAgICAgaWYgKCFmb3JjZVBvc3RUYWJsZSAmJiBjaGFyQ29kZVRvR2x5cGhJZFtpXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgZ2x5cGhOYW1lID0gdGhpcy5kaWZmZXJlbmNlc1tpXSB8fCBiYXNlRW5jb2RpbmdbaV07CiAgICAgICAgICBpZiAoIWdseXBoTmFtZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGdseXBoSWQgPSBwcm9wZXJ0aWVzLmdseXBoTmFtZXMuaW5kZXhPZihnbHlwaE5hbWUpOwogICAgICAgICAgaWYgKGdseXBoSWQgPiAwICYmIGhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2ldID0gZ2x5cGhJZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChjaGFyQ29kZVRvR2x5cGhJZC5sZW5ndGggPT09IDApIHsKICAgICAgY2hhckNvZGVUb0dseXBoSWRbMF0gPSAwOwogICAgfQogICAgbGV0IGdseXBoWmVyb0lkID0gbnVtR2x5cGhzT3V0IC0gMTsKICAgIGlmICghZHVwRmlyc3RFbnRyeSkgewogICAgICBnbHlwaFplcm9JZCA9IDA7CiAgICB9CiAgICBpZiAoIXByb3BlcnRpZXMuY3NzRm9udEluZm8pIHsKICAgICAgY29uc3QgbmV3TWFwcGluZyA9IGFkanVzdE1hcHBpbmcoY2hhckNvZGVUb0dseXBoSWQsIGhhc0dseXBoLCBnbHlwaFplcm9JZCwgdGhpcy50b1VuaWNvZGUpOwogICAgICB0aGlzLnRvRm9udENoYXIgPSBuZXdNYXBwaW5nLnRvRm9udENoYXI7CiAgICAgIHRhYmxlcy5jbWFwID0gewogICAgICAgIHRhZzogImNtYXAiLAogICAgICAgIGRhdGE6IGNyZWF0ZUNtYXBUYWJsZShuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkLCBuZXdNYXBwaW5nLnRvVW5pY29kZUV4dHJhTWFwLCBudW1HbHlwaHNPdXQpCiAgICAgIH07CiAgICAgIGlmICghdGFibGVzWyJPUy8yIl0gfHwgIXZhbGlkYXRlT1MyVGFibGUodGFibGVzWyJPUy8yIl0sIGZvbnQpKSB7CiAgICAgICAgdGFibGVzWyJPUy8yIl0gPSB7CiAgICAgICAgICB0YWc6ICJPUy8yIiwKICAgICAgICAgIGRhdGE6IGNyZWF0ZU9TMlRhYmxlKHByb3BlcnRpZXMsIG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQsIG1ldHJpY3NPdmVycmlkZSkKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBpZiAoIXRhYmxlcy5uYW1lKSB7CiAgICAgIHRhYmxlcy5uYW1lID0gewogICAgICAgIHRhZzogIm5hbWUiLAogICAgICAgIGRhdGE6IGNyZWF0ZU5hbWVUYWJsZSh0aGlzLm5hbWUpCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBjb25zdCBbbmFtZVByb3RvdHlwZSwgbmFtZVJlY29yZHNdID0gcmVhZE5hbWVUYWJsZSh0YWJsZXMubmFtZSk7CiAgICAgIHRhYmxlcy5uYW1lLmRhdGEgPSBjcmVhdGVOYW1lVGFibGUobmFtZSwgbmFtZVByb3RvdHlwZSk7CiAgICAgIHRoaXMucHNOYW1lID0gbmFtZVByb3RvdHlwZVswXVs2XSB8fCBudWxsOwogICAgICBpZiAoIXByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgICAgYWRqdXN0VHJ1ZVR5cGVUb1VuaWNvZGUocHJvcGVydGllcywgdGhpcy5pc1N5bWJvbGljRm9udCwgbmFtZVJlY29yZHMpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBidWlsZGVyID0gbmV3IE9wZW5UeXBlRmlsZUJ1aWxkZXIoaGVhZGVyLnZlcnNpb24pOwogICAgZm9yIChjb25zdCB0YWJsZVRhZyBpbiB0YWJsZXMpIHsKICAgICAgYnVpbGRlci5hZGRUYWJsZSh0YWJsZVRhZywgdGFibGVzW3RhYmxlVGFnXS5kYXRhKTsKICAgIH0KICAgIHJldHVybiBidWlsZGVyLnRvQXJyYXkoKTsKICB9CiAgY29udmVydChmb250TmFtZSwgZm9udCwgcHJvcGVydGllcykgewogICAgcHJvcGVydGllcy5maXhlZFBpdGNoID0gZmFsc2U7CiAgICBpZiAocHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcpIHsKICAgICAgYWRqdXN0VHlwZTFUb1VuaWNvZGUocHJvcGVydGllcywgcHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcpOwogICAgfQogICAgbGV0IGdseXBoWmVyb0lkID0gMTsKICAgIGlmIChmb250IGluc3RhbmNlb2YgQ0ZGRm9udCkgewogICAgICBnbHlwaFplcm9JZCA9IGZvbnQubnVtR2x5cGhzIC0gMTsKICAgIH0KICAgIGNvbnN0IG1hcHBpbmcgPSBmb250LmdldEdseXBoTWFwcGluZyhwcm9wZXJ0aWVzKTsKICAgIGxldCBuZXdNYXBwaW5nID0gbnVsbDsKICAgIGxldCBuZXdDaGFyQ29kZVRvR2x5cGhJZCA9IG1hcHBpbmc7CiAgICBsZXQgdG9Vbmljb2RlRXh0cmFNYXAgPSBudWxsOwogICAgaWYgKCFwcm9wZXJ0aWVzLmNzc0ZvbnRJbmZvKSB7CiAgICAgIG5ld01hcHBpbmcgPSBhZGp1c3RNYXBwaW5nKG1hcHBpbmcsIGZvbnQuaGFzR2x5cGhJZC5iaW5kKGZvbnQpLCBnbHlwaFplcm9JZCwgdGhpcy50b1VuaWNvZGUpOwogICAgICB0aGlzLnRvRm9udENoYXIgPSBuZXdNYXBwaW5nLnRvRm9udENoYXI7CiAgICAgIG5ld0NoYXJDb2RlVG9HbHlwaElkID0gbmV3TWFwcGluZy5jaGFyQ29kZVRvR2x5cGhJZDsKICAgICAgdG9Vbmljb2RlRXh0cmFNYXAgPSBuZXdNYXBwaW5nLnRvVW5pY29kZUV4dHJhTWFwOwogICAgfQogICAgY29uc3QgbnVtR2x5cGhzID0gZm9udC5udW1HbHlwaHM7CiAgICBmdW5jdGlvbiBnZXRDaGFyQ29kZXMoY2hhckNvZGVUb0dseXBoSWQsIGdseXBoSWQpIHsKICAgICAgbGV0IGNoYXJDb2RlcyA9IG51bGw7CiAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gY2hhckNvZGVUb0dseXBoSWQpIHsKICAgICAgICBpZiAoZ2x5cGhJZCA9PT0gY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdKSB7CiAgICAgICAgICAoY2hhckNvZGVzIHx8PSBbXSkucHVzaChjaGFyQ29kZSB8IDApOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2hhckNvZGVzOwogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlQ2hhckNvZGUoY2hhckNvZGVUb0dseXBoSWQsIGdseXBoSWQpIHsKICAgICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBjaGFyQ29kZVRvR2x5cGhJZCkgewogICAgICAgIGlmIChnbHlwaElkID09PSBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0pIHsKICAgICAgICAgIHJldHVybiBjaGFyQ29kZSB8IDA7CiAgICAgICAgfQogICAgICB9CiAgICAgIG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWRbbmV3TWFwcGluZy5uZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgIHJldHVybiBuZXdNYXBwaW5nLm5leHRBdmFpbGFibGVGb250Q2hhckNvZGUrKzsKICAgIH0KICAgIGNvbnN0IHNlYWNzID0gZm9udC5zZWFjczsKICAgIGlmIChuZXdNYXBwaW5nICYmIFNFQUNfQU5BTFlTSVNfRU5BQkxFRCAmJiBzZWFjcz8ubGVuZ3RoKSB7CiAgICAgIGNvbnN0IG1hdHJpeCA9IHByb3BlcnRpZXMuZm9udE1hdHJpeCB8fCBGT05UX0lERU5USVRZX01BVFJJWDsKICAgICAgY29uc3QgY2hhcnNldCA9IGZvbnQuZ2V0Q2hhcnNldCgpOwogICAgICBjb25zdCBzZWFjTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgZm9yIChsZXQgZ2x5cGhJZCBpbiBzZWFjcykgewogICAgICAgIGdseXBoSWQgfD0gMDsKICAgICAgICBjb25zdCBzZWFjID0gc2VhY3NbZ2x5cGhJZF07CiAgICAgICAgY29uc3QgYmFzZUdseXBoTmFtZSA9IFN0YW5kYXJkRW5jb2Rpbmdbc2VhY1syXV07CiAgICAgICAgY29uc3QgYWNjZW50R2x5cGhOYW1lID0gU3RhbmRhcmRFbmNvZGluZ1tzZWFjWzNdXTsKICAgICAgICBjb25zdCBiYXNlR2x5cGhJZCA9IGNoYXJzZXQuaW5kZXhPZihiYXNlR2x5cGhOYW1lKTsKICAgICAgICBjb25zdCBhY2NlbnRHbHlwaElkID0gY2hhcnNldC5pbmRleE9mKGFjY2VudEdseXBoTmFtZSk7CiAgICAgICAgaWYgKGJhc2VHbHlwaElkIDwgMCB8fCBhY2NlbnRHbHlwaElkIDwgMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFjY2VudE9mZnNldCA9IHsKICAgICAgICAgIHg6IHNlYWNbMF0gKiBtYXRyaXhbMF0gKyBzZWFjWzFdICogbWF0cml4WzJdICsgbWF0cml4WzRdLAogICAgICAgICAgeTogc2VhY1swXSAqIG1hdHJpeFsxXSArIHNlYWNbMV0gKiBtYXRyaXhbM10gKyBtYXRyaXhbNV0KICAgICAgICB9OwogICAgICAgIGNvbnN0IGNoYXJDb2RlcyA9IGdldENoYXJDb2RlcyhtYXBwaW5nLCBnbHlwaElkKTsKICAgICAgICBpZiAoIWNoYXJDb2RlcykgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgb2YgY2hhckNvZGVzKSB7CiAgICAgICAgICBjb25zdCBjaGFyQ29kZVRvR2x5cGhJZCA9IG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQ7CiAgICAgICAgICBjb25zdCBiYXNlRm9udENoYXJDb2RlID0gY3JlYXRlQ2hhckNvZGUoY2hhckNvZGVUb0dseXBoSWQsIGJhc2VHbHlwaElkKTsKICAgICAgICAgIGNvbnN0IGFjY2VudEZvbnRDaGFyQ29kZSA9IGNyZWF0ZUNoYXJDb2RlKGNoYXJDb2RlVG9HbHlwaElkLCBhY2NlbnRHbHlwaElkKTsKICAgICAgICAgIHNlYWNNYXBbY2hhckNvZGVdID0gewogICAgICAgICAgICBiYXNlRm9udENoYXJDb2RlLAogICAgICAgICAgICBhY2NlbnRGb250Q2hhckNvZGUsCiAgICAgICAgICAgIGFjY2VudE9mZnNldAogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJvcGVydGllcy5zZWFjTWFwID0gc2VhY01hcDsKICAgIH0KICAgIGNvbnN0IHVuaXRzUGVyRW0gPSBwcm9wZXJ0aWVzLmZvbnRNYXRyaXggPyAxIC8gTWF0aC5tYXgoLi4ucHJvcGVydGllcy5mb250TWF0cml4LnNsaWNlKDAsIDQpLm1hcChNYXRoLmFicykpIDogMTAwMDsKICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgT3BlblR5cGVGaWxlQnVpbGRlcigiXHg0Rlx4NTRceDU0XHg0RiIpOwogICAgYnVpbGRlci5hZGRUYWJsZSgiQ0ZGICIsIGZvbnQuZGF0YSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJPUy8yIiwgY3JlYXRlT1MyVGFibGUocHJvcGVydGllcywgbmV3Q2hhckNvZGVUb0dseXBoSWQpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoImNtYXAiLCBjcmVhdGVDbWFwVGFibGUobmV3Q2hhckNvZGVUb0dseXBoSWQsIHRvVW5pY29kZUV4dHJhTWFwLCBudW1HbHlwaHMpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoImhlYWQiLCAiXHgwMFx4MDFceDAwXHgwMCIgKyAiXHgwMFx4MDBceDEwXHgwMCIgKyAiXHgwMFx4MDBceDAwXHgwMCIgKyAiXHg1Rlx4MEZceDNDXHhGNSIgKyAiXHgwMFx4MDAiICsgc2FmZVN0cmluZzE2KHVuaXRzUGVyRW0pICsgIlx4MDBceDAwXHgwMFx4MDBceDllXHgwYlx4N2VceDI3IiArICJceDAwXHgwMFx4MDBceDAwXHg5ZVx4MGJceDdlXHgyNyIgKyAiXHgwMFx4MDAiICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuZGVzY2VudCkgKyAiXHgwRlx4RkYiICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuYXNjZW50KSArIHN0cmluZzE2KHByb3BlcnRpZXMuaXRhbGljQW5nbGUgPyAyIDogMCkgKyAiXHgwMFx4MTEiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoImhoZWEiLCAiXHgwMFx4MDFceDAwXHgwMCIgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5hc2NlbnQpICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuZGVzY2VudCkgKyAiXHgwMFx4MDAiICsgIlx4RkZceEZGIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArIHNhZmVTdHJpbmcxNihwcm9wZXJ0aWVzLmNhcEhlaWdodCkgKyBzYWZlU3RyaW5nMTYoTWF0aC50YW4ocHJvcGVydGllcy5pdGFsaWNBbmdsZSkgKiBwcm9wZXJ0aWVzLnhIZWlnaHQpICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgc3RyaW5nMTYobnVtR2x5cGhzKSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJobXR4IiwgZnVuY3Rpb24gZm9udEZpZWxkc0htdHgoKSB7CiAgICAgIGNvbnN0IGNoYXJzdHJpbmdzID0gZm9udC5jaGFyc3RyaW5nczsKICAgICAgY29uc3QgY2ZmV2lkdGhzID0gZm9udC5jZmYgPyBmb250LmNmZi53aWR0aHMgOiBudWxsOwogICAgICBsZXQgaG10eCA9ICJceDAwXHgwMFx4MDBceDAwIjsKICAgICAgZm9yIChsZXQgaSA9IDEsIGlpID0gbnVtR2x5cGhzOyBpIDwgaWk7IGkrKykgewogICAgICAgIGxldCB3aWR0aCA9IDA7CiAgICAgICAgaWYgKGNoYXJzdHJpbmdzKSB7CiAgICAgICAgICBjb25zdCBjaGFyc3RyaW5nID0gY2hhcnN0cmluZ3NbaSAtIDFdOwogICAgICAgICAgd2lkdGggPSAid2lkdGgiIGluIGNoYXJzdHJpbmcgPyBjaGFyc3RyaW5nLndpZHRoIDogMDsKICAgICAgICB9IGVsc2UgaWYgKGNmZldpZHRocykgewogICAgICAgICAgd2lkdGggPSBNYXRoLmNlaWwoY2ZmV2lkdGhzW2ldIHx8IDApOwogICAgICAgIH0KICAgICAgICBobXR4ICs9IHN0cmluZzE2KHdpZHRoKSArIHN0cmluZzE2KDApOwogICAgICB9CiAgICAgIHJldHVybiBobXR4OwogICAgfSgpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoIm1heHAiLCAiXHgwMFx4MDBceDUwXHgwMCIgKyBzdHJpbmcxNihudW1HbHlwaHMpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoIm5hbWUiLCBjcmVhdGVOYW1lVGFibGUoZm9udE5hbWUpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoInBvc3QiLCBjcmVhdGVQb3N0VGFibGUocHJvcGVydGllcykpOwogICAgcmV0dXJuIGJ1aWxkZXIudG9BcnJheSgpOwogIH0KICBnZXQgX3NwYWNlV2lkdGgoKSB7CiAgICBjb25zdCBwb3NzaWJsZVNwYWNlUmVwbGFjZW1lbnRzID0gWyJzcGFjZSIsICJtaW51cyIsICJvbmUiLCAiaSIsICJJIl07CiAgICBsZXQgd2lkdGg7CiAgICBmb3IgKGNvbnN0IGdseXBoTmFtZSBvZiBwb3NzaWJsZVNwYWNlUmVwbGFjZW1lbnRzKSB7CiAgICAgIGlmIChnbHlwaE5hbWUgaW4gdGhpcy53aWR0aHMpIHsKICAgICAgICB3aWR0aCA9IHRoaXMud2lkdGhzW2dseXBoTmFtZV07CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY29uc3QgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICAgICAgY29uc3QgZ2x5cGhVbmljb2RlID0gZ2x5cGhzVW5pY29kZU1hcFtnbHlwaE5hbWVdOwogICAgICBsZXQgY2hhcmNvZGUgPSAwOwogICAgICBpZiAodGhpcy5jb21wb3NpdGUgJiYgdGhpcy5jTWFwLmNvbnRhaW5zKGdseXBoVW5pY29kZSkpIHsKICAgICAgICBjaGFyY29kZSA9IHRoaXMuY01hcC5sb29rdXAoZ2x5cGhVbmljb2RlKTsKICAgICAgICBpZiAodHlwZW9mIGNoYXJjb2RlID09PSAic3RyaW5nIikgewogICAgICAgICAgY2hhcmNvZGUgPSBjb252ZXJ0Q2lkU3RyaW5nKGdseXBoVW5pY29kZSwgY2hhcmNvZGUpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIWNoYXJjb2RlICYmIHRoaXMudG9Vbmljb2RlKSB7CiAgICAgICAgY2hhcmNvZGUgPSB0aGlzLnRvVW5pY29kZS5jaGFyQ29kZU9mKGdseXBoVW5pY29kZSk7CiAgICAgIH0KICAgICAgaWYgKGNoYXJjb2RlIDw9IDApIHsKICAgICAgICBjaGFyY29kZSA9IGdseXBoVW5pY29kZTsKICAgICAgfQogICAgICB3aWR0aCA9IHRoaXMud2lkdGhzW2NoYXJjb2RlXTsKICAgICAgaWYgKHdpZHRoKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgIl9zcGFjZVdpZHRoIiwgd2lkdGggfHwgdGhpcy5kZWZhdWx0V2lkdGgpOwogIH0KICBfY2hhclRvR2x5cGgoY2hhcmNvZGUsIGlzU3BhY2UgPSBmYWxzZSkgewogICAgbGV0IGdseXBoID0gdGhpcy5fZ2x5cGhDYWNoZVtjaGFyY29kZV07CiAgICBpZiAoZ2x5cGg/LmlzU3BhY2UgPT09IGlzU3BhY2UpIHsKICAgICAgcmV0dXJuIGdseXBoOwogICAgfQogICAgbGV0IGZvbnRDaGFyQ29kZSwgd2lkdGgsIG9wZXJhdG9yTGlzdElkOwogICAgbGV0IHdpZHRoQ29kZSA9IGNoYXJjb2RlOwogICAgaWYgKHRoaXMuY01hcD8uY29udGFpbnMoY2hhcmNvZGUpKSB7CiAgICAgIHdpZHRoQ29kZSA9IHRoaXMuY01hcC5sb29rdXAoY2hhcmNvZGUpOwogICAgICBpZiAodHlwZW9mIHdpZHRoQ29kZSA9PT0gInN0cmluZyIpIHsKICAgICAgICB3aWR0aENvZGUgPSBjb252ZXJ0Q2lkU3RyaW5nKGNoYXJjb2RlLCB3aWR0aENvZGUpOwogICAgICB9CiAgICB9CiAgICB3aWR0aCA9IHRoaXMud2lkdGhzW3dpZHRoQ29kZV07CiAgICBpZiAodHlwZW9mIHdpZHRoICE9PSAibnVtYmVyIikgewogICAgICB3aWR0aCA9IHRoaXMuZGVmYXVsdFdpZHRoOwogICAgfQogICAgY29uc3Qgdm1ldHJpYyA9IHRoaXMudm1ldHJpY3M/Llt3aWR0aENvZGVdOwogICAgbGV0IHVuaWNvZGUgPSB0aGlzLnRvVW5pY29kZS5nZXQoY2hhcmNvZGUpIHx8IGNoYXJjb2RlOwogICAgaWYgKHR5cGVvZiB1bmljb2RlID09PSAibnVtYmVyIikgewogICAgICB1bmljb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZSh1bmljb2RlKTsKICAgIH0KICAgIGxldCBpc0luRm9udCA9IHRoaXMudG9Gb250Q2hhcltjaGFyY29kZV0gIT09IHVuZGVmaW5lZDsKICAgIGZvbnRDaGFyQ29kZSA9IHRoaXMudG9Gb250Q2hhcltjaGFyY29kZV0gfHwgY2hhcmNvZGU7CiAgICBpZiAodGhpcy5taXNzaW5nRmlsZSkgewogICAgICBjb25zdCBnbHlwaE5hbWUgPSB0aGlzLmRpZmZlcmVuY2VzW2NoYXJjb2RlXSB8fCB0aGlzLmRlZmF1bHRFbmNvZGluZ1tjaGFyY29kZV07CiAgICAgIGlmICgoZ2x5cGhOYW1lID09PSAiLm5vdGRlZiIgfHwgZ2x5cGhOYW1lID09PSAiIikgJiYgdGhpcy50eXBlID09PSAiVHlwZTEiKSB7CiAgICAgICAgZm9udENoYXJDb2RlID0gMHgyMDsKICAgICAgICBpZiAoZ2x5cGhOYW1lID09PSAiIikgewogICAgICAgICAgd2lkdGggfHw9IHRoaXMuX3NwYWNlV2lkdGg7CiAgICAgICAgICB1bmljb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZShmb250Q2hhckNvZGUpOwogICAgICAgIH0KICAgICAgfQogICAgICBmb250Q2hhckNvZGUgPSBtYXBTcGVjaWFsVW5pY29kZVZhbHVlcyhmb250Q2hhckNvZGUpOwogICAgfQogICAgaWYgKHRoaXMuaXNUeXBlM0ZvbnQpIHsKICAgICAgb3BlcmF0b3JMaXN0SWQgPSBmb250Q2hhckNvZGU7CiAgICB9CiAgICBsZXQgYWNjZW50ID0gbnVsbDsKICAgIGlmICh0aGlzLnNlYWNNYXA/LltjaGFyY29kZV0pIHsKICAgICAgaXNJbkZvbnQgPSB0cnVlOwogICAgICBjb25zdCBzZWFjID0gdGhpcy5zZWFjTWFwW2NoYXJjb2RlXTsKICAgICAgZm9udENoYXJDb2RlID0gc2VhYy5iYXNlRm9udENoYXJDb2RlOwogICAgICBhY2NlbnQgPSB7CiAgICAgICAgZm9udENoYXI6IFN0cmluZy5mcm9tQ29kZVBvaW50KHNlYWMuYWNjZW50Rm9udENoYXJDb2RlKSwKICAgICAgICBvZmZzZXQ6IHNlYWMuYWNjZW50T2Zmc2V0CiAgICAgIH07CiAgICB9CiAgICBsZXQgZm9udENoYXIgPSAiIjsKICAgIGlmICh0eXBlb2YgZm9udENoYXJDb2RlID09PSAibnVtYmVyIikgewogICAgICBpZiAoZm9udENoYXJDb2RlIDw9IDB4MTBmZmZmKSB7CiAgICAgICAgZm9udENoYXIgPSBTdHJpbmcuZnJvbUNvZGVQb2ludChmb250Q2hhckNvZGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oYGNoYXJUb0dseXBoIC0gaW52YWxpZCBmb250Q2hhckNvZGU6ICR7Zm9udENoYXJDb2RlfWApOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5taXNzaW5nRmlsZSAmJiB0aGlzLnZlcnRpY2FsICYmIGZvbnRDaGFyLmxlbmd0aCA9PT0gMSkgewogICAgICBjb25zdCB2ZXJ0aWNhbCA9IGdldFZlcnRpY2FsUHJlc2VudGF0aW9uRm9ybSgpW2ZvbnRDaGFyLmNoYXJDb2RlQXQoMCldOwogICAgICBpZiAodmVydGljYWwpIHsKICAgICAgICBmb250Q2hhciA9IHVuaWNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHZlcnRpY2FsKTsKICAgICAgfQogICAgfQogICAgZ2x5cGggPSBuZXcgZm9udHNfR2x5cGgoY2hhcmNvZGUsIGZvbnRDaGFyLCB1bmljb2RlLCBhY2NlbnQsIHdpZHRoLCB2bWV0cmljLCBvcGVyYXRvckxpc3RJZCwgaXNTcGFjZSwgaXNJbkZvbnQpOwogICAgcmV0dXJuIHRoaXMuX2dseXBoQ2FjaGVbY2hhcmNvZGVdID0gZ2x5cGg7CiAgfQogIGNoYXJzVG9HbHlwaHMoY2hhcnMpIHsKICAgIGxldCBnbHlwaHMgPSB0aGlzLl9jaGFyc0NhY2hlW2NoYXJzXTsKICAgIGlmIChnbHlwaHMpIHsKICAgICAgcmV0dXJuIGdseXBoczsKICAgIH0KICAgIGdseXBocyA9IFtdOwogICAgaWYgKHRoaXMuY01hcCkgewogICAgICBjb25zdCBjID0gT2JqZWN0LmNyZWF0ZShudWxsKSwKICAgICAgICBpaSA9IGNoYXJzLmxlbmd0aDsKICAgICAgbGV0IGkgPSAwOwogICAgICB3aGlsZSAoaSA8IGlpKSB7CiAgICAgICAgdGhpcy5jTWFwLnJlYWRDaGFyQ29kZShjaGFycywgaSwgYyk7CiAgICAgICAgY29uc3QgewogICAgICAgICAgY2hhcmNvZGUsCiAgICAgICAgICBsZW5ndGgKICAgICAgICB9ID0gYzsKICAgICAgICBpICs9IGxlbmd0aDsKICAgICAgICBjb25zdCBnbHlwaCA9IHRoaXMuX2NoYXJUb0dseXBoKGNoYXJjb2RlLCBsZW5ndGggPT09IDEgJiYgY2hhcnMuY2hhckNvZGVBdChpIC0gMSkgPT09IDB4MjApOwogICAgICAgIGdseXBocy5wdXNoKGdseXBoKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY2hhcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgIGNvbnN0IGNoYXJjb2RlID0gY2hhcnMuY2hhckNvZGVBdChpKTsKICAgICAgICBjb25zdCBnbHlwaCA9IHRoaXMuX2NoYXJUb0dseXBoKGNoYXJjb2RlLCBjaGFyY29kZSA9PT0gMHgyMCk7CiAgICAgICAgZ2x5cGhzLnB1c2goZ2x5cGgpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5fY2hhcnNDYWNoZVtjaGFyc10gPSBnbHlwaHM7CiAgfQogIGdldENoYXJQb3NpdGlvbnMoY2hhcnMpIHsKICAgIGNvbnN0IHBvc2l0aW9ucyA9IFtdOwogICAgaWYgKHRoaXMuY01hcCkgewogICAgICBjb25zdCBjID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgbGV0IGkgPSAwOwogICAgICB3aGlsZSAoaSA8IGNoYXJzLmxlbmd0aCkgewogICAgICAgIHRoaXMuY01hcC5yZWFkQ2hhckNvZGUoY2hhcnMsIGksIGMpOwogICAgICAgIGNvbnN0IGxlbmd0aCA9IGMubGVuZ3RoOwogICAgICAgIHBvc2l0aW9ucy5wdXNoKFtpLCBpICsgbGVuZ3RoXSk7CiAgICAgICAgaSArPSBsZW5ndGg7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNoYXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICBwb3NpdGlvbnMucHVzaChbaSwgaSArIDFdKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBvc2l0aW9uczsKICB9CiAgZ2V0IGdseXBoQ2FjaGVWYWx1ZXMoKSB7CiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh0aGlzLl9nbHlwaENhY2hlKTsKICB9CiAgZW5jb2RlU3RyaW5nKHN0cikgewogICAgY29uc3QgYnVmZmVycyA9IFtdOwogICAgY29uc3QgY3VycmVudEJ1ZiA9IFtdOwogICAgY29uc3QgaGFzQ3VycmVudEJ1ZkVycm9ycyA9ICgpID0+IGJ1ZmZlcnMubGVuZ3RoICUgMiA9PT0gMTsKICAgIGNvbnN0IGdldENoYXJDb2RlID0gdGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCA/IHVuaWNvZGUgPT4gdGhpcy50b1VuaWNvZGUuY2hhckNvZGVPZih1bmljb2RlKSA6IHVuaWNvZGUgPT4gdGhpcy50b1VuaWNvZGUuY2hhckNvZGVPZihTdHJpbmcuZnJvbUNvZGVQb2ludCh1bmljb2RlKSk7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCB1bmljb2RlID0gc3RyLmNvZGVQb2ludEF0KGkpOwogICAgICBpZiAodW5pY29kZSA+IDB4ZDdmZiAmJiAodW5pY29kZSA8IDB4ZTAwMCB8fCB1bmljb2RlID4gMHhmZmZkKSkgewogICAgICAgIGkrKzsKICAgICAgfQogICAgICBpZiAodGhpcy50b1VuaWNvZGUpIHsKICAgICAgICBjb25zdCBjaGFyQ29kZSA9IGdldENoYXJDb2RlKHVuaWNvZGUpOwogICAgICAgIGlmIChjaGFyQ29kZSAhPT0gLTEpIHsKICAgICAgICAgIGlmIChoYXNDdXJyZW50QnVmRXJyb3JzKCkpIHsKICAgICAgICAgICAgYnVmZmVycy5wdXNoKGN1cnJlbnRCdWYuam9pbigiIikpOwogICAgICAgICAgICBjdXJyZW50QnVmLmxlbmd0aCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBjaGFyQ29kZUxlbmd0aCA9IHRoaXMuY01hcCA/IHRoaXMuY01hcC5nZXRDaGFyQ29kZUxlbmd0aChjaGFyQ29kZSkgOiAxOwogICAgICAgICAgZm9yIChsZXQgaiA9IGNoYXJDb2RlTGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgICAgY3VycmVudEJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUgPj4gOCAqIGogJiAweGZmKSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFoYXNDdXJyZW50QnVmRXJyb3JzKCkpIHsKICAgICAgICBidWZmZXJzLnB1c2goY3VycmVudEJ1Zi5qb2luKCIiKSk7CiAgICAgICAgY3VycmVudEJ1Zi5sZW5ndGggPSAwOwogICAgICB9CiAgICAgIGN1cnJlbnRCdWYucHVzaChTdHJpbmcuZnJvbUNvZGVQb2ludCh1bmljb2RlKSk7CiAgICB9CiAgICBidWZmZXJzLnB1c2goY3VycmVudEJ1Zi5qb2luKCIiKSk7CiAgICByZXR1cm4gYnVmZmVyczsKICB9Cn0KY2xhc3MgRXJyb3JGb250IHsKICBjb25zdHJ1Y3RvcihlcnJvcikgewogICAgdGhpcy5lcnJvciA9IGVycm9yOwogICAgdGhpcy5sb2FkZWROYW1lID0gImdfZm9udF9lcnJvciI7CiAgICB0aGlzLm1pc3NpbmdGaWxlID0gdHJ1ZTsKICB9CiAgY2hhcnNUb0dseXBocygpIHsKICAgIHJldHVybiBbXTsKICB9CiAgZW5jb2RlU3RyaW5nKGNoYXJzKSB7CiAgICByZXR1cm4gW2NoYXJzXTsKICB9CiAgZXhwb3J0RGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGVycm9yOiB0aGlzLmVycm9yCiAgICB9OwogIH0KfQoKOy8vIC4vc3JjL3NoYXJlZC9vYmotYmluLXRyYW5zZm9ybS5qcwoKY2xhc3MgQ3NzRm9udEluZm8gewogICNidWZmZXI7CiAgI3ZpZXc7CiAgI2RlY29kZXI7CiAgc3RhdGljIHN0cmluZ3MgPSBbImZvbnRGYW1pbHkiLCAiZm9udFdlaWdodCIsICJpdGFsaWNBbmdsZSJdOwogIHN0YXRpYyB3cml0ZShpbmZvKSB7CiAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7CiAgICBjb25zdCBlbmNvZGVkU3RyaW5ncyA9IHt9OwogICAgbGV0IHN0cmluZ3NMZW5ndGggPSAwOwogICAgZm9yIChjb25zdCBwcm9wIG9mIENzc0ZvbnRJbmZvLnN0cmluZ3MpIHsKICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZXIuZW5jb2RlKGluZm9bcHJvcF0pOwogICAgICBlbmNvZGVkU3RyaW5nc1twcm9wXSA9IGVuY29kZWQ7CiAgICAgIHN0cmluZ3NMZW5ndGggKz0gNCArIGVuY29kZWQubGVuZ3RoOwogICAgfQogICAgY29uc3QgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHN0cmluZ3NMZW5ndGgpOwogICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7CiAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIGZvciAoY29uc3QgcHJvcCBvZiBDc3NGb250SW5mby5zdHJpbmdzKSB7CiAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVkU3RyaW5nc1twcm9wXTsKICAgICAgY29uc3QgbGVuZ3RoID0gZW5jb2RlZC5sZW5ndGg7CiAgICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCwgbGVuZ3RoKTsKICAgICAgZGF0YS5zZXQoZW5jb2RlZCwgb2Zmc2V0ICsgNCk7CiAgICAgIG9mZnNldCArPSA0ICsgbGVuZ3RoOwogICAgfQogICAgYXNzZXJ0KG9mZnNldCA9PT0gYnVmZmVyLmJ5dGVMZW5ndGgsICJDc3NGb250SW5mby53cml0ZTogQnVmZmVyIG92ZXJmbG93Iik7CiAgICByZXR1cm4gYnVmZmVyOwogIH0KICBjb25zdHJ1Y3RvcihidWZmZXIpIHsKICAgIHRoaXMuI2J1ZmZlciA9IGJ1ZmZlcjsKICAgIHRoaXMuI3ZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy4jYnVmZmVyKTsKICAgIHRoaXMuI2RlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsKICB9CiAgI3JlYWRTdHJpbmcoaW5kZXgpIHsKICAgIGFzc2VydChpbmRleCA8IENzc0ZvbnRJbmZvLnN0cmluZ3MubGVuZ3RoLCAiSW52YWxpZCBzdHJpbmcgaW5kZXgiKTsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleDsgaSsrKSB7CiAgICAgIG9mZnNldCArPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpICsgNDsKICAgIH0KICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICByZXR1cm4gdGhpcy4jZGVjb2Rlci5kZWNvZGUobmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmZmVyLCBvZmZzZXQgKyA0LCBsZW5ndGgpKTsKICB9CiAgZ2V0IGZvbnRGYW1pbHkoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZFN0cmluZygwKTsKICB9CiAgZ2V0IGZvbnRXZWlnaHQoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZFN0cmluZygxKTsKICB9CiAgZ2V0IGl0YWxpY0FuZ2xlKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRTdHJpbmcoMik7CiAgfQp9CmNsYXNzIFN5c3RlbUZvbnRJbmZvIHsKICAjYnVmZmVyOwogICN2aWV3OwogICNkZWNvZGVyOwogIHN0YXRpYyBzdHJpbmdzID0gWyJjc3MiLCAibG9hZGVkTmFtZSIsICJiYXNlRm9udE5hbWUiLCAic3JjIl07CiAgc3RhdGljIHdyaXRlKGluZm8pIHsKICAgIGNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsKICAgIGNvbnN0IGVuY29kZWRTdHJpbmdzID0ge307CiAgICBsZXQgc3RyaW5nc0xlbmd0aCA9IDA7CiAgICBmb3IgKGNvbnN0IHByb3Agb2YgU3lzdGVtRm9udEluZm8uc3RyaW5ncykgewogICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2Rlci5lbmNvZGUoaW5mb1twcm9wXSk7CiAgICAgIGVuY29kZWRTdHJpbmdzW3Byb3BdID0gZW5jb2RlZDsKICAgICAgc3RyaW5nc0xlbmd0aCArPSA0ICsgZW5jb2RlZC5sZW5ndGg7CiAgICB9CiAgICBzdHJpbmdzTGVuZ3RoICs9IDQ7CiAgICBsZXQgZW5jb2RlZFN0eWxlU3R5bGUsCiAgICAgIGVuY29kZWRTdHlsZVdlaWdodCwKICAgICAgbGVuZ3RoRXN0aW1hdGUgPSAxICsgc3RyaW5nc0xlbmd0aDsKICAgIGlmIChpbmZvLnN0eWxlKSB7CiAgICAgIGVuY29kZWRTdHlsZVN0eWxlID0gZW5jb2Rlci5lbmNvZGUoaW5mby5zdHlsZS5zdHlsZSk7CiAgICAgIGVuY29kZWRTdHlsZVdlaWdodCA9IGVuY29kZXIuZW5jb2RlKGluZm8uc3R5bGUud2VpZ2h0KTsKICAgICAgbGVuZ3RoRXN0aW1hdGUgKz0gNCArIGVuY29kZWRTdHlsZVN0eWxlLmxlbmd0aCArIDQgKyBlbmNvZGVkU3R5bGVXZWlnaHQubGVuZ3RoOwogICAgfQogICAgY29uc3QgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKGxlbmd0aEVzdGltYXRlKTsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShidWZmZXIpOwogICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICB2aWV3LnNldFVpbnQ4KG9mZnNldCsrLCBpbmZvLmd1ZXNzRmFsbGJhY2sgPyAxIDogMCk7CiAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIDApOwogICAgb2Zmc2V0ICs9IDQ7CiAgICBzdHJpbmdzTGVuZ3RoID0gMDsKICAgIGZvciAoY29uc3QgcHJvcCBvZiBTeXN0ZW1Gb250SW5mby5zdHJpbmdzKSB7CiAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVkU3RyaW5nc1twcm9wXTsKICAgICAgY29uc3QgbGVuZ3RoID0gZW5jb2RlZC5sZW5ndGg7CiAgICAgIHN0cmluZ3NMZW5ndGggKz0gNCArIGxlbmd0aDsKICAgICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCBsZW5ndGgpOwogICAgICBkYXRhLnNldChlbmNvZGVkLCBvZmZzZXQgKyA0KTsKICAgICAgb2Zmc2V0ICs9IDQgKyBsZW5ndGg7CiAgICB9CiAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQgLSBzdHJpbmdzTGVuZ3RoIC0gNCwgc3RyaW5nc0xlbmd0aCk7CiAgICBpZiAoaW5mby5zdHlsZSkgewogICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIGVuY29kZWRTdHlsZVN0eWxlLmxlbmd0aCk7CiAgICAgIGRhdGEuc2V0KGVuY29kZWRTdHlsZVN0eWxlLCBvZmZzZXQgKyA0KTsKICAgICAgb2Zmc2V0ICs9IDQgKyBlbmNvZGVkU3R5bGVTdHlsZS5sZW5ndGg7CiAgICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCwgZW5jb2RlZFN0eWxlV2VpZ2h0Lmxlbmd0aCk7CiAgICAgIGRhdGEuc2V0KGVuY29kZWRTdHlsZVdlaWdodCwgb2Zmc2V0ICsgNCk7CiAgICAgIG9mZnNldCArPSA0ICsgZW5jb2RlZFN0eWxlV2VpZ2h0Lmxlbmd0aDsKICAgIH0KICAgIGFzc2VydChvZmZzZXQgPD0gYnVmZmVyLmJ5dGVMZW5ndGgsICJTdWJzdGl0aW9uSW5mby53cml0ZTogQnVmZmVyIG92ZXJmbG93Iik7CiAgICByZXR1cm4gYnVmZmVyLnRyYW5zZmVyVG9GaXhlZExlbmd0aChvZmZzZXQpOwogIH0KICBjb25zdHJ1Y3RvcihidWZmZXIpIHsKICAgIHRoaXMuI2J1ZmZlciA9IGJ1ZmZlcjsKICAgIHRoaXMuI3ZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy4jYnVmZmVyKTsKICAgIHRoaXMuI2RlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsKICB9CiAgZ2V0IGd1ZXNzRmFsbGJhY2soKSB7CiAgICByZXR1cm4gdGhpcy4jdmlldy5nZXRVaW50OCgwKSAhPT0gMDsKICB9CiAgI3JlYWRTdHJpbmcoaW5kZXgpIHsKICAgIGFzc2VydChpbmRleCA8IFN5c3RlbUZvbnRJbmZvLnN0cmluZ3MubGVuZ3RoLCAiSW52YWxpZCBzdHJpbmcgaW5kZXgiKTsKICAgIGxldCBvZmZzZXQgPSA1OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleDsgaSsrKSB7CiAgICAgIG9mZnNldCArPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpICsgNDsKICAgIH0KICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICByZXR1cm4gdGhpcy4jZGVjb2Rlci5kZWNvZGUobmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmZmVyLCBvZmZzZXQgKyA0LCBsZW5ndGgpKTsKICB9CiAgZ2V0IGNzcygpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDApOwogIH0KICBnZXQgbG9hZGVkTmFtZSgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDEpOwogIH0KICBnZXQgYmFzZUZvbnROYW1lKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRTdHJpbmcoMik7CiAgfQogIGdldCBzcmMoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZFN0cmluZygzKTsKICB9CiAgZ2V0IHN0eWxlKCkgewogICAgbGV0IG9mZnNldCA9IDE7CiAgICBvZmZzZXQgKz0gNCArIHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBjb25zdCBzdHlsZUxlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBjb25zdCBzdHlsZSA9IHRoaXMuI2RlY29kZXIuZGVjb2RlKG5ldyBVaW50OEFycmF5KHRoaXMuI2J1ZmZlciwgb2Zmc2V0ICsgNCwgc3R5bGVMZW5ndGgpKTsKICAgIG9mZnNldCArPSA0ICsgc3R5bGVMZW5ndGg7CiAgICBjb25zdCB3ZWlnaHRMZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgY29uc3Qgd2VpZ2h0ID0gdGhpcy4jZGVjb2Rlci5kZWNvZGUobmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmZmVyLCBvZmZzZXQgKyA0LCB3ZWlnaHRMZW5ndGgpKTsKICAgIHJldHVybiB7CiAgICAgIHN0eWxlLAogICAgICB3ZWlnaHQKICAgIH07CiAgfQp9CmNsYXNzIEZvbnRJbmZvIHsKICBzdGF0aWMgYm9vbHMgPSBbImJsYWNrIiwgImJvbGQiLCAiZGlzYWJsZUZvbnRGYWNlIiwgImZvbnRFeHRyYVByb3BlcnRpZXMiLCAiaXNJbnZhbGlkUERGanNGb250IiwgImlzVHlwZTNGb250IiwgIml0YWxpYyIsICJtaXNzaW5nRmlsZSIsICJyZW1lYXN1cmUiLCAidmVydGljYWwiXTsKICBzdGF0aWMgbnVtYmVycyA9IFsiYXNjZW50IiwgImRlZmF1bHRXaWR0aCIsICJkZXNjZW50Il07CiAgc3RhdGljIHN0cmluZ3MgPSBbImZhbGxiYWNrTmFtZSIsICJsb2FkZWROYW1lIiwgIm1pbWV0eXBlIiwgIm5hbWUiXTsKICBzdGF0aWMgI09GRlNFVF9OVU1CRVJTID0gTWF0aC5jZWlsKHRoaXMuYm9vbHMubGVuZ3RoICogMiAvIDgpOwogIHN0YXRpYyAjT0ZGU0VUX0JCT1ggPSB0aGlzLiNPRkZTRVRfTlVNQkVSUyArIHRoaXMubnVtYmVycy5sZW5ndGggKiA4OwogIHN0YXRpYyAjT0ZGU0VUX0ZPTlRfTUFUUklYID0gdGhpcy4jT0ZGU0VUX0JCT1ggKyAxICsgMiAqIDQ7CiAgc3RhdGljICNPRkZTRVRfREVGQVVMVF9WTUVUUklDUyA9IHRoaXMuI09GRlNFVF9GT05UX01BVFJJWCArIDEgKyA4ICogNjsKICBzdGF0aWMgI09GRlNFVF9TVFJJTkdTID0gdGhpcy4jT0ZGU0VUX0RFRkFVTFRfVk1FVFJJQ1MgKyAxICsgMiAqIDM7CiAgI2J1ZmZlcjsKICAjZGVjb2RlcjsKICAjdmlldzsKICBjb25zdHJ1Y3Rvcih7CiAgICBkYXRhLAogICAgZXh0cmEKICB9KSB7CiAgICB0aGlzLiNidWZmZXIgPSBkYXRhOwogICAgdGhpcy4jZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOwogICAgdGhpcy4jdmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLiNidWZmZXIpOwogICAgaWYgKGV4dHJhKSB7CiAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgZXh0cmEpOwogICAgfQogIH0KICAjcmVhZEJvb2xlYW4oaW5kZXgpIHsKICAgIGFzc2VydChpbmRleCA8IEZvbnRJbmZvLmJvb2xzLmxlbmd0aCwgIkludmFsaWQgYm9vbGVhbiBpbmRleCIpOwogICAgY29uc3QgYnl0ZU9mZnNldCA9IE1hdGguZmxvb3IoaW5kZXggLyA0KTsKICAgIGNvbnN0IGJpdE9mZnNldCA9IGluZGV4ICogMiAlIDg7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuI3ZpZXcuZ2V0VWludDgoYnl0ZU9mZnNldCkgPj4gYml0T2Zmc2V0ICYgMHgwMzsKICAgIHJldHVybiB2YWx1ZSA9PT0gMHgwMCA/IHVuZGVmaW5lZCA6IHZhbHVlID09PSAweDAyOwogIH0KICBnZXQgYmxhY2soKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZEJvb2xlYW4oMCk7CiAgfQogIGdldCBib2xkKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRCb29sZWFuKDEpOwogIH0KICBnZXQgZGlzYWJsZUZvbnRGYWNlKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRCb29sZWFuKDIpOwogIH0KICBnZXQgZm9udEV4dHJhUHJvcGVydGllcygpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkQm9vbGVhbigzKTsKICB9CiAgZ2V0IGlzSW52YWxpZFBERmpzRm9udCgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkQm9vbGVhbig0KTsKICB9CiAgZ2V0IGlzVHlwZTNGb250KCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRCb29sZWFuKDUpOwogIH0KICBnZXQgaXRhbGljKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRCb29sZWFuKDYpOwogIH0KICBnZXQgbWlzc2luZ0ZpbGUoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZEJvb2xlYW4oNyk7CiAgfQogIGdldCByZW1lYXN1cmUoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZEJvb2xlYW4oOCk7CiAgfQogIGdldCB2ZXJ0aWNhbCgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkQm9vbGVhbig5KTsKICB9CiAgI3JlYWROdW1iZXIoaW5kZXgpIHsKICAgIGFzc2VydChpbmRleCA8IEZvbnRJbmZvLm51bWJlcnMubGVuZ3RoLCAiSW52YWxpZCBudW1iZXIgaW5kZXgiKTsKICAgIHJldHVybiB0aGlzLiN2aWV3LmdldEZsb2F0NjQoRm9udEluZm8uI09GRlNFVF9OVU1CRVJTICsgaW5kZXggKiA4KTsKICB9CiAgZ2V0IGFzY2VudCgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkTnVtYmVyKDApOwogIH0KICBnZXQgZGVmYXVsdFdpZHRoKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWROdW1iZXIoMSk7CiAgfQogIGdldCBkZXNjZW50KCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWROdW1iZXIoMik7CiAgfQogIGdldCBiYm94KCkgewogICAgbGV0IG9mZnNldCA9IEZvbnRJbmZvLiNPRkZTRVRfQkJPWDsKICAgIGNvbnN0IG51bUNvb3JkcyA9IHRoaXMuI3ZpZXcuZ2V0VWludDgob2Zmc2V0KTsKICAgIGlmIChudW1Db29yZHMgPT09IDApIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIG9mZnNldCArPSAxOwogICAgY29uc3QgYmJveCA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgYmJveC5wdXNoKHRoaXMuI3ZpZXcuZ2V0SW50MTYob2Zmc2V0LCB0cnVlKSk7CiAgICAgIG9mZnNldCArPSAyOwogICAgfQogICAgcmV0dXJuIGJib3g7CiAgfQogIGdldCBmb250TWF0cml4KCkgewogICAgbGV0IG9mZnNldCA9IEZvbnRJbmZvLiNPRkZTRVRfRk9OVF9NQVRSSVg7CiAgICBjb25zdCBudW1Qb2ludHMgPSB0aGlzLiN2aWV3LmdldFVpbnQ4KG9mZnNldCk7CiAgICBpZiAobnVtUG9pbnRzID09PSAwKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBvZmZzZXQgKz0gMTsKICAgIGNvbnN0IGZvbnRNYXRyaXggPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgIGZvbnRNYXRyaXgucHVzaCh0aGlzLiN2aWV3LmdldEZsb2F0NjQob2Zmc2V0LCB0cnVlKSk7CiAgICAgIG9mZnNldCArPSA4OwogICAgfQogICAgcmV0dXJuIGZvbnRNYXRyaXg7CiAgfQogIGdldCBkZWZhdWx0Vk1ldHJpY3MoKSB7CiAgICBsZXQgb2Zmc2V0ID0gRm9udEluZm8uI09GRlNFVF9ERUZBVUxUX1ZNRVRSSUNTOwogICAgY29uc3QgbnVtTWV0cmljcyA9IHRoaXMuI3ZpZXcuZ2V0VWludDgob2Zmc2V0KTsKICAgIGlmIChudW1NZXRyaWNzID09PSAwKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBvZmZzZXQgKz0gMTsKICAgIGNvbnN0IGRlZmF1bHRWTWV0cmljcyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgZGVmYXVsdFZNZXRyaWNzLnB1c2godGhpcy4jdmlldy5nZXRJbnQxNihvZmZzZXQsIHRydWUpKTsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9CiAgICByZXR1cm4gZGVmYXVsdFZNZXRyaWNzOwogIH0KICAjcmVhZFN0cmluZyhpbmRleCkgewogICAgYXNzZXJ0KGluZGV4IDwgRm9udEluZm8uc3RyaW5ncy5sZW5ndGgsICJJbnZhbGlkIHN0cmluZyBpbmRleCIpOwogICAgbGV0IG9mZnNldCA9IEZvbnRJbmZvLiNPRkZTRVRfU1RSSU5HUyArIDQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4OyBpKyspIHsKICAgICAgb2Zmc2V0ICs9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCkgKyA0OwogICAgfQogICAgY29uc3QgbGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIGNvbnN0IHN0cmluZ0RhdGEgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgc3RyaW5nRGF0YS5zZXQobmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmZmVyLCBvZmZzZXQgKyA0LCBsZW5ndGgpKTsKICAgIHJldHVybiB0aGlzLiNkZWNvZGVyLmRlY29kZShzdHJpbmdEYXRhKTsKICB9CiAgZ2V0IGZhbGxiYWNrTmFtZSgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDApOwogIH0KICBnZXQgbG9hZGVkTmFtZSgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDEpOwogIH0KICBnZXQgbWltZXR5cGUoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZFN0cmluZygyKTsKICB9CiAgZ2V0IG5hbWUoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZFN0cmluZygzKTsKICB9CiAgZ2V0IGRhdGEoKSB7CiAgICBsZXQgb2Zmc2V0ID0gRm9udEluZm8uI09GRlNFVF9TVFJJTkdTOwogICAgY29uc3Qgc3RyaW5nc0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIHN0cmluZ3NMZW5ndGg7CiAgICBjb25zdCBzeXN0ZW1Gb250SW5mb0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIHN5c3RlbUZvbnRJbmZvTGVuZ3RoOwogICAgY29uc3QgY3NzRm9udEluZm9MZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDQgKyBjc3NGb250SW5mb0xlbmd0aDsKICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBpZiAobGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmZmVyLCBvZmZzZXQgKyA0LCBsZW5ndGgpOwogIH0KICBjbGVhckRhdGEoKSB7CiAgICBsZXQgb2Zmc2V0ID0gRm9udEluZm8uI09GRlNFVF9TVFJJTkdTOwogICAgY29uc3Qgc3RyaW5nc0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIHN0cmluZ3NMZW5ndGg7CiAgICBjb25zdCBzeXN0ZW1Gb250SW5mb0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIHN5c3RlbUZvbnRJbmZvTGVuZ3RoOwogICAgY29uc3QgY3NzRm9udEluZm9MZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDQgKyBjc3NGb250SW5mb0xlbmd0aDsKICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmZmVyLCBvZmZzZXQgKyA0LCBsZW5ndGgpOwogICAgZGF0YS5maWxsKDApOwogICAgdGhpcy4jdmlldy5zZXRVaW50MzIob2Zmc2V0LCAwKTsKICB9CiAgZ2V0IGNzc0ZvbnRJbmZvKCkgewogICAgbGV0IG9mZnNldCA9IEZvbnRJbmZvLiNPRkZTRVRfU1RSSU5HUzsKICAgIGNvbnN0IHN0cmluZ3NMZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDQgKyBzdHJpbmdzTGVuZ3RoOwogICAgY29uc3Qgc3lzdGVtRm9udEluZm9MZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDQgKyBzeXN0ZW1Gb250SW5mb0xlbmd0aDsKICAgIGNvbnN0IGNzc0ZvbnRJbmZvTGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIGlmIChjc3NGb250SW5mb0xlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGNzc0ZvbnRJbmZvRGF0YSA9IG5ldyBVaW50OEFycmF5KGNzc0ZvbnRJbmZvTGVuZ3RoKTsKICAgIGNzc0ZvbnRJbmZvRGF0YS5zZXQobmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmZmVyLCBvZmZzZXQgKyA0LCBjc3NGb250SW5mb0xlbmd0aCkpOwogICAgcmV0dXJuIG5ldyBDc3NGb250SW5mbyhjc3NGb250SW5mb0RhdGEuYnVmZmVyKTsKICB9CiAgZ2V0IHN5c3RlbUZvbnRJbmZvKCkgewogICAgbGV0IG9mZnNldCA9IEZvbnRJbmZvLiNPRkZTRVRfU1RSSU5HUzsKICAgIGNvbnN0IHN0cmluZ3NMZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDQgKyBzdHJpbmdzTGVuZ3RoOwogICAgY29uc3Qgc3lzdGVtRm9udEluZm9MZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgaWYgKHN5c3RlbUZvbnRJbmZvTGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgc3lzdGVtRm9udEluZm9EYXRhID0gbmV3IFVpbnQ4QXJyYXkoc3lzdGVtRm9udEluZm9MZW5ndGgpOwogICAgc3lzdGVtRm9udEluZm9EYXRhLnNldChuZXcgVWludDhBcnJheSh0aGlzLiNidWZmZXIsIG9mZnNldCArIDQsIHN5c3RlbUZvbnRJbmZvTGVuZ3RoKSk7CiAgICByZXR1cm4gbmV3IFN5c3RlbUZvbnRJbmZvKHN5c3RlbUZvbnRJbmZvRGF0YS5idWZmZXIpOwogIH0KICBzdGF0aWMgd3JpdGUoZm9udCkgewogICAgY29uc3Qgc3lzdGVtRm9udEluZm9CdWZmZXIgPSBmb250LnN5c3RlbUZvbnRJbmZvID8gU3lzdGVtRm9udEluZm8ud3JpdGUoZm9udC5zeXN0ZW1Gb250SW5mbykgOiBudWxsOwogICAgY29uc3QgY3NzRm9udEluZm9CdWZmZXIgPSBmb250LmNzc0ZvbnRJbmZvID8gQ3NzRm9udEluZm8ud3JpdGUoZm9udC5jc3NGb250SW5mbykgOiBudWxsOwogICAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpOwogICAgY29uc3QgZW5jb2RlZFN0cmluZ3MgPSB7fTsKICAgIGxldCBzdHJpbmdzTGVuZ3RoID0gMDsKICAgIGZvciAoY29uc3QgcHJvcCBvZiBGb250SW5mby5zdHJpbmdzKSB7CiAgICAgIGVuY29kZWRTdHJpbmdzW3Byb3BdID0gZW5jb2Rlci5lbmNvZGUoZm9udFtwcm9wXSk7CiAgICAgIHN0cmluZ3NMZW5ndGggKz0gNCArIGVuY29kZWRTdHJpbmdzW3Byb3BdLmxlbmd0aDsKICAgIH0KICAgIGNvbnN0IGxlbmd0aEVzdGltYXRlID0gRm9udEluZm8uI09GRlNFVF9TVFJJTkdTICsgNCArIHN0cmluZ3NMZW5ndGggKyA0ICsgKHN5c3RlbUZvbnRJbmZvQnVmZmVyID8gc3lzdGVtRm9udEluZm9CdWZmZXIuYnl0ZUxlbmd0aCA6IDApICsgNCArIChjc3NGb250SW5mb0J1ZmZlciA/IGNzc0ZvbnRJbmZvQnVmZmVyLmJ5dGVMZW5ndGggOiAwKSArIDQgKyAoZm9udC5kYXRhID8gZm9udC5kYXRhLmxlbmd0aCA6IDApOwogICAgY29uc3QgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKGxlbmd0aEVzdGltYXRlKTsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShidWZmZXIpOwogICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBjb25zdCBudW1Cb29scyA9IEZvbnRJbmZvLmJvb2xzLmxlbmd0aDsKICAgIGxldCBib29sQnl0ZSA9IDAsCiAgICAgIGJvb2xCaXQgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Cb29sczsgaSsrKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gZm9udFtGb250SW5mby5ib29sc1tpXV07CiAgICAgIGNvbnN0IGJpdHMgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gMHgwMCA6IHZhbHVlID8gMHgwMiA6IDB4MDE7CiAgICAgIGJvb2xCeXRlIHw9IGJpdHMgPDwgYm9vbEJpdDsKICAgICAgYm9vbEJpdCArPSAyOwogICAgICBpZiAoYm9vbEJpdCA9PT0gOCB8fCBpID09PSBudW1Cb29scyAtIDEpIHsKICAgICAgICB2aWV3LnNldFVpbnQ4KG9mZnNldCsrLCBib29sQnl0ZSk7CiAgICAgICAgYm9vbEJ5dGUgPSAwOwogICAgICAgIGJvb2xCaXQgPSAwOwogICAgICB9CiAgICB9CiAgICBhc3NlcnQob2Zmc2V0ID09PSBGb250SW5mby4jT0ZGU0VUX05VTUJFUlMsICJGb250SW5mby53cml0ZTogQm9vbGVhbiBwcm9wZXJ0aWVzIG9mZnNldCBtaXNtYXRjaCIpOwogICAgZm9yIChjb25zdCBwcm9wIG9mIEZvbnRJbmZvLm51bWJlcnMpIHsKICAgICAgdmlldy5zZXRGbG9hdDY0KG9mZnNldCwgZm9udFtwcm9wXSk7CiAgICAgIG9mZnNldCArPSA4OwogICAgfQogICAgYXNzZXJ0KG9mZnNldCA9PT0gRm9udEluZm8uI09GRlNFVF9CQk9YLCAiRm9udEluZm8ud3JpdGU6IE51bWJlciBwcm9wZXJ0aWVzIG9mZnNldCBtaXNtYXRjaCIpOwogICAgaWYgKGZvbnQuYmJveCkgewogICAgICB2aWV3LnNldFVpbnQ4KG9mZnNldCsrLCA0KTsKICAgICAgZm9yIChjb25zdCBjb29yZCBvZiBmb250LmJib3gpIHsKICAgICAgICB2aWV3LnNldEludDE2KG9mZnNldCwgY29vcmQsIHRydWUpOwogICAgICAgIG9mZnNldCArPSAyOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB2aWV3LnNldFVpbnQ4KG9mZnNldCsrLCAwKTsKICAgICAgb2Zmc2V0ICs9IDIgKiA0OwogICAgfQogICAgYXNzZXJ0KG9mZnNldCA9PT0gRm9udEluZm8uI09GRlNFVF9GT05UX01BVFJJWCwgIkZvbnRJbmZvLndyaXRlOiBCQm94IHByb3BlcnRpZXMgb2Zmc2V0IG1pc21hdGNoIik7CiAgICBpZiAoZm9udC5mb250TWF0cml4KSB7CiAgICAgIHZpZXcuc2V0VWludDgob2Zmc2V0KyssIDYpOwogICAgICBmb3IgKGNvbnN0IHBvaW50IG9mIGZvbnQuZm9udE1hdHJpeCkgewogICAgICAgIHZpZXcuc2V0RmxvYXQ2NChvZmZzZXQsIHBvaW50LCB0cnVlKTsKICAgICAgICBvZmZzZXQgKz0gODsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmlldy5zZXRVaW50OChvZmZzZXQrKywgMCk7CiAgICAgIG9mZnNldCArPSA4ICogNjsKICAgIH0KICAgIGFzc2VydChvZmZzZXQgPT09IEZvbnRJbmZvLiNPRkZTRVRfREVGQVVMVF9WTUVUUklDUywgIkZvbnRJbmZvLndyaXRlOiBGb250TWF0cml4IHByb3BlcnRpZXMgb2Zmc2V0IG1pc21hdGNoIik7CiAgICBpZiAoZm9udC5kZWZhdWx0Vk1ldHJpY3MpIHsKICAgICAgdmlldy5zZXRVaW50OChvZmZzZXQrKywgMSk7CiAgICAgIGZvciAoY29uc3QgbWV0cmljIG9mIGZvbnQuZGVmYXVsdFZNZXRyaWNzKSB7CiAgICAgICAgdmlldy5zZXRJbnQxNihvZmZzZXQsIG1ldHJpYywgdHJ1ZSk7CiAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZpZXcuc2V0VWludDgob2Zmc2V0KyssIDApOwogICAgICBvZmZzZXQgKz0gMyAqIDI7CiAgICB9CiAgICBhc3NlcnQob2Zmc2V0ID09PSBGb250SW5mby4jT0ZGU0VUX1NUUklOR1MsICJGb250SW5mby53cml0ZTogRGVmYXVsdFZNZXRyaWNzIHByb3BlcnRpZXMgb2Zmc2V0IG1pc21hdGNoIik7CiAgICB2aWV3LnNldFVpbnQzMihGb250SW5mby4jT0ZGU0VUX1NUUklOR1MsIDApOwogICAgb2Zmc2V0ICs9IDQ7CiAgICBmb3IgKGNvbnN0IHByb3Agb2YgRm9udEluZm8uc3RyaW5ncykgewogICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlZFN0cmluZ3NbcHJvcF07CiAgICAgIGNvbnN0IGxlbmd0aCA9IGVuY29kZWQubGVuZ3RoOwogICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIGxlbmd0aCk7CiAgICAgIGRhdGEuc2V0KGVuY29kZWQsIG9mZnNldCArIDQpOwogICAgICBvZmZzZXQgKz0gNCArIGxlbmd0aDsKICAgIH0KICAgIHZpZXcuc2V0VWludDMyKEZvbnRJbmZvLiNPRkZTRVRfU1RSSU5HUywgb2Zmc2V0IC0gRm9udEluZm8uI09GRlNFVF9TVFJJTkdTIC0gNCk7CiAgICBpZiAoIXN5c3RlbUZvbnRJbmZvQnVmZmVyKSB7CiAgICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCwgMCk7CiAgICAgIG9mZnNldCArPSA0OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgbGVuZ3RoID0gc3lzdGVtRm9udEluZm9CdWZmZXIuYnl0ZUxlbmd0aDsKICAgICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCBsZW5ndGgpOwogICAgICBhc3NlcnQob2Zmc2V0ICsgNCArIGxlbmd0aCA8PSBidWZmZXIuYnl0ZUxlbmd0aCwgIkZvbnRJbmZvLndyaXRlOiBCdWZmZXIgb3ZlcmZsb3cgYXQgc3lzdGVtRm9udEluZm8iKTsKICAgICAgZGF0YS5zZXQobmV3IFVpbnQ4QXJyYXkoc3lzdGVtRm9udEluZm9CdWZmZXIpLCBvZmZzZXQgKyA0KTsKICAgICAgb2Zmc2V0ICs9IDQgKyBsZW5ndGg7CiAgICB9CiAgICBpZiAoIWNzc0ZvbnRJbmZvQnVmZmVyKSB7CiAgICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCwgMCk7CiAgICAgIG9mZnNldCArPSA0OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgbGVuZ3RoID0gY3NzRm9udEluZm9CdWZmZXIuYnl0ZUxlbmd0aDsKICAgICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCBsZW5ndGgpOwogICAgICBhc3NlcnQob2Zmc2V0ICsgNCArIGxlbmd0aCA8PSBidWZmZXIuYnl0ZUxlbmd0aCwgIkZvbnRJbmZvLndyaXRlOiBCdWZmZXIgb3ZlcmZsb3cgYXQgY3NzRm9udEluZm8iKTsKICAgICAgZGF0YS5zZXQobmV3IFVpbnQ4QXJyYXkoY3NzRm9udEluZm9CdWZmZXIpLCBvZmZzZXQgKyA0KTsKICAgICAgb2Zmc2V0ICs9IDQgKyBsZW5ndGg7CiAgICB9CiAgICBpZiAoZm9udC5kYXRhID09PSB1bmRlZmluZWQpIHsKICAgICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCAwKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICB9IGVsc2UgewogICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIGZvbnQuZGF0YS5sZW5ndGgpOwogICAgICBkYXRhLnNldChmb250LmRhdGEsIG9mZnNldCArIDQpOwogICAgICBvZmZzZXQgKz0gNCArIGZvbnQuZGF0YS5sZW5ndGg7CiAgICB9CiAgICBhc3NlcnQob2Zmc2V0IDw9IGJ1ZmZlci5ieXRlTGVuZ3RoLCAiRm9udEluZm8ud3JpdGU6IEJ1ZmZlciBvdmVyZmxvdyIpOwogICAgcmV0dXJuIGJ1ZmZlci50cmFuc2ZlclRvRml4ZWRMZW5ndGgob2Zmc2V0KTsKICB9Cn0KY2xhc3MgUGF0dGVybkluZm8gewogIHN0YXRpYyAjS0lORCA9IDA7CiAgc3RhdGljICNIQVNfQkJPWCA9IDE7CiAgc3RhdGljICNIQVNfQkFDS0dST1VORCA9IDI7CiAgc3RhdGljICNTSEFESU5HX1RZUEUgPSAzOwogIHN0YXRpYyAjTl9DT09SRCA9IDQ7CiAgc3RhdGljICNOX0NPTE9SID0gODsKICBzdGF0aWMgI05fU1RPUCA9IDEyOwogIHN0YXRpYyAjTl9GSUdVUkVTID0gMTY7CiAgY29uc3RydWN0b3IoYnVmZmVyKSB7CiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKICAgIHRoaXMudmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpOwogICAgdGhpcy5kYXRhID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICB9CiAgc3RhdGljIHdyaXRlKGlyKSB7CiAgICBsZXQga2luZCwKICAgICAgYmJveCA9IG51bGwsCiAgICAgIGNvb3JkcyA9IFtdLAogICAgICBjb2xvcnMgPSBbXSwKICAgICAgY29sb3JTdG9wcyA9IFtdLAogICAgICBmaWd1cmVzID0gW10sCiAgICAgIHNoYWRpbmdUeXBlID0gbnVsbCwKICAgICAgYmFja2dyb3VuZCA9IG51bGw7CiAgICBzd2l0Y2ggKGlyWzBdKSB7CiAgICAgIGNhc2UgIlJhZGlhbEF4aWFsIjoKICAgICAgICBraW5kID0gaXJbMV0gPT09ICJheGlhbCIgPyAxIDogMjsKICAgICAgICBiYm94ID0gaXJbMl07CiAgICAgICAgY29sb3JTdG9wcyA9IGlyWzNdOwogICAgICAgIGlmIChraW5kID09PSAxKSB7CiAgICAgICAgICBjb29yZHMucHVzaCguLi5pcls0XSwgLi4uaXJbNV0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb29yZHMucHVzaChpcls0XVswXSwgaXJbNF1bMV0sIGlyWzZdLCBpcls1XVswXSwgaXJbNV1bMV0sIGlyWzddKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIk1lc2giOgogICAgICAgIGtpbmQgPSAzOwogICAgICAgIHNoYWRpbmdUeXBlID0gaXJbMV07CiAgICAgICAgY29vcmRzID0gaXJbMl07CiAgICAgICAgY29sb3JzID0gaXJbM107CiAgICAgICAgZmlndXJlcyA9IGlyWzRdIHx8IFtdOwogICAgICAgIGJib3ggPSBpcls2XTsKICAgICAgICBiYWNrZ3JvdW5kID0gaXJbN107CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBwYXR0ZXJuIHR5cGU6ICR7aXJbMF19YCk7CiAgICB9CiAgICBjb25zdCBuQ29vcmQgPSBNYXRoLmZsb29yKGNvb3Jkcy5sZW5ndGggLyAyKTsKICAgIGNvbnN0IG5Db2xvciA9IE1hdGguZmxvb3IoY29sb3JzLmxlbmd0aCAvIDMpOwogICAgY29uc3QgblN0b3AgPSBjb2xvclN0b3BzLmxlbmd0aDsKICAgIGNvbnN0IG5GaWd1cmVzID0gZmlndXJlcy5sZW5ndGg7CiAgICBsZXQgZmlndXJlc1NpemUgPSAwOwogICAgZm9yIChjb25zdCBmaWd1cmUgb2YgZmlndXJlcykgewogICAgICBmaWd1cmVzU2l6ZSArPSAxOwogICAgICBmaWd1cmVzU2l6ZSA9IE1hdGguY2VpbChmaWd1cmVzU2l6ZSAvIDQpICogNDsKICAgICAgZmlndXJlc1NpemUgKz0gNCArIGZpZ3VyZS5jb29yZHMubGVuZ3RoICogNDsKICAgICAgZmlndXJlc1NpemUgKz0gNCArIGZpZ3VyZS5jb2xvcnMubGVuZ3RoICogNDsKICAgICAgaWYgKGZpZ3VyZS52ZXJ0aWNlc1BlclJvdyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZmlndXJlc1NpemUgKz0gNDsKICAgICAgfQogICAgfQogICAgY29uc3QgYnl0ZUxlbiA9IDIwICsgbkNvb3JkICogOCArIG5Db2xvciAqIDMgKyBuU3RvcCAqIDggKyAoYmJveCA/IDE2IDogMCkgKyAoYmFja2dyb3VuZCA/IDMgOiAwKSArIGZpZ3VyZXNTaXplOwogICAgY29uc3QgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKGJ5dGVMZW4pOwogICAgY29uc3QgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTsKICAgIGNvbnN0IHU4ZGF0YSA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7CiAgICBkYXRhVmlldy5zZXRVaW50OChQYXR0ZXJuSW5mby4jS0lORCwga2luZCk7CiAgICBkYXRhVmlldy5zZXRVaW50OChQYXR0ZXJuSW5mby4jSEFTX0JCT1gsIGJib3ggPyAxIDogMCk7CiAgICBkYXRhVmlldy5zZXRVaW50OChQYXR0ZXJuSW5mby4jSEFTX0JBQ0tHUk9VTkQsIGJhY2tncm91bmQgPyAxIDogMCk7CiAgICBkYXRhVmlldy5zZXRVaW50OChQYXR0ZXJuSW5mby4jU0hBRElOR19UWVBFLCBzaGFkaW5nVHlwZSk7CiAgICBkYXRhVmlldy5zZXRVaW50MzIoUGF0dGVybkluZm8uI05fQ09PUkQsIG5Db29yZCwgdHJ1ZSk7CiAgICBkYXRhVmlldy5zZXRVaW50MzIoUGF0dGVybkluZm8uI05fQ09MT1IsIG5Db2xvciwgdHJ1ZSk7CiAgICBkYXRhVmlldy5zZXRVaW50MzIoUGF0dGVybkluZm8uI05fU1RPUCwgblN0b3AsIHRydWUpOwogICAgZGF0YVZpZXcuc2V0VWludDMyKFBhdHRlcm5JbmZvLiNOX0ZJR1VSRVMsIG5GaWd1cmVzLCB0cnVlKTsKICAgIGxldCBvZmZzZXQgPSAyMDsKICAgIGNvbnN0IGNvb3Jkc1ZpZXcgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlciwgb2Zmc2V0LCBuQ29vcmQgKiAyKTsKICAgIGNvb3Jkc1ZpZXcuc2V0KGNvb3Jkcyk7CiAgICBvZmZzZXQgKz0gbkNvb3JkICogODsKICAgIHU4ZGF0YS5zZXQoY29sb3JzLCBvZmZzZXQpOwogICAgb2Zmc2V0ICs9IG5Db2xvciAqIDM7CiAgICBmb3IgKGNvbnN0IFtwb3MsIGhleF0gb2YgY29sb3JTdG9wcykgewogICAgICBkYXRhVmlldy5zZXRGbG9hdDMyKG9mZnNldCwgcG9zLCB0cnVlKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgIGRhdGFWaWV3LnNldFVpbnQzMihvZmZzZXQsIHBhcnNlSW50KGhleC5zbGljZSgxKSwgMTYpLCB0cnVlKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICB9CiAgICBpZiAoYmJveCkgewogICAgICBmb3IgKGNvbnN0IHYgb2YgYmJveCkgewogICAgICAgIGRhdGFWaWV3LnNldEZsb2F0MzIob2Zmc2V0LCB2LCB0cnVlKTsKICAgICAgICBvZmZzZXQgKz0gNDsKICAgICAgfQogICAgfQogICAgaWYgKGJhY2tncm91bmQpIHsKICAgICAgdThkYXRhLnNldChiYWNrZ3JvdW5kLCBvZmZzZXQpOwogICAgICBvZmZzZXQgKz0gMzsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlndXJlcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBmaWd1cmUgPSBmaWd1cmVzW2ldOwogICAgICBkYXRhVmlldy5zZXRVaW50OChvZmZzZXQsIGZpZ3VyZS50eXBlKTsKICAgICAgb2Zmc2V0ICs9IDE7CiAgICAgIG9mZnNldCA9IE1hdGguY2VpbChvZmZzZXQgLyA0KSAqIDQ7CiAgICAgIGRhdGFWaWV3LnNldFVpbnQzMihvZmZzZXQsIGZpZ3VyZS5jb29yZHMubGVuZ3RoLCB0cnVlKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgIGNvbnN0IGZpZ3VyZUNvb3Jkc1ZpZXcgPSBuZXcgSW50MzJBcnJheShidWZmZXIsIG9mZnNldCwgZmlndXJlLmNvb3Jkcy5sZW5ndGgpOwogICAgICBmaWd1cmVDb29yZHNWaWV3LnNldChmaWd1cmUuY29vcmRzKTsKICAgICAgb2Zmc2V0ICs9IGZpZ3VyZS5jb29yZHMubGVuZ3RoICogNDsKICAgICAgZGF0YVZpZXcuc2V0VWludDMyKG9mZnNldCwgZmlndXJlLmNvbG9ycy5sZW5ndGgsIHRydWUpOwogICAgICBvZmZzZXQgKz0gNDsKICAgICAgY29uc3QgY29sb3JzVmlldyA9IG5ldyBJbnQzMkFycmF5KGJ1ZmZlciwgb2Zmc2V0LCBmaWd1cmUuY29sb3JzLmxlbmd0aCk7CiAgICAgIGNvbG9yc1ZpZXcuc2V0KGZpZ3VyZS5jb2xvcnMpOwogICAgICBvZmZzZXQgKz0gZmlndXJlLmNvbG9ycy5sZW5ndGggKiA0OwogICAgICBpZiAoZmlndXJlLnZlcnRpY2VzUGVyUm93ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBkYXRhVmlldy5zZXRVaW50MzIob2Zmc2V0LCBmaWd1cmUudmVydGljZXNQZXJSb3csIHRydWUpOwogICAgICAgIG9mZnNldCArPSA0OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYnVmZmVyOwogIH0KICBnZXRJUigpIHsKICAgIGNvbnN0IGRhdGFWaWV3ID0gdGhpcy52aWV3OwogICAgY29uc3Qga2luZCA9IHRoaXMuZGF0YVtQYXR0ZXJuSW5mby4jS0lORF07CiAgICBjb25zdCBoYXNCQm94ID0gISF0aGlzLmRhdGFbUGF0dGVybkluZm8uI0hBU19CQk9YXTsKICAgIGNvbnN0IGhhc0JhY2tncm91bmQgPSAhIXRoaXMuZGF0YVtQYXR0ZXJuSW5mby4jSEFTX0JBQ0tHUk9VTkRdOwogICAgY29uc3QgbkNvb3JkID0gZGF0YVZpZXcuZ2V0VWludDMyKFBhdHRlcm5JbmZvLiNOX0NPT1JELCB0cnVlKTsKICAgIGNvbnN0IG5Db2xvciA9IGRhdGFWaWV3LmdldFVpbnQzMihQYXR0ZXJuSW5mby4jTl9DT0xPUiwgdHJ1ZSk7CiAgICBjb25zdCBuU3RvcCA9IGRhdGFWaWV3LmdldFVpbnQzMihQYXR0ZXJuSW5mby4jTl9TVE9QLCB0cnVlKTsKICAgIGNvbnN0IG5GaWd1cmVzID0gZGF0YVZpZXcuZ2V0VWludDMyKFBhdHRlcm5JbmZvLiNOX0ZJR1VSRVMsIHRydWUpOwogICAgbGV0IG9mZnNldCA9IDIwOwogICAgY29uc3QgY29vcmRzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLmJ1ZmZlciwgb2Zmc2V0LCBuQ29vcmQgKiAyKTsKICAgIG9mZnNldCArPSBuQ29vcmQgKiA4OwogICAgY29uc3QgY29sb3JzID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIsIG9mZnNldCwgbkNvbG9yICogMyk7CiAgICBvZmZzZXQgKz0gbkNvbG9yICogMzsKICAgIGNvbnN0IHN0b3BzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5TdG9wOyArK2kpIHsKICAgICAgY29uc3QgcCA9IGRhdGFWaWV3LmdldEZsb2F0MzIob2Zmc2V0LCB0cnVlKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgIGNvbnN0IHJnYiA9IGRhdGFWaWV3LmdldFVpbnQzMihvZmZzZXQsIHRydWUpOwogICAgICBvZmZzZXQgKz0gNDsKICAgICAgc3RvcHMucHVzaChbcCwgYCMke3JnYi50b1N0cmluZygxNikucGFkU3RhcnQoNiwgIjAiKX1gXSk7CiAgICB9CiAgICBsZXQgYmJveCA9IG51bGw7CiAgICBpZiAoaGFzQkJveCkgewogICAgICBiYm94ID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgKytpKSB7CiAgICAgICAgYmJveC5wdXNoKGRhdGFWaWV3LmdldEZsb2F0MzIob2Zmc2V0LCB0cnVlKSk7CiAgICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgIH0KICAgIH0KICAgIGxldCBiYWNrZ3JvdW5kID0gbnVsbDsKICAgIGlmIChoYXNCYWNrZ3JvdW5kKSB7CiAgICAgIGJhY2tncm91bmQgPSBuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlciwgb2Zmc2V0LCAzKTsKICAgICAgb2Zmc2V0ICs9IDM7CiAgICB9CiAgICBjb25zdCBmaWd1cmVzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5GaWd1cmVzOyArK2kpIHsKICAgICAgY29uc3QgdHlwZSA9IGRhdGFWaWV3LmdldFVpbnQ4KG9mZnNldCk7CiAgICAgIG9mZnNldCArPSAxOwogICAgICBvZmZzZXQgPSBNYXRoLmNlaWwob2Zmc2V0IC8gNCkgKiA0OwogICAgICBjb25zdCBjb29yZHNMZW5ndGggPSBkYXRhVmlldy5nZXRVaW50MzIob2Zmc2V0LCB0cnVlKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgIGNvbnN0IGZpZ3VyZUNvb3JkcyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYnVmZmVyLCBvZmZzZXQsIGNvb3Jkc0xlbmd0aCk7CiAgICAgIG9mZnNldCArPSBjb29yZHNMZW5ndGggKiA0OwogICAgICBjb25zdCBjb2xvcnNMZW5ndGggPSBkYXRhVmlldy5nZXRVaW50MzIob2Zmc2V0LCB0cnVlKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgIGNvbnN0IGZpZ3VyZUNvbG9ycyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYnVmZmVyLCBvZmZzZXQsIGNvbG9yc0xlbmd0aCk7CiAgICAgIG9mZnNldCArPSBjb2xvcnNMZW5ndGggKiA0OwogICAgICBjb25zdCBmaWd1cmUgPSB7CiAgICAgICAgdHlwZSwKICAgICAgICBjb29yZHM6IGZpZ3VyZUNvb3JkcywKICAgICAgICBjb2xvcnM6IGZpZ3VyZUNvbG9ycwogICAgICB9OwogICAgICBpZiAodHlwZSA9PT0gTWVzaEZpZ3VyZVR5cGUuTEFUVElDRSkgewogICAgICAgIGZpZ3VyZS52ZXJ0aWNlc1BlclJvdyA9IGRhdGFWaWV3LmdldFVpbnQzMihvZmZzZXQsIHRydWUpOwogICAgICAgIG9mZnNldCArPSA0OwogICAgICB9CiAgICAgIGZpZ3VyZXMucHVzaChmaWd1cmUpOwogICAgfQogICAgaWYgKGtpbmQgPT09IDEpIHsKICAgICAgcmV0dXJuIFsiUmFkaWFsQXhpYWwiLCAiYXhpYWwiLCBiYm94LCBzdG9wcywgQXJyYXkuZnJvbShjb29yZHMuc2xpY2UoMCwgMikpLCBBcnJheS5mcm9tKGNvb3Jkcy5zbGljZSgyLCA0KSksIG51bGwsIG51bGxdOwogICAgfQogICAgaWYgKGtpbmQgPT09IDIpIHsKICAgICAgcmV0dXJuIFsiUmFkaWFsQXhpYWwiLCAicmFkaWFsIiwgYmJveCwgc3RvcHMsIFtjb29yZHNbMF0sIGNvb3Jkc1sxXV0sIFtjb29yZHNbM10sIGNvb3Jkc1s0XV0sIGNvb3Jkc1syXSwgY29vcmRzWzVdXTsKICAgIH0KICAgIGlmIChraW5kID09PSAzKSB7CiAgICAgIGNvbnN0IHNoYWRpbmdUeXBlID0gdGhpcy5kYXRhW1BhdHRlcm5JbmZvLiNTSEFESU5HX1RZUEVdOwogICAgICBsZXQgYm91bmRzID0gbnVsbDsKICAgICAgaWYgKGNvb3Jkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgbGV0IG1pblggPSBjb29yZHNbMF0sCiAgICAgICAgICBtYXhYID0gY29vcmRzWzBdOwogICAgICAgIGxldCBtaW5ZID0gY29vcmRzWzFdLAogICAgICAgICAgbWF4WSA9IGNvb3Jkc1sxXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3Jkcy5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgY29uc3QgeCA9IGNvb3Jkc1tpXSwKICAgICAgICAgICAgeSA9IGNvb3Jkc1tpICsgMV07CiAgICAgICAgICBtaW5YID0gbWluWCA+IHggPyB4IDogbWluWDsKICAgICAgICAgIG1pblkgPSBtaW5ZID4geSA/IHkgOiBtaW5ZOwogICAgICAgICAgbWF4WCA9IG1heFggPCB4ID8geCA6IG1heFg7CiAgICAgICAgICBtYXhZID0gbWF4WSA8IHkgPyB5IDogbWF4WTsKICAgICAgICB9CiAgICAgICAgYm91bmRzID0gW21pblgsIG1pblksIG1heFgsIG1heFldOwogICAgICB9CiAgICAgIHJldHVybiBbIk1lc2giLCBzaGFkaW5nVHlwZSwgY29vcmRzLCBjb2xvcnMsIGZpZ3VyZXMsIGJvdW5kcywgYmJveCwgYmFja2dyb3VuZF07CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHBhdHRlcm4ga2luZDogJHtraW5kfWApOwogIH0KfQpjbGFzcyBGb250UGF0aEluZm8gewogIHN0YXRpYyB3cml0ZShwYXRoKSB7CiAgICBsZXQgZGF0YTsKICAgIGxldCBidWZmZXI7CiAgICBpZiAoRmVhdHVyZVRlc3QuaXNGbG9hdDE2QXJyYXlTdXBwb3J0ZWQpIHsKICAgICAgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHBhdGgubGVuZ3RoICogMik7CiAgICAgIGRhdGEgPSBuZXcgRmxvYXQxNkFycmF5KGJ1ZmZlcik7CiAgICB9IGVsc2UgewogICAgICBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIocGF0aC5sZW5ndGggKiA0KTsKICAgICAgZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoYnVmZmVyKTsKICAgIH0KICAgIGRhdGEuc2V0KHBhdGgpOwogICAgcmV0dXJuIGJ1ZmZlcjsKICB9CiAgI2J1ZmZlcjsKICBjb25zdHJ1Y3RvcihidWZmZXIpIHsKICAgIHRoaXMuI2J1ZmZlciA9IGJ1ZmZlcjsKICB9CiAgZ2V0IHBhdGgoKSB7CiAgICBpZiAoRmVhdHVyZVRlc3QuaXNGbG9hdDE2QXJyYXlTdXBwb3J0ZWQpIHsKICAgICAgcmV0dXJuIG5ldyBGbG9hdDE2QXJyYXkodGhpcy4jYnVmZmVyKTsKICAgIH0KICAgIHJldHVybiBuZXcgRmxvYXQzMkFycmF5KHRoaXMuI2J1ZmZlcik7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9wYXR0ZXJuLmpzCgoKCgpjb25zdCBTaGFkaW5nVHlwZSA9IHsKICBGVU5DVElPTl9CQVNFRDogMSwKICBBWElBTDogMiwKICBSQURJQUw6IDMsCiAgRlJFRV9GT1JNX01FU0g6IDQsCiAgTEFUVElDRV9GT1JNX01FU0g6IDUsCiAgQ09PTlNfUEFUQ0hfTUVTSDogNiwKICBURU5TT1JfUEFUQ0hfTUVTSDogNwp9OwpjbGFzcyBQYXR0ZXJuIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHVucmVhY2hhYmxlKCJDYW5ub3QgaW5pdGlhbGl6ZSBQYXR0ZXJuLiIpOwogIH0KICBzdGF0aWMgcGFyc2VTaGFkaW5nKHNoYWRpbmcsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKSB7CiAgICBjb25zdCBkaWN0ID0gc2hhZGluZyBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gPyBzaGFkaW5nLmRpY3QgOiBzaGFkaW5nOwogICAgY29uc3QgdHlwZSA9IGRpY3QuZ2V0KCJTaGFkaW5nVHlwZSIpOwogICAgdHJ5IHsKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5BWElBTDoKICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLlJBRElBTDoKICAgICAgICAgIHJldHVybiBuZXcgUmFkaWFsQXhpYWxTaGFkaW5nKGRpY3QsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLkZSRUVfRk9STV9NRVNIOgogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuTEFUVElDRV9GT1JNX01FU0g6CiAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5DT09OU19QQVRDSF9NRVNIOgogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuVEVOU09SX1BBVENIX01FU0g6CiAgICAgICAgICByZXR1cm4gbmV3IE1lc2hTaGFkaW5nKHNoYWRpbmcsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbnN1cHBvcnRlZCBTaGFkaW5nVHlwZTogIiArIHR5cGUpOwogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oZXgpOwogICAgICByZXR1cm4gbmV3IER1bW15U2hhZGluZygpOwogICAgfQogIH0KfQpjbGFzcyBCYXNlU2hhZGluZyB7CiAgc3RhdGljIFNNQUxMX05VTUJFUiA9IDFlLTY7CiAgZ2V0SVIoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRJUmAgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBSYWRpYWxBeGlhbFNoYWRpbmcgZXh0ZW5kcyBCYXNlU2hhZGluZyB7CiAgY29uc3RydWN0b3IoZGljdCwgeHJlZiwgcmVzb3VyY2VzLCBwZGZGdW5jdGlvbkZhY3RvcnksIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnNoYWRpbmdUeXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CiAgICBsZXQgY29vcmRzTGVuID0gMDsKICAgIGlmICh0aGlzLnNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5BWElBTCkgewogICAgICBjb29yZHNMZW4gPSA0OwogICAgfSBlbHNlIGlmICh0aGlzLnNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5SQURJQUwpIHsKICAgICAgY29vcmRzTGVuID0gNjsKICAgIH0KICAgIHRoaXMuY29vcmRzQXJyID0gZGljdC5nZXRBcnJheSgiQ29vcmRzIik7CiAgICBpZiAoIWlzTnVtYmVyQXJyYXkodGhpcy5jb29yZHNBcnIsIGNvb3Jkc0xlbikpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJSYWRpYWxBeGlhbFNoYWRpbmc6IEludmFsaWQgL0Nvb3JkcyBhcnJheS4iKTsKICAgIH0KICAgIGNvbnN0IGNzID0gQ29sb3JTcGFjZVV0aWxzLnBhcnNlKHsKICAgICAgY3M6IGRpY3QuZ2V0UmF3KCJDUyIpIHx8IGRpY3QuZ2V0UmF3KCJDb2xvclNwYWNlIiksCiAgICAgIHhyZWYsCiAgICAgIHJlc291cmNlcywKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KTsKICAgIHRoaXMuYmJveCA9IGxvb2t1cE5vcm1hbFJlY3QoZGljdC5nZXRBcnJheSgiQkJveCIpLCBudWxsKTsKICAgIGxldCB0MCA9IDAuMCwKICAgICAgdDEgPSAxLjA7CiAgICBjb25zdCBkb21haW5BcnIgPSBkaWN0LmdldEFycmF5KCJEb21haW4iKTsKICAgIGlmIChpc051bWJlckFycmF5KGRvbWFpbkFyciwgMikpIHsKICAgICAgW3QwLCB0MV0gPSBkb21haW5BcnI7CiAgICB9CiAgICBsZXQgZXh0ZW5kU3RhcnQgPSBmYWxzZSwKICAgICAgZXh0ZW5kRW5kID0gZmFsc2U7CiAgICBjb25zdCBleHRlbmRBcnIgPSBkaWN0LmdldEFycmF5KCJFeHRlbmQiKTsKICAgIGlmIChpc0Jvb2xlYW5BcnJheShleHRlbmRBcnIsIDIpKSB7CiAgICAgIFtleHRlbmRTdGFydCwgZXh0ZW5kRW5kXSA9IGV4dGVuZEFycjsKICAgIH0KICAgIGlmICh0aGlzLnNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5SQURJQUwgJiYgKCFleHRlbmRTdGFydCB8fCAhZXh0ZW5kRW5kKSkgewogICAgICBjb25zdCBbeDEsIHkxLCByMSwgeDIsIHkyLCByMl0gPSB0aGlzLmNvb3Jkc0FycjsKICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLmh5cG90KHgxIC0geDIsIHkxIC0geTIpOwogICAgICBpZiAocjEgPD0gcjIgKyBkaXN0YW5jZSAmJiByMiA8PSByMSArIGRpc3RhbmNlKSB7CiAgICAgICAgd2FybigiVW5zdXBwb3J0ZWQgcmFkaWFsIGdyYWRpZW50LiIpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmV4dGVuZFN0YXJ0ID0gZXh0ZW5kU3RhcnQ7CiAgICB0aGlzLmV4dGVuZEVuZCA9IGV4dGVuZEVuZDsKICAgIGNvbnN0IGZuT2JqID0gZGljdC5nZXRSYXcoIkZ1bmN0aW9uIik7CiAgICBjb25zdCBmbiA9IHBkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUoZm5PYmosIHRydWUpOwogICAgY29uc3QgTlVNQkVSX09GX1NBTVBMRVMgPSA4NDA7CiAgICBjb25zdCBzdGVwID0gKHQxIC0gdDApIC8gTlVNQkVSX09GX1NBTVBMRVM7CiAgICBjb25zdCBjb2xvclN0b3BzID0gdGhpcy5jb2xvclN0b3BzID0gW107CiAgICBpZiAodDAgPj0gdDEgfHwgc3RlcCA8PSAwKSB7CiAgICAgIGluZm8oIkJhZCBzaGFkaW5nIGRvbWFpbi4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY29sb3IgPSBuZXcgRmxvYXQzMkFycmF5KGNzLm51bUNvbXBzKSwKICAgICAgcmF0aW8gPSBuZXcgRmxvYXQzMkFycmF5KDEpOwogICAgbGV0IGlCYXNlID0gMDsKICAgIHJhdGlvWzBdID0gdDA7CiAgICBmbihyYXRpbywgMCwgY29sb3IsIDApOwogICAgY29uc3QgcmdiQnVmZmVyID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwogICAgY3MuZ2V0UmdiKGNvbG9yLCAwLCByZ2JCdWZmZXIpOwogICAgbGV0IFtyQmFzZSwgZ0Jhc2UsIGJCYXNlXSA9IHJnYkJ1ZmZlcjsKICAgIGNvbG9yU3RvcHMucHVzaChbMCwgVXRpbC5tYWtlSGV4Q29sb3IockJhc2UsIGdCYXNlLCBiQmFzZSldKTsKICAgIGxldCBpUHJldiA9IDE7CiAgICByYXRpb1swXSA9IHQwICsgc3RlcDsKICAgIGZuKHJhdGlvLCAwLCBjb2xvciwgMCk7CiAgICBjcy5nZXRSZ2IoY29sb3IsIDAsIHJnYkJ1ZmZlcik7CiAgICBsZXQgW3JQcmV2LCBnUHJldiwgYlByZXZdID0gcmdiQnVmZmVyOwogICAgbGV0IG1heFNsb3BlUiA9IHJQcmV2IC0gckJhc2UgKyAxOwogICAgbGV0IG1heFNsb3BlRyA9IGdQcmV2IC0gZ0Jhc2UgKyAxOwogICAgbGV0IG1heFNsb3BlQiA9IGJQcmV2IC0gYkJhc2UgKyAxOwogICAgbGV0IG1pblNsb3BlUiA9IHJQcmV2IC0gckJhc2UgLSAxOwogICAgbGV0IG1pblNsb3BlRyA9IGdQcmV2IC0gZ0Jhc2UgLSAxOwogICAgbGV0IG1pblNsb3BlQiA9IGJQcmV2IC0gYkJhc2UgLSAxOwogICAgZm9yIChsZXQgaSA9IDI7IGkgPCBOVU1CRVJfT0ZfU0FNUExFUzsgaSsrKSB7CiAgICAgIHJhdGlvWzBdID0gdDAgKyBpICogc3RlcDsKICAgICAgZm4ocmF0aW8sIDAsIGNvbG9yLCAwKTsKICAgICAgY3MuZ2V0UmdiKGNvbG9yLCAwLCByZ2JCdWZmZXIpOwogICAgICBjb25zdCBbciwgZywgYl0gPSByZ2JCdWZmZXI7CiAgICAgIGNvbnN0IHJ1biA9IGkgLSBpQmFzZTsKICAgICAgbWF4U2xvcGVSID0gTWF0aC5taW4obWF4U2xvcGVSLCAociAtIHJCYXNlICsgMSkgLyBydW4pOwogICAgICBtYXhTbG9wZUcgPSBNYXRoLm1pbihtYXhTbG9wZUcsIChnIC0gZ0Jhc2UgKyAxKSAvIHJ1bik7CiAgICAgIG1heFNsb3BlQiA9IE1hdGgubWluKG1heFNsb3BlQiwgKGIgLSBiQmFzZSArIDEpIC8gcnVuKTsKICAgICAgbWluU2xvcGVSID0gTWF0aC5tYXgobWluU2xvcGVSLCAociAtIHJCYXNlIC0gMSkgLyBydW4pOwogICAgICBtaW5TbG9wZUcgPSBNYXRoLm1heChtaW5TbG9wZUcsIChnIC0gZ0Jhc2UgLSAxKSAvIHJ1bik7CiAgICAgIG1pblNsb3BlQiA9IE1hdGgubWF4KG1pblNsb3BlQiwgKGIgLSBiQmFzZSAtIDEpIC8gcnVuKTsKICAgICAgY29uc3Qgc2xvcGVzRXhpc3QgPSBtaW5TbG9wZVIgPD0gbWF4U2xvcGVSICYmIG1pblNsb3BlRyA8PSBtYXhTbG9wZUcgJiYgbWluU2xvcGVCIDw9IG1heFNsb3BlQjsKICAgICAgaWYgKCFzbG9wZXNFeGlzdCkgewogICAgICAgIGNvbnN0IGNzc0NvbG9yID0gVXRpbC5tYWtlSGV4Q29sb3IoclByZXYsIGdQcmV2LCBiUHJldik7CiAgICAgICAgY29sb3JTdG9wcy5wdXNoKFtpUHJldiAvIE5VTUJFUl9PRl9TQU1QTEVTLCBjc3NDb2xvcl0pOwogICAgICAgIG1heFNsb3BlUiA9IHIgLSByUHJldiArIDE7CiAgICAgICAgbWF4U2xvcGVHID0gZyAtIGdQcmV2ICsgMTsKICAgICAgICBtYXhTbG9wZUIgPSBiIC0gYlByZXYgKyAxOwogICAgICAgIG1pblNsb3BlUiA9IHIgLSByUHJldiAtIDE7CiAgICAgICAgbWluU2xvcGVHID0gZyAtIGdQcmV2IC0gMTsKICAgICAgICBtaW5TbG9wZUIgPSBiIC0gYlByZXYgLSAxOwogICAgICAgIGlCYXNlID0gaVByZXY7CiAgICAgICAgckJhc2UgPSByUHJldjsKICAgICAgICBnQmFzZSA9IGdQcmV2OwogICAgICAgIGJCYXNlID0gYlByZXY7CiAgICAgIH0KICAgICAgaVByZXYgPSBpOwogICAgICByUHJldiA9IHI7CiAgICAgIGdQcmV2ID0gZzsKICAgICAgYlByZXYgPSBiOwogICAgfQogICAgY29sb3JTdG9wcy5wdXNoKFsxLCBVdGlsLm1ha2VIZXhDb2xvcihyUHJldiwgZ1ByZXYsIGJQcmV2KV0pOwogICAgbGV0IGJhY2tncm91bmQgPSAidHJhbnNwYXJlbnQiOwogICAgaWYgKGRpY3QuaGFzKCJCYWNrZ3JvdW5kIikpIHsKICAgICAgYmFja2dyb3VuZCA9IGNzLmdldFJnYkhleChkaWN0LmdldCgiQmFja2dyb3VuZCIpLCAwKTsKICAgIH0KICAgIGlmICghZXh0ZW5kU3RhcnQpIHsKICAgICAgY29sb3JTdG9wcy51bnNoaWZ0KFswLCBiYWNrZ3JvdW5kXSk7CiAgICAgIGNvbG9yU3RvcHNbMV1bMF0gKz0gQmFzZVNoYWRpbmcuU01BTExfTlVNQkVSOwogICAgfQogICAgaWYgKCFleHRlbmRFbmQpIHsKICAgICAgY29sb3JTdG9wcy5hdCgtMSlbMF0gLT0gQmFzZVNoYWRpbmcuU01BTExfTlVNQkVSOwogICAgICBjb2xvclN0b3BzLnB1c2goWzEsIGJhY2tncm91bmRdKTsKICAgIH0KICAgIHRoaXMuY29sb3JTdG9wcyA9IGNvbG9yU3RvcHM7CiAgfQogIGdldElSKCkgewogICAgY29uc3QgewogICAgICBjb29yZHNBcnIsCiAgICAgIHNoYWRpbmdUeXBlCiAgICB9ID0gdGhpczsKICAgIGxldCB0eXBlLCBwMCwgcDEsIHIwLCByMTsKICAgIGlmIChzaGFkaW5nVHlwZSA9PT0gU2hhZGluZ1R5cGUuQVhJQUwpIHsKICAgICAgcDAgPSBbY29vcmRzQXJyWzBdLCBjb29yZHNBcnJbMV1dOwogICAgICBwMSA9IFtjb29yZHNBcnJbMl0sIGNvb3Jkc0FyclszXV07CiAgICAgIHIwID0gbnVsbDsKICAgICAgcjEgPSBudWxsOwogICAgICB0eXBlID0gImF4aWFsIjsKICAgIH0gZWxzZSBpZiAoc2hhZGluZ1R5cGUgPT09IFNoYWRpbmdUeXBlLlJBRElBTCkgewogICAgICBwMCA9IFtjb29yZHNBcnJbMF0sIGNvb3Jkc0FyclsxXV07CiAgICAgIHAxID0gW2Nvb3Jkc0FyclszXSwgY29vcmRzQXJyWzRdXTsKICAgICAgcjAgPSBjb29yZHNBcnJbMl07CiAgICAgIHIxID0gY29vcmRzQXJyWzVdOwogICAgICB0eXBlID0gInJhZGlhbCI7CiAgICB9IGVsc2UgewogICAgICB1bnJlYWNoYWJsZShgZ2V0UGF0dGVybiB0eXBlIHVua25vd246ICR7c2hhZGluZ1R5cGV9YCk7CiAgICB9CiAgICByZXR1cm4gWyJSYWRpYWxBeGlhbCIsIHR5cGUsIHRoaXMuYmJveCwgdGhpcy5jb2xvclN0b3BzLCBwMCwgcDEsIHIwLCByMV07CiAgfQp9CmNsYXNzIE1lc2hTdHJlYW1SZWFkZXIgewogIGNvbnN0cnVjdG9yKHN0cmVhbSwgY29udGV4dCkgewogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0OwogICAgdGhpcy5idWZmZXIgPSAwOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogICAgY29uc3QgbnVtQ29tcHMgPSBjb250ZXh0Lm51bUNvbXBzOwogICAgdGhpcy50bXBDb21wc0J1ZiA9IG5ldyBGbG9hdDMyQXJyYXkobnVtQ29tcHMpOwogICAgY29uc3QgY3NOdW1Db21wcyA9IGNvbnRleHQuY29sb3JTcGFjZS5udW1Db21wczsKICAgIHRoaXMudG1wQ3NDb21wc0J1ZiA9IGNvbnRleHQuY29sb3JGbiA/IG5ldyBGbG9hdDMyQXJyYXkoY3NOdW1Db21wcykgOiB0aGlzLnRtcENvbXBzQnVmOwogIH0KICBnZXQgaGFzRGF0YSgpIHsKICAgIGlmICh0aGlzLnN0cmVhbS5lbmQpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLnBvcyA8IHRoaXMuc3RyZWFtLmVuZDsKICAgIH0KICAgIGlmICh0aGlzLmJ1ZmZlckxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBjb25zdCBuZXh0Qnl0ZSA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgIGlmIChuZXh0Qnl0ZSA8IDApIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBuZXh0Qnl0ZTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gODsKICAgIHJldHVybiB0cnVlOwogIH0KICByZWFkQml0cyhuKSB7CiAgICBjb25zdCB7CiAgICAgIHN0cmVhbQogICAgfSA9IHRoaXM7CiAgICBsZXQgewogICAgICBidWZmZXIsCiAgICAgIGJ1ZmZlckxlbmd0aAogICAgfSA9IHRoaXM7CiAgICBpZiAobiA9PT0gMzIpIHsKICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBzdHJlYW0uZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgfQogICAgICBidWZmZXIgPSBidWZmZXIgPDwgMjQgfCBzdHJlYW0uZ2V0Qnl0ZSgpIDw8IDE2IHwgc3RyZWFtLmdldEJ5dGUoKSA8PCA4IHwgc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgY29uc3QgbmV4dEJ5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICB0aGlzLmJ1ZmZlciA9IG5leHRCeXRlICYgKDEgPDwgYnVmZmVyTGVuZ3RoKSAtIDE7CiAgICAgIHJldHVybiAoYnVmZmVyIDw8IDggLSBidWZmZXJMZW5ndGggfCAobmV4dEJ5dGUgJiAweGZmKSA+PiBidWZmZXJMZW5ndGgpID4+PiAwOwogICAgfQogICAgaWYgKG4gPT09IDggJiYgYnVmZmVyTGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgfQogICAgd2hpbGUgKGJ1ZmZlckxlbmd0aCA8IG4pIHsKICAgICAgYnVmZmVyID0gYnVmZmVyIDw8IDggfCBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICBidWZmZXJMZW5ndGggKz0gODsKICAgIH0KICAgIGJ1ZmZlckxlbmd0aCAtPSBuOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSBidWZmZXJMZW5ndGg7CiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlciAmICgxIDw8IGJ1ZmZlckxlbmd0aCkgLSAxOwogICAgcmV0dXJuIGJ1ZmZlciA+PiBidWZmZXJMZW5ndGg7CiAgfQogIGFsaWduKCkgewogICAgdGhpcy5idWZmZXIgPSAwOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogIH0KICByZWFkRmxhZygpIHsKICAgIHJldHVybiB0aGlzLnJlYWRCaXRzKHRoaXMuY29udGV4dC5iaXRzUGVyRmxhZyk7CiAgfQogIHJlYWRDb29yZGluYXRlKCkgewogICAgY29uc3QgewogICAgICBiaXRzUGVyQ29vcmRpbmF0ZSwKICAgICAgZGVjb2RlCiAgICB9ID0gdGhpcy5jb250ZXh0OwogICAgY29uc3QgeGkgPSB0aGlzLnJlYWRCaXRzKGJpdHNQZXJDb29yZGluYXRlKTsKICAgIGNvbnN0IHlpID0gdGhpcy5yZWFkQml0cyhiaXRzUGVyQ29vcmRpbmF0ZSk7CiAgICBjb25zdCBzY2FsZSA9IGJpdHNQZXJDb29yZGluYXRlIDwgMzIgPyAxIC8gKCgxIDw8IGJpdHNQZXJDb29yZGluYXRlKSAtIDEpIDogMi4zMjgzMDY0MzY1Mzg2OTYzZS0xMDsKICAgIHJldHVybiBbeGkgKiBzY2FsZSAqIChkZWNvZGVbMV0gLSBkZWNvZGVbMF0pICsgZGVjb2RlWzBdLCB5aSAqIHNjYWxlICogKGRlY29kZVszXSAtIGRlY29kZVsyXSkgKyBkZWNvZGVbMl1dOwogIH0KICByZWFkQ29tcG9uZW50cygpIHsKICAgIGNvbnN0IHsKICAgICAgYml0c1BlckNvbXBvbmVudCwKICAgICAgY29sb3JGbiwKICAgICAgY29sb3JTcGFjZSwKICAgICAgZGVjb2RlLAogICAgICBudW1Db21wcwogICAgfSA9IHRoaXMuY29udGV4dDsKICAgIGNvbnN0IHNjYWxlID0gYml0c1BlckNvbXBvbmVudCA8IDMyID8gMSAvICgoMSA8PCBiaXRzUGVyQ29tcG9uZW50KSAtIDEpIDogMi4zMjgzMDY0MzY1Mzg2OTYzZS0xMDsKICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLnRtcENvbXBzQnVmOwogICAgZm9yIChsZXQgaSA9IDAsIGogPSA0OyBpIDwgbnVtQ29tcHM7IGkrKywgaiArPSAyKSB7CiAgICAgIGNvbnN0IGNpID0gdGhpcy5yZWFkQml0cyhiaXRzUGVyQ29tcG9uZW50KTsKICAgICAgY29tcG9uZW50c1tpXSA9IGNpICogc2NhbGUgKiAoZGVjb2RlW2ogKyAxXSAtIGRlY29kZVtqXSkgKyBkZWNvZGVbal07CiAgICB9CiAgICBjb25zdCBjb2xvciA9IHRoaXMudG1wQ3NDb21wc0J1ZjsKICAgIGNvbG9yRm4/Lihjb21wb25lbnRzLCAwLCBjb2xvciwgMCk7CiAgICByZXR1cm4gY29sb3JTcGFjZS5nZXRSZ2IoY29sb3IsIDApOwogIH0KfQpsZXQgYkNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKZnVuY3Rpb24gYnVpbGRCKGNvdW50KSB7CiAgY29uc3QgbHV0ID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gY291bnQ7IGkrKykgewogICAgY29uc3QgdCA9IGkgLyBjb3VudCwKICAgICAgdF8gPSAxIC0gdDsKICAgIGx1dC5wdXNoKG5ldyBGbG9hdDMyQXJyYXkoW3RfICoqIDMsIDMgKiB0ICogdF8gKiogMiwgMyAqIHQgKiogMiAqIHRfLCB0ICoqIDNdKSk7CiAgfQogIHJldHVybiBsdXQ7Cn0KZnVuY3Rpb24gZ2V0Qihjb3VudCkgewogIHJldHVybiBiQ2FjaGVbY291bnRdIHx8PSBidWlsZEIoY291bnQpOwp9CmZ1bmN0aW9uIGNsZWFyUGF0dGVybkNhY2hlcygpIHsKICBiQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwp9CmNsYXNzIE1lc2hTaGFkaW5nIGV4dGVuZHMgQmFzZVNoYWRpbmcgewogIHN0YXRpYyBNSU5fU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCA9IDM7CiAgc3RhdGljIE1BWF9TUExJVF9QQVRDSF9DSFVOS1NfQU1PVU5UID0gMjA7CiAgc3RhdGljIFRSSUFOR0xFX0RFTlNJVFkgPSAyMDsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIHhyZWYsIHJlc291cmNlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKSB7CiAgICBzdXBlcigpOwogICAgaWYgKCEoc3RyZWFtIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJNZXNoIGRhdGEgaXMgbm90IGEgc3RyZWFtIik7CiAgICB9CiAgICBjb25zdCBkaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICB0aGlzLnNoYWRpbmdUeXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CiAgICB0aGlzLmJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGRpY3QuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgICBjb25zdCBjcyA9IENvbG9yU3BhY2VVdGlscy5wYXJzZSh7CiAgICAgIGNzOiBkaWN0LmdldFJhdygiQ1MiKSB8fCBkaWN0LmdldFJhdygiQ29sb3JTcGFjZSIpLAogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgfSk7CiAgICB0aGlzLmJhY2tncm91bmQgPSBkaWN0LmhhcygiQmFja2dyb3VuZCIpID8gY3MuZ2V0UmdiKGRpY3QuZ2V0KCJCYWNrZ3JvdW5kIiksIDApIDogbnVsbDsKICAgIGNvbnN0IGZuT2JqID0gZGljdC5nZXRSYXcoIkZ1bmN0aW9uIik7CiAgICBjb25zdCBmbiA9IGZuT2JqID8gcGRmRnVuY3Rpb25GYWN0b3J5LmNyZWF0ZShmbk9iaiwgdHJ1ZSkgOiBudWxsOwogICAgdGhpcy5jb29yZHMgPSBbXTsKICAgIHRoaXMuY29sb3JzID0gW107CiAgICB0aGlzLmZpZ3VyZXMgPSBbXTsKICAgIGNvbnN0IGRlY29kZUNvbnRleHQgPSB7CiAgICAgIGJpdHNQZXJDb29yZGluYXRlOiBkaWN0LmdldCgiQml0c1BlckNvb3JkaW5hdGUiKSwKICAgICAgYml0c1BlckNvbXBvbmVudDogZGljdC5nZXQoIkJpdHNQZXJDb21wb25lbnQiKSwKICAgICAgYml0c1BlckZsYWc6IGRpY3QuZ2V0KCJCaXRzUGVyRmxhZyIpLAogICAgICBkZWNvZGU6IGRpY3QuZ2V0QXJyYXkoIkRlY29kZSIpLAogICAgICBjb2xvckZuOiBmbiwKICAgICAgY29sb3JTcGFjZTogY3MsCiAgICAgIG51bUNvbXBzOiBmbiA/IDEgOiBjcy5udW1Db21wcwogICAgfTsKICAgIGNvbnN0IHJlYWRlciA9IG5ldyBNZXNoU3RyZWFtUmVhZGVyKHN0cmVhbSwgZGVjb2RlQ29udGV4dCk7CiAgICBsZXQgcGF0Y2hNZXNoID0gZmFsc2U7CiAgICBzd2l0Y2ggKHRoaXMuc2hhZGluZ1R5cGUpIHsKICAgICAgY2FzZSBTaGFkaW5nVHlwZS5GUkVFX0ZPUk1fTUVTSDoKICAgICAgICB0aGlzLl9kZWNvZGVUeXBlNFNoYWRpbmcocmVhZGVyKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTaGFkaW5nVHlwZS5MQVRUSUNFX0ZPUk1fTUVTSDoKICAgICAgICBjb25zdCB2ZXJ0aWNlc1BlclJvdyA9IGRpY3QuZ2V0KCJWZXJ0aWNlc1BlclJvdyIpIHwgMDsKICAgICAgICBpZiAodmVydGljZXNQZXJSb3cgPCAyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgVmVydGljZXNQZXJSb3ciKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fZGVjb2RlVHlwZTVTaGFkaW5nKHJlYWRlciwgdmVydGljZXNQZXJSb3cpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNoYWRpbmdUeXBlLkNPT05TX1BBVENIX01FU0g6CiAgICAgICAgdGhpcy5fZGVjb2RlVHlwZTZTaGFkaW5nKHJlYWRlcik7CiAgICAgICAgcGF0Y2hNZXNoID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTaGFkaW5nVHlwZS5URU5TT1JfUEFUQ0hfTUVTSDoKICAgICAgICB0aGlzLl9kZWNvZGVUeXBlN1NoYWRpbmcocmVhZGVyKTsKICAgICAgICBwYXRjaE1lc2ggPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHVucmVhY2hhYmxlKCJVbnN1cHBvcnRlZCBtZXNoIHR5cGUuIik7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAocGF0Y2hNZXNoKSB7CiAgICAgIHRoaXMuX3VwZGF0ZUJvdW5kcygpOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0aGlzLmZpZ3VyZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIHRoaXMuX2J1aWxkRmlndXJlRnJvbVBhdGNoKGkpOwogICAgICB9CiAgICB9CiAgICB0aGlzLl91cGRhdGVCb3VuZHMoKTsKICAgIHRoaXMuX3BhY2tEYXRhKCk7CiAgfQogIF9kZWNvZGVUeXBlNFNoYWRpbmcocmVhZGVyKSB7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkczsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzOwogICAgY29uc3Qgb3BlcmF0b3JzID0gW107CiAgICBjb25zdCBwcyA9IFtdOwogICAgbGV0IHZlcnRpY2VzTGVmdCA9IDA7CiAgICB3aGlsZSAocmVhZGVyLmhhc0RhdGEpIHsKICAgICAgY29uc3QgZiA9IHJlYWRlci5yZWFkRmxhZygpOwogICAgICBjb25zdCBjb29yZCA9IHJlYWRlci5yZWFkQ29vcmRpbmF0ZSgpOwogICAgICBjb25zdCBjb2xvciA9IHJlYWRlci5yZWFkQ29tcG9uZW50cygpOwogICAgICBpZiAodmVydGljZXNMZWZ0ID09PSAwKSB7CiAgICAgICAgaWYgKCEoMCA8PSBmICYmIGYgPD0gMikpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVW5rbm93biB0eXBlNCBmbGFnIik7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoZikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB2ZXJ0aWNlc0xlZnQgPSAzOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcHMucHVzaChwcy5hdCgtMiksIHBzLmF0KC0xKSk7CiAgICAgICAgICAgIHZlcnRpY2VzTGVmdCA9IDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBwcy5wdXNoKHBzLmF0KC0zKSwgcHMuYXQoLTEpKTsKICAgICAgICAgICAgdmVydGljZXNMZWZ0ID0gMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIG9wZXJhdG9ycy5wdXNoKGYpOwogICAgICB9CiAgICAgIHBzLnB1c2goY29vcmRzLmxlbmd0aCk7CiAgICAgIGNvb3Jkcy5wdXNoKGNvb3JkKTsKICAgICAgY29sb3JzLnB1c2goY29sb3IpOwogICAgICB2ZXJ0aWNlc0xlZnQtLTsKICAgICAgcmVhZGVyLmFsaWduKCk7CiAgICB9CiAgICB0aGlzLmZpZ3VyZXMucHVzaCh7CiAgICAgIHR5cGU6IE1lc2hGaWd1cmVUeXBlLlRSSUFOR0xFUywKICAgICAgY29vcmRzOiBuZXcgSW50MzJBcnJheShwcyksCiAgICAgIGNvbG9yczogbmV3IEludDMyQXJyYXkocHMpCiAgICB9KTsKICB9CiAgX2RlY29kZVR5cGU1U2hhZGluZyhyZWFkZXIsIHZlcnRpY2VzUGVyUm93KSB7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkczsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzOwogICAgY29uc3QgcHMgPSBbXTsKICAgIHdoaWxlIChyZWFkZXIuaGFzRGF0YSkgewogICAgICBjb25zdCBjb29yZCA9IHJlYWRlci5yZWFkQ29vcmRpbmF0ZSgpOwogICAgICBjb25zdCBjb2xvciA9IHJlYWRlci5yZWFkQ29tcG9uZW50cygpOwogICAgICBwcy5wdXNoKGNvb3Jkcy5sZW5ndGgpOwogICAgICBjb29yZHMucHVzaChjb29yZCk7CiAgICAgIGNvbG9ycy5wdXNoKGNvbG9yKTsKICAgIH0KICAgIHRoaXMuZmlndXJlcy5wdXNoKHsKICAgICAgdHlwZTogTWVzaEZpZ3VyZVR5cGUuTEFUVElDRSwKICAgICAgY29vcmRzOiBuZXcgSW50MzJBcnJheShwcyksCiAgICAgIGNvbG9yczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICB2ZXJ0aWNlc1BlclJvdwogICAgfSk7CiAgfQogIF9kZWNvZGVUeXBlNlNoYWRpbmcocmVhZGVyKSB7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkczsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzOwogICAgY29uc3QgcHMgPSBuZXcgSW50MzJBcnJheSgxNik7CiAgICBjb25zdCBjcyA9IG5ldyBJbnQzMkFycmF5KDQpOwogICAgd2hpbGUgKHJlYWRlci5oYXNEYXRhKSB7CiAgICAgIGNvbnN0IGYgPSByZWFkZXIucmVhZEZsYWcoKTsKICAgICAgaWYgKCEoMCA8PSBmICYmIGYgPD0gMykpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZTYgZmxhZyIpOwogICAgICB9CiAgICAgIGNvbnN0IHBpID0gY29vcmRzLmxlbmd0aDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZiAhPT0gMCA/IDggOiAxMjsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb29yZHMucHVzaChyZWFkZXIucmVhZENvb3JkaW5hdGUoKSk7CiAgICAgIH0KICAgICAgY29uc3QgY2kgPSBjb2xvcnMubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmICE9PSAwID8gMiA6IDQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29sb3JzLnB1c2gocmVhZGVyLnJlYWRDb21wb25lbnRzKCkpOwogICAgICB9CiAgICAgIGxldCB0bXAxLCB0bXAyLCB0bXAzLCB0bXA0OwogICAgICBzd2l0Y2ggKGYpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBwc1sxMl0gPSBwaSArIDM7CiAgICAgICAgICBwc1sxM10gPSBwaSArIDQ7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDU7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDY7CiAgICAgICAgICBwc1s4XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzExXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzRdID0gcGkgKyAxOwogICAgICAgICAgcHNbN10gPSBwaSArIDg7CiAgICAgICAgICBwc1swXSA9IHBpOwogICAgICAgICAgcHNbMV0gPSBwaSArIDExOwogICAgICAgICAgcHNbMl0gPSBwaSArIDEwOwogICAgICAgICAgcHNbM10gPSBwaSArIDk7CiAgICAgICAgICBjc1syXSA9IGNpICsgMTsKICAgICAgICAgIGNzWzNdID0gY2kgKyAyOwogICAgICAgICAgY3NbMF0gPSBjaTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgdG1wMSA9IHBzWzEyXTsKICAgICAgICAgIHRtcDIgPSBwc1sxM107CiAgICAgICAgICB0bXAzID0gcHNbMTRdOwogICAgICAgICAgdG1wNCA9IHBzWzE1XTsKICAgICAgICAgIHBzWzEyXSA9IHRtcDQ7CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHRtcDM7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICBwc1s0XSA9IHRtcDI7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gdG1wMTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIHRtcDEgPSBjc1syXTsKICAgICAgICAgIHRtcDIgPSBjc1szXTsKICAgICAgICAgIGNzWzJdID0gdG1wMjsKICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICBjc1swXSA9IHRtcDE7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHRtcDEgPSBwc1sxNV07CiAgICAgICAgICB0bXAyID0gcHNbMTFdOwogICAgICAgICAgcHNbMTJdID0gcHNbM107CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHBzWzddOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSB0bXAyOwogICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICBwc1swXSA9IHRtcDE7CiAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgcHNbM10gPSBwaSArIDU7CiAgICAgICAgICB0bXAxID0gY3NbM107CiAgICAgICAgICBjc1syXSA9IGNzWzFdOwogICAgICAgICAgY3NbM10gPSBjaTsKICAgICAgICAgIGNzWzBdID0gdG1wMTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcHNbMTJdID0gcHNbMF07CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHBzWzFdOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSBwc1syXTsKICAgICAgICAgIHBzWzddID0gcGkgKyA0OwogICAgICAgICAgcHNbMF0gPSBwc1szXTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIGNzWzJdID0gY3NbMF07CiAgICAgICAgICBjc1szXSA9IGNpOwogICAgICAgICAgY3NbMF0gPSBjc1sxXTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcHNbNV0gPSBjb29yZHMubGVuZ3RoOwogICAgICBjb29yZHMucHVzaChbKC00ICogY29vcmRzW3BzWzBdXVswXSAtIGNvb3Jkc1twc1sxNV1dWzBdICsgNiAqIChjb29yZHNbcHNbNF1dWzBdICsgY29vcmRzW3BzWzFdXVswXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzBdICsgY29vcmRzW3BzWzNdXVswXSkgKyAzICogKGNvb3Jkc1twc1sxM11dWzBdICsgY29vcmRzW3BzWzddXVswXSkpIC8gOSwgKC00ICogY29vcmRzW3BzWzBdXVsxXSAtIGNvb3Jkc1twc1sxNV1dWzFdICsgNiAqIChjb29yZHNbcHNbNF1dWzFdICsgY29vcmRzW3BzWzFdXVsxXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzFdICsgY29vcmRzW3BzWzNdXVsxXSkgKyAzICogKGNvb3Jkc1twc1sxM11dWzFdICsgY29vcmRzW3BzWzddXVsxXSkpIC8gOV0pOwogICAgICBwc1s2XSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgIGNvb3Jkcy5wdXNoKFsoLTQgKiBjb29yZHNbcHNbM11dWzBdIC0gY29vcmRzW3BzWzEyXV1bMF0gKyA2ICogKGNvb3Jkc1twc1syXV1bMF0gKyBjb29yZHNbcHNbN11dWzBdKSAtIDIgKiAoY29vcmRzW3BzWzBdXVswXSArIGNvb3Jkc1twc1sxNV1dWzBdKSArIDMgKiAoY29vcmRzW3BzWzRdXVswXSArIGNvb3Jkc1twc1sxNF1dWzBdKSkgLyA5LCAoLTQgKiBjb29yZHNbcHNbM11dWzFdIC0gY29vcmRzW3BzWzEyXV1bMV0gKyA2ICogKGNvb3Jkc1twc1syXV1bMV0gKyBjb29yZHNbcHNbN11dWzFdKSAtIDIgKiAoY29vcmRzW3BzWzBdXVsxXSArIGNvb3Jkc1twc1sxNV1dWzFdKSArIDMgKiAoY29vcmRzW3BzWzRdXVsxXSArIGNvb3Jkc1twc1sxNF1dWzFdKSkgLyA5XSk7CiAgICAgIHBzWzldID0gY29vcmRzLmxlbmd0aDsKICAgICAgY29vcmRzLnB1c2goWygtNCAqIGNvb3Jkc1twc1sxMl1dWzBdIC0gY29vcmRzW3BzWzNdXVswXSArIDYgKiAoY29vcmRzW3BzWzhdXVswXSArIGNvb3Jkc1twc1sxM11dWzBdKSAtIDIgKiAoY29vcmRzW3BzWzBdXVswXSArIGNvb3Jkc1twc1sxNV1dWzBdKSArIDMgKiAoY29vcmRzW3BzWzExXV1bMF0gKyBjb29yZHNbcHNbMV1dWzBdKSkgLyA5LCAoLTQgKiBjb29yZHNbcHNbMTJdXVsxXSAtIGNvb3Jkc1twc1szXV1bMV0gKyA2ICogKGNvb3Jkc1twc1s4XV1bMV0gKyBjb29yZHNbcHNbMTNdXVsxXSkgLSAyICogKGNvb3Jkc1twc1swXV1bMV0gKyBjb29yZHNbcHNbMTVdXVsxXSkgKyAzICogKGNvb3Jkc1twc1sxMV1dWzFdICsgY29vcmRzW3BzWzFdXVsxXSkpIC8gOV0pOwogICAgICBwc1sxMF0gPSBjb29yZHMubGVuZ3RoOwogICAgICBjb29yZHMucHVzaChbKC00ICogY29vcmRzW3BzWzE1XV1bMF0gLSBjb29yZHNbcHNbMF1dWzBdICsgNiAqIChjb29yZHNbcHNbMTFdXVswXSArIGNvb3Jkc1twc1sxNF1dWzBdKSAtIDIgKiAoY29vcmRzW3BzWzEyXV1bMF0gKyBjb29yZHNbcHNbM11dWzBdKSArIDMgKiAoY29vcmRzW3BzWzJdXVswXSArIGNvb3Jkc1twc1s4XV1bMF0pKSAvIDksICgtNCAqIGNvb3Jkc1twc1sxNV1dWzFdIC0gY29vcmRzW3BzWzBdXVsxXSArIDYgKiAoY29vcmRzW3BzWzExXV1bMV0gKyBjb29yZHNbcHNbMTRdXVsxXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzFdICsgY29vcmRzW3BzWzNdXVsxXSkgKyAzICogKGNvb3Jkc1twc1syXV1bMV0gKyBjb29yZHNbcHNbOF1dWzFdKSkgLyA5XSk7CiAgICAgIHRoaXMuZmlndXJlcy5wdXNoKHsKICAgICAgICB0eXBlOiBNZXNoRmlndXJlVHlwZS5QQVRDSCwKICAgICAgICBjb29yZHM6IG5ldyBJbnQzMkFycmF5KHBzKSwKICAgICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KGNzKQogICAgICB9KTsKICAgIH0KICB9CiAgX2RlY29kZVR5cGU3U2hhZGluZyhyZWFkZXIpIHsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBwcyA9IG5ldyBJbnQzMkFycmF5KDE2KTsKICAgIGNvbnN0IGNzID0gbmV3IEludDMyQXJyYXkoNCk7CiAgICB3aGlsZSAocmVhZGVyLmhhc0RhdGEpIHsKICAgICAgY29uc3QgZiA9IHJlYWRlci5yZWFkRmxhZygpOwogICAgICBpZiAoISgwIDw9IGYgJiYgZiA8PSAzKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVW5rbm93biB0eXBlNyBmbGFnIik7CiAgICAgIH0KICAgICAgY29uc3QgcGkgPSBjb29yZHMubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmICE9PSAwID8gMTIgOiAxNjsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb29yZHMucHVzaChyZWFkZXIucmVhZENvb3JkaW5hdGUoKSk7CiAgICAgIH0KICAgICAgY29uc3QgY2kgPSBjb2xvcnMubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmICE9PSAwID8gMiA6IDQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29sb3JzLnB1c2gocmVhZGVyLnJlYWRDb21wb25lbnRzKCkpOwogICAgICB9CiAgICAgIGxldCB0bXAxLCB0bXAyLCB0bXAzLCB0bXA0OwogICAgICBzd2l0Y2ggKGYpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBwc1sxMl0gPSBwaSArIDM7CiAgICAgICAgICBwc1sxM10gPSBwaSArIDQ7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDU7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDY7CiAgICAgICAgICBwc1s4XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzldID0gcGkgKyAxMzsKICAgICAgICAgIHBzWzEwXSA9IHBpICsgMTQ7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1s0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzVdID0gcGkgKyAxMjsKICAgICAgICAgIHBzWzZdID0gcGkgKyAxNTsKICAgICAgICAgIHBzWzddID0gcGkgKyA4OwogICAgICAgICAgcHNbMF0gPSBwaTsKICAgICAgICAgIHBzWzFdID0gcGkgKyAxMTsKICAgICAgICAgIHBzWzJdID0gcGkgKyAxMDsKICAgICAgICAgIHBzWzNdID0gcGkgKyA5OwogICAgICAgICAgY3NbMl0gPSBjaSArIDE7CiAgICAgICAgICBjc1szXSA9IGNpICsgMjsKICAgICAgICAgIGNzWzBdID0gY2k7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHRtcDEgPSBwc1sxMl07CiAgICAgICAgICB0bXAyID0gcHNbMTNdOwogICAgICAgICAgdG1wMyA9IHBzWzE0XTsKICAgICAgICAgIHRtcDQgPSBwc1sxNV07CiAgICAgICAgICBwc1sxMl0gPSB0bXA0OwogICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgcHNbOF0gPSB0bXAzOwogICAgICAgICAgcHNbOV0gPSBwaSArIDk7CiAgICAgICAgICBwc1sxMF0gPSBwaSArIDEwOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSB0bXAyOwogICAgICAgICAgcHNbNV0gPSBwaSArIDg7CiAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gdG1wMTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIHRtcDEgPSBjc1syXTsKICAgICAgICAgIHRtcDIgPSBjc1szXTsKICAgICAgICAgIGNzWzJdID0gdG1wMjsKICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICBjc1swXSA9IHRtcDE7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHRtcDEgPSBwc1sxNV07CiAgICAgICAgICB0bXAyID0gcHNbMTFdOwogICAgICAgICAgcHNbMTJdID0gcHNbM107CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHBzWzddOwogICAgICAgICAgcHNbOV0gPSBwaSArIDk7CiAgICAgICAgICBwc1sxMF0gPSBwaSArIDEwOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSB0bXAyOwogICAgICAgICAgcHNbNV0gPSBwaSArIDg7CiAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gdG1wMTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIHRtcDEgPSBjc1szXTsKICAgICAgICAgIGNzWzJdID0gY3NbMV07CiAgICAgICAgICBjc1szXSA9IGNpOwogICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgY3NbMV0gPSBjaSArIDE7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBwc1sxMl0gPSBwc1swXTsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzhdID0gcHNbMV07CiAgICAgICAgICBwc1s5XSA9IHBpICsgOTsKICAgICAgICAgIHBzWzEwXSA9IHBpICsgMTA7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICBwc1s0XSA9IHBzWzJdOwogICAgICAgICAgcHNbNV0gPSBwaSArIDg7CiAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gcHNbM107CiAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgcHNbM10gPSBwaSArIDU7CiAgICAgICAgICBjc1syXSA9IGNzWzBdOwogICAgICAgICAgY3NbM10gPSBjaTsKICAgICAgICAgIGNzWzBdID0gY3NbMV07CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMuZmlndXJlcy5wdXNoKHsKICAgICAgICB0eXBlOiBNZXNoRmlndXJlVHlwZS5QQVRDSCwKICAgICAgICBjb29yZHM6IG5ldyBJbnQzMkFycmF5KHBzKSwKICAgICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KGNzKQogICAgICB9KTsKICAgIH0KICB9CiAgX2J1aWxkRmlndXJlRnJvbVBhdGNoKGluZGV4KSB7CiAgICBjb25zdCBmaWd1cmUgPSB0aGlzLmZpZ3VyZXNbaW5kZXhdOwogICAgYXNzZXJ0KGZpZ3VyZS50eXBlID09PSBNZXNoRmlndXJlVHlwZS5QQVRDSCwgIlVuZXhwZWN0ZWQgcGF0Y2ggbWVzaCBmaWd1cmUiKTsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzLAogICAgICBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgIGNvbnN0IHBpID0gZmlndXJlLmNvb3JkczsKICAgIGNvbnN0IGNpID0gZmlndXJlLmNvbG9yczsKICAgIGNvbnN0IGZpZ3VyZU1pblggPSBNYXRoLm1pbihjb29yZHNbcGlbMF1dWzBdLCBjb29yZHNbcGlbM11dWzBdLCBjb29yZHNbcGlbMTJdXVswXSwgY29vcmRzW3BpWzE1XV1bMF0pOwogICAgY29uc3QgZmlndXJlTWluWSA9IE1hdGgubWluKGNvb3Jkc1twaVswXV1bMV0sIGNvb3Jkc1twaVszXV1bMV0sIGNvb3Jkc1twaVsxMl1dWzFdLCBjb29yZHNbcGlbMTVdXVsxXSk7CiAgICBjb25zdCBmaWd1cmVNYXhYID0gTWF0aC5tYXgoY29vcmRzW3BpWzBdXVswXSwgY29vcmRzW3BpWzNdXVswXSwgY29vcmRzW3BpWzEyXV1bMF0sIGNvb3Jkc1twaVsxNV1dWzBdKTsKICAgIGNvbnN0IGZpZ3VyZU1heFkgPSBNYXRoLm1heChjb29yZHNbcGlbMF1dWzFdLCBjb29yZHNbcGlbM11dWzFdLCBjb29yZHNbcGlbMTJdXVsxXSwgY29vcmRzW3BpWzE1XV1bMV0pOwogICAgbGV0IHNwbGl0WEJ5ID0gTWF0aC5jZWlsKChmaWd1cmVNYXhYIC0gZmlndXJlTWluWCkgKiBNZXNoU2hhZGluZy5UUklBTkdMRV9ERU5TSVRZIC8gKHRoaXMuYm91bmRzWzJdIC0gdGhpcy5ib3VuZHNbMF0pKTsKICAgIHNwbGl0WEJ5ID0gTWF0aENsYW1wKHNwbGl0WEJ5LCBNZXNoU2hhZGluZy5NSU5fU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCwgTWVzaFNoYWRpbmcuTUFYX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQpOwogICAgbGV0IHNwbGl0WUJ5ID0gTWF0aC5jZWlsKChmaWd1cmVNYXhZIC0gZmlndXJlTWluWSkgKiBNZXNoU2hhZGluZy5UUklBTkdMRV9ERU5TSVRZIC8gKHRoaXMuYm91bmRzWzNdIC0gdGhpcy5ib3VuZHNbMV0pKTsKICAgIHNwbGl0WUJ5ID0gTWF0aENsYW1wKHNwbGl0WUJ5LCBNZXNoU2hhZGluZy5NSU5fU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCwgTWVzaFNoYWRpbmcuTUFYX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQpOwogICAgY29uc3QgdmVydGljZXNQZXJSb3cgPSBzcGxpdFhCeSArIDE7CiAgICBjb25zdCBmaWd1cmVDb29yZHMgPSBuZXcgSW50MzJBcnJheSgoc3BsaXRZQnkgKyAxKSAqIHZlcnRpY2VzUGVyUm93KTsKICAgIGNvbnN0IGZpZ3VyZUNvbG9ycyA9IG5ldyBJbnQzMkFycmF5KChzcGxpdFlCeSArIDEpICogdmVydGljZXNQZXJSb3cpOwogICAgbGV0IGsgPSAwOwogICAgY29uc3QgY2wgPSBuZXcgVWludDhBcnJheSgzKSwKICAgICAgY3IgPSBuZXcgVWludDhBcnJheSgzKTsKICAgIGNvbnN0IGMwID0gY29sb3JzW2NpWzBdXSwKICAgICAgYzEgPSBjb2xvcnNbY2lbMV1dLAogICAgICBjMiA9IGNvbG9yc1tjaVsyXV0sCiAgICAgIGMzID0gY29sb3JzW2NpWzNdXTsKICAgIGNvbnN0IGJSb3cgPSBnZXRCKHNwbGl0WUJ5KSwKICAgICAgYkNvbCA9IGdldEIoc3BsaXRYQnkpOwogICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDw9IHNwbGl0WUJ5OyByb3crKykgewogICAgICBjbFswXSA9IChjMFswXSAqIChzcGxpdFlCeSAtIHJvdykgKyBjMlswXSAqIHJvdykgLyBzcGxpdFlCeSB8IDA7CiAgICAgIGNsWzFdID0gKGMwWzFdICogKHNwbGl0WUJ5IC0gcm93KSArIGMyWzFdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgY2xbMl0gPSAoYzBbMl0gKiAoc3BsaXRZQnkgLSByb3cpICsgYzJbMl0gKiByb3cpIC8gc3BsaXRZQnkgfCAwOwogICAgICBjclswXSA9IChjMVswXSAqIChzcGxpdFlCeSAtIHJvdykgKyBjM1swXSAqIHJvdykgLyBzcGxpdFlCeSB8IDA7CiAgICAgIGNyWzFdID0gKGMxWzFdICogKHNwbGl0WUJ5IC0gcm93KSArIGMzWzFdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgY3JbMl0gPSAoYzFbMl0gKiAoc3BsaXRZQnkgLSByb3cpICsgYzNbMl0gKiByb3cpIC8gc3BsaXRZQnkgfCAwOwogICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPD0gc3BsaXRYQnk7IGNvbCsrLCBrKyspIHsKICAgICAgICBpZiAoKHJvdyA9PT0gMCB8fCByb3cgPT09IHNwbGl0WUJ5KSAmJiAoY29sID09PSAwIHx8IGNvbCA9PT0gc3BsaXRYQnkpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IHggPSAwLAogICAgICAgICAgeSA9IDA7CiAgICAgICAgbGV0IHEgPSAwOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDM7IGkrKykgewogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gMzsgaisrLCBxKyspIHsKICAgICAgICAgICAgY29uc3QgbSA9IGJSb3dbcm93XVtpXSAqIGJDb2xbY29sXVtqXTsKICAgICAgICAgICAgeCArPSBjb29yZHNbcGlbcV1dWzBdICogbTsKICAgICAgICAgICAgeSArPSBjb29yZHNbcGlbcV1dWzFdICogbTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlndXJlQ29vcmRzW2tdID0gY29vcmRzLmxlbmd0aDsKICAgICAgICBjb29yZHMucHVzaChbeCwgeV0pOwogICAgICAgIGZpZ3VyZUNvbG9yc1trXSA9IGNvbG9ycy5sZW5ndGg7CiAgICAgICAgY29uc3QgbmV3Q29sb3IgPSBuZXcgVWludDhBcnJheSgzKTsKICAgICAgICBuZXdDb2xvclswXSA9IChjbFswXSAqIChzcGxpdFhCeSAtIGNvbCkgKyBjclswXSAqIGNvbCkgLyBzcGxpdFhCeSB8IDA7CiAgICAgICAgbmV3Q29sb3JbMV0gPSAoY2xbMV0gKiAoc3BsaXRYQnkgLSBjb2wpICsgY3JbMV0gKiBjb2wpIC8gc3BsaXRYQnkgfCAwOwogICAgICAgIG5ld0NvbG9yWzJdID0gKGNsWzJdICogKHNwbGl0WEJ5IC0gY29sKSArIGNyWzJdICogY29sKSAvIHNwbGl0WEJ5IHwgMDsKICAgICAgICBjb2xvcnMucHVzaChuZXdDb2xvcik7CiAgICAgIH0KICAgIH0KICAgIGZpZ3VyZUNvb3Jkc1swXSA9IHBpWzBdOwogICAgZmlndXJlQ29sb3JzWzBdID0gY2lbMF07CiAgICBmaWd1cmVDb29yZHNbc3BsaXRYQnldID0gcGlbM107CiAgICBmaWd1cmVDb2xvcnNbc3BsaXRYQnldID0gY2lbMV07CiAgICBmaWd1cmVDb29yZHNbdmVydGljZXNQZXJSb3cgKiBzcGxpdFlCeV0gPSBwaVsxMl07CiAgICBmaWd1cmVDb2xvcnNbdmVydGljZXNQZXJSb3cgKiBzcGxpdFlCeV0gPSBjaVsyXTsKICAgIGZpZ3VyZUNvb3Jkc1t2ZXJ0aWNlc1BlclJvdyAqIHNwbGl0WUJ5ICsgc3BsaXRYQnldID0gcGlbMTVdOwogICAgZmlndXJlQ29sb3JzW3ZlcnRpY2VzUGVyUm93ICogc3BsaXRZQnkgKyBzcGxpdFhCeV0gPSBjaVszXTsKICAgIHRoaXMuZmlndXJlc1tpbmRleF0gPSB7CiAgICAgIHR5cGU6IE1lc2hGaWd1cmVUeXBlLkxBVFRJQ0UsCiAgICAgIGNvb3JkczogZmlndXJlQ29vcmRzLAogICAgICBjb2xvcnM6IGZpZ3VyZUNvbG9ycywKICAgICAgdmVydGljZXNQZXJSb3cKICAgIH07CiAgfQogIF91cGRhdGVCb3VuZHMoKSB7CiAgICBsZXQgbWluWCA9IHRoaXMuY29vcmRzWzBdWzBdLAogICAgICBtaW5ZID0gdGhpcy5jb29yZHNbMF1bMV0sCiAgICAgIG1heFggPSBtaW5YLAogICAgICBtYXhZID0gbWluWTsKICAgIGZvciAobGV0IGkgPSAxLCBpaSA9IHRoaXMuY29vcmRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgeCA9IHRoaXMuY29vcmRzW2ldWzBdLAogICAgICAgIHkgPSB0aGlzLmNvb3Jkc1tpXVsxXTsKICAgICAgbWluWCA9IG1pblggPiB4ID8geCA6IG1pblg7CiAgICAgIG1pblkgPSBtaW5ZID4geSA/IHkgOiBtaW5ZOwogICAgICBtYXhYID0gbWF4WCA8IHggPyB4IDogbWF4WDsKICAgICAgbWF4WSA9IG1heFkgPCB5ID8geSA6IG1heFk7CiAgICB9CiAgICB0aGlzLmJvdW5kcyA9IFttaW5YLCBtaW5ZLCBtYXhYLCBtYXhZXTsKICB9CiAgX3BhY2tEYXRhKCkgewogICAgbGV0IGksIGlpLCBqLCBqajsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzOwogICAgY29uc3QgY29vcmRzUGFja2VkID0gbmV3IEZsb2F0MzJBcnJheShjb29yZHMubGVuZ3RoICogMik7CiAgICBmb3IgKGkgPSAwLCBqID0gMCwgaWkgPSBjb29yZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCB4eSA9IGNvb3Jkc1tpXTsKICAgICAgY29vcmRzUGFja2VkW2orK10gPSB4eVswXTsKICAgICAgY29vcmRzUGFja2VkW2orK10gPSB4eVsxXTsKICAgIH0KICAgIHRoaXMuY29vcmRzID0gY29vcmRzUGFja2VkOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBjb2xvcnNQYWNrZWQgPSBuZXcgVWludDhBcnJheShjb2xvcnMubGVuZ3RoICogMyk7CiAgICBmb3IgKGkgPSAwLCBqID0gMCwgaWkgPSBjb2xvcnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBjID0gY29sb3JzW2ldOwogICAgICBjb2xvcnNQYWNrZWRbaisrXSA9IGNbMF07CiAgICAgIGNvbG9yc1BhY2tlZFtqKytdID0gY1sxXTsKICAgICAgY29sb3JzUGFja2VkW2orK10gPSBjWzJdOwogICAgfQogICAgdGhpcy5jb2xvcnMgPSBjb2xvcnNQYWNrZWQ7CiAgICBjb25zdCBmaWd1cmVzID0gdGhpcy5maWd1cmVzOwogICAgZm9yIChpID0gMCwgaWkgPSBmaWd1cmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgZmlndXJlID0gZmlndXJlc1tpXSwKICAgICAgICBwcyA9IGZpZ3VyZS5jb29yZHMsCiAgICAgICAgY3MgPSBmaWd1cmUuY29sb3JzOwogICAgICBmb3IgKGogPSAwLCBqaiA9IHBzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICBwc1tqXSAqPSAyOwogICAgICAgIGNzW2pdICo9IDM7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0SVIoKSB7CiAgICBjb25zdCB7CiAgICAgIGJvdW5kcwogICAgfSA9IHRoaXM7CiAgICBpZiAoYm91bmRzWzJdIC0gYm91bmRzWzBdID09PSAwIHx8IGJvdW5kc1szXSAtIGJvdW5kc1sxXSA9PT0gMCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgTWVzaFNoYWRpbmcgYm91bmRzOiBbJHtib3VuZHN9XS5gKTsKICAgIH0KICAgIHJldHVybiBbIk1lc2giLCB0aGlzLnNoYWRpbmdUeXBlLCB0aGlzLmNvb3JkcywgdGhpcy5jb2xvcnMsIHRoaXMuZmlndXJlcywgYm91bmRzLCB0aGlzLmJib3gsIHRoaXMuYmFja2dyb3VuZF07CiAgfQp9CmNsYXNzIER1bW15U2hhZGluZyBleHRlbmRzIEJhc2VTaGFkaW5nIHsKICBnZXRJUigpIHsKICAgIHJldHVybiBbIkR1bW15Il07CiAgfQp9CmZ1bmN0aW9uIGdldFRpbGluZ1BhdHRlcm5JUihvcGVyYXRvckxpc3QsIGRpY3QsIGNvbG9yKSB7CiAgY29uc3QgbWF0cml4ID0gbG9va3VwTWF0cml4KGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpLCBJREVOVElUWV9NQVRSSVgpOwogIGNvbnN0IGJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGRpY3QuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgaWYgKCFiYm94IHx8IGJib3hbMl0gLSBiYm94WzBdID09PSAwIHx8IGJib3hbM10gLSBiYm94WzFdID09PSAwKSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZ2V0VGlsaW5nUGF0dGVybklSIC9CQm94IGFycmF5LmApOwogIH0KICBjb25zdCB4c3RlcCA9IGRpY3QuZ2V0KCJYU3RlcCIpOwogIGlmICh0eXBlb2YgeHN0ZXAgIT09ICJudW1iZXIiKSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZ2V0VGlsaW5nUGF0dGVybklSIC9YU3RlcCB2YWx1ZS5gKTsKICB9CiAgY29uc3QgeXN0ZXAgPSBkaWN0LmdldCgiWVN0ZXAiKTsKICBpZiAodHlwZW9mIHlzdGVwICE9PSAibnVtYmVyIikgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGdldFRpbGluZ1BhdHRlcm5JUiAvWVN0ZXAgdmFsdWUuYCk7CiAgfQogIGNvbnN0IHBhaW50VHlwZSA9IGRpY3QuZ2V0KCJQYWludFR5cGUiKTsKICBpZiAoIU51bWJlci5pc0ludGVnZXIocGFpbnRUeXBlKSkgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGdldFRpbGluZ1BhdHRlcm5JUiAvUGFpbnRUeXBlIHZhbHVlLmApOwogIH0KICBjb25zdCB0aWxpbmdUeXBlID0gZGljdC5nZXQoIlRpbGluZ1R5cGUiKTsKICBpZiAoIU51bWJlci5pc0ludGVnZXIodGlsaW5nVHlwZSkpIHsKICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBnZXRUaWxpbmdQYXR0ZXJuSVIgL1RpbGluZ1R5cGUgdmFsdWUuYCk7CiAgfQogIHJldHVybiBbIlRpbGluZ1BhdHRlcm4iLCBjb2xvciwgb3BlcmF0b3JMaXN0LCBtYXRyaXgsIGJib3gsIHhzdGVwLCB5c3RlcCwgcGFpbnRUeXBlLCB0aWxpbmdUeXBlXTsKfQoKOy8vIC4vc3JjL2NvcmUvY2FsaWJyaV9mYWN0b3JzLmpzCmNvbnN0IENhbGlicmlCb2xkRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDAuOTc4MDEsIDAuOTI0ODIsIDAuODk1NTIsIDAuOTExMzMsIDAuODE5ODgsIDAuOTc1NjYsIDAuOTgxNTIsIDAuOTM1NDgsIDAuOTM1NDgsIDEuMjc5OCwgMC44NTI4NCwgMC45Mjc5NCwgMSwgMC45NjEzNCwgMS41NDY1NywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC44Mjg0NSwgMC44Mjg0NSwgMC44NTI4NCwgMC44NTI4NCwgMC44NTI4NCwgMC43NTg1OSwgMC45MjEzOCwgMC44MzkwOCwgMC43NzYyLCAwLjczMjkzLCAwLjg3Mjg5LCAwLjczMTMzLCAwLjc1MTQsIDAuODE5MjEsIDAuODczNTYsIDAuOTU5NTgsIDAuNTk1MjYsIDAuNzU3MjcsIDAuNjkyMjUsIDEuMDQ5MjQsIDAuOTEyMSwgMC44Njk0MywgMC43OTc5NSwgMC44ODE5OCwgMC43Nzk1OCwgMC43MDg2NCwgMC44MTA1NSwgMC45MDM5OSwgMC44ODY1MywgMC45NjAxNywgMC44MjU3NywgMC43Nzg5MiwgMC43ODI1NywgMC45NzUwNywgMS41NDY1NywgMC45NzUwNywgMC44NTI4NCwgMC44OTU1MiwgMC45MDE3NiwgMC44ODc2MiwgMC44Nzg1LCAwLjc1MjQxLCAwLjg3ODUsIDAuOTA1MTgsIDAuOTUwMTUsIDAuNzc2MTgsIDAuODc4NSwgMC44ODQwMSwgMC45MTkxNiwgMC44NjMwNCwgMC44ODQwMSwgMC45MTQ4OCwgMC44Nzg1LCAwLjg4MDEsIDAuODc4NSwgMC44Nzg1LCAwLjkxMzQzLCAwLjcxNzMsIDEuMDQxMDYsIDAuODc4NSwgMC44NTA3NSwgMC45NTc5NCwgMC44MjYxNiwgMC44NTE2MiwgMC43OTQ5MiwgMC44ODMzMSwgMS42OTgwOCwgMC44ODMzMSwgMC44NTI4NCwgMC45NzgwMSwgMC44OTU1MiwgMC45MTEzMywgMC44OTU1MiwgMC45MTEzMywgMS43ODAxLCAwLjg5NTUyLCAxLjI0NDg3LCAxLjEzMjU0LCAxLjEyNDAxLCAwLjk2ODM5LCAwLjg1Mjg0LCAwLjY4Nzg3LCAwLjcwNjQ1LCAwLjg1NTkyLCAwLjkwNzQ3LCAxLjAxNDY2LCAxLjAwODgsIDAuOTAzMjMsIDEsIDEuMDc0NjMsIDEsIDAuOTEwNTYsIDAuNzU4MDYsIDEuMTkxMTgsIDAuOTY4MzksIDAuNzg4NjQsIDAuODI4NDUsIDAuODQxMzMsIDAuNzU4NTksIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuNzc1MzksIDAuNzMyOTMsIDAuNzMxMzMsIDAuNzMxMzMsIDAuNzMxMzMsIDAuNzMxMzMsIDAuOTU5NTgsIDAuOTU5NTgsIDAuOTU5NTgsIDAuOTU5NTgsIDAuODg1MDYsIDAuOTEyMSwgMC44Njk0MywgMC44Njk0MywgMC44Njk0MywgMC44Njk0MywgMC44Njk0MywgMC44NTI4NCwgMC44NzUwOCwgMC45MDM5OSwgMC45MDM5OSwgMC45MDM5OSwgMC45MDM5OSwgMC43Nzg5MiwgMC43OTc5NSwgMC45MDgwNywgMC44ODc2MiwgMC44ODc2MiwgMC44ODc2MiwgMC44ODc2MiwgMC44ODc2MiwgMC44ODc2MiwgMC44NzE1LCAwLjc1MjQxLCAwLjkwNTE4LCAwLjkwNTE4LCAwLjkwNTE4LCAwLjkwNTE4LCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg3ODUsIDAuODc4NSwgMC44ODAxLCAwLjg4MDEsIDAuODgwMSwgMC44ODAxLCAwLjg4MDEsIDAuOTA3NDcsIDAuODkwNDksIDAuODc4NSwgMC44Nzg1LCAwLjg3ODUsIDAuODc4NSwgMC44NTE2MiwgMC44Nzg1LCAwLjg1MTYyLCAwLjgzOTA4LCAwLjg4NzYyLCAwLjgzOTA4LCAwLjg4NzYyLCAwLjgzOTA4LCAwLjg4NzYyLCAwLjczMjkzLCAwLjc1MjQxLCAwLjczMjkzLCAwLjc1MjQxLCAwLjczMjkzLCAwLjc1MjQxLCAwLjczMjkzLCAwLjc1MjQxLCAwLjg3Mjg5LCAwLjgzMDE2LCAwLjg4NTA2LCAwLjkzMTI1LCAwLjczMTMzLCAwLjkwNTE4LCAwLjczMTMzLCAwLjkwNTE4LCAwLjczMTMzLCAwLjkwNTE4LCAwLjczMTMzLCAwLjkwNTE4LCAwLjczMTMzLCAwLjkwNTE4LCAwLjgxOTIxLCAwLjc3NjE4LCAwLjgxOTIxLCAwLjc3NjE4LCAwLjgxOTIxLCAwLjc3NjE4LCAxLCAxLCAwLjg3MzU2LCAwLjg3ODUsIDAuOTEwNzUsIDAuODk2MDgsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuNzYyMjksIDAuOTAxNjcsIDAuNTk1MjYsIDAuOTE5MTYsIDEsIDEsIDAuODYzMDQsIDAuNjkyMjUsIDAuODg0MDEsIDEsIDEsIDAuNzA0MjQsIDAuNzk0NjgsIDAuOTE5MjYsIDAuODgxNzUsIDAuNzA4MjMsIDAuOTQ5MDMsIDAuOTEyMSwgMC44Nzg1LCAxLCAxLCAwLjkxMjEsIDAuODc4NSwgMC44NzgwMiwgMC44ODY1NiwgMC44Nzg1LCAwLjg2OTQzLCAwLjg4MDEsIDAuODY5NDMsIDAuODgwMSwgMC44Njk0MywgMC44ODAxLCAwLjg3NDAyLCAwLjg5MjkxLCAwLjc3OTU4LCAwLjkxMzQzLCAxLCAxLCAwLjc3OTU4LCAwLjkxMzQzLCAwLjcwODY0LCAwLjcxNzMsIDAuNzA4NjQsIDAuNzE3MywgMC43MDg2NCwgMC43MTczLCAwLjcwODY0LCAwLjcxNzMsIDEsIDEsIDAuODEwNTUsIDAuNzU4NDEsIDAuODEwNTUsIDEuMDY0NTIsIDAuOTAzOTksIDAuODc4NSwgMC45MDM5OSwgMC44Nzg1LCAwLjkwMzk5LCAwLjg3ODUsIDAuOTAzOTksIDAuODc4NSwgMC45MDM5OSwgMC44Nzg1LCAwLjkwMzk5LCAwLjg3ODUsIDAuOTYwMTcsIDAuOTU3OTQsIDAuNzc4OTIsIDAuODUxNjIsIDAuNzc4OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuOTI5NywgMC41Njg5MiwgMC44MzkwOCwgMC44ODc2MiwgMC43NzUzOSwgMC44NzE1LCAwLjg3NTA4LCAwLjg5MDQ5LCAxLCAxLCAwLjgxMDU1LCAxLjA0MTA2LCAxLjIwNTI4LCAxLjIwNTI4LCAxLCAxLjE1NTQzLCAwLjcwNjc0LCAwLjk4Mzg3LCAwLjk0NzIxLCAxLjMzNDMxLCAxLjQ1ODk0LCAwLjk1MTYxLCAxLjA2MzAzLCAwLjgzOTA4LCAwLjgwMzUyLCAwLjU3MTg0LCAwLjY5NjUsIDAuNTYyODksIDAuODIwMDEsIDAuNTYwMjksIDAuODEyMzUsIDEuMDI5ODgsIDAuODM5MDgsIDAuNzc2MiwgMC42ODE1NiwgMC44MDM2NywgMC43MzEzMywgMC43ODI1NywgMC44NzM1NiwgMC44Njk0MywgMC45NTk1OCwgMC43NTcyNywgMC44OTAxOSwgMS4wNDkyNCwgMC45MTIxLCAwLjc2NDgsIDAuODY5NDMsIDAuODczNTYsIDAuNzk3OTUsIDAuNzgyNzUsIDAuODEwNTUsIDAuNzc4OTIsIDAuOTc2MiwgMC44MjU3NywgMC45OTgxOSwgMC44NDg5NiwgMC45NTk1OCwgMC43Nzg5MiwgMC45NjEwOCwgMS4wMTQwNywgMC44OTA0OSwgMS4wMjk4OCwgMC45NDIxMSwgMC45NjEwOCwgMC44OTM2LCAwLjg0MDIxLCAwLjg3ODQyLCAwLjk2Mzk5LCAwLjc5MTA5LCAwLjg5MDQ5LCAxLjAwODEzLCAxLjAyOTg4LCAwLjg2MDc3LCAwLjg3NDQ1LCAwLjkyMDk5LCAwLjg0NzIzLCAwLjg2NTEzLCAwLjg4MDEsIDAuNzU2MzgsIDAuODU3MTQsIDAuNzgyMTYsIDAuNzk1ODYsIDAuODc5NjUsIDAuOTQyMTEsIDAuOTc3NDcsIDAuNzgyODcsIDAuOTc5MjYsIDAuODQ5NzEsIDEuMDI5ODgsIDAuOTQyMTEsIDAuODgwMSwgMC45NDIxMSwgMC44NDk3MSwgMC43MzEzMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDI2NCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDUxOCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDU0OCwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NjAxNywgMC45NTc5NCwgMC45NjAxNywgMC45NTc5NCwgMC45NjAxNywgMC45NTc5NCwgMC43Nzg5MiwgMC44NTE2MiwgMSwgMSwgMC44OTU1MiwgMC45MDUyNywgMSwgMC45MDM2MywgMC45Mjc5NCwgMC45Mjc5NCwgMC45Mjc5NCwgMC45Mjc5NCwgMC44NzAxMiwgMC44NzAxMiwgMC44NzAxMiwgMC44OTU1MiwgMC44OTU1MiwgMS40MjI1OSwgMC43MTE0MywgMS4wNjE1MiwgMSwgMSwgMS4wMzM3MiwgMS4wMzM3MiwgMC45NzE3MSwgMS40OTU2LCAyLjI4MDcsIDAuOTM4MzUsIDAuODM0MDYsIDAuOTExMzMsIDAuODQxMDcsIDAuOTExMzMsIDEsIDEsIDEsIDAuNzIwMjEsIDEsIDEuMjMxMDgsIDAuODM0ODksIDAuODg1MjUsIDAuODg1MjUsIDAuODE0OTksIDAuOTA1MjcsIDEuODEwNTUsIDAuOTA1MjcsIDEuODEwNTUsIDEuMzEwMDYsIDEuNTM3MTEsIDAuOTQ0MzQsIDEuMDg2OTYsIDEsIDAuOTUwMTgsIDAuNzcxOTIsIDAuODUyODQsIDAuOTA3NDcsIDEuMTc1MzQsIDAuNjk4MjUsIDAuOTcxNiwgMS4zNzA3NywgMC45MDc0NywgMC45MDc0NywgMC44NTM1NiwgMC45MDc0NywgMC45MDc0NywgMS40NDk0NywgMC44NTI4NCwgMC44OTQxLCAwLjg5NDEsIDAuNzA1NzIsIDAuOCwgMC43MDU3MiwgMC43MDU3MiwgMC43MDU3MiwgMC43MDU3MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4wODAwNCwgMC45MTAyNywgMSwgMSwgMSwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDcyNywgMC45MDcyNywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IENhbGlicmlCb2xkTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07CmNvbnN0IENhbGlicmlCb2xkSXRhbGljRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDAuOTc4MDEsIDAuOTI0ODIsIDAuODk1NTIsIDAuOTExMzMsIDAuODE5ODgsIDAuOTc1NjYsIDAuOTgxNTIsIDAuOTM1NDgsIDAuOTM1NDgsIDEuMjc5OCwgMC44NTI4NCwgMC45Mjc5NCwgMSwgMC45NjEzNCwgMS41NjIzOSwgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC44Mjg0NSwgMC44Mjg0NSwgMC44NTI4NCwgMC44NTI4NCwgMC44NTI4NCwgMC43NTg1OSwgMC45MjEzOCwgMC44MzkwOCwgMC43NzYyLCAwLjcxODA1LCAwLjg3Mjg5LCAwLjczMTMzLCAwLjc1MTQsIDAuODE5MjEsIDAuODczNTYsIDAuOTU5NTgsIDAuNTk1MjYsIDAuNzU3MjcsIDAuNjkyMjUsIDEuMDQ5MjQsIDAuOTA4NzIsIDAuODU5MzgsIDAuNzk3OTUsIDAuODcwNjgsIDAuNzc5NTgsIDAuNjk3NjYsIDAuODEwNTUsIDAuOTAzOTksIDAuODg2NTMsIDAuOTYwNjgsIDAuODI1NzcsIDAuNzc4OTIsIDAuNzgyNTcsIDAuOTc1MDcsIDEuNTI5LCAwLjk3NTA3LCAwLjg1Mjg0LCAwLjg5NTUyLCAwLjkwMTc2LCAwLjk0OTA4LCAwLjg2NDExLCAwLjc0MDEyLCAwLjg2NDExLCAwLjg4MzIzLCAwLjk1MDE1LCAwLjg2NDExLCAwLjg2MzMxLCAwLjg4NDAxLCAwLjkxOTE2LCAwLjg2MzA0LCAwLjg4NDAxLCAwLjkwMzksIDAuODYzMzEsIDAuODYzMzEsIDAuODY0MTEsIDAuODY0MTEsIDAuOTA0NjQsIDAuNzA4NTIsIDEuMDQxMDYsIDAuODYzMzEsIDAuODQzNzIsIDAuOTU3OTQsIDAuODI2MTYsIDAuODQ1NDgsIDAuNzk0OTIsIDAuODgzMzEsIDEuNjk4MDgsIDAuODgzMzEsIDAuODUyODQsIDAuOTc4MDEsIDAuODk1NTIsIDAuOTExMzMsIDAuODk1NTIsIDAuOTExMzMsIDEuNzgwMSwgMC44OTU1MiwgMS4yNDQ4NywgMS4xMzI1NCwgMS4xOTEyOSwgMC45NjgzOSwgMC44NTI4NCwgMC42ODc4NywgMC43MDY0NSwgMC44NTU5MiwgMC45MDc0NywgMS4wMTQ2NiwgMS4wMDg4LCAwLjkwMzIzLCAxLCAxLjA3NDYzLCAxLCAwLjkxMDU2LCAwLjc1ODA2LCAxLjE5MTE4LCAwLjk2ODM5LCAwLjc4ODY0LCAwLjgyODQ1LCAwLjg0MTMzLCAwLjc1ODU5LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjc3NTM5LCAwLjcxODA1LCAwLjczMTMzLCAwLjczMTMzLCAwLjczMTMzLCAwLjczMTMzLCAwLjk1OTU4LCAwLjk1OTU4LCAwLjk1OTU4LCAwLjk1OTU4LCAwLjg4NTA2LCAwLjkwODcyLCAwLjg1OTM4LCAwLjg1OTM4LCAwLjg1OTM4LCAwLjg1OTM4LCAwLjg1OTM4LCAwLjg1Mjg0LCAwLjg3MDY4LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjc3ODkyLCAwLjc5Nzk1LCAwLjkwODA3LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjg1ODg3LCAwLjc0MDEyLCAwLjg4MzIzLCAwLjg4MzIzLCAwLjg4MzIzLCAwLjg4MzIzLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg3ODUsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuOTA3NDcsIDAuODkwNDksIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODQ1NDgsIDAuODY0MTEsIDAuODQ1NDgsIDAuODM5MDgsIDAuOTQ5MDgsIDAuODM5MDgsIDAuOTQ5MDgsIDAuODM5MDgsIDAuOTQ5MDgsIDAuNzE4MDUsIDAuNzQwMTIsIDAuNzE4MDUsIDAuNzQwMTIsIDAuNzE4MDUsIDAuNzQwMTIsIDAuNzE4MDUsIDAuNzQwMTIsIDAuODcyODksIDAuNzk1MzgsIDAuODg1MDYsIDAuOTI3MjYsIDAuNzMxMzMsIDAuODgzMjMsIDAuNzMxMzMsIDAuODgzMjMsIDAuNzMxMzMsIDAuODgzMjMsIDAuNzMxMzMsIDAuODgzMjMsIDAuNzMxMzMsIDAuODgzMjMsIDAuODE5MjEsIDAuODY0MTEsIDAuODE5MjEsIDAuODY0MTEsIDAuODE5MjEsIDAuODY0MTEsIDEsIDEsIDAuODczNTYsIDAuODYzMzEsIDAuOTEwNzUsIDAuODc3NywgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC43NjQ2NywgMC45MDE2NywgMC41OTUyNiwgMC45MTkxNiwgMSwgMSwgMC44NjMwNCwgMC42OTIyNSwgMC44ODQwMSwgMSwgMSwgMC43MDQyNCwgMC43NzMxMiwgMC45MTkyNiwgMC44ODE3NSwgMC43MDgyMywgMC45NDkwMywgMC45MDg3MiwgMC44NjMzMSwgMSwgMSwgMC45MDg3MiwgMC44NjMzMSwgMC44NjkwNiwgMC44ODExNiwgMC44NjMzMSwgMC44NTkzOCwgMC44NjMzMSwgMC44NTkzOCwgMC44NjMzMSwgMC44NTkzOCwgMC44NjMzMSwgMC44NzQwMiwgMC44NjU0OSwgMC43Nzk1OCwgMC45MDQ2NCwgMSwgMSwgMC43Nzk1OCwgMC45MDQ2NCwgMC42OTc2NiwgMC43MDg1MiwgMC42OTc2NiwgMC43MDg1MiwgMC42OTc2NiwgMC43MDg1MiwgMC42OTc2NiwgMC43MDg1MiwgMSwgMSwgMC44MTA1NSwgMC43NTg0MSwgMC44MTA1NSwgMS4wNjQ1MiwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45NjA2OCwgMC45NTc5NCwgMC43Nzg5MiwgMC44NDU0OCwgMC43Nzg5MiwgMC43ODI1NywgMC43OTQ5MiwgMC43ODI1NywgMC43OTQ5MiwgMC43ODI1NywgMC43OTQ5MiwgMC45Mjk3LCAwLjU2ODkyLCAwLjgzOTA4LCAwLjk0OTA4LCAwLjc3NTM5LCAwLjg1ODg3LCAwLjg3MDY4LCAwLjg5MDQ5LCAxLCAxLCAwLjgxMDU1LCAxLjA0MTA2LCAxLjIwNTI4LCAxLjIwNTI4LCAxLCAxLjE1NTQzLCAwLjcwMDg4LCAwLjk4Mzg3LCAwLjk0NzIxLCAxLjMzNDMxLCAxLjQ1ODk0LCAwLjk1MTYxLCAxLjQ4Mzg3LCAwLjgzOTA4LCAwLjgwMzUyLCAwLjU3MTE4LCAwLjY5NjUsIDAuNTYzNDcsIDAuNzkxNzksIDAuNTU4NTMsIDAuODAzNDYsIDEuMDI5ODgsIDAuODM5MDgsIDAuNzc2MiwgMC42NzE3NCwgMC44NjAzNiwgMC43MzEzMywgMC43ODI1NywgMC44NzM1NiwgMC44NjQ0MSwgMC45NTk1OCwgMC43NTcyNywgMC44OTAxOSwgMS4wNDkyNCwgMC45MDg3MiwgMC43NDg4OSwgMC44NTkzOCwgMC44Nzg5MSwgMC43OTc5NSwgMC43OTU3LCAwLjgxMDU1LCAwLjc3ODkyLCAwLjk3NDQ3LCAwLjgyNTc3LCAwLjk3NDY2LCAwLjg3MTc5LCAwLjk1OTU4LCAwLjc3ODkyLCAwLjk0MjUyLCAwLjk1NjEyLCAwLjg3NTMsIDEuMDI5ODgsIDAuOTI3MzMsIDAuOTQyNTIsIDAuODc0MTEsIDAuODQwMjEsIDAuODcyOCwgMC45NTYxMiwgMC43NDA4MSwgMC44NzUzLCAxLjAyMTg5LCAxLjAyOTg4LCAwLjg0ODE0LCAwLjg3NDQ1LCAwLjkxODIyLCAwLjg0NzIzLCAwLjg1NjY4LCAwLjg2MzMxLCAwLjgxMzQ0LCAwLjg3NTgxLCAwLjc2NDIyLCAwLjgyMDQ2LCAwLjk2MDU3LCAwLjkyNzMzLCAwLjk5Mzc1LCAwLjc4MDIyLCAwLjk1NDUyLCAwLjg2MDE1LCAxLjAyOTg4LCAwLjkyNzMzLCAwLjg2MzMxLCAwLjkyNzMzLCAwLjg2MDE1LCAwLjczMTMzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNjMxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg4MzIzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg1MTc0LCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk2MDY4LCAwLjk1Nzk0LCAwLjk2MDY4LCAwLjk1Nzk0LCAwLjk2MDY4LCAwLjk1Nzk0LCAwLjc3ODkyLCAwLjg0NTQ4LCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMzYzLCAwLjkyNzk0LCAwLjkyNzk0LCAwLjkyNzk0LCAwLjg5ODA3LCAwLjg3MDEyLCAwLjg3MDEyLCAwLjg3MDEyLCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjcxMDk0LCAxLjA2MTUyLCAxLCAxLCAxLjAzMzcyLCAxLjAzMzcyLCAwLjk3MTcxLCAxLjQ5NTYsIDIuMjgwNywgMC45Mjk3MiwgMC44MzQwNiwgMC45MTEzMywgMC44MzMyNiwgMC45MTEzMywgMSwgMSwgMSwgMC43MjAyMSwgMSwgMS4yMzEwOCwgMC44MzQ4OSwgMC44ODUyNSwgMC44ODUyNSwgMC44MTQ5OSwgMC45MDYxNiwgMS44MTA1NSwgMC45MDUyNywgMS44MTA1NSwgMS4zMTA3LCAxLjUzNzExLCAwLjk0NDM0LCAxLjA4Njk2LCAxLCAwLjk1MDE4LCAwLjc3MTkyLCAwLjg1Mjg0LCAwLjkwNzQ3LCAxLjE3NTM0LCAwLjY5ODI1LCAwLjk3MTYsIDEuMzcwNzcsIDAuOTA3NDcsIDAuOTA3NDcsIDAuODUzNTYsIDAuOTA3NDcsIDAuOTA3NDcsIDEuNDQ5NDcsIDAuODUyODQsIDAuODk0MSwgMC44OTQxLCAwLjcwNTcyLCAwLjgsIDAuNzA1NzIsIDAuNzA1NzIsIDAuNzA1NzIsIDAuNzA1NzIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMDgwMDQsIDAuOTEwMjcsIDEsIDEsIDEsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTA3MjcsIDAuOTA3MjcsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBDYWxpYnJpQm9sZEl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yMjA3LAogIGxpbmVHYXA6IDAuMjIwNwp9Owpjb25zdCBDYWxpYnJpSXRhbGljRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDEuMTcyMjMsIDEuMTI5MywgMC44OTU1MiwgMC45MTEzMywgMC44MDM5NSwgMS4wMjI2OSwgMS4xNTYwMSwgMC45MTA1NiwgMC45MTA1NiwgMS4yNzk4LCAwLjg1Mjg0LCAwLjg5ODA3LCAxLCAwLjkwODYxLCAxLjM5NTQzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjk2MzA5LCAwLjk2MzA5LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjgzMzE5LCAwLjg4MDcxLCAwLjg2NzUsIDAuODE1NTIsIDAuNzIzNDYsIDAuODUxOTMsIDAuNzMyMDYsIDAuNzUyMiwgMC44MTEwNSwgMC44NjI3NSwgMC45MDY4NSwgMC42Mzc3LCAwLjc3ODkyLCAwLjc1NTkzLCAxLjAyNjM4LCAwLjg5MjQ5LCAwLjg0MTE4LCAwLjc3NDUyLCAwLjg1Mzc0LCAwLjc1MTg2LCAwLjY3Nzg5LCAwLjc5Nzc2LCAwLjg4ODQ0LCAwLjg1MDY2LCAwLjk0MzA5LCAwLjc3ODE4LCAwLjczMDYsIDAuNzY2NTksIDEuMTAzNjksIDEuMzgzMTMsIDEuMTAzNjksIDEuMDYxMzksIDAuODk1NTIsIDAuODczOSwgMC45MjQ1LCAwLjkyNDUsIDAuODMyMDMsIDAuOTI0NSwgMC44NTg2NSwgMS4wOTg0MiwgMC45MjQ1LCAwLjkyNDUsIDEuMDMyOTcsIDEuMDc2OTIsIDAuOTA5MTgsIDEuMDMyOTcsIDAuOTQ5NTksIDAuOTI0NSwgMC45MjI3NCwgMC45MjQ1LCAwLjkyNDUsIDEuMDI5MzMsIDAuNzc4MzIsIDEuMjA1NjIsIDAuOTI0NSwgMC44OTE2LCAwLjk4OTg2LCAwLjg2NjIxLCAwLjg5NDUzLCAwLjc5MDA0LCAwLjk0MTUyLCAxLjc3MjU2LCAwLjk0MTUyLCAwLjg1Mjg0LCAwLjk3ODAxLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjg5NTUyLCAwLjkxMTMzLCAxLjkxNzI5LCAwLjg5NTUyLCAxLjE3ODg5LCAxLjEzMjU0LCAxLjE2MzU5LCAwLjkyMDk4LCAwLjg1Mjg0LCAwLjY4Nzg3LCAwLjcxMzUzLCAwLjg0NzM3LCAwLjkwNzQ3LCAxLjAwODgsIDEuMDA0NCwgMC44NzY4MywgMSwgMS4wOTA5MSwgMSwgMC45MjIyOSwgMC43MzksIDEuMTU2NDIsIDAuOTIwOTgsIDAuNzYyODgsIDAuODA1MDQsIDAuODA5NzIsIDAuNzU4NTksIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuNzYzMTgsIDAuNzIzNDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuOTA2ODUsIDAuOTA2ODUsIDAuOTA2ODUsIDAuOTA2ODUsIDAuODY0NzcsIDAuODkyNDksIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODUyODQsIDAuODQ1NTcsIDAuODg4NDQsIDAuODg4NDQsIDAuODg4NDQsIDAuODg4NDQsIDAuNzMwNiwgMC43NzQ1MiwgMC44NjMzMSwgMC45MjQ1LCAwLjkyNDUsIDAuOTI0NSwgMC45MjQ1LCAwLjkyNDUsIDAuOTI0NSwgMC44NDg0MywgMC44MzIwMywgMC44NTg2NSwgMC44NTg2NSwgMC44NTg2NSwgMC44NTg2NSwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC45NDQ2OSwgMC45MjQ1LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkwNzQ3LCAwLjg2NjUxLCAwLjkyNDUsIDAuOTI0NSwgMC45MjQ1LCAwLjkyNDUsIDAuODk0NTMsIDAuOTI0NSwgMC44OTQ1MywgMC44Njc1LCAwLjkyNDUsIDAuODY3NSwgMC45MjQ1LCAwLjg2NzUsIDAuOTI0NSwgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC44NTE5MywgMC44ODc1LCAwLjg2NDc3LCAwLjk5MDM0LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjgxMTA1LCAwLjkyNDUsIDAuODExMDUsIDAuOTI0NSwgMC44MTEwNSwgMC45MjQ1LCAxLCAxLCAwLjg2Mjc1LCAwLjkyNDUsIDAuOTA4NzIsIDAuOTM1OTEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDEuMDMyOTcsIDAuOTA2ODUsIDAuODI2MDEsIDAuNzc4OTYsIDEuMDU2MTEsIDAuNjM3NywgMS4wNzY5MiwgMSwgMSwgMC45MDkxOCwgMC43NTU5MywgMS4wMzI5NywgMSwgMSwgMC43NjAzMiwgMC45Mzc1LCAwLjk4MTU2LCAwLjkzNDA3LCAwLjc3MjYxLCAxLjExNDI5LCAwLjg5MjQ5LCAwLjkyNDUsIDEsIDEsIDAuODkyNDksIDAuOTI0NSwgMC45MjUzNCwgMC44NjY5OCwgMC45MjQ1LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg2NjcsIDAuODYyOTEsIDAuNzUxODYsIDEuMDI5MzMsIDEsIDEsIDAuNzUxODYsIDEuMDI5MzMsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDEsIDEsIDAuNzk3NzYsIDAuOTc2NTUsIDAuNzk3NzYsIDEuMjMwMjMsIDAuODg4NDQsIDAuOTI0NSwgMC44ODg0NCwgMC45MjQ1LCAwLjg4ODQ0LCAwLjkyNDUsIDAuODg4NDQsIDAuOTI0NSwgMC44ODg0NCwgMC45MjQ1LCAwLjg4ODQ0LCAwLjkyNDUsIDAuOTQzMDksIDAuOTg5ODYsIDAuNzMwNiwgMC44OTQ1MywgMC43MzA2LCAwLjc2NjU5LCAwLjc5MDA0LCAwLjc2NjU5LCAwLjc5MDA0LCAwLjc2NjU5LCAwLjc5MDA0LCAxLjA5MjMxLCAwLjU0ODczLCAwLjg2NzUsIDAuOTI0NSwgMC43NjMxOCwgMC44NDg0MywgMC44NDU1NywgMC44NjY1MSwgMSwgMSwgMC43OTc3NiwgMS4yMDU2MiwgMS4xODYyMiwgMS4xODYyMiwgMSwgMS4xNDM3LCAwLjY3MDA5LCAwLjk2MzM0LCAwLjkzNjk1LCAxLjM1MTkxLCAxLjQwOTA5LCAwLjk1MTYxLCAxLjQ4Mzg3LCAwLjg2NzUsIDAuOTA4NjEsIDAuNjE5MiwgMC43MzYzLCAwLjY0ODI0LCAwLjgyNDExLCAwLjU2MzIxLCAwLjg1Njk2LCAxLjIzNTE2LCAwLjg2NzUsIDAuODE1NTIsIDAuNzI4NiwgMC44NDEzNCwgMC43MzIwNiwgMC43NjY1OSwgMC44NjI3NSwgMC44NDM2OSwgMC45MDY4NSwgMC43Nzg5MiwgMC44NTg3MSwgMS4wMjYzOCwgMC44OTI0OSwgMC43NTgyOCwgMC44NDExOCwgMC44NTk4NCwgMC43NzQ1MiwgMC43NjQ2NiwgMC43OTc3NiwgMC43MzA2LCAwLjkwNzgyLCAwLjc3ODE4LCAwLjkwMywgMC44NzI5MSwgMC45MDY4NSwgMC43MzA2LCAwLjk5MDU4LCAxLjAzNjY3LCAwLjk0NjM1LCAxLjIzNTE2LCAwLjk4NDksIDAuOTkwNTgsIDAuOTIzOTMsIDAuODkxNiwgMC45NDIsIDEuMDM2NjcsIDAuNzUwMjYsIDAuOTQ2MzUsIDEuMDI5NywgMS4yMzUxNiwgMC45MDkxOCwgMC45NDA0OCwgMC45ODIxNywgMC44OTc0NiwgMC44NDE1MywgMC45MjI3NCwgMC44MjUwNywgMC44ODgzMiwgMC44NDQzOCwgMC44ODE3OCwgMS4wMzUyNSwgMC45ODQ5LCAxLjAwMjI1LCAwLjc4MDg2LCAwLjk3MjQ4LCAwLjg5NDA0LCAxLjIzNTE2LCAwLjk4NDksIDAuOTIyNzQsIDAuOTg0OSwgMC44OTQwNCwgMC43MzIwNiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44OTY5MywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44NTg2NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDkzMywgMSwgMSwgMSwgMSwgMSwgMSwgMC45NDMwOSwgMC45ODk4NiwgMC45NDMwOSwgMC45ODk4NiwgMC45NDMwOSwgMC45ODk4NiwgMC43MzA2LCAwLjg5NDUzLCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMTg2LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjI1NjYsIDEuMjU2NiwgMS4yNTY2LCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjY4OTk0LCAxLjAzODA5LCAxLCAxLCAxLjAxNzYsIDEuMDE3NiwgMS4xMTUyMywgMS40OTU2LCAyLjAxNDYyLCAwLjk3ODU4LCAwLjgyNjE2LCAwLjkxMTMzLCAwLjgzNDM3LCAwLjkxMTMzLCAxLCAxLCAxLCAwLjcwNTA4LCAxLCAxLjIzMTA4LCAwLjc5ODAxLCAwLjg0NDI2LCAwLjg0NDI2LCAwLjc3NCwgMC45MDU3MiwgMS44MTA1NSwgMC45MDc0OSwgMS44MTA1NSwgMS4yODgwOSwgMS41NTQ2OSwgMC45NDQzNCwgMS4wNzgwNiwgMSwgMC45NzA5NCwgMC43NTg5LCAwLjg1Mjg0LCAwLjkwNzQ3LCAxLjE5NjU4LCAwLjY5ODI1LCAwLjk3NjIyLCAxLjMzNTEyLCAwLjkwNzQ3LCAwLjkwNzQ3LCAwLjg1Mjg0LCAwLjkwNzQ3LCAwLjkwNzQ3LCAxLjQ0OTQ3LCAwLjg1Mjg0LCAwLjg5NDEsIDAuODk0MSwgMC43MDU3MiwgMC44LCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjAzMzYsIDAuOTEwMjcsIDEsIDEsIDEsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDU4NTksIDEuMDU4NTksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBDYWxpYnJpSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07CmNvbnN0IENhbGlicmlSZWd1bGFyRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDEuMTcyMjMsIDEuMTI5MywgMC44OTU1MiwgMC45MTEzMywgMC44MDM5NSwgMS4wMjI2OSwgMS4xNTYwMSwgMC45MTA1NiwgMC45MTA1NiwgMS4yNzk4LCAwLjg1Mjg0LCAwLjg5ODA3LCAxLCAwLjkwODYxLCAxLjM5MDE2LCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjk2MzA5LCAwLjk2MzA5LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjgzMzE5LCAwLjg4MDcxLCAwLjg2NzUsIDAuODE1NTIsIDAuNzM4MzQsIDAuODUxOTMsIDAuNzMyMDYsIDAuNzUyMiwgMC44MTEwNSwgMC44NjI3NSwgMC45MDY4NSwgMC42Mzc3LCAwLjc3ODkyLCAwLjc1NTkzLCAxLjAyNjM4LCAwLjg5Mzg1LCAwLjg1MTIyLCAwLjc3NDUyLCAwLjg2NTAzLCAwLjc1MTg2LCAwLjY4ODg3LCAwLjc5Nzc2LCAwLjg4ODQ0LCAwLjg1MDY2LCAwLjk0MjU4LCAwLjc3ODE4LCAwLjczMDYsIDAuNzY2NTksIDEuMTAzNjksIDEuMzkwMTYsIDEuMTAzNjksIDEuMDYxMzksIDAuODk1NTIsIDAuODczOSwgMC44NjEyOCwgMC45NDQ2OSwgMC44NDU3LCAwLjk0NDY5LCAwLjg5NDY0LCAxLjA5ODQyLCAwLjg0NjM2LCAwLjk0NDY5LCAxLjAzMjk3LCAxLjA3NjkyLCAwLjkwOTE4LCAxLjAzMjk3LCAwLjk1ODk3LCAwLjk0NDY5LCAwLjk0ODIsIDAuOTQ0NjksIDAuOTQ0NjksIDEuMDQ2OTIsIDAuNzgyMjMsIDEuMjA1NjIsIDAuOTQ0NjksIDAuOTAzMzIsIDAuOTg5ODYsIDAuODY2MjEsIDAuOTA1MjcsIDAuNzkwMDQsIDAuOTQxNTIsIDEuNzcyNTYsIDAuOTQxNTIsIDAuODUyODQsIDAuOTc4MDEsIDAuODk1NTIsIDAuOTExMzMsIDAuODk1NTIsIDAuOTExMzMsIDEuOTE3MjksIDAuODk1NTIsIDEuMTc4ODksIDEuMTMyNTQsIDEuMDg3MDcsIDAuOTIwOTgsIDAuODUyODQsIDAuNjg3ODcsIDAuNzEzNTMsIDAuODQ3MzcsIDAuOTA3NDcsIDEuMDA4OCwgMS4wMDQ0LCAwLjg3NjgzLCAxLCAxLjA5MDkxLCAxLCAwLjkyMjI5LCAwLjczOSwgMS4xNTY0MiwgMC45MjA5OCwgMC43NjI4OCwgMC44MDUwNCwgMC44MDk3MiwgMC43NTg1OSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC43NjMxOCwgMC43MzgzNCwgMC43MzIwNiwgMC43MzIwNiwgMC43MzIwNiwgMC43MzIwNiwgMC45MDY4NSwgMC45MDY4NSwgMC45MDY4NSwgMC45MDY4NSwgMC44NjQ3NywgMC44OTM4NSwgMC44NTEyMiwgMC44NTEyMiwgMC44NTEyMiwgMC44NTEyMiwgMC44NTEyMiwgMC44NTI4NCwgMC44NTMxMSwgMC44ODg0NCwgMC44ODg0NCwgMC44ODg0NCwgMC44ODg0NCwgMC43MzA2LCAwLjc3NDUyLCAwLjg2MzMxLCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2OTMsIDAuODQ1NywgMC44OTQ2NCwgMC44OTQ2NCwgMC44OTQ2NCwgMC44OTQ2NCwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC45NDQ2OSwgMC45NDQ2OSwgMC45NDgyLCAwLjk0ODIsIDAuOTQ4MiwgMC45NDgyLCAwLjk0ODIsIDAuOTA3NDcsIDAuODY2NTEsIDAuOTQ0NjksIDAuOTQ0NjksIDAuOTQ0NjksIDAuOTQ0NjksIDAuOTA1MjcsIDAuOTQ0NjksIDAuOTA1MjcsIDAuODY3NSwgMC44NjEyOCwgMC44Njc1LCAwLjg2MTI4LCAwLjg2NzUsIDAuODYxMjgsIDAuNzM4MzQsIDAuODQ1NywgMC43MzgzNCwgMC44NDU3LCAwLjczODM0LCAwLjg0NTcsIDAuNzM4MzQsIDAuODQ1NywgMC44NTE5MywgMC45MjQ1NCwgMC44NjQ3NywgMC45OTIxLCAwLjczMjA2LCAwLjg5NDY0LCAwLjczMjA2LCAwLjg5NDY0LCAwLjczMjA2LCAwLjg5NDY0LCAwLjczMjA2LCAwLjg5NDY0LCAwLjczMjA2LCAwLjg5NDY0LCAwLjgxMTA1LCAwLjg0NjM2LCAwLjgxMTA1LCAwLjg0NjM2LCAwLjgxMTA1LCAwLjg0NjM2LCAxLCAxLCAwLjg2Mjc1LCAwLjk0NDY5LCAwLjkwODcyLCAwLjk1Nzg2LCAwLjkwNjg1LCAwLjgyNjAxLCAwLjkwNjg1LCAwLjgyNjAxLCAwLjkwNjg1LCAwLjgyNjAxLCAwLjkwNjg1LCAxLjAzMjk3LCAwLjkwNjg1LCAwLjgyNjAxLCAwLjc3NzQxLCAxLjA1NjExLCAwLjYzNzcsIDEuMDc2OTIsIDEsIDEsIDAuOTA5MTgsIDAuNzU1OTMsIDEuMDMyOTcsIDEsIDEsIDAuNzYwMzIsIDAuOTA0NTIsIDAuOTgxNTYsIDEuMTE4NDIsIDAuNzcyNjEsIDEuMTE0MjksIDAuODkzODUsIDAuOTQ0NjksIDEsIDEsIDAuODkzODUsIDAuOTQ0NjksIDAuOTU4NzcsIDAuODY5MDEsIDAuOTQ0NjksIDAuODUxMjIsIDAuOTQ4MiwgMC44NTEyMiwgMC45NDgyLCAwLjg1MTIyLCAwLjk0ODIsIDAuODY2NywgMC45MDAxNiwgMC43NTE4NiwgMS4wNDY5MiwgMSwgMSwgMC43NTE4NiwgMS4wNDY5MiwgMC42ODg4NywgMC43ODIyMywgMC42ODg4NywgMC43ODIyMywgMC42ODg4NywgMC43ODIyMywgMC42ODg4NywgMC43ODIyMywgMSwgMSwgMC43OTc3NiwgMC45MjE4OCwgMC43OTc3NiwgMS4yMzAyMywgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC45NDI1OCwgMC45ODk4NiwgMC43MzA2LCAwLjkwNTI3LCAwLjczMDYsIDAuNzY2NTksIDAuNzkwMDQsIDAuNzY2NTksIDAuNzkwMDQsIDAuNzY2NTksIDAuNzkwMDQsIDEuMDkyMzEsIDAuNTQ4NzMsIDAuODY3NSwgMC44NjEyOCwgMC43NjMxOCwgMC44NjkzLCAwLjg1MzExLCAwLjg2NjUxLCAxLCAxLCAwLjc5Nzc2LCAxLjIwNTYyLCAxLjE4NjIyLCAxLjE4NjIyLCAxLCAxLjE0MzcsIDAuNjc3NDIsIDAuOTYzMzQsIDAuOTM2OTUsIDEuMzUxOTEsIDEuNDA5MDksIDAuOTUxNjEsIDEuNDgzODcsIDAuODY2ODYsIDAuOTA4NjEsIDAuNjIyNjcsIDAuNzQzNTksIDAuNjU2NDksIDAuODU0OTgsIDAuNTY5NjMsIDAuODgyNTQsIDEuMjM1MTYsIDAuODY3NSwgMC44MTU1MiwgMC43NTQ0MywgMC44NDUwMywgMC43MzIwNiwgMC43NjY1OSwgMC44NjI3NSwgMC44NTEyMiwgMC45MDY4NSwgMC43Nzg5MiwgMC44NTc0NiwgMS4wMjYzOCwgMC44OTM4NSwgMC43NTY1NywgMC44NTEyMiwgMC44NjI3NSwgMC43NzQ1MiwgMC43NDE3MSwgMC43OTc3NiwgMC43MzA2LCAwLjk1MTY1LCAwLjc3ODE4LCAwLjg5NzcyLCAwLjg4ODMxLCAwLjkwNjg1LCAwLjczMDYsIDAuOTgxNDIsIDEuMDIxOTEsIDAuOTY1NzYsIDEuMjM1MTYsIDAuOTkwMTgsIDAuOTgxNDIsIDAuOTIzNiwgMC44OTI1OCwgMC45NDAzNSwgMS4wMjE5MSwgMC43ODg0OCwgMC45NjU3NiwgMC45NTYxLCAxLjIzNTE2LCAwLjkwOTE4LCAwLjkyNTc4LCAwLjk1NDI0LCAwLjg5NzQ2LCAwLjgzOTY5LCAwLjk0ODIsIDAuODAxMTMsIDAuODk0NDIsIDAuODUyMDgsIDAuODYxNTUsIDAuOTgwMjIsIDAuOTkwMTgsIDEuMDA0NTIsIDAuODEyMDksIDAuOTkyNDcsIDAuODkxODEsIDEuMjM1MTYsIDAuOTkwMTgsIDAuOTQ4MiwgMC45OTAxOCwgMC44OTE4MSwgMC43MzIwNiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44ODg0NCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44OTQ2NCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45Njc2NiwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NDI1OCwgMC45ODk4NiwgMC45NDI1OCwgMC45ODk4NiwgMC45NDI1OCwgMC45ODk4NiwgMC43MzA2LCAwLjkwNTI3LCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMTg2LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjI1NjYsIDEuMjU2NiwgMS4yNTY2LCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjY5MDQzLCAxLjAzODA5LCAxLCAxLCAxLjAxNzYsIDEuMDE3NiwgMS4xMTUyMywgMS40OTU2LCAyLjAxNDYyLCAwLjk5MzMxLCAwLjgyNjE2LCAwLjkxMTMzLCAwLjg0Mjg2LCAwLjkxMTMzLCAxLCAxLCAxLCAwLjcwNTA4LCAxLCAxLjIzMTA4LCAwLjc5ODAxLCAwLjg0NDI2LCAwLjg0NDI2LCAwLjc3NCwgMC45MDUyNywgMS44MTA1NSwgMC45MDUyNywgMS44MTA1NSwgMS4yODgwOSwgMS41NTQ2OSwgMC45NDQzNCwgMS4wNzgwNiwgMSwgMC45NzA5NCwgMC43NTg5LCAwLjg1Mjg0LCAwLjkwNzQ3LCAxLjE5NjU4LCAwLjY5ODI1LCAwLjk3NjIyLCAxLjMzNTEyLCAwLjkwNzQ3LCAwLjkwNzQ3LCAwLjg1MzU2LCAwLjkwNzQ3LCAwLjkwNzQ3LCAxLjQ0OTQ3LCAwLjg1Mjg0LCAwLjg5NDEsIDAuODk0MSwgMC43MDU3MiwgMC44LCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjAzMzYsIDAuOTEwMjcsIDEsIDEsIDEsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDU4NTksIDEuMDU4NTksIDEsIDEsIDEsIDEuMDcxODUsIDAuOTk0MTMsIDAuOTYzMzQsIDEuMDgwNjUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBDYWxpYnJpUmVndWxhck1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yMjA3LAogIGxpbmVHYXA6IDAuMjIwNwp9OwoKOy8vIC4vc3JjL2NvcmUvaGVsdmV0aWNhX2ZhY3RvcnMuanMKY29uc3QgSGVsdmV0aWNhQm9sZEZhY3RvcnMgPSBbMC43NjExNiwgMSwgMSwgMS4wMDA2LCAwLjk5OTk4LCAwLjk5OTc0LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAwLjk5OTc3LCAxLjAwMDg3LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTU5LCAxLjAwMDAzLCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTk4LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDI2LCAwLjk5OTksIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3NywgMS4wMDAyNiwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAwMSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAxNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk5OCwgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTk4LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTgyLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTU5LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTU5LCAxLjAwMDc3LCAwLjk5OTU5LCAxLjAwMDAzLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDc3LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI1LCAwLjk5OTY4LCAwLjk5OTczLCAxLjAwMDAzLCAxLjAwMDI1LCAwLjYwMjk5LCAxLjAwMDI0LCAxLjA2NDA5LCAxLCAxLCAwLjk5OTk4LCAxLCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjA2NDA5LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAxLjAzMzc0LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNDIsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDM4MjgsIDEuMDAwMjYsIDAuOTk5OTksIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTkzLCAwLjk5OTgsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEsIDEuMDAwMTYsIDAuOTk5NzcsIDAuOTk5NTksIDAuOTk5NzcsIDAuOTk5NTksIDAuOTk5NzcsIDAuOTk5NTksIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5OTgsIDEuMDAwMjYsIDAuODEyMSwgMS4wMDAyNiwgMC45OTk5OCwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMS4wMDAyNiwgMSwgMS4wMDAyNiwgMSwgMS4wMDAyNiwgMSwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLCAwLjk5OTgyLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAxLjAwMDM0LCAwLjk5OTc3LCAxLCAwLjk5OTk3LCAxLjAwMDI2LCAxLjAwMDc4LCAxLjAwMDM2LCAwLjk5OTczLCAxLjAwMDEzLCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5ODgsIDAuODUxNDgsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwNiwgMC45OTk3NywgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk3NywgMS4wMDA2OSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMC45OTk4NCwgMS4wMDAyNiwgMS4wMDAwMSwgMS4wMDAyNCwgMS4wMDAwMSwgMC45OTk5LCAxLCAxLjAwMDYsIDEuMDAwMDEsIDEuMDAwNDEsIDAuOTk5NjIsIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk5NSwgMS4wMDA0MSwgMC45OTk0MiwgMC45OTk3MywgMC45OTkyNywgMS4wMDA4MiwgMC45OTkwMiwgMS4wMDAyNiwgMS4wMDA4NywgMS4wMDA2LCAxLjAwMDY5LCAwLjk5OTczLCAwLjk5ODY3LCAwLjk5OTczLCAwLjk5OTMsIDEuMDAwMjYsIDEuMDAwNDksIDEuMDAwNTYsIDEsIDAuOTk5ODgsIDAuOTk5MzUsIDAuOTk5OTUsIDAuOTk5NTQsIDEuMDAwNTUsIDAuOTk5NDUsIDEuMDAwMzIsIDEuMDAwNiwgMC45OTk5NSwgMS4wMDAyNiwgMC45OTk5NSwgMS4wMDAzMiwgMS4wMDAwMSwgMS4wMDAwOCwgMC45OTk3MSwgMS4wMDAxOSwgMC45OTk0LCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNDQsIDAuOTk5NzMsIDEuMDAwMjMsIDEuMDAwNDcsIDEsIDAuOTk5NDIsIDAuOTk1NjEsIDAuOTk5ODksIDEuMDAwMzUsIDAuOTk5NzcsIDEuMDAwMzUsIDAuOTk5NzcsIDEuMDAwMTksIDAuOTk5NDQsIDEuMDAwMDEsIDEuMDAwMjEsIDAuOTk5MjYsIDEuMDAwMzUsIDEuMDAwMzUsIDAuOTk5NDIsIDEuMDAwNDgsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMzUsIDEuMDAwMDEsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5ODksIDEuMDAwNTcsIDEuMDAwMDEsIDAuOTk5MzYsIDEuMDAwNTIsIDEuMDAwMTIsIDAuOTk5OTYsIDEuMDAwNDMsIDEsIDEuMDAwMzUsIDAuOTk5NCwgMC45OTk3NiwgMS4wMDAzNSwgMC45OTk3MywgMS4wMDA1MiwgMS4wMDA0MSwgMS4wMDExOSwgMS4wMDAzNywgMC45OTk3MywgMS4wMDAwMiwgMC45OTk4NiwgMS4wMDA0MSwgMS4wMDA0MSwgMC45OTkwMiwgMC45OTk2LCAxLjAwMDM0LCAwLjk5OTk5LCAxLjAwMDI2LCAwLjk5OTk5LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDUyLCAwLjk5OTczLCAxLCAwLjk5OTczLCAxLjAwMDQxLCAxLjAwMDc1LCAwLjk5OTQsIDEuMDAwMywgMC45OTk5OSwgMSwgMS4wMDA0MSwgMC45OTk1NSwgMSwgMC45OTkxNSwgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMS4wMDExOSwgMC45OTk1NSwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTExLCAxLjAwMDYsIDEuMDAwMjYsIDAuOTk5NzIsIDEuMDAwMjYsIDAuOTk5MDIsIDEuMDAwNDEsIDAuOTk5NzMsIDAuOTk5OTksIDEsIDEsIDEuMDAwMzgsIDEuMDAwNSwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMSwgMSwgMC45OTk3MywgMSwgMSwgMC45OTk1NSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTcyLCAxLCAxLCAxLjAwMTA2LCAwLjk5OTk5LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk5LCAwLjk5OTk4LCAxLjY2NDc1LCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDIzLCAwLjk5OTczLCAwLjk5OTcxLCAxLjAwMDQ3LCAxLjAwMDIzLCAxLCAwLjk5OTkxLCAwLjk5OTg0LCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5OTcyLCAxLCAxLjIwOTg1LCAxLjM5NzEzLCAxLjAwMDAzLCAxLjAwMDMxLCAxLjAwMDE1LCAxLCAwLjk5NTYxLCAxLjAwMDI3LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTE1LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTk5LCAxLjAwMDAzLCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQxMTQ0LCAxLjYsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDA1NzksIDEuNDA1NzksIDEuMzY2MjUsIDAuOTk5OTksIDEsIDAuOTk4NjEsIDAuOTk4NjEsIDEsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NzIsIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDEuNDA0ODMsIDEsIDAuOTk5NzcsIDEuMDAwNTQsIDEsIDEsIDAuOTk5NTMsIDAuOTk5NjIsIDEuMDAwNDIsIDAuOTk5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IEhlbHZldGljYUJvbGRNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMiwKICBsaW5lR2FwOiAwLjIKfTsKY29uc3QgSGVsdmV0aWNhQm9sZEl0YWxpY0ZhY3RvcnMgPSBbMC43NjExNiwgMSwgMSwgMS4wMDA2LCAwLjk5OTk4LCAwLjk5OTc0LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAwLjk5OTc3LCAxLjAwMDg3LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTU5LCAxLjAwMDAzLCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTk4LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDI2LCAwLjk5OTksIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3NywgMS4wMDAyNiwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAwMSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAxNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk5OCwgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTk4LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTgyLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTU5LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTU5LCAxLjAwMDc3LCAwLjk5OTU5LCAxLjAwMDAzLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDc3LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI1LCAwLjk5OTY4LCAwLjk5OTczLCAxLjAwMDAzLCAxLjAwMDI1LCAwLjYwMjk5LCAxLjAwMDI0LCAxLjA2NDA5LCAxLCAxLCAwLjk5OTk4LCAxLCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjA2NDA5LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAxLjAwNDQsIDAuOTk5NzcsIDEuMDAwMjYsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MSwgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDAyNiwgMS4wMTAxMSwgMS4wMDAyNiwgMC45OTk5OSwgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTMsIDAuOTk5OCwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMSwgMS4wMDAxNiwgMC45OTk3NywgMC45OTk1OSwgMC45OTk3NywgMC45OTk1OSwgMC45OTk3NywgMC45OTk1OSwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk5OCwgMS4wMDAyNiwgMC44MTIxLCAxLjAwMDI2LCAwLjk5OTk4LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEsIDAuOTk5ODIsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NzcsIDEsIDEsIDEuMDAwMjYsIDAuOTk5NjksIDAuOTk5NzIsIDAuOTk5ODEsIDAuOTk5OCwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDIyLCAwLjkxMTU1LCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDYsIDAuOTk5NzcsIDEuMDAwMDEsIDAuOTk5OTksIDAuOTk5NzcsIDAuOTk5NjYsIDEuMDAwMjIsIDEuMDAwMzIsIDEuMDAwMDEsIDAuOTk5NDQsIDEuMDAwMjYsIDEuMDAwMDEsIDAuOTk5NjgsIDEuMDAwMDEsIDEuMDAwNDcsIDEsIDEuMDAwNiwgMS4wMDAwMSwgMC45OTk4MSwgMS4wMDEwMSwgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTQ4LCAwLjk5OTgxLCAxLjAwMDY0LCAwLjk5OTczLCAwLjk5OTQyLCAxLjAwMTAxLCAxLjAwMDYxLCAxLjAwMDI2LCAxLjAwMDY5LCAxLjAwMDYsIDEuMDAwMTQsIDAuOTk5NzMsIDEuMDEzMjIsIDAuOTk5NzMsIDEuMDAwNjUsIDEuMDAwMjYsIDEuMDAwMTIsIDAuOTk5MjMsIDEsIDEuMDAwNjQsIDEuMDAwNzYsIDAuOTk5NDgsIDEuMDAwNTUsIDEuMDAwNjMsIDEuMDAwMDcsIDAuOTk5NDMsIDEuMDAwNiwgMC45OTk0OCwgMS4wMDAyNiwgMC45OTk0OCwgMC45OTk0MywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyOSwgMS4wMDAzOCwgMS4wMDAzNSwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzgsIDEuMDAwMDEsIDEuMDAwNTcsIDAuOTk5ODksIDAuOTk5NjcsIDAuOTk5NjQsIDAuOTk5NjcsIDAuOTk5NzcsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMzgsIDAuOTk5NzcsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwNjYsIDAuOTk5NjcsIDAuOTk5NjcsIDEuMDAwNDEsIDAuOTk5OTgsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDAuOTk5NjcsIDEuMDAwMDEsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NjQsIDEuMDAwMzEsIDEuMDAwMDEsIDAuOTk5OTksIDAuOTk5OTksIDEsIDEuMDAwMjMsIDEsIDEsIDAuOTk5OTksIDEuMDAwMzUsIDEuMDAwMDEsIDAuOTk5OTksIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5OTksIDEuMDAwNTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NTUsIDAuOTk5NSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAzMiwgMC45OTk4OSwgMS4wMDAzNCwgMC45OTk5OSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMC45OTk3MywgMC40NTk5OCwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk4MiwgMC45OTk5NCwgMC45OTk5NiwgMSwgMS4wMDA0MiwgMS4wMDA0NCwgMS4wMDAyOSwgMS4wMDAyMywgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMC45OTk0OSwgMS4wMDAwMiwgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAzMiwgMC45ODY4NSwgMC45OTk3MywgMS4wMDAyNiwgMSwgMSwgMC45OTk2NiwgMS4wMDA0NCwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMSwgMSwgMC45OTk3MywgMSwgMSwgMC45OTk1NSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTcyLCAxLCAxLCAxLjAwMTA2LCAwLjk5OTk5LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk5LCAwLjk5OTk4LCAxLjY2NDc1LCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTczLCAwLjk5OTcxLCAwLjk5OTc4LCAxLCAxLCAwLjk5OTkxLCAwLjk5OTg0LCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDk4LCAxLCAxLCAxLCAxLjAwMDQ5LCAxLCAxLCAwLjk5OTcyLCAxLCAxLjIwOTg1LCAxLjM5NzEzLCAxLjAwMDAzLCAxLjAwMDMxLCAxLjAwMDE1LCAxLCAwLjk5NTYxLCAxLjAwMDI3LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTE1LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTk5LCAxLjAwMDAzLCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQxMTQ0LCAxLjYsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDA1NzksIDEuNDA1NzksIDEuMzY2MjUsIDAuOTk5OTksIDEsIDAuOTk4NjEsIDAuOTk4NjEsIDEsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NzIsIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDEuNDA0ODMsIDEsIDAuOTk5NzcsIDEuMDAwNTQsIDEsIDEsIDAuOTk5NTMsIDAuOTk5NjIsIDEuMDAwNDIsIDAuOTk5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IEhlbHZldGljYUJvbGRJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMzUsCiAgbGluZUdhcDogMC4yCn07CmNvbnN0IEhlbHZldGljYUl0YWxpY0ZhY3RvcnMgPSBbMC43NjExNiwgMSwgMSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5ODIsIDEuMDAwMDEsIDEuMDAwNDMsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NTksIDEuMDAwMDMsIDEuMDAwNiwgMC45OTk5OCwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMSwgMS4wMDAwMywgMS4wMDAwMywgMS4wMDAwMywgMC45OTk3MywgMC45OTk4NywgMS4wMDAwMSwgMS4wMDAwMSwgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDA2LCAxLCAxLjAwMDAxLCAwLjk5OTczLCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDAxLCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDE2LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTQ5LCAwLjk5OTczLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5MjQsIDEsIDAuOTk5MjQsIDAuOTk5OTksIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5OTgsIDEsIDEuMDAwNiwgMC45OTk3MywgMSwgMC45OTk3NywgMSwgMSwgMSwgMS4wMDAwNSwgMS4wMDA5LCAxLjAwMDA1LCAxLjAwMDAzLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDksIDAuOTk5NzMsIDAuOTk5OTgsIDEuMDAwMjUsIDAuOTk5NjgsIDAuOTk5NzMsIDEuMDAwMDMsIDEuMDAwMjUsIDAuNjAyOTksIDEuMDAwMjQsIDEuMDY0MDksIDEsIDEsIDAuOTk5OTgsIDEsIDAuOTk5OCwgMS4wMDA2LCAwLjk5OTk4LCAxLCAwLjk5OTM2LCAwLjk5OTczLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDI2LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMDMsIDEuMDAwMjIsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5ODIsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wNjQwOSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMSwgMC45OTk3MywgMSwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMC45OTk3NywgMSwgMC45OTk3NywgMSwgMC45OTk3NywgMSwgMC45OTk3NywgMSwgMC45OTk3NywgMS4wMjg4LCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5MjQsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTQ2LCAxLjAwMDM0LCAxLCAwLjk5OTI0LCAxLjAwMDAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTczLCAxLjA2MzExLCAwLjk5OTczLCAxLjAwMDI0LCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDQxLCAwLjk5OTgsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEsIDEuMDAwMTYsIDAuOTk5NzcsIDAuOTk5OTgsIDAuOTk5NzcsIDAuOTk5OTgsIDAuOTk5NzcsIDAuOTk5OTgsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDAyNiwgMC44OTU0NywgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLCAxLjAwMDAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAwLjk5OTI0LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLCAwLjk5OTgyLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDAxLCAxLCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDEuMDAwMDEsIDEsIDEuMDAwNTQsIDAuOTk5NzcsIDEuMDAwODQsIDEuMDAwMDcsIDAuOTk5NzMsIDEuMDAwMTMsIDAuOTk5MjQsIDEuMDAwMDEsIDEuMDAwMDEsIDAuOTk5NDUsIDAuOTEyMjEsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwNiwgMS4wMDAwMSwgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk3NywgMC45OTkzMywgMS4wMDAyMiwgMS4wMDA1NCwgMS4wMDAwMSwgMS4wMDA2NSwgMS4wMDAyNiwgMS4wMDAwMSwgMS4wMDAxLCAxLjAwMDAxLCAxLjAwMDUyLCAxLCAxLjAwMDYsIDEuMDAwMDEsIDAuOTk5NDUsIDAuOTk4OTcsIDAuOTk5NjgsIDAuOTk5MjQsIDEuMDAwMzYsIDAuOTk5NDUsIDAuOTk5NDksIDEsIDEuMDAwNiwgMC45OTg5NywgMC45OTkxOCwgMC45OTk2OCwgMC45OTkxMSwgMC45OTkyNCwgMSwgMC45OTk2MiwgMS4wMTQ4NywgMSwgMS4wMDA1LCAwLjk5OTczLCAxLjAwMDEyLCAxLjAwMDQzLCAxLCAwLjk5OTk1LCAwLjk5OTk0LCAxLjAwMDM2LCAwLjk5OTQ3LCAxLjAwMDE5LCAxLjAwMDYzLCAxLjAwMDI1LCAwLjk5OTI0LCAxLjAwMDM2LCAwLjk5OTczLCAxLjAwMDM2LCAxLjAwMDI1LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI3LCAxLjAwMDEsIDEuMDAwNjgsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLCAxLjAwMDA4LCAwLjk5OTU3LCAwLjk5OTcyLCAwLjk5OTQsIDAuOTk5NTQsIDAuOTk5NzUsIDEuMDAwNTEsIDEuMDAwMDEsIDEuMDAwMTksIDEuMDAwMDEsIDEuMDAwMSwgMC45OTk4NiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAzOCwgMC45OTk1NCwgMC45OTk1NCwgMC45OTk0LCAxLjAwMDY2LCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDU0LCAxLjAwMDAxLCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc1LCAxLjAwMDEsIDEuMDAwMDEsIDAuOTk5OTMsIDAuOTk5NSwgMC45OTk1NSwgMS4wMDAxNiwgMC45OTk3OCwgMC45OTk3NCwgMS4wMDAxOSwgMS4wMDAyMiwgMC45OTk1NSwgMS4wMDA1MywgMC45OTk3MywgMS4wMDA4OSwgMS4wMDAwNSwgMC45OTk2NywgMS4wMDA0OCwgMC45OTk3MywgMS4wMDAwMiwgMS4wMDAzNCwgMC45OTk3MywgMC45OTk3MywgMC45OTk2NCwgMS4wMDAwNiwgMS4wMDA2NiwgMC45OTk0NywgMC45OTk3MywgMC45ODg5NCwgMC45OTk3MywgMSwgMC40NDg5OCwgMSwgMC45OTk0NiwgMSwgMS4wMDAzOSwgMS4wMDA4MiwgMC45OTk5MSwgMC45OTk5MSwgMC45OTk4NSwgMS4wMDAyMiwgMS4wMDAyMywgMS4wMDA2MSwgMS4wMDAwNiwgMC45OTk2NiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDAxOSwgMS4wMDA4LCAxLCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTgzLCAxLjAwMDQ0LCAwLjk5OTczLCAwLjk5OTY0LCAwLjk4MzMyLCAxLCAwLjk5OTczLCAxLCAxLCAwLjk5OTYyLCAwLjk5ODk1LCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLCAxLCAxLCAwLjk5OTczLCAxLCAxLCAwLjk5OTU1LCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTcyLCAxLCAxLCAxLjAwMjY3LCAwLjk5OTk5LCAwLjk5OTk4LCAwLjk5OTk4LCAxLCAwLjk5OTk4LCAxLjY2NDc1LCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDIzLCAwLjk5OTczLCAxLjAwNDIzLCAwLjk5OTI1LCAwLjk5OTk5LCAxLCAwLjk5OTkxLCAwLjk5OTg0LCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDQ5LCAxLCAxLjAwMjQ1LCAxLCAxLCAxLCAxLCAwLjk2MzI5LCAxLCAxLjIwOTg1LCAxLjM5NzEzLCAxLjAwMDAzLCAwLjgyNTQsIDEuMDAwMTUsIDEsIDEuMDAwMzUsIDEuMDAwMjcsIDEuMDAwMzEsIDEuMDAwMzEsIDEuMDAwMDMsIDEuMDAwMzEsIDEuMDAwMzEsIDAuOTk5OTksIDEuMDAwMDMsIDAuOTk5OTksIDAuOTk5OTksIDEuNDExNDQsIDEuNiwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MDU3OSwgMS40MDU3OSwgMS4zNjYyNSwgMC45OTk5OSwgMSwgMC45OTg2MSwgMC45OTg2MSwgMSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMC45NTMxNywgMC45OTk5OSwgMC45OTk5OSwgMC45OTk5OSwgMC45OTk5OSwgMS40MDQ4MywgMSwgMC45OTk3NywgMS4wMDA1NCwgMSwgMSwgMC45OTk1MywgMC45OTk2MiwgMS4wMDA0MiwgMC45OTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgSGVsdmV0aWNhSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjM1LAogIGxpbmVHYXA6IDAuMgp9Owpjb25zdCBIZWx2ZXRpY2FSZWd1bGFyRmFjdG9ycyA9IFswLjc2MTE2LCAxLCAxLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMS4wMDAwMSwgMS4wMDA0MywgMC45OTk5OCwgMC45OTk5OCwgMC45OTk1OSwgMS4wMDAwMywgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTg3LCAxLjAwMDAxLCAxLjAwMDAxLCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDYsIDEsIDEuMDAwMDEsIDAuOTk5NzMsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMDEsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMTYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NDksIDAuOTk5NzMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTkyNCwgMC45OTkyNCwgMSwgMC45OTkyNCwgMC45OTk5OSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk5OCwgMSwgMS4wMDA2LCAwLjk5OTczLCAxLCAwLjk5OTc3LCAxLCAxLCAxLCAxLjAwMDA1LCAxLjAwMDksIDEuMDAwMDUsIDEuMDAwMDMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwOSwgMC45OTk3MywgMC45OTk5OCwgMS4wMDAyNSwgMC45OTk2OCwgMC45OTk3MywgMS4wMDAwMywgMS4wMDAyNSwgMC42MDI5OSwgMS4wMDAyNCwgMS4wNjQwOSwgMSwgMSwgMC45OTk5OCwgMSwgMC45OTk4LCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjA2NDA5LCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTczLCAxLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLjA0NTk2LCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5MjQsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDE5LCAxLjAwMDM0LCAxLCAwLjk5OTI0LCAxLjAwMDAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTczLCAxLjAyNTcyLCAwLjk5OTczLCAxLjAwMDA1LCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTk5LCAwLjk5OTgsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEsIDEuMDAwMTYsIDAuOTk5NzcsIDAuOTk5OTgsIDAuOTk5NzcsIDAuOTk5OTgsIDAuOTk5NzcsIDAuOTk5OTgsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDAyNiwgMC44NDUzMywgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLCAxLjAwMDAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAwLjk5OTI0LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLCAwLjk5OTgyLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDAxLCAxLCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5MjgsIDEsIDAuOTk5NzcsIDEuMDAwMTMsIDEuMDAwNTUsIDAuOTk5NDcsIDAuOTk5NDUsIDAuOTk5NDEsIDAuOTk5MjQsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNCwgMC45MTYyMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDA2LCAxLjAwMDAxLCAxLjAwMDA1LCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDE1LCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDI2LCAxLjAwMDAxLCAxLjAwMDE5LCAxLjAwMDAxLCAwLjk5OTQ2LCAxLCAxLjAwMDYsIDEuMDAwMDEsIDAuOTk5NzgsIDEuMDAwNDUsIDAuOTk5NzMsIDAuOTk5MjQsIDEuMDAwMjMsIDAuOTk5NzgsIDAuOTk5NjYsIDEsIDEuMDAwNjUsIDEuMDAwNDUsIDEuMDAwMTksIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5MjQsIDEsIDEsIDAuOTY0OTksIDEsIDEuMDAwNTUsIDAuOTk5NzMsIDEuMDAwMDgsIDEuMDAwMjcsIDEsIDAuOTk5NywgMC45OTk5NSwgMS4wMDAyMywgMC45OTkzMywgMS4wMDAxOSwgMS4wMDAxNSwgMS4wMDAzMSwgMC45OTkyNCwgMS4wMDAyMywgMC45OTk3MywgMS4wMDAyMywgMS4wMDAzMSwgMS4wMDAwMSwgMC45OTkyOCwgMS4wMDAyOSwgMS4wMDA5MiwgMS4wMDAzNSwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDEsIDAuOTk5ODgsIDAuOTk5NzUsIDEsIDEuMDAwODIsIDAuOTk1NjEsIDAuOTk5NiwgMS4wMDAzNSwgMS4wMDAwMSwgMC45OTk2MiwgMS4wMDAwMSwgMS4wMDA5MiwgMC45OTk2NCwgMS4wMDAwMSwgMC45OTk2MywgMC45OTk5OSwgMS4wMDAzNSwgMS4wMDAzNSwgMS4wMDA4MiwgMC45OTk2MiwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAzNSwgMS4wMDAwMSwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk2LCAwLjk5OTY3LCAxLjAwMDAxLCAxLjAwMDM0LCAxLjAwMDc0LCAxLjAwMDU0LCAxLjAwMDUzLCAxLjAwMDYzLCAwLjk5OTcxLCAwLjk5OTYyLCAxLjAwMDM1LCAwLjk5OTc1LCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDQzLCAwLjk5OTUzLCAxLjAwMDcsIDAuOTk5MTUsIDAuOTk5NzMsIDEuMDAwMDgsIDAuOTk4OTIsIDEuMDAwNzMsIDEuMDAwNzMsIDEuMDAxMTQsIDAuOTk5MTUsIDEuMDAwNzMsIDAuOTk5NTUsIDAuOTk5NzMsIDEuMDAwOTIsIDAuOTk5NzMsIDEsIDAuOTk5OTgsIDEsIDEuMDAwMywgMSwgMS4wMDA0MywgMS4wMDAwMSwgMC45OTk2OSwgMS4wMDAzLCAxLCAxLjAwMDM1LCAxLjAwMDAxLCAwLjk5OTUsIDEsIDEuMDAwOTIsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNywgMC45OTk1LCAxLCAwLjk5OTI0LCAxLjAwMDYsIDAuOTk5MjQsIDAuOTk5NzIsIDEuMDAwNjIsIDAuOTk5NzMsIDEuMDAxMTQsIDEuMDAwNzMsIDEsIDAuOTk5NTUsIDEsIDEsIDEuMDAwNDcsIDAuOTk5NjgsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMDEsIDEsIDEsIDEsIDAuOTk5NzMsIDEsIDEsIDAuOTk5NTUsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzIsIDEsIDEsIDEuMDAyNjcsIDAuOTk5OTksIDAuOTk5OTgsIDAuOTk5OTgsIDEsIDAuOTk5OTgsIDEuNjY0NzUsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwMjMsIDAuOTk5NzMsIDAuOTk5NzEsIDAuOTk5MjUsIDEuMDAwMjMsIDEsIDAuOTk5OTEsIDAuOTk5ODQsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTYzMjksIDEsIDEuMjA5ODUsIDEuMzk3MTMsIDEuMDAwMDMsIDAuODI1NCwgMS4wMDAxNSwgMSwgMS4wMDAzNSwgMS4wMDAyNywgMS4wMDAzMSwgMS4wMDAzMSwgMC45OTkxNSwgMS4wMDAzMSwgMS4wMDAzMSwgMC45OTk5OSwgMS4wMDAwMywgMC45OTk5OSwgMC45OTk5OSwgMS40MTE0NCwgMS42LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQwNTc5LCAxLjQwNTc5LCAxLjM2NjI1LCAwLjk5OTk5LCAxLCAwLjk5ODYxLCAwLjk5ODYxLCAxLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk1MzE3LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQwNDgzLCAxLCAwLjk5OTc3LCAxLjAwMDU0LCAxLCAxLCAwLjk5OTUzLCAwLjk5OTYyLCAxLjAwMDQyLCAwLjk5OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBIZWx2ZXRpY2FSZWd1bGFyTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIsCiAgbGluZUdhcDogMC4yCn07Cgo7Ly8gLi9zcmMvY29yZS9saWJlcmF0aW9uc2Fuc193aWR0aHMuanMKY29uc3QgTGliZXJhdGlvblNhbnNCb2xkV2lkdGhzID0gWzM2NSwgMCwgMzMzLCAyNzgsIDMzMywgNDc0LCA1NTYsIDU1NiwgODg5LCA3MjIsIDIzOCwgMzMzLCAzMzMsIDM4OSwgNTg0LCAyNzgsIDMzMywgMjc4LCAyNzgsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMzMzLCAzMzMsIDU4NCwgNTg0LCA1ODQsIDYxMSwgOTc1LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjExLCA3NzgsIDcyMiwgMjc4LCA1NTYsIDcyMiwgNjExLCA4MzMsIDcyMiwgNzc4LCA2NjcsIDc3OCwgNzIyLCA2NjcsIDYxMSwgNzIyLCA2NjcsIDk0NCwgNjY3LCA2NjcsIDYxMSwgMzMzLCAyNzgsIDMzMywgNTg0LCA1NTYsIDMzMywgNTU2LCA2MTEsIDU1NiwgNjExLCA1NTYsIDMzMywgNjExLCA2MTEsIDI3OCwgMjc4LCA1NTYsIDI3OCwgODg5LCA2MTEsIDYxMSwgNjExLCA2MTEsIDM4OSwgNTU2LCAzMzMsIDYxMSwgNTU2LCA3NzgsIDU1NiwgNTU2LCA1MDAsIDM4OSwgMjgwLCAzODksIDU4NCwgMzMzLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI4MCwgNTU2LCAzMzMsIDczNywgMzcwLCA1NTYsIDU4NCwgNzM3LCA1NTIsIDQwMCwgNTQ5LCAzMzMsIDMzMywgMzMzLCA1NzYsIDU1NiwgMjc4LCAzMzMsIDMzMywgMzY1LCA1NTYsIDgzNCwgODM0LCA4MzQsIDYxMSwgNzIyLCA3MjIsIDcyMiwgNzIyLCA3MjIsIDcyMiwgMTAwMCwgNzIyLCA2NjcsIDY2NywgNjY3LCA2NjcsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzIyLCA3MjIsIDc3OCwgNzc4LCA3NzgsIDc3OCwgNzc4LCA1ODQsIDc3OCwgNzIyLCA3MjIsIDcyMiwgNzIyLCA2NjcsIDY2NywgNjExLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA4ODksIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNTQ5LCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNTU2LCA2MTEsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNzE5LCA3MjIsIDYxMSwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDc4NSwgNTU2LCA1NTYsIDI3OCwgNzIyLCA1NTYsIDU1NiwgNjExLCAyNzgsIDYxMSwgMjc4LCA2MTEsIDM4NSwgNjExLCA0NzksIDYxMSwgMjc4LCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MDgsIDcyMywgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCAxMDAwLCA5NDQsIDcyMiwgMzg5LCA3MjIsIDM4OSwgNzIyLCAzODksIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2MTEsIDMzMywgNjExLCA0NzksIDYxMSwgMzMzLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA5NDQsIDc3OCwgNjY3LCA1NTYsIDY2NywgNjExLCA1MDAsIDYxMSwgNTAwLCA2MTEsIDUwMCwgMjc4LCA1NTYsIDcyMiwgNTU2LCAxMDAwLCA4ODksIDc3OCwgNjExLCA2NjcsIDU1NiwgNjExLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgNDY1LCA3MjIsIDMzMywgODUzLCA5MDYsIDQ3NCwgODI1LCA5MjcsIDgzOCwgMjc4LCA3MjIsIDcyMiwgNjAxLCA3MTksIDY2NywgNjExLCA3MjIsIDc3OCwgMjc4LCA3MjIsIDY2NywgODMzLCA3MjIsIDY0NCwgNzc4LCA3MjIsIDY2NywgNjAwLCA2MTEsIDY2NywgODIxLCA2NjcsIDgwOSwgODAyLCAyNzgsIDY2NywgNjE1LCA0NTEsIDYxMSwgMjc4LCA1ODIsIDYxNSwgNjEwLCA1NTYsIDYwNiwgNDc1LCA0NjAsIDYxMSwgNTQxLCAyNzgsIDU1OCwgNTU2LCA2MTIsIDU1NiwgNDQ1LCA2MTEsIDc2NiwgNjE5LCA1MjAsIDY4NCwgNDQ2LCA1ODIsIDcxNSwgNTc2LCA3NTMsIDg0NSwgMjc4LCA1ODIsIDYxMSwgNTgyLCA4NDUsIDY2NywgNjY5LCA4ODUsIDU2NywgNzExLCA2NjcsIDI3OCwgMjc2LCA1NTYsIDEwOTQsIDEwNjIsIDg3NSwgNjEwLCA3MjIsIDYyMiwgNzE5LCA3MjIsIDcxOSwgNzIyLCA1NjcsIDcxMiwgNjY3LCA5MDQsIDYyNiwgNzE5LCA3MTksIDYxMCwgNzAyLCA4MzMsIDcyMiwgNzc4LCA3MTksIDY2NywgNzIyLCA2MTEsIDYyMiwgODU0LCA2NjcsIDczMCwgNzAzLCAxMDA1LCAxMDE5LCA4NzAsIDk3OSwgNzE5LCA3MTEsIDEwMzEsIDcxOSwgNTU2LCA2MTgsIDYxNSwgNDE3LCA2MzUsIDU1NiwgNzA5LCA0OTcsIDYxNSwgNjE1LCA1MDAsIDYzNSwgNzQwLCA2MDQsIDYxMSwgNjA0LCA2MTEsIDU1NiwgNDkwLCA1NTYsIDg3NSwgNTU2LCA2MTUsIDU4MSwgODMzLCA4NDQsIDcyOSwgODU0LCA2MTUsIDU1MiwgODU0LCA1ODMsIDU1NiwgNTU2LCA2MTEsIDQxNywgNTUyLCA1NTYsIDI3OCwgMjgxLCAyNzgsIDk2OSwgOTA2LCA2MTEsIDUwMCwgNjE1LCA1NTYsIDYwNCwgNzc4LCA2MTEsIDQ4NywgNDQ3LCA5NDQsIDc3OCwgOTQ0LCA3NzgsIDk0NCwgNzc4LCA2NjcsIDU1NiwgMzMzLCAzMzMsIDU1NiwgMTAwMCwgMTAwMCwgNTUyLCAyNzgsIDI3OCwgMjc4LCAyNzgsIDUwMCwgNTAwLCA1MDAsIDU1NiwgNTU2LCAzNTAsIDEwMDAsIDEwMDAsIDI0MCwgNDc5LCAzMzMsIDMzMywgNjA0LCAzMzMsIDE2NywgMzk2LCA1NTYsIDU1NiwgMTA5NCwgNTU2LCA4ODUsIDQ4OSwgMTExNSwgMTAwMCwgNzY4LCA2MDAsIDgzNCwgODM0LCA4MzQsIDgzNCwgMTAwMCwgNTAwLCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgNTAwLCA0OTQsIDYxMiwgODIzLCA3MTMsIDU4NCwgNTQ5LCA3MTMsIDk3OSwgNzIyLCAyNzQsIDU0OSwgNTQ5LCA1ODMsIDU0OSwgNTQ5LCA2MDQsIDU4NCwgNjA0LCA2MDQsIDcwOCwgNjI1LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MjksIDYwNCwgNjA0LCAzNTQsIDM1NCwgMTAwMCwgOTkwLCA5OTAsIDk5MCwgOTkwLCA0OTQsIDYwNCwgNjA0LCA2MDQsIDYwNCwgMzU0LCAxMDIxLCAxMDUyLCA5MTcsIDc1MCwgNzUwLCA1MzEsIDY1NiwgNTk0LCA1MTAsIDUwMCwgNzUwLCA3NTAsIDYxMSwgNjExLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMjIyLCAyMjIsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzXTsKY29uc3QgTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpjb25zdCBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMgPSBbMzY1LCAwLCAzMzMsIDI3OCwgMzMzLCA0NzQsIDU1NiwgNTU2LCA4ODksIDcyMiwgMjM4LCAzMzMsIDMzMywgMzg5LCA1ODQsIDI3OCwgMzMzLCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAzMzMsIDMzMywgNTg0LCA1ODQsIDU4NCwgNjExLCA5NzUsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNjY3LCA2MTEsIDc3OCwgNzIyLCAyNzgsIDU1NiwgNzIyLCA2MTEsIDgzMywgNzIyLCA3NzgsIDY2NywgNzc4LCA3MjIsIDY2NywgNjExLCA3MjIsIDY2NywgOTQ0LCA2NjcsIDY2NywgNjExLCAzMzMsIDI3OCwgMzMzLCA1ODQsIDU1NiwgMzMzLCA1NTYsIDYxMSwgNTU2LCA2MTEsIDU1NiwgMzMzLCA2MTEsIDYxMSwgMjc4LCAyNzgsIDU1NiwgMjc4LCA4ODksIDYxMSwgNjExLCA2MTEsIDYxMSwgMzg5LCA1NTYsIDMzMywgNjExLCA1NTYsIDc3OCwgNTU2LCA1NTYsIDUwMCwgMzg5LCAyODAsIDM4OSwgNTg0LCAzMzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjgwLCA1NTYsIDMzMywgNzM3LCAzNzAsIDU1NiwgNTg0LCA3MzcsIDU1MiwgNDAwLCA1NDksIDMzMywgMzMzLCAzMzMsIDU3NiwgNTU2LCAyNzgsIDMzMywgMzMzLCAzNjUsIDU1NiwgODM0LCA4MzQsIDgzNCwgNjExLCA3MjIsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNzIyLCAxMDAwLCA3MjIsIDY2NywgNjY3LCA2NjcsIDY2NywgMjc4LCAyNzgsIDI3OCwgMjc4LCA3MjIsIDcyMiwgNzc4LCA3NzgsIDc3OCwgNzc4LCA3NzgsIDU4NCwgNzc4LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjY3LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDg4OSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NDksIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NTYsIDYxMSwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA3NDAsIDcyMiwgNjExLCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzgyLCA1NTYsIDU1NiwgMjc4LCA3MjIsIDU1NiwgNTU2LCA2MTEsIDI3OCwgNjExLCAyNzgsIDYxMSwgMzk2LCA2MTEsIDQ3OSwgNjExLCAyNzgsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcwOCwgNzIzLCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDEwMDAsIDk0NCwgNzIyLCAzODksIDcyMiwgMzg5LCA3MjIsIDM4OSwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDYxMSwgMzMzLCA2MTEsIDQ3OSwgNjExLCAzMzMsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDk0NCwgNzc4LCA2NjcsIDU1NiwgNjY3LCA2MTEsIDUwMCwgNjExLCA1MDAsIDYxMSwgNTAwLCAyNzgsIDU1NiwgNzIyLCA1NTYsIDEwMDAsIDg4OSwgNzc4LCA2MTEsIDY2NywgNTU2LCA2MTEsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDcyMiwgMzMzLCA4NTQsIDkwNiwgNDczLCA4NDQsIDkzMCwgODQ3LCAyNzgsIDcyMiwgNzIyLCA2MTAsIDY3MSwgNjY3LCA2MTEsIDcyMiwgNzc4LCAyNzgsIDcyMiwgNjY3LCA4MzMsIDcyMiwgNjU3LCA3NzgsIDcxOCwgNjY3LCA1OTAsIDYxMSwgNjY3LCA4MjIsIDY2NywgODI5LCA3ODEsIDI3OCwgNjY3LCA2MjAsIDQ3OSwgNjExLCAyNzgsIDU5MSwgNjIwLCA2MjEsIDU1NiwgNjEwLCA0NzksIDQ5MiwgNjExLCA1NTgsIDI3OCwgNTY2LCA1NTYsIDYwMywgNTU2LCA0NTAsIDYxMSwgNzEyLCA2MDUsIDUzMiwgNjY0LCA0MDksIDU5MSwgNzA0LCA1NzgsIDc3MywgODM0LCAyNzgsIDU5MSwgNjExLCA1OTEsIDgzNCwgNjY3LCA2NjcsIDg4NiwgNjE0LCA3MTksIDY2NywgMjc4LCAyNzgsIDU1NiwgMTA5NCwgMTA0MiwgODU0LCA2MjIsIDcxOSwgNjc3LCA3MTksIDcyMiwgNzA4LCA3MjIsIDYxNCwgNzIyLCA2NjcsIDkyNywgNjQzLCA3MTksIDcxOSwgNjE1LCA2ODcsIDgzMywgNzIyLCA3NzgsIDcxOSwgNjY3LCA3MjIsIDYxMSwgNjc3LCA3ODEsIDY2NywgNzI5LCA3MDgsIDk3OSwgOTg5LCA4NTQsIDEwMDAsIDcwOCwgNzE5LCAxMDQyLCA3MjksIDU1NiwgNjE5LCA2MDQsIDUzNCwgNjE4LCA1NTYsIDczNiwgNTEwLCA2MTEsIDYxMSwgNTA3LCA2MjIsIDc0MCwgNjA0LCA2MTEsIDYxMSwgNjExLCA1NTYsIDg4OSwgNTU2LCA4ODUsIDU1NiwgNjQ2LCA1ODMsIDg4OSwgOTM1LCA3MDcsIDg1NCwgNTk0LCA1NTIsIDg2NSwgNTg5LCA1NTYsIDU1NiwgNjExLCA0NjksIDU2MywgNTU2LCAyNzgsIDI3OCwgMjc4LCA5NjksIDkwNiwgNjExLCA1MDcsIDYxOSwgNTU2LCA2MTEsIDc3OCwgNjExLCA1NzUsIDQ2NywgOTQ0LCA3NzgsIDk0NCwgNzc4LCA5NDQsIDc3OCwgNjY3LCA1NTYsIDMzMywgMzMzLCA1NTYsIDEwMDAsIDEwMDAsIDU1MiwgMjc4LCAyNzgsIDI3OCwgMjc4LCA1MDAsIDUwMCwgNTAwLCA1NTYsIDU1NiwgMzUwLCAxMDAwLCAxMDAwLCAyNDAsIDQ3OSwgMzMzLCAzMzMsIDYwNCwgMzMzLCAxNjcsIDM5NiwgNTU2LCA1NTYsIDExMDQsIDU1NiwgODg1LCA1MTYsIDExNDYsIDEwMDAsIDc2OCwgNjAwLCA4MzQsIDgzNCwgODM0LCA4MzQsIDk5OSwgNTAwLCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgNTAwLCA0OTQsIDYxMiwgODIzLCA3MTMsIDU4NCwgNTQ5LCA3MTMsIDk3OSwgNzIyLCAyNzQsIDU0OSwgNTQ5LCA1ODMsIDU0OSwgNTQ5LCA2MDQsIDU4NCwgNjA0LCA2MDQsIDcwOCwgNjI1LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MjksIDYwNCwgNjA0LCAzNTQsIDM1NCwgMTAwMCwgOTkwLCA5OTAsIDk5MCwgOTkwLCA0OTQsIDYwNCwgNjA0LCA2MDQsIDYwNCwgMzU0LCAxMDIxLCAxMDUyLCA5MTcsIDc1MCwgNzUwLCA1MzEsIDY1NiwgNTk0LCA1MTAsIDUwMCwgNzUwLCA3NTAsIDYxMSwgNjExLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMjIyLCAyMjIsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzXTsKY29uc3QgTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpjb25zdCBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocyA9IFszNjUsIDAsIDMzMywgMjc4LCAyNzgsIDM1NSwgNTU2LCA1NTYsIDg4OSwgNjY3LCAxOTEsIDMzMywgMzMzLCAzODksIDU4NCwgMjc4LCAzMzMsIDI3OCwgMjc4LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCA1ODQsIDU4NCwgNTg0LCA1NTYsIDEwMTUsIDY2NywgNjY3LCA3MjIsIDcyMiwgNjY3LCA2MTEsIDc3OCwgNzIyLCAyNzgsIDUwMCwgNjY3LCA1NTYsIDgzMywgNzIyLCA3NzgsIDY2NywgNzc4LCA3MjIsIDY2NywgNjExLCA3MjIsIDY2NywgOTQ0LCA2NjcsIDY2NywgNjExLCAyNzgsIDI3OCwgMjc4LCA0NjksIDU1NiwgMzMzLCA1NTYsIDU1NiwgNTAwLCA1NTYsIDU1NiwgMjc4LCA1NTYsIDU1NiwgMjIyLCAyMjIsIDUwMCwgMjIyLCA4MzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMzMzLCA1MDAsIDI3OCwgNTU2LCA1MDAsIDcyMiwgNTAwLCA1MDAsIDUwMCwgMzM0LCAyNjAsIDMzNCwgNTg0LCAzMzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjYwLCA1NTYsIDMzMywgNzM3LCAzNzAsIDU1NiwgNTg0LCA3MzcsIDU1MiwgNDAwLCA1NDksIDMzMywgMzMzLCAzMzMsIDU3NiwgNTM3LCAyNzgsIDMzMywgMzMzLCAzNjUsIDU1NiwgODM0LCA4MzQsIDgzNCwgNjExLCA2NjcsIDY2NywgNjY3LCA2NjcsIDY2NywgNjY3LCAxMDAwLCA3MjIsIDY2NywgNjY3LCA2NjcsIDY2NywgMjc4LCAyNzgsIDI3OCwgMjc4LCA3MjIsIDcyMiwgNzc4LCA3NzgsIDc3OCwgNzc4LCA3NzgsIDU4NCwgNzc4LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjY3LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDg4OSwgNTAwLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NDksIDYxMSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1MDAsIDU1NiwgNTAwLCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA3MjIsIDUwMCwgNzIyLCA1MDAsIDcyMiwgNTAwLCA3MjIsIDUwMCwgNzIyLCA2MjUsIDcyMiwgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjIyLCAyNzgsIDI3OCwgNzMzLCA0NDQsIDUwMCwgMjIyLCA2NjcsIDUwMCwgNTAwLCA1NTYsIDIyMiwgNTU2LCAyMjIsIDU1NiwgMjgxLCA1NTYsIDQwMCwgNTU2LCAyMjIsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDYxNSwgNzIzLCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDEwMDAsIDk0NCwgNzIyLCAzMzMsIDcyMiwgMzMzLCA3MjIsIDMzMywgNjY3LCA1MDAsIDY2NywgNTAwLCA2NjcsIDUwMCwgNjY3LCA1MDAsIDYxMSwgMjc4LCA2MTEsIDM1NCwgNjExLCAyNzgsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDk0NCwgNzIyLCA2NjcsIDUwMCwgNjY3LCA2MTEsIDUwMCwgNjExLCA1MDAsIDYxMSwgNTAwLCAyMjIsIDU1NiwgNjY3LCA1NTYsIDEwMDAsIDg4OSwgNzc4LCA2MTEsIDY2NywgNTAwLCA2MTEsIDI3OCwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDY2NywgMjc4LCA3ODksIDg0NiwgMzg5LCA3OTQsIDg2NSwgNzc1LCAyMjIsIDY2NywgNjY3LCA1NzAsIDY3MSwgNjY3LCA2MTEsIDcyMiwgNzc4LCAyNzgsIDY2NywgNjY3LCA4MzMsIDcyMiwgNjQ4LCA3NzgsIDcyNSwgNjY3LCA2MDAsIDYxMSwgNjY3LCA4MzcsIDY2NywgODMxLCA3NjEsIDI3OCwgNjY3LCA1NzAsIDQzOSwgNTU1LCAyMjIsIDU1MCwgNTcwLCA1NzEsIDUwMCwgNTU2LCA0MzksIDQ2MywgNTU1LCA1NDIsIDIyMiwgNTAwLCA0OTIsIDU0OCwgNTAwLCA0NDcsIDU1NiwgNjcwLCA1NzMsIDQ4NiwgNjAzLCAzNzQsIDU1MCwgNjUyLCA1NDYsIDcyOCwgNzc5LCAyMjIsIDU1MCwgNTU2LCA1NTAsIDc3OSwgNjY3LCA2NjcsIDg0MywgNTQ0LCA3MDgsIDY2NywgMjc4LCAyNzgsIDUwMCwgMTA2NiwgOTgyLCA4NDQsIDU4OSwgNzE1LCA2MzksIDcyNCwgNjY3LCA2NTEsIDY2NywgNTQ0LCA3MDQsIDY2NywgOTE3LCA2MTQsIDcxNSwgNzE1LCA1ODksIDY4NiwgODMzLCA3MjIsIDc3OCwgNzI1LCA2NjcsIDcyMiwgNjExLCA2MzksIDc5NSwgNjY3LCA3MjcsIDY3MywgOTIwLCA5MjMsIDgwNSwgODg2LCA2NTEsIDY5NCwgMTAyMiwgNjgyLCA1NTYsIDU2MiwgNTIyLCA0OTMsIDU1MywgNTU2LCA2ODgsIDQ2NSwgNTU2LCA1NTYsIDQ3MiwgNTY0LCA2ODYsIDU1MCwgNTU2LCA1NTYsIDU1NiwgNTAwLCA4MzMsIDUwMCwgODM1LCA1MDAsIDU3MiwgNTE4LCA4MzAsIDg1MSwgNjIxLCA3MzYsIDUyNiwgNDkyLCA3NTIsIDUzNCwgNTU2LCA1NTYsIDU1NiwgMzc4LCA0OTYsIDUwMCwgMjIyLCAyMjIsIDIyMiwgOTEwLCA4MjgsIDU1NiwgNDcyLCA1NjUsIDUwMCwgNTU2LCA3NzgsIDU1NiwgNDkyLCAzMzksIDk0NCwgNzIyLCA5NDQsIDcyMiwgOTQ0LCA3MjIsIDY2NywgNTAwLCAzMzMsIDMzMywgNTU2LCAxMDAwLCAxMDAwLCA1NTIsIDIyMiwgMjIyLCAyMjIsIDIyMiwgMzMzLCAzMzMsIDMzMywgNTU2LCA1NTYsIDM1MCwgMTAwMCwgMTAwMCwgMTg4LCAzNTQsIDMzMywgMzMzLCA1MDAsIDMzMywgMTY3LCAzNjUsIDU1NiwgNTU2LCAxMDk0LCA1NTYsIDg4NSwgMzIzLCAxMDgzLCAxMDAwLCA3NjgsIDYwMCwgODM0LCA4MzQsIDgzNCwgODM0LCAxMDAwLCA1MDAsIDk5OCwgNTAwLCAxMDAwLCA1MDAsIDUwMCwgNDk0LCA2MTIsIDgyMywgNzEzLCA1ODQsIDU0OSwgNzEzLCA5NzksIDcxOSwgMjc0LCA1NDksIDU0OSwgNTg0LCA1NDksIDU0OSwgNjA0LCA1ODQsIDYwNCwgNjA0LCA3MDgsIDYyNSwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzI5LCA2MDQsIDYwNCwgMzU0LCAzNTQsIDEwMDAsIDk5MCwgOTkwLCA5OTAsIDk5MCwgNDk0LCA2MDQsIDYwNCwgNjA0LCA2MDQsIDM1NCwgMTAyMSwgMTA1MiwgOTE3LCA3NTAsIDc1MCwgNTMxLCA2NTYsIDU5NCwgNTEwLCA1MDAsIDc1MCwgNzUwLCA1MDAsIDUwMCwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDIyMiwgMjIyLCAyOTQsIDI5NCwgMzI0LCAzMjQsIDMxNiwgMzI4LCAzOTgsIDI4NV07CmNvbnN0IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpjb25zdCBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMgPSBbMzY1LCAwLCAzMzMsIDI3OCwgMjc4LCAzNTUsIDU1NiwgNTU2LCA4ODksIDY2NywgMTkxLCAzMzMsIDMzMywgMzg5LCA1ODQsIDI3OCwgMzMzLCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNzgsIDI3OCwgNTg0LCA1ODQsIDU4NCwgNTU2LCAxMDE1LCA2NjcsIDY2NywgNzIyLCA3MjIsIDY2NywgNjExLCA3NzgsIDcyMiwgMjc4LCA1MDAsIDY2NywgNTU2LCA4MzMsIDcyMiwgNzc4LCA2NjcsIDc3OCwgNzIyLCA2NjcsIDYxMSwgNzIyLCA2NjcsIDk0NCwgNjY3LCA2NjcsIDYxMSwgMjc4LCAyNzgsIDI3OCwgNDY5LCA1NTYsIDMzMywgNTU2LCA1NTYsIDUwMCwgNTU2LCA1NTYsIDI3OCwgNTU2LCA1NTYsIDIyMiwgMjIyLCA1MDAsIDIyMiwgODMzLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDMzMywgNTAwLCAyNzgsIDU1NiwgNTAwLCA3MjIsIDUwMCwgNTAwLCA1MDAsIDMzNCwgMjYwLCAzMzQsIDU4NCwgMzMzLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI2MCwgNTU2LCAzMzMsIDczNywgMzcwLCA1NTYsIDU4NCwgNzM3LCA1NTIsIDQwMCwgNTQ5LCAzMzMsIDMzMywgMzMzLCA1NzYsIDUzNywgMjc4LCAzMzMsIDMzMywgMzY1LCA1NTYsIDgzNCwgODM0LCA4MzQsIDYxMSwgNjY3LCA2NjcsIDY2NywgNjY3LCA2NjcsIDY2NywgMTAwMCwgNzIyLCA2NjcsIDY2NywgNjY3LCA2NjcsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzIyLCA3MjIsIDc3OCwgNzc4LCA3NzgsIDc3OCwgNzc4LCA1ODQsIDc3OCwgNzIyLCA3MjIsIDcyMiwgNzIyLCA2NjcsIDY2NywgNjExLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA4ODksIDUwMCwgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTQ5LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTAwLCA1NTYsIDUwMCwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNzIyLCA1MDAsIDcyMiwgNTAwLCA3MjIsIDUwMCwgNzIyLCA1MDAsIDcyMiwgNjE1LCA3MjIsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDIyMiwgMjc4LCAyNzgsIDczNSwgNDQ0LCA1MDAsIDIyMiwgNjY3LCA1MDAsIDUwMCwgNTU2LCAyMjIsIDU1NiwgMjIyLCA1NTYsIDI5MiwgNTU2LCAzMzQsIDU1NiwgMjIyLCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA2MDQsIDcyMywgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCAxMDAwLCA5NDQsIDcyMiwgMzMzLCA3MjIsIDMzMywgNzIyLCAzMzMsIDY2NywgNTAwLCA2NjcsIDUwMCwgNjY3LCA1MDAsIDY2NywgNTAwLCA2MTEsIDI3OCwgNjExLCAzNzUsIDYxMSwgMjc4LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA5NDQsIDcyMiwgNjY3LCA1MDAsIDY2NywgNjExLCA1MDAsIDYxMSwgNTAwLCA2MTEsIDUwMCwgMjIyLCA1NTYsIDY2NywgNTU2LCAxMDAwLCA4ODksIDc3OCwgNjExLCA2NjcsIDUwMCwgNjExLCAyNzgsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCA2NjcsIDI3OCwgNzg0LCA4MzgsIDM4NCwgNzc0LCA4NTUsIDc1MiwgMjIyLCA2NjcsIDY2NywgNTUxLCA2NjgsIDY2NywgNjExLCA3MjIsIDc3OCwgMjc4LCA2NjcsIDY2OCwgODMzLCA3MjIsIDY1MCwgNzc4LCA3MjIsIDY2NywgNjE4LCA2MTEsIDY2NywgNzk4LCA2NjcsIDgzNSwgNzQ4LCAyNzgsIDY2NywgNTc4LCA0NDYsIDU1NiwgMjIyLCA1NDcsIDU3OCwgNTc1LCA1MDAsIDU1NywgNDQ2LCA0NDEsIDU1NiwgNTU2LCAyMjIsIDUwMCwgNTAwLCA1NzYsIDUwMCwgNDQ4LCA1NTYsIDY5MCwgNTY5LCA0ODIsIDYxNywgMzk1LCA1NDcsIDY0OCwgNTI1LCA3MTMsIDc4MSwgMjIyLCA1NDcsIDU1NiwgNTQ3LCA3ODEsIDY2NywgNjY3LCA4NjUsIDU0MiwgNzE5LCA2NjcsIDI3OCwgMjc4LCA1MDAsIDEwNTcsIDEwMTAsIDg1NCwgNTgzLCA3MjIsIDYzNSwgNzE5LCA2NjcsIDY1NiwgNjY3LCA1NDIsIDY3NywgNjY3LCA5MjMsIDYwNCwgNzE5LCA3MTksIDU4MywgNjU2LCA4MzMsIDcyMiwgNzc4LCA3MTksIDY2NywgNzIyLCA2MTEsIDYzNSwgNzYwLCA2NjcsIDc0MCwgNjY3LCA5MTcsIDkzOCwgNzkyLCA4ODUsIDY1NiwgNzE5LCAxMDEwLCA3MjIsIDU1NiwgNTczLCA1MzEsIDM2NSwgNTgzLCA1NTYsIDY2OSwgNDU4LCA1NTksIDU1OSwgNDM4LCA1ODMsIDY4OCwgNTUyLCA1NTYsIDU0MiwgNTU2LCA1MDAsIDQ1OCwgNTAwLCA4MjMsIDUwMCwgNTczLCA1MjEsIDgwMiwgODIzLCA2MjUsIDcxOSwgNTIxLCA1MTAsIDc1MCwgNTQyLCA1NTYsIDU1NiwgNTU2LCAzNjUsIDUxMCwgNTAwLCAyMjIsIDI3OCwgMjIyLCA5MDYsIDgxMiwgNTU2LCA0MzgsIDU1OSwgNTAwLCA1NTIsIDc3OCwgNTU2LCA0ODksIDQxMSwgOTQ0LCA3MjIsIDk0NCwgNzIyLCA5NDQsIDcyMiwgNjY3LCA1MDAsIDMzMywgMzMzLCA1NTYsIDEwMDAsIDEwMDAsIDU1MiwgMjIyLCAyMjIsIDIyMiwgMjIyLCAzMzMsIDMzMywgMzMzLCA1NTYsIDU1NiwgMzUwLCAxMDAwLCAxMDAwLCAxODgsIDM1NCwgMzMzLCAzMzMsIDUwMCwgMzMzLCAxNjcsIDM2NSwgNTU2LCA1NTYsIDEwOTQsIDU1NiwgODg1LCAzMjMsIDEwNzMsIDEwMDAsIDc2OCwgNjAwLCA4MzQsIDgzNCwgODM0LCA4MzQsIDEwMDAsIDUwMCwgMTAwMCwgNTAwLCAxMDAwLCA1MDAsIDUwMCwgNDk0LCA2MTIsIDgyMywgNzEzLCA1ODQsIDU0OSwgNzEzLCA5NzksIDcxOSwgMjc0LCA1NDksIDU0OSwgNTgzLCA1NDksIDU0OSwgNjA0LCA1ODQsIDYwNCwgNjA0LCA3MDgsIDYyNSwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzI5LCA2MDQsIDYwNCwgMzU0LCAzNTQsIDEwMDAsIDk5MCwgOTkwLCA5OTAsIDk5MCwgNDk0LCA2MDQsIDYwNCwgNjA0LCA2MDQsIDM1NCwgMTAyMSwgMTA1MiwgOTE3LCA3NTAsIDc1MCwgNTMxLCA2NTYsIDU5NCwgNTEwLCA1MDAsIDc1MCwgNzUwLCA1MDAsIDUwMCwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDIyMiwgMjIyLCAyOTQsIDI5NCwgMzI0LCAzMjQsIDMxNiwgMzI4LCAzOTgsIDI4NV07CmNvbnN0IExpYmVyYXRpb25TYW5zUmVndWxhck1hcHBpbmcgPSBbLTEsIC0xLCAtMSwgMzIsIDMzLCAzNCwgMzUsIDM2LCAzNywgMzgsIDM5LCA0MCwgNDEsIDQyLCA0MywgNDQsIDQ1LCA0NiwgNDcsIDQ4LCA0OSwgNTAsIDUxLCA1MiwgNTMsIDU0LCA1NSwgNTYsIDU3LCA1OCwgNTksIDYwLCA2MSwgNjIsIDYzLCA2NCwgNjUsIDY2LCA2NywgNjgsIDY5LCA3MCwgNzEsIDcyLCA3MywgNzQsIDc1LCA3NiwgNzcsIDc4LCA3OSwgODAsIDgxLCA4MiwgODMsIDg0LCA4NSwgODYsIDg3LCA4OCwgODksIDkwLCA5MSwgOTIsIDkzLCA5NCwgOTUsIDk2LCA5NywgOTgsIDk5LCAxMDAsIDEwMSwgMTAyLCAxMDMsIDEwNCwgMTA1LCAxMDYsIDEwNywgMTA4LCAxMDksIDExMCwgMTExLCAxMTIsIDExMywgMTE0LCAxMTUsIDExNiwgMTE3LCAxMTgsIDExOSwgMTIwLCAxMjEsIDEyMiwgMTIzLCAxMjQsIDEyNSwgMTI2LCAxNjEsIDE2MiwgMTYzLCAxNjQsIDE2NSwgMTY2LCAxNjcsIDE2OCwgMTY5LCAxNzAsIDE3MSwgMTcyLCAxNzQsIDE3NSwgMTc2LCAxNzcsIDE3OCwgMTc5LCAxODAsIDE4MSwgMTgyLCAxODMsIDE4NCwgMTg1LCAxODYsIDE4NywgMTg4LCAxODksIDE5MCwgMTkxLCAxOTIsIDE5MywgMTk0LCAxOTUsIDE5NiwgMTk3LCAxOTgsIDE5OSwgMjAwLCAyMDEsIDIwMiwgMjAzLCAyMDQsIDIwNSwgMjA2LCAyMDcsIDIwOCwgMjA5LCAyMTAsIDIxMSwgMjEyLCAyMTMsIDIxNCwgMjE1LCAyMTYsIDIxNywgMjE4LCAyMTksIDIyMCwgMjIxLCAyMjIsIDIyMywgMjI0LCAyMjUsIDIyNiwgMjI3LCAyMjgsIDIyOSwgMjMwLCAyMzEsIDIzMiwgMjMzLCAyMzQsIDIzNSwgMjM2LCAyMzcsIDIzOCwgMjM5LCAyNDAsIDI0MSwgMjQyLCAyNDMsIDI0NCwgMjQ1LCAyNDYsIDI0NywgMjQ4LCAyNDksIDI1MCwgMjUxLCAyNTIsIDI1MywgMjU0LCAyNTUsIDI1NiwgMjU3LCAyNTgsIDI1OSwgMjYwLCAyNjEsIDI2MiwgMjYzLCAyNjQsIDI2NSwgMjY2LCAyNjcsIDI2OCwgMjY5LCAyNzAsIDI3MSwgMjcyLCAyNzMsIDI3NCwgMjc1LCAyNzYsIDI3NywgMjc4LCAyNzksIDI4MCwgMjgxLCAyODIsIDI4MywgMjg0LCAyODUsIDI4NiwgMjg3LCAyODgsIDI4OSwgMjkwLCAyOTEsIDI5MiwgMjkzLCAyOTQsIDI5NSwgMjk2LCAyOTcsIDI5OCwgMjk5LCAzMDAsIDMwMSwgMzAyLCAzMDMsIDMwNCwgMzA1LCAzMDYsIDMwNywgMzA4LCAzMDksIDMxMCwgMzExLCAzMTIsIDMxMywgMzE0LCAzMTUsIDMxNiwgMzE3LCAzMTgsIDMxOSwgMzIwLCAzMjEsIDMyMiwgMzIzLCAzMjQsIDMyNSwgMzI2LCAzMjcsIDMyOCwgMzI5LCAzMzAsIDMzMSwgMzMyLCAzMzMsIDMzNCwgMzM1LCAzMzYsIDMzNywgMzM4LCAzMzksIDM0MCwgMzQxLCAzNDIsIDM0MywgMzQ0LCAzNDUsIDM0NiwgMzQ3LCAzNDgsIDM0OSwgMzUwLCAzNTEsIDM1MiwgMzUzLCAzNTQsIDM1NSwgMzU2LCAzNTcsIDM1OCwgMzU5LCAzNjAsIDM2MSwgMzYyLCAzNjMsIDM2NCwgMzY1LCAzNjYsIDM2NywgMzY4LCAzNjksIDM3MCwgMzcxLCAzNzIsIDM3MywgMzc0LCAzNzUsIDM3NiwgMzc3LCAzNzgsIDM3OSwgMzgwLCAzODEsIDM4MiwgMzgzLCA0MDIsIDUwNiwgNTA3LCA1MDgsIDUwOSwgNTEwLCA1MTEsIDUzNiwgNTM3LCA1MzgsIDUzOSwgNzEwLCA3MTEsIDcxMywgNzI4LCA3MjksIDczMCwgNzMxLCA3MzIsIDczMywgOTAwLCA5MDEsIDkwMiwgOTAzLCA5MDQsIDkwNSwgOTA2LCA5MDgsIDkxMCwgOTExLCA5MTIsIDkxMywgOTE0LCA5MTUsIDkxNiwgOTE3LCA5MTgsIDkxOSwgOTIwLCA5MjEsIDkyMiwgOTIzLCA5MjQsIDkyNSwgOTI2LCA5MjcsIDkyOCwgOTI5LCA5MzEsIDkzMiwgOTMzLCA5MzQsIDkzNSwgOTM2LCA5MzcsIDkzOCwgOTM5LCA5NDAsIDk0MSwgOTQyLCA5NDMsIDk0NCwgOTQ1LCA5NDYsIDk0NywgOTQ4LCA5NDksIDk1MCwgOTUxLCA5NTIsIDk1MywgOTU0LCA5NTUsIDk1NiwgOTU3LCA5NTgsIDk1OSwgOTYwLCA5NjEsIDk2MiwgOTYzLCA5NjQsIDk2NSwgOTY2LCA5NjcsIDk2OCwgOTY5LCA5NzAsIDk3MSwgOTcyLCA5NzMsIDk3NCwgMTAyNCwgMTAyNSwgMTAyNiwgMTAyNywgMTAyOCwgMTAyOSwgMTAzMCwgMTAzMSwgMTAzMiwgMTAzMywgMTAzNCwgMTAzNSwgMTAzNiwgMTAzNywgMTAzOCwgMTAzOSwgMTA0MCwgMTA0MSwgMTA0MiwgMTA0MywgMTA0NCwgMTA0NSwgMTA0NiwgMTA0NywgMTA0OCwgMTA0OSwgMTA1MCwgMTA1MSwgMTA1MiwgMTA1MywgMTA1NCwgMTA1NSwgMTA1NiwgMTA1NywgMTA1OCwgMTA1OSwgMTA2MCwgMTA2MSwgMTA2MiwgMTA2MywgMTA2NCwgMTA2NSwgMTA2NiwgMTA2NywgMTA2OCwgMTA2OSwgMTA3MCwgMTA3MSwgMTA3MiwgMTA3MywgMTA3NCwgMTA3NSwgMTA3NiwgMTA3NywgMTA3OCwgMTA3OSwgMTA4MCwgMTA4MSwgMTA4MiwgMTA4MywgMTA4NCwgMTA4NSwgMTA4NiwgMTA4NywgMTA4OCwgMTA4OSwgMTA5MCwgMTA5MSwgMTA5MiwgMTA5MywgMTA5NCwgMTA5NSwgMTA5NiwgMTA5NywgMTA5OCwgMTA5OSwgMTEwMCwgMTEwMSwgMTEwMiwgMTEwMywgMTEwNCwgMTEwNSwgMTEwNiwgMTEwNywgMTEwOCwgMTEwOSwgMTExMCwgMTExMSwgMTExMiwgMTExMywgMTExNCwgMTExNSwgMTExNiwgMTExNywgMTExOCwgMTExOSwgMTEzOCwgMTEzOSwgMTE2OCwgMTE2OSwgNzgwOCwgNzgwOSwgNzgxMCwgNzgxMSwgNzgxMiwgNzgxMywgNzkyMiwgNzkyMywgODIwOCwgODIwOSwgODIxMSwgODIxMiwgODIxMywgODIxNSwgODIxNiwgODIxNywgODIxOCwgODIxOSwgODIyMCwgODIyMSwgODIyMiwgODIyNCwgODIyNSwgODIyNiwgODIzMCwgODI0MCwgODI0MiwgODI0MywgODI0OSwgODI1MCwgODI1MiwgODI1NCwgODI2MCwgODMxOSwgODM1NSwgODM1NiwgODM1OSwgODM2NCwgODQ1MywgODQ2NywgODQ3MCwgODQ4MiwgODQ4NiwgODQ5NCwgODUzOSwgODU0MCwgODU0MSwgODU0MiwgODU5MiwgODU5MywgODU5NCwgODU5NSwgODU5NiwgODU5NywgODYxNiwgODcwNiwgODcxMCwgODcxOSwgODcyMSwgODcyMiwgODczMCwgODczNCwgODczNSwgODc0NSwgODc0NywgODc3NiwgODgwMCwgODgwMSwgODgwNCwgODgwNSwgODk2MiwgODk3NiwgODk5MiwgODk5MywgOTQ3MiwgOTQ3NCwgOTQ4NCwgOTQ4OCwgOTQ5MiwgOTQ5NiwgOTUwMCwgOTUwOCwgOTUxNiwgOTUyNCwgOTUzMiwgOTU1MiwgOTU1MywgOTU1NCwgOTU1NSwgOTU1NiwgOTU1NywgOTU1OCwgOTU1OSwgOTU2MCwgOTU2MSwgOTU2MiwgOTU2MywgOTU2NCwgOTU2NSwgOTU2NiwgOTU2NywgOTU2OCwgOTU2OSwgOTU3MCwgOTU3MSwgOTU3MiwgOTU3MywgOTU3NCwgOTU3NSwgOTU3NiwgOTU3NywgOTU3OCwgOTU3OSwgOTU4MCwgOTYwMCwgOTYwNCwgOTYwOCwgOTYxMiwgOTYxNiwgOTYxNywgOTYxOCwgOTYxOSwgOTYzMiwgOTYzMywgOTY0MiwgOTY0MywgOTY0NCwgOTY1MCwgOTY1OCwgOTY2MCwgOTY2OCwgOTY3NCwgOTY3NSwgOTY3OSwgOTY4OCwgOTY4OSwgOTcwMiwgOTc4NiwgOTc4NywgOTc4OCwgOTc5MiwgOTc5NCwgOTgyNCwgOTgyNywgOTgyOSwgOTgzMCwgOTgzNCwgOTgzNSwgOTgzNiwgNjE0NDEsIDYxNDQyLCA2MTQ0NSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xXTsKCjsvLyAuL3NyYy9jb3JlL215cmlhZHByb19mYWN0b3JzLmpzCmNvbnN0IE15cmlhZFByb0JvbGRGYWN0b3JzID0gWzEuMzY4OTgsIDEsIDEsIDAuNzI3MDYsIDAuODA0NzksIDAuODM3MzQsIDAuOTg4OTQsIDAuOTk3OTMsIDAuOTg5NywgMC45Mzg4NCwgMC44NjIwOSwgMC45NDI5MiwgMC45NDI5MiwgMS4xNjY2MSwgMS4wMjA1OCwgMC45MzU4MiwgMC45NjY5NCwgMC45MzU4MiwgMS4xOTEzNywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC43ODA3NiwgMC43ODA3NiwgMS4wMjA1OCwgMS4wMjA1OCwgMS4wMjA1OCwgMC43Mjg1MSwgMC43ODk2NiwgMC45MDgzOCwgMC44MzYzNywgMC44MjM5MSwgMC45NjM3NiwgMC44MDA2MSwgMC44NjI3NSwgMC44NzY4LCAwLjk1NDA3LCAxLjAyNTgsIDAuNzM5MDEsIDAuODUwMjIsIDAuODM2NTUsIDEuMDE1NiwgMC45NTU0NiwgMC45MjE3OSwgMC44NzEwNywgMC45MjE3OSwgMC44MjExNCwgMC44MDk2LCAwLjg5NzEzLCAwLjk0NDM4LCAwLjk1MzUzLCAwLjk0MDgzLCAwLjkxOTA1LCAwLjkwNDA2LCAwLjk0NDYsIDAuOTQyOTIsIDEuMTg3NzcsIDAuOTQyOTIsIDEuMDIwNTgsIDAuODk5MDMsIDAuOTAwODgsIDAuOTQ5MzgsIDAuOTc4OTgsIDAuODEwOTMsIDAuOTc1NzEsIDAuOTQ5MzgsIDEuMDI0LCAwLjk1NzcsIDAuOTU5MzMsIDAuOTg2MjEsIDEuMDQ3NCwgMC45NzQ1NSwgMC45ODk4MSwgMC45NjcyLCAwLjk1OTMzLCAwLjk0NDYsIDAuOTc4OTgsIDAuOTc0MDcsIDAuOTc2NDYsIDAuNzgwMzYsIDEuMTAyMDgsIDAuOTU0NDIsIDAuOTUyOTgsIDAuOTc1NzksIDAuOTMzMiwgMC45NDAzOSwgMC45MzgsIDAuODA2ODcsIDEuMDExNDksIDAuODA2ODcsIDEuMDIwNTgsIDAuODA0NzksIDAuOTk3OTMsIDAuOTk3OTMsIDAuOTk3OTMsIDAuOTk3OTMsIDEuMDExNDksIDEuMDA4NzIsIDAuOTAwODgsIDAuOTE4ODIsIDEuMDIxMywgMC44MzYxLCAxLjAyMDU4LCAwLjYyMjk1LCAwLjU0MzI0LCAwLjg5MDIyLCAxLjA4NTk1LCAxLCAxLCAwLjkwMDg4LCAxLCAwLjk3NDU1LCAwLjkzNTgyLCAwLjkwMDg4LCAxLCAxLjA1Njg2LCAwLjgzNjEsIDAuOTk2NDIsIDAuOTk2NDIsIDAuOTk2NDIsIDAuNzI4NTEsIDAuOTA4MzgsIDAuOTA4MzgsIDAuOTA4MzgsIDAuOTA4MzgsIDAuOTA4MzgsIDAuOTA4MzgsIDAuODY4LCAwLjgyMzkxLCAwLjgwMDYxLCAwLjgwMDYxLCAwLjgwMDYxLCAwLjgwMDYxLCAxLjAyNTgsIDEuMDI1OCwgMS4wMjU4LCAxLjAyNTgsIDAuOTc0ODQsIDAuOTU1NDYsIDAuOTIxNzksIDAuOTIxNzksIDAuOTIxNzksIDAuOTIxNzksIDAuOTIxNzksIDEuMDIwNTgsIDAuOTIxNzksIDAuOTQ0MzgsIDAuOTQ0MzgsIDAuOTQ0MzgsIDAuOTQ0MzgsIDAuOTA0MDYsIDAuODY5NTgsIDAuOTgyMjUsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTAzMSwgMC44MTA5MywgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45ODYyMSwgMC45ODYyMSwgMC45ODYyMSwgMC45ODYyMSwgMC45Mzk2OSwgMC45NTkzMywgMC45NDQ2LCAwLjk0NDYsIDAuOTQ0NiwgMC45NDQ2LCAwLjk0NDYsIDEuMDg1OTUsIDAuOTQ0NiwgMC45NTQ0MiwgMC45NTQ0MiwgMC45NTQ0MiwgMC45NTQ0MiwgMC45NDAzOSwgMC45Nzg5OCwgMC45NDAzOSwgMC45MDgzOCwgMC45NDkzOCwgMC45MDgzOCwgMC45NDkzOCwgMC45MDgzOCwgMC45NDkzOCwgMC44MjM5MSwgMC44MTA5MywgMC44MjM5MSwgMC44MTA5MywgMC44MjM5MSwgMC44MTA5MywgMC44MjM5MSwgMC44MTA5MywgMC45NjM3NiwgMC44NDMxMywgMC45NzQ4NCwgMC45NzU3MSwgMC44MDA2MSwgMC45NDkzOCwgMC44MDA2MSwgMC45NDkzOCwgMC44MDA2MSwgMC45NDkzOCwgMC44MDA2MSwgMC45NDkzOCwgMC44MDA2MSwgMC45NDkzOCwgMC44NzY4LCAwLjk1NzcsIDAuODc2OCwgMC45NTc3LCAwLjg3NjgsIDAuOTU3NywgMSwgMSwgMC45NTQwNywgMC45NTkzMywgMC45NzA2OSwgMC45NTkzMywgMS4wMjU4LCAwLjk4NjIxLCAxLjAyNTgsIDAuOTg2MjEsIDEuMDI1OCwgMC45ODYyMSwgMS4wMjU4LCAwLjk4NjIxLCAxLjAyNTgsIDAuOTg2MjEsIDAuODg3LCAxLjAxNTkxLCAwLjczOTAxLCAxLjA0NzQsIDEsIDEsIDAuOTc0NTUsIDAuODM2NTUsIDAuOTg5ODEsIDEsIDEsIDAuODM2NTUsIDAuNzM5NzcsIDAuODM2NTUsIDAuNzM5MDMsIDAuODQ2MzgsIDEuMDMzLCAwLjk1NTQ2LCAwLjk1OTMzLCAxLCAxLCAwLjk1NTQ2LCAwLjk1OTMzLCAwLjgyNzEsIDAuOTU0MTcsIDAuOTU5MzMsIDAuOTIxNzksIDAuOTQ0NiwgMC45MjE3OSwgMC45NDQ2LCAwLjkyMTc5LCAwLjk0NDYsIDAuOTM2LCAwLjkxOTY0LCAwLjgyMTE0LCAwLjk3NjQ2LCAxLCAxLCAwLjgyMTE0LCAwLjk3NjQ2LCAwLjgwOTYsIDAuNzgwMzYsIDAuODA5NiwgMC43ODAzNiwgMSwgMSwgMC44MDk2LCAwLjc4MDM2LCAxLCAxLCAwLjg5NzEzLCAwLjc3NDUyLCAwLjg5NzEzLCAxLjEwMjA4LCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0MDgzLCAwLjk3NTc5LCAwLjkwNDA2LCAwLjk0MDM5LCAwLjkwNDA2LCAwLjk0NDYsIDAuOTM4LCAwLjk0NDYsIDAuOTM4LCAwLjk0NDYsIDAuOTM4LCAxLCAwLjk5NzkzLCAwLjkwODM4LCAwLjk0OTM4LCAwLjg2OCwgMC45MDMxLCAwLjkyMTc5LCAwLjk0NDYsIDEsIDEsIDAuODk3MTMsIDEuMTAyMDgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTA5ODksIDAuOTM1OCwgMC45MTk0NSwgMC44MzE4MSwgMC43NTI2MSwgMC44Nzk5MiwgMC44Mjk3NiwgMC45NjAzNCwgMC44MzY4OSwgMC45NzI2OCwgMS4wMDc4LCAwLjkwODM4LCAwLjgzNjM3LCAwLjgwMTksIDAuOTAxNTcsIDAuODAwNjEsIDAuOTQ0NiwgMC45NTQwNywgMC45MjQzNiwgMS4wMjU4LCAwLjg1MDIyLCAwLjk3MTUzLCAxLjAxNTYsIDAuOTU1NDYsIDAuODkxOTIsIDAuOTIxNzksIDAuOTIzNjEsIDAuODcxMDcsIDAuOTYzMTgsIDAuODk3MTMsIDAuOTM3MDQsIDAuOTU2MzgsIDAuOTE5MDUsIDAuOTE3MDksIDAuOTI3OTYsIDEuMDI1OCwgMC45MzcwNCwgMC45NDgzNiwgMS4wMzczLCAwLjk1OTMzLCAxLjAwNzgsIDAuOTU4NzEsIDAuOTQ4MzYsIDAuOTYxNzQsIDAuOTI2MDEsIDAuOTQ5OCwgMC45ODYwNywgMC45NTc3NiwgMC45NTkzMywgMS4wNTQ1MywgMS4wMDc4LCAwLjk4Mjc1LCAwLjkzMTQsIDAuOTU2MTcsIDAuOTE3MDEsIDEuMDU5OTMsIDAuOTQ0NiwgMC43ODM2NywgMC45NTUzLCAxLCAwLjg2ODMyLCAxLjAxMjgsIDAuOTU4NzEsIDAuOTkzOTQsIDAuODc1NDgsIDAuOTYzNjEsIDAuODY3NzQsIDEuMDA3OCwgMC45NTg3MSwgMC45NDQ2LCAwLjk1ODcxLCAwLjg2Nzc0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk0MDgzLCAwLjk3NTc5LCAwLjk0MDgzLCAwLjk3NTc5LCAwLjk0MDgzLCAwLjk3NTc5LCAwLjkwNDA2LCAwLjk0MDM5LCAwLjk2Njk0LCAxLCAwLjg5OTAzLCAxLCAxLCAxLCAwLjkzNTgyLCAwLjkzNTgyLCAwLjkzNTgyLCAxLCAwLjkwOCwgMC45MDgsIDAuOTE4LCAwLjk0MjE5LCAwLjk0MjE5LCAwLjk2NTQ0LCAxLCAxLjI4NSwgMSwgMSwgMC44MTA3OSwgMC44MTA3OSwgMSwgMSwgMC43NDg1NCwgMSwgMSwgMSwgMSwgMC45OTc5MywgMSwgMSwgMSwgMC42NSwgMSwgMS4zNjE0NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4xNzE3MywgMSwgMC44MDUzNSwgMC43NjE2OSwgMS4wMjA1OCwgMS4wNzMyLCAxLjA1NDg2LCAxLCAxLCAxLjMwNjkyLCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjE2MTYxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgTXlyaWFkUHJvQm9sZE1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9Owpjb25zdCBNeXJpYWRQcm9Cb2xkSXRhbGljRmFjdG9ycyA9IFsxLjM2ODk4LCAxLCAxLCAwLjY2MjI3LCAwLjgwNzc5LCAwLjgxNjI1LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3NzMzLCAwLjkyMjIyLCAwLjgzMjY2LCAwLjk0MjkyLCAwLjk0MjkyLCAxLjE2MTQ4LCAxLjAyMDU4LCAwLjkzNTgyLCAwLjk2Njk0LCAwLjkzNTgyLCAxLjE3MzM3LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjc4MDc2LCAwLjc4MDc2LCAxLjAyMDU4LCAxLjAyMDU4LCAxLjAyMDU4LCAwLjcxNTQxLCAwLjc2ODEzLCAwLjg1NTc2LCAwLjgwNTkxLCAwLjgwNzI5LCAwLjk0Mjk5LCAwLjc3NTEyLCAwLjgzNjU1LCAwLjg2NTIzLCAwLjkyMjIyLCAwLjk4NjIxLCAwLjcxNzQzLCAwLjgxNjk4LCAwLjc5NzI2LCAwLjk4NTU4LCAwLjkyMjIyLCAwLjkwNjM3LCAwLjgzODA5LCAwLjkwNjM3LCAwLjgwNzI5LCAwLjc2NDYzLCAwLjg2Mjc1LCAwLjkwNjk5LCAwLjkxNjA1LCAwLjkxNTQsIDAuODUzMDgsIDAuODU0NTgsIDAuOTA1MzEsIDAuOTQyOTIsIDEuMjEyOTYsIDAuOTQyOTIsIDEuMDIwNTgsIDAuODk5MDMsIDEuMTg2MTYsIDAuOTk2MTMsIDAuOTE2NzcsIDAuNzgyMTYsIDAuOTE2NzcsIDAuOTAwODMsIDAuOTg3OTYsIDAuOTEzNSwgMC45MjE2OCwgMC45NTM4MSwgMC45ODk4MSwgMC45NTI5OCwgMC45NTM4MSwgMC45MzQ1OSwgMC45MjE2OCwgMC45MTUxMywgMC45MjAwNCwgMC45MTY3NywgMC45NTA3NywgMC43NDgsIDEuMDQ1MDIsIDAuOTE2NzcsIDAuOTIwNjEsIDAuOTQyMzYsIDAuODk1NDQsIDAuODkzNjQsIDAuOSwgMC44MDY4NywgMC44NTc4LCAwLjgwNjg3LCAxLjAyMDU4LCAwLjgwNzc5LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjg1NzgsIDAuOTk5NzMsIDEuMTg2MTYsIDAuOTEzMzksIDEuMDgwNzQsIDAuODI4OTEsIDEuMDIwNTgsIDAuNTU1MDksIDAuNzE1MjYsIDAuODkwMjIsIDEuMDg1OTUsIDEsIDEsIDEuMTg2MTYsIDEsIDAuOTY3MzYsIDAuOTM1ODIsIDEuMTg2MTYsIDEsIDEuMDQ4NjQsIDAuODI3MTEsIDAuOTkwNDMsIDAuOTkwNDMsIDAuOTkwNDMsIDAuNzE1NDEsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODQ1LCAwLjgwNzI5LCAwLjc3NTEyLCAwLjc3NTEyLCAwLjc3NTEyLCAwLjc3NTEyLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk1OTYxLCAwLjkyMjIyLCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAxLjAyMDU4LCAwLjkwMjUxLCAwLjkwNjk5LCAwLjkwNjk5LCAwLjkwNjk5LCAwLjkwNjk5LCAwLjg1NDU4LCAwLjgzNjU5LCAwLjk0OTUxLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjg1ODExLCAwLjc4MjE2LCAwLjkwMDgzLCAwLjkwMDgzLCAwLjkwMDgzLCAwLjkwMDgzLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjkxMzUsIDAuOTIxNjgsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDEuMDg1OTUsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuODkzNjQsIDAuOTIzMzIsIDAuODkzNjQsIDAuODU1NzYsIDAuOTk2MTMsIDAuODU1NzYsIDAuOTk2MTMsIDAuODU1NzYsIDAuOTk2MTMsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuOTQyOTksIDAuNzY3ODMsIDAuOTU5NjEsIDAuOTE2NzcsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuODY1MjMsIDAuOTEzNSwgMC44NjUyMywgMC45MTM1LCAwLjg2NTIzLCAwLjkxMzUsIDEsIDEsIDAuOTIyMjIsIDAuOTIxNjgsIDAuOTIyMjIsIDAuOTIxNjgsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuODYwMzYsIDAuOTcwOTYsIDAuNzE3NDMsIDAuOTg5ODEsIDEsIDEsIDAuOTUyOTgsIDAuNzk3MjYsIDAuOTUzODEsIDEsIDEsIDAuNzk3MjYsIDAuNjg5NCwgMC43OTcyNiwgMC43NDMyMSwgMC44MTY5MSwgMS4wMDA2LCAwLjkyMjIyLCAwLjkyMTY4LCAxLCAxLCAwLjkyMjIyLCAwLjkyMTY4LCAwLjc5NDY0LCAwLjkyMDk4LCAwLjkyMTY4LCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwOSwgMC44NzUxNCwgMC44MDcyOSwgMC45NTA3NywgMSwgMSwgMC44MDcyOSwgMC45NTA3NywgMC43NjQ2MywgMC43NDgsIDAuNzY0NjMsIDAuNzQ4LCAxLCAxLCAwLjc2NDYzLCAwLjc0OCwgMSwgMSwgMC44NjI3NSwgMC43MjY1MSwgMC44NjI3NSwgMS4wNDUwMiwgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MTU0LCAwLjk0MjM2LCAwLjg1NDU4LCAwLjg5MzY0LCAwLjg1NDU4LCAwLjkwNTMxLCAwLjksIDAuOTA1MzEsIDAuOSwgMC45MDUzMSwgMC45LCAxLCAwLjk3Mjc2LCAwLjg1NTc2LCAwLjk5NjEzLCAwLjg0NSwgMC44NTgxMSwgMC45MDI1MSwgMC45MTY3NywgMSwgMSwgMC44NjI3NSwgMS4wNDUwMiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4wMDg5OSwgMS4zMDYyOCwgMC44NTU3NiwgMC44MDE3OCwgMC42Njg2MiwgMC43OTI3LCAwLjY5MzIzLCAwLjg4MTI3LCAwLjcyNDU5LCAwLjg5NzExLCAwLjk1MzgxLCAwLjg1NTc2LCAwLjgwNTkxLCAwLjc4MDUsIDAuOTQ3MjksIDAuNzc1MTIsIDAuOTA1MzEsIDAuOTIyMjIsIDAuOTA2MzcsIDAuOTg2MjEsIDAuODE2OTgsIDAuOTI2NTUsIDAuOTg1NTgsIDAuOTIyMjIsIDAuODUzNTksIDAuOTA2MzcsIDAuOTA5NzYsIDAuODM4MDksIDAuOTQ1MjMsIDAuODYyNzUsIDAuODM1MDksIDAuOTMxNTcsIDAuODUzMDgsIDAuODMzOTIsIDAuOTIzNDYsIDAuOTg2MjEsIDAuODM1MDksIDAuOTI4ODYsIDAuOTEzMjQsIDAuOTIxNjgsIDAuOTUzODEsIDAuOTA2NDYsIDAuOTI4ODYsIDAuOTA1NTcsIDAuODY4NDcsIDAuOTAyNzYsIDAuOTEzMjQsIDAuODY4NDIsIDAuOTIxNjgsIDAuOTk1MzEsIDAuOTUzODEsIDAuOTIyNCwgMC44NTQwOCwgMC45MjY5OSwgMC44Njg0NywgMS4wMDUxLCAwLjkxNTEzLCAwLjgwNDg3LCAwLjkzNDgxLCAxLCAwLjg4MTU5LCAxLjA1MjE0LCAwLjkwNjQ2LCAwLjk3MzU1LCAwLjgxNTM5LCAwLjg5Mzk4LCAwLjg1OTIzLCAwLjk1MzgxLCAwLjkwNjQ2LCAwLjkxNTEzLCAwLjkwNjQ2LCAwLjg1OTIzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkxNTQsIDAuOTQyMzYsIDAuOTE1NCwgMC45NDIzNiwgMC45MTU0LCAwLjk0MjM2LCAwLjg1NDU4LCAwLjg5MzY0LCAwLjk2Njk0LCAxLCAwLjg5OTAzLCAxLCAxLCAxLCAwLjkxNzgyLCAwLjkxNzgyLCAwLjkxNzgyLCAxLCAwLjg5NiwgMC44OTYsIDAuODk2LCAwLjkzMzIsIDAuOTMzMiwgMC45NTk3MywgMSwgMS4yNiwgMSwgMSwgMC44MDQ3OSwgMC44MDE3OCwgMSwgMSwgMC44NTYzMywgMSwgMSwgMSwgMSwgMC45NzI3NiwgMSwgMSwgMSwgMC42OTgsIDEsIDEuMzYxNDUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMTQ1NDIsIDEsIDAuNzkxOTksIDAuNzg2OTQsIDEuMDIwNTgsIDEuMDM0OTMsIDEuMDU0ODYsIDEsIDEsIDEuMjMwMjYsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMjAwMDYsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBNeXJpYWRQcm9Cb2xkSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIsCiAgbGluZUdhcDogMC4yCn07CmNvbnN0IE15cmlhZFByb0l0YWxpY0ZhY3RvcnMgPSBbMS4zNjg5OCwgMSwgMSwgMC42NTUwNywgMC44NDk0MywgMC44NTYzOSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44NjkzNiwgMC44ODMwNywgMC44Njk0OCwgMC44NTI4MywgMC44NTI4MywgMS4wNjM4MywgMS4wMjA1OCwgMC43NTk0NSwgMC45MjE5LCAwLjc1OTQ1LCAxLjE3MzM3LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjc1OTQ1LCAwLjc1OTQ1LCAxLjAyMDU4LCAxLjAyMDU4LCAxLjAyMDU4LCAwLjY5MDQ2LCAwLjcwOTI2LCAwLjg1MTU4LCAwLjc3ODEyLCAwLjc2ODUyLCAwLjg5NTkxLCAwLjcwNDY2LCAwLjc2MTI1LCAwLjgwMDk0LCAwLjg2ODIyLCAwLjgzODY0LCAwLjcyOCwgMC43NzIxMiwgMC43OTQ3NSwgMC45MzYzNywgMC44NzUxNCwgMC44NTg4LCAwLjc2MDEzLCAwLjg1ODgsIDAuNzI0MjEsIDAuNjk4NjYsIDAuNzc1OTgsIDAuODU5OTEsIDAuODA4MTEsIDAuODc4MzIsIDAuNzgxMTIsIDAuNzc1MTIsIDAuODU2MiwgMS4wMjIyLCAxLjE4NDE3LCAxLjAyMjIsIDEuMjcwMTQsIDAuODk5MDMsIDEuMTUwMTIsIDAuOTM4NTksIDAuOTQzOTksIDAuODQ2LCAwLjk0Mzk5LCAwLjgxNDUzLCAxLjAxODYsIDAuOTQyMTksIDAuOTYwMTcsIDEuMDMwNzUsIDEuMDIxNzUsIDAuOTEyLCAxLjAzMDc1LCAwLjk2OTk4LCAwLjk2MDE3LCAwLjkzODU5LCAwLjk0Mzk5LCAwLjk0Mzk5LCAwLjk1NDkzLCAwLjc0NiwgMS4xMjY1OCwgMC45NDU3OCwgMC45MSwgMC45NzksIDAuODgyLCAwLjg4MiwgMC44MywgMC44NTAzNCwgMC44MzUzNywgMC44NTAzNCwgMS4wMjA1OCwgMC43MDg2OSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44MzUzNywgMC45MDA4MywgMS4xNTAxMiwgMC45MTYxLCAwLjk0NTY1LCAwLjczNTQxLCAxLjAyMDU4LCAwLjUzNjA5LCAwLjY5MzUzLCAwLjc5NTE5LCAxLjA4NTk1LCAxLCAxLCAxLjE1MDEyLCAxLCAwLjkxOTc0LCAwLjc1OTQ1LCAxLjE1MDEyLCAxLCAwLjk0NDYsIDAuNzMzNjEsIDAuOTAwNSwgMC45MDA1LCAwLjkwMDUsIDAuNjI4NjQsIDAuODUxNTgsIDAuODUxNTgsIDAuODUxNTgsIDAuODUxNTgsIDAuODUxNTgsIDAuODUxNTgsIDAuNzczLCAwLjc2ODUyLCAwLjcwNDY2LCAwLjcwNDY2LCAwLjcwNDY2LCAwLjcwNDY2LCAwLjgzODY0LCAwLjgzODY0LCAwLjgzODY0LCAwLjgzODY0LCAwLjkwNTYxLCAwLjg3NTE0LCAwLjg1ODgsIDAuODU4OCwgMC44NTg4LCAwLjg1ODgsIDAuODU4OCwgMS4wMjA1OCwgMC44NTc1MSwgMC44NTk5MSwgMC44NTk5MSwgMC44NTk5MSwgMC44NTk5MSwgMC43NzUxMiwgMC43NjAxMywgMC44ODA3NSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC44MDc1LCAwLjg0NiwgMC44MTQ1MywgMC44MTQ1MywgMC44MTQ1MywgMC44MTQ1MywgMC44MjQyNCwgMC44MjQyNCwgMC44MjQyNCwgMC44MjQyNCwgMC45Mjc4LCAwLjk2MDE3LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAxLjA4NTk1LCAwLjg1NjIsIDAuOTQ1NzgsIDAuOTQ1NzgsIDAuOTQ1NzgsIDAuOTQ1NzgsIDAuODgyLCAwLjk0NTc4LCAwLjg4MiwgMC44NTE1OCwgMC45Mzg1OSwgMC44NTE1OCwgMC45Mzg1OSwgMC44NTE1OCwgMC45Mzg1OSwgMC43Njg1MiwgMC44NDYsIDAuNzY4NTIsIDAuODQ2LCAwLjc2ODUyLCAwLjg0NiwgMC43Njg1MiwgMC44NDYsIDAuODk1OTEsIDAuODU0NCwgMC45MDU2MSwgMC45NDM5OSwgMC43MDQ2NiwgMC44MTQ1MywgMC43MDQ2NiwgMC44MTQ1MywgMC43MDQ2NiwgMC44MTQ1MywgMC43MDQ2NiwgMC44MTQ1MywgMC43MDQ2NiwgMC44MTQ1MywgMC44MDA5NCwgMC45NDIxOSwgMC44MDA5NCwgMC45NDIxOSwgMC44MDA5NCwgMC45NDIxOSwgMSwgMSwgMC44NjgyMiwgMC45NjAxNywgMC44NjgyMiwgMC45NjAxNywgMC44Mzg2NCwgMC44MjQyNCwgMC44Mzg2NCwgMC44MjQyNCwgMC44Mzg2NCwgMC44MjQyNCwgMC44Mzg2NCwgMS4wMzA3NSwgMC44Mzg2NCwgMC44MjQyNCwgMC44MTQwMiwgMS4wMjczOCwgMC43MjgsIDEuMDIxNzUsIDEsIDEsIDAuOTEyLCAwLjc5NDc1LCAxLjAzMDc1LCAxLCAxLCAwLjc5NDc1LCAwLjgzOTExLCAwLjc5NDc1LCAwLjY2MjY2LCAwLjgwNTUzLCAxLjA2Njc2LCAwLjg3NTE0LCAwLjk2MDE3LCAxLCAxLCAwLjg3NTE0LCAwLjk2MDE3LCAwLjg2ODY1LCAwLjg3Mzk2LCAwLjk2MDE3LCAwLjg1ODgsIDAuOTM4NTksIDAuODU4OCwgMC45Mzg1OSwgMC44NTg4LCAwLjkzODU5LCAwLjg2NywgMC44NDc1OSwgMC43MjQyMSwgMC45NTQ5MywgMSwgMSwgMC43MjQyMSwgMC45NTQ5MywgMC42OTg2NiwgMC43NDYsIDAuNjk4NjYsIDAuNzQ2LCAxLCAxLCAwLjY5ODY2LCAwLjc0NiwgMSwgMSwgMC43NzU5OCwgMC44ODQxNywgMC43NzU5OCwgMS4xMjY1OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NzgzMiwgMC45NzksIDAuNzc1MTIsIDAuODgyLCAwLjc3NTEyLCAwLjg1NjIsIDAuODMsIDAuODU2MiwgMC44MywgMC44NTYyLCAwLjgzLCAxLCAwLjg4NDY1LCAwLjg1MTU4LCAwLjkzODU5LCAwLjc3MywgMC44MDc1LCAwLjg1NzUxLCAwLjg1NjIsIDEsIDEsIDAuNzc1OTgsIDEuMTI2NTgsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUzMTMsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMDgxMDYsIDEuMDM5MDEsIDAuODUxNTgsIDAuNzcwMjUsIDAuNjIyNjQsIDAuNzY0NiwgMC42NTM1MSwgMC44NjAyNiwgMC42OTQ2MSwgMC44OTk0NywgMS4wMzA3NSwgMC44NTE1OCwgMC43NzgxMiwgMC43NjQ0OSwgMC44ODgzNiwgMC43MDQ2NiwgMC44NTYyLCAwLjg2ODIyLCAwLjg1ODgsIDAuODM4NjQsIDAuNzcyMTIsIDAuODUzMDgsIDAuOTM2MzcsIDAuODc1MTQsIDAuODIzNTIsIDAuODU4OCwgMC44NTcwMSwgMC43NjAxMywgMC44OTA1OCwgMC43NzU5OCwgMC44MTU2LCAwLjgyNTY1LCAwLjc4MTEyLCAwLjc3ODk5LCAwLjg5Mzg2LCAwLjgzODY0LCAwLjgxNTYsIDAuOTQ4NiwgMC45MjM4OCwgMC45NjE4NiwgMS4wMzA3NSwgMC45MTEyMywgMC45NDg2LCAwLjkzMjk4LCAwLjg3OCwgMC45Mzk0MiwgMC45MjM4OCwgMC44NDU5NiwgMC45NjE4NiwgMC45NTExOSwgMS4wMzA3NSwgMC45MjIsIDAuODg3ODcsIDAuOTU4MjksIDAuODgsIDAuOTM1NTksIDAuOTM4NTksIDAuNzg4MTUsIDAuOTM3NTgsIDEsIDAuODkyMTcsIDEuMDM3MzcsIDAuOTExMjMsIDAuOTM5NjksIDAuNzc0ODcsIDAuODU3NjksIDAuODY3OTksIDEuMDMwNzUsIDAuOTExMjMsIDAuOTM4NTksIDAuOTExMjMsIDAuODY3OTksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODc4MzIsIDAuOTc5LCAwLjg3ODMyLCAwLjk3OSwgMC44NzgzMiwgMC45NzksIDAuNzc1MTIsIDAuODgyLCAwLjkyMTksIDEsIDAuODk5MDMsIDEsIDEsIDEsIDAuODczMjEsIDAuODczMjEsIDAuODczMjEsIDEsIDEuMDI3LCAxLjAyNywgMS4wMjcsIDAuODY4NDcsIDAuODY4NDcsIDAuNzkxMjEsIDEsIDEuMTI0LCAxLCAxLCAwLjczNTcyLCAwLjczNTcyLCAxLCAxLCAwLjg1MDM0LCAxLCAxLCAxLCAxLCAwLjg4NDY1LCAxLCAxLCAxLCAwLjY2OSwgMSwgMS4zNjE0NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNDgyOCwgMSwgMC43NDk0OCwgMC43NTE4NywgMS4wMjA1OCwgMC45ODM5MSwgMS4wMjExOSwgMSwgMSwgMS4wNjIzMywgMS4wODU5NSwgMS4wODU5NSwgMSwgMS4wODU5NSwgMS4wODU5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNTIzMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IE15cmlhZFByb0l0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9Owpjb25zdCBNeXJpYWRQcm9SZWd1bGFyRmFjdG9ycyA9IFsxLjM2ODk4LCAxLCAxLCAwLjc2MzA1LCAwLjgyNzg0LCAwLjk0OTM1LCAwLjg5MzY0LCAwLjkyMjQxLCAwLjg5MDczLCAwLjkwNzA2LCAwLjk4NDcyLCAwLjg1MjgzLCAwLjg1MjgzLCAxLjA2NjQsIDEuMDIwNTgsIDAuNzQ1MDUsIDAuOTIxOSwgMC43NDUwNSwgMS4yMzQ1NiwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC43NDUwNSwgMC43NDUwNSwgMS4wMjA1OCwgMS4wMjA1OCwgMS4wMjA1OCwgMC43MzAwMiwgMC43MjYwMSwgMC45MTc1NSwgMC44MTI2LCAwLjgwMzE0LCAwLjkyMjIyLCAwLjczNzY0LCAwLjc5NzI2LCAwLjgzMDUxLCAwLjkwMjg0LCAwLjg2MDIzLCAwLjc0LCAwLjgxMjYsIDAuODQ4NjksIDAuOTY1MTgsIDAuOTExMTUsIDAuODg1OCwgMC43OTc2MSwgMC44ODU4LCAwLjc0NDk4LCAwLjczOTE0LCAwLjgxMzYzLCAwLjg5NTkxLCAwLjgzNjU5LCAwLjg5NjMzLCAwLjg1NjA4LCAwLjgxMTEsIDAuOTA1MzEsIDEuMDIyMiwgMS4yMjczNiwgMS4wMjIyLCAxLjI3MDE0LCAwLjg5OTAzLCAwLjkwMDg4LCAwLjg2NjY3LCAxLjAyMzEsIDAuODk2LCAxLjAxNDExLCAwLjkwMDgzLCAxLjA1MDk5LCAxLjAwNTEyLCAwLjk5NzkzLCAxLjA1MzI2LCAxLjA5Mzc3LCAwLjkzOCwgMS4wNjIyNiwgMS4wMDExOSwgMC45OTc5MywgMC45ODcxNCwgMS4wMjMxLCAxLjAxMjMxLCAwLjk4MTk2LCAwLjc5MiwgMS4xOTEzNywgMC45OTA3NCwgMC45NjIsIDEuMDE5MTUsIDAuOTI2LCAwLjk0MiwgMC44NTYsIDAuODUwMzQsIDAuOTIwMDYsIDAuODUwMzQsIDEuMDIwNTgsIDAuNjkwNjcsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIwMDYsIDAuOTMzMiwgMC45MDA4OCwgMC45MTg4MiwgMC45MzQ4NCwgMC43NTMzOSwgMS4wMjA1OCwgMC41Njg2NiwgMC41NDMyNCwgMC43OTUxOSwgMS4wODU5NSwgMSwgMSwgMC45MDA4OCwgMSwgMC45NTMyNSwgMC43NDUwNSwgMC45MDA4OCwgMSwgMC45NzE5OCwgMC43NTMzOSwgMC45MTAwOSwgMC45MTAwOSwgMC45MTAwOSwgMC42NjQ2NiwgMC45MTc1NSwgMC45MTc1NSwgMC45MTc1NSwgMC45MTc1NSwgMC45MTc1NSwgMC45MTc1NSwgMC43ODgsIDAuODAzMTQsIDAuNzM3NjQsIDAuNzM3NjQsIDAuNzM3NjQsIDAuNzM3NjQsIDAuODYwMjMsIDAuODYwMjMsIDAuODYwMjMsIDAuODYwMjMsIDAuOTI5MTUsIDAuOTExMTUsIDAuODg1OCwgMC44ODU4LCAwLjg4NTgsIDAuODg1OCwgMC44ODU4LCAxLjAyMDU4LCAwLjg4NTgsIDAuODk1OTEsIDAuODk1OTEsIDAuODk1OTEsIDAuODk1OTEsIDAuODExMSwgMC43OTYxMSwgMC44OTcxMywgMC44NjY2NywgMC44NjY2NywgMC44NjY2NywgMC44NjY2NywgMC44NjY2NywgMC44NjY2NywgMC44NjkzNiwgMC44OTYsIDAuOTAwODMsIDAuOTAwODMsIDAuOTAwODMsIDAuOTAwODMsIDAuODQyMjQsIDAuODQyMjQsIDAuODQyMjQsIDAuODQyMjQsIDAuOTcyNzYsIDAuOTk3OTMsIDAuOTg3MTQsIDAuOTg3MTQsIDAuOTg3MTQsIDAuOTg3MTQsIDAuOTg3MTQsIDEuMDg1OTUsIDAuODk4NzYsIDAuOTkwNzQsIDAuOTkwNzQsIDAuOTkwNzQsIDAuOTkwNzQsIDAuOTQyLCAxLjAyMzEsIDAuOTQyLCAwLjkxNzU1LCAwLjg2NjY3LCAwLjkxNzU1LCAwLjg2NjY3LCAwLjkxNzU1LCAwLjg2NjY3LCAwLjgwMzE0LCAwLjg5NiwgMC44MDMxNCwgMC44OTYsIDAuODAzMTQsIDAuODk2LCAwLjgwMzE0LCAwLjg5NiwgMC45MjIyMiwgMC45MzM3MiwgMC45MjkxNSwgMS4wMTQxMSwgMC43Mzc2NCwgMC45MDA4MywgMC43Mzc2NCwgMC45MDA4MywgMC43Mzc2NCwgMC45MDA4MywgMC43Mzc2NCwgMC45MDA4MywgMC43Mzc2NCwgMC45MDA4MywgMC44MzA1MSwgMS4wMDUxMiwgMC44MzA1MSwgMS4wMDUxMiwgMC44MzA1MSwgMS4wMDUxMiwgMSwgMSwgMC45MDI4NCwgMC45OTc5MywgMC45MDk3NiwgMC45OTc5MywgMC44NjAyMywgMC44NDIyNCwgMC44NjAyMywgMC44NDIyNCwgMC44NjAyMywgMC44NDIyNCwgMC44NjAyMywgMS4wNTMyNiwgMC44NjAyMywgMC44NDIyNCwgMC44Mjg3MywgMS4wNzQ2OSwgMC43NCwgMS4wOTM3NywgMSwgMSwgMC45MzgsIDAuODQ4NjksIDEuMDYyMjYsIDEsIDEsIDAuODQ4NjksIDAuODM3MDQsIDAuODQ4NjksIDAuODE0NDEsIDAuODU1ODgsIDEuMDg5MjcsIDAuOTExMTUsIDAuOTk3OTMsIDEsIDEsIDAuOTExMTUsIDAuOTk3OTMsIDAuOTE4ODcsIDAuOTA5OTEsIDAuOTk3OTMsIDAuODg1OCwgMC45ODcxNCwgMC44ODU4LCAwLjk4NzE0LCAwLjg4NTgsIDAuOTg3MTQsIDAuODk0LCAwLjkxNDM0LCAwLjc0NDk4LCAwLjk4MTk2LCAxLCAxLCAwLjc0NDk4LCAwLjk4MTk2LCAwLjczOTE0LCAwLjc5MiwgMC43MzkxNCwgMC43OTIsIDEsIDEsIDAuNzM5MTQsIDAuNzkyLCAxLCAxLCAwLjgxMzYzLCAwLjkwNCwgMC44MTM2MywgMS4xOTEzNywgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTYzMywgMS4wMTkxNSwgMC44MTExLCAwLjk0MiwgMC44MTExLCAwLjkwNTMxLCAwLjg1NiwgMC45MDUzMSwgMC44NTYsIDAuOTA1MzEsIDAuODU2LCAxLCAwLjkyMjQxLCAwLjkxNzU1LCAwLjg2NjY3LCAwLjc4OCwgMC44NjkzNiwgMC44ODU4LCAwLjg5ODc2LCAxLCAxLCAwLjgxMzYzLCAxLjE5MTM3LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMzg4LCAxLjAzOTAxLCAwLjkyMTM4LCAwLjc4MTA1LCAwLjcxNTQsIDAuODYxNjksIDAuODA1MTMsIDAuOTQwMDcsIDAuODI1MjgsIDAuOTg2MTIsIDEuMDYyMjYsIDAuOTE3NTUsIDAuODEyNiwgMC44MTg4NCwgMC45MjgxOSwgMC43Mzc2NCwgMC45MDUzMSwgMC45MDI4NCwgMC44ODU4LCAwLjg2MDIzLCAwLjgxMjYsIDAuOTExNzIsIDAuOTY1MTgsIDAuOTExMTUsIDAuODMwODksIDAuODg1OCwgMC44Nzc5MSwgMC43OTc2MSwgMC44OTI5NywgMC44MTM2MywgMC44ODE1NywgMC44OTk5MiwgMC44NTYwOCwgMC44MTk5MiwgMC45NDMwNywgMC44NjAyMywgMC44ODE1NywgMC45NTMwOCwgMC45ODY5OSwgMC45OTc5MywgMS4wNjIyNiwgMC45NTgxNywgMC45NTMwOCwgMC45NzM1OCwgMC45MjgsIDAuOTgwODgsIDAuOTg2OTksIDAuOTI3NjEsIDAuOTk3OTMsIDAuOTYwMTcsIDEuMDYyMjYsIDAuOTg2LCAwLjk0NCwgMC45NTk3OCwgMC45MzgsIDAuOTY3MDUsIDAuOTg3MTQsIDAuODA0NDIsIDAuOTg5NzIsIDEsIDAuODk3NjIsIDEuMDQ1NTIsIDAuOTU4MTcsIDAuOTkwMDcsIDAuODcwNjQsIDAuOTE4NzksIDAuODg4ODgsIDEuMDYyMjYsIDAuOTU4MTcsIDAuOTg3MTQsIDAuOTU4MTcsIDAuODg4ODgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODk2MzMsIDEuMDE5MTUsIDAuODk2MzMsIDEuMDE5MTUsIDAuODk2MzMsIDEuMDE5MTUsIDAuODExMSwgMC45NDIsIDAuOTIxOSwgMSwgMC44OTkwMywgMSwgMSwgMSwgMC45MzE3MywgMC45MzE3MywgMC45MzE3MywgMSwgMS4wNjMwNCwgMS4wNjMwNCwgMS4wNjkwNCwgMC44OTkwMywgMC44OTkwMywgMC44MDU0OSwgMSwgMS4xNTYsIDEsIDEsIDAuNzY1NzUsIDAuNzY1NzUsIDEsIDEsIDAuNzI0NTgsIDEsIDEsIDEsIDEsIDAuOTIyNDEsIDEsIDEsIDEsIDAuNjE5LCAxLCAxLjM2MTQ1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA3MjU3LCAxLCAwLjc0NzA1LCAwLjcxMTE5LCAxLjAyMDU4LCAxLjAyNCwgMS4wMjExOSwgMSwgMSwgMS4xNTM2LCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA1NjM4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgTXlyaWFkUHJvUmVndWxhck1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9OwoKOy8vIC4vc3JjL2NvcmUvc2Vnb2V1aV9mYWN0b3JzLmpzCmNvbnN0IFNlZ29ldWlCb2xkRmFjdG9ycyA9IFsxLjc2NzM4LCAxLCAxLCAwLjk5Mjk3LCAwLjk4MjQsIDEuMDQwMTYsIDEuMDY0OTcsIDEuMDM0MjQsIDAuOTc1MjksIDEuMTc2NDcsIDEuMjMyMDMsIDEuMTA4NSwgMS4xMDg1LCAxLjE2OTM5LCAxLjIxMDcsIDAuOTc1NCwgMS4yMTQwOCwgMC45NzU0LCAxLjU5NTc4LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAwLjgxMzc4LCAwLjgxMzc4LCAxLjIxMDcsIDEuMjEwNywgMS4yMTA3LCAwLjcxNzAzLCAwLjk3ODQ3LCAwLjk3MzYzLCAwLjg4Nzc2LCAwLjg2NDEsIDEuMDIwOTYsIDAuNzk3OTUsIDAuODUxMzIsIDAuOTE0LCAxLjA2MDg1LCAxLjE0MDYsIDAuODAwNywgMC44OTg1OCwgMC44MzY5MywgMS4xNDg4OSwgMS4wOTM5OCwgMC45NzQ4OSwgMC45MjA5NCwgMC45NzQ4OSwgMC45MDM5OSwgMC44NDA0MSwgMC45NTkyMywgMS4wMDEzNSwgMSwgMS4wNjQ2NywgMC45ODI0MywgMC45MDk5NiwgMC45OTM2MSwgMS4xMDg1LCAxLjU2OTQyLCAxLjEwODUsIDEuMjEwNywgMC43NDYyNywgMC45NDI4MiwgMC45Njc1MiwgMS4wMTUxOSwgMC44NjMwNCwgMS4wMTM1OSwgMC45NzI3OCwgMS4xNTEwMywgMS4wMTM1OSwgMC45ODU2MSwgMS4wMjI4NSwgMS4wMjI4NSwgMS4wMDUyNywgMS4wMjI4NSwgMS4wMzAyLCAwLjk5MDQxLCAxLjAwMDgsIDEuMDE1MTksIDEuMDEzNTksIDEuMDIyNTgsIDAuNzkxMDQsIDEuMTY4NjIsIDAuOTkwNDEsIDAuOTc0NTQsIDEuMDI1MTEsIDAuOTkyOTgsIDAuOTY3NTIsIDAuOTU4MDEsIDAuOTQ4NTYsIDEuMTY1NzksIDAuOTQ4NTYsIDEuMjEwNywgMC45ODI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLCAxLjAzNDI0LCAxLjE2NTc5LCAwLjg3MjcsIDEuMzg3MSwgMS4xODYyMiwgMS4xMDgxOCwgMS4wNDQ3OCwgMS4yMTA3LCAxLjE4NjIyLCAwLjc1MTU1LCAwLjk0OTk0LCAxLjI4ODI2LCAxLjIxNDA4LCAxLjIxNDA4LCAwLjkxMDU2LCAxLCAwLjkxNTcyLCAwLjk3NTQsIDAuNjQ2NjMsIDEuMTgzMjgsIDEuMjQ4NjYsIDEuMDQ0NzgsIDEuMTQxNjksIDEuMTU3NDksIDEuMTczODksIDAuNzE3MDMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTM1MDYsIDAuODY0MSwgMC43OTc5NSwgMC43OTc5NSwgMC43OTc5NSwgMC43OTc5NSwgMS4xNDA2LCAxLjE0MDYsIDEuMTQwNiwgMS4xNDA2LCAxLjAyMDk2LCAxLjA5Mzk4LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAxLjIxMDcsIDAuOTc0ODksIDEuMDAxMzUsIDEuMDAxMzUsIDEuMDAxMzUsIDEuMDAxMzUsIDAuOTA5OTYsIDAuOTIwOTQsIDEuMDI3OTgsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTMxMzYsIDAuODYzMDQsIDAuOTcyNzgsIDAuOTcyNzgsIDAuOTcyNzgsIDAuOTcyNzgsIDEuMDIyODUsIDEuMDIyODUsIDEuMDIyODUsIDEuMDIyODUsIDAuOTcxMjIsIDAuOTkwNDEsIDEsIDEsIDEsIDEsIDEsIDEuMjg4MjYsIDEuMDAwOCwgMC45OTA0MSwgMC45OTA0MSwgMC45OTA0MSwgMC45OTA0MSwgMC45Njc1MiwgMS4wMTUxOSwgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC44NjQxLCAwLjg2MzA0LCAwLjg2NDEsIDAuODYzMDQsIDAuODY0MSwgMC44NjMwNCwgMC44NjQxLCAwLjg2MzA0LCAxLjAyMDk2LCAxLjAzMDU3LCAxLjAyMDk2LCAxLjAzNTE3LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjkxNCwgMS4wMTM1OSwgMC45MTQsIDEuMDEzNTksIDAuOTE0LCAxLjAxMzU5LCAxLCAxLCAxLjA2MDg1LCAwLjk4NTYxLCAxLjA2MDg1LCAxLjAwODc5LCAxLjE0MDYsIDEuMDIyODUsIDEuMTQwNiwgMS4wMjI4NSwgMS4xNDA2LCAxLjAyMjg1LCAxLjE0MDYsIDEuMDIyODUsIDEuMTQwNiwgMS4wMjI4NSwgMC45NzEzOCwgMS4wODY5MiwgMC44MDA3LCAxLjAyMjg1LCAxLCAxLCAxLjAwNTI3LCAwLjgzNjkzLCAxLjAyMjg1LCAxLCAxLCAwLjgzNjkzLCAwLjk0NTUsIDAuODM2OTMsIDAuOTA0MTgsIDAuODM2OTMsIDEuMTMwMDUsIDEuMDkzOTgsIDAuOTkwNDEsIDEsIDEsIDEuMDkzOTgsIDAuOTkwNDEsIDAuOTY2OTIsIDEuMDkyNTEsIDAuOTkwNDEsIDAuOTc0ODksIDEuMDAwOCwgMC45NzQ4OSwgMS4wMDA4LCAwLjk3NDg5LCAxLjAwMDgsIDAuOTM5OTQsIDAuOTc5MzEsIDAuOTAzOTksIDEuMDIyNTgsIDEsIDEsIDAuOTAzOTksIDEuMDIyNTgsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDEsIDEsIDAuOTU5MjMsIDEuMDcwMzQsIDAuOTU5MjMsIDEuMTY4NjIsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDY0NjcsIDEuMDI1MTEsIDAuOTA5OTYsIDAuOTY3NTIsIDAuOTA5OTYsIDAuOTkzNjEsIDAuOTU4MDEsIDAuOTkzNjEsIDAuOTU4MDEsIDAuOTkzNjEsIDAuOTU4MDEsIDEuMDc3MzMsIDEuMDM0MjQsIDAuOTczNjMsIDAuOTY3NTIsIDAuOTM1MDYsIDAuOTMxMzYsIDAuOTc0ODksIDEuMDAwOCwgMSwgMSwgMC45NTkyMywgMS4xNjg2MiwgMS4xNTEwMywgMS4xNTEwMywgMS4wMTE3MywgMS4wMzk1OSwgMC43NTk1MywgMC44MTM3OCwgMC43OTkxMiwgMS4xNTEwMywgMS4yMTk5NCwgMC45NTE2MSwgMC44NzgxNSwgMS4wMTE0OSwgMC44MTUyNSwgMC43Njc2LCAwLjk4MTY3LCAxLjAxMTM0LCAxLjAyNTQ2LCAwLjg0MDk3LCAxLjAzMDg5LCAxLjE4MTAyLCAwLjk3MzYzLCAwLjg4Nzc2LCAwLjg1MTM0LCAwLjk3ODI2LCAwLjc5Nzk1LCAwLjk5MzYxLCAxLjA2MDg1LCAwLjk3NDg5LCAxLjE0MDYsIDAuODk4NTgsIDEuMDM4OCwgMS4xNDg4OSwgMS4wOTM5OCwgMC44NjAzOSwgMC45NzQ4OSwgMS4wNTk1LCAwLjkyMDk0LCAwLjk0NzkzLCAwLjk1OTIzLCAwLjkwOTk2LCAwLjk5MzQ2LCAwLjk4MjQzLCAxLjAyMTEyLCAwLjk1NDkzLCAxLjE0MDYsIDAuOTA5OTYsIDEuMDM1NzQsIDEuMDI1OTcsIDEuMDAwOCwgMS4xODEwMiwgMS4wNjYyOCwgMS4wMzU3NCwgMS4wMTkyLCAxLjAxOTMyLCAxLjAwODg2LCAwLjk3NTMxLCAxLjAxMDYsIDEuMDAwOCwgMS4xMzE4OSwgMS4xODEwMiwgMS4wMjI3NywgMC45ODY4MywgMS4wMDE2LCAwLjk5NTYxLCAxLjA3MjM3LCAxLjAwMDgsIDAuOTA0MzQsIDAuOTk5MjEsIDAuOTM4MDMsIDAuODk2NSwgMS4yMzA4NSwgMS4wNjYyOCwgMS4wNDk4MywgMC45NjI2OCwgMS4wNDk5LCAwLjk4NDM5LCAxLjE4MTAyLCAxLjA2NjI4LCAxLjAwMDgsIDEuMDY2MjgsIDAuOTg0MzksIDAuNzk3OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDk0NjYsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTcyNzgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDIwNjUsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDY0NjcsIDEuMDI1MTEsIDEuMDY0NjcsIDEuMDI1MTEsIDEuMDY0NjcsIDEuMDI1MTEsIDAuOTA5OTYsIDAuOTY3NTIsIDEsIDEuMjE0MDgsIDAuODk5MDMsIDEsIDEsIDAuNzUxNTUsIDEuMDQzOTQsIDEuMDQzOTQsIDEuMDQzOTQsIDEuMDQzOTQsIDAuOTg2MzMsIDAuOTg2MzMsIDAuOTg2MzMsIDAuNzMwNDcsIDAuNzMwNDcsIDEuMjA2NDIsIDAuOTEyMTEsIDEuMjU2MzUsIDEuMjIyLCAxLjAyOTU2LCAxLjAzMzcyLCAxLjAzMzcyLCAwLjk2MDM5LCAxLjI0NjMzLCAxLCAxLjEyNDU0LCAwLjkzNTAzLCAxLjAzNDI0LCAxLjE5Njg3LCAxLjAzNDI0LCAxLCAxLCAxLCAwLjc3MSwgMSwgMSwgMS4xNTc0OSwgMS4xNTc0OSwgMS4xNTc0OSwgMS4xMDk0OCwgMC44NjI3OSwgMC45NDQzNCwgMC44NjI3OSwgMC45NDQzNCwgMC44NjE4MiwgMSwgMSwgMS4xNjg5NywgMSwgMC45NjA4NSwgMC45MDEzNywgMS4yMTA3LCAxLjE4NDE2LCAxLjEzOTczLCAwLjY5ODI1LCAwLjk3MTYsIDIuMTAzMzksIDEuMjkwMDQsIDEuMjkwMDQsIDEuMjExNzIsIDEuMjkwMDQsIDEuMjkwMDQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuNDI2MDMsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDEuMTg4NzQsIDEuNDI2MDMsIDEsIDEuNDI2MDMsIDEuNDI2MDMsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMjg4NiwgMS4wNDMxNSwgMS4xNTI5NiwgMS4zNDE2MywgMSwgMSwgMSwgMS4wOTE5MywgMS4wOTE5MywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IFNlZ29ldWlCb2xkTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjMzMDA4LAogIGxpbmVHYXA6IDAKfTsKY29uc3QgU2Vnb2V1aUJvbGRJdGFsaWNGYWN0b3JzID0gWzEuNzY3MzgsIDEsIDEsIDAuOTg5NDYsIDEuMDM5NTksIDEuMDQwMTYsIDEuMDI4MDksIDEuMDM2LCAwLjk3NjM5LCAxLjEwOTUzLCAxLjIzMjAzLCAxLjExMTQ0LCAxLjExMTQ0LCAxLjE2OTM5LCAxLjIxMjM3LCAwLjk3NTQsIDEuMjEyNjEsIDAuOTc1NCwgMS41OTc1NCwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDAuODEzNzgsIDAuODEzNzgsIDEuMjEyMzcsIDEuMjEyMzcsIDEuMjEyMzcsIDAuNzM1NDEsIDAuOTc4NDcsIDAuOTczNjMsIDAuODk3MjMsIDAuODc4OTcsIDEuMDQyNiwgMC43OTQyOSwgMC44NTI5MiwgMC45MTE0OSwgMS4wNTgxNSwgMS4xNDA2LCAwLjc5NjMxLCAwLjkwMTI4LCAwLjgzODUzLCAxLjA0Mzk2LCAxLjEwNjE1LCAwLjk3NTUyLCAwLjk0NDM2LCAwLjk3NTUyLCAwLjg4NjQxLCAwLjgwNTI3LCAwLjk2MDgzLCAxLjAwMTM1LCAxLCAxLjA2Nzc3LCAwLjk4MTcsIDAuOTExNDIsIDAuOTkzNjEsIDEuMTExNDQsIDEuNTcyOTMsIDEuMTExNDQsIDEuMjEyMzcsIDAuNzQ2MjcsIDEuMzE4MTgsIDEuMDY1ODUsIDAuOTcwNDIsIDAuODMwNTUsIDAuOTcwNDIsIDAuOTM1MDMsIDEuMTI2MSwgMC45NzA0MiwgMC45NzkyMiwgMS4xNDIzNiwgMC45NDU1MiwgMS4wMTA1NCwgMS4xNDIzNiwgMS4wMjQ3MSwgMC45NzkyMiwgMC45NDE2NSwgMC45NzA0MiwgMC45NzA0MiwgMS4wMjc2LCAwLjc4OTI5LCAxLjEyNjEsIDAuOTc5MjIsIDAuOTU4NzQsIDEuMDIxOTcsIDAuOTg1MDcsIDAuOTY3NTIsIDAuOTcxNjgsIDAuOTUxMDcsIDEuMTY1NzksIDAuOTUxMDcsIDEuMjEyMzcsIDEuMDM5NTksIDEuMDM2LCAxLjAzNiwgMSwgMS4wMzYsIDEuMTY1NzksIDAuODczNTcsIDEuMzE4MTgsIDEuMTg3NTQsIDEuMjY3ODEsIDEuMDUzNTYsIDEuMjEyMzcsIDEuMTg2MjIsIDAuNzk0ODcsIDAuOTQ5OTQsIDEuMjkwMDQsIDEuMjQwNDcsIDEuMjQwNDcsIDEuMzE4MTgsIDEsIDAuOTE0ODQsIDAuOTc1NCwgMS4zMTgxOCwgMS4xMzQ5LCAxLjI0ODY2LCAxLjA1MzU2LCAxLjEzOTM0LCAxLjE1NTc0LCAxLjE3Mzg5LCAwLjczNTQxLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk0Mzg1LCAwLjg3ODk3LCAwLjc5NDI5LCAwLjc5NDI5LCAwLjc5NDI5LCAwLjc5NDI5LCAxLjE0MDYsIDEuMTQwNiwgMS4xNDA2LCAxLjE0MDYsIDEuMDQyNiwgMS4xMDYxNSwgMC45NzU1MiwgMC45NzU1MiwgMC45NzU1MiwgMC45NzU1MiwgMC45NzU1MiwgMS4yMTIzNywgMC45NzU1MiwgMS4wMDEzNSwgMS4wMDEzNSwgMS4wMDEzNSwgMS4wMDEzNSwgMC45MTE0MiwgMC45NDQzNiwgMC45ODcyMSwgMS4wNjU4NSwgMS4wNjU4NSwgMS4wNjU4NSwgMS4wNjU4NSwgMS4wNjU4NSwgMS4wNjU4NSwgMC45NjcwNSwgMC44MzA1NSwgMC45MzUwMywgMC45MzUwMywgMC45MzUwMywgMC45MzUwMywgMS4xNDIzNiwgMS4xNDIzNiwgMS4xNDIzNiwgMS4xNDIzNiwgMC45MzEyNSwgMC45NzkyMiwgMC45NDE2NSwgMC45NDE2NSwgMC45NDE2NSwgMC45NDE2NSwgMC45NDE2NSwgMS4yOTAwNCwgMC45NDE2NSwgMC45NzkyMiwgMC45NzkyMiwgMC45NzkyMiwgMC45NzkyMiwgMC45Njc1MiwgMC45NzA0MiwgMC45Njc1MiwgMC45NzM2MywgMS4wNjU4NSwgMC45NzM2MywgMS4wNjU4NSwgMC45NzM2MywgMS4wNjU4NSwgMC44Nzg5NywgMC44MzA1NSwgMC44Nzg5NywgMC44MzA1NSwgMC44Nzg5NywgMC44MzA1NSwgMC44Nzg5NywgMC44MzA1NSwgMS4wNDI2LCAxLjAwMzMsIDEuMDQyNiwgMC45NzA0MiwgMC43OTQyOSwgMC45MzUwMywgMC43OTQyOSwgMC45MzUwMywgMC43OTQyOSwgMC45MzUwMywgMC43OTQyOSwgMC45MzUwMywgMC43OTQyOSwgMC45MzUwMywgMC45MTE0OSwgMC45NzA0MiwgMC45MTE0OSwgMC45NzA0MiwgMC45MTE0OSwgMC45NzA0MiwgMSwgMSwgMS4wNTgxNSwgMC45NzkyMiwgMS4wNTgxNSwgMC45NzkyMiwgMS4xNDA2LCAxLjE0MjM2LCAxLjE0MDYsIDEuMTQyMzYsIDEuMTQwNiwgMS4xNDIzNiwgMS4xNDA2LCAxLjE0MjM2LCAxLjE0MDYsIDEuMTQyMzYsIDAuOTc0NDEsIDEuMDQzMDIsIDAuNzk2MzEsIDEuMDE1ODIsIDEsIDEsIDEuMDEwNTQsIDAuODM4NTMsIDEuMTQyMzYsIDEsIDEsIDAuODM4NTMsIDEuMDkxMjUsIDAuODM4NTMsIDAuOTA0MTgsIDAuODM4NTMsIDEuMTk1MDgsIDEuMTA2MTUsIDAuOTc5MjIsIDEsIDEsIDEuMTA2MTUsIDAuOTc5MjIsIDEuMDEwMzQsIDEuMTA0NjYsIDAuOTc5MjIsIDAuOTc1NTIsIDAuOTQxNjUsIDAuOTc1NTIsIDAuOTQxNjUsIDAuOTc1NTIsIDAuOTQxNjUsIDAuOTE2MDIsIDAuOTE5ODEsIDAuODg2NDEsIDEuMDI3NiwgMSwgMSwgMC44ODY0MSwgMS4wMjc2LCAwLjgwNTI3LCAwLjc4OTI5LCAwLjgwNTI3LCAwLjc4OTI5LCAwLjgwNTI3LCAwLjc4OTI5LCAwLjgwNTI3LCAwLjc4OTI5LCAxLCAxLCAwLjk2MDgzLCAxLjA1NDAzLCAwLjk1OTIzLCAxLjE2ODYyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjA2Nzc3LCAxLjAyMTk3LCAwLjkxMTQyLCAwLjk2NzUyLCAwLjkxMTQyLCAwLjk5MzYxLCAwLjk3MTY4LCAwLjk5MzYxLCAwLjk3MTY4LCAwLjk5MzYxLCAwLjk3MTY4LCAxLjIzMTk5LCAxLjAzNiwgMC45NzM2MywgMS4wNjU4NSwgMC45NDM4NSwgMC45NjcwNSwgMC45NzU1MiwgMC45NDE2NSwgMSwgMSwgMC45NjA4MywgMS4xMjYxLCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAwLjk1MTYxLCAxLjI3MTI2LCAxLjAwODExLCAwLjgzMjg0LCAwLjc3NzAyLCAwLjk5MTM3LCAwLjk1MjUzLCAxLjAzNDcsIDAuODYxNDIsIDEuMDcyMDUsIDEuMTQyMzYsIDAuOTczNjMsIDAuODk3MjMsIDAuODY4NjksIDEuMDk4MTgsIDAuNzk0MjksIDAuOTkzNjEsIDEuMDU4MTUsIDAuOTc1NTIsIDEuMTQwNiwgMC45MDEyOCwgMS4wNjY2MiwgMS4wNDM5NiwgMS4xMDYxNSwgMC44NDkxOCwgMC45NzU1MiwgMS4wNDY5NCwgMC45NDQzNiwgMC45ODAxNSwgMC45NjA4MywgMC45MTE0MiwgMS4wMDM1NiwgMC45ODE3LCAxLjAxOTQ1LCAwLjk4OTk5LCAxLjE0MDYsIDAuOTExNDIsIDEuMDQ5NjEsIDAuOTg5OCwgMS4wMDYzOSwgMS4xNDIzNiwgMS4wNzUxNCwgMS4wNDk2MSwgMC45OTYwNywgMS4wMjg5NywgMS4wMDgsIDAuOTg5OCwgMC45NTEzNCwgMS4wMDYzOSwgMS4xMTEyMSwgMS4xNDIzNiwgMS4wMDUxOCwgMC45Nzk4MSwgMS4wMjE4NiwgMSwgMS4wODU3OCwgMC45NDE2NSwgMC45OTMxNCwgMC45ODM4NywgMC45MzAyOCwgMC45MzM3NywgMS4zNTEyNSwgMS4wNzUxNCwgMS4xMDY4NywgMC45MzQ5MSwgMS4wNDIzMiwgMS4wMDM1MSwgMS4xNDIzNiwgMS4wNzUxNCwgMC45NDE2NSwgMS4wNzUxNCwgMS4wMDM1MSwgMC43OTQyOSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wOTA5NywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MzUwMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NjYwOSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNjc3NywgMS4wMjE5NywgMS4wNjc3NywgMS4wMjE5NywgMS4wNjc3NywgMS4wMjE5NywgMC45MTE0MiwgMC45Njc1MiwgMSwgMS4yMTI2MSwgMC44OTkwMywgMSwgMSwgMC43NTE1NSwgMS4wNDc0NSwgMS4wNDc0NSwgMS4wNDc0NSwgMS4wNDM5NCwgMC45ODYzMywgMC45ODYzMywgMC45ODYzMywgMC43Mjk1OSwgMC43Mjk1OSwgMS4yMDUwMiwgMC45MTQwNiwgMS4yNjUxNCwgMS4yMjIsIDEuMDI5NTYsIDEuMDMzNzIsIDEuMDMzNzIsIDAuOTYwMzksIDEuMjQ2MzMsIDEsIDEuMDkxMjUsIDAuOTMzMjcsIDEuMDMzMzYsIDEuMTY1NDEsIDEuMDM2LCAxLCAxLCAxLCAwLjc3MSwgMSwgMSwgMS4xNTU3NCwgMS4xNTU3NCwgMS4xNTU3NCwgMS4xNTU3NCwgMC44NjM2NCwgMC45NDQzNCwgMC44NjI3OSwgMC45NDQzNCwgMC44NjIyNCwgMSwgMSwgMS4xNjc5OCwgMSwgMC45NjA4NSwgMC45MDA2OCwgMS4yMTIzNywgMS4xODQxNiwgMS4xMzkwNCwgMC42OTgyNSwgMC45NzE2LCAyLjEwMzM5LCAxLjI5MDA0LCAxLjI5MDA0LCAxLjIxMzM5LCAxLjI5MDA0LCAxLjI5MDA0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjQyNjAzLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAwLjg3MDI1LCAwLjg3MDI1LCAwLjg3MDI1LCAwLjg3MDI1LCAxLjE4Nzc1LCAxLjQyNjAzLCAxLCAxLjQyNjAzLCAxLjQyNjAzLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjI4ODYsIDEuMDQzMTUsIDEuMTUyOTYsIDEuMzQxNjMsIDEsIDEsIDEsIDEuMTMyNjksIDEuMTMyNjksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBTZWdvZXVpQm9sZEl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4zMzAwOCwKICBsaW5lR2FwOiAwCn07CmNvbnN0IFNlZ29ldWlJdGFsaWNGYWN0b3JzID0gWzEuNzY3MzgsIDEsIDEsIDAuOTg5NDYsIDEuMTQ3NjMsIDEuMDUzNjUsIDEuMDYyMzQsIDAuOTY5MjcsIDAuOTI1ODYsIDEuMTUzNzMsIDEuMTg0MTQsIDAuOTEzNDksIDAuOTEzNDksIDEuMDc0MDMsIDEuMTczMDgsIDAuNzgzODMsIDEuMjAwODgsIDAuNzgzODMsIDEuNDI1MzEsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuNzgzODMsIDAuNzgzODMsIDEuMTczMDgsIDEuMTczMDgsIDEuMTczMDgsIDAuNzczNDksIDAuOTQ1NjUsIDAuOTQ3MjksIDAuODU5NDQsIDAuODg1MDYsIDAuOTg1OCwgMC43NDgxNywgMC44MDAxNiwgMC44ODQ0OSwgMC45ODAzOSwgMC45NTc4MiwgMC42OTIzOCwgMC44OTg5OCwgMC44MzIzMSwgMC45ODE4MywgMS4wMzk4OSwgMC45NjkyNCwgMC44NjIzNywgMC45NjkyNCwgMC44MDU5NSwgMC43NDUyNCwgMC44NjA5MSwgMC45NTQwMiwgMC45NDE0MywgMC45ODQ0OCwgMC44ODU4LCAwLjgzMDg5LCAwLjkzMjg1LCAxLjA5NDksIDEuMzkwMTYsIDEuMDk0OSwgMS40NTk5NCwgMC43NDYyNywgMS4wNDgzOSwgMC45NzQ1NCwgMC45NzQ1NCwgMC44NzIwNywgMC45NzQ1NCwgMC44NzUzMywgMS4wNjE1MSwgMC45NzQ1NCwgMS4wMDE3NiwgMS4xNjQ4NCwgMS4wODEzMiwgMC45ODA0NywgMS4xNjQ4NCwgMS4wMjk4OSwgMS4wMTA1NCwgMC45NjIyNSwgMC45NzQ1NCwgMC45NzQ1NCwgMS4wNjU5OCwgMC43OTAwNCwgMS4xNjM0NCwgMS4wMDM1MSwgMC45NDYyOSwgMC45OTczLCAwLjkxMDE2LCAwLjk2Nzc3LCAwLjkwNDMsIDAuOTEwODIsIDAuOTI0ODEsIDAuOTEwODIsIDEuMTczMDgsIDAuOTU3NDgsIDAuOTY5MjcsIDAuOTY5MjcsIDEsIDAuOTY5MjcsIDAuOTI0ODEsIDAuODA1OTcsIDEuMDQ4MzksIDEuMjMzOTMsIDEuMTc4MSwgMC45MjQ1LCAxLjE3MzA4LCAxLjIwODA4LCAwLjYzMjE4LCAwLjk0MjYxLCAxLjI0ODIyLCAxLjA5OTcxLCAxLjA5OTcxLCAxLjA0ODM5LCAxLCAwLjg1MjczLCAwLjc4MDMyLCAxLjA0ODM5LCAxLjA5OTcxLCAxLjIyMzI2LCAwLjkyNDUsIDEuMDk4MzYsIDEuMTM1MjUsIDEuMTUyMjIsIDAuNzA0MjQsIDAuOTQ3MjksIDAuOTQ3MjksIDAuOTQ3MjksIDAuOTQ3MjksIDAuOTQ3MjksIDAuOTQ3MjksIDAuODU0OTgsIDAuODg1MDYsIDAuNzQ4MTcsIDAuNzQ4MTcsIDAuNzQ4MTcsIDAuNzQ4MTcsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTg1OCwgMS4wMzk4OSwgMC45NjkyNCwgMC45NjkyNCwgMC45NjkyNCwgMC45NjkyNCwgMC45NjkyNCwgMS4xNzMwOCwgMC45NjkyNCwgMC45NTQwMiwgMC45NTQwMiwgMC45NTQwMiwgMC45NTQwMiwgMC44MzA4OSwgMC44NjIzNywgMC44ODQwOSwgMC45NzQ1NCwgMC45NzQ1NCwgMC45NzQ1NCwgMC45NzQ1NCwgMC45NzQ1NCwgMC45NzQ1NCwgMC45MjkxNiwgMC44NzIwNywgMC44NzUzMywgMC44NzUzMywgMC44NzUzMywgMC44NzUzMywgMC45MzE0NiwgMC45MzE0NiwgMC45MzE0NiwgMC45MzE0NiwgMC45Mzg1NCwgMS4wMTA1NCwgMC45NjIyNSwgMC45NjIyNSwgMC45NjIyNSwgMC45NjIyNSwgMC45NjIyNSwgMS4yNDgyMiwgMC44NzYxLCAxLjAwMzUxLCAxLjAwMzUxLCAxLjAwMzUxLCAxLjAwMzUxLCAwLjk2Nzc3LCAwLjk3NDU0LCAwLjk2Nzc3LCAwLjk0NzI5LCAwLjk3NDU0LCAwLjk0NzI5LCAwLjk3NDU0LCAwLjk0NzI5LCAwLjk3NDU0LCAwLjg4NTA2LCAwLjg3MjA3LCAwLjg4NTA2LCAwLjg3MjA3LCAwLjg4NTA2LCAwLjg3MjA3LCAwLjg4NTA2LCAwLjg3MjA3LCAwLjk4NTgsIDAuOTUzOTEsIDAuOTg1OCwgMC45NzQ1NCwgMC43NDgxNywgMC44NzUzMywgMC43NDgxNywgMC44NzUzMywgMC43NDgxNywgMC44NzUzMywgMC43NDgxNywgMC44NzUzMywgMC43NDgxNywgMC44NzUzMywgMC44ODQ0OSwgMC45NzQ1NCwgMC44ODQ0OSwgMC45NzQ1NCwgMC44ODQ0OSwgMC45NzQ1NCwgMSwgMSwgMC45ODAzOSwgMS4wMDE3NiwgMC45ODAzOSwgMS4wMDE3NiwgMC45NTc4MiwgMC45MzE0NiwgMC45NTc4MiwgMC45MzE0NiwgMC45NTc4MiwgMC45MzE0NiwgMC45NTc4MiwgMS4xNjQ4NCwgMC45NTc4MiwgMC45MzE0NiwgMC44NDQyMSwgMS4xMjc2MSwgMC42OTIzOCwgMS4wODEzMiwgMSwgMSwgMC45ODA0NywgMC44MzIzMSwgMS4xNjQ4NCwgMSwgMSwgMC44NDcyMywgMS4wNDg2MSwgMC44NDcyMywgMC43ODc1NSwgMC44MzIzMSwgMS4yMzczNiwgMS4wMzk4OSwgMS4wMTA1NCwgMSwgMSwgMS4wMzk4OSwgMS4wMTA1NCwgMC45ODU3LCAxLjAzODQ5LCAxLjAxMDU0LCAwLjk2OTI0LCAwLjk2MjI1LCAwLjk2OTI0LCAwLjk2MjI1LCAwLjk2OTI0LCAwLjk2MjI1LCAwLjkyMzgzLCAwLjkwMTcxLCAwLjgwNTk1LCAxLjA2NTk4LCAxLCAxLCAwLjgwNTk1LCAxLjA2NTk4LCAwLjc0NTI0LCAwLjc5MDA0LCAwLjc0NTI0LCAwLjc5MDA0LCAwLjc0NTI0LCAwLjc5MDA0LCAwLjc0NTI0LCAwLjc5MDA0LCAxLCAxLCAwLjg2MDkxLCAxLjAyNzU5LCAwLjg1NzcxLCAxLjE2MzQ0LCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk4NDQ4LCAwLjk5NzMsIDAuODMwODksIDAuOTY3NzcsIDAuODMwODksIDAuOTMyODUsIDAuOTA0MywgMC45MzI4NSwgMC45MDQzLCAwLjkzMjg1LCAwLjkwNDMsIDEuMzE4NjgsIDAuOTY5MjcsIDAuOTQ3MjksIDAuOTc0NTQsIDAuODU0OTgsIDAuOTI5MTYsIDAuOTY5MjQsIDAuODc2MSwgMSwgMSwgMC44NjA5MSwgMS4xNjM0NCwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMC44MTk2NSwgMC44MTk2NSwgMC45NDcyOSwgMC43ODAzMiwgMC43MTAyMiwgMC45MDg4MywgMC44NDE3MSwgMC45OTg3NywgMC43NzU5NiwgMS4wNTczNCwgMS4yLCAwLjk0NzI5LCAwLjg1OTQ0LCAwLjgyNzkxLCAwLjk2MDcsIDAuNzQ4MTcsIDAuOTMyODUsIDAuOTgwMzksIDAuOTY5MjQsIDAuOTU3ODIsIDAuODk4OTgsIDAuOTgzMTYsIDAuOTgxODMsIDEuMDM5ODksIDAuNzg2MTQsIDAuOTY5MjQsIDAuOTc2NDIsIDAuODYyMzcsIDAuODYwNzUsIDAuODYwOTEsIDAuODMwODksIDAuOTAwODIsIDAuODg1OCwgMC45NzI5NiwgMS4wMTI4NCwgMC45NTc4MiwgMC44MzA4OSwgMS4wOTc2LCAxLjA0LCAxLjAzMzQyLCAxLjIsIDEuMDY3NSwgMS4wOTc2LCAwLjk4MjA1LCAxLjAzODA5LCAxLjA1MDk3LCAxLjA0LCAwLjk1MzY0LCAxLjAzMzQyLCAxLjA1NDAxLCAxLjIsIDEuMDIxNDgsIDEuMDExOSwgMS4wNDcyNCwgMS4wMTI3LCAxLjAyNzMyLCAwLjk2MjI1LCAwLjg5NjUsIDAuOTc3ODMsIDAuOTM1NzQsIDAuOTQ4MTgsIDEuMzA2NzksIDEuMDY3NSwgMS4xMTgyNiwgMC45OTgyMSwgMS4wNTU3LCAxLjAzMjYsIDEuMiwgMS4wNjc1LCAwLjk2MjI1LCAxLjA2NzUsIDEuMDMyNiwgMC43NDgxNywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wMzc1NCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44NzUzMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45ODcwNSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45ODQ0OCwgMC45OTczLCAwLjk4NDQ4LCAwLjk5NzMsIDAuOTg0NDgsIDAuOTk3MywgMC44MzA4OSwgMC45Njc3NywgMSwgMS4yMDA4OCwgMC44OTkwMywgMSwgMSwgMC43NTE1NSwgMC45NDk0NSwgMC45NDk0NSwgMC45NDk0NSwgMC45NDk0NSwgMS4xMjMxNywgMS4xMjMxNywgMS4xMjMxNywgMC42NzYwMywgMC42NzYwMywgMS4xNTYyMSwgMC43MzU4NCwgMS4yMTE5MSwgMS4yMjEzNSwgMS4wNjQ4MywgMC45NDg2OCwgMC45NDg2OCwgMC45NTk5NiwgMS4yNDYzMywgMSwgMS4wNzQ5NywgMC44NzcwOSwgMC45NjkyNywgMS4wMTQ3MywgMC45NjkyNywgMSwgMSwgMSwgMC43NzI5NSwgMSwgMSwgMS4wOTgzNiwgMS4wOTgzNiwgMS4wOTgzNiwgMS4wMTUyMiwgMC44NjMyMSwgMC45NDQzNCwgMC44NjQ5LCAwLjk0NDM0LCAwLjg2MTgyLCAxLCAxLCAxLjA4MywgMSwgMC45MTU3OCwgMC44NjQzOCwgMS4xNzMwOCwgMS4xODQxNiwgMS4xNDU4OSwgMC42OTgyNSwgMC45NzYyMiwgMS45Njc5MSwgMS4yNDgyMiwgMS4yNDgyMiwgMS4xNzMwOCwgMS4yNDgyMiwgMS4yNDgyMiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS40MjYwMywgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMS4xNzk4NCwgMS40MjYwMywgMSwgMS40MjYwMywgMS40MjYwMywgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4yODg2LCAxLjA0MzE1LCAxLjE1Mjk2LCAxLjM0MTYzLCAxLCAxLCAxLCAxLjEwNzQyLCAxLjEwNzQyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgU2Vnb2V1aUl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4zMzAwOCwKICBsaW5lR2FwOiAwCn07CmNvbnN0IFNlZ29ldWlSZWd1bGFyRmFjdG9ycyA9IFsxLjc2NzM4LCAxLCAxLCAwLjk4NTk0LCAxLjAyMjg1LCAxLjEwNDU0LCAxLjA2MjM0LCAwLjk2OTI3LCAwLjkyMDM3LCAxLjE5OTg1LCAxLjIwNDYsIDAuOTA2MTYsIDAuOTA2MTYsIDEuMDcxNTIsIDEuMTcxNCwgMC43ODAzMiwgMS4yMDA4OCwgMC43ODAzMiwgMS40MDI0NiwgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC43ODAzMiwgMC43ODAzMiwgMS4xNzE0LCAxLjE3MTQsIDEuMTcxNCwgMC44MDU5NywgMC45NDA4NCwgMC45NjcwNiwgMC44NTk0NCwgMC44NTczNCwgMC45NzA5MywgMC43NTg0MiwgMC43OTkzNiwgMC44ODE5OCwgMC45ODMxLCAwLjk1NzgyLCAwLjcxMzg3LCAwLjg2OTY5LCAwLjg0NjM2LCAxLjA3Nzk2LCAxLjAzNTg0LCAwLjk2OTI0LCAwLjgzOTY4LCAwLjk2OTI0LCAwLjgyODI2LCAwLjc5NjQ5LCAwLjg1NzcxLCAwLjk1MTMyLCAwLjkzMTE5LCAwLjk4OTY1LCAwLjg4NDMzLCAwLjgyODcsIDAuOTMzNjUsIDEuMDg2MTIsIDEuMzYzOCwgMS4wODYxMiwgMS40NTc4NiwgMC43NDYyNywgMC44MDQ5OSwgMC45MTQ4NCwgMS4wNTcwNywgMC45MjM4MywgMS4wNTg4MiwgMC45NDAzLCAxLjEyNjU0LCAxLjA1ODgyLCAxLjAxNzU2LCAxLjA5MDExLCAxLjA5MDExLCAwLjk5NDE0LCAxLjA5MDExLCAxLjAzNCwgMS4wMTc1NiwgMS4wNTM1NiwgMS4wNTcwNywgMS4wNTg4MiwgMS4wNDM5OSwgMC44NDg2MywgMS4yMTk2OCwgMS4wMTc1NiwgMC45NTgwMSwgMS4wMDA2OCwgMC45MTc5NywgMC45Njc3NywgMC45MDQzLCAwLjkwMzUxLCAwLjkyMTA1LCAwLjkwMzUxLCAxLjE3MTQsIDAuODUzMzcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTk5MTIsIDAuOTY5MjcsIDAuOTIxMDUsIDAuODA1OTcsIDEuMjQzNCwgMS4yMDgwOCwgMS4wNTkzNywgMC45MDk1NywgMS4xNzE0LCAxLjIwODA4LCAwLjc1MTU1LCAwLjk0MjYxLCAxLjI0NjQ0LCAxLjA5OTcxLCAxLjA5OTcxLCAwLjg0NzUxLCAxLCAwLjg1MjczLCAwLjc4MDMyLCAwLjYxNTg0LCAxLjA1NDI1LCAxLjE3OTE0LCAwLjkwOTU3LCAxLjA4NjY1LCAxLjExNTkzLCAxLjE0MTY5LCAwLjczMzgxLCAwLjk2NzA2LCAwLjk2NzA2LCAwLjk2NzA2LCAwLjk2NzA2LCAwLjk2NzA2LCAwLjk2NzA2LCAwLjg2MDM1LCAwLjg1NzM0LCAwLjc1ODQyLCAwLjc1ODQyLCAwLjc1ODQyLCAwLjc1ODQyLCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk3MDkzLCAxLjAzNTg0LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAxLjE3MTQsIDAuOTY5MjQsIDAuOTUxMzIsIDAuOTUxMzIsIDAuOTUxMzIsIDAuOTUxMzIsIDAuODI4NywgMC44Mzk2OCwgMC44OTA0OSwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MzU3NSwgMC45MjM4MywgMC45NDAzLCAwLjk0MDMsIDAuOTQwMywgMC45NDAzLCAwLjg3MTcsIDAuODcxNywgMC44NzE3LCAwLjg3MTcsIDEuMDA1MjcsIDEuMDE3NTYsIDEuMDUzNTYsIDEuMDUzNTYsIDEuMDUzNTYsIDEuMDUzNTYsIDEuMDUzNTYsIDEuMjQ2NDQsIDAuOTU5MjMsIDEuMDE3NTYsIDEuMDE3NTYsIDEuMDE3NTYsIDEuMDE3NTYsIDAuOTY3NzcsIDEuMDU3MDcsIDAuOTY3NzcsIDAuOTY3MDYsIDAuOTE0ODQsIDAuOTY3MDYsIDAuOTE0ODQsIDAuOTY3MDYsIDAuOTE0ODQsIDAuODU3MzQsIDAuOTIzODMsIDAuODU3MzQsIDAuOTIzODMsIDAuODU3MzQsIDAuOTIzODMsIDAuODU3MzQsIDAuOTIzODMsIDAuOTcwOTMsIDEuMDk2OSwgMC45NzA5MywgMS4wNTg4MiwgMC43NTg0MiwgMC45NDAzLCAwLjc1ODQyLCAwLjk0MDMsIDAuNzU4NDIsIDAuOTQwMywgMC43NTg0MiwgMC45NDAzLCAwLjc1ODQyLCAwLjk0MDMsIDAuODgxOTgsIDEuMDU4ODIsIDAuODgxOTgsIDEuMDU4ODIsIDAuODgxOTgsIDEuMDU4ODIsIDEsIDEsIDAuOTgzMSwgMS4wMTc1NiwgMC45ODMxLCAxLjAxNzU2LCAwLjk1NzgyLCAwLjg3MTcsIDAuOTU3ODIsIDAuODcxNywgMC45NTc4MiwgMC44NzE3LCAwLjk1NzgyLCAxLjA5MDExLCAwLjk1NzgyLCAwLjg3MTcsIDAuODQ3ODQsIDEuMTE1NTEsIDAuNzEzODcsIDEuMDkwMTEsIDEsIDEsIDAuOTk0MTQsIDAuODQ2MzYsIDEuMDkwMTEsIDEsIDEsIDAuODQ2MzYsIDEuMDUzNiwgMC44NDYzNiwgMC45NDI5OCwgMC44NDYzNiwgMS4yMzI5NywgMS4wMzU4NCwgMS4wMTc1NiwgMSwgMSwgMS4wMzU4NCwgMS4wMTc1NiwgMS4wMDMyMywgMS4wMzQ0NCwgMS4wMTc1NiwgMC45NjkyNCwgMS4wNTM1NiwgMC45NjkyNCwgMS4wNTM1NiwgMC45NjkyNCwgMS4wNTM1NiwgMC45MzA2NiwgMC45ODI5MywgMC44MjgyNiwgMS4wNDM5OSwgMSwgMSwgMC44MjgyNiwgMS4wNDM5OSwgMC43OTY0OSwgMC44NDg2MywgMC43OTY0OSwgMC44NDg2MywgMC43OTY0OSwgMC44NDg2MywgMC43OTY0OSwgMC44NDg2MywgMSwgMSwgMC44NTc3MSwgMS4xNzMxOCwgMC44NTc3MSwgMS4yMTk2OCwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45ODk2NSwgMS4wMDA2OCwgMC44Mjg3LCAwLjk2Nzc3LCAwLjgyODcsIDAuOTMzNjUsIDAuOTA0MywgMC45MzM2NSwgMC45MDQzLCAwLjkzMzY1LCAwLjkwNDMsIDEuMDg1NzEsIDAuOTY5MjcsIDAuOTY3MDYsIDAuOTE0ODQsIDAuODYwMzUsIDAuOTM1NzUsIDAuOTY5MjQsIDAuOTU5MjMsIDEsIDEsIDAuODU3NzEsIDEuMjE5NjgsIDEuMTE0MzcsIDEuMTE0MzcsIDAuOTMxMDksIDAuOTEyMDIsIDAuNjA0MTEsIDAuODQxNjQsIDAuNTU1NzIsIDEuMDExNzMsIDAuOTczNjEsIDAuODE4MTgsIDAuODE4MTgsIDAuOTY2MzUsIDAuNzgwMzIsIDAuNzI3MjcsIDAuOTIzNjYsIDAuOTg2MDEsIDEuMDM0MDUsIDAuNzc5NjgsIDEuMDk3OTksIDEuMiwgMC45NjcwNiwgMC44NTk0NCwgMC44NTYzOCwgMC45NjQ5MSwgMC43NTg0MiwgMC45MzM2NSwgMC45ODMxLCAwLjk2OTI0LCAwLjk1NzgyLCAwLjg2OTY5LCAwLjk0MTUyLCAxLjA3Nzk2LCAxLjAzNTg0LCAwLjc4NDM3LCAwLjk2OTI0LCAwLjk4NzE1LCAwLjgzOTY4LCAwLjgzNDkxLCAwLjg1NzcxLCAwLjgyODcsIDAuOTQ0OTIsIDAuODg0MzMsIDAuOTI4NywgMS4wMDk4LCAwLjk1NzgyLCAwLjgyODcsIDEuMDYyNSwgMC45ODI0OCwgMS4wMzQyNCwgMS4yLCAxLjAxMDcxLCAxLjA2MjUsIDAuOTUyNDYsIDEuMDM4MDksIDEuMDQ5MTIsIDAuOTgyNDgsIDEuMDAyMjEsIDEuMDM0MjQsIDEuMDU0NDMsIDEuMiwgMS4wNDc4NSwgMC45OTYwOSwgMS4wMDE2OSwgMS4wNTE3NiwgMC45OTM0NiwgMS4wNTM1NiwgMC45MDg3LCAxLjAzMDA0LCAwLjk1NTQyLCAwLjkzMTE3LCAxLjIzMzYyLCAxLjAxMDcxLCAxLjA3ODMxLCAxLjAyNTEyLCAxLjA1MjA1LCAxLjAzNTAyLCAxLjIsIDEuMDEwNzEsIDEuMDUzNTYsIDEuMDEwNzEsIDEuMDM1MDIsIDAuNzU4NDIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDM3MTksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTQwMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNDAyMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45ODk2NSwgMS4wMDA2OCwgMC45ODk2NSwgMS4wMDA2OCwgMC45ODk2NSwgMS4wMDA2OCwgMC44Mjg3LCAwLjk2Nzc3LCAxLCAxLjIwMDg4LCAwLjg5OTAzLCAxLCAxLCAwLjc1MTU1LCAxLjAzMDc3LCAxLjAzMDc3LCAxLjAzMDc3LCAxLjAzMDc3LCAxLjEzMTk2LCAxLjEzMTk2LCAxLjEzMTk2LCAwLjY3NDI4LCAwLjY3NDI4LCAxLjE2MDM5LCAwLjczMjkxLCAxLjIwOTk2LCAxLjIyMTM1LCAxLjA2NDgzLCAwLjk0ODY4LCAwLjk0ODY4LCAwLjk1OTk2LCAxLjI0NjMzLCAxLCAxLjA3NDk3LCAwLjg3Nzk2LCAwLjk2OTI3LCAxLjAxNTE4LCAwLjk2OTI3LCAxLCAxLCAxLCAwLjc3Mjk1LCAxLCAxLCAxLjEwNTM5LCAxLjEwNTM5LCAxLjExMzU4LCAxLjA2OTY3LCAwLjg2Mjc5LCAwLjk0NDM0LCAwLjg2Mjc5LCAwLjk0NDM0LCAwLjg2MTgyLCAxLCAxLCAxLjA4MywgMSwgMC45MTU3OCwgMC44NjUwNywgMS4xNzE0LCAxLjE4NDE2LCAxLjE0NTg5LCAwLjY5ODI1LCAwLjk3NjIyLCAxLjk2OTcsIDEuMjQ4MjIsIDEuMjQ4MjIsIDEuMTcyMzgsIDEuMjQ4MjIsIDEuMjQ4MjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuNDI2MDMsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDEuMTgwODMsIDEuNDI2MDMsIDEsIDEuNDI2MDMsIDEuNDI2MDMsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMjg4NiwgMS4wNDMxNSwgMS4xNTI5NiwgMS4zNDE2MywgMSwgMSwgMSwgMS4xMDkzOCwgMS4xMDkzOCwgMSwgMSwgMSwgMS4wNTQyNSwgMS4wOTk3MSwgMS4wOTk3MSwgMS4wOTk3MSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IFNlZ29ldWlSZWd1bGFyTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjMzMDA4LAogIGxpbmVHYXA6IDAKfTsKCjsvLyAuL3NyYy9jb3JlL3hmYV9mb250cy5qcwoKCgoKCgoKCmNvbnN0IGdldFhGQUZvbnRNYXAgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WyJNeXJpYWRQcm8tUmVndWxhciJdID0gdFsiUGRmSlMtRmFsbGJhY2stUmVndWxhciJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIiLAogICAgZmFjdG9yczogTXlyaWFkUHJvUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IE15cmlhZFByb1JlZ3VsYXJNZXRyaWNzCiAgfTsKICB0WyJNeXJpYWRQcm8tQm9sZCJdID0gdFsiUGRmSlMtRmFsbGJhY2stQm9sZCJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGQiLAogICAgZmFjdG9yczogTXlyaWFkUHJvQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IE15cmlhZFByb0JvbGRNZXRyaWNzCiAgfTsKICB0WyJNeXJpYWRQcm8tSXQiXSA9IHRbIk15cmlhZFByby1JdGFsaWMiXSA9IHRbIlBkZkpTLUZhbGxiYWNrLUl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUl0YWxpYyIsCiAgICBmYWN0b3JzOiBNeXJpYWRQcm9JdGFsaWNGYWN0b3JzLAogICAgYmFzZVdpZHRoczogTGliZXJhdGlvblNhbnNJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNJdGFsaWNNYXBwaW5nLAogICAgbWV0cmljczogTXlyaWFkUHJvSXRhbGljTWV0cmljcwogIH07CiAgdFsiTXlyaWFkUHJvLUJvbGRJdCJdID0gdFsiTXlyaWFkUHJvLUJvbGRJdGFsaWMiXSA9IHRbIlBkZkpTLUZhbGxiYWNrLUJvbGRJdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljIiwKICAgIGZhY3RvcnM6IE15cmlhZFByb0JvbGRJdGFsaWNGYWN0b3JzLAogICAgYmFzZVdpZHRoczogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zQm9sZEl0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBNeXJpYWRQcm9Cb2xkSXRhbGljTWV0cmljcwogIH07CiAgdC5BcmlhbE1UID0gdC5BcmlhbCA9IHRbIkFyaWFsLVJlZ3VsYXIiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyIiwKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJNYXBwaW5nCiAgfTsKICB0WyJBcmlhbC1Cb2xkTVQiXSA9IHRbIkFyaWFsLUJvbGQiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkIiwKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZFdpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nCiAgfTsKICB0WyJBcmlhbC1JdGFsaWNNVCJdID0gdFsiQXJpYWwtSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtSXRhbGljIiwKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZwogIH07CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01UIl0gPSB0WyJBcmlhbC1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZwogIH07CiAgdFsiQ2FsaWJyaS1SZWd1bGFyIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtUmVndWxhciIsCiAgICBmYWN0b3JzOiBDYWxpYnJpUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IENhbGlicmlSZWd1bGFyTWV0cmljcwogIH07CiAgdFsiQ2FsaWJyaS1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBmYWN0b3JzOiBDYWxpYnJpQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IENhbGlicmlCb2xkTWV0cmljcwogIH07CiAgdFsiQ2FsaWJyaS1JdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMiLAogICAgZmFjdG9yczogQ2FsaWJyaUl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBDYWxpYnJpSXRhbGljTWV0cmljcwogIH07CiAgdFsiQ2FsaWJyaS1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBmYWN0b3JzOiBDYWxpYnJpQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IENhbGlicmlCb2xkSXRhbGljTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1SZWd1bGFyIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtUmVndWxhciIsCiAgICBmYWN0b3JzOiBTZWdvZXVpUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IFNlZ29ldWlSZWd1bGFyTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBmYWN0b3JzOiBTZWdvZXVpQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IFNlZ29ldWlCb2xkTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1JdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMiLAogICAgZmFjdG9yczogU2Vnb2V1aUl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBTZWdvZXVpSXRhbGljTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBmYWN0b3JzOiBTZWdvZXVpQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IFNlZ29ldWlCb2xkSXRhbGljTWV0cmljcwogIH07CiAgdFsiSGVsdmV0aWNhLVJlZ3VsYXIiXSA9IHQuSGVsdmV0aWNhID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIiLAogICAgZmFjdG9yczogSGVsdmV0aWNhUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IEhlbHZldGljYVJlZ3VsYXJNZXRyaWNzCiAgfTsKICB0WyJIZWx2ZXRpY2EtQm9sZCJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGQiLAogICAgZmFjdG9yczogSGVsdmV0aWNhQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IEhlbHZldGljYUJvbGRNZXRyaWNzCiAgfTsKICB0WyJIZWx2ZXRpY2EtSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtSXRhbGljIiwKICAgIGZhY3RvcnM6IEhlbHZldGljYUl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBIZWx2ZXRpY2FJdGFsaWNNZXRyaWNzCiAgfTsKICB0WyJIZWx2ZXRpY2EtQm9sZEl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMiLAogICAgZmFjdG9yczogSGVsdmV0aWNhQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IEhlbHZldGljYUJvbGRJdGFsaWNNZXRyaWNzCiAgfTsKfSk7CmZ1bmN0aW9uIGdldFhmYUZvbnROYW1lKG5hbWUpIHsKICBjb25zdCBmb250TmFtZSA9IG5vcm1hbGl6ZUZvbnROYW1lKG5hbWUpOwogIGNvbnN0IGZvbnRNYXAgPSBnZXRYRkFGb250TWFwKCk7CiAgcmV0dXJuIGZvbnRNYXBbZm9udE5hbWVdOwp9CmZ1bmN0aW9uIGdldFhmYUZvbnRXaWR0aHMobmFtZSkgewogIGNvbnN0IGluZm8gPSBnZXRYZmFGb250TmFtZShuYW1lKTsKICBpZiAoIWluZm8pIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCB7CiAgICBiYXNlV2lkdGhzLAogICAgYmFzZU1hcHBpbmcsCiAgICBmYWN0b3JzCiAgfSA9IGluZm87CiAgY29uc3QgcmVzY2FsZWRCYXNlV2lkdGhzID0gIWZhY3RvcnMgPyBiYXNlV2lkdGhzIDogYmFzZVdpZHRocy5tYXAoKHcsIGkpID0+IHcgKiBmYWN0b3JzW2ldKTsKICBsZXQgY3VycmVudENvZGUgPSAtMjsKICBsZXQgY3VycmVudEFycmF5OwogIGNvbnN0IG5ld1dpZHRocyA9IFtdOwogIGZvciAoY29uc3QgW3VuaWNvZGUsIGdseXBoSW5kZXhdIG9mIGJhc2VNYXBwaW5nLm1hcCgoY2hhclVuaWNvZGUsIGluZGV4KSA9PiBbY2hhclVuaWNvZGUsIGluZGV4XSkuc29ydCgoW3VuaWNvZGUxXSwgW3VuaWNvZGUyXSkgPT4gdW5pY29kZTEgLSB1bmljb2RlMikpIHsKICAgIGlmICh1bmljb2RlID09PSAtMSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmICh1bmljb2RlID09PSBjdXJyZW50Q29kZSArIDEpIHsKICAgICAgY3VycmVudEFycmF5LnB1c2gocmVzY2FsZWRCYXNlV2lkdGhzW2dseXBoSW5kZXhdKTsKICAgICAgY3VycmVudENvZGUgKz0gMTsKICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnRDb2RlID0gdW5pY29kZTsKICAgICAgY3VycmVudEFycmF5ID0gW3Jlc2NhbGVkQmFzZVdpZHRoc1tnbHlwaEluZGV4XV07CiAgICAgIG5ld1dpZHRocy5wdXNoKHVuaWNvZGUsIGN1cnJlbnRBcnJheSk7CiAgICB9CiAgfQogIHJldHVybiBuZXdXaWR0aHM7Cn0KZnVuY3Rpb24gZ2V0WGZhRm9udERpY3QobmFtZSkgewogIGNvbnN0IHdpZHRocyA9IGdldFhmYUZvbnRXaWR0aHMobmFtZSk7CiAgY29uc3QgZGljdCA9IG5ldyBEaWN0KG51bGwpOwogIGRpY3Quc2V0KCJCYXNlRm9udCIsIE5hbWUuZ2V0KG5hbWUpKTsKICBkaWN0LnNldCgiVHlwZSIsIE5hbWUuZ2V0KCJGb250IikpOwogIGRpY3Quc2V0KCJTdWJ0eXBlIiwgTmFtZS5nZXQoIkNJREZvbnRUeXBlMiIpKTsKICBkaWN0LnNldCgiRW5jb2RpbmciLCBOYW1lLmdldCgiSWRlbnRpdHktSCIpKTsKICBkaWN0LnNldCgiQ0lEVG9HSURNYXAiLCBOYW1lLmdldCgiSWRlbnRpdHkiKSk7CiAgZGljdC5zZXQoIlciLCB3aWR0aHMpOwogIGRpY3Quc2V0KCJGaXJzdENoYXIiLCB3aWR0aHNbMF0pOwogIGRpY3Quc2V0KCJMYXN0Q2hhciIsIHdpZHRocy5hdCgtMikgKyB3aWR0aHMuYXQoLTEpLmxlbmd0aCAtIDEpOwogIGNvbnN0IGRlc2NyaXB0b3IgPSBuZXcgRGljdChudWxsKTsKICBkaWN0LnNldCgiRm9udERlc2NyaXB0b3IiLCBkZXNjcmlwdG9yKTsKICBjb25zdCBzeXN0ZW1JbmZvID0gbmV3IERpY3QobnVsbCk7CiAgc3lzdGVtSW5mby5zZXQoIk9yZGVyaW5nIiwgIklkZW50aXR5Iik7CiAgc3lzdGVtSW5mby5zZXQoIlJlZ2lzdHJ5IiwgIkFkb2JlIik7CiAgc3lzdGVtSW5mby5zZXQoIlN1cHBsZW1lbnQiLCAwKTsKICBkaWN0LnNldCgiQ0lEU3lzdGVtSW5mbyIsIHN5c3RlbUluZm8pOwogIHJldHVybiBkaWN0Owp9Cgo7Ly8gLi9zcmMvY29yZS9wc19wYXJzZXIuanMKCgoKY2xhc3MgUG9zdFNjcmlwdFBhcnNlciB7CiAgY29uc3RydWN0b3IobGV4ZXIpIHsKICAgIHRoaXMubGV4ZXIgPSBsZXhlcjsKICAgIHRoaXMub3BlcmF0b3JzID0gW107CiAgICB0aGlzLnRva2VuID0gbnVsbDsKICAgIHRoaXMucHJldiA9IG51bGw7CiAgfQogIG5leHRUb2tlbigpIHsKICAgIHRoaXMucHJldiA9IHRoaXMudG9rZW47CiAgICB0aGlzLnRva2VuID0gdGhpcy5sZXhlci5nZXRUb2tlbigpOwogIH0KICBhY2NlcHQodHlwZSkgewogICAgaWYgKHRoaXMudG9rZW4udHlwZSA9PT0gdHlwZSkgewogICAgICB0aGlzLm5leHRUb2tlbigpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgZXhwZWN0KHR5cGUpIHsKICAgIGlmICh0aGlzLmFjY2VwdCh0eXBlKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5leHBlY3RlZCBzeW1ib2w6IGZvdW5kICR7dGhpcy50b2tlbi50eXBlfSBleHBlY3RlZCAke3R5cGV9LmApOwogIH0KICBwYXJzZSgpIHsKICAgIHRoaXMubmV4dFRva2VuKCk7CiAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5MQlJBQ0UpOwogICAgdGhpcy5wYXJzZUJsb2NrKCk7CiAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UpOwogICAgcmV0dXJuIHRoaXMub3BlcmF0b3JzOwogIH0KICBwYXJzZUJsb2NrKCkgewogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLk5VTUJFUikpIHsKICAgICAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKHRoaXMucHJldi52YWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuT1BFUkFUT1IpKSB7CiAgICAgICAgdGhpcy5vcGVyYXRvcnMucHVzaCh0aGlzLnByZXYudmFsdWUpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSkpIHsKICAgICAgICB0aGlzLnBhcnNlQ29uZGl0aW9uKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgfQogIHBhcnNlQ29uZGl0aW9uKCkgewogICAgY29uc3QgY29uZGl0aW9uTG9jYXRpb24gPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKG51bGwsIG51bGwpOwogICAgdGhpcy5wYXJzZUJsb2NrKCk7CiAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UpOwogICAgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLklGKSkgewogICAgICB0aGlzLm9wZXJhdG9yc1tjb25kaXRpb25Mb2NhdGlvbl0gPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICAgIHRoaXMub3BlcmF0b3JzW2NvbmRpdGlvbkxvY2F0aW9uICsgMV0gPSAianoiOwogICAgfSBlbHNlIGlmICh0aGlzLmFjY2VwdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5MQlJBQ0UpKSB7CiAgICAgIGNvbnN0IGp1bXBMb2NhdGlvbiA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgICAgdGhpcy5vcGVyYXRvcnMucHVzaChudWxsLCBudWxsKTsKICAgICAgY29uc3QgZW5kT2ZUcnVlID0gdGhpcy5vcGVyYXRvcnMubGVuZ3RoOwogICAgICB0aGlzLnBhcnNlQmxvY2soKTsKICAgICAgdGhpcy5leHBlY3QoUG9zdFNjcmlwdFRva2VuVHlwZXMuUkJSQUNFKTsKICAgICAgdGhpcy5leHBlY3QoUG9zdFNjcmlwdFRva2VuVHlwZXMuSUZFTFNFKTsKICAgICAgdGhpcy5vcGVyYXRvcnNbanVtcExvY2F0aW9uXSA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgICAgdGhpcy5vcGVyYXRvcnNbanVtcExvY2F0aW9uICsgMV0gPSAiaiI7CiAgICAgIHRoaXMub3BlcmF0b3JzW2NvbmRpdGlvbkxvY2F0aW9uXSA9IGVuZE9mVHJ1ZTsKICAgICAgdGhpcy5vcGVyYXRvcnNbY29uZGl0aW9uTG9jYXRpb24gKyAxXSA9ICJqeiI7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBTIEZ1bmN0aW9uOiBlcnJvciBwYXJzaW5nIGNvbmRpdGlvbmFsLiIpOwogICAgfQogIH0KfQpjb25zdCBQb3N0U2NyaXB0VG9rZW5UeXBlcyA9IHsKICBMQlJBQ0U6IDAsCiAgUkJSQUNFOiAxLAogIE5VTUJFUjogMiwKICBPUEVSQVRPUjogMywKICBJRjogNCwKICBJRkVMU0U6IDUKfTsKY2xhc3MgUG9zdFNjcmlwdFRva2VuIHsKICBzdGF0aWMgZ2V0IG9wQ2FjaGUoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJvcENhY2hlIiwgT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgfQogIGNvbnN0cnVjdG9yKHR5cGUsIHZhbHVlKSB7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogIH0KICBzdGF0aWMgZ2V0T3BlcmF0b3Iob3ApIHsKICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4ub3BDYWNoZVtvcF0gfHw9IG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuT1BFUkFUT1IsIG9wKTsKICB9CiAgc3RhdGljIGdldCBMQlJBQ0UoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJMQlJBQ0UiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSwgInsiKSk7CiAgfQogIHN0YXRpYyBnZXQgUkJSQUNFKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiUkJSQUNFIiwgbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UsICJ9IikpOwogIH0KICBzdGF0aWMgZ2V0IElGKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiSUYiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLklGLCAiSUYiKSk7CiAgfQogIHN0YXRpYyBnZXQgSUZFTFNFKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiSUZFTFNFIiwgbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5JRkVMU0UsICJJRkVMU0UiKSk7CiAgfQp9CmNsYXNzIFBvc3RTY3JpcHRMZXhlciB7CiAgY29uc3RydWN0b3Ioc3RyZWFtKSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMubmV4dENoYXIoKTsKICAgIHRoaXMuc3RyQnVmID0gW107CiAgfQogIG5leHRDaGFyKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudENoYXIgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgfQogIGdldFRva2VuKCkgewogICAgbGV0IGNvbW1lbnQgPSBmYWxzZTsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoY2ggPCAwKSB7CiAgICAgICAgcmV0dXJuIEVPRjsKICAgICAgfQogICAgICBpZiAoY29tbWVudCkgewogICAgICAgIGlmIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCkgewogICAgICAgICAgY29tbWVudCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyNSkgewogICAgICAgIGNvbW1lbnQgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKCFpc1doaXRlU3BhY2UoY2gpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBzd2l0Y2ggKGNoIHwgMCkgewogICAgICBjYXNlIDB4MzA6CiAgICAgIGNhc2UgMHgzMToKICAgICAgY2FzZSAweDMyOgogICAgICBjYXNlIDB4MzM6CiAgICAgIGNhc2UgMHgzNDoKICAgICAgY2FzZSAweDM1OgogICAgICBjYXNlIDB4MzY6CiAgICAgIGNhc2UgMHgzNzoKICAgICAgY2FzZSAweDM4OgogICAgICBjYXNlIDB4Mzk6CiAgICAgIGNhc2UgMHgyYjoKICAgICAgY2FzZSAweDJkOgogICAgICBjYXNlIDB4MmU6CiAgICAgICAgcmV0dXJuIG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuTlVNQkVSLCB0aGlzLmdldE51bWJlcigpKTsKICAgICAgY2FzZSAweDdiOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLkxCUkFDRTsKICAgICAgY2FzZSAweDdkOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLlJCUkFDRTsKICAgIH0KICAgIGNvbnN0IHN0ckJ1ZiA9IHRoaXMuc3RyQnVmOwogICAgc3RyQnVmLmxlbmd0aCA9IDA7CiAgICBzdHJCdWZbMF0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDAgJiYgKGNoID49IDB4NDEgJiYgY2ggPD0gMHg1YSB8fCBjaCA+PSAweDYxICYmIGNoIDw9IDB4N2EpKSB7CiAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgIH0KICAgIGNvbnN0IHN0ciA9IHN0ckJ1Zi5qb2luKCIiKTsKICAgIHN3aXRjaCAoc3RyLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgY2FzZSAiaWYiOgogICAgICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4uSUY7CiAgICAgIGNhc2UgImlmZWxzZSI6CiAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5JRkVMU0U7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5nZXRPcGVyYXRvcihzdHIpOwogICAgfQogIH0KICBnZXROdW1iZXIoKSB7CiAgICBsZXQgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgY29uc3Qgc3RyQnVmID0gdGhpcy5zdHJCdWY7CiAgICBzdHJCdWYubGVuZ3RoID0gMDsKICAgIHN0ckJ1ZlswXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCkgewogICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5IHx8IGNoID09PSAweDJkIHx8IGNoID09PSAweDJlKSB7CiAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICB9IGVsc2UgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zdCB2YWx1ZSA9IHBhcnNlRmxvYXQoc3RyQnVmLmpvaW4oIiIpKTsKICAgIGlmIChpc05hTih2YWx1ZSkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGZsb2F0aW5nIHBvaW50IG51bWJlcjogJHt2YWx1ZX1gKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ltYWdlX3V0aWxzLmpzCgoKY2xhc3MgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHRoaXMuX29ubHlSZWZzID0gb3B0aW9ucz8ub25seVJlZnMgPT09IHRydWU7CiAgICBpZiAoIXRoaXMuX29ubHlSZWZzKSB7CiAgICAgIHRoaXMuX25hbWVSZWZNYXAgPSBuZXcgTWFwKCk7CiAgICAgIHRoaXMuX2ltYWdlTWFwID0gbmV3IE1hcCgpOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogIH0KICBnZXRCeU5hbWUobmFtZSkgewogICAgaWYgKHRoaXMuX29ubHlSZWZzKSB7CiAgICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgYGdldEJ5TmFtZWAgbWV0aG9kLiIpOwogICAgfQogICAgY29uc3QgcmVmID0gdGhpcy5fbmFtZVJlZk1hcC5nZXQobmFtZSk7CiAgICBpZiAocmVmKSB7CiAgICAgIHJldHVybiB0aGlzLmdldEJ5UmVmKHJlZik7CiAgICB9CiAgICByZXR1cm4gdGhpcy5faW1hZ2VNYXAuZ2V0KG5hbWUpIHx8IG51bGw7CiAgfQogIGdldEJ5UmVmKHJlZikgewogICAgcmV0dXJuIHRoaXMuX2ltYWdlQ2FjaGUuZ2V0KHJlZikgfHwgbnVsbDsKICB9CiAgc2V0KG5hbWUsIHJlZiwgZGF0YSkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgc2V0YCBjYWxsZWQuIik7CiAgfQp9CmNsYXNzIExvY2FsSW1hZ2VDYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBzZXQobmFtZSwgcmVmID0gbnVsbCwgZGF0YSkgewogICAgaWYgKHR5cGVvZiBuYW1lICE9PSAic3RyaW5nIikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsSW1hZ2VDYWNoZS5zZXQgLSBleHBlY3RlZCAibmFtZSIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAocmVmKSB7CiAgICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX25hbWVSZWZNYXAuc2V0KG5hbWUsIHJlZik7CiAgICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZU1hcC5oYXMobmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VNYXAuc2V0KG5hbWUsIGRhdGEpOwogIH0KfQpjbGFzcyBMb2NhbENvbG9yU3BhY2VDYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBzZXQobmFtZSA9IG51bGwsIHJlZiA9IG51bGwsIGRhdGEpIHsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIgJiYgIXJlZikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsQ29sb3JTcGFjZUNhY2hlLnNldCAtIGV4cGVjdGVkICJuYW1lIiBhbmQvb3IgInJlZiIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAocmVmKSB7CiAgICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChuYW1lICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5fbmFtZVJlZk1hcC5zZXQobmFtZSwgcmVmKTsKICAgICAgfQogICAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VNYXAuaGFzKG5hbWUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2ltYWdlTWFwLnNldChuYW1lLCBkYXRhKTsKICB9Cn0KY2xhc3MgTG9jYWxGdW5jdGlvbkNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHN1cGVyKHsKICAgICAgb25seVJlZnM6IHRydWUKICAgIH0pOwogIH0KICBzZXQobmFtZSA9IG51bGwsIHJlZiwgZGF0YSkgewogICAgaWYgKCFyZWYpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbEZ1bmN0aW9uQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgInJlZiIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogIH0KfQpjbGFzcyBMb2NhbEdTdGF0ZUNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIHNldChuYW1lLCByZWYgPSBudWxsLCBkYXRhKSB7CiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICJzdHJpbmciKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxHU3RhdGVDYWNoZS5zZXQgLSBleHBlY3RlZCAibmFtZSIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAocmVmKSB7CiAgICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX25hbWVSZWZNYXAuc2V0KG5hbWUsIHJlZik7CiAgICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZU1hcC5oYXMobmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VNYXAuc2V0KG5hbWUsIGRhdGEpOwogIH0KfQpjbGFzcyBMb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcih7CiAgICAgIG9ubHlSZWZzOiB0cnVlCiAgICB9KTsKICB9CiAgc2V0KG5hbWUgPSBudWxsLCByZWYsIGRhdGEpIHsKICAgIGlmICghcmVmKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgInJlZiIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogIH0KfQpjbGFzcyBSZWdpb25hbEltYWdlQ2FjaGUgZXh0ZW5kcyBCYXNlTG9jYWxDYWNoZSB7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgc3VwZXIoewogICAgICBvbmx5UmVmczogdHJ1ZQogICAgfSk7CiAgfQogIHNldChuYW1lID0gbnVsbCwgcmVmLCBkYXRhKSB7CiAgICBpZiAoIXJlZikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZ2lvbmFsSW1hZ2VDYWNoZS5zZXQgLSBleHBlY3RlZCAicmVmIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgfQp9CmNsYXNzIEdsb2JhbENvbG9yU3BhY2VDYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcih7CiAgICAgIG9ubHlSZWZzOiB0cnVlCiAgICB9KTsKICB9CiAgc2V0KG5hbWUgPSBudWxsLCByZWYsIGRhdGEpIHsKICAgIGlmICghcmVmKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignR2xvYmFsQ29sb3JTcGFjZUNhY2hlLnNldCAtIGV4cGVjdGVkICJyZWYiIGFyZ3VtZW50LicpOwogICAgfQogICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICB9CiAgY2xlYXIoKSB7CiAgICB0aGlzLl9pbWFnZUNhY2hlLmNsZWFyKCk7CiAgfQp9CmNsYXNzIEdsb2JhbEltYWdlQ2FjaGUgewogIHN0YXRpYyBOVU1fUEFHRVNfVEhSRVNIT0xEID0gMjsKICBzdGF0aWMgTUlOX0lNQUdFU19UT19DQUNIRSA9IDEwOwogIHN0YXRpYyBNQVhfQllURV9TSVpFID0gNWU3OwogICNkZWNvZGVGYWlsZWRTZXQgPSBuZXcgUmVmU2V0KCk7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLl9yZWZDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgdGhpcy5faW1hZ2VDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogIH0KICBnZXQgI2J5dGVTaXplKCkgewogICAgbGV0IGJ5dGVTaXplID0gMDsKICAgIGZvciAoY29uc3QgaW1hZ2VEYXRhIG9mIHRoaXMuX2ltYWdlQ2FjaGUpIHsKICAgICAgYnl0ZVNpemUgKz0gaW1hZ2VEYXRhLmJ5dGVTaXplOwogICAgfQogICAgcmV0dXJuIGJ5dGVTaXplOwogIH0KICBnZXQgI2NhY2hlTGltaXRSZWFjaGVkKCkgewogICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuc2l6ZSA8IEdsb2JhbEltYWdlQ2FjaGUuTUlOX0lNQUdFU19UT19DQUNIRSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy4jYnl0ZVNpemUgPCBHbG9iYWxJbWFnZUNhY2hlLk1BWF9CWVRFX1NJWkUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIHNob3VsZENhY2hlKHJlZiwgcGFnZUluZGV4KSB7CiAgICBsZXQgcGFnZUluZGV4U2V0ID0gdGhpcy5fcmVmQ2FjaGUuZ2V0KHJlZik7CiAgICBpZiAoIXBhZ2VJbmRleFNldCkgewogICAgICBwYWdlSW5kZXhTZXQgPSBuZXcgU2V0KCk7CiAgICAgIHRoaXMuX3JlZkNhY2hlLnB1dChyZWYsIHBhZ2VJbmRleFNldCk7CiAgICB9CiAgICBwYWdlSW5kZXhTZXQuYWRkKHBhZ2VJbmRleCk7CiAgICBpZiAocGFnZUluZGV4U2V0LnNpemUgPCBHbG9iYWxJbWFnZUNhY2hlLk5VTV9QQUdFU19USFJFU0hPTEQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKCF0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpICYmIHRoaXMuI2NhY2hlTGltaXRSZWFjaGVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBhZGREZWNvZGVGYWlsZWQocmVmKSB7CiAgICB0aGlzLiNkZWNvZGVGYWlsZWRTZXQucHV0KHJlZik7CiAgfQogIGhhc0RlY29kZUZhaWxlZChyZWYpIHsKICAgIHJldHVybiB0aGlzLiNkZWNvZGVGYWlsZWRTZXQuaGFzKHJlZik7CiAgfQogIGFkZEJ5dGVTaXplKHJlZiwgYnl0ZVNpemUpIHsKICAgIGNvbnN0IGltYWdlRGF0YSA9IHRoaXMuX2ltYWdlQ2FjaGUuZ2V0KHJlZik7CiAgICBpZiAoIWltYWdlRGF0YSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoaW1hZ2VEYXRhLmJ5dGVTaXplKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGltYWdlRGF0YS5ieXRlU2l6ZSA9IGJ5dGVTaXplOwogIH0KICBnZXREYXRhKHJlZiwgcGFnZUluZGV4KSB7CiAgICBjb25zdCBwYWdlSW5kZXhTZXQgPSB0aGlzLl9yZWZDYWNoZS5nZXQocmVmKTsKICAgIGlmICghcGFnZUluZGV4U2V0KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKHBhZ2VJbmRleFNldC5zaXplIDwgR2xvYmFsSW1hZ2VDYWNoZS5OVU1fUEFHRVNfVEhSRVNIT0xEKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgaW1hZ2VEYXRhID0gdGhpcy5faW1hZ2VDYWNoZS5nZXQocmVmKTsKICAgIGlmICghaW1hZ2VEYXRhKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcGFnZUluZGV4U2V0LmFkZChwYWdlSW5kZXgpOwogICAgcmV0dXJuIGltYWdlRGF0YTsKICB9CiAgc2V0RGF0YShyZWYsIGRhdGEpIHsKICAgIGlmICghdGhpcy5fcmVmQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdHbG9iYWxJbWFnZUNhY2hlLnNldERhdGEgLSBleHBlY3RlZCAic2hvdWxkQ2FjaGUiIHRvIGhhdmUgYmVlbiBjYWxsZWQuJyk7CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy4jY2FjaGVMaW1pdFJlYWNoZWQpIHsKICAgICAgd2FybigiR2xvYmFsSW1hZ2VDYWNoZS5zZXREYXRhIC0gY2FjaGUgbGltaXQgcmVhY2hlZC4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICB9CiAgY2xlYXIob25seURhdGEgPSBmYWxzZSkgewogICAgaWYgKCFvbmx5RGF0YSkgewogICAgICB0aGlzLiNkZWNvZGVGYWlsZWRTZXQuY2xlYXIoKTsKICAgICAgdGhpcy5fcmVmQ2FjaGUuY2xlYXIoKTsKICAgIH0KICAgIHRoaXMuX2ltYWdlQ2FjaGUuY2xlYXIoKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2Z1bmN0aW9uLmpzCgoKCgoKCmNsYXNzIFBERkZ1bmN0aW9uRmFjdG9yeSB7CiAgY29uc3RydWN0b3IoewogICAgeHJlZiwKICAgIGlzRXZhbFN1cHBvcnRlZCA9IHRydWUKICB9KSB7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5pc0V2YWxTdXBwb3J0ZWQgPSBpc0V2YWxTdXBwb3J0ZWQgIT09IGZhbHNlOwogIH0KICBjcmVhdGUoZm4sIHBhcnNlQXJyYXkgPSBmYWxzZSkgewogICAgbGV0IGZuUmVmLCBwYXJzZWRGbjsKICAgIGlmIChmbiBpbnN0YW5jZW9mIFJlZikgewogICAgICBmblJlZiA9IGZuOwogICAgfSBlbHNlIGlmIChmbiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgZm5SZWYgPSBmbi5vYmpJZDsKICAgIH0gZWxzZSBpZiAoZm4gaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgIGZuUmVmID0gZm4uZGljdD8ub2JqSWQ7CiAgICB9CiAgICBpZiAoZm5SZWYpIHsKICAgICAgY29uc3QgY2FjaGVkRm4gPSB0aGlzLl9sb2NhbEZ1bmN0aW9uQ2FjaGUuZ2V0QnlSZWYoZm5SZWYpOwogICAgICBpZiAoY2FjaGVkRm4pIHsKICAgICAgICByZXR1cm4gY2FjaGVkRm47CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGZuT2JqID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZm4pOwogICAgaWYgKEFycmF5LmlzQXJyYXkoZm5PYmopKSB7CiAgICAgIGlmICghcGFyc2VBcnJheSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignUERGRnVuY3Rpb25GYWN0b3J5LmNyZWF0ZSAtIGV4cGVjdGVkICJwYXJzZUFycmF5IiBhcmd1bWVudC4nKTsKICAgICAgfQogICAgICBwYXJzZWRGbiA9IFBERkZ1bmN0aW9uLnBhcnNlQXJyYXkodGhpcywgZm5PYmopOwogICAgfSBlbHNlIHsKICAgICAgcGFyc2VkRm4gPSBQREZGdW5jdGlvbi5wYXJzZSh0aGlzLCBmbk9iaik7CiAgICB9CiAgICBpZiAoZm5SZWYpIHsKICAgICAgdGhpcy5fbG9jYWxGdW5jdGlvbkNhY2hlLnNldChudWxsLCBmblJlZiwgcGFyc2VkRm4pOwogICAgfQogICAgcmV0dXJuIHBhcnNlZEZuOwogIH0KICBnZXQgX2xvY2FsRnVuY3Rpb25DYWNoZSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9sb2NhbEZ1bmN0aW9uQ2FjaGUiLCBuZXcgTG9jYWxGdW5jdGlvbkNhY2hlKCkpOwogIH0KfQpmdW5jdGlvbiB0b051bWJlckFycmF5KGFycikgewogIGlmICghQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaWYgKCFpc051bWJlckFycmF5KGFyciwgbnVsbCkpIHsKICAgIHJldHVybiBhcnIubWFwKHggPT4gK3gpOwogIH0KICByZXR1cm4gYXJyOwp9CmNsYXNzIFBERkZ1bmN0aW9uIHsKICBzdGF0aWMgZ2V0U2FtcGxlQXJyYXkoc2l6ZSwgb3V0cHV0U2l6ZSwgYnBzLCBzdHJlYW0pIHsKICAgIGxldCBpLCBpaTsKICAgIGxldCBsZW5ndGggPSAxOwogICAgZm9yIChpID0gMCwgaWkgPSBzaXplLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgbGVuZ3RoICo9IHNpemVbaV07CiAgICB9CiAgICBsZW5ndGggKj0gb3V0cHV0U2l6ZTsKICAgIGNvbnN0IGFycmF5ID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBsZXQgY29kZVNpemUgPSAwOwogICAgbGV0IGNvZGVCdWYgPSAwOwogICAgY29uc3Qgc2FtcGxlTXVsID0gMS4wIC8gKDIuMCAqKiBicHMgLSAxKTsKICAgIGNvbnN0IHN0ckJ5dGVzID0gc3RyZWFtLmdldEJ5dGVzKChsZW5ndGggKiBicHMgKyA3KSAvIDgpOwogICAgbGV0IHN0cklkeCA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgd2hpbGUgKGNvZGVTaXplIDwgYnBzKSB7CiAgICAgICAgY29kZUJ1ZiA8PD0gODsKICAgICAgICBjb2RlQnVmIHw9IHN0ckJ5dGVzW3N0cklkeCsrXTsKICAgICAgICBjb2RlU2l6ZSArPSA4OwogICAgICB9CiAgICAgIGNvZGVTaXplIC09IGJwczsKICAgICAgYXJyYXlbaV0gPSAoY29kZUJ1ZiA+PiBjb2RlU2l6ZSkgKiBzYW1wbGVNdWw7CiAgICAgIGNvZGVCdWYgJj0gKDEgPDwgY29kZVNpemUpIC0gMTsKICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9CiAgc3RhdGljIHBhcnNlKGZhY3RvcnksIGZuKSB7CiAgICBjb25zdCBkaWN0ID0gZm4uZGljdCB8fCBmbjsKICAgIGNvbnN0IHR5cGVOdW0gPSBkaWN0LmdldCgiRnVuY3Rpb25UeXBlIik7CiAgICBzd2l0Y2ggKHR5cGVOdW0pIHsKICAgICAgY2FzZSAwOgogICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdFNhbXBsZWQoZmFjdG9yeSwgZm4sIGRpY3QpOwogICAgICBjYXNlIDE6CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjoKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RJbnRlcnBvbGF0ZWQoZmFjdG9yeSwgZGljdCk7CiAgICAgIGNhc2UgMzoKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RTdGljaGVkKGZhY3RvcnksIGRpY3QpOwogICAgICBjYXNlIDQ6CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0UG9zdFNjcmlwdChmYWN0b3J5LCBmbiwgZGljdCk7CiAgICB9CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZSBvZiBmdW5jdGlvbiIpOwogIH0KICBzdGF0aWMgcGFyc2VBcnJheShmYWN0b3J5LCBmbk9iaikgewogICAgY29uc3QgewogICAgICB4cmVmCiAgICB9ID0gZmFjdG9yeTsKICAgIGNvbnN0IGZuQXJyYXkgPSBbXTsKICAgIGZvciAoY29uc3QgZm4gb2YgZm5PYmopIHsKICAgICAgZm5BcnJheS5wdXNoKHRoaXMucGFyc2UoZmFjdG9yeSwgeHJlZi5mZXRjaElmUmVmKGZuKSkpOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uIChzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmbkFycmF5Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBmbkFycmF5W2ldKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0ICsgaSk7CiAgICAgIH0KICAgIH07CiAgfQogIHN0YXRpYyBjb25zdHJ1Y3RTYW1wbGVkKGZhY3RvcnksIGZuLCBkaWN0KSB7CiAgICBmdW5jdGlvbiB0b011bHRpQXJyYXkoYXJyKSB7CiAgICAgIGNvbnN0IGlucHV0TGVuZ3RoID0gYXJyLmxlbmd0aDsKICAgICAgY29uc3Qgb3V0ID0gW107CiAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRMZW5ndGg7IGkgKz0gMikgewogICAgICAgIG91dFtpbmRleCsrXSA9IFthcnJbaV0sIGFycltpICsgMV1dOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICBmdW5jdGlvbiBpbnRlcnBvbGF0ZSh4LCB4bWluLCB4bWF4LCB5bWluLCB5bWF4KSB7CiAgICAgIHJldHVybiB5bWluICsgKHggLSB4bWluKSAqICgoeW1heCAtIHltaW4pIC8gKHhtYXggLSB4bWluKSk7CiAgICB9CiAgICBsZXQgZG9tYWluID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEb21haW4iKSk7CiAgICBsZXQgcmFuZ2UgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIlJhbmdlIikpOwogICAgaWYgKCFkb21haW4gfHwgIXJhbmdlKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gZG9tYWluIG9yIHJhbmdlIik7CiAgICB9CiAgICBjb25zdCBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoIC8gMjsKICAgIGNvbnN0IG91dHB1dFNpemUgPSByYW5nZS5sZW5ndGggLyAyOwogICAgZG9tYWluID0gdG9NdWx0aUFycmF5KGRvbWFpbik7CiAgICByYW5nZSA9IHRvTXVsdGlBcnJheShyYW5nZSk7CiAgICBjb25zdCBzaXplID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJTaXplIikpOwogICAgY29uc3QgYnBzID0gZGljdC5nZXQoIkJpdHNQZXJTYW1wbGUiKTsKICAgIGNvbnN0IG9yZGVyID0gZGljdC5nZXQoIk9yZGVyIikgfHwgMTsKICAgIGlmIChvcmRlciAhPT0gMSkgewogICAgICBpbmZvKCJObyBzdXBwb3J0IGZvciBjdWJpYyBzcGxpbmUgaW50ZXJwb2xhdGlvbjogIiArIG9yZGVyKTsKICAgIH0KICAgIGxldCBlbmNvZGUgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkVuY29kZSIpKTsKICAgIGlmICghZW5jb2RlKSB7CiAgICAgIGVuY29kZSA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0U2l6ZTsgKytpKSB7CiAgICAgICAgZW5jb2RlLnB1c2goWzAsIHNpemVbaV0gLSAxXSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGVuY29kZSA9IHRvTXVsdGlBcnJheShlbmNvZGUpOwogICAgfQogICAgbGV0IGRlY29kZSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiRGVjb2RlIikpOwogICAgZGVjb2RlID0gIWRlY29kZSA/IHJhbmdlIDogdG9NdWx0aUFycmF5KGRlY29kZSk7CiAgICBjb25zdCBzYW1wbGVzID0gdGhpcy5nZXRTYW1wbGVBcnJheShzaXplLCBvdXRwdXRTaXplLCBicHMsIGZuKTsKICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RTYW1wbGVkRm4oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgY29uc3QgY3ViZVZlcnRpY2VzID0gMSA8PCBpbnB1dFNpemU7CiAgICAgIGNvbnN0IGN1YmVOID0gbmV3IEZsb2F0NjRBcnJheShjdWJlVmVydGljZXMpLmZpbGwoMSk7CiAgICAgIGNvbnN0IGN1YmVWZXJ0ZXggPSBuZXcgVWludDMyQXJyYXkoY3ViZVZlcnRpY2VzKTsKICAgICAgbGV0IGksIGo7CiAgICAgIGxldCBrID0gb3V0cHV0U2l6ZSwKICAgICAgICBwb3MgPSAxOwogICAgICBmb3IgKGkgPSAwOyBpIDwgaW5wdXRTaXplOyArK2kpIHsKICAgICAgICBjb25zdCBkb21haW5fMmkgPSBkb21haW5baV1bMF07CiAgICAgICAgY29uc3QgZG9tYWluXzJpXzEgPSBkb21haW5baV1bMV07CiAgICAgICAgY29uc3QgeGkgPSBNYXRoQ2xhbXAoc3JjW3NyY09mZnNldCArIGldLCBkb21haW5fMmksIGRvbWFpbl8yaV8xKTsKICAgICAgICBsZXQgZSA9IGludGVycG9sYXRlKHhpLCBkb21haW5fMmksIGRvbWFpbl8yaV8xLCBlbmNvZGVbaV1bMF0sIGVuY29kZVtpXVsxXSk7CiAgICAgICAgY29uc3Qgc2l6ZV9pID0gc2l6ZVtpXTsKICAgICAgICBlID0gTWF0aENsYW1wKGUsIDAsIHNpemVfaSAtIDEpOwogICAgICAgIGNvbnN0IGUwID0gZSA8IHNpemVfaSAtIDEgPyBNYXRoLmZsb29yKGUpIDogZSAtIDE7CiAgICAgICAgY29uc3QgbjAgPSBlMCArIDEgLSBlOwogICAgICAgIGNvbnN0IG4xID0gZSAtIGUwOwogICAgICAgIGNvbnN0IG9mZnNldDAgPSBlMCAqIGs7CiAgICAgICAgY29uc3Qgb2Zmc2V0MSA9IG9mZnNldDAgKyBrOwogICAgICAgIGZvciAoaiA9IDA7IGogPCBjdWJlVmVydGljZXM7IGorKykgewogICAgICAgICAgaWYgKGogJiBwb3MpIHsKICAgICAgICAgICAgY3ViZU5bal0gKj0gbjE7CiAgICAgICAgICAgIGN1YmVWZXJ0ZXhbal0gKz0gb2Zmc2V0MTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1YmVOW2pdICo9IG4wOwogICAgICAgICAgICBjdWJlVmVydGV4W2pdICs9IG9mZnNldDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGsgKj0gc2l6ZV9pOwogICAgICAgIHBvcyA8PD0gMTsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgb3V0cHV0U2l6ZTsgKytqKSB7CiAgICAgICAgbGV0IHJqID0gMDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY3ViZVZlcnRpY2VzOyBpKyspIHsKICAgICAgICAgIHJqICs9IHNhbXBsZXNbY3ViZVZlcnRleFtpXSArIGpdICogY3ViZU5baV07CiAgICAgICAgfQogICAgICAgIHJqID0gaW50ZXJwb2xhdGUocmosIDAsIDEsIGRlY29kZVtqXVswXSwgZGVjb2RlW2pdWzFdKTsKICAgICAgICBkZXN0W2Rlc3RPZmZzZXQgKyBqXSA9IE1hdGhDbGFtcChyaiwgcmFuZ2Vbal1bMF0sIHJhbmdlW2pdWzFdKTsKICAgICAgfQogICAgfTsKICB9CiAgc3RhdGljIGNvbnN0cnVjdEludGVycG9sYXRlZChmYWN0b3J5LCBkaWN0KSB7CiAgICBjb25zdCBjMCA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiQzAiKSkgfHwgWzBdOwogICAgY29uc3QgYzEgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkMxIikpIHx8IFsxXTsKICAgIGNvbnN0IG4gPSBkaWN0LmdldCgiTiIpOwogICAgY29uc3QgZGlmZiA9IFtdOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYzAubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBkaWZmLnB1c2goYzFbaV0gLSBjMFtpXSk7CiAgICB9CiAgICBjb25zdCBsZW5ndGggPSBkaWZmLmxlbmd0aDsKICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RJbnRlcnBvbGF0ZWRGbihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBjb25zdCB4ID0gbiA9PT0gMSA/IHNyY1tzcmNPZmZzZXRdIDogc3JjW3NyY09mZnNldF0gKiogbjsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7ICsraikgewogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIGpdID0gYzBbal0gKyB4ICogZGlmZltqXTsKICAgICAgfQogICAgfTsKICB9CiAgc3RhdGljIGNvbnN0cnVjdFN0aWNoZWQoZmFjdG9yeSwgZGljdCkgewogICAgY29uc3QgZG9tYWluID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEb21haW4iKSk7CiAgICBpZiAoIWRvbWFpbikgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk5vIGRvbWFpbiIpOwogICAgfQogICAgY29uc3QgaW5wdXRTaXplID0gZG9tYWluLmxlbmd0aCAvIDI7CiAgICBpZiAoaW5wdXRTaXplICE9PSAxKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQmFkIGRvbWFpbiBmb3Igc3RpY2hlZCBmdW5jdGlvbiIpOwogICAgfQogICAgY29uc3QgewogICAgICB4cmVmCiAgICB9ID0gZmFjdG9yeTsKICAgIGNvbnN0IGZucyA9IFtdOwogICAgZm9yIChjb25zdCBmbiBvZiBkaWN0LmdldCgiRnVuY3Rpb25zIikpIHsKICAgICAgZm5zLnB1c2godGhpcy5wYXJzZShmYWN0b3J5LCB4cmVmLmZldGNoSWZSZWYoZm4pKSk7CiAgICB9CiAgICBjb25zdCBib3VuZHMgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkJvdW5kcyIpKTsKICAgIGNvbnN0IGVuY29kZSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiRW5jb2RlIikpOwogICAgY29uc3QgdG1wQnVmID0gbmV3IEZsb2F0MzJBcnJheSgxKTsKICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RTdGljaGVkRm4oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgY29uc3QgdiA9IE1hdGhDbGFtcChzcmNbc3JjT2Zmc2V0XSwgZG9tYWluWzBdLCBkb21haW5bMV0pOwogICAgICBjb25zdCBsZW5ndGggPSBib3VuZHMubGVuZ3RoOwogICAgICBsZXQgaTsKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKHYgPCBib3VuZHNbaV0pIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBsZXQgZG1pbiA9IGRvbWFpblswXTsKICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgZG1pbiA9IGJvdW5kc1tpIC0gMV07CiAgICAgIH0KICAgICAgbGV0IGRtYXggPSBkb21haW5bMV07CiAgICAgIGlmIChpIDwgYm91bmRzLmxlbmd0aCkgewogICAgICAgIGRtYXggPSBib3VuZHNbaV07CiAgICAgIH0KICAgICAgY29uc3Qgcm1pbiA9IGVuY29kZVsyICogaV07CiAgICAgIGNvbnN0IHJtYXggPSBlbmNvZGVbMiAqIGkgKyAxXTsKICAgICAgdG1wQnVmWzBdID0gZG1pbiA9PT0gZG1heCA/IHJtaW4gOiBybWluICsgKHYgLSBkbWluKSAqIChybWF4IC0gcm1pbikgLyAoZG1heCAtIGRtaW4pOwogICAgICBmbnNbaV0odG1wQnVmLCAwLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICAgIH07CiAgfQogIHN0YXRpYyBjb25zdHJ1Y3RQb3N0U2NyaXB0KGZhY3RvcnksIGZuLCBkaWN0KSB7CiAgICBjb25zdCBkb21haW4gPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkRvbWFpbiIpKTsKICAgIGNvbnN0IHJhbmdlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJSYW5nZSIpKTsKICAgIGlmICghZG9tYWluKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gZG9tYWluLiIpOwogICAgfQogICAgaWYgKCFyYW5nZSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk5vIHJhbmdlLiIpOwogICAgfQogICAgY29uc3QgbGV4ZXIgPSBuZXcgUG9zdFNjcmlwdExleGVyKGZuKTsKICAgIGNvbnN0IHBhcnNlciA9IG5ldyBQb3N0U2NyaXB0UGFyc2VyKGxleGVyKTsKICAgIGNvbnN0IGNvZGUgPSBwYXJzZXIucGFyc2UoKTsKICAgIGlmIChmYWN0b3J5LmlzRXZhbFN1cHBvcnRlZCAmJiBGZWF0dXJlVGVzdC5pc0V2YWxTdXBwb3J0ZWQpIHsKICAgICAgY29uc3QgY29tcGlsZWQgPSBuZXcgUG9zdFNjcmlwdENvbXBpbGVyKCkuY29tcGlsZShjb2RlLCBkb21haW4sIHJhbmdlKTsKICAgICAgaWYgKGNvbXBpbGVkKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbigic3JjIiwgInNyY09mZnNldCIsICJkZXN0IiwgImRlc3RPZmZzZXQiLCBjb21waWxlZCk7CiAgICAgIH0KICAgIH0KICAgIGluZm8oIlVuYWJsZSB0byBjb21waWxlIFBTIGZ1bmN0aW9uIik7CiAgICBjb25zdCBudW1PdXRwdXRzID0gcmFuZ2UubGVuZ3RoID4+IDE7CiAgICBjb25zdCBudW1JbnB1dHMgPSBkb21haW4ubGVuZ3RoID4+IDE7CiAgICBjb25zdCBldmFsdWF0b3IgPSBuZXcgUG9zdFNjcmlwdEV2YWx1YXRvcihjb2RlKTsKICAgIGNvbnN0IGNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGNvbnN0IE1BWF9DQUNIRV9TSVpFID0gMjA0OCAqIDQ7CiAgICBsZXQgY2FjaGVfYXZhaWxhYmxlID0gTUFYX0NBQ0hFX1NJWkU7CiAgICBjb25zdCB0bXBCdWYgPSBuZXcgRmxvYXQzMkFycmF5KG51bUlucHV0cyk7CiAgICByZXR1cm4gZnVuY3Rpb24gY29uc3RydWN0UG9zdFNjcmlwdEZuKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgIGxldCBpLCB2YWx1ZTsKICAgICAgbGV0IGtleSA9ICIiOwogICAgICBjb25zdCBpbnB1dCA9IHRtcEJ1ZjsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bUlucHV0czsgaSsrKSB7CiAgICAgICAgdmFsdWUgPSBzcmNbc3JjT2Zmc2V0ICsgaV07CiAgICAgICAgaW5wdXRbaV0gPSB2YWx1ZTsKICAgICAgICBrZXkgKz0gdmFsdWUgKyAiXyI7CiAgICAgIH0KICAgICAgY29uc3QgY2FjaGVkVmFsdWUgPSBjYWNoZVtrZXldOwogICAgICBpZiAoY2FjaGVkVmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGRlc3Quc2V0KGNhY2hlZFZhbHVlLCBkZXN0T2Zmc2V0KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgb3V0cHV0ID0gbmV3IEZsb2F0MzJBcnJheShudW1PdXRwdXRzKTsKICAgICAgY29uc3Qgc3RhY2sgPSBldmFsdWF0b3IuZXhlY3V0ZShpbnB1dCk7CiAgICAgIGNvbnN0IHN0YWNrSW5kZXggPSBzdGFjay5sZW5ndGggLSBudW1PdXRwdXRzOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtT3V0cHV0czsgaSsrKSB7CiAgICAgICAgdmFsdWUgPSBzdGFja1tzdGFja0luZGV4ICsgaV07CiAgICAgICAgbGV0IGJvdW5kID0gcmFuZ2VbaSAqIDJdOwogICAgICAgIGlmICh2YWx1ZSA8IGJvdW5kKSB7CiAgICAgICAgICB2YWx1ZSA9IGJvdW5kOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBib3VuZCA9IHJhbmdlW2kgKiAyICsgMV07CiAgICAgICAgICBpZiAodmFsdWUgPiBib3VuZCkgewogICAgICAgICAgICB2YWx1ZSA9IGJvdW5kOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvdXRwdXRbaV0gPSB2YWx1ZTsKICAgICAgfQogICAgICBpZiAoY2FjaGVfYXZhaWxhYmxlID4gMCkgewogICAgICAgIGNhY2hlX2F2YWlsYWJsZS0tOwogICAgICAgIGNhY2hlW2tleV0gPSBvdXRwdXQ7CiAgICAgIH0KICAgICAgZGVzdC5zZXQob3V0cHV0LCBkZXN0T2Zmc2V0KTsKICAgIH07CiAgfQp9CmZ1bmN0aW9uIGlzUERGRnVuY3Rpb24odikgewogIGxldCBmbkRpY3Q7CiAgaWYgKHYgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICBmbkRpY3QgPSB2OwogIH0gZWxzZSBpZiAodiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgIGZuRGljdCA9IHYuZGljdDsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICByZXR1cm4gZm5EaWN0LmhhcygiRnVuY3Rpb25UeXBlIik7Cn0KY2xhc3MgUG9zdFNjcmlwdFN0YWNrIHsKICBzdGF0aWMgTUFYX1NUQUNLX1NJWkUgPSAxMDA7CiAgY29uc3RydWN0b3IoaW5pdGlhbFN0YWNrKSB7CiAgICB0aGlzLnN0YWNrID0gaW5pdGlhbFN0YWNrID8gQXJyYXkuZnJvbShpbml0aWFsU3RhY2spIDogW107CiAgfQogIHB1c2godmFsdWUpIHsKICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA+PSBQb3N0U2NyaXB0U3RhY2suTUFYX1NUQUNLX1NJWkUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJQb3N0U2NyaXB0IGZ1bmN0aW9uIHN0YWNrIG92ZXJmbG93LiIpOwogICAgfQogICAgdGhpcy5zdGFjay5wdXNoKHZhbHVlKTsKICB9CiAgcG9wKCkgewogICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDw9IDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJQb3N0U2NyaXB0IGZ1bmN0aW9uIHN0YWNrIHVuZGVyZmxvdy4iKTsKICAgIH0KICAgIHJldHVybiB0aGlzLnN0YWNrLnBvcCgpOwogIH0KICBjb3B5KG4pIHsKICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCArIG4gPj0gUG9zdFNjcmlwdFN0YWNrLk1BWF9TVEFDS19TSVpFKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiUG9zdFNjcmlwdCBmdW5jdGlvbiBzdGFjayBvdmVyZmxvdy4iKTsKICAgIH0KICAgIGNvbnN0IHN0YWNrID0gdGhpcy5zdGFjazsKICAgIGZvciAobGV0IGkgPSBzdGFjay5sZW5ndGggLSBuLCBqID0gbiAtIDE7IGogPj0gMDsgai0tLCBpKyspIHsKICAgICAgc3RhY2sucHVzaChzdGFja1tpXSk7CiAgICB9CiAgfQogIGluZGV4KG4pIHsKICAgIHRoaXMucHVzaCh0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gbiAtIDFdKTsKICB9CiAgcm9sbChuLCBwKSB7CiAgICBjb25zdCBzdGFjayA9IHRoaXMuc3RhY2s7CiAgICBjb25zdCBsID0gc3RhY2subGVuZ3RoIC0gbjsKICAgIGNvbnN0IHIgPSBzdGFjay5sZW5ndGggLSAxOwogICAgY29uc3QgYyA9IGwgKyAocCAtIE1hdGguZmxvb3IocCAvIG4pICogbik7CiAgICBmb3IgKGxldCBpID0gbCwgaiA9IHI7IGkgPCBqOyBpKyssIGotLSkgewogICAgICBjb25zdCB0ID0gc3RhY2tbaV07CiAgICAgIHN0YWNrW2ldID0gc3RhY2tbal07CiAgICAgIHN0YWNrW2pdID0gdDsKICAgIH0KICAgIGZvciAobGV0IGkgPSBsLCBqID0gYyAtIDE7IGkgPCBqOyBpKyssIGotLSkgewogICAgICBjb25zdCB0ID0gc3RhY2tbaV07CiAgICAgIHN0YWNrW2ldID0gc3RhY2tbal07CiAgICAgIHN0YWNrW2pdID0gdDsKICAgIH0KICAgIGZvciAobGV0IGkgPSBjLCBqID0gcjsgaSA8IGo7IGkrKywgai0tKSB7CiAgICAgIGNvbnN0IHQgPSBzdGFja1tpXTsKICAgICAgc3RhY2tbaV0gPSBzdGFja1tqXTsKICAgICAgc3RhY2tbal0gPSB0OwogICAgfQogIH0KfQpjbGFzcyBQb3N0U2NyaXB0RXZhbHVhdG9yIHsKICBjb25zdHJ1Y3RvcihvcGVyYXRvcnMpIHsKICAgIHRoaXMub3BlcmF0b3JzID0gb3BlcmF0b3JzOwogIH0KICBleGVjdXRlKGluaXRpYWxTdGFjaykgewogICAgY29uc3Qgc3RhY2sgPSBuZXcgUG9zdFNjcmlwdFN0YWNrKGluaXRpYWxTdGFjayk7CiAgICBsZXQgY291bnRlciA9IDA7CiAgICBjb25zdCBvcGVyYXRvcnMgPSB0aGlzLm9wZXJhdG9yczsKICAgIGNvbnN0IGxlbmd0aCA9IG9wZXJhdG9ycy5sZW5ndGg7CiAgICBsZXQgb3BlcmF0b3IsIGEsIGI7CiAgICB3aGlsZSAoY291bnRlciA8IGxlbmd0aCkgewogICAgICBvcGVyYXRvciA9IG9wZXJhdG9yc1tjb3VudGVyKytdOwogICAgICBpZiAodHlwZW9mIG9wZXJhdG9yID09PSAibnVtYmVyIikgewogICAgICAgIHN0YWNrLnB1c2gob3BlcmF0b3IpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHsKICAgICAgICBjYXNlICJqeiI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBpZiAoIWEpIHsKICAgICAgICAgICAgY291bnRlciA9IGI7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJqIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGNvdW50ZXIgPSBhOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiYWJzIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5hYnMoYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiYWRkIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSArIGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiYW5kIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gImJvb2xlYW4iICYmIHR5cGVvZiBiID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhICYmIGIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhICYgYik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhdGFuIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBNYXRoLmF0YW4yKGEsIGIpIC8gTWF0aC5QSSAqIDE4MDsKICAgICAgICAgIGlmIChhIDwgMCkgewogICAgICAgICAgICBhICs9IDM2MDsKICAgICAgICAgIH0KICAgICAgICAgIHN0YWNrLnB1c2goYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJiaXRzaGlmdCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBpZiAoYSA+IDApIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhIDw8IGIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhID4+IGIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY2VpbGluZyI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGguY2VpbChhKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjb3B5IjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLmNvcHkoYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjb3MiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLmNvcyhhICUgMzYwIC8gMTgwICogTWF0aC5QSSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY3ZpIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKSB8IDA7CiAgICAgICAgICBzdGFjay5wdXNoKGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY3ZyIjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRpdiI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgLyBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImR1cCI6CiAgICAgICAgICBzdGFjay5jb3B5KDEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXEiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhID09PSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImV4Y2giOgogICAgICAgICAgc3RhY2sucm9sbCgyLCAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImV4cCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgKiogYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJmYWxzZSI6CiAgICAgICAgICBzdGFjay5wdXNoKGZhbHNlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImZsb29yIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5mbG9vcihhKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJnZSI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPj0gYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJndCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPiBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImlkaXYiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhIC8gYiB8IDApOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiaW5kZXgiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2suaW5kZXgoYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsZSI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPD0gYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsbiI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGgubG9nKGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxvZyI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGgubG9nMTAoYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibHQiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhIDwgYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtb2QiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhICUgYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtdWwiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhICogYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJuZSI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgIT09IGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibmVnIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goLWEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibm90IjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goIWEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaCh+YSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJvciI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBpZiAodHlwZW9mIGEgPT09ICJib29sZWFuIiAmJiB0eXBlb2YgYiA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYSB8fCBiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYSB8IGIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicG9wIjoKICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicm9sbCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5yb2xsKGEsIGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicm91bmQiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLnJvdW5kKGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInNpbiI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGguc2luKGEgJSAzNjAgLyAxODAgKiBNYXRoLlBJKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzcXJ0IjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5zcXJ0KGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN1YiI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgLSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInRydWUiOgogICAgICAgICAgc3RhY2sucHVzaCh0cnVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInRydW5jYXRlIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBhIDwgMCA/IE1hdGguY2VpbChhKSA6IE1hdGguZmxvb3IoYSk7CiAgICAgICAgICBzdGFjay5wdXNoKGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAieG9yIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gImJvb2xlYW4iICYmIHR5cGVvZiBiID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhICE9PSBiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYSBeIGIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5rbm93biBvcGVyYXRvciAke29wZXJhdG9yfWApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RhY2suc3RhY2s7CiAgfQp9CmNsYXNzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKHR5cGUpIHsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHVucmVhY2hhYmxlKCJhYnN0cmFjdCBtZXRob2QiKTsKICB9Cn0KY2xhc3MgQXN0QXJndW1lbnQgZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3RvcihpbmRleCwgbWluLCBtYXgpIHsKICAgIHN1cGVyKCJhcmdzIik7CiAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICB0aGlzLm1pbiA9IG1pbjsKICAgIHRoaXMubWF4ID0gbWF4OwogIH0KICB2aXNpdCh2aXNpdG9yKSB7CiAgICB2aXNpdG9yLnZpc2l0QXJndW1lbnQodGhpcyk7CiAgfQp9CmNsYXNzIEFzdExpdGVyYWwgZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3RvcihudW1iZXIpIHsKICAgIHN1cGVyKCJsaXRlcmFsIik7CiAgICB0aGlzLm51bWJlciA9IG51bWJlcjsKICAgIHRoaXMubWluID0gbnVtYmVyOwogICAgdGhpcy5tYXggPSBudW1iZXI7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHZpc2l0b3IudmlzaXRMaXRlcmFsKHRoaXMpOwogIH0KfQpjbGFzcyBBc3RCaW5hcnlPcGVyYXRpb24gZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3RvcihvcCwgYXJnMSwgYXJnMiwgbWluLCBtYXgpIHsKICAgIHN1cGVyKCJiaW5hcnkiKTsKICAgIHRoaXMub3AgPSBvcDsKICAgIHRoaXMuYXJnMSA9IGFyZzE7CiAgICB0aGlzLmFyZzIgPSBhcmcyOwogICAgdGhpcy5taW4gPSBtaW47CiAgICB0aGlzLm1heCA9IG1heDsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdmlzaXRvci52aXNpdEJpbmFyeU9wZXJhdGlvbih0aGlzKTsKICB9Cn0KY2xhc3MgQXN0TWluIGV4dGVuZHMgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IoYXJnLCBtYXgpIHsKICAgIHN1cGVyKCJtYXgiKTsKICAgIHRoaXMuYXJnID0gYXJnOwogICAgdGhpcy5taW4gPSBhcmcubWluOwogICAgdGhpcy5tYXggPSBtYXg7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHZpc2l0b3IudmlzaXRNaW4odGhpcyk7CiAgfQp9CmNsYXNzIEFzdFZhcmlhYmxlIGV4dGVuZHMgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IoaW5kZXgsIG1pbiwgbWF4KSB7CiAgICBzdXBlcigidmFyIik7CiAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICB0aGlzLm1pbiA9IG1pbjsKICAgIHRoaXMubWF4ID0gbWF4OwogIH0KICB2aXNpdCh2aXNpdG9yKSB7CiAgICB2aXNpdG9yLnZpc2l0VmFyaWFibGUodGhpcyk7CiAgfQp9CmNsYXNzIEFzdFZhcmlhYmxlRGVmaW5pdGlvbiBleHRlbmRzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKHZhcmlhYmxlLCBhcmcpIHsKICAgIHN1cGVyKCJkZWZpbml0aW9uIik7CiAgICB0aGlzLnZhcmlhYmxlID0gdmFyaWFibGU7CiAgICB0aGlzLmFyZyA9IGFyZzsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdmlzaXRvci52aXNpdFZhcmlhYmxlRGVmaW5pdGlvbih0aGlzKTsKICB9Cn0KY2xhc3MgRXhwcmVzc2lvbkJ1aWxkZXJWaXNpdG9yIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMucGFydHMgPSBbXTsKICB9CiAgdmlzaXRBcmd1bWVudChhcmcpIHsKICAgIHRoaXMucGFydHMucHVzaCgiTWF0aC5tYXgoIiwgYXJnLm1pbiwgIiwgTWF0aC5taW4oIiwgYXJnLm1heCwgIiwgc3JjW3NyY09mZnNldCArICIsIGFyZy5pbmRleCwgIl0pKSIpOwogIH0KICB2aXNpdFZhcmlhYmxlKHZhcmlhYmxlKSB7CiAgICB0aGlzLnBhcnRzLnB1c2goInYiLCB2YXJpYWJsZS5pbmRleCk7CiAgfQogIHZpc2l0TGl0ZXJhbChsaXRlcmFsKSB7CiAgICB0aGlzLnBhcnRzLnB1c2gobGl0ZXJhbC5udW1iZXIpOwogIH0KICB2aXNpdEJpbmFyeU9wZXJhdGlvbihvcGVyYXRpb24pIHsKICAgIHRoaXMucGFydHMucHVzaCgiKCIpOwogICAgb3BlcmF0aW9uLmFyZzEudmlzaXQodGhpcyk7CiAgICB0aGlzLnBhcnRzLnB1c2goIiAiLCBvcGVyYXRpb24ub3AsICIgIik7CiAgICBvcGVyYXRpb24uYXJnMi52aXNpdCh0aGlzKTsKICAgIHRoaXMucGFydHMucHVzaCgiKSIpOwogIH0KICB2aXNpdFZhcmlhYmxlRGVmaW5pdGlvbihkZWZpbml0aW9uKSB7CiAgICB0aGlzLnBhcnRzLnB1c2goInZhciAiKTsKICAgIGRlZmluaXRpb24udmFyaWFibGUudmlzaXQodGhpcyk7CiAgICB0aGlzLnBhcnRzLnB1c2goIiA9ICIpOwogICAgZGVmaW5pdGlvbi5hcmcudmlzaXQodGhpcyk7CiAgICB0aGlzLnBhcnRzLnB1c2goIjsiKTsKICB9CiAgdmlzaXRNaW4obWF4KSB7CiAgICB0aGlzLnBhcnRzLnB1c2goIk1hdGgubWluKCIpOwogICAgbWF4LmFyZy52aXNpdCh0aGlzKTsKICAgIHRoaXMucGFydHMucHVzaCgiLCAiLCBtYXgubWF4LCAiKSIpOwogIH0KICB0b1N0cmluZygpIHsKICAgIHJldHVybiB0aGlzLnBhcnRzLmpvaW4oIiIpOwogIH0KfQpmdW5jdGlvbiBidWlsZEFkZE9wZXJhdGlvbihudW0xLCBudW0yKSB7CiAgaWYgKG51bTIudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTIubnVtYmVyID09PSAwKSB7CiAgICByZXR1cm4gbnVtMTsKICB9CiAgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTEubnVtYmVyID09PSAwKSB7CiAgICByZXR1cm4gbnVtMjsKICB9CiAgaWYgKG51bTIudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwobnVtMS5udW1iZXIgKyBudW0yLm51bWJlcik7CiAgfQogIHJldHVybiBuZXcgQXN0QmluYXJ5T3BlcmF0aW9uKCIrIiwgbnVtMSwgbnVtMiwgbnVtMS5taW4gKyBudW0yLm1pbiwgbnVtMS5tYXggKyBudW0yLm1heCk7Cn0KZnVuY3Rpb24gYnVpbGRNdWxPcGVyYXRpb24obnVtMSwgbnVtMikgewogIGlmIChudW0yLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgaWYgKG51bTIubnVtYmVyID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbCgwKTsKICAgIH0gZWxzZSBpZiAobnVtMi5udW1iZXIgPT09IDEpIHsKICAgICAgcmV0dXJuIG51bTE7CiAgICB9IGVsc2UgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbChudW0xLm51bWJlciAqIG51bTIubnVtYmVyKTsKICAgIH0KICB9CiAgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICBpZiAobnVtMS5udW1iZXIgPT09IDApIHsKICAgICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKDApOwogICAgfSBlbHNlIGlmIChudW0xLm51bWJlciA9PT0gMSkgewogICAgICByZXR1cm4gbnVtMjsKICAgIH0KICB9CiAgY29uc3QgbWluID0gTWF0aC5taW4obnVtMS5taW4gKiBudW0yLm1pbiwgbnVtMS5taW4gKiBudW0yLm1heCwgbnVtMS5tYXggKiBudW0yLm1pbiwgbnVtMS5tYXggKiBudW0yLm1heCk7CiAgY29uc3QgbWF4ID0gTWF0aC5tYXgobnVtMS5taW4gKiBudW0yLm1pbiwgbnVtMS5taW4gKiBudW0yLm1heCwgbnVtMS5tYXggKiBudW0yLm1pbiwgbnVtMS5tYXggKiBudW0yLm1heCk7CiAgcmV0dXJuIG5ldyBBc3RCaW5hcnlPcGVyYXRpb24oIioiLCBudW0xLCBudW0yLCBtaW4sIG1heCk7Cn0KZnVuY3Rpb24gYnVpbGRTdWJPcGVyYXRpb24obnVtMSwgbnVtMikgewogIGlmIChudW0yLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgaWYgKG51bTIubnVtYmVyID09PSAwKSB7CiAgICAgIHJldHVybiBudW0xOwogICAgfSBlbHNlIGlmIChudW0xLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwobnVtMS5udW1iZXIgLSBudW0yLm51bWJlcik7CiAgICB9CiAgfQogIGlmIChudW0yLnR5cGUgPT09ICJiaW5hcnkiICYmIG51bTIub3AgPT09ICItIiAmJiBudW0xLnR5cGUgPT09ICJsaXRlcmFsIiAmJiBudW0xLm51bWJlciA9PT0gMSAmJiBudW0yLmFyZzEudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTIuYXJnMS5udW1iZXIgPT09IDEpIHsKICAgIHJldHVybiBudW0yLmFyZzI7CiAgfQogIHJldHVybiBuZXcgQXN0QmluYXJ5T3BlcmF0aW9uKCItIiwgbnVtMSwgbnVtMiwgbnVtMS5taW4gLSBudW0yLm1heCwgbnVtMS5tYXggLSBudW0yLm1pbik7Cn0KZnVuY3Rpb24gYnVpbGRNaW5PcGVyYXRpb24obnVtMSwgbWF4KSB7CiAgaWYgKG51bTEubWluID49IG1heCkgewogICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKG1heCk7CiAgfSBlbHNlIGlmIChudW0xLm1heCA8PSBtYXgpIHsKICAgIHJldHVybiBudW0xOwogIH0KICByZXR1cm4gbmV3IEFzdE1pbihudW0xLCBtYXgpOwp9CmNsYXNzIFBvc3RTY3JpcHRDb21waWxlciB7CiAgY29tcGlsZShjb2RlLCBkb21haW4sIHJhbmdlKSB7CiAgICBjb25zdCBzdGFjayA9IFtdOwogICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gW107CiAgICBjb25zdCBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoID4+IDEsCiAgICAgIG91dHB1dFNpemUgPSByYW5nZS5sZW5ndGggPj4gMTsKICAgIGxldCBsYXN0UmVnaXN0ZXIgPSAwOwogICAgbGV0IG4sIGo7CiAgICBsZXQgbnVtMSwgbnVtMiwgYXN0MSwgYXN0MiwgdG1wVmFyLCBpdGVtOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dFNpemU7IGkrKykgewogICAgICBzdGFjay5wdXNoKG5ldyBBc3RBcmd1bWVudChpLCBkb21haW5baSAqIDJdLCBkb21haW5baSAqIDIgKyAxXSkpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY29kZS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGl0ZW0gPSBjb2RlW2ldOwogICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICJudW1iZXIiKSB7CiAgICAgICAgc3RhY2sucHVzaChuZXcgQXN0TGl0ZXJhbChpdGVtKSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChpdGVtKSB7CiAgICAgICAgY2FzZSAiYWRkIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChidWlsZEFkZE9wZXJhdGlvbihudW0xLCBudW0yKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjdnIiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtdWwiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBudW0yID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBudW0xID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGJ1aWxkTXVsT3BlcmF0aW9uKG51bTEsIG51bTIpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN1YiI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG51bTIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG51bTEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYnVpbGRTdWJPcGVyYXRpb24obnVtMSwgbnVtMikpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXhjaCI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGFzdDEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGFzdDIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYXN0MSwgYXN0Mik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJwb3AiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImluZGV4IjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKG51bTEudHlwZSAhPT0gImxpdGVyYWwiKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbiA9IG51bTEubnVtYmVyOwogICAgICAgICAgaWYgKG4gPCAwIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG4pIHx8IHN0YWNrLmxlbmd0aCA8IG4pIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBhc3QxID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gbiAtIDFdOwogICAgICAgICAgaWYgKGFzdDEudHlwZSA9PT0gImxpdGVyYWwiIHx8IGFzdDEudHlwZSA9PT0gInZhciIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhc3QxKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB0bXBWYXIgPSBuZXcgQXN0VmFyaWFibGUobGFzdFJlZ2lzdGVyKyssIGFzdDEubWluLCBhc3QxLm1heCk7CiAgICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSBuIC0gMV0gPSB0bXBWYXI7CiAgICAgICAgICBzdGFjay5wdXNoKHRtcFZhcik7CiAgICAgICAgICBpbnN0cnVjdGlvbnMucHVzaChuZXcgQXN0VmFyaWFibGVEZWZpbml0aW9uKHRtcFZhciwgYXN0MSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZHVwIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBjb2RlW2kgKyAxXSA9PT0gIm51bWJlciIgJiYgY29kZVtpICsgMl0gPT09ICJndCIgJiYgY29kZVtpICsgM10gPT09IGkgKyA3ICYmIGNvZGVbaSArIDRdID09PSAianoiICYmIGNvZGVbaSArIDVdID09PSAicG9wIiAmJiBjb2RlW2kgKyA2XSA9PT0gY29kZVtpICsgMV0pIHsKICAgICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICBzdGFjay5wdXNoKGJ1aWxkTWluT3BlcmF0aW9uKG51bTEsIGNvZGVbaSArIDFdKSk7CiAgICAgICAgICAgIGkgKz0gNjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBhc3QxID0gc3RhY2suYXQoLTEpOwogICAgICAgICAgaWYgKGFzdDEudHlwZSA9PT0gImxpdGVyYWwiIHx8IGFzdDEudHlwZSA9PT0gInZhciIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhc3QxKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB0bXBWYXIgPSBuZXcgQXN0VmFyaWFibGUobGFzdFJlZ2lzdGVyKyssIGFzdDEubWluLCBhc3QxLm1heCk7CiAgICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSAxXSA9IHRtcFZhcjsKICAgICAgICAgIHN0YWNrLnB1c2godG1wVmFyKTsKICAgICAgICAgIGluc3RydWN0aW9ucy5wdXNoKG5ldyBBc3RWYXJpYWJsZURlZmluaXRpb24odG1wVmFyLCBhc3QxKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyb2xsIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKG51bTIudHlwZSAhPT0gImxpdGVyYWwiIHx8IG51bTEudHlwZSAhPT0gImxpdGVyYWwiKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaiA9IG51bTIubnVtYmVyOwogICAgICAgICAgbiA9IG51bTEubnVtYmVyOwogICAgICAgICAgaWYgKG4gPD0gMCB8fCAhTnVtYmVyLmlzSW50ZWdlcihuKSB8fCAhTnVtYmVyLmlzSW50ZWdlcihqKSB8fCBzdGFjay5sZW5ndGggPCBuKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaiA9IChqICUgbiArIG4pICUgbjsKICAgICAgICAgIGlmIChqID09PSAwKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgc3RhY2sucHVzaCguLi5zdGFjay5zcGxpY2Uoc3RhY2subGVuZ3RoIC0gbiwgbiAtIGopKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgaWYgKHN0YWNrLmxlbmd0aCAhPT0gb3V0cHV0U2l6ZSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgZm9yIChjb25zdCBpbnN0cnVjdGlvbiBvZiBpbnN0cnVjdGlvbnMpIHsKICAgICAgY29uc3Qgc3RhdGVtZW50QnVpbGRlciA9IG5ldyBFeHByZXNzaW9uQnVpbGRlclZpc2l0b3IoKTsKICAgICAgaW5zdHJ1Y3Rpb24udmlzaXQoc3RhdGVtZW50QnVpbGRlcik7CiAgICAgIHJlc3VsdC5wdXNoKHN0YXRlbWVudEJ1aWxkZXIudG9TdHJpbmcoKSk7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdGFjay5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGV4cHIgPSBzdGFja1tpXSwKICAgICAgICBzdGF0ZW1lbnRCdWlsZGVyID0gbmV3IEV4cHJlc3Npb25CdWlsZGVyVmlzaXRvcigpOwogICAgICBleHByLnZpc2l0KHN0YXRlbWVudEJ1aWxkZXIpOwogICAgICBjb25zdCBtaW4gPSByYW5nZVtpICogMl0sCiAgICAgICAgbWF4ID0gcmFuZ2VbaSAqIDIgKyAxXTsKICAgICAgY29uc3Qgb3V0ID0gW3N0YXRlbWVudEJ1aWxkZXIudG9TdHJpbmcoKV07CiAgICAgIGlmIChtaW4gPiBleHByLm1pbikgewogICAgICAgIG91dC51bnNoaWZ0KCJNYXRoLm1heCgiLCBtaW4sICIsICIpOwogICAgICAgIG91dC5wdXNoKCIpIik7CiAgICAgIH0KICAgICAgaWYgKG1heCA8IGV4cHIubWF4KSB7CiAgICAgICAgb3V0LnVuc2hpZnQoIk1hdGgubWluKCIsIG1heCwgIiwgIik7CiAgICAgICAgb3V0LnB1c2goIikiKTsKICAgICAgfQogICAgICBvdXQudW5zaGlmdCgiZGVzdFtkZXN0T2Zmc2V0ICsgIiwgaSwgIl0gPSAiKTsKICAgICAgb3V0LnB1c2goIjsiKTsKICAgICAgcmVzdWx0LnB1c2gob3V0LmpvaW4oIiIpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQuam9pbigiXG4iKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2JpZGkuanMKCmNvbnN0IGJhc2VUeXBlcyA9IFsiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiUyIsICJCIiwgIlMiLCAiV1MiLCAiQiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCIiwgIkIiLCAiQiIsICJTIiwgIldTIiwgIk9OIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVUIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkVTIiwgIkNTIiwgIkVTIiwgIkNTIiwgIkNTIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkNTIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJDUyIsICJPTiIsICJFVCIsICJFVCIsICJFVCIsICJFVCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIk9OIiwgIk9OIiwgIkJOIiwgIk9OIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVOIiwgIkVOIiwgIk9OIiwgIkwiLCAiT04iLCAiT04iLCAiT04iLCAiRU4iLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiT04iLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiXTsKY29uc3QgYXJhYmljVHlwZXMgPSBbIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIk9OIiwgIk9OIiwgIkFMIiwgIkVUIiwgIkVUIiwgIkFMIiwgIkNTIiwgIkFMIiwgIk9OIiwgIk9OIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkVUIiwgIkFOIiwgIkFOIiwgIkFMIiwgIkFMIiwgIkFMIiwgIk5TTSIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQU4iLCAiT04iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiTlNNIiwgIk5TTSIsICJPTiIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiXTsKZnVuY3Rpb24gaXNPZGQoaSkgewogIHJldHVybiAoaSAmIDEpICE9PSAwOwp9CmZ1bmN0aW9uIGlzRXZlbihpKSB7CiAgcmV0dXJuIChpICYgMSkgPT09IDA7Cn0KZnVuY3Rpb24gZmluZFVuZXF1YWwoYXJyLCBzdGFydCwgdmFsdWUpIHsKICBsZXQgaiwgamo7CiAgZm9yIChqID0gc3RhcnQsIGpqID0gYXJyLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgIGlmIChhcnJbal0gIT09IHZhbHVlKSB7CiAgICAgIHJldHVybiBqOwogICAgfQogIH0KICByZXR1cm4gajsKfQpmdW5jdGlvbiByZXZlcnNlVmFsdWVzKGFyciwgc3RhcnQsIGVuZCkgewogIGZvciAobGV0IGkgPSBzdGFydCwgaiA9IGVuZCAtIDE7IGkgPCBqOyArK2ksIC0taikgewogICAgY29uc3QgdGVtcCA9IGFycltpXTsKICAgIGFycltpXSA9IGFycltqXTsKICAgIGFycltqXSA9IHRlbXA7CiAgfQp9CmZ1bmN0aW9uIGNyZWF0ZUJpZGlUZXh0KHN0ciwgaXNMVFIsIHZlcnRpY2FsID0gZmFsc2UpIHsKICBsZXQgZGlyID0gImx0ciI7CiAgaWYgKHZlcnRpY2FsKSB7CiAgICBkaXIgPSAidHRiIjsKICB9IGVsc2UgaWYgKCFpc0xUUikgewogICAgZGlyID0gInJ0bCI7CiAgfQogIHJldHVybiB7CiAgICBzdHIsCiAgICBkaXIKICB9Owp9CmNvbnN0IGNoYXJzID0gW107CmNvbnN0IHR5cGVzID0gW107CmZ1bmN0aW9uIGJpZGkoc3RyLCBzdGFydExldmVsID0gLTEsIHZlcnRpY2FsID0gZmFsc2UpIHsKICBsZXQgaXNMVFIgPSB0cnVlOwogIGNvbnN0IHN0ckxlbmd0aCA9IHN0ci5sZW5ndGg7CiAgaWYgKHN0ckxlbmd0aCA9PT0gMCB8fCB2ZXJ0aWNhbCkgewogICAgcmV0dXJuIGNyZWF0ZUJpZGlUZXh0KHN0ciwgaXNMVFIsIHZlcnRpY2FsKTsKICB9CiAgY2hhcnMubGVuZ3RoID0gc3RyTGVuZ3RoOwogIHR5cGVzLmxlbmd0aCA9IHN0ckxlbmd0aDsKICBsZXQgbnVtQmlkaSA9IDA7CiAgbGV0IGksIGlpOwogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgY2hhcnNbaV0gPSBzdHIuY2hhckF0KGkpOwogICAgY29uc3QgY2hhckNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgIGxldCBjaGFyVHlwZSA9ICJMIjsKICAgIGlmIChjaGFyQ29kZSA8PSAweDAwZmYpIHsKICAgICAgY2hhclR5cGUgPSBiYXNlVHlwZXNbY2hhckNvZGVdOwogICAgfSBlbHNlIGlmICgweDA1OTAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHgwNWY0KSB7CiAgICAgIGNoYXJUeXBlID0gIlIiOwogICAgfSBlbHNlIGlmICgweDA2MDAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHgwNmZmKSB7CiAgICAgIGNoYXJUeXBlID0gYXJhYmljVHlwZXNbY2hhckNvZGUgJiAweGZmXTsKICAgICAgaWYgKCFjaGFyVHlwZSkgewogICAgICAgIHdhcm4oIkJpZGk6IGludmFsaWQgVW5pY29kZSBjaGFyYWN0ZXIgIiArIGNoYXJDb2RlLnRvU3RyaW5nKDE2KSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoMHgwNzAwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4MDhhYyB8fCAweGZiNTAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHhmZGZmIHx8IDB4ZmU3MCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweGZlZmYpIHsKICAgICAgY2hhclR5cGUgPSAiQUwiOwogICAgfQogICAgaWYgKGNoYXJUeXBlID09PSAiUiIgfHwgY2hhclR5cGUgPT09ICJBTCIgfHwgY2hhclR5cGUgPT09ICJBTiIpIHsKICAgICAgbnVtQmlkaSsrOwogICAgfQogICAgdHlwZXNbaV0gPSBjaGFyVHlwZTsKICB9CiAgaWYgKG51bUJpZGkgPT09IDApIHsKICAgIGlzTFRSID0gdHJ1ZTsKICAgIHJldHVybiBjcmVhdGVCaWRpVGV4dChzdHIsIGlzTFRSKTsKICB9CiAgaWYgKHN0YXJ0TGV2ZWwgPT09IC0xKSB7CiAgICBpZiAobnVtQmlkaSAvIHN0ckxlbmd0aCA8IDAuMyAmJiBzdHJMZW5ndGggPiA0KSB7CiAgICAgIGlzTFRSID0gdHJ1ZTsKICAgICAgc3RhcnRMZXZlbCA9IDA7CiAgICB9IGVsc2UgewogICAgICBpc0xUUiA9IGZhbHNlOwogICAgICBzdGFydExldmVsID0gMTsKICAgIH0KICB9CiAgY29uc3QgbGV2ZWxzID0gW107CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICBsZXZlbHNbaV0gPSBzdGFydExldmVsOwogIH0KICBjb25zdCBlID0gaXNPZGQoc3RhcnRMZXZlbCkgPyAiUiIgOiAiTCI7CiAgY29uc3Qgc29yID0gZTsKICBjb25zdCBlb3IgPSBzb3I7CiAgbGV0IGxhc3RUeXBlID0gc29yOwogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiTlNNIikgewogICAgICB0eXBlc1tpXSA9IGxhc3RUeXBlOwogICAgfSBlbHNlIHsKICAgICAgbGFzdFR5cGUgPSB0eXBlc1tpXTsKICAgIH0KICB9CiAgbGFzdFR5cGUgPSBzb3I7CiAgbGV0IHQ7CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAodCA9PT0gIkVOIikgewogICAgICB0eXBlc1tpXSA9IGxhc3RUeXBlID09PSAiQUwiID8gIkFOIiA6ICJFTiI7CiAgICB9IGVsc2UgaWYgKHQgPT09ICJSIiB8fCB0ID09PSAiTCIgfHwgdCA9PT0gIkFMIikgewogICAgICBsYXN0VHlwZSA9IHQ7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKHQgPT09ICJBTCIpIHsKICAgICAgdHlwZXNbaV0gPSAiUiI7CiAgICB9CiAgfQogIGZvciAoaSA9IDE7IGkgPCBzdHJMZW5ndGggLSAxOyArK2kpIHsKICAgIGlmICh0eXBlc1tpXSA9PT0gIkVTIiAmJiB0eXBlc1tpIC0gMV0gPT09ICJFTiIgJiYgdHlwZXNbaSArIDFdID09PSAiRU4iKSB7CiAgICAgIHR5cGVzW2ldID0gIkVOIjsKICAgIH0KICAgIGlmICh0eXBlc1tpXSA9PT0gIkNTIiAmJiAodHlwZXNbaSAtIDFdID09PSAiRU4iIHx8IHR5cGVzW2kgLSAxXSA9PT0gIkFOIikgJiYgdHlwZXNbaSArIDFdID09PSB0eXBlc1tpIC0gMV0pIHsKICAgICAgdHlwZXNbaV0gPSB0eXBlc1tpIC0gMV07CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiRU4iKSB7CiAgICAgIGZvciAobGV0IGogPSBpIC0gMTsgaiA+PSAwOyAtLWopIHsKICAgICAgICBpZiAodHlwZXNbal0gIT09ICJFVCIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0eXBlc1tqXSA9ICJFTiI7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgc3RyTGVuZ3RoOyArK2opIHsKICAgICAgICBpZiAodHlwZXNbal0gIT09ICJFVCIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0eXBlc1tqXSA9ICJFTiI7CiAgICAgIH0KICAgIH0KICB9CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAodCA9PT0gIldTIiB8fCB0ID09PSAiRVMiIHx8IHQgPT09ICJFVCIgfHwgdCA9PT0gIkNTIikgewogICAgICB0eXBlc1tpXSA9ICJPTiI7CiAgICB9CiAgfQogIGxhc3RUeXBlID0gc29yOwogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKHQgPT09ICJFTiIpIHsKICAgICAgdHlwZXNbaV0gPSBsYXN0VHlwZSA9PT0gIkwiID8gIkwiIDogIkVOIjsKICAgIH0gZWxzZSBpZiAodCA9PT0gIlIiIHx8IHQgPT09ICJMIikgewogICAgICBsYXN0VHlwZSA9IHQ7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiT04iKSB7CiAgICAgIGNvbnN0IGVuZCA9IGZpbmRVbmVxdWFsKHR5cGVzLCBpICsgMSwgIk9OIik7CiAgICAgIGxldCBiZWZvcmUgPSBzb3I7CiAgICAgIGlmIChpID4gMCkgewogICAgICAgIGJlZm9yZSA9IHR5cGVzW2kgLSAxXTsKICAgICAgfQogICAgICBsZXQgYWZ0ZXIgPSBlb3I7CiAgICAgIGlmIChlbmQgKyAxIDwgc3RyTGVuZ3RoKSB7CiAgICAgICAgYWZ0ZXIgPSB0eXBlc1tlbmQgKyAxXTsKICAgICAgfQogICAgICBpZiAoYmVmb3JlICE9PSAiTCIpIHsKICAgICAgICBiZWZvcmUgPSAiUiI7CiAgICAgIH0KICAgICAgaWYgKGFmdGVyICE9PSAiTCIpIHsKICAgICAgICBhZnRlciA9ICJSIjsKICAgICAgfQogICAgICBpZiAoYmVmb3JlID09PSBhZnRlcikgewogICAgICAgIHR5cGVzLmZpbGwoYmVmb3JlLCBpLCBlbmQpOwogICAgICB9CiAgICAgIGkgPSBlbmQgLSAxOwogICAgfQogIH0KICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgIGlmICh0eXBlc1tpXSA9PT0gIk9OIikgewogICAgICB0eXBlc1tpXSA9IGU7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKGlzRXZlbihsZXZlbHNbaV0pKSB7CiAgICAgIGlmICh0ID09PSAiUiIpIHsKICAgICAgICBsZXZlbHNbaV0gKz0gMTsKICAgICAgfSBlbHNlIGlmICh0ID09PSAiQU4iIHx8IHQgPT09ICJFTiIpIHsKICAgICAgICBsZXZlbHNbaV0gKz0gMjsKICAgICAgfQogICAgfSBlbHNlIGlmICh0ID09PSAiTCIgfHwgdCA9PT0gIkFOIiB8fCB0ID09PSAiRU4iKSB7CiAgICAgIGxldmVsc1tpXSArPSAxOwogICAgfQogIH0KICBsZXQgaGlnaGVzdExldmVsID0gLTE7CiAgbGV0IGxvd2VzdE9kZExldmVsID0gOTk7CiAgbGV0IGxldmVsOwogIGZvciAoaSA9IDAsIGlpID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgIGxldmVsID0gbGV2ZWxzW2ldOwogICAgaWYgKGhpZ2hlc3RMZXZlbCA8IGxldmVsKSB7CiAgICAgIGhpZ2hlc3RMZXZlbCA9IGxldmVsOwogICAgfQogICAgaWYgKGxvd2VzdE9kZExldmVsID4gbGV2ZWwgJiYgaXNPZGQobGV2ZWwpKSB7CiAgICAgIGxvd2VzdE9kZExldmVsID0gbGV2ZWw7CiAgICB9CiAgfQogIGZvciAobGV2ZWwgPSBoaWdoZXN0TGV2ZWw7IGxldmVsID49IGxvd2VzdE9kZExldmVsOyAtLWxldmVsKSB7CiAgICBsZXQgc3RhcnQgPSAtMTsKICAgIGZvciAoaSA9IDAsIGlpID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgaWYgKGxldmVsc1tpXSA8IGxldmVsKSB7CiAgICAgICAgaWYgKHN0YXJ0ID49IDApIHsKICAgICAgICAgIHJldmVyc2VWYWx1ZXMoY2hhcnMsIHN0YXJ0LCBpKTsKICAgICAgICAgIHN0YXJ0ID0gLTE7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHN0YXJ0IDwgMCkgewogICAgICAgIHN0YXJ0ID0gaTsKICAgICAgfQogICAgfQogICAgaWYgKHN0YXJ0ID49IDApIHsKICAgICAgcmV2ZXJzZVZhbHVlcyhjaGFycywgc3RhcnQsIGxldmVscy5sZW5ndGgpOwogICAgfQogIH0KICBmb3IgKGkgPSAwLCBpaSA9IGNoYXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgIGNvbnN0IGNoID0gY2hhcnNbaV07CiAgICBpZiAoY2ggPT09ICI8IiB8fCBjaCA9PT0gIj4iKSB7CiAgICAgIGNoYXJzW2ldID0gIiI7CiAgICB9CiAgfQogIHJldHVybiBjcmVhdGVCaWRpVGV4dChjaGFycy5qb2luKCIiKSwgaXNMVFIpOwp9Cgo7Ly8gLi9zcmMvY29yZS9mb250X3N1YnN0aXR1dGlvbnMuanMKCgoKY29uc3QgTk9STUFMID0gewogIHN0eWxlOiAibm9ybWFsIiwKICB3ZWlnaHQ6ICJub3JtYWwiCn07CmNvbnN0IEJPTEQgPSB7CiAgc3R5bGU6ICJub3JtYWwiLAogIHdlaWdodDogImJvbGQiCn07CmNvbnN0IElUQUxJQyA9IHsKICBzdHlsZTogIml0YWxpYyIsCiAgd2VpZ2h0OiAibm9ybWFsIgp9Owpjb25zdCBCT0xESVRBTElDID0gewogIHN0eWxlOiAiaXRhbGljIiwKICB3ZWlnaHQ6ICJib2xkIgp9Owpjb25zdCBzdWJzdGl0dXRpb25NYXAgPSBuZXcgTWFwKFtbIlRpbWVzLVJvbWFuIiwgewogIGxvY2FsOiBbIlRpbWVzIE5ldyBSb21hbiIsICJUaW1lcy1Sb21hbiIsICJUaW1lcyIsICJMaWJlcmF0aW9uIFNlcmlmIiwgIk5pbWJ1cyBSb21hbiIsICJOaW1idXMgUm9tYW4gTCIsICJUaW5vcyIsICJUaG9ybmRhbGUiLCAiVGVYIEd5cmUgVGVybWVzIiwgIkZyZWVTZXJpZiIsICJMaW51eCBMaWJlcnRpbmUgTyIsICJMaWJlcnRpbnVzIFNlcmlmIiwgIlBUIEFzdHJhIFNlcmlmIiwgIkRlamFWdSBTZXJpZiIsICJCaXRzdHJlYW0gVmVyYSBTZXJpZiIsICJVYnVudHUiXSwKICBzdHlsZTogTk9STUFMLAogIHVsdGltYXRlOiAic2VyaWYiCn1dLCBbIlRpbWVzLUJvbGQiLCB7CiAgYWxpYXM6ICJUaW1lcy1Sb21hbiIsCiAgc3R5bGU6IEJPTEQsCiAgdWx0aW1hdGU6ICJzZXJpZiIKfV0sIFsiVGltZXMtSXRhbGljIiwgewogIGFsaWFzOiAiVGltZXMtUm9tYW4iLAogIHN0eWxlOiBJVEFMSUMsCiAgdWx0aW1hdGU6ICJzZXJpZiIKfV0sIFsiVGltZXMtQm9sZEl0YWxpYyIsIHsKICBhbGlhczogIlRpbWVzLVJvbWFuIiwKICBzdHlsZTogQk9MRElUQUxJQywKICB1bHRpbWF0ZTogInNlcmlmIgp9XSwgWyJIZWx2ZXRpY2EiLCB7CiAgbG9jYWw6IFsiSGVsdmV0aWNhIiwgIkhlbHZldGljYSBOZXVlIiwgIkFyaWFsIiwgIkFyaWFsIE5vdmEiLCAiTGliZXJhdGlvbiBTYW5zIiwgIkFyaW1vIiwgIk5pbWJ1cyBTYW5zIiwgIk5pbWJ1cyBTYW5zIEwiLCAiQTAzMCIsICJUZVggR3lyZSBIZXJvcyIsICJGcmVlU2FucyIsICJEZWphVnUgU2FucyIsICJBbGJhbnkiLCAiQml0c3RyZWFtIFZlcmEgU2FucyIsICJBcmlhbCBVbmljb2RlIE1TIiwgIk1pY3Jvc29mdCBTYW5zIFNlcmlmIiwgIkFwcGxlIFN5bWJvbHMiLCAiQ2FudGFyZWxsIl0sCiAgcGF0aDogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIudHRmIiwKICBzdHlsZTogTk9STUFMLAogIHVsdGltYXRlOiAic2Fucy1zZXJpZiIKfV0sIFsiSGVsdmV0aWNhLUJvbGQiLCB7CiAgYWxpYXM6ICJIZWx2ZXRpY2EiLAogIHBhdGg6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkLnR0ZiIsCiAgc3R5bGU6IEJPTEQsCiAgdWx0aW1hdGU6ICJzYW5zLXNlcmlmIgp9XSwgWyJIZWx2ZXRpY2EtT2JsaXF1ZSIsIHsKICBhbGlhczogIkhlbHZldGljYSIsCiAgcGF0aDogIkxpYmVyYXRpb25TYW5zLUl0YWxpYy50dGYiLAogIHN0eWxlOiBJVEFMSUMsCiAgdWx0aW1hdGU6ICJzYW5zLXNlcmlmIgp9XSwgWyJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiLCB7CiAgYWxpYXM6ICJIZWx2ZXRpY2EiLAogIHBhdGg6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljLnR0ZiIsCiAgc3R5bGU6IEJPTERJVEFMSUMsCiAgdWx0aW1hdGU6ICJzYW5zLXNlcmlmIgp9XSwgWyJDb3VyaWVyIiwgewogIGxvY2FsOiBbIkNvdXJpZXIiLCAiQ291cmllciBOZXciLCAiTGliZXJhdGlvbiBNb25vIiwgIk5pbWJ1cyBNb25vIiwgIk5pbWJ1cyBNb25vIEwiLCAiQ291c2luZSIsICJDdW1iZXJsYW5kIiwgIlRlWCBHeXJlIEN1cnNvciIsICJGcmVlTW9ubyIsICJMaW51eCBMaWJlcnRpbmUgTW9ubyBPIiwgIkxpYmVydGludXMgTW9ubyJdLAogIHN0eWxlOiBOT1JNQUwsCiAgdWx0aW1hdGU6ICJtb25vc3BhY2UiCn1dLCBbIkNvdXJpZXItQm9sZCIsIHsKICBhbGlhczogIkNvdXJpZXIiLAogIHN0eWxlOiBCT0xELAogIHVsdGltYXRlOiAibW9ub3NwYWNlIgp9XSwgWyJDb3VyaWVyLU9ibGlxdWUiLCB7CiAgYWxpYXM6ICJDb3VyaWVyIiwKICBzdHlsZTogSVRBTElDLAogIHVsdGltYXRlOiAibW9ub3NwYWNlIgp9XSwgWyJDb3VyaWVyLUJvbGRPYmxpcXVlIiwgewogIGFsaWFzOiAiQ291cmllciIsCiAgc3R5bGU6IEJPTERJVEFMSUMsCiAgdWx0aW1hdGU6ICJtb25vc3BhY2UiCn1dLCBbIkFyaWFsQmxhY2siLCB7CiAgbG9jYWw6IFsiQXJpYWwgQmxhY2siXSwKICBzdHlsZTogewogICAgc3R5bGU6ICJub3JtYWwiLAogICAgd2VpZ2h0OiAiOTAwIgogIH0sCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZCIKfV0sIFsiQXJpYWxCbGFjay1Cb2xkIiwgewogIGFsaWFzOiAiQXJpYWxCbGFjayIKfV0sIFsiQXJpYWxCbGFjay1JdGFsaWMiLCB7CiAgYWxpYXM6ICJBcmlhbEJsYWNrIiwKICBzdHlsZTogewogICAgc3R5bGU6ICJpdGFsaWMiLAogICAgd2VpZ2h0OiAiOTAwIgogIH0sCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiCn1dLCBbIkFyaWFsQmxhY2stQm9sZEl0YWxpYyIsIHsKICBhbGlhczogIkFyaWFsQmxhY2stSXRhbGljIgp9XSwgWyJBcmlhbE5hcnJvdyIsIHsKICBsb2NhbDogWyJBcmlhbCBOYXJyb3ciLCAiTGliZXJhdGlvbiBTYW5zIE5hcnJvdyIsICJIZWx2ZXRpY2EgQ29uZGVuc2VkIiwgIk5pbWJ1cyBTYW5zIE5hcnJvdyIsICJUZVggR3lyZSBIZXJvcyBDbiJdLAogIHN0eWxlOiBOT1JNQUwsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EiCn1dLCBbIkFyaWFsTmFycm93LUJvbGQiLCB7CiAgYWxpYXM6ICJBcmlhbE5hcnJvdyIsCiAgc3R5bGU6IEJPTEQsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZCIKfV0sIFsiQXJpYWxOYXJyb3ctSXRhbGljIiwgewogIGFsaWFzOiAiQXJpYWxOYXJyb3ciLAogIHN0eWxlOiBJVEFMSUMsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtT2JsaXF1ZSIKfV0sIFsiQXJpYWxOYXJyb3ctQm9sZEl0YWxpYyIsIHsKICBhbGlhczogIkFyaWFsTmFycm93IiwKICBzdHlsZTogQk9MRElUQUxJQywKICBmYWxsYmFjazogIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSIKfV0sIFsiQ2FsaWJyaSIsIHsKICBsb2NhbDogWyJDYWxpYnJpIiwgIkNhcmxpdG8iXSwKICBzdHlsZTogTk9STUFMLAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhIgp9XSwgWyJDYWxpYnJpLUJvbGQiLCB7CiAgYWxpYXM6ICJDYWxpYnJpIiwKICBzdHlsZTogQk9MRCwKICBmYWxsYmFjazogIkhlbHZldGljYS1Cb2xkIgp9XSwgWyJDYWxpYnJpLUl0YWxpYyIsIHsKICBhbGlhczogIkNhbGlicmkiLAogIHN0eWxlOiBJVEFMSUMsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtT2JsaXF1ZSIKfV0sIFsiQ2FsaWJyaS1Cb2xkSXRhbGljIiwgewogIGFsaWFzOiAiQ2FsaWJyaSIsCiAgc3R5bGU6IEJPTERJVEFMSUMsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiCn1dLCBbIldpbmdkaW5ncyIsIHsKICBsb2NhbDogWyJXaW5nZGluZ3MiLCAiVVJXIERpbmdiYXRzIl0sCiAgc3R5bGU6IE5PUk1BTAp9XSwgWyJXaW5nZGluZ3MtUmVndWxhciIsIHsKICBhbGlhczogIldpbmdkaW5ncyIKfV0sIFsiV2luZ2RpbmdzLUJvbGQiLCB7CiAgYWxpYXM6ICJXaW5nZGluZ3MiCn1dLCBbIlx4Q0JceENFXHhDQ1x4RTUiLCB7CiAgbG9jYWw6IFsiU2ltU3VuIiwgIlNpbVN1biBSZWd1bGFyIiwgIk5TaW1TdW4iXSwKICBzdHlsZTogTk9STUFMLAogIHVsdGltYXRlOiAic2VyaWYiCn1dLCBbIlx4QkFceERBXHhDQ1x4RTUiLCB7CiAgbG9jYWw6IFsiU2ltSGVpIiwgIlNpbUhlaSBSZWd1bGFyIl0sCiAgc3R5bGU6IE5PUk1BTCwKICB1bHRpbWF0ZTogInNhbnMtc2VyaWYiCn1dLCBbIlx4QkZceEFDXHhDQ1x4RTUiLCB7CiAgbG9jYWw6IFsiS2FpVGkiLCAiU2ltS2FpIiwgIlNpbUthaSBSZWd1bGFyIl0sCiAgc3R5bGU6IE5PUk1BTCwKICB1bHRpbWF0ZTogInNhbnMtc2VyaWYiCn1dLCBbIlx4QjdceEMyXHhDQlx4Q0UiLCB7CiAgbG9jYWw6IFsiRmFuZ1NvbmciLCAiU2ltRmFuZyIsICJTaW1GYW5nIFJlZ3VsYXIiXSwKICBzdHlsZTogTk9STUFMLAogIHVsdGltYXRlOiAic2VyaWYiCn1dLCBbIlx4QkZceEFDXHhDQ1x4RTVfR0IyMzEyIiwgewogIGFsaWFzOiAiXHhCRlx4QUNceENDXHhFNSIKfV0sIFsiXHhCN1x4QzJceENCXHhDRV9HQjIzMTIiLCB7CiAgYWxpYXM6ICJceEI3XHhDMlx4Q0JceENFIgp9XSwgWyJceEMxXHhBNVx4Q0FceEU5IiwgewogIGxvY2FsOiBbIlNpbUxpIiwgIlNpbUxpIFJlZ3VsYXIiXSwKICBzdHlsZTogTk9STUFMLAogIHVsdGltYXRlOiAic2VyaWYiCn1dLCBbIlx4RDBceEMyXHhDQlx4Q0UiLCB7CiAgYWxpYXM6ICJceENCXHhDRVx4Q0NceEU1Igp9XV0pOwpjb25zdCBmb250QWxpYXNlcyA9IG5ldyBNYXAoW1siQXJpYWwtQmxhY2siLCAiQXJpYWxCbGFjayJdXSk7CmZ1bmN0aW9uIGdldFN0eWxlVG9BcHBlbmQoc3R5bGUpIHsKICBzd2l0Y2ggKHN0eWxlKSB7CiAgICBjYXNlIEJPTEQ6CiAgICAgIHJldHVybiAiQm9sZCI7CiAgICBjYXNlIElUQUxJQzoKICAgICAgcmV0dXJuICJJdGFsaWMiOwogICAgY2FzZSBCT0xESVRBTElDOgogICAgICByZXR1cm4gIkJvbGQgSXRhbGljIjsKICAgIGRlZmF1bHQ6CiAgICAgIGlmIChzdHlsZT8ud2VpZ2h0ID09PSAiYm9sZCIpIHsKICAgICAgICByZXR1cm4gIkJvbGQiOwogICAgICB9CiAgICAgIGlmIChzdHlsZT8uc3R5bGUgPT09ICJpdGFsaWMiKSB7CiAgICAgICAgcmV0dXJuICJJdGFsaWMiOwogICAgICB9CiAgfQogIHJldHVybiAiIjsKfQpmdW5jdGlvbiBnZXRGYW1pbHlOYW1lKHN0cikgewogIGNvbnN0IGtleXdvcmRzID0gbmV3IFNldChbInRoaW4iLCAiZXh0cmFsaWdodCIsICJ1bHRyYWxpZ2h0IiwgImRlbWlsaWdodCIsICJzZW1pbGlnaHQiLCAibGlnaHQiLCAiYm9vayIsICJyZWd1bGFyIiwgIm5vcm1hbCIsICJtZWRpdW0iLCAiZGVtaWJvbGQiLCAic2VtaWJvbGQiLCAiYm9sZCIsICJleHRyYWJvbGQiLCAidWx0cmFib2xkIiwgImJsYWNrIiwgImhlYXZ5IiwgImV4dHJhYmxhY2siLCAidWx0cmFibGFjayIsICJyb21hbiIsICJpdGFsaWMiLCAib2JsaXF1ZSIsICJ1bHRyYWNvbmRlbnNlZCIsICJleHRyYWNvbmRlbnNlZCIsICJjb25kZW5zZWQiLCAic2VtaWNvbmRlbnNlZCIsICJub3JtYWwiLCAic2VtaWV4cGFuZGVkIiwgImV4cGFuZGVkIiwgImV4dHJhZXhwYW5kZWQiLCAidWx0cmFleHBhbmRlZCIsICJib2xkaXRhbGljIl0pOwogIHJldHVybiBzdHIuc3BsaXQoL1stICwrXSsvZykuZmlsdGVyKHRvayA9PiAha2V5d29yZHMuaGFzKHRvay50b0xvd2VyQ2FzZSgpKSkuam9pbigiICIpOwp9CmZ1bmN0aW9uIGdlbmVyYXRlRm9udCh7CiAgYWxpYXMsCiAgbG9jYWwsCiAgcGF0aCwKICBmYWxsYmFjaywKICBzdHlsZSwKICB1bHRpbWF0ZQp9LCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrID0gdHJ1ZSwgdXNlUGF0aCA9IHRydWUsIGFwcGVuZCA9ICIiKSB7CiAgY29uc3QgcmVzdWx0ID0gewogICAgc3R5bGU6IG51bGwsCiAgICB1bHRpbWF0ZTogbnVsbAogIH07CiAgaWYgKGxvY2FsKSB7CiAgICBjb25zdCBleHRyYSA9IGFwcGVuZCA/IGAgJHthcHBlbmR9YCA6ICIiOwogICAgZm9yIChjb25zdCBuYW1lIG9mIGxvY2FsKSB7CiAgICAgIHNyYy5wdXNoKGBsb2NhbCgke25hbWV9JHtleHRyYX0pYCk7CiAgICB9CiAgfQogIGlmIChhbGlhcykgewogICAgY29uc3Qgc3Vic3RpdHV0aW9uID0gc3Vic3RpdHV0aW9uTWFwLmdldChhbGlhcyk7CiAgICBjb25zdCBhbGlhc0FwcGVuZCA9IGFwcGVuZCB8fCBnZXRTdHlsZVRvQXBwZW5kKHN0eWxlKTsKICAgIE9iamVjdC5hc3NpZ24ocmVzdWx0LCBnZW5lcmF0ZUZvbnQoc3Vic3RpdHV0aW9uLCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrICYmICFmYWxsYmFjaywgdXNlUGF0aCAmJiAhcGF0aCwgYWxpYXNBcHBlbmQpKTsKICB9CiAgaWYgKHN0eWxlKSB7CiAgICByZXN1bHQuc3R5bGUgPSBzdHlsZTsKICB9CiAgaWYgKHVsdGltYXRlKSB7CiAgICByZXN1bHQudWx0aW1hdGUgPSB1bHRpbWF0ZTsKICB9CiAgaWYgKHVzZUZhbGxiYWNrICYmIGZhbGxiYWNrKSB7CiAgICBjb25zdCBmYWxsYmFja0luZm8gPSBzdWJzdGl0dXRpb25NYXAuZ2V0KGZhbGxiYWNrKTsKICAgIGNvbnN0IHsKICAgICAgdWx0aW1hdGU6IGZhbGxiYWNrVWx0aW1hdGUKICAgIH0gPSBnZW5lcmF0ZUZvbnQoZmFsbGJhY2tJbmZvLCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrLCB1c2VQYXRoICYmICFwYXRoLCBhcHBlbmQpOwogICAgcmVzdWx0LnVsdGltYXRlIHx8PSBmYWxsYmFja1VsdGltYXRlOwogIH0KICBpZiAodXNlUGF0aCAmJiBwYXRoICYmIGxvY2FsRm9udFBhdGgpIHsKICAgIHNyYy5wdXNoKGB1cmwoJHtsb2NhbEZvbnRQYXRofSR7cGF0aH0pYCk7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KZnVuY3Rpb24gZ2V0Rm9udFN1YnN0aXR1dGlvbihzeXN0ZW1Gb250Q2FjaGUsIGlkRmFjdG9yeSwgbG9jYWxGb250UGF0aCwgYmFzZUZvbnROYW1lLCBzdGFuZGFyZEZvbnROYW1lLCB0eXBlKSB7CiAgaWYgKGJhc2VGb250TmFtZS5zdGFydHNXaXRoKCJJbnZhbGlkUERGanNGb250XyIpKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaWYgKCh0eXBlID09PSAiVHJ1ZVR5cGUiIHx8IHR5cGUgPT09ICJUeXBlMSIpICYmIC9eW0EtWl17Nn1cKy8udGVzdChiYXNlRm9udE5hbWUpKSB7CiAgICBiYXNlRm9udE5hbWUgPSBiYXNlRm9udE5hbWUuc2xpY2UoNyk7CiAgfQogIGJhc2VGb250TmFtZSA9IG5vcm1hbGl6ZUZvbnROYW1lKGJhc2VGb250TmFtZSk7CiAgY29uc3Qga2V5ID0gYmFzZUZvbnROYW1lOwogIGxldCBzdWJzdGl0dXRpb25JbmZvID0gc3lzdGVtRm9udENhY2hlLmdldChrZXkpOwogIGlmIChzdWJzdGl0dXRpb25JbmZvKSB7CiAgICByZXR1cm4gc3Vic3RpdHV0aW9uSW5mbzsKICB9CiAgbGV0IHN1YnN0aXR1dGlvbiA9IHN1YnN0aXR1dGlvbk1hcC5nZXQoYmFzZUZvbnROYW1lKTsKICBpZiAoIXN1YnN0aXR1dGlvbikgewogICAgZm9yIChjb25zdCBbYWxpYXMsIHN1YnN0XSBvZiBmb250QWxpYXNlcykgewogICAgICBpZiAoYmFzZUZvbnROYW1lLnN0YXJ0c1dpdGgoYWxpYXMpKSB7CiAgICAgICAgYmFzZUZvbnROYW1lID0gYCR7c3Vic3R9JHtiYXNlRm9udE5hbWUuc3Vic3RyaW5nKGFsaWFzLmxlbmd0aCl9YDsKICAgICAgICBzdWJzdGl0dXRpb24gPSBzdWJzdGl0dXRpb25NYXAuZ2V0KGJhc2VGb250TmFtZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgbGV0IG11c3RBZGRCYXNlRm9udCA9IGZhbHNlOwogIGlmICghc3Vic3RpdHV0aW9uKSB7CiAgICBzdWJzdGl0dXRpb24gPSBzdWJzdGl0dXRpb25NYXAuZ2V0KHN0YW5kYXJkRm9udE5hbWUpOwogICAgbXVzdEFkZEJhc2VGb250ID0gdHJ1ZTsKICB9CiAgY29uc3QgbG9hZGVkTmFtZSA9IGAke2lkRmFjdG9yeS5nZXREb2NJZCgpfV9zJHtpZEZhY3RvcnkuY3JlYXRlRm9udElkKCl9YDsKICBpZiAoIXN1YnN0aXR1dGlvbikgewogICAgaWYgKCF2YWxpZGF0ZUZvbnROYW1lKGJhc2VGb250TmFtZSkpIHsKICAgICAgd2FybihgQ2Fubm90IHN1YnN0aXR1dGUgdGhlIGZvbnQgYmVjYXVzZSBvZiBpdHMgbmFtZTogJHtiYXNlRm9udE5hbWV9YCk7CiAgICAgIHN5c3RlbUZvbnRDYWNoZS5zZXQoa2V5LCBudWxsKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBib2xkID0gL2JvbGQvZ2kudGVzdChiYXNlRm9udE5hbWUpOwogICAgY29uc3QgaXRhbGljID0gL29ibGlxdWV8aXRhbGljL2dpLnRlc3QoYmFzZUZvbnROYW1lKTsKICAgIGNvbnN0IHN0eWxlID0gYm9sZCAmJiBpdGFsaWMgJiYgQk9MRElUQUxJQyB8fCBib2xkICYmIEJPTEQgfHwgaXRhbGljICYmIElUQUxJQyB8fCBOT1JNQUw7CiAgICBzdWJzdGl0dXRpb25JbmZvID0gewogICAgICBjc3M6IGAiJHtnZXRGYW1pbHlOYW1lKGJhc2VGb250TmFtZSl9Iiwke2xvYWRlZE5hbWV9YCwKICAgICAgZ3Vlc3NGYWxsYmFjazogdHJ1ZSwKICAgICAgbG9hZGVkTmFtZSwKICAgICAgYmFzZUZvbnROYW1lLAogICAgICBzcmM6IGBsb2NhbCgke2Jhc2VGb250TmFtZX0pYCwKICAgICAgc3R5bGUKICAgIH07CiAgICBzeXN0ZW1Gb250Q2FjaGUuc2V0KGtleSwgc3Vic3RpdHV0aW9uSW5mbyk7CiAgICByZXR1cm4gc3Vic3RpdHV0aW9uSW5mbzsKICB9CiAgY29uc3Qgc3JjID0gW107CiAgaWYgKG11c3RBZGRCYXNlRm9udCAmJiB2YWxpZGF0ZUZvbnROYW1lKGJhc2VGb250TmFtZSkpIHsKICAgIHNyYy5wdXNoKGBsb2NhbCgke2Jhc2VGb250TmFtZX0pYCk7CiAgfQogIGNvbnN0IHsKICAgIHN0eWxlLAogICAgdWx0aW1hdGUKICB9ID0gZ2VuZXJhdGVGb250KHN1YnN0aXR1dGlvbiwgc3JjLCBsb2NhbEZvbnRQYXRoKTsKICBjb25zdCBndWVzc0ZhbGxiYWNrID0gdWx0aW1hdGUgPT09IG51bGw7CiAgY29uc3QgZmFsbGJhY2sgPSBndWVzc0ZhbGxiYWNrID8gIiIgOiBgLCR7dWx0aW1hdGV9YDsKICBzdWJzdGl0dXRpb25JbmZvID0gewogICAgY3NzOiBgIiR7Z2V0RmFtaWx5TmFtZShiYXNlRm9udE5hbWUpfSIsJHtsb2FkZWROYW1lfSR7ZmFsbGJhY2t9YCwKICAgIGd1ZXNzRmFsbGJhY2ssCiAgICBsb2FkZWROYW1lLAogICAgYmFzZUZvbnROYW1lLAogICAgc3JjOiBzcmMuam9pbigiLCIpLAogICAgc3R5bGUKICB9OwogIHN5c3RlbUZvbnRDYWNoZS5zZXQoa2V5LCBzdWJzdGl0dXRpb25JbmZvKTsKICByZXR1cm4gc3Vic3RpdHV0aW9uSW5mbzsKfQoKOy8vIC4vc3JjL3NoYXJlZC9tdXJtdXJoYXNoMy5qcwpjb25zdCBTRUVEID0gMHhjM2QyZTFmMDsKY29uc3QgTUFTS19ISUdIID0gMHhmZmZmMDAwMDsKY29uc3QgTUFTS19MT1cgPSAweGZmZmY7CmNsYXNzIE11cm11ckhhc2gzXzY0IHsKICBjb25zdHJ1Y3RvcihzZWVkKSB7CiAgICB0aGlzLmgxID0gc2VlZCA/IHNlZWQgJiAweGZmZmZmZmZmIDogU0VFRDsKICAgIHRoaXMuaDIgPSBzZWVkID8gc2VlZCAmIDB4ZmZmZmZmZmYgOiBTRUVEOwogIH0KICB1cGRhdGUoaW5wdXQpIHsKICAgIGxldCBkYXRhLCBsZW5ndGg7CiAgICBpZiAodHlwZW9mIGlucHV0ID09PSAic3RyaW5nIikgewogICAgICBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQubGVuZ3RoICogMik7CiAgICAgIGxlbmd0aCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGlucHV0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBjb2RlID0gaW5wdXQuY2hhckNvZGVBdChpKTsKICAgICAgICBpZiAoY29kZSA8PSAweGZmKSB7CiAgICAgICAgICBkYXRhW2xlbmd0aCsrXSA9IGNvZGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRhdGFbbGVuZ3RoKytdID0gY29kZSA+Pj4gODsKICAgICAgICAgIGRhdGFbbGVuZ3RoKytdID0gY29kZSAmIDB4ZmY7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKEFycmF5QnVmZmVyLmlzVmlldyhpbnB1dCkpIHsKICAgICAgZGF0YSA9IGlucHV0LnNsaWNlKCk7CiAgICAgIGxlbmd0aCA9IGRhdGEuYnl0ZUxlbmd0aDsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBkYXRhIGZvcm1hdCwgbXVzdCBiZSBhIHN0cmluZyBvciBUeXBlZEFycmF5LiIpOwogICAgfQogICAgY29uc3QgYmxvY2tDb3VudHMgPSBsZW5ndGggPj4gMjsKICAgIGNvbnN0IHRhaWxMZW5ndGggPSBsZW5ndGggLSBibG9ja0NvdW50cyAqIDQ7CiAgICBjb25zdCBkYXRhVWludDMyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyLCAwLCBibG9ja0NvdW50cyk7CiAgICBsZXQgazEgPSAwLAogICAgICBrMiA9IDA7CiAgICBsZXQgaDEgPSB0aGlzLmgxLAogICAgICBoMiA9IHRoaXMuaDI7CiAgICBjb25zdCBDMSA9IDB4Y2M5ZTJkNTEsCiAgICAgIEMyID0gMHgxYjg3MzU5MzsKICAgIGNvbnN0IEMxX0xPVyA9IEMxICYgTUFTS19MT1csCiAgICAgIEMyX0xPVyA9IEMyICYgTUFTS19MT1c7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2NrQ291bnRzOyBpKyspIHsKICAgICAgaWYgKGkgJiAxKSB7CiAgICAgICAgazEgPSBkYXRhVWludDMyW2ldOwogICAgICAgIGsxID0gazEgKiBDMSAmIE1BU0tfSElHSCB8IGsxICogQzFfTE9XICYgTUFTS19MT1c7CiAgICAgICAgazEgPSBrMSA8PCAxNSB8IGsxID4+PiAxNzsKICAgICAgICBrMSA9IGsxICogQzIgJiBNQVNLX0hJR0ggfCBrMSAqIEMyX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGgxIF49IGsxOwogICAgICAgIGgxID0gaDEgPDwgMTMgfCBoMSA+Pj4gMTk7CiAgICAgICAgaDEgPSBoMSAqIDUgKyAweGU2NTQ2YjY0OwogICAgICB9IGVsc2UgewogICAgICAgIGsyID0gZGF0YVVpbnQzMltpXTsKICAgICAgICBrMiA9IGsyICogQzEgJiBNQVNLX0hJR0ggfCBrMiAqIEMxX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGsyID0gazIgPDwgMTUgfCBrMiA+Pj4gMTc7CiAgICAgICAgazIgPSBrMiAqIEMyICYgTUFTS19ISUdIIHwgazIgKiBDMl9MT1cgJiBNQVNLX0xPVzsKICAgICAgICBoMiBePSBrMjsKICAgICAgICBoMiA9IGgyIDw8IDEzIHwgaDIgPj4+IDE5OwogICAgICAgIGgyID0gaDIgKiA1ICsgMHhlNjU0NmI2NDsKICAgICAgfQogICAgfQogICAgazEgPSAwOwogICAgc3dpdGNoICh0YWlsTGVuZ3RoKSB7CiAgICAgIGNhc2UgMzoKICAgICAgICBrMSBePSBkYXRhW2Jsb2NrQ291bnRzICogNCArIDJdIDw8IDE2OwogICAgICBjYXNlIDI6CiAgICAgICAgazEgXj0gZGF0YVtibG9ja0NvdW50cyAqIDQgKyAxXSA8PCA4OwogICAgICBjYXNlIDE6CiAgICAgICAgazEgXj0gZGF0YVtibG9ja0NvdW50cyAqIDRdOwogICAgICAgIGsxID0gazEgKiBDMSAmIE1BU0tfSElHSCB8IGsxICogQzFfTE9XICYgTUFTS19MT1c7CiAgICAgICAgazEgPSBrMSA8PCAxNSB8IGsxID4+PiAxNzsKICAgICAgICBrMSA9IGsxICogQzIgJiBNQVNLX0hJR0ggfCBrMSAqIEMyX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGlmIChibG9ja0NvdW50cyAmIDEpIHsKICAgICAgICAgIGgxIF49IGsxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoMiBePSBrMTsKICAgICAgICB9CiAgICB9CiAgICB0aGlzLmgxID0gaDE7CiAgICB0aGlzLmgyID0gaDI7CiAgfQogIGhleGRpZ2VzdCgpIHsKICAgIGxldCBoMSA9IHRoaXMuaDEsCiAgICAgIGgyID0gdGhpcy5oMjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgaDEgPSBoMSAqIDB4ZWQ1NThjY2QgJiBNQVNLX0hJR0ggfCBoMSAqIDB4OGNjZCAmIE1BU0tfTE9XOwogICAgaDIgPSBoMiAqIDB4ZmY1MWFmZDcgJiBNQVNLX0hJR0ggfCAoKGgyIDw8IDE2IHwgaDEgPj4+IDE2KSAqIDB4YWZkN2VkNTUgJiBNQVNLX0hJR0gpID4+PiAxNjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgaDEgPSBoMSAqIDB4MWE4NWVjNTMgJiBNQVNLX0hJR0ggfCBoMSAqIDB4ZWM1MyAmIE1BU0tfTE9XOwogICAgaDIgPSBoMiAqIDB4YzRjZWI5ZmUgJiBNQVNLX0hJR0ggfCAoKGgyIDw8IDE2IHwgaDEgPj4+IDE2KSAqIDB4YjlmZTFhODUgJiBNQVNLX0hJR0gpID4+PiAxNjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgcmV0dXJuIChoMSA+Pj4gMCkudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDgsICIwIikgKyAoaDIgPj4+IDApLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg4LCAiMCIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvaW1hZ2UuanMKCgoKCgoKCgoKCmZ1bmN0aW9uIHJlc2l6ZUltYWdlTWFzayhzcmMsIGJwYywgdzEsIGgxLCB3MiwgaDIpIHsKICBjb25zdCBsZW5ndGggPSB3MiAqIGgyOwogIGxldCBkZXN0OwogIGlmIChicGMgPD0gOCkgewogICAgZGVzdCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgfSBlbHNlIGlmIChicGMgPD0gMTYpIHsKICAgIGRlc3QgPSBuZXcgVWludDE2QXJyYXkobGVuZ3RoKTsKICB9IGVsc2UgewogICAgZGVzdCA9IG5ldyBVaW50MzJBcnJheShsZW5ndGgpOwogIH0KICBjb25zdCB4UmF0aW8gPSB3MSAvIHcyOwogIGNvbnN0IHlSYXRpbyA9IGgxIC8gaDI7CiAgbGV0IGksCiAgICBqLAogICAgcHksCiAgICBuZXdJbmRleCA9IDAsCiAgICBvbGRJbmRleDsKICBjb25zdCB4U2NhbGVkID0gbmV3IFVpbnQxNkFycmF5KHcyKTsKICBjb25zdCB3MVNjYW5saW5lID0gdzE7CiAgZm9yIChpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgIHhTY2FsZWRbaV0gPSBNYXRoLmZsb29yKGkgKiB4UmF0aW8pOwogIH0KICBmb3IgKGkgPSAwOyBpIDwgaDI7IGkrKykgewogICAgcHkgPSBNYXRoLmZsb29yKGkgKiB5UmF0aW8pICogdzFTY2FubGluZTsKICAgIGZvciAoaiA9IDA7IGogPCB3MjsgaisrKSB7CiAgICAgIG9sZEluZGV4ID0gcHkgKyB4U2NhbGVkW2pdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4XTsKICAgIH0KICB9CiAgcmV0dXJuIGRlc3Q7Cn0KY2xhc3MgUERGSW1hZ2UgewogIGNvbnN0cnVjdG9yKHsKICAgIHhyZWYsCiAgICByZXMsCiAgICBpbWFnZSwKICAgIGlzSW5saW5lID0gZmFsc2UsCiAgICBzbWFzayA9IG51bGwsCiAgICBtYXNrID0gbnVsbCwKICAgIGlzTWFzayA9IGZhbHNlLAogICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICB9KSB7CiAgICB0aGlzLmltYWdlID0gaW1hZ2U7CiAgICBjb25zdCBkaWN0ID0gaW1hZ2UuZGljdDsKICAgIGNvbnN0IGZpbHRlciA9IGRpY3QuZ2V0KCJGIiwgIkZpbHRlciIpOwogICAgbGV0IGZpbHRlck5hbWU7CiAgICBpZiAoZmlsdGVyIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBmaWx0ZXJOYW1lID0gZmlsdGVyLm5hbWU7CiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyKSkgewogICAgICBjb25zdCBmaWx0ZXJaZXJvID0geHJlZi5mZXRjaElmUmVmKGZpbHRlclswXSk7CiAgICAgIGlmIChmaWx0ZXJaZXJvIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGZpbHRlck5hbWUgPSBmaWx0ZXJaZXJvLm5hbWU7CiAgICAgIH0KICAgIH0KICAgIHN3aXRjaCAoZmlsdGVyTmFtZSkgewogICAgICBjYXNlICJKUFhEZWNvZGUiOgogICAgICAgICh7CiAgICAgICAgICB3aWR0aDogaW1hZ2Uud2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IGltYWdlLmhlaWdodCwKICAgICAgICAgIGNvbXBvbmVudHNDb3VudDogaW1hZ2UubnVtQ29tcHMsCiAgICAgICAgICBiaXRzUGVyQ29tcG9uZW50OiBpbWFnZS5iaXRzUGVyQ29tcG9uZW50CiAgICAgICAgfSA9IEpweEltYWdlLnBhcnNlSW1hZ2VQcm9wZXJ0aWVzKGltYWdlLnN0cmVhbSkpOwogICAgICAgIGltYWdlLnN0cmVhbS5yZXNldCgpOwogICAgICAgIGNvbnN0IHJlZHVjZVBvd2VyID0gSW1hZ2VSZXNpemVyLmdldFJlZHVjZVBvd2VyRm9ySlBYKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLm51bUNvbXBzKTsKICAgICAgICB0aGlzLmpweERlY29kZXJPcHRpb25zID0gewogICAgICAgICAgbnVtQ29tcG9uZW50czogMCwKICAgICAgICAgIGlzSW5kZXhlZENvbG9ybWFwOiBmYWxzZSwKICAgICAgICAgIHNtYXNrSW5EYXRhOiBkaWN0LmhhcygiU01hc2tJbkRhdGEiKSwKICAgICAgICAgIHJlZHVjZVBvd2VyCiAgICAgICAgfTsKICAgICAgICBpZiAocmVkdWNlUG93ZXIpIHsKICAgICAgICAgIGNvbnN0IGZhY3RvciA9IDIgKiogcmVkdWNlUG93ZXI7CiAgICAgICAgICBpbWFnZS53aWR0aCA9IE1hdGguY2VpbChpbWFnZS53aWR0aCAvIGZhY3Rvcik7CiAgICAgICAgICBpbWFnZS5oZWlnaHQgPSBNYXRoLmNlaWwoaW1hZ2UuaGVpZ2h0IC8gZmFjdG9yKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkpCSUcyRGVjb2RlIjoKICAgICAgICBpbWFnZS5iaXRzUGVyQ29tcG9uZW50ID0gMTsKICAgICAgICBpbWFnZS5udW1Db21wcyA9IDE7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBsZXQgd2lkdGggPSBkaWN0LmdldCgiVyIsICJXaWR0aCIpOwogICAgbGV0IGhlaWdodCA9IGRpY3QuZ2V0KCJIIiwgIkhlaWdodCIpOwogICAgaWYgKE51bWJlci5pc0ludGVnZXIoaW1hZ2Uud2lkdGgpICYmIGltYWdlLndpZHRoID4gMCAmJiBOdW1iZXIuaXNJbnRlZ2VyKGltYWdlLmhlaWdodCkgJiYgaW1hZ2UuaGVpZ2h0ID4gMCAmJiAoaW1hZ2Uud2lkdGggIT09IHdpZHRoIHx8IGltYWdlLmhlaWdodCAhPT0gaGVpZ2h0KSkgewogICAgICB3YXJuKCJQREZJbWFnZSAtIHVzaW5nIHRoZSBXaWR0aC9IZWlnaHQgb2YgdGhlIGltYWdlIGRhdGEsICIgKyAicmF0aGVyIHRoYW4gdGhlIGltYWdlIGRpY3Rpb25hcnkuIik7CiAgICAgIHdpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAgIGhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHZhbGlkV2lkdGggPSB0eXBlb2Ygd2lkdGggPT09ICJudW1iZXIiICYmIHdpZHRoID4gMCwKICAgICAgICB2YWxpZEhlaWdodCA9IHR5cGVvZiBoZWlnaHQgPT09ICJudW1iZXIiICYmIGhlaWdodCA+IDA7CiAgICAgIGlmICghdmFsaWRXaWR0aCB8fCAhdmFsaWRIZWlnaHQpIHsKICAgICAgICBpZiAoIWltYWdlLmZhbGxiYWNrRGltcykgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGltYWdlIHdpZHRoOiAke3dpZHRofSBvciBoZWlnaHQ6ICR7aGVpZ2h0fWApOwogICAgICAgIH0KICAgICAgICB3YXJuKCJQREZJbWFnZSAtIHVzaW5nIHRoZSBXaWR0aC9IZWlnaHQgb2YgdGhlIHBhcmVudCBpbWFnZSwgZm9yIFNNYXNrL01hc2sgZGF0YS4iKTsKICAgICAgICBpZiAoIXZhbGlkV2lkdGgpIHsKICAgICAgICAgIHdpZHRoID0gaW1hZ2UuZmFsbGJhY2tEaW1zLndpZHRoOwogICAgICAgIH0KICAgICAgICBpZiAoIXZhbGlkSGVpZ2h0KSB7CiAgICAgICAgICBoZWlnaHQgPSBpbWFnZS5mYWxsYmFja0RpbXMuaGVpZ2h0OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICB0aGlzLmludGVycG9sYXRlID0gZGljdC5nZXQoIkkiLCAiSW50ZXJwb2xhdGUiKTsKICAgIHRoaXMuaW1hZ2VNYXNrID0gZGljdC5nZXQoIklNIiwgIkltYWdlTWFzayIpIHx8IGZhbHNlOwogICAgdGhpcy5tYXR0ZSA9IGRpY3QuZ2V0KCJNYXR0ZSIpIHx8IGZhbHNlOwogICAgbGV0IGJpdHNQZXJDb21wb25lbnQgPSBpbWFnZS5iaXRzUGVyQ29tcG9uZW50OwogICAgaWYgKCFiaXRzUGVyQ29tcG9uZW50KSB7CiAgICAgIGJpdHNQZXJDb21wb25lbnQgPSBkaWN0LmdldCgiQlBDIiwgIkJpdHNQZXJDb21wb25lbnQiKTsKICAgICAgaWYgKCFiaXRzUGVyQ29tcG9uZW50KSB7CiAgICAgICAgaWYgKHRoaXMuaW1hZ2VNYXNrKSB7CiAgICAgICAgICBiaXRzUGVyQ29tcG9uZW50ID0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBCaXRzIHBlciBjb21wb25lbnQgbWlzc2luZyBpbiBpbWFnZTogJHt0aGlzLmltYWdlTWFza31gKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuYnBjID0gYml0c1BlckNvbXBvbmVudDsKICAgIGlmICghdGhpcy5pbWFnZU1hc2spIHsKICAgICAgbGV0IGNvbG9yU3BhY2UgPSBkaWN0LmdldFJhdygiQ1MiKSB8fCBkaWN0LmdldFJhdygiQ29sb3JTcGFjZSIpOwogICAgICBjb25zdCBoYXNDb2xvclNwYWNlID0gISFjb2xvclNwYWNlOwogICAgICBpZiAoIWhhc0NvbG9yU3BhY2UpIHsKICAgICAgICBpZiAodGhpcy5qcHhEZWNvZGVyT3B0aW9ucykgewogICAgICAgICAgY29sb3JTcGFjZSA9IE5hbWUuZ2V0KCJEZXZpY2VSR0JBIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN3aXRjaCAoaW1hZ2UubnVtQ29tcHMpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBOYW1lLmdldCgiRGV2aWNlR3JheSIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgY29sb3JTcGFjZSA9IE5hbWUuZ2V0KCJEZXZpY2VSR0IiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBOYW1lLmdldCgiRGV2aWNlQ01ZSyIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW1hZ2VzIHdpdGggJHtpbWFnZS5udW1Db21wc30gY29sb3IgY29tcG9uZW50cyBub3Qgc3VwcG9ydGVkLmApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aGlzLmpweERlY29kZXJPcHRpb25zPy5zbWFza0luRGF0YSkgewogICAgICAgIGNvbG9yU3BhY2UgPSBOYW1lLmdldCgiRGV2aWNlUkdCQSIpOwogICAgICB9CiAgICAgIHRoaXMuY29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5wYXJzZSh7CiAgICAgICAgY3M6IGNvbG9yU3BhY2UsCiAgICAgICAgeHJlZiwKICAgICAgICByZXNvdXJjZXM6IGlzSW5saW5lID8gcmVzIDogbnVsbCwKICAgICAgICBwZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgIH0pOwogICAgICB0aGlzLm51bUNvbXBzID0gdGhpcy5jb2xvclNwYWNlLm51bUNvbXBzOwogICAgICBpZiAodGhpcy5qcHhEZWNvZGVyT3B0aW9ucykgewogICAgICAgIHRoaXMuanB4RGVjb2Rlck9wdGlvbnMubnVtQ29tcG9uZW50cyA9IGhhc0NvbG9yU3BhY2UgPyB0aGlzLm51bUNvbXBzIDogMDsKICAgICAgICB0aGlzLmpweERlY29kZXJPcHRpb25zLmlzSW5kZXhlZENvbG9ybWFwID0gdGhpcy5jb2xvclNwYWNlLm5hbWUgPT09ICJJbmRleGVkIjsKICAgICAgfQogICAgfQogICAgdGhpcy5kZWNvZGUgPSBkaWN0LmdldEFycmF5KCJEIiwgIkRlY29kZSIpOwogICAgdGhpcy5uZWVkc0RlY29kZSA9IGZhbHNlOwogICAgaWYgKHRoaXMuZGVjb2RlICYmICh0aGlzLmNvbG9yU3BhY2UgJiYgIXRoaXMuY29sb3JTcGFjZS5pc0RlZmF1bHREZWNvZGUodGhpcy5kZWNvZGUsIGJpdHNQZXJDb21wb25lbnQpIHx8IGlzTWFzayAmJiAhQ29sb3JTcGFjZS5pc0RlZmF1bHREZWNvZGUodGhpcy5kZWNvZGUsIDEpKSkgewogICAgICB0aGlzLm5lZWRzRGVjb2RlID0gdHJ1ZTsKICAgICAgY29uc3QgbWF4ID0gKDEgPDwgYml0c1BlckNvbXBvbmVudCkgLSAxOwogICAgICB0aGlzLmRlY29kZUNvZWZmaWNpZW50cyA9IFtdOwogICAgICB0aGlzLmRlY29kZUFkZGVuZHMgPSBbXTsKICAgICAgY29uc3QgaXNJbmRleGVkID0gdGhpcy5jb2xvclNwYWNlPy5uYW1lID09PSAiSW5kZXhlZCI7CiAgICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IHRoaXMuZGVjb2RlLmxlbmd0aDsgaSArPSAyLCArK2opIHsKICAgICAgICBjb25zdCBkbWluID0gdGhpcy5kZWNvZGVbaV07CiAgICAgICAgY29uc3QgZG1heCA9IHRoaXMuZGVjb2RlW2kgKyAxXTsKICAgICAgICB0aGlzLmRlY29kZUNvZWZmaWNpZW50c1tqXSA9IGlzSW5kZXhlZCA/IChkbWF4IC0gZG1pbikgLyBtYXggOiBkbWF4IC0gZG1pbjsKICAgICAgICB0aGlzLmRlY29kZUFkZGVuZHNbal0gPSBpc0luZGV4ZWQgPyBkbWluIDogbWF4ICogZG1pbjsKICAgICAgfQogICAgfQogICAgaWYgKHNtYXNrKSB7CiAgICAgIHNtYXNrLmZhbGxiYWNrRGltcyA/Pz0gewogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodAogICAgICB9OwogICAgICB0aGlzLnNtYXNrID0gbmV3IFBERkltYWdlKHsKICAgICAgICB4cmVmLAogICAgICAgIHJlcywKICAgICAgICBpbWFnZTogc21hc2ssCiAgICAgICAgaXNJbmxpbmUsCiAgICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAobWFzaykgewogICAgICBpZiAobWFzayBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBjb25zdCBtYXNrRGljdCA9IG1hc2suZGljdCwKICAgICAgICAgIGltYWdlTWFzayA9IG1hc2tEaWN0LmdldCgiSU0iLCAiSW1hZ2VNYXNrIik7CiAgICAgICAgaWYgKCFpbWFnZU1hc2spIHsKICAgICAgICAgIHdhcm4oIklnbm9yaW5nIC9NYXNrIGluIGltYWdlIHdpdGhvdXQgL0ltYWdlTWFzay4iKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWFzay5mYWxsYmFja0RpbXMgPz89IHsKICAgICAgICAgICAgd2lkdGgsCiAgICAgICAgICAgIGhlaWdodAogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMubWFzayA9IG5ldyBQREZJbWFnZSh7CiAgICAgICAgICAgIHhyZWYsCiAgICAgICAgICAgIHJlcywKICAgICAgICAgICAgaW1hZ2U6IG1hc2ssCiAgICAgICAgICAgIGlzSW5saW5lLAogICAgICAgICAgICBpc01hc2s6IHRydWUsCiAgICAgICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubWFzayA9IG1hc2s7CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIGFzeW5jIGJ1aWxkSW1hZ2UoewogICAgeHJlZiwKICAgIHJlcywKICAgIGltYWdlLAogICAgaXNJbmxpbmUgPSBmYWxzZSwKICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgfSkgewogICAgY29uc3QgaW1hZ2VEYXRhID0gaW1hZ2U7CiAgICBsZXQgc21hc2tEYXRhID0gbnVsbDsKICAgIGxldCBtYXNrRGF0YSA9IG51bGw7CiAgICBjb25zdCBzbWFzayA9IGltYWdlLmRpY3QuZ2V0KCJTTWFzayIpOwogICAgY29uc3QgbWFzayA9IGltYWdlLmRpY3QuZ2V0KCJNYXNrIik7CiAgICBpZiAoc21hc2spIHsKICAgICAgaWYgKHNtYXNrIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIHNtYXNrRGF0YSA9IHNtYXNrOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oIlVuc3VwcG9ydGVkIC9TTWFzayBmb3JtYXQuIik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobWFzaykgewogICAgICBpZiAobWFzayBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gfHwgQXJyYXkuaXNBcnJheShtYXNrKSkgewogICAgICAgIG1hc2tEYXRhID0gbWFzazsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJVbnN1cHBvcnRlZCAvTWFzayBmb3JtYXQuIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgUERGSW1hZ2UoewogICAgICB4cmVmLAogICAgICByZXMsCiAgICAgIGltYWdlOiBpbWFnZURhdGEsCiAgICAgIGlzSW5saW5lLAogICAgICBzbWFzazogc21hc2tEYXRhLAogICAgICBtYXNrOiBtYXNrRGF0YSwKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU1hc2soewogICAgaW1hZ2UsCiAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IGZhbHNlCiAgfSkgewogICAgY29uc3QgewogICAgICBkaWN0CiAgICB9ID0gaW1hZ2U7CiAgICBjb25zdCB3aWR0aCA9IGRpY3QuZ2V0KCJXIiwgIldpZHRoIik7CiAgICBjb25zdCBoZWlnaHQgPSBkaWN0LmdldCgiSCIsICJIZWlnaHQiKTsKICAgIGNvbnN0IGludGVycG9sYXRlID0gZGljdC5nZXQoIkkiLCAiSW50ZXJwb2xhdGUiKTsKICAgIGNvbnN0IGRlY29kZSA9IGRpY3QuZ2V0QXJyYXkoIkQiLCAiRGVjb2RlIik7CiAgICBjb25zdCBpbnZlcnNlRGVjb2RlID0gZGVjb2RlPy5bMF0gPiAwOwogICAgY29uc3QgY29tcHV0ZWRMZW5ndGggPSAod2lkdGggKyA3ID4+IDMpICogaGVpZ2h0OwogICAgY29uc3QgaW1nQXJyYXkgPSBpbWFnZS5nZXRCeXRlcyhjb21wdXRlZExlbmd0aCk7CiAgICBjb25zdCBpc1NpbmdsZU9wYXF1ZVBpeGVsID0gd2lkdGggPT09IDEgJiYgaGVpZ2h0ID09PSAxICYmIGludmVyc2VEZWNvZGUgPT09IChpbWdBcnJheS5sZW5ndGggPT09IDAgfHwgISEoaW1nQXJyYXlbMF0gJiAxMjgpKTsKICAgIGlmIChpc1NpbmdsZU9wYXF1ZVBpeGVsKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaXNTaW5nbGVPcGFxdWVQaXhlbAogICAgICB9OwogICAgfQogICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgIGlmIChJbWFnZVJlc2l6ZXIubmVlZHNUb0JlUmVzaXplZCh3aWR0aCwgaGVpZ2h0KSkgewogICAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQgKiA0KTsKICAgICAgICBjb252ZXJ0QmxhY2tBbmRXaGl0ZVRvUkdCQSh7CiAgICAgICAgICBzcmM6IGltZ0FycmF5LAogICAgICAgICAgZGVzdDogZGF0YSwKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgbm9uQmxhY2tDb2xvcjogMCwKICAgICAgICAgIGludmVyc2VEZWNvZGUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gSW1hZ2VSZXNpemVyLmNyZWF0ZUltYWdlKHsKICAgICAgICAgIGtpbmQ6IEltYWdlS2luZC5SR0JBXzMyQlBQLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgaW50ZXJwb2xhdGUKICAgICAgICB9KTsKICAgICAgfQogICAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY29uc3QgaW1nRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnZlcnRCbGFja0FuZFdoaXRlVG9SR0JBKHsKICAgICAgICBzcmM6IGltZ0FycmF5LAogICAgICAgIGRlc3Q6IGltZ0RhdGEuZGF0YSwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgbm9uQmxhY2tDb2xvcjogMCwKICAgICAgICBpbnZlcnNlRGVjb2RlCiAgICAgIH0pOwogICAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIDAsIDApOwogICAgICBjb25zdCBiaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgZGF0YTogbnVsbCwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaW50ZXJwb2xhdGUsCiAgICAgICAgYml0bWFwCiAgICAgIH07CiAgICB9CiAgICBjb25zdCBhY3R1YWxMZW5ndGggPSBpbWdBcnJheS5ieXRlTGVuZ3RoOwogICAgY29uc3QgaGF2ZUZ1bGxEYXRhID0gY29tcHV0ZWRMZW5ndGggPT09IGFjdHVhbExlbmd0aDsKICAgIGxldCBkYXRhOwogICAgaWYgKGltYWdlIGluc3RhbmNlb2YgRGVjb2RlU3RyZWFtICYmICghaW52ZXJzZURlY29kZSB8fCBoYXZlRnVsbERhdGEpKSB7CiAgICAgIGRhdGEgPSBpbWdBcnJheTsKICAgIH0gZWxzZSBpZiAoIWludmVyc2VEZWNvZGUpIHsKICAgICAgZGF0YSA9IG5ldyBVaW50OEFycmF5KGltZ0FycmF5KTsKICAgIH0gZWxzZSB7CiAgICAgIGRhdGEgPSBuZXcgVWludDhBcnJheShjb21wdXRlZExlbmd0aCk7CiAgICAgIGRhdGEuc2V0KGltZ0FycmF5KTsKICAgICAgZGF0YS5maWxsKDB4ZmYsIGFjdHVhbExlbmd0aCk7CiAgICB9CiAgICBpZiAoaW52ZXJzZURlY29kZSkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFjdHVhbExlbmd0aDsgaSsrKSB7CiAgICAgICAgZGF0YVtpXSBePSAweGZmOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBkYXRhLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBpbnRlcnBvbGF0ZQogICAgfTsKICB9CiAgZ2V0IGRyYXdXaWR0aCgpIHsKICAgIHJldHVybiBNYXRoLm1heCh0aGlzLndpZHRoLCB0aGlzLnNtYXNrPy53aWR0aCB8fCAwLCB0aGlzLm1hc2s/LndpZHRoIHx8IDApOwogIH0KICBnZXQgZHJhd0hlaWdodCgpIHsKICAgIHJldHVybiBNYXRoLm1heCh0aGlzLmhlaWdodCwgdGhpcy5zbWFzaz8uaGVpZ2h0IHx8IDAsIHRoaXMubWFzaz8uaGVpZ2h0IHx8IDApOwogIH0KICBkZWNvZGVCdWZmZXIoYnVmZmVyKSB7CiAgICBjb25zdCBicGMgPSB0aGlzLmJwYzsKICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKICAgIGNvbnN0IGRlY29kZUFkZGVuZHMgPSB0aGlzLmRlY29kZUFkZGVuZHM7CiAgICBjb25zdCBkZWNvZGVDb2VmZmljaWVudHMgPSB0aGlzLmRlY29kZUNvZWZmaWNpZW50czsKICAgIGNvbnN0IG1heCA9ICgxIDw8IGJwYykgLSAxOwogICAgbGV0IGksIGlpOwogICAgaWYgKGJwYyA9PT0gMSkgewogICAgICBmb3IgKGkgPSAwLCBpaSA9IGJ1ZmZlci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgYnVmZmVyW2ldID0gKyFidWZmZXJbaV07CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGluZGV4ID0gMDsKICAgIGZvciAoaSA9IDAsIGlpID0gdGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0OyBpIDwgaWk7IGkrKykgewogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG51bUNvbXBzOyBqKyspIHsKICAgICAgICBidWZmZXJbaW5kZXhdID0gTWF0aENsYW1wKGRlY29kZUFkZGVuZHNbal0gKyBidWZmZXJbaW5kZXhdICogZGVjb2RlQ29lZmZpY2llbnRzW2pdLCAwLCBtYXgpOwogICAgICAgIGluZGV4Kys7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0Q29tcG9uZW50cyhidWZmZXIpIHsKICAgIGNvbnN0IGJwYyA9IHRoaXMuYnBjOwogICAgaWYgKGJwYyA9PT0gOCkgewogICAgICByZXR1cm4gYnVmZmVyOwogICAgfQogICAgY29uc3Qgd2lkdGggPSB0aGlzLndpZHRoOwogICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBjb25zdCBsZW5ndGggPSB3aWR0aCAqIGhlaWdodCAqIG51bUNvbXBzOwogICAgbGV0IGJ1ZmZlclBvcyA9IDA7CiAgICBsZXQgb3V0cHV0OwogICAgaWYgKGJwYyA8PSA4KSB7CiAgICAgIG91dHB1dCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgICB9IGVsc2UgaWYgKGJwYyA8PSAxNikgewogICAgICBvdXRwdXQgPSBuZXcgVWludDE2QXJyYXkobGVuZ3RoKTsKICAgIH0gZWxzZSB7CiAgICAgIG91dHB1dCA9IG5ldyBVaW50MzJBcnJheShsZW5ndGgpOwogICAgfQogICAgY29uc3Qgcm93Q29tcHMgPSB3aWR0aCAqIG51bUNvbXBzOwogICAgY29uc3QgbWF4ID0gKDEgPDwgYnBjKSAtIDE7CiAgICBsZXQgaSA9IDAsCiAgICAgIGlpLAogICAgICBidWY7CiAgICBpZiAoYnBjID09PSAxKSB7CiAgICAgIGxldCBtYXNrLCBsb29wMUVuZCwgbG9vcDJFbmQ7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaGVpZ2h0OyBqKyspIHsKICAgICAgICBsb29wMUVuZCA9IGkgKyAocm93Q29tcHMgJiB+Nyk7CiAgICAgICAgbG9vcDJFbmQgPSBpICsgcm93Q29tcHM7CiAgICAgICAgd2hpbGUgKGkgPCBsb29wMUVuZCkgewogICAgICAgICAgYnVmID0gYnVmZmVyW2J1ZmZlclBvcysrXTsKICAgICAgICAgIG91dHB1dFtpXSA9IGJ1ZiA+PiA3ICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgMV0gPSBidWYgPj4gNiAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDJdID0gYnVmID4+IDUgJiAxOwogICAgICAgICAgb3V0cHV0W2kgKyAzXSA9IGJ1ZiA+PiA0ICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgNF0gPSBidWYgPj4gMyAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDVdID0gYnVmID4+IDIgJiAxOwogICAgICAgICAgb3V0cHV0W2kgKyA2XSA9IGJ1ZiA+PiAxICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgN10gPSBidWYgJiAxOwogICAgICAgICAgaSArPSA4OwogICAgICAgIH0KICAgICAgICBpZiAoaSA8IGxvb3AyRW5kKSB7CiAgICAgICAgICBidWYgPSBidWZmZXJbYnVmZmVyUG9zKytdOwogICAgICAgICAgbWFzayA9IDEyODsKICAgICAgICAgIHdoaWxlIChpIDwgbG9vcDJFbmQpIHsKICAgICAgICAgICAgb3V0cHV0W2krK10gPSArISEoYnVmICYgbWFzayk7CiAgICAgICAgICAgIG1hc2sgPj49IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsZXQgYml0cyA9IDA7CiAgICAgIGJ1ZiA9IDA7CiAgICAgIGZvciAoaSA9IDAsIGlpID0gbGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgIGlmIChpICUgcm93Q29tcHMgPT09IDApIHsKICAgICAgICAgIGJ1ZiA9IDA7CiAgICAgICAgICBiaXRzID0gMDsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKGJpdHMgPCBicGMpIHsKICAgICAgICAgIGJ1ZiA9IGJ1ZiA8PCA4IHwgYnVmZmVyW2J1ZmZlclBvcysrXTsKICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICB9CiAgICAgICAgY29uc3QgcmVtYWluaW5nQml0cyA9IGJpdHMgLSBicGM7CiAgICAgICAgbGV0IHZhbHVlID0gYnVmID4+IHJlbWFpbmluZ0JpdHM7CiAgICAgICAgaWYgKHZhbHVlIDwgMCkgewogICAgICAgICAgdmFsdWUgPSAwOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiBtYXgpIHsKICAgICAgICAgIHZhbHVlID0gbWF4OwogICAgICAgIH0KICAgICAgICBvdXRwdXRbaV0gPSB2YWx1ZTsKICAgICAgICBidWYgJj0gKDEgPDwgcmVtYWluaW5nQml0cykgLSAxOwogICAgICAgIGJpdHMgPSByZW1haW5pbmdCaXRzOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICBhc3luYyBmaWxsT3BhY2l0eShyZ2JhQnVmLCB3aWR0aCwgaGVpZ2h0LCBhY3R1YWxIZWlnaHQsIGltYWdlKSB7CiAgICBjb25zdCBzbWFzayA9IHRoaXMuc21hc2s7CiAgICBjb25zdCBtYXNrID0gdGhpcy5tYXNrOwogICAgbGV0IGFscGhhQnVmLCBzdywgc2gsIGksIGlpLCBqOwogICAgaWYgKHNtYXNrKSB7CiAgICAgIHN3ID0gc21hc2sud2lkdGg7CiAgICAgIHNoID0gc21hc2suaGVpZ2h0OwogICAgICBhbHBoYUJ1ZiA9IG5ldyBVaW50OENsYW1wZWRBcnJheShzdyAqIHNoKTsKICAgICAgYXdhaXQgc21hc2suZmlsbEdyYXlCdWZmZXIoYWxwaGFCdWYpOwogICAgICBpZiAoc3cgIT09IHdpZHRoIHx8IHNoICE9PSBoZWlnaHQpIHsKICAgICAgICBhbHBoYUJ1ZiA9IHJlc2l6ZUltYWdlTWFzayhhbHBoYUJ1Ziwgc21hc2suYnBjLCBzdywgc2gsIHdpZHRoLCBoZWlnaHQpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKG1hc2spIHsKICAgICAgaWYgKG1hc2sgaW5zdGFuY2VvZiBQREZJbWFnZSkgewogICAgICAgIHN3ID0gbWFzay53aWR0aDsKICAgICAgICBzaCA9IG1hc2suaGVpZ2h0OwogICAgICAgIGFscGhhQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHN3ICogc2gpOwogICAgICAgIG1hc2subnVtQ29tcHMgPSAxOwogICAgICAgIGF3YWl0IG1hc2suZmlsbEdyYXlCdWZmZXIoYWxwaGFCdWYpOwogICAgICAgIGZvciAoaSA9IDAsIGlpID0gc3cgKiBzaDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgIGFscGhhQnVmW2ldID0gMjU1IC0gYWxwaGFCdWZbaV07CiAgICAgICAgfQogICAgICAgIGlmIChzdyAhPT0gd2lkdGggfHwgc2ggIT09IGhlaWdodCkgewogICAgICAgICAgYWxwaGFCdWYgPSByZXNpemVJbWFnZU1hc2soYWxwaGFCdWYsIG1hc2suYnBjLCBzdywgc2gsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG1hc2spKSB7CiAgICAgICAgYWxwaGFCdWYgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwogICAgICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHdpZHRoICogaGVpZ2h0OyBpIDwgaWk7ICsraSkgewogICAgICAgICAgbGV0IG9wYWNpdHkgPSAwOwogICAgICAgICAgY29uc3QgaW1hZ2VPZmZzZXQgPSBpICogbnVtQ29tcHM7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbnVtQ29tcHM7ICsraikgewogICAgICAgICAgICBjb25zdCBjb2xvciA9IGltYWdlW2ltYWdlT2Zmc2V0ICsgal07CiAgICAgICAgICAgIGNvbnN0IG1hc2tPZmZzZXQgPSBqICogMjsKICAgICAgICAgICAgaWYgKGNvbG9yIDwgbWFza1ttYXNrT2Zmc2V0XSB8fCBjb2xvciA+IG1hc2tbbWFza09mZnNldCArIDFdKSB7CiAgICAgICAgICAgICAgb3BhY2l0eSA9IDI1NTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYWxwaGFCdWZbaV0gPSBvcGFjaXR5OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gbWFzayBmb3JtYXQuIik7CiAgICAgIH0KICAgIH0KICAgIGlmIChhbHBoYUJ1ZikgewogICAgICBmb3IgKGkgPSAwLCBqID0gMywgaWkgPSB3aWR0aCAqIGFjdHVhbEhlaWdodDsgaSA8IGlpOyArK2ksIGogKz0gNCkgewogICAgICAgIHJnYmFCdWZbal0gPSBhbHBoYUJ1ZltpXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yIChpID0gMCwgaiA9IDMsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IGkgPCBpaTsgKytpLCBqICs9IDQpIHsKICAgICAgICByZ2JhQnVmW2pdID0gMjU1OwogICAgICB9CiAgICB9CiAgfQogIHVuZG9QcmVibGVuZChidWZmZXIsIHdpZHRoLCBoZWlnaHQpIHsKICAgIGNvbnN0IG1hdHRlID0gdGhpcy5zbWFzaz8ubWF0dGU7CiAgICBpZiAoIW1hdHRlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1hdHRlUmdiID0gdGhpcy5jb2xvclNwYWNlLmdldFJnYihtYXR0ZSwgMCk7CiAgICBjb25zdCBtYXR0ZVIgPSBtYXR0ZVJnYlswXTsKICAgIGNvbnN0IG1hdHRlRyA9IG1hdHRlUmdiWzFdOwogICAgY29uc3QgbWF0dGVCID0gbWF0dGVSZ2JbMl07CiAgICBjb25zdCBsZW5ndGggPSB3aWR0aCAqIGhlaWdodCAqIDQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSA0KSB7CiAgICAgIGNvbnN0IGFscGhhID0gYnVmZmVyW2kgKyAzXTsKICAgICAgaWYgKGFscGhhID09PSAwKSB7CiAgICAgICAgYnVmZmVyW2ldID0gMjU1OwogICAgICAgIGJ1ZmZlcltpICsgMV0gPSAyNTU7CiAgICAgICAgYnVmZmVyW2kgKyAyXSA9IDI1NTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBrID0gMjU1IC8gYWxwaGE7CiAgICAgIGJ1ZmZlcltpXSA9IChidWZmZXJbaV0gLSBtYXR0ZVIpICogayArIG1hdHRlUjsKICAgICAgYnVmZmVyW2kgKyAxXSA9IChidWZmZXJbaSArIDFdIC0gbWF0dGVHKSAqIGsgKyBtYXR0ZUc7CiAgICAgIGJ1ZmZlcltpICsgMl0gPSAoYnVmZmVyW2kgKyAyXSAtIG1hdHRlQikgKiBrICsgbWF0dGVCOwogICAgfQogIH0KICBhc3luYyBjcmVhdGVJbWFnZURhdGEoZm9yY2VSR0JBID0gZmFsc2UsIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID0gZmFsc2UpIHsKICAgIGNvbnN0IGRyYXdXaWR0aCA9IHRoaXMuZHJhd1dpZHRoOwogICAgY29uc3QgZHJhd0hlaWdodCA9IHRoaXMuZHJhd0hlaWdodDsKICAgIGNvbnN0IGltZ0RhdGEgPSB7CiAgICAgIHdpZHRoOiBkcmF3V2lkdGgsCiAgICAgIGhlaWdodDogZHJhd0hlaWdodCwKICAgICAgaW50ZXJwb2xhdGU6IHRoaXMuaW50ZXJwb2xhdGUsCiAgICAgIGtpbmQ6IDAsCiAgICAgIGRhdGE6IG51bGwKICAgIH07CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBjb25zdCBvcmlnaW5hbFdpZHRoID0gdGhpcy53aWR0aDsKICAgIGNvbnN0IG9yaWdpbmFsSGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICBjb25zdCBicGMgPSB0aGlzLmJwYzsKICAgIGNvbnN0IHJvd0J5dGVzID0gb3JpZ2luYWxXaWR0aCAqIG51bUNvbXBzICogYnBjICsgNyA+PiAzOwogICAgY29uc3QgbXVzdEJlUmVzaXplZCA9IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkICYmIEltYWdlUmVzaXplci5uZWVkc1RvQmVSZXNpemVkKGRyYXdXaWR0aCwgZHJhd0hlaWdodCk7CiAgICBpZiAoIXRoaXMuc21hc2sgJiYgIXRoaXMubWFzayAmJiB0aGlzLmNvbG9yU3BhY2UubmFtZSA9PT0gIkRldmljZVJHQkEiKSB7CiAgICAgIGltZ0RhdGEua2luZCA9IEltYWdlS2luZC5SR0JBXzMyQlBQOwogICAgICBjb25zdCBpbWdBcnJheSA9IGltZ0RhdGEuZGF0YSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIG9yaWdpbmFsV2lkdGggKiA0LCB7fSk7CiAgICAgIGlmIChpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgICAgIGlmICghbXVzdEJlUmVzaXplZCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQml0bWFwKEltYWdlS2luZC5SR0JBXzMyQlBQLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIGltZ0FycmF5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIEltYWdlUmVzaXplci5jcmVhdGVJbWFnZShpbWdEYXRhLCBmYWxzZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGltZ0RhdGE7CiAgICB9CiAgICBpZiAoIWZvcmNlUkdCQSkgewogICAgICBsZXQga2luZDsKICAgICAgaWYgKHRoaXMuY29sb3JTcGFjZS5uYW1lID09PSAiRGV2aWNlR3JheSIgJiYgYnBjID09PSAxKSB7CiAgICAgICAga2luZCA9IEltYWdlS2luZC5HUkFZU0NBTEVfMUJQUDsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbG9yU3BhY2UubmFtZSA9PT0gIkRldmljZVJHQiIgJiYgYnBjID09PSA4ICYmICF0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgICAga2luZCA9IEltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgIH0KICAgICAgaWYgKGtpbmQgJiYgIXRoaXMuc21hc2sgJiYgIXRoaXMubWFzayAmJiBkcmF3V2lkdGggPT09IG9yaWdpbmFsV2lkdGggJiYgZHJhd0hlaWdodCA9PT0gb3JpZ2luYWxIZWlnaHQpIHsKICAgICAgICBjb25zdCBpbWFnZSA9IGF3YWl0IHRoaXMuI2dldEltYWdlKG9yaWdpbmFsV2lkdGgsIG9yaWdpbmFsSGVpZ2h0KTsKICAgICAgICBpZiAoaW1hZ2UpIHsKICAgICAgICAgIHJldHVybiBpbWFnZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzLCB7fSk7CiAgICAgICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgICAgICBpZiAobXVzdEJlUmVzaXplZCkgewogICAgICAgICAgICByZXR1cm4gSW1hZ2VSZXNpemVyLmNyZWF0ZUltYWdlKHsKICAgICAgICAgICAgICBkYXRhLAogICAgICAgICAgICAgIGtpbmQsCiAgICAgICAgICAgICAgd2lkdGg6IGRyYXdXaWR0aCwKICAgICAgICAgICAgICBoZWlnaHQ6IGRyYXdIZWlnaHQsCiAgICAgICAgICAgICAgaW50ZXJwb2xhdGU6IHRoaXMuaW50ZXJwb2xhdGUKICAgICAgICAgICAgfSwgdGhpcy5uZWVkc0RlY29kZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVCaXRtYXAoa2luZCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIGRhdGEpOwogICAgICAgIH0KICAgICAgICBpbWdEYXRhLmtpbmQgPSBraW5kOwogICAgICAgIGltZ0RhdGEuZGF0YSA9IGRhdGE7CiAgICAgICAgaWYgKHRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgICAgIGFzc2VydChraW5kID09PSBJbWFnZUtpbmQuR1JBWVNDQUxFXzFCUFAsICJQREZJbWFnZS5jcmVhdGVJbWFnZURhdGE6IFRoZSBpbWFnZSBtdXN0IGJlIGdyYXlzY2FsZS4iKTsKICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IGltZ0RhdGEuZGF0YTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGJ1ZmZlci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGJ1ZmZlcltpXSBePSAweGZmOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaW1nRGF0YTsKICAgICAgfQogICAgICBpZiAodGhpcy5pbWFnZSBpbnN0YW5jZW9mIEpwZWdTdHJlYW0gJiYgIXRoaXMuc21hc2sgJiYgIXRoaXMubWFzayAmJiAhdGhpcy5uZWVkc0RlY29kZSkgewogICAgICAgIGxldCBpbWFnZUxlbmd0aCA9IG9yaWdpbmFsSGVpZ2h0ICogcm93Qnl0ZXM7CiAgICAgICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkICYmICFtdXN0QmVSZXNpemVkKSB7CiAgICAgICAgICBsZXQgaXNIYW5kbGVkID0gZmFsc2U7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMuY29sb3JTcGFjZS5uYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIkRldmljZUdyYXkiOgogICAgICAgICAgICAgIGltYWdlTGVuZ3RoICo9IDQ7CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgICAgICBpbWFnZUxlbmd0aCA9IGltYWdlTGVuZ3RoIC8gMyAqIDQ7CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiRGV2aWNlQ01ZSyI6CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc0hhbmRsZWQpIHsKICAgICAgICAgICAgY29uc3QgaW1hZ2UgPSBhd2FpdCB0aGlzLiNnZXRJbWFnZShkcmF3V2lkdGgsIGRyYXdIZWlnaHQpOwogICAgICAgICAgICBpZiAoaW1hZ2UpIHsKICAgICAgICAgICAgICByZXR1cm4gaW1hZ2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcmdiYSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhpbWFnZUxlbmd0aCwgewogICAgICAgICAgICAgIGRyYXdXaWR0aCwKICAgICAgICAgICAgICBkcmF3SGVpZ2h0LAogICAgICAgICAgICAgIGZvcmNlUkdCQTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQml0bWFwKEltYWdlS2luZC5SR0JBXzMyQlBQLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIHJnYmEpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMuY29sb3JTcGFjZS5uYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIkRldmljZUdyYXkiOgogICAgICAgICAgICAgIGltYWdlTGVuZ3RoICo9IDM7CiAgICAgICAgICAgIGNhc2UgIkRldmljZVJHQiI6CiAgICAgICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgICAgIGltZ0RhdGEua2luZCA9IEltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgICAgICAgaW1nRGF0YS5kYXRhID0gYXdhaXQgdGhpcy5nZXRJbWFnZUJ5dGVzKGltYWdlTGVuZ3RoLCB7CiAgICAgICAgICAgICAgICBkcmF3V2lkdGgsCiAgICAgICAgICAgICAgICBkcmF3SGVpZ2h0LAogICAgICAgICAgICAgICAgZm9yY2VSR0I6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAobXVzdEJlUmVzaXplZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEltYWdlUmVzaXplci5jcmVhdGVJbWFnZShpbWdEYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGltZ0RhdGE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCBpbWdBcnJheSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzLCB7CiAgICAgIGludGVybmFsOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IGFjdHVhbEhlaWdodCA9IDAgfCBpbWdBcnJheS5sZW5ndGggLyByb3dCeXRlcyAqIGRyYXdIZWlnaHQgLyBvcmlnaW5hbEhlaWdodDsKICAgIGNvbnN0IGNvbXBzID0gdGhpcy5nZXRDb21wb25lbnRzKGltZ0FycmF5KTsKICAgIGxldCBhbHBoYTAxLCBtYXliZVVuZG9QcmVibGVuZDsKICAgIGxldCBjYW52YXMsIGN0eCwgY2FudmFzSW1nRGF0YSwgZGF0YTsKICAgIGlmIChpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiAhbXVzdEJlUmVzaXplZCkgewogICAgICBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKGRyYXdXaWR0aCwgZHJhd0hlaWdodCk7CiAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICBjYW52YXNJbWdEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShkcmF3V2lkdGgsIGRyYXdIZWlnaHQpOwogICAgICBkYXRhID0gY2FudmFzSW1nRGF0YS5kYXRhOwogICAgfQogICAgaW1nRGF0YS5raW5kID0gSW1hZ2VLaW5kLlJHQkFfMzJCUFA7CiAgICBpZiAoIWZvcmNlUkdCQSAmJiAhdGhpcy5zbWFzayAmJiAhdGhpcy5tYXNrKSB7CiAgICAgIGlmICghaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgfHwgbXVzdEJlUmVzaXplZCkgewogICAgICAgIGltZ0RhdGEua2luZCA9IEltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkcmF3V2lkdGggKiBkcmF3SGVpZ2h0ICogMyk7CiAgICAgICAgYWxwaGEwMSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYXJyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyKTsKICAgICAgICBhcnIuZmlsbChGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4ZmYwMDAwMDAgOiAweDAwMDAwMGZmKTsKICAgICAgICBhbHBoYTAxID0gMTsKICAgICAgfQogICAgICBtYXliZVVuZG9QcmVibGVuZCA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCFpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCB8fCBtdXN0QmVSZXNpemVkKSB7CiAgICAgICAgZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkcmF3V2lkdGggKiBkcmF3SGVpZ2h0ICogNCk7CiAgICAgIH0KICAgICAgYWxwaGEwMSA9IDE7CiAgICAgIG1heWJlVW5kb1ByZWJsZW5kID0gdHJ1ZTsKICAgICAgYXdhaXQgdGhpcy5maWxsT3BhY2l0eShkYXRhLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIGFjdHVhbEhlaWdodCwgY29tcHMpOwogICAgfQogICAgaWYgKHRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgdGhpcy5kZWNvZGVCdWZmZXIoY29tcHMpOwogICAgfQogICAgdGhpcy5jb2xvclNwYWNlLmZpbGxSZ2IoZGF0YSwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIGRyYXdXaWR0aCwgZHJhd0hlaWdodCwgYWN0dWFsSGVpZ2h0LCBicGMsIGNvbXBzLCBhbHBoYTAxKTsKICAgIGlmIChtYXliZVVuZG9QcmVibGVuZCkgewogICAgICB0aGlzLnVuZG9QcmVibGVuZChkYXRhLCBkcmF3V2lkdGgsIGFjdHVhbEhlaWdodCk7CiAgICB9CiAgICBpZiAoaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgJiYgIW11c3RCZVJlc2l6ZWQpIHsKICAgICAgY3R4LnB1dEltYWdlRGF0YShjYW52YXNJbWdEYXRhLCAwLCAwKTsKICAgICAgY29uc3QgYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgICByZXR1cm4gewogICAgICAgIGRhdGE6IG51bGwsCiAgICAgICAgd2lkdGg6IGRyYXdXaWR0aCwKICAgICAgICBoZWlnaHQ6IGRyYXdIZWlnaHQsCiAgICAgICAgYml0bWFwLAogICAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICAgIH07CiAgICB9CiAgICBpbWdEYXRhLmRhdGEgPSBkYXRhOwogICAgaWYgKG11c3RCZVJlc2l6ZWQpIHsKICAgICAgcmV0dXJuIEltYWdlUmVzaXplci5jcmVhdGVJbWFnZShpbWdEYXRhKTsKICAgIH0KICAgIHJldHVybiBpbWdEYXRhOwogIH0KICBhc3luYyBmaWxsR3JheUJ1ZmZlcihidWZmZXIpIHsKICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKICAgIGlmIChudW1Db21wcyAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYFJlYWRpbmcgZ3JheSBzY2FsZSBmcm9tIGEgY29sb3IgaW1hZ2U6ICR7bnVtQ29tcHN9YCk7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IHRoaXMud2lkdGg7CiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIGNvbnN0IGJwYyA9IHRoaXMuYnBjOwogICAgY29uc3Qgcm93Qnl0ZXMgPSB3aWR0aCAqIG51bUNvbXBzICogYnBjICsgNyA+PiAzOwogICAgY29uc3QgaW1nQXJyYXkgPSBhd2FpdCB0aGlzLmdldEltYWdlQnl0ZXMoaGVpZ2h0ICogcm93Qnl0ZXMsIHsKICAgICAgaW50ZXJuYWw6IHRydWUKICAgIH0pOwogICAgY29uc3QgY29tcHMgPSB0aGlzLmdldENvbXBvbmVudHMoaW1nQXJyYXkpOwogICAgbGV0IGksIGxlbmd0aDsKICAgIGlmIChicGMgPT09IDEpIHsKICAgICAgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQ7CiAgICAgIGlmICh0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBidWZmZXJbaV0gPSBjb21wc1tpXSAtIDEgJiAyNTU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgYnVmZmVyW2ldID0gLWNvbXBzW2ldICYgMjU1OwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5uZWVkc0RlY29kZSkgewogICAgICB0aGlzLmRlY29kZUJ1ZmZlcihjb21wcyk7CiAgICB9CiAgICBsZW5ndGggPSB3aWR0aCAqIGhlaWdodDsKICAgIGNvbnN0IHNjYWxlID0gMjU1IC8gKCgxIDw8IGJwYykgLSAxKTsKICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICBidWZmZXJbaV0gPSBzY2FsZSAqIGNvbXBzW2ldOwogICAgfQogIH0KICBjcmVhdGVCaXRtYXAoa2luZCwgd2lkdGgsIGhlaWdodCwgc3JjKSB7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICBsZXQgaW1nRGF0YTsKICAgIGlmIChraW5kID09PSBJbWFnZUtpbmQuUkdCQV8zMkJQUCkgewogICAgICBpbWdEYXRhID0gbmV3IEltYWdlRGF0YShzcmMsIHdpZHRoLCBoZWlnaHQpOwogICAgfSBlbHNlIHsKICAgICAgaW1nRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnZlcnRUb1JHQkEoewogICAgICAgIGtpbmQsCiAgICAgICAgc3JjLAogICAgICAgIGRlc3Q6IG5ldyBVaW50MzJBcnJheShpbWdEYXRhLmRhdGEuYnVmZmVyKSwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaW52ZXJzZURlY29kZTogdGhpcy5uZWVkc0RlY29kZQogICAgICB9KTsKICAgIH0KICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgMCwgMCk7CiAgICBjb25zdCBiaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICByZXR1cm4gewogICAgICBkYXRhOiBudWxsLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBiaXRtYXAsCiAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICB9OwogIH0KICBhc3luYyAjZ2V0SW1hZ2Uod2lkdGgsIGhlaWdodCkgewogICAgY29uc3QgYml0bWFwID0gYXdhaXQgdGhpcy5pbWFnZS5nZXRUcmFuc2ZlcmFibGVJbWFnZSgpOwogICAgaWYgKCFiaXRtYXApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gewogICAgICBkYXRhOiBudWxsLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBiaXRtYXAsCiAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICB9OwogIH0KICBhc3luYyBnZXRJbWFnZUJ5dGVzKGxlbmd0aCwgewogICAgZHJhd1dpZHRoLAogICAgZHJhd0hlaWdodCwKICAgIGZvcmNlUkdCQSA9IGZhbHNlLAogICAgZm9yY2VSR0IgPSBmYWxzZSwKICAgIGludGVybmFsID0gZmFsc2UKICB9KSB7CiAgICB0aGlzLmltYWdlLnJlc2V0KCk7CiAgICB0aGlzLmltYWdlLmRyYXdXaWR0aCA9IGRyYXdXaWR0aCB8fCB0aGlzLndpZHRoOwogICAgdGhpcy5pbWFnZS5kcmF3SGVpZ2h0ID0gZHJhd0hlaWdodCB8fCB0aGlzLmhlaWdodDsKICAgIHRoaXMuaW1hZ2UuZm9yY2VSR0JBID0gISFmb3JjZVJHQkE7CiAgICB0aGlzLmltYWdlLmZvcmNlUkdCID0gISFmb3JjZVJHQjsKICAgIGNvbnN0IGltYWdlQnl0ZXMgPSBhd2FpdCB0aGlzLmltYWdlLmdldEltYWdlRGF0YShsZW5ndGgsIHRoaXMuanB4RGVjb2Rlck9wdGlvbnMpOwogICAgaWYgKGludGVybmFsIHx8IHRoaXMuaW1hZ2UgaW5zdGFuY2VvZiBEZWNvZGVTdHJlYW0pIHsKICAgICAgcmV0dXJuIGltYWdlQnl0ZXM7CiAgICB9CiAgICBhc3NlcnQoaW1hZ2VCeXRlcyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXksICdQREZJbWFnZS5nZXRJbWFnZUJ5dGVzOiBVbnN1cHBvcnRlZCAiaW1hZ2VCeXRlcyIgdHlwZS4nKTsKICAgIHJldHVybiBuZXcgVWludDhBcnJheShpbWFnZUJ5dGVzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2V2YWx1YXRvci5qcwoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpjb25zdCBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnMgPSBPYmplY3QuZnJlZXplKHsKICBtYXhJbWFnZVNpemU6IC0xLAogIGRpc2FibGVGb250RmFjZTogZmFsc2UsCiAgaWdub3JlRXJyb3JzOiBmYWxzZSwKICBpc0V2YWxTdXBwb3J0ZWQ6IHRydWUsCiAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ6IGZhbHNlLAogIGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOiBmYWxzZSwKICBjYW52YXNNYXhBcmVhSW5CeXRlczogLTEsCiAgZm9udEV4dHJhUHJvcGVydGllczogZmFsc2UsCiAgdXNlU3lzdGVtRm9udHM6IHRydWUsCiAgdXNlV2FzbTogdHJ1ZSwKICB1c2VXb3JrZXJGZXRjaDogdHJ1ZSwKICBjTWFwVXJsOiBudWxsLAogIGljY1VybDogbnVsbCwKICBzdGFuZGFyZEZvbnREYXRhVXJsOiBudWxsLAogIHdhc21Vcmw6IG51bGwKfSk7CmNvbnN0IFBhdHRlcm5UeXBlID0gewogIFRJTElORzogMSwKICBTSEFESU5HOiAyCn07CmNvbnN0IFRFWFRfQ0hVTktfQkFUQ0hfU0laRSA9IDEwOwpjb25zdCBkZWZlcnJlZCA9IFByb21pc2UucmVzb2x2ZSgpOwpmdW5jdGlvbiBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUsIHBhcnNpbmdBcnJheSA9IGZhbHNlKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICBmb3IgKGNvbnN0IHZhbCBvZiB2YWx1ZSkgewogICAgICBjb25zdCBtYXliZUJNID0gbm9ybWFsaXplQmxlbmRNb2RlKHZhbCwgdHJ1ZSk7CiAgICAgIGlmIChtYXliZUJNKSB7CiAgICAgICAgcmV0dXJuIG1heWJlQk07CiAgICAgIH0KICAgIH0KICAgIHdhcm4oYFVuc3VwcG9ydGVkIGJsZW5kIG1vZGUgQXJyYXk6ICR7dmFsdWV9YCk7CiAgICByZXR1cm4gInNvdXJjZS1vdmVyIjsKICB9CiAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgaWYgKHBhcnNpbmdBcnJheSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiAic291cmNlLW92ZXIiOwogIH0KICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgIGNhc2UgIk5vcm1hbCI6CiAgICBjYXNlICJDb21wYXRpYmxlIjoKICAgICAgcmV0dXJuICJzb3VyY2Utb3ZlciI7CiAgICBjYXNlICJNdWx0aXBseSI6CiAgICAgIHJldHVybiAibXVsdGlwbHkiOwogICAgY2FzZSAiU2NyZWVuIjoKICAgICAgcmV0dXJuICJzY3JlZW4iOwogICAgY2FzZSAiT3ZlcmxheSI6CiAgICAgIHJldHVybiAib3ZlcmxheSI7CiAgICBjYXNlICJEYXJrZW4iOgogICAgICByZXR1cm4gImRhcmtlbiI7CiAgICBjYXNlICJMaWdodGVuIjoKICAgICAgcmV0dXJuICJsaWdodGVuIjsKICAgIGNhc2UgIkNvbG9yRG9kZ2UiOgogICAgICByZXR1cm4gImNvbG9yLWRvZGdlIjsKICAgIGNhc2UgIkNvbG9yQnVybiI6CiAgICAgIHJldHVybiAiY29sb3ItYnVybiI7CiAgICBjYXNlICJIYXJkTGlnaHQiOgogICAgICByZXR1cm4gImhhcmQtbGlnaHQiOwogICAgY2FzZSAiU29mdExpZ2h0IjoKICAgICAgcmV0dXJuICJzb2Z0LWxpZ2h0IjsKICAgIGNhc2UgIkRpZmZlcmVuY2UiOgogICAgICByZXR1cm4gImRpZmZlcmVuY2UiOwogICAgY2FzZSAiRXhjbHVzaW9uIjoKICAgICAgcmV0dXJuICJleGNsdXNpb24iOwogICAgY2FzZSAiSHVlIjoKICAgICAgcmV0dXJuICJodWUiOwogICAgY2FzZSAiU2F0dXJhdGlvbiI6CiAgICAgIHJldHVybiAic2F0dXJhdGlvbiI7CiAgICBjYXNlICJDb2xvciI6CiAgICAgIHJldHVybiAiY29sb3IiOwogICAgY2FzZSAiTHVtaW5vc2l0eSI6CiAgICAgIHJldHVybiAibHVtaW5vc2l0eSI7CiAgfQogIGlmIChwYXJzaW5nQXJyYXkpIHsKICAgIHJldHVybiBudWxsOwogIH0KICB3YXJuKGBVbnN1cHBvcnRlZCBibGVuZCBtb2RlOiAke3ZhbHVlLm5hbWV9YCk7CiAgcmV0dXJuICJzb3VyY2Utb3ZlciI7Cn0KZnVuY3Rpb24gYWRkQ2FjaGVkSW1hZ2VPcHMob3BMaXN0LCB7CiAgb2JqSWQsCiAgZm4sCiAgYXJncywKICBvcHRpb25hbENvbnRlbnQsCiAgaGFzTWFzawp9KSB7CiAgaWYgKG9iaklkKSB7CiAgICBvcExpc3QuYWRkRGVwZW5kZW5jeShvYmpJZCk7CiAgfQogIG9wTGlzdC5hZGRJbWFnZU9wcyhmbiwgYXJncywgb3B0aW9uYWxDb250ZW50LCBoYXNNYXNrKTsKICBpZiAoZm4gPT09IE9QUy5wYWludEltYWdlTWFza1hPYmplY3QgJiYgYXJnc1swXT8uY291bnQgPiAwKSB7CiAgICBhcmdzWzBdLmNvdW50Kys7CiAgfQp9CmNsYXNzIFRpbWVTbG90TWFuYWdlciB7CiAgc3RhdGljIFRJTUVfU0xPVF9EVVJBVElPTl9NUyA9IDIwOwogIHN0YXRpYyBDSEVDS19USU1FX0VWRVJZID0gMTAwOwogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5yZXNldCgpOwogIH0KICBjaGVjaygpIHsKICAgIGlmICgrK3RoaXMuY2hlY2tlZCA8IFRpbWVTbG90TWFuYWdlci5DSEVDS19USU1FX0VWRVJZKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuY2hlY2tlZCA9IDA7CiAgICByZXR1cm4gdGhpcy5lbmRUaW1lIDw9IERhdGUubm93KCk7CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5lbmRUaW1lID0gRGF0ZS5ub3coKSArIFRpbWVTbG90TWFuYWdlci5USU1FX1NMT1RfRFVSQVRJT05fTVM7CiAgICB0aGlzLmNoZWNrZWQgPSAwOwogIH0KfQpjbGFzcyBQYXJ0aWFsRXZhbHVhdG9yIHsKICBjb25zdHJ1Y3Rvcih7CiAgICB4cmVmLAogICAgaGFuZGxlciwKICAgIHBhZ2VJbmRleCwKICAgIGlkRmFjdG9yeSwKICAgIGZvbnRDYWNoZSwKICAgIGJ1aWx0SW5DTWFwQ2FjaGUsCiAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGUsCiAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBnbG9iYWxJbWFnZUNhY2hlLAogICAgc3lzdGVtRm9udENhY2hlLAogICAgb3B0aW9ucyA9IG51bGwKICB9KSB7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjsKICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgdGhpcy5pZEZhY3RvcnkgPSBpZEZhY3Rvcnk7CiAgICB0aGlzLmZvbnRDYWNoZSA9IGZvbnRDYWNoZTsKICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZSA9IGJ1aWx0SW5DTWFwQ2FjaGU7CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZSA9IHN0YW5kYXJkRm9udERhdGFDYWNoZTsKICAgIHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlID0gZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOwogICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlID0gZ2xvYmFsSW1hZ2VDYWNoZTsKICAgIHRoaXMuc3lzdGVtRm9udENhY2hlID0gc3lzdGVtRm9udENhY2hlOwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnM7CiAgICB0aGlzLnR5cGUzRm9udFJlZnMgPSBudWxsOwogICAgdGhpcy5fcmVnaW9uYWxJbWFnZUNhY2hlID0gbmV3IFJlZ2lvbmFsSW1hZ2VDYWNoZSgpOwogICAgdGhpcy5fZmV0Y2hCdWlsdEluQ01hcEJvdW5kID0gdGhpcy5mZXRjaEJ1aWx0SW5DTWFwLmJpbmQodGhpcyk7CiAgfQogIGdldCBfcGRmRnVuY3Rpb25GYWN0b3J5KCkgewogICAgY29uc3QgcGRmRnVuY3Rpb25GYWN0b3J5ID0gbmV3IFBERkZ1bmN0aW9uRmFjdG9yeSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaXNFdmFsU3VwcG9ydGVkOiB0aGlzLm9wdGlvbnMuaXNFdmFsU3VwcG9ydGVkCiAgICB9KTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9wZGZGdW5jdGlvbkZhY3RvcnkiLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogIH0KICBnZXQgcGFyc2luZ1R5cGUzRm9udCgpIHsKICAgIHJldHVybiAhIXRoaXMudHlwZTNGb250UmVmczsKICB9CiAgY2xvbmUobmV3T3B0aW9ucyA9IG51bGwpIHsKICAgIGNvbnN0IG5ld0V2YWx1YXRvciA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBuZXdFdmFsdWF0b3Iub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgdGhpcy5vcHRpb25zLCBuZXdPcHRpb25zKTsKICAgIHJldHVybiBuZXdFdmFsdWF0b3I7CiAgfQogIGhhc0JsZW5kTW9kZXMocmVzb3VyY2VzLCBub25CbGVuZE1vZGVzU2V0KSB7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAocmVzb3VyY2VzLm9iaklkICYmIG5vbkJsZW5kTW9kZXNTZXQuaGFzKHJlc291cmNlcy5vYmpJZCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgcHJvY2Vzc2VkID0gbmV3IFJlZlNldChub25CbGVuZE1vZGVzU2V0KTsKICAgIGlmIChyZXNvdXJjZXMub2JqSWQpIHsKICAgICAgcHJvY2Vzc2VkLnB1dChyZXNvdXJjZXMub2JqSWQpOwogICAgfQogICAgY29uc3Qgbm9kZXMgPSBbcmVzb3VyY2VzXSwKICAgICAgeHJlZiA9IHRoaXMueHJlZjsKICAgIHdoaWxlIChub2Rlcy5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzLnNoaWZ0KCk7CiAgICAgIGNvbnN0IGdyYXBoaWNTdGF0ZXMgPSBub2RlLmdldCgiRXh0R1N0YXRlIik7CiAgICAgIGlmIChncmFwaGljU3RhdGVzIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGZvciAobGV0IGdyYXBoaWNTdGF0ZSBvZiBncmFwaGljU3RhdGVzLmdldFJhd1ZhbHVlcygpKSB7CiAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGdyYXBoaWNTdGF0ZSkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGdyYXBoaWNTdGF0ZSA9IHhyZWYuZmV0Y2goZ3JhcGhpY1N0YXRlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICBwcm9jZXNzZWQucHV0KGdyYXBoaWNTdGF0ZSk7CiAgICAgICAgICAgICAgaW5mbyhgaGFzQmxlbmRNb2RlcyAtIGlnbm9yaW5nIEV4dEdTdGF0ZTogIiR7ZXh9Ii5gKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCEoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlLm9iaklkKSB7CiAgICAgICAgICAgIHByb2Nlc3NlZC5wdXQoZ3JhcGhpY1N0YXRlLm9iaklkKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGJtID0gZ3JhcGhpY1N0YXRlLmdldCgiQk0iKTsKICAgICAgICAgIGlmIChibSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgaWYgKGJtLm5hbWUgIT09ICJOb3JtYWwiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYm0gIT09IHVuZGVmaW5lZCAmJiBBcnJheS5pc0FycmF5KGJtKSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYm0pIHsKICAgICAgICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIE5hbWUgJiYgZWxlbWVudC5uYW1lICE9PSAiTm9ybWFsIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHhPYmplY3RzID0gbm9kZS5nZXQoIlhPYmplY3QiKTsKICAgICAgaWYgKCEoeE9iamVjdHMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAobGV0IHhPYmplY3Qgb2YgeE9iamVjdHMuZ2V0UmF3VmFsdWVzKCkpIHsKICAgICAgICBpZiAoeE9iamVjdCBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgaWYgKHByb2Nlc3NlZC5oYXMoeE9iamVjdCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB4T2JqZWN0ID0geHJlZi5mZXRjaCh4T2JqZWN0KTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIHByb2Nlc3NlZC5wdXQoeE9iamVjdCk7CiAgICAgICAgICAgIGluZm8oYGhhc0JsZW5kTW9kZXMgLSBpZ25vcmluZyBYT2JqZWN0OiAiJHtleH0iLmApOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCEoeE9iamVjdCBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHhPYmplY3QuZGljdC5vYmpJZCkgewogICAgICAgICAgcHJvY2Vzc2VkLnB1dCh4T2JqZWN0LmRpY3Qub2JqSWQpOwogICAgICAgIH0KICAgICAgICBjb25zdCB4UmVzb3VyY2VzID0geE9iamVjdC5kaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICAgICAgaWYgKCEoeFJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHhSZXNvdXJjZXMub2JqSWQgJiYgcHJvY2Vzc2VkLmhhcyh4UmVzb3VyY2VzLm9iaklkKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIG5vZGVzLnB1c2goeFJlc291cmNlcyk7CiAgICAgICAgaWYgKHhSZXNvdXJjZXMub2JqSWQpIHsKICAgICAgICAgIHByb2Nlc3NlZC5wdXQoeFJlc291cmNlcy5vYmpJZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IHJlZiBvZiBwcm9jZXNzZWQpIHsKICAgICAgbm9uQmxlbmRNb2Rlc1NldC5wdXQocmVmKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgZmV0Y2hCdWlsdEluQ01hcChuYW1lKSB7CiAgICBjb25zdCBjYWNoZWREYXRhID0gdGhpcy5idWlsdEluQ01hcENhY2hlLmdldChuYW1lKTsKICAgIGlmIChjYWNoZWREYXRhKSB7CiAgICAgIHJldHVybiBjYWNoZWREYXRhOwogICAgfQogICAgbGV0IGRhdGE7CiAgICBpZiAodGhpcy5vcHRpb25zLnVzZVdvcmtlckZldGNoKSB7CiAgICAgIGRhdGEgPSB7CiAgICAgICAgY01hcERhdGE6IGF3YWl0IGZldGNoQmluYXJ5RGF0YShgJHt0aGlzLm9wdGlvbnMuY01hcFVybH0ke25hbWV9LmJjbWFwYCksCiAgICAgICAgaXNDb21wcmVzc2VkOiB0cnVlCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBkYXRhID0gYXdhaXQgdGhpcy5oYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiRmV0Y2hCaW5hcnlEYXRhIiwgewogICAgICAgIHR5cGU6ICJjTWFwUmVhZGVyRmFjdG9yeSIsCiAgICAgICAgbmFtZQogICAgICB9KTsKICAgIH0KICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZS5zZXQobmFtZSwgZGF0YSk7CiAgICByZXR1cm4gZGF0YTsKICB9CiAgYXN5bmMgZmV0Y2hTdGFuZGFyZEZvbnREYXRhKG5hbWUpIHsKICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZS5nZXQobmFtZSk7CiAgICBpZiAoY2FjaGVkRGF0YSkgewogICAgICByZXR1cm4gbmV3IFN0cmVhbShjYWNoZWREYXRhKTsKICAgIH0KICAgIGlmICh0aGlzLm9wdGlvbnMudXNlU3lzdGVtRm9udHMgJiYgbmFtZSAhPT0gIlN5bWJvbCIgJiYgbmFtZSAhPT0gIlphcGZEaW5nYmF0cyIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBzdGFuZGFyZEZvbnROYW1lVG9GaWxlTmFtZSA9IGdldEZvbnROYW1lVG9GaWxlTWFwKCksCiAgICAgIGZpbGVuYW1lID0gc3RhbmRhcmRGb250TmFtZVRvRmlsZU5hbWVbbmFtZV07CiAgICBsZXQgZGF0YTsKICAgIHRyeSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMudXNlV29ya2VyRmV0Y2gpIHsKICAgICAgICBkYXRhID0gYXdhaXQgZmV0Y2hCaW5hcnlEYXRhKGAke3RoaXMub3B0aW9ucy5zdGFuZGFyZEZvbnREYXRhVXJsfSR7ZmlsZW5hbWV9YCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YSA9IGF3YWl0IHRoaXMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkZldGNoQmluYXJ5RGF0YSIsIHsKICAgICAgICAgIHR5cGU6ICJzdGFuZGFyZEZvbnREYXRhRmFjdG9yeSIsCiAgICAgICAgICBmaWxlbmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICB3YXJuKGV4KTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZS5zZXQobmFtZSwgZGF0YSk7CiAgICByZXR1cm4gbmV3IFN0cmVhbShkYXRhKTsKICB9CiAgYXN5bmMgYnVpbGRGb3JtWE9iamVjdChyZXNvdXJjZXMsIHhvYmosIHNtYXNrLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSB4b2JqOwogICAgY29uc3QgbWF0cml4ID0gbG9va3VwTWF0cml4KGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpLCBudWxsKTsKICAgIGNvbnN0IGJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGRpY3QuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50LCBncm91cE9wdGlvbnM7CiAgICBpZiAoZGljdC5oYXMoIk9DIikpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgdGhpcy5wYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhkaWN0LmdldCgiT0MiKSwgcmVzb3VyY2VzKTsKICAgIH0KICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzLCBbIk9DIiwgb3B0aW9uYWxDb250ZW50XSk7CiAgICB9CiAgICBjb25zdCBncm91cCA9IGRpY3QuZ2V0KCJHcm91cCIpOwogICAgaWYgKGdyb3VwKSB7CiAgICAgIGdyb3VwT3B0aW9ucyA9IHsKICAgICAgICBtYXRyaXgsCiAgICAgICAgYmJveCwKICAgICAgICBzbWFzaywKICAgICAgICBpc29sYXRlZDogZmFsc2UsCiAgICAgICAga25vY2tvdXQ6IGZhbHNlCiAgICAgIH07CiAgICAgIGNvbnN0IGdyb3VwU3VidHlwZSA9IGdyb3VwLmdldCgiUyIpOwogICAgICBsZXQgY29sb3JTcGFjZSA9IG51bGw7CiAgICAgIGlmIChpc05hbWUoZ3JvdXBTdWJ0eXBlLCAiVHJhbnNwYXJlbmN5IikpIHsKICAgICAgICBncm91cE9wdGlvbnMuaXNvbGF0ZWQgPSBncm91cC5nZXQoIkkiKSB8fCBmYWxzZTsKICAgICAgICBncm91cE9wdGlvbnMua25vY2tvdXQgPSBncm91cC5nZXQoIksiKSB8fCBmYWxzZTsKICAgICAgICBpZiAoZ3JvdXAuaGFzKCJDUyIpKSB7CiAgICAgICAgICBjb25zdCBjcyA9IHRoaXMuX2dldENvbG9yU3BhY2UoZ3JvdXAuZ2V0UmF3KCJDUyIpLCByZXNvdXJjZXMsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICAgIGNvbG9yU3BhY2UgPSBjcyBpbnN0YW5jZW9mIENvbG9yU3BhY2UgPyBjcyA6IGF3YWl0IHRoaXMuX2hhbmRsZUNvbG9yU3BhY2UoY3MpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc21hc2s/LmJhY2tkcm9wKSB7CiAgICAgICAgY29sb3JTcGFjZSB8fD0gQ29sb3JTcGFjZVV0aWxzLnJnYjsKICAgICAgICBzbWFzay5iYWNrZHJvcCA9IGNvbG9yU3BhY2UuZ2V0UmdiSGV4KHNtYXNrLmJhY2tkcm9wLCAwKTsKICAgICAgfQogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmJlZ2luR3JvdXAsIFtncm91cE9wdGlvbnNdKTsKICAgIH0KICAgIGNvbnN0IGYzMm1hdHJpeCA9IG1hdHJpeCAmJiBuZXcgRmxvYXQzMkFycmF5KG1hdHJpeCk7CiAgICBjb25zdCBmMzJiYm94ID0gIWdyb3VwICYmIGJib3ggJiYgbmV3IEZsb2F0MzJBcnJheShiYm94KSB8fCBudWxsOwogICAgY29uc3QgYXJncyA9IFtmMzJtYXRyaXgsIGYzMmJib3hdOwogICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5wYWludEZvcm1YT2JqZWN0QmVnaW4sIGFyZ3MpOwogICAgY29uc3QgbG9jYWxSZXNvdXJjZXMgPSBkaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICBhd2FpdCB0aGlzLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgIHN0cmVhbTogeG9iaiwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzOiBsb2NhbFJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QgPyBsb2NhbFJlc291cmNlcyA6IHJlc291cmNlcywKICAgICAgb3BlcmF0b3JMaXN0LAogICAgICBpbml0aWFsU3RhdGUsCiAgICAgIHByZXZSZWZzOiBzZWVuUmVmcwogICAgfSk7CiAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnBhaW50Rm9ybVhPYmplY3RFbmQsIFtdKTsKICAgIGlmIChncm91cCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmVuZEdyb3VwLCBbZ3JvdXBPcHRpb25zXSk7CiAgICB9CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5lbmRNYXJrZWRDb250ZW50LCBbXSk7CiAgICB9CiAgfQogIF9zZW5kSW1nRGF0YShvYmpJZCwgaW1nRGF0YSwgY2FjaGVHbG9iYWxseSA9IGZhbHNlKSB7CiAgICBjb25zdCB0cmFuc2ZlcnMgPSBpbWdEYXRhID8gW2ltZ0RhdGEuYml0bWFwIHx8IGltZ0RhdGEuZGF0YS5idWZmZXJdIDogbnVsbDsKICAgIGlmICh0aGlzLnBhcnNpbmdUeXBlM0ZvbnQgfHwgY2FjaGVHbG9iYWxseSkgewogICAgICByZXR1cm4gdGhpcy5oYW5kbGVyLnNlbmQoImNvbW1vbm9iaiIsIFtvYmpJZCwgIkltYWdlIiwgaW1nRGF0YV0sIHRyYW5zZmVycyk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5oYW5kbGVyLnNlbmQoIm9iaiIsIFtvYmpJZCwgdGhpcy5wYWdlSW5kZXgsICJJbWFnZSIsIGltZ0RhdGFdLCB0cmFuc2ZlcnMpOwogIH0KICBhc3luYyBidWlsZFBhaW50SW1hZ2VYT2JqZWN0KHsKICAgIHJlc291cmNlcywKICAgIGltYWdlLAogICAgaXNJbmxpbmUgPSBmYWxzZSwKICAgIG9wZXJhdG9yTGlzdCwKICAgIGNhY2hlS2V5LAogICAgbG9jYWxJbWFnZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIG1heEltYWdlU2l6ZSwKICAgICAgaWdub3JlRXJyb3JzLAogICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZAogICAgfSA9IHRoaXMub3B0aW9uczsKICAgIGNvbnN0IHsKICAgICAgZGljdAogICAgfSA9IGltYWdlOwogICAgY29uc3QgaW1hZ2VSZWYgPSBkaWN0Lm9iaklkOwogICAgY29uc3QgdyA9IGRpY3QuZ2V0KCJXIiwgIldpZHRoIik7CiAgICBjb25zdCBoID0gZGljdC5nZXQoIkgiLCAiSGVpZ2h0Iik7CiAgICBpZiAoISh3ICYmIHR5cGVvZiB3ID09PSAibnVtYmVyIikgfHwgIShoICYmIHR5cGVvZiBoID09PSAibnVtYmVyIikpIHsKICAgICAgd2FybigiSW1hZ2UgZGltZW5zaW9ucyBhcmUgbWlzc2luZywgb3Igbm90IG51bWJlcnMuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChtYXhJbWFnZVNpemUgIT09IC0xICYmIHcgKiBoID4gbWF4SW1hZ2VTaXplKSB7CiAgICAgIGNvbnN0IG1zZyA9ICJJbWFnZSBleGNlZWRlZCBtYXhpbXVtIGFsbG93ZWQgc2l6ZSBhbmQgd2FzIHJlbW92ZWQuIjsKICAgICAgaWYgKCFpZ25vcmVFcnJvcnMpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKICAgICAgfQogICAgICB3YXJuKG1zZyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBvcHRpb25hbENvbnRlbnQ7CiAgICBpZiAoZGljdC5oYXMoIk9DIikpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgdGhpcy5wYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhkaWN0LmdldCgiT0MiKSwgcmVzb3VyY2VzKTsKICAgIH0KICAgIGNvbnN0IGltYWdlTWFzayA9IGRpY3QuZ2V0KCJJTSIsICJJbWFnZU1hc2siKSB8fCBmYWxzZTsKICAgIGxldCBpbWdEYXRhLCBmbiwgYXJnczsKICAgIGlmIChpbWFnZU1hc2spIHsKICAgICAgaW1nRGF0YSA9IGF3YWl0IFBERkltYWdlLmNyZWF0ZU1hc2soewogICAgICAgIGltYWdlLAogICAgICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOiBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiAhdGhpcy5wYXJzaW5nVHlwZTNGb250CiAgICAgIH0pOwogICAgICBpZiAoaW1nRGF0YS5pc1NpbmdsZU9wYXF1ZVBpeGVsKSB7CiAgICAgICAgZm4gPSBPUFMucGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrOwogICAgICAgIGFyZ3MgPSBbXTsKICAgICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoZm4sIGFyZ3MsIG9wdGlvbmFsQ29udGVudCk7CiAgICAgICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgICAgICBjb25zdCBjYWNoZURhdGEgPSB7CiAgICAgICAgICAgIGZuLAogICAgICAgICAgICBhcmdzLAogICAgICAgICAgICBvcHRpb25hbENvbnRlbnQKICAgICAgICAgIH07CiAgICAgICAgICBsb2NhbEltYWdlQ2FjaGUuc2V0KGNhY2hlS2V5LCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICAgIGlmIChpbWFnZVJlZikgewogICAgICAgICAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUuc2V0KG51bGwsIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMucGFyc2luZ1R5cGUzRm9udCkgewogICAgICAgIGFyZ3MgPSBjb21waWxlVHlwZTNHbHlwaChpbWdEYXRhKTsKICAgICAgICBpZiAoYXJncykgewogICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZEltYWdlT3BzKE9QUy5jb25zdHJ1Y3RQYXRoLCBhcmdzLCBvcHRpb25hbENvbnRlbnQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB3YXJuKCJDYW5ub3QgY29tcGlsZSBUeXBlMyBnbHlwaC4iKTsKICAgICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdCwgW2ltZ0RhdGFdLCBvcHRpb25hbENvbnRlbnQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBvYmpJZCA9IGBtYXNrXyR7dGhpcy5pZEZhY3RvcnkuY3JlYXRlT2JqSWQoKX1gOwogICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jeShvYmpJZCk7CiAgICAgIGltZ0RhdGEuZGF0YUxlbiA9IGltZ0RhdGEuYml0bWFwID8gaW1nRGF0YS53aWR0aCAqIGltZ0RhdGEuaGVpZ2h0ICogNCA6IGltZ0RhdGEuZGF0YS5sZW5ndGg7CiAgICAgIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBpbWdEYXRhKTsKICAgICAgZm4gPSBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0OwogICAgICBhcmdzID0gW3sKICAgICAgICBkYXRhOiBvYmpJZCwKICAgICAgICB3aWR0aDogaW1nRGF0YS53aWR0aCwKICAgICAgICBoZWlnaHQ6IGltZ0RhdGEuaGVpZ2h0LAogICAgICAgIGludGVycG9sYXRlOiBpbWdEYXRhLmludGVycG9sYXRlLAogICAgICAgIGNvdW50OiAxCiAgICAgIH1dOwogICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoZm4sIGFyZ3MsIG9wdGlvbmFsQ29udGVudCk7CiAgICAgIGlmIChjYWNoZUtleSkgewogICAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IHsKICAgICAgICAgIG9iaklkLAogICAgICAgICAgZm4sCiAgICAgICAgICBhcmdzLAogICAgICAgICAgb3B0aW9uYWxDb250ZW50CiAgICAgICAgfTsKICAgICAgICBsb2NhbEltYWdlQ2FjaGUuc2V0KGNhY2hlS2V5LCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICBpZiAoaW1hZ2VSZWYpIHsKICAgICAgICAgIHRoaXMuX3JlZ2lvbmFsSW1hZ2VDYWNoZS5zZXQobnVsbCwgaW1hZ2VSZWYsIGNhY2hlRGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFNNQUxMX0lNQUdFX0RJTUVOU0lPTlMgPSAyMDA7CiAgICBjb25zdCBoYXNNYXNrID0gZGljdC5oYXMoIlNNYXNrIikgfHwgZGljdC5oYXMoIk1hc2siKTsKICAgIGlmIChpc0lubGluZSAmJiB3ICsgaCA8IFNNQUxMX0lNQUdFX0RJTUVOU0lPTlMgJiYgIWhhc01hc2spIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBpbWFnZU9iaiA9IG5ldyBQREZJbWFnZSh7CiAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICByZXM6IHJlc291cmNlcywKICAgICAgICAgIGltYWdlLAogICAgICAgICAgaXNJbmxpbmUsCiAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZTogdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgIH0pOwogICAgICAgIGltZ0RhdGEgPSBhd2FpdCBpbWFnZU9iai5jcmVhdGVJbWFnZURhdGEodHJ1ZSwgZmFsc2UpOwogICAgICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3QsIFtpbWdEYXRhXSwgb3B0aW9uYWxDb250ZW50KTsKICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgY29uc3QgbXNnID0gYFVuYWJsZSB0byBkZWNvZGUgaW5saW5lIGltYWdlOiAiJHtyZWFzb259Ii5gOwogICAgICAgIGlmICghaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKICAgICAgICB9CiAgICAgICAgd2Fybihtc2cpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBvYmpJZCA9IGBpbWdfJHt0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpfWAsCiAgICAgIGNhY2hlR2xvYmFsbHkgPSBmYWxzZSwKICAgICAgZ2xvYmFsQ2FjaGVEYXRhID0gbnVsbDsKICAgIGlmICh0aGlzLnBhcnNpbmdUeXBlM0ZvbnQpIHsKICAgICAgb2JqSWQgPSBgJHt0aGlzLmlkRmFjdG9yeS5nZXREb2NJZCgpfV90eXBlM18ke29iaklkfWA7CiAgICB9IGVsc2UgaWYgKGNhY2hlS2V5ICYmIGltYWdlUmVmKSB7CiAgICAgIGNhY2hlR2xvYmFsbHkgPSB0aGlzLmdsb2JhbEltYWdlQ2FjaGUuc2hvdWxkQ2FjaGUoaW1hZ2VSZWYsIHRoaXMucGFnZUluZGV4KTsKICAgICAgaWYgKGNhY2hlR2xvYmFsbHkpIHsKICAgICAgICBhc3NlcnQoIWlzSW5saW5lLCAiQ2Fubm90IGNhY2hlIGFuIGlubGluZSBpbWFnZSBnbG9iYWxseS4iKTsKICAgICAgICBvYmpJZCA9IGAke3RoaXMuaWRGYWN0b3J5LmdldERvY0lkKCl9XyR7b2JqSWR9YDsKICAgICAgfQogICAgfQogICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY3kob2JqSWQpOwogICAgZm4gPSBPUFMucGFpbnRJbWFnZVhPYmplY3Q7CiAgICBhcmdzID0gW29iaklkLCB3LCBoXTsKICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhmbiwgYXJncywgb3B0aW9uYWxDb250ZW50LCBoYXNNYXNrKTsKICAgIGlmIChjYWNoZUdsb2JhbGx5KSB7CiAgICAgIGdsb2JhbENhY2hlRGF0YSA9IHsKICAgICAgICBvYmpJZCwKICAgICAgICBmbiwKICAgICAgICBhcmdzLAogICAgICAgIG9wdGlvbmFsQ29udGVudCwKICAgICAgICBoYXNNYXNrLAogICAgICAgIGJ5dGVTaXplOiAwCiAgICAgIH07CiAgICAgIGlmICh0aGlzLmdsb2JhbEltYWdlQ2FjaGUuaGFzRGVjb2RlRmFpbGVkKGltYWdlUmVmKSkgewogICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5zZXREYXRhKGltYWdlUmVmLCBnbG9iYWxDYWNoZURhdGEpOwogICAgICAgIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBudWxsLCBjYWNoZUdsb2JhbGx5KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHcgKiBoID4gMjUwMDAwIHx8IGhhc01hc2spIHsKICAgICAgICBjb25zdCBsb2NhbExlbmd0aCA9IGF3YWl0IHRoaXMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoImNvbW1vbm9iaiIsIFtvYmpJZCwgIkNvcHlMb2NhbEltYWdlIiwgewogICAgICAgICAgaW1hZ2VSZWYKICAgICAgICB9XSk7CiAgICAgICAgaWYgKGxvY2FsTGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmdsb2JhbEltYWdlQ2FjaGUuc2V0RGF0YShpbWFnZVJlZiwgZ2xvYmFsQ2FjaGVEYXRhKTsKICAgICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5hZGRCeXRlU2l6ZShpbWFnZVJlZiwgbG9jYWxMZW5ndGgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgUERGSW1hZ2UuYnVpbGRJbWFnZSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgcmVzOiByZXNvdXJjZXMsCiAgICAgIGltYWdlLAogICAgICBpc0lubGluZSwKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5OiB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZTogdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KS50aGVuKGFzeW5jIGltYWdlT2JqID0+IHsKICAgICAgaW1nRGF0YSA9IGF3YWl0IGltYWdlT2JqLmNyZWF0ZUltYWdlRGF0YShmYWxzZSwgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpOwogICAgICBpbWdEYXRhLmRhdGFMZW4gPSBpbWdEYXRhLmJpdG1hcCA/IGltZ0RhdGEud2lkdGggKiBpbWdEYXRhLmhlaWdodCAqIDQgOiBpbWdEYXRhLmRhdGEubGVuZ3RoOwogICAgICBpbWdEYXRhLnJlZiA9IGltYWdlUmVmOwogICAgICBpZiAoY2FjaGVHbG9iYWxseSkgewogICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5hZGRCeXRlU2l6ZShpbWFnZVJlZiwgaW1nRGF0YS5kYXRhTGVuKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fc2VuZEltZ0RhdGEob2JqSWQsIGltZ0RhdGEsIGNhY2hlR2xvYmFsbHkpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgd2FybihgVW5hYmxlIHRvIGRlY29kZSBpbWFnZSAiJHtvYmpJZH0iOiAiJHtyZWFzb259Ii5gKTsKICAgICAgaWYgKGltYWdlUmVmKSB7CiAgICAgICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLmFkZERlY29kZUZhaWxlZChpbWFnZVJlZik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBudWxsLCBjYWNoZUdsb2JhbGx5KTsKICAgIH0pOwogICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IHsKICAgICAgICBvYmpJZCwKICAgICAgICBmbiwKICAgICAgICBhcmdzLAogICAgICAgIG9wdGlvbmFsQ29udGVudCwKICAgICAgICBoYXNNYXNrCiAgICAgIH07CiAgICAgIGxvY2FsSW1hZ2VDYWNoZS5zZXQoY2FjaGVLZXksIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICBpZiAoaW1hZ2VSZWYpIHsKICAgICAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUuc2V0KG51bGwsIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgIGlmIChjYWNoZUdsb2JhbGx5KSB7CiAgICAgICAgICBhc3NlcnQoZ2xvYmFsQ2FjaGVEYXRhLCAiVGhlIGdsb2JhbCBjYWNoZS1kYXRhIG11c3QgYmUgYXZhaWxhYmxlLiIpOwogICAgICAgICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLnNldERhdGEoaW1hZ2VSZWYsIGdsb2JhbENhY2hlRGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGhhbmRsZVNNYXNrKHNtYXNrLCByZXNvdXJjZXMsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgc2VlblJlZnMpIHsKICAgIGNvbnN0IHNtYXNrQ29udGVudCA9IHNtYXNrLmdldCgiRyIpOwogICAgY29uc3Qgc21hc2tPcHRpb25zID0gewogICAgICBzdWJ0eXBlOiBzbWFzay5nZXQoIlMiKS5uYW1lLAogICAgICBiYWNrZHJvcDogc21hc2suZ2V0KCJCQyIpCiAgICB9OwogICAgY29uc3QgdHJhbnNmZXJPYmogPSBzbWFzay5nZXQoIlRSIik7CiAgICBpZiAoaXNQREZGdW5jdGlvbih0cmFuc2Zlck9iaikpIHsKICAgICAgY29uc3QgdHJhbnNmZXJGbiA9IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUodHJhbnNmZXJPYmopOwogICAgICBjb25zdCB0cmFuc2Zlck1hcCA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgICAgIGNvbnN0IHRtcCA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICB0bXBbMF0gPSBpIC8gMjU1OwogICAgICAgIHRyYW5zZmVyRm4odG1wLCAwLCB0bXAsIDApOwogICAgICAgIHRyYW5zZmVyTWFwW2ldID0gdG1wWzBdICogMjU1IHwgMDsKICAgICAgfQogICAgICBzbWFza09wdGlvbnMudHJhbnNmZXJNYXAgPSB0cmFuc2Zlck1hcDsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ1aWxkRm9ybVhPYmplY3QocmVzb3VyY2VzLCBzbWFza0NvbnRlbnQsIHNtYXNrT3B0aW9ucywgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoewogICAgICBuZXdQYXRoOiB0cnVlCiAgICB9KSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKTsKICB9CiAgaGFuZGxlVHJhbnNmZXJGdW5jdGlvbih0cikgewogICAgbGV0IHRyYW5zZmVyQXJyYXk7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh0cikpIHsKICAgICAgdHJhbnNmZXJBcnJheSA9IHRyOwogICAgfSBlbHNlIGlmIChpc1BERkZ1bmN0aW9uKHRyKSkgewogICAgICB0cmFuc2ZlckFycmF5ID0gW3RyXTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgdHJhbnNmZXJNYXBzID0gW107CiAgICBsZXQgbnVtRm5zID0gMCwKICAgICAgbnVtRWZmZWN0ZnVsRm5zID0gMDsKICAgIGZvciAoY29uc3QgZW50cnkgb2YgdHJhbnNmZXJBcnJheSkgewogICAgICBjb25zdCB0cmFuc2Zlck9iaiA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGVudHJ5KTsKICAgICAgbnVtRm5zKys7CiAgICAgIGlmIChpc05hbWUodHJhbnNmZXJPYmosICJJZGVudGl0eSIpKSB7CiAgICAgICAgdHJhbnNmZXJNYXBzLnB1c2gobnVsbCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSBpZiAoIWlzUERGRnVuY3Rpb24odHJhbnNmZXJPYmopKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgdHJhbnNmZXJGbiA9IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUodHJhbnNmZXJPYmopOwogICAgICBjb25zdCB0cmFuc2Zlck1hcCA9IG5ldyBVaW50OEFycmF5KDI1NiksCiAgICAgICAgdG1wID0gbmV3IEZsb2F0MzJBcnJheSgxKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAyNTY7IGorKykgewogICAgICAgIHRtcFswXSA9IGogLyAyNTU7CiAgICAgICAgdHJhbnNmZXJGbih0bXAsIDAsIHRtcCwgMCk7CiAgICAgICAgdHJhbnNmZXJNYXBbal0gPSB0bXBbMF0gKiAyNTUgfCAwOwogICAgICB9CiAgICAgIHRyYW5zZmVyTWFwcy5wdXNoKHRyYW5zZmVyTWFwKTsKICAgICAgbnVtRWZmZWN0ZnVsRm5zKys7CiAgICB9CiAgICBpZiAoIShudW1GbnMgPT09IDEgfHwgbnVtRm5zID09PSA0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChudW1FZmZlY3RmdWxGbnMgPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gdHJhbnNmZXJNYXBzOwogIH0KICBoYW5kbGVUaWxpbmdUeXBlKGZuLCBjb2xvciwgcmVzb3VyY2VzLCBwYXR0ZXJuLCBwYXR0ZXJuRGljdCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSkgewogICAgY29uc3QgdGlsaW5nT3BMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgY29uc3QgcGF0dGVyblJlc291cmNlcyA9IERpY3QubWVyZ2UoewogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIGRpY3RBcnJheTogW3BhdHRlcm5EaWN0LmdldCgiUmVzb3VyY2VzIiksIHJlc291cmNlc10KICAgIH0pOwogICAgcmV0dXJuIHRoaXMuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgc3RyZWFtOiBwYXR0ZXJuLAogICAgICB0YXNrLAogICAgICByZXNvdXJjZXM6IHBhdHRlcm5SZXNvdXJjZXMsCiAgICAgIG9wZXJhdG9yTGlzdDogdGlsaW5nT3BMaXN0CiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3Qgb3BlcmF0b3JMaXN0SVIgPSB0aWxpbmdPcExpc3QuZ2V0SVIoKTsKICAgICAgY29uc3QgdGlsaW5nUGF0dGVybklSID0gZ2V0VGlsaW5nUGF0dGVybklSKG9wZXJhdG9yTGlzdElSLCBwYXR0ZXJuRGljdCwgY29sb3IpOwogICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jaWVzKHRpbGluZ09wTGlzdC5kZXBlbmRlbmNpZXMpOwogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIHRpbGluZ1BhdHRlcm5JUik7CiAgICAgIGlmIChwYXR0ZXJuRGljdC5vYmpJZCkgewogICAgICAgIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLnNldChudWxsLCBwYXR0ZXJuRGljdC5vYmpJZCwgewogICAgICAgICAgb3BlcmF0b3JMaXN0SVIsCiAgICAgICAgICBkaWN0OiBwYXR0ZXJuRGljdAogICAgICAgIH0pOwogICAgICB9CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBoYW5kbGVUaWxpbmdUeXBlIC0gaWdub3JpbmcgcGF0dGVybjogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0pOwogIH0KICBhc3luYyBoYW5kbGVTZXRGb250KHJlc291cmNlcywgZm9udEFyZ3MsIGZvbnRSZWYsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGUsIGZhbGxiYWNrRm9udERpY3QgPSBudWxsLCBjc3NGb250SW5mbyA9IG51bGwpIHsKICAgIGNvbnN0IGZvbnROYW1lID0gZm9udEFyZ3M/LlswXSBpbnN0YW5jZW9mIE5hbWUgPyBmb250QXJnc1swXS5uYW1lIDogbnVsbDsKICAgIGNvbnN0IHRyYW5zbGF0ZWQgPSBhd2FpdCB0aGlzLmxvYWRGb250KGZvbnROYW1lLCBmb250UmVmLCByZXNvdXJjZXMsIHRhc2ssIGZhbGxiYWNrRm9udERpY3QsIGNzc0ZvbnRJbmZvKTsKICAgIGlmICh0cmFuc2xhdGVkLmZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY2llcyh0cmFuc2xhdGVkLnR5cGUzRGVwZW5kZW5jaWVzKTsKICAgIH0KICAgIHN0YXRlLmZvbnQgPSB0cmFuc2xhdGVkLmZvbnQ7CiAgICB0cmFuc2xhdGVkLnNlbmQodGhpcy5oYW5kbGVyKTsKICAgIHJldHVybiB0cmFuc2xhdGVkLmxvYWRlZE5hbWU7CiAgfQogIGhhbmRsZVRleHQoY2hhcnMsIHN0YXRlKSB7CiAgICBjb25zdCBmb250ID0gc3RhdGUuZm9udDsKICAgIGNvbnN0IGdseXBocyA9IGZvbnQuY2hhcnNUb0dseXBocyhjaGFycyk7CiAgICBpZiAoZm9udC5kYXRhKSB7CiAgICAgIGNvbnN0IGlzQWRkVG9QYXRoU2V0ID0gISEoc3RhdGUudGV4dFJlbmRlcmluZ01vZGUgJiBUZXh0UmVuZGVyaW5nTW9kZS5BRERfVE9fUEFUSF9GTEFHKTsKICAgICAgaWYgKGlzQWRkVG9QYXRoU2V0IHx8IHN0YXRlLmZpbGxDb2xvclNwYWNlLm5hbWUgPT09ICJQYXR0ZXJuIiB8fCBmb250LmRpc2FibGVGb250RmFjZSkgewogICAgICAgIFBhcnRpYWxFdmFsdWF0b3IuYnVpbGRGb250UGF0aHMoZm9udCwgZ2x5cGhzLCB0aGlzLmhhbmRsZXIsIHRoaXMub3B0aW9ucyk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBnbHlwaHM7CiAgfQogIGVuc3VyZVN0YXRlRm9udChzdGF0ZSkgewogICAgaWYgKHN0YXRlLmZvbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcmVhc29uID0gbmV3IEZvcm1hdEVycm9yKCJNaXNzaW5nIHNldEZvbnQgKFRmKSBvcGVyYXRvciBiZWZvcmUgdGV4dCByZW5kZXJpbmcgb3BlcmF0b3IuIik7CiAgICBpZiAodGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICB3YXJuKGBlbnN1cmVTdGF0ZUZvbnQ6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aHJvdyByZWFzb247CiAgfQogIGFzeW5jIHNldEdTdGF0ZSh7CiAgICByZXNvdXJjZXMsCiAgICBnU3RhdGUsCiAgICBvcGVyYXRvckxpc3QsCiAgICBjYWNoZUtleSwKICAgIHRhc2ssCiAgICBzdGF0ZU1hbmFnZXIsCiAgICBsb2NhbEdTdGF0ZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBzZWVuUmVmcwogIH0pIHsKICAgIGNvbnN0IGdTdGF0ZVJlZiA9IGdTdGF0ZS5vYmpJZDsKICAgIGxldCBpc1NpbXBsZUdTdGF0ZSA9IHRydWU7CiAgICBjb25zdCBnU3RhdGVPYmogPSBbXTsKICAgIGxldCBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBnU3RhdGUpIHsKICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICBjYXNlICJUeXBlIjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkxXIjoKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIHdhcm4oYEludmFsaWQgTFcgKGxpbmUgd2lkdGgpOiAke3ZhbHVlfWApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGdTdGF0ZU9iai5wdXNoKFtrZXksIE1hdGguYWJzKHZhbHVlKV0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTEMiOgogICAgICAgIGNhc2UgIkxKIjoKICAgICAgICBjYXNlICJNTCI6CiAgICAgICAgY2FzZSAiRCI6CiAgICAgICAgY2FzZSAiUkkiOgogICAgICAgIGNhc2UgIkZMIjoKICAgICAgICBjYXNlICJDQSI6CiAgICAgICAgY2FzZSAiY2EiOgogICAgICAgICAgZ1N0YXRlT2JqLnB1c2goW2tleSwgdmFsdWVdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZvbnQiOgogICAgICAgICAgaXNTaW1wbGVHU3RhdGUgPSBmYWxzZTsKICAgICAgICAgIHByb21pc2UgPSBwcm9taXNlLnRoZW4oKCkgPT4gdGhpcy5oYW5kbGVTZXRGb250KHJlc291cmNlcywgbnVsbCwgdmFsdWVbMF0sIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLnN0YXRlKS50aGVuKGZ1bmN0aW9uIChsb2FkZWROYW1lKSB7CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmN5KGxvYWRlZE5hbWUpOwogICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBbbG9hZGVkTmFtZSwgdmFsdWVbMV1dXSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCTSI6CiAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUpXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTTWFzayI6CiAgICAgICAgICBpZiAoaXNOYW1lKHZhbHVlLCAiTm9uZSIpKSB7CiAgICAgICAgICAgIGdTdGF0ZU9iai5wdXNoKFtrZXksIGZhbHNlXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgICBpc1NpbXBsZUdTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgICBwcm9taXNlID0gcHJvbWlzZS50aGVuKCgpID0+IHRoaXMuaGFuZGxlU01hc2sodmFsdWUsIHJlc291cmNlcywgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIsIGxvY2FsQ29sb3JTcGFjZUNhY2hlLCBzZWVuUmVmcykpOwogICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCB0cnVlXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3YXJuKCJVbnN1cHBvcnRlZCBTTWFzayB0eXBlIik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJUUiI6CiAgICAgICAgICBjb25zdCB0cmFuc2Zlck1hcHMgPSB0aGlzLmhhbmRsZVRyYW5zZmVyRnVuY3Rpb24odmFsdWUpOwogICAgICAgICAgZ1N0YXRlT2JqLnB1c2goW2tleSwgdHJhbnNmZXJNYXBzXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJPUCI6CiAgICAgICAgY2FzZSAib3AiOgogICAgICAgIGNhc2UgIk9QTSI6CiAgICAgICAgY2FzZSAiQkciOgogICAgICAgIGNhc2UgIkJHMiI6CiAgICAgICAgY2FzZSAiVUNSIjoKICAgICAgICBjYXNlICJVQ1IyIjoKICAgICAgICBjYXNlICJUUjIiOgogICAgICAgIGNhc2UgIkhUIjoKICAgICAgICBjYXNlICJTTSI6CiAgICAgICAgY2FzZSAiU0EiOgogICAgICAgIGNhc2UgIkFJUyI6CiAgICAgICAgY2FzZSAiVEsiOgogICAgICAgICAgaW5mbygiZ3JhcGhpYyBzdGF0ZSBvcGVyYXRvciAiICsga2V5KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpbmZvKCJVbmtub3duIGdyYXBoaWMgc3RhdGUgb3BlcmF0b3IgIiArIGtleSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgYXdhaXQgcHJvbWlzZTsKICAgIGlmIChnU3RhdGVPYmoubGVuZ3RoID4gMCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnNldEdTdGF0ZSwgW2dTdGF0ZU9ial0pOwogICAgfQogICAgaWYgKGlzU2ltcGxlR1N0YXRlKSB7CiAgICAgIGxvY2FsR1N0YXRlQ2FjaGUuc2V0KGNhY2hlS2V5LCBnU3RhdGVSZWYsIGdTdGF0ZU9iaik7CiAgICB9CiAgfQogIGxvYWRGb250KGZvbnROYW1lLCBmb250LCByZXNvdXJjZXMsIHRhc2ssIGZhbGxiYWNrRm9udERpY3QgPSBudWxsLCBjc3NGb250SW5mbyA9IG51bGwpIHsKICAgIGNvbnN0IGVycm9yRm9udCA9IGFzeW5jICgpID0+IG5ldyBUcmFuc2xhdGVkRm9udCh7CiAgICAgIGxvYWRlZE5hbWU6ICJnX2ZvbnRfZXJyb3IiLAogICAgICBmb250OiBuZXcgRXJyb3JGb250KGBGb250ICIke2ZvbnROYW1lfSIgaXMgbm90IGF2YWlsYWJsZS5gKSwKICAgICAgZGljdDogZm9udAogICAgfSk7CiAgICBsZXQgZm9udFJlZjsKICAgIGlmIChmb250KSB7CiAgICAgIGlmIChmb250IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgZm9udFJlZiA9IGZvbnQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGZvbnRSZXMgPSByZXNvdXJjZXMuZ2V0KCJGb250Iik7CiAgICAgIGlmIChmb250UmVzKSB7CiAgICAgICAgZm9udFJlZiA9IGZvbnRSZXMuZ2V0UmF3KGZvbnROYW1lKTsKICAgICAgfQogICAgfQogICAgaWYgKGZvbnRSZWYpIHsKICAgICAgaWYgKHRoaXMudHlwZTNGb250UmVmcz8uaGFzKGZvbnRSZWYpKSB7CiAgICAgICAgcmV0dXJuIGVycm9yRm9udCgpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmZvbnRDYWNoZS5oYXMoZm9udFJlZikpIHsKICAgICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnRSZWYpOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgZm9udCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZvbnRSZWYpOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHdhcm4oYGxvYWRGb250IC0gbG9va3VwIGZhaWxlZDogIiR7ZXh9Ii5gKTsKICAgICAgfQogICAgfQogICAgaWYgKCEoZm9udCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycyAmJiAhdGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgICAgd2FybihgRm9udCAiJHtmb250TmFtZX0iIGlzIG5vdCBhdmFpbGFibGUuYCk7CiAgICAgICAgcmV0dXJuIGVycm9yRm9udCgpOwogICAgICB9CiAgICAgIHdhcm4oYEZvbnQgIiR7Zm9udE5hbWV9IiBpcyBub3QgYXZhaWxhYmxlIC0tIGF0dGVtcHRpbmcgdG8gZmFsbGJhY2sgdG8gYSBkZWZhdWx0IGZvbnQuYCk7CiAgICAgIGZvbnQgPSBmYWxsYmFja0ZvbnREaWN0IHx8IFBhcnRpYWxFdmFsdWF0b3IuZmFsbGJhY2tGb250RGljdDsKICAgIH0KICAgIGlmIChmb250LmNhY2hlS2V5ICYmIHRoaXMuZm9udENhY2hlLmhhcyhmb250LmNhY2hlS2V5KSkgewogICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnQuY2FjaGVLZXkpOwogICAgfQogICAgY29uc3QgewogICAgICBwcm9taXNlLAogICAgICByZXNvbHZlCiAgICB9ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICBsZXQgcHJlRXZhbHVhdGVkRm9udDsKICAgIHRyeSB7CiAgICAgIHByZUV2YWx1YXRlZEZvbnQgPSB0aGlzLnByZUV2YWx1YXRlRm9udChmb250KTsKICAgICAgcHJlRXZhbHVhdGVkRm9udC5jc3NGb250SW5mbyA9IGNzc0ZvbnRJbmZvOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIHdhcm4oYGxvYWRGb250IC0gcHJlRXZhbHVhdGVGb250IGZhaWxlZDogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBlcnJvckZvbnQoKTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgZGVzY3JpcHRvciwKICAgICAgaGFzaAogICAgfSA9IHByZUV2YWx1YXRlZEZvbnQ7CiAgICBjb25zdCBmb250UmVmSXNSZWYgPSBmb250UmVmIGluc3RhbmNlb2YgUmVmOwogICAgbGV0IGZvbnRJRDsKICAgIGlmIChoYXNoICYmIGRlc2NyaXB0b3IgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IGZvbnRBbGlhc2VzID0gZGVzY3JpcHRvci5mb250QWxpYXNlcyB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgaWYgKGZvbnRBbGlhc2VzW2hhc2hdKSB7CiAgICAgICAgY29uc3QgYWxpYXNGb250UmVmID0gZm9udEFsaWFzZXNbaGFzaF0uYWxpYXNSZWY7CiAgICAgICAgaWYgKGZvbnRSZWZJc1JlZiAmJiBhbGlhc0ZvbnRSZWYgJiYgdGhpcy5mb250Q2FjaGUuaGFzKGFsaWFzRm9udFJlZikpIHsKICAgICAgICAgIHRoaXMuZm9udENhY2hlLnB1dEFsaWFzKGZvbnRSZWYsIGFsaWFzRm9udFJlZik7CiAgICAgICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnRSZWYpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb250QWxpYXNlc1toYXNoXSA9IHsKICAgICAgICAgIGZvbnRJRDogdGhpcy5pZEZhY3RvcnkuY3JlYXRlRm9udElkKCkKICAgICAgICB9OwogICAgICB9CiAgICAgIGlmIChmb250UmVmSXNSZWYpIHsKICAgICAgICBmb250QWxpYXNlc1toYXNoXS5hbGlhc1JlZiA9IGZvbnRSZWY7CiAgICAgIH0KICAgICAgZm9udElEID0gZm9udEFsaWFzZXNbaGFzaF0uZm9udElEOwogICAgfSBlbHNlIHsKICAgICAgZm9udElEID0gdGhpcy5pZEZhY3RvcnkuY3JlYXRlRm9udElkKCk7CiAgICB9CiAgICBhc3NlcnQoZm9udElEPy5zdGFydHNXaXRoKCJmIiksICdUaGUgImZvbnRJRCIgbXVzdCBiZSAoY29ycmVjdGx5KSBkZWZpbmVkLicpOwogICAgaWYgKGZvbnRSZWZJc1JlZikgewogICAgICB0aGlzLmZvbnRDYWNoZS5wdXQoZm9udFJlZiwgcHJvbWlzZSk7CiAgICB9IGVsc2UgewogICAgICBmb250LmNhY2hlS2V5ID0gYGNhY2hlS2V5XyR7Zm9udElEfWA7CiAgICAgIHRoaXMuZm9udENhY2hlLnB1dChmb250LmNhY2hlS2V5LCBwcm9taXNlKTsKICAgIH0KICAgIGZvbnQubG9hZGVkTmFtZSA9IGAke3RoaXMuaWRGYWN0b3J5LmdldERvY0lkKCl9XyR7Zm9udElEfWA7CiAgICB0aGlzLnRyYW5zbGF0ZUZvbnQocHJlRXZhbHVhdGVkRm9udCkudGhlbihhc3luYyB0cmFuc2xhdGVkRm9udCA9PiB7CiAgICAgIGNvbnN0IHRyYW5zbGF0ZWQgPSBuZXcgVHJhbnNsYXRlZEZvbnQoewogICAgICAgIGxvYWRlZE5hbWU6IGZvbnQubG9hZGVkTmFtZSwKICAgICAgICBmb250OiB0cmFuc2xhdGVkRm9udCwKICAgICAgICBkaWN0OiBmb250CiAgICAgIH0pOwogICAgICBpZiAodHJhbnNsYXRlZEZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgYXdhaXQgdHJhbnNsYXRlZC5sb2FkVHlwZTNEYXRhKHRoaXMsIHJlc291cmNlcywgdGFzayk7CiAgICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFR5cGUzIGZvbnQgbG9hZCBlcnJvcjogJHtyZWFzb259YCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJlc29sdmUodHJhbnNsYXRlZCk7CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICB3YXJuKGBsb2FkRm9udCAtIHRyYW5zbGF0ZUZvbnQgZmFpbGVkOiAiJHtyZWFzb259Ii5gKTsKICAgICAgcmVzb2x2ZShuZXcgVHJhbnNsYXRlZEZvbnQoewogICAgICAgIGxvYWRlZE5hbWU6IGZvbnQubG9hZGVkTmFtZSwKICAgICAgICBmb250OiBuZXcgRXJyb3JGb250KHJlYXNvbj8ubWVzc2FnZSksCiAgICAgICAgZGljdDogZm9udAogICAgICB9KSk7CiAgICB9KTsKICAgIHJldHVybiBwcm9taXNlOwogIH0KICBidWlsZFBhdGgoZm4sIGFyZ3MsIHN0YXRlKSB7CiAgICBjb25zdCB7CiAgICAgIHBhdGhNaW5NYXg6IG1pbk1heCwKICAgICAgcGF0aEJ1ZmZlcgogICAgfSA9IHN0YXRlOwogICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgY2FzZSBPUFMucmVjdGFuZ2xlOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHggPSBzdGF0ZS5jdXJyZW50UG9pbnRYID0gYXJnc1swXTsKICAgICAgICAgIGNvbnN0IHkgPSBzdGF0ZS5jdXJyZW50UG9pbnRZID0gYXJnc1sxXTsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gYXJnc1syXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IGFyZ3NbM107CiAgICAgICAgICBjb25zdCB4dyA9IHggKyB3aWR0aDsKICAgICAgICAgIGNvbnN0IHloID0geSArIGhlaWdodDsKICAgICAgICAgIGlmICh3aWR0aCA9PT0gMCB8fCBoZWlnaHQgPT09IDApIHsKICAgICAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMubW92ZVRvLCB4LCB5LCBEcmF3T1BTLmxpbmVUbywgeHcsIHloLCBEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5tb3ZlVG8sIHgsIHksIERyYXdPUFMubGluZVRvLCB4dywgeSwgRHJhd09QUy5saW5lVG8sIHh3LCB5aCwgRHJhd09QUy5saW5lVG8sIHgsIHloLCBEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICB9CiAgICAgICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveCh4LCB5LCB4dywgeWgsIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLm1vdmVUbzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB4ID0gc3RhdGUuY3VycmVudFBvaW50WCA9IGFyZ3NbMF07CiAgICAgICAgICBjb25zdCB5ID0gc3RhdGUuY3VycmVudFBvaW50WSA9IGFyZ3NbMV07CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5tb3ZlVG8sIHgsIHkpOwogICAgICAgICAgVXRpbC5wb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLmxpbmVUbzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB4ID0gc3RhdGUuY3VycmVudFBvaW50WCA9IGFyZ3NbMF07CiAgICAgICAgICBjb25zdCB5ID0gc3RhdGUuY3VycmVudFBvaW50WSA9IGFyZ3NbMV07CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5saW5lVG8sIHgsIHkpOwogICAgICAgICAgVXRpbC5wb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLmN1cnZlVG86CiAgICAgICAgewogICAgICAgICAgY29uc3Qgc3RhcnRYID0gc3RhdGUuY3VycmVudFBvaW50WDsKICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHN0YXRlLmN1cnJlbnRQb2ludFk7CiAgICAgICAgICBjb25zdCBbeDEsIHkxLCB4MiwgeTIsIHgsIHldID0gYXJnczsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFggPSB4OwogICAgICAgICAgc3RhdGUuY3VycmVudFBvaW50WSA9IHk7CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5jdXJ2ZVRvLCB4MSwgeTEsIHgyLCB5MiwgeCwgeSk7CiAgICAgICAgICBVdGlsLmJlemllckJvdW5kaW5nQm94KHN0YXJ0WCwgc3RhcnRZLCB4MSwgeTEsIHgyLCB5MiwgeCwgeSwgbWluTWF4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSBPUFMuY3VydmVUbzI6CiAgICAgICAgewogICAgICAgICAgY29uc3Qgc3RhcnRYID0gc3RhdGUuY3VycmVudFBvaW50WDsKICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHN0YXRlLmN1cnJlbnRQb2ludFk7CiAgICAgICAgICBjb25zdCBbeDEsIHkxLCB4LCB5XSA9IGFyZ3M7CiAgICAgICAgICBzdGF0ZS5jdXJyZW50UG9pbnRYID0geDsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFkgPSB5OwogICAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMuY3VydmVUbywgc3RhcnRYLCBzdGFydFksIHgxLCB5MSwgeCwgeSk7CiAgICAgICAgICBVdGlsLmJlemllckJvdW5kaW5nQm94KHN0YXJ0WCwgc3RhcnRZLCBzdGFydFgsIHN0YXJ0WSwgeDEsIHkxLCB4LCB5LCBtaW5NYXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIE9QUy5jdXJ2ZVRvMzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBzdGFydFggPSBzdGF0ZS5jdXJyZW50UG9pbnRYOwogICAgICAgICAgY29uc3Qgc3RhcnRZID0gc3RhdGUuY3VycmVudFBvaW50WTsKICAgICAgICAgIGNvbnN0IFt4MSwgeTEsIHgsIHldID0gYXJnczsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFggPSB4OwogICAgICAgICAgc3RhdGUuY3VycmVudFBvaW50WSA9IHk7CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5jdXJ2ZVRvLCB4MSwgeTEsIHgsIHksIHgsIHkpOwogICAgICAgICAgVXRpbC5iZXppZXJCb3VuZGluZ0JveChzdGFydFgsIHN0YXJ0WSwgeDEsIHkxLCB4LCB5LCB4LCB5LCBtaW5NYXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIE9QUy5jbG9zZVBhdGg6CiAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMuY2xvc2VQYXRoKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgX2dldENvbG9yU3BhY2UoY3MsIHJlc291cmNlcywgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIHJldHVybiBDb2xvclNwYWNlVXRpbHMucGFyc2UoewogICAgICBjcywKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogdGhpcy5fcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGU6IHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgYXN5bmNJZk5vdENhY2hlZDogdHJ1ZQogICAgfSk7CiAgfQogIGFzeW5jIF9oYW5kbGVDb2xvclNwYWNlKGNzUHJvbWlzZSkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIGF3YWl0IGNzUHJvbWlzZTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBfaGFuZGxlQ29sb3JTcGFjZSAtIGlnbm9yaW5nIENvbG9yU3BhY2U6ICIke2V4fSIuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdGhyb3cgZXg7CiAgICB9CiAgfQogIHBhcnNlU2hhZGluZyh7CiAgICBzaGFkaW5nLAogICAgcmVzb3VyY2VzLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUKICB9KSB7CiAgICBsZXQgaWQgPSBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUuZ2V0KHNoYWRpbmcpOwogICAgaWYgKGlkKSB7CiAgICAgIHJldHVybiBpZDsKICAgIH0KICAgIGxldCBwYXR0ZXJuSVI7CiAgICB0cnkgewogICAgICBjb25zdCBzaGFkaW5nRmlsbCA9IFBhdHRlcm4ucGFyc2VTaGFkaW5nKHNoYWRpbmcsIHRoaXMueHJlZiwgcmVzb3VyY2VzLCB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksIHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLCBsb2NhbENvbG9yU3BhY2VDYWNoZSk7CiAgICAgIHBhdHRlcm5JUiA9IHNoYWRpbmdGaWxsLmdldElSKCk7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBwYXJzZVNoYWRpbmcgLSBpZ25vcmluZyBzaGFkaW5nOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUuc2V0KHNoYWRpbmcsIG51bGwpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0KICAgIGlkID0gYHBhdHRlcm5fJHt0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpfWA7CiAgICBpZiAodGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgIGlkID0gYCR7dGhpcy5pZEZhY3RvcnkuZ2V0RG9jSWQoKX1fdHlwZTNfJHtpZH1gOwogICAgfQogICAgbG9jYWxTaGFkaW5nUGF0dGVybkNhY2hlLnNldChzaGFkaW5nLCBpZCk7CiAgICBpZiAodGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgIGNvbnN0IHRyYW5zZmVycyA9IFtdOwogICAgICBjb25zdCBwYXR0ZXJuQnVmZmVyID0gUGF0dGVybkluZm8ud3JpdGUocGF0dGVybklSKTsKICAgICAgdHJhbnNmZXJzLnB1c2gocGF0dGVybkJ1ZmZlcik7CiAgICAgIHRoaXMuaGFuZGxlci5zZW5kKCJjb21tb25vYmoiLCBbaWQsICJQYXR0ZXJuIiwgcGF0dGVybkJ1ZmZlcl0sIHRyYW5zZmVycyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmhhbmRsZXIuc2VuZCgib2JqIiwgW2lkLCB0aGlzLnBhZ2VJbmRleCwgIlBhdHRlcm4iLCBwYXR0ZXJuSVJdKTsKICAgIH0KICAgIHJldHVybiBpZDsKICB9CiAgaGFuZGxlQ29sb3JOKG9wZXJhdG9yTGlzdCwgZm4sIGFyZ3MsIGNzLCBwYXR0ZXJucywgcmVzb3VyY2VzLCB0YXNrLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUsIGxvY2FsU2hhZGluZ1BhdHRlcm5DYWNoZSkgewogICAgY29uc3QgcGF0dGVybk5hbWUgPSBhcmdzLnBvcCgpOwogICAgaWYgKHBhdHRlcm5OYW1lIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBjb25zdCByYXdQYXR0ZXJuID0gcGF0dGVybnMuZ2V0UmF3KHBhdHRlcm5OYW1lLm5hbWUpOwogICAgICBjb25zdCBsb2NhbFRpbGluZ1BhdHRlcm4gPSByYXdQYXR0ZXJuIGluc3RhbmNlb2YgUmVmICYmIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLmdldEJ5UmVmKHJhd1BhdHRlcm4pOwogICAgICBpZiAobG9jYWxUaWxpbmdQYXR0ZXJuKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGNvbG9yID0gY3MuYmFzZSA/IGNzLmJhc2UuZ2V0UmdiSGV4KGFyZ3MsIDApIDogbnVsbDsKICAgICAgICAgIGNvbnN0IHRpbGluZ1BhdHRlcm5JUiA9IGdldFRpbGluZ1BhdHRlcm5JUihsb2NhbFRpbGluZ1BhdHRlcm4ub3BlcmF0b3JMaXN0SVIsIGxvY2FsVGlsaW5nUGF0dGVybi5kaWN0LCBjb2xvcik7CiAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIHRpbGluZ1BhdHRlcm5JUik7CiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0gY2F0Y2gge30KICAgICAgfQogICAgICBjb25zdCBwYXR0ZXJuID0gdGhpcy54cmVmLmZldGNoSWZSZWYocmF3UGF0dGVybik7CiAgICAgIGlmIChwYXR0ZXJuKSB7CiAgICAgICAgY29uc3QgZGljdCA9IHBhdHRlcm4gaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gcGF0dGVybi5kaWN0IDogcGF0dGVybjsKICAgICAgICBjb25zdCB0eXBlTnVtID0gZGljdC5nZXQoIlBhdHRlcm5UeXBlIik7CiAgICAgICAgaWYgKHR5cGVOdW0gPT09IFBhdHRlcm5UeXBlLlRJTElORykgewogICAgICAgICAgY29uc3QgY29sb3IgPSBjcy5iYXNlID8gY3MuYmFzZS5nZXRSZ2JIZXgoYXJncywgMCkgOiBudWxsOwogICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlVGlsaW5nVHlwZShmbiwgY29sb3IsIHJlc291cmNlcywgcGF0dGVybiwgZGljdCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlTnVtID09PSBQYXR0ZXJuVHlwZS5TSEFESU5HKSB7CiAgICAgICAgICBjb25zdCBzaGFkaW5nID0gZGljdC5nZXQoIlNoYWRpbmciKTsKICAgICAgICAgIGNvbnN0IG9iaklkID0gdGhpcy5wYXJzZVNoYWRpbmcoewogICAgICAgICAgICBzaGFkaW5nLAogICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKG9iaklkKSB7CiAgICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IGxvb2t1cE1hdHJpeChkaWN0LmdldEFycmF5KCJNYXRyaXgiKSwgbnVsbCk7CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChmbiwgWyJTaGFkaW5nIiwgb2JqSWQsIG1hdHJpeF0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIFBhdHRlcm5UeXBlOiAke3R5cGVOdW19YCk7CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5rbm93biBQYXR0ZXJuTmFtZTogJHtwYXR0ZXJuTmFtZX1gKTsKICB9CiAgX3BhcnNlVmlzaWJpbGl0eUV4cHJlc3Npb24oYXJyYXksIG5lc3RpbmdDb3VudGVyLCBjdXJyZW50UmVzdWx0KSB7CiAgICBjb25zdCBNQVhfTkVTVElORyA9IDEwOwogICAgaWYgKCsrbmVzdGluZ0NvdW50ZXIgPiBNQVhfTkVTVElORykgewogICAgICB3YXJuKCJWaXNpYmlsaXR5IGV4cHJlc3Npb24gaXMgdG9vIGRlZXBseSBuZXN0ZWQiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgY29uc3Qgb3BlcmF0b3IgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihhcnJheVswXSk7CiAgICBpZiAobGVuZ3RoIDwgMiB8fCAhKG9wZXJhdG9yIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgd2FybigiSW52YWxpZCB2aXNpYmlsaXR5IGV4cHJlc3Npb24iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3dpdGNoIChvcGVyYXRvci5uYW1lKSB7CiAgICAgIGNhc2UgIkFuZCI6CiAgICAgIGNhc2UgIk9yIjoKICAgICAgY2FzZSAiTm90IjoKICAgICAgICBjdXJyZW50UmVzdWx0LnB1c2gob3BlcmF0b3IubmFtZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgd2FybihgSW52YWxpZCBvcGVyYXRvciAke29wZXJhdG9yLm5hbWV9IGluIHZpc2liaWxpdHkgZXhwcmVzc2lvbmApOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgcmF3ID0gYXJyYXlbaV07CiAgICAgIGNvbnN0IG9iamVjdCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKHJhdyk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9iamVjdCkpIHsKICAgICAgICBjb25zdCBuZXN0ZWRSZXN1bHQgPSBbXTsKICAgICAgICBjdXJyZW50UmVzdWx0LnB1c2gobmVzdGVkUmVzdWx0KTsKICAgICAgICB0aGlzLl9wYXJzZVZpc2liaWxpdHlFeHByZXNzaW9uKG9iamVjdCwgbmVzdGluZ0NvdW50ZXIsIG5lc3RlZFJlc3VsdCk7CiAgICAgIH0gZWxzZSBpZiAocmF3IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgY3VycmVudFJlc3VsdC5wdXNoKHJhdy50b1N0cmluZygpKTsKICAgICAgfQogICAgfQogIH0KICBhc3luYyBwYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhjb250ZW50UHJvcGVydGllcywgcmVzb3VyY2VzKSB7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50OwogICAgaWYgKGNvbnRlbnRQcm9wZXJ0aWVzIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBjb25zdCBwcm9wZXJ0aWVzID0gcmVzb3VyY2VzLmdldCgiUHJvcGVydGllcyIpOwogICAgICBvcHRpb25hbENvbnRlbnQgPSBwcm9wZXJ0aWVzLmdldChjb250ZW50UHJvcGVydGllcy5uYW1lKTsKICAgIH0gZWxzZSBpZiAoY29udGVudFByb3BlcnRpZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIG9wdGlvbmFsQ29udGVudCA9IGNvbnRlbnRQcm9wZXJ0aWVzOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJPcHRpb25hbCBjb250ZW50IHByb3BlcnRpZXMgbWFsZm9ybWVkLiIpOwogICAgfQogICAgY29uc3Qgb3B0aW9uYWxDb250ZW50VHlwZSA9IG9wdGlvbmFsQ29udGVudC5nZXQoIlR5cGUiKT8ubmFtZTsKICAgIGlmIChvcHRpb25hbENvbnRlbnRUeXBlID09PSAiT0NHIikgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgaWQ6IG9wdGlvbmFsQ29udGVudC5vYmpJZAogICAgICB9OwogICAgfSBlbHNlIGlmIChvcHRpb25hbENvbnRlbnRUeXBlID09PSAiT0NNRCIpIHsKICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IG9wdGlvbmFsQ29udGVudC5nZXQoIlZFIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4cHJlc3Npb24pKSB7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgdGhpcy5fcGFyc2VWaXNpYmlsaXR5RXhwcmVzc2lvbihleHByZXNzaW9uLCAwLCByZXN1bHQpOwogICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogIk9DTUQiLAogICAgICAgICAgICBleHByZXNzaW9uOiByZXN1bHQKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IG9wdGlvbmFsQ29udGVudEdyb3VwcyA9IG9wdGlvbmFsQ29udGVudC5nZXQoIk9DR3MiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9uYWxDb250ZW50R3JvdXBzKSB8fCBvcHRpb25hbENvbnRlbnRHcm91cHMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgZ3JvdXBJZHMgPSBbXTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25hbENvbnRlbnRHcm91cHMpKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IG9jZyBvZiBvcHRpb25hbENvbnRlbnRHcm91cHMpIHsKICAgICAgICAgICAgZ3JvdXBJZHMucHVzaChvY2cudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGdyb3VwSWRzLnB1c2gob3B0aW9uYWxDb250ZW50R3JvdXBzLm9iaklkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgICBpZHM6IGdyb3VwSWRzLAogICAgICAgICAgcG9saWN5OiBvcHRpb25hbENvbnRlbnQuZ2V0KCJQIikgaW5zdGFuY2VvZiBOYW1lID8gb3B0aW9uYWxDb250ZW50LmdldCgiUCIpLm5hbWUgOiBudWxsLAogICAgICAgICAgZXhwcmVzc2lvbjogbnVsbAogICAgICAgIH07CiAgICAgIH0gZWxzZSBpZiAob3B0aW9uYWxDb250ZW50R3JvdXBzIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgICBpZDogb3B0aW9uYWxDb250ZW50R3JvdXBzLnRvU3RyaW5nKCkKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZ2V0T3BlcmF0b3JMaXN0KHsKICAgIHN0cmVhbSwKICAgIHRhc2ssCiAgICByZXNvdXJjZXMsCiAgICBvcGVyYXRvckxpc3QsCiAgICBpbml0aWFsU3RhdGUgPSBudWxsLAogICAgZmFsbGJhY2tGb250RGljdCA9IG51bGwsCiAgICBwcmV2UmVmcyA9IG51bGwKICB9KSB7CiAgICBjb25zdCBvYmpJZCA9IHN0cmVhbS5kaWN0Py5vYmpJZDsKICAgIGNvbnN0IHNlZW5SZWZzID0gbmV3IFJlZlNldChwcmV2UmVmcyk7CiAgICBpZiAob2JqSWQpIHsKICAgICAgaWYgKHByZXZSZWZzPy5oYXMob2JqSWQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBjaXJjdWxhciByZWZlcmVuY2U6ICR7b2JqSWR9YCk7CiAgICAgIH0KICAgICAgc2VlblJlZnMucHV0KG9iaklkKTsKICAgIH0KICAgIHJlc291cmNlcyB8fD0gRGljdC5lbXB0eTsKICAgIGluaXRpYWxTdGF0ZSB8fD0gbmV3IEV2YWxTdGF0ZSgpOwogICAgaWYgKCFvcGVyYXRvckxpc3QpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRPcGVyYXRvckxpc3Q6IG1pc3NpbmcgIm9wZXJhdG9yTGlzdCIgcGFyYW1ldGVyJyk7CiAgICB9CiAgICBjb25zdCBzZWxmID0gdGhpczsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBjb25zdCBsb2NhbEltYWdlQ2FjaGUgPSBuZXcgTG9jYWxJbWFnZUNhY2hlKCk7CiAgICBjb25zdCBsb2NhbENvbG9yU3BhY2VDYWNoZSA9IG5ldyBMb2NhbENvbG9yU3BhY2VDYWNoZSgpOwogICAgY29uc3QgbG9jYWxHU3RhdGVDYWNoZSA9IG5ldyBMb2NhbEdTdGF0ZUNhY2hlKCk7CiAgICBjb25zdCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSA9IG5ldyBMb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSgpOwogICAgY29uc3QgbG9jYWxTaGFkaW5nUGF0dGVybkNhY2hlID0gbmV3IE1hcCgpOwogICAgY29uc3QgeG9ianMgPSByZXNvdXJjZXMuZ2V0KCJYT2JqZWN0IikgfHwgRGljdC5lbXB0eTsKICAgIGNvbnN0IHBhdHRlcm5zID0gcmVzb3VyY2VzLmdldCgiUGF0dGVybiIpIHx8IERpY3QuZW1wdHk7CiAgICBjb25zdCBzdGF0ZU1hbmFnZXIgPSBuZXcgU3RhdGVNYW5hZ2VyKGluaXRpYWxTdGF0ZSk7CiAgICBjb25zdCBwcmVwcm9jZXNzb3IgPSBuZXcgRXZhbHVhdG9yUHJlcHJvY2Vzc29yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyKTsKICAgIGNvbnN0IHRpbWVTbG90TWFuYWdlciA9IG5ldyBUaW1lU2xvdE1hbmFnZXIoKTsKICAgIGZ1bmN0aW9uIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoYXJndW1lbnQpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcHJlcHJvY2Vzc29yLnNhdmVkU3RhdGVzRGVwdGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5yZXN0b3JlLCBbXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiBwcm9taXNlQm9keShyZXNvbHZlLCByZWplY3QpIHsKICAgICAgY29uc3QgbmV4dCA9IGZ1bmN0aW9uIChwcm9taXNlKSB7CiAgICAgICAgUHJvbWlzZS5hbGwoW3Byb21pc2UsIG9wZXJhdG9yTGlzdC5yZWFkeV0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcHJvbWlzZUJvZHkocmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIHJlamVjdChleCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgcmVqZWN0KTsKICAgICAgfTsKICAgICAgdGFzay5lbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgIHRpbWVTbG90TWFuYWdlci5yZXNldCgpOwogICAgICBjb25zdCBvcGVyYXRpb24gPSB7fTsKICAgICAgbGV0IHN0b3AsIGksIGlpLCBjcywgbmFtZSwgaXNWYWxpZE5hbWU7CiAgICAgIHdoaWxlICghKHN0b3AgPSB0aW1lU2xvdE1hbmFnZXIuY2hlY2soKSkpIHsKICAgICAgICBvcGVyYXRpb24uYXJncyA9IG51bGw7CiAgICAgICAgaWYgKCFwcmVwcm9jZXNzb3IucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbGV0IGFyZ3MgPSBvcGVyYXRpb24uYXJnczsKICAgICAgICBsZXQgZm4gPSBvcGVyYXRpb24uZm47CiAgICAgICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgICAgIGNhc2UgT1BTLnBhaW50WE9iamVjdDoKICAgICAgICAgICAgaXNWYWxpZE5hbWUgPSBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZTsKICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKICAgICAgICAgICAgaWYgKGlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeU5hbWUobmFtZSk7CiAgICAgICAgICAgICAgaWYgKGxvY2FsSW1hZ2UpIHsKICAgICAgICAgICAgICAgIGFkZENhY2hlZEltYWdlT3BzKG9wZXJhdG9yTGlzdCwgbG9jYWxJbWFnZSk7CiAgICAgICAgICAgICAgICBhcmdzID0gbnVsbDsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlWE9iamVjdCwgcmVqZWN0WE9iamVjdCkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiWE9iamVjdCBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCB4b2JqID0geG9ianMuZ2V0UmF3KG5hbWUpOwogICAgICAgICAgICAgIGlmICh4b2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYWNoZWRJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeVJlZih4b2JqKSB8fCBzZWxmLl9yZWdpb25hbEltYWdlQ2FjaGUuZ2V0QnlSZWYoeG9iaikgfHwgc2VsZi5nbG9iYWxJbWFnZUNhY2hlLmdldERhdGEoeG9iaiwgc2VsZi5wYWdlSW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGNhY2hlZEltYWdlKSB7CiAgICAgICAgICAgICAgICAgIGFkZENhY2hlZEltYWdlT3BzKG9wZXJhdG9yTGlzdCwgY2FjaGVkSW1hZ2UpOwogICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4b2JqID0geHJlZi5mZXRjaCh4b2JqKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCEoeG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGJlIGEgc3RyZWFtIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB4b2JqLmRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGhhdmUgYSBOYW1lIHN1YnR5cGUiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHR5cGUubmFtZSA9PT0gIkZvcm0iKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc2F2ZSgpOwogICAgICAgICAgICAgICAgc2VsZi5idWlsZEZvcm1YT2JqZWN0KHJlc291cmNlcywgeG9iaiwgbnVsbCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoewogICAgICAgICAgICAgICAgICBuZXdQYXRoOiB0cnVlCiAgICAgICAgICAgICAgICB9KSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgIH0sIHJlamVjdFhPYmplY3QpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZS5uYW1lID09PSAiSW1hZ2UiKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgIGltYWdlOiB4b2JqLAogICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgICBsb2NhbEltYWdlQ2FjaGUsCiAgICAgICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgICAgICB9KS50aGVuKHJlc29sdmVYT2JqZWN0LCByZWplY3RYT2JqZWN0KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUubmFtZSA9PT0gIlBTIikgewogICAgICAgICAgICAgICAgaW5mbygiSWdub3JlZCBYT2JqZWN0IHN1YnR5cGUgUFMiKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmhhbmRsZWQgWE9iamVjdCBzdWJ0eXBlICR7dHlwZS5uYW1lfWApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBYT2JqZWN0OiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNhc2UgT1BTLnNldEZvbnQ6CiAgICAgICAgICAgIGNvbnN0IGZvbnRTaXplID0gYXJnc1sxXTsKICAgICAgICAgICAgbmV4dChzZWxmLmhhbmRsZVNldEZvbnQocmVzb3VyY2VzLCBhcmdzLCBudWxsLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlTWFuYWdlci5zdGF0ZSwgZmFsbGJhY2tGb250RGljdCkudGhlbihmdW5jdGlvbiAobG9hZGVkTmFtZSkgewogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmN5KGxvYWRlZE5hbWUpOwogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuc2V0Rm9udCwgW2xvYWRlZE5hbWUsIGZvbnRTaXplXSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuZW5kSW5saW5lSW1hZ2U6CiAgICAgICAgICAgIGNvbnN0IGNhY2hlS2V5ID0gYXJnc1swXS5jYWNoZUtleTsKICAgICAgICAgICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeU5hbWUoY2FjaGVLZXkpOwogICAgICAgICAgICAgIGlmIChsb2NhbEltYWdlKSB7CiAgICAgICAgICAgICAgICBhZGRDYWNoZWRJbWFnZU9wcyhvcGVyYXRvckxpc3QsIGxvY2FsSW1hZ2UpOwogICAgICAgICAgICAgICAgYXJncyA9IG51bGw7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dChzZWxmLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICBpbWFnZTogYXJnc1swXSwKICAgICAgICAgICAgICBpc0lubGluZTogdHJ1ZSwKICAgICAgICAgICAgICBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgY2FjaGVLZXksCiAgICAgICAgICAgICAgbG9jYWxJbWFnZUNhY2hlLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuc2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3NbMF0gPSBzZWxmLmhhbmRsZVRleHQoYXJnc1swXSwgc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaG93U3BhY2VkVGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY29tYmluZWRHbHlwaHMgPSBbXSwKICAgICAgICAgICAgICBzdGF0ZSA9IHN0YXRlTWFuYWdlci5zdGF0ZTsKICAgICAgICAgICAgZm9yIChjb25zdCBhcnJJdGVtIG9mIGFyZ3NbMF0pIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyckl0ZW0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKC4uLnNlbGYuaGFuZGxlVGV4dChhcnJJdGVtLCBzdGF0ZSkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyckl0ZW0gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKGFyckl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhcmdzWzBdID0gY29tYmluZWRHbHlwaHM7CiAgICAgICAgICAgIGZuID0gT1BTLnNob3dUZXh0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMubmV4dExpbmUpOwogICAgICAgICAgICBhcmdzWzBdID0gc2VsZi5oYW5kbGVUZXh0KGFyZ3NbMF0sIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgIGZuID0gT1BTLnNob3dUZXh0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLm5leHRMaW5lKTsKICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5zZXRXb3JkU3BhY2luZywgW2FyZ3Muc2hpZnQoKV0pOwogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnNldENoYXJTcGFjaW5nLCBbYXJncy5zaGlmdCgpXSk7CiAgICAgICAgICAgIGFyZ3NbMF0gPSBzZWxmLmhhbmRsZVRleHQoYXJnc1swXSwgc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgZm4gPSBPUFMuc2hvd1RleHQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0VGV4dFJlbmRlcmluZ01vZGU6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS50ZXh0UmVuZGVyaW5nTW9kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENvbG9yU3BhY2U6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zdCBmaWxsQ1MgPSBzZWxmLl9nZXRDb2xvclNwYWNlKGFyZ3NbMF0sIHJlc291cmNlcywgbG9jYWxDb2xvclNwYWNlQ2FjaGUpOwogICAgICAgICAgICAgIGlmIChmaWxsQ1MgaW5zdGFuY2VvZiBDb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuZmlsbENvbG9yU3BhY2UgPSBmaWxsQ1M7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbmV4dChzZWxmLl9oYW5kbGVDb2xvclNwYWNlKGZpbGxDUykudGhlbihjb2xvclNwYWNlID0+IHsKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2UgfHwgQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3JTcGFjZToKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHN0cm9rZUNTID0gc2VsZi5fZ2V0Q29sb3JTcGFjZShhcmdzWzBdLCByZXNvdXJjZXMsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICAgICAgICBpZiAoc3Ryb2tlQ1MgaW5zdGFuY2VvZiBDb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZSA9IHN0cm9rZUNTOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG5leHQoc2VsZi5faGFuZGxlQ29sb3JTcGFjZShzdHJva2VDUykudGhlbihjb2xvclNwYWNlID0+IHsKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gY29sb3JTcGFjZSB8fCBDb2xvclNwYWNlVXRpbHMuZ3JheTsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ29sb3I6CiAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlOwogICAgICAgICAgICBhcmdzID0gW2NzLmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgIGZuID0gT1BTLnNldEZpbGxSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VDb2xvcjoKICAgICAgICAgICAgY3MgPSBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZTsKICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsR3JheToKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUdyYXk6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0U3Ryb2tlUkdCQ29sb3I7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENNWUtDb2xvcjoKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmNteWs7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUNNWUtDb2xvcjoKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLnN0cm9rZUNvbG9yU3BhY2UgPSBDb2xvclNwYWNlVXRpbHMuY215azsKICAgICAgICAgICAgYXJncyA9IFtDb2xvclNwYWNlVXRpbHMuY215ay5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsUkdCQ29sb3I6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5yZ2I7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZVJHQkNvbG9yOgogICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5yZ2I7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxDb2xvck46CiAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLnBhdHRlcm5GaWxsQ29sb3JTcGFjZTsKICAgICAgICAgICAgaWYgKCFjcykgewogICAgICAgICAgICAgIGlmIChpc051bWJlckFycmF5KGFyZ3MsIG51bGwpKSB7CiAgICAgICAgICAgICAgICBhcmdzID0gW0NvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgICAgICBmbiA9IE9QUy5zZXRGaWxsUkdCQ29sb3I7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYXJncyA9IFtdOwogICAgICAgICAgICAgIGZuID0gT1BTLnNldEZpbGxUcmFuc3BhcmVudDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY3MubmFtZSA9PT0gIlBhdHRlcm4iKSB7CiAgICAgICAgICAgICAgbmV4dChzZWxmLmhhbmRsZUNvbG9yTihvcGVyYXRvckxpc3QsIE9QUy5zZXRGaWxsQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaywgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRGaWxsUkdCQ29sb3I7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3JOOgogICAgICAgICAgICBjcyA9IHN0YXRlTWFuYWdlci5zdGF0ZS5wYXR0ZXJuU3Ryb2tlQ29sb3JTcGFjZTsKICAgICAgICAgICAgaWYgKCFjcykgewogICAgICAgICAgICAgIGlmIChpc051bWJlckFycmF5KGFyZ3MsIG51bGwpKSB7CiAgICAgICAgICAgICAgICBhcmdzID0gW0NvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhcmdzID0gW107CiAgICAgICAgICAgICAgZm4gPSBPUFMuc2V0U3Ryb2tlVHJhbnNwYXJlbnQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNzLm5hbWUgPT09ICJQYXR0ZXJuIikgewogICAgICAgICAgICAgIG5leHQoc2VsZi5oYW5kbGVDb2xvck4ob3BlcmF0b3JMaXN0LCBPUFMuc2V0U3Ryb2tlQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaywgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaGFkaW5nRmlsbDoKICAgICAgICAgICAgbGV0IHNoYWRpbmc7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY29uc3Qgc2hhZGluZ1JlcyA9IHJlc291cmNlcy5nZXQoIlNoYWRpbmciKTsKICAgICAgICAgICAgICBpZiAoIXNoYWRpbmdSZXMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gc2hhZGluZyByZXNvdXJjZSBmb3VuZCIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzaGFkaW5nID0gc2hhZGluZ1Jlcy5nZXQoYXJnc1swXS5uYW1lKTsKICAgICAgICAgICAgICBpZiAoIXNoYWRpbmcpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gc2hhZGluZyBvYmplY3QgZm91bmQiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBTaGFkaW5nOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcGF0dGVybklkID0gc2VsZi5wYXJzZVNoYWRpbmcoewogICAgICAgICAgICAgIHNoYWRpbmcsCiAgICAgICAgICAgICAgcmVzb3VyY2VzLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICAgIGxvY2FsU2hhZGluZ1BhdHRlcm5DYWNoZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKCFwYXR0ZXJuSWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhcmdzID0gW3BhdHRlcm5JZF07CiAgICAgICAgICAgIGZuID0gT1BTLnNoYWRpbmdGaWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEdTdGF0ZToKICAgICAgICAgICAgaXNWYWxpZE5hbWUgPSBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZTsKICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKICAgICAgICAgICAgaWYgKGlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxHU3RhdGVPYmogPSBsb2NhbEdTdGF0ZUNhY2hlLmdldEJ5TmFtZShuYW1lKTsKICAgICAgICAgICAgICBpZiAobG9jYWxHU3RhdGVPYmopIHsKICAgICAgICAgICAgICAgIGlmIChsb2NhbEdTdGF0ZU9iai5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuc2V0R1N0YXRlLCBbbG9jYWxHU3RhdGVPYmpdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFyZ3MgPSBudWxsOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHQobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmVHU3RhdGUsIHJlamVjdEdTdGF0ZSkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiR1N0YXRlIG11c3QgYmUgcmVmZXJyZWQgdG8gYnkgbmFtZS4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZXh0R1N0YXRlID0gcmVzb3VyY2VzLmdldCgiRXh0R1N0YXRlIik7CiAgICAgICAgICAgICAgaWYgKCEoZXh0R1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRXh0R1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGdTdGF0ZSA9IGV4dEdTdGF0ZS5nZXQobmFtZSk7CiAgICAgICAgICAgICAgaWYgKCEoZ1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiR1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNlbGYuc2V0R1N0YXRlKHsKICAgICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICAgIGdTdGF0ZSwKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdCwKICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgdGFzaywKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlciwKICAgICAgICAgICAgICAgIGxvY2FsR1N0YXRlQ2FjaGUsCiAgICAgICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICAgICAgICAgIHNlZW5SZWZzCiAgICAgICAgICAgICAgfSkudGhlbihyZXNvbHZlR1N0YXRlLCByZWplY3RHU3RhdGUpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBFeHRHU3RhdGU6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuc2V0TGluZVdpZHRoOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgW3RoaWNrbmVzc10gPSBhcmdzOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpY2tuZXNzICE9PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgd2FybihgSW52YWxpZCBzZXRMaW5lV2lkdGg6ICR7dGhpY2tuZXNzfWApOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFyZ3NbMF0gPSBNYXRoLmFicyh0aGlja25lc3MpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5zZXREYXNoOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgZGFzaFBoYXNlID0gYXJnc1sxXTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhc2hQaGFzZSAhPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIHdhcm4oYEludmFsaWQgc2V0RGFzaDogJHtkYXNoUGhhc2V9YCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZGFzaEFycmF5ID0gYXJnc1swXTsKICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGFzaEFycmF5KSkgewogICAgICAgICAgICAgICAgd2FybihgSW52YWxpZCBzZXREYXNoOiAke2Rhc2hBcnJheX1gKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZGFzaEFycmF5LnNvbWUoeCA9PiB0eXBlb2YgeCAhPT0gIm51bWJlciIpKSB7CiAgICAgICAgICAgICAgICBhcmdzWzBdID0gZGFzaEFycmF5LmZpbHRlcih4ID0+IHR5cGVvZiB4ID09PSAibnVtYmVyIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5tb3ZlVG86CiAgICAgICAgICBjYXNlIE9QUy5saW5lVG86CiAgICAgICAgICBjYXNlIE9QUy5jdXJ2ZVRvOgogICAgICAgICAgY2FzZSBPUFMuY3VydmVUbzI6CiAgICAgICAgICBjYXNlIE9QUy5jdXJ2ZVRvMzoKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlUGF0aDoKICAgICAgICAgIGNhc2UgT1BTLnJlY3RhbmdsZToKICAgICAgICAgICAgc2VsZi5idWlsZFBhdGgoZm4sIGFyZ3MsIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSBPUFMuc3Ryb2tlOgogICAgICAgICAgY2FzZSBPUFMuY2xvc2VTdHJva2U6CiAgICAgICAgICBjYXNlIE9QUy5maWxsOgogICAgICAgICAgY2FzZSBPUFMuZW9GaWxsOgogICAgICAgICAgY2FzZSBPUFMuZmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmVvRmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlRmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlRU9GaWxsU3Ryb2tlOgogICAgICAgICAgY2FzZSBPUFMuZW5kUGF0aDoKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIHN0YXRlOiB7CiAgICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIsCiAgICAgICAgICAgICAgICAgIHBhdGhNaW5NYXgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9ID0gc3RhdGVNYW5hZ2VyOwogICAgICAgICAgICAgIGlmIChmbiA9PT0gT1BTLmNsb3NlU3Ryb2tlIHx8IGZuID09PSBPUFMuY2xvc2VGaWxsU3Ryb2tlIHx8IGZuID09PSBPUFMuY2xvc2VFT0ZpbGxTdHJva2UpIHsKICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIucHVzaChEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChwYXRoQnVmZmVyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5jb25zdHJ1Y3RQYXRoLCBbZm4sIFtudWxsXSwgbnVsbF0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmNvbnN0cnVjdFBhdGgsIFtmbiwgW25ldyBGbG9hdDMyQXJyYXkocGF0aEJ1ZmZlcildLCBwYXRoTWluTWF4LnNsaWNlKCldKTsKICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgIHBhdGhNaW5NYXguc2V0KFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XSwgMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5zZXRUZXh0TWF0cml4OgogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIFtuZXcgRmxvYXQzMkFycmF5KGFyZ3MpXSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSBPUFMubWFya1BvaW50OgogICAgICAgICAgY2FzZSBPUFMubWFya1BvaW50UHJvcHM6CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbkNvbXBhdDoKICAgICAgICAgIGNhc2UgT1BTLmVuZENvbXBhdDoKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wczoKICAgICAgICAgICAgaWYgKCEoYXJnc1swXSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgd2FybihgRXhwZWN0ZWQgbmFtZSBmb3IgYmVnaW5NYXJrZWRDb250ZW50UHJvcHMgYXJnMD0ke2FyZ3NbMF19YCk7CiAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG51bGxdKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJnc1swXS5uYW1lID09PSAiT0MiKSB7CiAgICAgICAgICAgICAgbmV4dChzZWxmLnBhcnNlTWFya2VkQ29udGVudFByb3BzKGFyZ3NbMV0sIHJlc291cmNlcykudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBkYXRhXSk7CiAgICAgICAgICAgICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBiZWdpbk1hcmtlZENvbnRlbnRQcm9wczogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBudWxsXSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3MgPSBbYXJnc1swXS5uYW1lLCBhcmdzWzFdIGluc3RhbmNlb2YgRGljdCA/IGFyZ3NbMV0uZ2V0KCJNQ0lEIikgOiBudWxsXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbk1hcmtlZENvbnRlbnQ6CiAgICAgICAgICBjYXNlIE9QUy5lbmRNYXJrZWRDb250ZW50OgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgaWYgKGFyZ3MgIT09IG51bGwpIHsKICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGFyZ3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGFyZ3NbaV0gaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoaSA8IGlpKSB7CiAgICAgICAgICAgICAgICB3YXJuKCJnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBvcGVyYXRvcjogIiArIGZuKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIGFyZ3MpOwogICAgICB9CiAgICAgIGlmIChzdG9wKSB7CiAgICAgICAgbmV4dChkZWZlcnJlZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoKTsKICAgICAgcmVzb2x2ZSgpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgd2FybihgZ2V0T3BlcmF0b3JMaXN0IC0gaWdub3JpbmcgZXJyb3JzIGR1cmluZyAiJHt0YXNrLm5hbWV9IiBgICsgYHRhc2s6ICIke3JlYXNvbn0iLmApOwogICAgICAgIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhyb3cgcmVhc29uOwogICAgfSk7CiAgfQogIGdldFRleHRDb250ZW50KHsKICAgIHN0cmVhbSwKICAgIHRhc2ssCiAgICByZXNvdXJjZXMsCiAgICBzdGF0ZU1hbmFnZXIgPSBudWxsLAogICAgaW5jbHVkZU1hcmtlZENvbnRlbnQgPSBmYWxzZSwKICAgIHNpbmssCiAgICBzZWVuU3R5bGVzID0gbmV3IFNldCgpLAogICAgdmlld0JveCwKICAgIGxhbmcgPSBudWxsLAogICAgbWFya2VkQ29udGVudERhdGEgPSBudWxsLAogICAgZGlzYWJsZU5vcm1hbGl6YXRpb24gPSBmYWxzZSwKICAgIGtlZXBXaGl0ZVNwYWNlID0gZmFsc2UsCiAgICBwcmV2UmVmcyA9IG51bGwsCiAgICBpbnRlcnNlY3RvciA9IG51bGwKICB9KSB7CiAgICBjb25zdCBvYmpJZCA9IHN0cmVhbS5kaWN0Py5vYmpJZDsKICAgIGNvbnN0IHNlZW5SZWZzID0gbmV3IFJlZlNldChwcmV2UmVmcyk7CiAgICBpZiAob2JqSWQpIHsKICAgICAgaWYgKHByZXZSZWZzPy5oYXMob2JqSWQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBnZXRUZXh0Q29udGVudCAtIGlnbm9yaW5nIGNpcmN1bGFyIHJlZmVyZW5jZTogJHtvYmpJZH1gKTsKICAgICAgfQogICAgICBzZWVuUmVmcy5wdXQob2JqSWQpOwogICAgfQogICAgcmVzb3VyY2VzIHx8PSBEaWN0LmVtcHR5OwogICAgc3RhdGVNYW5hZ2VyIHx8PSBuZXcgU3RhdGVNYW5hZ2VyKG5ldyBUZXh0U3RhdGUoKSk7CiAgICBpZiAoaW5jbHVkZU1hcmtlZENvbnRlbnQpIHsKICAgICAgbWFya2VkQ29udGVudERhdGEgfHw9IHsKICAgICAgICBsZXZlbDogMAogICAgICB9OwogICAgfQogICAgY29uc3QgdGV4dENvbnRlbnQgPSB7CiAgICAgIGl0ZW1zOiBbXSwKICAgICAgc3R5bGVzOiBPYmplY3QuY3JlYXRlKG51bGwpLAogICAgICBsYW5nCiAgICB9OwogICAgY29uc3QgdGV4dENvbnRlbnRJdGVtID0gewogICAgICBpbml0aWFsaXplZDogZmFsc2UsCiAgICAgIHN0cjogW10sCiAgICAgIHRvdGFsV2lkdGg6IDAsCiAgICAgIHRvdGFsSGVpZ2h0OiAwLAogICAgICB3aWR0aDogMCwKICAgICAgaGVpZ2h0OiAwLAogICAgICB2ZXJ0aWNhbDogZmFsc2UsCiAgICAgIHByZXZUcmFuc2Zvcm06IG51bGwsCiAgICAgIHRleHRBZHZhbmNlU2NhbGU6IDAsCiAgICAgIHNwYWNlSW5GbG93TWluOiAwLAogICAgICBzcGFjZUluRmxvd01heDogMCwKICAgICAgdHJhY2tpbmdTcGFjZU1pbjogSW5maW5pdHksCiAgICAgIG5lZ2F0aXZlU3BhY2VNYXg6IC1JbmZpbml0eSwKICAgICAgbm90QVNwYWNlOiAtSW5maW5pdHksCiAgICAgIHRyYW5zZm9ybTogbnVsbCwKICAgICAgZm9udE5hbWU6IG51bGwsCiAgICAgIGhhc0VPTDogZmFsc2UKICAgIH07CiAgICBjb25zdCB0d29MYXN0Q2hhcnMgPSBbIiAiLCAiICJdOwogICAgbGV0IHR3b0xhc3RDaGFyc1BvcyA9IDA7CiAgICBmdW5jdGlvbiBzYXZlTGFzdENoYXIoY2hhcikgewogICAgICBjb25zdCBuZXh0UG9zID0gKHR3b0xhc3RDaGFyc1BvcyArIDEpICUgMjsKICAgICAgY29uc3QgcmV0ID0gdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gIT09ICIgIiAmJiB0d29MYXN0Q2hhcnNbbmV4dFBvc10gPT09ICIgIjsKICAgICAgdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gPSBjaGFyOwogICAgICB0d29MYXN0Q2hhcnNQb3MgPSBuZXh0UG9zOwogICAgICByZXR1cm4gIWtlZXBXaGl0ZVNwYWNlICYmIHJldDsKICAgIH0KICAgIGZ1bmN0aW9uIHNob3VsZEFkZFdoaXRlcHNhY2UoKSB7CiAgICAgIHJldHVybiAha2VlcFdoaXRlU3BhY2UgJiYgdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gIT09ICIgIiAmJiB0d29MYXN0Q2hhcnNbKHR3b0xhc3RDaGFyc1BvcyArIDEpICUgMl0gPT09ICIgIjsKICAgIH0KICAgIGZ1bmN0aW9uIHJlc2V0TGFzdENoYXJzKCkgewogICAgICB0d29MYXN0Q2hhcnNbMF0gPSB0d29MYXN0Q2hhcnNbMV0gPSAiICI7CiAgICAgIHR3b0xhc3RDaGFyc1BvcyA9IDA7CiAgICB9CiAgICBjb25zdCBUUkFDS0lOR19TUEFDRV9GQUNUT1IgPSAwLjEwMjsKICAgIGNvbnN0IE5PVF9BX1NQQUNFX0ZBQ1RPUiA9IDAuMDM7CiAgICBjb25zdCBORUdBVElWRV9TUEFDRV9GQUNUT1IgPSAtMC4yOwogICAgY29uc3QgU1BBQ0VfSU5fRkxPV19NSU5fRkFDVE9SID0gMC4xMDI7CiAgICBjb25zdCBTUEFDRV9JTl9GTE9XX01BWF9GQUNUT1IgPSAwLjY7CiAgICBjb25zdCBWRVJUSUNBTF9TSElGVF9SQVRJTyA9IDAuMjU7CiAgICBjb25zdCBzZWxmID0gdGhpczsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBjb25zdCBzaG93U3BhY2VkVGV4dEJ1ZmZlciA9IFtdOwogICAgbGV0IHhvYmpzID0gbnVsbDsKICAgIGNvbnN0IGVtcHR5WE9iamVjdENhY2hlID0gbmV3IExvY2FsSW1hZ2VDYWNoZSgpOwogICAgY29uc3QgZW1wdHlHU3RhdGVDYWNoZSA9IG5ldyBMb2NhbEdTdGF0ZUNhY2hlKCk7CiAgICBjb25zdCBwcmVwcm9jZXNzb3IgPSBuZXcgRXZhbHVhdG9yUHJlcHJvY2Vzc29yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyKTsKICAgIGxldCB0ZXh0U3RhdGU7CiAgICBmdW5jdGlvbiBwdXNoV2hpdGVzcGFjZSh7CiAgICAgIHdpZHRoID0gMCwKICAgICAgaGVpZ2h0ID0gMCwKICAgICAgdHJhbnNmb3JtID0gdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0sCiAgICAgIGZvbnROYW1lID0gdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lCiAgICB9KSB7CiAgICAgIGludGVyc2VjdG9yPy5hZGRFeHRyYUNoYXIoIiAiKTsKICAgICAgdGV4dENvbnRlbnQuaXRlbXMucHVzaCh7CiAgICAgICAgc3RyOiAiICIsCiAgICAgICAgZGlyOiAibHRyIiwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgdHJhbnNmb3JtLAogICAgICAgIGZvbnROYW1lLAogICAgICAgIGhhc0VPTDogZmFsc2UKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpIHsKICAgICAgY29uc3QgZm9udCA9IHRleHRTdGF0ZS5mb250OwogICAgICBjb25zdCB0c20gPSBbdGV4dFN0YXRlLmZvbnRTaXplICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDAsIDAsIHRleHRTdGF0ZS5mb250U2l6ZSwgMCwgdGV4dFN0YXRlLnRleHRSaXNlXTsKICAgICAgaWYgKGZvbnQuaXNUeXBlM0ZvbnQgJiYgKHRleHRTdGF0ZS5mb250U2l6ZSA8PSAxIHx8IGZvbnQuaXNDaGFyQkJveCkgJiYgIWlzQXJyYXlFcXVhbCh0ZXh0U3RhdGUuZm9udE1hdHJpeCwgRk9OVF9JREVOVElUWV9NQVRSSVgpKSB7CiAgICAgICAgY29uc3QgZ2x5cGhIZWlnaHQgPSBmb250LmJib3hbM10gLSBmb250LmJib3hbMV07CiAgICAgICAgaWYgKGdseXBoSGVpZ2h0ID4gMCkgewogICAgICAgICAgdHNtWzNdICo9IGdseXBoSGVpZ2h0ICogdGV4dFN0YXRlLmZvbnRNYXRyaXhbM107CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBVdGlsLnRyYW5zZm9ybSh0ZXh0U3RhdGUuY3RtLCBVdGlsLnRyYW5zZm9ybSh0ZXh0U3RhdGUudGV4dE1hdHJpeCwgdHNtKSk7CiAgICB9CiAgICBmdW5jdGlvbiBlbnN1cmVUZXh0Q29udGVudEl0ZW0oKSB7CiAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICByZXR1cm4gdGV4dENvbnRlbnRJdGVtOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBmb250LAogICAgICAgIGxvYWRlZE5hbWUKICAgICAgfSA9IHRleHRTdGF0ZTsKICAgICAgaWYgKCFzZWVuU3R5bGVzLmhhcyhsb2FkZWROYW1lKSkgewogICAgICAgIHNlZW5TdHlsZXMuYWRkKGxvYWRlZE5hbWUpOwogICAgICAgIHRleHRDb250ZW50LnN0eWxlc1tsb2FkZWROYW1lXSA9IHsKICAgICAgICAgIGZvbnRGYW1pbHk6IGZvbnQuZmFsbGJhY2tOYW1lLAogICAgICAgICAgYXNjZW50OiBmb250LmFzY2VudCwKICAgICAgICAgIGRlc2NlbnQ6IGZvbnQuZGVzY2VudCwKICAgICAgICAgIHZlcnRpY2FsOiBmb250LnZlcnRpY2FsCiAgICAgICAgfTsKICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmZvbnRFeHRyYVByb3BlcnRpZXMgJiYgZm9udC5zeXN0ZW1Gb250SW5mbykgewogICAgICAgICAgY29uc3Qgc3R5bGUgPSB0ZXh0Q29udGVudC5zdHlsZXNbbG9hZGVkTmFtZV07CiAgICAgICAgICBzdHlsZS5mb250U3Vic3RpdHV0aW9uID0gZm9udC5zeXN0ZW1Gb250SW5mby5jc3M7CiAgICAgICAgICBzdHlsZS5mb250U3Vic3RpdHV0aW9uTG9hZGVkTmFtZSA9IGZvbnQuc3lzdGVtRm9udEluZm8ubG9hZGVkTmFtZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lID0gbG9hZGVkTmFtZTsKICAgICAgY29uc3QgdHJtID0gdGV4dENvbnRlbnRJdGVtLnRyYW5zZm9ybSA9IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCk7CiAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgIHRleHRDb250ZW50SXRlbS53aWR0aCA9IHRleHRDb250ZW50SXRlbS50b3RhbFdpZHRoID0gMDsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ID0gTWF0aC5oeXBvdCh0cm1bMl0sIHRybVszXSk7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLnZlcnRpY2FsID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLndpZHRoID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsV2lkdGggPSBNYXRoLmh5cG90KHRybVswXSwgdHJtWzFdKTsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ID0gMDsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udmVydGljYWwgPSB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IHNjYWxlTGluZVggPSBNYXRoLmh5cG90KHRleHRTdGF0ZS50ZXh0TGluZU1hdHJpeFswXSwgdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzFdKTsKICAgICAgY29uc3Qgc2NhbGVDdG1YID0gTWF0aC5oeXBvdCh0ZXh0U3RhdGUuY3RtWzBdLCB0ZXh0U3RhdGUuY3RtWzFdKTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUN0bVggKiBzY2FsZUxpbmVYOwogICAgICBjb25zdCB7CiAgICAgICAgZm9udFNpemUKICAgICAgfSA9IHRleHRTdGF0ZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnRyYWNraW5nU3BhY2VNaW4gPSBmb250U2l6ZSAqIFRSQUNLSU5HX1NQQUNFX0ZBQ1RPUjsKICAgICAgdGV4dENvbnRlbnRJdGVtLm5vdEFTcGFjZSA9IGZvbnRTaXplICogTk9UX0FfU1BBQ0VfRkFDVE9SOwogICAgICB0ZXh0Q29udGVudEl0ZW0ubmVnYXRpdmVTcGFjZU1heCA9IGZvbnRTaXplICogTkVHQVRJVkVfU1BBQ0VfRkFDVE9SOwogICAgICB0ZXh0Q29udGVudEl0ZW0uc3BhY2VJbkZsb3dNaW4gPSBmb250U2l6ZSAqIFNQQUNFX0lOX0ZMT1dfTUlOX0ZBQ1RPUjsKICAgICAgdGV4dENvbnRlbnRJdGVtLnNwYWNlSW5GbG93TWF4ID0gZm9udFNpemUgKiBTUEFDRV9JTl9GTE9XX01BWF9GQUNUT1I7CiAgICAgIHRleHRDb250ZW50SXRlbS5oYXNFT0wgPSBmYWxzZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRleHRDb250ZW50SXRlbTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZUFkdmFuY2VTY2FsZSgpIHsKICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgc2NhbGVMaW5lWCA9IE1hdGguaHlwb3QodGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzBdLCB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXhbMV0pOwogICAgICBjb25zdCBzY2FsZUN0bVggPSBNYXRoLmh5cG90KHRleHRTdGF0ZS5jdG1bMF0sIHRleHRTdGF0ZS5jdG1bMV0pOwogICAgICBjb25zdCBzY2FsZUZhY3RvciA9IHNjYWxlQ3RtWCAqIHNjYWxlTGluZVg7CiAgICAgIGlmIChzY2FsZUZhY3RvciA9PT0gdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0udmVydGljYWwpIHsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udG90YWxXaWR0aCArPSB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKiB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRleHRDb250ZW50SXRlbS50b3RhbEhlaWdodCArPSB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICogdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCA9IDA7CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUZhY3RvcjsKICAgIH0KICAgIGZ1bmN0aW9uIHJ1bkJpZGlUcmFuc2Zvcm0odGV4dENodW5rKSB7CiAgICAgIGxldCB0ZXh0ID0gdGV4dENodW5rLnN0ci5qb2luKCIiKTsKICAgICAgaWYgKCFkaXNhYmxlTm9ybWFsaXphdGlvbikgewogICAgICAgIHRleHQgPSBub3JtYWxpemVVbmljb2RlKHRleHQpOwogICAgICB9CiAgICAgIGNvbnN0IGJpZGlSZXN1bHQgPSBiaWRpKHRleHQsIC0xLCB0ZXh0Q2h1bmsudmVydGljYWwpOwogICAgICByZXR1cm4gewogICAgICAgIHN0cjogYmlkaVJlc3VsdC5zdHIsCiAgICAgICAgZGlyOiBiaWRpUmVzdWx0LmRpciwKICAgICAgICB3aWR0aDogTWF0aC5hYnModGV4dENodW5rLnRvdGFsV2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5hYnModGV4dENodW5rLnRvdGFsSGVpZ2h0KSwKICAgICAgICB0cmFuc2Zvcm06IHRleHRDaHVuay50cmFuc2Zvcm0sCiAgICAgICAgZm9udE5hbWU6IHRleHRDaHVuay5mb250TmFtZSwKICAgICAgICBoYXNFT0w6IHRleHRDaHVuay5oYXNFT0wKICAgICAgfTsKICAgIH0KICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNldEZvbnQoZm9udE5hbWUsIGZvbnRSZWYpIHsKICAgICAgY29uc3QgdHJhbnNsYXRlZCA9IGF3YWl0IHNlbGYubG9hZEZvbnQoZm9udE5hbWUsIGZvbnRSZWYsIHJlc291cmNlcywgdGFzayk7CiAgICAgIHRleHRTdGF0ZS5sb2FkZWROYW1lID0gdHJhbnNsYXRlZC5sb2FkZWROYW1lOwogICAgICB0ZXh0U3RhdGUuZm9udCA9IHRyYW5zbGF0ZWQuZm9udDsKICAgICAgdGV4dFN0YXRlLmZvbnRNYXRyaXggPSB0cmFuc2xhdGVkLmZvbnQuZm9udE1hdHJpeCB8fCBGT05UX0lERU5USVRZX01BVFJJWDsKICAgIH0KICAgIGZ1bmN0aW9uIGFwcGx5SW52ZXJzZVJvdGF0aW9uKHgsIHksIG1hdHJpeCkgewogICAgICBjb25zdCBzY2FsZSA9IE1hdGguaHlwb3QobWF0cml4WzBdLCBtYXRyaXhbMV0pOwogICAgICByZXR1cm4gWyhtYXRyaXhbMF0gKiB4ICsgbWF0cml4WzFdICogeSkgLyBzY2FsZSwgKG1hdHJpeFsyXSAqIHggKyBtYXRyaXhbM10gKiB5KSAvIHNjYWxlXTsKICAgIH0KICAgIGZ1bmN0aW9uIGNvbXBhcmVXaXRoTGFzdFBvc2l0aW9uKGdseXBoV2lkdGgpIHsKICAgICAgY29uc3QgY3VycmVudFRyYW5zZm9ybSA9IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCk7CiAgICAgIGxldCBwb3NYID0gY3VycmVudFRyYW5zZm9ybVs0XTsKICAgICAgbGV0IHBvc1kgPSBjdXJyZW50VHJhbnNmb3JtWzVdOwogICAgICBpZiAodGV4dFN0YXRlLmZvbnQ/LnZlcnRpY2FsKSB7CiAgICAgICAgaWYgKHBvc1ggPCB2aWV3Qm94WzBdIHx8IHBvc1ggPiB2aWV3Qm94WzJdIHx8IHBvc1kgKyBnbHlwaFdpZHRoIDwgdmlld0JveFsxXSB8fCBwb3NZID4gdmlld0JveFszXSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwb3NYICsgZ2x5cGhXaWR0aCA8IHZpZXdCb3hbMF0gfHwgcG9zWCA+IHZpZXdCb3hbMl0gfHwgcG9zWSA8IHZpZXdCb3hbMV0gfHwgcG9zWSA+IHZpZXdCb3hbM10pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCF0ZXh0U3RhdGUuZm9udCB8fCAhdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0pIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBsZXQgbGFzdFBvc1ggPSB0ZXh0Q29udGVudEl0ZW0ucHJldlRyYW5zZm9ybVs0XTsKICAgICAgbGV0IGxhc3RQb3NZID0gdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm1bNV07CiAgICAgIGlmIChsYXN0UG9zWCA9PT0gcG9zWCAmJiBsYXN0UG9zWSA9PT0gcG9zWSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGxldCByb3RhdGUgPSAtMTsKICAgICAgaWYgKGN1cnJlbnRUcmFuc2Zvcm1bMF0gJiYgY3VycmVudFRyYW5zZm9ybVsxXSA9PT0gMCAmJiBjdXJyZW50VHJhbnNmb3JtWzJdID09PSAwKSB7CiAgICAgICAgcm90YXRlID0gY3VycmVudFRyYW5zZm9ybVswXSA+IDAgPyAwIDogMTgwOwogICAgICB9IGVsc2UgaWYgKGN1cnJlbnRUcmFuc2Zvcm1bMV0gJiYgY3VycmVudFRyYW5zZm9ybVswXSA9PT0gMCAmJiBjdXJyZW50VHJhbnNmb3JtWzNdID09PSAwKSB7CiAgICAgICAgcm90YXRlID0gY3VycmVudFRyYW5zZm9ybVsxXSA+IDAgPyA5MCA6IDI3MDsKICAgICAgfQogICAgICBzd2l0Y2ggKHJvdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgOTA6CiAgICAgICAgICBbcG9zWCwgcG9zWV0gPSBbcG9zWSwgcG9zWF07CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFtsYXN0UG9zWSwgbGFzdFBvc1hdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxODA6CiAgICAgICAgICBbcG9zWCwgcG9zWSwgbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFstcG9zWCwgLXBvc1ksIC1sYXN0UG9zWCwgLWxhc3RQb3NZXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjcwOgogICAgICAgICAgW3Bvc1gsIHBvc1ldID0gWy1wb3NZLCAtcG9zWF07CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFstbGFzdFBvc1ksIC1sYXN0UG9zWF07CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgW3Bvc1gsIHBvc1ldID0gYXBwbHlJbnZlcnNlUm90YXRpb24ocG9zWCwgcG9zWSwgY3VycmVudFRyYW5zZm9ybSk7CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IGFwcGx5SW52ZXJzZVJvdGF0aW9uKGxhc3RQb3NYLCBsYXN0UG9zWSwgdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0pOwogICAgICB9CiAgICAgIGlmICh0ZXh0U3RhdGUuZm9udC52ZXJ0aWNhbCkgewogICAgICAgIGNvbnN0IGFkdmFuY2VZID0gKGxhc3RQb3NZIC0gcG9zWSkgLyB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgICBjb25zdCBhZHZhbmNlWCA9IHBvc1ggLSBsYXN0UG9zWDsKICAgICAgICBjb25zdCB0ZXh0T3JpZW50YXRpb24gPSBNYXRoLnNpZ24odGV4dENvbnRlbnRJdGVtLmhlaWdodCk7CiAgICAgICAgaWYgKGFkdmFuY2VZIDwgdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLm5lZ2F0aXZlU3BhY2VNYXgpIHsKICAgICAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWCkgPiAwLjUgKiB0ZXh0Q29udGVudEl0ZW0ud2lkdGgpIHsKICAgICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VYKSA+IHRleHRDb250ZW50SXRlbS53aWR0aCkgewogICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFkdmFuY2VZIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5ub3RBU3BhY2UpIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChhZHZhbmNlWSA8PSB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0udHJhY2tpbmdTcGFjZU1pbikgewogICAgICAgICAgaWYgKHNob3VsZEFkZFdoaXRlcHNhY2UoKSkgewogICAgICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmFicyhhZHZhbmNlWSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICs9IGFkdmFuY2VZOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWFkZEZha2VTcGFjZXMoYWR2YW5jZVksIHRleHRDb250ZW50SXRlbS5wcmV2VHJhbnNmb3JtLCB0ZXh0T3JpZW50YXRpb24pKSB7CiAgICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLnN0ci5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgICAgcHVzaFdoaXRlc3BhY2UoewogICAgICAgICAgICAgIGhlaWdodDogTWF0aC5hYnMoYWR2YW5jZVkpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCArPSBhZHZhbmNlWTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VYKSA+IHRleHRDb250ZW50SXRlbS53aWR0aCAqIFZFUlRJQ0FMX1NISUZUX1JBVElPKSB7CiAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBjb25zdCBhZHZhbmNlWCA9IChwb3NYIC0gbGFzdFBvc1gpIC8gdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgIGNvbnN0IGFkdmFuY2VZID0gcG9zWSAtIGxhc3RQb3NZOwogICAgICBjb25zdCB0ZXh0T3JpZW50YXRpb24gPSBNYXRoLnNpZ24odGV4dENvbnRlbnRJdGVtLndpZHRoKTsKICAgICAgaWYgKGFkdmFuY2VYIDwgdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLm5lZ2F0aXZlU3BhY2VNYXgpIHsKICAgICAgICBpZiAoTWF0aC5hYnMoYWR2YW5jZVkpID4gMC41ICogdGV4dENvbnRlbnRJdGVtLmhlaWdodCkgewogICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWSkgPiB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0KSB7CiAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKGFkdmFuY2VYIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5ub3RBU3BhY2UpIHsKICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICB9CiAgICAgIGlmIChhZHZhbmNlWCA8PSB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0udHJhY2tpbmdTcGFjZU1pbikgewogICAgICAgIGlmIChzaG91bGRBZGRXaGl0ZXBzYWNlKCkpIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgcHVzaFdoaXRlc3BhY2UoewogICAgICAgICAgICB3aWR0aDogTWF0aC5hYnMoYWR2YW5jZVgpCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGV4dENvbnRlbnRJdGVtLndpZHRoICs9IGFkdmFuY2VYOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghYWRkRmFrZVNwYWNlcyhhZHZhbmNlWCwgdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0sIHRleHRPcmllbnRhdGlvbikpIHsKICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLnN0ci5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmFicyhhZHZhbmNlWCkKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKz0gYWR2YW5jZVg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWSkgPiB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICogVkVSVElDQUxfU0hJRlRfUkFUSU8pIHsKICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICBjaGFycywKICAgICAgZXh0cmFTcGFjaW5nCiAgICB9KSB7CiAgICAgIGNvbnN0IGZvbnQgPSB0ZXh0U3RhdGUuZm9udDsKICAgICAgaWYgKCFjaGFycykgewogICAgICAgIGNvbnN0IGNoYXJTcGFjaW5nID0gdGV4dFN0YXRlLmNoYXJTcGFjaW5nICsgZXh0cmFTcGFjaW5nOwogICAgICAgIGlmIChjaGFyU3BhY2luZykgewogICAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KGNoYXJTcGFjaW5nICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgLWNoYXJTcGFjaW5nKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGtlZXBXaGl0ZVNwYWNlKSB7CiAgICAgICAgICBjb21wYXJlV2l0aExhc3RQb3NpdGlvbigwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGdseXBocyA9IGZvbnQuY2hhcnNUb0dseXBocyhjaGFycyk7CiAgICAgIGNvbnN0IHNjYWxlID0gdGV4dFN0YXRlLmZvbnRNYXRyaXhbMF0gKiB0ZXh0U3RhdGUuZm9udFNpemU7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGdseXBocy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgZ2x5cGggPSBnbHlwaHNbaV07CiAgICAgICAgY29uc3QgewogICAgICAgICAgY2F0ZWdvcnksCiAgICAgICAgICBvcmlnaW5hbENoYXJDb2RlCiAgICAgICAgfSA9IGdseXBoOwogICAgICAgIGlmIChjYXRlZ29yeS5pc0ludmlzaWJsZUZvcm1hdE1hcmspIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsZXQgY2hhclNwYWNpbmcgPSB0ZXh0U3RhdGUuY2hhclNwYWNpbmcgKyAoaSArIDEgPT09IGlpID8gZXh0cmFTcGFjaW5nIDogMCk7CiAgICAgICAgbGV0IGdseXBoV2lkdGggPSBnbHlwaC53aWR0aDsKICAgICAgICBpZiAoZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgZ2x5cGhXaWR0aCA9IGdseXBoLnZtZXRyaWMgPyBnbHlwaC52bWV0cmljWzBdIDogLWdseXBoV2lkdGg7CiAgICAgICAgfQogICAgICAgIGxldCBzY2FsZWREaW0gPSBnbHlwaFdpZHRoICogc2NhbGU7CiAgICAgICAgaWYgKG9yaWdpbmFsQ2hhckNvZGUgPT09IDB4MjApIHsKICAgICAgICAgIGNoYXJTcGFjaW5nICs9IHRleHRTdGF0ZS53b3JkU3BhY2luZzsKICAgICAgICB9CiAgICAgICAgaWYgKCFrZWVwV2hpdGVTcGFjZSAmJiBjYXRlZ29yeS5pc1doaXRlc3BhY2UpIHsKICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICBjaGFyU3BhY2luZyArPSBzY2FsZWREaW07CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KGNoYXJTcGFjaW5nICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhclNwYWNpbmcgKz0gLXNjYWxlZERpbTsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgLWNoYXJTcGFjaW5nKTsKICAgICAgICAgIH0KICAgICAgICAgIHNhdmVMYXN0Q2hhcigiICIpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghY2F0ZWdvcnkuaXNaZXJvV2lkdGhEaWFjcml0aWMgJiYgIWNvbXBhcmVXaXRoTGFzdFBvc2l0aW9uKHNjYWxlZERpbSkpIHsKICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeChzY2FsZWREaW0gKiB0ZXh0U3RhdGUudGV4dEhTY2FsZSwgMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeCgwLCBzY2FsZWREaW0pOwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHRleHRDaHVuayA9IGVuc3VyZVRleHRDb250ZW50SXRlbSgpOwogICAgICAgIGlmIChjYXRlZ29yeS5pc1plcm9XaWR0aERpYWNyaXRpYykgewogICAgICAgICAgc2NhbGVkRGltID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICBzY2FsZWREaW0gKj0gdGV4dFN0YXRlLnRleHRIU2NhbGU7CiAgICAgICAgICBpbnRlcnNlY3Rvcj8uYWRkR2x5cGgoZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKSwgc2NhbGVkRGltLCAwLCBnbHlwaC51bmljb2RlKTsKICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KHNjYWxlZERpbSwgMCk7CiAgICAgICAgICB0ZXh0Q2h1bmsud2lkdGggKz0gc2NhbGVkRGltOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpbnRlcnNlY3Rvcj8uYWRkR2x5cGgoZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKSwgMCwgc2NhbGVkRGltLCBnbHlwaC51bmljb2RlKTsKICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KDAsIHNjYWxlZERpbSk7CiAgICAgICAgICBzY2FsZWREaW0gPSBNYXRoLmFicyhzY2FsZWREaW0pOwogICAgICAgICAgdGV4dENodW5rLmhlaWdodCArPSBzY2FsZWREaW07CiAgICAgICAgfQogICAgICAgIGlmIChzY2FsZWREaW0pIHsKICAgICAgICAgIHRleHRDaHVuay5wcmV2VHJhbnNmb3JtID0gZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZ2x5cGhVbmljb2RlID0gZ2x5cGgudW5pY29kZTsKICAgICAgICBpZiAoc2F2ZUxhc3RDaGFyKGdseXBoVW5pY29kZSkpIHsKICAgICAgICAgIHRleHRDaHVuay5zdHIucHVzaCgiICIpOwogICAgICAgICAgaW50ZXJzZWN0b3I/LmFkZEV4dHJhQ2hhcigiICIpOwogICAgICAgIH0KICAgICAgICBpZiAoIWludGVyc2VjdG9yKSB7CiAgICAgICAgICB0ZXh0Q2h1bmsuc3RyLnB1c2goZ2x5cGhVbmljb2RlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNoYXJTcGFjaW5nKSB7CiAgICAgICAgICBpZiAoIWZvbnQudmVydGljYWwpIHsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoY2hhclNwYWNpbmcgKiB0ZXh0U3RhdGUudGV4dEhTY2FsZSwgMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeCgwLCAtY2hhclNwYWNpbmcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYXBwZW5kRU9MKCkgewogICAgICBpbnRlcnNlY3Rvcj8uYWRkRXh0cmFDaGFyKCJcbiIpOwogICAgICByZXNldExhc3RDaGFycygpOwogICAgICBpZiAodGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkKSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhhc0VPTCA9IHRydWU7CiAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHsKICAgICAgICAgIHN0cjogIiIsCiAgICAgICAgICBkaXI6ICJsdHIiLAogICAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICB0cmFuc2Zvcm06IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCksCiAgICAgICAgICBmb250TmFtZTogdGV4dFN0YXRlLmxvYWRlZE5hbWUsCiAgICAgICAgICBoYXNFT0w6IHRydWUKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYWRkRmFrZVNwYWNlcyh3aWR0aCwgdHJhbnNmLCB0ZXh0T3JpZW50YXRpb24pIHsKICAgICAgaWYgKHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5zcGFjZUluRmxvd01pbiA8PSB3aWR0aCAmJiB3aWR0aCA8PSB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0uc3BhY2VJbkZsb3dNYXgpIHsKICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkKSB7CiAgICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICAgICAgdGV4dENvbnRlbnRJdGVtLnN0ci5wdXNoKCIgIik7CiAgICAgICAgICBpbnRlcnNlY3Rvcj8uYWRkRXh0cmFDaGFyKCIgIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBmb250TmFtZSA9IHRleHRDb250ZW50SXRlbS5mb250TmFtZTsKICAgICAgbGV0IGhlaWdodCA9IDA7CiAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0udmVydGljYWwpIHsKICAgICAgICBoZWlnaHQgPSB3aWR0aDsKICAgICAgICB3aWR0aCA9IDA7CiAgICAgIH0KICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgcHVzaFdoaXRlc3BhY2UoewogICAgICAgIHdpZHRoOiBNYXRoLmFicyh3aWR0aCksCiAgICAgICAgaGVpZ2h0OiBNYXRoLmFicyhoZWlnaHQpLAogICAgICAgIHRyYW5zZm9ybTogdHJhbnNmIHx8IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCksCiAgICAgICAgZm9udE5hbWUKICAgICAgfSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gZmx1c2hUZXh0Q29udGVudEl0ZW0oKSB7CiAgICAgIGlmICghdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkIHx8ICF0ZXh0Q29udGVudEl0ZW0uc3RyKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghdGV4dENvbnRlbnRJdGVtLnZlcnRpY2FsKSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLnRvdGFsV2lkdGggKz0gdGV4dENvbnRlbnRJdGVtLndpZHRoICogdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ICs9IHRleHRDb250ZW50SXRlbS5oZWlnaHQgKiB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgfQogICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHJ1bkJpZGlUcmFuc2Zvcm0odGV4dENvbnRlbnRJdGVtKSk7CiAgICAgIHRleHRDb250ZW50SXRlbS5pbml0aWFsaXplZCA9IGZhbHNlOwogICAgICB0ZXh0Q29udGVudEl0ZW0uc3RyLmxlbmd0aCA9IDA7CiAgICB9CiAgICBmdW5jdGlvbiBlbnF1ZXVlQ2h1bmsoYmF0Y2ggPSBmYWxzZSkgewogICAgICBjb25zdCBsZW5ndGggPSB0ZXh0Q29udGVudC5pdGVtcy5sZW5ndGg7CiAgICAgIGlmIChsZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGJhdGNoICYmIGxlbmd0aCA8IFRFWFRfQ0hVTktfQkFUQ0hfU0laRSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBzaW5rPy5lbnF1ZXVlKHRleHRDb250ZW50LCBsZW5ndGgpOwogICAgICB0ZXh0Q29udGVudC5pdGVtcyA9IFtdOwogICAgICB0ZXh0Q29udGVudC5zdHlsZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQogICAgY29uc3QgdGltZVNsb3RNYW5hZ2VyID0gbmV3IFRpbWVTbG90TWFuYWdlcigpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCkgewogICAgICBjb25zdCBuZXh0ID0gZnVuY3Rpb24gKHByb21pc2UpIHsKICAgICAgICBlbnF1ZXVlQ2h1bmsodHJ1ZSk7CiAgICAgICAgUHJvbWlzZS5hbGwoW3Byb21pc2UsIHNpbms/LnJlYWR5XSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBwcm9taXNlQm9keShyZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgcmVqZWN0KGV4KTsKICAgICAgICAgIH0KICAgICAgICB9LCByZWplY3QpOwogICAgICB9OwogICAgICB0YXNrLmVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgdGltZVNsb3RNYW5hZ2VyLnJlc2V0KCk7CiAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IHt9OwogICAgICBsZXQgc3RvcCwKICAgICAgICBuYW1lLAogICAgICAgIGlzVmFsaWROYW1lLAogICAgICAgIGFyZ3MgPSBbXTsKICAgICAgd2hpbGUgKCEoc3RvcCA9IHRpbWVTbG90TWFuYWdlci5jaGVjaygpKSkgewogICAgICAgIGFyZ3MubGVuZ3RoID0gMDsKICAgICAgICBvcGVyYXRpb24uYXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKCFwcmVwcm9jZXNzb3IucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0ZSA9IHRleHRTdGF0ZTsKICAgICAgICB0ZXh0U3RhdGUgPSBzdGF0ZU1hbmFnZXIuc3RhdGU7CiAgICAgICAgY29uc3QgZm4gPSBvcGVyYXRpb24uZm47CiAgICAgICAgYXJncyA9IG9wZXJhdGlvbi5hcmdzOwogICAgICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGb250OgogICAgICAgICAgICBjb25zdCBmb250TmFtZUFyZyA9IGFyZ3NbMF0ubmFtZSwKICAgICAgICAgICAgICBmb250U2l6ZUFyZyA9IGFyZ3NbMV07CiAgICAgICAgICAgIGlmICh0ZXh0U3RhdGUuZm9udCAmJiBmb250TmFtZUFyZyA9PT0gdGV4dFN0YXRlLmZvbnROYW1lICYmIGZvbnRTaXplQXJnID09PSB0ZXh0U3RhdGUuZm9udFNpemUpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICB0ZXh0U3RhdGUuZm9udE5hbWUgPSBmb250TmFtZUFyZzsKICAgICAgICAgICAgdGV4dFN0YXRlLmZvbnRTaXplID0gZm9udFNpemVBcmc7CiAgICAgICAgICAgIG5leHQoaGFuZGxlU2V0Rm9udChmb250TmFtZUFyZywgbnVsbCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjYXNlIE9QUy5zZXRUZXh0UmlzZToKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRSaXNlID0gYXJnc1swXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRIU2NhbGU6CiAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0SFNjYWxlID0gYXJnc1swXSAvIDEwMDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRMZWFkaW5nOgogICAgICAgICAgICB0ZXh0U3RhdGUubGVhZGluZyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMubW92ZVRleHQ6CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TGluZU1hdHJpeChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRNYXRyaXggPSB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXguc2xpY2UoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRMZWFkaW5nTW92ZVRleHQ6CiAgICAgICAgICAgIHRleHRTdGF0ZS5sZWFkaW5nID0gLWFyZ3NbMV07CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TGluZU1hdHJpeChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRNYXRyaXggPSB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXguc2xpY2UoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5uZXh0TGluZToKICAgICAgICAgICAgdGV4dFN0YXRlLmNhcnJpYWdlUmV0dXJuKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0VGV4dE1hdHJpeDoKICAgICAgICAgICAgdGV4dFN0YXRlLnNldFRleHRNYXRyaXgoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSwgYXJnc1s0XSwgYXJnc1s1XSk7CiAgICAgICAgICAgIHRleHRTdGF0ZS5zZXRUZXh0TGluZU1hdHJpeChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdLCBhcmdzWzVdKTsKICAgICAgICAgICAgdXBkYXRlQWR2YW5jZVNjYWxlKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0Q2hhclNwYWNpbmc6CiAgICAgICAgICAgIHRleHRTdGF0ZS5jaGFyU3BhY2luZyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0V29yZFNwYWNpbmc6CiAgICAgICAgICAgIHRleHRTdGF0ZS53b3JkU3BhY2luZyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuYmVnaW5UZXh0OgogICAgICAgICAgICB0ZXh0U3RhdGUudGV4dE1hdHJpeCA9IElERU5USVRZX01BVFJJWC5zbGljZSgpOwogICAgICAgICAgICB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXggPSBJREVOVElUWV9NQVRSSVguc2xpY2UoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaG93U3BhY2VkVGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc3BhY2VGYWN0b3IgPSAodGV4dFN0YXRlLmZvbnQudmVydGljYWwgPyAxIDogLTEpICogdGV4dFN0YXRlLmZvbnRTaXplIC8gMTAwMDsKICAgICAgICAgICAgY29uc3QgZWxlbWVudHMgPSBhcmdzWzBdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGVsZW1lbnRzW2ldOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgIHNob3dTcGFjZWRUZXh0QnVmZmVyLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaXRlbSA9PT0gIm51bWJlciIgJiYgaXRlbSAhPT0gMCkgewogICAgICAgICAgICAgICAgY29uc3Qgc3RyID0gc2hvd1NwYWNlZFRleHRCdWZmZXIuam9pbigiIik7CiAgICAgICAgICAgICAgICBzaG93U3BhY2VkVGV4dEJ1ZmZlci5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICAgICAgICAgICAgICBjaGFyczogc3RyLAogICAgICAgICAgICAgICAgICBleHRyYVNwYWNpbmc6IGl0ZW0gKiBzcGFjZUZhY3RvcgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzaG93U3BhY2VkVGV4dEJ1ZmZlci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29uc3Qgc3RyID0gc2hvd1NwYWNlZFRleHRCdWZmZXIuam9pbigiIik7CiAgICAgICAgICAgICAgc2hvd1NwYWNlZFRleHRCdWZmZXIubGVuZ3RoID0gMDsKICAgICAgICAgICAgICBidWlsZFRleHRDb250ZW50SXRlbSh7CiAgICAgICAgICAgICAgICBjaGFyczogc3RyLAogICAgICAgICAgICAgICAgZXh0cmFTcGFjaW5nOiAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaG93VGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICAgICAgICAgIGNoYXJzOiBhcmdzWzBdLAogICAgICAgICAgICAgIGV4dHJhU3BhY2luZzogMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5uZXh0TGluZVNob3dUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0ZXh0U3RhdGUuY2FycmlhZ2VSZXR1cm4oKTsKICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICAgICAgICAgIGNoYXJzOiBhcmdzWzBdLAogICAgICAgICAgICAgIGV4dHJhU3BhY2luZzogMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5uZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGV4dFN0YXRlLndvcmRTcGFjaW5nID0gYXJnc1swXTsKICAgICAgICAgICAgdGV4dFN0YXRlLmNoYXJTcGFjaW5nID0gYXJnc1sxXTsKICAgICAgICAgICAgdGV4dFN0YXRlLmNhcnJpYWdlUmV0dXJuKCk7CiAgICAgICAgICAgIGJ1aWxkVGV4dENvbnRlbnRJdGVtKHsKICAgICAgICAgICAgICBjaGFyczogYXJnc1syXSwKICAgICAgICAgICAgICBleHRyYVNwYWNpbmc6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMucGFpbnRYT2JqZWN0OgogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICB4b2JqcyA/Pz0gcmVzb3VyY2VzLmdldCgiWE9iamVjdCIpIHx8IERpY3QuZW1wdHk7CiAgICAgICAgICAgIGlzVmFsaWROYW1lID0gYXJnc1swXSBpbnN0YW5jZW9mIE5hbWU7CiAgICAgICAgICAgIG5hbWUgPSBhcmdzWzBdLm5hbWU7CiAgICAgICAgICAgIGlmIChpc1ZhbGlkTmFtZSAmJiBlbXB0eVhPYmplY3RDYWNoZS5nZXRCeU5hbWUobmFtZSkpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlWE9iamVjdCwgcmVqZWN0WE9iamVjdCkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiWE9iamVjdCBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCB4b2JqID0geG9ianMuZ2V0UmF3KG5hbWUpOwogICAgICAgICAgICAgIGlmICh4b2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgICBpZiAoZW1wdHlYT2JqZWN0Q2FjaGUuZ2V0QnlSZWYoeG9iaikpIHsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgZ2xvYmFsSW1hZ2UgPSBzZWxmLmdsb2JhbEltYWdlQ2FjaGUuZ2V0RGF0YSh4b2JqLCBzZWxmLnBhZ2VJbmRleCk7CiAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsSW1hZ2UpIHsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeG9iaiA9IHhyZWYuZmV0Y2goeG9iaik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICghKHhvYmogaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJYT2JqZWN0IHNob3VsZCBiZSBhIHN0cmVhbSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgICBkaWN0CiAgICAgICAgICAgICAgfSA9IHhvYmo7CiAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGhhdmUgYSBOYW1lIHN1YnR5cGUiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHR5cGUubmFtZSAhPT0gIkZvcm0iKSB7CiAgICAgICAgICAgICAgICBlbXB0eVhPYmplY3RDYWNoZS5zZXQobmFtZSwgZGljdC5vYmpJZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U3RhdGUgPSBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoKTsKICAgICAgICAgICAgICBjb25zdCB4T2JqU3RhdGVNYW5hZ2VyID0gbmV3IFN0YXRlTWFuYWdlcihjdXJyZW50U3RhdGUpOwogICAgICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IGxvb2t1cE1hdHJpeChkaWN0LmdldEFycmF5KCJNYXRyaXgiKSwgbnVsbCk7CiAgICAgICAgICAgICAgaWYgKG1hdHJpeCkgewogICAgICAgICAgICAgICAgeE9ialN0YXRlTWFuYWdlci50cmFuc2Zvcm0obWF0cml4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxSZXNvdXJjZXMgPSBkaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICAgICAgICAgICAgZW5xdWV1ZUNodW5rKCk7CiAgICAgICAgICAgICAgY29uc3Qgc2lua1dyYXBwZXIgPSB7CiAgICAgICAgICAgICAgICBlbnF1ZXVlSW52b2tlZDogZmFsc2UsCiAgICAgICAgICAgICAgICBlbnF1ZXVlKGNodW5rLCBzaXplKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZW5xdWV1ZUludm9rZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzaW5rLmVucXVldWUoY2h1bmssIHNpemUpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldCBkZXNpcmVkU2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpbmsuZGVzaXJlZFNpemUgPz8gMDsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXQgcmVhZHkoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzaW5rLnJlYWR5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgc2VsZi5nZXRUZXh0Q29udGVudCh7CiAgICAgICAgICAgICAgICBzdHJlYW06IHhvYmosCiAgICAgICAgICAgICAgICB0YXNrLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBsb2NhbFJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QgPyBsb2NhbFJlc291cmNlcyA6IHJlc291cmNlcywKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlcjogeE9ialN0YXRlTWFuYWdlciwKICAgICAgICAgICAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50LAogICAgICAgICAgICAgICAgc2luazogc2luayAmJiBzaW5rV3JhcHBlciwKICAgICAgICAgICAgICAgIHNlZW5TdHlsZXMsCiAgICAgICAgICAgICAgICB2aWV3Qm94LAogICAgICAgICAgICAgICAgbGFuZywKICAgICAgICAgICAgICAgIG1hcmtlZENvbnRlbnREYXRhLAogICAgICAgICAgICAgICAgZGlzYWJsZU5vcm1hbGl6YXRpb24sCiAgICAgICAgICAgICAgICBrZWVwV2hpdGVTcGFjZSwKICAgICAgICAgICAgICAgIHByZXZSZWZzOiBzZWVuUmVmcwogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCFzaW5rV3JhcHBlci5lbnF1ZXVlSW52b2tlZCkgewogICAgICAgICAgICAgICAgICBlbXB0eVhPYmplY3RDYWNoZS5zZXQobmFtZSwgZGljdC5vYmpJZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgIH0sIHJlamVjdFhPYmplY3QpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRUZXh0Q29udGVudCAtIGlnbm9yaW5nIFhPYmplY3Q6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuc2V0R1N0YXRlOgogICAgICAgICAgICBpc1ZhbGlkTmFtZSA9IGFyZ3NbMF0gaW5zdGFuY2VvZiBOYW1lOwogICAgICAgICAgICBuYW1lID0gYXJnc1swXS5uYW1lOwogICAgICAgICAgICBpZiAoaXNWYWxpZE5hbWUgJiYgZW1wdHlHU3RhdGVDYWNoZS5nZXRCeU5hbWUobmFtZSkpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlR1N0YXRlLCByZWplY3RHU3RhdGUpIHsKICAgICAgICAgICAgICBpZiAoIWlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkdTdGF0ZSBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGV4dEdTdGF0ZSA9IHJlc291cmNlcy5nZXQoIkV4dEdTdGF0ZSIpOwogICAgICAgICAgICAgIGlmICghKGV4dEdTdGF0ZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkV4dEdTdGF0ZSBzaG91bGQgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBnU3RhdGUgPSBleHRHU3RhdGUuZ2V0KG5hbWUpOwogICAgICAgICAgICAgIGlmICghKGdTdGF0ZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkdTdGF0ZSBzaG91bGQgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBnU3RhdGVGb250ID0gZ1N0YXRlLmdldCgiRm9udCIpOwogICAgICAgICAgICAgIGlmICghZ1N0YXRlRm9udCkgewogICAgICAgICAgICAgICAgZW1wdHlHU3RhdGVDYWNoZS5zZXQobmFtZSwgZ1N0YXRlLm9iaklkLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJlc29sdmVHU3RhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgICB0ZXh0U3RhdGUuZm9udE5hbWUgPSBudWxsOwogICAgICAgICAgICAgIHRleHRTdGF0ZS5mb250U2l6ZSA9IGdTdGF0ZUZvbnRbMV07CiAgICAgICAgICAgICAgaGFuZGxlU2V0Rm9udChudWxsLCBnU3RhdGVGb250WzBdKS50aGVuKHJlc29sdmVHU3RhdGUsIHJlamVjdEdTdGF0ZSk7CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgICAgICAgIHdhcm4oYGdldFRleHRDb250ZW50IC0gaWdub3JpbmcgRXh0R1N0YXRlOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNhc2UgT1BTLmJlZ2luTWFya2VkQ29udGVudDoKICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgaWYgKGluY2x1ZGVNYXJrZWRDb250ZW50KSB7CiAgICAgICAgICAgICAgbWFya2VkQ29udGVudERhdGEubGV2ZWwrKzsKICAgICAgICAgICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJiZWdpbk1hcmtlZENvbnRlbnQiLAogICAgICAgICAgICAgICAgdGFnOiBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZSA/IGFyZ3NbMF0ubmFtZSA6IG51bGwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzOgogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBpZiAoaW5jbHVkZU1hcmtlZENvbnRlbnQpIHsKICAgICAgICAgICAgICBtYXJrZWRDb250ZW50RGF0YS5sZXZlbCsrOwogICAgICAgICAgICAgIGxldCBtY2lkID0gbnVsbDsKICAgICAgICAgICAgICBpZiAoYXJnc1sxXSBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgICAgICAgIG1jaWQgPSBhcmdzWzFdLmdldCgiTUNJRCIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJiZWdpbk1hcmtlZENvbnRlbnRQcm9wcyIsCiAgICAgICAgICAgICAgICBpZDogTnVtYmVyLmlzSW50ZWdlcihtY2lkKSA/IGAke3NlbGYuaWRGYWN0b3J5LmdldFBhZ2VPYmpJZCgpfV9tYyR7bWNpZH1gIDogbnVsbCwKICAgICAgICAgICAgICAgIHRhZzogYXJnc1swXSBpbnN0YW5jZW9mIE5hbWUgPyBhcmdzWzBdLm5hbWUgOiBudWxsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5lbmRNYXJrZWRDb250ZW50OgogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBpZiAoaW5jbHVkZU1hcmtlZENvbnRlbnQpIHsKICAgICAgICAgICAgICBpZiAobWFya2VkQ29udGVudERhdGEubGV2ZWwgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBtYXJrZWRDb250ZW50RGF0YS5sZXZlbC0tOwogICAgICAgICAgICAgIHRleHRDb250ZW50Lml0ZW1zLnB1c2goewogICAgICAgICAgICAgICAgdHlwZTogImVuZE1hcmtlZENvbnRlbnQiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5yZXN0b3JlOgogICAgICAgICAgICBpZiAocHJldmlvdXNTdGF0ZSAmJiAocHJldmlvdXNTdGF0ZS5mb250ICE9PSB0ZXh0U3RhdGUuZm9udCB8fCBwcmV2aW91c1N0YXRlLmZvbnRTaXplICE9PSB0ZXh0U3RhdGUuZm9udFNpemUgfHwgcHJldmlvdXNTdGF0ZS5mb250TmFtZSAhPT0gdGV4dFN0YXRlLmZvbnROYW1lKSkgewogICAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmICh0ZXh0Q29udGVudC5pdGVtcy5sZW5ndGggPj0gKHNpbms/LmRlc2lyZWRTaXplID8/IDEpKSB7CiAgICAgICAgICBzdG9wID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3RvcCkgewogICAgICAgIG5leHQoZGVmZXJyZWQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICBlbnF1ZXVlQ2h1bmsoKTsKICAgICAgcmVzb2x2ZSgpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgd2FybihgZ2V0VGV4dENvbnRlbnQgLSBpZ25vcmluZyBlcnJvcnMgZHVyaW5nICIke3Rhc2submFtZX0iIGAgKyBgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICBlbnF1ZXVlQ2h1bmsoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhyb3cgcmVhc29uOwogICAgfSk7CiAgfQogIGFzeW5jIGV4dHJhY3REYXRhU3RydWN0dXJlcyhkaWN0LCBwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmOwogICAgbGV0IGNpZFRvR2lkQnl0ZXM7CiAgICBjb25zdCB0b1VuaWNvZGVQcm9taXNlID0gdGhpcy5yZWFkVG9Vbmljb2RlKHByb3BlcnRpZXMudG9Vbmljb2RlKTsKICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICBjb25zdCBjaWRTeXN0ZW1JbmZvID0gZGljdC5nZXQoIkNJRFN5c3RlbUluZm8iKTsKICAgICAgaWYgKGNpZFN5c3RlbUluZm8gaW5zdGFuY2VvZiBEaWN0ICYmICFwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8pIHsKICAgICAgICBwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8gPSB7CiAgICAgICAgICByZWdpc3RyeTogc3RyaW5nVG9QREZTdHJpbmcoY2lkU3lzdGVtSW5mby5nZXQoIlJlZ2lzdHJ5IikpLAogICAgICAgICAgb3JkZXJpbmc6IHN0cmluZ1RvUERGU3RyaW5nKGNpZFN5c3RlbUluZm8uZ2V0KCJPcmRlcmluZyIpKSwKICAgICAgICAgIHN1cHBsZW1lbnQ6IGNpZFN5c3RlbUluZm8uZ2V0KCJTdXBwbGVtZW50IikKICAgICAgICB9OwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgY2lkVG9HaWRNYXAgPSBkaWN0LmdldCgiQ0lEVG9HSURNYXAiKTsKICAgICAgICBpZiAoY2lkVG9HaWRNYXAgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgICBjaWRUb0dpZEJ5dGVzID0gY2lkVG9HaWRNYXAuZ2V0Qnl0ZXMoKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICB0aHJvdyBleDsKICAgICAgICB9CiAgICAgICAgd2FybihgZXh0cmFjdERhdGFTdHJ1Y3R1cmVzIC0gaWdub3JpbmcgQ0lEVG9HSURNYXAgZGF0YTogIiR7ZXh9Ii5gKTsKICAgICAgfQogICAgfQogICAgY29uc3QgZGlmZmVyZW5jZXMgPSBbXTsKICAgIGxldCBiYXNlRW5jb2RpbmdOYW1lID0gbnVsbDsKICAgIGxldCBlbmNvZGluZzsKICAgIGlmIChkaWN0LmhhcygiRW5jb2RpbmciKSkgewogICAgICBlbmNvZGluZyA9IGRpY3QuZ2V0KCJFbmNvZGluZyIpOwogICAgICBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgYmFzZUVuY29kaW5nTmFtZSA9IGVuY29kaW5nLmdldCgiQmFzZUVuY29kaW5nIik7CiAgICAgICAgYmFzZUVuY29kaW5nTmFtZSA9IGJhc2VFbmNvZGluZ05hbWUgaW5zdGFuY2VvZiBOYW1lID8gYmFzZUVuY29kaW5nTmFtZS5uYW1lIDogbnVsbDsKICAgICAgICBpZiAoZW5jb2RpbmcuaGFzKCJEaWZmZXJlbmNlcyIpKSB7CiAgICAgICAgICBjb25zdCBkaWZmRW5jb2RpbmcgPSBlbmNvZGluZy5nZXQoIkRpZmZlcmVuY2VzIik7CiAgICAgICAgICBsZXQgaW5kZXggPSAwOwogICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBkaWZmRW5jb2RpbmcpIHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IHhyZWYuZmV0Y2hJZlJlZihlbnRyeSk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICBpbmRleCA9IGRhdGE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgICBkaWZmZXJlbmNlc1tpbmRleCsrXSA9IGRhdGEubmFtZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZW50cnkgaW4gJ0RpZmZlcmVuY2VzJyBhcnJheTogJHtkYXRhfWApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBlbmNvZGluZy5uYW1lOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IG1zZyA9ICJFbmNvZGluZyBpcyBub3QgYSBOYW1lIG5vciBhIERpY3QiOwogICAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKG1zZyk7CiAgICAgICAgfQogICAgICAgIHdhcm4obXNnKTsKICAgICAgfQogICAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSAhPT0gIk1hY1JvbWFuRW5jb2RpbmciICYmIGJhc2VFbmNvZGluZ05hbWUgIT09ICJNYWNFeHBlcnRFbmNvZGluZyIgJiYgYmFzZUVuY29kaW5nTmFtZSAhPT0gIldpbkFuc2lFbmNvZGluZyIpIHsKICAgICAgICBiYXNlRW5jb2RpbmdOYW1lID0gbnVsbDsKICAgICAgfQogICAgfQogICAgY29uc3Qgbm9uRW1iZWRkZWRGb250ID0gIXByb3BlcnRpZXMuZmlsZSB8fCBwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250LAogICAgICBpc1N5bWJvbHNGb250TmFtZSA9IGdldFN5bWJvbHNGb250cygpW3Byb3BlcnRpZXMubmFtZV07CiAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSAmJiBub25FbWJlZGRlZEZvbnQgJiYgaXNTeW1ib2xzRm9udE5hbWUpIHsKICAgICAgYmFzZUVuY29kaW5nTmFtZSA9IG51bGw7CiAgICB9CiAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSA9PT0gIldpbkFuc2lFbmNvZGluZyIgJiYgbm9uRW1iZWRkZWRGb250ICYmIHByb3BlcnRpZXMubmFtZT8uY2hhckNvZGVBdCgwKSA+PSAweGI3KSB7CiAgICAgIGNvbnN0IGZvbnROYW1lID0gcHJvcGVydGllcy5uYW1lOwogICAgICBjb25zdCBjaGluZXNlRm9udE5hbWVzID0gWyJceENCXHhDRVx4Q0NceEU1IiwgIlx4QkFceERBXHhDQ1x4RTUiLCAiXHhCRlx4QUNceENDXHhFNSIsICJceEI3XHhDMlx4Q0JceENFIiwgIlx4QkZceEFDXHhDQ1x4RTVfR0IyMzEyIiwgIlx4QjdceEMyXHhDQlx4Q0VfR0IyMzEyIiwgIlx4QzFceEE1XHhDQVx4RTkiLCAiXHhEMFx4QzJceENCXHhDRSJdOwogICAgICBpZiAoY2hpbmVzZUZvbnROYW1lcy5pbmNsdWRlcyhmb250TmFtZSkpIHsKICAgICAgICBiYXNlRW5jb2RpbmdOYW1lID0gbnVsbDsKICAgICAgICBwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZyA9ICJBZG9iZS1HQjEtVUNTMiI7CiAgICAgICAgcHJvcGVydGllcy5jb21wb3NpdGUgPSB0cnVlOwogICAgICAgIHByb3BlcnRpZXMuY2lkRW5jb2RpbmcgPSBOYW1lLmdldCgiR0JLLUVVQy1IIik7CiAgICAgICAgY29uc3QgY01hcCA9IGF3YWl0IENNYXBGYWN0b3J5LmNyZWF0ZSh7CiAgICAgICAgICBlbmNvZGluZzogcHJvcGVydGllcy5jaWRFbmNvZGluZywKICAgICAgICAgIGZldGNoQnVpbHRJbkNNYXA6IHRoaXMuX2ZldGNoQnVpbHRJbkNNYXBCb3VuZCwKICAgICAgICAgIHVzZUNNYXA6IG51bGwKICAgICAgICB9KTsKICAgICAgICBwcm9wZXJ0aWVzLmNNYXAgPSBjTWFwOwogICAgICAgIHByb3BlcnRpZXMudmVydGljYWwgPSBwcm9wZXJ0aWVzLmNNYXAudmVydGljYWw7CiAgICAgICAgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvID0gewogICAgICAgICAgcmVnaXN0cnk6ICJBZG9iZSIsCiAgICAgICAgICBvcmRlcmluZzogIkdCMSIsCiAgICAgICAgICBzdXBwbGVtZW50OiAwCiAgICAgICAgfTsKICAgICAgfQogICAgfQogICAgaWYgKGJhc2VFbmNvZGluZ05hbWUpIHsKICAgICAgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcgPSBnZXRFbmNvZGluZyhiYXNlRW5jb2RpbmdOYW1lKTsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBpc1N5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU3ltYm9saWMpOwogICAgICBjb25zdCBpc05vbnN5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuTm9uc3ltYm9saWMpOwogICAgICBpZiAocHJvcGVydGllcy50eXBlID09PSAiVHJ1ZVR5cGUiICYmIGlzU3ltYm9saWNGb250ICYmIGlzTm9uc3ltYm9saWNGb250ICYmIGRpZmZlcmVuY2VzLmxlbmd0aCAhPT0gMCkgewogICAgICAgIHByb3BlcnRpZXMuZmxhZ3MgJj0gfkZvbnRGbGFncy5TeW1ib2xpYzsKICAgICAgICBpc1N5bWJvbGljRm9udCA9IGZhbHNlOwogICAgICB9CiAgICAgIGVuY29kaW5nID0gU3RhbmRhcmRFbmNvZGluZzsKICAgICAgaWYgKHByb3BlcnRpZXMudHlwZSA9PT0gIlRydWVUeXBlIiAmJiAhaXNOb25zeW1ib2xpY0ZvbnQpIHsKICAgICAgICBlbmNvZGluZyA9IFdpbkFuc2lFbmNvZGluZzsKICAgICAgfQogICAgICBpZiAoaXNTeW1ib2xpY0ZvbnQgfHwgaXNTeW1ib2xzRm9udE5hbWUpIHsKICAgICAgICBlbmNvZGluZyA9IE1hY1JvbWFuRW5jb2Rpbmc7CiAgICAgICAgaWYgKG5vbkVtYmVkZGVkRm9udCkgewogICAgICAgICAgaWYgKC9TeW1ib2wvaS50ZXN0KHByb3BlcnRpZXMubmFtZSkpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBTeW1ib2xTZXRFbmNvZGluZzsKICAgICAgICAgIH0gZWxzZSBpZiAoL0RpbmdiYXRzL2kudGVzdChwcm9wZXJ0aWVzLm5hbWUpKSB7CiAgICAgICAgICAgIGVuY29kaW5nID0gWmFwZkRpbmdiYXRzRW5jb2Rpbmc7CiAgICAgICAgICB9IGVsc2UgaWYgKC9XaW5nZGluZ3MvaS50ZXN0KHByb3BlcnRpZXMubmFtZSkpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBXaW5BbnNpRW5jb2Rpbmc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICB9CiAgICBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzID0gZGlmZmVyZW5jZXM7CiAgICBwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUgPSBiYXNlRW5jb2RpbmdOYW1lOwogICAgcHJvcGVydGllcy5oYXNFbmNvZGluZyA9ICEhYmFzZUVuY29kaW5nTmFtZSB8fCBkaWZmZXJlbmNlcy5sZW5ndGggPiAwOwogICAgcHJvcGVydGllcy5kaWN0ID0gZGljdDsKICAgIHByb3BlcnRpZXMudG9Vbmljb2RlID0gYXdhaXQgdG9Vbmljb2RlUHJvbWlzZTsKICAgIGNvbnN0IGJ1aWx0VG9Vbmljb2RlID0gYXdhaXQgdGhpcy5idWlsZFRvVW5pY29kZShwcm9wZXJ0aWVzKTsKICAgIHByb3BlcnRpZXMudG9Vbmljb2RlID0gYnVpbHRUb1VuaWNvZGU7CiAgICBpZiAoY2lkVG9HaWRCeXRlcykgewogICAgICBwcm9wZXJ0aWVzLmNpZFRvR2lkTWFwID0gdGhpcy5yZWFkQ2lkVG9HaWRNYXAoY2lkVG9HaWRCeXRlcywgYnVpbHRUb1VuaWNvZGUpOwogICAgfQogICAgcmV0dXJuIHByb3BlcnRpZXM7CiAgfQogIF9zaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMsIGZvcmNlR2x5cGhzID0gZmFsc2UpIHsKICAgIGFzc2VydCghcHJvcGVydGllcy5jb21wb3NpdGUsICJNdXN0IGJlIGEgc2ltcGxlIGZvbnQuIik7CiAgICBjb25zdCB0b1VuaWNvZGUgPSBbXTsKICAgIGNvbnN0IGVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmcuc2xpY2UoKTsKICAgIGNvbnN0IGJhc2VFbmNvZGluZ05hbWUgPSBwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWU7CiAgICBjb25zdCBkaWZmZXJlbmNlcyA9IHByb3BlcnRpZXMuZGlmZmVyZW5jZXM7CiAgICBmb3IgKGNvbnN0IGNoYXJjb2RlIGluIGRpZmZlcmVuY2VzKSB7CiAgICAgIGNvbnN0IGdseXBoTmFtZSA9IGRpZmZlcmVuY2VzW2NoYXJjb2RlXTsKICAgICAgaWYgKGdseXBoTmFtZSA9PT0gIi5ub3RkZWYiKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZW5jb2RpbmdbY2hhcmNvZGVdID0gZ2x5cGhOYW1lOwogICAgfQogICAgY29uc3QgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICAgIGZvciAoY29uc3QgY2hhcmNvZGUgaW4gZW5jb2RpbmcpIHsKICAgICAgbGV0IGdseXBoTmFtZSA9IGVuY29kaW5nW2NoYXJjb2RlXTsKICAgICAgaWYgKGdseXBoTmFtZSA9PT0gIiIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgdW5pY29kZSA9IGdseXBoc1VuaWNvZGVNYXBbZ2x5cGhOYW1lXTsKICAgICAgaWYgKHVuaWNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHVuaWNvZGUpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCBjb2RlID0gMDsKICAgICAgc3dpdGNoIChnbHlwaE5hbWVbMF0pIHsKICAgICAgICBjYXNlICJHIjoKICAgICAgICAgIGlmIChnbHlwaE5hbWUubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgIGNvZGUgPSBwYXJzZUludChnbHlwaE5hbWUuc3Vic3RyaW5nKDEpLCAxNik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJnIjoKICAgICAgICAgIGlmIChnbHlwaE5hbWUubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICAgIGNvZGUgPSBwYXJzZUludChnbHlwaE5hbWUuc3Vic3RyaW5nKDEpLCAxNik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJDIjoKICAgICAgICBjYXNlICJjIjoKICAgICAgICAgIGlmIChnbHlwaE5hbWUubGVuZ3RoID49IDMgJiYgZ2x5cGhOYW1lLmxlbmd0aCA8PSA0KSB7CiAgICAgICAgICAgIGNvbnN0IGNvZGVTdHIgPSBnbHlwaE5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICBpZiAoZm9yY2VHbHlwaHMpIHsKICAgICAgICAgICAgICBjb2RlID0gcGFyc2VJbnQoY29kZVN0ciwgMTYpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvZGUgPSArY29kZVN0cjsKICAgICAgICAgICAgaWYgKE51bWJlci5pc05hTihjb2RlKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKHBhcnNlSW50KGNvZGVTdHIsIDE2KSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2ltcGxlRm9udFRvVW5pY29kZShwcm9wZXJ0aWVzLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidSI6CiAgICAgICAgICB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICAgICAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgICAgICAgY29kZSA9IHVuaWNvZGU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgc3dpdGNoIChnbHlwaE5hbWUpIHsKICAgICAgICAgICAgY2FzZSAiZl9oIjoKICAgICAgICAgICAgY2FzZSAiZl90IjoKICAgICAgICAgICAgY2FzZSAiVF9oIjoKICAgICAgICAgICAgICB0b1VuaWNvZGVbY2hhcmNvZGVdID0gZ2x5cGhOYW1lLnJlcGxhY2VBbGwoIl8iLCAiIik7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoY29kZSA+IDAgJiYgY29kZSA8PSAweDEwZmZmZiAmJiBOdW1iZXIuaXNJbnRlZ2VyKGNvZGUpKSB7CiAgICAgICAgaWYgKGJhc2VFbmNvZGluZ05hbWUgJiYgY29kZSA9PT0gK2NoYXJjb2RlKSB7CiAgICAgICAgICBjb25zdCBiYXNlRW5jb2RpbmcgPSBnZXRFbmNvZGluZyhiYXNlRW5jb2RpbmdOYW1lKTsKICAgICAgICAgIGlmIChiYXNlRW5jb2RpbmcgJiYgKGdseXBoTmFtZSA9IGJhc2VFbmNvZGluZ1tjaGFyY29kZV0pKSB7CiAgICAgICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGdseXBoc1VuaWNvZGVNYXBbZ2x5cGhOYW1lXSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0b1VuaWNvZGVbY2hhcmNvZGVdID0gU3RyaW5nLmZyb21Db2RlUG9pbnQoY29kZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0b1VuaWNvZGU7CiAgfQogIGFzeW5jIGJ1aWxkVG9Vbmljb2RlKHByb3BlcnRpZXMpIHsKICAgIHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXAgPSBwcm9wZXJ0aWVzLnRvVW5pY29kZT8ubGVuZ3RoID4gMDsKICAgIGlmIChwcm9wZXJ0aWVzLmhhc0luY2x1ZGVkVG9Vbmljb2RlTWFwKSB7CiAgICAgIGlmICghcHJvcGVydGllcy5jb21wb3NpdGUgJiYgcHJvcGVydGllcy5oYXNFbmNvZGluZykgewogICAgICAgIHByb3BlcnRpZXMuZmFsbGJhY2tUb1VuaWNvZGUgPSB0aGlzLl9zaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMpOwogICAgICB9CiAgICAgIHJldHVybiBwcm9wZXJ0aWVzLnRvVW5pY29kZTsKICAgIH0KICAgIGlmICghcHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgcmV0dXJuIG5ldyBUb1VuaWNvZGVNYXAodGhpcy5fc2ltcGxlRm9udFRvVW5pY29kZShwcm9wZXJ0aWVzKSk7CiAgICB9CiAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUgJiYgKHByb3BlcnRpZXMuY01hcC5idWlsdEluQ01hcCAmJiAhKHByb3BlcnRpZXMuY01hcCBpbnN0YW5jZW9mIElkZW50aXR5Q01hcCkgfHwgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvPy5yZWdpc3RyeSA9PT0gIkFkb2JlIiAmJiAocHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvLm9yZGVyaW5nID09PSAiR0IxIiB8fCBwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8ub3JkZXJpbmcgPT09ICJDTlMxIiB8fCBwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8ub3JkZXJpbmcgPT09ICJKYXBhbjEiIHx8IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5vcmRlcmluZyA9PT0gIktvcmVhMSIpKSkgewogICAgICBjb25zdCB7CiAgICAgICAgcmVnaXN0cnksCiAgICAgICAgb3JkZXJpbmcKICAgICAgfSA9IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mbzsKICAgICAgY29uc3QgdWNzMkNNYXBOYW1lID0gTmFtZS5nZXQoYCR7cmVnaXN0cnl9LSR7b3JkZXJpbmd9LVVDUzJgKTsKICAgICAgY29uc3QgdWNzMkNNYXAgPSBhd2FpdCBDTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgIGVuY29kaW5nOiB1Y3MyQ01hcE5hbWUsCiAgICAgICAgZmV0Y2hCdWlsdEluQ01hcDogdGhpcy5fZmV0Y2hCdWlsdEluQ01hcEJvdW5kLAogICAgICAgIHVzZUNNYXA6IG51bGwKICAgICAgfSk7CiAgICAgIGNvbnN0IHRvVW5pY29kZSA9IFtdLAogICAgICAgIGJ1ZiA9IFtdOwogICAgICBwcm9wZXJ0aWVzLmNNYXAuZm9yRWFjaChmdW5jdGlvbiAoY2hhcmNvZGUsIGNpZCkgewogICAgICAgIGlmIChjaWQgPiAweGZmZmYpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTWF4IHNpemUgb2YgQ0lEIGlzIDY1LDUzNSIpOwogICAgICAgIH0KICAgICAgICBjb25zdCB1Y3MyID0gdWNzMkNNYXAubG9va3VwKGNpZCk7CiAgICAgICAgaWYgKHVjczIpIHsKICAgICAgICAgIGJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdWNzMi5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICAgIGJ1Zi5wdXNoKCh1Y3MyLmNoYXJDb2RlQXQoaSkgPDwgOCkgKyB1Y3MyLmNoYXJDb2RlQXQoaSArIDEpKTsKICAgICAgICAgIH0KICAgICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmJ1Zik7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIG5ldyBUb1VuaWNvZGVNYXAodG9Vbmljb2RlKTsKICAgIH0KICAgIHJldHVybiBuZXcgSWRlbnRpdHlUb1VuaWNvZGVNYXAocHJvcGVydGllcy5maXJzdENoYXIsIHByb3BlcnRpZXMubGFzdENoYXIpOwogIH0KICBhc3luYyByZWFkVG9Vbmljb2RlKGNtYXBPYmopIHsKICAgIGlmICghY21hcE9iaikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChjbWFwT2JqIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBjb25zdCBjbWFwID0gYXdhaXQgQ01hcEZhY3RvcnkuY3JlYXRlKHsKICAgICAgICBlbmNvZGluZzogY21hcE9iaiwKICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICB9KTsKICAgICAgaWYgKGNtYXAgaW5zdGFuY2VvZiBJZGVudGl0eUNNYXApIHsKICAgICAgICByZXR1cm4gbmV3IElkZW50aXR5VG9Vbmljb2RlTWFwKDAsIDB4ZmZmZik7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBUb1VuaWNvZGVNYXAoY21hcC5nZXRNYXAoKSk7CiAgICB9CiAgICBpZiAoY21hcE9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBjbWFwID0gYXdhaXQgQ01hcEZhY3RvcnkuY3JlYXRlKHsKICAgICAgICAgIGVuY29kaW5nOiBjbWFwT2JqLAogICAgICAgICAgZmV0Y2hCdWlsdEluQ01hcDogdGhpcy5fZmV0Y2hCdWlsdEluQ01hcEJvdW5kLAogICAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICAgIH0pOwogICAgICAgIGlmIChjbWFwIGluc3RhbmNlb2YgSWRlbnRpdHlDTWFwKSB7CiAgICAgICAgICByZXR1cm4gbmV3IElkZW50aXR5VG9Vbmljb2RlTWFwKDAsIDB4ZmZmZik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1hcCA9IG5ldyBBcnJheShjbWFwLmxlbmd0aCk7CiAgICAgICAgY21hcC5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgdG9rZW4pIHsKICAgICAgICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludCh0b2tlbik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0b2tlbi5sZW5ndGggJSAyICE9PSAwKSB7CiAgICAgICAgICAgIHRva2VuID0gIlx1MDAwMCIgKyB0b2tlbjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHN0ciA9IFtdOwogICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0b2tlbi5sZW5ndGg7IGsgKz0gMikgewogICAgICAgICAgICBjb25zdCB3MSA9IHRva2VuLmNoYXJDb2RlQXQoaykgPDwgOCB8IHRva2VuLmNoYXJDb2RlQXQoayArIDEpOwogICAgICAgICAgICBpZiAoKHcxICYgMHhmODAwKSAhPT0gMHhkODAwKSB7CiAgICAgICAgICAgICAgc3RyLnB1c2godzEpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGsgKz0gMjsKICAgICAgICAgICAgY29uc3QgdzIgPSB0b2tlbi5jaGFyQ29kZUF0KGspIDw8IDggfCB0b2tlbi5jaGFyQ29kZUF0KGsgKyAxKTsKICAgICAgICAgICAgc3RyLnB1c2goKCh3MSAmIDB4M2ZmKSA8PCAxMCkgKyAodzIgJiAweDNmZikgKyAweDEwMDAwKTsKICAgICAgICAgIH0KICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludCguLi5zdHIpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBuZXcgVG9Vbmljb2RlTWFwKG1hcCk7CiAgICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICB3YXJuKGByZWFkVG9Vbmljb2RlIC0gaWdub3JpbmcgVG9Vbmljb2RlIGRhdGE6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIHJlYWRDaWRUb0dpZE1hcChnbHlwaHNEYXRhLCB0b1VuaWNvZGUpIHsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgZm9yIChsZXQgaiA9IDAsIGpqID0gZ2x5cGhzRGF0YS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgIGNvbnN0IGdseXBoSUQgPSBnbHlwaHNEYXRhW2orK10gPDwgOCB8IGdseXBoc0RhdGFbal07CiAgICAgIGNvbnN0IGNvZGUgPSBqID4+IDE7CiAgICAgIGlmIChnbHlwaElEID09PSAwICYmICF0b1VuaWNvZGUuaGFzKGNvZGUpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcmVzdWx0W2NvZGVdID0gZ2x5cGhJRDsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGV4dHJhY3RXaWR0aHMoZGljdCwgZGVzY3JpcHRvciwgcHJvcGVydGllcykgewogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZjsKICAgIGxldCBnbHlwaHNXaWR0aHMgPSBbXTsKICAgIGxldCBkZWZhdWx0V2lkdGggPSAwOwogICAgY29uc3QgZ2x5cGhzVk1ldHJpY3MgPSBbXTsKICAgIGxldCBkZWZhdWx0Vk1ldHJpY3M7CiAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgY29uc3QgZHcgPSBkaWN0LmdldCgiRFciKTsKICAgICAgZGVmYXVsdFdpZHRoID0gdHlwZW9mIGR3ID09PSAibnVtYmVyIiA/IE1hdGguY2VpbChkdykgOiAxMDAwOwogICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiVyIpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh3aWR0aHMpKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gd2lkdGhzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGxldCBzdGFydCA9IHhyZWYuZmV0Y2hJZlJlZih3aWR0aHNbaSsrXSk7CiAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoc3RhcnQpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgY29kZSA9IHhyZWYuZmV0Y2hJZlJlZih3aWR0aHNbaV0pOwogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29kZSkpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGNvZGUpIHsKICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IHhyZWYuZmV0Y2hJZlJlZihjKTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpZHRoID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgZ2x5cGhzV2lkdGhzW3N0YXJ0XSA9IHdpZHRoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzdGFydCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0ludGVnZXIoY29kZSkpIHsKICAgICAgICAgICAgY29uc3Qgd2lkdGggPSB4cmVmLmZldGNoSWZSZWYod2lkdGhzWysraV0pOwogICAgICAgICAgICBpZiAodHlwZW9mIHdpZHRoICE9PSAibnVtYmVyIikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGogPSBzdGFydDsgaiA8PSBjb2RlOyBqKyspIHsKICAgICAgICAgICAgICBnbHlwaHNXaWR0aHNbal0gPSB3aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwcm9wZXJ0aWVzLnZlcnRpY2FsKSB7CiAgICAgICAgY29uc3QgZHcyID0gZGljdC5nZXRBcnJheSgiRFcyIik7CiAgICAgICAgbGV0IHZtZXRyaWNzID0gaXNOdW1iZXJBcnJheShkdzIsIDIpID8gZHcyIDogWzg4MCwgLTEwMDBdOwogICAgICAgIGRlZmF1bHRWTWV0cmljcyA9IFt2bWV0cmljc1sxXSwgZGVmYXVsdFdpZHRoICogMC41LCB2bWV0cmljc1swXV07CiAgICAgICAgdm1ldHJpY3MgPSBkaWN0LmdldCgiVzIiKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2bWV0cmljcykpIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHZtZXRyaWNzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgbGV0IHN0YXJ0ID0geHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzW2krK10pOwogICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoc3RhcnQpKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY29kZSA9IHhyZWYuZmV0Y2hJZlJlZih2bWV0cmljc1tpXSk7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvZGUpKSB7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gY29kZS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB2bWV0cmljID0gW3hyZWYuZmV0Y2hJZlJlZihjb2RlW2orK10pLCB4cmVmLmZldGNoSWZSZWYoY29kZVtqKytdKSwgeHJlZi5mZXRjaElmUmVmKGNvZGVbal0pXTsKICAgICAgICAgICAgICAgIGlmIChpc051bWJlckFycmF5KHZtZXRyaWMsIG51bGwpKSB7CiAgICAgICAgICAgICAgICAgIGdseXBoc1ZNZXRyaWNzW3N0YXJ0XSA9IHZtZXRyaWM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGFydCsrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNvZGUpKSB7CiAgICAgICAgICAgICAgY29uc3Qgdm1ldHJpYyA9IFt4cmVmLmZldGNoSWZSZWYodm1ldHJpY3NbKytpXSksIHhyZWYuZmV0Y2hJZlJlZih2bWV0cmljc1srK2ldKSwgeHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzWysraV0pXTsKICAgICAgICAgICAgICBpZiAoIWlzTnVtYmVyQXJyYXkodm1ldHJpYywgbnVsbCkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKGxldCBqID0gc3RhcnQ7IGogPD0gY29kZTsgaisrKSB7CiAgICAgICAgICAgICAgICBnbHlwaHNWTWV0cmljc1tqXSA9IHZtZXRyaWM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHdpZHRocykpIHsKICAgICAgICBsZXQgaiA9IHByb3BlcnRpZXMuZmlyc3RDaGFyOwogICAgICAgIGZvciAoY29uc3QgdyBvZiB3aWR0aHMpIHsKICAgICAgICAgIGNvbnN0IHdpZHRoID0geHJlZi5mZXRjaElmUmVmKHcpOwogICAgICAgICAgaWYgKHR5cGVvZiB3aWR0aCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgZ2x5cGhzV2lkdGhzW2pdID0gd2lkdGg7CiAgICAgICAgICB9CiAgICAgICAgICBqKys7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1pc3NpbmdXaWR0aCA9IGRlc2NyaXB0b3IuZ2V0KCJNaXNzaW5nV2lkdGgiKTsKICAgICAgICBkZWZhdWx0V2lkdGggPSB0eXBlb2YgbWlzc2luZ1dpZHRoID09PSAibnVtYmVyIiA/IG1pc3NpbmdXaWR0aCA6IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYmFzZUZvbnROYW1lID0gZGljdC5nZXQoIkJhc2VGb250Iik7CiAgICAgICAgaWYgKGJhc2VGb250TmFtZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSB0aGlzLmdldEJhc2VGb250TWV0cmljcyhiYXNlRm9udE5hbWUubmFtZSk7CiAgICAgICAgICBnbHlwaHNXaWR0aHMgPSB0aGlzLmJ1aWxkQ2hhckNvZGVUb1dpZHRoKG1ldHJpY3Mud2lkdGhzLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGRlZmF1bHRXaWR0aCA9IG1ldHJpY3MuZGVmYXVsdFdpZHRoOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IGlzTW9ub3NwYWNlID0gdHJ1ZTsKICAgIGxldCBmaXJzdFdpZHRoID0gZGVmYXVsdFdpZHRoOwogICAgZm9yIChjb25zdCBnbHlwaCBpbiBnbHlwaHNXaWR0aHMpIHsKICAgICAgY29uc3QgZ2x5cGhXaWR0aCA9IGdseXBoc1dpZHRoc1tnbHlwaF07CiAgICAgIGlmICghZ2x5cGhXaWR0aCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghZmlyc3RXaWR0aCkgewogICAgICAgIGZpcnN0V2lkdGggPSBnbHlwaFdpZHRoOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChmaXJzdFdpZHRoICE9PSBnbHlwaFdpZHRoKSB7CiAgICAgICAgaXNNb25vc3BhY2UgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKGlzTW9ub3NwYWNlKSB7CiAgICAgIHByb3BlcnRpZXMuZmxhZ3MgfD0gRm9udEZsYWdzLkZpeGVkUGl0Y2g7CiAgICB9IGVsc2UgewogICAgICBwcm9wZXJ0aWVzLmZsYWdzICY9IH5Gb250RmxhZ3MuRml4ZWRQaXRjaDsKICAgIH0KICAgIHByb3BlcnRpZXMuZGVmYXVsdFdpZHRoID0gZGVmYXVsdFdpZHRoOwogICAgcHJvcGVydGllcy53aWR0aHMgPSBnbHlwaHNXaWR0aHM7CiAgICBwcm9wZXJ0aWVzLmRlZmF1bHRWTWV0cmljcyA9IGRlZmF1bHRWTWV0cmljczsKICAgIHByb3BlcnRpZXMudm1ldHJpY3MgPSBnbHlwaHNWTWV0cmljczsKICB9CiAgaXNTZXJpZkZvbnQoYmFzZUZvbnROYW1lKSB7CiAgICBjb25zdCBmb250TmFtZVdvU3R5bGUgPSBiYXNlRm9udE5hbWUuc3BsaXQoIi0iLCAxKVswXTsKICAgIHJldHVybiBmb250TmFtZVdvU3R5bGUgaW4gZ2V0U2VyaWZGb250cygpIHx8IC9zZXJpZi9naS50ZXN0KGZvbnROYW1lV29TdHlsZSk7CiAgfQogIGdldEJhc2VGb250TWV0cmljcyhuYW1lKSB7CiAgICBsZXQgZGVmYXVsdFdpZHRoID0gMDsKICAgIGxldCB3aWR0aHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgbGV0IG1vbm9zcGFjZSA9IGZhbHNlOwogICAgY29uc3Qgc3RkRm9udE1hcCA9IGdldFN0ZEZvbnRNYXAoKTsKICAgIGxldCBsb29rdXBOYW1lID0gc3RkRm9udE1hcFtuYW1lXSB8fCBuYW1lOwogICAgY29uc3QgTWV0cmljcyA9IGdldE1ldHJpY3MoKTsKICAgIGlmICghKGxvb2t1cE5hbWUgaW4gTWV0cmljcykpIHsKICAgICAgbG9va3VwTmFtZSA9IHRoaXMuaXNTZXJpZkZvbnQobmFtZSkgPyAiVGltZXMtUm9tYW4iIDogIkhlbHZldGljYSI7CiAgICB9CiAgICBjb25zdCBnbHlwaFdpZHRocyA9IE1ldHJpY3NbbG9va3VwTmFtZV07CiAgICBpZiAodHlwZW9mIGdseXBoV2lkdGhzID09PSAibnVtYmVyIikgewogICAgICBkZWZhdWx0V2lkdGggPSBnbHlwaFdpZHRoczsKICAgICAgbW9ub3NwYWNlID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHdpZHRocyA9IGdseXBoV2lkdGhzKCk7CiAgICB9CiAgICByZXR1cm4gewogICAgICBkZWZhdWx0V2lkdGgsCiAgICAgIG1vbm9zcGFjZSwKICAgICAgd2lkdGhzCiAgICB9OwogIH0KICBidWlsZENoYXJDb2RlVG9XaWR0aCh3aWR0aHNCeUdseXBoTmFtZSwgcHJvcGVydGllcykgewogICAgY29uc3Qgd2lkdGhzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGNvbnN0IGRpZmZlcmVuY2VzID0gcHJvcGVydGllcy5kaWZmZXJlbmNlczsKICAgIGNvbnN0IGVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmc7CiAgICBmb3IgKGxldCBjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgMjU2OyBjaGFyQ29kZSsrKSB7CiAgICAgIGlmIChjaGFyQ29kZSBpbiBkaWZmZXJlbmNlcyAmJiB3aWR0aHNCeUdseXBoTmFtZVtkaWZmZXJlbmNlc1tjaGFyQ29kZV1dKSB7CiAgICAgICAgd2lkdGhzW2NoYXJDb2RlXSA9IHdpZHRoc0J5R2x5cGhOYW1lW2RpZmZlcmVuY2VzW2NoYXJDb2RlXV07CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGNoYXJDb2RlIGluIGVuY29kaW5nICYmIHdpZHRoc0J5R2x5cGhOYW1lW2VuY29kaW5nW2NoYXJDb2RlXV0pIHsKICAgICAgICB3aWR0aHNbY2hhckNvZGVdID0gd2lkdGhzQnlHbHlwaE5hbWVbZW5jb2RpbmdbY2hhckNvZGVdXTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHdpZHRoczsKICB9CiAgcHJlRXZhbHVhdGVGb250KGRpY3QpIHsKICAgIGNvbnN0IGJhc2VEaWN0ID0gZGljdDsKICAgIGxldCB0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgIGlmICghKHR5cGUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoImludmFsaWQgZm9udCBTdWJ0eXBlIik7CiAgICB9CiAgICBsZXQgY29tcG9zaXRlID0gZmFsc2U7CiAgICBsZXQgaGFzaDsKICAgIGlmICh0eXBlLm5hbWUgPT09ICJUeXBlMCIpIHsKICAgICAgY29uc3QgZGYgPSBkaWN0LmdldCgiRGVzY2VuZGFudEZvbnRzIik7CiAgICAgIGlmICghZGYpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkRlc2NlbmRhbnQgZm9udHMgYXJlIG5vdCBzcGVjaWZpZWQiKTsKICAgICAgfQogICAgICBkaWN0ID0gQXJyYXkuaXNBcnJheShkZikgPyB0aGlzLnhyZWYuZmV0Y2hJZlJlZihkZlswXSkgOiBkZjsKICAgICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJEZXNjZW5kYW50IGZvbnQgaXMgbm90IGEgZGljdGlvbmFyeS4iKTsKICAgICAgfQogICAgICB0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJpbnZhbGlkIGZvbnQgU3VidHlwZSIpOwogICAgICB9CiAgICAgIGNvbXBvc2l0ZSA9IHRydWU7CiAgICB9CiAgICBsZXQgZmlyc3RDaGFyID0gZGljdC5nZXQoIkZpcnN0Q2hhciIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZpcnN0Q2hhcikpIHsKICAgICAgZmlyc3RDaGFyID0gMDsKICAgIH0KICAgIGxldCBsYXN0Q2hhciA9IGRpY3QuZ2V0KCJMYXN0Q2hhciIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGxhc3RDaGFyKSkgewogICAgICBsYXN0Q2hhciA9IGNvbXBvc2l0ZSA/IDB4ZmZmZiA6IDB4ZmY7CiAgICB9CiAgICBjb25zdCBkZXNjcmlwdG9yID0gZGljdC5nZXQoIkZvbnREZXNjcmlwdG9yIik7CiAgICBjb25zdCB0b1VuaWNvZGUgPSBkaWN0LmdldCgiVG9Vbmljb2RlIikgfHwgYmFzZURpY3QuZ2V0KCJUb1VuaWNvZGUiKTsKICAgIGlmIChkZXNjcmlwdG9yKSB7CiAgICAgIGhhc2ggPSBuZXcgTXVybXVySGFzaDNfNjQoKTsKICAgICAgY29uc3QgZW5jb2RpbmcgPSBiYXNlRGljdC5nZXRSYXcoIkVuY29kaW5nIik7CiAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICBoYXNoLnVwZGF0ZShlbmNvZGluZy5uYW1lKTsKICAgICAgfSBlbHNlIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIGhhc2gudXBkYXRlKGVuY29kaW5nLnRvU3RyaW5nKCkpOwogICAgICB9IGVsc2UgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW5jb2RpbmcuZ2V0UmF3VmFsdWVzKCkpIHsKICAgICAgICAgIGlmIChlbnRyeSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgaGFzaC51cGRhdGUoZW50cnkubmFtZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIGhhc2gudXBkYXRlKGVudHJ5LnRvU3RyaW5nKCkpOwogICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGVudHJ5KSkgewogICAgICAgICAgICBjb25zdCBkaWZmTGVuZ3RoID0gZW50cnkubGVuZ3RoLAogICAgICAgICAgICAgIGRpZmZCdWYgPSBuZXcgQXJyYXkoZGlmZkxlbmd0aCk7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZGlmZkxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgY29uc3QgZGlmZkVudHJ5ID0gZW50cnlbal07CiAgICAgICAgICAgICAgaWYgKGRpZmZFbnRyeSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgICAgIGRpZmZCdWZbal0gPSBkaWZmRW50cnkubmFtZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkaWZmRW50cnkgPT09ICJudW1iZXIiIHx8IGRpZmZFbnRyeSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICAgICAgZGlmZkJ1ZltqXSA9IGRpZmZFbnRyeS50b1N0cmluZygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBoYXNoLnVwZGF0ZShkaWZmQnVmLmpvaW4oKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGhhc2gudXBkYXRlKGAke2ZpcnN0Q2hhcn0tJHtsYXN0Q2hhcn1gKTsKICAgICAgaWYgKHRvVW5pY29kZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBjb25zdCBzdHJlYW0gPSB0b1VuaWNvZGUuc3RyZWFtIHx8IHRvVW5pY29kZTsKICAgICAgICBjb25zdCB1aW50OGFycmF5ID0gc3RyZWFtLmJ1ZmZlciA/IG5ldyBVaW50OEFycmF5KHN0cmVhbS5idWZmZXIuYnVmZmVyLCAwLCBzdHJlYW0uYnVmZmVyTGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KHN0cmVhbS5ieXRlcy5idWZmZXIsIHN0cmVhbS5zdGFydCwgc3RyZWFtLmVuZCAtIHN0cmVhbS5zdGFydCk7CiAgICAgICAgaGFzaC51cGRhdGUodWludDhhcnJheSk7CiAgICAgIH0gZWxzZSBpZiAodG9Vbmljb2RlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGhhc2gudXBkYXRlKHRvVW5pY29kZS5uYW1lKTsKICAgICAgfQogICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIikgfHwgYmFzZURpY3QuZ2V0KCJXaWR0aHMiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkod2lkdGhzKSkgewogICAgICAgIGNvbnN0IHdpZHRoc0J1ZiA9IFtdOwogICAgICAgIGZvciAoY29uc3QgZW50cnkgb2Ygd2lkdGhzKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGVudHJ5ID09PSAibnVtYmVyIiB8fCBlbnRyeSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICB3aWR0aHNCdWYucHVzaChlbnRyeS50b1N0cmluZygpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaGFzaC51cGRhdGUod2lkdGhzQnVmLmpvaW4oKSk7CiAgICAgIH0KICAgICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICAgIGhhc2gudXBkYXRlKCJjb21wb3NpdGVGb250Iik7CiAgICAgICAgY29uc3QgY29tcG9zaXRlV2lkdGhzID0gZGljdC5nZXQoIlciKSB8fCBiYXNlRGljdC5nZXQoIlciKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb21wb3NpdGVXaWR0aHMpKSB7CiAgICAgICAgICBjb25zdCB3aWR0aHNCdWYgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgY29tcG9zaXRlV2lkdGhzKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZW50cnkgPT09ICJudW1iZXIiIHx8IGVudHJ5IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgd2lkdGhzQnVmLnB1c2goZW50cnkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShlbnRyeSkpIHsKICAgICAgICAgICAgICBjb25zdCBzdWJXaWR0aHNCdWYgPSBbXTsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZW50cnkpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gIm51bWJlciIgfHwgZWxlbWVudCBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICAgICAgICBzdWJXaWR0aHNCdWYucHVzaChlbGVtZW50LnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB3aWR0aHNCdWYucHVzaChgWyR7c3ViV2lkdGhzQnVmLmpvaW4oKX1dYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGhhc2gudXBkYXRlKHdpZHRoc0J1Zi5qb2luKCkpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjaWRUb0dpZE1hcCA9IGRpY3QuZ2V0UmF3KCJDSURUb0dJRE1hcCIpIHx8IGJhc2VEaWN0LmdldFJhdygiQ0lEVG9HSURNYXAiKTsKICAgICAgICBpZiAoY2lkVG9HaWRNYXAgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICBoYXNoLnVwZGF0ZShjaWRUb0dpZE1hcC5uYW1lKTsKICAgICAgICB9IGVsc2UgaWYgKGNpZFRvR2lkTWFwIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICBoYXNoLnVwZGF0ZShjaWRUb0dpZE1hcC50b1N0cmluZygpKTsKICAgICAgICB9IGVsc2UgaWYgKGNpZFRvR2lkTWFwIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgICAgaGFzaC51cGRhdGUoY2lkVG9HaWRNYXAucGVla0J5dGVzKCkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgZGVzY3JpcHRvciwKICAgICAgZGljdCwKICAgICAgYmFzZURpY3QsCiAgICAgIGNvbXBvc2l0ZSwKICAgICAgdHlwZTogdHlwZS5uYW1lLAogICAgICBmaXJzdENoYXIsCiAgICAgIGxhc3RDaGFyLAogICAgICB0b1VuaWNvZGUsCiAgICAgIGhhc2g6IGhhc2ggPyBoYXNoLmhleGRpZ2VzdCgpIDogIiIKICAgIH07CiAgfQogIGFzeW5jIHRyYW5zbGF0ZUZvbnQoewogICAgZGVzY3JpcHRvciwKICAgIGRpY3QsCiAgICBiYXNlRGljdCwKICAgIGNvbXBvc2l0ZSwKICAgIHR5cGUsCiAgICBmaXJzdENoYXIsCiAgICBsYXN0Q2hhciwKICAgIHRvVW5pY29kZSwKICAgIGNzc0ZvbnRJbmZvCiAgfSkgewogICAgY29uc3QgaXNUeXBlM0ZvbnQgPSB0eXBlID09PSAiVHlwZTMiOwogICAgaWYgKCFkZXNjcmlwdG9yKSB7CiAgICAgIGlmIChpc1R5cGUzRm9udCkgewogICAgICAgIGRlc2NyaXB0b3IgPSBEaWN0LmVtcHR5OwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBiYXNlRm9udE5hbWUgPSBkaWN0LmdldCgiQmFzZUZvbnQiKTsKICAgICAgICBpZiAoIShiYXNlRm9udE5hbWUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJCYXNlIGZvbnQgaXMgbm90IHNwZWNpZmllZCIpOwogICAgICAgIH0KICAgICAgICBiYXNlRm9udE5hbWUgPSBiYXNlRm9udE5hbWUubmFtZS5yZXBsYWNlQWxsKC9bLF9dL2csICItIik7CiAgICAgICAgY29uc3QgbWV0cmljcyA9IHRoaXMuZ2V0QmFzZUZvbnRNZXRyaWNzKGJhc2VGb250TmFtZSk7CiAgICAgICAgY29uc3QgZm9udE5hbWVXb1N0eWxlID0gYmFzZUZvbnROYW1lLnNwbGl0KCItIiwgMSlbMF07CiAgICAgICAgY29uc3QgZmxhZ3MgPSAodGhpcy5pc1NlcmlmRm9udChmb250TmFtZVdvU3R5bGUpID8gRm9udEZsYWdzLlNlcmlmIDogMCkgfCAobWV0cmljcy5tb25vc3BhY2UgPyBGb250RmxhZ3MuRml4ZWRQaXRjaCA6IDApIHwgKGdldFN5bWJvbHNGb250cygpW2ZvbnROYW1lV29TdHlsZV0gPyBGb250RmxhZ3MuU3ltYm9saWMgOiBGb250RmxhZ3MuTm9uc3ltYm9saWMpOwogICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgbmFtZTogYmFzZUZvbnROYW1lLAogICAgICAgICAgbG9hZGVkTmFtZTogYmFzZURpY3QubG9hZGVkTmFtZSwKICAgICAgICAgIHN5c3RlbUZvbnRJbmZvOiBudWxsLAogICAgICAgICAgd2lkdGhzOiBtZXRyaWNzLndpZHRocywKICAgICAgICAgIGRlZmF1bHRXaWR0aDogbWV0cmljcy5kZWZhdWx0V2lkdGgsCiAgICAgICAgICBpc1NpbXVsYXRlZEZsYWdzOiB0cnVlLAogICAgICAgICAgZmxhZ3MsCiAgICAgICAgICBmaXJzdENoYXIsCiAgICAgICAgICBsYXN0Q2hhciwKICAgICAgICAgIHRvVW5pY29kZSwKICAgICAgICAgIHhIZWlnaHQ6IDAsCiAgICAgICAgICBjYXBIZWlnaHQ6IDAsCiAgICAgICAgICBpdGFsaWNBbmdsZTogMCwKICAgICAgICAgIGlzVHlwZTNGb250CiAgICAgICAgfTsKICAgICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIik7CiAgICAgICAgY29uc3Qgc3RhbmRhcmRGb250TmFtZSA9IGdldFN0YW5kYXJkRm9udE5hbWUoYmFzZUZvbnROYW1lKTsKICAgICAgICBsZXQgZmlsZSA9IG51bGw7CiAgICAgICAgaWYgKHN0YW5kYXJkRm9udE5hbWUpIHsKICAgICAgICAgIGZpbGUgPSBhd2FpdCB0aGlzLmZldGNoU3RhbmRhcmRGb250RGF0YShzdGFuZGFyZEZvbnROYW1lKTsKICAgICAgICAgIHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQgPSAhIWZpbGU7CiAgICAgICAgfQogICAgICAgIGlmICghcHJvcGVydGllcy5pc0ludGVybmFsRm9udCAmJiB0aGlzLm9wdGlvbnMudXNlU3lzdGVtRm9udHMpIHsKICAgICAgICAgIHByb3BlcnRpZXMuc3lzdGVtRm9udEluZm8gPSBnZXRGb250U3Vic3RpdHV0aW9uKHRoaXMuc3lzdGVtRm9udENhY2hlLCB0aGlzLmlkRmFjdG9yeSwgdGhpcy5vcHRpb25zLnN0YW5kYXJkRm9udERhdGFVcmwsIGJhc2VGb250TmFtZSwgc3RhbmRhcmRGb250TmFtZSwgdHlwZSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG5ld1Byb3BlcnRpZXMgPSBhd2FpdCB0aGlzLmV4dHJhY3REYXRhU3RydWN0dXJlcyhkaWN0LCBwcm9wZXJ0aWVzKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh3aWR0aHMpKSB7CiAgICAgICAgICBjb25zdCBnbHlwaFdpZHRocyA9IFtdOwogICAgICAgICAgbGV0IGogPSBmaXJzdENoYXI7CiAgICAgICAgICBmb3IgKGNvbnN0IHcgb2Ygd2lkdGhzKSB7CiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy54cmVmLmZldGNoSWZSZWYodyk7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2lkdGggPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgZ2x5cGhXaWR0aHNbal0gPSB3aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBqKys7CiAgICAgICAgICB9CiAgICAgICAgICBuZXdQcm9wZXJ0aWVzLndpZHRocyA9IGdseXBoV2lkdGhzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuZXdQcm9wZXJ0aWVzLndpZHRocyA9IHRoaXMuYnVpbGRDaGFyQ29kZVRvV2lkdGgobWV0cmljcy53aWR0aHMsIG5ld1Byb3BlcnRpZXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEZvbnQoYmFzZUZvbnROYW1lLCBmaWxlLCBuZXdQcm9wZXJ0aWVzLCB0aGlzLm9wdGlvbnMpOwogICAgICB9CiAgICB9CiAgICBsZXQgZm9udE5hbWUgPSBkZXNjcmlwdG9yLmdldCgiRm9udE5hbWUiKTsKICAgIGxldCBiYXNlRm9udCA9IGRpY3QuZ2V0KCJCYXNlRm9udCIpOwogICAgaWYgKHR5cGVvZiBmb250TmFtZSA9PT0gInN0cmluZyIpIHsKICAgICAgZm9udE5hbWUgPSBOYW1lLmdldChmb250TmFtZSk7CiAgICB9CiAgICBpZiAodHlwZW9mIGJhc2VGb250ID09PSAic3RyaW5nIikgewogICAgICBiYXNlRm9udCA9IE5hbWUuZ2V0KGJhc2VGb250KTsKICAgIH0KICAgIGNvbnN0IGZvbnROYW1lU3RyID0gZm9udE5hbWU/Lm5hbWU7CiAgICBjb25zdCBiYXNlRm9udFN0ciA9IGJhc2VGb250Py5uYW1lOwogICAgaWYgKGlzVHlwZTNGb250KSB7CiAgICAgIGlmICghZm9udE5hbWVTdHIpIHsKICAgICAgICBmb250TmFtZSA9IE5hbWUuZ2V0KHR5cGUpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGZvbnROYW1lU3RyICE9PSBiYXNlRm9udFN0cikgewogICAgICBpbmZvKGBUaGUgRm9udERlc2NyaXB0b3IncyBGb250TmFtZSBpcyAiJHtmb250TmFtZVN0cn0iIGJ1dCBgICsgYHNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgRm9udCdzIEJhc2VGb250ICIke2Jhc2VGb250U3RyfSIuYCk7CiAgICAgIGlmIChmb250TmFtZVN0ciAmJiBiYXNlRm9udFN0ciAmJiAoYmFzZUZvbnRTdHIuc3RhcnRzV2l0aChmb250TmFtZVN0cikgfHwgIWlzS25vd25Gb250TmFtZShmb250TmFtZVN0cikgJiYgaXNLbm93bkZvbnROYW1lKGJhc2VGb250U3RyKSkpIHsKICAgICAgICBmb250TmFtZSA9IG51bGw7CiAgICAgIH0KICAgICAgZm9udE5hbWUgfHw9IGJhc2VGb250OwogICAgfQogICAgaWYgKCEoZm9udE5hbWUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoImludmFsaWQgZm9udCBuYW1lIik7CiAgICB9CiAgICBsZXQgZm9udEZpbGUsIHN1YnR5cGUsIGxlbmd0aDEsIGxlbmd0aDIsIGxlbmd0aDM7CiAgICB0cnkgewogICAgICBmb250RmlsZSA9IGRlc2NyaXB0b3IuZ2V0KCJGb250RmlsZSIsICJGb250RmlsZTIiLCAiRm9udEZpbGUzIik7CiAgICAgIGlmIChmb250RmlsZSkgewogICAgICAgIGlmICghKGZvbnRGaWxlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRm9udEZpbGUgc2hvdWxkIGJlIGEgc3RyZWFtIik7CiAgICAgICAgfSBlbHNlIGlmIChmb250RmlsZS5pc0VtcHR5KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkZvbnRGaWxlIGlzIGVtcHR5Iik7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKGB0cmFuc2xhdGVGb250IC0gZmV0Y2hpbmcgIiR7Zm9udE5hbWUubmFtZX0iIGZvbnQgZmlsZTogIiR7ZXh9Ii5gKTsKICAgICAgZm9udEZpbGUgPSBudWxsOwogICAgfQogICAgbGV0IGlzSW50ZXJuYWxGb250ID0gZmFsc2U7CiAgICBsZXQgZ2x5cGhTY2FsZUZhY3RvcnMgPSBudWxsOwogICAgbGV0IHN5c3RlbUZvbnRJbmZvID0gbnVsbDsKICAgIGlmIChmb250RmlsZSkgewogICAgICBpZiAoZm9udEZpbGUuZGljdCkgewogICAgICAgIGNvbnN0IHN1YnR5cGVFbnRyeSA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgaWYgKHN1YnR5cGVFbnRyeSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgIHN1YnR5cGUgPSBzdWJ0eXBlRW50cnkubmFtZTsKICAgICAgICB9CiAgICAgICAgbGVuZ3RoMSA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJMZW5ndGgxIik7CiAgICAgICAgbGVuZ3RoMiA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJMZW5ndGgyIik7CiAgICAgICAgbGVuZ3RoMyA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJMZW5ndGgzIik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoY3NzRm9udEluZm8pIHsKICAgICAgY29uc3Qgc3RhbmRhcmRGb250TmFtZSA9IGdldFhmYUZvbnROYW1lKGZvbnROYW1lLm5hbWUpOwogICAgICBpZiAoc3RhbmRhcmRGb250TmFtZSkgewogICAgICAgIGNzc0ZvbnRJbmZvLmZvbnRGYW1pbHkgPSBgJHtjc3NGb250SW5mby5mb250RmFtaWx5fS1QZGZKUy1YRkFgOwogICAgICAgIGNzc0ZvbnRJbmZvLm1ldHJpY3MgPSBzdGFuZGFyZEZvbnROYW1lLm1ldHJpY3MgfHwgbnVsbDsKICAgICAgICBnbHlwaFNjYWxlRmFjdG9ycyA9IHN0YW5kYXJkRm9udE5hbWUuZmFjdG9ycyB8fCBudWxsOwogICAgICAgIGZvbnRGaWxlID0gYXdhaXQgdGhpcy5mZXRjaFN0YW5kYXJkRm9udERhdGEoc3RhbmRhcmRGb250TmFtZS5uYW1lKTsKICAgICAgICBpc0ludGVybmFsRm9udCA9ICEhZm9udEZpbGU7CiAgICAgICAgYmFzZURpY3QgPSBkaWN0ID0gZ2V0WGZhRm9udERpY3QoZm9udE5hbWUubmFtZSk7CiAgICAgICAgY29tcG9zaXRlID0gdHJ1ZTsKICAgICAgfQogICAgfSBlbHNlIGlmICghaXNUeXBlM0ZvbnQpIHsKICAgICAgY29uc3Qgc3RhbmRhcmRGb250TmFtZSA9IGdldFN0YW5kYXJkRm9udE5hbWUoZm9udE5hbWUubmFtZSk7CiAgICAgIGlmIChzdGFuZGFyZEZvbnROYW1lKSB7CiAgICAgICAgZm9udEZpbGUgPSBhd2FpdCB0aGlzLmZldGNoU3RhbmRhcmRGb250RGF0YShzdGFuZGFyZEZvbnROYW1lKTsKICAgICAgICBpc0ludGVybmFsRm9udCA9ICEhZm9udEZpbGU7CiAgICAgIH0KICAgICAgaWYgKCFpc0ludGVybmFsRm9udCAmJiB0aGlzLm9wdGlvbnMudXNlU3lzdGVtRm9udHMpIHsKICAgICAgICBzeXN0ZW1Gb250SW5mbyA9IGdldEZvbnRTdWJzdGl0dXRpb24odGhpcy5zeXN0ZW1Gb250Q2FjaGUsIHRoaXMuaWRGYWN0b3J5LCB0aGlzLm9wdGlvbnMuc3RhbmRhcmRGb250RGF0YVVybCwgZm9udE5hbWUubmFtZSwgc3RhbmRhcmRGb250TmFtZSwgdHlwZSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGZvbnRNYXRyaXggPSBsb29rdXBNYXRyaXgoZGljdC5nZXRBcnJheSgiRm9udE1hdHJpeCIpLCBGT05UX0lERU5USVRZX01BVFJJWCk7CiAgICBjb25zdCBiYm94ID0gbG9va3VwTm9ybWFsUmVjdChkZXNjcmlwdG9yLmdldEFycmF5KCJGb250QkJveCIpIHx8IGRpY3QuZ2V0QXJyYXkoIkZvbnRCQm94IiksIGlzVHlwZTNGb250ID8gWzAsIDAsIDAsIDBdIDogdW5kZWZpbmVkKTsKICAgIGxldCBhc2NlbnQgPSBkZXNjcmlwdG9yLmdldCgiQXNjZW50Iik7CiAgICBpZiAodHlwZW9mIGFzY2VudCAhPT0gIm51bWJlciIpIHsKICAgICAgYXNjZW50ID0gdW5kZWZpbmVkOwogICAgfQogICAgbGV0IGRlc2NlbnQgPSBkZXNjcmlwdG9yLmdldCgiRGVzY2VudCIpOwogICAgaWYgKHR5cGVvZiBkZXNjZW50ICE9PSAibnVtYmVyIikgewogICAgICBkZXNjZW50ID0gdW5kZWZpbmVkOwogICAgfQogICAgbGV0IHhIZWlnaHQgPSBkZXNjcmlwdG9yLmdldCgiWEhlaWdodCIpOwogICAgaWYgKHR5cGVvZiB4SGVpZ2h0ICE9PSAibnVtYmVyIikgewogICAgICB4SGVpZ2h0ID0gMDsKICAgIH0KICAgIGxldCBjYXBIZWlnaHQgPSBkZXNjcmlwdG9yLmdldCgiQ2FwSGVpZ2h0Iik7CiAgICBpZiAodHlwZW9mIGNhcEhlaWdodCAhPT0gIm51bWJlciIpIHsKICAgICAgY2FwSGVpZ2h0ID0gMDsKICAgIH0KICAgIGxldCBmbGFncyA9IGRlc2NyaXB0b3IuZ2V0KCJGbGFncyIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZsYWdzKSkgewogICAgICBmbGFncyA9IDA7CiAgICB9CiAgICBsZXQgaXRhbGljQW5nbGUgPSBkZXNjcmlwdG9yLmdldCgiSXRhbGljQW5nbGUiKTsKICAgIGlmICh0eXBlb2YgaXRhbGljQW5nbGUgIT09ICJudW1iZXIiKSB7CiAgICAgIGl0YWxpY0FuZ2xlID0gMDsKICAgIH0KICAgIGNvbnN0IHByb3BlcnRpZXMgPSB7CiAgICAgIHR5cGUsCiAgICAgIG5hbWU6IGZvbnROYW1lLm5hbWUsCiAgICAgIHN1YnR5cGUsCiAgICAgIGZpbGU6IGZvbnRGaWxlLAogICAgICBsZW5ndGgxLAogICAgICBsZW5ndGgyLAogICAgICBsZW5ndGgzLAogICAgICBpc0ludGVybmFsRm9udCwKICAgICAgbG9hZGVkTmFtZTogYmFzZURpY3QubG9hZGVkTmFtZSwKICAgICAgY29tcG9zaXRlLAogICAgICBmaXhlZFBpdGNoOiBmYWxzZSwKICAgICAgZm9udE1hdHJpeCwKICAgICAgZmlyc3RDaGFyLAogICAgICBsYXN0Q2hhciwKICAgICAgdG9Vbmljb2RlLAogICAgICBiYm94LAogICAgICBhc2NlbnQsCiAgICAgIGRlc2NlbnQsCiAgICAgIHhIZWlnaHQsCiAgICAgIGNhcEhlaWdodCwKICAgICAgZmxhZ3MsCiAgICAgIGl0YWxpY0FuZ2xlLAogICAgICBpc1R5cGUzRm9udCwKICAgICAgY3NzRm9udEluZm8sCiAgICAgIHNjYWxlRmFjdG9yczogZ2x5cGhTY2FsZUZhY3RvcnMsCiAgICAgIHN5c3RlbUZvbnRJbmZvCiAgICB9OwogICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICBjb25zdCBjaWRFbmNvZGluZyA9IGJhc2VEaWN0LmdldCgiRW5jb2RpbmciKTsKICAgICAgaWYgKGNpZEVuY29kaW5nIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIHByb3BlcnRpZXMuY2lkRW5jb2RpbmcgPSBjaWRFbmNvZGluZy5uYW1lOwogICAgICB9CiAgICAgIGNvbnN0IGNNYXAgPSBhd2FpdCBDTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgIGVuY29kaW5nOiBjaWRFbmNvZGluZywKICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICB9KTsKICAgICAgcHJvcGVydGllcy5jTWFwID0gY01hcDsKICAgICAgcHJvcGVydGllcy52ZXJ0aWNhbCA9IHByb3BlcnRpZXMuY01hcC52ZXJ0aWNhbDsKICAgIH0KICAgIGNvbnN0IG5ld1Byb3BlcnRpZXMgPSBhd2FpdCB0aGlzLmV4dHJhY3REYXRhU3RydWN0dXJlcyhkaWN0LCBwcm9wZXJ0aWVzKTsKICAgIHRoaXMuZXh0cmFjdFdpZHRocyhkaWN0LCBkZXNjcmlwdG9yLCBuZXdQcm9wZXJ0aWVzKTsKICAgIHJldHVybiBuZXcgRm9udChmb250TmFtZS5uYW1lLCBmb250RmlsZSwgbmV3UHJvcGVydGllcywgdGhpcy5vcHRpb25zKTsKICB9CiAgc3RhdGljIGJ1aWxkRm9udFBhdGhzKGZvbnQsIGdseXBocywgaGFuZGxlciwgZXZhbHVhdG9yT3B0aW9ucykgewogICAgZnVuY3Rpb24gYnVpbGRQYXRoKGZvbnRDaGFyKSB7CiAgICAgIGNvbnN0IGdseXBoTmFtZSA9IGAke2ZvbnQubG9hZGVkTmFtZX1fcGF0aF8ke2ZvbnRDaGFyfWA7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGZvbnQucmVuZGVyZXIuaGFzQnVpbHRQYXRoKGZvbnRDaGFyKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBidWZmZXIgPSBGb250UGF0aEluZm8ud3JpdGUoZm9udC5yZW5kZXJlci5nZXRQYXRoSnMoZm9udENoYXIpKTsKICAgICAgICBoYW5kbGVyLnNlbmQoImNvbW1vbm9iaiIsIFtnbHlwaE5hbWUsICJGb250UGF0aCIsIGJ1ZmZlcl0sIFtidWZmZXJdKTsKICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgaWYgKGV2YWx1YXRvck9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICB3YXJuKGBidWlsZEZvbnRQYXRocyAtIGlnbm9yaW5nICR7Z2x5cGhOYW1lfSBnbHlwaDogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBnbHlwaCBvZiBnbHlwaHMpIHsKICAgICAgYnVpbGRQYXRoKGdseXBoLmZvbnRDaGFyKTsKICAgICAgY29uc3QgYWNjZW50ID0gZ2x5cGguYWNjZW50OwogICAgICBpZiAoYWNjZW50Py5mb250Q2hhcikgewogICAgICAgIGJ1aWxkUGF0aChhY2NlbnQuZm9udENoYXIpOwogICAgICB9CiAgICB9CiAgfQogIHN0YXRpYyBnZXQgZmFsbGJhY2tGb250RGljdCgpIHsKICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCgpOwogICAgZGljdC5zZXQoIkJhc2VGb250IiwgTmFtZS5nZXQoIkhlbHZldGljYSIpKTsKICAgIGRpY3Quc2V0KCJUeXBlIiwgTmFtZS5nZXQoIkZhbGxiYWNrVHlwZSIpKTsKICAgIGRpY3Quc2V0KCJTdWJ0eXBlIiwgTmFtZS5nZXQoIkZhbGxiYWNrVHlwZSIpKTsKICAgIGRpY3Quc2V0KCJFbmNvZGluZyIsIE5hbWUuZ2V0KCJXaW5BbnNpRW5jb2RpbmciKSk7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJmYWxsYmFja0ZvbnREaWN0IiwgZGljdCk7CiAgfQp9CmNsYXNzIFRyYW5zbGF0ZWRGb250IHsKICAjc2VudCA9IGZhbHNlOwogICN0eXBlM0xvYWRlZCA9IG51bGw7CiAgY29uc3RydWN0b3IoewogICAgbG9hZGVkTmFtZSwKICAgIGZvbnQsCiAgICBkaWN0CiAgfSkgewogICAgdGhpcy5sb2FkZWROYW1lID0gbG9hZGVkTmFtZTsKICAgIHRoaXMuZm9udCA9IGZvbnQ7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogICAgdGhpcy50eXBlM0RlcGVuZGVuY2llcyA9IGZvbnQuaXNUeXBlM0ZvbnQgPyBuZXcgU2V0KCkgOiBudWxsOwogIH0KICBzZW5kKGhhbmRsZXIpIHsKICAgIGlmICh0aGlzLiNzZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI3NlbnQgPSB0cnVlOwogICAgY29uc3QgZm9udERhdGEgPSB0aGlzLmZvbnQuZXhwb3J0RGF0YSgpOwogICAgY29uc3QgdHJhbnNmZXIgPSBbXTsKICAgIGlmIChmb250RGF0YS5kYXRhKSB7CiAgICAgIGlmIChmb250RGF0YS5kYXRhLmNoYXJQcm9jT3BlcmF0b3JMaXN0KSB7CiAgICAgICAgZm9udERhdGEuY2hhclByb2NPcGVyYXRvckxpc3QgPSBmb250RGF0YS5kYXRhLmNoYXJQcm9jT3BlcmF0b3JMaXN0OwogICAgICB9CiAgICAgIGZvbnREYXRhLmRhdGEgPSBGb250SW5mby53cml0ZShmb250RGF0YS5kYXRhKTsKICAgICAgdHJhbnNmZXIucHVzaChmb250RGF0YS5kYXRhKTsKICAgIH0KICAgIGhhbmRsZXIuc2VuZCgiY29tbW9ub2JqIiwgW3RoaXMubG9hZGVkTmFtZSwgIkZvbnQiLCBmb250RGF0YV0sIHRyYW5zZmVyKTsKICB9CiAgZmFsbGJhY2soaGFuZGxlciwgZXZhbHVhdG9yT3B0aW9ucykgewogICAgaWYgKCF0aGlzLmZvbnQuZGF0YSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmZvbnQuZGlzYWJsZUZvbnRGYWNlID0gdHJ1ZTsKICAgIFBhcnRpYWxFdmFsdWF0b3IuYnVpbGRGb250UGF0aHModGhpcy5mb250LCB0aGlzLmZvbnQuZ2x5cGhDYWNoZVZhbHVlcywgaGFuZGxlciwgZXZhbHVhdG9yT3B0aW9ucyk7CiAgfQogIGxvYWRUeXBlM0RhdGEoZXZhbHVhdG9yLCByZXNvdXJjZXMsIHRhc2spIHsKICAgIGlmICh0aGlzLiN0eXBlM0xvYWRlZCkgewogICAgICByZXR1cm4gdGhpcy4jdHlwZTNMb2FkZWQ7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGZvbnQsCiAgICAgIHR5cGUzRGVwZW5kZW5jaWVzCiAgICB9ID0gdGhpczsKICAgIGFzc2VydChmb250LmlzVHlwZTNGb250LCAiTXVzdCBiZSBhIFR5cGUzIGZvbnQuIik7CiAgICBjb25zdCB0eXBlM0V2YWx1YXRvciA9IGV2YWx1YXRvci5jbG9uZSh7CiAgICAgIGlnbm9yZUVycm9yczogZmFsc2UKICAgIH0pOwogICAgY29uc3QgdHlwZTNGb250UmVmcyA9IG5ldyBSZWZTZXQoZXZhbHVhdG9yLnR5cGUzRm9udFJlZnMpOwogICAgaWYgKHRoaXMuZGljdC5vYmpJZCAmJiAhdHlwZTNGb250UmVmcy5oYXModGhpcy5kaWN0Lm9iaklkKSkgewogICAgICB0eXBlM0ZvbnRSZWZzLnB1dCh0aGlzLmRpY3Qub2JqSWQpOwogICAgfQogICAgdHlwZTNFdmFsdWF0b3IudHlwZTNGb250UmVmcyA9IHR5cGUzRm9udFJlZnM7CiAgICBsZXQgbG9hZENoYXJQcm9jc1Byb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTsKICAgIGNvbnN0IGNoYXJQcm9jcyA9IHRoaXMuZGljdC5nZXQoIkNoYXJQcm9jcyIpOwogICAgY29uc3QgZm9udFJlc291cmNlcyA9IHRoaXMuZGljdC5nZXQoIlJlc291cmNlcyIpIHx8IHJlc291cmNlczsKICAgIGNvbnN0IGNoYXJQcm9jT3BlcmF0b3JMaXN0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGNvbnN0IFt4MCwgeTAsIHgxLCB5MV0gPSBmb250LmJib3gsCiAgICAgIHdpZHRoID0geDEgLSB4MCwKICAgICAgaGVpZ2h0ID0geTEgLSB5MDsKICAgIGNvbnN0IGZvbnRCQm94U2l6ZSA9IE1hdGguaHlwb3Qod2lkdGgsIGhlaWdodCk7CiAgICBmb3IgKGNvbnN0IGtleSBvZiBjaGFyUHJvY3MuZ2V0S2V5cygpKSB7CiAgICAgIGxvYWRDaGFyUHJvY3NQcm9taXNlID0gbG9hZENoYXJQcm9jc1Byb21pc2UudGhlbigoKSA9PiB7CiAgICAgICAgY29uc3QgZ2x5cGhTdHJlYW0gPSBjaGFyUHJvY3MuZ2V0KGtleSk7CiAgICAgICAgY29uc3Qgb3BlcmF0b3JMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgICAgIHJldHVybiB0eXBlM0V2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICAgICAgc3RyZWFtOiBnbHlwaFN0cmVhbSwKICAgICAgICAgIHRhc2ssCiAgICAgICAgICByZXNvdXJjZXM6IGZvbnRSZXNvdXJjZXMsCiAgICAgICAgICBvcGVyYXRvckxpc3QKICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgIHN3aXRjaCAob3BlcmF0b3JMaXN0LmZuQXJyYXlbMF0pIHsKICAgICAgICAgICAgY2FzZSBPUFMuc2V0Q2hhcldpZHRoQW5kQm91bmRzOgogICAgICAgICAgICAgIHRoaXMuI3JlbW92ZVR5cGUzQ29sb3JPcGVyYXRvcnMob3BlcmF0b3JMaXN0LCBmb250QkJveFNpemUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIE9QUy5zZXRDaGFyV2lkdGg6CiAgICAgICAgICAgICAgaWYgKCFmb250QkJveFNpemUpIHsKICAgICAgICAgICAgICAgIHRoaXMuI2d1ZXNzVHlwZTNGb250QkJveChvcGVyYXRvckxpc3QpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGNoYXJQcm9jT3BlcmF0b3JMaXN0W2tleV0gPSBvcGVyYXRvckxpc3QuZ2V0SVIoKTsKICAgICAgICAgIGZvciAoY29uc3QgZGVwZW5kZW5jeSBvZiBvcGVyYXRvckxpc3QuZGVwZW5kZW5jaWVzKSB7CiAgICAgICAgICAgIHR5cGUzRGVwZW5kZW5jaWVzLmFkZChkZXBlbmRlbmN5KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICB3YXJuKGBUeXBlMyBmb250IHJlc291cmNlICIke2tleX0iIGlzIG5vdCBhdmFpbGFibGUuYCk7CiAgICAgICAgICBjb25zdCBkdW1teU9wZXJhdG9yTGlzdCA9IG5ldyBPcGVyYXRvckxpc3QoKTsKICAgICAgICAgIGNoYXJQcm9jT3BlcmF0b3JMaXN0W2tleV0gPSBkdW1teU9wZXJhdG9yTGlzdC5nZXRJUigpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIHRoaXMuI3R5cGUzTG9hZGVkID0gbG9hZENoYXJQcm9jc1Byb21pc2UudGhlbigoKSA9PiB7CiAgICAgIGZvbnQuY2hhclByb2NPcGVyYXRvckxpc3QgPSBjaGFyUHJvY09wZXJhdG9yTGlzdDsKICAgICAgaWYgKHRoaXMuX2Jib3gpIHsKICAgICAgICBmb250LmlzQ2hhckJCb3ggPSB0cnVlOwogICAgICAgIGZvbnQuYmJveCA9IHRoaXMuX2Jib3g7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHRoaXMuI3R5cGUzTG9hZGVkOwogIH0KICAjcmVtb3ZlVHlwZTNDb2xvck9wZXJhdG9ycyhvcGVyYXRvckxpc3QsIGZvbnRCQm94U2l6ZSA9IE5hTikgewogICAgY29uc3QgY2hhckJCb3ggPSBVdGlsLm5vcm1hbGl6ZVJlY3Qob3BlcmF0b3JMaXN0LmFyZ3NBcnJheVswXS5zbGljZSgyKSksCiAgICAgIHdpZHRoID0gY2hhckJCb3hbMl0gLSBjaGFyQkJveFswXSwKICAgICAgaGVpZ2h0ID0gY2hhckJCb3hbM10gLSBjaGFyQkJveFsxXTsKICAgIGNvbnN0IGNoYXJCQm94U2l6ZSA9IE1hdGguaHlwb3Qod2lkdGgsIGhlaWdodCk7CiAgICBpZiAod2lkdGggPT09IDAgfHwgaGVpZ2h0ID09PSAwKSB7CiAgICAgIG9wZXJhdG9yTGlzdC5mbkFycmF5LnNwbGljZSgwLCAxKTsKICAgICAgb3BlcmF0b3JMaXN0LmFyZ3NBcnJheS5zcGxpY2UoMCwgMSk7CiAgICB9IGVsc2UgaWYgKGZvbnRCQm94U2l6ZSA9PT0gMCB8fCBNYXRoLnJvdW5kKGNoYXJCQm94U2l6ZSAvIGZvbnRCQm94U2l6ZSkgPj0gMTApIHsKICAgICAgdGhpcy5fYmJveCA/Pz0gW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldOwogICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveCguLi5jaGFyQkJveCwgdGhpcy5fYmJveCk7CiAgICB9CiAgICBsZXQgaSA9IDAsCiAgICAgIGlpID0gb3BlcmF0b3JMaXN0Lmxlbmd0aDsKICAgIHdoaWxlIChpIDwgaWkpIHsKICAgICAgc3dpdGNoIChvcGVyYXRvckxpc3QuZm5BcnJheVtpXSkgewogICAgICAgIGNhc2UgT1BTLnNldENoYXJXaWR0aEFuZEJvdW5kczoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUNvbG9yU3BhY2U6CiAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENvbG9yU3BhY2U6CiAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3I6CiAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3JOOgogICAgICAgIGNhc2UgT1BTLnNldEZpbGxDb2xvcjoKICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ29sb3JOOgogICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUdyYXk6CiAgICAgICAgY2FzZSBPUFMuc2V0RmlsbEdyYXk6CiAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlUkdCQ29sb3I6CiAgICAgICAgY2FzZSBPUFMuc2V0RmlsbFJHQkNvbG9yOgogICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUNNWUtDb2xvcjoKICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ01ZS0NvbG9yOgogICAgICAgIGNhc2UgT1BTLnNoYWRpbmdGaWxsOgogICAgICAgIGNhc2UgT1BTLnNldFJlbmRlcmluZ0ludGVudDoKICAgICAgICAgIG9wZXJhdG9yTGlzdC5mbkFycmF5LnNwbGljZShpLCAxKTsKICAgICAgICAgIG9wZXJhdG9yTGlzdC5hcmdzQXJyYXkuc3BsaWNlKGksIDEpOwogICAgICAgICAgaWktLTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNhc2UgT1BTLnNldEdTdGF0ZToKICAgICAgICAgIGNvbnN0IFtnU3RhdGVPYmpdID0gb3BlcmF0b3JMaXN0LmFyZ3NBcnJheVtpXTsKICAgICAgICAgIGxldCBqID0gMCwKICAgICAgICAgICAgamogPSBnU3RhdGVPYmoubGVuZ3RoOwogICAgICAgICAgd2hpbGUgKGogPCBqaikgewogICAgICAgICAgICBjb25zdCBbZ1N0YXRlS2V5XSA9IGdTdGF0ZU9ialtqXTsKICAgICAgICAgICAgc3dpdGNoIChnU3RhdGVLZXkpIHsKICAgICAgICAgICAgICBjYXNlICJUUiI6CiAgICAgICAgICAgICAgY2FzZSAiVFIyIjoKICAgICAgICAgICAgICBjYXNlICJIVCI6CiAgICAgICAgICAgICAgY2FzZSAiQkciOgogICAgICAgICAgICAgIGNhc2UgIkJHMiI6CiAgICAgICAgICAgICAgY2FzZSAiVUNSIjoKICAgICAgICAgICAgICBjYXNlICJVQ1IyIjoKICAgICAgICAgICAgICAgIGdTdGF0ZU9iai5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgICBqai0tOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaisrOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaSsrOwogICAgfQogIH0KICAjZ3Vlc3NUeXBlM0ZvbnRCQm94KG9wZXJhdG9yTGlzdCkgewogICAgbGV0IGkgPSAxOwogICAgY29uc3QgaWkgPSBvcGVyYXRvckxpc3QubGVuZ3RoOwogICAgd2hpbGUgKGkgPCBpaSkgewogICAgICBzd2l0Y2ggKG9wZXJhdG9yTGlzdC5mbkFycmF5W2ldKSB7CiAgICAgICAgY2FzZSBPUFMuY29uc3RydWN0UGF0aDoKICAgICAgICAgIGNvbnN0IG1pbk1heCA9IG9wZXJhdG9yTGlzdC5hcmdzQXJyYXlbaV1bMl07CiAgICAgICAgICB0aGlzLl9iYm94ID8/PSBbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV07CiAgICAgICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveCguLi5taW5NYXgsIHRoaXMuX2Jib3gpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaSsrOwogICAgfQogIH0KfQpjbGFzcyBTdGF0ZU1hbmFnZXIgewogIGNvbnN0cnVjdG9yKGluaXRpYWxTdGF0ZSA9IG5ldyBFdmFsU3RhdGUoKSkgewogICAgdGhpcy5zdGF0ZSA9IGluaXRpYWxTdGF0ZTsKICAgIHRoaXMuc3RhdGVTdGFjayA9IFtdOwogIH0KICBzYXZlKCkgewogICAgY29uc3Qgb2xkID0gdGhpcy5zdGF0ZTsKICAgIHRoaXMuc3RhdGVTdGFjay5wdXNoKHRoaXMuc3RhdGUpOwogICAgdGhpcy5zdGF0ZSA9IG9sZC5jbG9uZSgpOwogIH0KICByZXN0b3JlKCkgewogICAgY29uc3QgcHJldiA9IHRoaXMuc3RhdGVTdGFjay5wb3AoKTsKICAgIGlmIChwcmV2KSB7CiAgICAgIHRoaXMuc3RhdGUgPSBwcmV2OwogICAgfQogIH0KICB0cmFuc2Zvcm0oYXJncykgewogICAgdGhpcy5zdGF0ZS5jdG0gPSBVdGlsLnRyYW5zZm9ybSh0aGlzLnN0YXRlLmN0bSwgYXJncyk7CiAgfQp9CmNsYXNzIFRleHRTdGF0ZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLmN0bSA9IG5ldyBGbG9hdDMyQXJyYXkoSURFTlRJVFlfTUFUUklYKTsKICAgIHRoaXMuZm9udE5hbWUgPSBudWxsOwogICAgdGhpcy5mb250U2l6ZSA9IDA7CiAgICB0aGlzLmxvYWRlZE5hbWUgPSBudWxsOwogICAgdGhpcy5mb250ID0gbnVsbDsKICAgIHRoaXMuZm9udE1hdHJpeCA9IEZPTlRfSURFTlRJVFlfTUFUUklYOwogICAgdGhpcy50ZXh0TWF0cml4ID0gSURFTlRJVFlfTUFUUklYLnNsaWNlKCk7CiAgICB0aGlzLnRleHRMaW5lTWF0cml4ID0gSURFTlRJVFlfTUFUUklYLnNsaWNlKCk7CiAgICB0aGlzLmNoYXJTcGFjaW5nID0gMDsKICAgIHRoaXMud29yZFNwYWNpbmcgPSAwOwogICAgdGhpcy5sZWFkaW5nID0gMDsKICAgIHRoaXMudGV4dEhTY2FsZSA9IDE7CiAgICB0aGlzLnRleHRSaXNlID0gMDsKICB9CiAgc2V0VGV4dE1hdHJpeChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICBjb25zdCBtID0gdGhpcy50ZXh0TWF0cml4OwogICAgbVswXSA9IGE7CiAgICBtWzFdID0gYjsKICAgIG1bMl0gPSBjOwogICAgbVszXSA9IGQ7CiAgICBtWzRdID0gZTsKICAgIG1bNV0gPSBmOwogIH0KICBzZXRUZXh0TGluZU1hdHJpeChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICBjb25zdCBtID0gdGhpcy50ZXh0TGluZU1hdHJpeDsKICAgIG1bMF0gPSBhOwogICAgbVsxXSA9IGI7CiAgICBtWzJdID0gYzsKICAgIG1bM10gPSBkOwogICAgbVs0XSA9IGU7CiAgICBtWzVdID0gZjsKICB9CiAgdHJhbnNsYXRlVGV4dE1hdHJpeCh4LCB5KSB7CiAgICBjb25zdCBtID0gdGhpcy50ZXh0TWF0cml4OwogICAgbVs0XSA9IG1bMF0gKiB4ICsgbVsyXSAqIHkgKyBtWzRdOwogICAgbVs1XSA9IG1bMV0gKiB4ICsgbVszXSAqIHkgKyBtWzVdOwogIH0KICB0cmFuc2xhdGVUZXh0TGluZU1hdHJpeCh4LCB5KSB7CiAgICBjb25zdCBtID0gdGhpcy50ZXh0TGluZU1hdHJpeDsKICAgIG1bNF0gPSBtWzBdICogeCArIG1bMl0gKiB5ICsgbVs0XTsKICAgIG1bNV0gPSBtWzFdICogeCArIG1bM10gKiB5ICsgbVs1XTsKICB9CiAgY2FycmlhZ2VSZXR1cm4oKSB7CiAgICB0aGlzLnRyYW5zbGF0ZVRleHRMaW5lTWF0cml4KDAsIC10aGlzLmxlYWRpbmcpOwogICAgdGhpcy50ZXh0TWF0cml4ID0gdGhpcy50ZXh0TGluZU1hdHJpeC5zbGljZSgpOwogIH0KICBjbG9uZSgpIHsKICAgIGNvbnN0IGNsb25lID0gT2JqZWN0LmNyZWF0ZSh0aGlzKTsKICAgIGNsb25lLnRleHRNYXRyaXggPSB0aGlzLnRleHRNYXRyaXguc2xpY2UoKTsKICAgIGNsb25lLnRleHRMaW5lTWF0cml4ID0gdGhpcy50ZXh0TGluZU1hdHJpeC5zbGljZSgpOwogICAgY2xvbmUuZm9udE1hdHJpeCA9IHRoaXMuZm9udE1hdHJpeC5zbGljZSgpOwogICAgcmV0dXJuIGNsb25lOwogIH0KfQpjbGFzcyBFdmFsU3RhdGUgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5jdG0gPSBuZXcgRmxvYXQzMkFycmF5KElERU5USVRZX01BVFJJWCk7CiAgICB0aGlzLmZvbnQgPSBudWxsOwogICAgdGhpcy50ZXh0UmVuZGVyaW5nTW9kZSA9IFRleHRSZW5kZXJpbmdNb2RlLkZJTEw7CiAgICB0aGlzLl9maWxsQ29sb3JTcGFjZSA9IHRoaXMuX3N0cm9rZUNvbG9yU3BhY2UgPSBDb2xvclNwYWNlVXRpbHMuZ3JheTsKICAgIHRoaXMucGF0dGVybkZpbGxDb2xvclNwYWNlID0gbnVsbDsKICAgIHRoaXMucGF0dGVyblN0cm9rZUNvbG9yU3BhY2UgPSBudWxsOwogICAgdGhpcy5jdXJyZW50UG9pbnRYID0gdGhpcy5jdXJyZW50UG9pbnRZID0gMDsKICAgIHRoaXMucGF0aE1pbk1heCA9IG5ldyBGbG9hdDMyQXJyYXkoW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldKTsKICAgIHRoaXMucGF0aEJ1ZmZlciA9IFtdOwogIH0KICBnZXQgZmlsbENvbG9yU3BhY2UoKSB7CiAgICByZXR1cm4gdGhpcy5fZmlsbENvbG9yU3BhY2U7CiAgfQogIHNldCBmaWxsQ29sb3JTcGFjZShjb2xvclNwYWNlKSB7CiAgICB0aGlzLl9maWxsQ29sb3JTcGFjZSA9IHRoaXMucGF0dGVybkZpbGxDb2xvclNwYWNlID0gY29sb3JTcGFjZTsKICB9CiAgZ2V0IHN0cm9rZUNvbG9yU3BhY2UoKSB7CiAgICByZXR1cm4gdGhpcy5fc3Ryb2tlQ29sb3JTcGFjZTsKICB9CiAgc2V0IHN0cm9rZUNvbG9yU3BhY2UoY29sb3JTcGFjZSkgewogICAgdGhpcy5fc3Ryb2tlQ29sb3JTcGFjZSA9IHRoaXMucGF0dGVyblN0cm9rZUNvbG9yU3BhY2UgPSBjb2xvclNwYWNlOwogIH0KICBjbG9uZSh7CiAgICBuZXdQYXRoID0gZmFsc2UKICB9ID0ge30pIHsKICAgIGNvbnN0IGNsb25lID0gT2JqZWN0LmNyZWF0ZSh0aGlzKTsKICAgIGlmIChuZXdQYXRoKSB7CiAgICAgIGNsb25lLnBhdGhCdWZmZXIgPSBbXTsKICAgICAgY2xvbmUucGF0aE1pbk1heCA9IG5ldyBGbG9hdDMyQXJyYXkoW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldKTsKICAgIH0KICAgIHJldHVybiBjbG9uZTsKICB9Cn0KY2xhc3MgRXZhbHVhdG9yUHJlcHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IG9wTWFwKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAib3BNYXAiLCBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUobnVsbCksIHsKICAgICAgdzogewogICAgICAgIGlkOiBPUFMuc2V0TGluZVdpZHRoLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBKOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRMaW5lQ2FwLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBqOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRMaW5lSm9pbiwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgTTogewogICAgICAgIGlkOiBPUFMuc2V0TWl0ZXJMaW1pdCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgZDogewogICAgICAgIGlkOiBPUFMuc2V0RGFzaCwKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgcmk6IHsKICAgICAgICBpZDogT1BTLnNldFJlbmRlcmluZ0ludGVudCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgaTogewogICAgICAgIGlkOiBPUFMuc2V0RmxhdG5lc3MsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGdzOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRHU3RhdGUsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHE6IHsKICAgICAgICBpZDogT1BTLnNhdmUsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFE6IHsKICAgICAgICBpZDogT1BTLnJlc3RvcmUsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGNtOiB7CiAgICAgICAgaWQ6IE9QUy50cmFuc2Zvcm0sCiAgICAgICAgbnVtQXJnczogNiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIG06IHsKICAgICAgICBpZDogT1BTLm1vdmVUbywKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgbDogewogICAgICAgIGlkOiBPUFMubGluZVRvLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBjOiB7CiAgICAgICAgaWQ6IE9QUy5jdXJ2ZVRvLAogICAgICAgIG51bUFyZ3M6IDYsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICB2OiB7CiAgICAgICAgaWQ6IE9QUy5jdXJ2ZVRvMiwKICAgICAgICBudW1BcmdzOiA0LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgeTogewogICAgICAgIGlkOiBPUFMuY3VydmVUbzMsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGg6IHsKICAgICAgICBpZDogT1BTLmNsb3NlUGF0aCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgcmU6IHsKICAgICAgICBpZDogT1BTLnJlY3RhbmdsZSwKICAgICAgICBudW1BcmdzOiA0LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgUzogewogICAgICAgIGlkOiBPUFMuc3Ryb2tlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBzOiB7CiAgICAgICAgaWQ6IE9QUy5jbG9zZVN0cm9rZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgZjogewogICAgICAgIGlkOiBPUFMuZmlsbCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRjogewogICAgICAgIGlkOiBPUFMuZmlsbCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgImYqIjogewogICAgICAgIGlkOiBPUFMuZW9GaWxsLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCOiB7CiAgICAgICAgaWQ6IE9QUy5maWxsU3Ryb2tlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAiQioiOiB7CiAgICAgICAgaWQ6IE9QUy5lb0ZpbGxTdHJva2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGI6IHsKICAgICAgICBpZDogT1BTLmNsb3NlRmlsbFN0cm9rZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgImIqIjogewogICAgICAgIGlkOiBPUFMuY2xvc2VFT0ZpbGxTdHJva2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIG46IHsKICAgICAgICBpZDogT1BTLmVuZFBhdGgsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFc6IHsKICAgICAgICBpZDogT1BTLmNsaXAsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICJXKiI6IHsKICAgICAgICBpZDogT1BTLmVvQ2xpcCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQlQ6IHsKICAgICAgICBpZDogT1BTLmJlZ2luVGV4dCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRVQ6IHsKICAgICAgICBpZDogT1BTLmVuZFRleHQsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRjOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRDaGFyU3BhY2luZywKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVHc6IHsKICAgICAgICBpZDogT1BTLnNldFdvcmRTcGFjaW5nLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUejogewogICAgICAgIGlkOiBPUFMuc2V0SFNjYWxlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUTDogewogICAgICAgIGlkOiBPUFMuc2V0TGVhZGluZywKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVGY6IHsKICAgICAgICBpZDogT1BTLnNldEZvbnQsCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRyOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRUZXh0UmVuZGVyaW5nTW9kZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVHM6IHsKICAgICAgICBpZDogT1BTLnNldFRleHRSaXNlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUZDogewogICAgICAgIGlkOiBPUFMubW92ZVRleHQsCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFREOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRMZWFkaW5nTW92ZVRleHQsCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRtOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRUZXh0TWF0cml4LAogICAgICAgIG51bUFyZ3M6IDYsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAiVCoiOiB7CiAgICAgICAgaWQ6IE9QUy5uZXh0TGluZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVGo6IHsKICAgICAgICBpZDogT1BTLnNob3dUZXh0LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUSjogewogICAgICAgIGlkOiBPUFMuc2hvd1NwYWNlZFRleHQsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICInIjogewogICAgICAgIGlkOiBPUFMubmV4dExpbmVTaG93VGV4dCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgJyInOiB7CiAgICAgICAgaWQ6IE9QUy5uZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dCwKICAgICAgICBudW1BcmdzOiAzLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgZDA6IHsKICAgICAgICBpZDogT1BTLnNldENoYXJXaWR0aCwKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgZDE6IHsKICAgICAgICBpZDogT1BTLnNldENoYXJXaWR0aEFuZEJvdW5kcywKICAgICAgICBudW1BcmdzOiA2LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQ1M6IHsKICAgICAgICBpZDogT1BTLnNldFN0cm9rZUNvbG9yU3BhY2UsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGNzOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRGaWxsQ29sb3JTcGFjZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgU0M6IHsKICAgICAgICBpZDogT1BTLnNldFN0cm9rZUNvbG9yLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiB0cnVlCiAgICAgIH0sCiAgICAgIFNDTjogewogICAgICAgIGlkOiBPUFMuc2V0U3Ryb2tlQ29sb3JOLAogICAgICAgIG51bUFyZ3M6IDMzLAogICAgICAgIHZhcmlhYmxlQXJnczogdHJ1ZQogICAgICB9LAogICAgICBzYzogewogICAgICAgIGlkOiBPUFMuc2V0RmlsbENvbG9yLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiB0cnVlCiAgICAgIH0sCiAgICAgIHNjbjogewogICAgICAgIGlkOiBPUFMuc2V0RmlsbENvbG9yTiwKICAgICAgICBudW1BcmdzOiAzMywKICAgICAgICB2YXJpYWJsZUFyZ3M6IHRydWUKICAgICAgfSwKICAgICAgRzogewogICAgICAgIGlkOiBPUFMuc2V0U3Ryb2tlR3JheSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgZzogewogICAgICAgIGlkOiBPUFMuc2V0RmlsbEdyYXksCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFJHOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRTdHJva2VSR0JDb2xvciwKICAgICAgICBudW1BcmdzOiAzLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgcmc6IHsKICAgICAgICBpZDogT1BTLnNldEZpbGxSR0JDb2xvciwKICAgICAgICBudW1BcmdzOiAzLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgSzogewogICAgICAgIGlkOiBPUFMuc2V0U3Ryb2tlQ01ZS0NvbG9yLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBrOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRGaWxsQ01ZS0NvbG9yLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBzaDogewogICAgICAgIGlkOiBPUFMuc2hhZGluZ0ZpbGwsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEJJOiB7CiAgICAgICAgaWQ6IE9QUy5iZWdpbklubGluZUltYWdlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBJRDogewogICAgICAgIGlkOiBPUFMuYmVnaW5JbWFnZURhdGEsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEVJOiB7CiAgICAgICAgaWQ6IE9QUy5lbmRJbmxpbmVJbWFnZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRG86IHsKICAgICAgICBpZDogT1BTLnBhaW50WE9iamVjdCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgTVA6IHsKICAgICAgICBpZDogT1BTLm1hcmtQb2ludCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRFA6IHsKICAgICAgICBpZDogT1BTLm1hcmtQb2ludFByb3BzLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCTUM6IHsKICAgICAgICBpZDogT1BTLmJlZ2luTWFya2VkQ29udGVudCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQkRDOiB7CiAgICAgICAgaWQ6IE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRU1DOiB7CiAgICAgICAgaWQ6IE9QUy5lbmRNYXJrZWRDb250ZW50LAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCWDogewogICAgICAgIGlkOiBPUFMuYmVnaW5Db21wYXQsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEVYOiB7CiAgICAgICAgaWQ6IE9QUy5lbmRDb21wYXQsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEJNOiBudWxsLAogICAgICBCRDogbnVsbCwKICAgICAgdHJ1ZTogbnVsbCwKICAgICAgZmE6IG51bGwsCiAgICAgIGZhbDogbnVsbCwKICAgICAgZmFsczogbnVsbCwKICAgICAgZmFsc2U6IG51bGwsCiAgICAgIG51OiBudWxsLAogICAgICBudWw6IG51bGwsCiAgICAgIG51bGw6IG51bGwKICAgIH0pKTsKICB9CiAgc3RhdGljIE1BWF9JTlZBTElEX1BBVEhfT1BTID0gMTA7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCB4cmVmLCBzdGF0ZU1hbmFnZXIgPSBuZXcgU3RhdGVNYW5hZ2VyKCkpIHsKICAgIHRoaXMucGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgIGxleGVyOiBuZXcgTGV4ZXIoc3RyZWFtLCBFdmFsdWF0b3JQcmVwcm9jZXNzb3Iub3BNYXApLAogICAgICB4cmVmCiAgICB9KTsKICAgIHRoaXMuc3RhdGVNYW5hZ2VyID0gc3RhdGVNYW5hZ2VyOwogICAgdGhpcy5ub25Qcm9jZXNzZWRBcmdzID0gW107CiAgICB0aGlzLl9pc1BhdGhPcCA9IGZhbHNlOwogICAgdGhpcy5fbnVtSW52YWxpZFBhdGhPUFMgPSAwOwogIH0KICBnZXQgc2F2ZWRTdGF0ZXNEZXB0aCgpIHsKICAgIHJldHVybiB0aGlzLnN0YXRlTWFuYWdlci5zdGF0ZVN0YWNrLmxlbmd0aDsKICB9CiAgcmVhZChvcGVyYXRpb24pIHsKICAgIGxldCBhcmdzID0gb3BlcmF0aW9uLmFyZ3M7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBjb25zdCBvYmogPSB0aGlzLnBhcnNlci5nZXRPYmooKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIENtZCkgewogICAgICAgIGNvbnN0IGNtZCA9IG9iai5jbWQ7CiAgICAgICAgY29uc3Qgb3BTcGVjID0gRXZhbHVhdG9yUHJlcHJvY2Vzc29yLm9wTWFwW2NtZF07CiAgICAgICAgaWYgKCFvcFNwZWMpIHsKICAgICAgICAgIHdhcm4oYFVua25vd24gY29tbWFuZCAiJHtjbWR9Ii5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBmbiA9IG9wU3BlYy5pZDsKICAgICAgICBjb25zdCBudW1BcmdzID0gb3BTcGVjLm51bUFyZ3M7CiAgICAgICAgbGV0IGFyZ3NMZW5ndGggPSBhcmdzICE9PSBudWxsID8gYXJncy5sZW5ndGggOiAwOwogICAgICAgIGlmICghdGhpcy5faXNQYXRoT3ApIHsKICAgICAgICAgIHRoaXMuX251bUludmFsaWRQYXRoT1BTID0gMDsKICAgICAgICB9CiAgICAgICAgdGhpcy5faXNQYXRoT3AgPSBmbiA+PSBPUFMubW92ZVRvICYmIGZuIDw9IE9QUy5lbmRQYXRoOwogICAgICAgIGlmICghb3BTcGVjLnZhcmlhYmxlQXJncykgewogICAgICAgICAgaWYgKGFyZ3NMZW5ndGggIT09IG51bUFyZ3MpIHsKICAgICAgICAgICAgY29uc3Qgbm9uUHJvY2Vzc2VkQXJncyA9IHRoaXMubm9uUHJvY2Vzc2VkQXJnczsKICAgICAgICAgICAgd2hpbGUgKGFyZ3NMZW5ndGggPiBudW1BcmdzKSB7CiAgICAgICAgICAgICAgbm9uUHJvY2Vzc2VkQXJncy5wdXNoKGFyZ3Muc2hpZnQoKSk7CiAgICAgICAgICAgICAgYXJnc0xlbmd0aC0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlIChhcmdzTGVuZ3RoIDwgbnVtQXJncyAmJiBub25Qcm9jZXNzZWRBcmdzLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgIGlmIChhcmdzID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBhcmdzID0gW107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFyZ3MudW5zaGlmdChub25Qcm9jZXNzZWRBcmdzLnBvcCgpKTsKICAgICAgICAgICAgICBhcmdzTGVuZ3RoKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChhcmdzTGVuZ3RoIDwgbnVtQXJncykgewogICAgICAgICAgICBjb25zdCBwYXJ0aWFsTXNnID0gYGNvbW1hbmQgJHtjbWR9OiBleHBlY3RlZCAke251bUFyZ3N9IGFyZ3MsIGAgKyBgYnV0IHJlY2VpdmVkICR7YXJnc0xlbmd0aH0gYXJncy5gOwogICAgICAgICAgICBpZiAodGhpcy5faXNQYXRoT3AgJiYgKyt0aGlzLl9udW1JbnZhbGlkUGF0aE9QUyA+IEV2YWx1YXRvclByZXByb2Nlc3Nvci5NQVhfSU5WQUxJRF9QQVRIX09QUykgewogICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCAke3BhcnRpYWxNc2d9YCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2FybihgU2tpcHBpbmcgJHtwYXJ0aWFsTXNnfWApOwogICAgICAgICAgICBpZiAoYXJncyAhPT0gbnVsbCkgewogICAgICAgICAgICAgIGFyZ3MubGVuZ3RoID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGFyZ3NMZW5ndGggPiBudW1BcmdzKSB7CiAgICAgICAgICBpbmZvKGBDb21tYW5kICR7Y21kfTogZXhwZWN0ZWQgWzAsICR7bnVtQXJnc31dIGFyZ3MsIGAgKyBgYnV0IHJlY2VpdmVkICR7YXJnc0xlbmd0aH0gYXJncy5gKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wcmVwcm9jZXNzQ29tbWFuZChmbiwgYXJncyk7CiAgICAgICAgb3BlcmF0aW9uLmZuID0gZm47CiAgICAgICAgb3BlcmF0aW9uLmFyZ3MgPSBhcmdzOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChvYmogPT09IEVPRikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAob2JqICE9PSBudWxsKSB7CiAgICAgICAgaWYgKGFyZ3MgPT09IG51bGwpIHsKICAgICAgICAgIGFyZ3MgPSBbXTsKICAgICAgICB9CiAgICAgICAgYXJncy5wdXNoKG9iaik7CiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMzMpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVG9vIG1hbnkgYXJndW1lbnRzIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIHByZXByb2Nlc3NDb21tYW5kKGZuLCBhcmdzKSB7CiAgICBzd2l0Y2ggKGZuIHwgMCkgewogICAgICBjYXNlIE9QUy5zYXZlOgogICAgICAgIHRoaXMuc3RhdGVNYW5hZ2VyLnNhdmUoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBPUFMucmVzdG9yZToKICAgICAgICB0aGlzLnN0YXRlTWFuYWdlci5yZXN0b3JlKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgT1BTLnRyYW5zZm9ybToKICAgICAgICB0aGlzLnN0YXRlTWFuYWdlci50cmFuc2Zvcm0oYXJncyk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9kZWZhdWx0X2FwcGVhcmFuY2UuanMKCgoKCgoKCgpjbGFzcyBEZWZhdWx0QXBwZWFyYW5jZUV2YWx1YXRvciBleHRlbmRzIEV2YWx1YXRvclByZXByb2Nlc3NvciB7CiAgY29uc3RydWN0b3Ioc3RyKSB7CiAgICBzdXBlcihuZXcgU3RyaW5nU3RyZWFtKHN0cikpOwogIH0KICBwYXJzZSgpIHsKICAgIGNvbnN0IG9wZXJhdGlvbiA9IHsKICAgICAgZm46IDAsCiAgICAgIGFyZ3M6IFtdCiAgICB9OwogICAgY29uc3QgcmVzdWx0ID0gewogICAgICBmb250U2l6ZTogMCwKICAgICAgZm9udE5hbWU6ICIiLAogICAgICBmb250Q29sb3I6IG5ldyBVaW50OENsYW1wZWRBcnJheSgzKQogICAgfTsKICAgIHRyeSB7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgb3BlcmF0aW9uLmFyZ3MubGVuZ3RoID0gMDsKICAgICAgICBpZiAoIXRoaXMucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc2F2ZWRTdGF0ZXNEZXB0aCAhPT0gMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGZuLAogICAgICAgICAgYXJncwogICAgICAgIH0gPSBvcGVyYXRpb247CiAgICAgICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgICAgIGNhc2UgT1BTLnNldEZvbnQ6CiAgICAgICAgICAgIGNvbnN0IFtmb250TmFtZSwgZm9udFNpemVdID0gYXJnczsKICAgICAgICAgICAgaWYgKGZvbnROYW1lIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICAgIHJlc3VsdC5mb250TmFtZSA9IGZvbnROYW1lLm5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBmb250U2l6ZSA9PT0gIm51bWJlciIgJiYgZm9udFNpemUgPiAwKSB7CiAgICAgICAgICAgICAgcmVzdWx0LmZvbnRTaXplID0gZm9udFNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsUkdCQ29sb3I6CiAgICAgICAgICAgIENvbG9yU3BhY2VVdGlscy5yZ2IuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsR3JheToKICAgICAgICAgICAgQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ01ZS0NvbG9yOgogICAgICAgICAgICBDb2xvclNwYWNlVXRpbHMuY215ay5nZXRSZ2JJdGVtKGFyZ3MsIDAsIHJlc3VsdC5mb250Q29sb3IsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICB3YXJuKGBwYXJzZURlZmF1bHRBcHBlYXJhbmNlIC0gaWdub3JpbmcgZXJyb3JzOiAiJHtyZWFzb259Ii5gKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlRGVmYXVsdEFwcGVhcmFuY2Uoc3RyKSB7CiAgcmV0dXJuIG5ldyBEZWZhdWx0QXBwZWFyYW5jZUV2YWx1YXRvcihzdHIpLnBhcnNlKCk7Cn0KY2xhc3MgQXBwZWFyYW5jZVN0cmVhbUV2YWx1YXRvciBleHRlbmRzIEV2YWx1YXRvclByZXByb2Nlc3NvciB7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCBldmFsdWF0b3JPcHRpb25zLCB4cmVmLCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIHN1cGVyKHN0cmVhbSk7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMuZXZhbHVhdG9yT3B0aW9ucyA9IGV2YWx1YXRvck9wdGlvbnM7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUgPSBnbG9iYWxDb2xvclNwYWNlQ2FjaGU7CiAgICB0aGlzLnJlc291cmNlcyA9IHN0cmVhbS5kaWN0Py5nZXQoIlJlc291cmNlcyIpOwogIH0KICBwYXJzZSgpIHsKICAgIGNvbnN0IG9wZXJhdGlvbiA9IHsKICAgICAgZm46IDAsCiAgICAgIGFyZ3M6IFtdCiAgICB9OwogICAgbGV0IHJlc3VsdCA9IHsKICAgICAgc2NhbGVGYWN0b3I6IDEsCiAgICAgIGZvbnRTaXplOiAwLAogICAgICBmb250TmFtZTogIiIsCiAgICAgIGZvbnRDb2xvcjogbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpLAogICAgICBmaWxsQ29sb3JTcGFjZTogQ29sb3JTcGFjZVV0aWxzLmdyYXkKICAgIH07CiAgICBsZXQgYnJlYWtMb29wID0gZmFsc2U7CiAgICBjb25zdCBzdGFjayA9IFtdOwogICAgdHJ5IHsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBvcGVyYXRpb24uYXJncy5sZW5ndGggPSAwOwogICAgICAgIGlmIChicmVha0xvb3AgfHwgIXRoaXMucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29uc3QgewogICAgICAgICAgZm4sCiAgICAgICAgICBhcmdzCiAgICAgICAgfSA9IG9wZXJhdGlvbjsKICAgICAgICBzd2l0Y2ggKGZuIHwgMCkgewogICAgICAgICAgY2FzZSBPUFMuc2F2ZToKICAgICAgICAgICAgc3RhY2sucHVzaCh7CiAgICAgICAgICAgICAgc2NhbGVGYWN0b3I6IHJlc3VsdC5zY2FsZUZhY3RvciwKICAgICAgICAgICAgICBmb250U2l6ZTogcmVzdWx0LmZvbnRTaXplLAogICAgICAgICAgICAgIGZvbnROYW1lOiByZXN1bHQuZm9udE5hbWUsCiAgICAgICAgICAgICAgZm9udENvbG9yOiByZXN1bHQuZm9udENvbG9yLnNsaWNlKCksCiAgICAgICAgICAgICAgZmlsbENvbG9yU3BhY2U6IHJlc3VsdC5maWxsQ29sb3JTcGFjZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5yZXN0b3JlOgogICAgICAgICAgICByZXN1bHQgPSBzdGFjay5wb3AoKSB8fCByZXN1bHQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0VGV4dE1hdHJpeDoKICAgICAgICAgICAgcmVzdWx0LnNjYWxlRmFjdG9yICo9IE1hdGguaHlwb3QoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0Rm9udDoKICAgICAgICAgICAgY29uc3QgW2ZvbnROYW1lLCBmb250U2l6ZV0gPSBhcmdzOwogICAgICAgICAgICBpZiAoZm9udE5hbWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgcmVzdWx0LmZvbnROYW1lID0gZm9udE5hbWUubmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIGZvbnRTaXplID09PSAibnVtYmVyIiAmJiBmb250U2l6ZSA+IDApIHsKICAgICAgICAgICAgICByZXN1bHQuZm9udFNpemUgPSBmb250U2l6ZSAqIHJlc3VsdC5zY2FsZUZhY3RvcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxDb2xvclNwYWNlOgogICAgICAgICAgICByZXN1bHQuZmlsbENvbG9yU3BhY2UgPSBDb2xvclNwYWNlVXRpbHMucGFyc2UoewogICAgICAgICAgICAgIGNzOiBhcmdzWzBdLAogICAgICAgICAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgICAgICAgICByZXNvdXJjZXM6IHRoaXMucmVzb3VyY2VzLAogICAgICAgICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogdGhpcy5fcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICAgICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZTogdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgICAgICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGU6IHRoaXMuX2xvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxDb2xvcjoKICAgICAgICAgICAgY29uc3QgY3MgPSByZXN1bHQuZmlsbENvbG9yU3BhY2U7CiAgICAgICAgICAgIGNzLmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbFJHQkNvbG9yOgogICAgICAgICAgICBDb2xvclNwYWNlVXRpbHMucmdiLmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbEdyYXk6CiAgICAgICAgICAgIENvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENNWUtDb2xvcjoKICAgICAgICAgICAgQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaG93VGV4dDoKICAgICAgICAgIGNhc2UgT1BTLnNob3dTcGFjZWRUZXh0OgogICAgICAgICAgY2FzZSBPUFMubmV4dExpbmVTaG93VGV4dDoKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OgogICAgICAgICAgICBicmVha0xvb3AgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICB3YXJuKGBwYXJzZUFwcGVhcmFuY2VTdHJlYW0gLSBpZ25vcmluZyBlcnJvcnM6ICIke3JlYXNvbn0iLmApOwogICAgfQogICAgdGhpcy5zdHJlYW0ucmVzZXQoKTsKICAgIGRlbGV0ZSByZXN1bHQuc2NhbGVGYWN0b3I7CiAgICBkZWxldGUgcmVzdWx0LmZpbGxDb2xvclNwYWNlOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgZ2V0IF9sb2NhbENvbG9yU3BhY2VDYWNoZSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9sb2NhbENvbG9yU3BhY2VDYWNoZSIsIG5ldyBMb2NhbENvbG9yU3BhY2VDYWNoZSgpKTsKICB9CiAgZ2V0IF9wZGZGdW5jdGlvbkZhY3RvcnkoKSB7CiAgICBjb25zdCBwZGZGdW5jdGlvbkZhY3RvcnkgPSBuZXcgUERGRnVuY3Rpb25GYWN0b3J5KHsKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICBpc0V2YWxTdXBwb3J0ZWQ6IHRoaXMuZXZhbHVhdG9yT3B0aW9ucy5pc0V2YWxTdXBwb3J0ZWQKICAgIH0pOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3BkZkZ1bmN0aW9uRmFjdG9yeSIsIHBkZkZ1bmN0aW9uRmFjdG9yeSk7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlQXBwZWFyYW5jZVN0cmVhbShzdHJlYW0sIGV2YWx1YXRvck9wdGlvbnMsIHhyZWYsIGdsb2JhbENvbG9yU3BhY2VDYWNoZSkgewogIHJldHVybiBuZXcgQXBwZWFyYW5jZVN0cmVhbUV2YWx1YXRvcihzdHJlYW0sIGV2YWx1YXRvck9wdGlvbnMsIHhyZWYsIGdsb2JhbENvbG9yU3BhY2VDYWNoZSkucGFyc2UoKTsKfQpmdW5jdGlvbiBnZXRQZGZDb2xvcihjb2xvciwgaXNGaWxsKSB7CiAgaWYgKGNvbG9yWzBdID09PSBjb2xvclsxXSAmJiBjb2xvclsxXSA9PT0gY29sb3JbMl0pIHsKICAgIGNvbnN0IGdyYXkgPSBjb2xvclswXSAvIDI1NTsKICAgIHJldHVybiBgJHtudW1iZXJUb1N0cmluZyhncmF5KX0gJHtpc0ZpbGwgPyAiZyIgOiAiRyJ9YDsKICB9CiAgcmV0dXJuIEFycmF5LmZyb20oY29sb3IsIGMgPT4gbnVtYmVyVG9TdHJpbmcoYyAvIDI1NSkpLmpvaW4oIiAiKSArIGAgJHtpc0ZpbGwgPyAicmciIDogIlJHIn1gOwp9CmZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRBcHBlYXJhbmNlKHsKICBmb250U2l6ZSwKICBmb250TmFtZSwKICBmb250Q29sb3IKfSkgewogIHJldHVybiBgLyR7ZXNjYXBlUERGTmFtZShmb250TmFtZSl9ICR7Zm9udFNpemV9IFRmICR7Z2V0UGRmQ29sb3IoZm9udENvbG9yLCB0cnVlKX1gOwp9CmNsYXNzIEZha2VVbmljb2RlRm9udCB7CiAgY29uc3RydWN0b3IoeHJlZiwgZm9udEZhbWlseSkgewogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMud2lkdGhzID0gbnVsbDsKICAgIHRoaXMuZmlyc3RDaGFyID0gSW5maW5pdHk7CiAgICB0aGlzLmxhc3RDaGFyID0gLUluZmluaXR5OwogICAgdGhpcy5mb250RmFtaWx5ID0gZm9udEZhbWlseTsKICAgIGNvbnN0IGNhbnZhcyA9IG5ldyBPZmZzY3JlZW5DYW52YXMoMSwgMSk7CiAgICB0aGlzLmN0eE1lYXN1cmUgPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiLCB7CiAgICAgIHdpbGxSZWFkRnJlcXVlbnRseTogdHJ1ZQogICAgfSk7CiAgICBpZiAoIUZha2VVbmljb2RlRm9udC5fZm9udE5hbWVJZCkgewogICAgICBGYWtlVW5pY29kZUZvbnQuX2ZvbnROYW1lSWQgPSAxOwogICAgfQogICAgdGhpcy5mb250TmFtZSA9IE5hbWUuZ2V0KGBJbnZhbGlkUERGanNGb250XyR7Zm9udEZhbWlseX1fJHtGYWtlVW5pY29kZUZvbnQuX2ZvbnROYW1lSWQrK31gKTsKICB9CiAgZ2V0IGZvbnREZXNjcmlwdG9yUmVmKCkgewogICAgaWYgKCFGYWtlVW5pY29kZUZvbnQuX2ZvbnREZXNjcmlwdG9yUmVmKSB7CiAgICAgIGNvbnN0IGZvbnREZXNjcmlwdG9yID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0SWZOYW1lKCJUeXBlIiwgIkZvbnREZXNjcmlwdG9yIik7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldCgiRm9udE5hbWUiLCB0aGlzLmZvbnROYW1lKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0KCJGb250RmFtaWx5IiwgIk15cmlhZFBybyBSZWd1bGFyIik7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldCgiRm9udEJCb3giLCBbMCwgMCwgMCwgMF0pOwogICAgICBmb250RGVzY3JpcHRvci5zZXRJZk5hbWUoIkZvbnRTdHJldGNoIiwgIk5vcm1hbCIpOwogICAgICBmb250RGVzY3JpcHRvci5zZXQoIkZvbnRXZWlnaHQiLCA0MDApOwogICAgICBmb250RGVzY3JpcHRvci5zZXQoIkl0YWxpY0FuZ2xlIiwgMCk7CiAgICAgIEZha2VVbmljb2RlRm9udC5fZm9udERlc2NyaXB0b3JSZWYgPSB0aGlzLnhyZWYuZ2V0TmV3UGVyc2lzdGVudFJlZihmb250RGVzY3JpcHRvcik7CiAgICB9CiAgICByZXR1cm4gRmFrZVVuaWNvZGVGb250Ll9mb250RGVzY3JpcHRvclJlZjsKICB9CiAgZ2V0IGRlc2NlbmRhbnRGb250UmVmKCkgewogICAgY29uc3QgZGVzY2VuZGFudEZvbnQgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0KCJCYXNlRm9udCIsIHRoaXMuZm9udE5hbWUpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0SWZOYW1lKCJUeXBlIiwgIkZvbnQiKTsKICAgIGRlc2NlbmRhbnRGb250LnNldElmTmFtZSgiU3VidHlwZSIsICJDSURGb250VHlwZTAiKTsKICAgIGRlc2NlbmRhbnRGb250LnNldElmTmFtZSgiQ0lEVG9HSURNYXAiLCAiSWRlbnRpdHkiKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiRmlyc3RDaGFyIiwgdGhpcy5maXJzdENoYXIpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0KCJMYXN0Q2hhciIsIHRoaXMubGFzdENoYXIpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0KCJGb250RGVzY3JpcHRvciIsIHRoaXMuZm9udERlc2NyaXB0b3JSZWYpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0KCJEVyIsIDEwMDApOwogICAgY29uc3Qgd2lkdGhzID0gW107CiAgICBjb25zdCBjaGFycyA9IFsuLi50aGlzLndpZHRocy5lbnRyaWVzKCldLnNvcnQoKTsKICAgIGxldCBjdXJyZW50Q2hhciA9IG51bGw7CiAgICBsZXQgY3VycmVudFdpZHRocyA9IG51bGw7CiAgICBmb3IgKGNvbnN0IFtjaGFyLCB3aWR0aF0gb2YgY2hhcnMpIHsKICAgICAgaWYgKCFjdXJyZW50Q2hhcikgewogICAgICAgIGN1cnJlbnRDaGFyID0gY2hhcjsKICAgICAgICBjdXJyZW50V2lkdGhzID0gW3dpZHRoXTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoY2hhciA9PT0gY3VycmVudENoYXIgKyBjdXJyZW50V2lkdGhzLmxlbmd0aCkgewogICAgICAgIGN1cnJlbnRXaWR0aHMucHVzaCh3aWR0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2lkdGhzLnB1c2goY3VycmVudENoYXIsIGN1cnJlbnRXaWR0aHMpOwogICAgICAgIGN1cnJlbnRDaGFyID0gY2hhcjsKICAgICAgICBjdXJyZW50V2lkdGhzID0gW3dpZHRoXTsKICAgICAgfQogICAgfQogICAgaWYgKGN1cnJlbnRDaGFyKSB7CiAgICAgIHdpZHRocy5wdXNoKGN1cnJlbnRDaGFyLCBjdXJyZW50V2lkdGhzKTsKICAgIH0KICAgIGRlc2NlbmRhbnRGb250LnNldCgiVyIsIHdpZHRocyk7CiAgICBjb25zdCBjaWRTeXN0ZW1JbmZvID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgIGNpZFN5c3RlbUluZm8uc2V0KCJPcmRlcmluZyIsICJJZGVudGl0eSIpOwogICAgY2lkU3lzdGVtSW5mby5zZXQoIlJlZ2lzdHJ5IiwgIkFkb2JlIik7CiAgICBjaWRTeXN0ZW1JbmZvLnNldCgiU3VwcGxlbWVudCIsIDApOwogICAgZGVzY2VuZGFudEZvbnQuc2V0KCJDSURTeXN0ZW1JbmZvIiwgY2lkU3lzdGVtSW5mbyk7CiAgICByZXR1cm4gdGhpcy54cmVmLmdldE5ld1BlcnNpc3RlbnRSZWYoZGVzY2VuZGFudEZvbnQpOwogIH0KICBnZXQgYmFzZUZvbnRSZWYoKSB7CiAgICBjb25zdCBiYXNlRm9udCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBiYXNlRm9udC5zZXQoIkJhc2VGb250IiwgdGhpcy5mb250TmFtZSk7CiAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlR5cGUiLCAiRm9udCIpOwogICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIlR5cGUwIik7CiAgICBiYXNlRm9udC5zZXRJZk5hbWUoIkVuY29kaW5nIiwgIklkZW50aXR5LUgiKTsKICAgIGJhc2VGb250LnNldCgiRGVzY2VuZGFudEZvbnRzIiwgW3RoaXMuZGVzY2VuZGFudEZvbnRSZWZdKTsKICAgIGJhc2VGb250LnNldElmTmFtZSgiVG9Vbmljb2RlIiwgIklkZW50aXR5LUgiKTsKICAgIHJldHVybiB0aGlzLnhyZWYuZ2V0TmV3UGVyc2lzdGVudFJlZihiYXNlRm9udCk7CiAgfQogIGdldCByZXNvdXJjZXMoKSB7CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgY29uc3QgZm9udCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBmb250LnNldCh0aGlzLmZvbnROYW1lLm5hbWUsIHRoaXMuYmFzZUZvbnRSZWYpOwogICAgcmVzb3VyY2VzLnNldCgiRm9udCIsIGZvbnQpOwogICAgcmV0dXJuIHJlc291cmNlczsKICB9CiAgX2NyZWF0ZUNvbnRleHQoKSB7CiAgICB0aGlzLndpZHRocyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuY3R4TWVhc3VyZS5mb250ID0gYDEwMDBweCAke3RoaXMuZm9udEZhbWlseX1gOwogICAgcmV0dXJuIHRoaXMuY3R4TWVhc3VyZTsKICB9CiAgY3JlYXRlRm9udFJlc291cmNlcyh0ZXh0KSB7CiAgICBjb25zdCBjdHggPSB0aGlzLl9jcmVhdGVDb250ZXh0KCk7CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgdGV4dC5zcGxpdCgvXHJcbj98XG4vKSkgewogICAgICBmb3IgKGNvbnN0IGNoYXIgb2YgbGluZS5zcGxpdCgiIikpIHsKICAgICAgICBjb25zdCBjb2RlID0gY2hhci5jaGFyQ29kZUF0KDApOwogICAgICAgIGlmICh0aGlzLndpZHRocy5oYXMoY29kZSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBtZXRyaWNzID0gY3R4Lm1lYXN1cmVUZXh0KGNoYXIpOwogICAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5jZWlsKG1ldHJpY3Mud2lkdGgpOwogICAgICAgIHRoaXMud2lkdGhzLnNldChjb2RlLCB3aWR0aCk7CiAgICAgICAgdGhpcy5maXJzdENoYXIgPSBNYXRoLm1pbihjb2RlLCB0aGlzLmZpcnN0Q2hhcik7CiAgICAgICAgdGhpcy5sYXN0Q2hhciA9IE1hdGgubWF4KGNvZGUsIHRoaXMubGFzdENoYXIpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5yZXNvdXJjZXM7CiAgfQogIHN0YXRpYyBnZXRGaXJzdFBvc2l0aW9uSW5mbyhyZWN0LCByb3RhdGlvbiwgZm9udFNpemUpIHsKICAgIGNvbnN0IFt4MSwgeTEsIHgyLCB5Ml0gPSByZWN0OwogICAgbGV0IHcgPSB4MiAtIHgxOwogICAgbGV0IGggPSB5MiAtIHkxOwogICAgaWYgKHJvdGF0aW9uICUgMTgwICE9PSAwKSB7CiAgICAgIFt3LCBoXSA9IFtoLCB3XTsKICAgIH0KICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBMSU5FX0ZBQ1RPUiAqIGZvbnRTaXplOwogICAgY29uc3QgbGluZURlc2NlbnQgPSBMSU5FX0RFU0NFTlRfRkFDVE9SICogZm9udFNpemU7CiAgICByZXR1cm4gewogICAgICBjb29yZHM6IFswLCBoICsgbGluZURlc2NlbnQgLSBsaW5lSGVpZ2h0XSwKICAgICAgYmJveDogWzAsIDAsIHcsIGhdLAogICAgICBtYXRyaXg6IHJvdGF0aW9uICE9PSAwID8gZ2V0Um90YXRpb25NYXRyaXgocm90YXRpb24sIGgsIGxpbmVIZWlnaHQpIDogdW5kZWZpbmVkCiAgICB9OwogIH0KICBjcmVhdGVBcHBlYXJhbmNlKHRleHQsIHJlY3QsIHJvdGF0aW9uLCBmb250U2l6ZSwgYmdDb2xvciwgc3Ryb2tlQWxwaGEpIHsKICAgIGNvbnN0IGN0eCA9IHRoaXMuX2NyZWF0ZUNvbnRleHQoKTsKICAgIGNvbnN0IGxpbmVzID0gW107CiAgICBsZXQgbWF4V2lkdGggPSAtSW5maW5pdHk7CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgdGV4dC5zcGxpdCgvXHJcbj98XG4vKSkgewogICAgICBsaW5lcy5wdXNoKGxpbmUpOwogICAgICBjb25zdCBsaW5lV2lkdGggPSBjdHgubWVhc3VyZVRleHQobGluZSkud2lkdGg7CiAgICAgIG1heFdpZHRoID0gTWF0aC5tYXgobWF4V2lkdGgsIGxpbmVXaWR0aCk7CiAgICAgIGZvciAoY29uc3QgY29kZSBvZiBjb2RlUG9pbnRJdGVyKGxpbmUpKSB7CiAgICAgICAgY29uc3QgY2hhciA9IFN0cmluZy5mcm9tQ29kZVBvaW50KGNvZGUpOwogICAgICAgIGxldCB3aWR0aCA9IHRoaXMud2lkdGhzLmdldChjb2RlKTsKICAgICAgICBpZiAod2lkdGggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY29uc3QgbWV0cmljcyA9IGN0eC5tZWFzdXJlVGV4dChjaGFyKTsKICAgICAgICAgIHdpZHRoID0gTWF0aC5jZWlsKG1ldHJpY3Mud2lkdGgpOwogICAgICAgICAgdGhpcy53aWR0aHMuc2V0KGNvZGUsIHdpZHRoKTsKICAgICAgICAgIHRoaXMuZmlyc3RDaGFyID0gTWF0aC5taW4oY29kZSwgdGhpcy5maXJzdENoYXIpOwogICAgICAgICAgdGhpcy5sYXN0Q2hhciA9IE1hdGgubWF4KGNvZGUsIHRoaXMubGFzdENoYXIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbWF4V2lkdGggKj0gZm9udFNpemUgLyAxMDAwOwogICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IHJlY3Q7CiAgICBsZXQgdyA9IHgyIC0geDE7CiAgICBsZXQgaCA9IHkyIC0geTE7CiAgICBpZiAocm90YXRpb24gJSAxODAgIT09IDApIHsKICAgICAgW3csIGhdID0gW2gsIHddOwogICAgfQogICAgbGV0IGhzY2FsZSA9IDE7CiAgICBpZiAobWF4V2lkdGggPiB3KSB7CiAgICAgIGhzY2FsZSA9IHcgLyBtYXhXaWR0aDsKICAgIH0KICAgIGxldCB2c2NhbGUgPSAxOwogICAgY29uc3QgbGluZUhlaWdodCA9IExJTkVfRkFDVE9SICogZm9udFNpemU7CiAgICBjb25zdCBsaW5lRGVzY2VudCA9IExJTkVfREVTQ0VOVF9GQUNUT1IgKiBmb250U2l6ZTsKICAgIGNvbnN0IG1heEhlaWdodCA9IGxpbmVIZWlnaHQgKiBsaW5lcy5sZW5ndGg7CiAgICBpZiAobWF4SGVpZ2h0ID4gaCkgewogICAgICB2c2NhbGUgPSBoIC8gbWF4SGVpZ2h0OwogICAgfQogICAgY29uc3QgZnNjYWxlID0gTWF0aC5taW4oaHNjYWxlLCB2c2NhbGUpOwogICAgY29uc3QgbmV3Rm9udFNpemUgPSBmb250U2l6ZSAqIGZzY2FsZTsKICAgIGNvbnN0IGJ1ZmZlciA9IFsicSIsIGAwIDAgJHtudW1iZXJUb1N0cmluZyh3KX0gJHtudW1iZXJUb1N0cmluZyhoKX0gcmUgVyBuYCwgYEJUYCwgYDEgMCAwIDEgMCAke251bWJlclRvU3RyaW5nKGggKyBsaW5lRGVzY2VudCl9IFRtIDAgVGMgJHtnZXRQZGZDb2xvcihiZ0NvbG9yLCB0cnVlKX1gLCBgLyR7dGhpcy5mb250TmFtZS5uYW1lfSAke251bWJlclRvU3RyaW5nKG5ld0ZvbnRTaXplKX0gVGZgXTsKICAgIGNvbnN0IHsKICAgICAgcmVzb3VyY2VzCiAgICB9ID0gdGhpczsKICAgIHN0cm9rZUFscGhhID0gdHlwZW9mIHN0cm9rZUFscGhhID09PSAibnVtYmVyIiAmJiBzdHJva2VBbHBoYSA+PSAwICYmIHN0cm9rZUFscGhhIDw9IDEgPyBzdHJva2VBbHBoYSA6IDE7CiAgICBpZiAoc3Ryb2tlQWxwaGEgIT09IDEpIHsKICAgICAgYnVmZmVyLnB1c2goIi9SMCBncyIpOwogICAgICBjb25zdCBleHRHU3RhdGUgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgICBjb25zdCByMCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICAgIHIwLnNldCgiY2EiLCBzdHJva2VBbHBoYSk7CiAgICAgIHIwLnNldCgiQ0EiLCBzdHJva2VBbHBoYSk7CiAgICAgIHIwLnNldElmTmFtZSgiVHlwZSIsICJFeHRHU3RhdGUiKTsKICAgICAgZXh0R1N0YXRlLnNldCgiUjAiLCByMCk7CiAgICAgIHJlc291cmNlcy5zZXQoIkV4dEdTdGF0ZSIsIGV4dEdTdGF0ZSk7CiAgICB9CiAgICBjb25zdCB2U2hpZnQgPSBudW1iZXJUb1N0cmluZyhsaW5lSGVpZ2h0KTsKICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykgewogICAgICBidWZmZXIucHVzaChgMCAtJHt2U2hpZnR9IFRkIDwke3N0cmluZ1RvVVRGMTZIZXhTdHJpbmcobGluZSl9PiBUamApOwogICAgfQogICAgYnVmZmVyLnB1c2goIkVUIiwgIlEiKTsKICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBidWZmZXIuam9pbigiXG4iKTsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW1EaWN0ID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgWzAsIDAsIHcsIGhdKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTGVuZ3RoIiwgYXBwZWFyYW5jZS5sZW5ndGgpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgaWYgKHJvdGF0aW9uKSB7CiAgICAgIGNvbnN0IG1hdHJpeCA9IGdldFJvdGF0aW9uTWF0cml4KHJvdGF0aW9uLCB3LCBoKTsKICAgICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJNYXRyaXgiLCBtYXRyaXgpOwogICAgfQogICAgY29uc3QgYXAgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KfQoKOy8vIC4vc3JjL3NoYXJlZC9zY3JpcHRpbmdfdXRpbHMuanMKZnVuY3Rpb24gbWFrZUNvbG9yQ29tcChuKSB7CiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgbikpICogMjU1KS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKTsKfQpmdW5jdGlvbiBzY2FsZUFuZENsYW1wKHgpIHsKICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMjU1LCAyNTUgKiB4KSk7Cn0KY2xhc3MgQ29sb3JDb252ZXJ0ZXJzIHsKICBzdGF0aWMgQ01ZS19HKFtjLCB5LCBtLCBrXSkgewogICAgcmV0dXJuIFsiRyIsIDEgLSBNYXRoLm1pbigxLCAwLjMgKiBjICsgMC41OSAqIG0gKyAwLjExICogeSArIGspXTsKICB9CiAgc3RhdGljIEdfQ01ZSyhbZ10pIHsKICAgIHJldHVybiBbIkNNWUsiLCAwLCAwLCAwLCAxIC0gZ107CiAgfQogIHN0YXRpYyBHX1JHQihbZ10pIHsKICAgIHJldHVybiBbIlJHQiIsIGcsIGcsIGddOwogIH0KICBzdGF0aWMgR19yZ2IoW2ddKSB7CiAgICBnID0gc2NhbGVBbmRDbGFtcChnKTsKICAgIHJldHVybiBbZywgZywgZ107CiAgfQogIHN0YXRpYyBHX0hUTUwoW2ddKSB7CiAgICBjb25zdCBHID0gbWFrZUNvbG9yQ29tcChnKTsKICAgIHJldHVybiBgIyR7R30ke0d9JHtHfWA7CiAgfQogIHN0YXRpYyBSR0JfRyhbciwgZywgYl0pIHsKICAgIHJldHVybiBbIkciLCAwLjMgKiByICsgMC41OSAqIGcgKyAwLjExICogYl07CiAgfQogIHN0YXRpYyBSR0JfcmdiKGNvbG9yKSB7CiAgICByZXR1cm4gY29sb3IubWFwKHNjYWxlQW5kQ2xhbXApOwogIH0KICBzdGF0aWMgUkdCX0hUTUwoY29sb3IpIHsKICAgIHJldHVybiBgIyR7Y29sb3IubWFwKG1ha2VDb2xvckNvbXApLmpvaW4oIiIpfWA7CiAgfQogIHN0YXRpYyBUX0hUTUwoKSB7CiAgICByZXR1cm4gIiMwMDAwMDAwMCI7CiAgfQogIHN0YXRpYyBUX3JnYigpIHsKICAgIHJldHVybiBbbnVsbF07CiAgfQogIHN0YXRpYyBDTVlLX1JHQihbYywgeSwgbSwga10pIHsKICAgIHJldHVybiBbIlJHQiIsIDEgLSBNYXRoLm1pbigxLCBjICsgayksIDEgLSBNYXRoLm1pbigxLCBtICsgayksIDEgLSBNYXRoLm1pbigxLCB5ICsgayldOwogIH0KICBzdGF0aWMgQ01ZS19yZ2IoW2MsIHksIG0sIGtdKSB7CiAgICByZXR1cm4gW3NjYWxlQW5kQ2xhbXAoMSAtIE1hdGgubWluKDEsIGMgKyBrKSksIHNjYWxlQW5kQ2xhbXAoMSAtIE1hdGgubWluKDEsIG0gKyBrKSksIHNjYWxlQW5kQ2xhbXAoMSAtIE1hdGgubWluKDEsIHkgKyBrKSldOwogIH0KICBzdGF0aWMgQ01ZS19IVE1MKGNvbXBvbmVudHMpIHsKICAgIGNvbnN0IHJnYiA9IHRoaXMuQ01ZS19SR0IoY29tcG9uZW50cykuc2xpY2UoMSk7CiAgICByZXR1cm4gdGhpcy5SR0JfSFRNTChyZ2IpOwogIH0KICBzdGF0aWMgUkdCX0NNWUsoW3IsIGcsIGJdKSB7CiAgICBjb25zdCBjID0gMSAtIHI7CiAgICBjb25zdCBtID0gMSAtIGc7CiAgICBjb25zdCB5ID0gMSAtIGI7CiAgICBjb25zdCBrID0gTWF0aC5taW4oYywgbSwgeSk7CiAgICByZXR1cm4gWyJDTVlLIiwgYywgbSwgeSwga107CiAgfQp9CmNvbnN0IERhdGVGb3JtYXRzID0gWyJtL2QiLCAibS9kL3l5IiwgIm1tL2RkL3l5IiwgIm1tL3l5IiwgImQtbW1tIiwgImQtbW1tLXl5IiwgImRkLW1tbS15eSIsICJ5eS1tbS1kZCIsICJtbW0teXkiLCAibW1tbS15eSIsICJtbW0gZCwgeXl5eSIsICJtbW1tIGQsIHl5eXkiLCAibS9kL3l5IGg6TU0gdHQiLCAibS9kL3l5IEhIOk1NIl07CmNvbnN0IFRpbWVGb3JtYXRzID0gWyJISDpNTSIsICJoOk1NIHR0IiwgIkhIOk1NOnNzIiwgImg6TU06c3MgdHQiXTsKCjsvLyAuL3NyYy9jb3JlL25hbWVfbnVtYmVyX3RyZWUuanMKCgpjbGFzcyBOYW1lT3JOdW1iZXJUcmVlIHsKICBjb25zdHJ1Y3Rvcihyb290LCB4cmVmLCB0eXBlKSB7CiAgICB0aGlzLnJvb3QgPSByb290OwogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMuX3R5cGUgPSB0eXBlOwogIH0KICBnZXRBbGwoaXNSYXcgPSBmYWxzZSkgewogICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgaWYgKCF0aGlzLnJvb3QpIHsKICAgICAgcmV0dXJuIG1hcDsKICAgIH0KICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBjb25zdCBwcm9jZXNzZWQgPSBuZXcgUmVmU2V0KCk7CiAgICBwcm9jZXNzZWQucHV0KHRoaXMucm9vdCk7CiAgICBjb25zdCBxdWV1ZSA9IFt0aGlzLnJvb3RdOwogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3Qgb2JqID0geHJlZi5mZXRjaElmUmVmKHF1ZXVlLnNoaWZ0KCkpOwogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChvYmouaGFzKCJLaWRzIikpIHsKICAgICAgICBjb25zdCBraWRzID0gb2JqLmdldCgiS2lkcyIpOwogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3Qga2lkIG9mIGtpZHMpIHsKICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGtpZCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBEdXBsaWNhdGUgZW50cnkgaW4gIiR7dGhpcy5fdHlwZX0iIHRyZWUuYCk7CiAgICAgICAgICB9CiAgICAgICAgICBxdWV1ZS5wdXNoKGtpZCk7CiAgICAgICAgICBwcm9jZXNzZWQucHV0KGtpZCk7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGVudHJpZXMgPSBvYmouZ2V0KHRoaXMuX3R5cGUpOwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZW50cmllcykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBlbnRyaWVzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICBtYXAuc2V0KHhyZWYuZmV0Y2hJZlJlZihlbnRyaWVzW2ldKSwgaXNSYXcgPyBlbnRyaWVzW2kgKyAxXSA6IHhyZWYuZmV0Y2hJZlJlZihlbnRyaWVzW2kgKyAxXSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWFwOwogIH0KICBnZXRSYXcoa2V5KSB7CiAgICBpZiAoIXRoaXMucm9vdCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBsZXQga2lkc09yRW50cmllcyA9IHhyZWYuZmV0Y2hJZlJlZih0aGlzLnJvb3QpOwogICAgbGV0IGxvb3BDb3VudCA9IDA7CiAgICBjb25zdCBNQVhfTEVWRUxTID0gMTA7CiAgICB3aGlsZSAoa2lkc09yRW50cmllcy5oYXMoIktpZHMiKSkgewogICAgICBpZiAoKytsb29wQ291bnQgPiBNQVhfTEVWRUxTKSB7CiAgICAgICAgd2FybihgU2VhcmNoIGRlcHRoIGxpbWl0IHJlYWNoZWQgZm9yICIke3RoaXMuX3R5cGV9IiB0cmVlLmApOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGtpZHMgPSBraWRzT3JFbnRyaWVzLmdldCgiS2lkcyIpOwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBsZXQgbCA9IDAsCiAgICAgICAgciA9IGtpZHMubGVuZ3RoIC0gMTsKICAgICAgd2hpbGUgKGwgPD0gcikgewogICAgICAgIGNvbnN0IG0gPSBsICsgciA+PiAxOwogICAgICAgIGNvbnN0IGtpZCA9IHhyZWYuZmV0Y2hJZlJlZihraWRzW21dKTsKICAgICAgICBjb25zdCBsaW1pdHMgPSBraWQuZ2V0KCJMaW1pdHMiKTsKICAgICAgICBpZiAoa2V5IDwgeHJlZi5mZXRjaElmUmVmKGxpbWl0c1swXSkpIHsKICAgICAgICAgIHIgPSBtIC0gMTsKICAgICAgICB9IGVsc2UgaWYgKGtleSA+IHhyZWYuZmV0Y2hJZlJlZihsaW1pdHNbMV0pKSB7CiAgICAgICAgICBsID0gbSArIDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGtpZHNPckVudHJpZXMgPSBraWQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGwgPiByKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGVudHJpZXMgPSBraWRzT3JFbnRyaWVzLmdldCh0aGlzLl90eXBlKTsKICAgIGlmIChBcnJheS5pc0FycmF5KGVudHJpZXMpKSB7CiAgICAgIGxldCBsID0gMCwKICAgICAgICByID0gZW50cmllcy5sZW5ndGggLSAyOwogICAgICB3aGlsZSAobCA8PSByKSB7CiAgICAgICAgY29uc3QgdG1wID0gbCArIHIgPj4gMSwKICAgICAgICAgIG0gPSB0bXAgKyAodG1wICYgMSk7CiAgICAgICAgY29uc3QgY3VycmVudEtleSA9IHhyZWYuZmV0Y2hJZlJlZihlbnRyaWVzW21dKTsKICAgICAgICBpZiAoa2V5IDwgY3VycmVudEtleSkgewogICAgICAgICAgciA9IG0gLSAyOwogICAgICAgIH0gZWxzZSBpZiAoa2V5ID4gY3VycmVudEtleSkgewogICAgICAgICAgbCA9IG0gKyAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZW50cmllc1ttICsgMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZ2V0KGtleSkgewogICAgcmV0dXJuIHRoaXMueHJlZi5mZXRjaElmUmVmKHRoaXMuZ2V0UmF3KGtleSkpOwogIH0KfQpjbGFzcyBOYW1lVHJlZSBleHRlbmRzIE5hbWVPck51bWJlclRyZWUgewogIGNvbnN0cnVjdG9yKHJvb3QsIHhyZWYpIHsKICAgIHN1cGVyKHJvb3QsIHhyZWYsICJOYW1lcyIpOwogIH0KfQpjbGFzcyBOdW1iZXJUcmVlIGV4dGVuZHMgTmFtZU9yTnVtYmVyVHJlZSB7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZikgewogICAgc3VwZXIocm9vdCwgeHJlZiwgIk51bXMiKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NsZWFudXBfaGVscGVyLmpzCgoKCgpmdW5jdGlvbiBjbGVhckdsb2JhbENhY2hlcygpIHsKICBjbGVhclBhdHRlcm5DYWNoZXMoKTsKICBjbGVhclByaW1pdGl2ZUNhY2hlcygpOwogIGNsZWFyVW5pY29kZUNhY2hlcygpOwogIEpweEltYWdlLmNsZWFudXAoKTsKfQoKOy8vIC4vc3JjL2NvcmUvZmlsZV9zcGVjLmpzCgoKCmZ1bmN0aW9uIHBpY2tQbGF0Zm9ybUl0ZW0oZGljdCkgewogIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChkaWN0LmhhcygiVUYiKSkgewogICAgcmV0dXJuIGRpY3QuZ2V0KCJVRiIpOwogIH0gZWxzZSBpZiAoZGljdC5oYXMoIkYiKSkgewogICAgcmV0dXJuIGRpY3QuZ2V0KCJGIik7CiAgfSBlbHNlIGlmIChkaWN0LmhhcygiVW5peCIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIlVuaXgiKTsKICB9IGVsc2UgaWYgKGRpY3QuaGFzKCJNYWMiKSkgewogICAgcmV0dXJuIGRpY3QuZ2V0KCJNYWMiKTsKICB9IGVsc2UgaWYgKGRpY3QuaGFzKCJET1MiKSkgewogICAgcmV0dXJuIGRpY3QuZ2V0KCJET1MiKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gc3RyaXBQYXRoKHN0cikgewogIHJldHVybiBzdHIuc3Vic3RyaW5nKHN0ci5sYXN0SW5kZXhPZigiLyIpICsgMSk7Cn0KY2xhc3MgRmlsZVNwZWMgewogICNjb250ZW50QXZhaWxhYmxlID0gZmFsc2U7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZiwgc2tpcENvbnRlbnQgPSBmYWxzZSkgewogICAgaWYgKCEocm9vdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLnJvb3QgPSByb290OwogICAgaWYgKHJvb3QuaGFzKCJGUyIpKSB7CiAgICAgIHRoaXMuZnMgPSByb290LmdldCgiRlMiKTsKICAgIH0KICAgIGlmIChyb290LmhhcygiUkYiKSkgewogICAgICB3YXJuKCJSZWxhdGVkIGZpbGUgc3BlY2lmaWNhdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgIH0KICAgIGlmICghc2tpcENvbnRlbnQpIHsKICAgICAgaWYgKHJvb3QuaGFzKCJFRiIpKSB7CiAgICAgICAgdGhpcy4jY29udGVudEF2YWlsYWJsZSA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybigiTm9uLWVtYmVkZGVkIGZpbGUgc3BlY2lmaWNhdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgfQogICAgfQogIH0KICBnZXQgZmlsZW5hbWUoKSB7CiAgICBsZXQgZmlsZW5hbWUgPSAiIjsKICAgIGNvbnN0IGl0ZW0gPSBwaWNrUGxhdGZvcm1JdGVtKHRoaXMucm9vdCk7CiAgICBpZiAoaXRlbSAmJiB0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIpIHsKICAgICAgZmlsZW5hbWUgPSBzdHJpbmdUb1BERlN0cmluZyhpdGVtLCB0cnVlKS5yZXBsYWNlQWxsKCJcXFxcIiwgIlxcIikucmVwbGFjZUFsbCgiXFwvIiwgIi8iKS5yZXBsYWNlQWxsKCJcXCIsICIvIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJmaWxlbmFtZSIsIGZpbGVuYW1lIHx8ICJ1bm5hbWVkIik7CiAgfQogIGdldCBjb250ZW50KCkgewogICAgaWYgKCF0aGlzLiNjb250ZW50QXZhaWxhYmxlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdGhpcy5fY29udGVudFJlZiB8fD0gcGlja1BsYXRmb3JtSXRlbSh0aGlzLnJvb3Q/LmdldCgiRUYiKSk7CiAgICBsZXQgY29udGVudCA9IG51bGw7CiAgICBpZiAodGhpcy5fY29udGVudFJlZikgewogICAgICBjb25zdCBmaWxlT2JqID0gdGhpcy54cmVmLmZldGNoSWZSZWYodGhpcy5fY29udGVudFJlZik7CiAgICAgIGlmIChmaWxlT2JqIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnRlbnQgPSBmaWxlT2JqLmdldEJ5dGVzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybigiRW1iZWRkZWQgZmlsZSBzcGVjaWZpY2F0aW9uIHBvaW50cyB0byBub24tZXhpc3RpbmcvaW52YWxpZCBjb250ZW50Iik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oIkVtYmVkZGVkIGZpbGUgc3BlY2lmaWNhdGlvbiBkb2VzIG5vdCBoYXZlIGFueSBjb250ZW50Iik7CiAgICB9CiAgICByZXR1cm4gY29udGVudDsKICB9CiAgZ2V0IGRlc2NyaXB0aW9uKCkgewogICAgbGV0IGRlc2NyaXB0aW9uID0gIiI7CiAgICBjb25zdCBkZXNjID0gdGhpcy5yb290Py5nZXQoIkRlc2MiKTsKICAgIGlmIChkZXNjICYmIHR5cGVvZiBkZXNjID09PSAic3RyaW5nIikgewogICAgICBkZXNjcmlwdGlvbiA9IHN0cmluZ1RvUERGU3RyaW5nKGRlc2MpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZGVzY3JpcHRpb24iLCBkZXNjcmlwdGlvbik7CiAgfQogIGdldCBzZXJpYWxpemFibGUoKSB7CiAgICByZXR1cm4gewogICAgICByYXdGaWxlbmFtZTogdGhpcy5maWxlbmFtZSwKICAgICAgZmlsZW5hbWU6IHN0cmlwUGF0aCh0aGlzLmZpbGVuYW1lKSwKICAgICAgY29udGVudDogdGhpcy5jb250ZW50LAogICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbgogICAgfTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3htbF9wYXJzZXIuanMKCmNvbnN0IFhNTFBhcnNlckVycm9yQ29kZSA9IHsKICBOb0Vycm9yOiAwLAogIEVuZE9mRG9jdW1lbnQ6IC0xLAogIFVudGVybWluYXRlZENkYXQ6IC0yLAogIFVudGVybWluYXRlZFhtbERlY2xhcmF0aW9uOiAtMywKICBVbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb246IC00LAogIFVudGVybWluYXRlZENvbW1lbnQ6IC01LAogIE1hbGZvcm1lZEVsZW1lbnQ6IC02LAogIE91dE9mTWVtb3J5OiAtNywKICBVbnRlcm1pbmF0ZWRBdHRyaWJ1dGVWYWx1ZTogLTgsCiAgVW50ZXJtaW5hdGVkRWxlbWVudDogLTksCiAgRWxlbWVudE5ldmVyQmVndW46IC0xMAp9OwpmdW5jdGlvbiBpc1doaXRlc3BhY2UocywgaW5kZXgpIHsKICBjb25zdCBjaCA9IHNbaW5kZXhdOwogIHJldHVybiBjaCA9PT0gIiAiIHx8IGNoID09PSAiXG4iIHx8IGNoID09PSAiXHIiIHx8IGNoID09PSAiXHQiOwp9CmZ1bmN0aW9uIGlzV2hpdGVzcGFjZVN0cmluZyhzKSB7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBpZiAoIWlzV2hpdGVzcGFjZShzLCBpKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmNsYXNzIFhNTFBhcnNlckJhc2UgewogIF9yZXNvbHZlRW50aXRpZXMocykgewogICAgcmV0dXJuIHMucmVwbGFjZUFsbCgvJihbXjtdKyk7L2csIChhbGwsIGVudGl0eSkgPT4gewogICAgICBpZiAoZW50aXR5LnN1YnN0cmluZygwLCAyKSA9PT0gIiN4IikgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChwYXJzZUludChlbnRpdHkuc3Vic3RyaW5nKDIpLCAxNikpOwogICAgICB9IGVsc2UgaWYgKGVudGl0eS5zdWJzdHJpbmcoMCwgMSkgPT09ICIjIikgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChwYXJzZUludChlbnRpdHkuc3Vic3RyaW5nKDEpLCAxMCkpOwogICAgICB9CiAgICAgIHN3aXRjaCAoZW50aXR5KSB7CiAgICAgICAgY2FzZSAibHQiOgogICAgICAgICAgcmV0dXJuICI8IjsKICAgICAgICBjYXNlICJndCI6CiAgICAgICAgICByZXR1cm4gIj4iOwogICAgICAgIGNhc2UgImFtcCI6CiAgICAgICAgICByZXR1cm4gIiYiOwogICAgICAgIGNhc2UgInF1b3QiOgogICAgICAgICAgcmV0dXJuICciJzsKICAgICAgICBjYXNlICJhcG9zIjoKICAgICAgICAgIHJldHVybiAiJyI7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMub25SZXNvbHZlRW50aXR5KGVudGl0eSk7CiAgICB9KTsKICB9CiAgX3BhcnNlQ29udGVudChzLCBzdGFydCkgewogICAgY29uc3QgYXR0cmlidXRlcyA9IFtdOwogICAgbGV0IHBvcyA9IHN0YXJ0OwogICAgZnVuY3Rpb24gc2tpcFdzKCkgewogICAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgaXNXaGl0ZXNwYWNlKHMsIHBvcykpIHsKICAgICAgICArK3BvczsKICAgICAgfQogICAgfQogICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmICFpc1doaXRlc3BhY2UocywgcG9zKSAmJiBzW3Bvc10gIT09ICI+IiAmJiBzW3Bvc10gIT09ICIvIikgewogICAgICArK3BvczsKICAgIH0KICAgIGNvbnN0IG5hbWUgPSBzLnN1YnN0cmluZyhzdGFydCwgcG9zKTsKICAgIHNraXBXcygpOwogICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmIHNbcG9zXSAhPT0gIj4iICYmIHNbcG9zXSAhPT0gIi8iICYmIHNbcG9zXSAhPT0gIj8iKSB7CiAgICAgIHNraXBXcygpOwogICAgICBsZXQgYXR0ck5hbWUgPSAiIiwKICAgICAgICBhdHRyVmFsdWUgPSAiIjsKICAgICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmICFpc1doaXRlc3BhY2UocywgcG9zKSAmJiBzW3Bvc10gIT09ICI9IikgewogICAgICAgIGF0dHJOYW1lICs9IHNbcG9zXTsKICAgICAgICArK3BvczsKICAgICAgfQogICAgICBza2lwV3MoKTsKICAgICAgaWYgKHNbcG9zXSAhPT0gIj0iKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgKytwb3M7CiAgICAgIHNraXBXcygpOwogICAgICBjb25zdCBhdHRyRW5kQ2hhciA9IHNbcG9zXTsKICAgICAgaWYgKGF0dHJFbmRDaGFyICE9PSAnIicgJiYgYXR0ckVuZENoYXIgIT09ICInIikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGF0dHJFbmRJbmRleCA9IHMuaW5kZXhPZihhdHRyRW5kQ2hhciwgKytwb3MpOwogICAgICBpZiAoYXR0ckVuZEluZGV4IDwgMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGF0dHJWYWx1ZSA9IHMuc3Vic3RyaW5nKHBvcywgYXR0ckVuZEluZGV4KTsKICAgICAgYXR0cmlidXRlcy5wdXNoKHsKICAgICAgICBuYW1lOiBhdHRyTmFtZSwKICAgICAgICB2YWx1ZTogdGhpcy5fcmVzb2x2ZUVudGl0aWVzKGF0dHJWYWx1ZSkKICAgICAgfSk7CiAgICAgIHBvcyA9IGF0dHJFbmRJbmRleCArIDE7CiAgICAgIHNraXBXcygpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgbmFtZSwKICAgICAgYXR0cmlidXRlcywKICAgICAgcGFyc2VkOiBwb3MgLSBzdGFydAogICAgfTsKICB9CiAgX3BhcnNlUHJvY2Vzc2luZ0luc3RydWN0aW9uKHMsIHN0YXJ0KSB7CiAgICBsZXQgcG9zID0gc3RhcnQ7CiAgICBmdW5jdGlvbiBza2lwV3MoKSB7CiAgICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiBpc1doaXRlc3BhY2UocywgcG9zKSkgewogICAgICAgICsrcG9zOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgIWlzV2hpdGVzcGFjZShzLCBwb3MpICYmIHNbcG9zXSAhPT0gIj4iICYmIHNbcG9zXSAhPT0gIj8iICYmIHNbcG9zXSAhPT0gIi8iKSB7CiAgICAgICsrcG9zOwogICAgfQogICAgY29uc3QgbmFtZSA9IHMuc3Vic3RyaW5nKHN0YXJ0LCBwb3MpOwogICAgc2tpcFdzKCk7CiAgICBjb25zdCBhdHRyU3RhcnQgPSBwb3M7CiAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgKHNbcG9zXSAhPT0gIj8iIHx8IHNbcG9zICsgMV0gIT09ICI+IikpIHsKICAgICAgKytwb3M7CiAgICB9CiAgICBjb25zdCB2YWx1ZSA9IHMuc3Vic3RyaW5nKGF0dHJTdGFydCwgcG9zKTsKICAgIHJldHVybiB7CiAgICAgIG5hbWUsCiAgICAgIHZhbHVlLAogICAgICBwYXJzZWQ6IHBvcyAtIHN0YXJ0CiAgICB9OwogIH0KICBwYXJzZVhtbChzKSB7CiAgICBsZXQgaSA9IDA7CiAgICB3aGlsZSAoaSA8IHMubGVuZ3RoKSB7CiAgICAgIGNvbnN0IGNoID0gc1tpXTsKICAgICAgbGV0IGogPSBpOwogICAgICBpZiAoY2ggPT09ICI8IikgewogICAgICAgICsrajsKICAgICAgICBjb25zdCBjaDIgPSBzW2pdOwogICAgICAgIGxldCBxOwogICAgICAgIHN3aXRjaCAoY2gyKSB7CiAgICAgICAgICBjYXNlICIvIjoKICAgICAgICAgICAgKytqOwogICAgICAgICAgICBxID0gcy5pbmRleE9mKCI+Iiwgaik7CiAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRWxlbWVudCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub25FbmRFbGVtZW50KHMuc3Vic3RyaW5nKGosIHEpKTsKICAgICAgICAgICAgaiA9IHEgKyAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIj8iOgogICAgICAgICAgICArK2o7CiAgICAgICAgICAgIGNvbnN0IHBpID0gdGhpcy5fcGFyc2VQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24ocywgaik7CiAgICAgICAgICAgIGlmIChzLnN1YnN0cmluZyhqICsgcGkucGFyc2VkLCBqICsgcGkucGFyc2VkICsgMikgIT09ICI/PiIpIHsKICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZFhtbERlY2xhcmF0aW9uKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vblBpKHBpLm5hbWUsIHBpLnZhbHVlKTsKICAgICAgICAgICAgaiArPSBwaS5wYXJzZWQgKyAyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIiEiOgogICAgICAgICAgICBpZiAocy5zdWJzdHJpbmcoaiArIDEsIGogKyAzKSA9PT0gIi0tIikgewogICAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIi0tPiIsIGogKyAzKTsKICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkQ29tbWVudCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMub25Db21tZW50KHMuc3Vic3RyaW5nKGogKyAzLCBxKSk7CiAgICAgICAgICAgICAgaiA9IHEgKyAzOwogICAgICAgICAgICB9IGVsc2UgaWYgKHMuc3Vic3RyaW5nKGogKyAxLCBqICsgOCkgPT09ICJbQ0RBVEFbIikgewogICAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIl1dPiIsIGogKyA4KTsKICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkQ2RhdCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMub25DZGF0YShzLnN1YnN0cmluZyhqICsgOCwgcSkpOwogICAgICAgICAgICAgIGogPSBxICsgMzsKICAgICAgICAgICAgfSBlbHNlIGlmIChzLnN1YnN0cmluZyhqICsgMSwgaiArIDgpID09PSAiRE9DVFlQRSIpIHsKICAgICAgICAgICAgICBjb25zdCBxMiA9IHMuaW5kZXhPZigiWyIsIGogKyA4KTsKICAgICAgICAgICAgICBsZXQgY29tcGxleERvY3R5cGUgPSBmYWxzZTsKICAgICAgICAgICAgICBxID0gcy5pbmRleE9mKCI+IiwgaiArIDgpOwogICAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb24pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocTIgPiAwICYmIHEgPiBxMikgewogICAgICAgICAgICAgICAgcSA9IHMuaW5kZXhPZigiXT4iLCBqICsgOCk7CiAgICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb24pOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb21wbGV4RG9jdHlwZSA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGRvY3R5cGVDb250ZW50ID0gcy5zdWJzdHJpbmcoaiArIDgsIHEgKyAoY29tcGxleERvY3R5cGUgPyAxIDogMCkpOwogICAgICAgICAgICAgIHRoaXMub25Eb2N0eXBlKGRvY3R5cGVDb250ZW50KTsKICAgICAgICAgICAgICBqID0gcSArIChjb21wbGV4RG9jdHlwZSA/IDIgOiAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLk1hbGZvcm1lZEVsZW1lbnQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLl9wYXJzZUNvbnRlbnQocywgaik7CiAgICAgICAgICAgIGlmIChjb250ZW50ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5NYWxmb3JtZWRFbGVtZW50KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGlzQ2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChzLnN1YnN0cmluZyhqICsgY29udGVudC5wYXJzZWQsIGogKyBjb250ZW50LnBhcnNlZCArIDIpID09PSAiLz4iKSB7CiAgICAgICAgICAgICAgaXNDbG9zZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHMuc3Vic3RyaW5nKGogKyBjb250ZW50LnBhcnNlZCwgaiArIGNvbnRlbnQucGFyc2VkICsgMSkgIT09ICI+IikgewogICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRWxlbWVudCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub25CZWdpbkVsZW1lbnQoY29udGVudC5uYW1lLCBjb250ZW50LmF0dHJpYnV0ZXMsIGlzQ2xvc2VkKTsKICAgICAgICAgICAgaiArPSBjb250ZW50LnBhcnNlZCArIChpc0Nsb3NlZCA/IDIgOiAxKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHdoaWxlIChqIDwgcy5sZW5ndGggJiYgc1tqXSAhPT0gIjwiKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHRleHQgPSBzLnN1YnN0cmluZyhpLCBqKTsKICAgICAgICB0aGlzLm9uVGV4dCh0aGlzLl9yZXNvbHZlRW50aXRpZXModGV4dCkpOwogICAgICB9CiAgICAgIGkgPSBqOwogICAgfQogIH0KICBvblJlc29sdmVFbnRpdHkobmFtZSkgewogICAgcmV0dXJuIGAmJHtuYW1lfTtgOwogIH0KICBvblBpKG5hbWUsIHZhbHVlKSB7fQogIG9uQ29tbWVudCh0ZXh0KSB7fQogIG9uQ2RhdGEodGV4dCkge30KICBvbkRvY3R5cGUoZG9jdHlwZUNvbnRlbnQpIHt9CiAgb25UZXh0KHRleHQpIHt9CiAgb25CZWdpbkVsZW1lbnQobmFtZSwgYXR0cmlidXRlcywgaXNFbXB0eSkge30KICBvbkVuZEVsZW1lbnQobmFtZSkge30KICBvbkVycm9yKGNvZGUpIHt9Cn0KY2xhc3MgU2ltcGxlRE9NTm9kZSB7CiAgY29uc3RydWN0b3Iobm9kZU5hbWUsIG5vZGVWYWx1ZSkgewogICAgdGhpcy5ub2RlTmFtZSA9IG5vZGVOYW1lOwogICAgdGhpcy5ub2RlVmFsdWUgPSBub2RlVmFsdWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgInBhcmVudE5vZGUiLCB7CiAgICAgIHZhbHVlOiBudWxsLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfQogIGdldCBmaXJzdENoaWxkKCkgewogICAgcmV0dXJuIHRoaXMuY2hpbGROb2Rlcz8uWzBdOwogIH0KICBnZXQgbmV4dFNpYmxpbmcoKSB7CiAgICBjb25zdCBjaGlsZE5vZGVzID0gdGhpcy5wYXJlbnROb2RlLmNoaWxkTm9kZXM7CiAgICBpZiAoIWNoaWxkTm9kZXMpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IGluZGV4ID0gY2hpbGROb2Rlcy5pbmRleE9mKHRoaXMpOwogICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIGNoaWxkTm9kZXNbaW5kZXggKyAxXTsKICB9CiAgZ2V0IHRleHRDb250ZW50KCkgewogICAgaWYgKCF0aGlzLmNoaWxkTm9kZXMpIHsKICAgICAgcmV0dXJuIHRoaXMubm9kZVZhbHVlIHx8ICIiOwogICAgfQogICAgcmV0dXJuIHRoaXMuY2hpbGROb2Rlcy5tYXAoY2hpbGQgPT4gY2hpbGQudGV4dENvbnRlbnQpLmpvaW4oIiIpOwogIH0KICBnZXQgY2hpbGRyZW4oKSB7CiAgICByZXR1cm4gdGhpcy5jaGlsZE5vZGVzIHx8IFtdOwogIH0KICBoYXNDaGlsZE5vZGVzKCkgewogICAgcmV0dXJuIHRoaXMuY2hpbGROb2Rlcz8ubGVuZ3RoID4gMDsKICB9CiAgc2VhcmNoTm9kZShwYXRocywgcG9zKSB7CiAgICBpZiAocG9zID49IHBhdGhzLmxlbmd0aCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvbnN0IGNvbXBvbmVudCA9IHBhdGhzW3Bvc107CiAgICBpZiAoY29tcG9uZW50Lm5hbWUuc3RhcnRzV2l0aCgiIyIpICYmIHBvcyA8IHBhdGhzLmxlbmd0aCAtIDEpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VhcmNoTm9kZShwYXRocywgcG9zICsgMSk7CiAgICB9CiAgICBjb25zdCBzdGFjayA9IFtdOwogICAgbGV0IG5vZGUgPSB0aGlzOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKGNvbXBvbmVudC5uYW1lID09PSBub2RlLm5vZGVOYW1lKSB7CiAgICAgICAgaWYgKGNvbXBvbmVudC5wb3MgPT09IDApIHsKICAgICAgICAgIGNvbnN0IHJlcyA9IG5vZGUuc2VhcmNoTm9kZShwYXRocywgcG9zICsgMSk7CiAgICAgICAgICBpZiAocmVzICE9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBbcGFyZW50XSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbGV0IHNpYmxpbmdQb3MgPSAwOwogICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBwYXJlbnQuY2hpbGROb2RlcykgewogICAgICAgICAgICBpZiAoY29tcG9uZW50Lm5hbWUgPT09IGNoaWxkLm5vZGVOYW1lKSB7CiAgICAgICAgICAgICAgaWYgKHNpYmxpbmdQb3MgPT09IGNvbXBvbmVudC5wb3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZC5zZWFyY2hOb2RlKHBhdGhzLCBwb3MgKyAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2libGluZ1BvcysrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbm9kZS5zZWFyY2hOb2RlKHBhdGhzLCBwb3MgKyAxKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG5vZGUuY2hpbGROb2Rlcz8ubGVuZ3RoID4gMCkgewogICAgICAgIHN0YWNrLnB1c2goW25vZGUsIDBdKTsKICAgICAgICBub2RlID0gbm9kZS5jaGlsZE5vZGVzWzBdOwogICAgICB9IGVsc2UgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggIT09IDApIHsKICAgICAgICAgIGNvbnN0IFtwYXJlbnQsIGN1cnJlbnRQb3NdID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBjb25zdCBuZXdQb3MgPSBjdXJyZW50UG9zICsgMTsKICAgICAgICAgIGlmIChuZXdQb3MgPCBwYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGgpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChbcGFyZW50LCBuZXdQb3NdKTsKICAgICAgICAgICAgbm9kZSA9IHBhcmVudC5jaGlsZE5vZGVzW25ld1Bvc107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgZHVtcChidWZmZXIpIHsKICAgIGlmICh0aGlzLm5vZGVOYW1lID09PSAiI3RleHQiKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGVuY29kZVRvWG1sU3RyaW5nKHRoaXMubm9kZVZhbHVlKSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGJ1ZmZlci5wdXNoKGA8JHt0aGlzLm5vZGVOYW1lfWApOwogICAgaWYgKHRoaXMuYXR0cmlidXRlcykgewogICAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZSBvZiB0aGlzLmF0dHJpYnV0ZXMpIHsKICAgICAgICBidWZmZXIucHVzaChgICR7YXR0cmlidXRlLm5hbWV9PSIke2VuY29kZVRvWG1sU3RyaW5nKGF0dHJpYnV0ZS52YWx1ZSl9ImApOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgYnVmZmVyLnB1c2goIj4iKTsKICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLmNoaWxkTm9kZXMpIHsKICAgICAgICBjaGlsZC5kdW1wKGJ1ZmZlcik7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goYDwvJHt0aGlzLm5vZGVOYW1lfT5gKTsKICAgIH0gZWxzZSBpZiAodGhpcy5ub2RlVmFsdWUpIHsKICAgICAgYnVmZmVyLnB1c2goYD4ke2VuY29kZVRvWG1sU3RyaW5nKHRoaXMubm9kZVZhbHVlKX08LyR7dGhpcy5ub2RlTmFtZX0+YCk7CiAgICB9IGVsc2UgewogICAgICBidWZmZXIucHVzaCgiLz4iKTsKICAgIH0KICB9Cn0KY2xhc3MgU2ltcGxlWE1MUGFyc2VyIGV4dGVuZHMgWE1MUGFyc2VyQmFzZSB7CiAgY29uc3RydWN0b3IoewogICAgaGFzQXR0cmlidXRlcyA9IGZhbHNlLAogICAgbG93ZXJDYXNlTmFtZSA9IGZhbHNlCiAgfSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudCA9IG51bGw7CiAgICB0aGlzLl9zdGFjayA9IG51bGw7CiAgICB0aGlzLl9lcnJvckNvZGUgPSBYTUxQYXJzZXJFcnJvckNvZGUuTm9FcnJvcjsKICAgIHRoaXMuX2hhc0F0dHJpYnV0ZXMgPSBoYXNBdHRyaWJ1dGVzOwogICAgdGhpcy5fbG93ZXJDYXNlTmFtZSA9IGxvd2VyQ2FzZU5hbWU7CiAgfQogIHBhcnNlRnJvbVN0cmluZyhkYXRhKSB7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQgPSBbXTsKICAgIHRoaXMuX3N0YWNrID0gW107CiAgICB0aGlzLl9lcnJvckNvZGUgPSBYTUxQYXJzZXJFcnJvckNvZGUuTm9FcnJvcjsKICAgIHRoaXMucGFyc2VYbWwoZGF0YSk7CiAgICBpZiAodGhpcy5fZXJyb3JDb2RlICE9PSBYTUxQYXJzZXJFcnJvckNvZGUuTm9FcnJvcikgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgY29uc3QgW2RvY3VtZW50RWxlbWVudF0gPSB0aGlzLl9jdXJyZW50RnJhZ21lbnQ7CiAgICBpZiAoIWRvY3VtZW50RWxlbWVudCkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgZG9jdW1lbnRFbGVtZW50CiAgICB9OwogIH0KICBvblRleHQodGV4dCkgewogICAgaWYgKGlzV2hpdGVzcGFjZVN0cmluZyh0ZXh0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBub2RlID0gbmV3IFNpbXBsZURPTU5vZGUoIiN0ZXh0IiwgdGV4dCk7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQucHVzaChub2RlKTsKICB9CiAgb25DZGF0YSh0ZXh0KSB7CiAgICBjb25zdCBub2RlID0gbmV3IFNpbXBsZURPTU5vZGUoIiN0ZXh0IiwgdGV4dCk7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQucHVzaChub2RlKTsKICB9CiAgb25CZWdpbkVsZW1lbnQobmFtZSwgYXR0cmlidXRlcywgaXNFbXB0eSkgewogICAgaWYgKHRoaXMuX2xvd2VyQ2FzZU5hbWUpIHsKICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIH0KICAgIGNvbnN0IG5vZGUgPSBuZXcgU2ltcGxlRE9NTm9kZShuYW1lKTsKICAgIG5vZGUuY2hpbGROb2RlcyA9IFtdOwogICAgaWYgKHRoaXMuX2hhc0F0dHJpYnV0ZXMpIHsKICAgICAgbm9kZS5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKICAgIH0KICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudC5wdXNoKG5vZGUpOwogICAgaWYgKGlzRW1wdHkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fc3RhY2sucHVzaCh0aGlzLl9jdXJyZW50RnJhZ21lbnQpOwogICAgdGhpcy5fY3VycmVudEZyYWdtZW50ID0gbm9kZS5jaGlsZE5vZGVzOwogIH0KICBvbkVuZEVsZW1lbnQobmFtZSkgewogICAgdGhpcy5fY3VycmVudEZyYWdtZW50ID0gdGhpcy5fc3RhY2sucG9wKCkgfHwgW107CiAgICBjb25zdCBsYXN0RWxlbWVudCA9IHRoaXMuX2N1cnJlbnRGcmFnbWVudC5hdCgtMSk7CiAgICBpZiAoIWxhc3RFbGVtZW50KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgZm9yIChjb25zdCBjaGlsZE5vZGUgb2YgbGFzdEVsZW1lbnQuY2hpbGROb2RlcykgewogICAgICBjaGlsZE5vZGUucGFyZW50Tm9kZSA9IGxhc3RFbGVtZW50OwogICAgfQogICAgcmV0dXJuIGxhc3RFbGVtZW50OwogIH0KICBvbkVycm9yKGNvZGUpIHsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IGNvZGU7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9tZXRhZGF0YV9wYXJzZXIuanMKCmNsYXNzIE1ldGFkYXRhUGFyc2VyIHsKICBjb25zdHJ1Y3RvcihkYXRhKSB7CiAgICBkYXRhID0gdGhpcy5fcmVwYWlyKGRhdGEpOwogICAgY29uc3QgcGFyc2VyID0gbmV3IFNpbXBsZVhNTFBhcnNlcih7CiAgICAgIGxvd2VyQ2FzZU5hbWU6IHRydWUKICAgIH0pOwogICAgY29uc3QgeG1sRG9jdW1lbnQgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKGRhdGEpOwogICAgdGhpcy5fbWV0YWRhdGFNYXAgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9kYXRhID0gZGF0YTsKICAgIGlmICh4bWxEb2N1bWVudCkgewogICAgICB0aGlzLl9wYXJzZSh4bWxEb2N1bWVudCk7CiAgICB9CiAgfQogIF9yZXBhaXIoZGF0YSkgewogICAgcmV0dXJuIGRhdGEucmVwbGFjZSgvXltePF0rLywgIiIpLnJlcGxhY2VBbGwoLz5cXDM3NlxcMzc3KFtePF0rKS9nLCBmdW5jdGlvbiAoYWxsLCBjb2RlcykgewogICAgICBjb25zdCBieXRlcyA9IGNvZGVzLnJlcGxhY2VBbGwoL1xcKFswLTNdKShbMC03XSkoWzAtN10pL2csIGZ1bmN0aW9uIChjb2RlLCBkMSwgZDIsIGQzKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZDEgKiA2NCArIGQyICogOCArIGQzICogMSk7CiAgICAgIH0pLnJlcGxhY2VBbGwoLyYoYW1wfGFwb3N8Z3R8bHR8cXVvdCk7L2csIGZ1bmN0aW9uIChzdHIsIG5hbWUpIHsKICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgIGNhc2UgImFtcCI6CiAgICAgICAgICAgIHJldHVybiAiJiI7CiAgICAgICAgICBjYXNlICJhcG9zIjoKICAgICAgICAgICAgcmV0dXJuICInIjsKICAgICAgICAgIGNhc2UgImd0IjoKICAgICAgICAgICAgcmV0dXJuICI+IjsKICAgICAgICAgIGNhc2UgImx0IjoKICAgICAgICAgICAgcmV0dXJuICI8IjsKICAgICAgICAgIGNhc2UgInF1b3QiOgogICAgICAgICAgICByZXR1cm4gJyInOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYF9yZXBhaXI6ICR7bmFtZX0gaXNuJ3QgZGVmaW5lZC5gKTsKICAgICAgfSk7CiAgICAgIGNvbnN0IGNoYXJCdWYgPSBbIj4iXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYnl0ZXMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgIGNvbnN0IGNvZGUgPSBieXRlcy5jaGFyQ29kZUF0KGkpICogMjU2ICsgYnl0ZXMuY2hhckNvZGVBdChpICsgMSk7CiAgICAgICAgaWYgKGNvZGUgPj0gMzIgJiYgY29kZSA8IDEyNyAmJiBjb2RlICE9PSA2MCAmJiBjb2RlICE9PSA2MiAmJiBjb2RlICE9PSAzOCkgewogICAgICAgICAgY2hhckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjaGFyQnVmLnB1c2goIiYjeCIgKyAoMHgxMDAwMCArIGNvZGUpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSkgKyAiOyIpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2hhckJ1Zi5qb2luKCIiKTsKICAgIH0pOwogIH0KICBfZ2V0U2VxdWVuY2UoZW50cnkpIHsKICAgIGNvbnN0IG5hbWUgPSBlbnRyeS5ub2RlTmFtZTsKICAgIGlmIChuYW1lICE9PSAicmRmOmJhZyIgJiYgbmFtZSAhPT0gInJkZjpzZXEiICYmIG5hbWUgIT09ICJyZGY6YWx0IikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiBlbnRyeS5jaGlsZE5vZGVzLmZpbHRlcihub2RlID0+IG5vZGUubm9kZU5hbWUgPT09ICJyZGY6bGkiKTsKICB9CiAgX3BhcnNlQXJyYXkoZW50cnkpIHsKICAgIGlmICghZW50cnkuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFtzZXFOb2RlXSA9IGVudHJ5LmNoaWxkTm9kZXM7CiAgICBjb25zdCBzZXF1ZW5jZSA9IHRoaXMuX2dldFNlcXVlbmNlKHNlcU5vZGUpIHx8IFtdOwogICAgdGhpcy5fbWV0YWRhdGFNYXAuc2V0KGVudHJ5Lm5vZGVOYW1lLCBzZXF1ZW5jZS5tYXAobm9kZSA9PiBub2RlLnRleHRDb250ZW50LnRyaW0oKSkpOwogIH0KICBfcGFyc2UoeG1sRG9jdW1lbnQpIHsKICAgIGxldCByZGYgPSB4bWxEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICBpZiAocmRmLm5vZGVOYW1lICE9PSAicmRmOnJkZiIpIHsKICAgICAgcmRmID0gcmRmLmZpcnN0Q2hpbGQ7CiAgICAgIHdoaWxlIChyZGYgJiYgcmRmLm5vZGVOYW1lICE9PSAicmRmOnJkZiIpIHsKICAgICAgICByZGYgPSByZGYubmV4dFNpYmxpbmc7CiAgICAgIH0KICAgIH0KICAgIGlmICghcmRmIHx8IHJkZi5ub2RlTmFtZSAhPT0gInJkZjpyZGYiIHx8ICFyZGYuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgZGVzYyBvZiByZGYuY2hpbGROb2RlcykgewogICAgICBpZiAoZGVzYy5ub2RlTmFtZSAhPT0gInJkZjpkZXNjcmlwdGlvbiIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGRlc2MuY2hpbGROb2RlcykgewogICAgICAgIGNvbnN0IG5hbWUgPSBlbnRyeS5ub2RlTmFtZTsKICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgIGNhc2UgIiN0ZXh0IjoKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlICJkYzpjcmVhdG9yIjoKICAgICAgICAgIGNhc2UgImRjOnN1YmplY3QiOgogICAgICAgICAgICB0aGlzLl9wYXJzZUFycmF5KGVudHJ5KTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRoaXMuX21ldGFkYXRhTWFwLnNldChuYW1lLCBlbnRyeS50ZXh0Q29udGVudC50cmltKCkpOwogICAgICB9CiAgICB9CiAgfQogIGdldCBzZXJpYWxpemFibGUoKSB7CiAgICByZXR1cm4gewogICAgICBwYXJzZWREYXRhOiB0aGlzLl9tZXRhZGF0YU1hcCwKICAgICAgcmF3RGF0YTogdGhpcy5fZGF0YQogICAgfTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3N0cnVjdF90cmVlLmpzCgoKCgoKY29uc3QgTUFYX0RFUFRIID0gNDA7CmNvbnN0IFN0cnVjdEVsZW1lbnRUeXBlID0gewogIFBBR0VfQ09OVEVOVDogMSwKICBTVFJFQU1fQ09OVEVOVDogMiwKICBPQkpFQ1Q6IDMsCiAgQU5OT1RBVElPTjogNCwKICBFTEVNRU5UOiA1Cn07CmNsYXNzIFN0cnVjdFRyZWVSb290IHsKICBjb25zdHJ1Y3Rvcih4cmVmLCByb290RGljdCwgcm9vdFJlZikgewogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMuZGljdCA9IHJvb3REaWN0OwogICAgdGhpcy5yZWYgPSByb290UmVmIGluc3RhbmNlb2YgUmVmID8gcm9vdFJlZiA6IG51bGw7CiAgICB0aGlzLnJvbGVNYXAgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnN0cnVjdFBhcmVudElkcyA9IG51bGw7CiAgICB0aGlzLmtpZFJlZlRvUG9zaXRpb24gPSB1bmRlZmluZWQ7CiAgICB0aGlzLnBhcmVudFRyZWUgPSBudWxsOwogIH0KICBnZXRLaWRQb3NpdGlvbihraWRSZWYpIHsKICAgIGlmICh0aGlzLmtpZFJlZlRvUG9zaXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBvYmogPSB0aGlzLmRpY3QuZ2V0KCJLIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHsKICAgICAgICBjb25zdCBtYXAgPSB0aGlzLmtpZFJlZlRvUG9zaXRpb24gPSBuZXcgTWFwKCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gb2JqLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHJlZiA9IG9ialtpXTsKICAgICAgICAgIGlmIChyZWYpIHsKICAgICAgICAgICAgbWFwLnNldChyZWYudG9TdHJpbmcoKSwgaSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICB0aGlzLmtpZFJlZlRvUG9zaXRpb24gPSBuZXcgTWFwKFtbb2JqLm9iaklkLCAwXV0pOwogICAgICB9IGVsc2UgaWYgKCFvYmopIHsKICAgICAgICB0aGlzLmtpZFJlZlRvUG9zaXRpb24gPSBuZXcgTWFwKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5raWRSZWZUb1Bvc2l0aW9uID0gbnVsbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMua2lkUmVmVG9Qb3NpdGlvbiA/IHRoaXMua2lkUmVmVG9Qb3NpdGlvbi5nZXQoa2lkUmVmKSA/PyBOYU4gOiAtMTsKICB9CiAgaW5pdCgpIHsKICAgIHRoaXMucmVhZFJvbGVNYXAoKTsKICAgIGNvbnN0IHBhcmVudFRyZWUgPSB0aGlzLmRpY3QuZ2V0KCJQYXJlbnRUcmVlIik7CiAgICBpZiAoIXBhcmVudFRyZWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5wYXJlbnRUcmVlID0gbmV3IE51bWJlclRyZWUocGFyZW50VHJlZSwgdGhpcy54cmVmKTsKICB9CiAgI2FkZElkVG9QYWdlKHBhZ2VSZWYsIGlkLCB0eXBlKSB7CiAgICBpZiAoIShwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSB8fCBpZCA8IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5zdHJ1Y3RQYXJlbnRJZHMgfHw9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgbGV0IGlkcyA9IHRoaXMuc3RydWN0UGFyZW50SWRzLmdldChwYWdlUmVmKTsKICAgIGlmICghaWRzKSB7CiAgICAgIGlkcyA9IFtdOwogICAgICB0aGlzLnN0cnVjdFBhcmVudElkcy5wdXQocGFnZVJlZiwgaWRzKTsKICAgIH0KICAgIGlkcy5wdXNoKFtpZCwgdHlwZV0pOwogIH0KICBhZGRBbm5vdGF0aW9uSWRUb1BhZ2UocGFnZVJlZiwgaWQpIHsKICAgIHRoaXMuI2FkZElkVG9QYWdlKHBhZ2VSZWYsIGlkLCBTdHJ1Y3RFbGVtZW50VHlwZS5BTk5PVEFUSU9OKTsKICB9CiAgcmVhZFJvbGVNYXAoKSB7CiAgICBjb25zdCByb2xlTWFwRGljdCA9IHRoaXMuZGljdC5nZXQoIlJvbGVNYXAiKTsKICAgIGlmICghKHJvbGVNYXBEaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2Ygcm9sZU1hcERpY3QpIHsKICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIHRoaXMucm9sZU1hcC5zZXQoa2V5LCB2YWx1ZS5uYW1lKTsKICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgY2FuQ3JlYXRlU3RydWN0dXJlVHJlZSh7CiAgICBjYXRhbG9nUmVmLAogICAgcGRmTWFuYWdlciwKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlCiAgfSkgewogICAgaWYgKCEoY2F0YWxvZ1JlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgd2FybigiQ2Fubm90IHNhdmUgdGhlIHN0cnVjdCB0cmVlOiBubyBjYXRhbG9nIHJlZmVyZW5jZS4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgbGV0IG5leHRLZXkgPSAwOwogICAgbGV0IGhhc05vdGhpbmdUb1VwZGF0ZSA9IHRydWU7CiAgICBmb3IgKGNvbnN0IFtwYWdlSW5kZXgsIGVsZW1lbnRzXSBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZSkgewogICAgICBjb25zdCB7CiAgICAgICAgcmVmOiBwYWdlUmVmCiAgICAgIH0gPSBhd2FpdCBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KTsKICAgICAgaWYgKCEocGFnZVJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgICB3YXJuKGBDYW5ub3Qgc2F2ZSB0aGUgc3RydWN0IHRyZWU6IHBhZ2UgJHtwYWdlSW5kZXh9IGhhcyBubyByZWYuYCk7CiAgICAgICAgaGFzTm90aGluZ1RvVXBkYXRlID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgICBpZiAoZWxlbWVudC5hY2Nlc3NpYmlsaXR5RGF0YT8udHlwZSkgewogICAgICAgICAgZWxlbWVudC5wYXJlbnRUcmVlSWQgPSBuZXh0S2V5Kys7CiAgICAgICAgICBoYXNOb3RoaW5nVG9VcGRhdGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChoYXNOb3RoaW5nVG9VcGRhdGUpIHsKICAgICAgZm9yIChjb25zdCBlbGVtZW50cyBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZS52YWx1ZXMoKSkgewogICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykgewogICAgICAgICAgZGVsZXRlIGVsZW1lbnQucGFyZW50VHJlZUlkOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZVN0cnVjdHVyZVRyZWUoewogICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICB4cmVmLAogICAgY2F0YWxvZ1JlZiwKICAgIHBkZk1hbmFnZXIsCiAgICBjaGFuZ2VzCiAgfSkgewogICAgY29uc3Qgcm9vdCA9IGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiY2xvbmVEaWN0Iik7CiAgICBjb25zdCBjYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgY2FjaGUucHV0KGNhdGFsb2dSZWYsIHJvb3QpOwogICAgY29uc3Qgc3RydWN0VHJlZVJvb3RSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgcm9vdC5zZXQoIlN0cnVjdFRyZWVSb290Iiwgc3RydWN0VHJlZVJvb3RSZWYpOwogICAgY29uc3Qgc3RydWN0VHJlZVJvb3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIHN0cnVjdFRyZWVSb290LnNldCgiVHlwZSIsIE5hbWUuZ2V0KCJTdHJ1Y3RUcmVlUm9vdCIpKTsKICAgIGNvbnN0IHBhcmVudFRyZWVSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgc3RydWN0VHJlZVJvb3Quc2V0KCJQYXJlbnRUcmVlIiwgcGFyZW50VHJlZVJlZik7CiAgICBjb25zdCBraWRzID0gW107CiAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIksiLCBraWRzKTsKICAgIGNhY2hlLnB1dChzdHJ1Y3RUcmVlUm9vdFJlZiwgc3RydWN0VHJlZVJvb3QpOwogICAgY29uc3QgcGFyZW50VHJlZSA9IG5ldyBEaWN0KHhyZWYpOwogICAgY29uc3QgbnVtcyA9IFtdOwogICAgcGFyZW50VHJlZS5zZXQoIk51bXMiLCBudW1zKTsKICAgIGNvbnN0IG5leHRLZXkgPSBhd2FpdCB0aGlzLiN3cml0ZUtpZHMoewogICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZSwKICAgICAgc3RydWN0VHJlZVJvb3RSZWYsCiAgICAgIHN0cnVjdFRyZWVSb290OiBudWxsLAogICAgICBraWRzLAogICAgICBudW1zLAogICAgICB4cmVmLAogICAgICBwZGZNYW5hZ2VyLAogICAgICBjaGFuZ2VzLAogICAgICBjYWNoZQogICAgfSk7CiAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlBhcmVudFRyZWVOZXh0S2V5IiwgbmV4dEtleSk7CiAgICBjYWNoZS5wdXQocGFyZW50VHJlZVJlZiwgcGFyZW50VHJlZSk7CiAgICBmb3IgKGNvbnN0IFtyZWYsIG9ial0gb2YgY2FjaGUuaXRlbXMoKSkgewogICAgICBjaGFuZ2VzLnB1dChyZWYsIHsKICAgICAgICBkYXRhOiBvYmoKICAgICAgfSk7CiAgICB9CiAgfQogIGFzeW5jIGNhblVwZGF0ZVN0cnVjdFRyZWUoewogICAgcGRmTWFuYWdlciwKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlCiAgfSkgewogICAgaWYgKCF0aGlzLnJlZikgewogICAgICB3YXJuKCJDYW5ub3QgdXBkYXRlIHRoZSBzdHJ1Y3QgdHJlZTogbm8gcm9vdCByZWZlcmVuY2UuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGxldCBuZXh0S2V5ID0gdGhpcy5kaWN0LmdldCgiUGFyZW50VHJlZU5leHRLZXkiKTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihuZXh0S2V5KSB8fCBuZXh0S2V5IDwgMCkgewogICAgICB3YXJuKCJDYW5ub3QgdXBkYXRlIHRoZSBzdHJ1Y3QgdHJlZTogaW52YWxpZCBuZXh0IGtleS4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgcGFyZW50VHJlZSA9IHRoaXMuZGljdC5nZXQoIlBhcmVudFRyZWUiKTsKICAgIGlmICghKHBhcmVudFRyZWUgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICB3YXJuKCJDYW5ub3QgdXBkYXRlIHRoZSBzdHJ1Y3QgdHJlZTogUGFyZW50VHJlZSBpc24ndCBhIGRpY3QuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IG51bXMgPSBwYXJlbnRUcmVlLmdldCgiTnVtcyIpOwogICAgaWYgKCFBcnJheS5pc0FycmF5KG51bXMpKSB7CiAgICAgIHdhcm4oIkNhbm5vdCB1cGRhdGUgdGhlIHN0cnVjdCB0cmVlOiBudW1zIGlzbid0IGFuIGFycmF5LiIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBudW1iZXJUcmVlID0gbmV3IE51bWJlclRyZWUocGFyZW50VHJlZSwgdGhpcy54cmVmKTsKICAgIGZvciAoY29uc3QgcGFnZUluZGV4IG9mIG5ld0Fubm90YXRpb25zQnlQYWdlLmtleXMoKSkgewogICAgICBjb25zdCB7CiAgICAgICAgcGFnZURpY3QKICAgICAgfSA9IGF3YWl0IHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpOwogICAgICBpZiAoIXBhZ2VEaWN0LmhhcygiU3RydWN0UGFyZW50cyIpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaWQgPSBwYWdlRGljdC5nZXQoIlN0cnVjdFBhcmVudHMiKTsKICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGlkKSB8fCAhQXJyYXkuaXNBcnJheShudW1iZXJUcmVlLmdldChpZCkpKSB7CiAgICAgICAgd2FybihgQ2Fubm90IHNhdmUgdGhlIHN0cnVjdCB0cmVlOiBwYWdlICR7cGFnZUluZGV4fSBoYXMgYSB3cm9uZyBpZC5gKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxldCBoYXNOb3RoaW5nVG9VcGRhdGUgPSB0cnVlOwogICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBlbGVtZW50c10gb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2UpIHsKICAgICAgY29uc3QgewogICAgICAgIHBhZ2VEaWN0CiAgICAgIH0gPSBhd2FpdCBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KTsKICAgICAgU3RydWN0VHJlZVJvb3QuI2NvbGxlY3RQYXJlbnRzKHsKICAgICAgICBlbGVtZW50cywKICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgcGFnZURpY3QsCiAgICAgICAgbnVtYmVyVHJlZQogICAgICB9KTsKICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7CiAgICAgICAgaWYgKGVsZW1lbnQuYWNjZXNzaWJpbGl0eURhdGE/LnR5cGUpIHsKICAgICAgICAgIGlmICghKGVsZW1lbnQuYWNjZXNzaWJpbGl0eURhdGEuc3RydWN0UGFyZW50ID49IDApKSB7CiAgICAgICAgICAgIGVsZW1lbnQucGFyZW50VHJlZUlkID0gbmV4dEtleSsrOwogICAgICAgICAgfQogICAgICAgICAgaGFzTm90aGluZ1RvVXBkYXRlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoaGFzTm90aGluZ1RvVXBkYXRlKSB7CiAgICAgIGZvciAoY29uc3QgZWxlbWVudHMgb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2UudmFsdWVzKCkpIHsKICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgICAgIGRlbGV0ZSBlbGVtZW50LnBhcmVudFRyZWVJZDsKICAgICAgICAgIGRlbGV0ZSBlbGVtZW50LnN0cnVjdFRyZWVQYXJlbnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBhc3luYyB1cGRhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgcGRmTWFuYWdlciwKICAgIGNoYW5nZXMKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIHJlZjogc3RydWN0VHJlZVJvb3RSZWYsCiAgICAgIHhyZWYKICAgIH0gPSB0aGlzOwogICAgY29uc3Qgc3RydWN0VHJlZVJvb3QgPSB0aGlzLmRpY3QuY2xvbmUoKTsKICAgIGNvbnN0IGNhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICBjYWNoZS5wdXQoc3RydWN0VHJlZVJvb3RSZWYsIHN0cnVjdFRyZWVSb290KTsKICAgIGxldCBwYXJlbnRUcmVlUmVmID0gc3RydWN0VHJlZVJvb3QuZ2V0UmF3KCJQYXJlbnRUcmVlIik7CiAgICBsZXQgcGFyZW50VHJlZTsKICAgIGlmIChwYXJlbnRUcmVlUmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHBhcmVudFRyZWUgPSB4cmVmLmZldGNoKHBhcmVudFRyZWVSZWYpOwogICAgfSBlbHNlIHsKICAgICAgcGFyZW50VHJlZSA9IHBhcmVudFRyZWVSZWY7CiAgICAgIHBhcmVudFRyZWVSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlBhcmVudFRyZWUiLCBwYXJlbnRUcmVlUmVmKTsKICAgIH0KICAgIHBhcmVudFRyZWUgPSBwYXJlbnRUcmVlLmNsb25lKCk7CiAgICBjYWNoZS5wdXQocGFyZW50VHJlZVJlZiwgcGFyZW50VHJlZSk7CiAgICBsZXQgbnVtcyA9IHBhcmVudFRyZWUuZ2V0UmF3KCJOdW1zIik7CiAgICBsZXQgbnVtc1JlZiA9IG51bGw7CiAgICBpZiAobnVtcyBpbnN0YW5jZW9mIFJlZikgewogICAgICBudW1zUmVmID0gbnVtczsKICAgICAgbnVtcyA9IHhyZWYuZmV0Y2gobnVtc1JlZik7CiAgICB9CiAgICBudW1zID0gbnVtcy5zbGljZSgpOwogICAgaWYgKCFudW1zUmVmKSB7CiAgICAgIHBhcmVudFRyZWUuc2V0KCJOdW1zIiwgbnVtcyk7CiAgICB9CiAgICBjb25zdCBuZXdOZXh0S2V5ID0gYXdhaXQgU3RydWN0VHJlZVJvb3QuI3dyaXRlS2lkcyh7CiAgICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgICBzdHJ1Y3RUcmVlUm9vdFJlZiwKICAgICAgc3RydWN0VHJlZVJvb3Q6IHRoaXMsCiAgICAgIGtpZHM6IG51bGwsCiAgICAgIG51bXMsCiAgICAgIHhyZWYsCiAgICAgIHBkZk1hbmFnZXIsCiAgICAgIGNoYW5nZXMsCiAgICAgIGNhY2hlCiAgICB9KTsKICAgIGlmIChuZXdOZXh0S2V5ID09PSAtMSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlBhcmVudFRyZWVOZXh0S2V5IiwgbmV3TmV4dEtleSk7CiAgICBpZiAobnVtc1JlZikgewogICAgICBjYWNoZS5wdXQobnVtc1JlZiwgbnVtcyk7CiAgICB9CiAgICBmb3IgKGNvbnN0IFtyZWYsIG9ial0gb2YgY2FjaGUuaXRlbXMoKSkgewogICAgICBjaGFuZ2VzLnB1dChyZWYsIHsKICAgICAgICBkYXRhOiBvYmoKICAgICAgfSk7CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyAjd3JpdGVLaWRzKHsKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgc3RydWN0VHJlZVJvb3RSZWYsCiAgICBzdHJ1Y3RUcmVlUm9vdCwKICAgIGtpZHMsCiAgICBudW1zLAogICAgeHJlZiwKICAgIHBkZk1hbmFnZXIsCiAgICBjaGFuZ2VzLAogICAgY2FjaGUKICB9KSB7CiAgICBjb25zdCBvYmpyID0gTmFtZS5nZXQoIk9CSlIiKTsKICAgIGxldCBuZXh0S2V5ID0gLTE7CiAgICBsZXQgc3RydWN0VHJlZVBhZ2VPYmpzOwogICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBlbGVtZW50c10gb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2UpIHsKICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpOwogICAgICBjb25zdCB7CiAgICAgICAgcmVmOiBwYWdlUmVmCiAgICAgIH0gPSBwYWdlOwogICAgICBjb25zdCBpc1BhZ2VSZWYgPSBwYWdlUmVmIGluc3RhbmNlb2YgUmVmOwogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICBhY2Nlc3NpYmlsaXR5RGF0YSwKICAgICAgICByZWYsCiAgICAgICAgcGFyZW50VHJlZUlkLAogICAgICAgIHN0cnVjdFRyZWVQYXJlbnQKICAgICAgfSBvZiBlbGVtZW50cykgewogICAgICAgIGlmICghYWNjZXNzaWJpbGl0eURhdGE/LnR5cGUpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCB7CiAgICAgICAgICBzdHJ1Y3RQYXJlbnQKICAgICAgICB9ID0gYWNjZXNzaWJpbGl0eURhdGE7CiAgICAgICAgaWYgKHN0cnVjdFRyZWVSb290ICYmIE51bWJlci5pc0ludGVnZXIoc3RydWN0UGFyZW50KSAmJiBzdHJ1Y3RQYXJlbnQgPj0gMCkgewogICAgICAgICAgbGV0IG9ianMgPSAoc3RydWN0VHJlZVBhZ2VPYmpzIHx8PSBuZXcgTWFwKCkpLmdldChwYWdlSW5kZXgpOwogICAgICAgICAgaWYgKG9ianMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzdHJ1Y3RUcmVlUGFnZSA9IG5ldyBTdHJ1Y3RUcmVlUGFnZShzdHJ1Y3RUcmVlUm9vdCwgcGFnZS5wYWdlRGljdCk7CiAgICAgICAgICAgIG9ianMgPSBzdHJ1Y3RUcmVlUGFnZS5jb2xsZWN0T2JqZWN0cyhwYWdlUmVmKTsKICAgICAgICAgICAgc3RydWN0VHJlZVBhZ2VPYmpzLnNldChwYWdlSW5kZXgsIG9ianMpOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgb2JqUmVmID0gb2Jqcz8uZ2V0KHN0cnVjdFBhcmVudCk7CiAgICAgICAgICBpZiAob2JqUmVmKSB7CiAgICAgICAgICAgIGNvbnN0IHRhZ0RpY3QgPSB4cmVmLmZldGNoKG9ialJlZikuY2xvbmUoKTsKICAgICAgICAgICAgU3RydWN0VHJlZVJvb3QuI3dyaXRlUHJvcGVydGllcyh0YWdEaWN0LCBhY2Nlc3NpYmlsaXR5RGF0YSk7CiAgICAgICAgICAgIGNoYW5nZXMucHV0KG9ialJlZiwgewogICAgICAgICAgICAgIGRhdGE6IHRhZ0RpY3QKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBuZXh0S2V5ID0gTWF0aC5tYXgobmV4dEtleSwgcGFyZW50VHJlZUlkKTsKICAgICAgICBjb25zdCB0YWdSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICAgIGNvbnN0IHRhZ0RpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgICBTdHJ1Y3RUcmVlUm9vdC4jd3JpdGVQcm9wZXJ0aWVzKHRhZ0RpY3QsIGFjY2Vzc2liaWxpdHlEYXRhKTsKICAgICAgICBhd2FpdCB0aGlzLiN1cGRhdGVQYXJlbnRUYWcoewogICAgICAgICAgc3RydWN0VHJlZVBhcmVudCwKICAgICAgICAgIHRhZ0RpY3QsCiAgICAgICAgICBuZXdUYWdSZWY6IHRhZ1JlZiwKICAgICAgICAgIHN0cnVjdFRyZWVSb290UmVmLAogICAgICAgICAgZmFsbGJhY2tLaWRzOiBraWRzLAogICAgICAgICAgeHJlZiwKICAgICAgICAgIGNhY2hlCiAgICAgICAgfSk7CiAgICAgICAgY29uc3Qgb2JqRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICAgIHRhZ0RpY3Quc2V0KCJLIiwgb2JqRGljdCk7CiAgICAgICAgb2JqRGljdC5zZXQoIlR5cGUiLCBvYmpyKTsKICAgICAgICBpZiAoaXNQYWdlUmVmKSB7CiAgICAgICAgICBvYmpEaWN0LnNldCgiUGciLCBwYWdlUmVmKTsKICAgICAgICB9CiAgICAgICAgb2JqRGljdC5zZXQoIk9iaiIsIHJlZik7CiAgICAgICAgY2FjaGUucHV0KHRhZ1JlZiwgdGFnRGljdCk7CiAgICAgICAgbnVtcy5wdXNoKHBhcmVudFRyZWVJZCwgdGFnUmVmKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5leHRLZXkgKyAxOwogIH0KICBzdGF0aWMgI3dyaXRlUHJvcGVydGllcyh0YWdEaWN0LCB7CiAgICB0eXBlLAogICAgdGl0bGUsCiAgICBsYW5nLAogICAgYWx0LAogICAgZXhwYW5kZWQsCiAgICBhY3R1YWxUZXh0CiAgfSkgewogICAgdGFnRGljdC5zZXQoIlMiLCBOYW1lLmdldCh0eXBlKSk7CiAgICBpZiAodGl0bGUpIHsKICAgICAgdGFnRGljdC5zZXQoIlQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHRpdGxlKSk7CiAgICB9CiAgICBpZiAobGFuZykgewogICAgICB0YWdEaWN0LnNldCgiTGFuZyIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUobGFuZykpOwogICAgfQogICAgaWYgKGFsdCkgewogICAgICB0YWdEaWN0LnNldCgiQWx0Iiwgc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRShhbHQpKTsKICAgIH0KICAgIGlmIChleHBhbmRlZCkgewogICAgICB0YWdEaWN0LnNldCgiRSIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUoZXhwYW5kZWQpKTsKICAgIH0KICAgIGlmIChhY3R1YWxUZXh0KSB7CiAgICAgIHRhZ0RpY3Quc2V0KCJBY3R1YWxUZXh0Iiwgc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRShhY3R1YWxUZXh0KSk7CiAgICB9CiAgfQogIHN0YXRpYyAjY29sbGVjdFBhcmVudHMoewogICAgZWxlbWVudHMsCiAgICB4cmVmLAogICAgcGFnZURpY3QsCiAgICBudW1iZXJUcmVlCiAgfSkgewogICAgY29uc3QgaWRUb0VsZW1lbnRzID0gbmV3IE1hcCgpOwogICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7CiAgICAgIGlmIChlbGVtZW50LnN0cnVjdFRyZWVQYXJlbnRJZCkgewogICAgICAgIGNvbnN0IGlkID0gcGFyc2VJbnQoZWxlbWVudC5zdHJ1Y3RUcmVlUGFyZW50SWQuc3BsaXQoIl9tYyIpWzFdLCAxMCk7CiAgICAgICAgbGV0IGVsZW1zID0gaWRUb0VsZW1lbnRzLmdldChpZCk7CiAgICAgICAgaWYgKCFlbGVtcykgewogICAgICAgICAgZWxlbXMgPSBbXTsKICAgICAgICAgIGlkVG9FbGVtZW50cy5zZXQoaWQsIGVsZW1zKTsKICAgICAgICB9CiAgICAgICAgZWxlbXMucHVzaChlbGVtZW50KTsKICAgICAgfQogICAgfQogICAgY29uc3QgaWQgPSBwYWdlRGljdC5nZXQoIlN0cnVjdFBhcmVudHMiKTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihpZCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFyZW50QXJyYXkgPSBudW1iZXJUcmVlLmdldChpZCk7CiAgICBjb25zdCB1cGRhdGVFbGVtZW50ID0gKGtpZCwgcGFnZUtpZCwga2lkUmVmKSA9PiB7CiAgICAgIGNvbnN0IGVsZW1zID0gaWRUb0VsZW1lbnRzLmdldChraWQpOwogICAgICBpZiAoZWxlbXMpIHsKICAgICAgICBjb25zdCBwYXJlbnRSZWYgPSBwYWdlS2lkLmdldFJhdygiUCIpOwogICAgICAgIGNvbnN0IHBhcmVudERpY3QgPSB4cmVmLmZldGNoSWZSZWYocGFyZW50UmVmKTsKICAgICAgICBpZiAocGFyZW50UmVmIGluc3RhbmNlb2YgUmVmICYmIHBhcmVudERpY3QgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICAgIHJlZjoga2lkUmVmLAogICAgICAgICAgICBkaWN0OiBwYWdlS2lkCiAgICAgICAgICB9OwogICAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1zKSB7CiAgICAgICAgICAgIGVsZW1lbnQuc3RydWN0VHJlZVBhcmVudCA9IHBhcmFtczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKICAgIGZvciAoY29uc3Qga2lkUmVmIG9mIHBhcmVudEFycmF5KSB7CiAgICAgIGlmICghKGtpZFJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBwYWdlS2lkID0geHJlZi5mZXRjaChraWRSZWYpOwogICAgICBjb25zdCBrID0gcGFnZUtpZC5nZXQoIksiKTsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoaykpIHsKICAgICAgICB1cGRhdGVFbGVtZW50KGssIHBhZ2VLaWQsIGtpZFJlZik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGspKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQga2lkIG9mIGspIHsKICAgICAgICBraWQgPSB4cmVmLmZldGNoSWZSZWYoa2lkKTsKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihraWQpICYmIHVwZGF0ZUVsZW1lbnQoa2lkLCBwYWdlS2lkLCBraWRSZWYpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKCEoa2lkIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzTmFtZShraWQuZ2V0KCJUeXBlIiksICJNQ1IiKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1jaWQgPSBraWQuZ2V0KCJNQ0lEIik7CiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIobWNpZCkgJiYgdXBkYXRlRWxlbWVudChtY2lkLCBwYWdlS2lkLCBraWRSZWYpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIGFzeW5jICN1cGRhdGVQYXJlbnRUYWcoewogICAgc3RydWN0VHJlZVBhcmVudCwKICAgIHRhZ0RpY3QsCiAgICBuZXdUYWdSZWYsCiAgICBzdHJ1Y3RUcmVlUm9vdFJlZiwKICAgIGZhbGxiYWNrS2lkcywKICAgIHhyZWYsCiAgICBjYWNoZQogIH0pIHsKICAgIGxldCByZWYgPSBudWxsOwogICAgbGV0IHBhcmVudFJlZjsKICAgIGlmIChzdHJ1Y3RUcmVlUGFyZW50KSB7CiAgICAgICh7CiAgICAgICAgcmVmCiAgICAgIH0gPSBzdHJ1Y3RUcmVlUGFyZW50KTsKICAgICAgcGFyZW50UmVmID0gc3RydWN0VHJlZVBhcmVudC5kaWN0LmdldFJhdygiUCIpIHx8IHN0cnVjdFRyZWVSb290UmVmOwogICAgfSBlbHNlIHsKICAgICAgcGFyZW50UmVmID0gc3RydWN0VHJlZVJvb3RSZWY7CiAgICB9CiAgICB0YWdEaWN0LnNldCgiUCIsIHBhcmVudFJlZik7CiAgICBjb25zdCBwYXJlbnREaWN0ID0geHJlZi5mZXRjaElmUmVmKHBhcmVudFJlZik7CiAgICBpZiAoIXBhcmVudERpY3QpIHsKICAgICAgZmFsbGJhY2tLaWRzLnB1c2gobmV3VGFnUmVmKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGNhY2hlZFBhcmVudERpY3QgPSBjYWNoZS5nZXQocGFyZW50UmVmKTsKICAgIGlmICghY2FjaGVkUGFyZW50RGljdCkgewogICAgICBjYWNoZWRQYXJlbnREaWN0ID0gcGFyZW50RGljdC5jbG9uZSgpOwogICAgICBjYWNoZS5wdXQocGFyZW50UmVmLCBjYWNoZWRQYXJlbnREaWN0KTsKICAgIH0KICAgIGNvbnN0IHBhcmVudEtpZHNSYXcgPSBjYWNoZWRQYXJlbnREaWN0LmdldFJhdygiSyIpOwogICAgbGV0IGNhY2hlZFBhcmVudEtpZHMgPSBwYXJlbnRLaWRzUmF3IGluc3RhbmNlb2YgUmVmID8gY2FjaGUuZ2V0KHBhcmVudEtpZHNSYXcpIDogbnVsbDsKICAgIGlmICghY2FjaGVkUGFyZW50S2lkcykgewogICAgICBjYWNoZWRQYXJlbnRLaWRzID0geHJlZi5mZXRjaElmUmVmKHBhcmVudEtpZHNSYXcpOwogICAgICBjYWNoZWRQYXJlbnRLaWRzID0gQXJyYXkuaXNBcnJheShjYWNoZWRQYXJlbnRLaWRzKSA/IGNhY2hlZFBhcmVudEtpZHMuc2xpY2UoKSA6IFtwYXJlbnRLaWRzUmF3XTsKICAgICAgY29uc3QgcGFyZW50S2lkc1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIGNhY2hlZFBhcmVudERpY3Quc2V0KCJLIiwgcGFyZW50S2lkc1JlZik7CiAgICAgIGNhY2hlLnB1dChwYXJlbnRLaWRzUmVmLCBjYWNoZWRQYXJlbnRLaWRzKTsKICAgIH0KICAgIGNvbnN0IGluZGV4ID0gY2FjaGVkUGFyZW50S2lkcy5pbmRleE9mKHJlZik7CiAgICBjYWNoZWRQYXJlbnRLaWRzLnNwbGljZShpbmRleCA+PSAwID8gaW5kZXggKyAxIDogY2FjaGVkUGFyZW50S2lkcy5sZW5ndGgsIDAsIG5ld1RhZ1JlZik7CiAgfQp9CmNsYXNzIFN0cnVjdEVsZW1lbnROb2RlIHsKICBjb25zdHJ1Y3Rvcih0cmVlLCBkaWN0KSB7CiAgICB0aGlzLnRyZWUgPSB0cmVlOwogICAgdGhpcy54cmVmID0gdHJlZS54cmVmOwogICAgdGhpcy5kaWN0ID0gZGljdDsKICAgIHRoaXMua2lkcyA9IFtdOwogICAgdGhpcy5wYXJzZUtpZHMoKTsKICB9CiAgZ2V0IHJvbGUoKSB7CiAgICBjb25zdCBuYW1lT2JqID0gdGhpcy5kaWN0LmdldCgiUyIpOwogICAgY29uc3QgbmFtZSA9IG5hbWVPYmogaW5zdGFuY2VvZiBOYW1lID8gbmFtZU9iai5uYW1lIDogIiI7CiAgICBjb25zdCB7CiAgICAgIHJvb3QKICAgIH0gPSB0aGlzLnRyZWU7CiAgICByZXR1cm4gcm9vdC5yb2xlTWFwLmdldChuYW1lKSA/PyBuYW1lOwogIH0KICBnZXQgbWF0aE1MKCkgewogICAgbGV0IEFGcyA9IHRoaXMuZGljdC5nZXQoIkFGIikgfHwgW107CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoQUZzKSkgewogICAgICBBRnMgPSBbQUZzXTsKICAgIH0KICAgIGZvciAobGV0IGFmIG9mIEFGcykgewogICAgICBhZiA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGFmKTsKICAgICAgaWYgKCEoYWYgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghaXNOYW1lKGFmLmdldCgiVHlwZSIpLCAiRmlsZXNwZWMiKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghaXNOYW1lKGFmLmdldCgiQUZSZWxhdGlvbnNoaXAiKSwgIlN1cHBsZW1lbnQiKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGVmID0gYWYuZ2V0KCJFRiIpOwogICAgICBpZiAoIShlZiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgZmlsZVN0cmVhbSA9IGVmLmdldCgiVUYiKSB8fCBlZi5nZXQoIkYiKTsKICAgICAgaWYgKCEoZmlsZVN0cmVhbSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFpc05hbWUoZmlsZVN0cmVhbS5kaWN0LmdldCgiVHlwZSIpLCAiRW1iZWRkZWRGaWxlIikpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIWlzTmFtZShmaWxlU3RyZWFtLmRpY3QuZ2V0KCJTdWJ0eXBlIiksICJhcHBsaWNhdGlvbi9tYXRobWwreG1sIikpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICByZXR1cm4gc3RyaW5nVG9VVEY4U3RyaW5nKGZpbGVTdHJlYW0uZ2V0U3RyaW5nKCkpOwogICAgfQogICAgY29uc3QgQSA9IHRoaXMuZGljdC5nZXQoIkEiKTsKICAgIGlmIChBIGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBPID0gQS5nZXQoIk8iKTsKICAgICAgaWYgKGlzTmFtZShPLCAiTVNGVF9PZmZpY2UiKSkgewogICAgICAgIGNvbnN0IG1hdGhtbCA9IEEuZ2V0KCJNU0ZUX01hdGhNTCIpOwogICAgICAgIHJldHVybiBtYXRobWwgPyBzdHJpbmdUb1BERlN0cmluZyhtYXRobWwpIDogbnVsbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIHBhcnNlS2lkcygpIHsKICAgIGxldCBwYWdlT2JqSWQgPSBudWxsOwogICAgY29uc3Qgb2JqUmVmID0gdGhpcy5kaWN0LmdldFJhdygiUGciKTsKICAgIGlmIChvYmpSZWYgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgcGFnZU9iaklkID0gb2JqUmVmLnRvU3RyaW5nKCk7CiAgICB9CiAgICBjb25zdCBraWRzID0gdGhpcy5kaWN0LmdldCgiSyIpOwogICAgaWYgKEFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgZm9yIChjb25zdCBraWQgb2Yga2lkcykgewogICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLnBhcnNlS2lkKHBhZ2VPYmpJZCwgdGhpcy54cmVmLmZldGNoSWZSZWYoa2lkKSk7CiAgICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICAgIHRoaXMua2lkcy5wdXNoKGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMucGFyc2VLaWQocGFnZU9iaklkLCBraWRzKTsKICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICB0aGlzLmtpZHMucHVzaChlbGVtZW50KTsKICAgICAgfQogICAgfQogIH0KICBwYXJzZUtpZChwYWdlT2JqSWQsIGtpZCkgewogICAgaWYgKE51bWJlci5pc0ludGVnZXIoa2lkKSkgewogICAgICBpZiAodGhpcy50cmVlLnBhZ2VEaWN0Lm9iaklkICE9PSBwYWdlT2JqSWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gbmV3IFN0cnVjdEVsZW1lbnQoewogICAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLlBBR0VfQ09OVEVOVCwKICAgICAgICBtY2lkOiBraWQsCiAgICAgICAgcGFnZU9iaklkCiAgICAgIH0pOwogICAgfQogICAgaWYgKCEoa2lkIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBwYWdlUmVmID0ga2lkLmdldFJhdygiUGciKTsKICAgIGlmIChwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHBhZ2VPYmpJZCA9IHBhZ2VSZWYudG9TdHJpbmcoKTsKICAgIH0KICAgIGNvbnN0IHR5cGUgPSBraWQuZ2V0KCJUeXBlIikgaW5zdGFuY2VvZiBOYW1lID8ga2lkLmdldCgiVHlwZSIpLm5hbWUgOiBudWxsOwogICAgaWYgKHR5cGUgPT09ICJNQ1IiKSB7CiAgICAgIGlmICh0aGlzLnRyZWUucGFnZURpY3Qub2JqSWQgIT09IHBhZ2VPYmpJZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGtpZFJlZiA9IGtpZC5nZXRSYXcoIlN0bSIpOwogICAgICByZXR1cm4gbmV3IFN0cnVjdEVsZW1lbnQoewogICAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLlNUUkVBTV9DT05URU5ULAogICAgICAgIHJlZk9iaklkOiBraWRSZWYgaW5zdGFuY2VvZiBSZWYgPyBraWRSZWYudG9TdHJpbmcoKSA6IG51bGwsCiAgICAgICAgcGFnZU9iaklkLAogICAgICAgIG1jaWQ6IGtpZC5nZXQoIk1DSUQiKQogICAgICB9KTsKICAgIH0KICAgIGlmICh0eXBlID09PSAiT0JKUiIpIHsKICAgICAgaWYgKHRoaXMudHJlZS5wYWdlRGljdC5vYmpJZCAhPT0gcGFnZU9iaklkKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3Qga2lkUmVmID0ga2lkLmdldFJhdygiT2JqIik7CiAgICAgIHJldHVybiBuZXcgU3RydWN0RWxlbWVudCh7CiAgICAgICAgdHlwZTogU3RydWN0RWxlbWVudFR5cGUuT0JKRUNULAogICAgICAgIHJlZk9iaklkOiBraWRSZWYgaW5zdGFuY2VvZiBSZWYgPyBraWRSZWYudG9TdHJpbmcoKSA6IG51bGwsCiAgICAgICAgcGFnZU9iaklkCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIG5ldyBTdHJ1Y3RFbGVtZW50KHsKICAgICAgdHlwZTogU3RydWN0RWxlbWVudFR5cGUuRUxFTUVOVCwKICAgICAgZGljdDoga2lkCiAgICB9KTsKICB9Cn0KY2xhc3MgU3RydWN0RWxlbWVudCB7CiAgY29uc3RydWN0b3IoewogICAgdHlwZSwKICAgIGRpY3QgPSBudWxsLAogICAgbWNpZCA9IG51bGwsCiAgICBwYWdlT2JqSWQgPSBudWxsLAogICAgcmVmT2JqSWQgPSBudWxsCiAgfSkgewogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICB0aGlzLm1jaWQgPSBtY2lkOwogICAgdGhpcy5wYWdlT2JqSWQgPSBwYWdlT2JqSWQ7CiAgICB0aGlzLnJlZk9iaklkID0gcmVmT2JqSWQ7CiAgICB0aGlzLnBhcmVudE5vZGUgPSBudWxsOwogIH0KfQpjbGFzcyBTdHJ1Y3RUcmVlUGFnZSB7CiAgY29uc3RydWN0b3Ioc3RydWN0VHJlZVJvb3QsIHBhZ2VEaWN0KSB7CiAgICB0aGlzLnJvb3QgPSBzdHJ1Y3RUcmVlUm9vdDsKICAgIHRoaXMueHJlZiA9IHN0cnVjdFRyZWVSb290Py54cmVmID8/IG51bGw7CiAgICB0aGlzLnJvb3REaWN0ID0gc3RydWN0VHJlZVJvb3Q/LmRpY3QgPz8gbnVsbDsKICAgIHRoaXMucGFnZURpY3QgPSBwYWdlRGljdDsKICAgIHRoaXMubm9kZXMgPSBbXTsKICB9CiAgY29sbGVjdE9iamVjdHMocGFnZVJlZikgewogICAgaWYgKCF0aGlzLnJvb3QgfHwgIXRoaXMucm9vdERpY3QgfHwgIShwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHBhcmVudFRyZWUgPSB0aGlzLnJvb3REaWN0LmdldCgiUGFyZW50VHJlZSIpOwogICAgaWYgKCFwYXJlbnRUcmVlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgaWRzID0gdGhpcy5yb290LnN0cnVjdFBhcmVudElkcz8uZ2V0KHBhZ2VSZWYpOwogICAgaWYgKCFpZHMpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7CiAgICBjb25zdCBudW1iZXJUcmVlID0gbmV3IE51bWJlclRyZWUocGFyZW50VHJlZSwgdGhpcy54cmVmKTsKICAgIGZvciAoY29uc3QgW2VsZW1JZF0gb2YgaWRzKSB7CiAgICAgIGNvbnN0IG9iaiA9IG51bWJlclRyZWUuZ2V0UmF3KGVsZW1JZCk7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICBtYXAuc2V0KGVsZW1JZCwgb2JqKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG1hcDsKICB9CiAgcGFyc2UocGFnZVJlZikgewogICAgaWYgKCF0aGlzLnJvb3QgfHwgIXRoaXMucm9vdERpY3QgfHwgIShwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHBhcmVudFRyZWUKICAgIH0gPSB0aGlzLnJvb3Q7CiAgICBpZiAoIXBhcmVudFRyZWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgaWQgPSB0aGlzLnBhZ2VEaWN0LmdldCgiU3RydWN0UGFyZW50cyIpOwogICAgY29uc3QgaWRzID0gdGhpcy5yb290LnN0cnVjdFBhcmVudElkcz8uZ2V0KHBhZ2VSZWYpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGlkKSAmJiAhaWRzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGlkKSkgewogICAgICBjb25zdCBwYXJlbnRBcnJheSA9IHBhcmVudFRyZWUuZ2V0KGlkKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyZW50QXJyYXkpKSB7CiAgICAgICAgZm9yIChjb25zdCByZWYgb2YgcGFyZW50QXJyYXkpIHsKICAgICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgICAgdGhpcy5hZGROb2RlKHRoaXMueHJlZi5mZXRjaChyZWYpLCBtYXApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKCFpZHMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBbZWxlbUlkLCB0eXBlXSBvZiBpZHMpIHsKICAgICAgY29uc3Qgb2JqID0gcGFyZW50VHJlZS5nZXQoZWxlbUlkKTsKICAgICAgaWYgKG9iaikgewogICAgICAgIGNvbnN0IGVsZW0gPSB0aGlzLmFkZE5vZGUodGhpcy54cmVmLmZldGNoSWZSZWYob2JqKSwgbWFwKTsKICAgICAgICBpZiAoZWxlbT8ua2lkcz8ubGVuZ3RoID09PSAxICYmIGVsZW0ua2lkc1swXS50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5PQkpFQ1QpIHsKICAgICAgICAgIGVsZW0ua2lkc1swXS50eXBlID0gdHlwZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgYWRkTm9kZShkaWN0LCBtYXAsIGxldmVsID0gMCkgewogICAgaWYgKGxldmVsID4gTUFYX0RFUFRIKSB7CiAgICAgIHdhcm4oIlN0cnVjdFRyZWUgTUFYX0RFUFRIIHJlYWNoZWQuIik7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKG1hcC5oYXMoZGljdCkpIHsKICAgICAgcmV0dXJuIG1hcC5nZXQoZGljdCk7CiAgICB9CiAgICBjb25zdCBlbGVtZW50ID0gbmV3IFN0cnVjdEVsZW1lbnROb2RlKHRoaXMsIGRpY3QpOwogICAgbWFwLnNldChkaWN0LCBlbGVtZW50KTsKICAgIHN3aXRjaCAoZWxlbWVudC5yb2xlKSB7CiAgICAgIGNhc2UgIkwiOgogICAgICBjYXNlICJMQm9keSI6CiAgICAgIGNhc2UgIkxJIjoKICAgICAgY2FzZSAiVGFibGUiOgogICAgICBjYXNlICJUSGVhZCI6CiAgICAgIGNhc2UgIlRCb2R5IjoKICAgICAgY2FzZSAiVEZvb3QiOgogICAgICBjYXNlICJUUiI6CiAgICAgICAgewogICAgICAgICAgZm9yIChjb25zdCBraWQgb2YgZWxlbWVudC5raWRzKSB7CiAgICAgICAgICAgIGlmIChraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuRUxFTUVOVCkgewogICAgICAgICAgICAgIHRoaXMuYWRkTm9kZShraWQuZGljdCwgbWFwLCBsZXZlbCAtIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgY29uc3QgcGFyZW50ID0gZGljdC5nZXQoIlAiKTsKICAgIGlmICghKHBhcmVudCBpbnN0YW5jZW9mIERpY3QpIHx8IGlzTmFtZShwYXJlbnQuZ2V0KCJUeXBlIiksICJTdHJ1Y3RUcmVlUm9vdCIpKSB7CiAgICAgIGlmICghdGhpcy5hZGRUb3BMZXZlbE5vZGUoZGljdCwgZWxlbWVudCkpIHsKICAgICAgICBtYXAuZGVsZXRlKGRpY3QpOwogICAgICB9CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfQogICAgY29uc3QgcGFyZW50Tm9kZSA9IHRoaXMuYWRkTm9kZShwYXJlbnQsIG1hcCwgbGV2ZWwgKyAxKTsKICAgIGlmICghcGFyZW50Tm9kZSkgewogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0KICAgIGxldCBzYXZlID0gZmFsc2U7CiAgICBmb3IgKGNvbnN0IGtpZCBvZiBwYXJlbnROb2RlLmtpZHMpIHsKICAgICAgaWYgKGtpZC50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5FTEVNRU5UICYmIGtpZC5kaWN0ID09PSBkaWN0KSB7CiAgICAgICAga2lkLnBhcmVudE5vZGUgPSBlbGVtZW50OwogICAgICAgIHNhdmUgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICBpZiAoIXNhdmUpIHsKICAgICAgbWFwLmRlbGV0ZShkaWN0KTsKICAgIH0KICAgIHJldHVybiBlbGVtZW50OwogIH0KICBhZGRUb3BMZXZlbE5vZGUoZGljdCwgZWxlbWVudCkgewogICAgY29uc3QgaW5kZXggPSB0aGlzLnJvb3QuZ2V0S2lkUG9zaXRpb24oZGljdC5vYmpJZCk7CiAgICBpZiAoaXNOYU4oaW5kZXgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgdGhpcy5ub2Rlc1tpbmRleF0gPSBlbGVtZW50OwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIGdldCBzZXJpYWxpemFibGUoKSB7CiAgICBmdW5jdGlvbiBub2RlVG9TZXJpYWxpemFibGUobm9kZSwgcGFyZW50LCBsZXZlbCA9IDApIHsKICAgICAgaWYgKGxldmVsID4gTUFYX0RFUFRIKSB7CiAgICAgICAgd2FybigiU3RydWN0VHJlZSB0b28gZGVlcCB0byBiZSBmdWxseSBzZXJpYWxpemVkLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBvYmogPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBvYmoucm9sZSA9IG5vZGUucm9sZTsKICAgICAgb2JqLmNoaWxkcmVuID0gW107CiAgICAgIHBhcmVudC5jaGlsZHJlbi5wdXNoKG9iaik7CiAgICAgIGxldCBhbHQgPSBub2RlLmRpY3QuZ2V0KCJBbHQiKTsKICAgICAgaWYgKHR5cGVvZiBhbHQgIT09ICJzdHJpbmciKSB7CiAgICAgICAgYWx0ID0gbm9kZS5kaWN0LmdldCgiQWN0dWFsVGV4dCIpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgYWx0ID09PSAic3RyaW5nIikgewogICAgICAgIG9iai5hbHQgPSBzdHJpbmdUb1BERlN0cmluZyhhbHQpOwogICAgICB9CiAgICAgIGlmIChvYmoucm9sZSA9PT0gIkZvcm11bGEiKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgbWF0aE1MCiAgICAgICAgfSA9IG5vZGU7CiAgICAgICAgaWYgKG1hdGhNTCkgewogICAgICAgICAgb2JqLm1hdGhNTCA9IG1hdGhNTDsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgYSA9IG5vZGUuZGljdC5nZXQoIkEiKTsKICAgICAgaWYgKGEgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgYmJveCA9IGxvb2t1cE5vcm1hbFJlY3QoYS5nZXRBcnJheSgiQkJveCIpLCBudWxsKTsKICAgICAgICBpZiAoYmJveCkgewogICAgICAgICAgb2JqLmJib3ggPSBiYm94OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCB3aWR0aCA9IGEuZ2V0KCJXaWR0aCIpOwogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gYS5nZXQoIkhlaWdodCIpOwogICAgICAgICAgaWYgKHR5cGVvZiB3aWR0aCA9PT0gIm51bWJlciIgJiYgd2lkdGggPiAwICYmIHR5cGVvZiBoZWlnaHQgPT09ICJudW1iZXIiICYmIGhlaWdodCA+IDApIHsKICAgICAgICAgICAgb2JqLmJib3ggPSBbMCwgMCwgd2lkdGgsIGhlaWdodF07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IGxhbmcgPSBub2RlLmRpY3QuZ2V0KCJMYW5nIik7CiAgICAgIGlmICh0eXBlb2YgbGFuZyA9PT0gInN0cmluZyIpIHsKICAgICAgICBvYmoubGFuZyA9IHN0cmluZ1RvUERGU3RyaW5nKGxhbmcpOwogICAgICB9CiAgICAgIGZvciAoY29uc3Qga2lkIG9mIG5vZGUua2lkcykgewogICAgICAgIGNvbnN0IGtpZEVsZW1lbnQgPSBraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuRUxFTUVOVCA/IGtpZC5wYXJlbnROb2RlIDogbnVsbDsKICAgICAgICBpZiAoa2lkRWxlbWVudCkgewogICAgICAgICAgbm9kZVRvU2VyaWFsaXphYmxlKGtpZEVsZW1lbnQsIG9iaiwgbGV2ZWwgKyAxKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gZWxzZSBpZiAoa2lkLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLlBBR0VfQ09OVEVOVCB8fCBraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuU1RSRUFNX0NPTlRFTlQpIHsKICAgICAgICAgIG9iai5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgdHlwZTogImNvbnRlbnQiLAogICAgICAgICAgICBpZDogYHAke2tpZC5wYWdlT2JqSWR9X21jJHtraWQubWNpZH1gCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGtpZC50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5PQkpFQ1QpIHsKICAgICAgICAgIG9iai5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgdHlwZTogIm9iamVjdCIsCiAgICAgICAgICAgIGlkOiBraWQucmVmT2JqSWQKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoa2lkLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLkFOTk9UQVRJT04pIHsKICAgICAgICAgIG9iai5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgdHlwZTogImFubm90YXRpb24iLAogICAgICAgICAgICBpZDogYCR7QW5ub3RhdGlvblByZWZpeH0ke2tpZC5yZWZPYmpJZH1gCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHJvb3QgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgcm9vdC5jaGlsZHJlbiA9IFtdOwogICAgcm9vdC5yb2xlID0gIlJvb3QiOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLm5vZGVzKSB7CiAgICAgIGlmICghY2hpbGQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBub2RlVG9TZXJpYWxpemFibGUoY2hpbGQsIHJvb3QpOwogICAgfQogICAgcmV0dXJuIHJvb3Q7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9jYXRhbG9nLmpzCgoKCgoKCgoKCgoKY29uc3QgaXNSZWYgPSB2ID0+IHYgaW5zdGFuY2VvZiBSZWY7CmNvbnN0IGlzVmFsaWRFeHBsaWNpdERlc3QgPSBfaXNWYWxpZEV4cGxpY2l0RGVzdC5iaW5kKG51bGwsIGlzUmVmLCBpc05hbWUpOwpmdW5jdGlvbiBmZXRjaERlc3QoZGVzdCkgewogIGlmIChkZXN0IGluc3RhbmNlb2YgRGljdCkgewogICAgZGVzdCA9IGRlc3QuZ2V0KCJEIik7CiAgfQogIHJldHVybiBpc1ZhbGlkRXhwbGljaXREZXN0KGRlc3QpID8gZGVzdCA6IG51bGw7Cn0KZnVuY3Rpb24gZmV0Y2hSZW1vdGVEZXN0KGFjdGlvbikgewogIGxldCBkZXN0ID0gYWN0aW9uLmdldCgiRCIpOwogIGlmIChkZXN0KSB7CiAgICBpZiAoZGVzdCBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgZGVzdCA9IGRlc3QubmFtZTsKICAgIH0KICAgIGlmICh0eXBlb2YgZGVzdCA9PT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIHN0cmluZ1RvUERGU3RyaW5nKGRlc3QsIHRydWUpOwogICAgfSBlbHNlIGlmIChpc1ZhbGlkRXhwbGljaXREZXN0KGRlc3QpKSB7CiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkZXN0KTsKICAgIH0KICB9CiAgcmV0dXJuIG51bGw7Cn0KY2xhc3MgQ2F0YWxvZyB7CiAgI2FjdHVhbE51bVBhZ2VzID0gbnVsbDsKICAjY2F0RGljdCA9IG51bGw7CiAgYnVpbHRJbkNNYXBDYWNoZSA9IG5ldyBNYXAoKTsKICBmb250Q2FjaGUgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUgPSBuZXcgR2xvYmFsQ29sb3JTcGFjZUNhY2hlKCk7CiAgZ2xvYmFsSW1hZ2VDYWNoZSA9IG5ldyBHbG9iYWxJbWFnZUNhY2hlKCk7CiAgbm9uQmxlbmRNb2Rlc1NldCA9IG5ldyBSZWZTZXQoKTsKICBwYWdlRGljdENhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgcGFnZUluZGV4Q2FjaGUgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICBwYWdlS2lkc0NvdW50Q2FjaGUgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICBzdGFuZGFyZEZvbnREYXRhQ2FjaGUgPSBuZXcgTWFwKCk7CiAgc3lzdGVtRm9udENhY2hlID0gbmV3IE1hcCgpOwogIGNvbnN0cnVjdG9yKHBkZk1hbmFnZXIsIHhyZWYpIHsKICAgIHRoaXMucGRmTWFuYWdlciA9IHBkZk1hbmFnZXI7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy4jY2F0RGljdCA9IHhyZWYuZ2V0Q2F0YWxvZ09iaigpOwogICAgaWYgKCEodGhpcy4jY2F0RGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQ2F0YWxvZyBvYmplY3QgaXMgbm90IGEgZGljdGlvbmFyeS4iKTsKICAgIH0KICAgIHRoaXMudG9wbGV2ZWxQYWdlc0RpY3Q7CiAgfQogIGNsb25lRGljdCgpIHsKICAgIHJldHVybiB0aGlzLiNjYXREaWN0LmNsb25lKCk7CiAgfQogIGdldCB2ZXJzaW9uKCkgewogICAgY29uc3QgdmVyc2lvbiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJWZXJzaW9uIik7CiAgICBpZiAodmVyc2lvbiBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgaWYgKFBERl9WRVJTSU9OX1JFR0VYUC50ZXN0KHZlcnNpb24ubmFtZSkpIHsKICAgICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ2ZXJzaW9uIiwgdmVyc2lvbi5uYW1lKTsKICAgICAgfQogICAgICB3YXJuKGBJbnZhbGlkIFBERiBjYXRhbG9nIHZlcnNpb246ICR7dmVyc2lvbi5uYW1lfWApOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAidmVyc2lvbiIsIG51bGwpOwogIH0KICBnZXQgbGFuZygpIHsKICAgIGNvbnN0IGxhbmcgPSB0aGlzLiNjYXREaWN0LmdldCgiTGFuZyIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAibGFuZyIsIGxhbmcgJiYgdHlwZW9mIGxhbmcgPT09ICJzdHJpbmciID8gc3RyaW5nVG9QREZTdHJpbmcobGFuZykgOiBudWxsKTsKICB9CiAgZ2V0IG5lZWRzUmVuZGVyaW5nKCkgewogICAgY29uc3QgbmVlZHNSZW5kZXJpbmcgPSB0aGlzLiNjYXREaWN0LmdldCgiTmVlZHNSZW5kZXJpbmciKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIm5lZWRzUmVuZGVyaW5nIiwgdHlwZW9mIG5lZWRzUmVuZGVyaW5nID09PSAiYm9vbGVhbiIgPyBuZWVkc1JlbmRlcmluZyA6IGZhbHNlKTsKICB9CiAgZ2V0IGNvbGxlY3Rpb24oKSB7CiAgICBsZXQgY29sbGVjdGlvbiA9IG51bGw7CiAgICB0cnkgewogICAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiQ29sbGVjdGlvbiIpOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCAmJiBvYmouc2l6ZSA+IDApIHsKICAgICAgICBjb2xsZWN0aW9uID0gb2JqOwogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIGluZm8oIkNhbm5vdCBmZXRjaCBDb2xsZWN0aW9uIGVudHJ5OyBhc3N1bWluZyBubyBjb2xsZWN0aW9uIGlzIHByZXNlbnQuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjb2xsZWN0aW9uIiwgY29sbGVjdGlvbik7CiAgfQogIGdldCBhY3JvRm9ybSgpIHsKICAgIGxldCBhY3JvRm9ybSA9IG51bGw7CiAgICB0cnkgewogICAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiQWNyb0Zvcm0iKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QgJiYgb2JqLnNpemUgPiAwKSB7CiAgICAgICAgYWNyb0Zvcm0gPSBvYmo7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgaW5mbygiQ2Fubm90IGZldGNoIEFjcm9Gb3JtIGVudHJ5OyBhc3N1bWluZyBubyBmb3JtcyBhcmUgcHJlc2VudC4iKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImFjcm9Gb3JtIiwgYWNyb0Zvcm0pOwogIH0KICBnZXQgYWNyb0Zvcm1SZWYoKSB7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuI2NhdERpY3QuZ2V0UmF3KCJBY3JvRm9ybSIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYWNyb0Zvcm1SZWYiLCB2YWx1ZSBpbnN0YW5jZW9mIFJlZiA/IHZhbHVlIDogbnVsbCk7CiAgfQogIGdldCBtZXRhZGF0YSgpIHsKICAgIGNvbnN0IHN0cmVhbVJlZiA9IHRoaXMuI2NhdERpY3QuZ2V0UmF3KCJNZXRhZGF0YSIpOwogICAgaWYgKCEoc3RyZWFtUmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJtZXRhZGF0YSIsIG51bGwpOwogICAgfQogICAgbGV0IG1ldGFkYXRhID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMueHJlZi5mZXRjaChzdHJlYW1SZWYsICF0aGlzLnhyZWYuZW5jcnlwdD8uZW5jcnlwdE1ldGFkYXRhKTsKICAgICAgaWYgKHN0cmVhbSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gJiYgc3RyZWFtLmRpY3QgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgdHlwZSA9IHN0cmVhbS5kaWN0LmdldCgiVHlwZSIpOwogICAgICAgIGNvbnN0IHN1YnR5cGUgPSBzdHJlYW0uZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgICAgICBpZiAoaXNOYW1lKHR5cGUsICJNZXRhZGF0YSIpICYmIGlzTmFtZShzdWJ0eXBlLCAiWE1MIikpIHsKICAgICAgICAgIGNvbnN0IGRhdGEgPSBzdHJpbmdUb1VURjhTdHJpbmcoc3RyZWFtLmdldFN0cmluZygpKTsKICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgIG1ldGFkYXRhID0gbmV3IE1ldGFkYXRhUGFyc2VyKGRhdGEpLnNlcmlhbGl6YWJsZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgaW5mbyhgU2tpcHBpbmcgaW52YWxpZCBNZXRhZGF0YTogIiR7ZXh9Ii5gKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgIm1ldGFkYXRhIiwgbWV0YWRhdGEpOwogIH0KICBnZXQgbWFya0luZm8oKSB7CiAgICBsZXQgbWFya0luZm8gPSBudWxsOwogICAgdHJ5IHsKICAgICAgbWFya0luZm8gPSB0aGlzLiNyZWFkTWFya0luZm8oKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybigiVW5hYmxlIHRvIHJlYWQgbWFyayBpbmZvLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAibWFya0luZm8iLCBtYXJrSW5mbyk7CiAgfQogICNyZWFkTWFya0luZm8oKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiTWFya0luZm8iKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgbWFya0luZm8gPSB7CiAgICAgIE1hcmtlZDogZmFsc2UsCiAgICAgIFVzZXJQcm9wZXJ0aWVzOiBmYWxzZSwKICAgICAgU3VzcGVjdHM6IGZhbHNlCiAgICB9OwogICAgZm9yIChjb25zdCBrZXkgaW4gbWFya0luZm8pIHsKICAgICAgY29uc3QgdmFsdWUgPSBvYmouZ2V0KGtleSk7CiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJib29sZWFuIikgewogICAgICAgIG1hcmtJbmZvW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG1hcmtJbmZvOwogIH0KICBnZXQgaGFzU3RydWN0VHJlZSgpIHsKICAgIHJldHVybiB0aGlzLiNjYXREaWN0LmhhcygiU3RydWN0VHJlZVJvb3QiKTsKICB9CiAgZ2V0IHN0cnVjdFRyZWVSb290KCkgewogICAgbGV0IHN0cnVjdFRyZWUgPSBudWxsOwogICAgdHJ5IHsKICAgICAgc3RydWN0VHJlZSA9IHRoaXMuI3JlYWRTdHJ1Y3RUcmVlUm9vdCgpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKCJVbmFibGUgcmVhZCB0byBzdHJ1Y3RUcmVlUm9vdCBpbmZvLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAic3RydWN0VHJlZVJvb3QiLCBzdHJ1Y3RUcmVlKTsKICB9CiAgI3JlYWRTdHJ1Y3RUcmVlUm9vdCgpIHsKICAgIGNvbnN0IHJhd09iaiA9IHRoaXMuI2NhdERpY3QuZ2V0UmF3KCJTdHJ1Y3RUcmVlUm9vdCIpOwogICAgY29uc3Qgb2JqID0gdGhpcy54cmVmLmZldGNoSWZSZWYocmF3T2JqKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgcm9vdCA9IG5ldyBTdHJ1Y3RUcmVlUm9vdCh0aGlzLnhyZWYsIG9iaiwgcmF3T2JqKTsKICAgIHJvb3QuaW5pdCgpOwogICAgcmV0dXJuIHJvb3Q7CiAgfQogIGdldCB0b3BsZXZlbFBhZ2VzRGljdCgpIHsKICAgIGNvbnN0IHBhZ2VzT2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIlBhZ2VzIik7CiAgICBpZiAoIShwYWdlc09iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCB0b3AtbGV2ZWwgcGFnZXMgZGljdGlvbmFyeS4iKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInRvcGxldmVsUGFnZXNEaWN0IiwgcGFnZXNPYmopOwogIH0KICBnZXQgZG9jdW1lbnRPdXRsaW5lKCkgewogICAgbGV0IG9iaiA9IG51bGw7CiAgICB0cnkgewogICAgICBvYmogPSB0aGlzLiNyZWFkRG9jdW1lbnRPdXRsaW5lKCk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oIlVuYWJsZSB0byByZWFkIGRvY3VtZW50IG91dGxpbmUuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJkb2N1bWVudE91dGxpbmUiLCBvYmopOwogIH0KICAjcmVhZERvY3VtZW50T3V0bGluZSgpIHsKICAgIGxldCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiT3V0bGluZXMiKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgb2JqID0gb2JqLmdldFJhdygiRmlyc3QiKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCByb290ID0gewogICAgICBpdGVtczogW10KICAgIH07CiAgICBjb25zdCBxdWV1ZSA9IFt7CiAgICAgIG9iaiwKICAgICAgcGFyZW50OiByb290CiAgICB9XTsKICAgIGNvbnN0IHByb2Nlc3NlZCA9IG5ldyBSZWZTZXQoKTsKICAgIHByb2Nlc3NlZC5wdXQob2JqKTsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWYsCiAgICAgIGJsYWNrQ29sb3IgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoMyk7CiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBpID0gcXVldWUuc2hpZnQoKTsKICAgICAgY29uc3Qgb3V0bGluZURpY3QgPSB4cmVmLmZldGNoSWZSZWYoaS5vYmopOwogICAgICBpZiAob3V0bGluZURpY3QgPT09IG51bGwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIW91dGxpbmVEaWN0LmhhcygiVGl0bGUiKSkgewogICAgICAgIHdhcm4oIkludmFsaWQgb3V0bGluZSBpdGVtIGVuY291bnRlcmVkLiIpOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgdXJsOiBudWxsLAogICAgICAgIGRlc3Q6IG51bGwsCiAgICAgICAgYWN0aW9uOiBudWxsCiAgICAgIH07CiAgICAgIENhdGFsb2cucGFyc2VEZXN0RGljdGlvbmFyeSh7CiAgICAgICAgZGVzdERpY3Q6IG91dGxpbmVEaWN0LAogICAgICAgIHJlc3VsdE9iajogZGF0YSwKICAgICAgICBkb2NCYXNlVXJsOiB0aGlzLmJhc2VVcmwsCiAgICAgICAgZG9jQXR0YWNobWVudHM6IHRoaXMuYXR0YWNobWVudHMKICAgICAgfSk7CiAgICAgIGNvbnN0IHRpdGxlID0gb3V0bGluZURpY3QuZ2V0KCJUaXRsZSIpOwogICAgICBjb25zdCBmbGFncyA9IG91dGxpbmVEaWN0LmdldCgiRiIpIHx8IDA7CiAgICAgIGNvbnN0IGNvbG9yID0gb3V0bGluZURpY3QuZ2V0QXJyYXkoIkMiKTsKICAgICAgY29uc3QgY291bnQgPSBvdXRsaW5lRGljdC5nZXQoIkNvdW50Iik7CiAgICAgIGxldCByZ2JDb2xvciA9IGJsYWNrQ29sb3I7CiAgICAgIGlmIChpc051bWJlckFycmF5KGNvbG9yLCAzKSAmJiAoY29sb3JbMF0gIT09IDAgfHwgY29sb3JbMV0gIT09IDAgfHwgY29sb3JbMl0gIT09IDApKSB7CiAgICAgICAgcmdiQ29sb3IgPSBDb2xvclNwYWNlVXRpbHMucmdiLmdldFJnYihjb2xvciwgMCk7CiAgICAgIH0KICAgICAgY29uc3Qgb3V0bGluZUl0ZW0gPSB7CiAgICAgICAgYWN0aW9uOiBkYXRhLmFjdGlvbiwKICAgICAgICBhdHRhY2htZW50OiBkYXRhLmF0dGFjaG1lbnQsCiAgICAgICAgZGVzdDogZGF0YS5kZXN0LAogICAgICAgIHVybDogZGF0YS51cmwsCiAgICAgICAgdW5zYWZlVXJsOiBkYXRhLnVuc2FmZVVybCwKICAgICAgICBuZXdXaW5kb3c6IGRhdGEubmV3V2luZG93LAogICAgICAgIHNldE9DR1N0YXRlOiBkYXRhLnNldE9DR1N0YXRlLAogICAgICAgIHRpdGxlOiB0eXBlb2YgdGl0bGUgPT09ICJzdHJpbmciID8gc3RyaW5nVG9QREZTdHJpbmcodGl0bGUpIDogIiIsCiAgICAgICAgY29sb3I6IHJnYkNvbG9yLAogICAgICAgIGNvdW50OiBOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSA/IGNvdW50IDogdW5kZWZpbmVkLAogICAgICAgIGJvbGQ6ICEhKGZsYWdzICYgMiksCiAgICAgICAgaXRhbGljOiAhIShmbGFncyAmIDEpLAogICAgICAgIGl0ZW1zOiBbXQogICAgICB9OwogICAgICBpLnBhcmVudC5pdGVtcy5wdXNoKG91dGxpbmVJdGVtKTsKICAgICAgb2JqID0gb3V0bGluZURpY3QuZ2V0UmF3KCJGaXJzdCIpOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmICYmICFwcm9jZXNzZWQuaGFzKG9iaikpIHsKICAgICAgICBxdWV1ZS5wdXNoKHsKICAgICAgICAgIG9iaiwKICAgICAgICAgIHBhcmVudDogb3V0bGluZUl0ZW0KICAgICAgICB9KTsKICAgICAgICBwcm9jZXNzZWQucHV0KG9iaik7CiAgICAgIH0KICAgICAgb2JqID0gb3V0bGluZURpY3QuZ2V0UmF3KCJOZXh0Iik7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBSZWYgJiYgIXByb2Nlc3NlZC5oYXMob2JqKSkgewogICAgICAgIHF1ZXVlLnB1c2goewogICAgICAgICAgb2JqLAogICAgICAgICAgcGFyZW50OiBpLnBhcmVudAogICAgICAgIH0pOwogICAgICAgIHByb2Nlc3NlZC5wdXQob2JqKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJvb3QuaXRlbXMubGVuZ3RoID4gMCA/IHJvb3QuaXRlbXMgOiBudWxsOwogIH0KICBnZXQgcGVybWlzc2lvbnMoKSB7CiAgICBsZXQgcGVybWlzc2lvbnMgPSBudWxsOwogICAgdHJ5IHsKICAgICAgcGVybWlzc2lvbnMgPSB0aGlzLiNyZWFkUGVybWlzc2lvbnMoKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybigiVW5hYmxlIHRvIHJlYWQgcGVybWlzc2lvbnMuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJwZXJtaXNzaW9ucyIsIHBlcm1pc3Npb25zKTsKICB9CiAgI3JlYWRQZXJtaXNzaW9ucygpIHsKICAgIGNvbnN0IGVuY3J5cHQgPSB0aGlzLnhyZWYudHJhaWxlci5nZXQoIkVuY3J5cHQiKTsKICAgIGlmICghKGVuY3J5cHQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBmbGFncyA9IGVuY3J5cHQuZ2V0KCJQIik7CiAgICBpZiAodHlwZW9mIGZsYWdzICE9PSAibnVtYmVyIikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGZsYWdzICs9IDIgKiogMzI7CiAgICBjb25zdCBwZXJtaXNzaW9ucyA9IFtdOwogICAgZm9yIChjb25zdCBrZXkgaW4gUGVybWlzc2lvbkZsYWcpIHsKICAgICAgY29uc3QgdmFsdWUgPSBQZXJtaXNzaW9uRmxhZ1trZXldOwogICAgICBpZiAoZmxhZ3MgJiB2YWx1ZSkgewogICAgICAgIHBlcm1pc3Npb25zLnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcGVybWlzc2lvbnM7CiAgfQogIGdldCBvcHRpb25hbENvbnRlbnRDb25maWcoKSB7CiAgICBsZXQgY29uZmlnID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLiNjYXREaWN0LmdldCgiT0NQcm9wZXJ0aWVzIik7CiAgICAgIGlmICghcHJvcGVydGllcykgewogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgIm9wdGlvbmFsQ29udGVudENvbmZpZyIsIG51bGwpOwogICAgICB9CiAgICAgIGNvbnN0IGRlZmF1bHRDb25maWcgPSBwcm9wZXJ0aWVzLmdldCgiRCIpOwogICAgICBpZiAoIWRlZmF1bHRDb25maWcpIHsKICAgICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJvcHRpb25hbENvbnRlbnRDb25maWciLCBudWxsKTsKICAgICAgfQogICAgICBjb25zdCBncm91cHNEYXRhID0gcHJvcGVydGllcy5nZXQoIk9DR3MiKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGdyb3Vwc0RhdGEpKSB7CiAgICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgbnVsbCk7CiAgICAgIH0KICAgICAgY29uc3QgZ3JvdXBSZWZDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgICBmb3IgKGNvbnN0IGdyb3VwUmVmIG9mIGdyb3Vwc0RhdGEpIHsKICAgICAgICBpZiAoIShncm91cFJlZiBpbnN0YW5jZW9mIFJlZikgfHwgZ3JvdXBSZWZDYWNoZS5oYXMoZ3JvdXBSZWYpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZ3JvdXBSZWZDYWNoZS5wdXQoZ3JvdXBSZWYsIHRoaXMuI3JlYWRPcHRpb25hbENvbnRlbnRHcm91cChncm91cFJlZikpOwogICAgICB9CiAgICAgIGNvbmZpZyA9IHRoaXMuI3JlYWRPcHRpb25hbENvbnRlbnRDb25maWcoZGVmYXVsdENvbmZpZywgZ3JvdXBSZWZDYWNoZSk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oYFVuYWJsZSB0byByZWFkIG9wdGlvbmFsIGNvbnRlbnQgY29uZmlnOiAke2V4fWApOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgY29uZmlnKTsKICB9CiAgI3JlYWRPcHRpb25hbENvbnRlbnRHcm91cChncm91cFJlZikgewogICAgY29uc3QgZ3JvdXAgPSB0aGlzLnhyZWYuZmV0Y2goZ3JvdXBSZWYpOwogICAgY29uc3Qgb2JqID0gewogICAgICBpZDogZ3JvdXBSZWYudG9TdHJpbmcoKSwKICAgICAgbmFtZTogbnVsbCwKICAgICAgaW50ZW50OiBudWxsLAogICAgICB1c2FnZTogewogICAgICAgIHByaW50OiBudWxsLAogICAgICAgIHZpZXc6IG51bGwKICAgICAgfSwKICAgICAgcmJHcm91cHM6IFtdCiAgICB9OwogICAgY29uc3QgbmFtZSA9IGdyb3VwLmdldCgiTmFtZSIpOwogICAgaWYgKHR5cGVvZiBuYW1lID09PSAic3RyaW5nIikgewogICAgICBvYmoubmFtZSA9IHN0cmluZ1RvUERGU3RyaW5nKG5hbWUpOwogICAgfQogICAgbGV0IGludGVudCA9IGdyb3VwLmdldEFycmF5KCJJbnRlbnQiKTsKICAgIGlmICghQXJyYXkuaXNBcnJheShpbnRlbnQpKSB7CiAgICAgIGludGVudCA9IFtpbnRlbnRdOwogICAgfQogICAgaWYgKGludGVudC5ldmVyeShpID0+IGkgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICBvYmouaW50ZW50ID0gaW50ZW50Lm1hcChpID0+IGkubmFtZSk7CiAgICB9CiAgICBjb25zdCB1c2FnZSA9IGdyb3VwLmdldCgiVXNhZ2UiKTsKICAgIGlmICghKHVzYWdlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIG9iajsKICAgIH0KICAgIGNvbnN0IHVzYWdlT2JqID0gb2JqLnVzYWdlOwogICAgY29uc3QgcHJpbnQgPSB1c2FnZS5nZXQoIlByaW50Iik7CiAgICBpZiAocHJpbnQgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IHByaW50U3RhdGUgPSBwcmludC5nZXQoIlByaW50U3RhdGUiKTsKICAgICAgaWYgKHByaW50U3RhdGUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgc3dpdGNoIChwcmludFN0YXRlLm5hbWUpIHsKICAgICAgICAgIGNhc2UgIk9OIjoKICAgICAgICAgIGNhc2UgIk9GRiI6CiAgICAgICAgICAgIHVzYWdlT2JqLnByaW50ID0gewogICAgICAgICAgICAgIHByaW50U3RhdGU6IHByaW50U3RhdGUubmFtZQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3QgdmlldyA9IHVzYWdlLmdldCgiVmlldyIpOwogICAgaWYgKHZpZXcgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IHZpZXdTdGF0ZSA9IHZpZXcuZ2V0KCJWaWV3U3RhdGUiKTsKICAgICAgaWYgKHZpZXdTdGF0ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICBzd2l0Y2ggKHZpZXdTdGF0ZS5uYW1lKSB7CiAgICAgICAgICBjYXNlICJPTiI6CiAgICAgICAgICBjYXNlICJPRkYiOgogICAgICAgICAgICB1c2FnZU9iai52aWV3ID0gewogICAgICAgICAgICAgIHZpZXdTdGF0ZTogdmlld1N0YXRlLm5hbWUKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQogICNyZWFkT3B0aW9uYWxDb250ZW50Q29uZmlnKGNvbmZpZywgZ3JvdXBSZWZDYWNoZSkgewogICAgZnVuY3Rpb24gcGFyc2VPbk9mZihyZWZzKSB7CiAgICAgIGNvbnN0IG9uUGFyc2VkID0gW107CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlZnMpKSB7CiAgICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiByZWZzKSB7CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYgJiYgZ3JvdXBSZWZDYWNoZS5oYXModmFsdWUpKSB7CiAgICAgICAgICAgIG9uUGFyc2VkLnB1c2godmFsdWUudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvblBhcnNlZDsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlT3JkZXIocmVmcywgbmVzdGVkTGV2ZWxzID0gMCkgewogICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmVmcykpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBvcmRlciA9IFtdOwogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJlZnMpIHsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYgJiYgZ3JvdXBSZWZDYWNoZS5oYXModmFsdWUpKSB7CiAgICAgICAgICBwYXJzZWRPcmRlclJlZnMucHV0KHZhbHVlKTsKICAgICAgICAgIG9yZGVyLnB1c2godmFsdWUudG9TdHJpbmcoKSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmVzdGVkT3JkZXIgPSBwYXJzZU5lc3RlZE9yZGVyKHZhbHVlLCBuZXN0ZWRMZXZlbHMpOwogICAgICAgIGlmIChuZXN0ZWRPcmRlcikgewogICAgICAgICAgb3JkZXIucHVzaChuZXN0ZWRPcmRlcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChuZXN0ZWRMZXZlbHMgPiAwKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyOwogICAgICB9CiAgICAgIGNvbnN0IGhpZGRlbkdyb3VwcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IFtncm91cFJlZl0gb2YgZ3JvdXBSZWZDYWNoZS5pdGVtcygpKSB7CiAgICAgICAgaWYgKHBhcnNlZE9yZGVyUmVmcy5oYXMoZ3JvdXBSZWYpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaGlkZGVuR3JvdXBzLnB1c2goZ3JvdXBSZWYudG9TdHJpbmcoKSk7CiAgICAgIH0KICAgICAgaWYgKGhpZGRlbkdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICBvcmRlci5wdXNoKHsKICAgICAgICAgIG5hbWU6IG51bGwsCiAgICAgICAgICBvcmRlcjogaGlkZGVuR3JvdXBzCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG9yZGVyOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VOZXN0ZWRPcmRlcihyZWYsIG5lc3RlZExldmVscykgewogICAgICBpZiAoKytuZXN0ZWRMZXZlbHMgPiBNQVhfTkVTVEVEX0xFVkVMUykgewogICAgICAgIHdhcm4oInBhcnNlTmVzdGVkT3JkZXIgLSByZWFjaGVkIE1BWF9ORVNURURfTEVWRUxTLiIpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0geHJlZi5mZXRjaElmUmVmKHJlZik7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBuZXN0ZWROYW1lID0geHJlZi5mZXRjaElmUmVmKHZhbHVlWzBdKTsKICAgICAgaWYgKHR5cGVvZiBuZXN0ZWROYW1lICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IG5lc3RlZE9yZGVyID0gcGFyc2VPcmRlcih2YWx1ZS5zbGljZSgxKSwgbmVzdGVkTGV2ZWxzKTsKICAgICAgaWYgKCFuZXN0ZWRPcmRlcj8ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBzdHJpbmdUb1BERlN0cmluZyhuZXN0ZWROYW1lKSwKICAgICAgICBvcmRlcjogbmVzdGVkT3JkZXIKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlUkJHcm91cHMocmJHcm91cHMpIHsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJiR3JvdXBzKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJiR3JvdXBzKSB7CiAgICAgICAgY29uc3QgcmJHcm91cCA9IHhyZWYuZmV0Y2hJZlJlZih2YWx1ZSk7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJiR3JvdXApIHx8ICFyYkdyb3VwLmxlbmd0aCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBhcnNlZFJiR3JvdXAgPSBuZXcgU2V0KCk7CiAgICAgICAgZm9yIChjb25zdCByZWYgb2YgcmJHcm91cCkgewogICAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFJlZiAmJiBncm91cFJlZkNhY2hlLmhhcyhyZWYpICYmICFwYXJzZWRSYkdyb3VwLmhhcyhyZWYudG9TdHJpbmcoKSkpIHsKICAgICAgICAgICAgcGFyc2VkUmJHcm91cC5hZGQocmVmLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBncm91cFJlZkNhY2hlLmdldChyZWYpLnJiR3JvdXBzLnB1c2gocGFyc2VkUmJHcm91cCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmLAogICAgICBwYXJzZWRPcmRlclJlZnMgPSBuZXcgUmVmU2V0KCksCiAgICAgIE1BWF9ORVNURURfTEVWRUxTID0gMTA7CiAgICBwYXJzZVJCR3JvdXBzKGNvbmZpZy5nZXQoIlJCR3JvdXBzIikpOwogICAgcmV0dXJuIHsKICAgICAgbmFtZTogdHlwZW9mIGNvbmZpZy5nZXQoIk5hbWUiKSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb1BERlN0cmluZyhjb25maWcuZ2V0KCJOYW1lIikpIDogbnVsbCwKICAgICAgY3JlYXRvcjogdHlwZW9mIGNvbmZpZy5nZXQoIkNyZWF0b3IiKSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb1BERlN0cmluZyhjb25maWcuZ2V0KCJDcmVhdG9yIikpIDogbnVsbCwKICAgICAgYmFzZVN0YXRlOiBjb25maWcuZ2V0KCJCYXNlU3RhdGUiKSBpbnN0YW5jZW9mIE5hbWUgPyBjb25maWcuZ2V0KCJCYXNlU3RhdGUiKS5uYW1lIDogbnVsbCwKICAgICAgb246IHBhcnNlT25PZmYoY29uZmlnLmdldCgiT04iKSksCiAgICAgIG9mZjogcGFyc2VPbk9mZihjb25maWcuZ2V0KCJPRkYiKSksCiAgICAgIG9yZGVyOiBwYXJzZU9yZGVyKGNvbmZpZy5nZXQoIk9yZGVyIikpLAogICAgICBncm91cHM6IFsuLi5ncm91cFJlZkNhY2hlXQogICAgfTsKICB9CiAgc2V0QWN0dWFsTnVtUGFnZXMobnVtID0gbnVsbCkgewogICAgdGhpcy4jYWN0dWFsTnVtUGFnZXMgPSBudW07CiAgfQogIGdldCBoYXNBY3R1YWxOdW1QYWdlcygpIHsKICAgIHJldHVybiB0aGlzLiNhY3R1YWxOdW1QYWdlcyAhPT0gbnVsbDsKICB9CiAgZ2V0IF9wYWdlc0NvdW50KCkgewogICAgY29uc3Qgb2JqID0gdGhpcy50b3BsZXZlbFBhZ2VzRGljdC5nZXQoIkNvdW50Iik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgY291bnQgaW4gdG9wLWxldmVsIHBhZ2VzIGRpY3Rpb25hcnkgaXMgbm90IGFuIGludGVnZXIuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfcGFnZXNDb3VudCIsIG9iaik7CiAgfQogIGdldCBudW1QYWdlcygpIHsKICAgIHJldHVybiB0aGlzLiNhY3R1YWxOdW1QYWdlcyA/PyB0aGlzLl9wYWdlc0NvdW50OwogIH0KICBnZXQgZGVzdGluYXRpb25zKCkgewogICAgY29uc3QgcmF3RGVzdHMgPSB0aGlzLiNyZWFkRGVzdHMoKSwKICAgICAgZGVzdHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZm9yIChjb25zdCBvYmogb2YgcmF3RGVzdHMpIHsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWVUcmVlKSB7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2Ygb2JqLmdldEFsbCgpKSB7CiAgICAgICAgICBjb25zdCBkZXN0ID0gZmV0Y2hEZXN0KHZhbHVlKTsKICAgICAgICAgIGlmIChkZXN0KSB7CiAgICAgICAgICAgIGRlc3RzW3N0cmluZ1RvUERGU3RyaW5nKGtleSwgdHJ1ZSldID0gZGVzdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG9iaikgewogICAgICAgICAgY29uc3QgZGVzdCA9IGZldGNoRGVzdCh2YWx1ZSk7CiAgICAgICAgICBpZiAoZGVzdCkgewogICAgICAgICAgICBkZXN0c1tzdHJpbmdUb1BERlN0cmluZyhrZXksIHRydWUpXSB8fD0gZGVzdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImRlc3RpbmF0aW9ucyIsIGRlc3RzKTsKICB9CiAgZ2V0RGVzdGluYXRpb24oaWQpIHsKICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KCJkZXN0aW5hdGlvbnMiKSkgewogICAgICByZXR1cm4gdGhpcy5kZXN0aW5hdGlvbnNbaWRdID8/IG51bGw7CiAgICB9CiAgICBjb25zdCByYXdEZXN0cyA9IHRoaXMuI3JlYWREZXN0cygpOwogICAgZm9yIChjb25zdCBvYmogb2YgcmF3RGVzdHMpIHsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWVUcmVlIHx8IG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBjb25zdCBkZXN0ID0gZmV0Y2hEZXN0KG9iai5nZXQoaWQpKTsKICAgICAgICBpZiAoZGVzdCkgewogICAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAocmF3RGVzdHMubGVuZ3RoKSB7CiAgICAgIGNvbnN0IGRlc3QgPSB0aGlzLmRlc3RpbmF0aW9uc1tpZF07CiAgICAgIGlmIChkZXN0KSB7CiAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICAjcmVhZERlc3RzKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIk5hbWVzIik7CiAgICBjb25zdCByYXdEZXN0cyA9IFtdOwogICAgaWYgKG9iaj8uaGFzKCJEZXN0cyIpKSB7CiAgICAgIHJhd0Rlc3RzLnB1c2gobmV3IE5hbWVUcmVlKG9iai5nZXRSYXcoIkRlc3RzIiksIHRoaXMueHJlZikpOwogICAgfQogICAgaWYgKHRoaXMuI2NhdERpY3QuaGFzKCJEZXN0cyIpKSB7CiAgICAgIHJhd0Rlc3RzLnB1c2godGhpcy4jY2F0RGljdC5nZXQoIkRlc3RzIikpOwogICAgfQogICAgcmV0dXJuIHJhd0Rlc3RzOwogIH0KICBnZXQgcmF3UGFnZUxhYmVscygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0UmF3KCJQYWdlTGFiZWxzIik7CiAgICBpZiAoIW9iaikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IG51bWJlclRyZWUgPSBuZXcgTnVtYmVyVHJlZShvYmosIHRoaXMueHJlZik7CiAgICByZXR1cm4gbnVtYmVyVHJlZS5nZXRBbGwoKTsKICB9CiAgZ2V0IHBhZ2VMYWJlbHMoKSB7CiAgICBsZXQgb2JqID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIG9iaiA9IHRoaXMuI3JlYWRQYWdlTGFiZWxzKCk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oIlVuYWJsZSB0byByZWFkIHBhZ2UgbGFiZWxzLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicGFnZUxhYmVscyIsIG9iaik7CiAgfQogICNyZWFkUGFnZUxhYmVscygpIHsKICAgIGNvbnN0IG51bXMgPSB0aGlzLnJhd1BhZ2VMYWJlbHM7CiAgICBpZiAoIW51bXMpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBwYWdlTGFiZWxzID0gbmV3IEFycmF5KHRoaXMubnVtUGFnZXMpOwogICAgbGV0IHN0eWxlID0gbnVsbCwKICAgICAgcHJlZml4ID0gIiI7CiAgICBsZXQgY3VycmVudExhYmVsID0gIiIsCiAgICAgIGN1cnJlbnRJbmRleCA9IDE7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0aGlzLm51bVBhZ2VzOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBsYWJlbERpY3QgPSBudW1zLmdldChpKTsKICAgICAgaWYgKGxhYmVsRGljdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKCEobGFiZWxEaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiUGFnZUxhYmVsIGlzIG5vdCBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgfQogICAgICAgIGlmIChsYWJlbERpY3QuaGFzKCJUeXBlIikgJiYgIWlzTmFtZShsYWJlbERpY3QuZ2V0KCJUeXBlIiksICJQYWdlTGFiZWwiKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIHR5cGUgaW4gUGFnZUxhYmVsIGRpY3Rpb25hcnkuIik7CiAgICAgICAgfQogICAgICAgIGlmIChsYWJlbERpY3QuaGFzKCJTIikpIHsKICAgICAgICAgIGNvbnN0IHMgPSBsYWJlbERpY3QuZ2V0KCJTIik7CiAgICAgICAgICBpZiAoIShzIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIHN0eWxlIGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgfQogICAgICAgICAgc3R5bGUgPSBzLm5hbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0eWxlID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKGxhYmVsRGljdC5oYXMoIlAiKSkgewogICAgICAgICAgY29uc3QgcCA9IGxhYmVsRGljdC5nZXQoIlAiKTsKICAgICAgICAgIGlmICh0eXBlb2YgcCAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIHByZWZpeCBpbiBQYWdlTGFiZWwgZGljdGlvbmFyeS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIHByZWZpeCA9IHN0cmluZ1RvUERGU3RyaW5nKHApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwcmVmaXggPSAiIjsKICAgICAgICB9CiAgICAgICAgaWYgKGxhYmVsRGljdC5oYXMoIlN0IikpIHsKICAgICAgICAgIGNvbnN0IHN0ID0gbGFiZWxEaWN0LmdldCgiU3QiKTsKICAgICAgICAgIGlmICghKE51bWJlci5pc0ludGVnZXIoc3QpICYmIHN0ID49IDEpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBzdGFydCBpbiBQYWdlTGFiZWwgZGljdGlvbmFyeS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRJbmRleCA9IHN0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50SW5kZXggPSAxOwogICAgICAgIH0KICAgICAgfQogICAgICBzd2l0Y2ggKHN0eWxlKSB7CiAgICAgICAgY2FzZSAiRCI6CiAgICAgICAgICBjdXJyZW50TGFiZWwgPSBjdXJyZW50SW5kZXg7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJSIjoKICAgICAgICBjYXNlICJyIjoKICAgICAgICAgIGN1cnJlbnRMYWJlbCA9IHRvUm9tYW5OdW1lcmFscyhjdXJyZW50SW5kZXgsIHN0eWxlID09PSAiciIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiQSI6CiAgICAgICAgY2FzZSAiYSI6CiAgICAgICAgICBjb25zdCBMSU1JVCA9IDI2OwogICAgICAgICAgY29uc3QgQV9VUFBFUl9DQVNFID0gMHg0MSwKICAgICAgICAgICAgQV9MT1dFUl9DQVNFID0gMHg2MTsKICAgICAgICAgIGNvbnN0IGJhc2VDaGFyQ29kZSA9IHN0eWxlID09PSAiYSIgPyBBX0xPV0VSX0NBU0UgOiBBX1VQUEVSX0NBU0U7CiAgICAgICAgICBjb25zdCBsZXR0ZXJJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7CiAgICAgICAgICBjb25zdCBjaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJhc2VDaGFyQ29kZSArIGxldHRlckluZGV4ICUgTElNSVQpOwogICAgICAgICAgY3VycmVudExhYmVsID0gY2hhcmFjdGVyLnJlcGVhdChNYXRoLmZsb29yKGxldHRlckluZGV4IC8gTElNSVQpICsgMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKHN0eWxlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBzdHlsZSAiJHtzdHlsZX0iIGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LmApOwogICAgICAgICAgfQogICAgICAgICAgY3VycmVudExhYmVsID0gIiI7CiAgICAgIH0KICAgICAgcGFnZUxhYmVsc1tpXSA9IHByZWZpeCArIGN1cnJlbnRMYWJlbDsKICAgICAgY3VycmVudEluZGV4Kys7CiAgICB9CiAgICByZXR1cm4gcGFnZUxhYmVsczsKICB9CiAgZ2V0IHBhZ2VMYXlvdXQoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiUGFnZUxheW91dCIpOwogICAgbGV0IHBhZ2VMYXlvdXQgPSAiIjsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIHN3aXRjaCAob2JqLm5hbWUpIHsKICAgICAgICBjYXNlICJTaW5nbGVQYWdlIjoKICAgICAgICBjYXNlICJPbmVDb2x1bW4iOgogICAgICAgIGNhc2UgIlR3b0NvbHVtbkxlZnQiOgogICAgICAgIGNhc2UgIlR3b0NvbHVtblJpZ2h0IjoKICAgICAgICBjYXNlICJUd29QYWdlTGVmdCI6CiAgICAgICAgY2FzZSAiVHdvUGFnZVJpZ2h0IjoKICAgICAgICAgIHBhZ2VMYXlvdXQgPSBvYmoubmFtZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicGFnZUxheW91dCIsIHBhZ2VMYXlvdXQpOwogIH0KICBnZXQgcGFnZU1vZGUoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiUGFnZU1vZGUiKTsKICAgIGxldCBwYWdlTW9kZSA9ICJVc2VOb25lIjsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIHN3aXRjaCAob2JqLm5hbWUpIHsKICAgICAgICBjYXNlICJVc2VOb25lIjoKICAgICAgICBjYXNlICJVc2VPdXRsaW5lcyI6CiAgICAgICAgY2FzZSAiVXNlVGh1bWJzIjoKICAgICAgICBjYXNlICJGdWxsU2NyZWVuIjoKICAgICAgICBjYXNlICJVc2VPQyI6CiAgICAgICAgY2FzZSAiVXNlQXR0YWNobWVudHMiOgogICAgICAgICAgcGFnZU1vZGUgPSBvYmoubmFtZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicGFnZU1vZGUiLCBwYWdlTW9kZSk7CiAgfQogIGdldCB2aWV3ZXJQcmVmZXJlbmNlcygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJWaWV3ZXJQcmVmZXJlbmNlcyIpOwogICAgaWYgKCEob2JqIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAidmlld2VyUHJlZmVyZW5jZXMiLCBudWxsKTsKICAgIH0KICAgIGxldCBwcmVmcyA9IG51bGw7CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBvYmopIHsKICAgICAgbGV0IHByZWZWYWx1ZTsKICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICBjYXNlICJIaWRlVG9vbGJhciI6CiAgICAgICAgY2FzZSAiSGlkZU1lbnViYXIiOgogICAgICAgIGNhc2UgIkhpZGVXaW5kb3dVSSI6CiAgICAgICAgY2FzZSAiRml0V2luZG93IjoKICAgICAgICBjYXNlICJDZW50ZXJXaW5kb3ciOgogICAgICAgIGNhc2UgIkRpc3BsYXlEb2NUaXRsZSI6CiAgICAgICAgY2FzZSAiUGlja1RyYXlCeVBERlNpemUiOgogICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTm9uRnVsbFNjcmVlblBhZ2VNb2RlIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgc3dpdGNoICh2YWx1ZS5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiVXNlTm9uZSI6CiAgICAgICAgICAgICAgY2FzZSAiVXNlT3V0bGluZXMiOgogICAgICAgICAgICAgIGNhc2UgIlVzZVRodW1icyI6CiAgICAgICAgICAgICAgY2FzZSAiVXNlT0MiOgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWUubmFtZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSAiVXNlTm9uZSI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkRpcmVjdGlvbiI6CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgIHN3aXRjaCAodmFsdWUubmFtZSkgewogICAgICAgICAgICAgIGNhc2UgIkwyUiI6CiAgICAgICAgICAgICAgY2FzZSAiUjJMIjoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gIkwyUiI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlZpZXdBcmVhIjoKICAgICAgICBjYXNlICJWaWV3Q2xpcCI6CiAgICAgICAgY2FzZSAiUHJpbnRBcmVhIjoKICAgICAgICBjYXNlICJQcmludENsaXAiOgogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJNZWRpYUJveCI6CiAgICAgICAgICAgICAgY2FzZSAiQ3JvcEJveCI6CiAgICAgICAgICAgICAgY2FzZSAiQmxlZWRCb3giOgogICAgICAgICAgICAgIGNhc2UgIlRyaW1Cb3giOgogICAgICAgICAgICAgIGNhc2UgIkFydEJveCI6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZS5uYW1lOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJDcm9wQm94IjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiUHJpbnRTY2FsaW5nIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgc3dpdGNoICh2YWx1ZS5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiTm9uZSI6CiAgICAgICAgICAgICAgY2FzZSAiQXBwRGVmYXVsdCI6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZS5uYW1lOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJBcHBEZWZhdWx0IjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRHVwbGV4IjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgc3dpdGNoICh2YWx1ZS5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiU2ltcGxleCI6CiAgICAgICAgICAgICAgY2FzZSAiRHVwbGV4RmxpcFNob3J0RWRnZSI6CiAgICAgICAgICAgICAgY2FzZSAiRHVwbGV4RmxpcExvbmdFZGdlIjoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gIk5vbmUiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJQcmludFBhZ2VSYW5nZSI6CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoICUgMiA9PT0gMCkgewogICAgICAgICAgICBjb25zdCBpc1ZhbGlkID0gdmFsdWUuZXZlcnkoKHBhZ2UsIGksIGFycikgPT4gTnVtYmVyLmlzSW50ZWdlcihwYWdlKSAmJiBwYWdlID4gMCAmJiAoaSA9PT0gMCB8fCBwYWdlID49IGFycltpIC0gMV0pICYmIHBhZ2UgPD0gdGhpcy5udW1QYWdlcyk7CiAgICAgICAgICAgIGlmIChpc1ZhbGlkKSB7CiAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk51bUNvcGllcyI6CiAgICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkgJiYgdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHdhcm4oYElnbm9yaW5nIG5vbi1zdGFuZGFyZCBrZXkgaW4gVmlld2VyUHJlZmVyZW5jZXM6ICR7a2V5fS5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChwcmVmVmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHdhcm4oYEJhZCB2YWx1ZSwgZm9yIGtleSAiJHtrZXl9IiwgaW4gVmlld2VyUHJlZmVyZW5jZXM6ICR7dmFsdWV9LmApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHByZWZzID8/PSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBwcmVmc1trZXldID0gcHJlZlZhbHVlOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAidmlld2VyUHJlZmVyZW5jZXMiLCBwcmVmcyk7CiAgfQogIGdldCBvcGVuQWN0aW9uKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIk9wZW5BY3Rpb24iKTsKICAgIGNvbnN0IG9wZW5BY3Rpb24gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgZGVzdERpY3QgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgICBkZXN0RGljdC5zZXQoIkEiLCBvYmopOwogICAgICBjb25zdCByZXN1bHRPYmogPSB7CiAgICAgICAgdXJsOiBudWxsLAogICAgICAgIGRlc3Q6IG51bGwsCiAgICAgICAgYWN0aW9uOiBudWxsCiAgICAgIH07CiAgICAgIENhdGFsb2cucGFyc2VEZXN0RGljdGlvbmFyeSh7CiAgICAgICAgZGVzdERpY3QsCiAgICAgICAgcmVzdWx0T2JqCiAgICAgIH0pOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXN1bHRPYmouZGVzdCkpIHsKICAgICAgICBvcGVuQWN0aW9uLmRlc3QgPSByZXN1bHRPYmouZGVzdDsKICAgICAgfSBlbHNlIGlmIChyZXN1bHRPYmouYWN0aW9uKSB7CiAgICAgICAgb3BlbkFjdGlvbi5hY3Rpb24gPSByZXN1bHRPYmouYWN0aW9uOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGlzVmFsaWRFeHBsaWNpdERlc3Qob2JqKSkgewogICAgICBvcGVuQWN0aW9uLmRlc3QgPSBvYmo7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJvcGVuQWN0aW9uIiwgb2JqZWN0U2l6ZShvcGVuQWN0aW9uKSA+IDAgPyBvcGVuQWN0aW9uIDogbnVsbCk7CiAgfQogIGdldCBhdHRhY2htZW50cygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJOYW1lcyIpOwogICAgbGV0IGF0dGFjaG1lbnRzID0gbnVsbDsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0ICYmIG9iai5oYXMoIkVtYmVkZGVkRmlsZXMiKSkgewogICAgICBjb25zdCBuYW1lVHJlZSA9IG5ldyBOYW1lVHJlZShvYmouZ2V0UmF3KCJFbWJlZGRlZEZpbGVzIiksIHRoaXMueHJlZik7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG5hbWVUcmVlLmdldEFsbCgpKSB7CiAgICAgICAgY29uc3QgZnMgPSBuZXcgRmlsZVNwZWModmFsdWUsIHRoaXMueHJlZik7CiAgICAgICAgYXR0YWNobWVudHMgPz89IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgYXR0YWNobWVudHNbc3RyaW5nVG9QREZTdHJpbmcoa2V5LCB0cnVlKV0gPSBmcy5zZXJpYWxpemFibGU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImF0dGFjaG1lbnRzIiwgYXR0YWNobWVudHMpOwogIH0KICBnZXQgeGZhSW1hZ2VzKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIk5hbWVzIik7CiAgICBsZXQgeGZhSW1hZ2VzID0gbnVsbDsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0ICYmIG9iai5oYXMoIlhGQUltYWdlcyIpKSB7CiAgICAgIGNvbnN0IG5hbWVUcmVlID0gbmV3IE5hbWVUcmVlKG9iai5nZXRSYXcoIlhGQUltYWdlcyIpLCB0aGlzLnhyZWYpOwogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBuYW1lVHJlZS5nZXRBbGwoKSkgewogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICAgIHhmYUltYWdlcyA/Pz0gbmV3IE1hcCgpOwogICAgICAgICAgeGZhSW1hZ2VzLnNldChzdHJpbmdUb1BERlN0cmluZyhrZXksIHRydWUpLCB2YWx1ZS5nZXRCeXRlcygpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYUltYWdlcyIsIHhmYUltYWdlcyk7CiAgfQogICNjb2xsZWN0SmF2YVNjcmlwdCgpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJOYW1lcyIpOwogICAgbGV0IGphdmFTY3JpcHQgPSBudWxsOwogICAgZnVuY3Rpb24gYXBwZW5kSWZKYXZhU2NyaXB0RGljdChuYW1lLCBqc0RpY3QpIHsKICAgICAgaWYgKCEoanNEaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCFpc05hbWUoanNEaWN0LmdldCgiUyIpLCAiSmF2YVNjcmlwdCIpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCBqcyA9IGpzRGljdC5nZXQoIkpTIik7CiAgICAgIGlmIChqcyBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBqcyA9IGpzLmdldFN0cmluZygpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBqcyAhPT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAganMgPSBzdHJpbmdUb1BERlN0cmluZyhqcywgdHJ1ZSkucmVwbGFjZUFsbCgiXHgwMCIsICIiKTsKICAgICAgaWYgKGpzKSB7CiAgICAgICAgKGphdmFTY3JpcHQgfHw9IG5ldyBNYXAoKSkuc2V0KG5hbWUsIGpzKTsKICAgICAgfQogICAgfQogICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QgJiYgb2JqLmhhcygiSmF2YVNjcmlwdCIpKSB7CiAgICAgIGNvbnN0IG5hbWVUcmVlID0gbmV3IE5hbWVUcmVlKG9iai5nZXRSYXcoIkphdmFTY3JpcHQiKSwgdGhpcy54cmVmKTsKICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgbmFtZVRyZWUuZ2V0QWxsKCkpIHsKICAgICAgICBhcHBlbmRJZkphdmFTY3JpcHREaWN0KHN0cmluZ1RvUERGU3RyaW5nKGtleSwgdHJ1ZSksIHZhbHVlKTsKICAgICAgfQogICAgfQogICAgY29uc3Qgb3BlbkFjdGlvbiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJPcGVuQWN0aW9uIik7CiAgICBpZiAob3BlbkFjdGlvbikgewogICAgICBhcHBlbmRJZkphdmFTY3JpcHREaWN0KCJPcGVuQWN0aW9uIiwgb3BlbkFjdGlvbik7CiAgICB9CiAgICByZXR1cm4gamF2YVNjcmlwdDsKICB9CiAgZ2V0IGpzQWN0aW9ucygpIHsKICAgIGNvbnN0IGphdmFTY3JpcHQgPSB0aGlzLiNjb2xsZWN0SmF2YVNjcmlwdCgpOwogICAgbGV0IGFjdGlvbnMgPSBjb2xsZWN0QWN0aW9ucyh0aGlzLnhyZWYsIHRoaXMuI2NhdERpY3QsIERvY3VtZW50QWN0aW9uRXZlbnRUeXBlKTsKICAgIGlmIChqYXZhU2NyaXB0KSB7CiAgICAgIGFjdGlvbnMgfHw9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBqYXZhU2NyaXB0KSB7CiAgICAgICAgaWYgKGtleSBpbiBhY3Rpb25zKSB7CiAgICAgICAgICBhY3Rpb25zW2tleV0ucHVzaCh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhY3Rpb25zW2tleV0gPSBbdmFsXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImpzQWN0aW9ucyIsIGFjdGlvbnMpOwogIH0KICBhc3luYyBjbGVhbnVwKG1hbnVhbGx5VHJpZ2dlcmVkID0gZmFsc2UpIHsKICAgIGNsZWFyR2xvYmFsQ2FjaGVzKCk7CiAgICB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZS5jbGVhcigpOwogICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLmNsZWFyKG1hbnVhbGx5VHJpZ2dlcmVkKTsKICAgIHRoaXMucGFnZUtpZHNDb3VudENhY2hlLmNsZWFyKCk7CiAgICB0aGlzLnBhZ2VJbmRleENhY2hlLmNsZWFyKCk7CiAgICB0aGlzLnBhZ2VEaWN0Q2FjaGUuY2xlYXIoKTsKICAgIHRoaXMubm9uQmxlbmRNb2Rlc1NldC5jbGVhcigpOwogICAgZm9yIChjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gb2YgYXdhaXQgUHJvbWlzZS5hbGwodGhpcy5mb250Q2FjaGUpKSB7CiAgICAgIGRlbGV0ZSBkaWN0LmNhY2hlS2V5OwogICAgfQogICAgdGhpcy5mb250Q2FjaGUuY2xlYXIoKTsKICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZS5jbGVhcigpOwogICAgdGhpcy5zdGFuZGFyZEZvbnREYXRhQ2FjaGUuY2xlYXIoKTsKICAgIHRoaXMuc3lzdGVtRm9udENhY2hlLmNsZWFyKCk7CiAgfQogIGFzeW5jIGdldFBhZ2VEaWN0KHBhZ2VJbmRleCkgewogICAgY29uc3Qgbm9kZXNUb1Zpc2l0ID0gW3RoaXMudG9wbGV2ZWxQYWdlc0RpY3RdOwogICAgY29uc3QgdmlzaXRlZE5vZGVzID0gbmV3IFJlZlNldCgpOwogICAgY29uc3QgcGFnZXNSZWYgPSB0aGlzLiNjYXREaWN0LmdldFJhdygiUGFnZXMiKTsKICAgIGlmIChwYWdlc1JlZiBpbnN0YW5jZW9mIFJlZikgewogICAgICB2aXNpdGVkTm9kZXMucHV0KHBhZ2VzUmVmKTsKICAgIH0KICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWYsCiAgICAgIHBhZ2VLaWRzQ291bnRDYWNoZSA9IHRoaXMucGFnZUtpZHNDb3VudENhY2hlLAogICAgICBwYWdlSW5kZXhDYWNoZSA9IHRoaXMucGFnZUluZGV4Q2FjaGUsCiAgICAgIHBhZ2VEaWN0Q2FjaGUgPSB0aGlzLnBhZ2VEaWN0Q2FjaGU7CiAgICBsZXQgY3VycmVudFBhZ2VJbmRleCA9IDA7CiAgICB3aGlsZSAobm9kZXNUb1Zpc2l0Lmxlbmd0aCkgewogICAgICBjb25zdCBjdXJyZW50Tm9kZSA9IG5vZGVzVG9WaXNpdC5wb3AoKTsKICAgICAgaWYgKGN1cnJlbnROb2RlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgY29uc3QgY291bnQgPSBwYWdlS2lkc0NvdW50Q2FjaGUuZ2V0KGN1cnJlbnROb2RlKTsKICAgICAgICBpZiAoY291bnQgPj0gMCAmJiBjdXJyZW50UGFnZUluZGV4ICsgY291bnQgPD0gcGFnZUluZGV4KSB7CiAgICAgICAgICBjdXJyZW50UGFnZUluZGV4ICs9IGNvdW50OwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh2aXNpdGVkTm9kZXMuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJQYWdlcyB0cmVlIGNvbnRhaW5zIGNpcmN1bGFyIHJlZmVyZW5jZS4iKTsKICAgICAgICB9CiAgICAgICAgdmlzaXRlZE5vZGVzLnB1dChjdXJyZW50Tm9kZSk7CiAgICAgICAgY29uc3Qgb2JqID0gYXdhaXQgKHBhZ2VEaWN0Q2FjaGUuZ2V0KGN1cnJlbnROb2RlKSB8fCB4cmVmLmZldGNoQXN5bmMoY3VycmVudE5vZGUpKTsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgbGV0IHR5cGUgPSBvYmouZ2V0UmF3KCJUeXBlIik7CiAgICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICB0eXBlID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKHR5cGUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzTmFtZSh0eXBlLCAiUGFnZSIpIHx8ICFvYmouaGFzKCJLaWRzIikpIHsKICAgICAgICAgICAgaWYgKCFwYWdlS2lkc0NvdW50Q2FjaGUuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgICAgIHBhZ2VLaWRzQ291bnRDYWNoZS5wdXQoY3VycmVudE5vZGUsIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcGFnZUluZGV4Q2FjaGUuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgICAgIHBhZ2VJbmRleENhY2hlLnB1dChjdXJyZW50Tm9kZSwgY3VycmVudFBhZ2VJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGN1cnJlbnRQYWdlSW5kZXggPT09IHBhZ2VJbmRleCkgewogICAgICAgICAgICAgIHJldHVybiBbb2JqLCBjdXJyZW50Tm9kZV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3VycmVudFBhZ2VJbmRleCsrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbm9kZXNUb1Zpc2l0LnB1c2gob2JqKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIShjdXJyZW50Tm9kZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJQYWdlIGRpY3Rpb25hcnkga2lkIHJlZmVyZW5jZSBwb2ludHMgdG8gd3JvbmcgdHlwZSBvZiBvYmplY3QuIik7CiAgICAgIH0KICAgICAgY29uc3QgewogICAgICAgIG9iaklkCiAgICAgIH0gPSBjdXJyZW50Tm9kZTsKICAgICAgbGV0IGNvdW50ID0gY3VycmVudE5vZGUuZ2V0UmF3KCJDb3VudCIpOwogICAgICBpZiAoY291bnQgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICBjb3VudCA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhjb3VudCk7CiAgICAgIH0KICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoY291bnQpICYmIGNvdW50ID49IDApIHsKICAgICAgICBpZiAob2JqSWQgJiYgIXBhZ2VLaWRzQ291bnRDYWNoZS5oYXMob2JqSWQpKSB7CiAgICAgICAgICBwYWdlS2lkc0NvdW50Q2FjaGUucHV0KG9iaklkLCBjb3VudCk7CiAgICAgICAgfQogICAgICAgIGlmIChjdXJyZW50UGFnZUluZGV4ICsgY291bnQgPD0gcGFnZUluZGV4KSB7CiAgICAgICAgICBjdXJyZW50UGFnZUluZGV4ICs9IGNvdW50OwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBraWRzID0gY3VycmVudE5vZGUuZ2V0UmF3KCJLaWRzIik7CiAgICAgIGlmIChraWRzIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAga2lkcyA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhraWRzKTsKICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICBsZXQgdHlwZSA9IGN1cnJlbnROb2RlLmdldFJhdygiVHlwZSIpOwogICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICB0eXBlID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKHR5cGUpOwogICAgICAgIH0KICAgICAgICBpZiAoaXNOYW1lKHR5cGUsICJQYWdlIikgfHwgIWN1cnJlbnROb2RlLmhhcygiS2lkcyIpKSB7CiAgICAgICAgICBpZiAoY3VycmVudFBhZ2VJbmRleCA9PT0gcGFnZUluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiBbY3VycmVudE5vZGUsIG51bGxdOwogICAgICAgICAgfQogICAgICAgICAgY3VycmVudFBhZ2VJbmRleCsrOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiUGFnZSBkaWN0aW9uYXJ5IGtpZHMgb2JqZWN0IGlzIG5vdCBhbiBhcnJheS4iKTsKICAgICAgfQogICAgICBmb3IgKGxldCBsYXN0ID0ga2lkcy5sZW5ndGggLSAxOyBsYXN0ID49IDA7IGxhc3QtLSkgewogICAgICAgIGNvbnN0IGxhc3RLaWQgPSBraWRzW2xhc3RdOwogICAgICAgIG5vZGVzVG9WaXNpdC5wdXNoKGxhc3RLaWQpOwogICAgICAgIGlmIChjdXJyZW50Tm9kZSA9PT0gdGhpcy50b3BsZXZlbFBhZ2VzRGljdCAmJiBsYXN0S2lkIGluc3RhbmNlb2YgUmVmICYmICFwYWdlRGljdENhY2hlLmhhcyhsYXN0S2lkKSkgewogICAgICAgICAgcGFnZURpY3RDYWNoZS5wdXQobGFzdEtpZCwgeHJlZi5mZXRjaEFzeW5jKGxhc3RLaWQpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBFcnJvcihgUGFnZSBpbmRleCAke3BhZ2VJbmRleH0gbm90IGZvdW5kLmApOwogIH0KICBhc3luYyBnZXRBbGxQYWdlRGljdHMocmVjb3ZlcnlNb2RlID0gZmFsc2UpIHsKICAgIGNvbnN0IHsKICAgICAgaWdub3JlRXJyb3JzCiAgICB9ID0gdGhpcy5wZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnM7CiAgICBjb25zdCBxdWV1ZSA9IFt7CiAgICAgIGN1cnJlbnROb2RlOiB0aGlzLnRvcGxldmVsUGFnZXNEaWN0LAogICAgICBwb3NJbktpZHM6IDAKICAgIH1dOwogICAgY29uc3QgdmlzaXRlZE5vZGVzID0gbmV3IFJlZlNldCgpOwogICAgY29uc3QgcGFnZXNSZWYgPSB0aGlzLiNjYXREaWN0LmdldFJhdygiUGFnZXMiKTsKICAgIGlmIChwYWdlc1JlZiBpbnN0YW5jZW9mIFJlZikgewogICAgICB2aXNpdGVkTm9kZXMucHV0KHBhZ2VzUmVmKTsKICAgIH0KICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKSwKICAgICAgeHJlZiA9IHRoaXMueHJlZiwKICAgICAgcGFnZUluZGV4Q2FjaGUgPSB0aGlzLnBhZ2VJbmRleENhY2hlOwogICAgbGV0IHBhZ2VJbmRleCA9IDA7CiAgICBmdW5jdGlvbiBhZGRQYWdlRGljdChwYWdlRGljdCwgcGFnZVJlZikgewogICAgICBpZiAocGFnZVJlZiAmJiAhcGFnZUluZGV4Q2FjaGUuaGFzKHBhZ2VSZWYpKSB7CiAgICAgICAgcGFnZUluZGV4Q2FjaGUucHV0KHBhZ2VSZWYsIHBhZ2VJbmRleCk7CiAgICAgIH0KICAgICAgbWFwLnNldChwYWdlSW5kZXgrKywgW3BhZ2VEaWN0LCBwYWdlUmVmXSk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRQYWdlRXJyb3IoZXJyb3IpIHsKICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgfQogICAgICBpZiAocmVjb3ZlcnlNb2RlICYmIGlnbm9yZUVycm9ycyAmJiBwYWdlSW5kZXggPT09IDApIHsKICAgICAgICB3YXJuKGBnZXRBbGxQYWdlRGljdHMgLSBTa2lwcGluZyBpbnZhbGlkIGZpcnN0IHBhZ2U6ICIke2Vycm9yfSIuYCk7CiAgICAgICAgZXJyb3IgPSBEaWN0LmVtcHR5OwogICAgICB9CiAgICAgIG1hcC5zZXQocGFnZUluZGV4KyssIFtlcnJvciwgbnVsbF0pOwogICAgfQogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgcXVldWVJdGVtID0gcXVldWUuYXQoLTEpOwogICAgICBjb25zdCB7CiAgICAgICAgY3VycmVudE5vZGUsCiAgICAgICAgcG9zSW5LaWRzCiAgICAgIH0gPSBxdWV1ZUl0ZW07CiAgICAgIGxldCBraWRzID0gY3VycmVudE5vZGUuZ2V0UmF3KCJLaWRzIik7CiAgICAgIGlmIChraWRzIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGtpZHMgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMoa2lkcyk7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgIGFkZFBhZ2VFcnJvcihleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGtpZHMpKSB7CiAgICAgICAgYWRkUGFnZUVycm9yKG5ldyBGb3JtYXRFcnJvcigiUGFnZSBkaWN0aW9uYXJ5IGtpZHMgb2JqZWN0IGlzIG5vdCBhbiBhcnJheS4iKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHBvc0luS2lkcyA+PSBraWRzLmxlbmd0aCkgewogICAgICAgIHF1ZXVlLnBvcCgpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGtpZE9iaiA9IGtpZHNbcG9zSW5LaWRzXTsKICAgICAgbGV0IG9iajsKICAgICAgaWYgKGtpZE9iaiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIGlmICh2aXNpdGVkTm9kZXMuaGFzKGtpZE9iaikpIHsKICAgICAgICAgIGFkZFBhZ2VFcnJvcihuZXcgRm9ybWF0RXJyb3IoIlBhZ2VzIHRyZWUgY29udGFpbnMgY2lyY3VsYXIgcmVmZXJlbmNlLiIpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB2aXNpdGVkTm9kZXMucHV0KGtpZE9iaik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIG9iaiA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhraWRPYmopOwogICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICBhZGRQYWdlRXJyb3IoZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG9iaiA9IGtpZE9iajsKICAgICAgfQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGFkZFBhZ2VFcnJvcihuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgZGljdGlvbmFyeSBraWQgcmVmZXJlbmNlIHBvaW50cyB0byB3cm9uZyB0eXBlIG9mIG9iamVjdC4iKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgbGV0IHR5cGUgPSBvYmouZ2V0UmF3KCJUeXBlIik7CiAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHR5cGUgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmModHlwZSk7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgIGFkZFBhZ2VFcnJvcihleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGlzTmFtZSh0eXBlLCAiUGFnZSIpIHx8ICFvYmouaGFzKCJLaWRzIikpIHsKICAgICAgICBhZGRQYWdlRGljdChvYmosIGtpZE9iaiBpbnN0YW5jZW9mIFJlZiA/IGtpZE9iaiA6IG51bGwpOwogICAgICB9IGVsc2UgewogICAgICAgIHF1ZXVlLnB1c2goewogICAgICAgICAgY3VycmVudE5vZGU6IG9iaiwKICAgICAgICAgIHBvc0luS2lkczogMAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHF1ZXVlSXRlbS5wb3NJbktpZHMrKzsKICAgIH0KICAgIHJldHVybiBtYXA7CiAgfQogIGdldFBhZ2VJbmRleChwYWdlUmVmKSB7CiAgICBjb25zdCBjYWNoZWRQYWdlSW5kZXggPSB0aGlzLnBhZ2VJbmRleENhY2hlLmdldChwYWdlUmVmKTsKICAgIGlmIChjYWNoZWRQYWdlSW5kZXggIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNhY2hlZFBhZ2VJbmRleCk7CiAgICB9CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmOwogICAgZnVuY3Rpb24gcGFnZXNCZWZvcmVSZWYoa2lkUmVmKSB7CiAgICAgIGxldCB0b3RhbCA9IDAsCiAgICAgICAgcGFyZW50UmVmOwogICAgICByZXR1cm4geHJlZi5mZXRjaEFzeW5jKGtpZFJlZikudGhlbihmdW5jdGlvbiAobm9kZSkgewogICAgICAgIGlmIChpc1JlZnNFcXVhbChraWRSZWYsIHBhZ2VSZWYpICYmICFpc0RpY3Qobm9kZSwgIlBhZ2UiKSAmJiAhKG5vZGUgaW5zdGFuY2VvZiBEaWN0ICYmICFub2RlLmhhcygiVHlwZSIpICYmIG5vZGUuaGFzKCJDb250ZW50cyIpKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJUaGUgcmVmZXJlbmNlIGRvZXMgbm90IHBvaW50IHRvIGEgL1BhZ2UgZGljdGlvbmFyeS4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFub2RlKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKCEobm9kZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk5vZGUgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgfQogICAgICAgIHBhcmVudFJlZiA9IG5vZGUuZ2V0UmF3KCJQYXJlbnQiKTsKICAgICAgICByZXR1cm4gbm9kZS5nZXRBc3luYygiUGFyZW50Iik7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHBhcmVudCkgewogICAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKCEocGFyZW50IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiUGFyZW50IG11c3QgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcGFyZW50LmdldEFzeW5jKCJLaWRzIik7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGtpZHMpIHsKICAgICAgICBpZiAoIWtpZHMpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBjb25zdCBraWRQcm9taXNlcyA9IFtdOwogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGZvciAoY29uc3Qga2lkIG9mIGtpZHMpIHsKICAgICAgICAgIGlmICghKGtpZCBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJLaWQgbXVzdCBiZSBhIHJlZmVyZW5jZS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc1JlZnNFcXVhbChraWQsIGtpZFJlZikpIHsKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGtpZFByb21pc2VzLnB1c2goeHJlZi5mZXRjaEFzeW5jKGtpZCkudGhlbihmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJLaWQgbm9kZSBtdXN0IGJlIGEgZGljdGlvbmFyeS4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2JqLmhhcygiQ291bnQiKSkgewogICAgICAgICAgICAgIHRvdGFsICs9IG9iai5nZXQoIkNvdW50Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG90YWwrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIktpZCByZWZlcmVuY2Ugbm90IGZvdW5kIGluIHBhcmVudCdzIGtpZHMuIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChraWRQcm9taXNlcykudGhlbigoKSA9PiBbdG90YWwsIHBhcmVudFJlZl0pOwogICAgICB9KTsKICAgIH0KICAgIGxldCB0b3RhbCA9IDA7CiAgICBjb25zdCBuZXh0ID0gcmVmID0+IHBhZ2VzQmVmb3JlUmVmKHJlZikudGhlbihhcmdzID0+IHsKICAgICAgaWYgKCFhcmdzKSB7CiAgICAgICAgdGhpcy5wYWdlSW5kZXhDYWNoZS5wdXQocGFnZVJlZiwgdG90YWwpOwogICAgICAgIHJldHVybiB0b3RhbDsKICAgICAgfQogICAgICBjb25zdCBbY291bnQsIHBhcmVudFJlZl0gPSBhcmdzOwogICAgICB0b3RhbCArPSBjb3VudDsKICAgICAgcmV0dXJuIG5leHQocGFyZW50UmVmKTsKICAgIH0pOwogICAgcmV0dXJuIG5leHQocGFnZVJlZik7CiAgfQogIGdldCBiYXNlVXJsKCkgewogICAgY29uc3QgdXJpID0gdGhpcy4jY2F0RGljdC5nZXQoIlVSSSIpOwogICAgaWYgKHVyaSBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgYmFzZSA9IHVyaS5nZXQoIkJhc2UiKTsKICAgICAgaWYgKHR5cGVvZiBiYXNlID09PSAic3RyaW5nIikgewogICAgICAgIGNvbnN0IGFic29sdXRlVXJsID0gY3JlYXRlVmFsaWRBYnNvbHV0ZVVybChiYXNlLCBudWxsLCB7CiAgICAgICAgICB0cnlDb252ZXJ0RW5jb2Rpbmc6IHRydWUKICAgICAgICB9KTsKICAgICAgICBpZiAoYWJzb2x1dGVVcmwpIHsKICAgICAgICAgIHJldHVybiBzaGFkb3codGhpcywgImJhc2VVcmwiLCBhYnNvbHV0ZVVybC5ocmVmKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImJhc2VVcmwiLCB0aGlzLnBkZk1hbmFnZXIuZG9jQmFzZVVybCk7CiAgfQogIHN0YXRpYyBwYXJzZURlc3REaWN0aW9uYXJ5KHsKICAgIGRlc3REaWN0LAogICAgcmVzdWx0T2JqLAogICAgZG9jQmFzZVVybCA9IG51bGwsCiAgICBkb2NBdHRhY2htZW50cyA9IG51bGwKICB9KSB7CiAgICBpZiAoIShkZXN0RGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHdhcm4oInBhcnNlRGVzdERpY3Rpb25hcnk6IGBkZXN0RGljdGAgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBhY3Rpb24gPSBkZXN0RGljdC5nZXQoIkEiKSwKICAgICAgdXJsLAogICAgICBkZXN0OwogICAgaWYgKCEoYWN0aW9uIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgaWYgKGRlc3REaWN0LmhhcygiRGVzdCIpKSB7CiAgICAgICAgYWN0aW9uID0gZGVzdERpY3QuZ2V0KCJEZXN0Iik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWN0aW9uID0gZGVzdERpY3QuZ2V0KCJBQSIpOwogICAgICAgIGlmIChhY3Rpb24gaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICBpZiAoYWN0aW9uLmhhcygiRCIpKSB7CiAgICAgICAgICAgIGFjdGlvbiA9IGFjdGlvbi5nZXQoIkQiKTsKICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLmhhcygiVSIpKSB7CiAgICAgICAgICAgIGFjdGlvbiA9IGFjdGlvbi5nZXQoIlUiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChhY3Rpb24gaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IGFjdGlvblR5cGUgPSBhY3Rpb24uZ2V0KCJTIik7CiAgICAgIGlmICghKGFjdGlvblR5cGUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICAgIHdhcm4oInBhcnNlRGVzdERpY3Rpb25hcnk6IEludmFsaWQgdHlwZSBpbiBBY3Rpb24gZGljdGlvbmFyeS4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgYWN0aW9uTmFtZSA9IGFjdGlvblR5cGUubmFtZTsKICAgICAgc3dpdGNoIChhY3Rpb25OYW1lKSB7CiAgICAgICAgY2FzZSAiUmVzZXRGb3JtIjoKICAgICAgICAgIGNvbnN0IGZsYWdzID0gYWN0aW9uLmdldCgiRmxhZ3MiKTsKICAgICAgICAgIGNvbnN0IGluY2x1ZGUgPSAoKHR5cGVvZiBmbGFncyA9PT0gIm51bWJlciIgPyBmbGFncyA6IDApICYgMSkgPT09IDA7CiAgICAgICAgICBjb25zdCBmaWVsZHMgPSBbXTsKICAgICAgICAgIGNvbnN0IHJlZnMgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3Qgb2JqIG9mIGFjdGlvbi5nZXQoIkZpZWxkcyIpIHx8IFtdKSB7CiAgICAgICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgICAgICByZWZzLnB1c2gob2JqLnRvU3RyaW5nKCkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmogPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgZmllbGRzLnB1c2goc3RyaW5nVG9QREZTdHJpbmcob2JqKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJlc3VsdE9iai5yZXNldEZvcm0gPSB7CiAgICAgICAgICAgIGZpZWxkcywKICAgICAgICAgICAgcmVmcywKICAgICAgICAgICAgaW5jbHVkZQogICAgICAgICAgfTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlVSSSI6CiAgICAgICAgICB1cmwgPSBhY3Rpb24uZ2V0KCJVUkkiKTsKICAgICAgICAgIGlmICh1cmwgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgIHVybCA9ICIvIiArIHVybC5uYW1lOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiR29UbyI6CiAgICAgICAgICBkZXN0ID0gYWN0aW9uLmdldCgiRCIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTGF1bmNoIjoKICAgICAgICBjYXNlICJHb1RvUiI6CiAgICAgICAgICBjb25zdCB1cmxEaWN0ID0gYWN0aW9uLmdldCgiRiIpOwogICAgICAgICAgaWYgKHVybERpY3QgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgIGNvbnN0IGZzID0gbmV3IEZpbGVTcGVjKHVybERpY3QsIG51bGwsIHRydWUpOwogICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgcmF3RmlsZW5hbWUKICAgICAgICAgICAgfSA9IGZzLnNlcmlhbGl6YWJsZTsKICAgICAgICAgICAgdXJsID0gcmF3RmlsZW5hbWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB1cmxEaWN0ID09PSAic3RyaW5nIikgewogICAgICAgICAgICB1cmwgPSB1cmxEaWN0OwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgcmVtb3RlRGVzdCA9IGZldGNoUmVtb3RlRGVzdChhY3Rpb24pOwogICAgICAgICAgaWYgKHJlbW90ZURlc3QgJiYgdHlwZW9mIHVybCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdXJsID0gdXJsLnNwbGl0KCIjIiwgMSlbMF0gKyAiIyIgKyByZW1vdGVEZXN0OwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgbmV3V2luZG93ID0gYWN0aW9uLmdldCgiTmV3V2luZG93Iik7CiAgICAgICAgICBpZiAodHlwZW9mIG5ld1dpbmRvdyA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHJlc3VsdE9iai5uZXdXaW5kb3cgPSBuZXdXaW5kb3c7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJHb1RvRSI6CiAgICAgICAgICBjb25zdCB0YXJnZXQgPSBhY3Rpb24uZ2V0KCJUIik7CiAgICAgICAgICBsZXQgYXR0YWNobWVudDsKICAgICAgICAgIGlmIChkb2NBdHRhY2htZW50cyAmJiB0YXJnZXQgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgIGNvbnN0IHJlbGF0aW9uc2hpcCA9IHRhcmdldC5nZXQoIlIiKTsKICAgICAgICAgICAgY29uc3QgbmFtZSA9IHRhcmdldC5nZXQoIk4iKTsKICAgICAgICAgICAgaWYgKGlzTmFtZShyZWxhdGlvbnNoaXAsICJDIikgJiYgdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgYXR0YWNobWVudCA9IGRvY0F0dGFjaG1lbnRzW3N0cmluZ1RvUERGU3RyaW5nKG5hbWUsIHRydWUpXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGF0dGFjaG1lbnQpIHsKICAgICAgICAgICAgcmVzdWx0T2JqLmF0dGFjaG1lbnQgPSBhdHRhY2htZW50OwogICAgICAgICAgICBjb25zdCBhdHRhY2htZW50RGVzdCA9IGZldGNoUmVtb3RlRGVzdChhY3Rpb24pOwogICAgICAgICAgICBpZiAoYXR0YWNobWVudERlc3QpIHsKICAgICAgICAgICAgICByZXN1bHRPYmouYXR0YWNobWVudERlc3QgPSBhdHRhY2htZW50RGVzdDsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2FybihgcGFyc2VEZXN0RGljdGlvbmFyeSAtIHVuaW1wbGVtZW50ZWQgIkdvVG9FIiBhY3Rpb24uYCk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJOYW1lZCI6CiAgICAgICAgICBjb25zdCBuYW1lZEFjdGlvbiA9IGFjdGlvbi5nZXQoIk4iKTsKICAgICAgICAgIGlmIChuYW1lZEFjdGlvbiBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgcmVzdWx0T2JqLmFjdGlvbiA9IG5hbWVkQWN0aW9uLm5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTZXRPQ0dTdGF0ZSI6CiAgICAgICAgICBjb25zdCBzdGF0ZSA9IGFjdGlvbi5nZXQoIlN0YXRlIik7CiAgICAgICAgICBjb25zdCBwcmVzZXJ2ZVJCID0gYWN0aW9uLmdldCgiUHJlc2VydmVSQiIpOwogICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHN0YXRlKSB8fCBzdGF0ZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBzdGF0ZUFyciA9IFtdOwogICAgICAgICAgZm9yIChjb25zdCBlbGVtIG9mIHN0YXRlKSB7CiAgICAgICAgICAgIGlmIChlbGVtIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICAgIHN3aXRjaCAoZWxlbS5uYW1lKSB7CiAgICAgICAgICAgICAgICBjYXNlICJPTiI6CiAgICAgICAgICAgICAgICBjYXNlICJPRkYiOgogICAgICAgICAgICAgICAgY2FzZSAiVG9nZ2xlIjoKICAgICAgICAgICAgICAgICAgc3RhdGVBcnIucHVzaChlbGVtLm5hbWUpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICAgIHN0YXRlQXJyLnB1c2goZWxlbS50b1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlQXJyLmxlbmd0aCAhPT0gc3RhdGUubGVuZ3RoKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcmVzdWx0T2JqLnNldE9DR1N0YXRlID0gewogICAgICAgICAgICBzdGF0ZTogc3RhdGVBcnIsCiAgICAgICAgICAgIHByZXNlcnZlUkI6IHR5cGVvZiBwcmVzZXJ2ZVJCID09PSAiYm9vbGVhbiIgPyBwcmVzZXJ2ZVJCIDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkphdmFTY3JpcHQiOgogICAgICAgICAgY29uc3QganNBY3Rpb24gPSBhY3Rpb24uZ2V0KCJKUyIpOwogICAgICAgICAgbGV0IGpzOwogICAgICAgICAgaWYgKGpzQWN0aW9uIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgICAgICBqcyA9IGpzQWN0aW9uLmdldFN0cmluZygpOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YganNBY3Rpb24gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGpzID0ganNBY3Rpb247CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBqc1VSTCA9IGpzICYmIHJlY292ZXJKc1VSTChzdHJpbmdUb1BERlN0cmluZyhqcywgdHJ1ZSkpOwogICAgICAgICAgaWYgKGpzVVJMKSB7CiAgICAgICAgICAgIHVybCA9IGpzVVJMLnVybDsKICAgICAgICAgICAgcmVzdWx0T2JqLm5ld1dpbmRvdyA9IGpzVVJMLm5ld1dpbmRvdzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChhY3Rpb25OYW1lID09PSAiSmF2YVNjcmlwdCIgfHwgYWN0aW9uTmFtZSA9PT0gIlN1Ym1pdEZvcm0iKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgd2FybihgcGFyc2VEZXN0RGljdGlvbmFyeSAtIHVuc3VwcG9ydGVkIGFjdGlvbjogIiR7YWN0aW9uTmFtZX0iLmApOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZGVzdERpY3QuaGFzKCJEZXN0IikpIHsKICAgICAgZGVzdCA9IGRlc3REaWN0LmdldCgiRGVzdCIpOwogICAgfQogICAgaWYgKHR5cGVvZiB1cmwgPT09ICJzdHJpbmciKSB7CiAgICAgIGNvbnN0IGFic29sdXRlVXJsID0gY3JlYXRlVmFsaWRBYnNvbHV0ZVVybCh1cmwsIGRvY0Jhc2VVcmwsIHsKICAgICAgICBhZGREZWZhdWx0UHJvdG9jb2w6IHRydWUsCiAgICAgICAgdHJ5Q29udmVydEVuY29kaW5nOiB0cnVlCiAgICAgIH0pOwogICAgICBpZiAoYWJzb2x1dGVVcmwpIHsKICAgICAgICByZXN1bHRPYmoudXJsID0gYWJzb2x1dGVVcmwuaHJlZjsKICAgICAgfQogICAgICByZXN1bHRPYmoudW5zYWZlVXJsID0gdXJsOwogICAgfQogICAgaWYgKGRlc3QpIHsKICAgICAgaWYgKGRlc3QgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgZGVzdCA9IGRlc3QubmFtZTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGRlc3QgPT09ICJzdHJpbmciKSB7CiAgICAgICAgcmVzdWx0T2JqLmRlc3QgPSBzdHJpbmdUb1BERlN0cmluZyhkZXN0LCB0cnVlKTsKICAgICAgfSBlbHNlIGlmIChpc1ZhbGlkRXhwbGljaXREZXN0KGRlc3QpKSB7CiAgICAgICAgcmVzdWx0T2JqLmRlc3QgPSBkZXN0OwogICAgICB9CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9vYmplY3RfbG9hZGVyLmpzCgoKCgpmdW5jdGlvbiBtYXlIYXZlQ2hpbGRyZW4odmFsdWUpIHsKICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBSZWYgfHwgdmFsdWUgaW5zdGFuY2VvZiBEaWN0IHx8IHZhbHVlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSB8fCBBcnJheS5pc0FycmF5KHZhbHVlKTsKfQpmdW5jdGlvbiBhZGRDaGlsZHJlbihub2RlLCBub2Rlc1RvVmlzaXQpIHsKICBpZiAobm9kZSBpbnN0YW5jZW9mIERpY3QpIHsKICAgIG5vZGUgPSBub2RlLmdldFJhd1ZhbHVlcygpOwogIH0gZWxzZSBpZiAobm9kZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgIG5vZGUgPSBub2RlLmRpY3QuZ2V0UmF3VmFsdWVzKCk7CiAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShub2RlKSkgewogICAgcmV0dXJuOwogIH0KICBmb3IgKGNvbnN0IHJhd1ZhbHVlIG9mIG5vZGUpIHsKICAgIGlmIChtYXlIYXZlQ2hpbGRyZW4ocmF3VmFsdWUpKSB7CiAgICAgIG5vZGVzVG9WaXNpdC5wdXNoKHJhd1ZhbHVlKTsKICAgIH0KICB9Cn0KY2xhc3MgT2JqZWN0TG9hZGVyIHsKICByZWZTZXQgPSBuZXcgUmVmU2V0KCk7CiAgY29uc3RydWN0b3IoZGljdCwga2V5cywgeHJlZikgewogICAgdGhpcy5kaWN0ID0gZGljdDsKICAgIHRoaXMua2V5cyA9IGtleXM7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogIH0KICBhc3luYyBsb2FkKCkgewogICAgY29uc3QgewogICAgICBrZXlzLAogICAgICBkaWN0CiAgICB9ID0gdGhpczsKICAgIGNvbnN0IG5vZGVzVG9WaXNpdCA9IFtdOwogICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykgewogICAgICBjb25zdCByYXdWYWx1ZSA9IGRpY3QuZ2V0UmF3KGtleSk7CiAgICAgIGlmIChyYXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbm9kZXNUb1Zpc2l0LnB1c2gocmF3VmFsdWUpOwogICAgICB9CiAgICB9CiAgICBhd2FpdCB0aGlzLiN3YWxrKG5vZGVzVG9WaXNpdCk7CiAgICB0aGlzLnJlZlNldCA9IG51bGw7CiAgfQogIGFzeW5jICN3YWxrKG5vZGVzVG9WaXNpdCkgewogICAgY29uc3Qgbm9kZXNUb1JldmlzaXQgPSBbXTsKICAgIGNvbnN0IHBlbmRpbmdSZXF1ZXN0cyA9IFtdOwogICAgd2hpbGUgKG5vZGVzVG9WaXNpdC5sZW5ndGgpIHsKICAgICAgbGV0IGN1cnJlbnROb2RlID0gbm9kZXNUb1Zpc2l0LnBvcCgpOwogICAgICBpZiAoY3VycmVudE5vZGUgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICBpZiAodGhpcy5yZWZTZXQuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLnJlZlNldC5wdXQoY3VycmVudE5vZGUpOwogICAgICAgICAgY3VycmVudE5vZGUgPSB0aGlzLnhyZWYuZmV0Y2goY3VycmVudE5vZGUpOwogICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICBpZiAoIShleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSkgewogICAgICAgICAgICB3YXJuKGBPYmplY3RMb2FkZXIuI3dhbGsgLSByZXF1ZXN0aW5nIGFsbCBkYXRhOiAiJHtleH0iLmApOwogICAgICAgICAgICBhd2FpdCB0aGlzLnhyZWYuc3RyZWFtLm1hbmFnZXIucmVxdWVzdEFsbENodW5rcygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBub2Rlc1RvUmV2aXNpdC5wdXNoKGN1cnJlbnROb2RlKTsKICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0cy5wdXNoKHsKICAgICAgICAgICAgYmVnaW46IGV4LmJlZ2luLAogICAgICAgICAgICBlbmQ6IGV4LmVuZAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjdXJyZW50Tm9kZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBjb25zdCBiYXNlU3RyZWFtcyA9IGN1cnJlbnROb2RlLmdldEJhc2VTdHJlYW1zKCk7CiAgICAgICAgaWYgKGJhc2VTdHJlYW1zKSB7CiAgICAgICAgICBsZXQgZm91bmRNaXNzaW5nRGF0YSA9IGZhbHNlOwogICAgICAgICAgZm9yIChjb25zdCBzdHJlYW0gb2YgYmFzZVN0cmVhbXMpIHsKICAgICAgICAgICAgaWYgKHN0cmVhbS5pc0RhdGFMb2FkZWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3VuZE1pc3NpbmdEYXRhID0gdHJ1ZTsKICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3RzLnB1c2goewogICAgICAgICAgICAgIGJlZ2luOiBzdHJlYW0uc3RhcnQsCiAgICAgICAgICAgICAgZW5kOiBzdHJlYW0uZW5kCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGZvdW5kTWlzc2luZ0RhdGEpIHsKICAgICAgICAgICAgbm9kZXNUb1JldmlzaXQucHVzaChjdXJyZW50Tm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGFkZENoaWxkcmVuKGN1cnJlbnROb2RlLCBub2Rlc1RvVmlzaXQpOwogICAgfQogICAgaWYgKHBlbmRpbmdSZXF1ZXN0cy5sZW5ndGgpIHsKICAgICAgYXdhaXQgdGhpcy54cmVmLnN0cmVhbS5tYW5hZ2VyLnJlcXVlc3RSYW5nZXMocGVuZGluZ1JlcXVlc3RzKTsKICAgICAgZm9yIChjb25zdCBub2RlIG9mIG5vZGVzVG9SZXZpc2l0KSB7CiAgICAgICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgIHRoaXMucmVmU2V0LnJlbW92ZShub2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy4jd2Fsayhub2Rlc1RvUmV2aXNpdCk7CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyBsb2FkKG9iaiwga2V5cywgeHJlZikgewogICAgaWYgKHhyZWYuc3RyZWFtLmlzRGF0YUxvYWRlZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBvYmpMb2FkZXIgPSBuZXcgT2JqZWN0TG9hZGVyKG9iaiwga2V5cywgeHJlZik7CiAgICBhd2FpdCBvYmpMb2FkZXIubG9hZCgpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3N5bWJvbF91dGlscy5qcwpjb25zdCAkYWNjZXB0V2hpdGVzcGFjZSA9IFN5bWJvbCgpOwpjb25zdCAkYWRkSFRNTCA9IFN5bWJvbCgpOwpjb25zdCAkYXBwZW5kQ2hpbGQgPSBTeW1ib2woKTsKY29uc3QgJGNoaWxkcmVuVG9IVE1MID0gU3ltYm9sKCk7CmNvbnN0ICRjbGVhbiA9IFN5bWJvbCgpOwpjb25zdCAkY2xlYW5QYWdlID0gU3ltYm9sKCk7CmNvbnN0ICRjbGVhbnVwID0gU3ltYm9sKCk7CmNvbnN0ICRjbG9uZSA9IFN5bWJvbCgpOwpjb25zdCAkY29uc3VtZWQgPSBTeW1ib2woKTsKY29uc3QgJGNvbnRlbnQgPSBTeW1ib2woImNvbnRlbnQiKTsKY29uc3QgJGRhdGEgPSBTeW1ib2woImRhdGEiKTsKY29uc3QgJGR1bXAgPSBTeW1ib2woKTsKY29uc3QgJGV4dHJhID0gU3ltYm9sKCJleHRyYSIpOwpjb25zdCAkZmluYWxpemUgPSBTeW1ib2woKTsKY29uc3QgJGZsdXNoSFRNTCA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0QXR0cmlidXRlSXQgPSBTeW1ib2woKTsKY29uc3QgJGdldEF0dHJpYnV0ZXMgPSBTeW1ib2woKTsKY29uc3QgJGdldEF2YWlsYWJsZVNwYWNlID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRDaGlsZHJlbkJ5Q2xhc3MgPSBTeW1ib2woKTsKY29uc3QgJGdldENoaWxkcmVuQnlOYW1lID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRDaGlsZHJlbkJ5TmFtZUl0ID0gU3ltYm9sKCk7CmNvbnN0ICRnZXREYXRhVmFsdWUgPSBTeW1ib2woKTsKY29uc3QgJGdldEV4dHJhID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdCA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0Q2hpbGRyZW4gPSBTeW1ib2woKTsKY29uc3QgJGdldENvbnRhaW5lZENoaWxkcmVuID0gU3ltYm9sKCk7CmNvbnN0ICRnZXROZXh0UGFnZSA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0U3ViZm9ybVBhcmVudCA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0UGFyZW50ID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRUZW1wbGF0ZVJvb3QgPSBTeW1ib2woKTsKY29uc3QgJGdsb2JhbERhdGEgPSBTeW1ib2woKTsKY29uc3QgJGhhc1NldHRhYmxlVmFsdWUgPSBTeW1ib2woKTsKY29uc3QgJGlkcyA9IFN5bWJvbCgpOwpjb25zdCAkaW5kZXhPZiA9IFN5bWJvbCgpOwpjb25zdCAkaW5zZXJ0QXQgPSBTeW1ib2woKTsKY29uc3QgJGlzQ0RBVEFYbWwgPSBTeW1ib2woKTsKY29uc3QgJGlzQmluZGFibGUgPSBTeW1ib2woKTsKY29uc3QgJGlzRGF0YVZhbHVlID0gU3ltYm9sKCk7CmNvbnN0ICRpc0Rlc2NlbmRlbnQgPSBTeW1ib2woKTsKY29uc3QgJGlzTnNBZ25vc3RpYyA9IFN5bWJvbCgpOwpjb25zdCAkaXNTcGxpdHRhYmxlID0gU3ltYm9sKCk7CmNvbnN0ICRpc1RoZXJlTW9yZVdpZHRoID0gU3ltYm9sKCk7CmNvbnN0ICRpc1RyYW5zcGFyZW50ID0gU3ltYm9sKCk7CmNvbnN0ICRpc1VzYWJsZSA9IFN5bWJvbCgpOwpjb25zdCAkbGFzdEF0dHJpYnV0ZSA9IFN5bWJvbCgpOwpjb25zdCAkbmFtZXNwYWNlSWQgPSBTeW1ib2woIm5hbWVzcGFjZUlkIik7CmNvbnN0ICRub2RlTmFtZSA9IFN5bWJvbCgibm9kZU5hbWUiKTsKY29uc3QgJG5zQXR0cmlidXRlcyA9IFN5bWJvbCgpOwpjb25zdCAkb25DaGlsZCA9IFN5bWJvbCgpOwpjb25zdCAkb25DaGlsZENoZWNrID0gU3ltYm9sKCk7CmNvbnN0ICRvblRleHQgPSBTeW1ib2woKTsKY29uc3QgJHB1c2hHbHlwaHMgPSBTeW1ib2woKTsKY29uc3QgJHBvcFBhcmEgPSBTeW1ib2woKTsKY29uc3QgJHB1c2hQYXJhID0gU3ltYm9sKCk7CmNvbnN0ICRyZW1vdmVDaGlsZCA9IFN5bWJvbCgpOwpjb25zdCAkcm9vdCA9IFN5bWJvbCgicm9vdCIpOwpjb25zdCAkcmVzb2x2ZVByb3RvdHlwZXMgPSBTeW1ib2woKTsKY29uc3QgJHNlYXJjaE5vZGUgPSBTeW1ib2woKTsKY29uc3QgJHNldElkID0gU3ltYm9sKCk7CmNvbnN0ICRzZXRTZXRBdHRyaWJ1dGVzID0gU3ltYm9sKCk7CmNvbnN0ICRzZXRWYWx1ZSA9IFN5bWJvbCgpOwpjb25zdCAkdGFiSW5kZXggPSBTeW1ib2woKTsKY29uc3QgJHRleHQgPSBTeW1ib2woKTsKY29uc3QgJHRvUGFnZXMgPSBTeW1ib2woKTsKY29uc3QgJHRvSFRNTCA9IFN5bWJvbCgpOwpjb25zdCAkdG9TdHJpbmcgPSBTeW1ib2woKTsKY29uc3QgJHRvU3R5bGUgPSBTeW1ib2woKTsKY29uc3QgJHVpZCA9IFN5bWJvbCgidWlkIik7Cgo7Ly8gLi9zcmMvY29yZS94ZmEvbmFtZXNwYWNlcy5qcwpjb25zdCAkYnVpbGRYRkFPYmplY3QgPSBTeW1ib2woKTsKY29uc3QgTmFtZXNwYWNlSWRzID0gewogIGNvbmZpZzogewogICAgaWQ6IDAsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94Y2kvIikKICB9LAogIGNvbm5lY3Rpb25TZXQ6IHsKICAgIGlkOiAxLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLWNvbm5lY3Rpb24tc2V0LyIpCiAgfSwKICBkYXRhc2V0czogewogICAgaWQ6IDIsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtZGF0YS8iKQogIH0sCiAgZm9ybTogewogICAgaWQ6IDMsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtZm9ybS8iKQogIH0sCiAgbG9jYWxlU2V0OiB7CiAgICBpZDogNCwKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hmYS1sb2NhbGUtc2V0LyIpCiAgfSwKICBwZGY6IHsKICAgIGlkOiA1LAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL25zLmFkb2JlLmNvbS94ZHAvcGRmLyIKICB9LAogIHNpZ25hdHVyZTogewogICAgaWQ6IDYsCiAgICBjaGVjazogbnMgPT4gbnMgPT09ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIgogIH0sCiAgc291cmNlU2V0OiB7CiAgICBpZDogNywKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hmYS1zb3VyY2Utc2V0LyIpCiAgfSwKICBzdHlsZXNoZWV0OiB7CiAgICBpZDogOCwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly93d3cudzMub3JnLzE5OTkvWFNML1RyYW5zZm9ybSIKICB9LAogIHRlbXBsYXRlOiB7CiAgICBpZDogOSwKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hmYS10ZW1wbGF0ZS8iKQogIH0sCiAgeGRjOiB7CiAgICBpZDogMTAsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZGMvIikKICB9LAogIHhkcDogewogICAgaWQ6IDExLAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL25zLmFkb2JlLmNvbS94ZHAvIgogIH0sCiAgeGZkZjogewogICAgaWQ6IDEyLAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL25zLmFkb2JlLmNvbS94ZmRmLyIKICB9LAogIHhodG1sOiB7CiAgICBpZDogMTMsCiAgICBjaGVjazogbnMgPT4gbnMgPT09ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIgogIH0sCiAgeG1wbWV0YTogewogICAgaWQ6IDE0LAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL25zLmFkb2JlLmNvbS94bXBtZXRhLyIKICB9Cn07Cgo7Ly8gLi9zcmMvY29yZS94ZmEvdXRpbHMuanMKCmNvbnN0IGRpbUNvbnZlcnRlcnMgPSB7CiAgcHQ6IHggPT4geCwKICBjbTogeCA9PiB4IC8gMi41NCAqIDcyLAogIG1tOiB4ID0+IHggLyAoMTAgKiAyLjU0KSAqIDcyLAogIGluOiB4ID0+IHggKiA3MiwKICBweDogeCA9PiB4Cn07CmNvbnN0IG1lYXN1cmVtZW50UGF0dGVybiA9IC8oWystXT9cZCtcLj9cZCopKC4qKS87CmZ1bmN0aW9uIHN0cmlwUXVvdGVzKHN0cikgewogIGlmIChzdHIuc3RhcnRzV2l0aCgiJyIpIHx8IHN0ci5zdGFydHNXaXRoKCciJykpIHsKICAgIHJldHVybiBzdHIuc2xpY2UoMSwgLTEpOwogIH0KICByZXR1cm4gc3RyOwp9CmZ1bmN0aW9uIGdldEludGVnZXIoewogIGRhdGEsCiAgZGVmYXVsdFZhbHVlLAogIHZhbGlkYXRlCn0pIHsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiBkZWZhdWx0VmFsdWU7CiAgfQogIGRhdGEgPSBkYXRhLnRyaW0oKTsKICBjb25zdCBuID0gcGFyc2VJbnQoZGF0YSwgMTApOwogIGlmICghaXNOYU4obikgJiYgdmFsaWRhdGUobikpIHsKICAgIHJldHVybiBuOwogIH0KICByZXR1cm4gZGVmYXVsdFZhbHVlOwp9CmZ1bmN0aW9uIGdldEZsb2F0KHsKICBkYXRhLAogIGRlZmF1bHRWYWx1ZSwKICB2YWxpZGF0ZQp9KSB7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogIH0KICBkYXRhID0gZGF0YS50cmltKCk7CiAgY29uc3QgbiA9IHBhcnNlRmxvYXQoZGF0YSk7CiAgaWYgKCFpc05hTihuKSAmJiB2YWxpZGF0ZShuKSkgewogICAgcmV0dXJuIG47CiAgfQogIHJldHVybiBkZWZhdWx0VmFsdWU7Cn0KZnVuY3Rpb24gZ2V0S2V5d29yZCh7CiAgZGF0YSwKICBkZWZhdWx0VmFsdWUsCiAgdmFsaWRhdGUKfSkgewogIGlmICghZGF0YSkgewogICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKICB9CiAgZGF0YSA9IGRhdGEudHJpbSgpOwogIGlmICh2YWxpZGF0ZShkYXRhKSkgewogICAgcmV0dXJuIGRhdGE7CiAgfQogIHJldHVybiBkZWZhdWx0VmFsdWU7Cn0KZnVuY3Rpb24gZ2V0U3RyaW5nT3B0aW9uKGRhdGEsIG9wdGlvbnMpIHsKICByZXR1cm4gZ2V0S2V5d29yZCh7CiAgICBkYXRhLAogICAgZGVmYXVsdFZhbHVlOiBvcHRpb25zWzBdLAogICAgdmFsaWRhdGU6IGsgPT4gb3B0aW9ucy5pbmNsdWRlcyhrKQogIH0pOwp9CmZ1bmN0aW9uIGdldE1lYXN1cmVtZW50KHN0ciwgZGVmID0gIjAiKSB7CiAgZGVmIHx8PSAiMCI7CiAgaWYgKCFzdHIpIHsKICAgIHJldHVybiBnZXRNZWFzdXJlbWVudChkZWYpOwogIH0KICBjb25zdCBtYXRjaCA9IHN0ci50cmltKCkubWF0Y2gobWVhc3VyZW1lbnRQYXR0ZXJuKTsKICBpZiAoIW1hdGNoKSB7CiAgICByZXR1cm4gZ2V0TWVhc3VyZW1lbnQoZGVmKTsKICB9CiAgY29uc3QgWywgdmFsdWVTdHIsIHVuaXRdID0gbWF0Y2g7CiAgY29uc3QgdmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlU3RyKTsKICBpZiAoaXNOYU4odmFsdWUpKSB7CiAgICByZXR1cm4gZ2V0TWVhc3VyZW1lbnQoZGVmKTsKICB9CiAgaWYgKHZhbHVlID09PSAwKSB7CiAgICByZXR1cm4gMDsKICB9CiAgY29uc3QgY29udiA9IGRpbUNvbnZlcnRlcnNbdW5pdF07CiAgaWYgKGNvbnYpIHsKICAgIHJldHVybiBjb252KHZhbHVlKTsKICB9CiAgcmV0dXJuIHZhbHVlOwp9CmZ1bmN0aW9uIGdldFJhdGlvKGRhdGEpIHsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiB7CiAgICAgIG51bTogMSwKICAgICAgZGVuOiAxCiAgICB9OwogIH0KICBjb25zdCByYXRpbyA9IGRhdGEuc3BsaXQoIjoiLCAyKS5tYXAoeCA9PiBwYXJzZUZsb2F0KHgudHJpbSgpKSkuZmlsdGVyKHggPT4gIWlzTmFOKHgpKTsKICBpZiAocmF0aW8ubGVuZ3RoID09PSAxKSB7CiAgICByYXRpby5wdXNoKDEpOwogIH0KICBpZiAocmF0aW8ubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gewogICAgICBudW06IDEsCiAgICAgIGRlbjogMQogICAgfTsKICB9CiAgY29uc3QgW251bSwgZGVuXSA9IHJhdGlvOwogIHJldHVybiB7CiAgICBudW0sCiAgICBkZW4KICB9Owp9CmZ1bmN0aW9uIGdldFJlbGV2YW50KGRhdGEpIHsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiBbXTsKICB9CiAgcmV0dXJuIGRhdGEudHJpbSgpLnNwbGl0KC9ccysvKS5tYXAoZSA9PiAoewogICAgZXhjbHVkZWQ6IGVbMF0gPT09ICItIiwKICAgIHZpZXduYW1lOiBlLnN1YnN0cmluZygxKQogIH0pKTsKfQpmdW5jdGlvbiBnZXRDb2xvcihkYXRhLCBkZWYgPSBbMCwgMCwgMF0pIHsKICBsZXQgW3IsIGcsIGJdID0gZGVmOwogIGlmICghZGF0YSkgewogICAgcmV0dXJuIHsKICAgICAgciwKICAgICAgZywKICAgICAgYgogICAgfTsKICB9CiAgY29uc3QgY29sb3IgPSBkYXRhLnNwbGl0KCIsIiwgMykubWFwKGMgPT4gTWF0aENsYW1wKHBhcnNlSW50KGMudHJpbSgpLCAxMCksIDAsIDI1NSkpLm1hcChjID0+IGlzTmFOKGMpID8gMCA6IGMpOwogIGlmIChjb2xvci5sZW5ndGggPCAzKSB7CiAgICByZXR1cm4gewogICAgICByLAogICAgICBnLAogICAgICBiCiAgICB9OwogIH0KICBbciwgZywgYl0gPSBjb2xvcjsKICByZXR1cm4gewogICAgciwKICAgIGcsCiAgICBiCiAgfTsKfQpmdW5jdGlvbiBnZXRCQm94KGRhdGEpIHsKICBjb25zdCBkZWYgPSAtMTsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiB7CiAgICAgIHg6IGRlZiwKICAgICAgeTogZGVmLAogICAgICB3aWR0aDogZGVmLAogICAgICBoZWlnaHQ6IGRlZgogICAgfTsKICB9CiAgY29uc3QgYmJveCA9IGRhdGEuc3BsaXQoIiwiLCA0KS5tYXAobSA9PiBnZXRNZWFzdXJlbWVudChtLnRyaW0oKSwgIi0xIikpOwogIGlmIChiYm94Lmxlbmd0aCA8IDQgfHwgYmJveFsyXSA8IDAgfHwgYmJveFszXSA8IDApIHsKICAgIHJldHVybiB7CiAgICAgIHg6IGRlZiwKICAgICAgeTogZGVmLAogICAgICB3aWR0aDogZGVmLAogICAgICBoZWlnaHQ6IGRlZgogICAgfTsKICB9CiAgY29uc3QgW3gsIHksIHdpZHRoLCBoZWlnaHRdID0gYmJveDsKICByZXR1cm4gewogICAgeCwKICAgIHksCiAgICB3aWR0aCwKICAgIGhlaWdodAogIH07Cn0KY2xhc3MgSFRNTFJlc3VsdCB7CiAgc3RhdGljIGdldCBGQUlMVVJFKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiRkFJTFVSRSIsIG5ldyBIVE1MUmVzdWx0KGZhbHNlLCBudWxsLCBudWxsLCBudWxsKSk7CiAgfQogIHN0YXRpYyBnZXQgRU1QVFkoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJFTVBUWSIsIG5ldyBIVE1MUmVzdWx0KHRydWUsIG51bGwsIG51bGwsIG51bGwpKTsKICB9CiAgY29uc3RydWN0b3Ioc3VjY2VzcywgaHRtbCwgYmJveCwgYnJlYWtOb2RlKSB7CiAgICB0aGlzLnN1Y2Nlc3MgPSBzdWNjZXNzOwogICAgdGhpcy5odG1sID0gaHRtbDsKICAgIHRoaXMuYmJveCA9IGJib3g7CiAgICB0aGlzLmJyZWFrTm9kZSA9IGJyZWFrTm9kZTsKICB9CiAgaXNCcmVhaygpIHsKICAgIHJldHVybiAhIXRoaXMuYnJlYWtOb2RlOwogIH0KICBzdGF0aWMgYnJlYWtOb2RlKG5vZGUpIHsKICAgIHJldHVybiBuZXcgSFRNTFJlc3VsdChmYWxzZSwgbnVsbCwgbnVsbCwgbm9kZSk7CiAgfQogIHN0YXRpYyBzdWNjZXNzKGh0bWwsIGJib3ggPSBudWxsKSB7CiAgICByZXR1cm4gbmV3IEhUTUxSZXN1bHQodHJ1ZSwgaHRtbCwgYmJveCwgbnVsbCk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvZm9udHMuanMKCgoKY2xhc3MgRm9udEZpbmRlciB7CiAgY29uc3RydWN0b3IocGRmRm9udHMpIHsKICAgIHRoaXMuZm9udHMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLmNhY2hlID0gbmV3IE1hcCgpOwogICAgdGhpcy53YXJuZWQgPSBuZXcgU2V0KCk7CiAgICB0aGlzLmRlZmF1bHRGb250ID0gbnVsbDsKICAgIHRoaXMuYWRkKHBkZkZvbnRzKTsKICB9CiAgYWRkKHBkZkZvbnRzLCByZWFsbHlNaXNzaW5nRm9udHMgPSBudWxsKSB7CiAgICBmb3IgKGNvbnN0IHBkZkZvbnQgb2YgcGRmRm9udHMpIHsKICAgICAgdGhpcy5hZGRQZGZGb250KHBkZkZvbnQpOwogICAgfQogICAgZm9yIChjb25zdCBwZGZGb250IG9mIHRoaXMuZm9udHMudmFsdWVzKCkpIHsKICAgICAgaWYgKCFwZGZGb250LnJlZ3VsYXIpIHsKICAgICAgICBwZGZGb250LnJlZ3VsYXIgPSBwZGZGb250Lml0YWxpYyB8fCBwZGZGb250LmJvbGQgfHwgcGRmRm9udC5ib2xkaXRhbGljOwogICAgICB9CiAgICB9CiAgICBpZiAoIXJlYWxseU1pc3NpbmdGb250cyB8fCByZWFsbHlNaXNzaW5nRm9udHMuc2l6ZSA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBteXJpYWQgPSB0aGlzLmZvbnRzLmdldCgiUGRmSlMtRmFsbGJhY2stUGRmSlMtWEZBIik7CiAgICBmb3IgKGNvbnN0IG1pc3Npbmcgb2YgcmVhbGx5TWlzc2luZ0ZvbnRzKSB7CiAgICAgIHRoaXMuZm9udHMuc2V0KG1pc3NpbmcsIG15cmlhZCk7CiAgICB9CiAgfQogIGFkZFBkZkZvbnQocGRmRm9udCkgewogICAgY29uc3QgY3NzRm9udEluZm8gPSBwZGZGb250LmNzc0ZvbnRJbmZvOwogICAgY29uc3QgbmFtZSA9IGNzc0ZvbnRJbmZvLmZvbnRGYW1pbHk7CiAgICBsZXQgZm9udCA9IHRoaXMuZm9udHMuZ2V0KG5hbWUpOwogICAgaWYgKCFmb250KSB7CiAgICAgIGZvbnQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB0aGlzLmZvbnRzLnNldChuYW1lLCBmb250KTsKICAgICAgaWYgKCF0aGlzLmRlZmF1bHRGb250KSB7CiAgICAgICAgdGhpcy5kZWZhdWx0Rm9udCA9IGZvbnQ7CiAgICAgIH0KICAgIH0KICAgIGxldCBwcm9wZXJ0eSA9ICIiOwogICAgY29uc3QgZm9udFdlaWdodCA9IHBhcnNlRmxvYXQoY3NzRm9udEluZm8uZm9udFdlaWdodCk7CiAgICBpZiAocGFyc2VGbG9hdChjc3NGb250SW5mby5pdGFsaWNBbmdsZSkgIT09IDApIHsKICAgICAgcHJvcGVydHkgPSBmb250V2VpZ2h0ID49IDcwMCA/ICJib2xkaXRhbGljIiA6ICJpdGFsaWMiOwogICAgfSBlbHNlIGlmIChmb250V2VpZ2h0ID49IDcwMCkgewogICAgICBwcm9wZXJ0eSA9ICJib2xkIjsKICAgIH0KICAgIGlmICghcHJvcGVydHkpIHsKICAgICAgaWYgKHBkZkZvbnQubmFtZS5pbmNsdWRlcygiQm9sZCIpIHx8IHBkZkZvbnQucHNOYW1lPy5pbmNsdWRlcygiQm9sZCIpKSB7CiAgICAgICAgcHJvcGVydHkgPSAiYm9sZCI7CiAgICAgIH0KICAgICAgaWYgKHBkZkZvbnQubmFtZS5pbmNsdWRlcygiSXRhbGljIikgfHwgcGRmRm9udC5uYW1lLmVuZHNXaXRoKCJJdCIpIHx8IHBkZkZvbnQucHNOYW1lPy5pbmNsdWRlcygiSXRhbGljIikgfHwgcGRmRm9udC5wc05hbWU/LmVuZHNXaXRoKCJJdCIpKSB7CiAgICAgICAgcHJvcGVydHkgKz0gIml0YWxpYyI7CiAgICAgIH0KICAgIH0KICAgIGlmICghcHJvcGVydHkpIHsKICAgICAgcHJvcGVydHkgPSAicmVndWxhciI7CiAgICB9CiAgICBmb250W3Byb3BlcnR5XSA9IHBkZkZvbnQ7CiAgfQogIGdldERlZmF1bHQoKSB7CiAgICByZXR1cm4gdGhpcy5kZWZhdWx0Rm9udDsKICB9CiAgZmluZChmb250TmFtZSwgbXVzdFdhcm4gPSB0cnVlKSB7CiAgICBsZXQgZm9udCA9IHRoaXMuZm9udHMuZ2V0KGZvbnROYW1lKSB8fCB0aGlzLmNhY2hlLmdldChmb250TmFtZSk7CiAgICBpZiAoZm9udCkgewogICAgICByZXR1cm4gZm9udDsKICAgIH0KICAgIGNvbnN0IHBhdHRlcm4gPSAvLHwtfF98IHxib2xkaXRhbGljfGJvbGR8aXRhbGljfHJlZ3VsYXJ8aXQvZ2k7CiAgICBsZXQgbmFtZSA9IGZvbnROYW1lLnJlcGxhY2VBbGwocGF0dGVybiwgIiIpOwogICAgZm9udCA9IHRoaXMuZm9udHMuZ2V0KG5hbWUpOwogICAgaWYgKGZvbnQpIHsKICAgICAgdGhpcy5jYWNoZS5zZXQoZm9udE5hbWUsIGZvbnQpOwogICAgICByZXR1cm4gZm9udDsKICAgIH0KICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICBjb25zdCBtYXliZSA9IFtdOwogICAgZm9yIChjb25zdCBbZmFtaWx5LCBwZGZGb250XSBvZiB0aGlzLmZvbnRzLmVudHJpZXMoKSkgewogICAgICBpZiAoZmFtaWx5LnJlcGxhY2VBbGwocGF0dGVybiwgIiIpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChuYW1lKSkgewogICAgICAgIG1heWJlLnB1c2gocGRmRm9udCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXliZS5sZW5ndGggPT09IDApIHsKICAgICAgZm9yIChjb25zdCBbLCBwZGZGb250XSBvZiB0aGlzLmZvbnRzLmVudHJpZXMoKSkgewogICAgICAgIGlmIChwZGZGb250LnJlZ3VsYXIubmFtZT8ucmVwbGFjZUFsbChwYXR0ZXJuLCAiIikudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKG5hbWUpKSB7CiAgICAgICAgICBtYXliZS5wdXNoKHBkZkZvbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKG1heWJlLmxlbmd0aCA9PT0gMCkgewogICAgICBuYW1lID0gbmFtZS5yZXBsYWNlQWxsKC9wc210fG10L2dpLCAiIik7CiAgICAgIGZvciAoY29uc3QgW2ZhbWlseSwgcGRmRm9udF0gb2YgdGhpcy5mb250cy5lbnRyaWVzKCkpIHsKICAgICAgICBpZiAoZmFtaWx5LnJlcGxhY2VBbGwocGF0dGVybiwgIiIpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChuYW1lKSkgewogICAgICAgICAgbWF5YmUucHVzaChwZGZGb250KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXliZS5sZW5ndGggPT09IDApIHsKICAgICAgZm9yIChjb25zdCBwZGZGb250IG9mIHRoaXMuZm9udHMudmFsdWVzKCkpIHsKICAgICAgICBpZiAocGRmRm9udC5yZWd1bGFyLm5hbWU/LnJlcGxhY2VBbGwocGF0dGVybiwgIiIpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChuYW1lKSkgewogICAgICAgICAgbWF5YmUucHVzaChwZGZGb250KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXliZS5sZW5ndGggPj0gMSkgewogICAgICBpZiAobWF5YmUubGVuZ3RoICE9PSAxICYmIG11c3RXYXJuKSB7CiAgICAgICAgd2FybihgWEZBIC0gVG9vIG1hbnkgY2hvaWNlcyB0byBndWVzcyB0aGUgY29ycmVjdCBmb250OiAke2ZvbnROYW1lfWApOwogICAgICB9CiAgICAgIHRoaXMuY2FjaGUuc2V0KGZvbnROYW1lLCBtYXliZVswXSk7CiAgICAgIHJldHVybiBtYXliZVswXTsKICAgIH0KICAgIGlmIChtdXN0V2FybiAmJiAhdGhpcy53YXJuZWQuaGFzKGZvbnROYW1lKSkgewogICAgICB0aGlzLndhcm5lZC5hZGQoZm9udE5hbWUpOwogICAgICB3YXJuKGBYRkEgLSBDYW5ub3QgZmluZCB0aGUgZm9udDogJHtmb250TmFtZX1gKTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KfQpmdW5jdGlvbiBzZWxlY3RGb250KHhmYUZvbnQsIHR5cGVmYWNlKSB7CiAgaWYgKHhmYUZvbnQucG9zdHVyZSA9PT0gIml0YWxpYyIpIHsKICAgIGlmICh4ZmFGb250LndlaWdodCA9PT0gImJvbGQiKSB7CiAgICAgIHJldHVybiB0eXBlZmFjZS5ib2xkaXRhbGljOwogICAgfQogICAgcmV0dXJuIHR5cGVmYWNlLml0YWxpYzsKICB9IGVsc2UgaWYgKHhmYUZvbnQud2VpZ2h0ID09PSAiYm9sZCIpIHsKICAgIHJldHVybiB0eXBlZmFjZS5ib2xkOwogIH0KICByZXR1cm4gdHlwZWZhY2UucmVndWxhcjsKfQpmdW5jdGlvbiBmb250c19nZXRNZXRyaWNzKHhmYUZvbnQsIHJlYWwgPSBmYWxzZSkgewogIGxldCBwZGZGb250ID0gbnVsbDsKICBpZiAoeGZhRm9udCkgewogICAgY29uc3QgbmFtZSA9IHN0cmlwUXVvdGVzKHhmYUZvbnQudHlwZWZhY2UpOwogICAgY29uc3QgdHlwZWZhY2UgPSB4ZmFGb250WyRnbG9iYWxEYXRhXS5mb250RmluZGVyLmZpbmQobmFtZSk7CiAgICBwZGZGb250ID0gc2VsZWN0Rm9udCh4ZmFGb250LCB0eXBlZmFjZSk7CiAgfQogIGlmICghcGRmRm9udCkgewogICAgcmV0dXJuIHsKICAgICAgbGluZUhlaWdodDogMTIsCiAgICAgIGxpbmVHYXA6IDIsCiAgICAgIGxpbmVOb0dhcDogMTAKICAgIH07CiAgfQogIGNvbnN0IHNpemUgPSB4ZmFGb250LnNpemUgfHwgMTA7CiAgY29uc3QgbGluZUhlaWdodCA9IHBkZkZvbnQubGluZUhlaWdodCA/IE1hdGgubWF4KHJlYWwgPyAwIDogMS4yLCBwZGZGb250LmxpbmVIZWlnaHQpIDogMS4yOwogIGNvbnN0IGxpbmVHYXAgPSBwZGZGb250LmxpbmVHYXAgPT09IHVuZGVmaW5lZCA/IDAuMiA6IHBkZkZvbnQubGluZUdhcDsKICByZXR1cm4gewogICAgbGluZUhlaWdodDogbGluZUhlaWdodCAqIHNpemUsCiAgICBsaW5lR2FwOiBsaW5lR2FwICogc2l6ZSwKICAgIGxpbmVOb0dhcDogTWF0aC5tYXgoMSwgbGluZUhlaWdodCAtIGxpbmVHYXApICogc2l6ZQogIH07Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS90ZXh0LmpzCgpjb25zdCBXSURUSF9GQUNUT1IgPSAxLjAyOwpjbGFzcyB0ZXh0X0ZvbnRJbmZvIHsKICBjb25zdHJ1Y3Rvcih4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQsIGZvbnRGaW5kZXIpIHsKICAgIHRoaXMubGluZUhlaWdodCA9IGxpbmVIZWlnaHQ7CiAgICB0aGlzLnBhcmFNYXJnaW4gPSBtYXJnaW4gfHwgewogICAgICB0b3A6IDAsCiAgICAgIGJvdHRvbTogMCwKICAgICAgbGVmdDogMCwKICAgICAgcmlnaHQ6IDAKICAgIH07CiAgICBpZiAoIXhmYUZvbnQpIHsKICAgICAgW3RoaXMucGRmRm9udCwgdGhpcy54ZmFGb250XSA9IHRoaXMuZGVmYXVsdEZvbnQoZm9udEZpbmRlcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMueGZhRm9udCA9IHsKICAgICAgdHlwZWZhY2U6IHhmYUZvbnQudHlwZWZhY2UsCiAgICAgIHBvc3R1cmU6IHhmYUZvbnQucG9zdHVyZSwKICAgICAgd2VpZ2h0OiB4ZmFGb250LndlaWdodCwKICAgICAgc2l6ZTogeGZhRm9udC5zaXplLAogICAgICBsZXR0ZXJTcGFjaW5nOiB4ZmFGb250LmxldHRlclNwYWNpbmcKICAgIH07CiAgICBjb25zdCB0eXBlZmFjZSA9IGZvbnRGaW5kZXIuZmluZCh4ZmFGb250LnR5cGVmYWNlKTsKICAgIGlmICghdHlwZWZhY2UpIHsKICAgICAgW3RoaXMucGRmRm9udCwgdGhpcy54ZmFGb250XSA9IHRoaXMuZGVmYXVsdEZvbnQoZm9udEZpbmRlcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMucGRmRm9udCA9IHNlbGVjdEZvbnQoeGZhRm9udCwgdHlwZWZhY2UpOwogICAgaWYgKCF0aGlzLnBkZkZvbnQpIHsKICAgICAgW3RoaXMucGRmRm9udCwgdGhpcy54ZmFGb250XSA9IHRoaXMuZGVmYXVsdEZvbnQoZm9udEZpbmRlcik7CiAgICB9CiAgfQogIGRlZmF1bHRGb250KGZvbnRGaW5kZXIpIHsKICAgIGNvbnN0IGZvbnQgPSBmb250RmluZGVyLmZpbmQoIkhlbHZldGljYSIsIGZhbHNlKSB8fCBmb250RmluZGVyLmZpbmQoIk15cmlhZCBQcm8iLCBmYWxzZSkgfHwgZm9udEZpbmRlci5maW5kKCJBcmlhbCIsIGZhbHNlKSB8fCBmb250RmluZGVyLmdldERlZmF1bHQoKTsKICAgIGlmIChmb250Py5yZWd1bGFyKSB7CiAgICAgIGNvbnN0IHBkZkZvbnQgPSBmb250LnJlZ3VsYXI7CiAgICAgIGNvbnN0IGluZm8gPSBwZGZGb250LmNzc0ZvbnRJbmZvOwogICAgICBjb25zdCB4ZmFGb250ID0gewogICAgICAgIHR5cGVmYWNlOiBpbmZvLmZvbnRGYW1pbHksCiAgICAgICAgcG9zdHVyZTogIm5vcm1hbCIsCiAgICAgICAgd2VpZ2h0OiAibm9ybWFsIiwKICAgICAgICBzaXplOiAxMCwKICAgICAgICBsZXR0ZXJTcGFjaW5nOiAwCiAgICAgIH07CiAgICAgIHJldHVybiBbcGRmRm9udCwgeGZhRm9udF07CiAgICB9CiAgICBjb25zdCB4ZmFGb250ID0gewogICAgICB0eXBlZmFjZTogIkNvdXJpZXIiLAogICAgICBwb3N0dXJlOiAibm9ybWFsIiwKICAgICAgd2VpZ2h0OiAibm9ybWFsIiwKICAgICAgc2l6ZTogMTAsCiAgICAgIGxldHRlclNwYWNpbmc6IDAKICAgIH07CiAgICByZXR1cm4gW251bGwsIHhmYUZvbnRdOwogIH0KfQpjbGFzcyBGb250U2VsZWN0b3IgewogIGNvbnN0cnVjdG9yKGRlZmF1bHRYZmFGb250LCBkZWZhdWx0UGFyYU1hcmdpbiwgZGVmYXVsdExpbmVIZWlnaHQsIGZvbnRGaW5kZXIpIHsKICAgIHRoaXMuZm9udEZpbmRlciA9IGZvbnRGaW5kZXI7CiAgICB0aGlzLnN0YWNrID0gW25ldyB0ZXh0X0ZvbnRJbmZvKGRlZmF1bHRYZmFGb250LCBkZWZhdWx0UGFyYU1hcmdpbiwgZGVmYXVsdExpbmVIZWlnaHQsIGZvbnRGaW5kZXIpXTsKICB9CiAgcHVzaERhdGEoeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0KSB7CiAgICBjb25zdCBsYXN0Rm9udCA9IHRoaXMuc3RhY2suYXQoLTEpOwogICAgZm9yIChjb25zdCBuYW1lIG9mIFsidHlwZWZhY2UiLCAicG9zdHVyZSIsICJ3ZWlnaHQiLCAic2l6ZSIsICJsZXR0ZXJTcGFjaW5nIl0pIHsKICAgICAgaWYgKCF4ZmFGb250W25hbWVdKSB7CiAgICAgICAgeGZhRm9udFtuYW1lXSA9IGxhc3RGb250LnhmYUZvbnRbbmFtZV07CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBbInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCJdKSB7CiAgICAgIGlmIChpc05hTihtYXJnaW5bbmFtZV0pKSB7CiAgICAgICAgbWFyZ2luW25hbWVdID0gbGFzdEZvbnQucGFyYU1hcmdpbltuYW1lXTsKICAgICAgfQogICAgfQogICAgY29uc3QgZm9udEluZm8gPSBuZXcgdGV4dF9Gb250SW5mbyh4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQgfHwgbGFzdEZvbnQubGluZUhlaWdodCwgdGhpcy5mb250RmluZGVyKTsKICAgIGlmICghZm9udEluZm8ucGRmRm9udCkgewogICAgICBmb250SW5mby5wZGZGb250ID0gbGFzdEZvbnQucGRmRm9udDsKICAgIH0KICAgIHRoaXMuc3RhY2sucHVzaChmb250SW5mbyk7CiAgfQogIHBvcEZvbnQoKSB7CiAgICB0aGlzLnN0YWNrLnBvcCgpOwogIH0KICB0b3BGb250KCkgewogICAgcmV0dXJuIHRoaXMuc3RhY2suYXQoLTEpOwogIH0KfQpjbGFzcyBUZXh0TWVhc3VyZSB7CiAgY29uc3RydWN0b3IoZGVmYXVsdFhmYUZvbnQsIGRlZmF1bHRQYXJhTWFyZ2luLCBkZWZhdWx0TGluZUhlaWdodCwgZm9udHMpIHsKICAgIHRoaXMuZ2x5cGhzID0gW107CiAgICB0aGlzLmZvbnRTZWxlY3RvciA9IG5ldyBGb250U2VsZWN0b3IoZGVmYXVsdFhmYUZvbnQsIGRlZmF1bHRQYXJhTWFyZ2luLCBkZWZhdWx0TGluZUhlaWdodCwgZm9udHMpOwogICAgdGhpcy5leHRyYUhlaWdodCA9IDA7CiAgfQogIHB1c2hEYXRhKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCkgewogICAgdGhpcy5mb250U2VsZWN0b3IucHVzaERhdGEoeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0KTsKICB9CiAgcG9wRm9udCh4ZmFGb250KSB7CiAgICByZXR1cm4gdGhpcy5mb250U2VsZWN0b3IucG9wRm9udCgpOwogIH0KICBhZGRQYXJhKCkgewogICAgY29uc3QgbGFzdEZvbnQgPSB0aGlzLmZvbnRTZWxlY3Rvci50b3BGb250KCk7CiAgICB0aGlzLmV4dHJhSGVpZ2h0ICs9IGxhc3RGb250LnBhcmFNYXJnaW4udG9wICsgbGFzdEZvbnQucGFyYU1hcmdpbi5ib3R0b207CiAgfQogIGFkZFN0cmluZyhzdHIpIHsKICAgIGlmICghc3RyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGxhc3RGb250ID0gdGhpcy5mb250U2VsZWN0b3IudG9wRm9udCgpOwogICAgY29uc3QgZm9udFNpemUgPSBsYXN0Rm9udC54ZmFGb250LnNpemU7CiAgICBpZiAobGFzdEZvbnQucGRmRm9udCkgewogICAgICBjb25zdCBsZXR0ZXJTcGFjaW5nID0gbGFzdEZvbnQueGZhRm9udC5sZXR0ZXJTcGFjaW5nOwogICAgICBjb25zdCBwZGZGb250ID0gbGFzdEZvbnQucGRmRm9udDsKICAgICAgY29uc3QgZm9udExpbmVIZWlnaHQgPSBwZGZGb250LmxpbmVIZWlnaHQgfHwgMS4yOwogICAgICBjb25zdCBsaW5lSGVpZ2h0ID0gbGFzdEZvbnQubGluZUhlaWdodCB8fCBNYXRoLm1heCgxLjIsIGZvbnRMaW5lSGVpZ2h0KSAqIGZvbnRTaXplOwogICAgICBjb25zdCBsaW5lR2FwID0gcGRmRm9udC5saW5lR2FwID09PSB1bmRlZmluZWQgPyAwLjIgOiBwZGZGb250LmxpbmVHYXA7CiAgICAgIGNvbnN0IG5vR2FwID0gZm9udExpbmVIZWlnaHQgLSBsaW5lR2FwOwogICAgICBjb25zdCBmaXJzdExpbmVIZWlnaHQgPSBNYXRoLm1heCgxLCBub0dhcCkgKiBmb250U2l6ZTsKICAgICAgY29uc3Qgc2NhbGUgPSBmb250U2l6ZSAvIDEwMDA7CiAgICAgIGNvbnN0IGZhbGxiYWNrV2lkdGggPSBwZGZGb250LmRlZmF1bHRXaWR0aCB8fCBwZGZGb250LmNoYXJzVG9HbHlwaHMoIiAiKVswXS53aWR0aDsKICAgICAgZm9yIChjb25zdCBsaW5lIG9mIHN0ci5zcGxpdCgvW1x1MjAyOVxuXS8pKSB7CiAgICAgICAgY29uc3QgZW5jb2RlZExpbmUgPSBwZGZGb250LmVuY29kZVN0cmluZyhsaW5lKS5qb2luKCIiKTsKICAgICAgICBjb25zdCBnbHlwaHMgPSBwZGZGb250LmNoYXJzVG9HbHlwaHMoZW5jb2RlZExpbmUpOwogICAgICAgIGZvciAoY29uc3QgZ2x5cGggb2YgZ2x5cGhzKSB7CiAgICAgICAgICBjb25zdCB3aWR0aCA9IGdseXBoLndpZHRoIHx8IGZhbGxiYWNrV2lkdGg7CiAgICAgICAgICB0aGlzLmdseXBocy5wdXNoKFt3aWR0aCAqIHNjYWxlICsgbGV0dGVyU3BhY2luZywgbGluZUhlaWdodCwgZmlyc3RMaW5lSGVpZ2h0LCBnbHlwaC51bmljb2RlLCBmYWxzZV0pOwogICAgICAgIH0KICAgICAgICB0aGlzLmdseXBocy5wdXNoKFswLCAwLCAwLCAiXG4iLCB0cnVlXSk7CiAgICAgIH0KICAgICAgdGhpcy5nbHlwaHMucG9wKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgbGluZSBvZiBzdHIuc3BsaXQoL1tcdTIwMjlcbl0vKSkgewogICAgICBmb3IgKGNvbnN0IGNoYXIgb2YgbGluZS5zcGxpdCgiIikpIHsKICAgICAgICB0aGlzLmdseXBocy5wdXNoKFtmb250U2l6ZSwgMS4yICogZm9udFNpemUsIGZvbnRTaXplLCBjaGFyLCBmYWxzZV0pOwogICAgICB9CiAgICAgIHRoaXMuZ2x5cGhzLnB1c2goWzAsIDAsIDAsICJcbiIsIHRydWVdKTsKICAgIH0KICAgIHRoaXMuZ2x5cGhzLnBvcCgpOwogIH0KICBjb21wdXRlKG1heFdpZHRoKSB7CiAgICBsZXQgbGFzdFNwYWNlUG9zID0gLTEsCiAgICAgIGxhc3RTcGFjZVdpZHRoID0gMCwKICAgICAgd2lkdGggPSAwLAogICAgICBoZWlnaHQgPSAwLAogICAgICBjdXJyZW50TGluZVdpZHRoID0gMCwKICAgICAgY3VycmVudExpbmVIZWlnaHQgPSAwOwogICAgbGV0IGlzQnJva2VuID0gZmFsc2U7CiAgICBsZXQgaXNGaXJzdExpbmUgPSB0cnVlOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5nbHlwaHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBbZ2x5cGhXaWR0aCwgbGluZUhlaWdodCwgZmlyc3RMaW5lSGVpZ2h0LCBjaGFyLCBpc0VPTF0gPSB0aGlzLmdseXBoc1tpXTsKICAgICAgY29uc3QgaXNTcGFjZSA9IGNoYXIgPT09ICIgIjsKICAgICAgY29uc3QgZ2x5cGhIZWlnaHQgPSBpc0ZpcnN0TGluZSA/IGZpcnN0TGluZUhlaWdodCA6IGxpbmVIZWlnaHQ7CiAgICAgIGlmIChpc0VPTCkgewogICAgICAgIHdpZHRoID0gTWF0aC5tYXgod2lkdGgsIGN1cnJlbnRMaW5lV2lkdGgpOwogICAgICAgIGN1cnJlbnRMaW5lV2lkdGggPSAwOwogICAgICAgIGhlaWdodCArPSBjdXJyZW50TGluZUhlaWdodDsKICAgICAgICBjdXJyZW50TGluZUhlaWdodCA9IGdseXBoSGVpZ2h0OwogICAgICAgIGxhc3RTcGFjZVBvcyA9IC0xOwogICAgICAgIGxhc3RTcGFjZVdpZHRoID0gMDsKICAgICAgICBpc0ZpcnN0TGluZSA9IGZhbHNlOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChpc1NwYWNlKSB7CiAgICAgICAgaWYgKGN1cnJlbnRMaW5lV2lkdGggKyBnbHlwaFdpZHRoID4gbWF4V2lkdGgpIHsKICAgICAgICAgIHdpZHRoID0gTWF0aC5tYXgod2lkdGgsIGN1cnJlbnRMaW5lV2lkdGgpOwogICAgICAgICAgY3VycmVudExpbmVXaWR0aCA9IDA7CiAgICAgICAgICBoZWlnaHQgKz0gY3VycmVudExpbmVIZWlnaHQ7CiAgICAgICAgICBjdXJyZW50TGluZUhlaWdodCA9IGdseXBoSGVpZ2h0OwogICAgICAgICAgbGFzdFNwYWNlUG9zID0gLTE7CiAgICAgICAgICBsYXN0U3BhY2VXaWR0aCA9IDA7CiAgICAgICAgICBpc0Jyb2tlbiA9IHRydWU7CiAgICAgICAgICBpc0ZpcnN0TGluZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50TGluZUhlaWdodCA9IE1hdGgubWF4KGdseXBoSGVpZ2h0LCBjdXJyZW50TGluZUhlaWdodCk7CiAgICAgICAgICBsYXN0U3BhY2VXaWR0aCA9IGN1cnJlbnRMaW5lV2lkdGg7CiAgICAgICAgICBjdXJyZW50TGluZVdpZHRoICs9IGdseXBoV2lkdGg7CiAgICAgICAgICBsYXN0U3BhY2VQb3MgPSBpOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoY3VycmVudExpbmVXaWR0aCArIGdseXBoV2lkdGggPiBtYXhXaWR0aCkgewogICAgICAgIGhlaWdodCArPSBjdXJyZW50TGluZUhlaWdodDsKICAgICAgICBjdXJyZW50TGluZUhlaWdodCA9IGdseXBoSGVpZ2h0OwogICAgICAgIGlmIChsYXN0U3BhY2VQb3MgIT09IC0xKSB7CiAgICAgICAgICBpID0gbGFzdFNwYWNlUG9zOwogICAgICAgICAgd2lkdGggPSBNYXRoLm1heCh3aWR0aCwgbGFzdFNwYWNlV2lkdGgpOwogICAgICAgICAgY3VycmVudExpbmVXaWR0aCA9IDA7CiAgICAgICAgICBsYXN0U3BhY2VQb3MgPSAtMTsKICAgICAgICAgIGxhc3RTcGFjZVdpZHRoID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2lkdGggPSBNYXRoLm1heCh3aWR0aCwgY3VycmVudExpbmVXaWR0aCk7CiAgICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gZ2x5cGhXaWR0aDsKICAgICAgICB9CiAgICAgICAgaXNCcm9rZW4gPSB0cnVlOwogICAgICAgIGlzRmlyc3RMaW5lID0gZmFsc2U7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY3VycmVudExpbmVXaWR0aCArPSBnbHlwaFdpZHRoOwogICAgICBjdXJyZW50TGluZUhlaWdodCA9IE1hdGgubWF4KGdseXBoSGVpZ2h0LCBjdXJyZW50TGluZUhlaWdodCk7CiAgICB9CiAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBjdXJyZW50TGluZVdpZHRoKTsKICAgIGhlaWdodCArPSBjdXJyZW50TGluZUhlaWdodCArIHRoaXMuZXh0cmFIZWlnaHQ7CiAgICByZXR1cm4gewogICAgICB3aWR0aDogV0lEVEhfRkFDVE9SICogd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAgaXNCcm9rZW4KICAgIH07CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvc29tLmpzCgoKY29uc3QgbmFtZVBhdHRlcm4gPSAvXlteLltdKy87CmNvbnN0IGluZGV4UGF0dGVybiA9IC9eW15cXV0rLzsKY29uc3Qgb3BlcmF0b3JzID0gewogIGRvdDogMCwKICBkb3REb3Q6IDEsCiAgZG90SGFzaDogMiwKICBkb3RCcmFja2V0OiAzLAogIGRvdFBhcmVuOiA0Cn07CmNvbnN0IHNob3J0Y3V0cyA9IG5ldyBNYXAoW1siJGRhdGEiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5kYXRhc2V0cyA/IHJvb3QuZGF0YXNldHMuZGF0YSA6IHJvb3RdLCBbIiRyZWNvcmQiLCAocm9vdCwgY3VycmVudCkgPT4gKHJvb3QuZGF0YXNldHMgPyByb290LmRhdGFzZXRzLmRhdGEgOiByb290KVskZ2V0Q2hpbGRyZW5dKClbMF1dLCBbIiR0ZW1wbGF0ZSIsIChyb290LCBjdXJyZW50KSA9PiByb290LnRlbXBsYXRlXSwgWyIkY29ubmVjdGlvblNldCIsIChyb290LCBjdXJyZW50KSA9PiByb290LmNvbm5lY3Rpb25TZXRdLCBbIiRmb3JtIiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuZm9ybV0sIFsiJGxheW91dCIsIChyb290LCBjdXJyZW50KSA9PiByb290LmxheW91dF0sIFsiJGhvc3QiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5ob3N0XSwgWyIkZGF0YVdpbmRvdyIsIChyb290LCBjdXJyZW50KSA9PiByb290LmRhdGFXaW5kb3ddLCBbIiRldmVudCIsIChyb290LCBjdXJyZW50KSA9PiByb290LmV2ZW50XSwgWyIhIiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuZGF0YXNldHNdLCBbIiR4ZmEiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdF0sIFsieGZhIiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3RdLCBbIiQiLCAocm9vdCwgY3VycmVudCkgPT4gY3VycmVudF1dKTsKY29uc3Qgc29tQ2FjaGUgPSBuZXcgV2Vha01hcCgpOwpmdW5jdGlvbiBwYXJzZUluZGV4KGluZGV4KSB7CiAgaW5kZXggPSBpbmRleC50cmltKCk7CiAgaWYgKGluZGV4ID09PSAiKiIpIHsKICAgIHJldHVybiBJbmZpbml0eTsKICB9CiAgcmV0dXJuIHBhcnNlSW50KGluZGV4LCAxMCkgfHwgMDsKfQpmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb24oZXhwciwgZG90RG90QWxsb3dlZCwgbm9FeHByID0gdHJ1ZSkgewogIGxldCBtYXRjaCA9IGV4cHIubWF0Y2gobmFtZVBhdHRlcm4pOwogIGlmICghbWF0Y2gpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBsZXQgW25hbWVdID0gbWF0Y2g7CiAgY29uc3QgcGFyc2VkID0gW3sKICAgIG5hbWUsCiAgICBjYWNoZU5hbWU6ICIuIiArIG5hbWUsCiAgICBpbmRleDogMCwKICAgIGpzOiBudWxsLAogICAgZm9ybUNhbGM6IG51bGwsCiAgICBvcGVyYXRvcjogb3BlcmF0b3JzLmRvdAogIH1dOwogIGxldCBwb3MgPSBuYW1lLmxlbmd0aDsKICB3aGlsZSAocG9zIDwgZXhwci5sZW5ndGgpIHsKICAgIGNvbnN0IHNwb3MgPSBwb3M7CiAgICBjb25zdCBjaGFyID0gZXhwci5jaGFyQXQocG9zKyspOwogICAgaWYgKGNoYXIgPT09ICJbIikgewogICAgICBtYXRjaCA9IGV4cHIuc2xpY2UocG9zKS5tYXRjaChpbmRleFBhdHRlcm4pOwogICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgd2FybigiWEZBIC0gSW52YWxpZCBpbmRleCBpbiBTT00gZXhwcmVzc2lvbiIpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHBhcnNlZC5hdCgtMSkuaW5kZXggPSBwYXJzZUluZGV4KG1hdGNoWzBdKTsKICAgICAgcG9zICs9IG1hdGNoWzBdLmxlbmd0aCArIDE7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgbGV0IG9wZXJhdG9yOwogICAgc3dpdGNoIChleHByLmNoYXJBdChwb3MpKSB7CiAgICAgIGNhc2UgIi4iOgogICAgICAgIGlmICghZG90RG90QWxsb3dlZCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHBvcysrOwogICAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzLmRvdERvdDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiIyI6CiAgICAgICAgcG9zKys7CiAgICAgICAgb3BlcmF0b3IgPSBvcGVyYXRvcnMuZG90SGFzaDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiWyI6CiAgICAgICAgaWYgKG5vRXhwcikgewogICAgICAgICAgd2FybigiWEZBIC0gU09NIGV4cHJlc3Npb24gY29udGFpbnMgYSBGb3JtQ2FsYyBzdWJleHByZXNzaW9uIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIG5vdy4iKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3RCcmFja2V0OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICIoIjoKICAgICAgICBpZiAobm9FeHByKSB7CiAgICAgICAgICB3YXJuKCJYRkEgLSBTT00gZXhwcmVzc2lvbiBjb250YWlucyBhIEphdmFTY3JpcHQgc3ViZXhwcmVzc2lvbiB3aGljaCBpcyBub3Qgc3VwcG9ydGVkIGZvciBub3cuIik7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgb3BlcmF0b3IgPSBvcGVyYXRvcnMuZG90UGFyZW47CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgb3BlcmF0b3IgPSBvcGVyYXRvcnMuZG90OwogICAgICAgIGJyZWFrOwogICAgfQogICAgbWF0Y2ggPSBleHByLnNsaWNlKHBvcykubWF0Y2gobmFtZVBhdHRlcm4pOwogICAgaWYgKCFtYXRjaCkgewogICAgICBicmVhazsKICAgIH0KICAgIFtuYW1lXSA9IG1hdGNoOwogICAgcG9zICs9IG5hbWUubGVuZ3RoOwogICAgcGFyc2VkLnB1c2goewogICAgICBuYW1lLAogICAgICBjYWNoZU5hbWU6IGV4cHIuc2xpY2Uoc3BvcywgcG9zKSwKICAgICAgb3BlcmF0b3IsCiAgICAgIGluZGV4OiAwLAogICAgICBqczogbnVsbCwKICAgICAgZm9ybUNhbGM6IG51bGwKICAgIH0pOwogIH0KICByZXR1cm4gcGFyc2VkOwp9CmZ1bmN0aW9uIHNlYXJjaE5vZGUocm9vdCwgY29udGFpbmVyLCBleHByLCBkb3REb3RBbGxvd2VkID0gdHJ1ZSwgdXNlQ2FjaGUgPSB0cnVlKSB7CiAgY29uc3QgcGFyc2VkID0gcGFyc2VFeHByZXNzaW9uKGV4cHIsIGRvdERvdEFsbG93ZWQpOwogIGlmICghcGFyc2VkKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgZm4gPSBzaG9ydGN1dHMuZ2V0KHBhcnNlZFswXS5uYW1lKTsKICBsZXQgaSA9IDA7CiAgbGV0IGlzUXVhbGlmaWVkOwogIGlmIChmbikgewogICAgaXNRdWFsaWZpZWQgPSB0cnVlOwogICAgcm9vdCA9IFtmbihyb290LCBjb250YWluZXIpXTsKICAgIGkgPSAxOwogIH0gZWxzZSB7CiAgICBpc1F1YWxpZmllZCA9IGNvbnRhaW5lciA9PT0gbnVsbDsKICAgIHJvb3QgPSBbY29udGFpbmVyIHx8IHJvb3RdOwogIH0KICBmb3IgKGxldCBpaSA9IHBhcnNlZC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIGNhY2hlTmFtZSwKICAgICAgb3BlcmF0b3IsCiAgICAgIGluZGV4CiAgICB9ID0gcGFyc2VkW2ldOwogICAgY29uc3Qgbm9kZXMgPSBbXTsKICAgIGZvciAoY29uc3Qgbm9kZSBvZiByb290KSB7CiAgICAgIGlmICghbm9kZS5pc1hGQU9iamVjdCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCBjaGlsZHJlbiwgY2FjaGVkOwogICAgICBpZiAodXNlQ2FjaGUpIHsKICAgICAgICBjYWNoZWQgPSBzb21DYWNoZS5nZXQobm9kZSk7CiAgICAgICAgaWYgKCFjYWNoZWQpIHsKICAgICAgICAgIGNhY2hlZCA9IG5ldyBNYXAoKTsKICAgICAgICAgIHNvbUNhY2hlLnNldChub2RlLCBjYWNoZWQpOwogICAgICAgIH0KICAgICAgICBjaGlsZHJlbiA9IGNhY2hlZC5nZXQoY2FjaGVOYW1lKTsKICAgICAgfQogICAgICBpZiAoIWNoaWxkcmVuKSB7CiAgICAgICAgc3dpdGNoIChvcGVyYXRvcikgewogICAgICAgICAgY2FzZSBvcGVyYXRvcnMuZG90OgogICAgICAgICAgICBjaGlsZHJlbiA9IG5vZGVbJGdldENoaWxkcmVuQnlOYW1lXShuYW1lLCBmYWxzZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBvcGVyYXRvcnMuZG90RG90OgogICAgICAgICAgICBjaGlsZHJlbiA9IG5vZGVbJGdldENoaWxkcmVuQnlOYW1lXShuYW1lLCB0cnVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIG9wZXJhdG9ycy5kb3RIYXNoOgogICAgICAgICAgICBjaGlsZHJlbiA9IG5vZGVbJGdldENoaWxkcmVuQnlDbGFzc10obmFtZSk7CiAgICAgICAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uaXNYRkFPYmplY3RBcnJheSA/IGNoaWxkcmVuLmNoaWxkcmVuIDogW2NoaWxkcmVuXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHVzZUNhY2hlKSB7CiAgICAgICAgICBjYWNoZWQuc2V0KGNhY2hlTmFtZSwgY2hpbGRyZW4pOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgIG5vZGVzLnB1c2goY2hpbGRyZW4pOwogICAgICB9CiAgICB9CiAgICBpZiAobm9kZXMubGVuZ3RoID09PSAwICYmICFpc1F1YWxpZmllZCAmJiBpID09PSAwKSB7CiAgICAgIGNvbnN0IHBhcmVudCA9IGNvbnRhaW5lclskZ2V0UGFyZW50XSgpOwogICAgICBjb250YWluZXIgPSBwYXJlbnQ7CiAgICAgIGlmICghY29udGFpbmVyKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaSA9IC0xOwogICAgICByb290ID0gW2NvbnRhaW5lcl07CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgcm9vdCA9IGlzRmluaXRlKGluZGV4KSA/IG5vZGVzLmZpbHRlcihub2RlID0+IGluZGV4IDwgbm9kZS5sZW5ndGgpLm1hcChub2RlID0+IG5vZGVbaW5kZXhdKSA6IG5vZGVzLmZsYXQoKTsKICB9CiAgaWYgKHJvb3QubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgcmV0dXJuIHJvb3Q7Cn0KZnVuY3Rpb24gY3JlYXRlRGF0YU5vZGUocm9vdCwgY29udGFpbmVyLCBleHByKSB7CiAgY29uc3QgcGFyc2VkID0gcGFyc2VFeHByZXNzaW9uKGV4cHIpOwogIGlmICghcGFyc2VkKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaWYgKHBhcnNlZC5zb21lKHggPT4geC5vcGVyYXRvciA9PT0gb3BlcmF0b3JzLmRvdERvdCkpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBmbiA9IHNob3J0Y3V0cy5nZXQocGFyc2VkWzBdLm5hbWUpOwogIGxldCBpID0gMDsKICBpZiAoZm4pIHsKICAgIHJvb3QgPSBmbihyb290LCBjb250YWluZXIpOwogICAgaSA9IDE7CiAgfSBlbHNlIHsKICAgIHJvb3QgPSBjb250YWluZXIgfHwgcm9vdDsKICB9CiAgZm9yIChsZXQgaWkgPSBwYXJzZWQubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgewogICAgICBuYW1lLAogICAgICBvcGVyYXRvciwKICAgICAgaW5kZXgKICAgIH0gPSBwYXJzZWRbaV07CiAgICBpZiAoIWlzRmluaXRlKGluZGV4KSkgewogICAgICBwYXJzZWRbaV0uaW5kZXggPSAwOwogICAgICByZXR1cm4gcm9vdC5jcmVhdGVOb2RlcyhwYXJzZWQuc2xpY2UoaSkpOwogICAgfQogICAgbGV0IGNoaWxkcmVuOwogICAgc3dpdGNoIChvcGVyYXRvcikgewogICAgICBjYXNlIG9wZXJhdG9ycy5kb3Q6CiAgICAgICAgY2hpbGRyZW4gPSByb290WyRnZXRDaGlsZHJlbkJ5TmFtZV0obmFtZSwgZmFsc2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIG9wZXJhdG9ycy5kb3REb3Q6CiAgICAgICAgY2hpbGRyZW4gPSByb290WyRnZXRDaGlsZHJlbkJ5TmFtZV0obmFtZSwgdHJ1ZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2Ugb3BlcmF0b3JzLmRvdEhhc2g6CiAgICAgICAgY2hpbGRyZW4gPSByb290WyRnZXRDaGlsZHJlbkJ5Q2xhc3NdKG5hbWUpOwogICAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uaXNYRkFPYmplY3RBcnJheSA/IGNoaWxkcmVuLmNoaWxkcmVuIDogW2NoaWxkcmVuXTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBicmVhazsKICAgIH0KICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHJvb3QuY3JlYXRlTm9kZXMocGFyc2VkLnNsaWNlKGkpKTsKICAgIH0KICAgIGlmIChpbmRleCA8IGNoaWxkcmVuLmxlbmd0aCkgewogICAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuW2luZGV4XTsKICAgICAgaWYgKCFjaGlsZC5pc1hGQU9iamVjdCkgewogICAgICAgIHdhcm4oYFhGQSAtIENhbm5vdCBjcmVhdGUgYSBub2RlLmApOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJvb3QgPSBjaGlsZDsKICAgIH0gZWxzZSB7CiAgICAgIHBhcnNlZFtpXS5pbmRleCA9IGluZGV4IC0gY2hpbGRyZW4ubGVuZ3RoOwogICAgICByZXR1cm4gcm9vdC5jcmVhdGVOb2RlcyhwYXJzZWQuc2xpY2UoaSkpOwogICAgfQogIH0KICByZXR1cm4gbnVsbDsKfQoKOy8vIC4vc3JjL2NvcmUveGZhL3hmYV9vYmplY3QuanMKCgoKCgoKY29uc3QgX2FwcGx5UHJvdG90eXBlID0gU3ltYm9sKCk7CmNvbnN0IF9hdHRyaWJ1dGVzID0gU3ltYm9sKCk7CmNvbnN0IF9hdHRyaWJ1dGVOYW1lcyA9IFN5bWJvbCgpOwpjb25zdCBfY2hpbGRyZW4gPSBTeW1ib2woIl9jaGlsZHJlbiIpOwpjb25zdCBfY2xvbmVBdHRyaWJ1dGUgPSBTeW1ib2woKTsKY29uc3QgX2RhdGFWYWx1ZSA9IFN5bWJvbCgpOwpjb25zdCBfZGVmYXVsdFZhbHVlID0gU3ltYm9sKCk7CmNvbnN0IF9maWx0ZXJlZENoaWxkcmVuR2VuZXJhdG9yID0gU3ltYm9sKCk7CmNvbnN0IF9nZXRQcm90b3R5cGUgPSBTeW1ib2woKTsKY29uc3QgX2dldFVuc2V0QXR0cmlidXRlcyA9IFN5bWJvbCgpOwpjb25zdCBfaGFzQ2hpbGRyZW4gPSBTeW1ib2woKTsKY29uc3QgX21heCA9IFN5bWJvbCgpOwpjb25zdCBfb3B0aW9ucyA9IFN5bWJvbCgpOwpjb25zdCBfcGFyZW50ID0gU3ltYm9sKCJwYXJlbnQiKTsKY29uc3QgX3Jlc29sdmVQcm90b3R5cGVzSGVscGVyID0gU3ltYm9sKCk7CmNvbnN0IF9zZXRBdHRyaWJ1dGVzID0gU3ltYm9sKCk7CmNvbnN0IF92YWxpZGF0b3IgPSBTeW1ib2woKTsKbGV0IHVpZCA9IDA7CmNvbnN0IE5TX0RBVEFTRVRTID0gTmFtZXNwYWNlSWRzLmRhdGFzZXRzLmlkOwpjbGFzcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUsIGhhc0NoaWxkcmVuID0gZmFsc2UpIHsKICAgIHRoaXNbJG5hbWVzcGFjZUlkXSA9IG5zSWQ7CiAgICB0aGlzWyRub2RlTmFtZV0gPSBuYW1lOwogICAgdGhpc1tfaGFzQ2hpbGRyZW5dID0gaGFzQ2hpbGRyZW47CiAgICB0aGlzW19wYXJlbnRdID0gbnVsbDsKICAgIHRoaXNbX2NoaWxkcmVuXSA9IFtdOwogICAgdGhpc1skdWlkXSA9IGAke25hbWV9JHt1aWQrK31gOwogICAgdGhpc1skZ2xvYmFsRGF0YV0gPSBudWxsOwogIH0KICBnZXQgaXNYRkFPYmplY3QoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZ2V0IGlzWEZBT2JqZWN0QXJyYXkoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNyZWF0ZU5vZGVzKHBhdGgpIHsKICAgIGxldCByb290ID0gdGhpcywKICAgICAgbm9kZSA9IG51bGw7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgaW5kZXgKICAgIH0gb2YgcGF0aCkgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpc0Zpbml0ZShpbmRleCkgPyBpbmRleCA6IDA7IGkgPD0gaWk7IGkrKykgewogICAgICAgIGNvbnN0IG5zSWQgPSByb290WyRuYW1lc3BhY2VJZF0gPT09IE5TX0RBVEFTRVRTID8gLTEgOiByb290WyRuYW1lc3BhY2VJZF07CiAgICAgICAgbm9kZSA9IG5ldyBYbWxPYmplY3QobnNJZCwgbmFtZSk7CiAgICAgICAgcm9vdFskYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICB9CiAgICAgIHJvb3QgPSBub2RlOwogICAgfQogICAgcmV0dXJuIG5vZGU7CiAgfQogIFskb25DaGlsZF0oY2hpbGQpIHsKICAgIGlmICghdGhpc1tfaGFzQ2hpbGRyZW5dIHx8ICF0aGlzWyRvbkNoaWxkQ2hlY2tdKGNoaWxkKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBuYW1lID0gY2hpbGRbJG5vZGVOYW1lXTsKICAgIGNvbnN0IG5vZGUgPSB0aGlzW25hbWVdOwogICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSkgewogICAgICBpZiAobm9kZS5wdXNoKGNoaWxkKSkgewogICAgICAgIHRoaXNbJGFwcGVuZENoaWxkXShjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChub2RlICE9PSBudWxsKSB7CiAgICAgICAgdGhpc1skcmVtb3ZlQ2hpbGRdKG5vZGUpOwogICAgICB9CiAgICAgIHRoaXNbbmFtZV0gPSBjaGlsZDsKICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKGNoaWxkKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBsZXQgaWQgPSAiIjsKICAgIGlmICh0aGlzLmlkKSB7CiAgICAgIGlkID0gYCAoaWQ6ICR7dGhpcy5pZH0pYDsKICAgIH0gZWxzZSBpZiAodGhpcy5uYW1lKSB7CiAgICAgIGlkID0gYCAobmFtZTogJHt0aGlzLm5hbWV9ICR7dGhpcy5oLnZhbHVlfSlgOwogICAgfQogICAgd2FybihgWEZBIC0gbm9kZSAiJHt0aGlzWyRub2RlTmFtZV19IiR7aWR9IGhhcyBhbHJlYWR5IGVub3VnaCAiJHtuYW1lfSIhYCk7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskb25DaGlsZENoZWNrXShjaGlsZCkgewogICAgcmV0dXJuIHRoaXMuaGFzT3duUHJvcGVydHkoY2hpbGRbJG5vZGVOYW1lXSkgJiYgY2hpbGRbJG5hbWVzcGFjZUlkXSA9PT0gdGhpc1skbmFtZXNwYWNlSWRdOwogIH0KICBbJGlzTnNBZ25vc3RpY10oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskYWNjZXB0V2hpdGVzcGFjZV0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskaXNDREFUQVhtbF0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskaXNCaW5kYWJsZV0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskcG9wUGFyYV0oKSB7CiAgICBpZiAodGhpcy5wYXJhKSB7CiAgICAgIHRoaXNbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLnBhcmFTdGFjay5wb3AoKTsKICAgIH0KICB9CiAgWyRwdXNoUGFyYV0oKSB7CiAgICB0aGlzWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5wYXJhU3RhY2sucHVzaCh0aGlzLnBhcmEpOwogIH0KICBbJHNldElkXShpZHMpIHsKICAgIGlmICh0aGlzLmlkICYmIHRoaXNbJG5hbWVzcGFjZUlkXSA9PT0gTmFtZXNwYWNlSWRzLnRlbXBsYXRlLmlkKSB7CiAgICAgIGlkcy5zZXQodGhpcy5pZCwgdGhpcyk7CiAgICB9CiAgfQogIFskZ2V0VGVtcGxhdGVSb290XSgpIHsKICAgIHJldHVybiB0aGlzWyRnbG9iYWxEYXRhXS50ZW1wbGF0ZTsKICB9CiAgWyRpc1NwbGl0dGFibGVdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJGlzVGhlcmVNb3JlV2lkdGhdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJGFwcGVuZENoaWxkXShjaGlsZCkgewogICAgY2hpbGRbX3BhcmVudF0gPSB0aGlzOwogICAgdGhpc1tfY2hpbGRyZW5dLnB1c2goY2hpbGQpOwogICAgaWYgKCFjaGlsZFskZ2xvYmFsRGF0YV0gJiYgdGhpc1skZ2xvYmFsRGF0YV0pIHsKICAgICAgY2hpbGRbJGdsb2JhbERhdGFdID0gdGhpc1skZ2xvYmFsRGF0YV07CiAgICB9CiAgfQogIFskcmVtb3ZlQ2hpbGRdKGNoaWxkKSB7CiAgICBjb25zdCBpID0gdGhpc1tfY2hpbGRyZW5dLmluZGV4T2YoY2hpbGQpOwogICAgdGhpc1tfY2hpbGRyZW5dLnNwbGljZShpLCAxKTsKICB9CiAgWyRoYXNTZXR0YWJsZVZhbHVlXSgpIHsKICAgIHJldHVybiB0aGlzLmhhc093blByb3BlcnR5KCJ2YWx1ZSIpOwogIH0KICBbJHNldFZhbHVlXShfKSB7fQogIFskb25UZXh0XShfKSB7fQogIFskZmluYWxpemVdKCkge30KICBbJGNsZWFuXShidWlsZGVyKSB7CiAgICBkZWxldGUgdGhpc1tfaGFzQ2hpbGRyZW5dOwogICAgaWYgKHRoaXNbJGNsZWFudXBdKSB7CiAgICAgIGJ1aWxkZXIuY2xlYW4odGhpc1skY2xlYW51cF0pOwogICAgICBkZWxldGUgdGhpc1skY2xlYW51cF07CiAgICB9CiAgfQogIFskaW5kZXhPZl0oY2hpbGQpIHsKICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0uaW5kZXhPZihjaGlsZCk7CiAgfQogIFskaW5zZXJ0QXRdKGksIGNoaWxkKSB7CiAgICBjaGlsZFtfcGFyZW50XSA9IHRoaXM7CiAgICB0aGlzW19jaGlsZHJlbl0uc3BsaWNlKGksIDAsIGNoaWxkKTsKICAgIGlmICghY2hpbGRbJGdsb2JhbERhdGFdICYmIHRoaXNbJGdsb2JhbERhdGFdKSB7CiAgICAgIGNoaWxkWyRnbG9iYWxEYXRhXSA9IHRoaXNbJGdsb2JhbERhdGFdOwogICAgfQogIH0KICBbJGlzVHJhbnNwYXJlbnRdKCkgewogICAgcmV0dXJuICF0aGlzLm5hbWU7CiAgfQogIFskbGFzdEF0dHJpYnV0ZV0oKSB7CiAgICByZXR1cm4gIiI7CiAgfQogIFskdGV4dF0oKSB7CiAgICBpZiAodGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gdGhpc1skY29udGVudF07CiAgICB9CiAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dLm1hcChjID0+IGNbJHRleHRdKCkpLmpvaW4oIiIpOwogIH0KICBnZXQgW19hdHRyaWJ1dGVOYW1lc10oKSB7CiAgICBjb25zdCBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKTsKICAgIGlmICghcHJvdG8uX2F0dHJpYnV0ZXMpIHsKICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHByb3RvLl9hdHRyaWJ1dGVzID0gbmV3IFNldCgpOwogICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgICBpZiAodGhpc1tuYW1lXSA9PT0gbnVsbCB8fCB0aGlzW25hbWVdIGluc3RhbmNlb2YgWEZBT2JqZWN0IHx8IHRoaXNbbmFtZV0gaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGF0dHJpYnV0ZXMuYWRkKG5hbWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsIF9hdHRyaWJ1dGVOYW1lcywgcHJvdG8uX2F0dHJpYnV0ZXMpOwogIH0KICBbJGlzRGVzY2VuZGVudF0ocGFyZW50KSB7CiAgICBsZXQgbm9kZSA9IHRoaXM7CiAgICB3aGlsZSAobm9kZSkgewogICAgICBpZiAobm9kZSA9PT0gcGFyZW50KSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgbm9kZSA9IG5vZGVbJGdldFBhcmVudF0oKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRnZXRQYXJlbnRdKCkgewogICAgcmV0dXJuIHRoaXNbX3BhcmVudF07CiAgfQogIFskZ2V0U3ViZm9ybVBhcmVudF0oKSB7CiAgICByZXR1cm4gdGhpc1skZ2V0UGFyZW50XSgpOwogIH0KICBbJGdldENoaWxkcmVuXShuYW1lID0gbnVsbCkgewogICAgaWYgKCFuYW1lKSB7CiAgICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl07CiAgICB9CiAgICByZXR1cm4gdGhpc1tuYW1lXTsKICB9CiAgWyRkdW1wXSgpIHsKICAgIGNvbnN0IGR1bXBlZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAodGhpc1skY29udGVudF0pIHsKICAgICAgZHVtcGVkLiRjb250ZW50ID0gdGhpc1skY29udGVudF07CiAgICB9CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgY29uc3QgdmFsdWUgPSB0aGlzW25hbWVdOwogICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgICBkdW1wZWRbbmFtZV0gPSB2YWx1ZVskZHVtcF0oKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFhGQU9iamVjdEFycmF5KSB7CiAgICAgICAgaWYgKCF2YWx1ZS5pc0VtcHR5KCkpIHsKICAgICAgICAgIGR1bXBlZFtuYW1lXSA9IHZhbHVlLmR1bXAoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZHVtcGVkW25hbWVdID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkdW1wZWQ7CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgWyR0b0hUTUxdKCkgewogICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgfQogICpbJGdldENvbnRhaW5lZENoaWxkcmVuXSgpIHsKICAgIGZvciAoY29uc3Qgbm9kZSBvZiB0aGlzWyRnZXRDaGlsZHJlbl0oKSkgewogICAgICB5aWVsZCBub2RlOwogICAgfQogIH0KICAqW19maWx0ZXJlZENoaWxkcmVuR2VuZXJhdG9yXShmaWx0ZXIsIGluY2x1ZGUpIHsKICAgIGZvciAoY29uc3Qgbm9kZSBvZiB0aGlzWyRnZXRDb250YWluZWRDaGlsZHJlbl0oKSkgewogICAgICBpZiAoIWZpbHRlciB8fCBpbmNsdWRlID09PSBmaWx0ZXIuaGFzKG5vZGVbJG5vZGVOYW1lXSkpIHsKICAgICAgICBjb25zdCBhdmFpbGFibGVTcGFjZSA9IHRoaXNbJGdldEF2YWlsYWJsZVNwYWNlXSgpOwogICAgICAgIGNvbnN0IHJlcyA9IG5vZGVbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogICAgICAgIGlmICghcmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgIHRoaXNbJGV4dHJhXS5mYWlsaW5nTm9kZSA9IG5vZGU7CiAgICAgICAgfQogICAgICAgIHlpZWxkIHJlczsKICAgICAgfQogICAgfQogIH0KICBbJGZsdXNoSFRNTF0oKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgWyRhZGRIVE1MXShodG1sLCBiYm94KSB7CiAgICB0aGlzWyRleHRyYV0uY2hpbGRyZW4ucHVzaChodG1sKTsKICB9CiAgWyRnZXRBdmFpbGFibGVTcGFjZV0oKSB7fQogIFskY2hpbGRyZW5Ub0hUTUxdKHsKICAgIGZpbHRlciA9IG51bGwsCiAgICBpbmNsdWRlID0gdHJ1ZQogIH0pIHsKICAgIGlmICghdGhpc1skZXh0cmFdLmdlbmVyYXRvcikgewogICAgICB0aGlzWyRleHRyYV0uZ2VuZXJhdG9yID0gdGhpc1tfZmlsdGVyZWRDaGlsZHJlbkdlbmVyYXRvcl0oZmlsdGVyLCBpbmNsdWRlKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGF2YWlsYWJsZVNwYWNlID0gdGhpc1skZ2V0QXZhaWxhYmxlU3BhY2VdKCk7CiAgICAgIGNvbnN0IHJlcyA9IHRoaXNbJGV4dHJhXS5mYWlsaW5nTm9kZVskdG9IVE1MXShhdmFpbGFibGVTcGFjZSk7CiAgICAgIGlmICghcmVzLnN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gcmVzOwogICAgICB9CiAgICAgIGlmIChyZXMuaHRtbCkgewogICAgICAgIHRoaXNbJGFkZEhUTUxdKHJlcy5odG1sLCByZXMuYmJveCk7CiAgICAgIH0KICAgICAgZGVsZXRlIHRoaXNbJGV4dHJhXS5mYWlsaW5nTm9kZTsKICAgIH0KICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IGdlbiA9IHRoaXNbJGV4dHJhXS5nZW5lcmF0b3IubmV4dCgpOwogICAgICBpZiAoZ2VuLmRvbmUpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjb25zdCByZXMgPSBnZW4udmFsdWU7CiAgICAgIGlmICghcmVzLnN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gcmVzOwogICAgICB9CiAgICAgIGlmIChyZXMuaHRtbCkgewogICAgICAgIHRoaXNbJGFkZEhUTUxdKHJlcy5odG1sLCByZXMuYmJveCk7CiAgICAgIH0KICAgIH0KICAgIHRoaXNbJGV4dHJhXS5nZW5lcmF0b3IgPSBudWxsOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgfQogIFskc2V0U2V0QXR0cmlidXRlc10oYXR0cmlidXRlcykgewogICAgdGhpc1tfc2V0QXR0cmlidXRlc10gPSBuZXcgU2V0KE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpKTsKICB9CiAgW19nZXRVbnNldEF0dHJpYnV0ZXNdKHByb3RvQXR0cmlidXRlcykgewogICAgY29uc3QgYWxsQXR0ciA9IHRoaXNbX2F0dHJpYnV0ZU5hbWVzXTsKICAgIGNvbnN0IHNldEF0dHIgPSB0aGlzW19zZXRBdHRyaWJ1dGVzXTsKICAgIHJldHVybiBbLi4ucHJvdG9BdHRyaWJ1dGVzXS5maWx0ZXIoeCA9PiBhbGxBdHRyLmhhcyh4KSAmJiAhc2V0QXR0ci5oYXMoeCkpOwogIH0KICBbJHJlc29sdmVQcm90b3R5cGVzXShpZHMsIGFuY2VzdG9ycyA9IG5ldyBTZXQoKSkgewogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgY2hpbGRbX3Jlc29sdmVQcm90b3R5cGVzSGVscGVyXShpZHMsIGFuY2VzdG9ycyk7CiAgICB9CiAgfQogIFtfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXJdKGlkcywgYW5jZXN0b3JzKSB7CiAgICBjb25zdCBwcm90byA9IHRoaXNbX2dldFByb3RvdHlwZV0oaWRzLCBhbmNlc3RvcnMpOwogICAgaWYgKHByb3RvKSB7CiAgICAgIHRoaXNbX2FwcGx5UHJvdG90eXBlXShwcm90bywgaWRzLCBhbmNlc3RvcnMpOwogICAgfSBlbHNlIHsKICAgICAgdGhpc1skcmVzb2x2ZVByb3RvdHlwZXNdKGlkcywgYW5jZXN0b3JzKTsKICAgIH0KICB9CiAgW19nZXRQcm90b3R5cGVdKGlkcywgYW5jZXN0b3JzKSB7CiAgICBjb25zdCB7CiAgICAgIHVzZSwKICAgICAgdXNlaHJlZgogICAgfSA9IHRoaXM7CiAgICBpZiAoIXVzZSAmJiAhdXNlaHJlZikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBwcm90byA9IG51bGw7CiAgICBsZXQgc29tRXhwcmVzc2lvbiA9IG51bGw7CiAgICBsZXQgaWQgPSBudWxsOwogICAgbGV0IHJlZiA9IHVzZTsKICAgIGlmICh1c2VocmVmKSB7CiAgICAgIHJlZiA9IHVzZWhyZWY7CiAgICAgIGlmICh1c2VocmVmLnN0YXJ0c1dpdGgoIiNzb20oIikgJiYgdXNlaHJlZi5lbmRzV2l0aCgiKSIpKSB7CiAgICAgICAgc29tRXhwcmVzc2lvbiA9IHVzZWhyZWYuc2xpY2UoIiNzb20oIi5sZW5ndGgsIC0xKTsKICAgICAgfSBlbHNlIGlmICh1c2VocmVmLnN0YXJ0c1dpdGgoIi4jc29tKCIpICYmIHVzZWhyZWYuZW5kc1dpdGgoIikiKSkgewogICAgICAgIHNvbUV4cHJlc3Npb24gPSB1c2VocmVmLnNsaWNlKCIuI3NvbSgiLmxlbmd0aCwgLTEpOwogICAgICB9IGVsc2UgaWYgKHVzZWhyZWYuc3RhcnRzV2l0aCgiIyIpKSB7CiAgICAgICAgaWQgPSB1c2VocmVmLnNsaWNlKDEpOwogICAgICB9IGVsc2UgaWYgKHVzZWhyZWYuc3RhcnRzV2l0aCgiLiMiKSkgewogICAgICAgIGlkID0gdXNlaHJlZi5zbGljZSgyKTsKICAgICAgfQogICAgfSBlbHNlIGlmICh1c2Uuc3RhcnRzV2l0aCgiIyIpKSB7CiAgICAgIGlkID0gdXNlLnNsaWNlKDEpOwogICAgfSBlbHNlIHsKICAgICAgc29tRXhwcmVzc2lvbiA9IHVzZTsKICAgIH0KICAgIHRoaXMudXNlID0gdGhpcy51c2VocmVmID0gIiI7CiAgICBpZiAoaWQpIHsKICAgICAgcHJvdG8gPSBpZHMuZ2V0KGlkKTsKICAgIH0gZWxzZSB7CiAgICAgIHByb3RvID0gc2VhcmNoTm9kZShpZHMuZ2V0KCRyb290KSwgdGhpcywgc29tRXhwcmVzc2lvbiwgdHJ1ZSwgZmFsc2UpOwogICAgICBpZiAocHJvdG8pIHsKICAgICAgICBwcm90byA9IHByb3RvWzBdOwogICAgICB9CiAgICB9CiAgICBpZiAoIXByb3RvKSB7CiAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgcHJvdG90eXBlIHJlZmVyZW5jZTogJHtyZWZ9LmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChwcm90b1skbm9kZU5hbWVdICE9PSB0aGlzWyRub2RlTmFtZV0pIHsKICAgICAgd2FybihgWEZBIC0gSW5jb21wYXRpYmxlIHByb3RvdHlwZTogJHtwcm90b1skbm9kZU5hbWVdfSAhPT0gJHt0aGlzWyRub2RlTmFtZV19LmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChhbmNlc3RvcnMuaGFzKHByb3RvKSkgewogICAgICB3YXJuKGBYRkEgLSBDeWNsZSBkZXRlY3RlZCBpbiBwcm90b3R5cGVzIHVzZS5gKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBhbmNlc3RvcnMuYWRkKHByb3RvKTsKICAgIGNvbnN0IHByb3RvUHJvdG8gPSBwcm90b1tfZ2V0UHJvdG90eXBlXShpZHMsIGFuY2VzdG9ycyk7CiAgICBpZiAocHJvdG9Qcm90bykgewogICAgICBwcm90b1tfYXBwbHlQcm90b3R5cGVdKHByb3RvUHJvdG8sIGlkcywgYW5jZXN0b3JzKTsKICAgIH0KICAgIHByb3RvWyRyZXNvbHZlUHJvdG90eXBlc10oaWRzLCBhbmNlc3RvcnMpOwogICAgYW5jZXN0b3JzLmRlbGV0ZShwcm90byk7CiAgICByZXR1cm4gcHJvdG87CiAgfQogIFtfYXBwbHlQcm90b3R5cGVdKHByb3RvLCBpZHMsIGFuY2VzdG9ycykgewogICAgaWYgKGFuY2VzdG9ycy5oYXMocHJvdG8pKSB7CiAgICAgIHdhcm4oYFhGQSAtIEN5Y2xlIGRldGVjdGVkIGluIHByb3RvdHlwZXMgdXNlLmApOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXNbJGNvbnRlbnRdICYmIHByb3RvWyRjb250ZW50XSkgewogICAgICB0aGlzWyRjb250ZW50XSA9IHByb3RvWyRjb250ZW50XTsKICAgIH0KICAgIGNvbnN0IG5ld0FuY2VzdG9ycyA9IG5ldyBTZXQoYW5jZXN0b3JzKTsKICAgIG5ld0FuY2VzdG9ycy5hZGQocHJvdG8pOwogICAgZm9yIChjb25zdCB1bnNldEF0dHJOYW1lIG9mIHRoaXNbX2dldFVuc2V0QXR0cmlidXRlc10ocHJvdG9bX3NldEF0dHJpYnV0ZXNdKSkgewogICAgICB0aGlzW3Vuc2V0QXR0ck5hbWVdID0gcHJvdG9bdW5zZXRBdHRyTmFtZV07CiAgICAgIGlmICh0aGlzW19zZXRBdHRyaWJ1dGVzXSkgewogICAgICAgIHRoaXNbX3NldEF0dHJpYnV0ZXNdLmFkZCh1bnNldEF0dHJOYW1lKTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGlmICh0aGlzW19hdHRyaWJ1dGVOYW1lc10uaGFzKG5hbWUpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdmFsdWUgPSB0aGlzW25hbWVdOwogICAgICBjb25zdCBwcm90b1ZhbHVlID0gcHJvdG9bbmFtZV07CiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFhGQU9iamVjdEFycmF5KSB7CiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB2YWx1ZVtfY2hpbGRyZW5dKSB7CiAgICAgICAgICBjaGlsZFtfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXJdKGlkcywgYW5jZXN0b3JzKTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaSA9IHZhbHVlW19jaGlsZHJlbl0ubGVuZ3RoLCBpaSA9IHByb3RvVmFsdWVbX2NoaWxkcmVuXS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjaGlsZCA9IHByb3RvW19jaGlsZHJlbl1baV1bJGNsb25lXSgpOwogICAgICAgICAgaWYgKHZhbHVlLnB1c2goY2hpbGQpKSB7CiAgICAgICAgICAgIGNoaWxkW19wYXJlbnRdID0gdGhpczsKICAgICAgICAgICAgdGhpc1tfY2hpbGRyZW5dLnB1c2goY2hpbGQpOwogICAgICAgICAgICBjaGlsZFtfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXJdKGlkcywgYW5jZXN0b3JzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodmFsdWUgIT09IG51bGwpIHsKICAgICAgICB2YWx1ZVskcmVzb2x2ZVByb3RvdHlwZXNdKGlkcywgYW5jZXN0b3JzKTsKICAgICAgICBpZiAocHJvdG9WYWx1ZSkgewogICAgICAgICAgdmFsdWVbX2FwcGx5UHJvdG90eXBlXShwcm90b1ZhbHVlLCBpZHMsIGFuY2VzdG9ycyk7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChwcm90b1ZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBwcm90b1ZhbHVlWyRjbG9uZV0oKTsKICAgICAgICBjaGlsZFtfcGFyZW50XSA9IHRoaXM7CiAgICAgICAgdGhpc1tuYW1lXSA9IGNoaWxkOwogICAgICAgIHRoaXNbX2NoaWxkcmVuXS5wdXNoKGNoaWxkKTsKICAgICAgICBjaGlsZFtfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXJdKGlkcywgYW5jZXN0b3JzKTsKICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgW19jbG9uZUF0dHJpYnV0ZV0ob2JqKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7CiAgICAgIHJldHVybiBvYmoubWFwKHggPT4gWEZBT2JqZWN0W19jbG9uZUF0dHJpYnV0ZV0oeCkpOwogICAgfQogICAgaWYgKHR5cGVvZiBvYmogPT09ICJvYmplY3QiICYmIG9iaiAhPT0gbnVsbCkgewogICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgb2JqKTsKICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQogIFskY2xvbmVdKCkgewogICAgY29uc3QgY2xvbmUgPSBPYmplY3QuY3JlYXRlKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSk7CiAgICBmb3IgKGNvbnN0ICRzeW1ib2wgb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh0aGlzKSkgewogICAgICB0cnkgewogICAgICAgIGNsb25lWyRzeW1ib2xdID0gdGhpc1skc3ltYm9sXTsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgc2hhZG93KGNsb25lLCAkc3ltYm9sLCB0aGlzWyRzeW1ib2xdKTsKICAgICAgfQogICAgfQogICAgY2xvbmVbJHVpZF0gPSBgJHtjbG9uZVskbm9kZU5hbWVdfSR7dWlkKyt9YDsKICAgIGNsb25lW19jaGlsZHJlbl0gPSBbXTsKICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBpZiAodGhpc1tfYXR0cmlidXRlTmFtZXNdLmhhcyhuYW1lKSkgewogICAgICAgIGNsb25lW25hbWVdID0gWEZBT2JqZWN0W19jbG9uZUF0dHJpYnV0ZV0odGhpc1tuYW1lXSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdmFsdWUgPSB0aGlzW25hbWVdOwogICAgICBjbG9uZVtuYW1lXSA9IHZhbHVlIGluc3RhbmNlb2YgWEZBT2JqZWN0QXJyYXkgPyBuZXcgWEZBT2JqZWN0QXJyYXkodmFsdWVbX21heF0pIDogbnVsbDsKICAgIH0KICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIGNvbnN0IG5hbWUgPSBjaGlsZFskbm9kZU5hbWVdOwogICAgICBjb25zdCBjbG9uZWRDaGlsZCA9IGNoaWxkWyRjbG9uZV0oKTsKICAgICAgY2xvbmVbX2NoaWxkcmVuXS5wdXNoKGNsb25lZENoaWxkKTsKICAgICAgY2xvbmVkQ2hpbGRbX3BhcmVudF0gPSBjbG9uZTsKICAgICAgaWYgKGNsb25lW25hbWVdID09PSBudWxsKSB7CiAgICAgICAgY2xvbmVbbmFtZV0gPSBjbG9uZWRDaGlsZDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjbG9uZVtuYW1lXVtfY2hpbGRyZW5dLnB1c2goY2xvbmVkQ2hpbGQpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gY2xvbmU7CiAgfQogIFskZ2V0Q2hpbGRyZW5dKG5hbWUgPSBudWxsKSB7CiAgICBpZiAoIW5hbWUpIHsKICAgICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXTsKICAgIH0KICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0uZmlsdGVyKGMgPT4gY1skbm9kZU5hbWVdID09PSBuYW1lKTsKICB9CiAgWyRnZXRDaGlsZHJlbkJ5Q2xhc3NdKG5hbWUpIHsKICAgIHJldHVybiB0aGlzW25hbWVdOwogIH0KICBbJGdldENoaWxkcmVuQnlOYW1lXShuYW1lLCBhbGxUcmFuc3BhcmVudCwgZmlyc3QgPSB0cnVlKSB7CiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzWyRnZXRDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBhbGxUcmFuc3BhcmVudCwgZmlyc3QpKTsKICB9CiAgKlskZ2V0Q2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIGZpcnN0ID0gdHJ1ZSkgewogICAgaWYgKG5hbWUgPT09ICJwYXJlbnQiKSB7CiAgICAgIHlpZWxkIHRoaXNbX3BhcmVudF07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIGlmIChjaGlsZFskbm9kZU5hbWVdID09PSBuYW1lKSB7CiAgICAgICAgeWllbGQgY2hpbGQ7CiAgICAgIH0KICAgICAgaWYgKGNoaWxkLm5hbWUgPT09IG5hbWUpIHsKICAgICAgICB5aWVsZCBjaGlsZDsKICAgICAgfQogICAgICBpZiAoYWxsVHJhbnNwYXJlbnQgfHwgY2hpbGRbJGlzVHJhbnNwYXJlbnRdKCkpIHsKICAgICAgICB5aWVsZCogY2hpbGRbJGdldENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGFsbFRyYW5zcGFyZW50LCBmYWxzZSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChmaXJzdCAmJiB0aGlzW19hdHRyaWJ1dGVOYW1lc10uaGFzKG5hbWUpKSB7CiAgICAgIHlpZWxkIG5ldyBYRkFBdHRyaWJ1dGUodGhpcywgbmFtZSwgdGhpc1tuYW1lXSk7CiAgICB9CiAgfQp9CmNsYXNzIFhGQU9iamVjdEFycmF5IHsKICBjb25zdHJ1Y3RvcihtYXggPSBJbmZpbml0eSkgewogICAgdGhpc1tfbWF4XSA9IG1heDsKICAgIHRoaXNbX2NoaWxkcmVuXSA9IFtdOwogIH0KICBnZXQgaXNYRkFPYmplY3QoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGdldCBpc1hGQU9iamVjdEFycmF5KCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIHB1c2goY2hpbGQpIHsKICAgIGNvbnN0IGxlbiA9IHRoaXNbX2NoaWxkcmVuXS5sZW5ndGg7CiAgICBpZiAobGVuIDw9IHRoaXNbX21heF0pIHsKICAgICAgdGhpc1tfY2hpbGRyZW5dLnB1c2goY2hpbGQpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHdhcm4oYFhGQSAtIG5vZGUgIiR7Y2hpbGRbJG5vZGVOYW1lXX0iIGFjY2VwdHMgbm8gbW9yZSB0aGFuICR7dGhpc1tfbWF4XX0gY2hpbGRyZW5gKTsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgaXNFbXB0eSgpIHsKICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAwOwogIH0KICBkdW1wKCkgewogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPT09IDEgPyB0aGlzW19jaGlsZHJlbl1bMF1bJGR1bXBdKCkgOiB0aGlzW19jaGlsZHJlbl0ubWFwKHggPT4geFskZHVtcF0oKSk7CiAgfQogIFskY2xvbmVdKCkgewogICAgY29uc3QgY2xvbmUgPSBuZXcgWEZBT2JqZWN0QXJyYXkodGhpc1tfbWF4XSk7CiAgICBjbG9uZVtfY2hpbGRyZW5dID0gdGhpc1tfY2hpbGRyZW5dLm1hcChjID0+IGNbJGNsb25lXSgpKTsKICAgIHJldHVybiBjbG9uZTsKICB9CiAgZ2V0IGNoaWxkcmVuKCkgewogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXTsKICB9CiAgY2xlYXIoKSB7CiAgICB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID0gMDsKICB9Cn0KY2xhc3MgWEZBQXR0cmlidXRlIHsKICBjb25zdHJ1Y3Rvcihub2RlLCBuYW1lLCB2YWx1ZSkgewogICAgdGhpc1tfcGFyZW50XSA9IG5vZGU7CiAgICB0aGlzWyRub2RlTmFtZV0gPSBuYW1lOwogICAgdGhpc1skY29udGVudF0gPSB2YWx1ZTsKICAgIHRoaXNbJGNvbnN1bWVkXSA9IGZhbHNlOwogICAgdGhpc1skdWlkXSA9IGBhdHRyaWJ1dGUke3VpZCsrfWA7CiAgfQogIFskZ2V0UGFyZW50XSgpIHsKICAgIHJldHVybiB0aGlzW19wYXJlbnRdOwogIH0KICBbJGlzRGF0YVZhbHVlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJGdldERhdGFWYWx1ZV0oKSB7CiAgICByZXR1cm4gdGhpc1skY29udGVudF0udHJpbSgpOwogIH0KICBbJHNldFZhbHVlXSh2YWx1ZSkgewogICAgdmFsdWUgPSB2YWx1ZS52YWx1ZSB8fCAiIjsKICAgIHRoaXNbJGNvbnRlbnRdID0gdmFsdWUudG9TdHJpbmcoKTsKICB9CiAgWyR0ZXh0XSgpIHsKICAgIHJldHVybiB0aGlzWyRjb250ZW50XTsKICB9CiAgWyRpc0Rlc2NlbmRlbnRdKHBhcmVudCkgewogICAgcmV0dXJuIHRoaXNbX3BhcmVudF0gPT09IHBhcmVudCB8fCB0aGlzW19wYXJlbnRdWyRpc0Rlc2NlbmRlbnRdKHBhcmVudCk7CiAgfQp9CmNsYXNzIFhtbE9iamVjdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IobnNJZCwgbmFtZSwgYXR0cmlidXRlcyA9IHt9KSB7CiAgICBzdXBlcihuc0lkLCBuYW1lKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gIiI7CiAgICB0aGlzW19kYXRhVmFsdWVdID0gbnVsbDsKICAgIGlmIChuYW1lICE9PSAiI3RleHQiKSB7CiAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgICAgdGhpc1tfYXR0cmlidXRlc10gPSBtYXA7CiAgICAgIGZvciAoY29uc3QgW2F0dHJOYW1lLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoYXR0cmlidXRlcykpIHsKICAgICAgICBtYXAuc2V0KGF0dHJOYW1lLCBuZXcgWEZBQXR0cmlidXRlKHRoaXMsIGF0dHJOYW1lLCB2YWx1ZSkpOwogICAgICB9CiAgICAgIGlmIChhdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KCRuc0F0dHJpYnV0ZXMpKSB7CiAgICAgICAgY29uc3QgZGF0YU5vZGUgPSBhdHRyaWJ1dGVzWyRuc0F0dHJpYnV0ZXNdLnhmYS5kYXRhTm9kZTsKICAgICAgICBpZiAoZGF0YU5vZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKGRhdGFOb2RlID09PSAiZGF0YUdyb3VwIikgewogICAgICAgICAgICB0aGlzW19kYXRhVmFsdWVdID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFOb2RlID09PSAiZGF0YVZhbHVlIikgewogICAgICAgICAgICB0aGlzW19kYXRhVmFsdWVdID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXNbJGNvbnN1bWVkXSA9IGZhbHNlOwogIH0KICBbJHRvU3RyaW5nXShidWYpIHsKICAgIGNvbnN0IHRhZ05hbWUgPSB0aGlzWyRub2RlTmFtZV07CiAgICBpZiAodGFnTmFtZSA9PT0gIiN0ZXh0IikgewogICAgICBidWYucHVzaChlbmNvZGVUb1htbFN0cmluZyh0aGlzWyRjb250ZW50XSkpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB1dGY4VGFnTmFtZSA9IHV0ZjhTdHJpbmdUb1N0cmluZyh0YWdOYW1lKTsKICAgIGNvbnN0IHByZWZpeCA9IHRoaXNbJG5hbWVzcGFjZUlkXSA9PT0gTlNfREFUQVNFVFMgPyAieGZhOiIgOiAiIjsKICAgIGJ1Zi5wdXNoKGA8JHtwcmVmaXh9JHt1dGY4VGFnTmFtZX1gKTsKICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiB0aGlzW19hdHRyaWJ1dGVzXS5lbnRyaWVzKCkpIHsKICAgICAgY29uc3QgdXRmOE5hbWUgPSB1dGY4U3RyaW5nVG9TdHJpbmcobmFtZSk7CiAgICAgIGJ1Zi5wdXNoKGAgJHt1dGY4TmFtZX09IiR7ZW5jb2RlVG9YbWxTdHJpbmcodmFsdWVbJGNvbnRlbnRdKX0iYCk7CiAgICB9CiAgICBpZiAodGhpc1tfZGF0YVZhbHVlXSAhPT0gbnVsbCkgewogICAgICBpZiAodGhpc1tfZGF0YVZhbHVlXSkgewogICAgICAgIGJ1Zi5wdXNoKGAgeGZhOmRhdGFOb2RlPSJkYXRhVmFsdWUiYCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnVmLnB1c2goYCB4ZmE6ZGF0YU5vZGU9ImRhdGFHcm91cCJgKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzWyRjb250ZW50XSAmJiB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAwKSB7CiAgICAgIGJ1Zi5wdXNoKCIvPiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBidWYucHVzaCgiPiIpOwogICAgaWYgKHRoaXNbJGNvbnRlbnRdKSB7CiAgICAgIGlmICh0eXBlb2YgdGhpc1skY29udGVudF0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgYnVmLnB1c2goZW5jb2RlVG9YbWxTdHJpbmcodGhpc1skY29udGVudF0pKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzWyRjb250ZW50XVskdG9TdHJpbmddKGJ1Zik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgICAgY2hpbGRbJHRvU3RyaW5nXShidWYpOwogICAgICB9CiAgICB9CiAgICBidWYucHVzaChgPC8ke3ByZWZpeH0ke3V0ZjhUYWdOYW1lfT5gKTsKICB9CiAgWyRvbkNoaWxkXShjaGlsZCkgewogICAgaWYgKHRoaXNbJGNvbnRlbnRdKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBuZXcgWG1sT2JqZWN0KHRoaXNbJG5hbWVzcGFjZUlkXSwgIiN0ZXh0Iik7CiAgICAgIHRoaXNbJGFwcGVuZENoaWxkXShub2RlKTsKICAgICAgbm9kZVskY29udGVudF0gPSB0aGlzWyRjb250ZW50XTsKICAgICAgdGhpc1skY29udGVudF0gPSAiIjsKICAgIH0KICAgIHRoaXNbJGFwcGVuZENoaWxkXShjaGlsZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRvblRleHRdKHN0cikgewogICAgdGhpc1skY29udGVudF0gKz0gc3RyOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGlmICh0aGlzWyRjb250ZW50XSAmJiB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBub2RlID0gbmV3IFhtbE9iamVjdCh0aGlzWyRuYW1lc3BhY2VJZF0sICIjdGV4dCIpOwogICAgICB0aGlzWyRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgIG5vZGVbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF07CiAgICAgIGRlbGV0ZSB0aGlzWyRjb250ZW50XTsKICAgIH0KICB9CiAgWyR0b0hUTUxdKCkgewogICAgaWYgKHRoaXNbJG5vZGVOYW1lXSA9PT0gIiN0ZXh0IikgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiI3RleHQiLAogICAgICAgIHZhbHVlOiB0aGlzWyRjb250ZW50XQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogIH0KICBbJGdldENoaWxkcmVuXShuYW1lID0gbnVsbCkgewogICAgaWYgKCFuYW1lKSB7CiAgICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl07CiAgICB9CiAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dLmZpbHRlcihjID0+IGNbJG5vZGVOYW1lXSA9PT0gbmFtZSk7CiAgfQogIFskZ2V0QXR0cmlidXRlc10oKSB7CiAgICByZXR1cm4gdGhpc1tfYXR0cmlidXRlc107CiAgfQogIFskZ2V0Q2hpbGRyZW5CeUNsYXNzXShuYW1lKSB7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXNbX2F0dHJpYnV0ZXNdLmdldChuYW1lKTsKICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHJldHVybiB0aGlzWyRnZXRDaGlsZHJlbl0obmFtZSk7CiAgfQogICpbJGdldENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGFsbFRyYW5zcGFyZW50KSB7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXNbX2F0dHJpYnV0ZXNdLmdldChuYW1lKTsKICAgIGlmICh2YWx1ZSkgewogICAgICB5aWVsZCB2YWx1ZTsKICAgIH0KICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIGlmIChjaGlsZFskbm9kZU5hbWVdID09PSBuYW1lKSB7CiAgICAgICAgeWllbGQgY2hpbGQ7CiAgICAgIH0KICAgICAgaWYgKGFsbFRyYW5zcGFyZW50KSB7CiAgICAgICAgeWllbGQqIGNoaWxkWyRnZXRDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBhbGxUcmFuc3BhcmVudCk7CiAgICAgIH0KICAgIH0KICB9CiAgKlskZ2V0QXR0cmlidXRlSXRdKG5hbWUsIHNraXBDb25zdW1lZCkgewogICAgY29uc3QgdmFsdWUgPSB0aGlzW19hdHRyaWJ1dGVzXS5nZXQobmFtZSk7CiAgICBpZiAodmFsdWUgJiYgKCFza2lwQ29uc3VtZWQgfHwgIXZhbHVlWyRjb25zdW1lZF0pKSB7CiAgICAgIHlpZWxkIHZhbHVlOwogICAgfQogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgeWllbGQqIGNoaWxkWyRnZXRBdHRyaWJ1dGVJdF0obmFtZSwgc2tpcENvbnN1bWVkKTsKICAgIH0KICB9CiAgKlskZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGFsbFRyYW5zcGFyZW50LCBza2lwQ29uc3VtZWQpIHsKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIGlmIChjaGlsZFskbm9kZU5hbWVdID09PSBuYW1lICYmICghc2tpcENvbnN1bWVkIHx8ICFjaGlsZFskY29uc3VtZWRdKSkgewogICAgICAgIHlpZWxkIGNoaWxkOwogICAgICB9CiAgICAgIGlmIChhbGxUcmFuc3BhcmVudCkgewogICAgICAgIHlpZWxkKiBjaGlsZFskZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGFsbFRyYW5zcGFyZW50LCBza2lwQ29uc3VtZWQpOwogICAgICB9CiAgICB9CiAgfQogIFskaXNEYXRhVmFsdWVdKCkgewogICAgaWYgKHRoaXNbX2RhdGFWYWx1ZV0gPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPT09IDAgfHwgdGhpc1tfY2hpbGRyZW5dWzBdWyRuYW1lc3BhY2VJZF0gPT09IE5hbWVzcGFjZUlkcy54aHRtbC5pZDsKICAgIH0KICAgIHJldHVybiB0aGlzW19kYXRhVmFsdWVdOwogIH0KICBbJGdldERhdGFWYWx1ZV0oKSB7CiAgICBpZiAodGhpc1tfZGF0YVZhbHVlXSA9PT0gbnVsbCkgewogICAgICBpZiAodGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXNbX2NoaWxkcmVuXVswXVskbmFtZXNwYWNlSWRdID09PSBOYW1lc3BhY2VJZHMueGh0bWwuaWQpIHsKICAgICAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dWzBdWyR0ZXh0XSgpLnRyaW0oKTsKICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgfQogIFskc2V0VmFsdWVdKHZhbHVlKSB7CiAgICB2YWx1ZSA9IHZhbHVlLnZhbHVlIHx8ICIiOwogICAgdGhpc1skY29udGVudF0gPSB2YWx1ZS50b1N0cmluZygpOwogIH0KICBbJGR1bXBdKGhhc05TID0gZmFsc2UpIHsKICAgIGNvbnN0IGR1bXBlZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAoaGFzTlMpIHsKICAgICAgZHVtcGVkLiRucyA9IHRoaXNbJG5hbWVzcGFjZUlkXTsKICAgIH0KICAgIGlmICh0aGlzWyRjb250ZW50XSkgewogICAgICBkdW1wZWQuJGNvbnRlbnQgPSB0aGlzWyRjb250ZW50XTsKICAgIH0KICAgIGR1bXBlZC4kbmFtZSA9IHRoaXNbJG5vZGVOYW1lXTsKICAgIGR1bXBlZC5jaGlsZHJlbiA9IFtdOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgZHVtcGVkLmNoaWxkcmVuLnB1c2goY2hpbGRbJGR1bXBdKGhhc05TKSk7CiAgICB9CiAgICBkdW1wZWQuYXR0cmlidXRlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBmb3IgKGNvbnN0IFtuYW1lLCB2YWx1ZV0gb2YgdGhpc1tfYXR0cmlidXRlc10pIHsKICAgICAgZHVtcGVkLmF0dHJpYnV0ZXNbbmFtZV0gPSB2YWx1ZVskY29udGVudF07CiAgICB9CiAgICByZXR1cm4gZHVtcGVkOwogIH0KfQpjbGFzcyBDb250ZW50T2JqZWN0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lKSB7CiAgICBzdXBlcihuc0lkLCBuYW1lKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gIiI7CiAgfQogIFskb25UZXh0XSh0ZXh0KSB7CiAgICB0aGlzWyRjb250ZW50XSArPSB0ZXh0OwogIH0KICBbJGZpbmFsaXplXSgpIHt9Cn0KY2xhc3MgT3B0aW9uT2JqZWN0IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IobnNJZCwgbmFtZSwgb3B0aW9ucykgewogICAgc3VwZXIobnNJZCwgbmFtZSk7CiAgICB0aGlzW19vcHRpb25zXSA9IG9wdGlvbnM7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSBnZXRLZXl3b3JkKHsKICAgICAgZGF0YTogdGhpc1skY29udGVudF0sCiAgICAgIGRlZmF1bHRWYWx1ZTogdGhpc1tfb3B0aW9uc11bMF0sCiAgICAgIHZhbGlkYXRlOiBrID0+IHRoaXNbX29wdGlvbnNdLmluY2x1ZGVzKGspCiAgICB9KTsKICB9CiAgWyRjbGVhbl0oYnVpbGRlcikgewogICAgc3VwZXJbJGNsZWFuXShidWlsZGVyKTsKICAgIGRlbGV0ZSB0aGlzW19vcHRpb25zXTsKICB9Cn0KY2xhc3MgU3RyaW5nT2JqZWN0IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICB9Cn0KY2xhc3MgSW50ZWdlck9iamVjdCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUsIGRlZmF1bHRWYWx1ZSwgdmFsaWRhdG9yKSB7CiAgICBzdXBlcihuc0lkLCBuYW1lKTsKICAgIHRoaXNbX2RlZmF1bHRWYWx1ZV0gPSBkZWZhdWx0VmFsdWU7CiAgICB0aGlzW192YWxpZGF0b3JdID0gdmFsaWRhdG9yOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IHRoaXNbJGNvbnRlbnRdLAogICAgICBkZWZhdWx0VmFsdWU6IHRoaXNbX2RlZmF1bHRWYWx1ZV0sCiAgICAgIHZhbGlkYXRlOiB0aGlzW192YWxpZGF0b3JdCiAgICB9KTsKICB9CiAgWyRjbGVhbl0oYnVpbGRlcikgewogICAgc3VwZXJbJGNsZWFuXShidWlsZGVyKTsKICAgIGRlbGV0ZSB0aGlzW19kZWZhdWx0VmFsdWVdOwogICAgZGVsZXRlIHRoaXNbX3ZhbGlkYXRvcl07CiAgfQp9CmNsYXNzIE9wdGlvbjAxIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IobnNJZCwgbmFtZSkgewogICAgc3VwZXIobnNJZCwgbmFtZSwgMCwgbiA9PiBuID09PSAxKTsKICB9Cn0KY2xhc3MgT3B0aW9uMTAgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lKSB7CiAgICBzdXBlcihuc0lkLCBuYW1lLCAxLCBuID0+IG4gPT09IDApOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2h0bWxfdXRpbHMuanMKCgoKCgoKZnVuY3Rpb24gbWVhc3VyZVRvU3RyaW5nKG0pIHsKICBpZiAodHlwZW9mIG0gPT09ICJzdHJpbmciKSB7CiAgICByZXR1cm4gIjBweCI7CiAgfQogIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKG0pID8gYCR7bX1weGAgOiBgJHttLnRvRml4ZWQoMil9cHhgOwp9CmNvbnN0IGNvbnZlcnRlcnMgPSB7CiAgYW5jaG9yVHlwZShub2RlLCBzdHlsZSkgewogICAgY29uc3QgcGFyZW50ID0gbm9kZVskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGlmICghcGFyZW50IHx8IHBhcmVudC5sYXlvdXQgJiYgcGFyZW50LmxheW91dCAhPT0gInBvc2l0aW9uIikgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoISgidHJhbnNmb3JtIiBpbiBzdHlsZSkpIHsKICAgICAgc3R5bGUudHJhbnNmb3JtID0gIiI7CiAgICB9CiAgICBzd2l0Y2ggKG5vZGUuYW5jaG9yVHlwZSkgewogICAgICBjYXNlICJib3R0b21DZW50ZXIiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC01MCUsIC0xMDAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImJvdHRvbUxlZnQiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKDAsLTEwMCUpIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiYm90dG9tUmlnaHQiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC0xMDAlLC0xMDAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm1pZGRsZUNlbnRlciI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTUwJSwtNTAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm1pZGRsZUxlZnQiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKDAsLTUwJSkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJtaWRkbGVSaWdodCI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTEwMCUsLTUwJSkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJ0b3BDZW50ZXIiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC01MCUsMCkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJ0b3BSaWdodCI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTEwMCUsMCkiOwogICAgICAgIGJyZWFrOwogICAgfQogIH0sCiAgZGltZW5zaW9ucyhub2RlLCBzdHlsZSkgewogICAgY29uc3QgcGFyZW50ID0gbm9kZVskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGxldCB3aWR0aCA9IG5vZGUudzsKICAgIGNvbnN0IGhlaWdodCA9IG5vZGUuaDsKICAgIGlmIChwYXJlbnQubGF5b3V0Py5pbmNsdWRlcygicm93IikpIHsKICAgICAgY29uc3QgZXh0cmEgPSBwYXJlbnRbJGV4dHJhXTsKICAgICAgY29uc3QgY29sU3BhbiA9IG5vZGUuY29sU3BhbjsKICAgICAgbGV0IHc7CiAgICAgIGlmIChjb2xTcGFuID09PSAtMSkgewogICAgICAgIHcgPSBNYXRoLnN1bVByZWNpc2UoZXh0cmEuY29sdW1uV2lkdGhzLnNsaWNlKGV4dHJhLmN1cnJlbnRDb2x1bW4pKTsKICAgICAgICBleHRyYS5jdXJyZW50Q29sdW1uID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB3ID0gTWF0aC5zdW1QcmVjaXNlKGV4dHJhLmNvbHVtbldpZHRocy5zbGljZShleHRyYS5jdXJyZW50Q29sdW1uLCBleHRyYS5jdXJyZW50Q29sdW1uICsgY29sU3BhbikpOwogICAgICAgIGV4dHJhLmN1cnJlbnRDb2x1bW4gPSAoZXh0cmEuY3VycmVudENvbHVtbiArIG5vZGUuY29sU3BhbikgJSBleHRyYS5jb2x1bW5XaWR0aHMubGVuZ3RoOwogICAgICB9CiAgICAgIGlmICghaXNOYU4odykpIHsKICAgICAgICB3aWR0aCA9IG5vZGUudyA9IHc7CiAgICAgIH0KICAgIH0KICAgIHN0eWxlLndpZHRoID0gd2lkdGggIT09ICIiID8gbWVhc3VyZVRvU3RyaW5nKHdpZHRoKSA6ICJhdXRvIjsKICAgIHN0eWxlLmhlaWdodCA9IGhlaWdodCAhPT0gIiIgPyBtZWFzdXJlVG9TdHJpbmcoaGVpZ2h0KSA6ICJhdXRvIjsKICB9LAogIHBvc2l0aW9uKG5vZGUsIHN0eWxlKSB7CiAgICBjb25zdCBwYXJlbnQgPSBub2RlWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgaWYgKHBhcmVudD8ubGF5b3V0ICYmIHBhcmVudC5sYXlvdXQgIT09ICJwb3NpdGlvbiIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgc3R5bGUubGVmdCA9IG1lYXN1cmVUb1N0cmluZyhub2RlLngpOwogICAgc3R5bGUudG9wID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUueSk7CiAgfSwKICByb3RhdGUobm9kZSwgc3R5bGUpIHsKICAgIGlmIChub2RlLnJvdGF0ZSkgewogICAgICBpZiAoISgidHJhbnNmb3JtIiBpbiBzdHlsZSkpIHsKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gPSAiIjsKICAgICAgfQogICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gYHJvdGF0ZSgtJHtub2RlLnJvdGF0ZX1kZWcpYDsKICAgICAgc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gInRvcCBsZWZ0IjsKICAgIH0KICB9LAogIHByZXNlbmNlKG5vZGUsIHN0eWxlKSB7CiAgICBzd2l0Y2ggKG5vZGUucHJlc2VuY2UpIHsKICAgICAgY2FzZSAiaW52aXNpYmxlIjoKICAgICAgICBzdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImhpZGRlbiI6CiAgICAgIGNhc2UgImluYWN0aXZlIjoKICAgICAgICBzdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIGJyZWFrOwogICAgfQogIH0sCiAgaEFsaWduKG5vZGUsIHN0eWxlKSB7CiAgICBpZiAobm9kZVskbm9kZU5hbWVdID09PSAicGFyYSIpIHsKICAgICAgc3dpdGNoIChub2RlLmhBbGlnbikgewogICAgICAgIGNhc2UgImp1c3RpZnlBbGwiOgogICAgICAgICAgc3R5bGUudGV4dEFsaWduID0gImp1c3RpZnktYWxsIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInJhZGl4IjoKICAgICAgICAgIHN0eWxlLnRleHRBbGlnbiA9ICJsZWZ0IjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBzdHlsZS50ZXh0QWxpZ24gPSBub2RlLmhBbGlnbjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgc3dpdGNoIChub2RlLmhBbGlnbikgewogICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgICAgc3R5bGUuYWxpZ25TZWxmID0gInN0YXJ0IjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImNlbnRlciI6CiAgICAgICAgICBzdHlsZS5hbGlnblNlbGYgPSAiY2VudGVyIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICAgIHN0eWxlLmFsaWduU2VsZiA9ICJlbmQiOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9LAogIG1hcmdpbihub2RlLCBzdHlsZSkgewogICAgaWYgKG5vZGUubWFyZ2luKSB7CiAgICAgIHN0eWxlLm1hcmdpbiA9IG5vZGUubWFyZ2luWyR0b1N0eWxlXSgpLm1hcmdpbjsKICAgIH0KICB9Cn07CmZ1bmN0aW9uIHNldE1pbk1heERpbWVuc2lvbnMobm9kZSwgc3R5bGUpIHsKICBjb25zdCBwYXJlbnQgPSBub2RlWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogIGlmIChwYXJlbnQubGF5b3V0ID09PSAicG9zaXRpb24iKSB7CiAgICBpZiAobm9kZS5taW5XID4gMCkgewogICAgICBzdHlsZS5taW5XaWR0aCA9IG1lYXN1cmVUb1N0cmluZyhub2RlLm1pblcpOwogICAgfQogICAgaWYgKG5vZGUubWF4VyA+IDApIHsKICAgICAgc3R5bGUubWF4V2lkdGggPSBtZWFzdXJlVG9TdHJpbmcobm9kZS5tYXhXKTsKICAgIH0KICAgIGlmIChub2RlLm1pbkggPiAwKSB7CiAgICAgIHN0eWxlLm1pbkhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhub2RlLm1pbkgpOwogICAgfQogICAgaWYgKG5vZGUubWF4SCA+IDApIHsKICAgICAgc3R5bGUubWF4SGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUubWF4SCk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGxheW91dFRleHQodGV4dCwgeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0LCBmb250RmluZGVyLCB3aWR0aCkgewogIGNvbnN0IG1lYXN1cmUgPSBuZXcgVGV4dE1lYXN1cmUoeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0LCBmb250RmluZGVyKTsKICBpZiAodHlwZW9mIHRleHQgPT09ICJzdHJpbmciKSB7CiAgICBtZWFzdXJlLmFkZFN0cmluZyh0ZXh0KTsKICB9IGVsc2UgewogICAgdGV4dFskcHVzaEdseXBoc10obWVhc3VyZSk7CiAgfQogIHJldHVybiBtZWFzdXJlLmNvbXB1dGUod2lkdGgpOwp9CmZ1bmN0aW9uIGxheW91dE5vZGUobm9kZSwgYXZhaWxhYmxlU3BhY2UpIHsKICBsZXQgaGVpZ2h0ID0gbnVsbDsKICBsZXQgd2lkdGggPSBudWxsOwogIGxldCBpc0Jyb2tlbiA9IGZhbHNlOwogIGlmICgoIW5vZGUudyB8fCAhbm9kZS5oKSAmJiBub2RlLnZhbHVlKSB7CiAgICBsZXQgbWFyZ2luSCA9IDA7CiAgICBsZXQgbWFyZ2luViA9IDA7CiAgICBpZiAobm9kZS5tYXJnaW4pIHsKICAgICAgbWFyZ2luSCA9IG5vZGUubWFyZ2luLmxlZnRJbnNldCArIG5vZGUubWFyZ2luLnJpZ2h0SW5zZXQ7CiAgICAgIG1hcmdpblYgPSBub2RlLm1hcmdpbi50b3BJbnNldCArIG5vZGUubWFyZ2luLmJvdHRvbUluc2V0OwogICAgfQogICAgbGV0IGxpbmVIZWlnaHQgPSBudWxsOwogICAgbGV0IG1hcmdpbiA9IG51bGw7CiAgICBpZiAobm9kZS5wYXJhKSB7CiAgICAgIG1hcmdpbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGxpbmVIZWlnaHQgPSBub2RlLnBhcmEubGluZUhlaWdodCA9PT0gIiIgPyBudWxsIDogbm9kZS5wYXJhLmxpbmVIZWlnaHQ7CiAgICAgIG1hcmdpbi50b3AgPSBub2RlLnBhcmEuc3BhY2VBYm92ZSA9PT0gIiIgPyAwIDogbm9kZS5wYXJhLnNwYWNlQWJvdmU7CiAgICAgIG1hcmdpbi5ib3R0b20gPSBub2RlLnBhcmEuc3BhY2VCZWxvdyA9PT0gIiIgPyAwIDogbm9kZS5wYXJhLnNwYWNlQmVsb3c7CiAgICAgIG1hcmdpbi5sZWZ0ID0gbm9kZS5wYXJhLm1hcmdpbkxlZnQgPT09ICIiID8gMCA6IG5vZGUucGFyYS5tYXJnaW5MZWZ0OwogICAgICBtYXJnaW4ucmlnaHQgPSBub2RlLnBhcmEubWFyZ2luUmlnaHQgPT09ICIiID8gMCA6IG5vZGUucGFyYS5tYXJnaW5SaWdodDsKICAgIH0KICAgIGxldCBmb250ID0gbm9kZS5mb250OwogICAgaWYgKCFmb250KSB7CiAgICAgIGNvbnN0IHJvb3QgPSBub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgICAgIGxldCBwYXJlbnQgPSBub2RlWyRnZXRQYXJlbnRdKCk7CiAgICAgIHdoaWxlIChwYXJlbnQgJiYgcGFyZW50ICE9PSByb290KSB7CiAgICAgICAgaWYgKHBhcmVudC5mb250KSB7CiAgICAgICAgICBmb250ID0gcGFyZW50LmZvbnQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcGFyZW50ID0gcGFyZW50WyRnZXRQYXJlbnRdKCk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG1heFdpZHRoID0gKG5vZGUudyB8fCBhdmFpbGFibGVTcGFjZS53aWR0aCkgLSBtYXJnaW5IOwogICAgY29uc3QgZm9udEZpbmRlciA9IG5vZGVbJGdsb2JhbERhdGFdLmZvbnRGaW5kZXI7CiAgICBpZiAobm9kZS52YWx1ZS5leERhdGEgJiYgbm9kZS52YWx1ZS5leERhdGFbJGNvbnRlbnRdICYmIG5vZGUudmFsdWUuZXhEYXRhLmNvbnRlbnRUeXBlID09PSAidGV4dC9odG1sIikgewogICAgICBjb25zdCByZXMgPSBsYXlvdXRUZXh0KG5vZGUudmFsdWUuZXhEYXRhWyRjb250ZW50XSwgZm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0LCBmb250RmluZGVyLCBtYXhXaWR0aCk7CiAgICAgIHdpZHRoID0gcmVzLndpZHRoOwogICAgICBoZWlnaHQgPSByZXMuaGVpZ2h0OwogICAgICBpc0Jyb2tlbiA9IHJlcy5pc0Jyb2tlbjsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHRleHQgPSBub2RlLnZhbHVlWyR0ZXh0XSgpOwogICAgICBpZiAodGV4dCkgewogICAgICAgIGNvbnN0IHJlcyA9IGxheW91dFRleHQodGV4dCwgZm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0LCBmb250RmluZGVyLCBtYXhXaWR0aCk7CiAgICAgICAgd2lkdGggPSByZXMud2lkdGg7CiAgICAgICAgaGVpZ2h0ID0gcmVzLmhlaWdodDsKICAgICAgICBpc0Jyb2tlbiA9IHJlcy5pc0Jyb2tlbjsKICAgICAgfQogICAgfQogICAgaWYgKHdpZHRoICE9PSBudWxsICYmICFub2RlLncpIHsKICAgICAgd2lkdGggKz0gbWFyZ2luSDsKICAgIH0KICAgIGlmIChoZWlnaHQgIT09IG51bGwgJiYgIW5vZGUuaCkgewogICAgICBoZWlnaHQgKz0gbWFyZ2luVjsKICAgIH0KICB9CiAgcmV0dXJuIHsKICAgIHc6IHdpZHRoLAogICAgaDogaGVpZ2h0LAogICAgaXNCcm9rZW4KICB9Owp9CmZ1bmN0aW9uIGNvbXB1dGVCYm94KG5vZGUsIGh0bWwsIGF2YWlsYWJsZVNwYWNlKSB7CiAgbGV0IGJib3g7CiAgaWYgKG5vZGUudyAhPT0gIiIgJiYgbm9kZS5oICE9PSAiIikgewogICAgYmJveCA9IFtub2RlLngsIG5vZGUueSwgbm9kZS53LCBub2RlLmhdOwogIH0gZWxzZSB7CiAgICBpZiAoIWF2YWlsYWJsZVNwYWNlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbGV0IHdpZHRoID0gbm9kZS53OwogICAgaWYgKHdpZHRoID09PSAiIikgewogICAgICBpZiAobm9kZS5tYXhXID09PSAwKSB7CiAgICAgICAgY29uc3QgcGFyZW50ID0gbm9kZVskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgICAgICB3aWR0aCA9IHBhcmVudC5sYXlvdXQgPT09ICJwb3NpdGlvbiIgJiYgcGFyZW50LncgIT09ICIiID8gMCA6IG5vZGUubWluVzsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aWR0aCA9IE1hdGgubWluKG5vZGUubWF4VywgYXZhaWxhYmxlU3BhY2Uud2lkdGgpOwogICAgICB9CiAgICAgIGh0bWwuYXR0cmlidXRlcy5zdHlsZS53aWR0aCA9IG1lYXN1cmVUb1N0cmluZyh3aWR0aCk7CiAgICB9CiAgICBsZXQgaGVpZ2h0ID0gbm9kZS5oOwogICAgaWYgKGhlaWdodCA9PT0gIiIpIHsKICAgICAgaWYgKG5vZGUubWF4SCA9PT0gMCkgewogICAgICAgIGNvbnN0IHBhcmVudCA9IG5vZGVbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICAgICAgaGVpZ2h0ID0gcGFyZW50LmxheW91dCA9PT0gInBvc2l0aW9uIiAmJiBwYXJlbnQuaCAhPT0gIiIgPyAwIDogbm9kZS5taW5IOwogICAgICB9IGVsc2UgewogICAgICAgIGhlaWdodCA9IE1hdGgubWluKG5vZGUubWF4SCwgYXZhaWxhYmxlU3BhY2UuaGVpZ2h0KTsKICAgICAgfQogICAgICBodG1sLmF0dHJpYnV0ZXMuc3R5bGUuaGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKGhlaWdodCk7CiAgICB9CiAgICBiYm94ID0gW25vZGUueCwgbm9kZS55LCB3aWR0aCwgaGVpZ2h0XTsKICB9CiAgcmV0dXJuIGJib3g7Cn0KZnVuY3Rpb24gZml4RGltZW5zaW9ucyhub2RlKSB7CiAgY29uc3QgcGFyZW50ID0gbm9kZVskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICBpZiAocGFyZW50LmxheW91dD8uaW5jbHVkZXMoInJvdyIpKSB7CiAgICBjb25zdCBleHRyYSA9IHBhcmVudFskZXh0cmFdOwogICAgY29uc3QgY29sU3BhbiA9IG5vZGUuY29sU3BhbjsKICAgIGxldCB3aWR0aDsKICAgIGlmIChjb2xTcGFuID09PSAtMSkgewogICAgICB3aWR0aCA9IE1hdGguc3VtUHJlY2lzZShleHRyYS5jb2x1bW5XaWR0aHMuc2xpY2UoZXh0cmEuY3VycmVudENvbHVtbikpOwogICAgfSBlbHNlIHsKICAgICAgd2lkdGggPSBNYXRoLnN1bVByZWNpc2UoZXh0cmEuY29sdW1uV2lkdGhzLnNsaWNlKGV4dHJhLmN1cnJlbnRDb2x1bW4sIGV4dHJhLmN1cnJlbnRDb2x1bW4gKyBjb2xTcGFuKSk7CiAgICB9CiAgICBpZiAoIWlzTmFOKHdpZHRoKSkgewogICAgICBub2RlLncgPSB3aWR0aDsKICAgIH0KICB9CiAgaWYgKHBhcmVudC5sYXlvdXQgJiYgcGFyZW50LmxheW91dCAhPT0gInBvc2l0aW9uIikgewogICAgbm9kZS54ID0gbm9kZS55ID0gMDsKICB9CiAgaWYgKG5vZGUubGF5b3V0ID09PSAidGFibGUiKSB7CiAgICBpZiAobm9kZS53ID09PSAiIiAmJiBBcnJheS5pc0FycmF5KG5vZGUuY29sdW1uV2lkdGhzKSkgewogICAgICBub2RlLncgPSBNYXRoLnN1bVByZWNpc2Uobm9kZS5jb2x1bW5XaWR0aHMpOwogICAgfQogIH0KfQpmdW5jdGlvbiBsYXlvdXRDbGFzcyhub2RlKSB7CiAgc3dpdGNoIChub2RlLmxheW91dCkgewogICAgY2FzZSAicG9zaXRpb24iOgogICAgICByZXR1cm4gInhmYVBvc2l0aW9uIjsKICAgIGNhc2UgImxyLXRiIjoKICAgICAgcmV0dXJuICJ4ZmFMclRiIjsKICAgIGNhc2UgInJsLXJvdyI6CiAgICAgIHJldHVybiAieGZhUmxSb3ciOwogICAgY2FzZSAicmwtdGIiOgogICAgICByZXR1cm4gInhmYVJsVGIiOwogICAgY2FzZSAicm93IjoKICAgICAgcmV0dXJuICJ4ZmFSb3ciOwogICAgY2FzZSAidGFibGUiOgogICAgICByZXR1cm4gInhmYVRhYmxlIjsKICAgIGNhc2UgInRiIjoKICAgICAgcmV0dXJuICJ4ZmFUYiI7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gInhmYVBvc2l0aW9uIjsKICB9Cn0KZnVuY3Rpb24gdG9TdHlsZShub2RlLCAuLi5uYW1lcykgewogIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHsKICAgIGNvbnN0IHZhbHVlID0gbm9kZVtuYW1lXTsKICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmIChjb252ZXJ0ZXJzLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIGNvbnZlcnRlcnNbbmFtZV0obm9kZSwgc3R5bGUpOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFhGQU9iamVjdCkgewogICAgICBjb25zdCBuZXdTdHlsZSA9IHZhbHVlWyR0b1N0eWxlXSgpOwogICAgICBpZiAobmV3U3R5bGUpIHsKICAgICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCBuZXdTdHlsZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybihgKERFQlVHKSAtIFhGQSAtIHN0eWxlIGZvciAke25hbWV9IG5vdCBpbXBsZW1lbnRlZCB5ZXRgKTsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gc3R5bGU7Cn0KZnVuY3Rpb24gY3JlYXRlV3JhcHBlcihub2RlLCBodG1sKSB7CiAgY29uc3QgewogICAgYXR0cmlidXRlcwogIH0gPSBodG1sOwogIGNvbnN0IHsKICAgIHN0eWxlCiAgfSA9IGF0dHJpYnV0ZXM7CiAgY29uc3Qgd3JhcHBlciA9IHsKICAgIG5hbWU6ICJkaXYiLAogICAgYXR0cmlidXRlczogewogICAgICBjbGFzczogWyJ4ZmFXcmFwcGVyIl0sCiAgICAgIHN0eWxlOiBPYmplY3QuY3JlYXRlKG51bGwpCiAgICB9LAogICAgY2hpbGRyZW46IFtdCiAgfTsKICBhdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYVdyYXBwZWQiKTsKICBpZiAobm9kZS5ib3JkZXIpIHsKICAgIGNvbnN0IHsKICAgICAgd2lkdGhzLAogICAgICBpbnNldHMKICAgIH0gPSBub2RlLmJvcmRlclskZXh0cmFdOwogICAgbGV0IHdpZHRoLCBoZWlnaHQ7CiAgICBsZXQgdG9wID0gaW5zZXRzWzBdOwogICAgbGV0IGxlZnQgPSBpbnNldHNbM107CiAgICBjb25zdCBpbnNldHNIID0gaW5zZXRzWzBdICsgaW5zZXRzWzJdOwogICAgY29uc3QgaW5zZXRzVyA9IGluc2V0c1sxXSArIGluc2V0c1szXTsKICAgIHN3aXRjaCAobm9kZS5ib3JkZXIuaGFuZCkgewogICAgICBjYXNlICJldmVuIjoKICAgICAgICB0b3AgLT0gd2lkdGhzWzBdIC8gMjsKICAgICAgICBsZWZ0IC09IHdpZHRoc1szXSAvIDI7CiAgICAgICAgd2lkdGggPSBgY2FsYygxMDAlICsgJHsod2lkdGhzWzFdICsgd2lkdGhzWzNdKSAvIDIgLSBpbnNldHNXfXB4KWA7CiAgICAgICAgaGVpZ2h0ID0gYGNhbGMoMTAwJSArICR7KHdpZHRoc1swXSArIHdpZHRoc1syXSkgLyAyIC0gaW5zZXRzSH1weClgOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJsZWZ0IjoKICAgICAgICB0b3AgLT0gd2lkdGhzWzBdOwogICAgICAgIGxlZnQgLT0gd2lkdGhzWzNdOwogICAgICAgIHdpZHRoID0gYGNhbGMoMTAwJSArICR7d2lkdGhzWzFdICsgd2lkdGhzWzNdIC0gaW5zZXRzV31weClgOwogICAgICAgIGhlaWdodCA9IGBjYWxjKDEwMCUgKyAke3dpZHRoc1swXSArIHdpZHRoc1syXSAtIGluc2V0c0h9cHgpYDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgIHdpZHRoID0gaW5zZXRzVyA/IGBjYWxjKDEwMCUgLSAke2luc2V0c1d9cHgpYCA6ICIxMDAlIjsKICAgICAgICBoZWlnaHQgPSBpbnNldHNIID8gYGNhbGMoMTAwJSAtICR7aW5zZXRzSH1weClgIDogIjEwMCUiOwogICAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgY2xhc3NOYW1lcyA9IFsieGZhQm9yZGVyIl07CiAgICBpZiAoaXNQcmludE9ubHkobm9kZS5ib3JkZXIpKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUHJpbnRPbmx5Iik7CiAgICB9CiAgICBjb25zdCBib3JkZXIgPSB7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IGNsYXNzTmFtZXMsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHRvcDogYCR7dG9wfXB4YCwKICAgICAgICAgIGxlZnQ6IGAke2xlZnR9cHhgLAogICAgICAgICAgd2lkdGgsCiAgICAgICAgICBoZWlnaHQKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNoaWxkcmVuOiBbXQogICAgfTsKICAgIGZvciAoY29uc3Qga2V5IG9mIFsiYm9yZGVyIiwgImJvcmRlcldpZHRoIiwgImJvcmRlckNvbG9yIiwgImJvcmRlclJhZGl1cyIsICJib3JkZXJTdHlsZSJdKSB7CiAgICAgIGlmIChzdHlsZVtrZXldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBib3JkZXIuYXR0cmlidXRlcy5zdHlsZVtrZXldID0gc3R5bGVba2V5XTsKICAgICAgICBkZWxldGUgc3R5bGVba2V5XTsKICAgICAgfQogICAgfQogICAgd3JhcHBlci5jaGlsZHJlbi5wdXNoKGJvcmRlciwgaHRtbCk7CiAgfSBlbHNlIHsKICAgIHdyYXBwZXIuY2hpbGRyZW4ucHVzaChodG1sKTsKICB9CiAgZm9yIChjb25zdCBrZXkgb2YgWyJiYWNrZ3JvdW5kIiwgImJhY2tncm91bmRDbGlwIiwgInRvcCIsICJsZWZ0IiwgIndpZHRoIiwgImhlaWdodCIsICJtaW5XaWR0aCIsICJtaW5IZWlnaHQiLCAibWF4V2lkdGgiLCAibWF4SGVpZ2h0IiwgInRyYW5zZm9ybSIsICJ0cmFuc2Zvcm1PcmlnaW4iLCAidmlzaWJpbGl0eSJdKSB7CiAgICBpZiAoc3R5bGVba2V5XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHdyYXBwZXIuYXR0cmlidXRlcy5zdHlsZVtrZXldID0gc3R5bGVba2V5XTsKICAgICAgZGVsZXRlIHN0eWxlW2tleV07CiAgICB9CiAgfQogIHdyYXBwZXIuYXR0cmlidXRlcy5zdHlsZS5wb3NpdGlvbiA9IHN0eWxlLnBvc2l0aW9uID09PSAiYWJzb2x1dGUiID8gImFic29sdXRlIiA6ICJyZWxhdGl2ZSI7CiAgZGVsZXRlIHN0eWxlLnBvc2l0aW9uOwogIGlmIChzdHlsZS5hbGlnblNlbGYpIHsKICAgIHdyYXBwZXIuYXR0cmlidXRlcy5zdHlsZS5hbGlnblNlbGYgPSBzdHlsZS5hbGlnblNlbGY7CiAgICBkZWxldGUgc3R5bGUuYWxpZ25TZWxmOwogIH0KICByZXR1cm4gd3JhcHBlcjsKfQpmdW5jdGlvbiBmaXhUZXh0SW5kZW50KHN0eWxlcykgewogIGNvbnN0IGluZGVudCA9IGdldE1lYXN1cmVtZW50KHN0eWxlcy50ZXh0SW5kZW50LCAiMHB4Iik7CiAgaWYgKGluZGVudCA+PSAwKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IGFsaWduID0gc3R5bGVzLnRleHRBbGlnbiA9PT0gInJpZ2h0IiA/ICJyaWdodCIgOiAibGVmdCI7CiAgY29uc3QgbmFtZSA9ICJwYWRkaW5nIiArIChhbGlnbiA9PT0gImxlZnQiID8gIkxlZnQiIDogIlJpZ2h0Iik7CiAgY29uc3QgcGFkZGluZyA9IGdldE1lYXN1cmVtZW50KHN0eWxlc1tuYW1lXSwgIjBweCIpOwogIHN0eWxlc1tuYW1lXSA9IGAke3BhZGRpbmcgLSBpbmRlbnR9cHhgOwp9CmZ1bmN0aW9uIHNldEFjY2Vzcyhub2RlLCBjbGFzc05hbWVzKSB7CiAgc3dpdGNoIChub2RlLmFjY2VzcykgewogICAgY2FzZSAibm9uSW50ZXJhY3RpdmUiOgogICAgICBjbGFzc05hbWVzLnB1c2goInhmYU5vbkludGVyYWN0aXZlIik7CiAgICAgIGJyZWFrOwogICAgY2FzZSAicmVhZE9ubHkiOgogICAgICBjbGFzc05hbWVzLnB1c2goInhmYVJlYWRPbmx5Iik7CiAgICAgIGJyZWFrOwogICAgY2FzZSAicHJvdGVjdGVkIjoKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFEaXNhYmxlZCIpOwogICAgICBicmVhazsKICB9Cn0KZnVuY3Rpb24gaXNQcmludE9ubHkobm9kZSkgewogIHJldHVybiBub2RlLnJlbGV2YW50Lmxlbmd0aCA+IDAgJiYgIW5vZGUucmVsZXZhbnRbMF0uZXhjbHVkZWQgJiYgbm9kZS5yZWxldmFudFswXS52aWV3bmFtZSA9PT0gInByaW50IjsKfQpmdW5jdGlvbiBnZXRDdXJyZW50UGFyYShub2RlKSB7CiAgY29uc3Qgc3RhY2sgPSBub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5wYXJhU3RhY2s7CiAgcmV0dXJuIHN0YWNrLmxlbmd0aCA/IHN0YWNrLmF0KC0xKSA6IG51bGw7Cn0KZnVuY3Rpb24gc2V0UGFyYShub2RlLCBub2RlU3R5bGUsIHZhbHVlKSB7CiAgaWYgKHZhbHVlLmF0dHJpYnV0ZXMuY2xhc3M/LmluY2x1ZGVzKCJ4ZmFSaWNoIikpIHsKICAgIGlmIChub2RlU3R5bGUpIHsKICAgICAgaWYgKG5vZGUuaCA9PT0gIiIpIHsKICAgICAgICBub2RlU3R5bGUuaGVpZ2h0ID0gImF1dG8iOwogICAgICB9CiAgICAgIGlmIChub2RlLncgPT09ICIiKSB7CiAgICAgICAgbm9kZVN0eWxlLndpZHRoID0gImF1dG8iOwogICAgICB9CiAgICB9CiAgICBjb25zdCBwYXJhID0gZ2V0Q3VycmVudFBhcmEobm9kZSk7CiAgICBpZiAocGFyYSkgewogICAgICBjb25zdCB2YWx1ZVN0eWxlID0gdmFsdWUuYXR0cmlidXRlcy5zdHlsZTsKICAgICAgdmFsdWVTdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgICB2YWx1ZVN0eWxlLmZsZXhEaXJlY3Rpb24gPSAiY29sdW1uIjsKICAgICAgc3dpdGNoIChwYXJhLnZBbGlnbikgewogICAgICAgIGNhc2UgInRvcCI6CiAgICAgICAgICB2YWx1ZVN0eWxlLmp1c3RpZnlDb250ZW50ID0gInN0YXJ0IjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICB2YWx1ZVN0eWxlLmp1c3RpZnlDb250ZW50ID0gImVuZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtaWRkbGUiOgogICAgICAgICAgdmFsdWVTdHlsZS5qdXN0aWZ5Q29udGVudCA9ICJjZW50ZXIiOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY29uc3QgcGFyYVN0eWxlID0gcGFyYVskdG9TdHlsZV0oKTsKICAgICAgZm9yIChjb25zdCBba2V5LCB2YWxdIG9mIE9iamVjdC5lbnRyaWVzKHBhcmFTdHlsZSkpIHsKICAgICAgICBpZiAoIShrZXkgaW4gdmFsdWVTdHlsZSkpIHsKICAgICAgICAgIHZhbHVlU3R5bGVba2V5XSA9IHZhbDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cn0KZnVuY3Rpb24gc2V0Rm9udEZhbWlseSh4ZmFGb250LCBub2RlLCBmb250RmluZGVyLCBzdHlsZSkgewogIGlmICghZm9udEZpbmRlcikgewogICAgZGVsZXRlIHN0eWxlLmZvbnRGYW1pbHk7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IG5hbWUgPSBzdHJpcFF1b3Rlcyh4ZmFGb250LnR5cGVmYWNlKTsKICBzdHlsZS5mb250RmFtaWx5ID0gYCIke25hbWV9ImA7CiAgY29uc3QgdHlwZWZhY2UgPSBmb250RmluZGVyLmZpbmQobmFtZSk7CiAgaWYgKHR5cGVmYWNlKSB7CiAgICBjb25zdCB7CiAgICAgIGZvbnRGYW1pbHkKICAgIH0gPSB0eXBlZmFjZS5yZWd1bGFyLmNzc0ZvbnRJbmZvOwogICAgaWYgKGZvbnRGYW1pbHkgIT09IG5hbWUpIHsKICAgICAgc3R5bGUuZm9udEZhbWlseSA9IGAiJHtmb250RmFtaWx5fSJgOwogICAgfQogICAgY29uc3QgcGFyYSA9IGdldEN1cnJlbnRQYXJhKG5vZGUpOwogICAgaWYgKHBhcmEgJiYgcGFyYS5saW5lSGVpZ2h0ICE9PSAiIikgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoc3R5bGUubGluZUhlaWdodCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwZGZGb250ID0gc2VsZWN0Rm9udCh4ZmFGb250LCB0eXBlZmFjZSk7CiAgICBpZiAocGRmRm9udCkgewogICAgICBzdHlsZS5saW5lSGVpZ2h0ID0gTWF0aC5tYXgoMS4yLCBwZGZGb250LmxpbmVIZWlnaHQpOwogICAgfQogIH0KfQpmdW5jdGlvbiBmaXhVUkwoc3RyKSB7CiAgY29uc3QgYWJzb2x1dGVVcmwgPSBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHN0ciwgbnVsbCwgewogICAgYWRkRGVmYXVsdFByb3RvY29sOiB0cnVlLAogICAgdHJ5Q29udmVydEVuY29kaW5nOiB0cnVlCiAgfSk7CiAgcmV0dXJuIGFic29sdXRlVXJsID8gYWJzb2x1dGVVcmwuaHJlZiA6IG51bGw7Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9sYXlvdXQuanMKCgoKZnVuY3Rpb24gY3JlYXRlTGluZShub2RlLCBjaGlsZHJlbikgewogIHJldHVybiB7CiAgICBuYW1lOiAiZGl2IiwKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgY2xhc3M6IFtub2RlLmxheW91dCA9PT0gImxyLXRiIiA/ICJ4ZmFMciIgOiAieGZhUmwiXQogICAgfSwKICAgIGNoaWxkcmVuCiAgfTsKfQpmdW5jdGlvbiBmbHVzaEhUTUwobm9kZSkgewogIGlmICghbm9kZVskZXh0cmFdKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgYXR0cmlidXRlcyA9IG5vZGVbJGV4dHJhXS5hdHRyaWJ1dGVzOwogIGNvbnN0IGh0bWwgPSB7CiAgICBuYW1lOiAiZGl2IiwKICAgIGF0dHJpYnV0ZXMsCiAgICBjaGlsZHJlbjogbm9kZVskZXh0cmFdLmNoaWxkcmVuCiAgfTsKICBpZiAobm9kZVskZXh0cmFdLmZhaWxpbmdOb2RlKSB7CiAgICBjb25zdCBodG1sRnJvbUZhaWxpbmcgPSBub2RlWyRleHRyYV0uZmFpbGluZ05vZGVbJGZsdXNoSFRNTF0oKTsKICAgIGlmIChodG1sRnJvbUZhaWxpbmcpIHsKICAgICAgaWYgKG5vZGUubGF5b3V0LmVuZHNXaXRoKCItdGIiKSkgewogICAgICAgIGh0bWwuY2hpbGRyZW4ucHVzaChjcmVhdGVMaW5lKG5vZGUsIFtodG1sRnJvbUZhaWxpbmddKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaHRtbC5jaGlsZHJlbi5wdXNoKGh0bWxGcm9tRmFpbGluZyk7CiAgICAgIH0KICAgIH0KICB9CiAgaWYgKGh0bWwuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgcmV0dXJuIGh0bWw7Cn0KZnVuY3Rpb24gYWRkSFRNTChub2RlLCBodG1sLCBiYm94KSB7CiAgY29uc3QgZXh0cmEgPSBub2RlWyRleHRyYV07CiAgY29uc3QgYXZhaWxhYmxlU3BhY2UgPSBleHRyYS5hdmFpbGFibGVTcGFjZTsKICBjb25zdCBbeCwgeSwgdywgaF0gPSBiYm94OwogIHN3aXRjaCAobm9kZS5sYXlvdXQpIHsKICAgIGNhc2UgInBvc2l0aW9uIjoKICAgICAgewogICAgICAgIGV4dHJhLndpZHRoID0gTWF0aC5tYXgoZXh0cmEud2lkdGgsIHggKyB3KTsKICAgICAgICBleHRyYS5oZWlnaHQgPSBNYXRoLm1heChleHRyYS5oZWlnaHQsIHkgKyBoKTsKICAgICAgICBleHRyYS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICBjYXNlICJsci10YiI6CiAgICBjYXNlICJybC10YiI6CiAgICAgIGlmICghZXh0cmEubGluZSB8fCBleHRyYS5hdHRlbXB0ID09PSAxKSB7CiAgICAgICAgZXh0cmEubGluZSA9IGNyZWF0ZUxpbmUobm9kZSwgW10pOwogICAgICAgIGV4dHJhLmNoaWxkcmVuLnB1c2goZXh0cmEubGluZSk7CiAgICAgICAgZXh0cmEubnVtYmVySW5MaW5lID0gMDsKICAgICAgfQogICAgICBleHRyYS5udW1iZXJJbkxpbmUgKz0gMTsKICAgICAgZXh0cmEubGluZS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICBpZiAoZXh0cmEuYXR0ZW1wdCA9PT0gMCkgewogICAgICAgIGV4dHJhLmN1cnJlbnRXaWR0aCArPSB3OwogICAgICAgIGV4dHJhLmhlaWdodCA9IE1hdGgubWF4KGV4dHJhLmhlaWdodCwgZXh0cmEucHJldkhlaWdodCArIGgpOwogICAgICB9IGVsc2UgewogICAgICAgIGV4dHJhLmN1cnJlbnRXaWR0aCA9IHc7CiAgICAgICAgZXh0cmEucHJldkhlaWdodCA9IGV4dHJhLmhlaWdodDsKICAgICAgICBleHRyYS5oZWlnaHQgKz0gaDsKICAgICAgICBleHRyYS5hdHRlbXB0ID0gMDsKICAgICAgfQogICAgICBleHRyYS53aWR0aCA9IE1hdGgubWF4KGV4dHJhLndpZHRoLCBleHRyYS5jdXJyZW50V2lkdGgpOwogICAgICBicmVhazsKICAgIGNhc2UgInJsLXJvdyI6CiAgICBjYXNlICJyb3ciOgogICAgICB7CiAgICAgICAgZXh0cmEuY2hpbGRyZW4ucHVzaChodG1sKTsKICAgICAgICBleHRyYS53aWR0aCArPSB3OwogICAgICAgIGV4dHJhLmhlaWdodCA9IE1hdGgubWF4KGV4dHJhLmhlaWdodCwgaCk7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKGV4dHJhLmhlaWdodCk7CiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBleHRyYS5jaGlsZHJlbikgewogICAgICAgICAgY2hpbGQuYXR0cmlidXRlcy5zdHlsZS5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICB9CiAgICBjYXNlICJ0YWJsZSI6CiAgICAgIHsKICAgICAgICBleHRyYS53aWR0aCA9IE1hdGhDbGFtcCh3LCBleHRyYS53aWR0aCwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpOwogICAgICAgIGV4dHJhLmhlaWdodCArPSBoOwogICAgICAgIGV4dHJhLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIGNhc2UgInRiIjoKICAgICAgewogICAgICAgIGV4dHJhLndpZHRoID0gTWF0aENsYW1wKHcsIGV4dHJhLndpZHRoLCBhdmFpbGFibGVTcGFjZS53aWR0aCk7CiAgICAgICAgZXh0cmEuaGVpZ2h0ICs9IGg7CiAgICAgICAgZXh0cmEuY2hpbGRyZW4ucHVzaChodG1sKTsKICAgICAgICBicmVhazsKICAgICAgfQogIH0KfQpmdW5jdGlvbiBnZXRBdmFpbGFibGVTcGFjZShub2RlKSB7CiAgY29uc3QgYXZhaWxhYmxlU3BhY2UgPSBub2RlWyRleHRyYV0uYXZhaWxhYmxlU3BhY2U7CiAgY29uc3QgbWFyZ2luViA9IG5vZGUubWFyZ2luID8gbm9kZS5tYXJnaW4udG9wSW5zZXQgKyBub2RlLm1hcmdpbi5ib3R0b21JbnNldCA6IDA7CiAgY29uc3QgbWFyZ2luSCA9IG5vZGUubWFyZ2luID8gbm9kZS5tYXJnaW4ubGVmdEluc2V0ICsgbm9kZS5tYXJnaW4ucmlnaHRJbnNldCA6IDA7CiAgc3dpdGNoIChub2RlLmxheW91dCkgewogICAgY2FzZSAibHItdGIiOgogICAgY2FzZSAicmwtdGIiOgogICAgICBpZiAobm9kZVskZXh0cmFdLmF0dGVtcHQgPT09IDApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgd2lkdGg6IGF2YWlsYWJsZVNwYWNlLndpZHRoIC0gbWFyZ2luSCAtIG5vZGVbJGV4dHJhXS5jdXJyZW50V2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IGF2YWlsYWJsZVNwYWNlLmhlaWdodCAtIG1hcmdpblYgLSBub2RlWyRleHRyYV0ucHJldkhlaWdodAogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICB3aWR0aDogYXZhaWxhYmxlU3BhY2Uud2lkdGggLSBtYXJnaW5ILAogICAgICAgIGhlaWdodDogYXZhaWxhYmxlU3BhY2UuaGVpZ2h0IC0gbWFyZ2luViAtIG5vZGVbJGV4dHJhXS5oZWlnaHQKICAgICAgfTsKICAgIGNhc2UgInJsLXJvdyI6CiAgICBjYXNlICJyb3ciOgogICAgICBjb25zdCB3aWR0aCA9IE1hdGguc3VtUHJlY2lzZShub2RlWyRleHRyYV0uY29sdW1uV2lkdGhzLnNsaWNlKG5vZGVbJGV4dHJhXS5jdXJyZW50Q29sdW1uKSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0OiBhdmFpbGFibGVTcGFjZS5oZWlnaHQgLSBtYXJnaW5ICiAgICAgIH07CiAgICBjYXNlICJ0YWJsZSI6CiAgICBjYXNlICJ0YiI6CiAgICAgIHJldHVybiB7CiAgICAgICAgd2lkdGg6IGF2YWlsYWJsZVNwYWNlLndpZHRoIC0gbWFyZ2luSCwKICAgICAgICBoZWlnaHQ6IGF2YWlsYWJsZVNwYWNlLmhlaWdodCAtIG1hcmdpblYgLSBub2RlWyRleHRyYV0uaGVpZ2h0CiAgICAgIH07CiAgICBjYXNlICJwb3NpdGlvbiI6CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gYXZhaWxhYmxlU3BhY2U7CiAgfQp9CmZ1bmN0aW9uIGdldFRyYW5zZm9ybWVkQkJveChub2RlKSB7CiAgbGV0IHcgPSBub2RlLncgPT09ICIiID8gTmFOIDogbm9kZS53OwogIGxldCBoID0gbm9kZS5oID09PSAiIiA/IE5hTiA6IG5vZGUuaDsKICBsZXQgW2NlbnRlclgsIGNlbnRlclldID0gWzAsIDBdOwogIHN3aXRjaCAobm9kZS5hbmNob3JUeXBlIHx8ICIiKSB7CiAgICBjYXNlICJib3R0b21DZW50ZXIiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbdyAvIDIsIGhdOwogICAgICBicmVhazsKICAgIGNhc2UgImJvdHRvbUxlZnQiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbMCwgaF07CiAgICAgIGJyZWFrOwogICAgY2FzZSAiYm90dG9tUmlnaHQiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbdywgaF07CiAgICAgIGJyZWFrOwogICAgY2FzZSAibWlkZGxlQ2VudGVyIjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3cgLyAyLCBoIC8gMl07CiAgICAgIGJyZWFrOwogICAgY2FzZSAibWlkZGxlTGVmdCI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFswLCBoIC8gMl07CiAgICAgIGJyZWFrOwogICAgY2FzZSAibWlkZGxlUmlnaHQiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbdywgaCAvIDJdOwogICAgICBicmVhazsKICAgIGNhc2UgInRvcENlbnRlciI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFt3IC8gMiwgMF07CiAgICAgIGJyZWFrOwogICAgY2FzZSAidG9wUmlnaHQiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbdywgMF07CiAgICAgIGJyZWFrOwogIH0KICBsZXQgeCwgeTsKICBzd2l0Y2ggKG5vZGUucm90YXRlIHx8IDApIHsKICAgIGNhc2UgMDoKICAgICAgW3gsIHldID0gWy1jZW50ZXJYLCAtY2VudGVyWV07CiAgICAgIGJyZWFrOwogICAgY2FzZSA5MDoKICAgICAgW3gsIHldID0gWy1jZW50ZXJZLCBjZW50ZXJYXTsKICAgICAgW3csIGhdID0gW2gsIC13XTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDE4MDoKICAgICAgW3gsIHldID0gW2NlbnRlclgsIGNlbnRlclldOwogICAgICBbdywgaF0gPSBbLXcsIC1oXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDI3MDoKICAgICAgW3gsIHldID0gW2NlbnRlclksIC1jZW50ZXJYXTsKICAgICAgW3csIGhdID0gWy1oLCB3XTsKICAgICAgYnJlYWs7CiAgfQogIHJldHVybiBbbm9kZS54ICsgeCArIE1hdGgubWluKDAsIHcpLCBub2RlLnkgKyB5ICsgTWF0aC5taW4oMCwgaCksIE1hdGguYWJzKHcpLCBNYXRoLmFicyhoKV07Cn0KZnVuY3Rpb24gY2hlY2tEaW1lbnNpb25zKG5vZGUsIHNwYWNlKSB7CiAgaWYgKG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLmZpcnN0VW5zcGxpdHRhYmxlID09PSBudWxsKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgaWYgKG5vZGUudyA9PT0gMCB8fCBub2RlLmggPT09IDApIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBjb25zdCBFUlJPUiA9IDI7CiAgY29uc3QgcGFyZW50ID0gbm9kZVskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICBjb25zdCBhdHRlbXB0ID0gcGFyZW50WyRleHRyYV0/LmF0dGVtcHQgfHwgMDsKICBjb25zdCBbLCB5LCB3LCBoXSA9IGdldFRyYW5zZm9ybWVkQkJveChub2RlKTsKICBzd2l0Y2ggKHBhcmVudC5sYXlvdXQpIHsKICAgIGNhc2UgImxyLXRiIjoKICAgIGNhc2UgInJsLXRiIjoKICAgICAgaWYgKGF0dGVtcHQgPT09IDApIHsKICAgICAgICBpZiAoIW5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSkgewogICAgICAgICAgaWYgKG5vZGUuaCAhPT0gIiIgJiYgTWF0aC5yb3VuZChoIC0gc3BhY2UuaGVpZ2h0KSA+IEVSUk9SKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChub2RlLncgIT09ICIiKSB7CiAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHcgLSBzcGFjZS53aWR0aCkgPD0gRVJST1IpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFyZW50WyRleHRyYV0ubnVtYmVySW5MaW5lID09PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHNwYWNlLmhlaWdodCA+IEVSUk9SOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzcGFjZS53aWR0aCA+IEVSUk9SOwogICAgICAgIH0KICAgICAgICBpZiAobm9kZS53ICE9PSAiIikgewogICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodyAtIHNwYWNlLndpZHRoKSA8PSBFUlJPUjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNwYWNlLndpZHRoID4gRVJST1I7CiAgICAgIH0KICAgICAgaWYgKG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChub2RlLmggIT09ICIiICYmIE1hdGgucm91bmQoaCAtIHNwYWNlLmhlaWdodCkgPiBFUlJPUikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAobm9kZS53ID09PSAiIiB8fCBNYXRoLnJvdW5kKHcgLSBzcGFjZS53aWR0aCkgPD0gRVJST1IpIHsKICAgICAgICByZXR1cm4gc3BhY2UuaGVpZ2h0ID4gRVJST1I7CiAgICAgIH0KICAgICAgaWYgKHBhcmVudFskaXNUaGVyZU1vcmVXaWR0aF0oKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gc3BhY2UuaGVpZ2h0ID4gRVJST1I7CiAgICBjYXNlICJ0YWJsZSI6CiAgICBjYXNlICJ0YiI6CiAgICAgIGlmIChub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpZiAobm9kZS5oICE9PSAiIiAmJiAhbm9kZVskaXNTcGxpdHRhYmxlXSgpKSB7CiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoaCAtIHNwYWNlLmhlaWdodCkgPD0gRVJST1I7CiAgICAgIH0KICAgICAgaWYgKG5vZGUudyA9PT0gIiIgfHwgTWF0aC5yb3VuZCh3IC0gc3BhY2Uud2lkdGgpIDw9IEVSUk9SKSB7CiAgICAgICAgcmV0dXJuIHNwYWNlLmhlaWdodCA+IEVSUk9SOwogICAgICB9CiAgICAgIGlmIChwYXJlbnRbJGlzVGhlcmVNb3JlV2lkdGhdKCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHNwYWNlLmhlaWdodCA+IEVSUk9SOwogICAgY2FzZSAicG9zaXRpb24iOgogICAgICBpZiAobm9kZVskZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG5vZGUuaCA9PT0gIiIgfHwgTWF0aC5yb3VuZChoICsgeSAtIHNwYWNlLmhlaWdodCkgPD0gRVJST1IpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBjb25zdCBhcmVhID0gbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0uY3VycmVudENvbnRlbnRBcmVhOwogICAgICByZXR1cm4gaCArIHkgPiBhcmVhLmg7CiAgICBjYXNlICJybC1yb3ciOgogICAgY2FzZSAicm93IjoKICAgICAgaWYgKG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChub2RlLmggIT09ICIiKSB7CiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoaCAtIHNwYWNlLmhlaWdodCkgPD0gRVJST1I7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS90ZW1wbGF0ZS5qcwoKCgoKCgoKCgoKY29uc3QgVEVNUExBVEVfTlNfSUQgPSBOYW1lc3BhY2VJZHMudGVtcGxhdGUuaWQ7CmNvbnN0IFNWR19OUyA9ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI7CmNvbnN0IE1BWF9BVFRFTVBUU19GT1JfTFJUQl9MQVlPVVQgPSAyOwpjb25zdCBNQVhfRU1QVFlfUEFHRVMgPSAzOwpjb25zdCBERUZBVUxUX1RBQl9JTkRFWCA9IDUwMDA7CmNvbnN0IEhFQURJTkdfUEFUVEVSTiA9IC9eSChcZCspJC87CmNvbnN0IE1JTUVTID0gbmV3IFNldChbImltYWdlL2dpZiIsICJpbWFnZS9qcGVnIiwgImltYWdlL2pwZyIsICJpbWFnZS9wanBlZyIsICJpbWFnZS9wbmciLCAiaW1hZ2UvYXBuZyIsICJpbWFnZS94LXBuZyIsICJpbWFnZS9ibXAiLCAiaW1hZ2UveC1tcy1ibXAiLCAiaW1hZ2UvdGlmZiIsICJpbWFnZS90aWYiLCAiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIl0pOwpjb25zdCBJTUFHRVNfSEVBREVSUyA9IFtbWzB4NDIsIDB4NGRdLCAiaW1hZ2UvYm1wIl0sIFtbMHhmZiwgMHhkOCwgMHhmZl0sICJpbWFnZS9qcGVnIl0sIFtbMHg0OSwgMHg0OSwgMHgyYSwgMHgwMF0sICJpbWFnZS90aWZmIl0sIFtbMHg0ZCwgMHg0ZCwgMHgwMCwgMHgyYV0sICJpbWFnZS90aWZmIl0sIFtbMHg0NywgMHg0OSwgMHg0NiwgMHgzOCwgMHgzOSwgMHg2MV0sICJpbWFnZS9naWYiXSwgW1sweDg5LCAweDUwLCAweDRlLCAweDQ3LCAweDBkLCAweDBhLCAweDFhLCAweDBhXSwgImltYWdlL3BuZyJdXTsKZnVuY3Rpb24gZ2V0Qm9yZGVyRGltcyhub2RlKSB7CiAgaWYgKCFub2RlIHx8ICFub2RlLmJvcmRlcikgewogICAgcmV0dXJuIHsKICAgICAgdzogMCwKICAgICAgaDogMAogICAgfTsKICB9CiAgY29uc3QgYm9yZGVyRXh0cmEgPSBub2RlLmJvcmRlclskZ2V0RXh0cmFdKCk7CiAgaWYgKCFib3JkZXJFeHRyYSkgewogICAgcmV0dXJuIHsKICAgICAgdzogMCwKICAgICAgaDogMAogICAgfTsKICB9CiAgcmV0dXJuIHsKICAgIHc6IGJvcmRlckV4dHJhLndpZHRoc1swXSArIGJvcmRlckV4dHJhLndpZHRoc1syXSArIGJvcmRlckV4dHJhLmluc2V0c1swXSArIGJvcmRlckV4dHJhLmluc2V0c1syXSwKICAgIGg6IGJvcmRlckV4dHJhLndpZHRoc1sxXSArIGJvcmRlckV4dHJhLndpZHRoc1szXSArIGJvcmRlckV4dHJhLmluc2V0c1sxXSArIGJvcmRlckV4dHJhLmluc2V0c1szXQogIH07Cn0KZnVuY3Rpb24gaGFzTWFyZ2luKG5vZGUpIHsKICByZXR1cm4gbm9kZS5tYXJnaW4gJiYgKG5vZGUubWFyZ2luLnRvcEluc2V0IHx8IG5vZGUubWFyZ2luLnJpZ2h0SW5zZXQgfHwgbm9kZS5tYXJnaW4uYm90dG9tSW5zZXQgfHwgbm9kZS5tYXJnaW4ubGVmdEluc2V0KTsKfQpmdW5jdGlvbiBfc2V0VmFsdWUodGVtcGxhdGVOb2RlLCB2YWx1ZSkgewogIGlmICghdGVtcGxhdGVOb2RlLnZhbHVlKSB7CiAgICBjb25zdCBub2RlVmFsdWUgPSBuZXcgVmFsdWUoe30pOwogICAgdGVtcGxhdGVOb2RlWyRhcHBlbmRDaGlsZF0obm9kZVZhbHVlKTsKICAgIHRlbXBsYXRlTm9kZS52YWx1ZSA9IG5vZGVWYWx1ZTsKICB9CiAgdGVtcGxhdGVOb2RlLnZhbHVlWyRzZXRWYWx1ZV0odmFsdWUpOwp9CmZ1bmN0aW9uKiBnZXRDb250YWluZWRDaGlsZHJlbihub2RlKSB7CiAgZm9yIChjb25zdCBjaGlsZCBvZiBub2RlWyRnZXRDaGlsZHJlbl0oKSkgewogICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgU3ViZm9ybVNldCkgewogICAgICB5aWVsZCogY2hpbGRbJGdldENvbnRhaW5lZENoaWxkcmVuXSgpOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHlpZWxkIGNoaWxkOwogIH0KfQpmdW5jdGlvbiBpc1JlcXVpcmVkKG5vZGUpIHsKICByZXR1cm4gbm9kZS52YWxpZGF0ZT8ubnVsbFRlc3QgPT09ICJlcnJvciI7Cn0KZnVuY3Rpb24gc2V0VGFiSW5kZXgobm9kZSkgewogIHdoaWxlIChub2RlKSB7CiAgICBpZiAoIW5vZGUudHJhdmVyc2FsKSB7CiAgICAgIG5vZGVbJHRhYkluZGV4XSA9IG5vZGVbJGdldFBhcmVudF0oKVskdGFiSW5kZXhdOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAobm9kZVskdGFiSW5kZXhdKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBuZXh0ID0gbnVsbDsKICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS50cmF2ZXJzYWxbJGdldENoaWxkcmVuXSgpKSB7CiAgICAgIGlmIChjaGlsZC5vcGVyYXRpb24gPT09ICJuZXh0IikgewogICAgICAgIG5leHQgPSBjaGlsZDsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKCFuZXh0IHx8ICFuZXh0LnJlZikgewogICAgICBub2RlWyR0YWJJbmRleF0gPSBub2RlWyRnZXRQYXJlbnRdKClbJHRhYkluZGV4XTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgcm9vdCA9IG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKTsKICAgIG5vZGVbJHRhYkluZGV4XSA9ICsrcm9vdFskdGFiSW5kZXhdOwogICAgY29uc3QgcmVmID0gcm9vdFskc2VhcmNoTm9kZV0obmV4dC5yZWYsIG5vZGUpOwogICAgaWYgKCFyZWYpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbm9kZSA9IHJlZlswXTsKICB9Cn0KZnVuY3Rpb24gYXBwbHlBc3Npc3Qob2JqLCBhdHRyaWJ1dGVzKSB7CiAgY29uc3QgYXNzaXN0ID0gb2JqLmFzc2lzdDsKICBpZiAoYXNzaXN0KSB7CiAgICBjb25zdCBhc3Npc3RUaXRsZSA9IGFzc2lzdFskdG9IVE1MXSgpOwogICAgaWYgKGFzc2lzdFRpdGxlKSB7CiAgICAgIGF0dHJpYnV0ZXMudGl0bGUgPSBhc3Npc3RUaXRsZTsKICAgIH0KICAgIGNvbnN0IHJvbGUgPSBhc3Npc3Qucm9sZTsKICAgIGNvbnN0IG1hdGNoID0gcm9sZS5tYXRjaChIRUFESU5HX1BBVFRFUk4pOwogICAgaWYgKG1hdGNoKSB7CiAgICAgIGNvbnN0IGFyaWFSb2xlID0gImhlYWRpbmciOwogICAgICBjb25zdCBhcmlhTGV2ZWwgPSBtYXRjaFsxXTsKICAgICAgYXR0cmlidXRlcy5yb2xlID0gYXJpYVJvbGU7CiAgICAgIGF0dHJpYnV0ZXNbImFyaWEtbGV2ZWwiXSA9IGFyaWFMZXZlbDsKICAgIH0KICB9CiAgaWYgKG9iai5sYXlvdXQgPT09ICJ0YWJsZSIpIHsKICAgIGF0dHJpYnV0ZXMucm9sZSA9ICJ0YWJsZSI7CiAgfSBlbHNlIGlmIChvYmoubGF5b3V0ID09PSAicm93IikgewogICAgYXR0cmlidXRlcy5yb2xlID0gInJvdyI7CiAgfSBlbHNlIHsKICAgIGNvbnN0IHBhcmVudCA9IG9ialskZ2V0UGFyZW50XSgpOwogICAgaWYgKHBhcmVudC5sYXlvdXQgPT09ICJyb3ciKSB7CiAgICAgIGF0dHJpYnV0ZXMucm9sZSA9IHBhcmVudC5hc3Npc3Q/LnJvbGUgPT09ICJUSCIgPyAiY29sdW1uaGVhZGVyIiA6ICJjZWxsIjsKICAgIH0KICB9Cn0KZnVuY3Rpb24gYXJpYUxhYmVsKG9iaikgewogIGlmICghb2JqLmFzc2lzdCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGFzc2lzdCA9IG9iai5hc3Npc3Q7CiAgaWYgKGFzc2lzdC5zcGVhayAmJiBhc3Npc3Quc3BlYWtbJGNvbnRlbnRdICE9PSAiIikgewogICAgcmV0dXJuIGFzc2lzdC5zcGVha1skY29udGVudF07CiAgfQogIGlmIChhc3Npc3QudG9vbFRpcCkgewogICAgcmV0dXJuIGFzc2lzdC50b29sVGlwWyRjb250ZW50XTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gdmFsdWVUb0h0bWwodmFsdWUpIHsKICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgIG5hbWU6ICJkaXYiLAogICAgYXR0cmlidXRlczogewogICAgICBjbGFzczogWyJ4ZmFSaWNoIl0sCiAgICAgIHN0eWxlOiBPYmplY3QuY3JlYXRlKG51bGwpCiAgICB9LAogICAgY2hpbGRyZW46IFt7CiAgICAgIG5hbWU6ICJzcGFuIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHN0eWxlOiBPYmplY3QuY3JlYXRlKG51bGwpCiAgICAgIH0sCiAgICAgIHZhbHVlCiAgICB9XQogIH0pOwp9CmZ1bmN0aW9uIHNldEZpcnN0VW5zcGxpdHRhYmxlKG5vZGUpIHsKICBjb25zdCByb290ID0gbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpOwogIGlmIChyb290WyRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPT09IG51bGwpIHsKICAgIHJvb3RbJGV4dHJhXS5maXJzdFVuc3BsaXR0YWJsZSA9IG5vZGU7CiAgICByb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlID0gdHJ1ZTsKICB9Cn0KZnVuY3Rpb24gdW5zZXRGaXJzdFVuc3BsaXR0YWJsZShub2RlKSB7CiAgY29uc3Qgcm9vdCA9IG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKTsKICBpZiAocm9vdFskZXh0cmFdLmZpcnN0VW5zcGxpdHRhYmxlID09PSBub2RlKSB7CiAgICByb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlID0gZmFsc2U7CiAgfQp9CmZ1bmN0aW9uIGhhbmRsZUJyZWFrKG5vZGUpIHsKICBpZiAobm9kZVskZXh0cmFdKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIG5vZGVbJGV4dHJhXSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgaWYgKG5vZGUudGFyZ2V0VHlwZSA9PT0gImF1dG8iKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbnN0IHJvb3QgPSBub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgbGV0IHRhcmdldCA9IG51bGw7CiAgaWYgKG5vZGUudGFyZ2V0KSB7CiAgICB0YXJnZXQgPSByb290WyRzZWFyY2hOb2RlXShub2RlLnRhcmdldCwgbm9kZVskZ2V0UGFyZW50XSgpKTsKICAgIGlmICghdGFyZ2V0KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRhcmdldCA9IHRhcmdldFswXTsKICB9CiAgY29uc3QgewogICAgY3VycmVudFBhZ2VBcmVhLAogICAgY3VycmVudENvbnRlbnRBcmVhCiAgfSA9IHJvb3RbJGV4dHJhXTsKICBpZiAobm9kZS50YXJnZXRUeXBlID09PSAicGFnZUFyZWEiKSB7CiAgICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBQYWdlQXJlYSkpIHsKICAgICAgdGFyZ2V0ID0gbnVsbDsKICAgIH0KICAgIGlmIChub2RlLnN0YXJ0TmV3KSB7CiAgICAgIG5vZGVbJGV4dHJhXS50YXJnZXQgPSB0YXJnZXQgfHwgY3VycmVudFBhZ2VBcmVhOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSBpZiAodGFyZ2V0ICYmIHRhcmdldCAhPT0gY3VycmVudFBhZ2VBcmVhKSB7CiAgICAgIG5vZGVbJGV4dHJhXS50YXJnZXQgPSB0YXJnZXQ7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBDb250ZW50QXJlYSkpIHsKICAgIHRhcmdldCA9IG51bGw7CiAgfQogIGNvbnN0IHBhZ2VBcmVhID0gdGFyZ2V0ICYmIHRhcmdldFskZ2V0UGFyZW50XSgpOwogIGxldCBpbmRleDsKICBsZXQgbmV4dFBhZ2VBcmVhID0gcGFnZUFyZWE7CiAgaWYgKG5vZGUuc3RhcnROZXcpIHsKICAgIGlmICh0YXJnZXQpIHsKICAgICAgY29uc3QgY29udGVudEFyZWFzID0gcGFnZUFyZWEuY29udGVudEFyZWEuY2hpbGRyZW47CiAgICAgIGNvbnN0IGluZGV4Rm9yQ3VycmVudCA9IGNvbnRlbnRBcmVhcy5pbmRleE9mKGN1cnJlbnRDb250ZW50QXJlYSk7CiAgICAgIGNvbnN0IGluZGV4Rm9yVGFyZ2V0ID0gY29udGVudEFyZWFzLmluZGV4T2YodGFyZ2V0KTsKICAgICAgaWYgKGluZGV4Rm9yQ3VycmVudCAhPT0gLTEgJiYgaW5kZXhGb3JDdXJyZW50IDwgaW5kZXhGb3JUYXJnZXQpIHsKICAgICAgICBuZXh0UGFnZUFyZWEgPSBudWxsOwogICAgICB9CiAgICAgIGluZGV4ID0gaW5kZXhGb3JUYXJnZXQgLSAxOwogICAgfSBlbHNlIHsKICAgICAgaW5kZXggPSBjdXJyZW50UGFnZUFyZWEuY29udGVudEFyZWEuY2hpbGRyZW4uaW5kZXhPZihjdXJyZW50Q29udGVudEFyZWEpOwogICAgfQogIH0gZWxzZSBpZiAodGFyZ2V0ICYmIHRhcmdldCAhPT0gY3VycmVudENvbnRlbnRBcmVhKSB7CiAgICBjb25zdCBjb250ZW50QXJlYXMgPSBwYWdlQXJlYS5jb250ZW50QXJlYS5jaGlsZHJlbjsKICAgIGluZGV4ID0gY29udGVudEFyZWFzLmluZGV4T2YodGFyZ2V0KSAtIDE7CiAgICBuZXh0UGFnZUFyZWEgPSBwYWdlQXJlYSA9PT0gY3VycmVudFBhZ2VBcmVhID8gbnVsbCA6IHBhZ2VBcmVhOwogIH0gZWxzZSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIG5vZGVbJGV4dHJhXS50YXJnZXQgPSBuZXh0UGFnZUFyZWE7CiAgbm9kZVskZXh0cmFdLmluZGV4ID0gaW5kZXg7CiAgcmV0dXJuIHRydWU7Cn0KZnVuY3Rpb24gaGFuZGxlT3ZlcmZsb3cobm9kZSwgZXh0cmFOb2RlLCBzcGFjZSkgewogIGNvbnN0IHJvb3QgPSBub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgY29uc3Qgc2F2ZWQgPSByb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlOwogIGNvbnN0IHNhdmVkTWV0aG9kID0gZXh0cmFOb2RlWyRnZXRTdWJmb3JtUGFyZW50XTsKICBleHRyYU5vZGVbJGdldFN1YmZvcm1QYXJlbnRdID0gKCkgPT4gbm9kZTsKICByb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlID0gdHJ1ZTsKICBjb25zdCByZXMgPSBleHRyYU5vZGVbJHRvSFRNTF0oc3BhY2UpOwogIG5vZGVbJGFkZEhUTUxdKHJlcy5odG1sLCByZXMuYmJveCk7CiAgcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHNhdmVkOwogIGV4dHJhTm9kZVskZ2V0U3ViZm9ybVBhcmVudF0gPSBzYXZlZE1ldGhvZDsKfQpjbGFzcyBBcHBlYXJhbmNlRmlsdGVyIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImFwcGVhcmFuY2VGaWx0ZXIiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEFyYyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJhcmMiLCB0cnVlKTsKICAgIHRoaXMuY2lyY3VsYXIgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5jaXJjdWxhciwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuaGFuZCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhhbmQsIFsiZXZlbiIsICJsZWZ0IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnN0YXJ0QW5nbGUgPSBnZXRGbG9hdCh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuc3RhcnRBbmdsZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMuc3dlZXBBbmdsZSA9IGdldEZsb2F0KHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zd2VlcEFuZ2xlLAogICAgICBkZWZhdWx0VmFsdWU6IDM2MCwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5lZGdlID0gbnVsbDsKICAgIHRoaXMuZmlsbCA9IG51bGw7CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIGNvbnN0IGVkZ2UgPSB0aGlzLmVkZ2UgfHwgbmV3IEVkZ2Uoe30pOwogICAgY29uc3QgZWRnZVN0eWxlID0gZWRnZVskdG9TdHlsZV0oKTsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzLmZpbGw/LnByZXNlbmNlID09PSAidmlzaWJsZSIpIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgdGhpcy5maWxsWyR0b1N0eWxlXSgpKTsKICAgIH0gZWxzZSB7CiAgICAgIHN0eWxlLmZpbGwgPSAidHJhbnNwYXJlbnQiOwogICAgfQogICAgc3R5bGUuc3Ryb2tlV2lkdGggPSBtZWFzdXJlVG9TdHJpbmcoZWRnZS5wcmVzZW5jZSA9PT0gInZpc2libGUiID8gZWRnZS50aGlja25lc3MgOiAwKTsKICAgIHN0eWxlLnN0cm9rZSA9IGVkZ2VTdHlsZS5jb2xvcjsKICAgIGxldCBhcmM7CiAgICBjb25zdCBhdHRyaWJ1dGVzID0gewogICAgICB4bWxuczogU1ZHX05TLAogICAgICBzdHlsZTogewogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgaGVpZ2h0OiAiMTAwJSIsCiAgICAgICAgb3ZlcmZsb3c6ICJ2aXNpYmxlIgogICAgICB9CiAgICB9OwogICAgaWYgKHRoaXMuc3dlZXBBbmdsZSA9PT0gMzYwKSB7CiAgICAgIGFyYyA9IHsKICAgICAgICBuYW1lOiAiZWxsaXBzZSIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgICAgIGN4OiAiNTAlIiwKICAgICAgICAgIGN5OiAiNTAlIiwKICAgICAgICAgIHJ4OiAiNTAlIiwKICAgICAgICAgIHJ5OiAiNTAlIiwKICAgICAgICAgIHN0eWxlCiAgICAgICAgfQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgY29uc3Qgc3RhcnRBbmdsZSA9IHRoaXMuc3RhcnRBbmdsZSAqIE1hdGguUEkgLyAxODA7CiAgICAgIGNvbnN0IHN3ZWVwQW5nbGUgPSB0aGlzLnN3ZWVwQW5nbGUgKiBNYXRoLlBJIC8gMTgwOwogICAgICBjb25zdCBsYXJnZUFyYyA9IHRoaXMuc3dlZXBBbmdsZSA+IDE4MCA/IDEgOiAwOwogICAgICBjb25zdCBbeDEsIHkxLCB4MiwgeTJdID0gWzUwICogKDEgKyBNYXRoLmNvcyhzdGFydEFuZ2xlKSksIDUwICogKDEgLSBNYXRoLnNpbihzdGFydEFuZ2xlKSksIDUwICogKDEgKyBNYXRoLmNvcyhzdGFydEFuZ2xlICsgc3dlZXBBbmdsZSkpLCA1MCAqICgxIC0gTWF0aC5zaW4oc3RhcnRBbmdsZSArIHN3ZWVwQW5nbGUpKV07CiAgICAgIGFyYyA9IHsKICAgICAgICBuYW1lOiAicGF0aCIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgICAgIGQ6IGBNICR7eDF9ICR7eTF9IEEgNTAgNTAgMCAke2xhcmdlQXJjfSAwICR7eDJ9ICR7eTJ9YCwKICAgICAgICAgIHZlY3RvckVmZmVjdDogIm5vbi1zY2FsaW5nLXN0cm9rZSIsCiAgICAgICAgICBzdHlsZQogICAgICAgIH0KICAgICAgfTsKICAgICAgT2JqZWN0LmFzc2lnbihhdHRyaWJ1dGVzLCB7CiAgICAgICAgdmlld0JveDogIjAgMCAxMDAgMTAwIiwKICAgICAgICBwcmVzZXJ2ZUFzcGVjdFJhdGlvOiAibm9uZSIKICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBzdmcgPSB7CiAgICAgIG5hbWU6ICJzdmciLAogICAgICBjaGlsZHJlbjogW2FyY10sCiAgICAgIGF0dHJpYnV0ZXMKICAgIH07CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldFBhcmVudF0oKTsKICAgIGlmIChoYXNNYXJnaW4ocGFyZW50KSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lIiwKICAgICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgICAgaGVpZ2h0OiAiMTAwJSIKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNoaWxkcmVuOiBbc3ZnXQogICAgICB9KTsKICAgIH0KICAgIHN2Zy5hdHRyaWJ1dGVzLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3Moc3ZnKTsKICB9Cn0KY2xhc3MgQXJlYSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJhcmVhIiwgdHJ1ZSk7CiAgICB0aGlzLmNvbFNwYW4gPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5jb2xTcGFuLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPj0gMSB8fCBuID09PSAtMQogICAgfSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLngsICIwcHQiKTsKICAgIHRoaXMueSA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueSwgIjBwdCIpOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuYXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kcmF3ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4T2JqZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4Y2xHcm91cCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWVsZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm1TZXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgKlskZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCkgewogICAgeWllbGQqIGdldENvbnRhaW5lZENoaWxkcmVuKHRoaXMpOwogIH0KICBbJGlzVHJhbnNwYXJlbnRdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskaXNCaW5kYWJsZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRhZGRIVE1MXShodG1sLCBiYm94KSB7CiAgICBjb25zdCBbeCwgeSwgdywgaF0gPSBiYm94OwogICAgdGhpc1skZXh0cmFdLndpZHRoID0gTWF0aC5tYXgodGhpc1skZXh0cmFdLndpZHRoLCB4ICsgdyk7CiAgICB0aGlzWyRleHRyYV0uaGVpZ2h0ID0gTWF0aC5tYXgodGhpc1skZXh0cmFdLmhlaWdodCwgeSArIGgpOwogICAgdGhpc1skZXh0cmFdLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgfQogIFskZ2V0QXZhaWxhYmxlU3BhY2VdKCkgewogICAgcmV0dXJuIHRoaXNbJGV4dHJhXS5hdmFpbGFibGVTcGFjZTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgInBvc2l0aW9uIik7CiAgICBjb25zdCBhdHRyaWJ1dGVzID0gewogICAgICBzdHlsZSwKICAgICAgaWQ6IHRoaXNbJHVpZF0sCiAgICAgIGNsYXNzOiBbInhmYUFyZWEiXQogICAgfTsKICAgIGlmIChpc1ByaW50T25seSh0aGlzKSkgewogICAgICBhdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYVByaW50T25seSIpOwogICAgfQogICAgaWYgKHRoaXMubmFtZSkgewogICAgICBhdHRyaWJ1dGVzLnhmYU5hbWUgPSB0aGlzLm5hbWU7CiAgICB9CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgdGhpc1skZXh0cmFdID0gewogICAgICBjaGlsZHJlbiwKICAgICAgd2lkdGg6IDAsCiAgICAgIGhlaWdodDogMCwKICAgICAgYXZhaWxhYmxlU3BhY2UKICAgIH07CiAgICBjb25zdCByZXN1bHQgPSB0aGlzWyRjaGlsZHJlblRvSFRNTF0oewogICAgICBmaWx0ZXI6IG5ldyBTZXQoWyJhcmVhIiwgImRyYXciLCAiZmllbGQiLCAiZXhjbEdyb3VwIiwgInN1YmZvcm0iLCAic3ViZm9ybVNldCJdKSwKICAgICAgaW5jbHVkZTogdHJ1ZQogICAgfSk7CiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7CiAgICAgIGlmIChyZXN1bHQuaXNCcmVhaygpKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICBkZWxldGUgdGhpc1skZXh0cmFdOwogICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgfQogICAgc3R5bGUud2lkdGggPSBtZWFzdXJlVG9TdHJpbmcodGhpc1skZXh0cmFdLndpZHRoKTsKICAgIHN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzWyRleHRyYV0uaGVpZ2h0KTsKICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBjaGlsZHJlbgogICAgfTsKICAgIGNvbnN0IGJib3ggPSBbdGhpcy54LCB0aGlzLnksIHRoaXNbJGV4dHJhXS53aWR0aCwgdGhpc1skZXh0cmFdLmhlaWdodF07CiAgICBkZWxldGUgdGhpc1skZXh0cmFdOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhodG1sLCBiYm94KTsKICB9Cn0KY2xhc3MgQXNzaXN0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImFzc2lzdCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnJvbGUgPSBhdHRyaWJ1dGVzLnJvbGUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5zcGVhayA9IG51bGw7CiAgICB0aGlzLnRvb2xUaXAgPSBudWxsOwogIH0KICBbJHRvSFRNTF0oKSB7CiAgICByZXR1cm4gdGhpcy50b29sVGlwPy5bJGNvbnRlbnRdIHx8IG51bGw7CiAgfQp9CmNsYXNzIEJhcmNvZGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYmFyY29kZSIsIHRydWUpOwogICAgdGhpcy5jaGFyRW5jb2RpbmcgPSBnZXRLZXl3b3JkKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5jaGFyRW5jb2RpbmcgPyBhdHRyaWJ1dGVzLmNoYXJFbmNvZGluZy50b0xvd2VyQ2FzZSgpIDogIiIsCiAgICAgIGRlZmF1bHRWYWx1ZTogIiIsCiAgICAgIHZhbGlkYXRlOiBrID0+IFsidXRmLTgiLCAiYmlnLWZpdmUiLCAiZm9udHNwZWNpZmljIiwgImdiayIsICJnYi0xODAzMCIsICJnYi0yMzEyIiwgImtzYy01NjAxIiwgIm5vbmUiLCAic2hpZnQtamlzIiwgInVjcy0yIiwgInV0Zi0xNiJdLmluY2x1ZGVzKGspIHx8IGsubWF0Y2goL2lzby04ODU5LVxkezJ9LykKICAgIH0pOwogICAgdGhpcy5jaGVja3N1bSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmNoZWNrc3VtLCBbIm5vbmUiLCAiMW1vZDEwIiwgIjFtb2QxMF8xbW9kMTEiLCAiMm1vZDEwIiwgImF1dG8iXSk7CiAgICB0aGlzLmRhdGFDb2x1bW5Db3VudCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmRhdGFDb2x1bW5Db3VudCwKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMuZGF0YUxlbmd0aCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmRhdGFMZW5ndGgsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmRhdGFQcmVwID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZGF0YVByZXAsIFsibm9uZSIsICJmbGF0ZUNvbXByZXNzIl0pOwogICAgdGhpcy5kYXRhUm93Q291bnQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5kYXRhUm93Q291bnQsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmVuZENoYXIgPSBhdHRyaWJ1dGVzLmVuZENoYXIgfHwgIiI7CiAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWwsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMCAmJiB4IDw9IDgKICAgIH0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm1vZHVsZUhlaWdodCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubW9kdWxlSGVpZ2h0LCAiNW1tIik7CiAgICB0aGlzLm1vZHVsZVdpZHRoID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tb2R1bGVXaWR0aCwgIjAuMjVtbSIpOwogICAgdGhpcy5wcmludENoZWNrRGlnaXQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5wcmludENoZWNrRGlnaXQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnJvd0NvbHVtblJhdGlvID0gZ2V0UmF0aW8oYXR0cmlidXRlcy5yb3dDb2x1bW5SYXRpbyk7CiAgICB0aGlzLnN0YXJ0Q2hhciA9IGF0dHJpYnV0ZXMuc3RhcnRDaGFyIHx8ICIiOwogICAgdGhpcy50ZXh0TG9jYXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50ZXh0TG9jYXRpb24sIFsiYmVsb3ciLCAiYWJvdmUiLCAiYWJvdmVFbWJlZGRlZCIsICJiZWxvd0VtYmVkZGVkIiwgIm5vbmUiXSk7CiAgICB0aGlzLnRydW5jYXRlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMudHJ1bmNhdGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlID8gYXR0cmlidXRlcy50eXBlLnRvTG93ZXJDYXNlKCkgOiAiIiwgWyJhenRlYyIsICJjb2RhYmFyIiwgImNvZGUyb2Y1aW5kdXN0cmlhbCIsICJjb2RlMm9mNWludGVybGVhdmVkIiwgImNvZGUyb2Y1bWF0cml4IiwgImNvZGUyb2Y1c3RhbmRhcmQiLCAiY29kZTNvZjkiLCAiY29kZTNvZjlleHRlbmRlZCIsICJjb2RlMTEiLCAiY29kZTQ5IiwgImNvZGU5MyIsICJjb2RlMTI4IiwgImNvZGUxMjhhIiwgImNvZGUxMjhiIiwgImNvZGUxMjhjIiwgImNvZGUxMjhzc2NjIiwgImRhdGFtYXRyaXgiLCAiZWFuOCIsICJlYW44YWRkMiIsICJlYW44YWRkNSIsICJlYW4xMyIsICJlYW4xM2FkZDIiLCAiZWFuMTNhZGQ1IiwgImVhbjEzcHdjZCIsICJmaW0iLCAibG9nbWFycyIsICJtYXhpY29kZSIsICJtc2kiLCAicGRmNDE3IiwgInBkZjQxN21hY3JvIiwgInBsZXNzZXkiLCAicG9zdGF1c2N1c3QyIiwgInBvc3RhdXNjdXN0MyIsICJwb3N0YXVzcmVwbHlwYWlkIiwgInBvc3RhdXNzdGFuZGFyZCIsICJwb3N0dWtybTRzY2MiLCAicG9zdHVzZHBiYyIsICJwb3N0dXNpbWIiLCAicG9zdHVzc3RhbmRhcmQiLCAicG9zdHVzNXppcCIsICJxcmNvZGUiLCAicmZpZCIsICJyc3MxNCIsICJyc3MxNGV4cGFuZGVkIiwgInJzczE0bGltaXRlZCIsICJyc3MxNHN0YWNrZWQiLCAicnNzMTRzdGFja2Vkb21uaSIsICJyc3MxNHRydW5jYXRlZCIsICJ0ZWxlcGVuIiwgInVjYzEyOCIsICJ1Y2MxMjhyYW5kb20iLCAidWNjMTI4c3NjYyIsICJ1cGNhIiwgInVwY2FhZGQyIiwgInVwY2FhZGQ1IiwgInVwY2Fwd2NkIiwgInVwY2UiLCAidXBjZWFkZDIiLCAidXBjZWFkZDUiLCAidXBjZWFuMiIsICJ1cGNlYW41IiwgInVwc21heGljb2RlIl0pOwogICAgdGhpcy51cHNNb2RlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudXBzTW9kZSwgWyJ1c0NhcnJpZXIiLCAiaW50ZXJuYXRpb25hbENhcnJpZXIiLCAic2VjdXJlU3ltYm9sIiwgInN0YW5kYXJkU3ltYm9sIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMud2lkZU5hcnJvd1JhdGlvID0gZ2V0UmF0aW8oYXR0cmlidXRlcy53aWRlTmFycm93UmF0aW8pOwogICAgdGhpcy5lbmNyeXB0ID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9Cn0KY2xhc3MgQmluZCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJiaW5kIiwgdHJ1ZSk7CiAgICB0aGlzLm1hdGNoID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubWF0Y2gsIFsib25jZSIsICJkYXRhUmVmIiwgImdsb2JhbCIsICJub25lIl0pOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMucGljdHVyZSA9IG51bGw7CiAgfQp9CmNsYXNzIEJpbmRJdGVtcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJiaW5kSXRlbXMiKTsKICAgIHRoaXMuY29ubmVjdGlvbiA9IGF0dHJpYnV0ZXMuY29ubmVjdGlvbiB8fCAiIjsKICAgIHRoaXMubGFiZWxSZWYgPSBhdHRyaWJ1dGVzLmxhYmVsUmVmIHx8ICIiOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudmFsdWVSZWYgPSBhdHRyaWJ1dGVzLnZhbHVlUmVmIHx8ICIiOwogIH0KfQpjbGFzcyBCb29rZW5kIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJvb2tlbmQiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sZWFkZXIgPSBhdHRyaWJ1dGVzLmxlYWRlciB8fCAiIjsKICAgIHRoaXMudHJhaWxlciA9IGF0dHJpYnV0ZXMudHJhaWxlciB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEJvb2xlYW5FbGVtZW50IGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYm9vbGVhbiIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiB2YWx1ZVRvSHRtbCh0aGlzWyRjb250ZW50XSA9PT0gMSA/ICIxIiA6ICIwIik7CiAgfQp9CmNsYXNzIEJvcmRlciBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJib3JkZXIiLCB0cnVlKTsKICAgIHRoaXMuYnJlYWsgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5icmVhaywgWyJjbG9zZSIsICJvcGVuIl0pOwogICAgdGhpcy5oYW5kID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaGFuZCwgWyJldmVuIiwgImxlZnQiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb3JuZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoNCk7CiAgICB0aGlzLmVkZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoNCk7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmZpbGwgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbJGdldEV4dHJhXSgpIHsKICAgIGlmICghdGhpc1skZXh0cmFdKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy5lZGdlLmNoaWxkcmVuLnNsaWNlKCk7CiAgICAgIGlmIChlZGdlcy5sZW5ndGggPCA0KSB7CiAgICAgICAgY29uc3QgZGVmYXVsdEVkZ2UgPSBlZGdlcy5hdCgtMSkgfHwgbmV3IEVkZ2Uoe30pOwogICAgICAgIGZvciAobGV0IGkgPSBlZGdlcy5sZW5ndGg7IGkgPCA0OyBpKyspIHsKICAgICAgICAgIGVkZ2VzLnB1c2goZGVmYXVsdEVkZ2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCB3aWR0aHMgPSBlZGdlcy5tYXAoZWRnZSA9PiBlZGdlLnRoaWNrbmVzcyk7CiAgICAgIGNvbnN0IGluc2V0cyA9IFswLCAwLCAwLCAwXTsKICAgICAgaWYgKHRoaXMubWFyZ2luKSB7CiAgICAgICAgaW5zZXRzWzBdID0gdGhpcy5tYXJnaW4udG9wSW5zZXQ7CiAgICAgICAgaW5zZXRzWzFdID0gdGhpcy5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgICBpbnNldHNbMl0gPSB0aGlzLm1hcmdpbi5ib3R0b21JbnNldDsKICAgICAgICBpbnNldHNbM10gPSB0aGlzLm1hcmdpbi5sZWZ0SW5zZXQ7CiAgICAgIH0KICAgICAgdGhpc1skZXh0cmFdID0gewogICAgICAgIHdpZHRocywKICAgICAgICBpbnNldHMsCiAgICAgICAgZWRnZXMKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB0aGlzWyRleHRyYV07CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICBjb25zdCB7CiAgICAgIGVkZ2VzCiAgICB9ID0gdGhpc1skZ2V0RXh0cmFdKCk7CiAgICBjb25zdCBlZGdlU3R5bGVzID0gZWRnZXMubWFwKG5vZGUgPT4gewogICAgICBjb25zdCBzdHlsZSA9IG5vZGVbJHRvU3R5bGVdKCk7CiAgICAgIHN0eWxlLmNvbG9yIHx8PSAiIzAwMDAwMCI7CiAgICAgIHJldHVybiBzdHlsZTsKICAgIH0pOwogICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKHRoaXMubWFyZ2luKSB7CiAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIHRoaXMubWFyZ2luWyR0b1N0eWxlXSgpKTsKICAgIH0KICAgIGlmICh0aGlzLmZpbGw/LnByZXNlbmNlID09PSAidmlzaWJsZSIpIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgdGhpcy5maWxsWyR0b1N0eWxlXSgpKTsKICAgIH0KICAgIGlmICh0aGlzLmNvcm5lci5jaGlsZHJlbi5zb21lKG5vZGUgPT4gbm9kZS5yYWRpdXMgIT09IDApKSB7CiAgICAgIGNvbnN0IGNvcm5lclN0eWxlcyA9IHRoaXMuY29ybmVyLmNoaWxkcmVuLm1hcChub2RlID0+IG5vZGVbJHRvU3R5bGVdKCkpOwogICAgICBpZiAoY29ybmVyU3R5bGVzLmxlbmd0aCA9PT0gMiB8fCBjb3JuZXJTdHlsZXMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgY29uc3QgbGFzdCA9IGNvcm5lclN0eWxlcy5hdCgtMSk7CiAgICAgICAgZm9yIChsZXQgaSA9IGNvcm5lclN0eWxlcy5sZW5ndGg7IGkgPCA0OyBpKyspIHsKICAgICAgICAgIGNvcm5lclN0eWxlcy5wdXNoKGxhc3QpOwogICAgICAgIH0KICAgICAgfQogICAgICBzdHlsZS5ib3JkZXJSYWRpdXMgPSBjb3JuZXJTdHlsZXMubWFwKHMgPT4gcy5yYWRpdXMpLmpvaW4oIiAiKTsKICAgIH0KICAgIHN3aXRjaCAodGhpcy5wcmVzZW5jZSkgewogICAgICBjYXNlICJpbnZpc2libGUiOgogICAgICBjYXNlICJoaWRkZW4iOgogICAgICAgIHN0eWxlLmJvcmRlclN0eWxlID0gIiI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImluYWN0aXZlIjoKICAgICAgICBzdHlsZS5ib3JkZXJTdHlsZSA9ICJub25lIjsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBzdHlsZS5ib3JkZXJTdHlsZSA9IGVkZ2VTdHlsZXMubWFwKHMgPT4gcy5zdHlsZSkuam9pbigiICIpOwogICAgICAgIGJyZWFrOwogICAgfQogICAgc3R5bGUuYm9yZGVyV2lkdGggPSBlZGdlU3R5bGVzLm1hcChzID0+IHMud2lkdGgpLmpvaW4oIiAiKTsKICAgIHN0eWxlLmJvcmRlckNvbG9yID0gZWRnZVN0eWxlcy5tYXAocyA9PiBzLmNvbG9yKS5qb2luKCIgIik7CiAgICByZXR1cm4gc3R5bGU7CiAgfQp9CmNsYXNzIEJyZWFrIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJyZWFrIiwgdHJ1ZSk7CiAgICB0aGlzLmFmdGVyID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYWZ0ZXIsIFsiYXV0byIsICJjb250ZW50QXJlYSIsICJwYWdlQXJlYSIsICJwYWdlRXZlbiIsICJwYWdlT2RkIl0pOwogICAgdGhpcy5hZnRlclRhcmdldCA9IGF0dHJpYnV0ZXMuYWZ0ZXJUYXJnZXQgfHwgIiI7CiAgICB0aGlzLmJlZm9yZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmJlZm9yZSwgWyJhdXRvIiwgImNvbnRlbnRBcmVhIiwgInBhZ2VBcmVhIiwgInBhZ2VFdmVuIiwgInBhZ2VPZGQiXSk7CiAgICB0aGlzLmJlZm9yZVRhcmdldCA9IGF0dHJpYnV0ZXMuYmVmb3JlVGFyZ2V0IHx8ICIiOwogICAgdGhpcy5ib29rZW5kTGVhZGVyID0gYXR0cmlidXRlcy5ib29rZW5kTGVhZGVyIHx8ICIiOwogICAgdGhpcy5ib29rZW5kVHJhaWxlciA9IGF0dHJpYnV0ZXMuYm9va2VuZFRyYWlsZXIgfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3ZlcmZsb3dMZWFkZXIgPSBhdHRyaWJ1dGVzLm92ZXJmbG93TGVhZGVyIHx8ICIiOwogICAgdGhpcy5vdmVyZmxvd1RhcmdldCA9IGF0dHJpYnV0ZXMub3ZlcmZsb3dUYXJnZXQgfHwgIiI7CiAgICB0aGlzLm92ZXJmbG93VHJhaWxlciA9IGF0dHJpYnV0ZXMub3ZlcmZsb3dUcmFpbGVyIHx8ICIiOwogICAgdGhpcy5zdGFydE5ldyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnN0YXJ0TmV3LAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9Cn0KY2xhc3MgQnJlYWtBZnRlciBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJicmVha0FmdGVyIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVhZGVyID0gYXR0cmlidXRlcy5sZWFkZXIgfHwgIiI7CiAgICB0aGlzLnN0YXJ0TmV3ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuc3RhcnROZXcsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogICAgdGhpcy50YXJnZXRUeXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudGFyZ2V0VHlwZSwgWyJhdXRvIiwgImNvbnRlbnRBcmVhIiwgInBhZ2VBcmVhIl0pOwogICAgdGhpcy50cmFpbGVyID0gYXR0cmlidXRlcy50cmFpbGVyIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuc2NyaXB0ID0gbnVsbDsKICB9Cn0KY2xhc3MgQnJlYWtCZWZvcmUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYnJlYWtCZWZvcmUiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sZWFkZXIgPSBhdHRyaWJ1dGVzLmxlYWRlciB8fCAiIjsKICAgIHRoaXMuc3RhcnROZXcgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zdGFydE5ldywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgICB0aGlzLnRhcmdldFR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50YXJnZXRUeXBlLCBbImF1dG8iLCAiY29udGVudEFyZWEiLCAicGFnZUFyZWEiXSk7CiAgICB0aGlzLnRyYWlsZXIgPSBhdHRyaWJ1dGVzLnRyYWlsZXIgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5zY3JpcHQgPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHRoaXNbJGV4dHJhXSA9IHt9OwogICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICB9Cn0KY2xhc3MgQnV0dG9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJ1dHRvbiIsIHRydWUpOwogICAgdGhpcy5oaWdobGlnaHQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oaWdobGlnaHQsIFsiaW52ZXJ0ZWQiLCAibm9uZSIsICJvdXRsaW5lIiwgInB1c2giXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgY29uc3QgZ3JhbmRwYSA9IHBhcmVudFskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgaHRtbEJ1dHRvbiA9IHsKICAgICAgbmFtZTogImJ1dHRvbiIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBpZDogdGhpc1skdWlkXSwKICAgICAgICBjbGFzczogWyJ4ZmFCdXR0b24iXSwKICAgICAgICBzdHlsZToge30KICAgICAgfSwKICAgICAgY2hpbGRyZW46IFtdCiAgICB9OwogICAgZm9yIChjb25zdCBldmVudCBvZiBncmFuZHBhLmV2ZW50LmNoaWxkcmVuKSB7CiAgICAgIGlmIChldmVudC5hY3Rpdml0eSAhPT0gImNsaWNrIiB8fCAhZXZlbnQuc2NyaXB0KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QganNVUkwgPSByZWNvdmVySnNVUkwoZXZlbnQuc2NyaXB0WyRjb250ZW50XSk7CiAgICAgIGlmICghanNVUkwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBocmVmID0gZml4VVJMKGpzVVJMLnVybCk7CiAgICAgIGlmICghaHJlZikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGh0bWxCdXR0b24uY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgbmFtZTogImEiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGlkOiAibGluayIgKyB0aGlzWyR1aWRdLAogICAgICAgICAgaHJlZiwKICAgICAgICAgIG5ld1dpbmRvdzoganNVUkwubmV3V2luZG93LAogICAgICAgICAgY2xhc3M6IFsieGZhTGluayJdLAogICAgICAgICAgc3R5bGU6IHt9CiAgICAgICAgfSwKICAgICAgICBjaGlsZHJlbjogW10KICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGh0bWxCdXR0b24pOwogIH0KfQpjbGFzcyBDYWxjdWxhdGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY2FsY3VsYXRlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3ZlcnJpZGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5vdmVycmlkZSwgWyJkaXNhYmxlZCIsICJlcnJvciIsICJpZ25vcmUiLCAid2FybmluZyJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1lc3NhZ2UgPSBudWxsOwogICAgdGhpcy5zY3JpcHQgPSBudWxsOwogIH0KfQpjbGFzcyBDYXB0aW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNhcHRpb24iLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wbGFjZW1lbnQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wbGFjZW1lbnQsIFsibGVmdCIsICJib3R0b20iLCAiaW5saW5lIiwgInJpZ2h0IiwgInRvcCJdKTsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlc2VydmUgPSBNYXRoLmNlaWwoZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5yZXNlcnZlKSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5mb250ID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICAgIHRoaXMucGFyYSA9IG51bGw7CiAgICB0aGlzLnZhbHVlID0gbnVsbDsKICB9CiAgWyRzZXRWYWx1ZV0odmFsdWUpIHsKICAgIF9zZXRWYWx1ZSh0aGlzLCB2YWx1ZSk7CiAgfQogIFskZ2V0RXh0cmFdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBpZiAoIXRoaXNbJGV4dHJhXSkgewogICAgICBsZXQgewogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodAogICAgICB9ID0gYXZhaWxhYmxlU3BhY2U7CiAgICAgIHN3aXRjaCAodGhpcy5wbGFjZW1lbnQpIHsKICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgY2FzZSAiaW5saW5lIjoKICAgICAgICAgIHdpZHRoID0gdGhpcy5yZXNlcnZlIDw9IDAgPyB3aWR0aCA6IHRoaXMucmVzZXJ2ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInRvcCI6CiAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgIGhlaWdodCA9IHRoaXMucmVzZXJ2ZSA8PSAwID8gaGVpZ2h0IDogdGhpcy5yZXNlcnZlOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpc1skZXh0cmFdID0gbGF5b3V0Tm9kZSh0aGlzLCB7CiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIHRoaXNbJGV4dHJhXTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBpZiAoIXRoaXMudmFsdWUpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICB0aGlzWyRwdXNoUGFyYV0oKTsKICAgIGNvbnN0IHZhbHVlID0gdGhpcy52YWx1ZVskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkuaHRtbDsKICAgIGlmICghdmFsdWUpIHsKICAgICAgdGhpc1skcG9wUGFyYV0oKTsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBjb25zdCBzYXZlZFJlc2VydmUgPSB0aGlzLnJlc2VydmU7CiAgICBpZiAodGhpcy5yZXNlcnZlIDw9IDApIHsKICAgICAgY29uc3QgewogICAgICAgIHcsCiAgICAgICAgaAogICAgICB9ID0gdGhpc1skZ2V0RXh0cmFdKGF2YWlsYWJsZVNwYWNlKTsKICAgICAgc3dpdGNoICh0aGlzLnBsYWNlbWVudCkgewogICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICBjYXNlICJpbmxpbmUiOgogICAgICAgICAgdGhpcy5yZXNlcnZlID0gdzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInRvcCI6CiAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgIHRoaXMucmVzZXJ2ZSA9IGg7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgIGNoaWxkcmVuLnB1c2goewogICAgICAgIG5hbWU6ICIjdGV4dCIsCiAgICAgICAgdmFsdWUKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBjaGlsZHJlbi5wdXNoKHZhbHVlKTsKICAgIH0KICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiZm9udCIsICJtYXJnaW4iLCAidmlzaWJpbGl0eSIpOwogICAgc3dpdGNoICh0aGlzLnBsYWNlbWVudCkgewogICAgICBjYXNlICJsZWZ0IjoKICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgIGlmICh0aGlzLnJlc2VydmUgPiAwKSB7CiAgICAgICAgICBzdHlsZS53aWR0aCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLnJlc2VydmUpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG9wIjoKICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICBpZiAodGhpcy5yZXNlcnZlID4gMCkgewogICAgICAgICAgc3R5bGUuaGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMucmVzZXJ2ZSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgfQogICAgc2V0UGFyYSh0aGlzLCBudWxsLCB2YWx1ZSk7CiAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgdGhpcy5yZXNlcnZlID0gc2F2ZWRSZXNlcnZlOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgc3R5bGUsCiAgICAgICAgY2xhc3M6IFsieGZhQ2FwdGlvbiJdCiAgICAgIH0sCiAgICAgIGNoaWxkcmVuCiAgICB9KTsKICB9Cn0KY2xhc3MgQ2VydGlmaWNhdGUgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY2VydGlmaWNhdGUiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgQ2VydGlmaWNhdGVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNlcnRpZmljYXRlcyIsIHRydWUpOwogICAgdGhpcy5jcmVkZW50aWFsU2VydmVyUG9saWN5ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuY3JlZGVudGlhbFNlcnZlclBvbGljeSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51cmwgPSBhdHRyaWJ1dGVzLnVybCB8fCAiIjsKICAgIHRoaXMudXJsUG9saWN5ID0gYXR0cmlidXRlcy51cmxQb2xpY3kgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5lbmNyeXB0aW9uID0gbnVsbDsKICAgIHRoaXMuaXNzdWVycyA9IG51bGw7CiAgICB0aGlzLmtleVVzYWdlID0gbnVsbDsKICAgIHRoaXMub2lkcyA9IG51bGw7CiAgICB0aGlzLnNpZ25pbmcgPSBudWxsOwogICAgdGhpcy5zdWJqZWN0RE5zID0gbnVsbDsKICB9Cn0KY2xhc3MgQ2hlY2tCdXR0b24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY2hlY2tCdXR0b24iLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5tYXJrID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubWFyaywgWyJkZWZhdWx0IiwgImNoZWNrIiwgImNpcmNsZSIsICJjcm9zcyIsICJkaWFtb25kIiwgInNxdWFyZSIsICJzdGFyIl0pOwogICAgdGhpcy5zaGFwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnNoYXBlLCBbInNxdWFyZSIsICJyb3VuZCJdKTsKICAgIHRoaXMuc2l6ZSA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuc2l6ZSwgIjEwcHQiKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJtYXJnaW4iKTsKICAgIGNvbnN0IHNpemUgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5zaXplKTsKICAgIHN0eWxlLndpZHRoID0gc3R5bGUuaGVpZ2h0ID0gc2l6ZTsKICAgIGxldCB0eXBlOwogICAgbGV0IGNsYXNzTmFtZTsKICAgIGxldCBncm91cElkOwogICAgY29uc3QgZmllbGQgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGl0ZW1zID0gZmllbGQuaXRlbXMuY2hpbGRyZW4ubGVuZ3RoICYmIGZpZWxkLml0ZW1zLmNoaWxkcmVuWzBdWyR0b0hUTUxdKCkuaHRtbCB8fCBbXTsKICAgIGNvbnN0IGV4cG9ydGVkVmFsdWUgPSB7CiAgICAgIG9uOiAoaXRlbXNbMF0gIT09IHVuZGVmaW5lZCA/IGl0ZW1zWzBdIDogIm9uIikudG9TdHJpbmcoKSwKICAgICAgb2ZmOiAoaXRlbXNbMV0gIT09IHVuZGVmaW5lZCA/IGl0ZW1zWzFdIDogIm9mZiIpLnRvU3RyaW5nKCkKICAgIH07CiAgICBjb25zdCB2YWx1ZSA9IGZpZWxkLnZhbHVlPy5bJHRleHRdKCkgfHwgIm9mZiI7CiAgICBjb25zdCBjaGVja2VkID0gdmFsdWUgPT09IGV4cG9ydGVkVmFsdWUub24gfHwgdW5kZWZpbmVkOwogICAgY29uc3QgY29udGFpbmVyID0gZmllbGRbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICBjb25zdCBmaWVsZElkID0gZmllbGRbJHVpZF07CiAgICBsZXQgZGF0YUlkOwogICAgaWYgKGNvbnRhaW5lciBpbnN0YW5jZW9mIEV4Y2xHcm91cCkgewogICAgICBncm91cElkID0gY29udGFpbmVyWyR1aWRdOwogICAgICB0eXBlID0gInJhZGlvIjsKICAgICAgY2xhc3NOYW1lID0gInhmYVJhZGlvIjsKICAgICAgZGF0YUlkID0gY29udGFpbmVyWyRkYXRhXT8uWyR1aWRdIHx8IGNvbnRhaW5lclskdWlkXTsKICAgIH0gZWxzZSB7CiAgICAgIHR5cGUgPSAiY2hlY2tib3giOwogICAgICBjbGFzc05hbWUgPSAieGZhQ2hlY2tib3giOwogICAgICBkYXRhSWQgPSBmaWVsZFskZGF0YV0/LlskdWlkXSB8fCBmaWVsZFskdWlkXTsKICAgIH0KICAgIGNvbnN0IGlucHV0ID0gewogICAgICBuYW1lOiAiaW5wdXQiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFtjbGFzc05hbWVdLAogICAgICAgIHN0eWxlLAogICAgICAgIGZpZWxkSWQsCiAgICAgICAgZGF0YUlkLAogICAgICAgIHR5cGUsCiAgICAgICAgY2hlY2tlZCwKICAgICAgICB4ZmFPbjogZXhwb3J0ZWRWYWx1ZS5vbiwKICAgICAgICB4ZmFPZmY6IGV4cG9ydGVkVmFsdWUub2ZmLAogICAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgIH0KICAgIH07CiAgICBpZiAoZ3JvdXBJZCkgewogICAgICBpbnB1dC5hdHRyaWJ1dGVzLm5hbWUgPSBncm91cElkOwogICAgfQogICAgaWYgKGlzUmVxdWlyZWQoZmllbGQpKSB7CiAgICAgIGlucHV0LmF0dHJpYnV0ZXNbImFyaWEtcmVxdWlyZWQiXSA9IHRydWU7CiAgICAgIGlucHV0LmF0dHJpYnV0ZXMucmVxdWlyZWQgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJsYWJlbCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFMYWJlbCJdCiAgICAgIH0sCiAgICAgIGNoaWxkcmVuOiBbaW5wdXRdCiAgICB9KTsKICB9Cn0KY2xhc3MgQ2hvaWNlTGlzdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjaG9pY2VMaXN0IiwgdHJ1ZSk7CiAgICB0aGlzLmNvbW1pdE9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuY29tbWl0T24sIFsic2VsZWN0IiwgImV4aXQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3BlbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm9wZW4sIFsidXNlckNvbnRyb2wiLCAiYWx3YXlzIiwgIm11bHRpU2VsZWN0IiwgIm9uRW50cnkiXSk7CiAgICB0aGlzLnRleHRFbnRyeSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnRleHRFbnRyeSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJib3JkZXIiLCAibWFyZ2luIik7CiAgICBjb25zdCB1aSA9IHRoaXNbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGZpZWxkID0gdWlbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGZvbnRTaXplID0gZmllbGQuZm9udD8uc2l6ZSB8fCAxMDsKICAgIGNvbnN0IG9wdGlvblN0eWxlID0gewogICAgICBmb250U2l6ZTogYGNhbGMoJHtmb250U2l6ZX1weCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpYAogICAgfTsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICBpZiAoZmllbGQuaXRlbXMuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBpdGVtcyA9IGZpZWxkLml0ZW1zOwogICAgICBsZXQgZGlzcGxheWVkSW5kZXggPSAwOwogICAgICBsZXQgc2F2ZUluZGV4ID0gMDsKICAgICAgaWYgKGl0ZW1zLmNoaWxkcmVuLmxlbmd0aCA9PT0gMikgewogICAgICAgIGRpc3BsYXllZEluZGV4ID0gaXRlbXMuY2hpbGRyZW5bMF0uc2F2ZTsKICAgICAgICBzYXZlSW5kZXggPSAxIC0gZGlzcGxheWVkSW5kZXg7CiAgICAgIH0KICAgICAgY29uc3QgZGlzcGxheWVkID0gaXRlbXMuY2hpbGRyZW5bZGlzcGxheWVkSW5kZXhdWyR0b0hUTUxdKCkuaHRtbDsKICAgICAgY29uc3QgdmFsdWVzID0gaXRlbXMuY2hpbGRyZW5bc2F2ZUluZGV4XVskdG9IVE1MXSgpLmh0bWw7CiAgICAgIGxldCBzZWxlY3RlZCA9IGZhbHNlOwogICAgICBjb25zdCB2YWx1ZSA9IGZpZWxkLnZhbHVlPy5bJHRleHRdKCkgfHwgIiI7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGRpc3BsYXllZC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3Qgb3B0aW9uID0gewogICAgICAgICAgbmFtZTogIm9wdGlvbiIsCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZXNbaV0gfHwgZGlzcGxheWVkW2ldLAogICAgICAgICAgICBzdHlsZTogb3B0aW9uU3R5bGUKICAgICAgICAgIH0sCiAgICAgICAgICB2YWx1ZTogZGlzcGxheWVkW2ldCiAgICAgICAgfTsKICAgICAgICBpZiAodmFsdWVzW2ldID09PSB2YWx1ZSkgewogICAgICAgICAgb3B0aW9uLmF0dHJpYnV0ZXMuc2VsZWN0ZWQgPSBzZWxlY3RlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGNoaWxkcmVuLnB1c2gob3B0aW9uKTsKICAgICAgfQogICAgICBpZiAoIXNlbGVjdGVkKSB7CiAgICAgICAgY2hpbGRyZW4uc3BsaWNlKDAsIDAsIHsKICAgICAgICAgIG5hbWU6ICJvcHRpb24iLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICBoaWRkZW46IHRydWUsCiAgICAgICAgICAgIHNlbGVjdGVkOiB0cnVlCiAgICAgICAgICB9LAogICAgICAgICAgdmFsdWU6ICIgIgogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzZWxlY3RBdHRyaWJ1dGVzID0gewogICAgICBjbGFzczogWyJ4ZmFTZWxlY3QiXSwKICAgICAgZmllbGRJZDogZmllbGRbJHVpZF0sCiAgICAgIGRhdGFJZDogZmllbGRbJGRhdGFdPy5bJHVpZF0gfHwgZmllbGRbJHVpZF0sCiAgICAgIHN0eWxlLAogICAgICAiYXJpYS1sYWJlbCI6IGFyaWFMYWJlbChmaWVsZCksCiAgICAgICJhcmlhLXJlcXVpcmVkIjogZmFsc2UKICAgIH07CiAgICBpZiAoaXNSZXF1aXJlZChmaWVsZCkpIHsKICAgICAgc2VsZWN0QXR0cmlidXRlc1siYXJpYS1yZXF1aXJlZCJdID0gdHJ1ZTsKICAgICAgc2VsZWN0QXR0cmlidXRlcy5yZXF1aXJlZCA9IHRydWU7CiAgICB9CiAgICBpZiAodGhpcy5vcGVuID09PSAibXVsdGlTZWxlY3QiKSB7CiAgICAgIHNlbGVjdEF0dHJpYnV0ZXMubXVsdGlwbGUgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJsYWJlbCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFMYWJlbCJdCiAgICAgIH0sCiAgICAgIGNoaWxkcmVuOiBbewogICAgICAgIG5hbWU6ICJzZWxlY3QiLAogICAgICAgIGNoaWxkcmVuLAogICAgICAgIGF0dHJpYnV0ZXM6IHNlbGVjdEF0dHJpYnV0ZXMKICAgICAgfV0KICAgIH0pOwogIH0KfQpjbGFzcyBDb2xvciBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjb2xvciIsIHRydWUpOwogICAgdGhpcy5jU3BhY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5jU3BhY2UsIFsiU1JHQiJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudmFsdWUgPSBhdHRyaWJ1dGVzLnZhbHVlID8gZ2V0Q29sb3IoYXR0cmlidXRlcy52YWx1ZSkgOiAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyRoYXNTZXR0YWJsZVZhbHVlXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIHJldHVybiB0aGlzLnZhbHVlID8gVXRpbC5tYWtlSGV4Q29sb3IodGhpcy52YWx1ZS5yLCB0aGlzLnZhbHVlLmcsIHRoaXMudmFsdWUuYikgOiBudWxsOwogIH0KfQpjbGFzcyBDb21iIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNvbWIiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5udW1iZXJPZkNlbGxzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubnVtYmVyT2ZDZWxscywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgQ29ubmVjdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjb25uZWN0IiwgdHJ1ZSk7CiAgICB0aGlzLmNvbm5lY3Rpb24gPSBhdHRyaWJ1dGVzLmNvbm5lY3Rpb24gfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnVzYWdlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudXNhZ2UsIFsiZXhwb3J0QW5kSW1wb3J0IiwgImV4cG9ydE9ubHkiLCAiaW1wb3J0T25seSJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogIH0KfQpjbGFzcyBDb250ZW50QXJlYSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjb250ZW50QXJlYSIsIHRydWUpOwogICAgdGhpcy5oID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5oKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudyk7CiAgICB0aGlzLnggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLngsICIwcHQiKTsKICAgIHRoaXMueSA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueSwgIjBwdCIpOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBsZWZ0ID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMueCk7CiAgICBjb25zdCB0b3AgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy55KTsKICAgIGNvbnN0IHN0eWxlID0gewogICAgICBsZWZ0LAogICAgICB0b3AsCiAgICAgIHdpZHRoOiBtZWFzdXJlVG9TdHJpbmcodGhpcy53KSwKICAgICAgaGVpZ2h0OiBtZWFzdXJlVG9TdHJpbmcodGhpcy5oKQogICAgfTsKICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbInhmYUNvbnRlbnRhcmVhIl07CiAgICBpZiAoaXNQcmludE9ubHkodGhpcykpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFQcmludE9ubHkiKTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgY2hpbGRyZW46IFtdLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgc3R5bGUsCiAgICAgICAgY2xhc3M6IGNsYXNzTmFtZXMsCiAgICAgICAgaWQ6IHRoaXNbJHVpZF0KICAgICAgfQogICAgfSk7CiAgfQp9CmNsYXNzIENvcm5lciBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjb3JuZXIiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5pbnZlcnRlZCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmludmVydGVkLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5qb2luID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuam9pbiwgWyJzcXVhcmUiLCAicm91bmQiXSk7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yYWRpdXMgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnJhZGl1cyk7CiAgICB0aGlzLnN0cm9rZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnN0cm9rZSwgWyJzb2xpZCIsICJkYXNoRG90IiwgImRhc2hEb3REb3QiLCAiZGFzaGVkIiwgImRvdHRlZCIsICJlbWJvc3NlZCIsICJldGNoZWQiLCAibG93ZXJlZCIsICJyYWlzZWQiXSk7CiAgICB0aGlzLnRoaWNrbmVzcyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudGhpY2tuZXNzLCAiMC41cHQiKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAidmlzaWJpbGl0eSIpOwogICAgc3R5bGUucmFkaXVzID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMuam9pbiA9PT0gInNxdWFyZSIgPyAwIDogdGhpcy5yYWRpdXMpOwogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBEYXRlRWxlbWVudCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGF0ZSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IGRhdGUgPSB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgICB0aGlzWyRjb250ZW50XSA9IGRhdGUgPyBuZXcgRGF0ZShkYXRlKSA6IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdID8gdGhpc1skY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgRGF0ZVRpbWUgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRhdGVUaW1lIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgZGF0ZSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gZGF0ZSA/IG5ldyBEYXRlKGRhdGUpIDogbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1skY29udGVudF0gPyB0aGlzWyRjb250ZW50XS50b1N0cmluZygpIDogIiIpOwogIH0KfQpjbGFzcyBEYXRlVGltZUVkaXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGF0ZVRpbWVFZGl0IiwgdHJ1ZSk7CiAgICB0aGlzLmhTY3JvbGxQb2xpY3kgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oU2Nyb2xsUG9saWN5LCBbImF1dG8iLCAib2ZmIiwgIm9uIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnBpY2tlciA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnBpY2tlciwgWyJob3N0IiwgIm5vbmUiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5jb21iID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImJvcmRlciIsICJmb250IiwgIm1hcmdpbiIpOwogICAgY29uc3QgZmllbGQgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJpbnB1dCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgZmllbGRJZDogZmllbGRbJHVpZF0sCiAgICAgICAgZGF0YUlkOiBmaWVsZFskZGF0YV0/LlskdWlkXSB8fCBmaWVsZFskdWlkXSwKICAgICAgICBjbGFzczogWyJ4ZmFUZXh0ZmllbGQiXSwKICAgICAgICBzdHlsZSwKICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFMYWJlbChmaWVsZCksCiAgICAgICAgImFyaWEtcmVxdWlyZWQiOiBmYWxzZQogICAgICB9CiAgICB9OwogICAgaWYgKGlzUmVxdWlyZWQoZmllbGQpKSB7CiAgICAgIGh0bWwuYXR0cmlidXRlc1siYXJpYS1yZXF1aXJlZCJdID0gdHJ1ZTsKICAgICAgaHRtbC5hdHRyaWJ1dGVzLnJlcXVpcmVkID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW2h0bWxdCiAgICB9KTsKICB9Cn0KY2xhc3MgRGVjaW1hbCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGVjaW1hbCIpOwogICAgdGhpcy5mcmFjRGlnaXRzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZnJhY0RpZ2l0cywKICAgICAgZGVmYXVsdFZhbHVlOiAyLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sZWFkRGlnaXRzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubGVhZERpZ2l0cywKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IG51bWJlciA9IHBhcnNlRmxvYXQodGhpc1skY29udGVudF0udHJpbSgpKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gaXNOYU4obnVtYmVyKSA/IG51bGwgOiBudW1iZXI7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdICE9PSBudWxsID8gdGhpc1skY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgRGVmYXVsdFVpIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRlZmF1bHRVaSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KfQpjbGFzcyBEZXNjIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRlc2MiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZsb2F0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmludGVnZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIERpZ2VzdE1ldGhvZCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkaWdlc3RNZXRob2QiLCBbIiIsICJTSEExIiwgIlNIQTI1NiIsICJTSEE1MTIiLCAiUklQRU1EMTYwIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBEaWdlc3RNZXRob2RzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRpZ2VzdE1ldGhvZHMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmRpZ2VzdE1ldGhvZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBEcmF3IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRyYXciLCB0cnVlKTsKICAgIHRoaXMuYW5jaG9yVHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFuY2hvclR5cGUsIFsidG9wTGVmdCIsICJib3R0b21DZW50ZXIiLCAiYm90dG9tTGVmdCIsICJib3R0b21SaWdodCIsICJtaWRkbGVDZW50ZXIiLCAibWlkZGxlTGVmdCIsICJtaWRkbGVSaWdodCIsICJ0b3BDZW50ZXIiLCAidG9wUmlnaHQiXSk7CiAgICB0aGlzLmNvbFNwYW4gPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5jb2xTcGFuLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPj0gMSB8fCBuID09PSAtMQogICAgfSk7CiAgICB0aGlzLmggPSBhdHRyaWJ1dGVzLmggPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmgpIDogIiI7CiAgICB0aGlzLmhBbGlnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhBbGlnbiwgWyJsZWZ0IiwgImNlbnRlciIsICJqdXN0aWZ5IiwgImp1c3RpZnlBbGwiLCAicmFkaXgiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubG9jYWxlID0gYXR0cmlidXRlcy5sb2NhbGUgfHwgIiI7CiAgICB0aGlzLm1heEggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1heEgsICIwcHQiKTsKICAgIHRoaXMubWF4VyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4VywgIjBwdCIpOwogICAgdGhpcy5taW5IID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5ILCAiMHB0Iik7CiAgICB0aGlzLm1pblcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1pblcsICIwcHQiKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnJvdGF0ZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnJvdGF0ZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ICUgOTAgPT09IDAKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudyA9IGF0dHJpYnV0ZXMudyA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudykgOiAiIjsKICAgIHRoaXMueCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmFzc2lzdCA9IG51bGw7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNhcHRpb24gPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICB0aGlzLmtlZXAgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogICAgdGhpcy5wYXJhID0gbnVsbDsKICAgIHRoaXMudHJhdmVyc2FsID0gbnVsbDsKICAgIHRoaXMudWkgPSBudWxsOwogICAgdGhpcy52YWx1ZSA9IG51bGw7CiAgICB0aGlzLnNldFByb3BlcnR5ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogIFskc2V0VmFsdWVdKHZhbHVlKSB7CiAgICBfc2V0VmFsdWUodGhpcywgdmFsdWUpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHNldFRhYkluZGV4KHRoaXMpOwogICAgaWYgKHRoaXMucHJlc2VuY2UgPT09ICJoaWRkZW4iIHx8IHRoaXMucHJlc2VuY2UgPT09ICJpbmFjdGl2ZSIpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBmaXhEaW1lbnNpb25zKHRoaXMpOwogICAgdGhpc1skcHVzaFBhcmFdKCk7CiAgICBjb25zdCBzYXZlZFcgPSB0aGlzLnc7CiAgICBjb25zdCBzYXZlZEggPSB0aGlzLmg7CiAgICBjb25zdCB7CiAgICAgIHcsCiAgICAgIGgsCiAgICAgIGlzQnJva2VuCiAgICB9ID0gbGF5b3V0Tm9kZSh0aGlzLCBhdmFpbGFibGVTcGFjZSk7CiAgICBpZiAodyAmJiB0aGlzLncgPT09ICIiKSB7CiAgICAgIGlmIChpc0Jyb2tlbiAmJiB0aGlzWyRnZXRTdWJmb3JtUGFyZW50XSgpWyRpc1RoZXJlTW9yZVdpZHRoXSgpKSB7CiAgICAgICAgdGhpc1skcG9wUGFyYV0oKTsKICAgICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgICB9CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICBpZiAoaCAmJiB0aGlzLmggPT09ICIiKSB7CiAgICAgIHRoaXMuaCA9IGg7CiAgICB9CiAgICBzZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIGlmICghY2hlY2tEaW1lbnNpb25zKHRoaXMsIGF2YWlsYWJsZVNwYWNlKSkgewogICAgICB0aGlzLncgPSBzYXZlZFc7CiAgICAgIHRoaXMuaCA9IHNhdmVkSDsKICAgICAgdGhpc1skcG9wUGFyYV0oKTsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIHVuc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImZvbnQiLCAiaEFsaWduIiwgImRpbWVuc2lvbnMiLCAicG9zaXRpb24iLCAicHJlc2VuY2UiLCAicm90YXRlIiwgImFuY2hvclR5cGUiLCAiYm9yZGVyIiwgIm1hcmdpbiIpOwogICAgc2V0TWluTWF4RGltZW5zaW9ucyh0aGlzLCBzdHlsZSk7CiAgICBpZiAoc3R5bGUubWFyZ2luKSB7CiAgICAgIHN0eWxlLnBhZGRpbmcgPSBzdHlsZS5tYXJnaW47CiAgICAgIGRlbGV0ZSBzdHlsZS5tYXJnaW47CiAgICB9CiAgICBjb25zdCBjbGFzc05hbWVzID0gWyJ4ZmFEcmF3Il07CiAgICBpZiAodGhpcy5mb250KSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhRm9udCIpOwogICAgfQogICAgaWYgKGlzUHJpbnRPbmx5KHRoaXMpKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUHJpbnRPbmx5Iik7CiAgICB9CiAgICBjb25zdCBhdHRyaWJ1dGVzID0gewogICAgICBzdHlsZSwKICAgICAgaWQ6IHRoaXNbJHVpZF0sCiAgICAgIGNsYXNzOiBjbGFzc05hbWVzCiAgICB9OwogICAgaWYgKHRoaXMubmFtZSkgewogICAgICBhdHRyaWJ1dGVzLnhmYU5hbWUgPSB0aGlzLm5hbWU7CiAgICB9CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlcywKICAgICAgY2hpbGRyZW46IFtdCiAgICB9OwogICAgYXBwbHlBc3Npc3QodGhpcywgYXR0cmlidXRlcyk7CiAgICBjb25zdCBiYm94ID0gY29tcHV0ZUJib3godGhpcywgaHRtbCwgYXZhaWxhYmxlU3BhY2UpOwogICAgY29uc3QgdmFsdWUgPSB0aGlzLnZhbHVlID8gdGhpcy52YWx1ZVskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkuaHRtbCA6IG51bGw7CiAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgdGhpcy53ID0gc2F2ZWRXOwogICAgICB0aGlzLmggPSBzYXZlZEg7CiAgICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoY3JlYXRlV3JhcHBlcih0aGlzLCBodG1sKSwgYmJveCk7CiAgICB9CiAgICBodG1sLmNoaWxkcmVuLnB1c2godmFsdWUpOwogICAgc2V0UGFyYSh0aGlzLCBzdHlsZSwgdmFsdWUpOwogICAgdGhpcy53ID0gc2F2ZWRXOwogICAgdGhpcy5oID0gc2F2ZWRIOwogICAgdGhpc1skcG9wUGFyYV0oKTsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoY3JlYXRlV3JhcHBlcih0aGlzLCBodG1sKSwgYmJveCk7CiAgfQp9CmNsYXNzIEVkZ2UgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZWRnZSIsIHRydWUpOwogICAgdGhpcy5jYXAgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5jYXAsIFsic3F1YXJlIiwgImJ1dHQiLCAicm91bmQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnN0cm9rZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnN0cm9rZSwgWyJzb2xpZCIsICJkYXNoRG90IiwgImRhc2hEb3REb3QiLCAiZGFzaGVkIiwgImRvdHRlZCIsICJlbWJvc3NlZCIsICJldGNoZWQiLCAibG93ZXJlZCIsICJyYWlzZWQiXSk7CiAgICB0aGlzLnRoaWNrbmVzcyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudGhpY2tuZXNzLCAiMC41cHQiKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAidmlzaWJpbGl0eSIpOwogICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgewogICAgICBsaW5lY2FwOiB0aGlzLmNhcCwKICAgICAgd2lkdGg6IG1lYXN1cmVUb1N0cmluZyh0aGlzLnRoaWNrbmVzcyksCiAgICAgIGNvbG9yOiB0aGlzLmNvbG9yID8gdGhpcy5jb2xvclskdG9TdHlsZV0oKSA6ICIjMDAwMDAwIiwKICAgICAgc3R5bGU6ICIiCiAgICB9KTsKICAgIGlmICh0aGlzLnByZXNlbmNlICE9PSAidmlzaWJsZSIpIHsKICAgICAgc3R5bGUuc3R5bGUgPSAibm9uZSI7CiAgICB9IGVsc2UgewogICAgICBzd2l0Y2ggKHRoaXMuc3Ryb2tlKSB7CiAgICAgICAgY2FzZSAic29saWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAic29saWQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGFzaERvdCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJkYXNoZWQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGFzaERvdERvdCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJkYXNoZWQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGFzaGVkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gImRhc2hlZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkb3R0ZWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAiZG90dGVkIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImVtYm9zc2VkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gInJpZGdlIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImV0Y2hlZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJncm9vdmUiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibG93ZXJlZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJpbnNldCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyYWlzZWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAib3V0c2V0IjsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3R5bGU7CiAgfQp9CmNsYXNzIEVuY29kaW5nIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY29kaW5nIiwgWyJhZGJlLng1MDkucnNhX3NoYTEiLCAiYWRiZS5wa2NzNy5kZXRhY2hlZCIsICJhZGJlLnBrY3M3LnNoYTEiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEVuY29kaW5ncyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNvZGluZ3MiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVuY29kaW5nID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEVuY3J5cHQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jcnlwdCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jZXJ0aWZpY2F0ZSA9IG51bGw7CiAgfQp9CmNsYXNzIEVuY3J5cHREYXRhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY3J5cHREYXRhIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3BlcmF0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3BlcmF0aW9uLCBbImVuY3J5cHQiLCAiZGVjcnlwdCJdKTsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5maWx0ZXIgPSBudWxsOwogICAgdGhpcy5tYW5pZmVzdCA9IG51bGw7CiAgfQp9CmNsYXNzIEVuY3J5cHRpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jcnlwdGlvbiIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY2VydGlmaWNhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRW5jcnlwdGlvbk1ldGhvZCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNyeXB0aW9uTWV0aG9kIiwgWyIiLCAiQUVTMjU2LUNCQyIsICJUUklQTEVERVMtQ0JDIiwgIkFFUzEyOC1DQkMiLCAiQUVTMTkyLUNCQyJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgRW5jcnlwdGlvbk1ldGhvZHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jcnlwdGlvbk1ldGhvZHMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVuY3J5cHRpb25NZXRob2QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRXZlbnQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXZlbnQiLCB0cnVlKTsKICAgIHRoaXMuYWN0aXZpdHkgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hY3Rpdml0eSwgWyJjbGljayIsICJjaGFuZ2UiLCAiZG9jQ2xvc2UiLCAiZG9jUmVhZHkiLCAiZW50ZXIiLCAiZXhpdCIsICJmdWxsIiwgImluZGV4Q2hhbmdlIiwgImluaXRpYWxpemUiLCAibW91c2VEb3duIiwgIm1vdXNlRW50ZXIiLCAibW91c2VFeGl0IiwgIm1vdXNlVXAiLCAicG9zdEV4ZWN1dGUiLCAicG9zdE9wZW4iLCAicG9zdFByaW50IiwgInBvc3RTYXZlIiwgInBvc3RTaWduIiwgInBvc3RTdWJtaXQiLCAicHJlRXhlY3V0ZSIsICJwcmVPcGVuIiwgInByZVByaW50IiwgInByZVNhdmUiLCAicHJlU2lnbiIsICJwcmVTdWJtaXQiLCAicmVhZHkiLCAidmFsaWRhdGlvblN0YXRlIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxpc3RlbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmxpc3RlbiwgWyJyZWZPbmx5IiwgInJlZkFuZERlc2NlbmRlbnRzIl0pOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmVuY3J5cHREYXRhID0gbnVsbDsKICAgIHRoaXMuZXhlY3V0ZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgICB0aGlzLnNpZ25EYXRhID0gbnVsbDsKICAgIHRoaXMuc3VibWl0ID0gbnVsbDsKICB9Cn0KY2xhc3MgRXhEYXRhIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJleERhdGEiKTsKICAgIHRoaXMuY29udGVudFR5cGUgPSBhdHRyaWJ1dGVzLmNvbnRlbnRUeXBlIHx8ICIiOwogICAgdGhpcy5ocmVmID0gYXR0cmlidXRlcy5ocmVmIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm1heExlbmd0aCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1heExlbmd0aCwKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAtMQogICAgfSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJpZCA9IGF0dHJpYnV0ZXMucmlkIHx8ICIiOwogICAgdGhpcy50cmFuc2ZlckVuY29kaW5nID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHJhbnNmZXJFbmNvZGluZywgWyJub25lIiwgImJhc2U2NCIsICJwYWNrYWdlIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRpc0NEQVRBWG1sXSgpIHsKICAgIHJldHVybiB0aGlzLmNvbnRlbnRUeXBlID09PSAidGV4dC9odG1sIjsKICB9CiAgWyRvbkNoaWxkXShjaGlsZCkgewogICAgaWYgKHRoaXMuY29udGVudFR5cGUgPT09ICJ0ZXh0L2h0bWwiICYmIGNoaWxkWyRuYW1lc3BhY2VJZF0gPT09IE5hbWVzcGFjZUlkcy54aHRtbC5pZCkgewogICAgICB0aGlzWyRjb250ZW50XSA9IGNoaWxkOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLmNvbnRlbnRUeXBlID09PSAidGV4dC94bWwiKSB7CiAgICAgIHRoaXNbJGNvbnRlbnRdID0gY2hpbGQ7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGlmICh0aGlzLmNvbnRlbnRUeXBlICE9PSAidGV4dC9odG1sIiB8fCAhdGhpc1skY29udGVudF0pIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICByZXR1cm4gdGhpc1skY29udGVudF1bJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogIH0KfQpjbGFzcyBFeE9iamVjdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJleE9iamVjdCIsIHRydWUpOwogICAgdGhpcy5hcmNoaXZlID0gYXR0cmlidXRlcy5hcmNoaXZlIHx8ICIiOwogICAgdGhpcy5jbGFzc0lkID0gYXR0cmlidXRlcy5jbGFzc0lkIHx8ICIiOwogICAgdGhpcy5jb2RlQmFzZSA9IGF0dHJpYnV0ZXMuY29kZUJhc2UgfHwgIiI7CiAgICB0aGlzLmNvZGVUeXBlID0gYXR0cmlidXRlcy5jb2RlVHlwZSB8fCAiIjsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4T2JqZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZsb2F0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmludGVnZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEV4Y2xHcm91cCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJleGNsR3JvdXAiLCB0cnVlKTsKICAgIHRoaXMuYWNjZXNzID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYWNjZXNzLCBbIm9wZW4iLCAibm9uSW50ZXJhY3RpdmUiLCAicHJvdGVjdGVkIiwgInJlYWRPbmx5Il0pOwogICAgdGhpcy5hY2Nlc3NLZXkgPSBhdHRyaWJ1dGVzLmFjY2Vzc0tleSB8fCAiIjsKICAgIHRoaXMuYW5jaG9yVHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFuY2hvclR5cGUsIFsidG9wTGVmdCIsICJib3R0b21DZW50ZXIiLCAiYm90dG9tTGVmdCIsICJib3R0b21SaWdodCIsICJtaWRkbGVDZW50ZXIiLCAibWlkZGxlTGVmdCIsICJtaWRkbGVSaWdodCIsICJ0b3BDZW50ZXIiLCAidG9wUmlnaHQiXSk7CiAgICB0aGlzLmNvbFNwYW4gPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5jb2xTcGFuLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPj0gMSB8fCBuID09PSAtMQogICAgfSk7CiAgICB0aGlzLmggPSBhdHRyaWJ1dGVzLmggPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmgpIDogIiI7CiAgICB0aGlzLmhBbGlnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhBbGlnbiwgWyJsZWZ0IiwgImNlbnRlciIsICJqdXN0aWZ5IiwgImp1c3RpZnlBbGwiLCAicmFkaXgiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGF5b3V0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubGF5b3V0LCBbInBvc2l0aW9uIiwgImxyLXRiIiwgInJsLXJvdyIsICJybC10YiIsICJyb3ciLCAidGFibGUiLCAidGIiXSk7CiAgICB0aGlzLm1heEggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1heEgsICIwcHQiKTsKICAgIHRoaXMubWF4VyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4VywgIjBwdCIpOwogICAgdGhpcy5taW5IID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5ILCAiMHB0Iik7CiAgICB0aGlzLm1pblcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1pblcsICIwcHQiKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53ID0gYXR0cmlidXRlcy53ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy53KSA6ICIiOwogICAgdGhpcy54ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuYXNzaXN0ID0gbnVsbDsKICAgIHRoaXMuYmluZCA9IG51bGw7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNhbGN1bGF0ZSA9IG51bGw7CiAgICB0aGlzLmNhcHRpb24gPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICAgIHRoaXMucGFyYSA9IG51bGw7CiAgICB0aGlzLnRyYXZlcnNhbCA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRlID0gbnVsbDsKICAgIHRoaXMuY29ubmVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5ldmVudCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWVsZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zZXRQcm9wZXJ0eSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskaGFzU2V0dGFibGVWYWx1ZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRzZXRWYWx1ZV0odmFsdWUpIHsKICAgIGZvciAoY29uc3QgZmllbGQgb2YgdGhpcy5maWVsZC5jaGlsZHJlbikgewogICAgICBpZiAoIWZpZWxkLnZhbHVlKSB7CiAgICAgICAgY29uc3Qgbm9kZVZhbHVlID0gbmV3IFZhbHVlKHt9KTsKICAgICAgICBmaWVsZFskYXBwZW5kQ2hpbGRdKG5vZGVWYWx1ZSk7CiAgICAgICAgZmllbGQudmFsdWUgPSBub2RlVmFsdWU7CiAgICAgIH0KICAgICAgZmllbGQudmFsdWVbJHNldFZhbHVlXSh2YWx1ZSk7CiAgICB9CiAgfQogIFskaXNUaGVyZU1vcmVXaWR0aF0oKSB7CiAgICByZXR1cm4gdGhpcy5sYXlvdXQuZW5kc1dpdGgoIi10YiIpICYmIHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSAwICYmIHRoaXNbJGV4dHJhXS5udW1iZXJJbkxpbmUgPiAwIHx8IHRoaXNbJGdldFBhcmVudF0oKVskaXNUaGVyZU1vcmVXaWR0aF0oKTsKICB9CiAgWyRpc1NwbGl0dGFibGVdKCkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGlmICghcGFyZW50WyRpc1NwbGl0dGFibGVdKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlOwogICAgfQogICAgaWYgKHRoaXMubGF5b3V0ID09PSAicG9zaXRpb24iIHx8IHRoaXMubGF5b3V0LmluY2x1ZGVzKCJyb3ciKSkgewogICAgICB0aGlzWyRleHRyYV0uX2lzU3BsaXR0YWJsZSA9IGZhbHNlOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAocGFyZW50LmxheW91dD8uZW5kc1dpdGgoIi10YiIpICYmIHBhcmVudFskZXh0cmFdLm51bWJlckluTGluZSAhPT0gMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzWyRleHRyYV0uX2lzU3BsaXR0YWJsZSA9IHRydWU7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRmbHVzaEhUTUxdKCkgewogICAgcmV0dXJuIGZsdXNoSFRNTCh0aGlzKTsKICB9CiAgWyRhZGRIVE1MXShodG1sLCBiYm94KSB7CiAgICBhZGRIVE1MKHRoaXMsIGh0bWwsIGJib3gpOwogIH0KICBbJGdldEF2YWlsYWJsZVNwYWNlXSgpIHsKICAgIHJldHVybiBnZXRBdmFpbGFibGVTcGFjZSh0aGlzKTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBzZXRUYWJJbmRleCh0aGlzKTsKICAgIGlmICh0aGlzLnByZXNlbmNlID09PSAiaGlkZGVuIiB8fCB0aGlzLnByZXNlbmNlID09PSAiaW5hY3RpdmUiIHx8IHRoaXMuaCA9PT0gMCB8fCB0aGlzLncgPT09IDApIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBmaXhEaW1lbnNpb25zKHRoaXMpOwogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7CiAgICAgIGlkOiB0aGlzWyR1aWRdLAogICAgICBjbGFzczogW10KICAgIH07CiAgICBzZXRBY2Nlc3ModGhpcywgYXR0cmlidXRlcy5jbGFzcyk7CiAgICB0aGlzWyRleHRyYV0gfHw9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBPYmplY3QuYXNzaWduKHRoaXNbJGV4dHJhXSwgewogICAgICBjaGlsZHJlbiwKICAgICAgYXR0cmlidXRlcywKICAgICAgYXR0ZW1wdDogMCwKICAgICAgbGluZTogbnVsbCwKICAgICAgbnVtYmVySW5MaW5lOiAwLAogICAgICBhdmFpbGFibGVTcGFjZTogewogICAgICAgIHdpZHRoOiBNYXRoLm1pbih0aGlzLncgfHwgSW5maW5pdHksIGF2YWlsYWJsZVNwYWNlLndpZHRoKSwKICAgICAgICBoZWlnaHQ6IE1hdGgubWluKHRoaXMuaCB8fCBJbmZpbml0eSwgYXZhaWxhYmxlU3BhY2UuaGVpZ2h0KQogICAgICB9LAogICAgICB3aWR0aDogMCwKICAgICAgaGVpZ2h0OiAwLAogICAgICBwcmV2SGVpZ2h0OiAwLAogICAgICBjdXJyZW50V2lkdGg6IDAKICAgIH0pOwogICAgY29uc3QgaXNTcGxpdHRhYmxlID0gdGhpc1skaXNTcGxpdHRhYmxlXSgpOwogICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICB9CiAgICBpZiAoIWNoZWNrRGltZW5zaW9ucyh0aGlzLCBhdmFpbGFibGVTcGFjZSkpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIGNvbnN0IGZpbHRlciA9IG5ldyBTZXQoWyJmaWVsZCJdKTsKICAgIGlmICh0aGlzLmxheW91dC5pbmNsdWRlcygicm93IikpIHsKICAgICAgY29uc3QgY29sdW1uV2lkdGhzID0gdGhpc1skZ2V0U3ViZm9ybVBhcmVudF0oKS5jb2x1bW5XaWR0aHM7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbHVtbldpZHRocykgJiYgY29sdW1uV2lkdGhzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzWyRleHRyYV0uY29sdW1uV2lkdGhzID0gY29sdW1uV2lkdGhzOwogICAgICAgIHRoaXNbJGV4dHJhXS5jdXJyZW50Q29sdW1uID0gMDsKICAgICAgfQogICAgfQogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJhbmNob3JUeXBlIiwgImRpbWVuc2lvbnMiLCAicG9zaXRpb24iLCAicHJlc2VuY2UiLCAiYm9yZGVyIiwgIm1hcmdpbiIsICJoQWxpZ24iKTsKICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbInhmYUV4Y2xncm91cCJdOwogICAgY29uc3QgY2wgPSBsYXlvdXRDbGFzcyh0aGlzKTsKICAgIGlmIChjbCkgewogICAgICBjbGFzc05hbWVzLnB1c2goY2wpOwogICAgfQogICAgaWYgKGlzUHJpbnRPbmx5KHRoaXMpKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUHJpbnRPbmx5Iik7CiAgICB9CiAgICBhdHRyaWJ1dGVzLnN0eWxlID0gc3R5bGU7CiAgICBhdHRyaWJ1dGVzLmNsYXNzID0gY2xhc3NOYW1lczsKICAgIGlmICh0aGlzLm5hbWUpIHsKICAgICAgYXR0cmlidXRlcy54ZmFOYW1lID0gdGhpcy5uYW1lOwogICAgfQogICAgdGhpc1skcHVzaFBhcmFdKCk7CiAgICBjb25zdCBpc0xyVGIgPSB0aGlzLmxheW91dCA9PT0gImxyLXRiIiB8fCB0aGlzLmxheW91dCA9PT0gInJsLXRiIjsKICAgIGNvbnN0IG1heFJ1biA9IGlzTHJUYiA/IE1BWF9BVFRFTVBUU19GT1JfTFJUQl9MQVlPVVQgOiAxOwogICAgZm9yICg7IHRoaXNbJGV4dHJhXS5hdHRlbXB0IDwgbWF4UnVuOyB0aGlzWyRleHRyYV0uYXR0ZW1wdCsrKSB7CiAgICAgIGlmIChpc0xyVGIgJiYgdGhpc1skZXh0cmFdLmF0dGVtcHQgPT09IE1BWF9BVFRFTVBUU19GT1JfTFJUQl9MQVlPVVQgLSAxKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm51bWJlckluTGluZSA9IDA7CiAgICAgIH0KICAgICAgY29uc3QgcmVzdWx0ID0gdGhpc1skY2hpbGRyZW5Ub0hUTUxdKHsKICAgICAgICBmaWx0ZXIsCiAgICAgICAgaW5jbHVkZTogdHJ1ZQogICAgICB9KTsKICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHJlc3VsdC5pc0JyZWFrKCkpIHsKICAgICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgaWYgKGlzTHJUYiAmJiB0aGlzWyRleHRyYV0uYXR0ZW1wdCA9PT0gMCAmJiB0aGlzWyRleHRyYV0ubnVtYmVySW5MaW5lID09PSAwICYmICF0aGlzWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUpIHsKICAgICAgICB0aGlzWyRleHRyYV0uYXR0ZW1wdCA9IG1heFJ1bjsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgdGhpc1skcG9wUGFyYV0oKTsKICAgIGlmICghaXNTcGxpdHRhYmxlKSB7CiAgICAgIHVuc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICB9CiAgICBpZiAodGhpc1skZXh0cmFdLmF0dGVtcHQgPT09IG1heFJ1bikgewogICAgICBpZiAoIWlzU3BsaXR0YWJsZSkgewogICAgICAgIGRlbGV0ZSB0aGlzWyRleHRyYV07CiAgICAgIH0KICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIGxldCBtYXJnaW5IID0gMDsKICAgIGxldCBtYXJnaW5WID0gMDsKICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICBtYXJnaW5IID0gdGhpcy5tYXJnaW4ubGVmdEluc2V0ICsgdGhpcy5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgbWFyZ2luViA9IHRoaXMubWFyZ2luLnRvcEluc2V0ICsgdGhpcy5tYXJnaW4uYm90dG9tSW5zZXQ7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IE1hdGgubWF4KHRoaXNbJGV4dHJhXS53aWR0aCArIG1hcmdpbkgsIHRoaXMudyB8fCAwKTsKICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KHRoaXNbJGV4dHJhXS5oZWlnaHQgKyBtYXJnaW5WLCB0aGlzLmggfHwgMCk7CiAgICBjb25zdCBiYm94ID0gW3RoaXMueCwgdGhpcy55LCB3aWR0aCwgaGVpZ2h0XTsKICAgIGlmICh0aGlzLncgPT09ICIiKSB7CiAgICAgIHN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHdpZHRoKTsKICAgIH0KICAgIGlmICh0aGlzLmggPT09ICIiKSB7CiAgICAgIHN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhoZWlnaHQpOwogICAgfQogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgYXBwbHlBc3Npc3QodGhpcywgYXR0cmlidXRlcyk7CiAgICBkZWxldGUgdGhpc1skZXh0cmFdOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhjcmVhdGVXcmFwcGVyKHRoaXMsIGh0bWwpLCBiYm94KTsKICB9Cn0KY2xhc3MgRXhlY3V0ZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJleGVjdXRlIik7CiAgICB0aGlzLmNvbm5lY3Rpb24gPSBhdHRyaWJ1dGVzLmNvbm5lY3Rpb24gfHwgIiI7CiAgICB0aGlzLmV4ZWN1dGVUeXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZXhlY3V0ZVR5cGUsIFsiaW1wb3J0IiwgInJlbWVyZ2UiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucnVuQXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5ydW5BdCwgWyJjbGllbnQiLCAiYm90aCIsICJzZXJ2ZXIiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBFeHRyYXMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXh0cmFzIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvb2xlYW4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWNpbWFsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leHRyYXMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmxvYXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW1hZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW50ZWdlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZXh0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRmllbGQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZmllbGQiLCB0cnVlKTsKICAgIHRoaXMuYWNjZXNzID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYWNjZXNzLCBbIm9wZW4iLCAibm9uSW50ZXJhY3RpdmUiLCAicHJvdGVjdGVkIiwgInJlYWRPbmx5Il0pOwogICAgdGhpcy5hY2Nlc3NLZXkgPSBhdHRyaWJ1dGVzLmFjY2Vzc0tleSB8fCAiIjsKICAgIHRoaXMuYW5jaG9yVHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFuY2hvclR5cGUsIFsidG9wTGVmdCIsICJib3R0b21DZW50ZXIiLCAiYm90dG9tTGVmdCIsICJib3R0b21SaWdodCIsICJtaWRkbGVDZW50ZXIiLCAibWlkZGxlTGVmdCIsICJtaWRkbGVSaWdodCIsICJ0b3BDZW50ZXIiLCAidG9wUmlnaHQiXSk7CiAgICB0aGlzLmNvbFNwYW4gPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5jb2xTcGFuLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPj0gMSB8fCBuID09PSAtMQogICAgfSk7CiAgICB0aGlzLmggPSBhdHRyaWJ1dGVzLmggPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmgpIDogIiI7CiAgICB0aGlzLmhBbGlnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhBbGlnbiwgWyJsZWZ0IiwgImNlbnRlciIsICJqdXN0aWZ5IiwgImp1c3RpZnlBbGwiLCAicmFkaXgiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubG9jYWxlID0gYXR0cmlidXRlcy5sb2NhbGUgfHwgIiI7CiAgICB0aGlzLm1heEggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1heEgsICIwcHQiKTsKICAgIHRoaXMubWF4VyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4VywgIjBwdCIpOwogICAgdGhpcy5taW5IID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5ILCAiMHB0Iik7CiAgICB0aGlzLm1pblcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1pblcsICIwcHQiKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnJvdGF0ZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnJvdGF0ZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ICUgOTAgPT09IDAKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudyA9IGF0dHJpYnV0ZXMudyA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudykgOiAiIjsKICAgIHRoaXMueCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmFzc2lzdCA9IG51bGw7CiAgICB0aGlzLmJpbmQgPSBudWxsOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5jYWxjdWxhdGUgPSBudWxsOwogICAgdGhpcy5jYXB0aW9uID0gbnVsbDsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmZvbnQgPSBudWxsOwogICAgdGhpcy5mb3JtYXQgPSBudWxsOwogICAgdGhpcy5pdGVtcyA9IG5ldyBYRkFPYmplY3RBcnJheSgyKTsKICAgIHRoaXMua2VlcCA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgICB0aGlzLnBhcmEgPSBudWxsOwogICAgdGhpcy50cmF2ZXJzYWwgPSBudWxsOwogICAgdGhpcy51aSA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRlID0gbnVsbDsKICAgIHRoaXMudmFsdWUgPSBudWxsOwogICAgdGhpcy5iaW5kSXRlbXMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29ubmVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5ldmVudCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zZXRQcm9wZXJ0eSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskc2V0VmFsdWVdKHZhbHVlKSB7CiAgICBfc2V0VmFsdWUodGhpcywgdmFsdWUpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHNldFRhYkluZGV4KHRoaXMpOwogICAgaWYgKCF0aGlzLnVpKSB7CiAgICAgIHRoaXMudWkgPSBuZXcgVWkoe30pOwogICAgICB0aGlzLnVpWyRnbG9iYWxEYXRhXSA9IHRoaXNbJGdsb2JhbERhdGFdOwogICAgICB0aGlzWyRhcHBlbmRDaGlsZF0odGhpcy51aSk7CiAgICAgIGxldCBub2RlOwogICAgICBzd2l0Y2ggKHRoaXMuaXRlbXMuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgbm9kZSA9IG5ldyBUZXh0RWRpdCh7fSk7CiAgICAgICAgICB0aGlzLnVpLnRleHRFZGl0ID0gbm9kZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIG5vZGUgPSBuZXcgQ2hlY2tCdXR0b24oe30pOwogICAgICAgICAgdGhpcy51aS5jaGVja0J1dHRvbiA9IG5vZGU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBub2RlID0gbmV3IENob2ljZUxpc3Qoe30pOwogICAgICAgICAgdGhpcy51aS5jaG9pY2VMaXN0ID0gbm9kZTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMudWlbJGFwcGVuZENoaWxkXShub2RlKTsKICAgIH0KICAgIGlmICghdGhpcy51aSB8fCB0aGlzLnByZXNlbmNlID09PSAiaGlkZGVuIiB8fCB0aGlzLnByZXNlbmNlID09PSAiaW5hY3RpdmUiIHx8IHRoaXMuaCA9PT0gMCB8fCB0aGlzLncgPT09IDApIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBpZiAodGhpcy5jYXB0aW9uKSB7CiAgICAgIGRlbGV0ZSB0aGlzLmNhcHRpb25bJGV4dHJhXTsKICAgIH0KICAgIHRoaXNbJHB1c2hQYXJhXSgpOwogICAgY29uc3QgY2FwdGlvbiA9IHRoaXMuY2FwdGlvbiA/IHRoaXMuY2FwdGlvblskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkuaHRtbCA6IG51bGw7CiAgICBjb25zdCBzYXZlZFcgPSB0aGlzLnc7CiAgICBjb25zdCBzYXZlZEggPSB0aGlzLmg7CiAgICBsZXQgbWFyZ2luSCA9IDA7CiAgICBsZXQgbWFyZ2luViA9IDA7CiAgICBpZiAodGhpcy5tYXJnaW4pIHsKICAgICAgbWFyZ2luSCA9IHRoaXMubWFyZ2luLmxlZnRJbnNldCArIHRoaXMubWFyZ2luLnJpZ2h0SW5zZXQ7CiAgICAgIG1hcmdpblYgPSB0aGlzLm1hcmdpbi50b3BJbnNldCArIHRoaXMubWFyZ2luLmJvdHRvbUluc2V0OwogICAgfQogICAgbGV0IGJvcmRlckRpbXMgPSBudWxsOwogICAgaWYgKHRoaXMudyA9PT0gIiIgfHwgdGhpcy5oID09PSAiIikgewogICAgICBsZXQgd2lkdGggPSBudWxsOwogICAgICBsZXQgaGVpZ2h0ID0gbnVsbDsKICAgICAgbGV0IHVpVyA9IDA7CiAgICAgIGxldCB1aUggPSAwOwogICAgICBpZiAodGhpcy51aS5jaGVja0J1dHRvbikgewogICAgICAgIHVpVyA9IHVpSCA9IHRoaXMudWkuY2hlY2tCdXR0b24uc2l6ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICB3LAogICAgICAgICAgaAogICAgICAgIH0gPSBsYXlvdXROb2RlKHRoaXMsIGF2YWlsYWJsZVNwYWNlKTsKICAgICAgICBpZiAodyAhPT0gbnVsbCkgewogICAgICAgICAgdWlXID0gdzsKICAgICAgICAgIHVpSCA9IGg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHVpSCA9IGZvbnRzX2dldE1ldHJpY3ModGhpcy5mb250LCB0cnVlKS5saW5lTm9HYXA7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJvcmRlckRpbXMgPSBnZXRCb3JkZXJEaW1zKHRoaXMudWlbJGdldEV4dHJhXSgpKTsKICAgICAgdWlXICs9IGJvcmRlckRpbXMudzsKICAgICAgdWlIICs9IGJvcmRlckRpbXMuaDsKICAgICAgaWYgKHRoaXMuY2FwdGlvbikgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHcsCiAgICAgICAgICBoLAogICAgICAgICAgaXNCcm9rZW4KICAgICAgICB9ID0gdGhpcy5jYXB0aW9uWyRnZXRFeHRyYV0oYXZhaWxhYmxlU3BhY2UpOwogICAgICAgIGlmIChpc0Jyb2tlbiAmJiB0aGlzWyRnZXRTdWJmb3JtUGFyZW50XSgpWyRpc1RoZXJlTW9yZVdpZHRoXSgpKSB7CiAgICAgICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgICAgICB9CiAgICAgICAgd2lkdGggPSB3OwogICAgICAgIGhlaWdodCA9IGg7CiAgICAgICAgc3dpdGNoICh0aGlzLmNhcHRpb24ucGxhY2VtZW50KSB7CiAgICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICAgIGNhc2UgImlubGluZSI6CiAgICAgICAgICAgIHdpZHRoICs9IHVpVzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgICAgaGVpZ2h0ICs9IHVpSDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHdpZHRoID0gdWlXOwogICAgICAgIGhlaWdodCA9IHVpSDsKICAgICAgfQogICAgICBpZiAod2lkdGggJiYgdGhpcy53ID09PSAiIikgewogICAgICAgIHdpZHRoICs9IG1hcmdpbkg7CiAgICAgICAgdGhpcy53ID0gTWF0aC5taW4odGhpcy5tYXhXIDw9IDAgPyBJbmZpbml0eSA6IHRoaXMubWF4VywgdGhpcy5taW5XICsgMSA8IHdpZHRoID8gd2lkdGggOiB0aGlzLm1pblcpOwogICAgICB9CiAgICAgIGlmIChoZWlnaHQgJiYgdGhpcy5oID09PSAiIikgewogICAgICAgIGhlaWdodCArPSBtYXJnaW5WOwogICAgICAgIHRoaXMuaCA9IE1hdGgubWluKHRoaXMubWF4SCA8PSAwID8gSW5maW5pdHkgOiB0aGlzLm1heEgsIHRoaXMubWluSCArIDEgPCBoZWlnaHQgPyBoZWlnaHQgOiB0aGlzLm1pbkgpOwogICAgICB9CiAgICB9CiAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgZml4RGltZW5zaW9ucyh0aGlzKTsKICAgIHNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgaWYgKCFjaGVja0RpbWVuc2lvbnModGhpcywgYXZhaWxhYmxlU3BhY2UpKSB7CiAgICAgIHRoaXMudyA9IHNhdmVkVzsKICAgICAgdGhpcy5oID0gc2F2ZWRIOwogICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgfQogICAgdW5zZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiZm9udCIsICJkaW1lbnNpb25zIiwgInBvc2l0aW9uIiwgInJvdGF0ZSIsICJhbmNob3JUeXBlIiwgInByZXNlbmNlIiwgIm1hcmdpbiIsICJoQWxpZ24iKTsKICAgIHNldE1pbk1heERpbWVuc2lvbnModGhpcywgc3R5bGUpOwogICAgY29uc3QgY2xhc3NOYW1lcyA9IFsieGZhRmllbGQiXTsKICAgIGlmICh0aGlzLmZvbnQpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFGb250Iik7CiAgICB9CiAgICBpZiAoaXNQcmludE9ubHkodGhpcykpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFQcmludE9ubHkiKTsKICAgIH0KICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7CiAgICAgIHN0eWxlLAogICAgICBpZDogdGhpc1skdWlkXSwKICAgICAgY2xhc3M6IGNsYXNzTmFtZXMKICAgIH07CiAgICBpZiAoc3R5bGUubWFyZ2luKSB7CiAgICAgIHN0eWxlLnBhZGRpbmcgPSBzdHlsZS5tYXJnaW47CiAgICAgIGRlbGV0ZSBzdHlsZS5tYXJnaW47CiAgICB9CiAgICBzZXRBY2Nlc3ModGhpcywgY2xhc3NOYW1lcyk7CiAgICBpZiAodGhpcy5uYW1lKSB7CiAgICAgIGF0dHJpYnV0ZXMueGZhTmFtZSA9IHRoaXMubmFtZTsKICAgIH0KICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlcywKICAgICAgY2hpbGRyZW4KICAgIH07CiAgICBhcHBseUFzc2lzdCh0aGlzLCBhdHRyaWJ1dGVzKTsKICAgIGNvbnN0IGJvcmRlclN0eWxlID0gdGhpcy5ib3JkZXIgPyB0aGlzLmJvcmRlclskdG9TdHlsZV0oKSA6IG51bGw7CiAgICBjb25zdCBiYm94ID0gY29tcHV0ZUJib3godGhpcywgaHRtbCwgYXZhaWxhYmxlU3BhY2UpOwogICAgY29uc3QgdWkgPSB0aGlzLnVpWyR0b0hUTUxdKCkuaHRtbDsKICAgIGlmICghdWkpIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgYm9yZGVyU3R5bGUpOwogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGNyZWF0ZVdyYXBwZXIodGhpcywgaHRtbCksIGJib3gpOwogICAgfQogICAgaWYgKHRoaXNbJHRhYkluZGV4XSkgewogICAgICBpZiAodWkuY2hpbGRyZW4/LlswXSkgewogICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMudGFiaW5kZXggPSB0aGlzWyR0YWJJbmRleF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdWkuYXR0cmlidXRlcy50YWJpbmRleCA9IHRoaXNbJHRhYkluZGV4XTsKICAgICAgfQogICAgfQogICAgdWkuYXR0cmlidXRlcy5zdHlsZSB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGxldCBhRWxlbWVudCA9IG51bGw7CiAgICBpZiAodGhpcy51aS5idXR0b24pIHsKICAgICAgaWYgKHVpLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSkgewogICAgICAgIFthRWxlbWVudF0gPSB1aS5jaGlsZHJlbi5zcGxpY2UoMCwgMSk7CiAgICAgIH0KICAgICAgT2JqZWN0LmFzc2lnbih1aS5hdHRyaWJ1dGVzLnN0eWxlLCBib3JkZXJTdHlsZSk7CiAgICB9IGVsc2UgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCBib3JkZXJTdHlsZSk7CiAgICB9CiAgICBjaGlsZHJlbi5wdXNoKHVpKTsKICAgIGlmICh0aGlzLnZhbHVlKSB7CiAgICAgIGlmICh0aGlzLnVpLmltYWdlRWRpdCkgewogICAgICAgIHVpLmNoaWxkcmVuLnB1c2godGhpcy52YWx1ZVskdG9IVE1MXSgpLmh0bWwpOwogICAgICB9IGVsc2UgaWYgKCF0aGlzLnVpLmJ1dHRvbikgewogICAgICAgIGxldCB2YWx1ZSA9ICIiOwogICAgICAgIGlmICh0aGlzLnZhbHVlLmV4RGF0YSkgewogICAgICAgICAgdmFsdWUgPSB0aGlzLnZhbHVlLmV4RGF0YVskdGV4dF0oKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMudmFsdWUudGV4dCkgewogICAgICAgICAgdmFsdWUgPSB0aGlzLnZhbHVlLnRleHRbJGdldEV4dHJhXSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBodG1sVmFsdWUgPSB0aGlzLnZhbHVlWyR0b0hUTUxdKCkuaHRtbDsKICAgICAgICAgIGlmIChodG1sVmFsdWUgIT09IG51bGwpIHsKICAgICAgICAgICAgdmFsdWUgPSBodG1sVmFsdWUuY2hpbGRyZW5bMF0udmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnVpLnRleHRFZGl0ICYmIHRoaXMudmFsdWUudGV4dD8ubWF4Q2hhcnMpIHsKICAgICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMubWF4TGVuZ3RoID0gdGhpcy52YWx1ZS50ZXh0Lm1heENoYXJzOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgIGlmICh0aGlzLnVpLm51bWVyaWNFZGl0KSB7CiAgICAgICAgICAgIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7CiAgICAgICAgICAgIHZhbHVlID0gaXNOYU4odmFsdWUpID8gIiIgOiB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHVpLmNoaWxkcmVuWzBdLm5hbWUgPT09ICJ0ZXh0YXJlYSIpIHsKICAgICAgICAgICAgdWkuY2hpbGRyZW5bMF0uYXR0cmlidXRlcy50ZXh0Q29udGVudCA9IHZhbHVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWkuY2hpbGRyZW5bMF0uYXR0cmlidXRlcy52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLnVpLmltYWdlRWRpdCAmJiB1aS5jaGlsZHJlbj8uWzBdICYmIHRoaXMuaCkgewogICAgICBib3JkZXJEaW1zID0gYm9yZGVyRGltcyB8fCBnZXRCb3JkZXJEaW1zKHRoaXMudWlbJGdldEV4dHJhXSgpKTsKICAgICAgbGV0IGNhcHRpb25IZWlnaHQgPSAwOwogICAgICBpZiAodGhpcy5jYXB0aW9uICYmIFsidG9wIiwgImJvdHRvbSJdLmluY2x1ZGVzKHRoaXMuY2FwdGlvbi5wbGFjZW1lbnQpKSB7CiAgICAgICAgY2FwdGlvbkhlaWdodCA9IHRoaXMuY2FwdGlvbi5yZXNlcnZlOwogICAgICAgIGlmIChjYXB0aW9uSGVpZ2h0IDw9IDApIHsKICAgICAgICAgIGNhcHRpb25IZWlnaHQgPSB0aGlzLmNhcHRpb25bJGdldEV4dHJhXShhdmFpbGFibGVTcGFjZSkuaDsKICAgICAgICB9CiAgICAgICAgY29uc3QgaW5wdXRIZWlnaHQgPSB0aGlzLmggLSBjYXB0aW9uSGVpZ2h0IC0gbWFyZ2luViAtIGJvcmRlckRpbXMuaDsKICAgICAgICB1aS5jaGlsZHJlblswXS5hdHRyaWJ1dGVzLnN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhpbnB1dEhlaWdodCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdWkuY2hpbGRyZW5bMF0uYXR0cmlidXRlcy5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIH0KICAgIH0KICAgIGlmIChhRWxlbWVudCkgewogICAgICB1aS5jaGlsZHJlbi5wdXNoKGFFbGVtZW50KTsKICAgIH0KICAgIGlmICghY2FwdGlvbikgewogICAgICBpZiAodWkuYXR0cmlidXRlcy5jbGFzcykgewogICAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhTGVmdCIpOwogICAgICB9CiAgICAgIHRoaXMudyA9IHNhdmVkVzsKICAgICAgdGhpcy5oID0gc2F2ZWRIOwogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGNyZWF0ZVdyYXBwZXIodGhpcywgaHRtbCksIGJib3gpOwogICAgfQogICAgaWYgKHRoaXMudWkuYnV0dG9uKSB7CiAgICAgIGlmIChzdHlsZS5wYWRkaW5nKSB7CiAgICAgICAgZGVsZXRlIHN0eWxlLnBhZGRpbmc7CiAgICAgIH0KICAgICAgaWYgKGNhcHRpb24ubmFtZSA9PT0gImRpdiIpIHsKICAgICAgICBjYXB0aW9uLm5hbWUgPSAic3BhbiI7CiAgICAgIH0KICAgICAgdWkuY2hpbGRyZW4ucHVzaChjYXB0aW9uKTsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhodG1sLCBiYm94KTsKICAgIH0gZWxzZSBpZiAodGhpcy51aS5jaGVja0J1dHRvbikgewogICAgICBjYXB0aW9uLmF0dHJpYnV0ZXMuY2xhc3NbMF0gPSAieGZhQ2FwdGlvbkZvckNoZWNrQnV0dG9uIjsKICAgIH0KICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MgfHw9IFtdOwogICAgdWkuY2hpbGRyZW4uc3BsaWNlKDAsIDAsIGNhcHRpb24pOwogICAgc3dpdGNoICh0aGlzLmNhcHRpb24ucGxhY2VtZW50KSB7CiAgICAgIGNhc2UgImxlZnQiOgogICAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhTGVmdCIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgdWkuYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFSaWdodCIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJ0b3AiOgogICAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhVG9wIik7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgdWkuYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFCb3R0b20iKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiaW5saW5lIjoKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYUxlZnQiKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHRoaXMudyA9IHNhdmVkVzsKICAgIHRoaXMuaCA9IHNhdmVkSDsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoY3JlYXRlV3JhcHBlcih0aGlzLCBodG1sKSwgYmJveCk7CiAgfQp9CmNsYXNzIEZpbGwgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZmlsbCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5saW5lYXIgPSBudWxsOwogICAgdGhpcy5wYXR0ZXJuID0gbnVsbDsKICAgIHRoaXMucmFkaWFsID0gbnVsbDsKICAgIHRoaXMuc29saWQgPSBudWxsOwogICAgdGhpcy5zdGlwcGxlID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGdyYW5kcGEgPSBwYXJlbnRbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGdncmFuZHBhID0gZ3JhbmRwYVskZ2V0UGFyZW50XSgpOwogICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgbGV0IHByb3BOYW1lID0gImNvbG9yIjsKICAgIGxldCBhbHRQcm9wTmFtZSA9IHByb3BOYW1lOwogICAgaWYgKHBhcmVudCBpbnN0YW5jZW9mIEJvcmRlcikgewogICAgICBwcm9wTmFtZSA9ICJiYWNrZ3JvdW5kLWNvbG9yIjsKICAgICAgYWx0UHJvcE5hbWUgPSAiYmFja2dyb3VuZCI7CiAgICAgIGlmIChnZ3JhbmRwYSBpbnN0YW5jZW9mIFVpKSB7CiAgICAgICAgc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIndoaXRlIjsKICAgICAgfQogICAgfQogICAgaWYgKHBhcmVudCBpbnN0YW5jZW9mIFJlY3RhbmdsZSB8fCBwYXJlbnQgaW5zdGFuY2VvZiBBcmMpIHsKICAgICAgcHJvcE5hbWUgPSBhbHRQcm9wTmFtZSA9ICJmaWxsIjsKICAgICAgc3R5bGUuZmlsbCA9ICJ3aGl0ZSI7CiAgICB9CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgaWYgKG5hbWUgPT09ICJleHRyYXMiIHx8IG5hbWUgPT09ICJjb2xvciIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBvYmogPSB0aGlzW25hbWVdOwogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBYRkFPYmplY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgY29sb3IgPSBvYmpbJHRvU3R5bGVdKHRoaXMuY29sb3IpOwogICAgICBpZiAoY29sb3IpIHsKICAgICAgICBzdHlsZVtjb2xvci5zdGFydHNXaXRoKCIjIikgPyBwcm9wTmFtZSA6IGFsdFByb3BOYW1lXSA9IGNvbG9yOwogICAgICB9CiAgICAgIHJldHVybiBzdHlsZTsKICAgIH0KICAgIGlmICh0aGlzLmNvbG9yPy52YWx1ZSkgewogICAgICBjb25zdCBjb2xvciA9IHRoaXMuY29sb3JbJHRvU3R5bGVdKCk7CiAgICAgIHN0eWxlW2NvbG9yLnN0YXJ0c1dpdGgoIiMiKSA/IHByb3BOYW1lIDogYWx0UHJvcE5hbWVdID0gY29sb3I7CiAgICB9CiAgICByZXR1cm4gc3R5bGU7CiAgfQp9CmNsYXNzIEZpbHRlciBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmaWx0ZXIiLCB0cnVlKTsKICAgIHRoaXMuYWRkUmV2b2NhdGlvbkluZm8gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hZGRSZXZvY2F0aW9uSW5mbywgWyIiLCAicmVxdWlyZWQiLCAib3B0aW9uYWwiLCAibm9uZSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudmVyc2lvbiA9IGdldEludGVnZXIoewogICAgICBkYXRhOiB0aGlzLnZlcnNpb24sCiAgICAgIGRlZmF1bHRWYWx1ZTogNSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAxICYmIHggPD0gNQogICAgfSk7CiAgICB0aGlzLmFwcGVhcmFuY2VGaWx0ZXIgPSBudWxsOwogICAgdGhpcy5jZXJ0aWZpY2F0ZXMgPSBudWxsOwogICAgdGhpcy5kaWdlc3RNZXRob2RzID0gbnVsbDsKICAgIHRoaXMuZW5jb2RpbmdzID0gbnVsbDsKICAgIHRoaXMuZW5jcnlwdGlvbk1ldGhvZHMgPSBudWxsOwogICAgdGhpcy5oYW5kbGVyID0gbnVsbDsKICAgIHRoaXMubG9ja0RvY3VtZW50ID0gbnVsbDsKICAgIHRoaXMubWRwID0gbnVsbDsKICAgIHRoaXMucmVhc29ucyA9IG51bGw7CiAgICB0aGlzLnRpbWVTdGFtcCA9IG51bGw7CiAgfQp9CmNsYXNzIEZsb2F0IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmbG9hdCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IG51bWJlciA9IHBhcnNlRmxvYXQodGhpc1skY29udGVudF0udHJpbSgpKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gaXNOYU4obnVtYmVyKSA/IG51bGwgOiBudW1iZXI7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdICE9PSBudWxsID8gdGhpc1skY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgdGVtcGxhdGVfRm9udCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmb250IiwgdHJ1ZSk7CiAgICB0aGlzLmJhc2VsaW5lU2hpZnQgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmJhc2VsaW5lU2hpZnQpOwogICAgdGhpcy5mb250SG9yaXpvbnRhbFNjYWxlID0gZ2V0RmxvYXQoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmZvbnRIb3Jpem9udGFsU2NhbGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMTAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5mb250VmVydGljYWxTY2FsZSA9IGdldEZsb2F0KHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5mb250VmVydGljYWxTY2FsZSwKICAgICAgZGVmYXVsdFZhbHVlOiAxMDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMua2VybmluZ01vZGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5rZXJuaW5nTW9kZSwgWyJub25lIiwgInBhaXIiXSk7CiAgICB0aGlzLmxldHRlclNwYWNpbmcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmxldHRlclNwYWNpbmcsICIwIik7CiAgICB0aGlzLmxpbmVUaHJvdWdoID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubGluZVRocm91Z2gsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMSB8fCB4ID09PSAyCiAgICB9KTsKICAgIHRoaXMubGluZVRocm91Z2hQZXJpb2QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5saW5lVGhyb3VnaFBlcmlvZCwgWyJhbGwiLCAid29yZCJdKTsKICAgIHRoaXMub3ZlcmxpbmUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5vdmVybGluZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxIHx8IHggPT09IDIKICAgIH0pOwogICAgdGhpcy5vdmVybGluZVBlcmlvZCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm92ZXJsaW5lUGVyaW9kLCBbImFsbCIsICJ3b3JkIl0pOwogICAgdGhpcy5wb3N0dXJlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucG9zdHVyZSwgWyJub3JtYWwiLCAiaXRhbGljIl0pOwogICAgdGhpcy5zaXplID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5zaXplLCAiMTBwdCIpOwogICAgdGhpcy50eXBlZmFjZSA9IGF0dHJpYnV0ZXMudHlwZWZhY2UgfHwgIkNvdXJpZXIiOwogICAgdGhpcy51bmRlcmxpbmUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy51bmRlcmxpbmUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMSB8fCB4ID09PSAyCiAgICB9KTsKICAgIHRoaXMudW5kZXJsaW5lUGVyaW9kID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudW5kZXJsaW5lUGVyaW9kLCBbImFsbCIsICJ3b3JkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMud2VpZ2h0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMud2VpZ2h0LCBbIm5vcm1hbCIsICJib2xkIl0pOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5maWxsID0gbnVsbDsKICB9CiAgWyRjbGVhbl0oYnVpbGRlcikgewogICAgc3VwZXJbJGNsZWFuXShidWlsZGVyKTsKICAgIHRoaXNbJGdsb2JhbERhdGFdLnVzZWRUeXBlZmFjZXMuYWRkKHRoaXMudHlwZWZhY2UpOwogIH0KICBbJHRvU3R5bGVdKCkgewogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJmaWxsIik7CiAgICBjb25zdCBjb2xvciA9IHN0eWxlLmNvbG9yOwogICAgaWYgKGNvbG9yKSB7CiAgICAgIGlmIChjb2xvciA9PT0gIiMwMDAwMDAiKSB7CiAgICAgICAgZGVsZXRlIHN0eWxlLmNvbG9yOwogICAgICB9IGVsc2UgaWYgKCFjb2xvci5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgICBzdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7CiAgICAgICAgc3R5bGUuYmFja2dyb3VuZENsaXAgPSAidGV4dCI7CiAgICAgICAgc3R5bGUuY29sb3IgPSAidHJhbnNwYXJlbnQiOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5iYXNlbGluZVNoaWZ0KSB7CiAgICAgIHN0eWxlLnZlcnRpY2FsQWxpZ24gPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5iYXNlbGluZVNoaWZ0KTsKICAgIH0KICAgIHN0eWxlLmZvbnRLZXJuaW5nID0gdGhpcy5rZXJuaW5nTW9kZSA9PT0gIm5vbmUiID8gIm5vbmUiIDogIm5vcm1hbCI7CiAgICBzdHlsZS5sZXR0ZXJTcGFjaW5nID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMubGV0dGVyU3BhY2luZyk7CiAgICBpZiAodGhpcy5saW5lVGhyb3VnaCAhPT0gMCkgewogICAgICBzdHlsZS50ZXh0RGVjb3JhdGlvbiA9ICJsaW5lLXRocm91Z2giOwogICAgICBpZiAodGhpcy5saW5lVGhyb3VnaCA9PT0gMikgewogICAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uU3R5bGUgPSAiZG91YmxlIjsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMub3ZlcmxpbmUgIT09IDApIHsKICAgICAgc3R5bGUudGV4dERlY29yYXRpb24gPSAib3ZlcmxpbmUiOwogICAgICBpZiAodGhpcy5vdmVybGluZSA9PT0gMikgewogICAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uU3R5bGUgPSAiZG91YmxlIjsKICAgICAgfQogICAgfQogICAgc3R5bGUuZm9udFN0eWxlID0gdGhpcy5wb3N0dXJlOwogICAgc3R5bGUuZm9udFNpemUgPSBtZWFzdXJlVG9TdHJpbmcoMC45OSAqIHRoaXMuc2l6ZSk7CiAgICBzZXRGb250RmFtaWx5KHRoaXMsIHRoaXMsIHRoaXNbJGdsb2JhbERhdGFdLmZvbnRGaW5kZXIsIHN0eWxlKTsKICAgIGlmICh0aGlzLnVuZGVybGluZSAhPT0gMCkgewogICAgICBzdHlsZS50ZXh0RGVjb3JhdGlvbiA9ICJ1bmRlcmxpbmUiOwogICAgICBpZiAodGhpcy51bmRlcmxpbmUgPT09IDIpIHsKICAgICAgICBzdHlsZS50ZXh0RGVjb3JhdGlvblN0eWxlID0gImRvdWJsZSI7CiAgICAgIH0KICAgIH0KICAgIHN0eWxlLmZvbnRXZWlnaHQgPSB0aGlzLndlaWdodDsKICAgIHJldHVybiBzdHlsZTsKICB9Cn0KY2xhc3MgRm9ybWF0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImZvcm1hdCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5waWN0dXJlID0gbnVsbDsKICB9Cn0KY2xhc3MgSGFuZGxlciBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJoYW5kbGVyIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBIeXBoZW5hdGlvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJoeXBoZW5hdGlvbiIpOwogICAgdGhpcy5leGNsdWRlQWxsQ2FwcyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmV4Y2x1ZGVBbGxDYXBzLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5leGNsdWRlSW5pdGlhbENhcCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmV4Y2x1ZGVJbml0aWFsQ2FwLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5oeXBoZW5hdGUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5oeXBoZW5hdGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucHVzaENoYXJhY3RlckNvdW50ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucHVzaENoYXJhY3RlckNvdW50LAogICAgICBkZWZhdWx0VmFsdWU6IDMsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLnJlbWFpbkNoYXJhY3RlckNvdW50ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucmVtYWluQ2hhcmFjdGVyQ291bnQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMywKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLndvcmRDaGFyYWN0ZXJDb3VudCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLndvcmRDaGFyYWN0ZXJDb3VudCwKICAgICAgZGVmYXVsdFZhbHVlOiA3LAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogIH0KfQpjbGFzcyBJbWFnZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJpbWFnZSIpOwogICAgdGhpcy5hc3BlY3QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hc3BlY3QsIFsiZml0IiwgImFjdHVhbCIsICJoZWlnaHQiLCAibm9uZSIsICJ3aWR0aCJdKTsKICAgIHRoaXMuY29udGVudFR5cGUgPSBhdHRyaWJ1dGVzLmNvbnRlbnRUeXBlIHx8ICIiOwogICAgdGhpcy5ocmVmID0gYXR0cmlidXRlcy5ocmVmIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnRyYW5zZmVyRW5jb2RpbmcgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50cmFuc2ZlckVuY29kaW5nLCBbImJhc2U2NCIsICJub25lIiwgInBhY2thZ2UiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJHRvSFRNTF0oKSB7CiAgICBpZiAodGhpcy5jb250ZW50VHlwZSAmJiAhTUlNRVMuaGFzKHRoaXMuY29udGVudFR5cGUudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBsZXQgYnVmZmVyID0gdGhpc1skZ2xvYmFsRGF0YV0uaW1hZ2VzPy5nZXQodGhpcy5ocmVmKTsKICAgIGlmICghYnVmZmVyICYmICh0aGlzLmhyZWYgfHwgIXRoaXNbJGNvbnRlbnRdKSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGlmICghYnVmZmVyICYmIHRoaXMudHJhbnNmZXJFbmNvZGluZyA9PT0gImJhc2U2NCIpIHsKICAgICAgYnVmZmVyID0gZnJvbUJhc2U2NFV0aWwodGhpc1skY29udGVudF0pOwogICAgfQogICAgaWYgKCFidWZmZXIpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBpZiAoIXRoaXMuY29udGVudFR5cGUpIHsKICAgICAgZm9yIChjb25zdCBbaGVhZGVyLCB0eXBlXSBvZiBJTUFHRVNfSEVBREVSUykgewogICAgICAgIGlmIChidWZmZXIubGVuZ3RoID4gaGVhZGVyLmxlbmd0aCAmJiBoZWFkZXIuZXZlcnkoKHgsIGkpID0+IHggPT09IGJ1ZmZlcltpXSkpIHsKICAgICAgICAgIHRoaXMuY29udGVudFR5cGUgPSB0eXBlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghdGhpcy5jb250ZW50VHlwZSkgewogICAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgICB9CiAgICB9CiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2J1ZmZlcl0sIHsKICAgICAgdHlwZTogdGhpcy5jb250ZW50VHlwZQogICAgfSk7CiAgICBsZXQgc3R5bGU7CiAgICBzd2l0Y2ggKHRoaXMuYXNwZWN0KSB7CiAgICAgIGNhc2UgImZpdCI6CiAgICAgIGNhc2UgImFjdHVhbCI6CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImhlaWdodCI6CiAgICAgICAgc3R5bGUgPSB7CiAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICAgIG9iamVjdEZpdDogImZpbGwiCiAgICAgICAgfTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAibm9uZSI6CiAgICAgICAgc3R5bGUgPSB7CiAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgaGVpZ2h0OiAiMTAwJSIsCiAgICAgICAgICBvYmplY3RGaXQ6ICJmaWxsIgogICAgICAgIH07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIndpZHRoIjoKICAgICAgICBzdHlsZSA9IHsKICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICBvYmplY3RGaXQ6ICJmaWxsIgogICAgICAgIH07CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImltZyIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFJbWFnZSJdLAogICAgICAgIHN0eWxlLAogICAgICAgIHNyYzogVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSwKICAgICAgICBhbHQ6IHBhcmVudCA/IGFyaWFMYWJlbChwYXJlbnRbJGdldFBhcmVudF0oKSkgOiBudWxsCiAgICAgIH0KICAgIH0pOwogIH0KfQpjbGFzcyBJbWFnZUVkaXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaW1hZ2VFZGl0IiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGEgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5kYXRhLCBbImxpbmsiLCAiZW1iZWQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgaWYgKHRoaXMuZGF0YSA9PT0gImVtYmVkIikgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgYXR0cmlidXRlczoge30KICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICB9Cn0KY2xhc3MgSW50ZWdlciBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaW50ZWdlciIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IG51bWJlciA9IHBhcnNlSW50KHRoaXNbJGNvbnRlbnRdLnRyaW0oKSwgMTApOwogICAgdGhpc1skY29udGVudF0gPSBpc05hTihudW1iZXIpID8gbnVsbCA6IG51bWJlcjsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1skY29udGVudF0gIT09IG51bGwgPyB0aGlzWyRjb250ZW50XS50b1N0cmluZygpIDogIiIpOwogIH0KfQpjbGFzcyBJc3N1ZXJzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImlzc3VlcnMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNlcnRpZmljYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEl0ZW1zIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIml0ZW1zIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy5zYXZlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuc2F2ZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvb2xlYW4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWNpbWFsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJHRvSFRNTF0oKSB7CiAgICBjb25zdCBvdXRwdXQgPSBbXTsKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1skZ2V0Q2hpbGRyZW5dKCkpIHsKICAgICAgb3V0cHV0LnB1c2goY2hpbGRbJHRleHRdKCkpOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhvdXRwdXQpOwogIH0KfQpjbGFzcyBLZWVwIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImtlZXAiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgY29uc3Qgb3B0aW9ucyA9IFsibm9uZSIsICJjb250ZW50QXJlYSIsICJwYWdlQXJlYSJdOwogICAgdGhpcy5pbnRhY3QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5pbnRhY3QsIG9wdGlvbnMpOwogICAgdGhpcy5uZXh0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmV4dCwgb3B0aW9ucyk7CiAgICB0aGlzLnByZXZpb3VzID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJldmlvdXMsIG9wdGlvbnMpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9Cn0KY2xhc3MgS2V5VXNhZ2UgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAia2V5VXNhZ2UiKTsKICAgIGNvbnN0IG9wdGlvbnMgPSBbIiIsICJ5ZXMiLCAibm8iXTsKICAgIHRoaXMuY3JsU2lnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmNybFNpZ24sIG9wdGlvbnMpOwogICAgdGhpcy5kYXRhRW5jaXBoZXJtZW50ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZGF0YUVuY2lwaGVybWVudCwgb3B0aW9ucyk7CiAgICB0aGlzLmRlY2lwaGVyT25seSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmRlY2lwaGVyT25seSwgb3B0aW9ucyk7CiAgICB0aGlzLmRpZ2l0YWxTaWduYXR1cmUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5kaWdpdGFsU2lnbmF0dXJlLCBvcHRpb25zKTsKICAgIHRoaXMuZW5jaXBoZXJPbmx5ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZW5jaXBoZXJPbmx5LCBvcHRpb25zKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5rZXlBZ3JlZW1lbnQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5rZXlBZ3JlZW1lbnQsIG9wdGlvbnMpOwogICAgdGhpcy5rZXlDZXJ0U2lnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmtleUNlcnRTaWduLCBvcHRpb25zKTsKICAgIHRoaXMua2V5RW5jaXBoZXJtZW50ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMua2V5RW5jaXBoZXJtZW50LCBvcHRpb25zKTsKICAgIHRoaXMubm9uUmVwdWRpYXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5ub25SZXB1ZGlhdGlvbiwgb3B0aW9ucyk7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgTGluZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJsaW5lIiwgdHJ1ZSk7CiAgICB0aGlzLmhhbmQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oYW5kLCBbImV2ZW4iLCAibGVmdCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5zbG9wZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnNsb3BlLCBbIlxcIiwgIi8iXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5lZGdlID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKCkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBlZGdlID0gdGhpcy5lZGdlIHx8IG5ldyBFZGdlKHt9KTsKICAgIGNvbnN0IGVkZ2VTdHlsZSA9IGVkZ2VbJHRvU3R5bGVdKCk7CiAgICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCB0aGlja25lc3MgPSBlZGdlLnByZXNlbmNlID09PSAidmlzaWJsZSIgPyBlZGdlLnRoaWNrbmVzcyA6IDA7CiAgICBzdHlsZS5zdHJva2VXaWR0aCA9IG1lYXN1cmVUb1N0cmluZyh0aGlja25lc3MpOwogICAgc3R5bGUuc3Ryb2tlID0gZWRnZVN0eWxlLmNvbG9yOwogICAgbGV0IHgxLCB5MSwgeDIsIHkyOwogICAgbGV0IHdpZHRoID0gIjEwMCUiOwogICAgbGV0IGhlaWdodCA9ICIxMDAlIjsKICAgIGlmIChwYXJlbnQudyA8PSB0aGlja25lc3MpIHsKICAgICAgW3gxLCB5MSwgeDIsIHkyXSA9IFsiNTAlIiwgMCwgIjUwJSIsICIxMDAlIl07CiAgICAgIHdpZHRoID0gc3R5bGUuc3Ryb2tlV2lkdGg7CiAgICB9IGVsc2UgaWYgKHBhcmVudC5oIDw9IHRoaWNrbmVzcykgewogICAgICBbeDEsIHkxLCB4MiwgeTJdID0gWzAsICI1MCUiLCAiMTAwJSIsICI1MCUiXTsKICAgICAgaGVpZ2h0ID0gc3R5bGUuc3Ryb2tlV2lkdGg7CiAgICB9IGVsc2UgaWYgKHRoaXMuc2xvcGUgPT09ICJcXCIpIHsKICAgICAgW3gxLCB5MSwgeDIsIHkyXSA9IFswLCAwLCAiMTAwJSIsICIxMDAlIl07CiAgICB9IGVsc2UgewogICAgICBbeDEsIHkxLCB4MiwgeTJdID0gWzAsICIxMDAlIiwgIjEwMCUiLCAwXTsKICAgIH0KICAgIGNvbnN0IGxpbmUgPSB7CiAgICAgIG5hbWU6ICJsaW5lIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgeDEsCiAgICAgICAgeTEsCiAgICAgICAgeDIsCiAgICAgICAgeTIsCiAgICAgICAgc3R5bGUKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHN2ZyA9IHsKICAgICAgbmFtZTogInN2ZyIsCiAgICAgIGNoaWxkcmVuOiBbbGluZV0sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB4bWxuczogU1ZHX05TLAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICBzdHlsZTogewogICAgICAgICAgb3ZlcmZsb3c6ICJ2aXNpYmxlIgogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGlmIChoYXNNYXJnaW4ocGFyZW50KSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lIiwKICAgICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgICAgaGVpZ2h0OiAiMTAwJSIKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNoaWxkcmVuOiBbc3ZnXQogICAgICB9KTsKICAgIH0KICAgIHN2Zy5hdHRyaWJ1dGVzLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3Moc3ZnKTsKICB9Cn0KY2xhc3MgTGluZWFyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImxpbmVhciIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbInRvUmlnaHQiLCAidG9Cb3R0b20iLCAidG9MZWZ0IiwgInRvVG9wIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKHN0YXJ0Q29sb3IpIHsKICAgIHN0YXJ0Q29sb3IgPSBzdGFydENvbG9yID8gc3RhcnRDb2xvclskdG9TdHlsZV0oKSA6ICIjRkZGRkZGIjsKICAgIGNvbnN0IHRyYW5zZiA9IHRoaXMudHlwZS5yZXBsYWNlKC8oW1JCTFRdKS8sICIgJDEiKS50b0xvd2VyQ2FzZSgpOwogICAgY29uc3QgZW5kQ29sb3IgPSB0aGlzLmNvbG9yID8gdGhpcy5jb2xvclskdG9TdHlsZV0oKSA6ICIjMDAwMDAwIjsKICAgIHJldHVybiBgbGluZWFyLWdyYWRpZW50KCR7dHJhbnNmfSwgJHtzdGFydENvbG9yfSwgJHtlbmRDb2xvcn0pYDsKICB9Cn0KY2xhc3MgTG9ja0RvY3VtZW50IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJsb2NrRG9jdW1lbnQiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSBnZXRTdHJpbmdPcHRpb24odGhpc1skY29udGVudF0sIFsiYXV0byIsICIwIiwgIjEiXSk7CiAgfQp9CmNsYXNzIE1hbmlmZXN0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm1hbmlmZXN0IiwgdHJ1ZSk7CiAgICB0aGlzLmFjdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFjdGlvbiwgWyJpbmNsdWRlIiwgImFsbCIsICJleGNsdWRlIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5yZWYgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgTWFyZ2luIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm1hcmdpbiIsIHRydWUpOwogICAgdGhpcy5ib3R0b21JbnNldCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuYm90dG9tSW5zZXQsICIwIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVmdEluc2V0ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5sZWZ0SW5zZXQsICIwIik7CiAgICB0aGlzLnJpZ2h0SW5zZXQgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnJpZ2h0SW5zZXQsICIwIik7CiAgICB0aGlzLnRvcEluc2V0ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy50b3BJbnNldCwgIjAiKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICByZXR1cm4gewogICAgICBtYXJnaW46IG1lYXN1cmVUb1N0cmluZyh0aGlzLnRvcEluc2V0KSArICIgIiArIG1lYXN1cmVUb1N0cmluZyh0aGlzLnJpZ2h0SW5zZXQpICsgIiAiICsgbWVhc3VyZVRvU3RyaW5nKHRoaXMuYm90dG9tSW5zZXQpICsgIiAiICsgbWVhc3VyZVRvU3RyaW5nKHRoaXMubGVmdEluc2V0KQogICAgfTsKICB9Cn0KY2xhc3MgTWRwIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm1kcCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnBlcm1pc3Npb25zID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucGVybWlzc2lvbnMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMiwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMSB8fCB4ID09PSAzCiAgICB9KTsKICAgIHRoaXMuc2lnbmF0dXJlVHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnNpZ25hdHVyZVR5cGUsIFsiZmlsbGVyIiwgImF1dGhvciJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIE1lZGl1bSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJtZWRpdW0iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5pbWFnaW5nQkJveCA9IGdldEJCb3goYXR0cmlidXRlcy5pbWFnaW5nQkJveCk7CiAgICB0aGlzLmxvbmcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmxvbmcpOwogICAgdGhpcy5vcmllbnRhdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm9yaWVudGF0aW9uLCBbInBvcnRyYWl0IiwgImxhbmRzY2FwZSJdKTsKICAgIHRoaXMuc2hvcnQgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnNob3J0KTsKICAgIHRoaXMuc3RvY2sgPSBhdHRyaWJ1dGVzLnN0b2NrIHx8ICIiOwogICAgdGhpcy50cmF5SW4gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50cmF5SW4sIFsiYXV0byIsICJkZWxlZ2F0ZSIsICJwYWdlRnJvbnQiXSk7CiAgICB0aGlzLnRyYXlPdXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50cmF5T3V0LCBbImF1dG8iLCAiZGVsZWdhdGUiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBNZXNzYWdlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm1lc3NhZ2UiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudGV4dCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBOdW1lcmljRWRpdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJudW1lcmljRWRpdCIsIHRydWUpOwogICAgdGhpcy5oU2Nyb2xsUG9saWN5ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaFNjcm9sbFBvbGljeSwgWyJhdXRvIiwgIm9mZiIsICJvbiJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuY29tYiA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJib3JkZXIiLCAiZm9udCIsICJtYXJnaW4iKTsKICAgIGNvbnN0IGZpZWxkID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiaW5wdXQiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgIGZpZWxkSWQ6IGZpZWxkWyR1aWRdLAogICAgICAgIGRhdGFJZDogZmllbGRbJGRhdGFdPy5bJHVpZF0gfHwgZmllbGRbJHVpZF0sCiAgICAgICAgY2xhc3M6IFsieGZhVGV4dGZpZWxkIl0sCiAgICAgICAgc3R5bGUsCiAgICAgICAgImFyaWEtbGFiZWwiOiBhcmlhTGFiZWwoZmllbGQpLAogICAgICAgICJhcmlhLXJlcXVpcmVkIjogZmFsc2UKICAgICAgfQogICAgfTsKICAgIGlmIChpc1JlcXVpcmVkKGZpZWxkKSkgewogICAgICBodG1sLmF0dHJpYnV0ZXNbImFyaWEtcmVxdWlyZWQiXSA9IHRydWU7CiAgICAgIGh0bWwuYXR0cmlidXRlcy5yZXF1aXJlZCA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImxhYmVsIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYUxhYmVsIl0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IFtodG1sXQogICAgfSk7CiAgfQp9CmNsYXNzIE9jY3VyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm9jY3VyIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuaW5pdGlhbCA9IGF0dHJpYnV0ZXMuaW5pdGlhbCAhPT0gIiIgPyBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5pbml0aWFsLAogICAgICBkZWZhdWx0VmFsdWU6ICIiLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KSA6ICIiOwogICAgdGhpcy5tYXggPSBhdHRyaWJ1dGVzLm1heCAhPT0gIiIgPyBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5tYXgsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pIDogIiI7CiAgICB0aGlzLm1pbiA9IGF0dHJpYnV0ZXMubWluICE9PSAiIiA/IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1pbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KSA6ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyRjbGVhbl0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBvcmlnaW5hbE1pbiA9IHRoaXMubWluOwogICAgaWYgKHRoaXMubWluID09PSAiIikgewogICAgICB0aGlzLm1pbiA9IHBhcmVudCBpbnN0YW5jZW9mIFBhZ2VBcmVhIHx8IHBhcmVudCBpbnN0YW5jZW9mIFBhZ2VTZXQgPyAwIDogMTsKICAgIH0KICAgIGlmICh0aGlzLm1heCA9PT0gIiIpIHsKICAgICAgaWYgKG9yaWdpbmFsTWluID09PSAiIikgewogICAgICAgIHRoaXMubWF4ID0gcGFyZW50IGluc3RhbmNlb2YgUGFnZUFyZWEgfHwgcGFyZW50IGluc3RhbmNlb2YgUGFnZVNldCA/IC0xIDogMTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm1heCA9IHRoaXMubWluOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5tYXggIT09IC0xICYmIHRoaXMubWF4IDwgdGhpcy5taW4pIHsKICAgICAgdGhpcy5tYXggPSB0aGlzLm1pbjsKICAgIH0KICAgIGlmICh0aGlzLmluaXRpYWwgPT09ICIiKSB7CiAgICAgIHRoaXMuaW5pdGlhbCA9IHBhcmVudCBpbnN0YW5jZW9mIFRlbXBsYXRlID8gMSA6IHRoaXMubWluOwogICAgfQogIH0KfQpjbGFzcyBPaWQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAib2lkIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIE9pZHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAib2lkcyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMub2lkID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIE92ZXJmbG93IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm92ZXJmbG93Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVhZGVyID0gYXR0cmlidXRlcy5sZWFkZXIgfHwgIiI7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogICAgdGhpcy50cmFpbGVyID0gYXR0cmlidXRlcy50cmFpbGVyIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRnZXRFeHRyYV0oKSB7CiAgICBpZiAoIXRoaXNbJGV4dHJhXSkgewogICAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICAgIGNvbnN0IHJvb3QgPSB0aGlzWyRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgICAgIGNvbnN0IHRhcmdldCA9IHJvb3RbJHNlYXJjaE5vZGVdKHRoaXMudGFyZ2V0LCBwYXJlbnQpOwogICAgICBjb25zdCBsZWFkZXIgPSByb290WyRzZWFyY2hOb2RlXSh0aGlzLmxlYWRlciwgcGFyZW50KTsKICAgICAgY29uc3QgdHJhaWxlciA9IHJvb3RbJHNlYXJjaE5vZGVdKHRoaXMudHJhaWxlciwgcGFyZW50KTsKICAgICAgdGhpc1skZXh0cmFdID0gewogICAgICAgIHRhcmdldDogdGFyZ2V0Py5bMF0gfHwgbnVsbCwKICAgICAgICBsZWFkZXI6IGxlYWRlcj8uWzBdIHx8IG51bGwsCiAgICAgICAgdHJhaWxlcjogdHJhaWxlcj8uWzBdIHx8IG51bGwsCiAgICAgICAgYWRkTGVhZGVyOiBmYWxzZSwKICAgICAgICBhZGRUcmFpbGVyOiBmYWxzZQogICAgICB9OwogICAgfQogICAgcmV0dXJuIHRoaXNbJGV4dHJhXTsKICB9Cn0KY2xhc3MgUGFnZUFyZWEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGFnZUFyZWEiLCB0cnVlKTsKICAgIHRoaXMuYmxhbmtPck5vdEJsYW5rID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYmxhbmtPck5vdEJsYW5rLCBbImFueSIsICJibGFuayIsICJub3RCbGFuayJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5pbml0aWFsTnVtYmVyID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuaW5pdGlhbE51bWJlciwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMubnVtYmVyZWQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5udW1iZXJlZCwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMub2RkT3JFdmVuID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub2RkT3JFdmVuLCBbImFueSIsICJldmVuIiwgIm9kZCJdKTsKICAgIHRoaXMucGFnZVBvc2l0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucGFnZVBvc2l0aW9uLCBbImFueSIsICJmaXJzdCIsICJsYXN0IiwgIm9ubHkiLCAicmVzdCJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tZWRpdW0gPSBudWxsOwogICAgdGhpcy5vY2N1ciA9IG51bGw7CiAgICB0aGlzLmFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29udGVudEFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZHJhdyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGNsR3JvdXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGlzVXNhYmxlXSgpIHsKICAgIGlmICghdGhpc1skZXh0cmFdKSB7CiAgICAgIHRoaXNbJGV4dHJhXSA9IHsKICAgICAgICBudW1iZXJPZlVzZTogMAogICAgICB9OwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiAhdGhpcy5vY2N1ciB8fCB0aGlzLm9jY3VyLm1heCA9PT0gLTEgfHwgdGhpc1skZXh0cmFdLm51bWJlck9mVXNlIDwgdGhpcy5vY2N1ci5tYXg7CiAgfQogIFskY2xlYW5QYWdlXSgpIHsKICAgIGRlbGV0ZSB0aGlzWyRleHRyYV07CiAgfQogIFskZ2V0TmV4dFBhZ2VdKCkgewogICAgdGhpc1skZXh0cmFdIHx8PSB7CiAgICAgIG51bWJlck9mVXNlOiAwCiAgICB9OwogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgaWYgKHBhcmVudC5yZWxhdGlvbiA9PT0gIm9yZGVyZWRPY2N1cnJlbmNlIikgewogICAgICBpZiAodGhpc1skaXNVc2FibGVdKCkpIHsKICAgICAgICB0aGlzWyRleHRyYV0ubnVtYmVyT2ZVc2UgKz0gMTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBhcmVudFskZ2V0TmV4dFBhZ2VdKCk7CiAgfQogIFskZ2V0QXZhaWxhYmxlU3BhY2VdKCkgewogICAgcmV0dXJuIHRoaXNbJGV4dHJhXS5zcGFjZSB8fCB7CiAgICAgIHdpZHRoOiAwLAogICAgICBoZWlnaHQ6IDAKICAgIH07CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIHRoaXNbJGV4dHJhXSB8fD0gewogICAgICBudW1iZXJPZlVzZTogMQogICAgfTsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICB0aGlzWyRleHRyYV0uY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzLm1lZGl1bSAmJiB0aGlzLm1lZGl1bS5zaG9ydCAmJiB0aGlzLm1lZGl1bS5sb25nKSB7CiAgICAgIHN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMubWVkaXVtLnNob3J0KTsKICAgICAgc3R5bGUuaGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMubWVkaXVtLmxvbmcpOwogICAgICB0aGlzWyRleHRyYV0uc3BhY2UgPSB7CiAgICAgICAgd2lkdGg6IHRoaXMubWVkaXVtLnNob3J0LAogICAgICAgIGhlaWdodDogdGhpcy5tZWRpdW0ubG9uZwogICAgICB9OwogICAgICBpZiAodGhpcy5tZWRpdW0ub3JpZW50YXRpb24gPT09ICJsYW5kc2NhcGUiKSB7CiAgICAgICAgY29uc3QgeCA9IHN0eWxlLndpZHRoOwogICAgICAgIHN0eWxlLndpZHRoID0gc3R5bGUuaGVpZ2h0OwogICAgICAgIHN0eWxlLmhlaWdodCA9IHg7CiAgICAgICAgdGhpc1skZXh0cmFdLnNwYWNlID0gewogICAgICAgICAgd2lkdGg6IHRoaXMubWVkaXVtLmxvbmcsCiAgICAgICAgICBoZWlnaHQ6IHRoaXMubWVkaXVtLnNob3J0CiAgICAgICAgfTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgd2FybigiWEZBIC0gTm8gbWVkaXVtIHNwZWNpZmllZCBpbiBwYWdlQXJlYTogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICB9CiAgICB0aGlzWyRjaGlsZHJlblRvSFRNTF0oewogICAgICBmaWx0ZXI6IG5ldyBTZXQoWyJhcmVhIiwgImRyYXciLCAiZmllbGQiLCAic3ViZm9ybSJdKSwKICAgICAgaW5jbHVkZTogdHJ1ZQogICAgfSk7CiAgICB0aGlzWyRjaGlsZHJlblRvSFRNTF0oewogICAgICBmaWx0ZXI6IG5ldyBTZXQoWyJjb250ZW50QXJlYSJdKSwKICAgICAgaW5jbHVkZTogdHJ1ZQogICAgfSk7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGNoaWxkcmVuLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhUGFnZSJdLAogICAgICAgIGlkOiB0aGlzWyR1aWRdLAogICAgICAgIHN0eWxlLAogICAgICAgIHhmYU5hbWU6IHRoaXMubmFtZQogICAgICB9CiAgICB9KTsKICB9Cn0KY2xhc3MgUGFnZVNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwYWdlU2V0IiwgdHJ1ZSk7CiAgICB0aGlzLmR1cGxleEltcG9zaXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5kdXBsZXhJbXBvc2l0aW9uLCBbImxvbmdFZGdlIiwgInNob3J0RWRnZSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yZWxhdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnJlbGF0aW9uLCBbIm9yZGVyZWRPY2N1cnJlbmNlIiwgImR1cGxleFBhZ2luYXRlZCIsICJzaW1wbGV4UGFnaW5hdGVkIl0pOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMub2NjdXIgPSBudWxsOwogICAgdGhpcy5wYWdlQXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYWdlU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogIFskY2xlYW5QYWdlXSgpIHsKICAgIGZvciAoY29uc3QgcGFnZSBvZiB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuKSB7CiAgICAgIHBhZ2VbJGNsZWFuUGFnZV0oKTsKICAgIH0KICAgIGZvciAoY29uc3QgcGFnZSBvZiB0aGlzLnBhZ2VTZXQuY2hpbGRyZW4pIHsKICAgICAgcGFnZVskY2xlYW5QYWdlXSgpOwogICAgfQogIH0KICBbJGlzVXNhYmxlXSgpIHsKICAgIHJldHVybiAhdGhpcy5vY2N1ciB8fCB0aGlzLm9jY3VyLm1heCA9PT0gLTEgfHwgdGhpc1skZXh0cmFdLm51bWJlck9mVXNlIDwgdGhpcy5vY2N1ci5tYXg7CiAgfQogIFskZ2V0TmV4dFBhZ2VdKCkgewogICAgdGhpc1skZXh0cmFdIHx8PSB7CiAgICAgIG51bWJlck9mVXNlOiAxLAogICAgICBwYWdlSW5kZXg6IC0xLAogICAgICBwYWdlU2V0SW5kZXg6IC0xCiAgICB9OwogICAgaWYgKHRoaXMucmVsYXRpb24gPT09ICJvcmRlcmVkT2NjdXJyZW5jZSIpIHsKICAgICAgaWYgKHRoaXNbJGV4dHJhXS5wYWdlSW5kZXggKyAxIDwgdGhpcy5wYWdlQXJlYS5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICB0aGlzWyRleHRyYV0ucGFnZUluZGV4ICs9IDE7CiAgICAgICAgY29uc3QgcGFnZUFyZWEgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuW3RoaXNbJGV4dHJhXS5wYWdlSW5kZXhdOwogICAgICAgIHJldHVybiBwYWdlQXJlYVskZ2V0TmV4dFBhZ2VdKCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXNbJGV4dHJhXS5wYWdlU2V0SW5kZXggKyAxIDwgdGhpcy5wYWdlU2V0LmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHRoaXNbJGV4dHJhXS5wYWdlU2V0SW5kZXggKz0gMTsKICAgICAgICByZXR1cm4gdGhpcy5wYWdlU2V0LmNoaWxkcmVuW3RoaXNbJGV4dHJhXS5wYWdlU2V0SW5kZXhdWyRnZXROZXh0UGFnZV0oKTsKICAgICAgfQogICAgICBpZiAodGhpc1skaXNVc2FibGVdKCkpIHsKICAgICAgICB0aGlzWyRleHRyYV0ubnVtYmVyT2ZVc2UgKz0gMTsKICAgICAgICB0aGlzWyRleHRyYV0ucGFnZUluZGV4ID0gLTE7CiAgICAgICAgdGhpc1skZXh0cmFdLnBhZ2VTZXRJbmRleCA9IC0xOwogICAgICAgIHJldHVybiB0aGlzWyRnZXROZXh0UGFnZV0oKTsKICAgICAgfQogICAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBQYWdlU2V0KSB7CiAgICAgICAgcmV0dXJuIHBhcmVudFskZ2V0TmV4dFBhZ2VdKCk7CiAgICAgIH0KICAgICAgdGhpc1skY2xlYW5QYWdlXSgpOwogICAgICByZXR1cm4gdGhpc1skZ2V0TmV4dFBhZ2VdKCk7CiAgICB9CiAgICBjb25zdCBwYWdlTnVtYmVyID0gdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ucGFnZU51bWJlcjsKICAgIGNvbnN0IHBhcml0eSA9IHBhZ2VOdW1iZXIgJSAyID09PSAwID8gImV2ZW4iIDogIm9kZCI7CiAgICBjb25zdCBwb3NpdGlvbiA9IHBhZ2VOdW1iZXIgPT09IDAgPyAiZmlyc3QiIDogInJlc3QiOwogICAgbGV0IHBhZ2UgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuLmZpbmQocCA9PiBwLm9kZE9yRXZlbiA9PT0gcGFyaXR5ICYmIHAucGFnZVBvc2l0aW9uID09PSBwb3NpdGlvbik7CiAgICBpZiAocGFnZSkgewogICAgICByZXR1cm4gcGFnZTsKICAgIH0KICAgIHBhZ2UgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuLmZpbmQocCA9PiBwLm9kZE9yRXZlbiA9PT0gImFueSIgJiYgcC5wYWdlUG9zaXRpb24gPT09IHBvc2l0aW9uKTsKICAgIGlmIChwYWdlKSB7CiAgICAgIHJldHVybiBwYWdlOwogICAgfQogICAgcGFnZSA9IHRoaXMucGFnZUFyZWEuY2hpbGRyZW4uZmluZChwID0+IHAub2RkT3JFdmVuID09PSAiYW55IiAmJiBwLnBhZ2VQb3NpdGlvbiA9PT0gImFueSIpOwogICAgaWYgKHBhZ2UpIHsKICAgICAgcmV0dXJuIHBhZ2U7CiAgICB9CiAgICByZXR1cm4gdGhpcy5wYWdlQXJlYS5jaGlsZHJlblswXTsKICB9Cn0KY2xhc3MgUGFyYSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwYXJhIiwgdHJ1ZSk7CiAgICB0aGlzLmhBbGlnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhBbGlnbiwgWyJsZWZ0IiwgImNlbnRlciIsICJqdXN0aWZ5IiwgImp1c3RpZnlBbGwiLCAicmFkaXgiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGluZUhlaWdodCA9IGF0dHJpYnV0ZXMubGluZUhlaWdodCA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubGluZUhlaWdodCwgIjBwdCIpIDogIiI7CiAgICB0aGlzLm1hcmdpbkxlZnQgPSBhdHRyaWJ1dGVzLm1hcmdpbkxlZnQgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1hcmdpbkxlZnQsICIwcHQiKSA6ICIiOwogICAgdGhpcy5tYXJnaW5SaWdodCA9IGF0dHJpYnV0ZXMubWFyZ2luUmlnaHQgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1hcmdpblJpZ2h0LCAiMHB0IikgOiAiIjsKICAgIHRoaXMub3JwaGFucyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm9ycGhhbnMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMucHJlc2VydmUgPSBhdHRyaWJ1dGVzLnByZXNlcnZlIHx8ICIiOwogICAgdGhpcy5yYWRpeE9mZnNldCA9IGF0dHJpYnV0ZXMucmFkaXhPZmZzZXQgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnJhZGl4T2Zmc2V0LCAiMHB0IikgOiAiIjsKICAgIHRoaXMuc3BhY2VBYm92ZSA9IGF0dHJpYnV0ZXMuc3BhY2VBYm92ZSA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuc3BhY2VBYm92ZSwgIjBwdCIpIDogIiI7CiAgICB0aGlzLnNwYWNlQmVsb3cgPSBhdHRyaWJ1dGVzLnNwYWNlQmVsb3cgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnNwYWNlQmVsb3csICIwcHQiKSA6ICIiOwogICAgdGhpcy50YWJEZWZhdWx0ID0gYXR0cmlidXRlcy50YWJEZWZhdWx0ID8gZ2V0TWVhc3VyZW1lbnQodGhpcy50YWJEZWZhdWx0KSA6ICIiOwogICAgdGhpcy50YWJTdG9wcyA9IChhdHRyaWJ1dGVzLnRhYlN0b3BzIHx8ICIiKS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcCgoeCwgaSkgPT4gaSAlIDIgPT09IDEgPyBnZXRNZWFzdXJlbWVudCh4KSA6IHgpOwogICAgdGhpcy50ZXh0SW5kZW50ID0gYXR0cmlidXRlcy50ZXh0SW5kZW50ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy50ZXh0SW5kZW50LCAiMHB0IikgOiAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnZBbGlnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnZBbGlnbiwgWyJ0b3AiLCAiYm90dG9tIiwgIm1pZGRsZSJdKTsKICAgIHRoaXMud2lkb3dzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMud2lkb3dzLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmh5cGhlbmF0aW9uID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiaEFsaWduIik7CiAgICBpZiAodGhpcy5tYXJnaW5MZWZ0ICE9PSAiIikgewogICAgICBzdHlsZS5wYWRkaW5nTGVmdCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLm1hcmdpbkxlZnQpOwogICAgfQogICAgaWYgKHRoaXMubWFyZ2luUmlnaHQgIT09ICIiKSB7CiAgICAgIHN0eWxlLnBhZGRpbmdSaWdodCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLm1hcmdpblJpZ2h0KTsKICAgIH0KICAgIGlmICh0aGlzLnNwYWNlQWJvdmUgIT09ICIiKSB7CiAgICAgIHN0eWxlLnBhZGRpbmdUb3AgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5zcGFjZUFib3ZlKTsKICAgIH0KICAgIGlmICh0aGlzLnNwYWNlQmVsb3cgIT09ICIiKSB7CiAgICAgIHN0eWxlLnBhZGRpbmdCb3R0b20gPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5zcGFjZUJlbG93KTsKICAgIH0KICAgIGlmICh0aGlzLnRleHRJbmRlbnQgIT09ICIiKSB7CiAgICAgIHN0eWxlLnRleHRJbmRlbnQgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy50ZXh0SW5kZW50KTsKICAgICAgZml4VGV4dEluZGVudChzdHlsZSk7CiAgICB9CiAgICBpZiAodGhpcy5saW5lSGVpZ2h0ID4gMCkgewogICAgICBzdHlsZS5saW5lSGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMubGluZUhlaWdodCk7CiAgICB9CiAgICBpZiAodGhpcy50YWJEZWZhdWx0ICE9PSAiIikgewogICAgICBzdHlsZS50YWJTaXplID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMudGFiRGVmYXVsdCk7CiAgICB9CiAgICBpZiAodGhpcy50YWJTdG9wcy5sZW5ndGggPiAwKSB7fQogICAgaWYgKHRoaXMuaHlwaGVuYXRhdGlvbikgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB0aGlzLmh5cGhlbmF0YXRpb25bJHRvU3R5bGVdKCkpOwogICAgfQogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBQYXNzd29yZEVkaXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGFzc3dvcmRFZGl0IiwgdHJ1ZSk7CiAgICB0aGlzLmhTY3JvbGxQb2xpY3kgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oU2Nyb2xsUG9saWN5LCBbImF1dG8iLCAib2ZmIiwgIm9uIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnBhc3N3b3JkQ2hhciA9IGF0dHJpYnV0ZXMucGFzc3dvcmRDaGFyIHx8ICIqIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQp9CmNsYXNzIHRlbXBsYXRlX1BhdHRlcm4gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGF0dGVybiIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbImNyb3NzSGF0Y2giLCAiY3Jvc3NEaWFnb25hbCIsICJkaWFnb25hbExlZnQiLCAiZGlhZ29uYWxSaWdodCIsICJob3Jpem9udGFsIiwgInZlcnRpY2FsIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKHN0YXJ0Q29sb3IpIHsKICAgIHN0YXJ0Q29sb3IgPSBzdGFydENvbG9yID8gc3RhcnRDb2xvclskdG9TdHlsZV0oKSA6ICIjRkZGRkZGIjsKICAgIGNvbnN0IGVuZENvbG9yID0gdGhpcy5jb2xvciA/IHRoaXMuY29sb3JbJHRvU3R5bGVdKCkgOiAiIzAwMDAwMCI7CiAgICBjb25zdCB3aWR0aCA9IDU7CiAgICBjb25zdCBjbWQgPSAicmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCI7CiAgICBjb25zdCBjb2xvcnMgPSBgJHtzdGFydENvbG9yfSwke3N0YXJ0Q29sb3J9ICR7d2lkdGh9cHgsJHtlbmRDb2xvcn0gJHt3aWR0aH1weCwke2VuZENvbG9yfSAkezIgKiB3aWR0aH1weGA7CiAgICBzd2l0Y2ggKHRoaXMudHlwZSkgewogICAgICBjYXNlICJjcm9zc0hhdGNoIjoKICAgICAgICByZXR1cm4gYCR7Y21kfSh0byB0b3AsJHtjb2xvcnN9KSAke2NtZH0odG8gcmlnaHQsJHtjb2xvcnN9KWA7CiAgICAgIGNhc2UgImNyb3NzRGlhZ29uYWwiOgogICAgICAgIHJldHVybiBgJHtjbWR9KDQ1ZGVnLCR7Y29sb3JzfSkgJHtjbWR9KC00NWRlZywke2NvbG9yc30pYDsKICAgICAgY2FzZSAiZGlhZ29uYWxMZWZ0IjoKICAgICAgICByZXR1cm4gYCR7Y21kfSg0NWRlZywke2NvbG9yc30pYDsKICAgICAgY2FzZSAiZGlhZ29uYWxSaWdodCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0oLTQ1ZGVnLCR7Y29sb3JzfSlgOwogICAgICBjYXNlICJob3Jpem9udGFsIjoKICAgICAgICByZXR1cm4gYCR7Y21kfSh0byB0b3AsJHtjb2xvcnN9KWA7CiAgICAgIGNhc2UgInZlcnRpY2FsIjoKICAgICAgICByZXR1cm4gYCR7Y21kfSh0byByaWdodCwke2NvbG9yc30pYDsKICAgIH0KICAgIHJldHVybiAiIjsKICB9Cn0KY2xhc3MgUGljdHVyZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwaWN0dXJlIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFByb3RvIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInByb3RvIiwgdHJ1ZSk7CiAgICB0aGlzLmFwcGVhcmFuY2VGaWx0ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYXJjID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYXNzaXN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJhcmNvZGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYmluZEl0ZW1zID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJvb2tlbmQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5ib3JkZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWsgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWtBZnRlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5icmVha0JlZm9yZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5idXR0b24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY2FsY3VsYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNhcHRpb24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY2VydGlmaWNhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY2VydGlmaWNhdGVzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNoZWNrQnV0dG9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNob2ljZUxpc3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29sb3IgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29tYiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb25uZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbnRlbnRBcmVhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvcm5lciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lRWRpdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWNpbWFsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlZmF1bHRVaSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZXNjID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRpZ2VzdE1ldGhvZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kaWdlc3RNZXRob2RzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRyYXcgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZWRnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNvZGluZyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNvZGluZ3MgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jcnlwdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNyeXB0RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNyeXB0aW9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmVuY3J5cHRpb25NZXRob2QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jcnlwdGlvbk1ldGhvZHMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXZlbnQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4T2JqZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4Y2xHcm91cCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGVjdXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4dHJhcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWVsZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWxsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZpbHRlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mb250ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZvcm1hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5oYW5kbGVyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmh5cGhlbmF0aW9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlRWRpdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmlzc3VlcnMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaXRlbXMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMua2VlcCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5rZXlVc2FnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5saW5lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmxpbmVhciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5sb2NrRG9jdW1lbnQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWFuaWZlc3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWFyZ2luID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1kcCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5tZWRpdW0gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWVzc2FnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5udW1lcmljRWRpdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5vY2N1ciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5vaWQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMub2lkcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5vdmVyZmxvdyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYWdlQXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYWdlU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBhcmEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGFzc3dvcmRFZGl0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBhdHRlcm4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGljdHVyZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5yYWRpYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucmVhc29uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnJlYXNvbnMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucmVjdGFuZ2xlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnJlZiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zY3JpcHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2V0UHJvcGVydHkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2lnbkRhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2lnbmF0dXJlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNpZ25pbmcgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc29saWQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3BlYWsgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3RpcHBsZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm1TZXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViamVjdEROID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmplY3RETnMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3VibWl0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dEVkaXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lU3RhbXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudG9vbFRpcCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50cmF2ZXJzYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudHJhdmVyc2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudWkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudmFsaWRhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudmFsdWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudmFyaWFibGVzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFJhZGlhbCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJyYWRpYWwiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJ0b0VkZ2UiLCAidG9DZW50ZXIiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oc3RhcnRDb2xvcikgewogICAgc3RhcnRDb2xvciA9IHN0YXJ0Q29sb3IgPyBzdGFydENvbG9yWyR0b1N0eWxlXSgpIDogIiNGRkZGRkYiOwogICAgY29uc3QgZW5kQ29sb3IgPSB0aGlzLmNvbG9yID8gdGhpcy5jb2xvclskdG9TdHlsZV0oKSA6ICIjMDAwMDAwIjsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMudHlwZSA9PT0gInRvRWRnZSIgPyBgJHtzdGFydENvbG9yfSwke2VuZENvbG9yfWAgOiBgJHtlbmRDb2xvcn0sJHtzdGFydENvbG9yfWA7CiAgICByZXR1cm4gYHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgY2VudGVyLCAke2NvbG9yc30pYDsKICB9Cn0KY2xhc3MgUmVhc29uIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInJlYXNvbiIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBSZWFzb25zIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInJlYXNvbnMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnJlYXNvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBSZWN0YW5nbGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicmVjdGFuZ2xlIiwgdHJ1ZSk7CiAgICB0aGlzLmhhbmQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oYW5kLCBbImV2ZW4iLCAibGVmdCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29ybmVyID0gbmV3IFhGQU9iamVjdEFycmF5KDQpOwogICAgdGhpcy5lZGdlID0gbmV3IFhGQU9iamVjdEFycmF5KDQpOwogICAgdGhpcy5maWxsID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKCkgewogICAgY29uc3QgZWRnZSA9IHRoaXMuZWRnZS5jaGlsZHJlbi5sZW5ndGggPyB0aGlzLmVkZ2UuY2hpbGRyZW5bMF0gOiBuZXcgRWRnZSh7fSk7CiAgICBjb25zdCBlZGdlU3R5bGUgPSBlZGdlWyR0b1N0eWxlXSgpOwogICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKHRoaXMuZmlsbD8ucHJlc2VuY2UgPT09ICJ2aXNpYmxlIikgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB0aGlzLmZpbGxbJHRvU3R5bGVdKCkpOwogICAgfSBlbHNlIHsKICAgICAgc3R5bGUuZmlsbCA9ICJ0cmFuc3BhcmVudCI7CiAgICB9CiAgICBzdHlsZS5zdHJva2VXaWR0aCA9IG1lYXN1cmVUb1N0cmluZyhlZGdlLnByZXNlbmNlID09PSAidmlzaWJsZSIgPyBlZGdlLnRoaWNrbmVzcyA6IDApOwogICAgc3R5bGUuc3Ryb2tlID0gZWRnZVN0eWxlLmNvbG9yOwogICAgY29uc3QgY29ybmVyID0gdGhpcy5jb3JuZXIuY2hpbGRyZW4ubGVuZ3RoID8gdGhpcy5jb3JuZXIuY2hpbGRyZW5bMF0gOiBuZXcgQ29ybmVyKHt9KTsKICAgIGNvbnN0IGNvcm5lclN0eWxlID0gY29ybmVyWyR0b1N0eWxlXSgpOwogICAgY29uc3QgcmVjdCA9IHsKICAgICAgbmFtZTogInJlY3QiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgIHg6IDAsCiAgICAgICAgeTogMCwKICAgICAgICByeDogY29ybmVyU3R5bGUucmFkaXVzLAogICAgICAgIHJ5OiBjb3JuZXJTdHlsZS5yYWRpdXMsCiAgICAgICAgc3R5bGUKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHN2ZyA9IHsKICAgICAgbmFtZTogInN2ZyIsCiAgICAgIGNoaWxkcmVuOiBbcmVjdF0sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB4bWxuczogU1ZHX05TLAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBvdmVyZmxvdzogInZpc2libGUiCiAgICAgICAgfSwKICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgIGhlaWdodDogIjEwMCUiCiAgICAgIH0KICAgIH07CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldFBhcmVudF0oKTsKICAgIGlmIChoYXNNYXJnaW4ocGFyZW50KSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lIiwKICAgICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgICAgaGVpZ2h0OiAiMTAwJSIKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNoaWxkcmVuOiBbc3ZnXQogICAgICB9KTsKICAgIH0KICAgIHN2Zy5hdHRyaWJ1dGVzLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3Moc3ZnKTsKICB9Cn0KY2xhc3MgUmVmRWxlbWVudCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJyZWYiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgU2NyaXB0IGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNjcmlwdCIpOwogICAgdGhpcy5iaW5kaW5nID0gYXR0cmlidXRlcy5iaW5kaW5nIHx8ICIiOwogICAgdGhpcy5jb250ZW50VHlwZSA9IGF0dHJpYnV0ZXMuY29udGVudFR5cGUgfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucnVuQXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5ydW5BdCwgWyJjbGllbnQiLCAiYm90aCIsICJzZXJ2ZXIiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBTZXRQcm9wZXJ0eSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzZXRQcm9wZXJ0eSIpOwogICAgdGhpcy5jb25uZWN0aW9uID0gYXR0cmlidXRlcy5jb25uZWN0aW9uIHx8ICIiOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgfQp9CmNsYXNzIFNpZ25EYXRhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNpZ25EYXRhIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3BlcmF0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3BlcmF0aW9uLCBbInNpZ24iLCAiY2xlYXIiLCAidmVyaWZ5Il0pOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5maWx0ZXIgPSBudWxsOwogICAgdGhpcy5tYW5pZmVzdCA9IG51bGw7CiAgfQp9CmNsYXNzIFNpZ25hdHVyZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzaWduYXR1cmUiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJQREYxLjMiLCAiUERGMS42Il0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZmlsdGVyID0gbnVsbDsKICAgIHRoaXMubWFuaWZlc3QgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KfQpjbGFzcyBTaWduaW5nIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNpZ25pbmciLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNlcnRpZmljYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFNvbGlkIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNvbGlkIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oc3RhcnRDb2xvcikgewogICAgcmV0dXJuIHN0YXJ0Q29sb3IgPyBzdGFydENvbG9yWyR0b1N0eWxlXSgpIDogIiNGRkZGRkYiOwogIH0KfQpjbGFzcyBTcGVhayBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzcGVhayIpOwogICAgdGhpcy5kaXNhYmxlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZGlzYWJsZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wcmlvcml0eSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByaW9yaXR5LCBbImN1c3RvbSIsICJjYXB0aW9uIiwgIm5hbWUiLCAidG9vbFRpcCJdKTsKICAgIHRoaXMucmlkID0gYXR0cmlidXRlcy5yaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBTdGlwcGxlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInN0aXBwbGUiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5yYXRlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucmF0ZSwKICAgICAgZGVmYXVsdFZhbHVlOiA1MCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwICYmIHggPD0gMTAwCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXShiZ0NvbG9yKSB7CiAgICBjb25zdCBhbHBoYSA9IHRoaXMucmF0ZSAvIDEwMDsKICAgIHJldHVybiBVdGlsLm1ha2VIZXhDb2xvcihNYXRoLnJvdW5kKGJnQ29sb3IudmFsdWUuciAqICgxIC0gYWxwaGEpICsgdGhpcy52YWx1ZS5yICogYWxwaGEpLCBNYXRoLnJvdW5kKGJnQ29sb3IudmFsdWUuZyAqICgxIC0gYWxwaGEpICsgdGhpcy52YWx1ZS5nICogYWxwaGEpLCBNYXRoLnJvdW5kKGJnQ29sb3IudmFsdWUuYiAqICgxIC0gYWxwaGEpICsgdGhpcy52YWx1ZS5iICogYWxwaGEpKTsKICB9Cn0KY2xhc3MgU3ViZm9ybSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdWJmb3JtIiwgdHJ1ZSk7CiAgICB0aGlzLmFjY2VzcyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFjY2VzcywgWyJvcGVuIiwgIm5vbkludGVyYWN0aXZlIiwgInByb3RlY3RlZCIsICJyZWFkT25seSJdKTsKICAgIHRoaXMuYWxsb3dNYWNybyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmFsbG93TWFjcm8sCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmFuY2hvclR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hbmNob3JUeXBlLCBbInRvcExlZnQiLCAiYm90dG9tQ2VudGVyIiwgImJvdHRvbUxlZnQiLCAiYm90dG9tUmlnaHQiLCAibWlkZGxlQ2VudGVyIiwgIm1pZGRsZUxlZnQiLCAibWlkZGxlUmlnaHQiLCAidG9wQ2VudGVyIiwgInRvcFJpZ2h0Il0pOwogICAgdGhpcy5jb2xTcGFuID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY29sU3BhbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgfHwgbiA9PT0gLTEKICAgIH0pOwogICAgdGhpcy5jb2x1bW5XaWR0aHMgPSAoYXR0cmlidXRlcy5jb2x1bW5XaWR0aHMgfHwgIiIpLnRyaW0oKS5zcGxpdCgvXHMrLykubWFwKHggPT4geCA9PT0gIi0xIiA/IC0xIDogZ2V0TWVhc3VyZW1lbnQoeCkpOwogICAgdGhpcy5oID0gYXR0cmlidXRlcy5oID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5oKSA6ICIiOwogICAgdGhpcy5oQWxpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oQWxpZ24sIFsibGVmdCIsICJjZW50ZXIiLCAianVzdGlmeSIsICJqdXN0aWZ5QWxsIiwgInJhZGl4IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxheW91dCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmxheW91dCwgWyJwb3NpdGlvbiIsICJsci10YiIsICJybC1yb3ciLCAicmwtdGIiLCAicm93IiwgInRhYmxlIiwgInRiIl0pOwogICAgdGhpcy5sb2NhbGUgPSBhdHRyaWJ1dGVzLmxvY2FsZSB8fCAiIjsKICAgIHRoaXMubWF4SCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4SCwgIjBwdCIpOwogICAgdGhpcy5tYXhXID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXhXLCAiMHB0Iik7CiAgICB0aGlzLm1lcmdlTW9kZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm1lcmdlTW9kZSwgWyJjb25zdW1lRGF0YSIsICJtYXRjaFRlbXBsYXRlIl0pOwogICAgdGhpcy5taW5IID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5ILCAiMHB0Iik7CiAgICB0aGlzLm1pblcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1pblcsICIwcHQiKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnJlc3RvcmVTdGF0ZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnJlc3RvcmVTdGF0ZSwgWyJtYW51YWwiLCAiYXV0byJdKTsKICAgIHRoaXMuc2NvcGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zY29wZSwgWyJuYW1lIiwgIm5vbmUiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53ID0gYXR0cmlidXRlcy53ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy53KSA6ICIiOwogICAgdGhpcy54ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuYXNzaXN0ID0gbnVsbDsKICAgIHRoaXMuYmluZCA9IG51bGw7CiAgICB0aGlzLmJvb2tlbmQgPSBudWxsOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5icmVhayA9IG51bGw7CiAgICB0aGlzLmNhbGN1bGF0ZSA9IG51bGw7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5rZWVwID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICAgIHRoaXMub2NjdXIgPSBudWxsOwogICAgdGhpcy5vdmVyZmxvdyA9IG51bGw7CiAgICB0aGlzLnBhZ2VTZXQgPSBudWxsOwogICAgdGhpcy5wYXJhID0gbnVsbDsKICAgIHRoaXMudHJhdmVyc2FsID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGUgPSBudWxsOwogICAgdGhpcy52YXJpYWJsZXMgPSBudWxsOwogICAgdGhpcy5hcmVhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrQWZ0ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWtCZWZvcmUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29ubmVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kcmF3ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV2ZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4T2JqZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4Y2xHcm91cCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWVsZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wcm90byA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zZXRQcm9wZXJ0eSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm1TZXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyRnZXRTdWJmb3JtUGFyZW50XSgpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKTsKICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBTdWJmb3JtU2V0KSB7CiAgICAgIHJldHVybiBwYXJlbnRbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICB9CiAgICByZXR1cm4gcGFyZW50OwogIH0KICBbJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskaXNUaGVyZU1vcmVXaWR0aF0oKSB7CiAgICByZXR1cm4gdGhpcy5sYXlvdXQuZW5kc1dpdGgoIi10YiIpICYmIHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSAwICYmIHRoaXNbJGV4dHJhXS5udW1iZXJJbkxpbmUgPiAwIHx8IHRoaXNbJGdldFBhcmVudF0oKVskaXNUaGVyZU1vcmVXaWR0aF0oKTsKICB9CiAgKlskZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCkgewogICAgeWllbGQqIGdldENvbnRhaW5lZENoaWxkcmVuKHRoaXMpOwogIH0KICBbJGZsdXNoSFRNTF0oKSB7CiAgICByZXR1cm4gZmx1c2hIVE1MKHRoaXMpOwogIH0KICBbJGFkZEhUTUxdKGh0bWwsIGJib3gpIHsKICAgIGFkZEhUTUwodGhpcywgaHRtbCwgYmJveCk7CiAgfQogIFskZ2V0QXZhaWxhYmxlU3BhY2VdKCkgewogICAgcmV0dXJuIGdldEF2YWlsYWJsZVNwYWNlKHRoaXMpOwogIH0KICBbJGlzU3BsaXR0YWJsZV0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgaWYgKCFwYXJlbnRbJGlzU3BsaXR0YWJsZV0oKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpc1skZXh0cmFdLl9pc1NwbGl0dGFibGUgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpc1skZXh0cmFdLl9pc1NwbGl0dGFibGU7CiAgICB9CiAgICBpZiAodGhpcy5sYXlvdXQgPT09ICJwb3NpdGlvbiIgfHwgdGhpcy5sYXlvdXQuaW5jbHVkZXMoInJvdyIpKSB7CiAgICAgIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gZmFsc2U7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLmtlZXAgJiYgdGhpcy5rZWVwLmludGFjdCAhPT0gIm5vbmUiKSB7CiAgICAgIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gZmFsc2U7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChwYXJlbnQubGF5b3V0Py5lbmRzV2l0aCgiLXRiIikgJiYgcGFyZW50WyRleHRyYV0ubnVtYmVySW5MaW5lICE9PSAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHNldFRhYkluZGV4KHRoaXMpOwogICAgaWYgKHRoaXMuYnJlYWspIHsKICAgICAgaWYgKHRoaXMuYnJlYWsuYWZ0ZXIgIT09ICJhdXRvIiB8fCB0aGlzLmJyZWFrLmFmdGVyVGFyZ2V0ICE9PSAiIikgewogICAgICAgIGNvbnN0IG5vZGUgPSBuZXcgQnJlYWtBZnRlcih7CiAgICAgICAgICB0YXJnZXRUeXBlOiB0aGlzLmJyZWFrLmFmdGVyLAogICAgICAgICAgdGFyZ2V0OiB0aGlzLmJyZWFrLmFmdGVyVGFyZ2V0LAogICAgICAgICAgc3RhcnROZXc6IHRoaXMuYnJlYWsuc3RhcnROZXcudG9TdHJpbmcoKQogICAgICAgIH0pOwogICAgICAgIG5vZGVbJGdsb2JhbERhdGFdID0gdGhpc1skZ2xvYmFsRGF0YV07CiAgICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICAgIHRoaXMuYnJlYWtBZnRlci5wdXNoKG5vZGUpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmJyZWFrLmJlZm9yZSAhPT0gImF1dG8iIHx8IHRoaXMuYnJlYWsuYmVmb3JlVGFyZ2V0ICE9PSAiIikgewogICAgICAgIGNvbnN0IG5vZGUgPSBuZXcgQnJlYWtCZWZvcmUoewogICAgICAgICAgdGFyZ2V0VHlwZTogdGhpcy5icmVhay5iZWZvcmUsCiAgICAgICAgICB0YXJnZXQ6IHRoaXMuYnJlYWsuYmVmb3JlVGFyZ2V0LAogICAgICAgICAgc3RhcnROZXc6IHRoaXMuYnJlYWsuc3RhcnROZXcudG9TdHJpbmcoKQogICAgICAgIH0pOwogICAgICAgIG5vZGVbJGdsb2JhbERhdGFdID0gdGhpc1skZ2xvYmFsRGF0YV07CiAgICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICAgIHRoaXMuYnJlYWtCZWZvcmUucHVzaChub2RlKTsKICAgICAgfQogICAgICBpZiAodGhpcy5icmVhay5vdmVyZmxvd1RhcmdldCAhPT0gIiIpIHsKICAgICAgICBjb25zdCBub2RlID0gbmV3IE92ZXJmbG93KHsKICAgICAgICAgIHRhcmdldDogdGhpcy5icmVhay5vdmVyZmxvd1RhcmdldCwKICAgICAgICAgIGxlYWRlcjogdGhpcy5icmVhay5vdmVyZmxvd0xlYWRlciwKICAgICAgICAgIHRyYWlsZXI6IHRoaXMuYnJlYWsub3ZlcmZsb3dUcmFpbGVyCiAgICAgICAgfSk7CiAgICAgICAgbm9kZVskZ2xvYmFsRGF0YV0gPSB0aGlzWyRnbG9iYWxEYXRhXTsKICAgICAgICB0aGlzWyRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgICAgdGhpcy5vdmVyZmxvdy5wdXNoKG5vZGUpOwogICAgICB9CiAgICAgIHRoaXNbJHJlbW92ZUNoaWxkXSh0aGlzLmJyZWFrKTsKICAgICAgdGhpcy5icmVhayA9IG51bGw7CiAgICB9CiAgICBpZiAodGhpcy5wcmVzZW5jZSA9PT0gImhpZGRlbiIgfHwgdGhpcy5wcmVzZW5jZSA9PT0gImluYWN0aXZlIikgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGlmICh0aGlzLmJyZWFrQmVmb3JlLmNoaWxkcmVuLmxlbmd0aCA+IDEgfHwgdGhpcy5icmVha0FmdGVyLmNoaWxkcmVuLmxlbmd0aCA+IDEpIHsKICAgICAgd2FybigiWEZBIC0gU2V2ZXJhbCBicmVha0JlZm9yZSBvciBicmVha0FmdGVyIGluIHN1YmZvcm1zOiBwbGVhc2UgZmlsZSBhIGJ1Zy4iKTsKICAgIH0KICAgIGlmICh0aGlzLmJyZWFrQmVmb3JlLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSB7CiAgICAgIGNvbnN0IGJyZWFrQmVmb3JlID0gdGhpcy5icmVha0JlZm9yZS5jaGlsZHJlblswXTsKICAgICAgaWYgKGhhbmRsZUJyZWFrKGJyZWFrQmVmb3JlKSkgewogICAgICAgIHJldHVybiBIVE1MUmVzdWx0LmJyZWFrTm9kZShicmVha0JlZm9yZSk7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzWyRleHRyYV0/LmFmdGVyQnJlYWtBZnRlcikgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGZpeERpbWVuc2lvbnModGhpcyk7CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgaWQ6IHRoaXNbJHVpZF0sCiAgICAgIGNsYXNzOiBbXQogICAgfTsKICAgIHNldEFjY2Vzcyh0aGlzLCBhdHRyaWJ1dGVzLmNsYXNzKTsKICAgIHRoaXNbJGV4dHJhXSB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIE9iamVjdC5hc3NpZ24odGhpc1skZXh0cmFdLCB7CiAgICAgIGNoaWxkcmVuLAogICAgICBsaW5lOiBudWxsLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBhdHRlbXB0OiAwLAogICAgICBudW1iZXJJbkxpbmU6IDAsCiAgICAgIGF2YWlsYWJsZVNwYWNlOiB7CiAgICAgICAgd2lkdGg6IE1hdGgubWluKHRoaXMudyB8fCBJbmZpbml0eSwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5taW4odGhpcy5oIHx8IEluZmluaXR5LCBhdmFpbGFibGVTcGFjZS5oZWlnaHQpCiAgICAgIH0sCiAgICAgIHdpZHRoOiAwLAogICAgICBoZWlnaHQ6IDAsCiAgICAgIHByZXZIZWlnaHQ6IDAsCiAgICAgIGN1cnJlbnRXaWR0aDogMAogICAgfSk7CiAgICBjb25zdCByb290ID0gdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpOwogICAgY29uc3Qgc2F2ZWROb0xheW91dEZhaWx1cmUgPSByb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlOwogICAgY29uc3QgaXNTcGxpdHRhYmxlID0gdGhpc1skaXNTcGxpdHRhYmxlXSgpOwogICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICB9CiAgICBpZiAoIWNoZWNrRGltZW5zaW9ucyh0aGlzLCBhdmFpbGFibGVTcGFjZSkpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIGNvbnN0IGZpbHRlciA9IG5ldyBTZXQoWyJhcmVhIiwgImRyYXciLCAiZXhjbEdyb3VwIiwgImZpZWxkIiwgInN1YmZvcm0iLCAic3ViZm9ybVNldCJdKTsKICAgIGlmICh0aGlzLmxheW91dC5pbmNsdWRlcygicm93IikpIHsKICAgICAgY29uc3QgY29sdW1uV2lkdGhzID0gdGhpc1skZ2V0U3ViZm9ybVBhcmVudF0oKS5jb2x1bW5XaWR0aHM7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbHVtbldpZHRocykgJiYgY29sdW1uV2lkdGhzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzWyRleHRyYV0uY29sdW1uV2lkdGhzID0gY29sdW1uV2lkdGhzOwogICAgICAgIHRoaXNbJGV4dHJhXS5jdXJyZW50Q29sdW1uID0gMDsKICAgICAgfQogICAgfQogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJhbmNob3JUeXBlIiwgImRpbWVuc2lvbnMiLCAicG9zaXRpb24iLCAicHJlc2VuY2UiLCAiYm9yZGVyIiwgIm1hcmdpbiIsICJoQWxpZ24iKTsKICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbInhmYVN1YmZvcm0iXTsKICAgIGNvbnN0IGNsID0gbGF5b3V0Q2xhc3ModGhpcyk7CiAgICBpZiAoY2wpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKGNsKTsKICAgIH0KICAgIGF0dHJpYnV0ZXMuc3R5bGUgPSBzdHlsZTsKICAgIGF0dHJpYnV0ZXMuY2xhc3MgPSBjbGFzc05hbWVzOwogICAgaWYgKHRoaXMubmFtZSkgewogICAgICBhdHRyaWJ1dGVzLnhmYU5hbWUgPSB0aGlzLm5hbWU7CiAgICB9CiAgICBpZiAodGhpcy5vdmVyZmxvdykgewogICAgICBjb25zdCBvdmVyZmxvd0V4dHJhID0gdGhpcy5vdmVyZmxvd1skZ2V0RXh0cmFdKCk7CiAgICAgIGlmIChvdmVyZmxvd0V4dHJhLmFkZExlYWRlcikgewogICAgICAgIG92ZXJmbG93RXh0cmEuYWRkTGVhZGVyID0gZmFsc2U7CiAgICAgICAgaGFuZGxlT3ZlcmZsb3codGhpcywgb3ZlcmZsb3dFeHRyYS5sZWFkZXIsIGF2YWlsYWJsZVNwYWNlKTsKICAgICAgfQogICAgfQogICAgdGhpc1skcHVzaFBhcmFdKCk7CiAgICBjb25zdCBpc0xyVGIgPSB0aGlzLmxheW91dCA9PT0gImxyLXRiIiB8fCB0aGlzLmxheW91dCA9PT0gInJsLXRiIjsKICAgIGNvbnN0IG1heFJ1biA9IGlzTHJUYiA/IE1BWF9BVFRFTVBUU19GT1JfTFJUQl9MQVlPVVQgOiAxOwogICAgZm9yICg7IHRoaXNbJGV4dHJhXS5hdHRlbXB0IDwgbWF4UnVuOyB0aGlzWyRleHRyYV0uYXR0ZW1wdCsrKSB7CiAgICAgIGlmIChpc0xyVGIgJiYgdGhpc1skZXh0cmFdLmF0dGVtcHQgPT09IE1BWF9BVFRFTVBUU19GT1JfTFJUQl9MQVlPVVQgLSAxKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm51bWJlckluTGluZSA9IDA7CiAgICAgIH0KICAgICAgY29uc3QgcmVzdWx0ID0gdGhpc1skY2hpbGRyZW5Ub0hUTUxdKHsKICAgICAgICBmaWx0ZXIsCiAgICAgICAgaW5jbHVkZTogdHJ1ZQogICAgICB9KTsKICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHJlc3VsdC5pc0JyZWFrKCkpIHsKICAgICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgaWYgKGlzTHJUYiAmJiB0aGlzWyRleHRyYV0uYXR0ZW1wdCA9PT0gMCAmJiB0aGlzWyRleHRyYV0ubnVtYmVySW5MaW5lID09PSAwICYmICFyb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLmF0dGVtcHQgPSBtYXhSdW47CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICBpZiAoIWlzU3BsaXR0YWJsZSkgewogICAgICB1bnNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgfQogICAgcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHNhdmVkTm9MYXlvdXRGYWlsdXJlOwogICAgaWYgKHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSBtYXhSdW4pIHsKICAgICAgaWYgKHRoaXMub3ZlcmZsb3cpIHsKICAgICAgICB0aGlzWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5vdmVyZmxvd05vZGUgPSB0aGlzLm92ZXJmbG93OwogICAgICB9CiAgICAgIGlmICghaXNTcGxpdHRhYmxlKSB7CiAgICAgICAgZGVsZXRlIHRoaXNbJGV4dHJhXTsKICAgICAgfQogICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgfQogICAgaWYgKHRoaXMub3ZlcmZsb3cpIHsKICAgICAgY29uc3Qgb3ZlcmZsb3dFeHRyYSA9IHRoaXMub3ZlcmZsb3dbJGdldEV4dHJhXSgpOwogICAgICBpZiAob3ZlcmZsb3dFeHRyYS5hZGRUcmFpbGVyKSB7CiAgICAgICAgb3ZlcmZsb3dFeHRyYS5hZGRUcmFpbGVyID0gZmFsc2U7CiAgICAgICAgaGFuZGxlT3ZlcmZsb3codGhpcywgb3ZlcmZsb3dFeHRyYS50cmFpbGVyLCBhdmFpbGFibGVTcGFjZSk7CiAgICAgIH0KICAgIH0KICAgIGxldCBtYXJnaW5IID0gMDsKICAgIGxldCBtYXJnaW5WID0gMDsKICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICBtYXJnaW5IID0gdGhpcy5tYXJnaW4ubGVmdEluc2V0ICsgdGhpcy5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgbWFyZ2luViA9IHRoaXMubWFyZ2luLnRvcEluc2V0ICsgdGhpcy5tYXJnaW4uYm90dG9tSW5zZXQ7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IE1hdGgubWF4KHRoaXNbJGV4dHJhXS53aWR0aCArIG1hcmdpbkgsIHRoaXMudyB8fCAwKTsKICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KHRoaXNbJGV4dHJhXS5oZWlnaHQgKyBtYXJnaW5WLCB0aGlzLmggfHwgMCk7CiAgICBjb25zdCBiYm94ID0gW3RoaXMueCwgdGhpcy55LCB3aWR0aCwgaGVpZ2h0XTsKICAgIGlmICh0aGlzLncgPT09ICIiKSB7CiAgICAgIHN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHdpZHRoKTsKICAgIH0KICAgIGlmICh0aGlzLmggPT09ICIiKSB7CiAgICAgIHN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhoZWlnaHQpOwogICAgfQogICAgaWYgKChzdHlsZS53aWR0aCA9PT0gIjBweCIgfHwgc3R5bGUuaGVpZ2h0ID09PSAiMHB4IikgJiYgY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgYXBwbHlBc3Npc3QodGhpcywgYXR0cmlidXRlcyk7CiAgICBjb25zdCByZXN1bHQgPSBIVE1MUmVzdWx0LnN1Y2Nlc3MoY3JlYXRlV3JhcHBlcih0aGlzLCBodG1sKSwgYmJveCk7CiAgICBpZiAodGhpcy5icmVha0FmdGVyLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSB7CiAgICAgIGNvbnN0IGJyZWFrQWZ0ZXIgPSB0aGlzLmJyZWFrQWZ0ZXIuY2hpbGRyZW5bMF07CiAgICAgIGlmIChoYW5kbGVCcmVhayhicmVha0FmdGVyKSkgewogICAgICAgIHRoaXNbJGV4dHJhXS5hZnRlckJyZWFrQWZ0ZXIgPSByZXN1bHQ7CiAgICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuYnJlYWtOb2RlKGJyZWFrQWZ0ZXIpOwogICAgICB9CiAgICB9CiAgICBkZWxldGUgdGhpc1skZXh0cmFdOwogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0KY2xhc3MgU3ViZm9ybVNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdWJmb3JtU2V0IiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmVsYXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5yZWxhdGlvbiwgWyJvcmRlcmVkIiwgImNob2ljZSIsICJ1bm9yZGVyZWQiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib29rZW5kID0gbnVsbDsKICAgIHRoaXMuYnJlYWsgPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMub2NjdXIgPSBudWxsOwogICAgdGhpcy5vdmVyZmxvdyA9IG51bGw7CiAgICB0aGlzLmJyZWFrQWZ0ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWtCZWZvcmUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogICpbJGdldENvbnRhaW5lZENoaWxkcmVuXSgpIHsKICAgIHlpZWxkKiBnZXRDb250YWluZWRDaGlsZHJlbih0aGlzKTsKICB9CiAgWyRnZXRTdWJmb3JtUGFyZW50XSgpIHsKICAgIGxldCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICB3aGlsZSAoIShwYXJlbnQgaW5zdGFuY2VvZiBTdWJmb3JtKSkgewogICAgICBwYXJlbnQgPSBwYXJlbnRbJGdldFBhcmVudF0oKTsKICAgIH0KICAgIHJldHVybiBwYXJlbnQ7CiAgfQogIFskaXNCaW5kYWJsZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgU3ViamVjdEROIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdWJqZWN0RE4iKTsKICAgIHRoaXMuZGVsaW1pdGVyID0gYXR0cmlidXRlcy5kZWxpbWl0ZXIgfHwgIiwiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gbmV3IE1hcCh0aGlzWyRjb250ZW50XS5zcGxpdCh0aGlzLmRlbGltaXRlcikubWFwKGt2ID0+IHsKICAgICAga3YgPSBrdi5zcGxpdCgiPSIsIDIpOwogICAgICBrdlswXSA9IGt2WzBdLnRyaW0oKTsKICAgICAgcmV0dXJuIGt2OwogICAgfSkpOwogIH0KfQpjbGFzcyBTdWJqZWN0RE5zIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInN1YmplY3RETnMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnN1YmplY3RETiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBTdWJtaXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3VibWl0IiwgdHJ1ZSk7CiAgICB0aGlzLmVtYmVkUERGID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZW1iZWRQREYsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmZvcm1hdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmZvcm1hdCwgWyJ4ZHAiLCAiZm9ybWRhdGEiLCAicGRmIiwgInVybGVuY29kZWQiLCAieGZkIiwgInhtbCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICAgIHRoaXMudGV4dEVuY29kaW5nID0gZ2V0S2V5d29yZCh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMudGV4dEVuY29kaW5nID8gYXR0cmlidXRlcy50ZXh0RW5jb2RpbmcudG9Mb3dlckNhc2UoKSA6ICIiLAogICAgICBkZWZhdWx0VmFsdWU6ICIiLAogICAgICB2YWxpZGF0ZTogayA9PiBbInV0Zi04IiwgImJpZy1maXZlIiwgImZvbnRzcGVjaWZpYyIsICJnYmsiLCAiZ2ItMTgwMzAiLCAiZ2ItMjMxMiIsICJrc2MtNTYwMSIsICJub25lIiwgInNoaWZ0LWppcyIsICJ1Y3MtMiIsICJ1dGYtMTYiXS5pbmNsdWRlcyhrKSB8fCBrLm1hdGNoKC9pc28tODg1OS1cZHsyfS8pCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnhkcENvbnRlbnQgPSBhdHRyaWJ1dGVzLnhkcENvbnRlbnQgfHwgIiI7CiAgICB0aGlzLmVuY3J5cHQgPSBudWxsOwogICAgdGhpcy5lbmNyeXB0RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zaWduRGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBUZW1wbGF0ZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0ZW1wbGF0ZSIsIHRydWUpOwogICAgdGhpcy5iYXNlUHJvZmlsZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmJhc2VQcm9maWxlLCBbImZ1bGwiLCAiaW50ZXJhY3RpdmVGb3JtcyJdKTsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGlmICh0aGlzLnN1YmZvcm0uY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHdhcm4oIlhGQSAtIE5vIHN1YmZvcm1zIGluIHRlbXBsYXRlIG5vZGUuIik7CiAgICB9CiAgICBpZiAodGhpcy5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCA+PSAyKSB7CiAgICAgIHdhcm4oIlhGQSAtIFNldmVyYWwgc3ViZm9ybXMgaW4gdGVtcGxhdGUgbm9kZTogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICB9CiAgICB0aGlzWyR0YWJJbmRleF0gPSBERUZBVUxUX1RBQl9JTkRFWDsKICB9CiAgWyRpc1NwbGl0dGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskc2VhcmNoTm9kZV0oZXhwciwgY29udGFpbmVyKSB7CiAgICBpZiAoZXhwci5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgcmV0dXJuIFt0aGlzWyRpZHNdLmdldChleHByLnNsaWNlKDEpKV07CiAgICB9CiAgICByZXR1cm4gc2VhcmNoTm9kZSh0aGlzLCBjb250YWluZXIsIGV4cHIsIHRydWUsIHRydWUpOwogIH0KICAqWyR0b1BhZ2VzXSgpIHsKICAgIGlmICghdGhpcy5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBjaGlsZHJlbjogW10KICAgICAgfSk7CiAgICB9CiAgICB0aGlzWyRleHRyYV0gPSB7CiAgICAgIG92ZXJmbG93Tm9kZTogbnVsbCwKICAgICAgZmlyc3RVbnNwbGl0dGFibGU6IG51bGwsCiAgICAgIGN1cnJlbnRDb250ZW50QXJlYTogbnVsbCwKICAgICAgY3VycmVudFBhZ2VBcmVhOiBudWxsLAogICAgICBub0xheW91dEZhaWx1cmU6IGZhbHNlLAogICAgICBwYWdlTnVtYmVyOiAxLAogICAgICBwYWdlUG9zaXRpb246ICJmaXJzdCIsCiAgICAgIG9kZE9yRXZlbjogIm9kZCIsCiAgICAgIGJsYW5rT3JOb3RCbGFuazogIm5vbkJsYW5rIiwKICAgICAgcGFyYVN0YWNrOiBbXQogICAgfTsKICAgIGNvbnN0IHJvb3QgPSB0aGlzLnN1YmZvcm0uY2hpbGRyZW5bMF07CiAgICByb290LnBhZ2VTZXRbJGNsZWFuUGFnZV0oKTsKICAgIGNvbnN0IHBhZ2VBcmVhcyA9IHJvb3QucGFnZVNldC5wYWdlQXJlYS5jaGlsZHJlbjsKICAgIGNvbnN0IG1haW5IdG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgY2hpbGRyZW46IFtdCiAgICB9OwogICAgbGV0IHBhZ2VBcmVhID0gbnVsbDsKICAgIGxldCBicmVha0JlZm9yZSA9IG51bGw7CiAgICBsZXQgYnJlYWtCZWZvcmVUYXJnZXQgPSBudWxsOwogICAgaWYgKHJvb3QuYnJlYWtCZWZvcmUuY2hpbGRyZW4ubGVuZ3RoID49IDEpIHsKICAgICAgYnJlYWtCZWZvcmUgPSByb290LmJyZWFrQmVmb3JlLmNoaWxkcmVuWzBdOwogICAgICBicmVha0JlZm9yZVRhcmdldCA9IGJyZWFrQmVmb3JlLnRhcmdldDsKICAgIH0gZWxzZSBpZiAocm9vdC5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCA+PSAxICYmIHJvb3Quc3ViZm9ybS5jaGlsZHJlblswXS5icmVha0JlZm9yZS5jaGlsZHJlbi5sZW5ndGggPj0gMSkgewogICAgICBicmVha0JlZm9yZSA9IHJvb3Quc3ViZm9ybS5jaGlsZHJlblswXS5icmVha0JlZm9yZS5jaGlsZHJlblswXTsKICAgICAgYnJlYWtCZWZvcmVUYXJnZXQgPSBicmVha0JlZm9yZS50YXJnZXQ7CiAgICB9IGVsc2UgaWYgKHJvb3QuYnJlYWs/LmJlZm9yZVRhcmdldCkgewogICAgICBicmVha0JlZm9yZSA9IHJvb3QuYnJlYWs7CiAgICAgIGJyZWFrQmVmb3JlVGFyZ2V0ID0gYnJlYWtCZWZvcmUuYmVmb3JlVGFyZ2V0OwogICAgfSBlbHNlIGlmIChyb290LnN1YmZvcm0uY2hpbGRyZW4ubGVuZ3RoID49IDEgJiYgcm9vdC5zdWJmb3JtLmNoaWxkcmVuWzBdLmJyZWFrPy5iZWZvcmVUYXJnZXQpIHsKICAgICAgYnJlYWtCZWZvcmUgPSByb290LnN1YmZvcm0uY2hpbGRyZW5bMF0uYnJlYWs7CiAgICAgIGJyZWFrQmVmb3JlVGFyZ2V0ID0gYnJlYWtCZWZvcmUuYmVmb3JlVGFyZ2V0OwogICAgfQogICAgaWYgKGJyZWFrQmVmb3JlKSB7CiAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXNbJHNlYXJjaE5vZGVdKGJyZWFrQmVmb3JlVGFyZ2V0LCBicmVha0JlZm9yZVskZ2V0UGFyZW50XSgpKTsKICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIFBhZ2VBcmVhKSB7CiAgICAgICAgcGFnZUFyZWEgPSB0YXJnZXQ7CiAgICAgICAgYnJlYWtCZWZvcmVbJGV4dHJhXSA9IHt9OwogICAgICB9CiAgICB9CiAgICBwYWdlQXJlYSB8fD0gcGFnZUFyZWFzWzBdOwogICAgcGFnZUFyZWFbJGV4dHJhXSA9IHsKICAgICAgbnVtYmVyT2ZVc2U6IDEKICAgIH07CiAgICBjb25zdCBwYWdlQXJlYVBhcmVudCA9IHBhZ2VBcmVhWyRnZXRQYXJlbnRdKCk7CiAgICBwYWdlQXJlYVBhcmVudFskZXh0cmFdID0gewogICAgICBudW1iZXJPZlVzZTogMSwKICAgICAgcGFnZUluZGV4OiBwYWdlQXJlYVBhcmVudC5wYWdlQXJlYS5jaGlsZHJlbi5pbmRleE9mKHBhZ2VBcmVhKSwKICAgICAgcGFnZVNldEluZGV4OiAwCiAgICB9OwogICAgbGV0IHRhcmdldFBhZ2VBcmVhOwogICAgbGV0IGxlYWRlciA9IG51bGw7CiAgICBsZXQgdHJhaWxlciA9IG51bGw7CiAgICBsZXQgaGFzU29tZXRoaW5nID0gdHJ1ZTsKICAgIGxldCBoYXNTb21ldGhpbmdDb3VudGVyID0gMDsKICAgIGxldCBzdGFydEluZGV4ID0gMDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmICghaGFzU29tZXRoaW5nKSB7CiAgICAgICAgbWFpbkh0bWwuY2hpbGRyZW4ucG9wKCk7CiAgICAgICAgaWYgKCsraGFzU29tZXRoaW5nQ291bnRlciA9PT0gTUFYX0VNUFRZX1BBR0VTKSB7CiAgICAgICAgICB3YXJuKCJYRkEgLSBTb21ldGhpbmcgZ29lcyB3cm9uZzogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICAgICAgICByZXR1cm4gbWFpbkh0bWw7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGhhc1NvbWV0aGluZ0NvdW50ZXIgPSAwOwogICAgICB9CiAgICAgIHRhcmdldFBhZ2VBcmVhID0gbnVsbDsKICAgICAgdGhpc1skZXh0cmFdLmN1cnJlbnRQYWdlQXJlYSA9IHBhZ2VBcmVhOwogICAgICBjb25zdCBwYWdlID0gcGFnZUFyZWFbJHRvSFRNTF0oKS5odG1sOwogICAgICBtYWluSHRtbC5jaGlsZHJlbi5wdXNoKHBhZ2UpOwogICAgICBpZiAobGVhZGVyKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgICAgICAgcGFnZS5jaGlsZHJlbi5wdXNoKGxlYWRlclskdG9IVE1MXShwYWdlQXJlYVskZXh0cmFdLnNwYWNlKS5odG1sKTsKICAgICAgICBsZWFkZXIgPSBudWxsOwogICAgICB9CiAgICAgIGlmICh0cmFpbGVyKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgICAgICAgcGFnZS5jaGlsZHJlbi5wdXNoKHRyYWlsZXJbJHRvSFRNTF0ocGFnZUFyZWFbJGV4dHJhXS5zcGFjZSkuaHRtbCk7CiAgICAgICAgdHJhaWxlciA9IG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgY29udGVudEFyZWFzID0gcGFnZUFyZWEuY29udGVudEFyZWEuY2hpbGRyZW47CiAgICAgIGNvbnN0IGh0bWxDb250ZW50QXJlYXMgPSBwYWdlLmNoaWxkcmVuLmZpbHRlcihub2RlID0+IG5vZGUuYXR0cmlidXRlcy5jbGFzcy5pbmNsdWRlcygieGZhQ29udGVudGFyZWEiKSk7CiAgICAgIGhhc1NvbWV0aGluZyA9IGZhbHNlOwogICAgICB0aGlzWyRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPSBudWxsOwogICAgICB0aGlzWyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlID0gZmFsc2U7CiAgICAgIGNvbnN0IGZsdXNoID0gaW5kZXggPT4gewogICAgICAgIGNvbnN0IGh0bWwgPSByb290WyRmbHVzaEhUTUxdKCk7CiAgICAgICAgaWYgKGh0bWwpIHsKICAgICAgICAgIGhhc1NvbWV0aGluZyB8fD0gaHRtbC5jaGlsZHJlbj8ubGVuZ3RoID4gMDsKICAgICAgICAgIGh0bWxDb250ZW50QXJlYXNbaW5kZXhdLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBmb3IgKGxldCBpID0gc3RhcnRJbmRleCwgaWkgPSBjb250ZW50QXJlYXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IGNvbnRlbnRBcmVhID0gdGhpc1skZXh0cmFdLmN1cnJlbnRDb250ZW50QXJlYSA9IGNvbnRlbnRBcmVhc1tpXTsKICAgICAgICBjb25zdCBzcGFjZSA9IHsKICAgICAgICAgIHdpZHRoOiBjb250ZW50QXJlYS53LAogICAgICAgICAgaGVpZ2h0OiBjb250ZW50QXJlYS5oCiAgICAgICAgfTsKICAgICAgICBzdGFydEluZGV4ID0gMDsKICAgICAgICBpZiAobGVhZGVyKSB7CiAgICAgICAgICBodG1sQ29udGVudEFyZWFzW2ldLmNoaWxkcmVuLnB1c2gobGVhZGVyWyR0b0hUTUxdKHNwYWNlKS5odG1sKTsKICAgICAgICAgIGxlYWRlciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0cmFpbGVyKSB7CiAgICAgICAgICBodG1sQ29udGVudEFyZWFzW2ldLmNoaWxkcmVuLnB1c2godHJhaWxlclskdG9IVE1MXShzcGFjZSkuaHRtbCk7CiAgICAgICAgICB0cmFpbGVyID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgY29uc3QgaHRtbCA9IHJvb3RbJHRvSFRNTF0oc3BhY2UpOwogICAgICAgIGlmIChodG1sLnN1Y2Nlc3MpIHsKICAgICAgICAgIGlmIChodG1sLmh0bWwpIHsKICAgICAgICAgICAgaGFzU29tZXRoaW5nIHx8PSBodG1sLmh0bWwuY2hpbGRyZW4/Lmxlbmd0aCA+IDA7CiAgICAgICAgICAgIGh0bWxDb250ZW50QXJlYXNbaV0uY2hpbGRyZW4ucHVzaChodG1sLmh0bWwpOwogICAgICAgICAgfSBlbHNlIGlmICghaGFzU29tZXRoaW5nICYmIG1haW5IdG1sLmNoaWxkcmVuLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgbWFpbkh0bWwuY2hpbGRyZW4ucG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbWFpbkh0bWw7CiAgICAgICAgfQogICAgICAgIGlmIChodG1sLmlzQnJlYWsoKSkgewogICAgICAgICAgY29uc3Qgbm9kZSA9IGh0bWwuYnJlYWtOb2RlOwogICAgICAgICAgZmx1c2goaSk7CiAgICAgICAgICBpZiAobm9kZS50YXJnZXRUeXBlID09PSAiYXV0byIpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS5sZWFkZXIpIHsKICAgICAgICAgICAgbGVhZGVyID0gdGhpc1skc2VhcmNoTm9kZV0obm9kZS5sZWFkZXIsIG5vZGVbJGdldFBhcmVudF0oKSk7CiAgICAgICAgICAgIGxlYWRlciA9IGxlYWRlciA/IGxlYWRlclswXSA6IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS50cmFpbGVyKSB7CiAgICAgICAgICAgIHRyYWlsZXIgPSB0aGlzWyRzZWFyY2hOb2RlXShub2RlLnRyYWlsZXIsIG5vZGVbJGdldFBhcmVudF0oKSk7CiAgICAgICAgICAgIHRyYWlsZXIgPSB0cmFpbGVyID8gdHJhaWxlclswXSA6IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS50YXJnZXRUeXBlID09PSAicGFnZUFyZWEiKSB7CiAgICAgICAgICAgIHRhcmdldFBhZ2VBcmVhID0gbm9kZVskZXh0cmFdLnRhcmdldDsKICAgICAgICAgICAgaSA9IEluZmluaXR5OwogICAgICAgICAgfSBlbHNlIGlmICghbm9kZVskZXh0cmFdLnRhcmdldCkgewogICAgICAgICAgICBpID0gbm9kZVskZXh0cmFdLmluZGV4OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFyZ2V0UGFnZUFyZWEgPSBub2RlWyRleHRyYV0udGFyZ2V0OwogICAgICAgICAgICBzdGFydEluZGV4ID0gbm9kZVskZXh0cmFdLmluZGV4ICsgMTsKICAgICAgICAgICAgaSA9IEluZmluaXR5OwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzWyRleHRyYV0ub3ZlcmZsb3dOb2RlKSB7CiAgICAgICAgICBjb25zdCBub2RlID0gdGhpc1skZXh0cmFdLm92ZXJmbG93Tm9kZTsKICAgICAgICAgIHRoaXNbJGV4dHJhXS5vdmVyZmxvd05vZGUgPSBudWxsOwogICAgICAgICAgY29uc3Qgb3ZlcmZsb3dFeHRyYSA9IG5vZGVbJGdldEV4dHJhXSgpOwogICAgICAgICAgY29uc3QgdGFyZ2V0ID0gb3ZlcmZsb3dFeHRyYS50YXJnZXQ7CiAgICAgICAgICBvdmVyZmxvd0V4dHJhLmFkZExlYWRlciA9IG92ZXJmbG93RXh0cmEubGVhZGVyICE9PSBudWxsOwogICAgICAgICAgb3ZlcmZsb3dFeHRyYS5hZGRUcmFpbGVyID0gb3ZlcmZsb3dFeHRyYS50cmFpbGVyICE9PSBudWxsOwogICAgICAgICAgZmx1c2goaSk7CiAgICAgICAgICBjb25zdCBjdXJyZW50SW5kZXggPSBpOwogICAgICAgICAgaSA9IEluZmluaXR5OwogICAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIFBhZ2VBcmVhKSB7CiAgICAgICAgICAgIHRhcmdldFBhZ2VBcmVhID0gdGFyZ2V0OwogICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBDb250ZW50QXJlYSkgewogICAgICAgICAgICBjb25zdCBpbmRleCA9IGNvbnRlbnRBcmVhcy5pbmRleE9mKHRhcmdldCk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICBpZiAoaW5kZXggPiBjdXJyZW50SW5kZXgpIHsKICAgICAgICAgICAgICAgIGkgPSBpbmRleCAtIDE7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXggPSBpbmRleDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGFyZ2V0UGFnZUFyZWEgPSB0YXJnZXRbJGdldFBhcmVudF0oKTsKICAgICAgICAgICAgICBzdGFydEluZGV4ID0gdGFyZ2V0UGFnZUFyZWEuY29udGVudEFyZWEuY2hpbGRyZW4uaW5kZXhPZih0YXJnZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZmx1c2goaSk7CiAgICAgIH0KICAgICAgdGhpc1skZXh0cmFdLnBhZ2VOdW1iZXIgKz0gMTsKICAgICAgaWYgKHRhcmdldFBhZ2VBcmVhKSB7CiAgICAgICAgaWYgKHRhcmdldFBhZ2VBcmVhWyRpc1VzYWJsZV0oKSkgewogICAgICAgICAgdGFyZ2V0UGFnZUFyZWFbJGV4dHJhXS5udW1iZXJPZlVzZSArPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0YXJnZXRQYWdlQXJlYSA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIHBhZ2VBcmVhID0gdGFyZ2V0UGFnZUFyZWEgfHwgcGFnZUFyZWFbJGdldE5leHRQYWdlXSgpOwogICAgICB5aWVsZCBudWxsOwogICAgfQogIH0KfQpjbGFzcyBUZXh0IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0ZXh0Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubWF4Q2hhcnMgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5tYXhDaGFycywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yaWQgPSBhdHRyaWJ1dGVzLnJpZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskYWNjZXB0V2hpdGVzcGFjZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRvbkNoaWxkXShjaGlsZCkgewogICAgaWYgKGNoaWxkWyRuYW1lc3BhY2VJZF0gPT09IE5hbWVzcGFjZUlkcy54aHRtbC5pZCkgewogICAgICB0aGlzWyRjb250ZW50XSA9IGNoaWxkOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHdhcm4oYFhGQSAtIEludmFsaWQgY29udGVudCBpbiBUZXh0OiAke2NoaWxkWyRub2RlTmFtZV19LmApOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJG9uVGV4dF0oc3RyKSB7CiAgICBpZiAodGhpc1skY29udGVudF0gaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXJbJG9uVGV4dF0oc3RyKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBpZiAodHlwZW9mIHRoaXNbJGNvbnRlbnRdID09PSAic3RyaW5nIikgewogICAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnJlcGxhY2VBbGwoIlxyXG4iLCAiXG4iKTsKICAgIH0KICB9CiAgWyRnZXRFeHRyYV0oKSB7CiAgICBpZiAodHlwZW9mIHRoaXNbJGNvbnRlbnRdID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gdGhpc1skY29udGVudF0uc3BsaXQoL1tcdTIwMjlcdTIwMjhcbl0vKS5maWx0ZXIobGluZSA9PiAhIWxpbmUpLmpvaW4oIlxuIik7CiAgICB9CiAgICByZXR1cm4gdGhpc1skY29udGVudF1bJHRleHRdKCk7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgaWYgKHR5cGVvZiB0aGlzWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgaHRtbCA9IHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdKS5odG1sOwogICAgICBpZiAodGhpc1skY29udGVudF0uaW5jbHVkZXMoIlx1MjAyOSIpKSB7CiAgICAgICAgaHRtbC5uYW1lID0gImRpdiI7CiAgICAgICAgaHRtbC5jaGlsZHJlbiA9IFtdOwogICAgICAgIHRoaXNbJGNvbnRlbnRdLnNwbGl0KCJcdTIwMjkiKS5tYXAocGFyYSA9PiBwYXJhLnNwbGl0KC9bXHUyMDI4XG5dLykuZmxhdE1hcChsaW5lID0+IFt7CiAgICAgICAgICBuYW1lOiAic3BhbiIsCiAgICAgICAgICB2YWx1ZTogbGluZQogICAgICAgIH0sIHsKICAgICAgICAgIG5hbWU6ICJiciIKICAgICAgICB9XSkpLmZvckVhY2gobGluZXMgPT4gewogICAgICAgICAgaHRtbC5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgbmFtZTogInAiLAogICAgICAgICAgICBjaGlsZHJlbjogbGluZXMKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKC9bXHUyMDI4XG5dLy50ZXN0KHRoaXNbJGNvbnRlbnRdKSkgewogICAgICAgIGh0bWwubmFtZSA9ICJkaXYiOwogICAgICAgIGh0bWwuY2hpbGRyZW4gPSBbXTsKICAgICAgICB0aGlzWyRjb250ZW50XS5zcGxpdCgvW1x1MjAyOFxuXS8pLmZvckVhY2gobGluZSA9PiB7CiAgICAgICAgICBodG1sLmNoaWxkcmVuLnB1c2goewogICAgICAgICAgICBuYW1lOiAic3BhbiIsCiAgICAgICAgICAgIHZhbHVlOiBsaW5lCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJiciIKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoaHRtbCk7CiAgICB9CiAgICByZXR1cm4gdGhpc1skY29udGVudF1bJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogIH0KfQpjbGFzcyBUZXh0RWRpdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0ZXh0RWRpdCIsIHRydWUpOwogICAgdGhpcy5hbGxvd1JpY2hUZXh0ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuYWxsb3dSaWNoVGV4dCwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuaFNjcm9sbFBvbGljeSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhTY3JvbGxQb2xpY3ksIFsiYXV0byIsICJvZmYiLCAib24iXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubXVsdGlMaW5lID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubXVsdGlMaW5lLAogICAgICBkZWZhdWx0VmFsdWU6ICIiLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAwIHx8IHggPT09IDEKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudlNjcm9sbFBvbGljeSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnZTY3JvbGxQb2xpY3ksIFsiYXV0byIsICJvZmYiLCAib24iXSk7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNvbWIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiYm9yZGVyIiwgImZvbnQiLCAibWFyZ2luIik7CiAgICBsZXQgaHRtbDsKICAgIGNvbnN0IGZpZWxkID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRQYXJlbnRdKCk7CiAgICBpZiAodGhpcy5tdWx0aUxpbmUgPT09ICIiKSB7CiAgICAgIHRoaXMubXVsdGlMaW5lID0gZmllbGQgaW5zdGFuY2VvZiBEcmF3ID8gMSA6IDA7CiAgICB9CiAgICBpZiAodGhpcy5tdWx0aUxpbmUgPT09IDEpIHsKICAgICAgaHRtbCA9IHsKICAgICAgICBuYW1lOiAidGV4dGFyZWEiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGRhdGFJZDogZmllbGRbJGRhdGFdPy5bJHVpZF0gfHwgZmllbGRbJHVpZF0sCiAgICAgICAgICBmaWVsZElkOiBmaWVsZFskdWlkXSwKICAgICAgICAgIGNsYXNzOiBbInhmYVRleHRmaWVsZCJdLAogICAgICAgICAgc3R5bGUsCiAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFMYWJlbChmaWVsZCksCiAgICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgICAgfQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgaHRtbCA9IHsKICAgICAgICBuYW1lOiAiaW5wdXQiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHR5cGU6ICJ0ZXh0IiwKICAgICAgICAgIGRhdGFJZDogZmllbGRbJGRhdGFdPy5bJHVpZF0gfHwgZmllbGRbJHVpZF0sCiAgICAgICAgICBmaWVsZElkOiBmaWVsZFskdWlkXSwKICAgICAgICAgIGNsYXNzOiBbInhmYVRleHRmaWVsZCJdLAogICAgICAgICAgc3R5bGUsCiAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFMYWJlbChmaWVsZCksCiAgICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgaWYgKGlzUmVxdWlyZWQoZmllbGQpKSB7CiAgICAgIGh0bWwuYXR0cmlidXRlc1siYXJpYS1yZXF1aXJlZCJdID0gdHJ1ZTsKICAgICAgaHRtbC5hdHRyaWJ1dGVzLnJlcXVpcmVkID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW2h0bWxdCiAgICB9KTsKICB9Cn0KY2xhc3MgVGltZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0aW1lIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgZGF0ZSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gZGF0ZSA/IG5ldyBEYXRlKGRhdGUpIDogbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1skY29udGVudF0gPyB0aGlzWyRjb250ZW50XS50b1N0cmluZygpIDogIiIpOwogIH0KfQpjbGFzcyBUaW1lU3RhbXAgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidGltZVN0YW1wIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuc2VydmVyID0gYXR0cmlidXRlcy5zZXJ2ZXIgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgVG9vbFRpcCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0b29sVGlwIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucmlkID0gYXR0cmlidXRlcy5yaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBUcmF2ZXJzYWwgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidHJhdmVyc2FsIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnRyYXZlcnNlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFRyYXZlcnNlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInRyYXZlcnNlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3BlcmF0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3BlcmF0aW9uLCBbIm5leHQiLCAiYmFjayIsICJkb3duIiwgImZpcnN0IiwgImxlZnQiLCAicmlnaHQiLCAidXAiXSk7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuc2NyaXB0ID0gbnVsbDsKICB9CiAgZ2V0IG5hbWUoKSB7CiAgICByZXR1cm4gdGhpcy5vcGVyYXRpb247CiAgfQogIFskaXNUcmFuc3BhcmVudF0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9CmNsYXNzIFVpIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInVpIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogICAgdGhpcy5iYXJjb2RlID0gbnVsbDsKICAgIHRoaXMuYnV0dG9uID0gbnVsbDsKICAgIHRoaXMuY2hlY2tCdXR0b24gPSBudWxsOwogICAgdGhpcy5jaG9pY2VMaXN0ID0gbnVsbDsKICAgIHRoaXMuZGF0ZVRpbWVFZGl0ID0gbnVsbDsKICAgIHRoaXMuZGVmYXVsdFVpID0gbnVsbDsKICAgIHRoaXMuaW1hZ2VFZGl0ID0gbnVsbDsKICAgIHRoaXMubnVtZXJpY0VkaXQgPSBudWxsOwogICAgdGhpcy5wYXNzd29yZEVkaXQgPSBudWxsOwogICAgdGhpcy5zaWduYXR1cmUgPSBudWxsOwogICAgdGhpcy50ZXh0RWRpdCA9IG51bGw7CiAgfQogIFskZ2V0RXh0cmFdKCkgewogICAgaWYgKHRoaXNbJGV4dHJhXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICAgIGlmIChuYW1lID09PSAiZXh0cmFzIiB8fCBuYW1lID09PSAicGljdHVyZSIpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBvYmogPSB0aGlzW25hbWVdOwogICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIFhGQU9iamVjdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB0aGlzWyRleHRyYV0gPSBvYmo7CiAgICAgICAgcmV0dXJuIG9iajsKICAgICAgfQogICAgICB0aGlzWyRleHRyYV0gPSBudWxsOwogICAgfQogICAgcmV0dXJuIHRoaXNbJGV4dHJhXTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBvYmogPSB0aGlzWyRnZXRFeHRyYV0oKTsKICAgIGlmIChvYmopIHsKICAgICAgcmV0dXJuIG9ialskdG9IVE1MXShhdmFpbGFibGVTcGFjZSk7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICB9Cn0KY2xhc3MgVmFsaWRhdGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidmFsaWRhdGUiLCB0cnVlKTsKICAgIHRoaXMuZm9ybWF0VGVzdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmZvcm1hdFRlc3QsIFsid2FybmluZyIsICJkaXNhYmxlZCIsICJlcnJvciJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5udWxsVGVzdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm51bGxUZXN0LCBbImRpc2FibGVkIiwgImVycm9yIiwgIndhcm5pbmciXSk7CiAgICB0aGlzLnNjcmlwdFRlc3QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zY3JpcHRUZXN0LCBbImVycm9yIiwgImRpc2FibGVkIiwgIndhcm5pbmciXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tZXNzYWdlID0gbnVsbDsKICAgIHRoaXMucGljdHVyZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQp9CmNsYXNzIFZhbHVlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInZhbHVlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3ZlcnJpZGUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5vdmVycmlkZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmFyYyA9IG51bGw7CiAgICB0aGlzLmJvb2xlYW4gPSBudWxsOwogICAgdGhpcy5kYXRlID0gbnVsbDsKICAgIHRoaXMuZGF0ZVRpbWUgPSBudWxsOwogICAgdGhpcy5kZWNpbWFsID0gbnVsbDsKICAgIHRoaXMuZXhEYXRhID0gbnVsbDsKICAgIHRoaXMuZmxvYXQgPSBudWxsOwogICAgdGhpcy5pbWFnZSA9IG51bGw7CiAgICB0aGlzLmludGVnZXIgPSBudWxsOwogICAgdGhpcy5saW5lID0gbnVsbDsKICAgIHRoaXMucmVjdGFuZ2xlID0gbnVsbDsKICAgIHRoaXMudGV4dCA9IG51bGw7CiAgICB0aGlzLnRpbWUgPSBudWxsOwogIH0KICBbJHNldFZhbHVlXSh2YWx1ZSkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgaWYgKHBhcmVudCBpbnN0YW5jZW9mIEZpZWxkKSB7CiAgICAgIGlmIChwYXJlbnQudWk/LmltYWdlRWRpdCkgewogICAgICAgIGlmICghdGhpcy5pbWFnZSkgewogICAgICAgICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSh7fSk7CiAgICAgICAgICB0aGlzWyRhcHBlbmRDaGlsZF0odGhpcy5pbWFnZSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuaW1hZ2VbJGNvbnRlbnRdID0gdmFsdWVbJGNvbnRlbnRdOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgY29uc3QgdmFsdWVOYW1lID0gdmFsdWVbJG5vZGVOYW1lXTsKICAgIGlmICh0aGlzW3ZhbHVlTmFtZV0gIT09IG51bGwpIHsKICAgICAgdGhpc1t2YWx1ZU5hbWVdWyRjb250ZW50XSA9IHZhbHVlWyRjb250ZW50XTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXNbbmFtZV07CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgICB0aGlzW25hbWVdID0gbnVsbDsKICAgICAgICB0aGlzWyRyZW1vdmVDaGlsZF0ob2JqKTsKICAgICAgfQogICAgfQogICAgdGhpc1t2YWx1ZVskbm9kZU5hbWVdXSA9IHZhbHVlOwogICAgdGhpc1skYXBwZW5kQ2hpbGRdKHZhbHVlKTsKICB9CiAgWyR0ZXh0XSgpIHsKICAgIGlmICh0aGlzLmV4RGF0YSkgewogICAgICBpZiAodHlwZW9mIHRoaXMuZXhEYXRhWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gdGhpcy5leERhdGFbJGNvbnRlbnRdLnRyaW0oKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5leERhdGFbJGNvbnRlbnRdWyR0ZXh0XSgpLnRyaW0oKTsKICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBpZiAobmFtZSA9PT0gImltYWdlIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG9iaiA9IHRoaXNbbmFtZV07CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgICByZXR1cm4gKG9ialskY29udGVudF0gfHwgIiIpLnRvU3RyaW5nKCkudHJpbSgpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgY29uc3Qgb2JqID0gdGhpc1tuYW1lXTsKICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgWEZBT2JqZWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHJldHVybiBvYmpbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgfQp9CmNsYXNzIFZhcmlhYmxlcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ2YXJpYWJsZXMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZsb2F0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmludGVnZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWFuaWZlc3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2NyaXB0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGlzVHJhbnNwYXJlbnRdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIFRlbXBsYXRlTmFtZXNwYWNlIHsKICBzdGF0aWMgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKFRlbXBsYXRlTmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBUZW1wbGF0ZU5hbWVzcGFjZVtuYW1lXShhdHRyaWJ1dGVzKTsKICAgICAgbm9kZVskc2V0U2V0QXR0cmlidXRlc10oYXR0cmlidXRlcyk7CiAgICAgIHJldHVybiBub2RlOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGFwcGVhcmFuY2VGaWx0ZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXBwZWFyYW5jZUZpbHRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBhcmMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXJjKGF0dHJzKTsKICB9CiAgc3RhdGljIGFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXJlYShhdHRycyk7CiAgfQogIHN0YXRpYyBhc3Npc3QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXNzaXN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGJhcmNvZGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQmFyY29kZShhdHRycyk7CiAgfQogIHN0YXRpYyBiaW5kKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJpbmQoYXR0cnMpOwogIH0KICBzdGF0aWMgYmluZEl0ZW1zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJpbmRJdGVtcyhhdHRycyk7CiAgfQogIHN0YXRpYyBib29rZW5kKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJvb2tlbmQoYXR0cnMpOwogIH0KICBzdGF0aWMgYm9vbGVhbihhdHRycykgewogICAgcmV0dXJuIG5ldyBCb29sZWFuRWxlbWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBib3JkZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQm9yZGVyKGF0dHJzKTsKICB9CiAgc3RhdGljIGJyZWFrKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJyZWFrKGF0dHJzKTsKICB9CiAgc3RhdGljIGJyZWFrQWZ0ZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQnJlYWtBZnRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBicmVha0JlZm9yZShhdHRycykgewogICAgcmV0dXJuIG5ldyBCcmVha0JlZm9yZShhdHRycyk7CiAgfQogIHN0YXRpYyBidXR0b24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQnV0dG9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNhbGN1bGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDYWxjdWxhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgY2FwdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBDYXB0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNlcnRpZmljYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENlcnRpZmljYXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNlcnRpZmljYXRlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDZXJ0aWZpY2F0ZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgY2hlY2tCdXR0b24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2hlY2tCdXR0b24oYXR0cnMpOwogIH0KICBzdGF0aWMgY2hvaWNlTGlzdChhdHRycykgewogICAgcmV0dXJuIG5ldyBDaG9pY2VMaXN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbG9yKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbG9yKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbWIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tYihhdHRycyk7CiAgfQogIHN0YXRpYyBjb25uZWN0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbm5lY3QoYXR0cnMpOwogIH0KICBzdGF0aWMgY29udGVudEFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29udGVudEFyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgY29ybmVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvcm5lcihhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVFbGVtZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVUaW1lKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVUaW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVUaW1lRWRpdChhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlVGltZUVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVjaW1hbChhdHRycykgewogICAgcmV0dXJuIG5ldyBEZWNpbWFsKGF0dHJzKTsKICB9CiAgc3RhdGljIGRlZmF1bHRVaShhdHRycykgewogICAgcmV0dXJuIG5ldyBEZWZhdWx0VWkoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVzYyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEZXNjKGF0dHJzKTsKICB9CiAgc3RhdGljIGRpZ2VzdE1ldGhvZChhdHRycykgewogICAgcmV0dXJuIG5ldyBEaWdlc3RNZXRob2QoYXR0cnMpOwogIH0KICBzdGF0aWMgZGlnZXN0TWV0aG9kcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEaWdlc3RNZXRob2RzKGF0dHJzKTsKICB9CiAgc3RhdGljIGRyYXcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRHJhdyhhdHRycyk7CiAgfQogIHN0YXRpYyBlZGdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVkZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jb2RpbmcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jb2RpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jb2RpbmdzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY29kaW5ncyhhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY3J5cHQoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdERhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdERhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHRpb25NZXRob2QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdGlvbk1ldGhvZChhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0aW9uTWV0aG9kcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0aW9uTWV0aG9kcyhhdHRycyk7CiAgfQogIHN0YXRpYyBldmVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBFdmVudChhdHRycyk7CiAgfQogIHN0YXRpYyBleERhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXhEYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4T2JqZWN0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEV4T2JqZWN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGV4Y2xHcm91cChhdHRycykgewogICAgcmV0dXJuIG5ldyBFeGNsR3JvdXAoYXR0cnMpOwogIH0KICBzdGF0aWMgZXhlY3V0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFeGVjdXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4dHJhcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFeHRyYXMoYXR0cnMpOwogIH0KICBzdGF0aWMgZmllbGQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmllbGQoYXR0cnMpOwogIH0KICBzdGF0aWMgZmlsbChhdHRycykgewogICAgcmV0dXJuIG5ldyBGaWxsKGF0dHJzKTsKICB9CiAgc3RhdGljIGZpbHRlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBGaWx0ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgZmxvYXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmxvYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgZm9udChhdHRycykgewogICAgcmV0dXJuIG5ldyB0ZW1wbGF0ZV9Gb250KGF0dHJzKTsKICB9CiAgc3RhdGljIGZvcm1hdChhdHRycykgewogICAgcmV0dXJuIG5ldyBGb3JtYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgaGFuZGxlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBIYW5kbGVyKGF0dHJzKTsKICB9CiAgc3RhdGljIGh5cGhlbmF0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEh5cGhlbmF0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGltYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEltYWdlKGF0dHJzKTsKICB9CiAgc3RhdGljIGltYWdlRWRpdChhdHRycykgewogICAgcmV0dXJuIG5ldyBJbWFnZUVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgaW50ZWdlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBJbnRlZ2VyKGF0dHJzKTsKICB9CiAgc3RhdGljIGlzc3VlcnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSXNzdWVycyhhdHRycyk7CiAgfQogIHN0YXRpYyBpdGVtcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBJdGVtcyhhdHRycyk7CiAgfQogIHN0YXRpYyBrZWVwKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEtlZXAoYXR0cnMpOwogIH0KICBzdGF0aWMga2V5VXNhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgS2V5VXNhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgbGluZShhdHRycykgewogICAgcmV0dXJuIG5ldyBMaW5lKGF0dHJzKTsKICB9CiAgc3RhdGljIGxpbmVhcihhdHRycykgewogICAgcmV0dXJuIG5ldyBMaW5lYXIoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9ja0RvY3VtZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExvY2tEb2N1bWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBtYW5pZmVzdChhdHRycykgewogICAgcmV0dXJuIG5ldyBNYW5pZmVzdChhdHRycyk7CiAgfQogIHN0YXRpYyBtYXJnaW4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWFyZ2luKGF0dHJzKTsKICB9CiAgc3RhdGljIG1kcChhdHRycykgewogICAgcmV0dXJuIG5ldyBNZHAoYXR0cnMpOwogIH0KICBzdGF0aWMgbWVkaXVtKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lZGl1bShhdHRycyk7CiAgfQogIHN0YXRpYyBtZXNzYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lc3NhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgbnVtZXJpY0VkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtZXJpY0VkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgb2NjdXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT2NjdXIoYXR0cnMpOwogIH0KICBzdGF0aWMgb2lkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9pZChhdHRycyk7CiAgfQogIHN0YXRpYyBvaWRzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9pZHMoYXR0cnMpOwogIH0KICBzdGF0aWMgb3ZlcmZsb3coYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3ZlcmZsb3coYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZUFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFnZUFyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlU2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhcmEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFyYShhdHRycyk7CiAgfQogIHN0YXRpYyBwYXNzd29yZEVkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFzc3dvcmRFZGl0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhdHRlcm4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgdGVtcGxhdGVfUGF0dGVybihhdHRycyk7CiAgfQogIHN0YXRpYyBwaWN0dXJlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBpY3R1cmUoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJvdG8oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJvdG8oYXR0cnMpOwogIH0KICBzdGF0aWMgcmFkaWFsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJhZGlhbChhdHRycyk7CiAgfQogIHN0YXRpYyByZWFzb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVhc29uKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlYXNvbnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVhc29ucyhhdHRycyk7CiAgfQogIHN0YXRpYyByZWN0YW5nbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlZihhdHRycykgewogICAgcmV0dXJuIG5ldyBSZWZFbGVtZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHNjcmlwdChhdHRycykgewogICAgcmV0dXJuIG5ldyBTY3JpcHQoYXR0cnMpOwogIH0KICBzdGF0aWMgc2V0UHJvcGVydHkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU2V0UHJvcGVydHkoYXR0cnMpOwogIH0KICBzdGF0aWMgc2lnbkRhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU2lnbkRhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgc2lnbmF0dXJlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpZ25hdHVyZShhdHRycyk7CiAgfQogIHN0YXRpYyBzaWduaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpZ25pbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgc29saWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU29saWQoYXR0cnMpOwogIH0KICBzdGF0aWMgc3BlYWsoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3BlYWsoYXR0cnMpOwogIH0KICBzdGF0aWMgc3RpcHBsZShhdHRycykgewogICAgcmV0dXJuIG5ldyBTdGlwcGxlKGF0dHJzKTsKICB9CiAgc3RhdGljIHN1YmZvcm0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3ViZm9ybShhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJmb3JtU2V0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmZvcm1TZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgc3ViamVjdEROKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmplY3RETihhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJqZWN0RE5zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmplY3RETnMoYXR0cnMpOwogIH0KICBzdGF0aWMgc3VibWl0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1Ym1pdChhdHRycyk7CiAgfQogIHN0YXRpYyB0ZW1wbGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUZW1wbGF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyB0ZXh0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRleHQoYXR0cnMpOwogIH0KICBzdGF0aWMgdGV4dEVkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGV4dEVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgdGltZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUaW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIHRpbWVTdGFtcChhdHRycykgewogICAgcmV0dXJuIG5ldyBUaW1lU3RhbXAoYXR0cnMpOwogIH0KICBzdGF0aWMgdG9vbFRpcChhdHRycykgewogICAgcmV0dXJuIG5ldyBUb29sVGlwKGF0dHJzKTsKICB9CiAgc3RhdGljIHRyYXZlcnNhbChhdHRycykgewogICAgcmV0dXJuIG5ldyBUcmF2ZXJzYWwoYXR0cnMpOwogIH0KICBzdGF0aWMgdHJhdmVyc2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHJhdmVyc2UoYXR0cnMpOwogIH0KICBzdGF0aWMgdWkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVWkoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFsaWRhdGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmFsaWRhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFsdWUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmFsdWUoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFyaWFibGVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhcmlhYmxlcyhhdHRycyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvYmluZC5qcwoKCgoKCgpjb25zdCBiaW5kX05TX0RBVEFTRVRTID0gTmFtZXNwYWNlSWRzLmRhdGFzZXRzLmlkOwpmdW5jdGlvbiBjcmVhdGVUZXh0KGNvbnRlbnQpIHsKICBjb25zdCBub2RlID0gbmV3IFRleHQoe30pOwogIG5vZGVbJGNvbnRlbnRdID0gY29udGVudDsKICByZXR1cm4gbm9kZTsKfQpjbGFzcyBCaW5kZXIgewogIGNvbnN0cnVjdG9yKHJvb3QpIHsKICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICB0aGlzLmRhdGFzZXRzID0gcm9vdC5kYXRhc2V0czsKICAgIHRoaXMuZGF0YSA9IHJvb3QuZGF0YXNldHM/LmRhdGEgfHwgbmV3IFhtbE9iamVjdChOYW1lc3BhY2VJZHMuZGF0YXNldHMuaWQsICJkYXRhIik7CiAgICB0aGlzLmVtcHR5TWVyZ2UgPSB0aGlzLmRhdGFbJGdldENoaWxkcmVuXSgpLmxlbmd0aCA9PT0gMDsKICAgIHRoaXMucm9vdC5mb3JtID0gdGhpcy5mb3JtID0gcm9vdC50ZW1wbGF0ZVskY2xvbmVdKCk7CiAgfQogIF9pc0NvbnN1bWVEYXRhKCkgewogICAgcmV0dXJuICF0aGlzLmVtcHR5TWVyZ2UgJiYgdGhpcy5fbWVyZ2VNb2RlOwogIH0KICBfaXNNYXRjaFRlbXBsYXRlKCkgewogICAgcmV0dXJuICF0aGlzLl9pc0NvbnN1bWVEYXRhKCk7CiAgfQogIGJpbmQoKSB7CiAgICB0aGlzLl9iaW5kRWxlbWVudCh0aGlzLmZvcm0sIHRoaXMuZGF0YSk7CiAgICByZXR1cm4gdGhpcy5mb3JtOwogIH0KICBnZXREYXRhKCkgewogICAgcmV0dXJuIHRoaXMuZGF0YTsKICB9CiAgX2JpbmRWYWx1ZShmb3JtTm9kZSwgZGF0YSwgcGljdHVyZSkgewogICAgZm9ybU5vZGVbJGRhdGFdID0gZGF0YTsKICAgIGlmIChmb3JtTm9kZVskaGFzU2V0dGFibGVWYWx1ZV0oKSkgewogICAgICBpZiAoZGF0YVskaXNEYXRhVmFsdWVdKCkpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IGRhdGFbJGdldERhdGFWYWx1ZV0oKTsKICAgICAgICBmb3JtTm9kZVskc2V0VmFsdWVdKGNyZWF0ZVRleHQodmFsdWUpKTsKICAgICAgfSBlbHNlIGlmIChmb3JtTm9kZSBpbnN0YW5jZW9mIEZpZWxkICYmIGZvcm1Ob2RlLnVpPy5jaG9pY2VMaXN0Py5vcGVuID09PSAibXVsdGlTZWxlY3QiKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhWyRnZXRDaGlsZHJlbl0oKS5tYXAoY2hpbGQgPT4gY2hpbGRbJGNvbnRlbnRdLnRyaW0oKSkuam9pbigiXG4iKTsKICAgICAgICBmb3JtTm9kZVskc2V0VmFsdWVdKGNyZWF0ZVRleHQodmFsdWUpKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICB3YXJuKGBYRkEgLSBOb2RlcyBoYXZlbid0IHRoZSBzYW1lIHR5cGUuYCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIWRhdGFbJGlzRGF0YVZhbHVlXSgpIHx8IHRoaXMuX2lzTWF0Y2hUZW1wbGF0ZSgpKSB7CiAgICAgIHRoaXMuX2JpbmRFbGVtZW50KGZvcm1Ob2RlLCBkYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oYFhGQSAtIE5vZGVzIGhhdmVuJ3QgdGhlIHNhbWUgdHlwZS5gKTsKICAgIH0KICB9CiAgX2ZpbmREYXRhQnlOYW1lVG9Db25zdW1lKG5hbWUsIGlzVmFsdWUsIGRhdGFOb2RlLCBnbG9iYWwpIHsKICAgIGlmICghbmFtZSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBnZW5lcmF0b3IsIG1hdGNoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgZ2VuZXJhdG9yID0gZGF0YU5vZGVbJGdldFJlYWxDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBmYWxzZSwgdHJ1ZSk7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgbWF0Y2ggPSBnZW5lcmF0b3IubmV4dCgpLnZhbHVlOwogICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoaXNWYWx1ZSA9PT0gbWF0Y2hbJGlzRGF0YVZhbHVlXSgpKSB7CiAgICAgICAgICByZXR1cm4gbWF0Y2g7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChkYXRhTm9kZVskbmFtZXNwYWNlSWRdID09PSBOYW1lc3BhY2VJZHMuZGF0YXNldHMuaWQgJiYgZGF0YU5vZGVbJG5vZGVOYW1lXSA9PT0gImRhdGEiKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgZGF0YU5vZGUgPSBkYXRhTm9kZVskZ2V0UGFyZW50XSgpOwogICAgfQogICAgaWYgKCFnbG9iYWwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBnZW5lcmF0b3IgPSB0aGlzLmRhdGFbJGdldFJlYWxDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCB0cnVlLCBmYWxzZSk7CiAgICBtYXRjaCA9IGdlbmVyYXRvci5uZXh0KCkudmFsdWU7CiAgICBpZiAobWF0Y2gpIHsKICAgICAgcmV0dXJuIG1hdGNoOwogICAgfQogICAgZ2VuZXJhdG9yID0gdGhpcy5kYXRhWyRnZXRBdHRyaWJ1dGVJdF0obmFtZSwgdHJ1ZSk7CiAgICBtYXRjaCA9IGdlbmVyYXRvci5uZXh0KCkudmFsdWU7CiAgICBpZiAobWF0Y2g/LlskaXNEYXRhVmFsdWVdKCkpIHsKICAgICAgcmV0dXJuIG1hdGNoOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIF9zZXRQcm9wZXJ0aWVzKGZvcm1Ob2RlLCBkYXRhTm9kZSkgewogICAgaWYgKCFmb3JtTm9kZS5oYXNPd25Qcm9wZXJ0eSgic2V0UHJvcGVydHkiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcmVmLAogICAgICB0YXJnZXQsCiAgICAgIGNvbm5lY3Rpb24KICAgIH0gb2YgZm9ybU5vZGUuc2V0UHJvcGVydHkuY2hpbGRyZW4pIHsKICAgICAgaWYgKGNvbm5lY3Rpb24pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIXJlZikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG5vZGVzID0gc2VhcmNoTm9kZSh0aGlzLnJvb3QsIGRhdGFOb2RlLCByZWYsIGZhbHNlLCBmYWxzZSk7CiAgICAgIGlmICghbm9kZXMpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHJlZmVyZW5jZTogJHtyZWZ9LmApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IFtub2RlXSA9IG5vZGVzOwogICAgICBpZiAoIW5vZGVbJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhKSkgewogICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgbm9kZTogbXVzdCBiZSBhIGRhdGEgbm9kZS5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB0YXJnZXROb2RlcyA9IHNlYXJjaE5vZGUodGhpcy5yb290LCBmb3JtTm9kZSwgdGFyZ2V0LCBmYWxzZSwgZmFsc2UpOwogICAgICBpZiAoIXRhcmdldE5vZGVzKSB7CiAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCB0YXJnZXQ6ICR7dGFyZ2V0fS5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBbdGFyZ2V0Tm9kZV0gPSB0YXJnZXROb2RlczsKICAgICAgaWYgKCF0YXJnZXROb2RlWyRpc0Rlc2NlbmRlbnRdKGZvcm1Ob2RlKSkgewogICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgdGFyZ2V0OiBtdXN0IGJlIGEgcHJvcGVydHkgb3Igc3VicHJvcGVydHkuYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdGFyZ2V0UGFyZW50ID0gdGFyZ2V0Tm9kZVskZ2V0UGFyZW50XSgpOwogICAgICBpZiAodGFyZ2V0Tm9kZSBpbnN0YW5jZW9mIFNldFByb3BlcnR5IHx8IHRhcmdldFBhcmVudCBpbnN0YW5jZW9mIFNldFByb3BlcnR5KSB7CiAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCB0YXJnZXQ6IGNhbm5vdCBiZSBhIHNldFByb3BlcnR5IG9yIG9uZSBvZiBpdHMgcHJvcGVydGllcy5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodGFyZ2V0Tm9kZSBpbnN0YW5jZW9mIEJpbmRJdGVtcyB8fCB0YXJnZXRQYXJlbnQgaW5zdGFuY2VvZiBCaW5kSXRlbXMpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHRhcmdldDogY2Fubm90IGJlIGEgYmluZEl0ZW1zIG9yIG9uZSBvZiBpdHMgcHJvcGVydGllcy5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBjb250ZW50ID0gbm9kZVskdGV4dF0oKTsKICAgICAgY29uc3QgbmFtZSA9IHRhcmdldE5vZGVbJG5vZGVOYW1lXTsKICAgICAgaWYgKHRhcmdldE5vZGUgaW5zdGFuY2VvZiBYRkFBdHRyaWJ1dGUpIHsKICAgICAgICBjb25zdCBhdHRycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgYXR0cnNbbmFtZV0gPSBjb250ZW50OwogICAgICAgIGNvbnN0IG9iaiA9IFJlZmxlY3QuY29uc3RydWN0KE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXRQYXJlbnQpLmNvbnN0cnVjdG9yLCBbYXR0cnNdKTsKICAgICAgICB0YXJnZXRQYXJlbnRbbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCF0YXJnZXROb2RlLmhhc093blByb3BlcnR5KCRjb250ZW50KSkgewogICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgbm9kZSB0byB1c2UgaW4gc2V0UHJvcGVydHlgKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0YXJnZXROb2RlWyRkYXRhXSA9IG5vZGU7CiAgICAgIHRhcmdldE5vZGVbJGNvbnRlbnRdID0gY29udGVudDsKICAgICAgdGFyZ2V0Tm9kZVskZmluYWxpemVdKCk7CiAgICB9CiAgfQogIF9iaW5kSXRlbXMoZm9ybU5vZGUsIGRhdGFOb2RlKSB7CiAgICBpZiAoIWZvcm1Ob2RlLmhhc093blByb3BlcnR5KCJpdGVtcyIpIHx8ICFmb3JtTm9kZS5oYXNPd25Qcm9wZXJ0eSgiYmluZEl0ZW1zIikgfHwgZm9ybU5vZGUuYmluZEl0ZW1zLmlzRW1wdHkoKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZm9ybU5vZGUuaXRlbXMuY2hpbGRyZW4pIHsKICAgICAgZm9ybU5vZGVbJHJlbW92ZUNoaWxkXShpdGVtKTsKICAgIH0KICAgIGZvcm1Ob2RlLml0ZW1zLmNsZWFyKCk7CiAgICBjb25zdCBsYWJlbHMgPSBuZXcgSXRlbXMoe30pOwogICAgY29uc3QgdmFsdWVzID0gbmV3IEl0ZW1zKHt9KTsKICAgIGZvcm1Ob2RlWyRhcHBlbmRDaGlsZF0obGFiZWxzKTsKICAgIGZvcm1Ob2RlLml0ZW1zLnB1c2gobGFiZWxzKTsKICAgIGZvcm1Ob2RlWyRhcHBlbmRDaGlsZF0odmFsdWVzKTsKICAgIGZvcm1Ob2RlLml0ZW1zLnB1c2godmFsdWVzKTsKICAgIGZvciAoY29uc3QgewogICAgICByZWYsCiAgICAgIGxhYmVsUmVmLAogICAgICB2YWx1ZVJlZiwKICAgICAgY29ubmVjdGlvbgogICAgfSBvZiBmb3JtTm9kZS5iaW5kSXRlbXMuY2hpbGRyZW4pIHsKICAgICAgaWYgKGNvbm5lY3Rpb24pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIXJlZikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG5vZGVzID0gc2VhcmNoTm9kZSh0aGlzLnJvb3QsIGRhdGFOb2RlLCByZWYsIGZhbHNlLCBmYWxzZSk7CiAgICAgIGlmICghbm9kZXMpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHJlZmVyZW5jZTogJHtyZWZ9LmApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2RlcykgewogICAgICAgIGlmICghbm9kZVskaXNEZXNjZW5kZW50XSh0aGlzLmRhdGFzZXRzKSkgewogICAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCByZWYgKCR7cmVmfSk6IG11c3QgYmUgYSBkYXRhc2V0cyBjaGlsZC5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYWJlbE5vZGVzID0gc2VhcmNoTm9kZSh0aGlzLnJvb3QsIG5vZGUsIGxhYmVsUmVmLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgaWYgKCFsYWJlbE5vZGVzKSB7CiAgICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIGxhYmVsOiAke2xhYmVsUmVmfS5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBbbGFiZWxOb2RlXSA9IGxhYmVsTm9kZXM7CiAgICAgICAgaWYgKCFsYWJlbE5vZGVbJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhc2V0cykpIHsKICAgICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgbGFiZWw6IG11c3QgYmUgYSBkYXRhc2V0cyBjaGlsZC5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCB2YWx1ZU5vZGVzID0gc2VhcmNoTm9kZSh0aGlzLnJvb3QsIG5vZGUsIHZhbHVlUmVmLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgaWYgKCF2YWx1ZU5vZGVzKSB7CiAgICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHZhbHVlOiAke3ZhbHVlUmVmfS5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBbdmFsdWVOb2RlXSA9IHZhbHVlTm9kZXM7CiAgICAgICAgaWYgKCF2YWx1ZU5vZGVbJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhc2V0cykpIHsKICAgICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgdmFsdWU6IG11c3QgYmUgYSBkYXRhc2V0cyBjaGlsZC5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYWJlbCA9IGNyZWF0ZVRleHQobGFiZWxOb2RlWyR0ZXh0XSgpKTsKICAgICAgICBjb25zdCB2YWx1ZSA9IGNyZWF0ZVRleHQodmFsdWVOb2RlWyR0ZXh0XSgpKTsKICAgICAgICBsYWJlbHNbJGFwcGVuZENoaWxkXShsYWJlbCk7CiAgICAgICAgbGFiZWxzLnRleHQucHVzaChsYWJlbCk7CiAgICAgICAgdmFsdWVzWyRhcHBlbmRDaGlsZF0odmFsdWUpOwogICAgICAgIHZhbHVlcy50ZXh0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgfQogIF9iaW5kT2NjdXJyZW5jZXMoZm9ybU5vZGUsIG1hdGNoZXMsIHBpY3R1cmUpIHsKICAgIGxldCBiYXNlQ2xvbmU7CiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPiAxKSB7CiAgICAgIGJhc2VDbG9uZSA9IGZvcm1Ob2RlWyRjbG9uZV0oKTsKICAgICAgYmFzZUNsb25lWyRyZW1vdmVDaGlsZF0oYmFzZUNsb25lLm9jY3VyKTsKICAgICAgYmFzZUNsb25lLm9jY3VyID0gbnVsbDsKICAgIH0KICAgIHRoaXMuX2JpbmRWYWx1ZShmb3JtTm9kZSwgbWF0Y2hlc1swXSwgcGljdHVyZSk7CiAgICB0aGlzLl9zZXRQcm9wZXJ0aWVzKGZvcm1Ob2RlLCBtYXRjaGVzWzBdKTsKICAgIHRoaXMuX2JpbmRJdGVtcyhmb3JtTm9kZSwgbWF0Y2hlc1swXSk7CiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFyZW50ID0gZm9ybU5vZGVbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IG5hbWUgPSBmb3JtTm9kZVskbm9kZU5hbWVdOwogICAgY29uc3QgcG9zID0gcGFyZW50WyRpbmRleE9mXShmb3JtTm9kZSk7CiAgICBmb3IgKGxldCBpID0gMSwgaWkgPSBtYXRjaGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgbWF0Y2ggPSBtYXRjaGVzW2ldOwogICAgICBjb25zdCBjbG9uZSA9IGJhc2VDbG9uZVskY2xvbmVdKCk7CiAgICAgIHBhcmVudFtuYW1lXS5wdXNoKGNsb25lKTsKICAgICAgcGFyZW50WyRpbnNlcnRBdF0ocG9zICsgaSwgY2xvbmUpOwogICAgICB0aGlzLl9iaW5kVmFsdWUoY2xvbmUsIG1hdGNoLCBwaWN0dXJlKTsKICAgICAgdGhpcy5fc2V0UHJvcGVydGllcyhjbG9uZSwgbWF0Y2gpOwogICAgICB0aGlzLl9iaW5kSXRlbXMoY2xvbmUsIG1hdGNoKTsKICAgIH0KICB9CiAgX2NyZWF0ZU9jY3VycmVuY2VzKGZvcm1Ob2RlKSB7CiAgICBpZiAoIXRoaXMuZW1wdHlNZXJnZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIG9jY3VyCiAgICB9ID0gZm9ybU5vZGU7CiAgICBpZiAoIW9jY3VyIHx8IG9jY3VyLmluaXRpYWwgPD0gMSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYXJlbnQgPSBmb3JtTm9kZVskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgbmFtZSA9IGZvcm1Ob2RlWyRub2RlTmFtZV07CiAgICBpZiAoIShwYXJlbnRbbmFtZV0gaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGN1cnJlbnROdW1iZXI7CiAgICBpZiAoZm9ybU5vZGUubmFtZSkgewogICAgICBjdXJyZW50TnVtYmVyID0gcGFyZW50W25hbWVdLmNoaWxkcmVuLmZpbHRlcihlID0+IGUubmFtZSA9PT0gZm9ybU5vZGUubmFtZSkubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgY3VycmVudE51bWJlciA9IHBhcmVudFtuYW1lXS5jaGlsZHJlbi5sZW5ndGg7CiAgICB9CiAgICBjb25zdCBwb3MgPSBwYXJlbnRbJGluZGV4T2ZdKGZvcm1Ob2RlKSArIDE7CiAgICBjb25zdCBpaSA9IG9jY3VyLmluaXRpYWwgLSBjdXJyZW50TnVtYmVyOwogICAgaWYgKGlpKSB7CiAgICAgIGNvbnN0IG5vZGVDbG9uZSA9IGZvcm1Ob2RlWyRjbG9uZV0oKTsKICAgICAgbm9kZUNsb25lWyRyZW1vdmVDaGlsZF0obm9kZUNsb25lLm9jY3VyKTsKICAgICAgbm9kZUNsb25lLm9jY3VyID0gbnVsbDsKICAgICAgcGFyZW50W25hbWVdLnB1c2gobm9kZUNsb25lKTsKICAgICAgcGFyZW50WyRpbnNlcnRBdF0ocG9zLCBub2RlQ2xvbmUpOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBjbG9uZSA9IG5vZGVDbG9uZVskY2xvbmVdKCk7CiAgICAgICAgcGFyZW50W25hbWVdLnB1c2goY2xvbmUpOwogICAgICAgIHBhcmVudFskaW5zZXJ0QXRdKHBvcyArIGksIGNsb25lKTsKICAgICAgfQogICAgfQogIH0KICBfZ2V0T2NjdXJJbmZvKGZvcm1Ob2RlKSB7CiAgICBjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIG9jY3VyCiAgICB9ID0gZm9ybU5vZGU7CiAgICBpZiAoIW9jY3VyIHx8ICFuYW1lKSB7CiAgICAgIHJldHVybiBbMSwgMV07CiAgICB9CiAgICBjb25zdCBtYXggPSBvY2N1ci5tYXggPT09IC0xID8gSW5maW5pdHkgOiBvY2N1ci5tYXg7CiAgICByZXR1cm4gW29jY3VyLm1pbiwgbWF4XTsKICB9CiAgX3NldEFuZEJpbmQoZm9ybU5vZGUsIGRhdGFOb2RlKSB7CiAgICB0aGlzLl9zZXRQcm9wZXJ0aWVzKGZvcm1Ob2RlLCBkYXRhTm9kZSk7CiAgICB0aGlzLl9iaW5kSXRlbXMoZm9ybU5vZGUsIGRhdGFOb2RlKTsKICAgIHRoaXMuX2JpbmRFbGVtZW50KGZvcm1Ob2RlLCBkYXRhTm9kZSk7CiAgfQogIF9iaW5kRWxlbWVudChmb3JtTm9kZSwgZGF0YU5vZGUpIHsKICAgIGNvbnN0IHVzZWxlc3NOb2RlcyA9IFtdOwogICAgdGhpcy5fY3JlYXRlT2NjdXJyZW5jZXMoZm9ybU5vZGUpOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiBmb3JtTm9kZVskZ2V0Q2hpbGRyZW5dKCkpIHsKICAgICAgaWYgKGNoaWxkWyRkYXRhXSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICh0aGlzLl9tZXJnZU1vZGUgPT09IHVuZGVmaW5lZCAmJiBjaGlsZFskbm9kZU5hbWVdID09PSAic3ViZm9ybSIpIHsKICAgICAgICB0aGlzLl9tZXJnZU1vZGUgPSBjaGlsZC5tZXJnZU1vZGUgPT09ICJjb25zdW1lRGF0YSI7CiAgICAgICAgY29uc3QgZGF0YUNoaWxkcmVuID0gZGF0YU5vZGVbJGdldENoaWxkcmVuXSgpOwogICAgICAgIGlmIChkYXRhQ2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgdGhpcy5fYmluZE9jY3VycmVuY2VzKGNoaWxkLCBbZGF0YUNoaWxkcmVuWzBdXSwgbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgICAgIGNvbnN0IG5zSWQgPSBkYXRhTm9kZVskbmFtZXNwYWNlSWRdID09PSBiaW5kX05TX0RBVEFTRVRTID8gLTEgOiBkYXRhTm9kZVskbmFtZXNwYWNlSWRdOwogICAgICAgICAgY29uc3QgZGF0YUNoaWxkID0gY2hpbGRbJGRhdGFdID0gbmV3IFhtbE9iamVjdChuc0lkLCBjaGlsZC5uYW1lIHx8ICJyb290Iik7CiAgICAgICAgICBkYXRhTm9kZVskYXBwZW5kQ2hpbGRdKGRhdGFDaGlsZCk7CiAgICAgICAgICB0aGlzLl9iaW5kRWxlbWVudChjaGlsZCwgZGF0YUNoaWxkKTsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFjaGlsZFskaXNCaW5kYWJsZV0oKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCBnbG9iYWwgPSBmYWxzZTsKICAgICAgbGV0IHBpY3R1cmUgPSBudWxsOwogICAgICBsZXQgcmVmID0gbnVsbDsKICAgICAgbGV0IG1hdGNoID0gbnVsbDsKICAgICAgaWYgKGNoaWxkLmJpbmQpIHsKICAgICAgICBzd2l0Y2ggKGNoaWxkLmJpbmQubWF0Y2gpIHsKICAgICAgICAgIGNhc2UgIm5vbmUiOgogICAgICAgICAgICB0aGlzLl9zZXRBbmRCaW5kKGNoaWxkLCBkYXRhTm9kZSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSAiZ2xvYmFsIjoKICAgICAgICAgICAgZ2xvYmFsID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJkYXRhUmVmIjoKICAgICAgICAgICAgaWYgKCFjaGlsZC5iaW5kLnJlZikgewogICAgICAgICAgICAgIHdhcm4oYFhGQSAtIHJlZiBpcyBlbXB0eSBpbiBub2RlICR7Y2hpbGRbJG5vZGVOYW1lXX0uYCk7CiAgICAgICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgZGF0YU5vZGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlZiA9IGNoaWxkLmJpbmQucmVmOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoY2hpbGQuYmluZC5waWN0dXJlKSB7CiAgICAgICAgICBwaWN0dXJlID0gY2hpbGQuYmluZC5waWN0dXJlWyRjb250ZW50XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgW21pbiwgbWF4XSA9IHRoaXMuX2dldE9jY3VySW5mbyhjaGlsZCk7CiAgICAgIGlmIChyZWYpIHsKICAgICAgICBtYXRjaCA9IHNlYXJjaE5vZGUodGhpcy5yb290LCBkYXRhTm9kZSwgcmVmLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgaWYgKG1hdGNoID09PSBudWxsKSB7CiAgICAgICAgICBtYXRjaCA9IGNyZWF0ZURhdGFOb2RlKHRoaXMuZGF0YSwgZGF0YU5vZGUsIHJlZik7CiAgICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX2lzQ29uc3VtZURhdGEoKSkgewogICAgICAgICAgICBtYXRjaFskY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX3NldEFuZEJpbmQoY2hpbGQsIG1hdGNoKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5faXNDb25zdW1lRGF0YSgpKSB7CiAgICAgICAgICAgIG1hdGNoID0gbWF0Y2guZmlsdGVyKG5vZGUgPT4gIW5vZGVbJGNvbnN1bWVkXSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID4gbWF4KSB7CiAgICAgICAgICAgIG1hdGNoID0gbWF0Y2guc2xpY2UoMCwgbWF4KTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIG1hdGNoID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYXRjaCAmJiB0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICAgICAgbWF0Y2guZm9yRWFjaChub2RlID0+IHsKICAgICAgICAgICAgICBub2RlWyRjb25zdW1lZF0gPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCFjaGlsZC5uYW1lKSB7CiAgICAgICAgICB0aGlzLl9zZXRBbmRCaW5kKGNoaWxkLCBkYXRhTm9kZSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX2lzQ29uc3VtZURhdGEoKSkgewogICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IFtdOwogICAgICAgICAgd2hpbGUgKG1hdGNoZXMubGVuZ3RoIDwgbWF4KSB7CiAgICAgICAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy5fZmluZERhdGFCeU5hbWVUb0NvbnN1bWUoY2hpbGQubmFtZSwgY2hpbGRbJGhhc1NldHRhYmxlVmFsdWVdKCksIGRhdGFOb2RlLCBnbG9iYWwpOwogICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm91bmRbJGNvbnN1bWVkXSA9IHRydWU7CiAgICAgICAgICAgIG1hdGNoZXMucHVzaChmb3VuZCk7CiAgICAgICAgICB9CiAgICAgICAgICBtYXRjaCA9IG1hdGNoZXMubGVuZ3RoID4gMCA/IG1hdGNoZXMgOiBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRjaCA9IGRhdGFOb2RlWyRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdF0oY2hpbGQubmFtZSwgZmFsc2UsIHRoaXMuZW1wdHlNZXJnZSkubmV4dCgpLnZhbHVlOwogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICBpZiAobWluID09PSAwKSB7CiAgICAgICAgICAgICAgdXNlbGVzc05vZGVzLnB1c2goY2hpbGQpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG5zSWQgPSBkYXRhTm9kZVskbmFtZXNwYWNlSWRdID09PSBiaW5kX05TX0RBVEFTRVRTID8gLTEgOiBkYXRhTm9kZVskbmFtZXNwYWNlSWRdOwogICAgICAgICAgICBtYXRjaCA9IGNoaWxkWyRkYXRhXSA9IG5ldyBYbWxPYmplY3QobnNJZCwgY2hpbGQubmFtZSk7CiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgICAgICAgICBtYXRjaFskY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhTm9kZVskYXBwZW5kQ2hpbGRdKG1hdGNoKTsKICAgICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgbWF0Y2gpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgICAgICAgbWF0Y2hbJGNvbnN1bWVkXSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBtYXRjaCA9IFttYXRjaF07CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChtYXRjaCkgewogICAgICAgIHRoaXMuX2JpbmRPY2N1cnJlbmNlcyhjaGlsZCwgbWF0Y2gsIHBpY3R1cmUpOwogICAgICB9IGVsc2UgaWYgKG1pbiA+IDApIHsKICAgICAgICB0aGlzLl9zZXRBbmRCaW5kKGNoaWxkLCBkYXRhTm9kZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdXNlbGVzc05vZGVzLnB1c2goY2hpbGQpOwogICAgICB9CiAgICB9CiAgICB1c2VsZXNzTm9kZXMuZm9yRWFjaChub2RlID0+IG5vZGVbJGdldFBhcmVudF0oKVskcmVtb3ZlQ2hpbGRdKG5vZGUpKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9kYXRhLmpzCgpjbGFzcyBEYXRhSGFuZGxlciB7CiAgY29uc3RydWN0b3Iocm9vdCwgZGF0YSkgewogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMuZGF0YXNldCA9IHJvb3QuZGF0YXNldHMgfHwgbnVsbDsKICB9CiAgc2VyaWFsaXplKHN0b3JhZ2UpIHsKICAgIGNvbnN0IHN0YWNrID0gW1stMSwgdGhpcy5kYXRhWyRnZXRDaGlsZHJlbl0oKV1dOwogICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgbGFzdCA9IHN0YWNrLmF0KC0xKTsKICAgICAgY29uc3QgW2ksIGNoaWxkcmVuXSA9IGxhc3Q7CiAgICAgIGlmIChpICsgMSA9PT0gY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlblsrK2xhc3RbMF1dOwogICAgICBjb25zdCBzdG9yYWdlRW50cnkgPSBzdG9yYWdlLmdldChjaGlsZFskdWlkXSk7CiAgICAgIGlmIChzdG9yYWdlRW50cnkpIHsKICAgICAgICBjaGlsZFskc2V0VmFsdWVdKHN0b3JhZ2VFbnRyeSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IGNoaWxkWyRnZXRBdHRyaWJ1dGVzXSgpOwogICAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgYXR0cmlidXRlcy52YWx1ZXMoKSkgewogICAgICAgICAgY29uc3QgZW50cnkgPSBzdG9yYWdlLmdldCh2YWx1ZVskdWlkXSk7CiAgICAgICAgICBpZiAoZW50cnkpIHsKICAgICAgICAgICAgdmFsdWVbJHNldFZhbHVlXShlbnRyeSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBub2RlcyA9IGNoaWxkWyRnZXRDaGlsZHJlbl0oKTsKICAgICAgaWYgKG5vZGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBzdGFjay5wdXNoKFstMSwgbm9kZXNdKTsKICAgICAgfQogICAgfQogICAgY29uc3QgYnVmID0gW2A8eGZhOmRhdGFzZXRzIHhtbG5zOnhmYT0iaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtZGF0YS8xLjAvIj5gXTsKICAgIGlmICh0aGlzLmRhdGFzZXQpIHsKICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLmRhdGFzZXRbJGdldENoaWxkcmVuXSgpKSB7CiAgICAgICAgaWYgKGNoaWxkWyRub2RlTmFtZV0gIT09ICJkYXRhIikgewogICAgICAgICAgY2hpbGRbJHRvU3RyaW5nXShidWYpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy5kYXRhWyR0b1N0cmluZ10oYnVmKTsKICAgIGJ1Zi5wdXNoKCI8L3hmYTpkYXRhc2V0cz4iKTsKICAgIHJldHVybiBidWYuam9pbigiIik7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvY29uZmlnLmpzCgoKCgoKY29uc3QgQ09ORklHX05TX0lEID0gTmFtZXNwYWNlSWRzLmNvbmZpZy5pZDsKY2xhc3MgQWNyb2JhdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWNyb2JhdCIsIHRydWUpOwogICAgdGhpcy5hY3JvYmF0NyA9IG51bGw7CiAgICB0aGlzLmF1dG9TYXZlID0gbnVsbDsKICAgIHRoaXMuY29tbW9uID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGUgPSBudWxsOwogICAgdGhpcy52YWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyA9IG51bGw7CiAgICB0aGlzLnN1Ym1pdFVybCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBBY3JvYmF0NyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWNyb2JhdDciLCB0cnVlKTsKICAgIHRoaXMuZHluYW1pY1JlbmRlciA9IG51bGw7CiAgfQp9CmNsYXNzIEFEQkVfSlNDb25zb2xlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJBREJFX0pTQ29uc29sZSIsIFsiZGVsZWdhdGUiLCAiRW5hYmxlIiwgIkRpc2FibGUiXSk7CiAgfQp9CmNsYXNzIEFEQkVfSlNEZWJ1Z2dlciBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiQURCRV9KU0RlYnVnZ2VyIiwgWyJkZWxlZ2F0ZSIsICJFbmFibGUiLCAiRGlzYWJsZSJdKTsKICB9Cn0KY2xhc3MgQWRkU2lsZW50UHJpbnQgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWRkU2lsZW50UHJpbnQiKTsKICB9Cn0KY2xhc3MgQWRkVmlld2VyUHJlZmVyZW5jZXMgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWRkVmlld2VyUHJlZmVyZW5jZXMiKTsKICB9Cn0KY2xhc3MgQWRqdXN0RGF0YSBleHRlbmRzIE9wdGlvbjEwIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhZGp1c3REYXRhIik7CiAgfQp9CmNsYXNzIEFkb2JlRXh0ZW5zaW9uTGV2ZWwgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhZG9iZUV4dGVuc2lvbkxldmVsIiwgMCwgbiA9PiBuID49IDEgJiYgbiA8PSA4KTsKICB9Cn0KY2xhc3MgQWdlbnQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFnZW50IiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgPyBhdHRyaWJ1dGVzLm5hbWUudHJpbSgpIDogIiI7CiAgICB0aGlzLmNvbW1vbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBBbHdheXNFbWJlZCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFsd2F5c0VtYmVkIik7CiAgfQp9CmNsYXNzIEFtZCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYW1kIik7CiAgfQp9CmNsYXNzIGNvbmZpZ19BcmVhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhcmVhIik7CiAgICB0aGlzLmxldmVsID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubGV2ZWwsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxICYmIG4gPD0gMwogICAgfSk7CiAgICB0aGlzLm5hbWUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5uYW1lLCBbIiIsICJiYXJjb2RlIiwgImNvcmVpbml0IiwgImRldmljZURyaXZlciIsICJmb250IiwgImdlbmVyYWwiLCAibGF5b3V0IiwgIm1lcmdlIiwgInNjcmlwdCIsICJzaWduYXR1cmUiLCAic291cmNlU2V0IiwgInRlbXBsYXRlQ2FjaGUiXSk7CiAgfQp9CmNsYXNzIEF0dHJpYnV0ZXMgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImF0dHJpYnV0ZXMiLCBbInByZXNlcnZlIiwgImRlbGVnYXRlIiwgImlnbm9yZSJdKTsKICB9Cn0KY2xhc3MgQXV0b1NhdmUgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImF1dG9TYXZlIiwgWyJkaXNhYmxlZCIsICJlbmFibGVkIl0pOwogIH0KfQpjbGFzcyBCYXNlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJiYXNlIik7CiAgfQp9CmNsYXNzIEJhdGNoT3V0cHV0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJiYXRjaE91dHB1dCIpOwogICAgdGhpcy5mb3JtYXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5mb3JtYXQsIFsibm9uZSIsICJjb25jYXQiLCAiemlwIiwgInppcENvbXByZXNzIl0pOwogIH0KfQpjbGFzcyBCZWhhdmlvck92ZXJyaWRlIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYmVoYXZpb3JPdmVycmlkZSIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gbmV3IE1hcCh0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLmZpbHRlcih4ID0+IHguaW5jbHVkZXMoIjoiKSkubWFwKHggPT4geC5zcGxpdCgiOiIsIDIpKSk7CiAgfQp9CmNsYXNzIENhY2hlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjYWNoZSIsIHRydWUpOwogICAgdGhpcy50ZW1wbGF0ZUNhY2hlID0gbnVsbDsKICB9Cn0KY2xhc3MgQ2hhbmdlIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNoYW5nZSIpOwogIH0KfQpjbGFzcyBDb21tb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbW1vbiIsIHRydWUpOwogICAgdGhpcy5kYXRhID0gbnVsbDsKICAgIHRoaXMubG9jYWxlID0gbnVsbDsKICAgIHRoaXMubG9jYWxlU2V0ID0gbnVsbDsKICAgIHRoaXMubWVzc2FnaW5nID0gbnVsbDsKICAgIHRoaXMuc3VwcHJlc3NCYW5uZXIgPSBudWxsOwogICAgdGhpcy50ZW1wbGF0ZSA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRpb25NZXNzYWdpbmcgPSBudWxsOwogICAgdGhpcy52ZXJzaW9uQ29udHJvbCA9IG51bGw7CiAgICB0aGlzLmxvZyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBDb21wcmVzcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29tcHJlc3MiKTsKICAgIHRoaXMuc2NvcGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zY29wZSwgWyJpbWFnZU9ubHkiLCAiZG9jdW1lbnQiXSk7CiAgfQp9CmNsYXNzIENvbXByZXNzTG9naWNhbFN0cnVjdHVyZSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb21wcmVzc0xvZ2ljYWxTdHJ1Y3R1cmUiKTsKICB9Cn0KY2xhc3MgQ29tcHJlc3NPYmplY3RTdHJlYW0gZXh0ZW5kcyBPcHRpb24xMCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29tcHJlc3NPYmplY3RTdHJlYW0iKTsKICB9Cn0KY2xhc3MgQ29tcHJlc3Npb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbXByZXNzaW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmNvbXByZXNzTG9naWNhbFN0cnVjdHVyZSA9IG51bGw7CiAgICB0aGlzLmNvbXByZXNzT2JqZWN0U3RyZWFtID0gbnVsbDsKICAgIHRoaXMubGV2ZWwgPSBudWxsOwogICAgdGhpcy50eXBlID0gbnVsbDsKICB9Cn0KY2xhc3MgQ29uZmlnIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb25maWciLCB0cnVlKTsKICAgIHRoaXMuYWNyb2JhdCA9IG51bGw7CiAgICB0aGlzLnByZXNlbnQgPSBudWxsOwogICAgdGhpcy50cmFjZSA9IG51bGw7CiAgICB0aGlzLmFnZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIENvbmZvcm1hbmNlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb25mb3JtYW5jZSIsIFsiQSIsICJCIl0pOwogIH0KfQpjbGFzcyBDb250ZW50Q29weSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb250ZW50Q29weSIpOwogIH0KfQpjbGFzcyBDb3BpZXMgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb3BpZXMiLCAxLCBuID0+IG4gPj0gMSk7CiAgfQp9CmNsYXNzIENyZWF0b3IgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNyZWF0b3IiKTsKICB9Cn0KY2xhc3MgQ3VycmVudFBhZ2UgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjdXJyZW50UGFnZSIsIDAsIG4gPT4gbiA+PSAwKTsKICB9Cn0KY2xhc3MgRGF0YSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZGF0YSIsIHRydWUpOwogICAgdGhpcy5hZGp1c3REYXRhID0gbnVsbDsKICAgIHRoaXMuYXR0cmlidXRlcyA9IG51bGw7CiAgICB0aGlzLmluY3JlbWVudGFsTG9hZCA9IG51bGw7CiAgICB0aGlzLm91dHB1dFhTTCA9IG51bGw7CiAgICB0aGlzLnJhbmdlID0gbnVsbDsKICAgIHRoaXMucmVjb3JkID0gbnVsbDsKICAgIHRoaXMuc3RhcnROb2RlID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICAgIHRoaXMud2luZG93ID0gbnVsbDsKICAgIHRoaXMueHNsID0gbnVsbDsKICAgIHRoaXMuZXhjbHVkZU5TID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRyYW5zZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBEZWJ1ZyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZGVidWciLCB0cnVlKTsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgRGVmYXVsdFR5cGVmYWNlIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZGVmYXVsdFR5cGVmYWNlIik7CiAgICB0aGlzLndyaXRpbmdTY3JpcHQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy53cml0aW5nU2NyaXB0LCBbIioiLCAiQXJhYmljIiwgIkN5cmlsbGljIiwgIkVhc3RFdXJvcGVhblJvbWFuIiwgIkdyZWVrIiwgIkhlYnJldyIsICJKYXBhbmVzZSIsICJLb3JlYW4iLCAiUm9tYW4iLCAiU2ltcGxpZmllZENoaW5lc2UiLCAiVGhhaSIsICJUcmFkaXRpb25hbENoaW5lc2UiLCAiVmlldG5hbWVzZSJdKTsKICB9Cn0KY2xhc3MgRGVzdGluYXRpb24gZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImRlc3RpbmF0aW9uIiwgWyJwZGYiLCAicGNsIiwgInBzIiwgIndlYkNsaWVudCIsICJ6cGwiXSk7CiAgfQp9CmNsYXNzIERvY3VtZW50QXNzZW1ibHkgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZG9jdW1lbnRBc3NlbWJseSIpOwogIH0KfQpjbGFzcyBEcml2ZXIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImRyaXZlciIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lID8gYXR0cmlidXRlcy5uYW1lLnRyaW0oKSA6ICIiOwogICAgdGhpcy5mb250SW5mbyA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIER1cGxleE9wdGlvbiBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZHVwbGV4T3B0aW9uIiwgWyJzaW1wbGV4IiwgImR1cGxleEZsaXBMb25nRWRnZSIsICJkdXBsZXhGbGlwU2hvcnRFZGdlIl0pOwogIH0KfQpjbGFzcyBEeW5hbWljUmVuZGVyIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkeW5hbWljUmVuZGVyIiwgWyJmb3JiaWRkZW4iLCAicmVxdWlyZWQiXSk7CiAgfQp9CmNsYXNzIEVtYmVkIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVtYmVkIik7CiAgfQp9CmNsYXNzIGNvbmZpZ19FbmNyeXB0IGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVuY3J5cHQiKTsKICB9Cn0KY2xhc3MgY29uZmlnX0VuY3J5cHRpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVuY3J5cHRpb24iLCB0cnVlKTsKICAgIHRoaXMuZW5jcnlwdCA9IG51bGw7CiAgICB0aGlzLmVuY3J5cHRpb25MZXZlbCA9IG51bGw7CiAgICB0aGlzLnBlcm1pc3Npb25zID0gbnVsbDsKICB9Cn0KY2xhc3MgRW5jcnlwdGlvbkxldmVsIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlbmNyeXB0aW9uTGV2ZWwiLCBbIjQwYml0IiwgIjEyOGJpdCJdKTsKICB9Cn0KY2xhc3MgRW5mb3JjZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZW5mb3JjZSIpOwogIH0KfQpjbGFzcyBFcXVhdGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVxdWF0ZSIpOwogICAgdGhpcy5mb3JjZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmZvcmNlLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPT09IDAKICAgIH0pOwogICAgdGhpcy5mcm9tID0gYXR0cmlidXRlcy5mcm9tIHx8ICIiOwogICAgdGhpcy50byA9IGF0dHJpYnV0ZXMudG8gfHwgIiI7CiAgfQp9CmNsYXNzIEVxdWF0ZVJhbmdlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlcXVhdGVSYW5nZSIpOwogICAgdGhpcy5mcm9tID0gYXR0cmlidXRlcy5mcm9tIHx8ICIiOwogICAgdGhpcy50byA9IGF0dHJpYnV0ZXMudG8gfHwgIiI7CiAgICB0aGlzLl91bmljb2RlUmFuZ2UgPSBhdHRyaWJ1dGVzLnVuaWNvZGVSYW5nZSB8fCAiIjsKICB9CiAgZ2V0IHVuaWNvZGVSYW5nZSgpIHsKICAgIGNvbnN0IHJhbmdlcyA9IFtdOwogICAgY29uc3QgdW5pY29kZVJlZ2V4ID0gL1VcKyhbMC05YS1mQS1GXSspLzsKICAgIGNvbnN0IHVuaWNvZGVSYW5nZSA9IHRoaXMuX3VuaWNvZGVSYW5nZTsKICAgIGZvciAobGV0IHJhbmdlIG9mIHVuaWNvZGVSYW5nZS5zcGxpdCgiLCIpLm1hcCh4ID0+IHgudHJpbSgpKS5maWx0ZXIoeCA9PiAhIXgpKSB7CiAgICAgIHJhbmdlID0gcmFuZ2Uuc3BsaXQoIi0iLCAyKS5tYXAoeCA9PiB7CiAgICAgICAgY29uc3QgZm91bmQgPSB4Lm1hdGNoKHVuaWNvZGVSZWdleCk7CiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJzZUludChmb3VuZFsxXSwgMTYpOwogICAgICB9KTsKICAgICAgaWYgKHJhbmdlLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHJhbmdlLnB1c2gocmFuZ2VbMF0pOwogICAgICB9CiAgICAgIHJhbmdlcy5wdXNoKHJhbmdlKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInVuaWNvZGVSYW5nZSIsIHJhbmdlcyk7CiAgfQp9CmNsYXNzIEV4Y2x1ZGUgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJleGNsdWRlIik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLmZpbHRlcih4ID0+IHggJiYgWyJjYWxjdWxhdGUiLCAiY2xvc2UiLCAiZW50ZXIiLCAiZXhpdCIsICJpbml0aWFsaXplIiwgInJlYWR5IiwgInZhbGlkYXRlIl0uaW5jbHVkZXMoeCkpOwogIH0KfQpjbGFzcyBFeGNsdWRlTlMgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImV4Y2x1ZGVOUyIpOwogIH0KfQpjbGFzcyBGbGlwTGFiZWwgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImZsaXBMYWJlbCIsIFsidXNlUHJpbnRlclNldHRpbmciLCAib24iLCAib2ZmIl0pOwogIH0KfQpjbGFzcyBjb25maWdfRm9udEluZm8gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImZvbnRJbmZvIiwgdHJ1ZSk7CiAgICB0aGlzLmVtYmVkID0gbnVsbDsKICAgIHRoaXMubWFwID0gbnVsbDsKICAgIHRoaXMuc3Vic2V0QmVsb3cgPSBudWxsOwogICAgdGhpcy5hbHdheXNFbWJlZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWZhdWx0VHlwZWZhY2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubmV2ZXJFbWJlZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBGb3JtRmllbGRGaWxsaW5nIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImZvcm1GaWVsZEZpbGxpbmciKTsKICB9Cn0KY2xhc3MgR3JvdXBQYXJlbnQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImdyb3VwUGFyZW50Iik7CiAgfQp9CmNsYXNzIElmRW1wdHkgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImlmRW1wdHkiLCBbImRhdGFWYWx1ZSIsICJkYXRhR3JvdXAiLCAiaWdub3JlIiwgInJlbW92ZSJdKTsKICB9Cn0KY2xhc3MgSW5jbHVkZVhEUENvbnRlbnQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImluY2x1ZGVYRFBDb250ZW50Iik7CiAgfQp9CmNsYXNzIEluY3JlbWVudGFsTG9hZCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiaW5jcmVtZW50YWxMb2FkIiwgWyJub25lIiwgImZvcndhcmRPbmx5Il0pOwogIH0KfQpjbGFzcyBJbmNyZW1lbnRhbE1lcmdlIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImluY3JlbWVudGFsTWVyZ2UiKTsKICB9Cn0KY2xhc3MgSW50ZXJhY3RpdmUgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiaW50ZXJhY3RpdmUiKTsKICB9Cn0KY2xhc3MgSm9nIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJqb2ciLCBbInVzZVByaW50ZXJTZXR0aW5nIiwgIm5vbmUiLCAicGFnZVNldCJdKTsKICB9Cn0KY2xhc3MgTGFiZWxQcmludGVyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsYWJlbFByaW50ZXIiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm5hbWUsIFsienBsIiwgImRwbCIsICJpcGwiLCAidGNwbCJdKTsKICAgIHRoaXMuYmF0Y2hPdXRwdXQgPSBudWxsOwogICAgdGhpcy5mbGlwTGFiZWwgPSBudWxsOwogICAgdGhpcy5mb250SW5mbyA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIExheW91dCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibGF5b3V0IiwgWyJwYWdpbmF0ZSIsICJwYW5lbCJdKTsKICB9Cn0KY2xhc3MgTGV2ZWwgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsZXZlbCIsIDAsIG4gPT4gbiA+IDApOwogIH0KfQpjbGFzcyBMaW5lYXJpemVkIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImxpbmVhcml6ZWQiKTsKICB9Cn0KY2xhc3MgTG9jYWxlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsb2NhbGUiKTsKICB9Cn0KY2xhc3MgTG9jYWxlU2V0IGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsb2NhbGVTZXQiKTsKICB9Cn0KY2xhc3MgTG9nIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsb2ciLCB0cnVlKTsKICAgIHRoaXMubW9kZSA9IG51bGw7CiAgICB0aGlzLnRocmVzaG9sZCA9IG51bGw7CiAgICB0aGlzLnRvID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgTWFwRWxlbWVudCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibWFwIiwgdHJ1ZSk7CiAgICB0aGlzLmVxdWF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lcXVhdGVSYW5nZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBNZWRpdW1JbmZvIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtZWRpdW1JbmZvIiwgdHJ1ZSk7CiAgICB0aGlzLm1hcCA9IG51bGw7CiAgfQp9CmNsYXNzIGNvbmZpZ19NZXNzYWdlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtZXNzYWdlIiwgdHJ1ZSk7CiAgICB0aGlzLm1zZ0lkID0gbnVsbDsKICAgIHRoaXMuc2V2ZXJpdHkgPSBudWxsOwogIH0KfQpjbGFzcyBNZXNzYWdpbmcgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm1lc3NhZ2luZyIsIHRydWUpOwogICAgdGhpcy5tZXNzYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIE1vZGUgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm1vZGUiLCBbImFwcGVuZCIsICJvdmVyd3JpdGUiXSk7CiAgfQp9CmNsYXNzIE1vZGlmeUFubm90cyBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtb2RpZnlBbm5vdHMiKTsKICB9Cn0KY2xhc3MgTXNnSWQgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtc2dJZCIsIDEsIG4gPT4gbiA+PSAxKTsKICB9Cn0KY2xhc3MgTmFtZUF0dHIgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm5hbWVBdHRyIik7CiAgfQp9CmNsYXNzIE5ldmVyRW1iZWQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJuZXZlckVtYmVkIik7CiAgfQp9CmNsYXNzIE51bWJlck9mQ29waWVzIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibnVtYmVyT2ZDb3BpZXMiLCBudWxsLCBuID0+IG4gPj0gMiAmJiBuIDw9IDUpOwogIH0KfQpjbGFzcyBPcGVuQWN0aW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvcGVuQWN0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmRlc3RpbmF0aW9uID0gbnVsbDsKICB9Cn0KY2xhc3MgT3V0cHV0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXQiLCB0cnVlKTsKICAgIHRoaXMudG8gPSBudWxsOwogICAgdGhpcy50eXBlID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgT3V0cHV0QmluIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXRCaW4iKTsKICB9Cn0KY2xhc3MgT3V0cHV0WFNMIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXRYU0wiLCB0cnVlKTsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgT3ZlcnByaW50IGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdmVycHJpbnQiLCBbIm5vbmUiLCAiYm90aCIsICJkcmF3IiwgImZpZWxkIl0pOwogIH0KfQpjbGFzcyBQYWNrZXRzIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwYWNrZXRzIik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgaWYgKHRoaXNbJGNvbnRlbnRdID09PSAiKiIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLmZpbHRlcih4ID0+IFsiY29uZmlnIiwgImRhdGFzZXRzIiwgInRlbXBsYXRlIiwgInhmZGYiLCAieHNsdCJdLmluY2x1ZGVzKHgpKTsKICB9Cn0KY2xhc3MgUGFnZU9mZnNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFnZU9mZnNldCIpOwogICAgdGhpcy54ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMueCwKICAgICAgZGVmYXVsdFZhbHVlOiAidXNlWERDU2V0dGluZyIsCiAgICAgIHZhbGlkYXRlOiBuID0+IHRydWUKICAgIH0pOwogICAgdGhpcy55ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMueSwKICAgICAgZGVmYXVsdFZhbHVlOiAidXNlWERDU2V0dGluZyIsCiAgICAgIHZhbGlkYXRlOiBuID0+IHRydWUKICAgIH0pOwogIH0KfQpjbGFzcyBQYWdlUmFuZ2UgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBhZ2VSYW5nZSIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IG51bWJlcnMgPSB0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcCh4ID0+IHBhcnNlSW50KHgsIDEwKSk7CiAgICBjb25zdCByYW5nZXMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IG51bWJlcnMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICByYW5nZXMucHVzaChudW1iZXJzLnNsaWNlKGksIGkgKyAyKSk7CiAgICB9CiAgICB0aGlzWyRjb250ZW50XSA9IHJhbmdlczsKICB9Cn0KY2xhc3MgUGFnaW5hdGlvbiBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFnaW5hdGlvbiIsIFsic2ltcGxleCIsICJkdXBsZXhTaG9ydEVkZ2UiLCAiZHVwbGV4TG9uZ0VkZ2UiXSk7CiAgfQp9CmNsYXNzIFBhZ2luYXRpb25PdmVycmlkZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFnaW5hdGlvbk92ZXJyaWRlIiwgWyJub25lIiwgImZvcmNlRHVwbGV4IiwgImZvcmNlRHVwbGV4TG9uZ0VkZ2UiLCAiZm9yY2VEdXBsZXhTaG9ydEVkZ2UiLCAiZm9yY2VTaW1wbGV4Il0pOwogIH0KfQpjbGFzcyBQYXJ0IGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFydCIsIDEsIG4gPT4gZmFsc2UpOwogIH0KfQpjbGFzcyBQY2wgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBjbCIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5iYXRjaE91dHB1dCA9IG51bGw7CiAgICB0aGlzLmZvbnRJbmZvID0gbnVsbDsKICAgIHRoaXMuam9nID0gbnVsbDsKICAgIHRoaXMubWVkaXVtSW5mbyA9IG51bGw7CiAgICB0aGlzLm91dHB1dEJpbiA9IG51bGw7CiAgICB0aGlzLnBhZ2VPZmZzZXQgPSBudWxsOwogICAgdGhpcy5zdGFwbGUgPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBQZGYgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBkZiIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5hZG9iZUV4dGVuc2lvbkxldmVsID0gbnVsbDsKICAgIHRoaXMuYmF0Y2hPdXRwdXQgPSBudWxsOwogICAgdGhpcy5jb21wcmVzc2lvbiA9IG51bGw7CiAgICB0aGlzLmNyZWF0b3IgPSBudWxsOwogICAgdGhpcy5lbmNyeXB0aW9uID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy5pbnRlcmFjdGl2ZSA9IG51bGw7CiAgICB0aGlzLmxpbmVhcml6ZWQgPSBudWxsOwogICAgdGhpcy5vcGVuQWN0aW9uID0gbnVsbDsKICAgIHRoaXMucGRmYSA9IG51bGw7CiAgICB0aGlzLnByb2R1Y2VyID0gbnVsbDsKICAgIHRoaXMucmVuZGVyUG9saWN5ID0gbnVsbDsKICAgIHRoaXMuc2NyaXB0TW9kZWwgPSBudWxsOwogICAgdGhpcy5zaWxlbnRQcmludCA9IG51bGw7CiAgICB0aGlzLnN1Ym1pdEZvcm1hdCA9IG51bGw7CiAgICB0aGlzLnRhZ2dlZCA9IG51bGw7CiAgICB0aGlzLnZlcnNpb24gPSBudWxsOwogICAgdGhpcy52aWV3ZXJQcmVmZXJlbmNlcyA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIFBkZmEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBkZmEiLCB0cnVlKTsKICAgIHRoaXMuYW1kID0gbnVsbDsKICAgIHRoaXMuY29uZm9ybWFuY2UgPSBudWxsOwogICAgdGhpcy5pbmNsdWRlWERQQ29udGVudCA9IG51bGw7CiAgICB0aGlzLnBhcnQgPSBudWxsOwogIH0KfQpjbGFzcyBQZXJtaXNzaW9ucyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGVybWlzc2lvbnMiLCB0cnVlKTsKICAgIHRoaXMuYWNjZXNzaWJsZUNvbnRlbnQgPSBudWxsOwogICAgdGhpcy5jaGFuZ2UgPSBudWxsOwogICAgdGhpcy5jb250ZW50Q29weSA9IG51bGw7CiAgICB0aGlzLmRvY3VtZW50QXNzZW1ibHkgPSBudWxsOwogICAgdGhpcy5mb3JtRmllbGRGaWxsaW5nID0gbnVsbDsKICAgIHRoaXMubW9kaWZ5QW5ub3RzID0gbnVsbDsKICAgIHRoaXMucGxhaW50ZXh0TWV0YWRhdGEgPSBudWxsOwogICAgdGhpcy5wcmludCA9IG51bGw7CiAgICB0aGlzLnByaW50SGlnaFF1YWxpdHkgPSBudWxsOwogIH0KfQpjbGFzcyBQaWNrVHJheUJ5UERGU2l6ZSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwaWNrVHJheUJ5UERGU2l6ZSIpOwogIH0KfQpjbGFzcyBjb25maWdfUGljdHVyZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGljdHVyZSIpOwogIH0KfQpjbGFzcyBQbGFpbnRleHRNZXRhZGF0YSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwbGFpbnRleHRNZXRhZGF0YSIpOwogIH0KfQpjbGFzcyBQcmVzZW5jZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicHJlc2VuY2UiLCBbInByZXNlcnZlIiwgImRpc3NvbHZlIiwgImRpc3NvbHZlU3RydWN0dXJlIiwgImlnbm9yZSIsICJyZW1vdmUiXSk7CiAgfQp9CmNsYXNzIFByZXNlbnQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByZXNlbnQiLCB0cnVlKTsKICAgIHRoaXMuYmVoYXZpb3JPdmVycmlkZSA9IG51bGw7CiAgICB0aGlzLmNhY2hlID0gbnVsbDsKICAgIHRoaXMuY29tbW9uID0gbnVsbDsKICAgIHRoaXMuY29waWVzID0gbnVsbDsKICAgIHRoaXMuZGVzdGluYXRpb24gPSBudWxsOwogICAgdGhpcy5pbmNyZW1lbnRhbE1lcmdlID0gbnVsbDsKICAgIHRoaXMubGF5b3V0ID0gbnVsbDsKICAgIHRoaXMub3V0cHV0ID0gbnVsbDsKICAgIHRoaXMub3ZlcnByaW50ID0gbnVsbDsKICAgIHRoaXMucGFnaW5hdGlvbiA9IG51bGw7CiAgICB0aGlzLnBhZ2luYXRpb25PdmVycmlkZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRlID0gbnVsbDsKICAgIHRoaXMueGRwID0gbnVsbDsKICAgIHRoaXMuZHJpdmVyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmxhYmVsUHJpbnRlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wY2wgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGRmID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1Ym1pdFVybCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy53ZWJDbGllbnQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuenBsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFByaW50IGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByaW50Iik7CiAgfQp9CmNsYXNzIFByaW50SGlnaFF1YWxpdHkgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicHJpbnRIaWdoUXVhbGl0eSIpOwogIH0KfQpjbGFzcyBQcmludFNjYWxpbmcgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByaW50U2NhbGluZyIsIFsiYXBwZGVmYXVsdCIsICJub1NjYWxpbmciXSk7CiAgfQp9CmNsYXNzIFByaW50ZXJOYW1lIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcmludGVyTmFtZSIpOwogIH0KfQpjbGFzcyBQcm9kdWNlciBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicHJvZHVjZXIiKTsKICB9Cn0KY2xhc3MgUHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBzIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLmJhdGNoT3V0cHV0ID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy5qb2cgPSBudWxsOwogICAgdGhpcy5tZWRpdW1JbmZvID0gbnVsbDsKICAgIHRoaXMub3V0cHV0QmluID0gbnVsbDsKICAgIHRoaXMuc3RhcGxlID0gbnVsbDsKICAgIHRoaXMueGRjID0gbnVsbDsKICB9Cn0KY2xhc3MgUmFuZ2UgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJyYW5nZSIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF0uc3BsaXQoIiwiLCAyKS5tYXAocmFuZ2UgPT4gcmFuZ2Uuc3BsaXQoIi0iKS5tYXAoeCA9PiBwYXJzZUludCh4LnRyaW0oKSwgMTApKSkuZmlsdGVyKHJhbmdlID0+IHJhbmdlLmV2ZXJ5KHggPT4gIWlzTmFOKHgpKSkubWFwKHJhbmdlID0+IHsKICAgICAgaWYgKHJhbmdlLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHJhbmdlLnB1c2gocmFuZ2VbMF0pOwogICAgICB9CiAgICAgIHJldHVybiByYW5nZTsKICAgIH0pOwogIH0KfQpjbGFzcyBSZWNvcmQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJyZWNvcmQiKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgIGNvbnN0IG4gPSBwYXJzZUludCh0aGlzWyRjb250ZW50XSwgMTApOwogICAgaWYgKCFpc05hTihuKSAmJiBuID49IDApIHsKICAgICAgdGhpc1skY29udGVudF0gPSBuOwogICAgfQogIH0KfQpjbGFzcyBSZWxldmFudCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInJlbGV2YW50Iik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pOwogIH0KfQpjbGFzcyBSZW5hbWUgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJyZW5hbWUiKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgIGlmICh0aGlzWyRjb250ZW50XS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoInhtbCIpIHx8IG5ldyBSZWdFeHAoIltcXHB7TH1fXVtcXHB7TH1cXGQuX1xccHtNfS1dKiIsICJ1IikudGVzdCh0aGlzWyRjb250ZW50XSkpIHsKICAgICAgd2FybigiWEZBIC0gUmVuYW1lOiBpbnZhbGlkIFhGQSBuYW1lIik7CiAgICB9CiAgfQp9CmNsYXNzIFJlbmRlclBvbGljeSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicmVuZGVyUG9saWN5IiwgWyJzZXJ2ZXIiLCAiY2xpZW50Il0pOwogIH0KfQpjbGFzcyBSdW5TY3JpcHRzIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJydW5TY3JpcHRzIiwgWyJib3RoIiwgImNsaWVudCIsICJub25lIiwgInNlcnZlciJdKTsKICB9Cn0KY2xhc3MgY29uZmlnX1NjcmlwdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic2NyaXB0IiwgdHJ1ZSk7CiAgICB0aGlzLmN1cnJlbnRQYWdlID0gbnVsbDsKICAgIHRoaXMuZXhjbHVkZSA9IG51bGw7CiAgICB0aGlzLnJ1blNjcmlwdHMgPSBudWxsOwogIH0KfQpjbGFzcyBTY3JpcHRNb2RlbCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic2NyaXB0TW9kZWwiLCBbIlhGQSIsICJub25lIl0pOwogIH0KfQpjbGFzcyBTZXZlcml0eSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic2V2ZXJpdHkiLCBbImlnbm9yZSIsICJlcnJvciIsICJpbmZvcm1hdGlvbiIsICJ0cmFjZSIsICJ3YXJuaW5nIl0pOwogIH0KfQpjbGFzcyBTaWxlbnRQcmludCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic2lsZW50UHJpbnQiLCB0cnVlKTsKICAgIHRoaXMuYWRkU2lsZW50UHJpbnQgPSBudWxsOwogICAgdGhpcy5wcmludGVyTmFtZSA9IG51bGw7CiAgfQp9CmNsYXNzIFN0YXBsZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3RhcGxlIik7CiAgICB0aGlzLm1vZGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5tb2RlLCBbInVzZVByaW50ZXJTZXR0aW5nIiwgIm9uIiwgIm9mZiJdKTsKICB9Cn0KY2xhc3MgU3RhcnROb2RlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdGFydE5vZGUiKTsKICB9Cn0KY2xhc3MgU3RhcnRQYWdlIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3RhcnRQYWdlIiwgMCwgbiA9PiB0cnVlKTsKICB9Cn0KY2xhc3MgU3VibWl0Rm9ybWF0IGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdWJtaXRGb3JtYXQiLCBbImh0bWwiLCAiZGVsZWdhdGUiLCAiZmRmIiwgInhtbCIsICJwZGYiXSk7CiAgfQp9CmNsYXNzIFN1Ym1pdFVybCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3VibWl0VXJsIik7CiAgfQp9CmNsYXNzIFN1YnNldEJlbG93IGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3Vic2V0QmVsb3ciLCAxMDAsIG4gPT4gbiA+PSAwICYmIG4gPD0gMTAwKTsKICB9Cn0KY2xhc3MgU3VwcHJlc3NCYW5uZXIgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3VwcHJlc3NCYW5uZXIiKTsKICB9Cn0KY2xhc3MgVGFnZ2VkIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRhZ2dlZCIpOwogIH0KfQpjbGFzcyBjb25maWdfVGVtcGxhdGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRlbXBsYXRlIiwgdHJ1ZSk7CiAgICB0aGlzLmJhc2UgPSBudWxsOwogICAgdGhpcy5yZWxldmFudCA9IG51bGw7CiAgICB0aGlzLnN0YXJ0UGFnZSA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgICB0aGlzLnhzbCA9IG51bGw7CiAgfQp9CmNsYXNzIFRocmVzaG9sZCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidGhyZXNob2xkIiwgWyJ0cmFjZSIsICJlcnJvciIsICJpbmZvcm1hdGlvbiIsICJ3YXJuaW5nIl0pOwogIH0KfQpjbGFzcyBUbyBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidG8iLCBbIm51bGwiLCAibWVtb3J5IiwgInN0ZGVyciIsICJzdGRvdXQiLCAic3lzdGVtIiwgInVyaSJdKTsKICB9Cn0KY2xhc3MgVGVtcGxhdGVDYWNoZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidGVtcGxhdGVDYWNoZSIpOwogICAgdGhpcy5tYXhFbnRyaWVzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubWF4RW50cmllcywKICAgICAgZGVmYXVsdFZhbHVlOiA1LAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDAKICAgIH0pOwogIH0KfQpjbGFzcyBUcmFjZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidHJhY2UiLCB0cnVlKTsKICAgIHRoaXMuYXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBUcmFuc2Zvcm0gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRyYW5zZm9ybSIsIHRydWUpOwogICAgdGhpcy5ncm91cFBhcmVudCA9IG51bGw7CiAgICB0aGlzLmlmRW1wdHkgPSBudWxsOwogICAgdGhpcy5uYW1lQXR0ciA9IG51bGw7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogICAgdGhpcy5wcmVzZW5jZSA9IG51bGw7CiAgICB0aGlzLnJlbmFtZSA9IG51bGw7CiAgICB0aGlzLndoaXRlc3BhY2UgPSBudWxsOwogIH0KfQpjbGFzcyBUeXBlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ0eXBlIiwgWyJub25lIiwgImFzY2lpODUiLCAiYXNjaWlIZXgiLCAiY2NpdHRmYXgiLCAiZmxhdGUiLCAibHp3IiwgInJ1bkxlbmd0aCIsICJuYXRpdmUiLCAieGRwIiwgIm1lcmdlZFhEUCJdKTsKICB9Cn0KY2xhc3MgVXJpIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ1cmkiKTsKICB9Cn0KY2xhc3MgY29uZmlnX1ZhbGlkYXRlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0ZSIsIFsicHJlU3VibWl0IiwgInByZVByaW50IiwgInByZUV4ZWN1dGUiLCAicHJlU2F2ZSJdKTsKICB9Cn0KY2xhc3MgVmFsaWRhdGVBcHByb3ZhbFNpZ25hdHVyZXMgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF0udHJpbSgpLnNwbGl0KC9ccysvKS5maWx0ZXIoeCA9PiBbImRvY1JlYWR5IiwgInBvc3RTaWduIl0uaW5jbHVkZXMoeCkpOwogIH0KfQpjbGFzcyBWYWxpZGF0aW9uTWVzc2FnaW5nIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0aW9uTWVzc2FnaW5nIiwgWyJhbGxNZXNzYWdlc0luZGl2aWR1YWxseSIsICJhbGxNZXNzYWdlc1RvZ2V0aGVyIiwgImZpcnN0TWVzc2FnZU9ubHkiLCAibm9NZXNzYWdlcyJdKTsKICB9Cn0KY2xhc3MgVmVyc2lvbiBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmVyc2lvbiIsIFsiMS43IiwgIjEuNiIsICIxLjUiLCAiMS40IiwgIjEuMyIsICIxLjIiXSk7CiAgfQp9CmNsYXNzIFZlcnNpb25Db250cm9sIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJWZXJzaW9uQ29udHJvbCIpOwogICAgdGhpcy5vdXRwdXRCZWxvdyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm91dHB1dEJlbG93LCBbIndhcm4iLCAiZXJyb3IiLCAidXBkYXRlIl0pOwogICAgdGhpcy5zb3VyY2VBYm92ZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnNvdXJjZUFib3ZlLCBbIndhcm4iLCAiZXJyb3IiXSk7CiAgICB0aGlzLnNvdXJjZUJlbG93ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc291cmNlQmVsb3csIFsidXBkYXRlIiwgIm1haW50YWluIl0pOwogIH0KfQpjbGFzcyBWaWV3ZXJQcmVmZXJlbmNlcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmlld2VyUHJlZmVyZW5jZXMiLCB0cnVlKTsKICAgIHRoaXMuQURCRV9KU0NvbnNvbGUgPSBudWxsOwogICAgdGhpcy5BREJFX0pTRGVidWdnZXIgPSBudWxsOwogICAgdGhpcy5hZGRWaWV3ZXJQcmVmZXJlbmNlcyA9IG51bGw7CiAgICB0aGlzLmR1cGxleE9wdGlvbiA9IG51bGw7CiAgICB0aGlzLmVuZm9yY2UgPSBudWxsOwogICAgdGhpcy5udW1iZXJPZkNvcGllcyA9IG51bGw7CiAgICB0aGlzLnBhZ2VSYW5nZSA9IG51bGw7CiAgICB0aGlzLnBpY2tUcmF5QnlQREZTaXplID0gbnVsbDsKICAgIHRoaXMucHJpbnRTY2FsaW5nID0gbnVsbDsKICB9Cn0KY2xhc3MgV2ViQ2xpZW50IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ3ZWJDbGllbnQiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSA/IGF0dHJpYnV0ZXMubmFtZS50cmltKCkgOiAiIjsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBXaGl0ZXNwYWNlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ3aGl0ZXNwYWNlIiwgWyJwcmVzZXJ2ZSIsICJsdHJpbSIsICJub3JtYWxpemUiLCAicnRyaW0iLCAidHJpbSJdKTsKICB9Cn0KY2xhc3MgV2luZG93IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAid2luZG93Iik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgcGFpciA9IHRoaXNbJGNvbnRlbnRdLnNwbGl0KCIsIiwgMikubWFwKHggPT4gcGFyc2VJbnQoeC50cmltKCksIDEwKSk7CiAgICBpZiAocGFpci5zb21lKHggPT4gaXNOYU4oeCkpKSB7CiAgICAgIHRoaXNbJGNvbnRlbnRdID0gWzAsIDBdOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAocGFpci5sZW5ndGggPT09IDEpIHsKICAgICAgcGFpci5wdXNoKHBhaXJbMF0pOwogICAgfQogICAgdGhpc1skY29udGVudF0gPSBwYWlyOwogIH0KfQpjbGFzcyBYZGMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInhkYyIsIHRydWUpOwogICAgdGhpcy51cmkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMueHNsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFhkcCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAieGRwIiwgdHJ1ZSk7CiAgICB0aGlzLnBhY2tldHMgPSBudWxsOwogIH0KfQpjbGFzcyBYc2wgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInhzbCIsIHRydWUpOwogICAgdGhpcy5kZWJ1ZyA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIFpwbCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAienBsIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgPyBhdHRyaWJ1dGVzLm5hbWUudHJpbSgpIDogIiI7CiAgICB0aGlzLmJhdGNoT3V0cHV0ID0gbnVsbDsKICAgIHRoaXMuZmxpcExhYmVsID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBDb25maWdOYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoQ29uZmlnTmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBDb25maWdOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgYWNyb2JhdChhdHRycykgewogICAgcmV0dXJuIG5ldyBBY3JvYmF0KGF0dHJzKTsKICB9CiAgc3RhdGljIGFjcm9iYXQ3KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFjcm9iYXQ3KGF0dHJzKTsKICB9CiAgc3RhdGljIEFEQkVfSlNDb25zb2xlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFEQkVfSlNDb25zb2xlKGF0dHJzKTsKICB9CiAgc3RhdGljIEFEQkVfSlNEZWJ1Z2dlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBBREJFX0pTRGVidWdnZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgYWRkU2lsZW50UHJpbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWRkU2lsZW50UHJpbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgYWRkVmlld2VyUHJlZmVyZW5jZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWRkVmlld2VyUHJlZmVyZW5jZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgYWRqdXN0RGF0YShhdHRycykgewogICAgcmV0dXJuIG5ldyBBZGp1c3REYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIGFkb2JlRXh0ZW5zaW9uTGV2ZWwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWRvYmVFeHRlbnNpb25MZXZlbChhdHRycyk7CiAgfQogIHN0YXRpYyBhZ2VudChhdHRycykgewogICAgcmV0dXJuIG5ldyBBZ2VudChhdHRycyk7CiAgfQogIHN0YXRpYyBhbHdheXNFbWJlZChhdHRycykgewogICAgcmV0dXJuIG5ldyBBbHdheXNFbWJlZChhdHRycyk7CiAgfQogIHN0YXRpYyBhbWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQW1kKGF0dHJzKTsKICB9CiAgc3RhdGljIGFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29uZmlnX0FyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgYXR0cmlidXRlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBBdHRyaWJ1dGVzKGF0dHJzKTsKICB9CiAgc3RhdGljIGF1dG9TYXZlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEF1dG9TYXZlKGF0dHJzKTsKICB9CiAgc3RhdGljIGJhc2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQmFzZShhdHRycyk7CiAgfQogIHN0YXRpYyBiYXRjaE91dHB1dChhdHRycykgewogICAgcmV0dXJuIG5ldyBCYXRjaE91dHB1dChhdHRycyk7CiAgfQogIHN0YXRpYyBiZWhhdmlvck92ZXJyaWRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJlaGF2aW9yT3ZlcnJpZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgY2FjaGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2FjaGUoYXR0cnMpOwogIH0KICBzdGF0aWMgY2hhbmdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENoYW5nZShhdHRycyk7CiAgfQogIHN0YXRpYyBjb21tb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tbW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbXByZXNzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbXByZXNzKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbXByZXNzTG9naWNhbFN0cnVjdHVyZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDb21wcmVzc0xvZ2ljYWxTdHJ1Y3R1cmUoYXR0cnMpOwogIH0KICBzdGF0aWMgY29tcHJlc3NPYmplY3RTdHJlYW0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tcHJlc3NPYmplY3RTdHJlYW0oYXR0cnMpOwogIH0KICBzdGF0aWMgY29tcHJlc3Npb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tcHJlc3Npb24oYXR0cnMpOwogIH0KICBzdGF0aWMgY29uZmlnKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbmZpZyhhdHRycyk7CiAgfQogIHN0YXRpYyBjb25mb3JtYW5jZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDb25mb3JtYW5jZShhdHRycyk7CiAgfQogIHN0YXRpYyBjb250ZW50Q29weShhdHRycykgewogICAgcmV0dXJuIG5ldyBDb250ZW50Q29weShhdHRycyk7CiAgfQogIHN0YXRpYyBjb3BpZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29waWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIGNyZWF0b3IoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ3JlYXRvcihhdHRycyk7CiAgfQogIHN0YXRpYyBjdXJyZW50UGFnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDdXJyZW50UGFnZShhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVidWcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGVidWcoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVmYXVsdFR5cGVmYWNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERlZmF1bHRUeXBlZmFjZShhdHRycyk7CiAgfQogIHN0YXRpYyBkZXN0aW5hdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBEZXN0aW5hdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBkb2N1bWVudEFzc2VtYmx5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERvY3VtZW50QXNzZW1ibHkoYXR0cnMpOwogIH0KICBzdGF0aWMgZHJpdmVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERyaXZlcihhdHRycyk7CiAgfQogIHN0YXRpYyBkdXBsZXhPcHRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRHVwbGV4T3B0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGR5bmFtaWNSZW5kZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRHluYW1pY1JlbmRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBlbWJlZChhdHRycykgewogICAgcmV0dXJuIG5ldyBFbWJlZChhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19FbmNyeXB0KGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29uZmlnX0VuY3J5cHRpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdGlvbkxldmVsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY3J5cHRpb25MZXZlbChhdHRycyk7CiAgfQogIHN0YXRpYyBlbmZvcmNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuZm9yY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZXF1YXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVxdWF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyBlcXVhdGVSYW5nZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFcXVhdGVSYW5nZShhdHRycyk7CiAgfQogIHN0YXRpYyBleGNsdWRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEV4Y2x1ZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgZXhjbHVkZU5TKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEV4Y2x1ZGVOUyhhdHRycyk7CiAgfQogIHN0YXRpYyBmbGlwTGFiZWwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmxpcExhYmVsKGF0dHJzKTsKICB9CiAgc3RhdGljIGZvbnRJbmZvKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19Gb250SW5mbyhhdHRycyk7CiAgfQogIHN0YXRpYyBmb3JtRmllbGRGaWxsaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEZvcm1GaWVsZEZpbGxpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgZ3JvdXBQYXJlbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgR3JvdXBQYXJlbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgaWZFbXB0eShhdHRycykgewogICAgcmV0dXJuIG5ldyBJZkVtcHR5KGF0dHJzKTsKICB9CiAgc3RhdGljIGluY2x1ZGVYRFBDb250ZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEluY2x1ZGVYRFBDb250ZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGluY3JlbWVudGFsTG9hZChhdHRycykgewogICAgcmV0dXJuIG5ldyBJbmNyZW1lbnRhbExvYWQoYXR0cnMpOwogIH0KICBzdGF0aWMgaW5jcmVtZW50YWxNZXJnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBJbmNyZW1lbnRhbE1lcmdlKGF0dHJzKTsKICB9CiAgc3RhdGljIGludGVyYWN0aXZlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEludGVyYWN0aXZlKGF0dHJzKTsKICB9CiAgc3RhdGljIGpvZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBKb2coYXR0cnMpOwogIH0KICBzdGF0aWMgbGFiZWxQcmludGVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExhYmVsUHJpbnRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBsYXlvdXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTGF5b3V0KGF0dHJzKTsKICB9CiAgc3RhdGljIGxldmVsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExldmVsKGF0dHJzKTsKICB9CiAgc3RhdGljIGxpbmVhcml6ZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTGluZWFyaXplZChhdHRycyk7CiAgfQogIHN0YXRpYyBsb2NhbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTG9jYWxlKGF0dHJzKTsKICB9CiAgc3RhdGljIGxvY2FsZVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBMb2NhbGVTZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExvZyhhdHRycyk7CiAgfQogIHN0YXRpYyBtYXAoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWFwRWxlbWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBtZWRpdW1JbmZvKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lZGl1bUluZm8oYXR0cnMpOwogIH0KICBzdGF0aWMgbWVzc2FnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfTWVzc2FnZShhdHRycyk7CiAgfQogIHN0YXRpYyBtZXNzYWdpbmcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWVzc2FnaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIG1vZGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9kZShhdHRycyk7CiAgfQogIHN0YXRpYyBtb2RpZnlBbm5vdHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9kaWZ5QW5ub3RzKGF0dHJzKTsKICB9CiAgc3RhdGljIG1zZ0lkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1zZ0lkKGF0dHJzKTsKICB9CiAgc3RhdGljIG5hbWVBdHRyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE5hbWVBdHRyKGF0dHJzKTsKICB9CiAgc3RhdGljIG5ldmVyRW1iZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTmV2ZXJFbWJlZChhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJPZkNvcGllcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBOdW1iZXJPZkNvcGllcyhhdHRycyk7CiAgfQogIHN0YXRpYyBvcGVuQWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9wZW5BY3Rpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgb3V0cHV0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE91dHB1dChhdHRycyk7CiAgfQogIHN0YXRpYyBvdXRwdXRCaW4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3V0cHV0QmluKGF0dHJzKTsKICB9CiAgc3RhdGljIG91dHB1dFhTTChhdHRycykgewogICAgcmV0dXJuIG5ldyBPdXRwdXRYU0woYXR0cnMpOwogIH0KICBzdGF0aWMgb3ZlcnByaW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE92ZXJwcmludChhdHRycyk7CiAgfQogIHN0YXRpYyBwYWNrZXRzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBhY2tldHMoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZU9mZnNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlT2Zmc2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2VSYW5nZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlUmFuZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnaW5hdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdpbmF0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2luYXRpb25PdmVycmlkZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdpbmF0aW9uT3ZlcnJpZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFydChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYXJ0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBjbChhdHRycykgewogICAgcmV0dXJuIG5ldyBQY2woYXR0cnMpOwogIH0KICBzdGF0aWMgcGRmKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBkZihhdHRycyk7CiAgfQogIHN0YXRpYyBwZGZhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBkZmEoYXR0cnMpOwogIH0KICBzdGF0aWMgcGVybWlzc2lvbnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGVybWlzc2lvbnMoYXR0cnMpOwogIH0KICBzdGF0aWMgcGlja1RyYXlCeVBERlNpemUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGlja1RyYXlCeVBERlNpemUoYXR0cnMpOwogIH0KICBzdGF0aWMgcGljdHVyZShhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfUGljdHVyZShhdHRycyk7CiAgfQogIHN0YXRpYyBwbGFpbnRleHRNZXRhZGF0YShhdHRycykgewogICAgcmV0dXJuIG5ldyBQbGFpbnRleHRNZXRhZGF0YShhdHRycyk7CiAgfQogIHN0YXRpYyBwcmVzZW5jZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmVzZW5jZShhdHRycyk7CiAgfQogIHN0YXRpYyBwcmVzZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByZXNlbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJpbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJpbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJpbnRIaWdoUXVhbGl0eShhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmludEhpZ2hRdWFsaXR5KGF0dHJzKTsKICB9CiAgc3RhdGljIHByaW50U2NhbGluZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmludFNjYWxpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJpbnRlck5hbWUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJpbnRlck5hbWUoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJvZHVjZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJvZHVjZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgcHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHMoYXR0cnMpOwogIH0KICBzdGF0aWMgcmFuZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmFuZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgcmVjb3JkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJlY29yZChhdHRycyk7CiAgfQogIHN0YXRpYyByZWxldmFudChhdHRycykgewogICAgcmV0dXJuIG5ldyBSZWxldmFudChhdHRycyk7CiAgfQogIHN0YXRpYyByZW5hbWUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVuYW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlbmRlclBvbGljeShhdHRycykgewogICAgcmV0dXJuIG5ldyBSZW5kZXJQb2xpY3koYXR0cnMpOwogIH0KICBzdGF0aWMgcnVuU2NyaXB0cyhhdHRycykgewogICAgcmV0dXJuIG5ldyBSdW5TY3JpcHRzKGF0dHJzKTsKICB9CiAgc3RhdGljIHNjcmlwdChhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfU2NyaXB0KGF0dHJzKTsKICB9CiAgc3RhdGljIHNjcmlwdE1vZGVsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNjcmlwdE1vZGVsKGF0dHJzKTsKICB9CiAgc3RhdGljIHNldmVyaXR5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNldmVyaXR5KGF0dHJzKTsKICB9CiAgc3RhdGljIHNpbGVudFByaW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpbGVudFByaW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHN0YXBsZShhdHRycykgewogICAgcmV0dXJuIG5ldyBTdGFwbGUoYXR0cnMpOwogIH0KICBzdGF0aWMgc3RhcnROb2RlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN0YXJ0Tm9kZShhdHRycyk7CiAgfQogIHN0YXRpYyBzdGFydFBhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3RhcnRQYWdlKGF0dHJzKTsKICB9CiAgc3RhdGljIHN1Ym1pdEZvcm1hdChhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJtaXRGb3JtYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgc3VibWl0VXJsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1Ym1pdFVybChhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJzZXRCZWxvdyhhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJzZXRCZWxvdyhhdHRycyk7CiAgfQogIHN0YXRpYyBzdXBwcmVzc0Jhbm5lcihhdHRycykgewogICAgcmV0dXJuIG5ldyBTdXBwcmVzc0Jhbm5lcihhdHRycyk7CiAgfQogIHN0YXRpYyB0YWdnZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGFnZ2VkKGF0dHJzKTsKICB9CiAgc3RhdGljIHRlbXBsYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19UZW1wbGF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyB0ZW1wbGF0ZUNhY2hlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRlbXBsYXRlQ2FjaGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdGhyZXNob2xkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRocmVzaG9sZChhdHRycyk7CiAgfQogIHN0YXRpYyB0byhhdHRycykgewogICAgcmV0dXJuIG5ldyBUbyhhdHRycyk7CiAgfQogIHN0YXRpYyB0cmFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUcmFjZShhdHRycyk7CiAgfQogIHN0YXRpYyB0cmFuc2Zvcm0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHJhbnNmb3JtKGF0dHJzKTsKICB9CiAgc3RhdGljIHR5cGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHlwZShhdHRycyk7CiAgfQogIHN0YXRpYyB1cmkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVXJpKGF0dHJzKTsKICB9CiAgc3RhdGljIHZhbGlkYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19WYWxpZGF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyB2YWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBWYWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyhhdHRycyk7CiAgfQogIHN0YXRpYyB2YWxpZGF0aW9uTWVzc2FnaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25NZXNzYWdpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgdmVyc2lvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBWZXJzaW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHZlcnNpb25Db250cm9sKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZlcnNpb25Db250cm9sKGF0dHJzKTsKICB9CiAgc3RhdGljIHZpZXdlclByZWZlcmVuY2VzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZpZXdlclByZWZlcmVuY2VzKGF0dHJzKTsKICB9CiAgc3RhdGljIHdlYkNsaWVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBXZWJDbGllbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgd2hpdGVzcGFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBXaGl0ZXNwYWNlKGF0dHJzKTsKICB9CiAgc3RhdGljIHdpbmRvdyhhdHRycykgewogICAgcmV0dXJuIG5ldyBXaW5kb3coYXR0cnMpOwogIH0KICBzdGF0aWMgeGRjKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFhkYyhhdHRycyk7CiAgfQogIHN0YXRpYyB4ZHAoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgWGRwKGF0dHJzKTsKICB9CiAgc3RhdGljIHhzbChhdHRycykgewogICAgcmV0dXJuIG5ldyBYc2woYXR0cnMpOwogIH0KICBzdGF0aWMgenBsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFpwbChhdHRycyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvY29ubmVjdGlvbl9zZXQuanMKCgpjb25zdCBDT05ORUNUSU9OX1NFVF9OU19JRCA9IE5hbWVzcGFjZUlkcy5jb25uZWN0aW9uU2V0LmlkOwpjbGFzcyBDb25uZWN0aW9uU2V0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgImNvbm5lY3Rpb25TZXQiLCB0cnVlKTsKICAgIHRoaXMud3NkbENvbm5lY3Rpb24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMueG1sQ29ubmVjdGlvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy54c2RDb25uZWN0aW9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEVmZmVjdGl2ZUlucHV0UG9saWN5IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgImVmZmVjdGl2ZUlucHV0UG9saWN5Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEVmZmVjdGl2ZU91dHB1dFBvbGljeSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJlZmZlY3RpdmVPdXRwdXRQb2xpY3kiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgT3BlcmF0aW9uIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgIm9wZXJhdGlvbiIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmlucHV0ID0gYXR0cmlidXRlcy5pbnB1dCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMub3V0cHV0ID0gYXR0cmlidXRlcy5vdXRwdXQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBSb290RWxlbWVudCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJyb290RWxlbWVudCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBTb2FwQWN0aW9uIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgInNvYXBBY3Rpb24iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgU29hcEFkZHJlc3MgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAic29hcEFkZHJlc3MiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgY29ubmVjdGlvbl9zZXRfVXJpIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgInVyaSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBXc2RsQWRkcmVzcyBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJ3c2RsQWRkcmVzcyIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBXc2RsQ29ubmVjdGlvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJ3c2RsQ29ubmVjdGlvbiIsIHRydWUpOwogICAgdGhpcy5kYXRhRGVzY3JpcHRpb24gPSBhdHRyaWJ1dGVzLmRhdGFEZXNjcmlwdGlvbiB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMuZWZmZWN0aXZlSW5wdXRQb2xpY3kgPSBudWxsOwogICAgdGhpcy5lZmZlY3RpdmVPdXRwdXRQb2xpY3kgPSBudWxsOwogICAgdGhpcy5vcGVyYXRpb24gPSBudWxsOwogICAgdGhpcy5zb2FwQWN0aW9uID0gbnVsbDsKICAgIHRoaXMuc29hcEFkZHJlc3MgPSBudWxsOwogICAgdGhpcy53c2RsQWRkcmVzcyA9IG51bGw7CiAgfQp9CmNsYXNzIFhtbENvbm5lY3Rpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAieG1sQ29ubmVjdGlvbiIsIHRydWUpOwogICAgdGhpcy5kYXRhRGVzY3JpcHRpb24gPSBhdHRyaWJ1dGVzLmRhdGFEZXNjcmlwdGlvbiB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgWHNkQ29ubmVjdGlvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJ4c2RDb25uZWN0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGFEZXNjcmlwdGlvbiA9IGF0dHJpYnV0ZXMuZGF0YURlc2NyaXB0aW9uIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yb290RWxlbWVudCA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIENvbm5lY3Rpb25TZXROYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoQ29ubmVjdGlvblNldE5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gQ29ubmVjdGlvblNldE5hbWVzcGFjZVtuYW1lXShhdHRyaWJ1dGVzKTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIHN0YXRpYyBjb25uZWN0aW9uU2V0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbm5lY3Rpb25TZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgZWZmZWN0aXZlSW5wdXRQb2xpY3koYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRWZmZWN0aXZlSW5wdXRQb2xpY3koYXR0cnMpOwogIH0KICBzdGF0aWMgZWZmZWN0aXZlT3V0cHV0UG9saWN5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVmZmVjdGl2ZU91dHB1dFBvbGljeShhdHRycyk7CiAgfQogIHN0YXRpYyBvcGVyYXRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3BlcmF0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHJvb3RFbGVtZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJvb3RFbGVtZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHNvYXBBY3Rpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU29hcEFjdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBzb2FwQWRkcmVzcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBTb2FwQWRkcmVzcyhhdHRycyk7CiAgfQogIHN0YXRpYyB1cmkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29ubmVjdGlvbl9zZXRfVXJpKGF0dHJzKTsKICB9CiAgc3RhdGljIHdzZGxBZGRyZXNzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFdzZGxBZGRyZXNzKGF0dHJzKTsKICB9CiAgc3RhdGljIHdzZGxDb25uZWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFdzZGxDb25uZWN0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHhtbENvbm5lY3Rpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgWG1sQ29ubmVjdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyB4c2RDb25uZWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFhzZENvbm5lY3Rpb24oYXR0cnMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2RhdGFzZXRzLmpzCgoKCmNvbnN0IERBVEFTRVRTX05TX0lEID0gTmFtZXNwYWNlSWRzLmRhdGFzZXRzLmlkOwpjbGFzcyBkYXRhc2V0c19EYXRhIGV4dGVuZHMgWG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihEQVRBU0VUU19OU19JRCwgImRhdGEiLCBhdHRyaWJ1dGVzKTsKICB9CiAgWyRpc05zQWdub3N0aWNdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIERhdGFzZXRzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihEQVRBU0VUU19OU19JRCwgImRhdGFzZXRzIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGEgPSBudWxsOwogICAgdGhpcy5TaWduYXR1cmUgPSBudWxsOwogIH0KICBbJG9uQ2hpbGRdKGNoaWxkKSB7CiAgICBjb25zdCBuYW1lID0gY2hpbGRbJG5vZGVOYW1lXTsKICAgIGlmIChuYW1lID09PSAiZGF0YSIgJiYgY2hpbGRbJG5hbWVzcGFjZUlkXSA9PT0gREFUQVNFVFNfTlNfSUQgfHwgbmFtZSA9PT0gIlNpZ25hdHVyZSIgJiYgY2hpbGRbJG5hbWVzcGFjZUlkXSA9PT0gTmFtZXNwYWNlSWRzLnNpZ25hdHVyZS5pZCkgewogICAgICB0aGlzW25hbWVdID0gY2hpbGQ7CiAgICB9CiAgICB0aGlzWyRhcHBlbmRDaGlsZF0oY2hpbGQpOwogIH0KfQpjbGFzcyBEYXRhc2V0c05hbWVzcGFjZSB7CiAgc3RhdGljIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChEYXRhc2V0c05hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gRGF0YXNldHNOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgZGF0YXNldHMoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBEYXRhc2V0cyhhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGRhdGEoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBkYXRhc2V0c19EYXRhKGF0dHJpYnV0ZXMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2xvY2FsZV9zZXQuanMKCgoKY29uc3QgTE9DQUxFX1NFVF9OU19JRCA9IE5hbWVzcGFjZUlkcy5sb2NhbGVTZXQuaWQ7CmNsYXNzIENhbGVuZGFyU3ltYm9scyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImNhbGVuZGFyU3ltYm9scyIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gImdyZWdvcmlhbiI7CiAgICB0aGlzLmRheU5hbWVzID0gbmV3IFhGQU9iamVjdEFycmF5KDIpOwogICAgdGhpcy5lcmFOYW1lcyA9IG51bGw7CiAgICB0aGlzLm1lcmlkaWVtTmFtZXMgPSBudWxsOwogICAgdGhpcy5tb250aE5hbWVzID0gbmV3IFhGQU9iamVjdEFycmF5KDIpOwogIH0KfQpjbGFzcyBDdXJyZW5jeVN5bWJvbCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImN1cnJlbmN5U3ltYm9sIik7CiAgICB0aGlzLm5hbWUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5uYW1lLCBbInN5bWJvbCIsICJpc29uYW1lIiwgImRlY2ltYWwiXSk7CiAgfQp9CmNsYXNzIEN1cnJlbmN5U3ltYm9scyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImN1cnJlbmN5U3ltYm9scyIsIHRydWUpOwogICAgdGhpcy5jdXJyZW5jeVN5bWJvbCA9IG5ldyBYRkFPYmplY3RBcnJheSgzKTsKICB9Cn0KY2xhc3MgRGF0ZVBhdHRlcm4gZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlUGF0dGVybiIpOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyJmdWxsIiwgImxvbmciLCAibWVkIiwgInNob3J0Il0pOwogIH0KfQpjbGFzcyBEYXRlUGF0dGVybnMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlUGF0dGVybnMiLCB0cnVlKTsKICAgIHRoaXMuZGF0ZVBhdHRlcm4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoNCk7CiAgfQp9CmNsYXNzIERhdGVUaW1lU3ltYm9scyBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlVGltZVN5bWJvbHMiKTsKICB9Cn0KY2xhc3MgRGF5IGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF5Iik7CiAgfQp9CmNsYXNzIERheU5hbWVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF5TmFtZXMiLCB0cnVlKTsKICAgIHRoaXMuYWJiciA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmFiYnIsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmRheSA9IG5ldyBYRkFPYmplY3RBcnJheSg3KTsKICB9Cn0KY2xhc3MgRXJhIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZXJhIik7CiAgfQp9CmNsYXNzIEVyYU5hbWVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZXJhTmFtZXMiLCB0cnVlKTsKICAgIHRoaXMuZXJhID0gbmV3IFhGQU9iamVjdEFycmF5KDIpOwogIH0KfQpjbGFzcyBsb2NhbGVfc2V0X0xvY2FsZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImxvY2FsZSIsIHRydWUpOwogICAgdGhpcy5kZXNjID0gYXR0cmlidXRlcy5kZXNjIHx8ICIiOwogICAgdGhpcy5uYW1lID0gImlzb25hbWUiOwogICAgdGhpcy5jYWxlbmRhclN5bWJvbHMgPSBudWxsOwogICAgdGhpcy5jdXJyZW5jeVN5bWJvbHMgPSBudWxsOwogICAgdGhpcy5kYXRlUGF0dGVybnMgPSBudWxsOwogICAgdGhpcy5kYXRlVGltZVN5bWJvbHMgPSBudWxsOwogICAgdGhpcy5udW1iZXJQYXR0ZXJucyA9IG51bGw7CiAgICB0aGlzLm51bWJlclN5bWJvbHMgPSBudWxsOwogICAgdGhpcy50aW1lUGF0dGVybnMgPSBudWxsOwogICAgdGhpcy50eXBlRmFjZXMgPSBudWxsOwogIH0KfQpjbGFzcyBsb2NhbGVfc2V0X0xvY2FsZVNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImxvY2FsZVNldCIsIHRydWUpOwogICAgdGhpcy5sb2NhbGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgTWVyaWRpZW0gZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJtZXJpZGllbSIpOwogIH0KfQpjbGFzcyBNZXJpZGllbU5hbWVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibWVyaWRpZW1OYW1lcyIsIHRydWUpOwogICAgdGhpcy5tZXJpZGllbSA9IG5ldyBYRkFPYmplY3RBcnJheSgyKTsKICB9Cn0KY2xhc3MgTW9udGggZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJtb250aCIpOwogIH0KfQpjbGFzcyBNb250aE5hbWVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibW9udGhOYW1lcyIsIHRydWUpOwogICAgdGhpcy5hYmJyID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuYWJiciwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMubW9udGggPSBuZXcgWEZBT2JqZWN0QXJyYXkoMTIpOwogIH0KfQpjbGFzcyBOdW1iZXJQYXR0ZXJuIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibnVtYmVyUGF0dGVybiIpOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyJmdWxsIiwgImxvbmciLCAibWVkIiwgInNob3J0Il0pOwogIH0KfQpjbGFzcyBOdW1iZXJQYXR0ZXJucyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm51bWJlclBhdHRlcm5zIiwgdHJ1ZSk7CiAgICB0aGlzLm51bWJlclBhdHRlcm4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoNCk7CiAgfQp9CmNsYXNzIE51bWJlclN5bWJvbCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm51bWJlclN5bWJvbCIpOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyJkZWNpbWFsIiwgImdyb3VwaW5nIiwgInBlcmNlbnQiLCAibWludXMiLCAiemVybyJdKTsKICB9Cn0KY2xhc3MgTnVtYmVyU3ltYm9scyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm51bWJlclN5bWJvbHMiLCB0cnVlKTsKICAgIHRoaXMubnVtYmVyU3ltYm9sID0gbmV3IFhGQU9iamVjdEFycmF5KDUpOwogIH0KfQpjbGFzcyBUaW1lUGF0dGVybiBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgInRpbWVQYXR0ZXJuIik7CiAgICB0aGlzLm5hbWUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5uYW1lLCBbImZ1bGwiLCAibG9uZyIsICJtZWQiLCAic2hvcnQiXSk7CiAgfQp9CmNsYXNzIFRpbWVQYXR0ZXJucyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgInRpbWVQYXR0ZXJucyIsIHRydWUpOwogICAgdGhpcy50aW1lUGF0dGVybiA9IG5ldyBYRkFPYmplY3RBcnJheSg0KTsKICB9Cn0KY2xhc3MgVHlwZUZhY2UgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJ0eXBlRmFjZSIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHwgIiI7CiAgfQp9CmNsYXNzIFR5cGVGYWNlcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgInR5cGVGYWNlcyIsIHRydWUpOwogICAgdGhpcy50eXBlRmFjZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBMb2NhbGVTZXROYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoTG9jYWxlU2V0TmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBMb2NhbGVTZXROYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgY2FsZW5kYXJTeW1ib2xzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENhbGVuZGFyU3ltYm9scyhhdHRycyk7CiAgfQogIHN0YXRpYyBjdXJyZW5jeVN5bWJvbChhdHRycykgewogICAgcmV0dXJuIG5ldyBDdXJyZW5jeVN5bWJvbChhdHRycyk7CiAgfQogIHN0YXRpYyBjdXJyZW5jeVN5bWJvbHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ3VycmVuY3lTeW1ib2xzKGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVQYXR0ZXJuKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVQYXR0ZXJuKGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVQYXR0ZXJucyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlUGF0dGVybnMoYXR0cnMpOwogIH0KICBzdGF0aWMgZGF0ZVRpbWVTeW1ib2xzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVUaW1lU3ltYm9scyhhdHRycyk7CiAgfQogIHN0YXRpYyBkYXkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGF5KGF0dHJzKTsKICB9CiAgc3RhdGljIGRheU5hbWVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERheU5hbWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIGVyYShhdHRycykgewogICAgcmV0dXJuIG5ldyBFcmEoYXR0cnMpOwogIH0KICBzdGF0aWMgZXJhTmFtZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXJhTmFtZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9jYWxlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGxvY2FsZV9zZXRfTG9jYWxlKGF0dHJzKTsKICB9CiAgc3RhdGljIGxvY2FsZVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBsb2NhbGVfc2V0X0xvY2FsZVNldChhdHRycyk7CiAgfQogIHN0YXRpYyBtZXJpZGllbShhdHRycykgewogICAgcmV0dXJuIG5ldyBNZXJpZGllbShhdHRycyk7CiAgfQogIHN0YXRpYyBtZXJpZGllbU5hbWVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lcmlkaWVtTmFtZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgbW9udGgoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9udGgoYXR0cnMpOwogIH0KICBzdGF0aWMgbW9udGhOYW1lcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBNb250aE5hbWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIG51bWJlclBhdHRlcm4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyUGF0dGVybihhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJQYXR0ZXJucyhhdHRycykgewogICAgcmV0dXJuIG5ldyBOdW1iZXJQYXR0ZXJucyhhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJTeW1ib2woYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyU3ltYm9sKGF0dHJzKTsKICB9CiAgc3RhdGljIG51bWJlclN5bWJvbHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyU3ltYm9scyhhdHRycyk7CiAgfQogIHN0YXRpYyB0aW1lUGF0dGVybihhdHRycykgewogICAgcmV0dXJuIG5ldyBUaW1lUGF0dGVybihhdHRycyk7CiAgfQogIHN0YXRpYyB0aW1lUGF0dGVybnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGltZVBhdHRlcm5zKGF0dHJzKTsKICB9CiAgc3RhdGljIHR5cGVGYWNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFR5cGVGYWNlKGF0dHJzKTsKICB9CiAgc3RhdGljIHR5cGVGYWNlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBUeXBlRmFjZXMoYXR0cnMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3NpZ25hdHVyZS5qcwoKCmNvbnN0IFNJR05BVFVSRV9OU19JRCA9IE5hbWVzcGFjZUlkcy5zaWduYXR1cmUuaWQ7CmNsYXNzIHNpZ25hdHVyZV9TaWduYXR1cmUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFNJR05BVFVSRV9OU19JRCwgInNpZ25hdHVyZSIsIHRydWUpOwogIH0KfQpjbGFzcyBTaWduYXR1cmVOYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoU2lnbmF0dXJlTmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBTaWduYXR1cmVOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgc2lnbmF0dXJlKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgc2lnbmF0dXJlX1NpZ25hdHVyZShhdHRyaWJ1dGVzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9zdHlsZXNoZWV0LmpzCgoKY29uc3QgU1RZTEVTSEVFVF9OU19JRCA9IE5hbWVzcGFjZUlkcy5zdHlsZXNoZWV0LmlkOwpjbGFzcyBTdHlsZXNoZWV0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihTVFlMRVNIRUVUX05TX0lELCAic3R5bGVzaGVldCIsIHRydWUpOwogIH0KfQpjbGFzcyBTdHlsZXNoZWV0TmFtZXNwYWNlIHsKICBzdGF0aWMgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKFN0eWxlc2hlZXROYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIFN0eWxlc2hlZXROYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgc3R5bGVzaGVldChhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFN0eWxlc2hlZXQoYXR0cmlidXRlcyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEveGRwLmpzCgoKCmNvbnN0IFhEUF9OU19JRCA9IE5hbWVzcGFjZUlkcy54ZHAuaWQ7CmNsYXNzIHhkcF9YZHAgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFhEUF9OU19JRCwgInhkcCIsIHRydWUpOwogICAgdGhpcy51dWlkID0gYXR0cmlidXRlcy51dWlkIHx8ICIiOwogICAgdGhpcy50aW1lU3RhbXAgPSBhdHRyaWJ1dGVzLnRpbWVTdGFtcCB8fCAiIjsKICAgIHRoaXMuY29uZmlnID0gbnVsbDsKICAgIHRoaXMuY29ubmVjdGlvblNldCA9IG51bGw7CiAgICB0aGlzLmRhdGFzZXRzID0gbnVsbDsKICAgIHRoaXMubG9jYWxlU2V0ID0gbnVsbDsKICAgIHRoaXMuc3R5bGVzaGVldCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZW1wbGF0ZSA9IG51bGw7CiAgfQogIFskb25DaGlsZENoZWNrXShjaGlsZCkgewogICAgY29uc3QgbnMgPSBOYW1lc3BhY2VJZHNbY2hpbGRbJG5vZGVOYW1lXV07CiAgICByZXR1cm4gbnMgJiYgY2hpbGRbJG5hbWVzcGFjZUlkXSA9PT0gbnMuaWQ7CiAgfQp9CmNsYXNzIFhkcE5hbWVzcGFjZSB7CiAgc3RhdGljIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChYZHBOYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIFhkcE5hbWVzcGFjZVtuYW1lXShhdHRyaWJ1dGVzKTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIHN0YXRpYyB4ZHAoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyB4ZHBfWGRwKGF0dHJpYnV0ZXMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3hodG1sLmpzCgoKCgoKY29uc3QgWEhUTUxfTlNfSUQgPSBOYW1lc3BhY2VJZHMueGh0bWwuaWQ7CmNvbnN0ICRyaWNoVGV4dCA9IFN5bWJvbCgpOwpjb25zdCBWQUxJRF9TVFlMRVMgPSBuZXcgU2V0KFsiY29sb3IiLCAiZm9udCIsICJmb250LWZhbWlseSIsICJmb250LXNpemUiLCAiZm9udC1zdHJldGNoIiwgImZvbnQtc3R5bGUiLCAiZm9udC13ZWlnaHQiLCAibWFyZ2luIiwgIm1hcmdpbi1ib3R0b20iLCAibWFyZ2luLWxlZnQiLCAibWFyZ2luLXJpZ2h0IiwgIm1hcmdpbi10b3AiLCAibGV0dGVyLXNwYWNpbmciLCAibGluZS1oZWlnaHQiLCAib3JwaGFucyIsICJwYWdlLWJyZWFrLWFmdGVyIiwgInBhZ2UtYnJlYWstYmVmb3JlIiwgInBhZ2UtYnJlYWstaW5zaWRlIiwgInRhYi1pbnRlcnZhbCIsICJ0YWItc3RvcCIsICJ0ZXh0LWFsaWduIiwgInRleHQtZGVjb3JhdGlvbiIsICJ0ZXh0LWluZGVudCIsICJ2ZXJ0aWNhbC1hbGlnbiIsICJ3aWRvd3MiLCAia2VybmluZy1tb2RlIiwgInhmYS1mb250LWhvcml6b250YWwtc2NhbGUiLCAieGZhLWZvbnQtdmVydGljYWwtc2NhbGUiLCAieGZhLXNwYWNlcnVuIiwgInhmYS10YWItc3RvcHMiXSk7CmNvbnN0IFN0eWxlTWFwcGluZyA9IG5ldyBNYXAoW1sicGFnZS1icmVhay1hZnRlciIsICJicmVha0FmdGVyIl0sIFsicGFnZS1icmVhay1iZWZvcmUiLCAiYnJlYWtCZWZvcmUiXSwgWyJwYWdlLWJyZWFrLWluc2lkZSIsICJicmVha0luc2lkZSJdLCBbImtlcm5pbmctbW9kZSIsIHZhbHVlID0+IHZhbHVlID09PSAibm9uZSIgPyAibm9uZSIgOiAibm9ybWFsIl0sIFsieGZhLWZvbnQtaG9yaXpvbnRhbC1zY2FsZSIsIHZhbHVlID0+IGBzY2FsZVgoJHtNYXRoLm1heCgwLCBwYXJzZUludCh2YWx1ZSkgLyAxMDApLnRvRml4ZWQoMil9KWBdLCBbInhmYS1mb250LXZlcnRpY2FsLXNjYWxlIiwgdmFsdWUgPT4gYHNjYWxlWSgke01hdGgubWF4KDAsIHBhcnNlSW50KHZhbHVlKSAvIDEwMCkudG9GaXhlZCgyKX0pYF0sIFsieGZhLXNwYWNlcnVuIiwgIiJdLCBbInhmYS10YWItc3RvcHMiLCAiIl0sIFsiZm9udC1zaXplIiwgKHZhbHVlLCBvcmlnaW5hbCkgPT4gewogIHZhbHVlID0gb3JpZ2luYWwuZm9udFNpemUgPSBNYXRoLmFicyhnZXRNZWFzdXJlbWVudCh2YWx1ZSkpOwogIHJldHVybiBtZWFzdXJlVG9TdHJpbmcoMC45OSAqIHZhbHVlKTsKfV0sIFsibGV0dGVyLXNwYWNpbmciLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsibGluZS1oZWlnaHQiLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsibWFyZ2luIiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbIm1hcmdpbi1ib3R0b20iLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsibWFyZ2luLWxlZnQiLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsibWFyZ2luLXJpZ2h0IiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbIm1hcmdpbi10b3AiLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsidGV4dC1pbmRlbnQiLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsiZm9udC1mYW1pbHkiLCB2YWx1ZSA9PiB2YWx1ZV0sIFsidmVydGljYWwtYWxpZ24iLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV1dKTsKY29uc3Qgc3BhY2VzUmVnRXhwID0gL1xzKy9nOwpjb25zdCBjcmxmUmVnRXhwID0gL1tcclxuXSsvZzsKY29uc3QgY3JsZkZvclJpY2hUZXh0UmVnRXhwID0gL1xyXG4/L2c7CmZ1bmN0aW9uIG1hcFN0eWxlKHN0eWxlU3RyLCBub2RlLCByaWNoVGV4dCkgewogIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBpZiAoIXN0eWxlU3RyKSB7CiAgICByZXR1cm4gc3R5bGU7CiAgfQogIGNvbnN0IG9yaWdpbmFsID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBzdHlsZVN0ci5zcGxpdCgiOyIpLm1hcChzID0+IHMuc3BsaXQoIjoiLCAyKSkpIHsKICAgIGNvbnN0IG1hcHBpbmcgPSBTdHlsZU1hcHBpbmcuZ2V0KGtleSk7CiAgICBpZiAobWFwcGluZyA9PT0gIiIpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgbmV3VmFsdWUgPSB2YWx1ZTsKICAgIGlmIChtYXBwaW5nKSB7CiAgICAgIG5ld1ZhbHVlID0gdHlwZW9mIG1hcHBpbmcgPT09ICJzdHJpbmciID8gbWFwcGluZyA6IG1hcHBpbmcodmFsdWUsIG9yaWdpbmFsKTsKICAgIH0KICAgIGlmIChrZXkuZW5kc1dpdGgoInNjYWxlIikpIHsKICAgICAgc3R5bGUudHJhbnNmb3JtID0gc3R5bGUudHJhbnNmb3JtID8gYCR7c3R5bGVba2V5XX0gJHtuZXdWYWx1ZX1gIDogbmV3VmFsdWU7CiAgICB9IGVsc2UgewogICAgICBzdHlsZVtrZXkucmVwbGFjZUFsbCgvLShbYS16QS1aXSkvZywgKF8sIHgpID0+IHgudG9VcHBlckNhc2UoKSldID0gbmV3VmFsdWU7CiAgICB9CiAgfQogIGlmIChzdHlsZS5mb250RmFtaWx5KSB7CiAgICBzZXRGb250RmFtaWx5KHsKICAgICAgdHlwZWZhY2U6IHN0eWxlLmZvbnRGYW1pbHksCiAgICAgIHdlaWdodDogc3R5bGUuZm9udFdlaWdodCB8fCAibm9ybWFsIiwKICAgICAgcG9zdHVyZTogc3R5bGUuZm9udFN0eWxlIHx8ICJub3JtYWwiLAogICAgICBzaXplOiBvcmlnaW5hbC5mb250U2l6ZSB8fCAwCiAgICB9LCBub2RlLCBub2RlWyRnbG9iYWxEYXRhXS5mb250RmluZGVyLCBzdHlsZSk7CiAgfQogIGlmIChyaWNoVGV4dCAmJiBzdHlsZS52ZXJ0aWNhbEFsaWduICYmIHN0eWxlLnZlcnRpY2FsQWxpZ24gIT09ICIwcHgiICYmIHN0eWxlLmZvbnRTaXplKSB7CiAgICBjb25zdCBTVUJfU1VQRVJfU0NSSVBUX0ZBQ1RPUiA9IDAuNTgzOwogICAgY29uc3QgVkVSVElDQUxfRkFDVE9SID0gMC4zMzM7CiAgICBjb25zdCBmb250U2l6ZSA9IGdldE1lYXN1cmVtZW50KHN0eWxlLmZvbnRTaXplKTsKICAgIHN0eWxlLmZvbnRTaXplID0gbWVhc3VyZVRvU3RyaW5nKGZvbnRTaXplICogU1VCX1NVUEVSX1NDUklQVF9GQUNUT1IpOwogICAgc3R5bGUudmVydGljYWxBbGlnbiA9IG1lYXN1cmVUb1N0cmluZyhNYXRoLnNpZ24oZ2V0TWVhc3VyZW1lbnQoc3R5bGUudmVydGljYWxBbGlnbikpICogZm9udFNpemUgKiBWRVJUSUNBTF9GQUNUT1IpOwogIH0KICBpZiAocmljaFRleHQgJiYgc3R5bGUuZm9udFNpemUpIHsKICAgIHN0eWxlLmZvbnRTaXplID0gYGNhbGMoJHtzdHlsZS5mb250U2l6ZX0gKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKWA7CiAgfQogIGZpeFRleHRJbmRlbnQoc3R5bGUpOwogIHJldHVybiBzdHlsZTsKfQpmdW5jdGlvbiBjaGVja1N0eWxlKG5vZGUpIHsKICBpZiAoIW5vZGUuc3R5bGUpIHsKICAgIHJldHVybiAiIjsKICB9CiAgcmV0dXJuIG5vZGUuc3R5bGUuc3BsaXQoIjsiKS5maWx0ZXIocyA9PiAhIXMudHJpbSgpKS5tYXAocyA9PiBzLnNwbGl0KCI6IiwgMikubWFwKHQgPT4gdC50cmltKCkpKS5maWx0ZXIoKFtrZXksIHZhbHVlXSkgPT4gewogICAgaWYgKGtleSA9PT0gImZvbnQtZmFtaWx5IikgewogICAgICBub2RlWyRnbG9iYWxEYXRhXS51c2VkVHlwZWZhY2VzLmFkZCh2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gVkFMSURfU1RZTEVTLmhhcyhrZXkpOwogIH0pLm1hcChrdiA9PiBrdi5qb2luKCI6IikpLmpvaW4oIjsiKTsKfQpjb25zdCBOb1doaXRlcyA9IG5ldyBTZXQoWyJib2R5IiwgImh0bWwiXSk7CmNsYXNzIFhodG1sT2JqZWN0IGV4dGVuZHMgWG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzLCBuYW1lKSB7CiAgICBzdXBlcihYSFRNTF9OU19JRCwgbmFtZSk7CiAgICB0aGlzWyRyaWNoVGV4dF0gPSBmYWxzZTsKICAgIHRoaXMuc3R5bGUgPSBhdHRyaWJ1dGVzLnN0eWxlIHx8ICIiOwogIH0KICBbJGNsZWFuXShidWlsZGVyKSB7CiAgICBzdXBlclskY2xlYW5dKGJ1aWxkZXIpOwogICAgdGhpcy5zdHlsZSA9IGNoZWNrU3R5bGUodGhpcyk7CiAgfQogIFskYWNjZXB0V2hpdGVzcGFjZV0oKSB7CiAgICByZXR1cm4gIU5vV2hpdGVzLmhhcyh0aGlzWyRub2RlTmFtZV0pOwogIH0KICBbJG9uVGV4dF0oc3RyLCByaWNoVGV4dCA9IGZhbHNlKSB7CiAgICBpZiAoIXJpY2hUZXh0KSB7CiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlQWxsKGNybGZSZWdFeHAsICIiKTsKICAgICAgaWYgKCF0aGlzLnN0eWxlLmluY2x1ZGVzKCJ4ZmEtc3BhY2VydW46eWVzIikpIHsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZUFsbChzcGFjZXNSZWdFeHAsICIgIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXNbJHJpY2hUZXh0XSA9IHRydWU7CiAgICB9CiAgICBpZiAoc3RyKSB7CiAgICAgIHRoaXNbJGNvbnRlbnRdICs9IHN0cjsKICAgIH0KICB9CiAgWyRwdXNoR2x5cGhzXShtZWFzdXJlLCBtdXN0UG9wID0gdHJ1ZSkgewogICAgY29uc3QgeGZhRm9udCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBtYXJnaW4gPSB7CiAgICAgIHRvcDogTmFOLAogICAgICBib3R0b206IE5hTiwKICAgICAgbGVmdDogTmFOLAogICAgICByaWdodDogTmFOCiAgICB9OwogICAgbGV0IGxpbmVIZWlnaHQgPSBudWxsOwogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5zdHlsZS5zcGxpdCgiOyIpLm1hcChzID0+IHMuc3BsaXQoIjoiLCAyKSkpIHsKICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICBjYXNlICJmb250LWZhbWlseSI6CiAgICAgICAgICB4ZmFGb250LnR5cGVmYWNlID0gc3RyaXBRdW90ZXModmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZm9udC1zaXplIjoKICAgICAgICAgIHhmYUZvbnQuc2l6ZSA9IGdldE1lYXN1cmVtZW50KHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImZvbnQtd2VpZ2h0IjoKICAgICAgICAgIHhmYUZvbnQud2VpZ2h0ID0gdmFsdWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJmb250LXN0eWxlIjoKICAgICAgICAgIHhmYUZvbnQucG9zdHVyZSA9IHZhbHVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibGV0dGVyLXNwYWNpbmciOgogICAgICAgICAgeGZhRm9udC5sZXR0ZXJTcGFjaW5nID0gZ2V0TWVhc3VyZW1lbnQodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWFyZ2luIjoKICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IHZhbHVlLnNwbGl0KC8gXHQvKS5tYXAoeCA9PiBnZXRNZWFzdXJlbWVudCh4KSk7CiAgICAgICAgICBzd2l0Y2ggKHZhbHVlcy5sZW5ndGgpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIG1hcmdpbi50b3AgPSBtYXJnaW4uYm90dG9tID0gbWFyZ2luLmxlZnQgPSBtYXJnaW4ucmlnaHQgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBtYXJnaW4udG9wID0gbWFyZ2luLmJvdHRvbSA9IHZhbHVlc1swXTsKICAgICAgICAgICAgICBtYXJnaW4ubGVmdCA9IG1hcmdpbi5yaWdodCA9IHZhbHVlc1sxXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIG1hcmdpbi50b3AgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgbWFyZ2luLmJvdHRvbSA9IHZhbHVlc1syXTsKICAgICAgICAgICAgICBtYXJnaW4ubGVmdCA9IG1hcmdpbi5yaWdodCA9IHZhbHVlc1sxXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIG1hcmdpbi50b3AgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgbWFyZ2luLmxlZnQgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgICAgbWFyZ2luLmJvdHRvbSA9IHZhbHVlc1syXTsKICAgICAgICAgICAgICBtYXJnaW4ucmlnaHQgPSB2YWx1ZXNbM107CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtYXJnaW4tdG9wIjoKICAgICAgICAgIG1hcmdpbi50b3AgPSBnZXRNZWFzdXJlbWVudCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtYXJnaW4tYm90dG9tIjoKICAgICAgICAgIG1hcmdpbi5ib3R0b20gPSBnZXRNZWFzdXJlbWVudCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtYXJnaW4tbGVmdCI6CiAgICAgICAgICBtYXJnaW4ubGVmdCA9IGdldE1lYXN1cmVtZW50KHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm1hcmdpbi1yaWdodCI6CiAgICAgICAgICBtYXJnaW4ucmlnaHQgPSBnZXRNZWFzdXJlbWVudCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsaW5lLWhlaWdodCI6CiAgICAgICAgICBsaW5lSGVpZ2h0ID0gZ2V0TWVhc3VyZW1lbnQodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIG1lYXN1cmUucHVzaERhdGEoeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0KTsKICAgIGlmICh0aGlzWyRjb250ZW50XSkgewogICAgICBtZWFzdXJlLmFkZFN0cmluZyh0aGlzWyRjb250ZW50XSk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbJGdldENoaWxkcmVuXSgpKSB7CiAgICAgICAgaWYgKGNoaWxkWyRub2RlTmFtZV0gPT09ICIjdGV4dCIpIHsKICAgICAgICAgIG1lYXN1cmUuYWRkU3RyaW5nKGNoaWxkWyRjb250ZW50XSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY2hpbGRbJHB1c2hHbHlwaHNdKG1lYXN1cmUpOwogICAgICB9CiAgICB9CiAgICBpZiAobXVzdFBvcCkgewogICAgICBtZWFzdXJlLnBvcEZvbnQoKTsKICAgIH0KICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgdGhpc1skZXh0cmFdID0gewogICAgICBjaGlsZHJlbgogICAgfTsKICAgIHRoaXNbJGNoaWxkcmVuVG9IVE1MXSh7fSk7CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwICYmICF0aGlzWyRjb250ZW50XSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGxldCB2YWx1ZTsKICAgIGlmICh0aGlzWyRyaWNoVGV4dF0pIHsKICAgICAgdmFsdWUgPSB0aGlzWyRjb250ZW50XSA/IHRoaXNbJGNvbnRlbnRdLnJlcGxhY2VBbGwoY3JsZkZvclJpY2hUZXh0UmVnRXhwLCAiXG4iKSA6IHVuZGVmaW5lZDsKICAgIH0gZWxzZSB7CiAgICAgIHZhbHVlID0gdGhpc1skY29udGVudF0gfHwgdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6IHRoaXNbJG5vZGVOYW1lXSwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGhyZWY6IHRoaXMuaHJlZiwKICAgICAgICBzdHlsZTogbWFwU3R5bGUodGhpcy5zdHlsZSwgdGhpcywgdGhpc1skcmljaFRleHRdKQogICAgICB9LAogICAgICBjaGlsZHJlbiwKICAgICAgdmFsdWUKICAgIH0pOwogIH0KfQpjbGFzcyBBIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJhIik7CiAgICB0aGlzLmhyZWYgPSBmaXhVUkwoYXR0cmlidXRlcy5ocmVmKSB8fCAiIjsKICB9Cn0KY2xhc3MgQiBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYiIpOwogIH0KICBbJHB1c2hHbHlwaHNdKG1lYXN1cmUpIHsKICAgIG1lYXN1cmUucHVzaEZvbnQoewogICAgICB3ZWlnaHQ6ICJib2xkIgogICAgfSk7CiAgICBzdXBlclskcHVzaEdseXBoc10obWVhc3VyZSk7CiAgICBtZWFzdXJlLnBvcEZvbnQoKTsKICB9Cn0KY2xhc3MgQm9keSBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYm9keSIpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHJlcyA9IHN1cGVyWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICAgIGNvbnN0IHsKICAgICAgaHRtbAogICAgfSA9IHJlczsKICAgIGlmICghaHRtbCkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGh0bWwubmFtZSA9ICJkaXYiOwogICAgaHRtbC5hdHRyaWJ1dGVzLmNsYXNzID0gWyJ4ZmFSaWNoIl07CiAgICByZXR1cm4gcmVzOwogIH0KfQpjbGFzcyBCciBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYnIiKTsKICB9CiAgWyR0ZXh0XSgpIHsKICAgIHJldHVybiAiXG4iOwogIH0KICBbJHB1c2hHbHlwaHNdKG1lYXN1cmUpIHsKICAgIG1lYXN1cmUuYWRkU3RyaW5nKCJcbiIpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiYnIiCiAgICB9KTsKICB9Cn0KY2xhc3MgSHRtbCBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiaHRtbCIpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICB0aGlzWyRleHRyYV0gPSB7CiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgdGhpc1skY2hpbGRyZW5Ub0hUTUxdKHt9KTsKICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgY2xhc3M6IFsieGZhUmljaCJdLAogICAgICAgICAgc3R5bGU6IHt9CiAgICAgICAgfSwKICAgICAgICB2YWx1ZTogdGhpc1skY29udGVudF0gfHwgIiIKICAgICAgfSk7CiAgICB9CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7CiAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5bMF07CiAgICAgIGlmIChjaGlsZC5hdHRyaWJ1dGVzPy5jbGFzcy5pbmNsdWRlcygieGZhUmljaCIpKSB7CiAgICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhjaGlsZCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYVJpY2giXSwKICAgICAgICBzdHlsZToge30KICAgICAgfSwKICAgICAgY2hpbGRyZW4KICAgIH0pOwogIH0KfQpjbGFzcyBJIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJpIik7CiAgfQogIFskcHVzaEdseXBoc10obWVhc3VyZSkgewogICAgbWVhc3VyZS5wdXNoRm9udCh7CiAgICAgIHBvc3R1cmU6ICJpdGFsaWMiCiAgICB9KTsKICAgIHN1cGVyWyRwdXNoR2x5cGhzXShtZWFzdXJlKTsKICAgIG1lYXN1cmUucG9wRm9udCgpOwogIH0KfQpjbGFzcyBMaSBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAibGkiKTsKICB9Cn0KY2xhc3MgT2wgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgIm9sIik7CiAgfQp9CmNsYXNzIFAgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgInAiKTsKICB9CiAgWyRwdXNoR2x5cGhzXShtZWFzdXJlKSB7CiAgICBzdXBlclskcHVzaEdseXBoc10obWVhc3VyZSwgZmFsc2UpOwogICAgbWVhc3VyZS5hZGRTdHJpbmcoIlxuIik7CiAgICBtZWFzdXJlLmFkZFBhcmEoKTsKICAgIG1lYXN1cmUucG9wRm9udCgpOwogIH0KICBbJHRleHRdKCkgewogICAgY29uc3Qgc2libGluZ3MgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldENoaWxkcmVuXSgpOwogICAgaWYgKHNpYmxpbmdzLmF0KC0xKSA9PT0gdGhpcykgewogICAgICByZXR1cm4gc3VwZXJbJHRleHRdKCk7CiAgICB9CiAgICByZXR1cm4gc3VwZXJbJHRleHRdKCkgKyAiXG4iOwogIH0KfQpjbGFzcyBTcGFuIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJzcGFuIik7CiAgfQp9CmNsYXNzIFN1YiBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAic3ViIik7CiAgfQp9CmNsYXNzIFN1cCBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAic3VwIik7CiAgfQp9CmNsYXNzIFVsIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJ1bCIpOwogIH0KfQpjbGFzcyBYaHRtbE5hbWVzcGFjZSB7CiAgc3RhdGljIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChYaHRtbE5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gWGh0bWxOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgYShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IEEoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBiKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgQihhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGJvZHkoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBCb2R5KGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgYnIoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBCcihhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGh0bWwoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBIdG1sKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgaShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IEkoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBsaShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IExpKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgb2woYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBPbChhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIHAoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBQKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgc3BhbihhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFNwYW4oYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBzdWIoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTdWIoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBzdXAoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTdXAoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyB1bChhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFVsKGF0dHJpYnV0ZXMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3NldHVwLmpzCgoKCgoKCgoKCmNvbnN0IE5hbWVzcGFjZVNldFVwID0gewogIGNvbmZpZzogQ29uZmlnTmFtZXNwYWNlLAogIGNvbm5lY3Rpb246IENvbm5lY3Rpb25TZXROYW1lc3BhY2UsCiAgZGF0YXNldHM6IERhdGFzZXRzTmFtZXNwYWNlLAogIGxvY2FsZVNldDogTG9jYWxlU2V0TmFtZXNwYWNlLAogIHNpZ25hdHVyZTogU2lnbmF0dXJlTmFtZXNwYWNlLAogIHN0eWxlc2hlZXQ6IFN0eWxlc2hlZXROYW1lc3BhY2UsCiAgdGVtcGxhdGU6IFRlbXBsYXRlTmFtZXNwYWNlLAogIHhkcDogWGRwTmFtZXNwYWNlLAogIHhodG1sOiBYaHRtbE5hbWVzcGFjZQp9OwoKOy8vIC4vc3JjL2NvcmUveGZhL3Vua25vd24uanMKCgpjbGFzcyBVbmtub3duTmFtZXNwYWNlIHsKICBjb25zdHJ1Y3Rvcihuc0lkKSB7CiAgICB0aGlzLm5hbWVzcGFjZUlkID0gbnNJZDsKICB9CiAgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBYbWxPYmplY3QodGhpcy5uYW1lc3BhY2VJZCwgbmFtZSwgYXR0cmlidXRlcyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvYnVpbGRlci5qcwoKCgoKCgoKY2xhc3MgUm9vdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoaWRzKSB7CiAgICBzdXBlcigtMSwgInJvb3QiLCBPYmplY3QuY3JlYXRlKG51bGwpKTsKICAgIHRoaXMuZWxlbWVudCA9IG51bGw7CiAgICB0aGlzWyRpZHNdID0gaWRzOwogIH0KICBbJG9uQ2hpbGRdKGNoaWxkKSB7CiAgICB0aGlzLmVsZW1lbnQgPSBjaGlsZDsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHN1cGVyWyRmaW5hbGl6ZV0oKTsKICAgIGlmICh0aGlzLmVsZW1lbnQudGVtcGxhdGUgaW5zdGFuY2VvZiBUZW1wbGF0ZSkgewogICAgICB0aGlzWyRpZHNdLnNldCgkcm9vdCwgdGhpcy5lbGVtZW50KTsKICAgICAgdGhpcy5lbGVtZW50LnRlbXBsYXRlWyRyZXNvbHZlUHJvdG90eXBlc10odGhpc1skaWRzXSk7CiAgICAgIHRoaXMuZWxlbWVudC50ZW1wbGF0ZVskaWRzXSA9IHRoaXNbJGlkc107CiAgICB9CiAgfQp9CmNsYXNzIEVtcHR5IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKC0xLCAiIiwgT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgfQogIFskb25DaGlsZF0oXykgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjbGFzcyBCdWlsZGVyIHsKICBjb25zdHJ1Y3Rvcihyb290TmFtZVNwYWNlID0gbnVsbCkgewogICAgdGhpcy5fbmFtZXNwYWNlU3RhY2sgPSBbXTsKICAgIHRoaXMuX25zQWdub3N0aWNMZXZlbCA9IDA7CiAgICB0aGlzLl9uYW1lc3BhY2VQcmVmaXhlcyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX25hbWVzcGFjZXMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9uZXh0TnNJZCA9IE1hdGgubWF4KC4uLk9iamVjdC52YWx1ZXMoTmFtZXNwYWNlSWRzKS5tYXAoKHsKICAgICAgaWQKICAgIH0pID0+IGlkKSk7CiAgICB0aGlzLl9jdXJyZW50TmFtZXNwYWNlID0gcm9vdE5hbWVTcGFjZSB8fCBuZXcgVW5rbm93bk5hbWVzcGFjZSgrK3RoaXMuX25leHROc0lkKTsKICB9CiAgYnVpbGRSb290KGlkcykgewogICAgcmV0dXJuIG5ldyBSb290KGlkcyk7CiAgfQogIGJ1aWxkKHsKICAgIG5zUHJlZml4LAogICAgbmFtZSwKICAgIGF0dHJpYnV0ZXMsCiAgICBuYW1lc3BhY2UsCiAgICBwcmVmaXhlcwogIH0pIHsKICAgIGNvbnN0IGhhc05hbWVzcGFjZURlZiA9IG5hbWVzcGFjZSAhPT0gbnVsbDsKICAgIGlmIChoYXNOYW1lc3BhY2VEZWYpIHsKICAgICAgdGhpcy5fbmFtZXNwYWNlU3RhY2sucHVzaCh0aGlzLl9jdXJyZW50TmFtZXNwYWNlKTsKICAgICAgdGhpcy5fY3VycmVudE5hbWVzcGFjZSA9IHRoaXMuX3NlYXJjaE5hbWVzcGFjZShuYW1lc3BhY2UpOwogICAgfQogICAgaWYgKHByZWZpeGVzKSB7CiAgICAgIHRoaXMuX2FkZE5hbWVzcGFjZVByZWZpeChwcmVmaXhlcyk7CiAgICB9CiAgICBpZiAoYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eSgkbnNBdHRyaWJ1dGVzKSkgewogICAgICBjb25zdCBkYXRhVGVtcGxhdGUgPSBOYW1lc3BhY2VTZXRVcC5kYXRhc2V0czsKICAgICAgY29uc3QgbnNBdHRycyA9IGF0dHJpYnV0ZXNbJG5zQXR0cmlidXRlc107CiAgICAgIGxldCB4ZmFBdHRycyA9IG51bGw7CiAgICAgIGZvciAoY29uc3QgW25zLCBhdHRyc10gb2YgT2JqZWN0LmVudHJpZXMobnNBdHRycykpIHsKICAgICAgICBjb25zdCBuc1RvVXNlID0gdGhpcy5fZ2V0TmFtZXNwYWNlVG9Vc2UobnMpOwogICAgICAgIGlmIChuc1RvVXNlID09PSBkYXRhVGVtcGxhdGUpIHsKICAgICAgICAgIHhmYUF0dHJzID0gewogICAgICAgICAgICB4ZmE6IGF0dHJzCiAgICAgICAgICB9OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh4ZmFBdHRycykgewogICAgICAgIGF0dHJpYnV0ZXNbJG5zQXR0cmlidXRlc10gPSB4ZmFBdHRyczsKICAgICAgfSBlbHNlIHsKICAgICAgICBkZWxldGUgYXR0cmlidXRlc1skbnNBdHRyaWJ1dGVzXTsKICAgICAgfQogICAgfQogICAgY29uc3QgbmFtZXNwYWNlVG9Vc2UgPSB0aGlzLl9nZXROYW1lc3BhY2VUb1VzZShuc1ByZWZpeCk7CiAgICBjb25zdCBub2RlID0gbmFtZXNwYWNlVG9Vc2U/LlskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHx8IG5ldyBFbXB0eSgpOwogICAgaWYgKG5vZGVbJGlzTnNBZ25vc3RpY10oKSkgewogICAgICB0aGlzLl9uc0Fnbm9zdGljTGV2ZWwrKzsKICAgIH0KICAgIGlmIChoYXNOYW1lc3BhY2VEZWYgfHwgcHJlZml4ZXMgfHwgbm9kZVskaXNOc0Fnbm9zdGljXSgpKSB7CiAgICAgIG5vZGVbJGNsZWFudXBdID0gewogICAgICAgIGhhc05hbWVzcGFjZTogaGFzTmFtZXNwYWNlRGVmLAogICAgICAgIHByZWZpeGVzLAogICAgICAgIG5zQWdub3N0aWM6IG5vZGVbJGlzTnNBZ25vc3RpY10oKQogICAgICB9OwogICAgfQogICAgcmV0dXJuIG5vZGU7CiAgfQogIGlzTnNBZ25vc3RpYygpIHsKICAgIHJldHVybiB0aGlzLl9uc0Fnbm9zdGljTGV2ZWwgPiAwOwogIH0KICBfc2VhcmNoTmFtZXNwYWNlKG5zTmFtZSkgewogICAgbGV0IG5zID0gdGhpcy5fbmFtZXNwYWNlcy5nZXQobnNOYW1lKTsKICAgIGlmIChucykgewogICAgICByZXR1cm4gbnM7CiAgICB9CiAgICBmb3IgKGNvbnN0IFtuYW1lLCB7CiAgICAgIGNoZWNrCiAgICB9XSBvZiBPYmplY3QuZW50cmllcyhOYW1lc3BhY2VJZHMpKSB7CiAgICAgIGlmIChjaGVjayhuc05hbWUpKSB7CiAgICAgICAgbnMgPSBOYW1lc3BhY2VTZXRVcFtuYW1lXTsKICAgICAgICBpZiAobnMpIHsKICAgICAgICAgIHRoaXMuX25hbWVzcGFjZXMuc2V0KG5zTmFtZSwgbnMpOwogICAgICAgICAgcmV0dXJuIG5zOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgbnMgPSBuZXcgVW5rbm93bk5hbWVzcGFjZSgrK3RoaXMuX25leHROc0lkKTsKICAgIHRoaXMuX25hbWVzcGFjZXMuc2V0KG5zTmFtZSwgbnMpOwogICAgcmV0dXJuIG5zOwogIH0KICBfYWRkTmFtZXNwYWNlUHJlZml4KHByZWZpeGVzKSB7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcHJlZml4LAogICAgICB2YWx1ZQogICAgfSBvZiBwcmVmaXhlcykgewogICAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLl9zZWFyY2hOYW1lc3BhY2UodmFsdWUpOwogICAgICBsZXQgcHJlZml4U3RhY2sgPSB0aGlzLl9uYW1lc3BhY2VQcmVmaXhlcy5nZXQocHJlZml4KTsKICAgICAgaWYgKCFwcmVmaXhTdGFjaykgewogICAgICAgIHByZWZpeFN0YWNrID0gW107CiAgICAgICAgdGhpcy5fbmFtZXNwYWNlUHJlZml4ZXMuc2V0KHByZWZpeCwgcHJlZml4U3RhY2spOwogICAgICB9CiAgICAgIHByZWZpeFN0YWNrLnB1c2gobmFtZXNwYWNlKTsKICAgIH0KICB9CiAgX2dldE5hbWVzcGFjZVRvVXNlKHByZWZpeCkgewogICAgaWYgKCFwcmVmaXgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnROYW1lc3BhY2U7CiAgICB9CiAgICBjb25zdCBwcmVmaXhTdGFjayA9IHRoaXMuX25hbWVzcGFjZVByZWZpeGVzLmdldChwcmVmaXgpOwogICAgaWYgKHByZWZpeFN0YWNrPy5sZW5ndGggPiAwKSB7CiAgICAgIHJldHVybiBwcmVmaXhTdGFjay5hdCgtMSk7CiAgICB9CiAgICB3YXJuKGBVbmtub3duIG5hbWVzcGFjZSBwcmVmaXg6ICR7cHJlZml4fS5gKTsKICAgIHJldHVybiBudWxsOwogIH0KICBjbGVhbihkYXRhKSB7CiAgICBjb25zdCB7CiAgICAgIGhhc05hbWVzcGFjZSwKICAgICAgcHJlZml4ZXMsCiAgICAgIG5zQWdub3N0aWMKICAgIH0gPSBkYXRhOwogICAgaWYgKGhhc05hbWVzcGFjZSkgewogICAgICB0aGlzLl9jdXJyZW50TmFtZXNwYWNlID0gdGhpcy5fbmFtZXNwYWNlU3RhY2sucG9wKCk7CiAgICB9CiAgICBpZiAocHJlZml4ZXMpIHsKICAgICAgcHJlZml4ZXMuZm9yRWFjaCgoewogICAgICAgIHByZWZpeAogICAgICB9KSA9PiB7CiAgICAgICAgdGhpcy5fbmFtZXNwYWNlUHJlZml4ZXMuZ2V0KHByZWZpeCkucG9wKCk7CiAgICAgIH0pOwogICAgfQogICAgaWYgKG5zQWdub3N0aWMpIHsKICAgICAgdGhpcy5fbnNBZ25vc3RpY0xldmVsLS07CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvcGFyc2VyLmpzCgoKCgpjbGFzcyBYRkFQYXJzZXIgZXh0ZW5kcyBYTUxQYXJzZXJCYXNlIHsKICBjb25zdHJ1Y3Rvcihyb290TmFtZVNwYWNlID0gbnVsbCwgcmljaFRleHQgPSBmYWxzZSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2J1aWxkZXIgPSBuZXcgQnVpbGRlcihyb290TmFtZVNwYWNlKTsKICAgIHRoaXMuX3N0YWNrID0gW107CiAgICB0aGlzLl9nbG9iYWxEYXRhID0gewogICAgICB1c2VkVHlwZWZhY2VzOiBuZXcgU2V0KCkKICAgIH07CiAgICB0aGlzLl9pZHMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fYnVpbGRlci5idWlsZFJvb3QodGhpcy5faWRzKTsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IFhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yOwogICAgdGhpcy5fd2hpdGVSZWdleCA9IC9eXHMrJC87CiAgICB0aGlzLl9uYnNwcyA9IC9ceGEwKy9nOwogICAgdGhpcy5fcmljaFRleHQgPSByaWNoVGV4dDsKICB9CiAgcGFyc2UoZGF0YSkgewogICAgdGhpcy5wYXJzZVhtbChkYXRhKTsKICAgIGlmICh0aGlzLl9lcnJvckNvZGUgIT09IFhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICB0aGlzLl9jdXJyZW50WyRmaW5hbGl6ZV0oKTsKICAgIHJldHVybiB0aGlzLl9jdXJyZW50LmVsZW1lbnQ7CiAgfQogIG9uVGV4dCh0ZXh0KSB7CiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHRoaXMuX25ic3BzLCBtYXRjaCA9PiBtYXRjaC5zbGljZSgxKSArICIgIik7CiAgICBpZiAodGhpcy5fcmljaFRleHQgfHwgdGhpcy5fY3VycmVudFskYWNjZXB0V2hpdGVzcGFjZV0oKSkgewogICAgICB0aGlzLl9jdXJyZW50WyRvblRleHRdKHRleHQsIHRoaXMuX3JpY2hUZXh0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX3doaXRlUmVnZXgudGVzdCh0ZXh0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9jdXJyZW50WyRvblRleHRdKHRleHQudHJpbSgpKTsKICB9CiAgb25DZGF0YSh0ZXh0KSB7CiAgICB0aGlzLl9jdXJyZW50WyRvblRleHRdKHRleHQpOwogIH0KICBfbWtBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMsIHRhZ05hbWUpIHsKICAgIGxldCBuYW1lc3BhY2UgPSBudWxsOwogICAgbGV0IHByZWZpeGVzID0gbnVsbDsKICAgIGNvbnN0IGF0dHJpYnV0ZU9iaiA9IE9iamVjdC5jcmVhdGUoe30pOwogICAgZm9yIChjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIHZhbHVlCiAgICB9IG9mIGF0dHJpYnV0ZXMpIHsKICAgICAgaWYgKG5hbWUgPT09ICJ4bWxucyIpIHsKICAgICAgICBpZiAoIW5hbWVzcGFjZSkgewogICAgICAgICAgbmFtZXNwYWNlID0gdmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdhcm4oYFhGQSAtIG11bHRpcGxlIG5hbWVzcGFjZSBkZWZpbml0aW9uIGluIDwke3RhZ05hbWV9PmApOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChuYW1lLnN0YXJ0c1dpdGgoInhtbG5zOiIpKSB7CiAgICAgICAgY29uc3QgcHJlZml4ID0gbmFtZS5zdWJzdHJpbmcoInhtbG5zOiIubGVuZ3RoKTsKICAgICAgICBwcmVmaXhlcyA/Pz0gW107CiAgICAgICAgcHJlZml4ZXMucHVzaCh7CiAgICAgICAgICBwcmVmaXgsCiAgICAgICAgICB2YWx1ZQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGkgPSBuYW1lLmluZGV4T2YoIjoiKTsKICAgICAgICBpZiAoaSA9PT0gLTEpIHsKICAgICAgICAgIGF0dHJpYnV0ZU9ialtuYW1lXSA9IHZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBuc0F0dHJzID0gYXR0cmlidXRlT2JqWyRuc0F0dHJpYnV0ZXNdID8/PSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgY29uc3QgW25zLCBhdHRyTmFtZV0gPSBbbmFtZS5zbGljZSgwLCBpKSwgbmFtZS5zbGljZShpICsgMSldOwogICAgICAgICAgY29uc3QgYXR0cnMgPSBuc0F0dHJzW25zXSB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGF0dHJzW2F0dHJOYW1lXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIFtuYW1lc3BhY2UsIHByZWZpeGVzLCBhdHRyaWJ1dGVPYmpdOwogIH0KICBfZ2V0TmFtZUFuZFByZWZpeChuYW1lLCBuc0Fnbm9zdGljKSB7CiAgICBjb25zdCBpID0gbmFtZS5pbmRleE9mKCI6Iik7CiAgICBpZiAoaSA9PT0gLTEpIHsKICAgICAgcmV0dXJuIFtuYW1lLCBudWxsXTsKICAgIH0KICAgIHJldHVybiBbbmFtZS5zdWJzdHJpbmcoaSArIDEpLCBuc0Fnbm9zdGljID8gIiIgOiBuYW1lLnN1YnN0cmluZygwLCBpKV07CiAgfQogIG9uQmVnaW5FbGVtZW50KHRhZ05hbWUsIGF0dHJpYnV0ZXMsIGlzRW1wdHkpIHsKICAgIGNvbnN0IFtuYW1lc3BhY2UsIHByZWZpeGVzLCBhdHRyaWJ1dGVzT2JqXSA9IHRoaXMuX21rQXR0cmlidXRlcyhhdHRyaWJ1dGVzLCB0YWdOYW1lKTsKICAgIGNvbnN0IFtuYW1lLCBuc1ByZWZpeF0gPSB0aGlzLl9nZXROYW1lQW5kUHJlZml4KHRhZ05hbWUsIHRoaXMuX2J1aWxkZXIuaXNOc0Fnbm9zdGljKCkpOwogICAgY29uc3Qgbm9kZSA9IHRoaXMuX2J1aWxkZXIuYnVpbGQoewogICAgICBuc1ByZWZpeCwKICAgICAgbmFtZSwKICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlc09iaiwKICAgICAgbmFtZXNwYWNlLAogICAgICBwcmVmaXhlcwogICAgfSk7CiAgICBub2RlWyRnbG9iYWxEYXRhXSA9IHRoaXMuX2dsb2JhbERhdGE7CiAgICBpZiAoaXNFbXB0eSkgewogICAgICBub2RlWyRmaW5hbGl6ZV0oKTsKICAgICAgaWYgKHRoaXMuX2N1cnJlbnRbJG9uQ2hpbGRdKG5vZGUpKSB7CiAgICAgICAgbm9kZVskc2V0SWRdKHRoaXMuX2lkcyk7CiAgICAgIH0KICAgICAgbm9kZVskY2xlYW5dKHRoaXMuX2J1aWxkZXIpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9zdGFjay5wdXNoKHRoaXMuX2N1cnJlbnQpOwogICAgdGhpcy5fY3VycmVudCA9IG5vZGU7CiAgfQogIG9uRW5kRWxlbWVudChuYW1lKSB7CiAgICBjb25zdCBub2RlID0gdGhpcy5fY3VycmVudDsKICAgIGlmIChub2RlWyRpc0NEQVRBWG1sXSgpICYmIHR5cGVvZiBub2RlWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFhGQVBhcnNlcigpOwogICAgICBwYXJzZXIuX2dsb2JhbERhdGEgPSB0aGlzLl9nbG9iYWxEYXRhOwogICAgICBjb25zdCByb290ID0gcGFyc2VyLnBhcnNlKG5vZGVbJGNvbnRlbnRdKTsKICAgICAgbm9kZVskY29udGVudF0gPSBudWxsOwogICAgICBub2RlWyRvbkNoaWxkXShyb290KTsKICAgIH0KICAgIG5vZGVbJGZpbmFsaXplXSgpOwogICAgdGhpcy5fY3VycmVudCA9IHRoaXMuX3N0YWNrLnBvcCgpOwogICAgaWYgKHRoaXMuX2N1cnJlbnRbJG9uQ2hpbGRdKG5vZGUpKSB7CiAgICAgIG5vZGVbJHNldElkXSh0aGlzLl9pZHMpOwogICAgfQogICAgbm9kZVskY2xlYW5dKHRoaXMuX2J1aWxkZXIpOwogIH0KICBvbkVycm9yKGNvZGUpIHsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IGNvZGU7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvZmFjdG9yeS5qcwoKCgoKCgoKCmNsYXNzIFhGQUZhY3RvcnkgewogIGNvbnN0cnVjdG9yKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHRoaXMucm9vdCA9IG5ldyBYRkFQYXJzZXIoKS5wYXJzZShYRkFGYWN0b3J5Ll9jcmVhdGVEb2N1bWVudChkYXRhKSk7CiAgICAgIGNvbnN0IGJpbmRlciA9IG5ldyBCaW5kZXIodGhpcy5yb290KTsKICAgICAgdGhpcy5mb3JtID0gYmluZGVyLmJpbmQoKTsKICAgICAgdGhpcy5kYXRhSGFuZGxlciA9IG5ldyBEYXRhSGFuZGxlcih0aGlzLnJvb3QsIGJpbmRlci5nZXREYXRhKCkpOwogICAgICB0aGlzLmZvcm1bJGdsb2JhbERhdGFdLnRlbXBsYXRlID0gdGhpcy5mb3JtOwogICAgfSBjYXRjaCAoZSkgewogICAgICB3YXJuKGBYRkEgLSBhbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgcGFyc2luZyBhbmQgYmluZGluZzogJHtlfWApOwogICAgfQogIH0KICBpc1ZhbGlkKCkgewogICAgcmV0dXJuICEhKHRoaXMucm9vdCAmJiB0aGlzLmZvcm0pOwogIH0KICBfY3JlYXRlUGFnZXNIZWxwZXIoKSB7CiAgICBjb25zdCBpdGVyYXRvciA9IHRoaXMuZm9ybVskdG9QYWdlc10oKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNvbnN0IG5leHRJdGVyYXRpb24gPSAoKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHZhbHVlID0gaXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgaWYgKHZhbHVlLmRvbmUpIHsKICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZS52YWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXRUaW1lb3V0KG5leHRJdGVyYXRpb24sIDApOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHNldFRpbWVvdXQobmV4dEl0ZXJhdGlvbiwgMCk7CiAgICB9KTsKICB9CiAgYXN5bmMgX2NyZWF0ZVBhZ2VzKCkgewogICAgdHJ5IHsKICAgICAgdGhpcy5wYWdlcyA9IGF3YWl0IHRoaXMuX2NyZWF0ZVBhZ2VzSGVscGVyKCk7CiAgICAgIHRoaXMuZGltcyA9IHRoaXMucGFnZXMuY2hpbGRyZW4ubWFwKGMgPT4gewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0CiAgICAgICAgfSA9IGMuYXR0cmlidXRlcy5zdHlsZTsKICAgICAgICByZXR1cm4gWzAsIDAsIHBhcnNlSW50KHdpZHRoKSwgcGFyc2VJbnQoaGVpZ2h0KV07CiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICB3YXJuKGBYRkEgLSBhbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgbGF5b3V0OiAke2V9YCk7CiAgICB9CiAgfQogIGdldEJvdW5kaW5nQm94KHBhZ2VJbmRleCkgewogICAgcmV0dXJuIHRoaXMuZGltc1twYWdlSW5kZXhdOwogIH0KICBhc3luYyBnZXROdW1QYWdlcygpIHsKICAgIGlmICghdGhpcy5wYWdlcykgewogICAgICBhd2FpdCB0aGlzLl9jcmVhdGVQYWdlcygpOwogICAgfQogICAgcmV0dXJuIHRoaXMuZGltcy5sZW5ndGg7CiAgfQogIHNldEltYWdlcyhpbWFnZXMpIHsKICAgIHRoaXMuZm9ybVskZ2xvYmFsRGF0YV0uaW1hZ2VzID0gaW1hZ2VzOwogIH0KICBzZXRGb250cyhmb250cykgewogICAgdGhpcy5mb3JtWyRnbG9iYWxEYXRhXS5mb250RmluZGVyID0gbmV3IEZvbnRGaW5kZXIoZm9udHMpOwogICAgY29uc3QgbWlzc2luZ0ZvbnRzID0gW107CiAgICBmb3IgKGxldCB0eXBlZmFjZSBvZiB0aGlzLmZvcm1bJGdsb2JhbERhdGFdLnVzZWRUeXBlZmFjZXMpIHsKICAgICAgdHlwZWZhY2UgPSBzdHJpcFF1b3Rlcyh0eXBlZmFjZSk7CiAgICAgIGNvbnN0IGZvbnQgPSB0aGlzLmZvcm1bJGdsb2JhbERhdGFdLmZvbnRGaW5kZXIuZmluZCh0eXBlZmFjZSk7CiAgICAgIGlmICghZm9udCkgewogICAgICAgIG1pc3NpbmdGb250cy5wdXNoKHR5cGVmYWNlKTsKICAgICAgfQogICAgfQogICAgaWYgKG1pc3NpbmdGb250cy5sZW5ndGggPiAwKSB7CiAgICAgIHJldHVybiBtaXNzaW5nRm9udHM7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgYXBwZW5kRm9udHMoZm9udHMsIHJlYWxseU1pc3NpbmdGb250cykgewogICAgdGhpcy5mb3JtWyRnbG9iYWxEYXRhXS5mb250RmluZGVyLmFkZChmb250cywgcmVhbGx5TWlzc2luZ0ZvbnRzKTsKICB9CiAgYXN5bmMgZ2V0UGFnZXMoKSB7CiAgICBpZiAoIXRoaXMucGFnZXMpIHsKICAgICAgYXdhaXQgdGhpcy5fY3JlYXRlUGFnZXMoKTsKICAgIH0KICAgIGNvbnN0IHBhZ2VzID0gdGhpcy5wYWdlczsKICAgIHRoaXMucGFnZXMgPSBudWxsOwogICAgcmV0dXJuIHBhZ2VzOwogIH0KICBzZXJpYWxpemVEYXRhKHN0b3JhZ2UpIHsKICAgIHJldHVybiB0aGlzLmRhdGFIYW5kbGVyLnNlcmlhbGl6ZShzdG9yYWdlKTsKICB9CiAgc3RhdGljIF9jcmVhdGVEb2N1bWVudChkYXRhKSB7CiAgICBpZiAoIWRhdGFbIi94ZHA6eGRwIl0pIHsKICAgICAgcmV0dXJuIGRhdGFbInhkcDp4ZHAiXTsKICAgIH0KICAgIHJldHVybiBPYmplY3QudmFsdWVzKGRhdGEpLmpvaW4oIiIpOwogIH0KICBzdGF0aWMgZ2V0UmljaFRleHRBc0h0bWwocmMpIHsKICAgIGlmICghcmMgfHwgdHlwZW9mIHJjICE9PSAic3RyaW5nIikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHRyeSB7CiAgICAgIGxldCByb290ID0gbmV3IFhGQVBhcnNlcihYaHRtbE5hbWVzcGFjZSwgdHJ1ZSkucGFyc2UocmMpOwogICAgICBpZiAoIVsiYm9keSIsICJ4aHRtbCJdLmluY2x1ZGVzKHJvb3RbJG5vZGVOYW1lXSkpIHsKICAgICAgICBjb25zdCBuZXdSb290ID0gWGh0bWxOYW1lc3BhY2UuYm9keSh7fSk7CiAgICAgICAgbmV3Um9vdFskYXBwZW5kQ2hpbGRdKHJvb3QpOwogICAgICAgIHJvb3QgPSBuZXdSb290OwogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdCA9IHJvb3RbJHRvSFRNTF0oKTsKICAgICAgaWYgKCFyZXN1bHQuc3VjY2VzcykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBodG1sCiAgICAgIH0gPSByZXN1bHQ7CiAgICAgIGNvbnN0IHsKICAgICAgICBhdHRyaWJ1dGVzCiAgICAgIH0gPSBodG1sOwogICAgICBpZiAoYXR0cmlidXRlcykgewogICAgICAgIGlmIChhdHRyaWJ1dGVzLmNsYXNzKSB7CiAgICAgICAgICBhdHRyaWJ1dGVzLmNsYXNzID0gYXR0cmlidXRlcy5jbGFzcy5maWx0ZXIoYXR0ciA9PiAhYXR0ci5zdGFydHNXaXRoKCJ4ZmEiKSk7CiAgICAgICAgfQogICAgICAgIGF0dHJpYnV0ZXMuZGlyID0gImF1dG8iOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgaHRtbCwKICAgICAgICBzdHI6IHJvb3RbJHRleHRdKCkKICAgICAgfTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2FybihgWEZBIC0gYW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIHBhcnNpbmcgb2YgcmljaCB0ZXh0OiAke2V9YCk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2Fubm90YXRpb24uanMKCgoKCgoKCgoKCgoKCgoKY2xhc3MgQW5ub3RhdGlvbkZhY3RvcnkgewogIHN0YXRpYyBjcmVhdGVHbG9iYWxzKHBkZk1hbmFnZXIpIHsKICAgIHJldHVybiBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhY3JvRm9ybSIpLCBwZGZNYW5hZ2VyLmVuc3VyZURvYygieGZhRGF0YXNldHMiKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJzdHJ1Y3RUcmVlUm9vdCIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImJhc2VVcmwiKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhdHRhY2htZW50cyIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImdsb2JhbENvbG9yU3BhY2VDYWNoZSIpXSkudGhlbigoW2Fjcm9Gb3JtLCB4ZmFEYXRhc2V0cywgc3RydWN0VHJlZVJvb3QsIGJhc2VVcmwsIGF0dGFjaG1lbnRzLCBnbG9iYWxDb2xvclNwYWNlQ2FjaGVdKSA9PiAoewogICAgICBwZGZNYW5hZ2VyLAogICAgICBhY3JvRm9ybTogYWNyb0Zvcm0gaW5zdGFuY2VvZiBEaWN0ID8gYWNyb0Zvcm0gOiBEaWN0LmVtcHR5LAogICAgICB4ZmFEYXRhc2V0cywKICAgICAgc3RydWN0VHJlZVJvb3QsCiAgICAgIGJhc2VVcmwsCiAgICAgIGF0dGFjaG1lbnRzLAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUKICAgIH0pLCByZWFzb24gPT4gewogICAgICB3YXJuKGBjcmVhdGVHbG9iYWxzOiAiJHtyZWFzb259Ii5gKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9KTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZSh4cmVmLCByZWYsIGFubm90YXRpb25HbG9iYWxzLCBpZEZhY3RvcnksIGNvbGxlY3RGaWVsZHMsIG9ycGhhbkZpZWxkcywgY29sbGVjdEJ5VHlwZSwgcGFnZVJlZikgewogICAgY29uc3QgcGFnZUluZGV4ID0gY29sbGVjdEZpZWxkcyA/IGF3YWl0IHRoaXMuX2dldFBhZ2VJbmRleCh4cmVmLCByZWYsIGFubm90YXRpb25HbG9iYWxzLnBkZk1hbmFnZXIpIDogbnVsbDsKICAgIHJldHVybiBhbm5vdGF0aW9uR2xvYmFscy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAiX2NyZWF0ZSIsIFt4cmVmLCByZWYsIGFubm90YXRpb25HbG9iYWxzLCBpZEZhY3RvcnksIGNvbGxlY3RGaWVsZHMsIG9ycGhhbkZpZWxkcywgY29sbGVjdEJ5VHlwZSwgcGFnZUluZGV4LCBwYWdlUmVmXSk7CiAgfQogIHN0YXRpYyBfY3JlYXRlKHhyZWYsIHJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIGlkRmFjdG9yeSwgY29sbGVjdEZpZWxkcyA9IGZhbHNlLCBvcnBoYW5GaWVsZHMgPSBudWxsLCBjb2xsZWN0QnlUeXBlID0gbnVsbCwgcGFnZUluZGV4ID0gbnVsbCwgcGFnZVJlZiA9IG51bGwpIHsKICAgIGNvbnN0IGRpY3QgPSB4cmVmLmZldGNoSWZSZWYocmVmKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgbGV0IHN1YnR5cGUgPSBkaWN0LmdldCgiU3VidHlwZSIpOwogICAgc3VidHlwZSA9IHN1YnR5cGUgaW5zdGFuY2VvZiBOYW1lID8gc3VidHlwZS5uYW1lIDogbnVsbDsKICAgIGlmIChjb2xsZWN0QnlUeXBlICYmICFjb2xsZWN0QnlUeXBlLmhhcyhBbm5vdGF0aW9uVHlwZVtzdWJ0eXBlLnRvVXBwZXJDYXNlKCldKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgYWNyb0Zvcm0sCiAgICAgIHBkZk1hbmFnZXIKICAgIH0gPSBhbm5vdGF0aW9uR2xvYmFsczsKICAgIGNvbnN0IGlkID0gcmVmIGluc3RhbmNlb2YgUmVmID8gcmVmLnRvU3RyaW5nKCkgOiBgYW5ub3RfJHtpZEZhY3RvcnkuY3JlYXRlT2JqSWQoKX1gOwogICAgY29uc3QgcGFyYW1ldGVycyA9IHsKICAgICAgeHJlZiwKICAgICAgcmVmLAogICAgICBkaWN0LAogICAgICBzdWJ0eXBlLAogICAgICBpZCwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMsCiAgICAgIGNvbGxlY3RGaWVsZHMsCiAgICAgIG9ycGhhbkZpZWxkcywKICAgICAgbmVlZEFwcGVhcmFuY2VzOiAhY29sbGVjdEZpZWxkcyAmJiBhY3JvRm9ybS5nZXQoIk5lZWRBcHBlYXJhbmNlcyIpID09PSB0cnVlLAogICAgICBwYWdlSW5kZXgsCiAgICAgIGV2YWx1YXRvck9wdGlvbnM6IHBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9ucywKICAgICAgcGFnZVJlZgogICAgfTsKICAgIHN3aXRjaCAoc3VidHlwZSkgewogICAgICBjYXNlICJMaW5rIjoKICAgICAgICByZXR1cm4gbmV3IExpbmtBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJUZXh0IjoKICAgICAgICByZXR1cm4gbmV3IFRleHRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJXaWRnZXQiOgogICAgICAgIGxldCBmaWVsZFR5cGUgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgICAgIGRpY3QsCiAgICAgICAgICBrZXk6ICJGVCIKICAgICAgICB9KTsKICAgICAgICBmaWVsZFR5cGUgPSBmaWVsZFR5cGUgaW5zdGFuY2VvZiBOYW1lID8gZmllbGRUeXBlLm5hbWUgOiBudWxsOwogICAgICAgIHN3aXRjaCAoZmllbGRUeXBlKSB7CiAgICAgICAgICBjYXNlICJUeCI6CiAgICAgICAgICAgIHJldHVybiBuZXcgVGV4dFdpZGdldEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgICAgICBjYXNlICJCdG4iOgogICAgICAgICAgICByZXR1cm4gbmV3IEJ1dHRvbldpZGdldEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgICAgICBjYXNlICJDaCI6CiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hvaWNlV2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgICAgIGNhc2UgIlNpZyI6CiAgICAgICAgICAgIHJldHVybiBuZXcgU2lnbmF0dXJlV2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgICB9CiAgICAgICAgd2FybihgVW5pbXBsZW1lbnRlZCB3aWRnZXQgZmllbGQgdHlwZSAiJHtmaWVsZFR5cGV9IiwgYCArICJmYWxsaW5nIGJhY2sgdG8gYmFzZSBmaWVsZCB0eXBlLiIpOwogICAgICAgIHJldHVybiBuZXcgV2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiUG9wdXAiOgogICAgICAgIHJldHVybiBuZXcgUG9wdXBBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJGcmVlVGV4dCI6CiAgICAgICAgcmV0dXJuIG5ldyBGcmVlVGV4dEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIkxpbmUiOgogICAgICAgIHJldHVybiBuZXcgTGluZUFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlNxdWFyZSI6CiAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJDaXJjbGUiOgogICAgICAgIHJldHVybiBuZXcgQ2lyY2xlQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiUG9seUxpbmUiOgogICAgICAgIHJldHVybiBuZXcgUG9seWxpbmVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJQb2x5Z29uIjoKICAgICAgICByZXR1cm4gbmV3IFBvbHlnb25Bbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJDYXJldCI6CiAgICAgICAgcmV0dXJuIG5ldyBDYXJldEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIkluayI6CiAgICAgICAgcmV0dXJuIG5ldyBJbmtBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJIaWdobGlnaHQiOgogICAgICAgIHJldHVybiBuZXcgSGlnaGxpZ2h0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiVW5kZXJsaW5lIjoKICAgICAgICByZXR1cm4gbmV3IFVuZGVybGluZUFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlNxdWlnZ2x5IjoKICAgICAgICByZXR1cm4gbmV3IFNxdWlnZ2x5QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiU3RyaWtlT3V0IjoKICAgICAgICByZXR1cm4gbmV3IFN0cmlrZU91dEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlN0YW1wIjoKICAgICAgICByZXR1cm4gbmV3IFN0YW1wQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiRmlsZUF0dGFjaG1lbnQiOgogICAgICAgIHJldHVybiBuZXcgRmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBkZWZhdWx0OgogICAgICAgIGlmICghY29sbGVjdEZpZWxkcykgewogICAgICAgICAgaWYgKCFzdWJ0eXBlKSB7CiAgICAgICAgICAgIHdhcm4oIkFubm90YXRpb24gaXMgbWlzc2luZyB0aGUgcmVxdWlyZWQgL1N1YnR5cGUuIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3YXJuKGBVbmltcGxlbWVudGVkIGFubm90YXRpb24gdHlwZSAiJHtzdWJ0eXBlfSIsIGAgKyAiZmFsbGluZyBiYWNrIHRvIGJhc2UgYW5ub3RhdGlvbi4iKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgX2dldFBhZ2VJbmRleCh4cmVmLCByZWYsIHBkZk1hbmFnZXIpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGFubm90RGljdCA9IGF3YWl0IHhyZWYuZmV0Y2hJZlJlZkFzeW5jKHJlZik7CiAgICAgIGlmICghKGFubm90RGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2VSZWYgPSBhbm5vdERpY3QuZ2V0UmF3KCJQIik7CiAgICAgIGlmIChwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHBhZ2VJbmRleCA9IGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZ2V0UGFnZUluZGV4IiwgW3BhZ2VSZWZdKTsKICAgICAgICAgIHJldHVybiBwYWdlSW5kZXg7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgIGluZm8oYF9nZXRQYWdlSW5kZXggLS0gbm90IGEgdmFsaWQgcGFnZSByZWZlcmVuY2U6ICIke2V4fSIuYCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChhbm5vdERpY3QuaGFzKCJLaWRzIikpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgY29uc3QgbnVtUGFnZXMgPSBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygibnVtUGFnZXMiKTsKICAgICAgZm9yIChsZXQgcGFnZUluZGV4ID0gMDsgcGFnZUluZGV4IDwgbnVtUGFnZXM7IHBhZ2VJbmRleCsrKSB7CiAgICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpOwogICAgICAgIGNvbnN0IGFubm90YXRpb25zID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmUocGFnZSwgImFubm90YXRpb25zIik7CiAgICAgICAgZm9yIChjb25zdCBhbm5vdFJlZiBvZiBhbm5vdGF0aW9ucykgewogICAgICAgICAgaWYgKGFubm90UmVmIGluc3RhbmNlb2YgUmVmICYmIGlzUmVmc0VxdWFsKGFubm90UmVmLCByZWYpKSB7CiAgICAgICAgICAgIHJldHVybiBwYWdlSW5kZXg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICB3YXJuKGBfZ2V0UGFnZUluZGV4OiAiJHtleH0iLmApOwogICAgfQogICAgcmV0dXJuIC0xOwogIH0KICBzdGF0aWMgZ2VuZXJhdGVJbWFnZXMoYW5ub3RhdGlvbnMsIHhyZWYsIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICBpZiAoIWlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgIHdhcm4oImdlbmVyYXRlSW1hZ2VzOiBPZmZzY3JlZW5DYW52YXMgaXMgbm90IHN1cHBvcnRlZCwgY2Fubm90IHNhdmUgb3IgcHJpbnQgc29tZSBhbm5vdGF0aW9ucyB3aXRoIGltYWdlcy4iKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgaW1hZ2VQcm9taXNlczsKICAgIGZvciAoY29uc3QgewogICAgICBiaXRtYXBJZCwKICAgICAgYml0bWFwCiAgICB9IG9mIGFubm90YXRpb25zKSB7CiAgICAgIGlmICghYml0bWFwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaW1hZ2VQcm9taXNlcyB8fD0gbmV3IE1hcCgpOwogICAgICBpbWFnZVByb21pc2VzLnNldChiaXRtYXBJZCwgU3RhbXBBbm5vdGF0aW9uLmNyZWF0ZUltYWdlKGJpdG1hcCwgeHJlZikpOwogICAgfQogICAgcmV0dXJuIGltYWdlUHJvbWlzZXM7CiAgfQogIHN0YXRpYyBhc3luYyBzYXZlTmV3QW5ub3RhdGlvbnMoZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9ucywgaW1hZ2VQcm9taXNlcywgY2hhbmdlcykgewogICAgY29uc3QgeHJlZiA9IGV2YWx1YXRvci54cmVmOwogICAgbGV0IGJhc2VGb250UmVmOwogICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgIGNvbnN0IHsKICAgICAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQKICAgIH0gPSBldmFsdWF0b3Iub3B0aW9uczsKICAgIGZvciAoY29uc3QgYW5ub3RhdGlvbiBvZiBhbm5vdGF0aW9ucykgewogICAgICBpZiAoYW5ub3RhdGlvbi5kZWxldGVkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChhbm5vdGF0aW9uLmFubm90YXRpb25UeXBlKSB7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5GUkVFVEVYVDoKICAgICAgICAgIGlmICghYmFzZUZvbnRSZWYpIHsKICAgICAgICAgICAgY29uc3QgYmFzZUZvbnQgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgICAgICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJCYXNlRm9udCIsICJIZWx2ZXRpY2EiKTsKICAgICAgICAgICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJUeXBlIiwgIkZvbnQiKTsKICAgICAgICAgICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIlR5cGUxIik7CiAgICAgICAgICAgIGJhc2VGb250LnNldElmTmFtZSgiRW5jb2RpbmciLCAiV2luQW5zaUVuY29kaW5nIik7CiAgICAgICAgICAgIGJhc2VGb250UmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgICAgICAgY2hhbmdlcy5wdXQoYmFzZUZvbnRSZWYsIHsKICAgICAgICAgICAgICBkYXRhOiBiYXNlRm9udAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHByb21pc2VzLnB1c2goRnJlZVRleHRBbm5vdGF0aW9uLmNyZWF0ZU5ld0Fubm90YXRpb24oeHJlZiwgYW5ub3RhdGlvbiwgY2hhbmdlcywgewogICAgICAgICAgICBldmFsdWF0b3IsCiAgICAgICAgICAgIHRhc2ssCiAgICAgICAgICAgIGJhc2VGb250UmVmCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLkhJR0hMSUdIVDoKICAgICAgICAgIGlmIChhbm5vdGF0aW9uLnF1YWRQb2ludHMpIHsKICAgICAgICAgICAgcHJvbWlzZXMucHVzaChIaWdobGlnaHRBbm5vdGF0aW9uLmNyZWF0ZU5ld0Fubm90YXRpb24oeHJlZiwgYW5ub3RhdGlvbiwgY2hhbmdlcykpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJvbWlzZXMucHVzaChJbmtBbm5vdGF0aW9uLmNyZWF0ZU5ld0Fubm90YXRpb24oeHJlZiwgYW5ub3RhdGlvbiwgY2hhbmdlcykpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5JTks6CiAgICAgICAgICBwcm9taXNlcy5wdXNoKElua0Fubm90YXRpb24uY3JlYXRlTmV3QW5ub3RhdGlvbih4cmVmLCBhbm5vdGF0aW9uLCBjaGFuZ2VzKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLlNUQU1QOgogICAgICAgICAgY29uc3QgaW1hZ2UgPSBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA/IGF3YWl0IGltYWdlUHJvbWlzZXM/LmdldChhbm5vdGF0aW9uLmJpdG1hcElkKSA6IG51bGw7CiAgICAgICAgICBpZiAoaW1hZ2U/LmltYWdlU3RyZWFtKSB7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICBpbWFnZVN0cmVhbSwKICAgICAgICAgICAgICBzbWFza1N0cmVhbQogICAgICAgICAgICB9ID0gaW1hZ2U7CiAgICAgICAgICAgIGlmIChzbWFza1N0cmVhbSkgewogICAgICAgICAgICAgIGNvbnN0IHNtYXNrUmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgICAgICAgICBjaGFuZ2VzLnB1dChzbWFza1JlZiwgewogICAgICAgICAgICAgICAgZGF0YTogc21hc2tTdHJlYW0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpbWFnZVN0cmVhbS5kaWN0LnNldCgiU01hc2siLCBzbWFza1JlZik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaW1hZ2VSZWYgPSBpbWFnZS5pbWFnZVJlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgICAgICAgIGNoYW5nZXMucHV0KGltYWdlUmVmLCB7CiAgICAgICAgICAgICAgZGF0YTogaW1hZ2VTdHJlYW0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGltYWdlLmltYWdlU3RyZWFtID0gaW1hZ2Uuc21hc2tTdHJlYW0gPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgcHJvbWlzZXMucHVzaChTdGFtcEFubm90YXRpb24uY3JlYXRlTmV3QW5ub3RhdGlvbih4cmVmLCBhbm5vdGF0aW9uLCBjaGFuZ2VzLCB7CiAgICAgICAgICAgIGltYWdlCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLlNJR05BVFVSRToKICAgICAgICAgIHByb21pc2VzLnB1c2goU3RhbXBBbm5vdGF0aW9uLmNyZWF0ZU5ld0Fubm90YXRpb24oeHJlZiwgYW5ub3RhdGlvbiwgY2hhbmdlcywge30pKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBhbm5vdGF0aW9uczogKGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKSkuZmxhdCgpCiAgICB9OwogIH0KICBzdGF0aWMgYXN5bmMgcHJpbnROZXdBbm5vdGF0aW9ucyhhbm5vdGF0aW9uR2xvYmFscywgZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9ucywgaW1hZ2VQcm9taXNlcykgewogICAgaWYgKCFhbm5vdGF0aW9ucykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgb3B0aW9ucywKICAgICAgeHJlZgogICAgfSA9IGV2YWx1YXRvcjsKICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKGFubm90YXRpb24uZGVsZXRlZCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHN3aXRjaCAoYW5ub3RhdGlvbi5hbm5vdGF0aW9uVHlwZSkgewogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuRlJFRVRFWFQ6CiAgICAgICAgICBwcm9taXNlcy5wdXNoKEZyZWVUZXh0QW5ub3RhdGlvbi5jcmVhdGVOZXdQcmludEFubm90YXRpb24oYW5ub3RhdGlvbkdsb2JhbHMsIHhyZWYsIGFubm90YXRpb24sIHsKICAgICAgICAgICAgZXZhbHVhdG9yLAogICAgICAgICAgICB0YXNrLAogICAgICAgICAgICBldmFsdWF0b3JPcHRpb25zOiBvcHRpb25zCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLkhJR0hMSUdIVDoKICAgICAgICAgIGlmIChhbm5vdGF0aW9uLnF1YWRQb2ludHMpIHsKICAgICAgICAgICAgcHJvbWlzZXMucHVzaChIaWdobGlnaHRBbm5vdGF0aW9uLmNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgewogICAgICAgICAgICAgIGV2YWx1YXRvck9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJvbWlzZXMucHVzaChJbmtBbm5vdGF0aW9uLmNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgewogICAgICAgICAgICAgIGV2YWx1YXRvck9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5JTks6CiAgICAgICAgICBwcm9taXNlcy5wdXNoKElua0Fubm90YXRpb24uY3JlYXRlTmV3UHJpbnRBbm5vdGF0aW9uKGFubm90YXRpb25HbG9iYWxzLCB4cmVmLCBhbm5vdGF0aW9uLCB7CiAgICAgICAgICAgIGV2YWx1YXRvck9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgIH0pKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuU1RBTVA6CiAgICAgICAgICBjb25zdCBpbWFnZSA9IG9wdGlvbnMuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPyBhd2FpdCBpbWFnZVByb21pc2VzPy5nZXQoYW5ub3RhdGlvbi5iaXRtYXBJZCkgOiBudWxsOwogICAgICAgICAgaWYgKGltYWdlPy5pbWFnZVN0cmVhbSkgewogICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgaW1hZ2VTdHJlYW0sCiAgICAgICAgICAgICAgc21hc2tTdHJlYW0KICAgICAgICAgICAgfSA9IGltYWdlOwogICAgICAgICAgICBpZiAoc21hc2tTdHJlYW0pIHsKICAgICAgICAgICAgICBpbWFnZVN0cmVhbS5kaWN0LnNldCgiU01hc2siLCBzbWFza1N0cmVhbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW1hZ2UuaW1hZ2VSZWYgPSBuZXcgSnBlZ1N0cmVhbShpbWFnZVN0cmVhbSwgaW1hZ2VTdHJlYW0ubGVuZ3RoKTsKICAgICAgICAgICAgaW1hZ2UuaW1hZ2VTdHJlYW0gPSBpbWFnZS5zbWFza1N0cmVhbSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBwcm9taXNlcy5wdXNoKFN0YW1wQW5ub3RhdGlvbi5jcmVhdGVOZXdQcmludEFubm90YXRpb24oYW5ub3RhdGlvbkdsb2JhbHMsIHhyZWYsIGFubm90YXRpb24sIHsKICAgICAgICAgICAgaW1hZ2UsCiAgICAgICAgICAgIGV2YWx1YXRvck9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgIH0pKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuU0lHTkFUVVJFOgogICAgICAgICAgcHJvbWlzZXMucHVzaChTdGFtcEFubm90YXRpb24uY3JlYXRlTmV3UHJpbnRBbm5vdGF0aW9uKGFubm90YXRpb25HbG9iYWxzLCB4cmVmLCBhbm5vdGF0aW9uLCB7CiAgICAgICAgICAgIGV2YWx1YXRvck9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgIH0pKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogIH0KfQpmdW5jdGlvbiBnZXRSZ2JDb2xvcihjb2xvciwgZGVmYXVsdENvbG9yID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpKSB7CiAgaWYgKCFBcnJheS5pc0FycmF5KGNvbG9yKSkgewogICAgcmV0dXJuIGRlZmF1bHRDb2xvcjsKICB9CiAgY29uc3QgcmdiQ29sb3IgPSBkZWZhdWx0Q29sb3IgfHwgbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwogIHN3aXRjaCAoY29sb3IubGVuZ3RoKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBudWxsOwogICAgY2FzZSAxOgogICAgICBDb2xvclNwYWNlVXRpbHMuZ3JheS5nZXRSZ2JJdGVtKGNvbG9yLCAwLCByZ2JDb2xvciwgMCk7CiAgICAgIHJldHVybiByZ2JDb2xvcjsKICAgIGNhc2UgMzoKICAgICAgQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JJdGVtKGNvbG9yLCAwLCByZ2JDb2xvciwgMCk7CiAgICAgIHJldHVybiByZ2JDb2xvcjsKICAgIGNhc2UgNDoKICAgICAgQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiSXRlbShjb2xvciwgMCwgcmdiQ29sb3IsIDApOwogICAgICByZXR1cm4gcmdiQ29sb3I7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gZGVmYXVsdENvbG9yOwogIH0KfQpmdW5jdGlvbiBnZXRQZGZDb2xvckFycmF5KGNvbG9yLCBkZWZhdWx0VmFsdWUgPSBudWxsKSB7CiAgcmV0dXJuIGNvbG9yICYmIEFycmF5LmZyb20oY29sb3IsIGMgPT4gYyAvIDI1NSkgfHwgZGVmYXVsdFZhbHVlOwp9CmZ1bmN0aW9uIGdldFF1YWRQb2ludHMoZGljdCwgcmVjdCkgewogIGNvbnN0IHF1YWRQb2ludHMgPSBkaWN0LmdldEFycmF5KCJRdWFkUG9pbnRzIik7CiAgaWYgKCFpc051bWJlckFycmF5KHF1YWRQb2ludHMsIG51bGwpIHx8IHF1YWRQb2ludHMubGVuZ3RoID09PSAwIHx8IHF1YWRQb2ludHMubGVuZ3RoICUgOCA+IDApIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBuZXdRdWFkUG9pbnRzID0gbmV3IEZsb2F0MzJBcnJheShxdWFkUG9pbnRzLmxlbmd0aCk7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gcXVhZFBvaW50cy5sZW5ndGg7IGkgPCBpaTsgaSArPSA4KSB7CiAgICBjb25zdCBbeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgeDQsIHk0XSA9IHF1YWRQb2ludHMuc2xpY2UoaSwgaSArIDgpOwogICAgY29uc3QgbWluWCA9IE1hdGgubWluKHgxLCB4MiwgeDMsIHg0KTsKICAgIGNvbnN0IG1heFggPSBNYXRoLm1heCh4MSwgeDIsIHgzLCB4NCk7CiAgICBjb25zdCBtaW5ZID0gTWF0aC5taW4oeTEsIHkyLCB5MywgeTQpOwogICAgY29uc3QgbWF4WSA9IE1hdGgubWF4KHkxLCB5MiwgeTMsIHk0KTsKICAgIGlmIChyZWN0ICE9PSBudWxsICYmIChtaW5YIDwgcmVjdFswXSB8fCBtYXhYID4gcmVjdFsyXSB8fCBtaW5ZIDwgcmVjdFsxXSB8fCBtYXhZID4gcmVjdFszXSkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBuZXdRdWFkUG9pbnRzLnNldChbbWluWCwgbWF4WSwgbWF4WCwgbWF4WSwgbWluWCwgbWluWSwgbWF4WCwgbWluWV0sIGkpOwogIH0KICByZXR1cm4gbmV3UXVhZFBvaW50czsKfQpmdW5jdGlvbiBnZXRUcmFuc2Zvcm1NYXRyaXgocmVjdCwgYmJveCwgbWF0cml4KSB7CiAgY29uc3QgbWluTWF4ID0gbmV3IEZsb2F0MzJBcnJheShbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV0pOwogIFV0aWwuYXhpYWxBbGlnbmVkQm91bmRpbmdCb3goYmJveCwgbWF0cml4LCBtaW5NYXgpOwogIGNvbnN0IFttaW5YLCBtaW5ZLCBtYXhYLCBtYXhZXSA9IG1pbk1heDsKICBpZiAobWluWCA9PT0gbWF4WCB8fCBtaW5ZID09PSBtYXhZKSB7CiAgICByZXR1cm4gWzEsIDAsIDAsIDEsIHJlY3RbMF0sIHJlY3RbMV1dOwogIH0KICBjb25zdCB4UmF0aW8gPSAocmVjdFsyXSAtIHJlY3RbMF0pIC8gKG1heFggLSBtaW5YKTsKICBjb25zdCB5UmF0aW8gPSAocmVjdFszXSAtIHJlY3RbMV0pIC8gKG1heFkgLSBtaW5ZKTsKICByZXR1cm4gW3hSYXRpbywgMCwgMCwgeVJhdGlvLCByZWN0WzBdIC0gbWluWCAqIHhSYXRpbywgcmVjdFsxXSAtIG1pblkgKiB5UmF0aW9dOwp9CmNsYXNzIEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmLAogICAgICBhbm5vdGF0aW9uR2xvYmFscywKICAgICAgcmVmLAogICAgICBvcnBoYW5GaWVsZHMKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBwYXJlbnRSZWYgPSBvcnBoYW5GaWVsZHM/LmdldChyZWYpOwogICAgaWYgKHBhcmVudFJlZikgewogICAgICBkaWN0LnNldCgiUGFyZW50IiwgcGFyZW50UmVmKTsKICAgIH0KICAgIHRoaXMuc2V0VGl0bGUoZGljdC5nZXQoIlQiKSk7CiAgICB0aGlzLnNldENvbnRlbnRzKGRpY3QuZ2V0KCJDb250ZW50cyIpKTsKICAgIHRoaXMuc2V0TW9kaWZpY2F0aW9uRGF0ZShkaWN0LmdldCgiTSIpKTsKICAgIHRoaXMuc2V0RmxhZ3MoZGljdC5nZXQoIkYiKSk7CiAgICB0aGlzLnNldFJlY3RhbmdsZShkaWN0LmdldEFycmF5KCJSZWN0IikpOwogICAgdGhpcy5zZXRDb2xvcihkaWN0LmdldEFycmF5KCJDIikpOwogICAgdGhpcy5zZXRCb3JkZXJTdHlsZShkaWN0KTsKICAgIHRoaXMuc2V0QXBwZWFyYW5jZShkaWN0KTsKICAgIHRoaXMuc2V0T3B0aW9uYWxDb250ZW50KGRpY3QpOwogICAgY29uc3QgTUsgPSBkaWN0LmdldCgiTUsiKTsKICAgIHRoaXMuc2V0Qm9yZGVyQW5kQmFja2dyb3VuZENvbG9ycyhNSyk7CiAgICB0aGlzLnNldFJvdGF0aW9uKE1LLCBkaWN0KTsKICAgIHRoaXMucmVmID0gcGFyYW1zLnJlZiBpbnN0YW5jZW9mIFJlZiA/IHBhcmFtcy5yZWYgOiBudWxsOwogICAgdGhpcy5fc3RyZWFtcyA9IFtdOwogICAgaWYgKHRoaXMuYXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5hcHBlYXJhbmNlKTsKICAgIH0KICAgIGNvbnN0IGlzTG9ja2VkID0gISEodGhpcy5mbGFncyAmIEFubm90YXRpb25GbGFnLkxPQ0tFRCk7CiAgICBjb25zdCBpc0NvbnRlbnRMb2NrZWQgPSAhISh0aGlzLmZsYWdzICYgQW5ub3RhdGlvbkZsYWcuTE9DS0VEQ09OVEVOVFMpOwogICAgdGhpcy5kYXRhID0gewogICAgICBhbm5vdGF0aW9uRmxhZ3M6IHRoaXMuZmxhZ3MsCiAgICAgIGJvcmRlclN0eWxlOiB0aGlzLmJvcmRlclN0eWxlLAogICAgICBjb2xvcjogdGhpcy5jb2xvciwKICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGlzLmJhY2tncm91bmRDb2xvciwKICAgICAgYm9yZGVyQ29sb3I6IHRoaXMuYm9yZGVyQ29sb3IsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICBjb250ZW50c09iajogdGhpcy5fY29udGVudHMsCiAgICAgIGhhc0FwcGVhcmFuY2U6ICEhdGhpcy5hcHBlYXJhbmNlLAogICAgICBpZDogcGFyYW1zLmlkLAogICAgICBtb2RpZmljYXRpb25EYXRlOiB0aGlzLm1vZGlmaWNhdGlvbkRhdGUsCiAgICAgIHJlY3Q6IHRoaXMucmVjdGFuZ2xlLAogICAgICBzdWJ0eXBlOiBwYXJhbXMuc3VidHlwZSwKICAgICAgaGFzT3duQ2FudmFzOiBmYWxzZSwKICAgICAgbm9Sb3RhdGU6ICEhKHRoaXMuZmxhZ3MgJiBBbm5vdGF0aW9uRmxhZy5OT1JPVEFURSksCiAgICAgIG5vSFRNTDogaXNMb2NrZWQgJiYgaXNDb250ZW50TG9ja2VkLAogICAgICBpc0VkaXRhYmxlOiBmYWxzZSwKICAgICAgc3RydWN0UGFyZW50OiAtMQogICAgfTsKICAgIGlmIChhbm5vdGF0aW9uR2xvYmFscy5zdHJ1Y3RUcmVlUm9vdCkgewogICAgICBsZXQgc3RydWN0UGFyZW50ID0gZGljdC5nZXQoIlN0cnVjdFBhcmVudCIpOwogICAgICB0aGlzLmRhdGEuc3RydWN0UGFyZW50ID0gc3RydWN0UGFyZW50ID0gTnVtYmVyLmlzSW50ZWdlcihzdHJ1Y3RQYXJlbnQpICYmIHN0cnVjdFBhcmVudCA+PSAwID8gc3RydWN0UGFyZW50IDogLTE7CiAgICAgIGFubm90YXRpb25HbG9iYWxzLnN0cnVjdFRyZWVSb290LmFkZEFubm90YXRpb25JZFRvUGFnZShwYXJhbXMucGFnZVJlZiwgc3RydWN0UGFyZW50KTsKICAgIH0KICAgIGlmIChwYXJhbXMuY29sbGVjdEZpZWxkcykgewogICAgICBjb25zdCBraWRzID0gZGljdC5nZXQoIktpZHMiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICBjb25zdCBraWRJZHMgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IGtpZCBvZiBraWRzKSB7CiAgICAgICAgICBpZiAoa2lkIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIGtpZElkcy5wdXNoKGtpZC50b1N0cmluZygpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGtpZElkcy5sZW5ndGggIT09IDApIHsKICAgICAgICAgIHRoaXMuZGF0YS5raWRJZHMgPSBraWRJZHM7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZGF0YS5hY3Rpb25zID0gY29sbGVjdEFjdGlvbnMoeHJlZiwgZGljdCwgQW5ub3RhdGlvbkFjdGlvbkV2ZW50VHlwZSk7CiAgICAgIHRoaXMuZGF0YS5maWVsZE5hbWUgPSB0aGlzLl9jb25zdHJ1Y3RGaWVsZE5hbWUoZGljdCk7CiAgICAgIHRoaXMuZGF0YS5wYWdlSW5kZXggPSBwYXJhbXMucGFnZUluZGV4OwogICAgfQogICAgY29uc3QgaXQgPSBkaWN0LmdldCgiSVQiKTsKICAgIGlmIChpdCBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgdGhpcy5kYXRhLml0ID0gaXQubmFtZTsKICAgIH0KICAgIHRoaXMuX2lzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID0gcGFyYW1zLmV2YWx1YXRvck9wdGlvbnMuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ7CiAgICB0aGlzLl9mYWxsYmFja0ZvbnREaWN0ID0gbnVsbDsKICAgIHRoaXMuX25lZWRBcHBlYXJhbmNlcyA9IGZhbHNlOwogIH0KICBfaGFzRmxhZyhmbGFncywgZmxhZykgewogICAgcmV0dXJuICEhKGZsYWdzICYgZmxhZyk7CiAgfQogIF9idWlsZEZsYWdzKG5vVmlldywgbm9QcmludCkgewogICAgbGV0IHsKICAgICAgZmxhZ3MKICAgIH0gPSB0aGlzOwogICAgaWYgKG5vVmlldyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmIChub1ByaW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGlmIChub1ByaW50KSB7CiAgICAgICAgcmV0dXJuIGZsYWdzICYgfkFubm90YXRpb25GbGFnLlBSSU5UOwogICAgICB9CiAgICAgIHJldHVybiBmbGFncyAmIH5Bbm5vdGF0aW9uRmxhZy5ISURERU4gfCBBbm5vdGF0aW9uRmxhZy5QUklOVDsKICAgIH0KICAgIGlmIChub1ZpZXcpIHsKICAgICAgZmxhZ3MgfD0gQW5ub3RhdGlvbkZsYWcuUFJJTlQ7CiAgICAgIGlmIChub1ByaW50KSB7CiAgICAgICAgcmV0dXJuIGZsYWdzICYgfkFubm90YXRpb25GbGFnLk5PVklFVyB8IEFubm90YXRpb25GbGFnLkhJRERFTjsKICAgICAgfQogICAgICByZXR1cm4gZmxhZ3MgJiB+QW5ub3RhdGlvbkZsYWcuSElEREVOIHwgQW5ub3RhdGlvbkZsYWcuTk9WSUVXOwogICAgfQogICAgZmxhZ3MgJj0gfihBbm5vdGF0aW9uRmxhZy5ISURERU4gfCBBbm5vdGF0aW9uRmxhZy5OT1ZJRVcpOwogICAgaWYgKG5vUHJpbnQpIHsKICAgICAgcmV0dXJuIGZsYWdzICYgfkFubm90YXRpb25GbGFnLlBSSU5UOwogICAgfQogICAgcmV0dXJuIGZsYWdzIHwgQW5ub3RhdGlvbkZsYWcuUFJJTlQ7CiAgfQogIF9pc1ZpZXdhYmxlKGZsYWdzKSB7CiAgICByZXR1cm4gIXRoaXMuX2hhc0ZsYWcoZmxhZ3MsIEFubm90YXRpb25GbGFnLklOVklTSUJMRSkgJiYgIXRoaXMuX2hhc0ZsYWcoZmxhZ3MsIEFubm90YXRpb25GbGFnLk5PVklFVyk7CiAgfQogIF9pc1ByaW50YWJsZShmbGFncykgewogICAgcmV0dXJuIHRoaXMuX2hhc0ZsYWcoZmxhZ3MsIEFubm90YXRpb25GbGFnLlBSSU5UKSAmJiAhdGhpcy5faGFzRmxhZyhmbGFncywgQW5ub3RhdGlvbkZsYWcuSElEREVOKSAmJiAhdGhpcy5faGFzRmxhZyhmbGFncywgQW5ub3RhdGlvbkZsYWcuSU5WSVNJQkxFKTsKICB9CiAgbXVzdEJlVmlld2VkKGFubm90YXRpb25TdG9yYWdlLCBfcmVuZGVyRm9ybXMpIHsKICAgIGNvbnN0IG5vVmlldyA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKT8ubm9WaWV3OwogICAgaWYgKG5vVmlldyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiAhbm9WaWV3OwogICAgfQogICAgcmV0dXJuIHRoaXMudmlld2FibGUgJiYgIXRoaXMuX2hhc0ZsYWcodGhpcy5mbGFncywgQW5ub3RhdGlvbkZsYWcuSElEREVOKTsKICB9CiAgbXVzdEJlUHJpbnRlZChhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgY29uc3Qgbm9QcmludCA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKT8ubm9QcmludDsKICAgIGlmIChub1ByaW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuICFub1ByaW50OwogICAgfQogICAgcmV0dXJuIHRoaXMucHJpbnRhYmxlOwogIH0KICBtdXN0QmVWaWV3ZWRXaGVuRWRpdGluZyhpc0VkaXRpbmcsIG1vZGlmaWVkSWRzID0gbnVsbCkgewogICAgcmV0dXJuIGlzRWRpdGluZyA/ICF0aGlzLmRhdGEuaXNFZGl0YWJsZSA6ICFtb2RpZmllZElkcz8uaGFzKHRoaXMuZGF0YS5pZCk7CiAgfQogIGdldCB2aWV3YWJsZSgpIHsKICAgIGlmICh0aGlzLmRhdGEucXVhZFBvaW50cyA9PT0gbnVsbCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5mbGFncyA9PT0gMCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9pc1ZpZXdhYmxlKHRoaXMuZmxhZ3MpOwogIH0KICBnZXQgcHJpbnRhYmxlKCkgewogICAgaWYgKHRoaXMuZGF0YS5xdWFkUG9pbnRzID09PSBudWxsKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLmZsYWdzID09PSAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9pc1ByaW50YWJsZSh0aGlzLmZsYWdzKTsKICB9CiAgX3BhcnNlU3RyaW5nSGVscGVyKGRhdGEpIHsKICAgIGNvbnN0IHN0ciA9IHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiA/IHN0cmluZ1RvUERGU3RyaW5nKGRhdGEpIDogIiI7CiAgICBjb25zdCBkaXIgPSBzdHIgJiYgYmlkaShzdHIpLmRpciA9PT0gInJ0bCIgPyAicnRsIiA6ICJsdHIiOwogICAgcmV0dXJuIHsKICAgICAgc3RyLAogICAgICBkaXIKICAgIH07CiAgfQogIHNldERlZmF1bHRBcHBlYXJhbmNlKHBhcmFtcykgewogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICBhbm5vdGF0aW9uR2xvYmFscwogICAgfSA9IHBhcmFtczsKICAgIGNvbnN0IGRlZmF1bHRBcHBlYXJhbmNlID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkRBIgogICAgfSkgfHwgYW5ub3RhdGlvbkdsb2JhbHMuYWNyb0Zvcm0uZ2V0KCJEQSIpOwogICAgdGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UgPSB0eXBlb2YgZGVmYXVsdEFwcGVhcmFuY2UgPT09ICJzdHJpbmciID8gZGVmYXVsdEFwcGVhcmFuY2UgOiAiIjsKICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEgPSBwYXJzZURlZmF1bHRBcHBlYXJhbmNlKHRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlKTsKICB9CiAgc2V0VGl0bGUodGl0bGUpIHsKICAgIHRoaXMuX3RpdGxlID0gdGhpcy5fcGFyc2VTdHJpbmdIZWxwZXIodGl0bGUpOwogIH0KICBzZXRDb250ZW50cyhjb250ZW50cykgewogICAgdGhpcy5fY29udGVudHMgPSB0aGlzLl9wYXJzZVN0cmluZ0hlbHBlcihjb250ZW50cyk7CiAgfQogIHNldE1vZGlmaWNhdGlvbkRhdGUobW9kaWZpY2F0aW9uRGF0ZSkgewogICAgdGhpcy5tb2RpZmljYXRpb25EYXRlID0gdHlwZW9mIG1vZGlmaWNhdGlvbkRhdGUgPT09ICJzdHJpbmciID8gbW9kaWZpY2F0aW9uRGF0ZSA6IG51bGw7CiAgfQogIHNldEZsYWdzKGZsYWdzKSB7CiAgICB0aGlzLmZsYWdzID0gTnVtYmVyLmlzSW50ZWdlcihmbGFncykgJiYgZmxhZ3MgPiAwID8gZmxhZ3MgOiAwOwogICAgaWYgKHRoaXMuZmxhZ3MgJiBBbm5vdGF0aW9uRmxhZy5JTlZJU0lCTEUgJiYgdGhpcy5jb25zdHJ1Y3Rvci5uYW1lICE9PSAiQW5ub3RhdGlvbiIpIHsKICAgICAgdGhpcy5mbGFncyBePSBBbm5vdGF0aW9uRmxhZy5JTlZJU0lCTEU7CiAgICB9CiAgfQogIGhhc0ZsYWcoZmxhZykgewogICAgcmV0dXJuIHRoaXMuX2hhc0ZsYWcodGhpcy5mbGFncywgZmxhZyk7CiAgfQogIHNldFJlY3RhbmdsZShyZWN0YW5nbGUpIHsKICAgIHRoaXMucmVjdGFuZ2xlID0gbG9va3VwTm9ybWFsUmVjdChyZWN0YW5nbGUsIFswLCAwLCAwLCAwXSk7CiAgfQogIHNldENvbG9yKGNvbG9yKSB7CiAgICB0aGlzLmNvbG9yID0gZ2V0UmdiQ29sb3IoY29sb3IpOwogIH0KICBzZXRMaW5lRW5kaW5ncyhsaW5lRW5kaW5ncykgewogICAgdGhpcy5saW5lRW5kaW5ncyA9IFsiTm9uZSIsICJOb25lIl07CiAgICBpZiAoQXJyYXkuaXNBcnJheShsaW5lRW5kaW5ncykgJiYgbGluZUVuZGluZ3MubGVuZ3RoID09PSAyKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjsgaSsrKSB7CiAgICAgICAgY29uc3Qgb2JqID0gbGluZUVuZGluZ3NbaV07CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgIHN3aXRjaCAob2JqLm5hbWUpIHsKICAgICAgICAgICAgY2FzZSAiTm9uZSI6CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgIlNxdWFyZSI6CiAgICAgICAgICAgIGNhc2UgIkNpcmNsZSI6CiAgICAgICAgICAgIGNhc2UgIkRpYW1vbmQiOgogICAgICAgICAgICBjYXNlICJPcGVuQXJyb3ciOgogICAgICAgICAgICBjYXNlICJDbG9zZWRBcnJvdyI6CiAgICAgICAgICAgIGNhc2UgIkJ1dHQiOgogICAgICAgICAgICBjYXNlICJST3BlbkFycm93IjoKICAgICAgICAgICAgY2FzZSAiUkNsb3NlZEFycm93IjoKICAgICAgICAgICAgY2FzZSAiU2xhc2giOgogICAgICAgICAgICAgIHRoaXMubGluZUVuZGluZ3NbaV0gPSBvYmoubmFtZTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgd2FybihgSWdub3JpbmcgaW52YWxpZCBsaW5lRW5kaW5nOiAke29ian1gKTsKICAgICAgfQogICAgfQogIH0KICBzZXRSb3RhdGlvbihtaywgZGljdCkgewogICAgdGhpcy5yb3RhdGlvbiA9IDA7CiAgICBsZXQgYW5nbGUgPSBtayBpbnN0YW5jZW9mIERpY3QgPyBtay5nZXQoIlIiKSB8fCAwIDogZGljdC5nZXQoIlJvdGF0ZSIpIHx8IDA7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihhbmdsZSkgJiYgYW5nbGUgIT09IDApIHsKICAgICAgYW5nbGUgJT0gMzYwOwogICAgICBpZiAoYW5nbGUgPCAwKSB7CiAgICAgICAgYW5nbGUgKz0gMzYwOwogICAgICB9CiAgICAgIGlmIChhbmdsZSAlIDkwID09PSAwKSB7CiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IGFuZ2xlOwogICAgICB9CiAgICB9CiAgfQogIHNldEJvcmRlckFuZEJhY2tncm91bmRDb2xvcnMobWspIHsKICAgIGlmIChtayBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgdGhpcy5ib3JkZXJDb2xvciA9IGdldFJnYkNvbG9yKG1rLmdldEFycmF5KCJCQyIpLCBudWxsKTsKICAgICAgdGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBnZXRSZ2JDb2xvcihtay5nZXRBcnJheSgiQkciKSwgbnVsbCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmJvcmRlckNvbG9yID0gdGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBudWxsOwogICAgfQogIH0KICBzZXRCb3JkZXJTdHlsZShib3JkZXJTdHlsZSkgewogICAgdGhpcy5ib3JkZXJTdHlsZSA9IG5ldyBBbm5vdGF0aW9uQm9yZGVyU3R5bGUoKTsKICAgIGlmICghKGJvcmRlclN0eWxlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGJvcmRlclN0eWxlLmhhcygiQlMiKSkgewogICAgICBjb25zdCBkaWN0ID0gYm9yZGVyU3R5bGUuZ2V0KCJCUyIpOwogICAgICBpZiAoZGljdCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBjb25zdCBkaWN0VHlwZSA9IGRpY3QuZ2V0KCJUeXBlIik7CiAgICAgICAgaWYgKCFkaWN0VHlwZSB8fCBpc05hbWUoZGljdFR5cGUsICJCb3JkZXIiKSkgewogICAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXRXaWR0aChkaWN0LmdldCgiVyIpLCB0aGlzLnJlY3RhbmdsZSk7CiAgICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldFN0eWxlKGRpY3QuZ2V0KCJTIikpOwogICAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXREYXNoQXJyYXkoZGljdC5nZXRBcnJheSgiRCIpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoYm9yZGVyU3R5bGUuaGFzKCJCb3JkZXIiKSkgewogICAgICBjb25zdCBhcnJheSA9IGJvcmRlclN0eWxlLmdldEFycmF5KCJCb3JkZXIiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyYXkpICYmIGFycmF5Lmxlbmd0aCA+PSAzKSB7CiAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXRIb3Jpem9udGFsQ29ybmVyUmFkaXVzKGFycmF5WzBdKTsKICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldFZlcnRpY2FsQ29ybmVyUmFkaXVzKGFycmF5WzFdKTsKICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldFdpZHRoKGFycmF5WzJdLCB0aGlzLnJlY3RhbmdsZSk7CiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXREYXNoQXJyYXkoYXJyYXlbM10sIHRydWUpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXRXaWR0aCgwKTsKICAgIH0KICB9CiAgc2V0QXBwZWFyYW5jZShkaWN0KSB7CiAgICB0aGlzLmFwcGVhcmFuY2UgPSBudWxsOwogICAgY29uc3QgYXBwZWFyYW5jZVN0YXRlcyA9IGRpY3QuZ2V0KCJBUCIpOwogICAgaWYgKCEoYXBwZWFyYW5jZVN0YXRlcyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG5vcm1hbEFwcGVhcmFuY2VTdGF0ZSA9IGFwcGVhcmFuY2VTdGF0ZXMuZ2V0KCJOIik7CiAgICBpZiAobm9ybWFsQXBwZWFyYW5jZVN0YXRlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICB0aGlzLmFwcGVhcmFuY2UgPSBub3JtYWxBcHBlYXJhbmNlU3RhdGU7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghKG5vcm1hbEFwcGVhcmFuY2VTdGF0ZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFzID0gZGljdC5nZXQoIkFTIik7CiAgICBpZiAoIShhcyBpbnN0YW5jZW9mIE5hbWUpIHx8ICFub3JtYWxBcHBlYXJhbmNlU3RhdGUuaGFzKGFzLm5hbWUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBub3JtYWxBcHBlYXJhbmNlU3RhdGUuZ2V0KGFzLm5hbWUpOwogICAgaWYgKGFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgIHRoaXMuYXBwZWFyYW5jZSA9IGFwcGVhcmFuY2U7CiAgICB9CiAgfQogIHNldE9wdGlvbmFsQ29udGVudChkaWN0KSB7CiAgICB0aGlzLm9jID0gbnVsbDsKICAgIGNvbnN0IG9jID0gZGljdC5nZXQoIk9DIik7CiAgICBpZiAob2MgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIHdhcm4oInNldE9wdGlvbmFsQ29udGVudDogU3VwcG9ydCBmb3IgL05hbWUtZW50cnkgaXMgbm90IGltcGxlbWVudGVkLiIpOwogICAgfSBlbHNlIGlmIChvYyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgdGhpcy5vYyA9IG9jOwogICAgfQogIH0KICBhc3luYyBsb2FkUmVzb3VyY2VzKGtleXMsIGFwcGVhcmFuY2UpIHsKICAgIGNvbnN0IHJlc291cmNlcyA9IGF3YWl0IGFwcGVhcmFuY2UuZGljdC5nZXRBc3luYygiUmVzb3VyY2VzIik7CiAgICBpZiAocmVzb3VyY2VzKSB7CiAgICAgIGF3YWl0IE9iamVjdExvYWRlci5sb2FkKHJlc291cmNlcywga2V5cywgcmVzb3VyY2VzLnhyZWYpOwogICAgfQogICAgcmV0dXJuIHJlc291cmNlczsKICB9CiAgYXN5bmMgZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgY29uc3QgewogICAgICBoYXNPd25DYW52YXMsCiAgICAgIGlkLAogICAgICByZWN0CiAgICB9ID0gdGhpcy5kYXRhOwogICAgbGV0IGFwcGVhcmFuY2UgPSB0aGlzLmFwcGVhcmFuY2U7CiAgICBjb25zdCBpc1VzaW5nT3duQ2FudmFzID0gISEoaGFzT3duQ2FudmFzICYmIGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuRElTUExBWSk7CiAgICBpZiAoaXNVc2luZ093bkNhbnZhcyAmJiAodGhpcy53aWR0aCA9PT0gMCB8fCB0aGlzLmhlaWdodCA9PT0gMCkpIHsKICAgICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IGZhbHNlOwogICAgICByZXR1cm4gewogICAgICAgIG9wTGlzdDogbmV3IE9wZXJhdG9yTGlzdCgpLAogICAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgICAgc2VwYXJhdGVDYW52YXM6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICBpZiAoIWFwcGVhcmFuY2UpIHsKICAgICAgaWYgKCFpc1VzaW5nT3duQ2FudmFzKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG9wTGlzdDogbmV3IE9wZXJhdG9yTGlzdCgpLAogICAgICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0KICAgICAgYXBwZWFyYW5jZSA9IG5ldyBTdHJpbmdTdHJlYW0oIiIpOwogICAgICBhcHBlYXJhbmNlLmRpY3QgPSBuZXcgRGljdCgpOwogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZURpY3QgPSBhcHBlYXJhbmNlLmRpY3Q7CiAgICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCB0aGlzLmxvYWRSZXNvdXJjZXMoUkVTT1VSQ0VTX0tFWVNfT1BFUkFUT1JfTElTVCwgYXBwZWFyYW5jZSk7CiAgICBjb25zdCBiYm94ID0gbG9va3VwUmVjdChhcHBlYXJhbmNlRGljdC5nZXRBcnJheSgiQkJveCIpLCBbMCwgMCwgMSwgMV0pOwogICAgY29uc3QgbWF0cml4ID0gbG9va3VwTWF0cml4KGFwcGVhcmFuY2VEaWN0LmdldEFycmF5KCJNYXRyaXgiKSwgSURFTlRJVFlfTUFUUklYKTsKICAgIGNvbnN0IHRyYW5zZm9ybSA9IGdldFRyYW5zZm9ybU1hdHJpeChyZWN0LCBiYm94LCBtYXRyaXgpOwogICAgY29uc3Qgb3BMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgbGV0IG9wdGlvbmFsQ29udGVudDsKICAgIGlmICh0aGlzLm9jKSB7CiAgICAgIG9wdGlvbmFsQ29udGVudCA9IGF3YWl0IGV2YWx1YXRvci5wYXJzZU1hcmtlZENvbnRlbnRQcm9wcyh0aGlzLm9jLCBudWxsKTsKICAgIH0KICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcExpc3QuYWRkT3AoT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzLCBbIk9DIiwgb3B0aW9uYWxDb250ZW50XSk7CiAgICB9CiAgICBvcExpc3QuYWRkT3AoT1BTLmJlZ2luQW5ub3RhdGlvbiwgW2lkLCByZWN0LCB0cmFuc2Zvcm0sIG1hdHJpeCwgaXNVc2luZ093bkNhbnZhc10pOwogICAgYXdhaXQgZXZhbHVhdG9yLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgIHN0cmVhbTogYXBwZWFyYW5jZSwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzLAogICAgICBvcGVyYXRvckxpc3Q6IG9wTGlzdCwKICAgICAgZmFsbGJhY2tGb250RGljdDogdGhpcy5fZmFsbGJhY2tGb250RGljdAogICAgfSk7CiAgICBvcExpc3QuYWRkT3AoT1BTLmVuZEFubm90YXRpb24sIFtdKTsKICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcExpc3QuYWRkT3AoT1BTLmVuZE1hcmtlZENvbnRlbnQsIFtdKTsKICAgIH0KICAgIHRoaXMucmVzZXQoKTsKICAgIHJldHVybiB7CiAgICAgIG9wTGlzdCwKICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgc2VwYXJhdGVDYW52YXM6IGlzVXNpbmdPd25DYW52YXMKICAgIH07CiAgfQogIGFzeW5jIHNhdmUoZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSwgY2hhbmdlcykgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGdldCBvdmVybGF5c1RleHRDb250ZW50KCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBnZXQgaGFzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGFzeW5jIGV4dHJhY3RUZXh0Q29udGVudChldmFsdWF0b3IsIHRhc2ssIHZpZXdCb3gpIHsKICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJlc291cmNlcyA9IGF3YWl0IHRoaXMubG9hZFJlc291cmNlcyhSRVNPVVJDRVNfS0VZU19URVhUX0NPTlRFTlQsIHRoaXMuYXBwZWFyYW5jZSk7CiAgICBjb25zdCB0ZXh0ID0gW107CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGxldCBmaXJzdFBvc2l0aW9uID0gbnVsbDsKICAgIGNvbnN0IHNpbmsgPSB7CiAgICAgIGRlc2lyZWRTaXplOiBNYXRoLkluZmluaXR5LAogICAgICByZWFkeTogdHJ1ZSwKICAgICAgZW5xdWV1ZShjaHVuaywgc2l6ZSkgewogICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBjaHVuay5pdGVtcykgewogICAgICAgICAgaWYgKGl0ZW0uc3RyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBmaXJzdFBvc2l0aW9uIHx8PSBpdGVtLnRyYW5zZm9ybS5zbGljZSgtMik7CiAgICAgICAgICBidWZmZXIucHVzaChpdGVtLnN0cik7CiAgICAgICAgICBpZiAoaXRlbS5oYXNFT0wpIHsKICAgICAgICAgICAgdGV4dC5wdXNoKGJ1ZmZlci5qb2luKCIiKS50cmltRW5kKCkpOwogICAgICAgICAgICBidWZmZXIubGVuZ3RoID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBhd2FpdCBldmFsdWF0b3IuZ2V0VGV4dENvbnRlbnQoewogICAgICBzdHJlYW06IHRoaXMuYXBwZWFyYW5jZSwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzLAogICAgICBpbmNsdWRlTWFya2VkQ29udGVudDogdHJ1ZSwKICAgICAga2VlcFdoaXRlU3BhY2U6IHRydWUsCiAgICAgIHNpbmssCiAgICAgIHZpZXdCb3gKICAgIH0pOwogICAgdGhpcy5yZXNldCgpOwogICAgaWYgKGJ1ZmZlci5sZW5ndGgpIHsKICAgICAgdGV4dC5wdXNoKGJ1ZmZlci5qb2luKCIiKS50cmltRW5kKCkpOwogICAgfQogICAgaWYgKHRleHQubGVuZ3RoID4gMSB8fCB0ZXh0WzBdKSB7CiAgICAgIGNvbnN0IGFwcGVhcmFuY2VEaWN0ID0gdGhpcy5hcHBlYXJhbmNlLmRpY3Q7CiAgICAgIGNvbnN0IGJib3ggPSBsb29rdXBSZWN0KGFwcGVhcmFuY2VEaWN0LmdldEFycmF5KCJCQm94IiksIG51bGwpOwogICAgICBjb25zdCBtYXRyaXggPSBsb29rdXBNYXRyaXgoYXBwZWFyYW5jZURpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpLCBudWxsKTsKICAgICAgdGhpcy5kYXRhLnRleHRQb3NpdGlvbiA9IHRoaXMuX3RyYW5zZm9ybVBvaW50KGZpcnN0UG9zaXRpb24sIGJib3gsIG1hdHJpeCk7CiAgICAgIHRoaXMuZGF0YS50ZXh0Q29udGVudCA9IHRleHQ7CiAgICB9CiAgfQogIF90cmFuc2Zvcm1Qb2ludChjb29yZHMsIGJib3gsIG1hdHJpeCkgewogICAgY29uc3QgewogICAgICByZWN0CiAgICB9ID0gdGhpcy5kYXRhOwogICAgYmJveCB8fD0gWzAsIDAsIDEsIDFdOwogICAgbWF0cml4IHx8PSBbMSwgMCwgMCwgMSwgMCwgMF07CiAgICBjb25zdCB0cmFuc2Zvcm0gPSBnZXRUcmFuc2Zvcm1NYXRyaXgocmVjdCwgYmJveCwgbWF0cml4KTsKICAgIHRyYW5zZm9ybVs0XSAtPSByZWN0WzBdOwogICAgdHJhbnNmb3JtWzVdIC09IHJlY3RbMV07CiAgICBjb25zdCBwID0gY29vcmRzLnNsaWNlKCk7CiAgICBVdGlsLmFwcGx5VHJhbnNmb3JtKHAsIHRyYW5zZm9ybSk7CiAgICBVdGlsLmFwcGx5VHJhbnNmb3JtKHAsIG1hdHJpeCk7CiAgICByZXR1cm4gcDsKICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICBpZiAodGhpcy5kYXRhLmtpZElkcykgewogICAgICByZXR1cm4gewogICAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgICAgYWN0aW9uczogdGhpcy5kYXRhLmFjdGlvbnMsCiAgICAgICAgbmFtZTogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICAgIGZpbGxDb2xvcjogdGhpcy5kYXRhLmJhY2tncm91bmRDb2xvciwKICAgICAgICB0eXBlOiAiIiwKICAgICAgICBraWRJZHM6IHRoaXMuZGF0YS5raWRJZHMsCiAgICAgICAgcGFnZTogdGhpcy5kYXRhLnBhZ2VJbmRleCwKICAgICAgICByb3RhdGlvbjogdGhpcy5yb3RhdGlvbgogICAgICB9OwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIHJlc2V0KCkgewogICAgZm9yIChjb25zdCBzdHJlYW0gb2YgdGhpcy5fc3RyZWFtcykgewogICAgICBzdHJlYW0ucmVzZXQoKTsKICAgIH0KICB9CiAgX2NvbnN0cnVjdEZpZWxkTmFtZShkaWN0KSB7CiAgICBpZiAoIWRpY3QuaGFzKCJUIikgJiYgIWRpY3QuaGFzKCJQYXJlbnQiKSkgewogICAgICB3YXJuKCJVbmtub3duIGZpZWxkIG5hbWUsIGZhbGxpbmcgYmFjayB0byBlbXB0eSBmaWVsZCBuYW1lLiIpOwogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBpZiAoIWRpY3QuaGFzKCJQYXJlbnQiKSkgewogICAgICByZXR1cm4gc3RyaW5nVG9QREZTdHJpbmcoZGljdC5nZXQoIlQiKSk7CiAgICB9CiAgICBjb25zdCBmaWVsZE5hbWUgPSBbXTsKICAgIGlmIChkaWN0LmhhcygiVCIpKSB7CiAgICAgIGZpZWxkTmFtZS51bnNoaWZ0KHN0cmluZ1RvUERGU3RyaW5nKGRpY3QuZ2V0KCJUIikpKTsKICAgIH0KICAgIGxldCBsb29wRGljdCA9IGRpY3Q7CiAgICBjb25zdCB2aXNpdGVkID0gbmV3IFJlZlNldCgpOwogICAgaWYgKGRpY3Qub2JqSWQpIHsKICAgICAgdmlzaXRlZC5wdXQoZGljdC5vYmpJZCk7CiAgICB9CiAgICB3aGlsZSAobG9vcERpY3QuaGFzKCJQYXJlbnQiKSkgewogICAgICBsb29wRGljdCA9IGxvb3BEaWN0LmdldCgiUGFyZW50Iik7CiAgICAgIGlmICghKGxvb3BEaWN0IGluc3RhbmNlb2YgRGljdCkgfHwgbG9vcERpY3Qub2JqSWQgJiYgdmlzaXRlZC5oYXMobG9vcERpY3Qub2JqSWQpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGxvb3BEaWN0Lm9iaklkKSB7CiAgICAgICAgdmlzaXRlZC5wdXQobG9vcERpY3Qub2JqSWQpOwogICAgICB9CiAgICAgIGlmIChsb29wRGljdC5oYXMoIlQiKSkgewogICAgICAgIGZpZWxkTmFtZS51bnNoaWZ0KHN0cmluZ1RvUERGU3RyaW5nKGxvb3BEaWN0LmdldCgiVCIpKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmaWVsZE5hbWUuam9pbigiLiIpOwogIH0KICBnZXQgd2lkdGgoKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhLnJlY3RbMl0gLSB0aGlzLmRhdGEucmVjdFswXTsKICB9CiAgZ2V0IGhlaWdodCgpIHsKICAgIHJldHVybiB0aGlzLmRhdGEucmVjdFszXSAtIHRoaXMuZGF0YS5yZWN0WzFdOwogIH0KfQpjbGFzcyBBbm5vdGF0aW9uQm9yZGVyU3R5bGUgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy53aWR0aCA9IDE7CiAgICB0aGlzLnJhd1dpZHRoID0gMTsKICAgIHRoaXMuc3R5bGUgPSBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLlNPTElEOwogICAgdGhpcy5kYXNoQXJyYXkgPSBbM107CiAgICB0aGlzLmhvcml6b250YWxDb3JuZXJSYWRpdXMgPSAwOwogICAgdGhpcy52ZXJ0aWNhbENvcm5lclJhZGl1cyA9IDA7CiAgfQogIHNldFdpZHRoKHdpZHRoLCByZWN0ID0gWzAsIDAsIDAsIDBdKSB7CiAgICBpZiAod2lkdGggaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIHRoaXMud2lkdGggPSAwOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodHlwZW9mIHdpZHRoID09PSAibnVtYmVyIikgewogICAgICBpZiAod2lkdGggPiAwKSB7CiAgICAgICAgdGhpcy5yYXdXaWR0aCA9IHdpZHRoOwogICAgICAgIGNvbnN0IG1heFdpZHRoID0gKHJlY3RbMl0gLSByZWN0WzBdKSAvIDI7CiAgICAgICAgY29uc3QgbWF4SGVpZ2h0ID0gKHJlY3RbM10gLSByZWN0WzFdKSAvIDI7CiAgICAgICAgaWYgKG1heFdpZHRoID4gMCAmJiBtYXhIZWlnaHQgPiAwICYmICh3aWR0aCA+IG1heFdpZHRoIHx8IHdpZHRoID4gbWF4SGVpZ2h0KSkgewogICAgICAgICAgd2FybihgQW5ub3RhdGlvbkJvcmRlclN0eWxlLnNldFdpZHRoIC0gaWdub3Jpbmcgd2lkdGg6ICR7d2lkdGh9YCk7CiAgICAgICAgICB3aWR0aCA9IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICAgIH0KICB9CiAgc2V0U3R5bGUoc3R5bGUpIHsKICAgIGlmICghKHN0eWxlIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3dpdGNoIChzdHlsZS5uYW1lKSB7CiAgICAgIGNhc2UgIlMiOgogICAgICAgIHRoaXMuc3R5bGUgPSBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLlNPTElEOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJEIjoKICAgICAgICB0aGlzLnN0eWxlID0gQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5EQVNIRUQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkIiOgogICAgICAgIHRoaXMuc3R5bGUgPSBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLkJFVkVMRUQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkkiOgogICAgICAgIHRoaXMuc3R5bGUgPSBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLklOU0VUOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJVIjoKICAgICAgICB0aGlzLnN0eWxlID0gQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5VTkRFUkxJTkU7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogIHNldERhc2hBcnJheShkYXNoQXJyYXksIGZvcmNlU3R5bGUgPSBmYWxzZSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoZGFzaEFycmF5KSkgewogICAgICBsZXQgaXNWYWxpZCA9IHRydWU7CiAgICAgIGxldCBhbGxaZXJvcyA9IHRydWU7CiAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBkYXNoQXJyYXkpIHsKICAgICAgICBjb25zdCB2YWxpZE51bWJlciA9ICtlbGVtZW50ID49IDA7CiAgICAgICAgaWYgKCF2YWxpZE51bWJlcikgewogICAgICAgICAgaXNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50ID4gMCkgewogICAgICAgICAgYWxsWmVyb3MgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGRhc2hBcnJheS5sZW5ndGggPT09IDAgfHwgaXNWYWxpZCAmJiAhYWxsWmVyb3MpIHsKICAgICAgICB0aGlzLmRhc2hBcnJheSA9IGRhc2hBcnJheTsKICAgICAgICBpZiAoZm9yY2VTdHlsZSkgewogICAgICAgICAgdGhpcy5zZXRTdHlsZShOYW1lLmdldCgiRCIpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy53aWR0aCA9IDA7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZGFzaEFycmF5KSB7CiAgICAgIHRoaXMud2lkdGggPSAwOwogICAgfQogIH0KICBzZXRIb3Jpem9udGFsQ29ybmVyUmFkaXVzKHJhZGl1cykgewogICAgaWYgKE51bWJlci5pc0ludGVnZXIocmFkaXVzKSkgewogICAgICB0aGlzLmhvcml6b250YWxDb3JuZXJSYWRpdXMgPSByYWRpdXM7CiAgICB9CiAgfQogIHNldFZlcnRpY2FsQ29ybmVyUmFkaXVzKHJhZGl1cykgewogICAgaWYgKE51bWJlci5pc0ludGVnZXIocmFkaXVzKSkgewogICAgICB0aGlzLnZlcnRpY2FsQ29ybmVyUmFkaXVzID0gcmFkaXVzOwogICAgfQogIH0KfQpjbGFzcyBNYXJrdXBBbm5vdGF0aW9uIGV4dGVuZHMgQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0CiAgICB9ID0gcGFyYW1zOwogICAgaWYgKGRpY3QuaGFzKCJJUlQiKSkgewogICAgICBjb25zdCByYXdJUlQgPSBkaWN0LmdldFJhdygiSVJUIik7CiAgICAgIHRoaXMuZGF0YS5pblJlcGx5VG8gPSByYXdJUlQgaW5zdGFuY2VvZiBSZWYgPyByYXdJUlQudG9TdHJpbmcoKSA6IG51bGw7CiAgICAgIGNvbnN0IHJ0ID0gZGljdC5nZXQoIlJUIik7CiAgICAgIHRoaXMuZGF0YS5yZXBseVR5cGUgPSBydCBpbnN0YW5jZW9mIE5hbWUgPyBydC5uYW1lIDogQW5ub3RhdGlvblJlcGx5VHlwZS5SRVBMWTsKICAgIH0KICAgIGxldCBwb3B1cFJlZiA9IG51bGw7CiAgICBpZiAodGhpcy5kYXRhLnJlcGx5VHlwZSA9PT0gQW5ub3RhdGlvblJlcGx5VHlwZS5HUk9VUCkgewogICAgICBjb25zdCBwYXJlbnQgPSBkaWN0LmdldCgiSVJUIik7CiAgICAgIHRoaXMuc2V0VGl0bGUocGFyZW50LmdldCgiVCIpKTsKICAgICAgdGhpcy5kYXRhLnRpdGxlT2JqID0gdGhpcy5fdGl0bGU7CiAgICAgIHRoaXMuc2V0Q29udGVudHMocGFyZW50LmdldCgiQ29udGVudHMiKSk7CiAgICAgIHRoaXMuZGF0YS5jb250ZW50c09iaiA9IHRoaXMuX2NvbnRlbnRzOwogICAgICBpZiAoIXBhcmVudC5oYXMoIkNyZWF0aW9uRGF0ZSIpKSB7CiAgICAgICAgdGhpcy5kYXRhLmNyZWF0aW9uRGF0ZSA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRDcmVhdGlvbkRhdGUocGFyZW50LmdldCgiQ3JlYXRpb25EYXRlIikpOwogICAgICAgIHRoaXMuZGF0YS5jcmVhdGlvbkRhdGUgPSB0aGlzLmNyZWF0aW9uRGF0ZTsKICAgICAgfQogICAgICBpZiAoIXBhcmVudC5oYXMoIk0iKSkgewogICAgICAgIHRoaXMuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldE1vZGlmaWNhdGlvbkRhdGUocGFyZW50LmdldCgiTSIpKTsKICAgICAgICB0aGlzLmRhdGEubW9kaWZpY2F0aW9uRGF0ZSA9IHRoaXMubW9kaWZpY2F0aW9uRGF0ZTsKICAgICAgfQogICAgICBwb3B1cFJlZiA9IHBhcmVudC5nZXRSYXcoIlBvcHVwIik7CiAgICAgIGlmICghcGFyZW50LmhhcygiQyIpKSB7CiAgICAgICAgdGhpcy5kYXRhLmNvbG9yID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldENvbG9yKHBhcmVudC5nZXRBcnJheSgiQyIpKTsKICAgICAgICB0aGlzLmRhdGEuY29sb3IgPSB0aGlzLmNvbG9yOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRhdGEudGl0bGVPYmogPSB0aGlzLl90aXRsZTsKICAgICAgdGhpcy5zZXRDcmVhdGlvbkRhdGUoZGljdC5nZXQoIkNyZWF0aW9uRGF0ZSIpKTsKICAgICAgdGhpcy5kYXRhLmNyZWF0aW9uRGF0ZSA9IHRoaXMuY3JlYXRpb25EYXRlOwogICAgICBwb3B1cFJlZiA9IGRpY3QuZ2V0UmF3KCJQb3B1cCIpOwogICAgICBpZiAoIWRpY3QuaGFzKCJDIikpIHsKICAgICAgICB0aGlzLmRhdGEuY29sb3IgPSBudWxsOwogICAgICB9CiAgICB9CiAgICB0aGlzLmRhdGEucG9wdXBSZWYgPSBwb3B1cFJlZiBpbnN0YW5jZW9mIFJlZiA/IHBvcHVwUmVmLnRvU3RyaW5nKCkgOiBudWxsOwogICAgaWYgKGRpY3QuaGFzKCJSQyIpKSB7CiAgICAgIHRoaXMuZGF0YS5yaWNoVGV4dCA9IFhGQUZhY3RvcnkuZ2V0UmljaFRleHRBc0h0bWwoZGljdC5nZXQoIlJDIikpOwogICAgfQogIH0KICBzZXRDcmVhdGlvbkRhdGUoY3JlYXRpb25EYXRlKSB7CiAgICB0aGlzLmNyZWF0aW9uRGF0ZSA9IHR5cGVvZiBjcmVhdGlvbkRhdGUgPT09ICJzdHJpbmciID8gY3JlYXRpb25EYXRlIDogbnVsbDsKICB9CiAgX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgIHhyZWYsCiAgICBleHRyYSwKICAgIHN0cm9rZUNvbG9yLAogICAgZmlsbENvbG9yLAogICAgYmxlbmRNb2RlLAogICAgc3Ryb2tlQWxwaGEsCiAgICBmaWxsQWxwaGEsCiAgICBwb2ludHNDYWxsYmFjawogIH0pIHsKICAgIGNvbnN0IGJib3ggPSB0aGlzLmRhdGEucmVjdCA9IFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XTsKICAgIGNvbnN0IGJ1ZmZlciA9IFsicSJdOwogICAgaWYgKGV4dHJhKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGV4dHJhKTsKICAgIH0KICAgIGlmIChzdHJva2VDb2xvcikgewogICAgICBidWZmZXIucHVzaChgJHtzdHJva2VDb2xvclswXX0gJHtzdHJva2VDb2xvclsxXX0gJHtzdHJva2VDb2xvclsyXX0gUkdgKTsKICAgIH0KICAgIGlmIChmaWxsQ29sb3IpIHsKICAgICAgYnVmZmVyLnB1c2goYCR7ZmlsbENvbG9yWzBdfSAke2ZpbGxDb2xvclsxXX0gJHtmaWxsQ29sb3JbMl19IHJnYCk7CiAgICB9CiAgICBjb25zdCBwb2ludHNBcnJheSA9IHRoaXMuZGF0YS5xdWFkUG9pbnRzIHx8IEZsb2F0MzJBcnJheS5mcm9tKFt0aGlzLnJlY3RhbmdsZVswXSwgdGhpcy5yZWN0YW5nbGVbM10sIHRoaXMucmVjdGFuZ2xlWzJdLCB0aGlzLnJlY3RhbmdsZVszXSwgdGhpcy5yZWN0YW5nbGVbMF0sIHRoaXMucmVjdGFuZ2xlWzFdLCB0aGlzLnJlY3RhbmdsZVsyXSwgdGhpcy5yZWN0YW5nbGVbMV1dKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHBvaW50c0FycmF5Lmxlbmd0aDsgaSA8IGlpOyBpICs9IDgpIHsKICAgICAgY29uc3QgcG9pbnRzID0gcG9pbnRzQ2FsbGJhY2soYnVmZmVyLCBwb2ludHNBcnJheS5zdWJhcnJheShpLCBpICsgOCkpOwogICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveCguLi5wb2ludHMsIGJib3gpOwogICAgfQogICAgYnVmZmVyLnB1c2goIlEiKTsKICAgIGNvbnN0IGZvcm1EaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKGJ1ZmZlci5qb2luKCIgIikpOwogICAgYXBwZWFyYW5jZVN0cmVhbS5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICBmb3JtRGljdC5zZXQoIkZtMCIsIGFwcGVhcmFuY2VTdHJlYW0pOwogICAgY29uc3QgZ3NEaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBpZiAoYmxlbmRNb2RlKSB7CiAgICAgIGdzRGljdC5zZXRJZk5hbWUoIkJNIiwgYmxlbmRNb2RlKTsKICAgIH0KICAgIGdzRGljdC5zZXRJZk51bWJlcigiQ0EiLCBzdHJva2VBbHBoYSk7CiAgICBnc0RpY3Quc2V0SWZOdW1iZXIoImNhIiwgZmlsbEFscGhhKTsKICAgIGNvbnN0IHN0YXRlRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgc3RhdGVEaWN0LnNldCgiR1MwIiwgZ3NEaWN0KTsKICAgIGNvbnN0IHJlc291cmNlcyA9IG5ldyBEaWN0KHhyZWYpOwogICAgcmVzb3VyY2VzLnNldCgiRXh0R1N0YXRlIiwgc3RhdGVEaWN0KTsKICAgIHJlc291cmNlcy5zZXQoIlhPYmplY3QiLCBmb3JtRGljdCk7CiAgICBjb25zdCBhcHBlYXJhbmNlRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgYXBwZWFyYW5jZURpY3Quc2V0KCJCQm94IiwgYmJveCk7CiAgICB0aGlzLmFwcGVhcmFuY2UgPSBuZXcgU3RyaW5nU3RyZWFtKCIvR1MwIGdzIC9GbTAgRG8iKTsKICAgIHRoaXMuYXBwZWFyYW5jZS5kaWN0ID0gYXBwZWFyYW5jZURpY3Q7CiAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5hcHBlYXJhbmNlLCBhcHBlYXJhbmNlU3RyZWFtKTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld0Fubm90YXRpb24oeHJlZiwgYW5ub3RhdGlvbiwgY2hhbmdlcywgcGFyYW1zKSB7CiAgICBjb25zdCBhbm5vdGF0aW9uUmVmID0gYW5ub3RhdGlvbi5yZWYgfHw9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICBjb25zdCBhcCA9IGF3YWl0IHRoaXMuY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbShhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpOwogICAgbGV0IGFubm90YXRpb25EaWN0OwogICAgaWYgKGFwKSB7CiAgICAgIGNvbnN0IGFwUmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgYW5ub3RhdGlvbkRpY3QgPSB0aGlzLmNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgICAgIGFwUmVmCiAgICAgIH0pOwogICAgICBjaGFuZ2VzLnB1dChhcFJlZiwgewogICAgICAgIGRhdGE6IGFwCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgYW5ub3RhdGlvbkRpY3QgPSB0aGlzLmNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwge30pOwogICAgfQogICAgaWYgKE51bWJlci5pc0ludGVnZXIoYW5ub3RhdGlvbi5wYXJlbnRUcmVlSWQpKSB7CiAgICAgIGFubm90YXRpb25EaWN0LnNldCgiU3RydWN0UGFyZW50IiwgYW5ub3RhdGlvbi5wYXJlbnRUcmVlSWQpOwogICAgfQogICAgY2hhbmdlcy5wdXQoYW5ub3RhdGlvblJlZiwgewogICAgICBkYXRhOiBhbm5vdGF0aW9uRGljdAogICAgfSk7CiAgICBjb25zdCByZXRSZWYgPSB7CiAgICAgIHJlZjogYW5ub3RhdGlvblJlZgogICAgfTsKICAgIGNvbnN0IHsKICAgICAgcG9wdXAKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgaWYgKHBvcHVwKSB7CiAgICAgIGlmIChwb3B1cC5kZWxldGVkKSB7CiAgICAgICAgYW5ub3RhdGlvbkRpY3QuZGVsZXRlKCJQb3B1cCIpOwogICAgICAgIGFubm90YXRpb25EaWN0LmRlbGV0ZSgiQ29udGVudHMiKTsKICAgICAgICBhbm5vdGF0aW9uRGljdC5kZWxldGUoIlJDIik7CiAgICAgICAgcmV0dXJuIHJldFJlZjsKICAgICAgfQogICAgICBjb25zdCBwb3B1cFJlZiA9IHBvcHVwLnJlZiB8fD0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgcG9wdXAucGFyZW50ID0gYW5ub3RhdGlvblJlZjsKICAgICAgY29uc3QgcG9wdXBEaWN0ID0gUG9wdXBBbm5vdGF0aW9uLmNyZWF0ZU5ld0RpY3QocG9wdXAsIHhyZWYpOwogICAgICBjaGFuZ2VzLnB1dChwb3B1cFJlZiwgewogICAgICAgIGRhdGE6IHBvcHVwRGljdAogICAgICB9KTsKICAgICAgYW5ub3RhdGlvbkRpY3Quc2V0SWZEZWZpbmVkKCJDb250ZW50cyIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUocG9wdXAuY29udGVudHMpKTsKICAgICAgYW5ub3RhdGlvbkRpY3Quc2V0KCJQb3B1cCIsIHBvcHVwUmVmKTsKICAgICAgcmV0dXJuIFtyZXRSZWYsIHsKICAgICAgICByZWY6IHBvcHVwUmVmCiAgICAgIH1dOwogICAgfQogICAgcmV0dXJuIHJldFJlZjsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgcGFyYW1zKSB7CiAgICBjb25zdCBhcCA9IGF3YWl0IHRoaXMuY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbShhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpOwogICAgY29uc3QgYW5ub3RhdGlvbkRpY3QgPSB0aGlzLmNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgYXAgPyB7CiAgICAgIGFwCiAgICB9IDoge30pOwogICAgY29uc3QgbmV3QW5ub3RhdGlvbiA9IG5ldyB0aGlzLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcih7CiAgICAgIGRpY3Q6IGFubm90YXRpb25EaWN0LAogICAgICB4cmVmLAogICAgICBhbm5vdGF0aW9uR2xvYmFscywKICAgICAgZXZhbHVhdG9yT3B0aW9uczogcGFyYW1zLmV2YWx1YXRvck9wdGlvbnMKICAgIH0pOwogICAgaWYgKGFubm90YXRpb24ucmVmKSB7CiAgICAgIG5ld0Fubm90YXRpb24ucmVmID0gbmV3QW5ub3RhdGlvbi5yZWZUb1JlcGxhY2UgPSBhbm5vdGF0aW9uLnJlZjsKICAgIH0KICAgIHJldHVybiBuZXdBbm5vdGF0aW9uOwogIH0KfQpjbGFzcyBXaWRnZXRBbm5vdGF0aW9uIGV4dGVuZHMgQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmLAogICAgICBhbm5vdGF0aW9uR2xvYmFscwogICAgfSA9IHBhcmFtczsKICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICB0aGlzLl9uZWVkQXBwZWFyYW5jZXMgPSBwYXJhbXMubmVlZEFwcGVhcmFuY2VzOwogICAgZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLldJREdFVDsKICAgIGlmIChkYXRhLmZpZWxkTmFtZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGRhdGEuZmllbGROYW1lID0gdGhpcy5fY29uc3RydWN0RmllbGROYW1lKGRpY3QpOwogICAgfQogICAgaWYgKGRhdGEuYWN0aW9ucyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGRhdGEuYWN0aW9ucyA9IGNvbGxlY3RBY3Rpb25zKHhyZWYsIGRpY3QsIEFubm90YXRpb25BY3Rpb25FdmVudFR5cGUpOwogICAgfQogICAgbGV0IGZpZWxkVmFsdWUgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdCwKICAgICAga2V5OiAiViIsCiAgICAgIGdldEFycmF5OiB0cnVlCiAgICB9KTsKICAgIGRhdGEuZmllbGRWYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShmaWVsZFZhbHVlKTsKICAgIGNvbnN0IGRlZmF1bHRGaWVsZFZhbHVlID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkRWIiwKICAgICAgZ2V0QXJyYXk6IHRydWUKICAgIH0pOwogICAgZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShkZWZhdWx0RmllbGRWYWx1ZSk7CiAgICBpZiAoZmllbGRWYWx1ZSA9PT0gdW5kZWZpbmVkICYmIGFubm90YXRpb25HbG9iYWxzLnhmYURhdGFzZXRzKSB7CiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLl90aXRsZS5zdHI7CiAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgdGhpcy5faGFzVmFsdWVGcm9tWEZBID0gdHJ1ZTsKICAgICAgICBkYXRhLmZpZWxkVmFsdWUgPSBmaWVsZFZhbHVlID0gYW5ub3RhdGlvbkdsb2JhbHMueGZhRGF0YXNldHMuZ2V0VmFsdWUocGF0aCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChmaWVsZFZhbHVlID09PSB1bmRlZmluZWQgJiYgZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSAhPT0gbnVsbCkgewogICAgICBkYXRhLmZpZWxkVmFsdWUgPSBkYXRhLmRlZmF1bHRGaWVsZFZhbHVlOwogICAgfQogICAgZGF0YS5hbHRlcm5hdGl2ZVRleHQgPSBzdHJpbmdUb1BERlN0cmluZyhkaWN0LmdldCgiVFUiKSB8fCAiIik7CiAgICB0aGlzLnNldERlZmF1bHRBcHBlYXJhbmNlKHBhcmFtcyk7CiAgICBkYXRhLmhhc0FwcGVhcmFuY2UgfHw9IHRoaXMuX25lZWRBcHBlYXJhbmNlcyAmJiBkYXRhLmZpZWxkVmFsdWUgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmZpZWxkVmFsdWUgIT09IG51bGw7CiAgICBjb25zdCBmaWVsZFR5cGUgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdCwKICAgICAga2V5OiAiRlQiCiAgICB9KTsKICAgIGRhdGEuZmllbGRUeXBlID0gZmllbGRUeXBlIGluc3RhbmNlb2YgTmFtZSA/IGZpZWxkVHlwZS5uYW1lIDogbnVsbDsKICAgIGNvbnN0IGxvY2FsUmVzb3VyY2VzID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkRSIgogICAgfSk7CiAgICBjb25zdCBhY3JvRm9ybVJlc291cmNlcyA9IGFubm90YXRpb25HbG9iYWxzLmFjcm9Gb3JtLmdldCgiRFIiKTsKICAgIGNvbnN0IGFwcGVhcmFuY2VSZXNvdXJjZXMgPSB0aGlzLmFwcGVhcmFuY2U/LmRpY3QuZ2V0KCJSZXNvdXJjZXMiKTsKICAgIHRoaXMuX2ZpZWxkUmVzb3VyY2VzID0gewogICAgICBsb2NhbFJlc291cmNlcywKICAgICAgYWNyb0Zvcm1SZXNvdXJjZXMsCiAgICAgIGFwcGVhcmFuY2VSZXNvdXJjZXMsCiAgICAgIG1lcmdlZFJlc291cmNlczogRGljdC5tZXJnZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBkaWN0QXJyYXk6IFtsb2NhbFJlc291cmNlcywgYXBwZWFyYW5jZVJlc291cmNlcywgYWNyb0Zvcm1SZXNvdXJjZXNdLAogICAgICAgIG1lcmdlU3ViRGljdHM6IHRydWUKICAgICAgfSkKICAgIH07CiAgICBkYXRhLmZpZWxkRmxhZ3MgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdCwKICAgICAga2V5OiAiRmYiCiAgICB9KTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihkYXRhLmZpZWxkRmxhZ3MpIHx8IGRhdGEuZmllbGRGbGFncyA8IDApIHsKICAgICAgZGF0YS5maWVsZEZsYWdzID0gMDsKICAgIH0KICAgIGRhdGEucGFzc3dvcmQgPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLlBBU1NXT1JEKTsKICAgIGRhdGEucmVhZE9ubHkgPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLlJFQURPTkxZKTsKICAgIGRhdGEucmVxdWlyZWQgPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLlJFUVVJUkVEKTsKICAgIGRhdGEuaGlkZGVuID0gdGhpcy5faGFzRmxhZyhkYXRhLmFubm90YXRpb25GbGFncywgQW5ub3RhdGlvbkZsYWcuSElEREVOKSB8fCB0aGlzLl9oYXNGbGFnKGRhdGEuYW5ub3RhdGlvbkZsYWdzLCBBbm5vdGF0aW9uRmxhZy5OT1ZJRVcpOwogIH0KICBfZGVjb2RlRm9ybVZhbHVlKGZvcm1WYWx1ZSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoZm9ybVZhbHVlKSkgewogICAgICByZXR1cm4gZm9ybVZhbHVlLmZpbHRlcihpdGVtID0+IHR5cGVvZiBpdGVtID09PSAic3RyaW5nIikubWFwKGl0ZW0gPT4gc3RyaW5nVG9QREZTdHJpbmcoaXRlbSkpOwogICAgfSBlbHNlIGlmIChmb3JtVmFsdWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIHJldHVybiBzdHJpbmdUb1BERlN0cmluZyhmb3JtVmFsdWUubmFtZSk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBmb3JtVmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgIHJldHVybiBzdHJpbmdUb1BERlN0cmluZyhmb3JtVmFsdWUpOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGhhc0ZpZWxkRmxhZyhmbGFnKSB7CiAgICByZXR1cm4gISEodGhpcy5kYXRhLmZpZWxkRmxhZ3MgJiBmbGFnKTsKICB9CiAgX2lzVmlld2FibGUoZmxhZ3MpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBtdXN0QmVWaWV3ZWQoYW5ub3RhdGlvblN0b3JhZ2UsIHJlbmRlckZvcm1zKSB7CiAgICBpZiAocmVuZGVyRm9ybXMpIHsKICAgICAgcmV0dXJuIHRoaXMudmlld2FibGU7CiAgICB9CiAgICByZXR1cm4gc3VwZXIubXVzdEJlVmlld2VkKGFubm90YXRpb25TdG9yYWdlLCByZW5kZXJGb3JtcykgJiYgIXRoaXMuX2hhc0ZsYWcodGhpcy5mbGFncywgQW5ub3RhdGlvbkZsYWcuTk9WSUVXKTsKICB9CiAgZ2V0Um90YXRpb25NYXRyaXgoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGxldCByb3RhdGlvbiA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKT8ucm90YXRpb247CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb247CiAgICB9CiAgICByZXR1cm4gcm90YXRpb24gPT09IDAgPyBJREVOVElUWV9NQVRSSVggOiBnZXRSb3RhdGlvbk1hdHJpeChyb3RhdGlvbiwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpOwogIH0KICBnZXRCb3JkZXJBbmRCYWNrZ3JvdW5kQXBwZWFyYW5jZXMoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGxldCByb3RhdGlvbiA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKT8ucm90YXRpb247CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb247CiAgICB9CiAgICBpZiAoIXRoaXMuYmFja2dyb3VuZENvbG9yICYmICF0aGlzLmJvcmRlckNvbG9yKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIGNvbnN0IHJlY3QgPSByb3RhdGlvbiA9PT0gMCB8fCByb3RhdGlvbiA9PT0gMTgwID8gYDAgMCAke3RoaXMud2lkdGh9ICR7dGhpcy5oZWlnaHR9IHJlYCA6IGAwIDAgJHt0aGlzLmhlaWdodH0gJHt0aGlzLndpZHRofSByZWA7CiAgICBsZXQgc3RyID0gIiI7CiAgICBpZiAodGhpcy5iYWNrZ3JvdW5kQ29sb3IpIHsKICAgICAgc3RyID0gYCR7Z2V0UGRmQ29sb3IodGhpcy5iYWNrZ3JvdW5kQ29sb3IsIHRydWUpfSAke3JlY3R9IGYgYDsKICAgIH0KICAgIGlmICh0aGlzLmJvcmRlckNvbG9yKSB7CiAgICAgIGNvbnN0IGJvcmRlcldpZHRoID0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCB8fCAxOwogICAgICBzdHIgKz0gYCR7Ym9yZGVyV2lkdGh9IHcgJHtnZXRQZGZDb2xvcih0aGlzLmJvcmRlckNvbG9yLCBmYWxzZSl9ICR7cmVjdH0gUyBgOwogICAgfQogICAgcmV0dXJuIHN0cjsKICB9CiAgYXN5bmMgZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgaWYgKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuQU5OT1RBVElPTlNfRk9STVMgJiYgISh0aGlzIGluc3RhbmNlb2YgU2lnbmF0dXJlV2lkZ2V0QW5ub3RhdGlvbikgJiYgIXRoaXMuZGF0YS5ub0hUTUwgJiYgIXRoaXMuZGF0YS5oYXNPd25DYW52YXMpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBvcExpc3Q6IG5ldyBPcGVyYXRvckxpc3QoKSwKICAgICAgICBzZXBhcmF0ZUZvcm06IHRydWUsCiAgICAgICAgc2VwYXJhdGVDYW52YXM6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICBpZiAoIXRoaXMuX2hhc1RleHQpIHsKICAgICAgcmV0dXJuIHN1cGVyLmdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIGlmICh0aGlzLmFwcGVhcmFuY2UgJiYgY29udGVudCA9PT0gbnVsbCkgewogICAgICByZXR1cm4gc3VwZXIuZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICB9CiAgICBjb25zdCBvcExpc3QgPSBuZXcgT3BlcmF0b3JMaXN0KCk7CiAgICBpZiAoIXRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlIHx8IGNvbnRlbnQgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBvcExpc3QsCiAgICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgICBzZXBhcmF0ZUNhbnZhczogZmFsc2UKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IGlzVXNpbmdPd25DYW52YXMgPSAhISh0aGlzLmRhdGEuaGFzT3duQ2FudmFzICYmIGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuRElTUExBWSk7CiAgICBjb25zdCBtYXRyaXggPSBbMSwgMCwgMCwgMSwgMCwgMF07CiAgICBjb25zdCBiYm94ID0gWzAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0XTsKICAgIGNvbnN0IHRyYW5zZm9ybSA9IGdldFRyYW5zZm9ybU1hdHJpeCh0aGlzLmRhdGEucmVjdCwgYmJveCwgbWF0cml4KTsKICAgIGxldCBvcHRpb25hbENvbnRlbnQ7CiAgICBpZiAodGhpcy5vYykgewogICAgICBvcHRpb25hbENvbnRlbnQgPSBhd2FpdCBldmFsdWF0b3IucGFyc2VNYXJrZWRDb250ZW50UHJvcHModGhpcy5vYywgbnVsbCk7CiAgICB9CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgb3BMaXN0LmFkZE9wKE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG9wdGlvbmFsQ29udGVudF0pOwogICAgfQogICAgb3BMaXN0LmFkZE9wKE9QUy5iZWdpbkFubm90YXRpb24sIFt0aGlzLmRhdGEuaWQsIHRoaXMuZGF0YS5yZWN0LCB0cmFuc2Zvcm0sIHRoaXMuZ2V0Um90YXRpb25NYXRyaXgoYW5ub3RhdGlvblN0b3JhZ2UpLCBpc1VzaW5nT3duQ2FudmFzXSk7CiAgICBjb25zdCBzdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKGNvbnRlbnQpOwogICAgYXdhaXQgZXZhbHVhdG9yLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgIHN0cmVhbSwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzOiB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMsCiAgICAgIG9wZXJhdG9yTGlzdDogb3BMaXN0CiAgICB9KTsKICAgIG9wTGlzdC5hZGRPcChPUFMuZW5kQW5ub3RhdGlvbiwgW10pOwogICAgaWYgKG9wdGlvbmFsQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIG9wTGlzdC5hZGRPcChPUFMuZW5kTWFya2VkQ29udGVudCwgW10pOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgb3BMaXN0LAogICAgICBzZXBhcmF0ZUZvcm06IGZhbHNlLAogICAgICBzZXBhcmF0ZUNhbnZhczogaXNVc2luZ093bkNhbnZhcwogICAgfTsKICB9CiAgX2dldE1LRGljdChyb3RhdGlvbikgewogICAgY29uc3QgbWsgPSBuZXcgRGljdChudWxsKTsKICAgIGlmIChyb3RhdGlvbikgewogICAgICBtay5zZXQoIlIiLCByb3RhdGlvbik7CiAgICB9CiAgICBtay5zZXRJZkFycmF5KCJCQyIsIGdldFBkZkNvbG9yQXJyYXkodGhpcy5ib3JkZXJDb2xvcikpOwogICAgbWsuc2V0SWZBcnJheSgiQkciLCBnZXRQZGZDb2xvckFycmF5KHRoaXMuYmFja2dyb3VuZENvbG9yKSk7CiAgICByZXR1cm4gbWsuc2l6ZSA+IDAgPyBtayA6IG51bGw7CiAgfQogIGFtZW5kU2F2ZWREaWN0KGFubm90YXRpb25TdG9yYWdlLCBkaWN0KSB7fQogIHNldFZhbHVlKGRpY3QsIHZhbHVlLCB4cmVmLCBjaGFuZ2VzKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3Q6IHBhcmVudERpY3QsCiAgICAgIHJlZjogcGFyZW50UmVmCiAgICB9ID0gZ2V0UGFyZW50VG9VcGRhdGUoZGljdCwgdGhpcy5yZWYsIHhyZWYpOwogICAgaWYgKCFwYXJlbnREaWN0KSB7CiAgICAgIGRpY3Quc2V0KCJWIiwgdmFsdWUpOwogICAgfSBlbHNlIGlmICghY2hhbmdlcy5oYXMocGFyZW50UmVmKSkgewogICAgICBjb25zdCBuZXdQYXJlbnREaWN0ID0gcGFyZW50RGljdC5jbG9uZSgpOwogICAgICBuZXdQYXJlbnREaWN0LnNldCgiViIsIHZhbHVlKTsKICAgICAgY2hhbmdlcy5wdXQocGFyZW50UmVmLCB7CiAgICAgICAgZGF0YTogbmV3UGFyZW50RGljdAogICAgICB9KTsKICAgICAgcmV0dXJuIG5ld1BhcmVudERpY3Q7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgYXN5bmMgc2F2ZShldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKSB7CiAgICBjb25zdCBzdG9yYWdlRW50cnkgPSBhbm5vdGF0aW9uU3RvcmFnZT8uZ2V0KHRoaXMuZGF0YS5pZCk7CiAgICBjb25zdCBmbGFncyA9IHRoaXMuX2J1aWxkRmxhZ3Moc3RvcmFnZUVudHJ5Py5ub1ZpZXcsIHN0b3JhZ2VFbnRyeT8ubm9QcmludCk7CiAgICBsZXQgdmFsdWUgPSBzdG9yYWdlRW50cnk/LnZhbHVlLAogICAgICByb3RhdGlvbiA9IHN0b3JhZ2VFbnRyeT8ucm90YXRpb247CiAgICBpZiAodmFsdWUgPT09IHRoaXMuZGF0YS5maWVsZFZhbHVlIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKCF0aGlzLl9oYXNWYWx1ZUZyb21YRkEgJiYgcm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiBmbGFncyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhbHVlIHx8PSB0aGlzLmRhdGEuZmllbGRWYWx1ZTsKICAgIH0KICAgIGlmIChyb3RhdGlvbiA9PT0gdW5kZWZpbmVkICYmICF0aGlzLl9oYXNWYWx1ZUZyb21YRkEgJiYgQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgQXJyYXkuaXNBcnJheSh0aGlzLmRhdGEuZmllbGRWYWx1ZSkgJiYgaXNBcnJheUVxdWFsKHZhbHVlLCB0aGlzLmRhdGEuZmllbGRWYWx1ZSkgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb247CiAgICB9CiAgICBsZXQgYXBwZWFyYW5jZSA9IG51bGw7CiAgICBpZiAoIXRoaXMuX25lZWRBcHBlYXJhbmNlcykgewogICAgICBhcHBlYXJhbmNlID0gYXdhaXQgdGhpcy5fZ2V0QXBwZWFyYW5jZShldmFsdWF0b3IsIHRhc2ssIFJlbmRlcmluZ0ludGVudEZsYWcuU0FWRSwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgICBpZiAoYXBwZWFyYW5jZSA9PT0gbnVsbCAmJiBmbGFncyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9IGVsc2Uge30KICAgIGxldCBuZWVkQXBwZWFyYW5jZXMgPSBmYWxzZTsKICAgIGlmIChhcHBlYXJhbmNlPy5uZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgbmVlZEFwcGVhcmFuY2VzID0gdHJ1ZTsKICAgICAgYXBwZWFyYW5jZSA9IG51bGw7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHhyZWYKICAgIH0gPSBldmFsdWF0b3I7CiAgICBjb25zdCBvcmlnaW5hbERpY3QgPSB4cmVmLmZldGNoSWZSZWYodGhpcy5yZWYpOwogICAgaWYgKCEob3JpZ2luYWxEaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgZm9yIChjb25zdCBrZXkgb2Ygb3JpZ2luYWxEaWN0LmdldEtleXMoKSkgewogICAgICBpZiAoa2V5ICE9PSAiQVAiKSB7CiAgICAgICAgZGljdC5zZXQoa2V5LCBvcmlnaW5hbERpY3QuZ2V0UmF3KGtleSkpOwogICAgICB9CiAgICB9CiAgICBpZiAoZmxhZ3MgIT09IHVuZGVmaW5lZCkgewogICAgICBkaWN0LnNldCgiRiIsIGZsYWdzKTsKICAgICAgaWYgKGFwcGVhcmFuY2UgPT09IG51bGwgJiYgIW5lZWRBcHBlYXJhbmNlcykgewogICAgICAgIGNvbnN0IGFwID0gb3JpZ2luYWxEaWN0LmdldFJhdygiQVAiKTsKICAgICAgICBpZiAoYXApIHsKICAgICAgICAgIGRpY3Quc2V0KCJBUCIsIGFwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHhmYSA9IHsKICAgICAgcGF0aDogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgdmFsdWUKICAgIH07CiAgICBjb25zdCBuZXdQYXJlbnREaWN0ID0gdGhpcy5zZXRWYWx1ZShkaWN0LCBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlLm1hcChzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKSA6IHN0cmluZ1RvQXNjaWlPclVURjE2QkUodmFsdWUpLCB4cmVmLCBjaGFuZ2VzKTsKICAgIHRoaXMuYW1lbmRTYXZlZERpY3QoYW5ub3RhdGlvblN0b3JhZ2UsIG5ld1BhcmVudERpY3QgfHwgZGljdCk7CiAgICBjb25zdCBtYXliZU1LID0gdGhpcy5fZ2V0TUtEaWN0KHJvdGF0aW9uKTsKICAgIGlmIChtYXliZU1LKSB7CiAgICAgIGRpY3Quc2V0KCJNSyIsIG1heWJlTUspOwogICAgfQogICAgY2hhbmdlcy5wdXQodGhpcy5yZWYsIHsKICAgICAgZGF0YTogZGljdCwKICAgICAgeGZhLAogICAgICBuZWVkQXBwZWFyYW5jZXMKICAgIH0pOwogICAgaWYgKGFwcGVhcmFuY2UgIT09IG51bGwpIHsKICAgICAgY29uc3QgbmV3UmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgY29uc3QgQVAgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgZGljdC5zZXQoIkFQIiwgQVApOwogICAgICBBUC5zZXQoIk4iLCBuZXdSZWYpOwogICAgICBjb25zdCByZXNvdXJjZXMgPSB0aGlzLl9nZXRTYXZlRmllbGRSZXNvdXJjZXMoeHJlZik7CiAgICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgICBjb25zdCBhcHBlYXJhbmNlRGljdCA9IGFwcGVhcmFuY2VTdHJlYW0uZGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBhcHBlYXJhbmNlRGljdC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiRm9ybSIpOwogICAgICBhcHBlYXJhbmNlRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICAgIGNvbnN0IGJib3ggPSByb3RhdGlvbiAlIDE4MCA9PT0gMCA/IFswLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodF0gOiBbMCwgMCwgdGhpcy5oZWlnaHQsIHRoaXMud2lkdGhdOwogICAgICBhcHBlYXJhbmNlRGljdC5zZXQoIkJCb3giLCBiYm94KTsKICAgICAgY29uc3Qgcm90YXRpb25NYXRyaXggPSB0aGlzLmdldFJvdGF0aW9uTWF0cml4KGFubm90YXRpb25TdG9yYWdlKTsKICAgICAgaWYgKHJvdGF0aW9uTWF0cml4ICE9PSBJREVOVElUWV9NQVRSSVgpIHsKICAgICAgICBhcHBlYXJhbmNlRGljdC5zZXQoIk1hdHJpeCIsIHJvdGF0aW9uTWF0cml4KTsKICAgICAgfQogICAgICBjaGFuZ2VzLnB1dChuZXdSZWYsIHsKICAgICAgICBkYXRhOiBhcHBlYXJhbmNlU3RyZWFtLAogICAgICAgIHhmYTogbnVsbCwKICAgICAgICBuZWVkQXBwZWFyYW5jZXM6IGZhbHNlCiAgICAgIH0pOwogICAgfQogICAgZGljdC5zZXQoIk0iLCBgRDoke2dldE1vZGlmaWNhdGlvbkRhdGUoKX1gKTsKICB9CiAgYXN5bmMgX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBpZiAodGhpcy5kYXRhLnBhc3N3b3JkKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpOwogICAgbGV0IHZhbHVlLCByb3RhdGlvbjsKICAgIGlmIChzdG9yYWdlRW50cnkpIHsKICAgICAgdmFsdWUgPSBzdG9yYWdlRW50cnkuZm9ybWF0dGVkVmFsdWUgfHwgc3RvcmFnZUVudHJ5LnZhbHVlOwogICAgICByb3RhdGlvbiA9IHN0b3JhZ2VFbnRyeS5yb3RhdGlvbjsKICAgIH0KICAgIGlmIChyb3RhdGlvbiA9PT0gdW5kZWZpbmVkICYmIHZhbHVlID09PSB1bmRlZmluZWQgJiYgIXRoaXMuX25lZWRBcHBlYXJhbmNlcykgewogICAgICBpZiAoIXRoaXMuX2hhc1ZhbHVlRnJvbVhGQSB8fCB0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgY29uc3QgY29sb3JzID0gdGhpcy5nZXRCb3JkZXJBbmRCYWNrZ3JvdW5kQXBwZWFyYW5jZXMoYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZTsKICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgIHJldHVybiBgL1R4IEJNQyBxICR7Y29sb3JzfVEgRU1DYDsKICAgICAgfQogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCA9PT0gMSkgewogICAgICB2YWx1ZSA9IHZhbHVlWzBdOwogICAgfQogICAgYXNzZXJ0KHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIsICJFeHBlY3RlZCBgdmFsdWVgIHRvIGJlIGEgc3RyaW5nLiIpOwogICAgdmFsdWUgPSB2YWx1ZS50cmltRW5kKCk7CiAgICBpZiAodGhpcy5kYXRhLmNvbWJvKSB7CiAgICAgIGNvbnN0IG9wdGlvbiA9IHRoaXMuZGF0YS5vcHRpb25zLmZpbmQoKHsKICAgICAgICBleHBvcnRWYWx1ZQogICAgICB9KSA9PiB2YWx1ZSA9PT0gZXhwb3J0VmFsdWUpOwogICAgICB2YWx1ZSA9IG9wdGlvbj8uZGlzcGxheVZhbHVlIHx8IHZhbHVlOwogICAgfQogICAgaWYgKHZhbHVlID09PSAiIikgewogICAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31RIEVNQ2A7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb247CiAgICB9CiAgICBsZXQgbGluZUNvdW50ID0gLTE7CiAgICBsZXQgbGluZXM7CiAgICBpZiAodGhpcy5kYXRhLm11bHRpTGluZSkgewogICAgICBsaW5lcyA9IHZhbHVlLnNwbGl0KC9cclxuP3xcbi8pLm1hcChsaW5lID0+IGxpbmUubm9ybWFsaXplKCJORkMiKSk7CiAgICAgIGxpbmVDb3VudCA9IGxpbmVzLmxlbmd0aDsKICAgIH0gZWxzZSB7CiAgICAgIGxpbmVzID0gW3ZhbHVlLnJlcGxhY2UoL1xyXG4/fFxuLywgIiIpLm5vcm1hbGl6ZSgiTkZDIildOwogICAgfQogICAgY29uc3QgZGVmYXVsdFBhZGRpbmcgPSAxOwogICAgY29uc3QgZGVmYXVsdEhQYWRkaW5nID0gMjsKICAgIGxldCB7CiAgICAgIHdpZHRoOiB0b3RhbFdpZHRoLAogICAgICBoZWlnaHQ6IHRvdGFsSGVpZ2h0CiAgICB9ID0gdGhpczsKICAgIGlmIChyb3RhdGlvbiA9PT0gOTAgfHwgcm90YXRpb24gPT09IDI3MCkgewogICAgICBbdG90YWxXaWR0aCwgdG90YWxIZWlnaHRdID0gW3RvdGFsSGVpZ2h0LCB0b3RhbFdpZHRoXTsKICAgIH0KICAgIGlmICghdGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UpIHsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YSA9IHBhcnNlRGVmYXVsdEFwcGVhcmFuY2UodGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UgPSAiL0hlbHZldGljYSAwIFRmIDAgZyIpOwogICAgfQogICAgbGV0IGZvbnQgPSBhd2FpdCBXaWRnZXRBbm5vdGF0aW9uLl9nZXRGb250RGF0YShldmFsdWF0b3IsIHRhc2ssIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEsIHRoaXMuX2ZpZWxkUmVzb3VyY2VzLm1lcmdlZFJlc291cmNlcyk7CiAgICBsZXQgZGVmYXVsdEFwcGVhcmFuY2UsIGZvbnRTaXplLCBsaW5lSGVpZ2h0OwogICAgY29uc3QgZW5jb2RlZExpbmVzID0gW107CiAgICBsZXQgZW5jb2RpbmdFcnJvciA9IGZhbHNlOwogICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7CiAgICAgIGNvbnN0IGVuY29kZWRTdHJpbmcgPSBmb250LmVuY29kZVN0cmluZyhsaW5lKTsKICAgICAgaWYgKGVuY29kZWRTdHJpbmcubGVuZ3RoID4gMSkgewogICAgICAgIGVuY29kaW5nRXJyb3IgPSB0cnVlOwogICAgICB9CiAgICAgIGVuY29kZWRMaW5lcy5wdXNoKGVuY29kZWRTdHJpbmcuam9pbigiIikpOwogICAgfQogICAgaWYgKGVuY29kaW5nRXJyb3IgJiYgaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5TQVZFKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmVlZEFwcGVhcmFuY2VzOiB0cnVlCiAgICAgIH07CiAgICB9CiAgICBpZiAoZW5jb2RpbmdFcnJvciAmJiB0aGlzLl9pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgICBjb25zdCBmb250RmFtaWx5ID0gdGhpcy5kYXRhLmNvbWIgPyAibW9ub3NwYWNlIiA6ICJzYW5zLXNlcmlmIjsKICAgICAgY29uc3QgZmFrZVVuaWNvZGVGb250ID0gbmV3IEZha2VVbmljb2RlRm9udChldmFsdWF0b3IueHJlZiwgZm9udEZhbWlseSk7CiAgICAgIGNvbnN0IHJlc291cmNlcyA9IGZha2VVbmljb2RlRm9udC5jcmVhdGVGb250UmVzb3VyY2VzKGxpbmVzLmpvaW4oIiIpKTsKICAgICAgY29uc3QgbmV3Rm9udCA9IHJlc291cmNlcy5nZXRSYXcoIkZvbnQiKTsKICAgICAgaWYgKHRoaXMuX2ZpZWxkUmVzb3VyY2VzLm1lcmdlZFJlc291cmNlcy5oYXMoIkZvbnQiKSkgewogICAgICAgIGNvbnN0IG9sZEZvbnQgPSB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMuZ2V0KCJGb250Iik7CiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgbmV3Rm9udC5nZXRLZXlzKCkpIHsKICAgICAgICAgIG9sZEZvbnQuc2V0KGtleSwgbmV3Rm9udC5nZXRSYXcoa2V5KSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX2ZpZWxkUmVzb3VyY2VzLm1lcmdlZFJlc291cmNlcy5zZXQoIkZvbnQiLCBuZXdGb250KTsKICAgICAgfQogICAgICBjb25zdCBmb250TmFtZSA9IGZha2VVbmljb2RlRm9udC5mb250TmFtZS5uYW1lOwogICAgICBmb250ID0gYXdhaXQgV2lkZ2V0QW5ub3RhdGlvbi5fZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCB7CiAgICAgICAgZm9udE5hbWUsCiAgICAgICAgZm9udFNpemU6IDAKICAgICAgfSwgcmVzb3VyY2VzKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZW5jb2RlZExpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBlbmNvZGVkTGluZXNbaV0gPSBzdHJpbmdUb1VURjE2U3RyaW5nKGxpbmVzW2ldKTsKICAgICAgfQogICAgICBjb25zdCBzYXZlZERlZmF1bHRBcHBlYXJhbmNlID0gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKG51bGwpLCB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhKTsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YS5mb250U2l6ZSA9IDA7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udE5hbWUgPSBmb250TmFtZTsKICAgICAgW2RlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZSwgbGluZUhlaWdodF0gPSB0aGlzLl9jb21wdXRlRm9udFNpemUodG90YWxIZWlnaHQgLSAyICogZGVmYXVsdFBhZGRpbmcsIHRvdGFsV2lkdGggLSAyICogZGVmYXVsdEhQYWRkaW5nLCB2YWx1ZSwgZm9udCwgbGluZUNvdW50KTsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YSA9IHNhdmVkRGVmYXVsdEFwcGVhcmFuY2U7CiAgICB9IGVsc2UgewogICAgICBpZiAoIXRoaXMuX2lzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgICAgd2FybigiX2dldEFwcGVhcmFuY2U6IE9mZnNjcmVlbkNhbnZhcyBpcyBub3Qgc3VwcG9ydGVkLCBhbm5vdGF0aW9uIG1heSBub3QgcmVuZGVyIGNvcnJlY3RseS4iKTsKICAgICAgfQogICAgICBbZGVmYXVsdEFwcGVhcmFuY2UsIGZvbnRTaXplLCBsaW5lSGVpZ2h0XSA9IHRoaXMuX2NvbXB1dGVGb250U2l6ZSh0b3RhbEhlaWdodCAtIDIgKiBkZWZhdWx0UGFkZGluZywgdG90YWxXaWR0aCAtIDIgKiBkZWZhdWx0SFBhZGRpbmcsIHZhbHVlLCBmb250LCBsaW5lQ291bnQpOwogICAgfQogICAgbGV0IGRlc2NlbnQgPSBmb250LmRlc2NlbnQ7CiAgICBpZiAoaXNOYU4oZGVzY2VudCkpIHsKICAgICAgZGVzY2VudCA9IEJBU0VMSU5FX0ZBQ1RPUiAqIGxpbmVIZWlnaHQ7CiAgICB9IGVsc2UgewogICAgICBkZXNjZW50ID0gTWF0aC5tYXgoQkFTRUxJTkVfRkFDVE9SICogbGluZUhlaWdodCwgTWF0aC5hYnMoZGVzY2VudCkgKiBmb250U2l6ZSk7CiAgICB9CiAgICBjb25zdCBkZWZhdWx0VlBhZGRpbmcgPSBNYXRoLm1pbihNYXRoLmZsb29yKCh0b3RhbEhlaWdodCAtIGZvbnRTaXplKSAvIDIpLCBkZWZhdWx0UGFkZGluZyk7CiAgICBjb25zdCBhbGlnbm1lbnQgPSB0aGlzLmRhdGEudGV4dEFsaWdubWVudDsKICAgIGlmICh0aGlzLmRhdGEubXVsdGlMaW5lKSB7CiAgICAgIHJldHVybiB0aGlzLl9nZXRNdWx0aWxpbmVBcHBlYXJhbmNlKGRlZmF1bHRBcHBlYXJhbmNlLCBlbmNvZGVkTGluZXMsIGZvbnQsIGZvbnRTaXplLCB0b3RhbFdpZHRoLCB0b3RhbEhlaWdodCwgYWxpZ25tZW50LCBkZWZhdWx0SFBhZGRpbmcsIGRlZmF1bHRWUGFkZGluZywgZGVzY2VudCwgbGluZUhlaWdodCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgaWYgKHRoaXMuZGF0YS5jb21iKSB7CiAgICAgIHJldHVybiB0aGlzLl9nZXRDb21iQXBwZWFyYW5jZShkZWZhdWx0QXBwZWFyYW5jZSwgZm9udCwgZW5jb2RlZExpbmVzWzBdLCBmb250U2l6ZSwgdG90YWxXaWR0aCwgdG90YWxIZWlnaHQsIGRlZmF1bHRIUGFkZGluZywgZGVmYXVsdFZQYWRkaW5nLCBkZXNjZW50LCBsaW5lSGVpZ2h0LCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICB9CiAgICBjb25zdCBib3R0b21QYWRkaW5nID0gZGVmYXVsdFZQYWRkaW5nICsgZGVzY2VudDsKICAgIGlmIChhbGlnbm1lbnQgPT09IDAgfHwgYWxpZ25tZW50ID4gMikgewogICAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31CVCBgICsgZGVmYXVsdEFwcGVhcmFuY2UgKyBgIDEgMCAwIDEgJHtudW1iZXJUb1N0cmluZyhkZWZhdWx0SFBhZGRpbmcpfSAke251bWJlclRvU3RyaW5nKGJvdHRvbVBhZGRpbmcpfSBUbSAoJHtlc2NhcGVTdHJpbmcoZW5jb2RlZExpbmVzWzBdKX0pIFRqYCArICIgRVQgUSBFTUMiOwogICAgfQogICAgY29uc3QgcHJldkluZm8gPSB7CiAgICAgIHNoaWZ0OiAwCiAgICB9OwogICAgY29uc3QgcmVuZGVyZWRUZXh0ID0gdGhpcy5fcmVuZGVyVGV4dChlbmNvZGVkTGluZXNbMF0sIGZvbnQsIGZvbnRTaXplLCB0b3RhbFdpZHRoLCBhbGlnbm1lbnQsIHByZXZJbmZvLCBkZWZhdWx0SFBhZGRpbmcsIGJvdHRvbVBhZGRpbmcpOwogICAgcmV0dXJuIGAvVHggQk1DIHEgJHtjb2xvcnN9QlQgYCArIGRlZmF1bHRBcHBlYXJhbmNlICsgYCAxIDAgMCAxIDAgMCBUbSAke3JlbmRlcmVkVGV4dH1gICsgIiBFVCBRIEVNQyI7CiAgfQogIHN0YXRpYyBhc3luYyBfZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCBhcHBlYXJhbmNlRGF0YSwgcmVzb3VyY2VzKSB7CiAgICBjb25zdCBvcGVyYXRvckxpc3QgPSBuZXcgT3BlcmF0b3JMaXN0KCk7CiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSB7CiAgICAgIGZvbnQ6IG51bGwsCiAgICAgIGNsb25lKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICB9OwogICAgY29uc3QgewogICAgICBmb250TmFtZSwKICAgICAgZm9udFNpemUKICAgIH0gPSBhcHBlYXJhbmNlRGF0YTsKICAgIGF3YWl0IGV2YWx1YXRvci5oYW5kbGVTZXRGb250KHJlc291cmNlcywgW2ZvbnROYW1lICYmIE5hbWUuZ2V0KGZvbnROYW1lKSwgZm9udFNpemVdLCBudWxsLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgbnVsbCk7CiAgICByZXR1cm4gaW5pdGlhbFN0YXRlLmZvbnQ7CiAgfQogIF9nZXRUZXh0V2lkdGgodGV4dCwgZm9udCkgewogICAgcmV0dXJuIE1hdGguc3VtUHJlY2lzZShmb250LmNoYXJzVG9HbHlwaHModGV4dCkubWFwKGcgPT4gZy53aWR0aCkpIC8gMTAwMDsKICB9CiAgX2NvbXB1dGVGb250U2l6ZShoZWlnaHQsIHdpZHRoLCB0ZXh0LCBmb250LCBsaW5lQ291bnQpIHsKICAgIGxldCB7CiAgICAgIGZvbnRTaXplCiAgICB9ID0gdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YTsKICAgIGxldCBsaW5lSGVpZ2h0ID0gKGZvbnRTaXplIHx8IDEyKSAqIExJTkVfRkFDVE9SLAogICAgICBudW1iZXJPZkxpbmVzID0gTWF0aC5yb3VuZChoZWlnaHQgLyBsaW5lSGVpZ2h0KTsKICAgIGlmICghZm9udFNpemUpIHsKICAgICAgY29uc3Qgcm91bmRXaXRoVHdvRGlnaXRzID0geCA9PiBNYXRoLmZsb29yKHggKiAxMDApIC8gMTAwOwogICAgICBpZiAobGluZUNvdW50ID09PSAtMSkgewogICAgICAgIGNvbnN0IHRleHRXaWR0aCA9IHRoaXMuX2dldFRleHRXaWR0aCh0ZXh0LCBmb250KTsKICAgICAgICBmb250U2l6ZSA9IHJvdW5kV2l0aFR3b0RpZ2l0cyhNYXRoLm1pbihoZWlnaHQgLyBMSU5FX0ZBQ1RPUiwgd2lkdGggLyB0ZXh0V2lkdGgpKTsKICAgICAgICBudW1iZXJPZkxpbmVzID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBsaW5lcyA9IHRleHQuc3BsaXQoL1xyXG4/fFxuLyk7CiAgICAgICAgY29uc3QgY2FjaGVkTGluZXMgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHsKICAgICAgICAgIGNvbnN0IGVuY29kZWQgPSBmb250LmVuY29kZVN0cmluZyhsaW5lKS5qb2luKCIiKTsKICAgICAgICAgIGNvbnN0IGdseXBocyA9IGZvbnQuY2hhcnNUb0dseXBocyhlbmNvZGVkKTsKICAgICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IGZvbnQuZ2V0Q2hhclBvc2l0aW9ucyhlbmNvZGVkKTsKICAgICAgICAgIGNhY2hlZExpbmVzLnB1c2goewogICAgICAgICAgICBsaW5lOiBlbmNvZGVkLAogICAgICAgICAgICBnbHlwaHMsCiAgICAgICAgICAgIHBvc2l0aW9ucwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGlzVG9vQmlnID0gZnNpemUgPT4gewogICAgICAgICAgbGV0IHRvdGFsSGVpZ2h0ID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgY2FjaGUgb2YgY2FjaGVkTGluZXMpIHsKICAgICAgICAgICAgY29uc3QgY2h1bmtzID0gdGhpcy5fc3BsaXRMaW5lKG51bGwsIGZvbnQsIGZzaXplLCB3aWR0aCwgY2FjaGUpOwogICAgICAgICAgICB0b3RhbEhlaWdodCArPSBjaHVua3MubGVuZ3RoICogZnNpemU7CiAgICAgICAgICAgIGlmICh0b3RhbEhlaWdodCA+IGhlaWdodCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgICAgICBudW1iZXJPZkxpbmVzID0gTWF0aC5tYXgobnVtYmVyT2ZMaW5lcywgbGluZUNvdW50KTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgbGluZUhlaWdodCA9IGhlaWdodCAvIG51bWJlck9mTGluZXM7CiAgICAgICAgICBmb250U2l6ZSA9IHJvdW5kV2l0aFR3b0RpZ2l0cyhsaW5lSGVpZ2h0IC8gTElORV9GQUNUT1IpOwogICAgICAgICAgaWYgKGlzVG9vQmlnKGZvbnRTaXplKSkgewogICAgICAgICAgICBudW1iZXJPZkxpbmVzKys7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBmb250TmFtZSwKICAgICAgICBmb250Q29sb3IKICAgICAgfSA9IHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGE7CiAgICAgIHRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlID0gY3JlYXRlRGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgIGZvbnRTaXplLAogICAgICAgIGZvbnROYW1lLAogICAgICAgIGZvbnRDb2xvcgogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBbdGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UsIGZvbnRTaXplLCBoZWlnaHQgLyBudW1iZXJPZkxpbmVzXTsKICB9CiAgX3JlbmRlclRleHQodGV4dCwgZm9udCwgZm9udFNpemUsIHRvdGFsV2lkdGgsIGFsaWdubWVudCwgcHJldkluZm8sIGhQYWRkaW5nLCB2UGFkZGluZykgewogICAgbGV0IHNoaWZ0OwogICAgaWYgKGFsaWdubWVudCA9PT0gMSkgewogICAgICBjb25zdCB3aWR0aCA9IHRoaXMuX2dldFRleHRXaWR0aCh0ZXh0LCBmb250KSAqIGZvbnRTaXplOwogICAgICBzaGlmdCA9ICh0b3RhbFdpZHRoIC0gd2lkdGgpIC8gMjsKICAgIH0gZWxzZSBpZiAoYWxpZ25tZW50ID09PSAyKSB7CiAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5fZ2V0VGV4dFdpZHRoKHRleHQsIGZvbnQpICogZm9udFNpemU7CiAgICAgIHNoaWZ0ID0gdG90YWxXaWR0aCAtIHdpZHRoIC0gaFBhZGRpbmc7CiAgICB9IGVsc2UgewogICAgICBzaGlmdCA9IGhQYWRkaW5nOwogICAgfQogICAgY29uc3Qgc2hpZnRTdHIgPSBudW1iZXJUb1N0cmluZyhzaGlmdCAtIHByZXZJbmZvLnNoaWZ0KTsKICAgIHByZXZJbmZvLnNoaWZ0ID0gc2hpZnQ7CiAgICB2UGFkZGluZyA9IG51bWJlclRvU3RyaW5nKHZQYWRkaW5nKTsKICAgIHJldHVybiBgJHtzaGlmdFN0cn0gJHt2UGFkZGluZ30gVGQgKCR7ZXNjYXBlU3RyaW5nKHRleHQpfSkgVGpgOwogIH0KICBfZ2V0U2F2ZUZpZWxkUmVzb3VyY2VzKHhyZWYpIHsKICAgIGNvbnN0IHsKICAgICAgbG9jYWxSZXNvdXJjZXMsCiAgICAgIGFwcGVhcmFuY2VSZXNvdXJjZXMsCiAgICAgIGFjcm9Gb3JtUmVzb3VyY2VzCiAgICB9ID0gdGhpcy5fZmllbGRSZXNvdXJjZXM7CiAgICBjb25zdCBmb250TmFtZSA9IHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGE/LmZvbnROYW1lOwogICAgaWYgKCFmb250TmFtZSkgewogICAgICByZXR1cm4gbG9jYWxSZXNvdXJjZXMgfHwgRGljdC5lbXB0eTsKICAgIH0KICAgIGZvciAoY29uc3QgcmVzb3VyY2VzIG9mIFtsb2NhbFJlc291cmNlcywgYXBwZWFyYW5jZVJlc291cmNlc10pIHsKICAgICAgaWYgKHJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBjb25zdCBsb2NhbEZvbnQgPSByZXNvdXJjZXMuZ2V0KCJGb250Iik7CiAgICAgICAgaWYgKGxvY2FsRm9udCBpbnN0YW5jZW9mIERpY3QgJiYgbG9jYWxGb250Lmhhcyhmb250TmFtZSkpIHsKICAgICAgICAgIHJldHVybiByZXNvdXJjZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoYWNyb0Zvcm1SZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IGFjcm9Gb3JtRm9udCA9IGFjcm9Gb3JtUmVzb3VyY2VzLmdldCgiRm9udCIpOwogICAgICBpZiAoYWNyb0Zvcm1Gb250IGluc3RhbmNlb2YgRGljdCAmJiBhY3JvRm9ybUZvbnQuaGFzKGZvbnROYW1lKSkgewogICAgICAgIGNvbnN0IHN1YkZvbnREaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICAgICAgc3ViRm9udERpY3Quc2V0KGZvbnROYW1lLCBhY3JvRm9ybUZvbnQuZ2V0UmF3KGZvbnROYW1lKSk7CiAgICAgICAgY29uc3Qgc3ViUmVzb3VyY2VzRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICAgIHN1YlJlc291cmNlc0RpY3Quc2V0KCJGb250Iiwgc3ViRm9udERpY3QpOwogICAgICAgIHJldHVybiBEaWN0Lm1lcmdlKHsKICAgICAgICAgIHhyZWYsCiAgICAgICAgICBkaWN0QXJyYXk6IFtzdWJSZXNvdXJjZXNEaWN0LCBsb2NhbFJlc291cmNlc10sCiAgICAgICAgICBtZXJnZVN1YkRpY3RzOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBsb2NhbFJlc291cmNlcyB8fCBEaWN0LmVtcHR5OwogIH0KICBnZXRGaWVsZE9iamVjdCgpIHsKICAgIHJldHVybiBudWxsOwogIH0KfQpjbGFzcyBUZXh0V2lkZ2V0QW5ub3RhdGlvbiBleHRlbmRzIFdpZGdldEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdAogICAgfSA9IHBhcmFtczsKICAgIGlmIChkaWN0LmhhcygiUE1EIikpIHsKICAgICAgdGhpcy5mbGFncyB8PSBBbm5vdGF0aW9uRmxhZy5ISURERU47CiAgICAgIHRoaXMuZGF0YS5oaWRkZW4gPSB0cnVlOwogICAgICB3YXJuKCJCYXJjb2RlcyBhcmUgbm90IHN1cHBvcnRlZCIpOwogICAgfQogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5yZWFkT25seSAmJiAhdGhpcy5kYXRhLm5vSFRNTDsKICAgIHRoaXMuX2hhc1RleHQgPSB0cnVlOwogICAgaWYgKHR5cGVvZiB0aGlzLmRhdGEuZmllbGRWYWx1ZSAhPT0gInN0cmluZyIpIHsKICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSAiIjsKICAgIH0KICAgIGxldCBhbGlnbm1lbnQgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdCwKICAgICAga2V5OiAiUSIKICAgIH0pOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGFsaWdubWVudCkgfHwgYWxpZ25tZW50IDwgMCB8fCBhbGlnbm1lbnQgPiAyKSB7CiAgICAgIGFsaWdubWVudCA9IG51bGw7CiAgICB9CiAgICB0aGlzLmRhdGEudGV4dEFsaWdubWVudCA9IGFsaWdubWVudDsKICAgIGxldCBtYXhpbXVtTGVuZ3RoID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIk1heExlbiIKICAgIH0pOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG1heGltdW1MZW5ndGgpIHx8IG1heGltdW1MZW5ndGggPCAwKSB7CiAgICAgIG1heGltdW1MZW5ndGggPSAwOwogICAgfQogICAgdGhpcy5kYXRhLm1heExlbiA9IG1heGltdW1MZW5ndGg7CiAgICB0aGlzLmRhdGEubXVsdGlMaW5lID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5NVUxUSUxJTkUpOwogICAgdGhpcy5kYXRhLmNvbWIgPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLkNPTUIpICYmICF0aGlzLmRhdGEubXVsdGlMaW5lICYmICF0aGlzLmRhdGEucGFzc3dvcmQgJiYgIXRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuRklMRVNFTEVDVCkgJiYgdGhpcy5kYXRhLm1heExlbiAhPT0gMDsKICAgIHRoaXMuZGF0YS5kb05vdFNjcm9sbCA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuRE9OT1RTQ1JPTEwpOwogICAgY29uc3QgewogICAgICBkYXRhOiB7CiAgICAgICAgYWN0aW9ucwogICAgICB9CiAgICB9ID0gdGhpczsKICAgIGlmICghYWN0aW9ucykgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBBRkRhdGVUaW1lID0gL15BRihEYXRlfFRpbWUpXyg/OktleXN0cm9rZXxGb3JtYXQpKD86RXgpP1woWyciXT8oW14nIl0rKVsnIl0/XCk7JC87CiAgICBsZXQgY2FuVXNlSFRNTERhdGVUaW1lID0gZmFsc2U7CiAgICBpZiAoYWN0aW9ucy5Gb3JtYXQ/Lmxlbmd0aCA9PT0gMSAmJiBhY3Rpb25zLktleXN0cm9rZT8ubGVuZ3RoID09PSAxICYmIEFGRGF0ZVRpbWUudGVzdChhY3Rpb25zLkZvcm1hdFswXSkgJiYgQUZEYXRlVGltZS50ZXN0KGFjdGlvbnMuS2V5c3Ryb2tlWzBdKSB8fCBhY3Rpb25zLkZvcm1hdD8ubGVuZ3RoID09PSAwICYmIGFjdGlvbnMuS2V5c3Ryb2tlPy5sZW5ndGggPT09IDEgJiYgQUZEYXRlVGltZS50ZXN0KGFjdGlvbnMuS2V5c3Ryb2tlWzBdKSB8fCBhY3Rpb25zLktleXN0cm9rZT8ubGVuZ3RoID09PSAwICYmIGFjdGlvbnMuRm9ybWF0Py5sZW5ndGggPT09IDEgJiYgQUZEYXRlVGltZS50ZXN0KGFjdGlvbnMuRm9ybWF0WzBdKSkgewogICAgICBjYW5Vc2VIVE1MRGF0ZVRpbWUgPSB0cnVlOwogICAgfQogICAgY29uc3QgYWN0aW9uc1RvVmlzaXQgPSBbXTsKICAgIGlmIChhY3Rpb25zLkZvcm1hdCkgewogICAgICBhY3Rpb25zVG9WaXNpdC5wdXNoKC4uLmFjdGlvbnMuRm9ybWF0KTsKICAgIH0KICAgIGlmIChhY3Rpb25zLktleXN0cm9rZSkgewogICAgICBhY3Rpb25zVG9WaXNpdC5wdXNoKC4uLmFjdGlvbnMuS2V5c3Ryb2tlKTsKICAgIH0KICAgIGlmIChjYW5Vc2VIVE1MRGF0ZVRpbWUpIHsKICAgICAgZGVsZXRlIGFjdGlvbnMuS2V5c3Ryb2tlOwogICAgICBhY3Rpb25zLkZvcm1hdCA9IGFjdGlvbnNUb1Zpc2l0OwogICAgfQogICAgZm9yIChjb25zdCBmb3JtYXRBY3Rpb24gb2YgYWN0aW9uc1RvVmlzaXQpIHsKICAgICAgY29uc3QgbSA9IGZvcm1hdEFjdGlvbi5tYXRjaChBRkRhdGVUaW1lKTsKICAgICAgaWYgKCFtKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaXNEYXRlID0gbVsxXSA9PT0gIkRhdGUiOwogICAgICBsZXQgZm9ybWF0ID0gbVsyXTsKICAgICAgY29uc3QgbnVtID0gcGFyc2VJbnQoZm9ybWF0LCAxMCk7CiAgICAgIGlmICghaXNOYU4obnVtKSAmJiBNYXRoLmZsb29yKE1hdGgubG9nMTAobnVtKSkgKyAxID09PSBtWzJdLmxlbmd0aCkgewogICAgICAgIGZvcm1hdCA9IChpc0RhdGUgPyBEYXRlRm9ybWF0cyA6IFRpbWVGb3JtYXRzKVtudW1dID8/IGZvcm1hdDsKICAgICAgfQogICAgICB0aGlzLmRhdGEuZGF0ZXRpbWVGb3JtYXQgPSBmb3JtYXQ7CiAgICAgIGlmICghY2FuVXNlSFRNTERhdGVUaW1lKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGlzRGF0ZSkgewogICAgICAgIGlmICgvSEh8TU18c3N8aC8udGVzdChmb3JtYXQpKSB7CiAgICAgICAgICB0aGlzLmRhdGEuZGF0ZXRpbWVUeXBlID0gImRhdGV0aW1lLWxvY2FsIjsKICAgICAgICAgIHRoaXMuZGF0YS50aW1lU3RlcCA9IC9zcy8udGVzdChmb3JtYXQpID8gMSA6IDYwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmRhdGEuZGF0ZXRpbWVUeXBlID0gImRhdGUiOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLmRhdGEuZGF0ZXRpbWVUeXBlID0gInRpbWUiOwogICAgICB0aGlzLmRhdGEudGltZVN0ZXAgPSAvc3MvLnRlc3QoZm9ybWF0KSA/IDEgOiA2MDsKICAgICAgYnJlYWs7CiAgICB9CiAgfQogIGdldCBoYXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiAhIXRoaXMuYXBwZWFyYW5jZSAmJiAhdGhpcy5fbmVlZEFwcGVhcmFuY2VzOwogIH0KICBfZ2V0Q29tYkFwcGVhcmFuY2UoZGVmYXVsdEFwcGVhcmFuY2UsIGZvbnQsIHRleHQsIGZvbnRTaXplLCB3aWR0aCwgaGVpZ2h0LCBoUGFkZGluZywgdlBhZGRpbmcsIGRlc2NlbnQsIGxpbmVIZWlnaHQsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBjb25zdCBjb21iV2lkdGggPSB3aWR0aCAvIHRoaXMuZGF0YS5tYXhMZW47CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmdldEJvcmRlckFuZEJhY2tncm91bmRBcHBlYXJhbmNlcyhhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICBjb25zdCBidWYgPSBbXTsKICAgIGNvbnN0IHBvc2l0aW9ucyA9IGZvbnQuZ2V0Q2hhclBvc2l0aW9ucyh0ZXh0KTsKICAgIGZvciAoY29uc3QgW3N0YXJ0LCBlbmRdIG9mIHBvc2l0aW9ucykgewogICAgICBidWYucHVzaChgKCR7ZXNjYXBlU3RyaW5nKHRleHQuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpKX0pIFRqYCk7CiAgICB9CiAgICBjb25zdCByZW5kZXJlZENvbWIgPSBidWYuam9pbihgICR7bnVtYmVyVG9TdHJpbmcoY29tYldpZHRoKX0gMCBUZCBgKTsKICAgIHJldHVybiBgL1R4IEJNQyBxICR7Y29sb3JzfUJUIGAgKyBkZWZhdWx0QXBwZWFyYW5jZSArIGAgMSAwIDAgMSAke251bWJlclRvU3RyaW5nKGhQYWRkaW5nKX0gJHtudW1iZXJUb1N0cmluZyh2UGFkZGluZyArIGRlc2NlbnQpfSBUbSAke3JlbmRlcmVkQ29tYn1gICsgIiBFVCBRIEVNQyI7CiAgfQogIF9nZXRNdWx0aWxpbmVBcHBlYXJhbmNlKGRlZmF1bHRBcHBlYXJhbmNlLCBsaW5lcywgZm9udCwgZm9udFNpemUsIHdpZHRoLCBoZWlnaHQsIGFsaWdubWVudCwgaFBhZGRpbmcsIHZQYWRkaW5nLCBkZXNjZW50LCBsaW5lSGVpZ2h0LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgY29uc3QgYnVmID0gW107CiAgICBjb25zdCB0b3RhbFdpZHRoID0gd2lkdGggLSAyICogaFBhZGRpbmc7CiAgICBjb25zdCBwcmV2SW5mbyA9IHsKICAgICAgc2hpZnQ6IDAKICAgIH07CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBsaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXTsKICAgICAgY29uc3QgY2h1bmtzID0gdGhpcy5fc3BsaXRMaW5lKGxpbmUsIGZvbnQsIGZvbnRTaXplLCB0b3RhbFdpZHRoKTsKICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gY2h1bmtzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICBjb25zdCBjaHVuayA9IGNodW5rc1tqXTsKICAgICAgICBjb25zdCB2U2hpZnQgPSBpID09PSAwICYmIGogPT09IDAgPyAtdlBhZGRpbmcgLSAobGluZUhlaWdodCAtIGRlc2NlbnQpIDogLWxpbmVIZWlnaHQ7CiAgICAgICAgYnVmLnB1c2godGhpcy5fcmVuZGVyVGV4dChjaHVuaywgZm9udCwgZm9udFNpemUsIHdpZHRoLCBhbGlnbm1lbnQsIHByZXZJbmZvLCBoUGFkZGluZywgdlNoaWZ0KSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuZ2V0Qm9yZGVyQW5kQmFja2dyb3VuZEFwcGVhcmFuY2VzKGFubm90YXRpb25TdG9yYWdlKTsKICAgIGNvbnN0IHJlbmRlcmVkVGV4dCA9IGJ1Zi5qb2luKCJcbiIpOwogICAgcmV0dXJuIGAvVHggQk1DIHEgJHtjb2xvcnN9QlQgYCArIGRlZmF1bHRBcHBlYXJhbmNlICsgYCAxIDAgMCAxIDAgJHtudW1iZXJUb1N0cmluZyhoZWlnaHQpfSBUbSAke3JlbmRlcmVkVGV4dH1gICsgIiBFVCBRIEVNQyI7CiAgfQogIF9zcGxpdExpbmUobGluZSwgZm9udCwgZm9udFNpemUsIHdpZHRoLCBjYWNoZSA9IHt9KSB7CiAgICBsaW5lID0gY2FjaGUubGluZSB8fCBsaW5lOwogICAgY29uc3QgZ2x5cGhzID0gY2FjaGUuZ2x5cGhzIHx8IGZvbnQuY2hhcnNUb0dseXBocyhsaW5lKTsKICAgIGlmIChnbHlwaHMubGVuZ3RoIDw9IDEpIHsKICAgICAgcmV0dXJuIFtsaW5lXTsKICAgIH0KICAgIGNvbnN0IHBvc2l0aW9ucyA9IGNhY2hlLnBvc2l0aW9ucyB8fCBmb250LmdldENoYXJQb3NpdGlvbnMobGluZSk7CiAgICBjb25zdCBzY2FsZSA9IGZvbnRTaXplIC8gMTAwMDsKICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgbGV0IGxhc3RTcGFjZVBvc0luU3RyaW5nU3RhcnQgPSAtMSwKICAgICAgbGFzdFNwYWNlUG9zSW5TdHJpbmdFbmQgPSAtMSwKICAgICAgbGFzdFNwYWNlUG9zID0gLTEsCiAgICAgIHN0YXJ0Q2h1bmsgPSAwLAogICAgICBjdXJyZW50V2lkdGggPSAwOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZ2x5cGhzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgW3N0YXJ0LCBlbmRdID0gcG9zaXRpb25zW2ldOwogICAgICBjb25zdCBnbHlwaCA9IGdseXBoc1tpXTsKICAgICAgY29uc3QgZ2x5cGhXaWR0aCA9IGdseXBoLndpZHRoICogc2NhbGU7CiAgICAgIGlmIChnbHlwaC51bmljb2RlID09PSAiICIpIHsKICAgICAgICBpZiAoY3VycmVudFdpZHRoICsgZ2x5cGhXaWR0aCA+IHdpZHRoKSB7CiAgICAgICAgICBjaHVua3MucHVzaChsaW5lLnN1YnN0cmluZyhzdGFydENodW5rLCBzdGFydCkpOwogICAgICAgICAgc3RhcnRDaHVuayA9IHN0YXJ0OwogICAgICAgICAgY3VycmVudFdpZHRoID0gZ2x5cGhXaWR0aDsKICAgICAgICAgIGxhc3RTcGFjZVBvc0luU3RyaW5nU3RhcnQgPSAtMTsKICAgICAgICAgIGxhc3RTcGFjZVBvcyA9IC0xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50V2lkdGggKz0gZ2x5cGhXaWR0aDsKICAgICAgICAgIGxhc3RTcGFjZVBvc0luU3RyaW5nU3RhcnQgPSBzdGFydDsKICAgICAgICAgIGxhc3RTcGFjZVBvc0luU3RyaW5nRW5kID0gZW5kOwogICAgICAgICAgbGFzdFNwYWNlUG9zID0gaTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY3VycmVudFdpZHRoICsgZ2x5cGhXaWR0aCA+IHdpZHRoKSB7CiAgICAgICAgaWYgKGxhc3RTcGFjZVBvc0luU3RyaW5nU3RhcnQgIT09IC0xKSB7CiAgICAgICAgICBjaHVua3MucHVzaChsaW5lLnN1YnN0cmluZyhzdGFydENodW5rLCBsYXN0U3BhY2VQb3NJblN0cmluZ0VuZCkpOwogICAgICAgICAgc3RhcnRDaHVuayA9IGxhc3RTcGFjZVBvc0luU3RyaW5nRW5kOwogICAgICAgICAgaSA9IGxhc3RTcGFjZVBvcyArIDE7CiAgICAgICAgICBsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ID0gLTE7CiAgICAgICAgICBjdXJyZW50V2lkdGggPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjaHVua3MucHVzaChsaW5lLnN1YnN0cmluZyhzdGFydENodW5rLCBzdGFydCkpOwogICAgICAgICAgc3RhcnRDaHVuayA9IHN0YXJ0OwogICAgICAgICAgY3VycmVudFdpZHRoID0gZ2x5cGhXaWR0aDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3VycmVudFdpZHRoICs9IGdseXBoV2lkdGg7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdGFydENodW5rIDwgbGluZS5sZW5ndGgpIHsKICAgICAgY2h1bmtzLnB1c2gobGluZS5zdWJzdHJpbmcoc3RhcnRDaHVuaywgbGluZS5sZW5ndGgpKTsKICAgIH0KICAgIHJldHVybiBjaHVua3M7CiAgfQogIGFzeW5jIGV4dHJhY3RUZXh0Q29udGVudChldmFsdWF0b3IsIHRhc2ssIHZpZXdCb3gpIHsKICAgIGF3YWl0IHN1cGVyLmV4dHJhY3RUZXh0Q29udGVudChldmFsdWF0b3IsIHRhc2ssIHZpZXdCb3gpOwogICAgY29uc3QgdGV4dCA9IHRoaXMuZGF0YS50ZXh0Q29udGVudDsKICAgIGlmICghdGV4dCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBhbGxUZXh0ID0gdGV4dC5qb2luKCJcbiIpOwogICAgaWYgKGFsbFRleHQgPT09IHRoaXMuZGF0YS5maWVsZFZhbHVlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJlZ2V4ID0gYWxsVGV4dC5yZXBsYWNlQWxsKC8oWy4qKz9eJHt9KCl8W1xdXFxdKXwoXHMrKS9nLCAoX20sIHAxKSA9PiBwMSA/IGBcXCR7cDF9YCA6ICJcXHMrIik7CiAgICBpZiAobmV3IFJlZ0V4cChgXlxccyoke3JlZ2V4fVxccyokYCkudGVzdCh0aGlzLmRhdGEuZmllbGRWYWx1ZSkpIHsKICAgICAgdGhpcy5kYXRhLnRleHRDb250ZW50ID0gdGhpcy5kYXRhLmZpZWxkVmFsdWUuc3BsaXQoIlxuIik7CiAgICB9CiAgfQogIGdldEZpZWxkT2JqZWN0KCkgewogICAgcmV0dXJuIHsKICAgICAgaWQ6IHRoaXMuZGF0YS5pZCwKICAgICAgdmFsdWU6IHRoaXMuZGF0YS5maWVsZFZhbHVlLAogICAgICBkZWZhdWx0VmFsdWU6IHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSB8fCAiIiwKICAgICAgbXVsdGlsaW5lOiB0aGlzLmRhdGEubXVsdGlMaW5lLAogICAgICBwYXNzd29yZDogdGhpcy5kYXRhLnBhc3N3b3JkLAogICAgICBjaGFyTGltaXQ6IHRoaXMuZGF0YS5tYXhMZW4sCiAgICAgIGNvbWI6IHRoaXMuZGF0YS5jb21iLAogICAgICBlZGl0YWJsZTogIXRoaXMuZGF0YS5yZWFkT25seSwKICAgICAgaGlkZGVuOiB0aGlzLmRhdGEuaGlkZGVuLAogICAgICBuYW1lOiB0aGlzLmRhdGEuZmllbGROYW1lLAogICAgICByZWN0OiB0aGlzLmRhdGEucmVjdCwKICAgICAgYWN0aW9uczogdGhpcy5kYXRhLmFjdGlvbnMsCiAgICAgIHBhZ2U6IHRoaXMuZGF0YS5wYWdlSW5kZXgsCiAgICAgIHN0cm9rZUNvbG9yOiB0aGlzLmRhdGEuYm9yZGVyQ29sb3IsCiAgICAgIGZpbGxDb2xvcjogdGhpcy5kYXRhLmJhY2tncm91bmRDb2xvciwKICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgIGRhdGV0aW1lRm9ybWF0OiB0aGlzLmRhdGEuZGF0ZXRpbWVGb3JtYXQsCiAgICAgIGhhc0RhdGV0aW1lSFRNTDogISF0aGlzLmRhdGEuZGF0ZXRpbWVUeXBlLAogICAgICB0eXBlOiAidGV4dCIKICAgIH07CiAgfQp9CmNsYXNzIEJ1dHRvbldpZGdldEFubm90YXRpb24gZXh0ZW5kcyBXaWRnZXRBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlID0gbnVsbDsKICAgIHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSA9IG51bGw7CiAgICBjb25zdCBpc1JhZGlvID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5SQURJTyksCiAgICAgIGlzUHVzaEJ1dHRvbiA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuUFVTSEJVVFRPTik7CiAgICB0aGlzLmRhdGEuY2hlY2tCb3ggPSAhaXNSYWRpbyAmJiAhaXNQdXNoQnV0dG9uOwogICAgdGhpcy5kYXRhLnJhZGlvQnV0dG9uID0gaXNSYWRpbyAmJiAhaXNQdXNoQnV0dG9uOwogICAgdGhpcy5kYXRhLnB1c2hCdXR0b24gPSBpc1B1c2hCdXR0b247CiAgICB0aGlzLmRhdGEuaXNUb29sdGlwT25seSA9IGZhbHNlOwogICAgaWYgKHRoaXMuZGF0YS5jaGVja0JveCkgewogICAgICB0aGlzLl9wcm9jZXNzQ2hlY2tCb3gocGFyYW1zKTsKICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLnJhZGlvQnV0dG9uKSB7CiAgICAgIHRoaXMuX3Byb2Nlc3NSYWRpb0J1dHRvbihwYXJhbXMpOwogICAgfSBlbHNlIGlmICh0aGlzLmRhdGEucHVzaEJ1dHRvbikgewogICAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdHJ1ZTsKICAgICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgICB0aGlzLl9wcm9jZXNzUHVzaEJ1dHRvbihwYXJhbXMpOwogICAgfSBlbHNlIHsKICAgICAgd2FybigiSW52YWxpZCBmaWVsZCBmbGFncyBmb3IgYnV0dG9uIHdpZGdldCBhbm5vdGF0aW9uIik7CiAgICB9CiAgfQogIGFzeW5jIGdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGlmICh0aGlzLmRhdGEucHVzaEJ1dHRvbikgewogICAgICByZXR1cm4gc3VwZXIuZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBmYWxzZSwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgbGV0IHZhbHVlID0gbnVsbDsKICAgIGxldCByb3RhdGlvbiA9IG51bGw7CiAgICBpZiAoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2UuZ2V0KHRoaXMuZGF0YS5pZCk7CiAgICAgIHZhbHVlID0gc3RvcmFnZUVudHJ5ID8gc3RvcmFnZUVudHJ5LnZhbHVlIDogbnVsbDsKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnkgPyBzdG9yYWdlRW50cnkucm90YXRpb24gOiBudWxsOwogICAgfQogICAgaWYgKHZhbHVlID09PSBudWxsICYmIHRoaXMuYXBwZWFyYW5jZSkgewogICAgICByZXR1cm4gc3VwZXIuZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICB9CiAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuZGF0YS5jaGVja0JveCA/IHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSB0aGlzLmRhdGEuZXhwb3J0VmFsdWUgOiB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmJ1dHRvblZhbHVlOwogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZSA9IHZhbHVlID8gdGhpcy5jaGVja2VkQXBwZWFyYW5jZSA6IHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZTsKICAgIGlmIChhcHBlYXJhbmNlKSB7CiAgICAgIGNvbnN0IHNhdmVkQXBwZWFyYW5jZSA9IHRoaXMuYXBwZWFyYW5jZTsKICAgICAgY29uc3Qgc2F2ZWRNYXRyaXggPSBsb29rdXBNYXRyaXgoYXBwZWFyYW5jZS5kaWN0LmdldEFycmF5KCJNYXRyaXgiKSwgSURFTlRJVFlfTUFUUklYKTsKICAgICAgaWYgKHJvdGF0aW9uKSB7CiAgICAgICAgYXBwZWFyYW5jZS5kaWN0LnNldCgiTWF0cml4IiwgdGhpcy5nZXRSb3RhdGlvbk1hdHJpeChhbm5vdGF0aW9uU3RvcmFnZSkpOwogICAgICB9CiAgICAgIHRoaXMuYXBwZWFyYW5jZSA9IGFwcGVhcmFuY2U7CiAgICAgIGNvbnN0IG9wZXJhdG9yTGlzdCA9IHN1cGVyLmdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgICB0aGlzLmFwcGVhcmFuY2UgPSBzYXZlZEFwcGVhcmFuY2U7CiAgICAgIGFwcGVhcmFuY2UuZGljdC5zZXQoIk1hdHJpeCIsIHNhdmVkTWF0cml4KTsKICAgICAgcmV0dXJuIG9wZXJhdG9yTGlzdDsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG9wTGlzdDogbmV3IE9wZXJhdG9yTGlzdCgpLAogICAgICBzZXBhcmF0ZUZvcm06IGZhbHNlLAogICAgICBzZXBhcmF0ZUNhbnZhczogZmFsc2UKICAgIH07CiAgfQogIGFzeW5jIHNhdmUoZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSwgY2hhbmdlcykgewogICAgaWYgKHRoaXMuZGF0YS5jaGVja0JveCkgewogICAgICB0aGlzLl9zYXZlQ2hlY2tib3goZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSwgY2hhbmdlcyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLmRhdGEucmFkaW9CdXR0b24pIHsKICAgICAgdGhpcy5fc2F2ZVJhZGlvQnV0dG9uKGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpOwogICAgfQogIH0KICBhc3luYyBfc2F2ZUNoZWNrYm94KGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpIHsKICAgIGlmICghYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2UuZ2V0KHRoaXMuZGF0YS5pZCk7CiAgICBjb25zdCBmbGFncyA9IHRoaXMuX2J1aWxkRmxhZ3Moc3RvcmFnZUVudHJ5Py5ub1ZpZXcsIHN0b3JhZ2VFbnRyeT8ubm9QcmludCk7CiAgICBsZXQgcm90YXRpb24gPSBzdG9yYWdlRW50cnk/LnJvdGF0aW9uLAogICAgICB2YWx1ZSA9IHN0b3JhZ2VFbnRyeT8udmFsdWU7CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiBmbGFncyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSB0aGlzLmRhdGEuZXhwb3J0VmFsdWU7CiAgICAgIGlmIChkZWZhdWx0VmFsdWUgPT09IHZhbHVlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICBsZXQgZGljdCA9IGV2YWx1YXRvci54cmVmLmZldGNoSWZSZWYodGhpcy5yZWYpOwogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGRpY3QgPSBkaWN0LmNsb25lKCk7CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb247CiAgICB9CiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSB0aGlzLmRhdGEuZXhwb3J0VmFsdWU7CiAgICB9CiAgICBjb25zdCB4ZmEgPSB7CiAgICAgIHBhdGg6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgIHZhbHVlOiB2YWx1ZSA/IHRoaXMuZGF0YS5leHBvcnRWYWx1ZSA6ICIiCiAgICB9OwogICAgY29uc3QgbmFtZSA9IE5hbWUuZ2V0KHZhbHVlID8gdGhpcy5kYXRhLmV4cG9ydFZhbHVlIDogIk9mZiIpOwogICAgdGhpcy5zZXRWYWx1ZShkaWN0LCBuYW1lLCBldmFsdWF0b3IueHJlZiwgY2hhbmdlcyk7CiAgICBkaWN0LnNldCgiQVMiLCBuYW1lKTsKICAgIGRpY3Quc2V0KCJNIiwgYEQ6JHtnZXRNb2RpZmljYXRpb25EYXRlKCl9YCk7CiAgICBpZiAoZmxhZ3MgIT09IHVuZGVmaW5lZCkgewogICAgICBkaWN0LnNldCgiRiIsIGZsYWdzKTsKICAgIH0KICAgIGNvbnN0IG1heWJlTUsgPSB0aGlzLl9nZXRNS0RpY3Qocm90YXRpb24pOwogICAgaWYgKG1heWJlTUspIHsKICAgICAgZGljdC5zZXQoIk1LIiwgbWF5YmVNSyk7CiAgICB9CiAgICBjaGFuZ2VzLnB1dCh0aGlzLnJlZiwgewogICAgICBkYXRhOiBkaWN0LAogICAgICB4ZmEsCiAgICAgIG5lZWRBcHBlYXJhbmNlczogZmFsc2UKICAgIH0pOwogIH0KICBhc3luYyBfc2F2ZVJhZGlvQnV0dG9uKGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpIHsKICAgIGlmICghYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2UuZ2V0KHRoaXMuZGF0YS5pZCk7CiAgICBjb25zdCBmbGFncyA9IHRoaXMuX2J1aWxkRmxhZ3Moc3RvcmFnZUVudHJ5Py5ub1ZpZXcsIHN0b3JhZ2VFbnRyeT8ubm9QcmludCk7CiAgICBsZXQgcm90YXRpb24gPSBzdG9yYWdlRW50cnk/LnJvdGF0aW9uLAogICAgICB2YWx1ZSA9IHN0b3JhZ2VFbnRyeT8udmFsdWU7CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiBmbGFncyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSB0aGlzLmRhdGEuYnV0dG9uVmFsdWU7CiAgICAgIGlmIChkZWZhdWx0VmFsdWUgPT09IHZhbHVlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICBsZXQgZGljdCA9IGV2YWx1YXRvci54cmVmLmZldGNoSWZSZWYodGhpcy5yZWYpOwogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGRpY3QgPSBkaWN0LmNsb25lKCk7CiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSB0aGlzLmRhdGEuYnV0dG9uVmFsdWU7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb247CiAgICB9CiAgICBjb25zdCB4ZmEgPSB7CiAgICAgIHBhdGg6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgIHZhbHVlOiB2YWx1ZSA/IHRoaXMuZGF0YS5idXR0b25WYWx1ZSA6ICIiCiAgICB9OwogICAgY29uc3QgbmFtZSA9IE5hbWUuZ2V0KHZhbHVlID8gdGhpcy5kYXRhLmJ1dHRvblZhbHVlIDogIk9mZiIpOwogICAgaWYgKHZhbHVlKSB7CiAgICAgIHRoaXMuc2V0VmFsdWUoZGljdCwgbmFtZSwgZXZhbHVhdG9yLnhyZWYsIGNoYW5nZXMpOwogICAgfQogICAgZGljdC5zZXQoIkFTIiwgbmFtZSk7CiAgICBkaWN0LnNldCgiTSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZSgpfWApOwogICAgaWYgKGZsYWdzICE9PSB1bmRlZmluZWQpIHsKICAgICAgZGljdC5zZXQoIkYiLCBmbGFncyk7CiAgICB9CiAgICBjb25zdCBtYXliZU1LID0gdGhpcy5fZ2V0TUtEaWN0KHJvdGF0aW9uKTsKICAgIGlmIChtYXliZU1LKSB7CiAgICAgIGRpY3Quc2V0KCJNSyIsIG1heWJlTUspOwogICAgfQogICAgY2hhbmdlcy5wdXQodGhpcy5yZWYsIHsKICAgICAgZGF0YTogZGljdCwKICAgICAgeGZhLAogICAgICBuZWVkQXBwZWFyYW5jZXM6IGZhbHNlCiAgICB9KTsKICB9CiAgX2dldERlZmF1bHRDaGVja2VkQXBwZWFyYW5jZShwYXJhbXMsIHR5cGUpIHsKICAgIGNvbnN0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXM7CiAgICBjb25zdCBiYm94ID0gWzAsIDAsIHdpZHRoLCBoZWlnaHRdOwogICAgY29uc3QgRk9OVF9SQVRJTyA9IDAuODsKICAgIGNvbnN0IGZvbnRTaXplID0gTWF0aC5taW4od2lkdGgsIGhlaWdodCkgKiBGT05UX1JBVElPOwogICAgbGV0IG1ldHJpY3MsIGNoYXI7CiAgICBpZiAodHlwZSA9PT0gImNoZWNrIikgewogICAgICBtZXRyaWNzID0gewogICAgICAgIHdpZHRoOiAwLjc1NSAqIGZvbnRTaXplLAogICAgICAgIGhlaWdodDogMC43MDUgKiBmb250U2l6ZQogICAgICB9OwogICAgICBjaGFyID0gIlx4MzMiOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAiZGlzYyIpIHsKICAgICAgbWV0cmljcyA9IHsKICAgICAgICB3aWR0aDogMC43OTEgKiBmb250U2l6ZSwKICAgICAgICBoZWlnaHQ6IDAuNzA1ICogZm9udFNpemUKICAgICAgfTsKICAgICAgY2hhciA9ICJceDZDIjsKICAgIH0gZWxzZSB7CiAgICAgIHVucmVhY2hhYmxlKGBfZ2V0RGVmYXVsdENoZWNrZWRBcHBlYXJhbmNlIC0gdW5zdXBwb3J0ZWQgdHlwZTogJHt0eXBlfWApOwogICAgfQogICAgY29uc3QgeFNoaWZ0ID0gbnVtYmVyVG9TdHJpbmcoKHdpZHRoIC0gbWV0cmljcy53aWR0aCkgLyAyKTsKICAgIGNvbnN0IHlTaGlmdCA9IG51bWJlclRvU3RyaW5nKChoZWlnaHQgLSBtZXRyaWNzLmhlaWdodCkgLyAyKTsKICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBgcSBCVCAvUGRmSnNaYURiICR7Zm9udFNpemV9IFRmIDAgZyAke3hTaGlmdH0gJHt5U2hpZnR9IFRkICgke2NoYXJ9KSBUaiBFVCBRYDsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW1EaWN0ID0gbmV3IERpY3QocGFyYW1zLnhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCBiYm94KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTWF0cml4IiwgWzEsIDAsIDAsIDEsIDAsIDBdKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTGVuZ3RoIiwgYXBwZWFyYW5jZS5sZW5ndGgpOwogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QocGFyYW1zLnhyZWYpOwogICAgY29uc3QgZm9udCA9IG5ldyBEaWN0KHBhcmFtcy54cmVmKTsKICAgIGZvbnQuc2V0KCJQZGZKc1phRGIiLCB0aGlzLmZhbGxiYWNrRm9udERpY3QpOwogICAgcmVzb3VyY2VzLnNldCgiRm9udCIsIGZvbnQpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgdGhpcy5jaGVja2VkQXBwZWFyYW5jZSA9IG5ldyBTdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLmNoZWNrZWRBcHBlYXJhbmNlKTsKICB9CiAgX3Byb2Nlc3NDaGVja0JveChwYXJhbXMpIHsKICAgIGNvbnN0IGN1c3RvbUFwcGVhcmFuY2UgPSBwYXJhbXMuZGljdC5nZXQoIkFQIik7CiAgICBpZiAoIShjdXN0b21BcHBlYXJhbmNlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgbm9ybWFsQXBwZWFyYW5jZSA9IGN1c3RvbUFwcGVhcmFuY2UuZ2V0KCJOIik7CiAgICBpZiAoIShub3JtYWxBcHBlYXJhbmNlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYXNWYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShwYXJhbXMuZGljdC5nZXQoIkFTIikpOwogICAgaWYgKHR5cGVvZiBhc1ZhbHVlID09PSAic3RyaW5nIikgewogICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9IGFzVmFsdWU7CiAgICB9CiAgICBjb25zdCB5ZXMgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSAhPT0gbnVsbCAmJiB0aGlzLmRhdGEuZmllbGRWYWx1ZSAhPT0gIk9mZiIgPyB0aGlzLmRhdGEuZmllbGRWYWx1ZSA6ICJZZXMiOwogICAgY29uc3QgZXhwb3J0VmFsdWVzID0gdGhpcy5fZGVjb2RlRm9ybVZhbHVlKG5vcm1hbEFwcGVhcmFuY2UuZ2V0S2V5cygpKTsKICAgIGlmIChleHBvcnRWYWx1ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgIGV4cG9ydFZhbHVlcy5wdXNoKCJPZmYiLCB5ZXMpOwogICAgfSBlbHNlIGlmIChleHBvcnRWYWx1ZXMubGVuZ3RoID09PSAxKSB7CiAgICAgIGlmIChleHBvcnRWYWx1ZXNbMF0gPT09ICJPZmYiKSB7CiAgICAgICAgZXhwb3J0VmFsdWVzLnB1c2goeWVzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBleHBvcnRWYWx1ZXMudW5zaGlmdCgiT2ZmIik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXhwb3J0VmFsdWVzLmluY2x1ZGVzKHllcykpIHsKICAgICAgZXhwb3J0VmFsdWVzLmxlbmd0aCA9IDA7CiAgICAgIGV4cG9ydFZhbHVlcy5wdXNoKCJPZmYiLCB5ZXMpOwogICAgfSBlbHNlIHsKICAgICAgY29uc3Qgb3RoZXJZZXMgPSBleHBvcnRWYWx1ZXMuZmluZCh2ID0+IHYgIT09ICJPZmYiKTsKICAgICAgZXhwb3J0VmFsdWVzLmxlbmd0aCA9IDA7CiAgICAgIGV4cG9ydFZhbHVlcy5wdXNoKCJPZmYiLCBvdGhlclllcyk7CiAgICB9CiAgICBpZiAoIWV4cG9ydFZhbHVlcy5pbmNsdWRlcyh0aGlzLmRhdGEuZmllbGRWYWx1ZSkpIHsKICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSAiT2ZmIjsKICAgIH0KICAgIHRoaXMuZGF0YS5leHBvcnRWYWx1ZSA9IGV4cG9ydFZhbHVlc1sxXTsKICAgIGNvbnN0IGNoZWNrZWRBcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZS5nZXQodGhpcy5kYXRhLmV4cG9ydFZhbHVlKTsKICAgIHRoaXMuY2hlY2tlZEFwcGVhcmFuY2UgPSBjaGVja2VkQXBwZWFyYW5jZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gPyBjaGVja2VkQXBwZWFyYW5jZSA6IG51bGw7CiAgICBjb25zdCB1bmNoZWNrZWRBcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZS5nZXQoIk9mZiIpOwogICAgdGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlID0gdW5jaGVja2VkQXBwZWFyYW5jZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gPyB1bmNoZWNrZWRBcHBlYXJhbmNlIDogbnVsbDsKICAgIGlmICh0aGlzLmNoZWNrZWRBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLmNoZWNrZWRBcHBlYXJhbmNlKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX2dldERlZmF1bHRDaGVja2VkQXBwZWFyYW5jZShwYXJhbXMsICJjaGVjayIpOwogICAgfQogICAgaWYgKHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlKTsKICAgIH0KICAgIHRoaXMuX2ZhbGxiYWNrRm9udERpY3QgPSB0aGlzLmZhbGxiYWNrRm9udERpY3Q7CiAgICBpZiAodGhpcy5kYXRhLmRlZmF1bHRGaWVsZFZhbHVlID09PSBudWxsKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA9ICJPZmYiOwogICAgfQogIH0KICBfcHJvY2Vzc1JhZGlvQnV0dG9uKHBhcmFtcykgewogICAgdGhpcy5kYXRhLmJ1dHRvblZhbHVlID0gbnVsbDsKICAgIGNvbnN0IGZpZWxkUGFyZW50ID0gcGFyYW1zLmRpY3QuZ2V0KCJQYXJlbnQiKTsKICAgIGlmIChmaWVsZFBhcmVudCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgdGhpcy5wYXJlbnQgPSBwYXJhbXMuZGljdC5nZXRSYXcoIlBhcmVudCIpOwogICAgICBjb25zdCBmaWVsZFBhcmVudFZhbHVlID0gZmllbGRQYXJlbnQuZ2V0KCJWIik7CiAgICAgIGlmIChmaWVsZFBhcmVudFZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gdGhpcy5fZGVjb2RlRm9ybVZhbHVlKGZpZWxkUGFyZW50VmFsdWUpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBhcHBlYXJhbmNlU3RhdGVzID0gcGFyYW1zLmRpY3QuZ2V0KCJBUCIpOwogICAgaWYgKCEoYXBwZWFyYW5jZVN0YXRlcyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG5vcm1hbEFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlU3RhdGVzLmdldCgiTiIpOwogICAgaWYgKCEobm9ybWFsQXBwZWFyYW5jZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3Qga2V5IG9mIG5vcm1hbEFwcGVhcmFuY2UuZ2V0S2V5cygpKSB7CiAgICAgIGlmIChrZXkgIT09ICJPZmYiKSB7CiAgICAgICAgdGhpcy5kYXRhLmJ1dHRvblZhbHVlID0gdGhpcy5fZGVjb2RlRm9ybVZhbHVlKGtleSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGNoZWNrZWRBcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZS5nZXQodGhpcy5kYXRhLmJ1dHRvblZhbHVlKTsKICAgIHRoaXMuY2hlY2tlZEFwcGVhcmFuY2UgPSBjaGVja2VkQXBwZWFyYW5jZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gPyBjaGVja2VkQXBwZWFyYW5jZSA6IG51bGw7CiAgICBjb25zdCB1bmNoZWNrZWRBcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZS5nZXQoIk9mZiIpOwogICAgdGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlID0gdW5jaGVja2VkQXBwZWFyYW5jZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gPyB1bmNoZWNrZWRBcHBlYXJhbmNlIDogbnVsbDsKICAgIGlmICh0aGlzLmNoZWNrZWRBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLmNoZWNrZWRBcHBlYXJhbmNlKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX2dldERlZmF1bHRDaGVja2VkQXBwZWFyYW5jZShwYXJhbXMsICJkaXNjIik7CiAgICB9CiAgICBpZiAodGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2UpOwogICAgfQogICAgdGhpcy5fZmFsbGJhY2tGb250RGljdCA9IHRoaXMuZmFsbGJhY2tGb250RGljdDsKICAgIGlmICh0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgPT09IG51bGwpIHsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRGaWVsZFZhbHVlID0gIk9mZiI7CiAgICB9CiAgfQogIF9wcm9jZXNzUHVzaEJ1dHRvbihwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMKICAgIH0gPSBwYXJhbXM7CiAgICBpZiAoIWRpY3QuaGFzKCJBIikgJiYgIWRpY3QuaGFzKCJBQSIpICYmICF0aGlzLmRhdGEuYWx0ZXJuYXRpdmVUZXh0KSB7CiAgICAgIHdhcm4oIlB1c2ggYnV0dG9ucyB3aXRob3V0IGFjdGlvbiBkaWN0aW9uYXJpZXMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5kYXRhLmlzVG9vbHRpcE9ubHkgPSAhZGljdC5oYXMoIkEiKSAmJiAhZGljdC5oYXMoIkFBIik7CiAgICBDYXRhbG9nLnBhcnNlRGVzdERpY3Rpb25hcnkoewogICAgICBkZXN0RGljdDogZGljdCwKICAgICAgcmVzdWx0T2JqOiB0aGlzLmRhdGEsCiAgICAgIGRvY0Jhc2VVcmw6IGFubm90YXRpb25HbG9iYWxzLmJhc2VVcmwsCiAgICAgIGRvY0F0dGFjaG1lbnRzOiBhbm5vdGF0aW9uR2xvYmFscy5hdHRhY2htZW50cwogICAgfSk7CiAgfQogIGdldEZpZWxkT2JqZWN0KCkgewogICAgbGV0IHR5cGUgPSAiYnV0dG9uIjsKICAgIGxldCBleHBvcnRWYWx1ZXM7CiAgICBpZiAodGhpcy5kYXRhLmNoZWNrQm94KSB7CiAgICAgIHR5cGUgPSAiY2hlY2tib3giOwogICAgICBleHBvcnRWYWx1ZXMgPSB0aGlzLmRhdGEuZXhwb3J0VmFsdWU7CiAgICB9IGVsc2UgaWYgKHRoaXMuZGF0YS5yYWRpb0J1dHRvbikgewogICAgICB0eXBlID0gInJhZGlvYnV0dG9uIjsKICAgICAgZXhwb3J0VmFsdWVzID0gdGhpcy5kYXRhLmJ1dHRvblZhbHVlOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgaWQ6IHRoaXMuZGF0YS5pZCwKICAgICAgdmFsdWU6IHRoaXMuZGF0YS5maWVsZFZhbHVlIHx8ICJPZmYiLAogICAgICBkZWZhdWx0VmFsdWU6IHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSwKICAgICAgZXhwb3J0VmFsdWVzLAogICAgICBlZGl0YWJsZTogIXRoaXMuZGF0YS5yZWFkT25seSwKICAgICAgbmFtZTogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgcmVjdDogdGhpcy5kYXRhLnJlY3QsCiAgICAgIGhpZGRlbjogdGhpcy5kYXRhLmhpZGRlbiwKICAgICAgYWN0aW9uczogdGhpcy5kYXRhLmFjdGlvbnMsCiAgICAgIHBhZ2U6IHRoaXMuZGF0YS5wYWdlSW5kZXgsCiAgICAgIHN0cm9rZUNvbG9yOiB0aGlzLmRhdGEuYm9yZGVyQ29sb3IsCiAgICAgIGZpbGxDb2xvcjogdGhpcy5kYXRhLmJhY2tncm91bmRDb2xvciwKICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgIHR5cGUKICAgIH07CiAgfQogIGdldCBmYWxsYmFja0ZvbnREaWN0KCkgewogICAgY29uc3QgZGljdCA9IG5ldyBEaWN0KCk7CiAgICBkaWN0LnNldElmTmFtZSgiQmFzZUZvbnQiLCAiWmFwZkRpbmdiYXRzIik7CiAgICBkaWN0LnNldElmTmFtZSgiVHlwZSIsICJGYWxsYmFja1R5cGUiKTsKICAgIGRpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZhbGxiYWNrVHlwZSIpOwogICAgZGljdC5zZXRJZk5hbWUoIkVuY29kaW5nIiwgIlphcGZEaW5nYmF0c0VuY29kaW5nIik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJmYWxsYmFja0ZvbnREaWN0IiwgZGljdCk7CiAgfQp9CmNsYXNzIENob2ljZVdpZGdldEFubm90YXRpb24gZXh0ZW5kcyBXaWRnZXRBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmluZGljZXMgPSBkaWN0LmdldEFycmF5KCJJIik7CiAgICB0aGlzLmhhc0luZGljZXMgPSBBcnJheS5pc0FycmF5KHRoaXMuaW5kaWNlcykgJiYgdGhpcy5pbmRpY2VzLmxlbmd0aCA+IDA7CiAgICB0aGlzLmRhdGEub3B0aW9ucyA9IFtdOwogICAgY29uc3Qgb3B0aW9ucyA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICBkaWN0LAogICAgICBrZXk6ICJPcHQiCiAgICB9KTsKICAgIGlmIChBcnJheS5pc0FycmF5KG9wdGlvbnMpKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IG9wdGlvbnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IG9wdGlvbiA9IHhyZWYuZmV0Y2hJZlJlZihvcHRpb25zW2ldKTsKICAgICAgICBjb25zdCBpc09wdGlvbkFycmF5ID0gQXJyYXkuaXNBcnJheShvcHRpb24pOwogICAgICAgIHRoaXMuZGF0YS5vcHRpb25zW2ldID0gewogICAgICAgICAgZXhwb3J0VmFsdWU6IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShpc09wdGlvbkFycmF5ID8geHJlZi5mZXRjaElmUmVmKG9wdGlvblswXSkgOiBvcHRpb24pLAogICAgICAgICAgZGlzcGxheVZhbHVlOiB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoaXNPcHRpb25BcnJheSA/IHhyZWYuZmV0Y2hJZlJlZihvcHRpb25bMV0pIDogb3B0aW9uKQogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpcy5oYXNJbmRpY2VzKSB7CiAgICAgIGlmICh0eXBlb2YgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSBbdGhpcy5kYXRhLmZpZWxkVmFsdWVdOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlIHx8PSBbXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSBbXTsKICAgICAgY29uc3QgaWkgPSB0aGlzLmRhdGEub3B0aW9ucy5sZW5ndGg7CiAgICAgIGZvciAoY29uc3QgaSBvZiB0aGlzLmluZGljZXMpIHsKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihpKSAmJiBpID49IDAgJiYgaSA8IGlpKSB7CiAgICAgICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZS5wdXNoKHRoaXMuZGF0YS5vcHRpb25zW2ldLmV4cG9ydFZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLmRhdGEub3B0aW9ucy5sZW5ndGggPT09IDAgJiYgdGhpcy5kYXRhLmZpZWxkVmFsdWUubGVuZ3RoID4gMCkgewogICAgICB0aGlzLmRhdGEub3B0aW9ucyA9IHRoaXMuZGF0YS5maWVsZFZhbHVlLm1hcCh2YWx1ZSA9PiAoewogICAgICAgIGV4cG9ydFZhbHVlOiB2YWx1ZSwKICAgICAgICBkaXNwbGF5VmFsdWU6IHZhbHVlCiAgICAgIH0pKTsKICAgIH0KICAgIHRoaXMuZGF0YS5jb21ibyA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuQ09NQk8pOwogICAgdGhpcy5kYXRhLm11bHRpU2VsZWN0ID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5NVUxUSVNFTEVDVCk7CiAgICB0aGlzLl9oYXNUZXh0ID0gdHJ1ZTsKICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICBjb25zdCB0eXBlID0gdGhpcy5kYXRhLmNvbWJvID8gImNvbWJvYm94IiA6ICJsaXN0Ym94IjsKICAgIGNvbnN0IHZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWUubGVuZ3RoID4gMCA/IHRoaXMuZGF0YS5maWVsZFZhbHVlWzBdIDogbnVsbDsKICAgIHJldHVybiB7CiAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgIHZhbHVlLAogICAgICBkZWZhdWx0VmFsdWU6IHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSwKICAgICAgZWRpdGFibGU6ICF0aGlzLmRhdGEucmVhZE9ubHksCiAgICAgIG5hbWU6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgIHJlY3Q6IHRoaXMuZGF0YS5yZWN0LAogICAgICBudW1JdGVtczogdGhpcy5kYXRhLmZpZWxkVmFsdWUubGVuZ3RoLAogICAgICBtdWx0aXBsZVNlbGVjdGlvbjogdGhpcy5kYXRhLm11bHRpU2VsZWN0LAogICAgICBoaWRkZW46IHRoaXMuZGF0YS5oaWRkZW4sCiAgICAgIGFjdGlvbnM6IHRoaXMuZGF0YS5hY3Rpb25zLAogICAgICBpdGVtczogdGhpcy5kYXRhLm9wdGlvbnMsCiAgICAgIHBhZ2U6IHRoaXMuZGF0YS5wYWdlSW5kZXgsCiAgICAgIHN0cm9rZUNvbG9yOiB0aGlzLmRhdGEuYm9yZGVyQ29sb3IsCiAgICAgIGZpbGxDb2xvcjogdGhpcy5kYXRhLmJhY2tncm91bmRDb2xvciwKICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgIHR5cGUKICAgIH07CiAgfQogIGFtZW5kU2F2ZWREaWN0KGFubm90YXRpb25TdG9yYWdlLCBkaWN0KSB7CiAgICBpZiAoIXRoaXMuaGFzSW5kaWNlcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgdmFsdWVzID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpPy52YWx1ZTsKICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7CiAgICAgIHZhbHVlcyA9IFt2YWx1ZXNdOwogICAgfQogICAgY29uc3QgaW5kaWNlcyA9IFtdOwogICAgY29uc3QgewogICAgICBvcHRpb25zCiAgICB9ID0gdGhpcy5kYXRhOwogICAgZm9yIChsZXQgaSA9IDAsIGogPSAwLCBpaSA9IG9wdGlvbnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBpZiAob3B0aW9uc1tpXS5leHBvcnRWYWx1ZSA9PT0gdmFsdWVzW2pdKSB7CiAgICAgICAgaW5kaWNlcy5wdXNoKGkpOwogICAgICAgIGogKz0gMTsKICAgICAgfQogICAgfQogICAgZGljdC5zZXQoIkkiLCBpbmRpY2VzKTsKICB9CiAgYXN5bmMgX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBpZiAodGhpcy5kYXRhLmNvbWJvKSB7CiAgICAgIHJldHVybiBzdXBlci5fZ2V0QXBwZWFyYW5jZShldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgbGV0IGV4cG9ydGVkVmFsdWUsIHJvdGF0aW9uOwogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpOwogICAgaWYgKHN0b3JhZ2VFbnRyeSkgewogICAgICByb3RhdGlvbiA9IHN0b3JhZ2VFbnRyeS5yb3RhdGlvbjsKICAgICAgZXhwb3J0ZWRWYWx1ZSA9IHN0b3JhZ2VFbnRyeS52YWx1ZTsKICAgIH0KICAgIGlmIChyb3RhdGlvbiA9PT0gdW5kZWZpbmVkICYmIGV4cG9ydGVkVmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhdGhpcy5fbmVlZEFwcGVhcmFuY2VzKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKGV4cG9ydGVkVmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICBleHBvcnRlZFZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWU7CiAgICB9IGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KGV4cG9ydGVkVmFsdWUpKSB7CiAgICAgIGV4cG9ydGVkVmFsdWUgPSBbZXhwb3J0ZWRWYWx1ZV07CiAgICB9CiAgICBjb25zdCBkZWZhdWx0UGFkZGluZyA9IDE7CiAgICBjb25zdCBkZWZhdWx0SFBhZGRpbmcgPSAyOwogICAgbGV0IHsKICAgICAgd2lkdGg6IHRvdGFsV2lkdGgsCiAgICAgIGhlaWdodDogdG90YWxIZWlnaHQKICAgIH0gPSB0aGlzOwogICAgaWYgKHJvdGF0aW9uID09PSA5MCB8fCByb3RhdGlvbiA9PT0gMjcwKSB7CiAgICAgIFt0b3RhbFdpZHRoLCB0b3RhbEhlaWdodF0gPSBbdG90YWxIZWlnaHQsIHRvdGFsV2lkdGhdOwogICAgfQogICAgY29uc3QgbGluZUNvdW50ID0gdGhpcy5kYXRhLm9wdGlvbnMubGVuZ3RoOwogICAgY29uc3QgdmFsdWVJbmRpY2VzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVDb3VudDsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBleHBvcnRWYWx1ZQogICAgICB9ID0gdGhpcy5kYXRhLm9wdGlvbnNbaV07CiAgICAgIGlmIChleHBvcnRlZFZhbHVlLmluY2x1ZGVzKGV4cG9ydFZhbHVlKSkgewogICAgICAgIHZhbHVlSW5kaWNlcy5wdXNoKGkpOwogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEgPSBwYXJzZURlZmF1bHRBcHBlYXJhbmNlKHRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlID0gIi9IZWx2ZXRpY2EgMCBUZiAwIGciKTsKICAgIH0KICAgIGNvbnN0IGZvbnQgPSBhd2FpdCBXaWRnZXRBbm5vdGF0aW9uLl9nZXRGb250RGF0YShldmFsdWF0b3IsIHRhc2ssIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEsIHRoaXMuX2ZpZWxkUmVzb3VyY2VzLm1lcmdlZFJlc291cmNlcyk7CiAgICBsZXQgZGVmYXVsdEFwcGVhcmFuY2U7CiAgICBsZXQgewogICAgICBmb250U2l6ZQogICAgfSA9IHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGE7CiAgICBpZiAoIWZvbnRTaXplKSB7CiAgICAgIGNvbnN0IGxpbmVIZWlnaHQgPSAodG90YWxIZWlnaHQgLSBkZWZhdWx0UGFkZGluZykgLyBsaW5lQ291bnQ7CiAgICAgIGxldCBsaW5lV2lkdGggPSAtMTsKICAgICAgbGV0IHZhbHVlOwogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICBkaXNwbGF5VmFsdWUKICAgICAgfSBvZiB0aGlzLmRhdGEub3B0aW9ucykgewogICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5fZ2V0VGV4dFdpZHRoKGRpc3BsYXlWYWx1ZSwgZm9udCk7CiAgICAgICAgaWYgKHdpZHRoID4gbGluZVdpZHRoKSB7CiAgICAgICAgICBsaW5lV2lkdGggPSB3aWR0aDsKICAgICAgICAgIHZhbHVlID0gZGlzcGxheVZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgICBbZGVmYXVsdEFwcGVhcmFuY2UsIGZvbnRTaXplXSA9IHRoaXMuX2NvbXB1dGVGb250U2l6ZShsaW5lSGVpZ2h0LCB0b3RhbFdpZHRoIC0gMiAqIGRlZmF1bHRIUGFkZGluZywgdmFsdWUsIGZvbnQsIC0xKTsKICAgIH0gZWxzZSB7CiAgICAgIGRlZmF1bHRBcHBlYXJhbmNlID0gdGhpcy5fZGVmYXVsdEFwcGVhcmFuY2U7CiAgICB9CiAgICBjb25zdCBsaW5lSGVpZ2h0ID0gZm9udFNpemUgKiBMSU5FX0ZBQ1RPUjsKICAgIGNvbnN0IHZQYWRkaW5nID0gKGxpbmVIZWlnaHQgLSBmb250U2l6ZSkgLyAyOwogICAgY29uc3QgbnVtYmVyT2ZWaXNpYmxlTGluZXMgPSBNYXRoLmZsb29yKHRvdGFsSGVpZ2h0IC8gbGluZUhlaWdodCk7CiAgICBsZXQgZmlyc3RJbmRleCA9IDA7CiAgICBpZiAodmFsdWVJbmRpY2VzLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgbWluSW5kZXggPSBNYXRoLm1pbiguLi52YWx1ZUluZGljZXMpOwogICAgICBjb25zdCBtYXhJbmRleCA9IE1hdGgubWF4KC4uLnZhbHVlSW5kaWNlcyk7CiAgICAgIGZpcnN0SW5kZXggPSBNYXRoLm1heCgwLCBtYXhJbmRleCAtIG51bWJlck9mVmlzaWJsZUxpbmVzICsgMSk7CiAgICAgIGlmIChmaXJzdEluZGV4ID4gbWluSW5kZXgpIHsKICAgICAgICBmaXJzdEluZGV4ID0gbWluSW5kZXg7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGZpcnN0SW5kZXggKyBudW1iZXJPZlZpc2libGVMaW5lcyArIDEsIGxpbmVDb3VudCk7CiAgICBjb25zdCBidWYgPSBbIi9UeCBCTUMgcSIsIGAxIDEgJHt0b3RhbFdpZHRofSAke3RvdGFsSGVpZ2h0fSByZSBXIG5gXTsKICAgIGlmICh2YWx1ZUluZGljZXMubGVuZ3RoKSB7CiAgICAgIGJ1Zi5wdXNoKCIwLjYwMDAwNiAwLjc1Njg2NiAwLjg1NDkwNCByZyIpOwogICAgICBmb3IgKGNvbnN0IGluZGV4IG9mIHZhbHVlSW5kaWNlcykgewogICAgICAgIGlmIChmaXJzdEluZGV4IDw9IGluZGV4ICYmIGluZGV4IDwgZW5kKSB7CiAgICAgICAgICBidWYucHVzaChgMSAke3RvdGFsSGVpZ2h0IC0gKGluZGV4IC0gZmlyc3RJbmRleCArIDEpICogbGluZUhlaWdodH0gJHt0b3RhbFdpZHRofSAke2xpbmVIZWlnaHR9IHJlIGZgKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGJ1Zi5wdXNoKCJCVCIsIGRlZmF1bHRBcHBlYXJhbmNlLCBgMSAwIDAgMSAwICR7dG90YWxIZWlnaHR9IFRtYCk7CiAgICBjb25zdCBwcmV2SW5mbyA9IHsKICAgICAgc2hpZnQ6IDAKICAgIH07CiAgICBmb3IgKGxldCBpID0gZmlyc3RJbmRleDsgaSA8IGVuZDsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXNwbGF5VmFsdWUKICAgICAgfSA9IHRoaXMuZGF0YS5vcHRpb25zW2ldOwogICAgICBjb25zdCB2cGFkZGluZyA9IGkgPT09IGZpcnN0SW5kZXggPyB2UGFkZGluZyA6IDA7CiAgICAgIGJ1Zi5wdXNoKHRoaXMuX3JlbmRlclRleHQoZGlzcGxheVZhbHVlLCBmb250LCBmb250U2l6ZSwgdG90YWxXaWR0aCwgMCwgcHJldkluZm8sIGRlZmF1bHRIUGFkZGluZywgLWxpbmVIZWlnaHQgKyB2cGFkZGluZykpOwogICAgfQogICAgYnVmLnB1c2goIkVUIFEgRU1DIik7CiAgICByZXR1cm4gYnVmLmpvaW4oIlxuIik7CiAgfQp9CmNsYXNzIFNpZ25hdHVyZVdpZGdldEFubm90YXRpb24gZXh0ZW5kcyBXaWRnZXRBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9IG51bGw7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9ICF0aGlzLmRhdGEuaGFzT3duQ2FudmFzOwogIH0KICBnZXRGaWVsZE9iamVjdCgpIHsKICAgIHJldHVybiB7CiAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgIHZhbHVlOiBudWxsLAogICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICB0eXBlOiAic2lnbmF0dXJlIgogICAgfTsKICB9Cn0KY2xhc3MgVGV4dEFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIGNvbnN0IERFRkFVTFRfSUNPTl9TSVpFID0gMjI7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLm5vUm90YXRlID0gdHJ1ZTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5URVhUOwogICAgaWYgKHRoaXMuZGF0YS5oYXNBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuZGF0YS5uYW1lID0gIk5vSWNvbiI7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRhdGEucmVjdFsxXSA9IHRoaXMuZGF0YS5yZWN0WzNdIC0gREVGQVVMVF9JQ09OX1NJWkU7CiAgICAgIHRoaXMuZGF0YS5yZWN0WzJdID0gdGhpcy5kYXRhLnJlY3RbMF0gKyBERUZBVUxUX0lDT05fU0laRTsKICAgICAgdGhpcy5kYXRhLm5hbWUgPSBkaWN0LmhhcygiTmFtZSIpID8gZGljdC5nZXQoIk5hbWUiKS5uYW1lIDogIk5vdGUiOwogICAgfQogICAgaWYgKGRpY3QuaGFzKCJTdGF0ZSIpKSB7CiAgICAgIHRoaXMuZGF0YS5zdGF0ZSA9IGRpY3QuZ2V0KCJTdGF0ZSIpIHx8IG51bGw7CiAgICAgIHRoaXMuZGF0YS5zdGF0ZU1vZGVsID0gZGljdC5nZXQoIlN0YXRlTW9kZWwiKSB8fCBudWxsOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnN0YXRlID0gbnVsbDsKICAgICAgdGhpcy5kYXRhLnN0YXRlTW9kZWwgPSBudWxsOwogICAgfQogIH0KfQpjbGFzcyBMaW5rQW5ub3RhdGlvbiBleHRlbmRzIEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5MSU5LOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgY29uc3QgcXVhZFBvaW50cyA9IGdldFF1YWRQb2ludHMoZGljdCwgdGhpcy5yZWN0YW5nbGUpOwogICAgaWYgKHF1YWRQb2ludHMpIHsKICAgICAgdGhpcy5kYXRhLnF1YWRQb2ludHMgPSBxdWFkUG9pbnRzOwogICAgfQogICAgdGhpcy5kYXRhLmJvcmRlckNvbG9yIHx8PSB0aGlzLmRhdGEuY29sb3I7CiAgICBDYXRhbG9nLnBhcnNlRGVzdERpY3Rpb25hcnkoewogICAgICBkZXN0RGljdDogZGljdCwKICAgICAgcmVzdWx0T2JqOiB0aGlzLmRhdGEsCiAgICAgIGRvY0Jhc2VVcmw6IGFubm90YXRpb25HbG9iYWxzLmJhc2VVcmwsCiAgICAgIGRvY0F0dGFjaG1lbnRzOiBhbm5vdGF0aW9uR2xvYmFscy5hdHRhY2htZW50cwogICAgfSk7CiAgfQogIGdldCBvdmVybGF5c1RleHRDb250ZW50KCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIFBvcHVwQW5ub3RhdGlvbiBleHRlbmRzIEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdAogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlBPUFVQOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgaWYgKHRoaXMud2lkdGggPT09IDAgfHwgdGhpcy5oZWlnaHQgPT09IDApIHsKICAgICAgdGhpcy5kYXRhLnJlY3QgPSBudWxsOwogICAgfQogICAgbGV0IHBhcmVudEl0ZW0gPSBkaWN0LmdldCgiUGFyZW50Iik7CiAgICBpZiAoIXBhcmVudEl0ZW0pIHsKICAgICAgd2FybigiUG9wdXAgYW5ub3RhdGlvbiBoYXMgYSBtaXNzaW5nIG9yIGludmFsaWQgcGFyZW50IGFubm90YXRpb24uIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZGF0YS5wYXJlbnRSZWN0ID0gbG9va3VwTm9ybWFsUmVjdChwYXJlbnRJdGVtLmdldEFycmF5KCJSZWN0IiksIG51bGwpOwogICAgdGhpcy5kYXRhLmNyZWF0aW9uRGF0ZSA9IHBhcmVudEl0ZW0uZ2V0KCJDcmVhdGlvbkRhdGUiKSB8fCAiIjsKICAgIGNvbnN0IHJ0ID0gcGFyZW50SXRlbS5nZXQoIlJUIik7CiAgICBpZiAoaXNOYW1lKHJ0LCBBbm5vdGF0aW9uUmVwbHlUeXBlLkdST1VQKSkgewogICAgICBwYXJlbnRJdGVtID0gcGFyZW50SXRlbS5nZXQoIklSVCIpOwogICAgfQogICAgaWYgKCFwYXJlbnRJdGVtLmhhcygiTSIpKSB7CiAgICAgIHRoaXMuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuc2V0TW9kaWZpY2F0aW9uRGF0ZShwYXJlbnRJdGVtLmdldCgiTSIpKTsKICAgICAgdGhpcy5kYXRhLm1vZGlmaWNhdGlvbkRhdGUgPSB0aGlzLm1vZGlmaWNhdGlvbkRhdGU7CiAgICB9CiAgICBpZiAoIXBhcmVudEl0ZW0uaGFzKCJDIikpIHsKICAgICAgdGhpcy5kYXRhLmNvbG9yID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuc2V0Q29sb3IocGFyZW50SXRlbS5nZXRBcnJheSgiQyIpKTsKICAgICAgdGhpcy5kYXRhLmNvbG9yID0gdGhpcy5jb2xvcjsKICAgIH0KICAgIGlmICghdGhpcy52aWV3YWJsZSkgewogICAgICBjb25zdCBwYXJlbnRGbGFncyA9IHBhcmVudEl0ZW0uZ2V0KCJGIik7CiAgICAgIGlmICh0aGlzLl9pc1ZpZXdhYmxlKHBhcmVudEZsYWdzKSkgewogICAgICAgIHRoaXMuc2V0RmxhZ3MocGFyZW50RmxhZ3MpOwogICAgICB9CiAgICB9CiAgICB0aGlzLnNldFRpdGxlKHBhcmVudEl0ZW0uZ2V0KCJUIikpOwogICAgdGhpcy5kYXRhLnRpdGxlT2JqID0gdGhpcy5fdGl0bGU7CiAgICB0aGlzLnNldENvbnRlbnRzKHBhcmVudEl0ZW0uZ2V0KCJDb250ZW50cyIpKTsKICAgIHRoaXMuZGF0YS5jb250ZW50c09iaiA9IHRoaXMuX2NvbnRlbnRzOwogICAgaWYgKHBhcmVudEl0ZW0uaGFzKCJSQyIpKSB7CiAgICAgIHRoaXMuZGF0YS5yaWNoVGV4dCA9IFhGQUZhY3RvcnkuZ2V0UmljaFRleHRBc0h0bWwocGFyZW50SXRlbS5nZXQoIlJDIikpOwogICAgfQogICAgdGhpcy5kYXRhLm9wZW4gPSAhIWRpY3QuZ2V0KCJPcGVuIik7CiAgfQogIHN0YXRpYyBjcmVhdGVOZXdEaWN0KGFubm90YXRpb24sIHhyZWYsIF9wYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgb2xkQW5ub3RhdGlvbiwKICAgICAgcmVjdCwKICAgICAgcGFyZW50CiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGNvbnN0IHBvcHVwID0gb2xkQW5ub3RhdGlvbiB8fCBuZXcgRGljdCh4cmVmKTsKICAgIHBvcHVwLnNldElmTm90RXhpc3RzKCJUeXBlIiwgTmFtZS5nZXQoIkFubm90IikpOwogICAgcG9wdXAuc2V0SWZOb3RFeGlzdHMoIlN1YnR5cGUiLCBOYW1lLmdldCgiUG9wdXAiKSk7CiAgICBwb3B1cC5zZXRJZk5vdEV4aXN0cygiT3BlbiIsIGZhbHNlKTsKICAgIHBvcHVwLnNldElmQXJyYXkoIlJlY3QiLCByZWN0KTsKICAgIHBvcHVwLnNldCgiUGFyZW50IiwgcGFyZW50KTsKICAgIHJldHVybiBwb3B1cDsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKSB7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KY2xhc3MgRnJlZVRleHRBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5pc0VkaXRhYmxlID0gIXRoaXMuZGF0YS5ub0hUTUw7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICBjb25zdCB7CiAgICAgIGFubm90YXRpb25HbG9iYWxzLAogICAgICBldmFsdWF0b3JPcHRpb25zLAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuRlJFRVRFWFQ7CiAgICB0aGlzLnNldERlZmF1bHRBcHBlYXJhbmNlKHBhcmFtcyk7CiAgICB0aGlzLl9oYXNBcHBlYXJhbmNlID0gISF0aGlzLmFwcGVhcmFuY2U7CiAgICBpZiAodGhpcy5faGFzQXBwZWFyYW5jZSkgewogICAgICBjb25zdCB7CiAgICAgICAgZm9udENvbG9yLAogICAgICAgIGZvbnRTaXplCiAgICAgIH0gPSBwYXJzZUFwcGVhcmFuY2VTdHJlYW0odGhpcy5hcHBlYXJhbmNlLCBldmFsdWF0b3JPcHRpb25zLCB4cmVmLCBhbm5vdGF0aW9uR2xvYmFscy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUpOwogICAgICB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLmZvbnRDb2xvciA9IGZvbnRDb2xvcjsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YS5mb250U2l6ZSA9IGZvbnRTaXplIHx8IDEwOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YS5mb250U2l6ZSB8fD0gMTA7CiAgICAgIGNvbnN0IHsKICAgICAgICBmb250Q29sb3IsCiAgICAgICAgZm9udFNpemUKICAgICAgfSA9IHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGE7CiAgICAgIGlmICh0aGlzLl9jb250ZW50cy5zdHIpIHsKICAgICAgICB0aGlzLmRhdGEudGV4dENvbnRlbnQgPSB0aGlzLl9jb250ZW50cy5zdHIuc3BsaXQoL1xyXG4/fFxuLykubWFwKGxpbmUgPT4gbGluZS50cmltRW5kKCkpOwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGNvb3JkcywKICAgICAgICAgIGJib3gsCiAgICAgICAgICBtYXRyaXgKICAgICAgICB9ID0gRmFrZVVuaWNvZGVGb250LmdldEZpcnN0UG9zaXRpb25JbmZvKHRoaXMucmVjdGFuZ2xlLCB0aGlzLnJvdGF0aW9uLCBmb250U2l6ZSk7CiAgICAgICAgdGhpcy5kYXRhLnRleHRQb3NpdGlvbiA9IHRoaXMuX3RyYW5zZm9ybVBvaW50KGNvb3JkcywgYmJveCwgbWF0cml4KTsKICAgICAgfQogICAgICBpZiAodGhpcy5faXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgICBjb25zdCBzdHJva2VBbHBoYSA9IHBhcmFtcy5kaWN0LmdldCgiQ0EiKTsKICAgICAgICBjb25zdCBmYWtlVW5pY29kZUZvbnQgPSBuZXcgRmFrZVVuaWNvZGVGb250KHhyZWYsICJzYW5zLXNlcmlmIik7CiAgICAgICAgdGhpcy5hcHBlYXJhbmNlID0gZmFrZVVuaWNvZGVGb250LmNyZWF0ZUFwcGVhcmFuY2UodGhpcy5fY29udGVudHMuc3RyLCB0aGlzLnJlY3RhbmdsZSwgdGhpcy5yb3RhdGlvbiwgZm9udFNpemUsIGZvbnRDb2xvciwgc3Ryb2tlQWxwaGEpOwogICAgICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLmFwcGVhcmFuY2UpOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oIkZyZWVUZXh0QW5ub3RhdGlvbjogT2Zmc2NyZWVuQ2FudmFzIGlzIG5vdCBzdXBwb3J0ZWQsIGFubm90YXRpb24gbWF5IG5vdCByZW5kZXIgY29ycmVjdGx5LiIpOwogICAgICB9CiAgICB9CiAgfQogIGdldCBoYXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiB0aGlzLl9oYXNBcHBlYXJhbmNlOwogIH0KICBzdGF0aWMgY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCB7CiAgICBhcFJlZiwKICAgIGFwCiAgfSkgewogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgZGF0ZSwKICAgICAgZm9udFNpemUsCiAgICAgIG9sZEFubm90YXRpb24sCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB1c2VyLAogICAgICB2YWx1ZQogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCBmcmVldGV4dCA9IG9sZEFubm90YXRpb24gfHwgbmV3IERpY3QoeHJlZik7CiAgICBmcmVldGV4dC5zZXRJZk5vdEV4aXN0cygiVHlwZSIsIE5hbWUuZ2V0KCJBbm5vdCIpKTsKICAgIGZyZWV0ZXh0LnNldElmTm90RXhpc3RzKCJTdWJ0eXBlIiwgTmFtZS5nZXQoIkZyZWVUZXh0IikpOwogICAgZnJlZXRleHQuc2V0KG9sZEFubm90YXRpb24gPyAiTSIgOiAiQ3JlYXRpb25EYXRlIiwgYEQ6JHtnZXRNb2RpZmljYXRpb25EYXRlKGRhdGUpfWApOwogICAgaWYgKG9sZEFubm90YXRpb24pIHsKICAgICAgZnJlZXRleHQuZGVsZXRlKCJSQyIpOwogICAgfQogICAgZnJlZXRleHQuc2V0SWZBcnJheSgiUmVjdCIsIHJlY3QpOwogICAgY29uc3QgZGEgPSBgL0hlbHYgJHtmb250U2l6ZX0gVGYgJHtnZXRQZGZDb2xvcihjb2xvciwgdHJ1ZSl9YDsKICAgIGZyZWV0ZXh0LnNldCgiREEiLCBkYSk7CiAgICBmcmVldGV4dC5zZXRJZkRlZmluZWQoIkNvbnRlbnRzIiwgc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRSh2YWx1ZSkpOwogICAgZnJlZXRleHQuc2V0SWZOb3RFeGlzdHMoIkYiLCA0KTsKICAgIGZyZWV0ZXh0LnNldElmTm90RXhpc3RzKCJCb3JkZXIiLCBbMCwgMCwgMF0pOwogICAgZnJlZXRleHQuc2V0SWZOdW1iZXIoIlJvdGF0ZSIsIHJvdGF0aW9uKTsKICAgIGZyZWV0ZXh0LnNldElmRGVmaW5lZCgiVCIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodXNlcikpOwogICAgaWYgKGFwUmVmIHx8IGFwKSB7CiAgICAgIGNvbnN0IG4gPSBuZXcgRGljdCh4cmVmKTsKICAgICAgZnJlZXRleHQuc2V0KCJBUCIsIG4pOwogICAgICBuLnNldCgiTiIsIGFwUmVmIHx8IGFwKTsKICAgIH0KICAgIHJldHVybiBmcmVldGV4dDsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIGJhc2VGb250UmVmLAogICAgICBldmFsdWF0b3IsCiAgICAgIHRhc2sKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCB7CiAgICAgIGNvbG9yLAogICAgICBmb250U2l6ZSwKICAgICAgcmVjdCwKICAgICAgcm90YXRpb24sCiAgICAgIHZhbHVlCiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGlmICghY29sb3IpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgRGljdCh4cmVmKTsKICAgIGNvbnN0IGZvbnQgPSBuZXcgRGljdCh4cmVmKTsKICAgIGlmIChiYXNlRm9udFJlZikgewogICAgICBmb250LnNldCgiSGVsdiIsIGJhc2VGb250UmVmKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGJhc2VGb250ID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGJhc2VGb250LnNldElmTmFtZSgiQmFzZUZvbnQiLCAiSGVsdmV0aWNhIik7CiAgICAgIGJhc2VGb250LnNldElmTmFtZSgiVHlwZSIsICJGb250Iik7CiAgICAgIGJhc2VGb250LnNldElmTmFtZSgiU3VidHlwZSIsICJUeXBlMSIpOwogICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIkVuY29kaW5nIiwgIldpbkFuc2lFbmNvZGluZyIpOwogICAgICBmb250LnNldCgiSGVsdiIsIGJhc2VGb250KTsKICAgIH0KICAgIHJlc291cmNlcy5zZXQoIkZvbnQiLCBmb250KTsKICAgIGNvbnN0IGhlbHYgPSBhd2FpdCBXaWRnZXRBbm5vdGF0aW9uLl9nZXRGb250RGF0YShldmFsdWF0b3IsIHRhc2ssIHsKICAgICAgZm9udE5hbWU6ICJIZWx2IiwKICAgICAgZm9udFNpemUKICAgIH0sIHJlc291cmNlcyk7CiAgICBjb25zdCBbeDEsIHkxLCB4MiwgeTJdID0gcmVjdDsKICAgIGxldCB3ID0geDIgLSB4MTsKICAgIGxldCBoID0geTIgLSB5MTsKICAgIGlmIChyb3RhdGlvbiAlIDE4MCAhPT0gMCkgewogICAgICBbdywgaF0gPSBbaCwgd107CiAgICB9CiAgICBjb25zdCBsaW5lcyA9IHZhbHVlLnNwbGl0KCJcbiIpOwogICAgY29uc3Qgc2NhbGUgPSBmb250U2l6ZSAvIDEwMDA7CiAgICBsZXQgdG90YWxXaWR0aCA9IC1JbmZpbml0eTsKICAgIGNvbnN0IGVuY29kZWRMaW5lcyA9IFtdOwogICAgZm9yIChsZXQgbGluZSBvZiBsaW5lcykgewogICAgICBjb25zdCBlbmNvZGVkID0gaGVsdi5lbmNvZGVTdHJpbmcobGluZSk7CiAgICAgIGlmIChlbmNvZGVkLmxlbmd0aCA+IDEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBsaW5lID0gZW5jb2RlZC5qb2luKCIiKTsKICAgICAgZW5jb2RlZExpbmVzLnB1c2gobGluZSk7CiAgICAgIGxldCBsaW5lV2lkdGggPSAwOwogICAgICBjb25zdCBnbHlwaHMgPSBoZWx2LmNoYXJzVG9HbHlwaHMobGluZSk7CiAgICAgIGZvciAoY29uc3QgZ2x5cGggb2YgZ2x5cGhzKSB7CiAgICAgICAgbGluZVdpZHRoICs9IGdseXBoLndpZHRoICogc2NhbGU7CiAgICAgIH0KICAgICAgdG90YWxXaWR0aCA9IE1hdGgubWF4KHRvdGFsV2lkdGgsIGxpbmVXaWR0aCk7CiAgICB9CiAgICBsZXQgaHNjYWxlID0gMTsKICAgIGlmICh0b3RhbFdpZHRoID4gdykgewogICAgICBoc2NhbGUgPSB3IC8gdG90YWxXaWR0aDsKICAgIH0KICAgIGxldCB2c2NhbGUgPSAxOwogICAgY29uc3QgbGluZUhlaWdodCA9IExJTkVfRkFDVE9SICogZm9udFNpemU7CiAgICBjb25zdCBsaW5lQXNjZW50ID0gKExJTkVfRkFDVE9SIC0gTElORV9ERVNDRU5UX0ZBQ1RPUikgKiBmb250U2l6ZTsKICAgIGNvbnN0IHRvdGFsSGVpZ2h0ID0gbGluZUhlaWdodCAqIGxpbmVzLmxlbmd0aDsKICAgIGlmICh0b3RhbEhlaWdodCA+IGgpIHsKICAgICAgdnNjYWxlID0gaCAvIHRvdGFsSGVpZ2h0OwogICAgfQogICAgY29uc3QgZnNjYWxlID0gTWF0aC5taW4oaHNjYWxlLCB2c2NhbGUpOwogICAgY29uc3QgbmV3Rm9udFNpemUgPSBmb250U2l6ZSAqIGZzY2FsZTsKICAgIGxldCBmaXJzdFBvaW50LCBjbGlwQm94LCBtYXRyaXg7CiAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICBtYXRyaXggPSBbMSwgMCwgMCwgMV07CiAgICAgICAgY2xpcEJveCA9IFtyZWN0WzBdLCByZWN0WzFdLCB3LCBoXTsKICAgICAgICBmaXJzdFBvaW50ID0gW3JlY3RbMF0sIHJlY3RbM10gLSBsaW5lQXNjZW50XTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSA5MDoKICAgICAgICBtYXRyaXggPSBbMCwgMSwgLTEsIDBdOwogICAgICAgIGNsaXBCb3ggPSBbcmVjdFsxXSwgLXJlY3RbMl0sIHcsIGhdOwogICAgICAgIGZpcnN0UG9pbnQgPSBbcmVjdFsxXSwgLXJlY3RbMF0gLSBsaW5lQXNjZW50XTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAxODA6CiAgICAgICAgbWF0cml4ID0gWy0xLCAwLCAwLCAtMV07CiAgICAgICAgY2xpcEJveCA9IFstcmVjdFsyXSwgLXJlY3RbM10sIHcsIGhdOwogICAgICAgIGZpcnN0UG9pbnQgPSBbLXJlY3RbMl0sIC1yZWN0WzFdIC0gbGluZUFzY2VudF07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjcwOgogICAgICAgIG1hdHJpeCA9IFswLCAtMSwgMSwgMF07CiAgICAgICAgY2xpcEJveCA9IFstcmVjdFszXSwgcmVjdFswXSwgdywgaF07CiAgICAgICAgZmlyc3RQb2ludCA9IFstcmVjdFszXSwgcmVjdFsyXSAtIGxpbmVBc2NlbnRdOwogICAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgYnVmZmVyID0gWyJxIiwgYCR7bWF0cml4LmpvaW4oIiAiKX0gMCAwIGNtYCwgYCR7Y2xpcEJveC5qb2luKCIgIil9IHJlIFcgbmAsIGBCVGAsIGAke2dldFBkZkNvbG9yKGNvbG9yLCB0cnVlKX1gLCBgMCBUYyAvSGVsdiAke251bWJlclRvU3RyaW5nKG5ld0ZvbnRTaXplKX0gVGZgXTsKICAgIGJ1ZmZlci5wdXNoKGAke2ZpcnN0UG9pbnQuam9pbigiICIpfSBUZCAoJHtlc2NhcGVTdHJpbmcoZW5jb2RlZExpbmVzWzBdKX0pIFRqYCk7CiAgICBjb25zdCB2U2hpZnQgPSBudW1iZXJUb1N0cmluZyhsaW5lSGVpZ2h0KTsKICAgIGZvciAobGV0IGkgPSAxLCBpaSA9IGVuY29kZWRMaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGxpbmUgPSBlbmNvZGVkTGluZXNbaV07CiAgICAgIGJ1ZmZlci5wdXNoKGAwIC0ke3ZTaGlmdH0gVGQgKCR7ZXNjYXBlU3RyaW5nKGxpbmUpfSkgVGpgKTsKICAgIH0KICAgIGJ1ZmZlci5wdXNoKCJFVCIsICJRIik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYnVmZmVyLmpvaW4oIlxuIik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCByZWN0KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTWF0cml4IiwgWzEsIDAsIDAsIDEsIC1yZWN0WzBdLCAtcmVjdFsxXV0pOwogICAgY29uc3QgYXAgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KfQpjbGFzcyBMaW5lQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLkxJTkU7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgY29uc3QgbGluZUNvb3JkaW5hdGVzID0gbG9va3VwUmVjdChkaWN0LmdldEFycmF5KCJMIiksIFswLCAwLCAwLCAwXSk7CiAgICB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzID0gVXRpbC5ub3JtYWxpemVSZWN0KGxpbmVDb29yZGluYXRlcyk7CiAgICB0aGlzLnNldExpbmVFbmRpbmdzKGRpY3QuZ2V0QXJyYXkoIkxFIikpOwogICAgdGhpcy5kYXRhLmxpbmVFbmRpbmdzID0gdGhpcy5saW5lRW5kaW5nczsKICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yLCBbMCwgMCwgMF0pOwogICAgICBjb25zdCBzdHJva2VBbHBoYSA9IGRpY3QuZ2V0KCJDQSIpOwogICAgICBjb25zdCBpbnRlcmlvckNvbG9yID0gZ2V0UmdiQ29sb3IoZGljdC5nZXRBcnJheSgiSUMiKSwgbnVsbCk7CiAgICAgIGNvbnN0IGZpbGxDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkoaW50ZXJpb3JDb2xvcik7CiAgICAgIGNvbnN0IGZpbGxBbHBoYSA9IGZpbGxDb2xvciA/IHN0cm9rZUFscGhhIDogbnVsbDsKICAgICAgY29uc3QgYm9yZGVyV2lkdGggPSB0aGlzLmJvcmRlclN0eWxlLndpZHRoIHx8IDEsCiAgICAgICAgYm9yZGVyQWRqdXN0ID0gMiAqIGJvcmRlcldpZHRoOwogICAgICBjb25zdCBiYm94ID0gW3RoaXMuZGF0YS5saW5lQ29vcmRpbmF0ZXNbMF0gLSBib3JkZXJBZGp1c3QsIHRoaXMuZGF0YS5saW5lQ29vcmRpbmF0ZXNbMV0gLSBib3JkZXJBZGp1c3QsIHRoaXMuZGF0YS5saW5lQ29vcmRpbmF0ZXNbMl0gKyBib3JkZXJBZGp1c3QsIHRoaXMuZGF0YS5saW5lQ29vcmRpbmF0ZXNbM10gKyBib3JkZXJBZGp1c3RdOwogICAgICBpZiAoIVV0aWwuaW50ZXJzZWN0KHRoaXMucmVjdGFuZ2xlLCBiYm94KSkgewogICAgICAgIHRoaXMucmVjdGFuZ2xlID0gYmJveDsKICAgICAgfQogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7Ym9yZGVyV2lkdGh9IHdgLAogICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgIGZpbGxDb2xvciwKICAgICAgICBzdHJva2VBbHBoYSwKICAgICAgICBmaWxsQWxwaGEsCiAgICAgICAgcG9pbnRzQ2FsbGJhY2s6IChidWZmZXIsIHBvaW50cykgPT4gewogICAgICAgICAgYnVmZmVyLnB1c2goYCR7bGluZUNvb3JkaW5hdGVzWzBdfSAke2xpbmVDb29yZGluYXRlc1sxXX0gbWAsIGAke2xpbmVDb29yZGluYXRlc1syXX0gJHtsaW5lQ29vcmRpbmF0ZXNbM119IGxgLCAiUyIpOwogICAgICAgICAgcmV0dXJuIFtwb2ludHNbMF0gLSBib3JkZXJXaWR0aCwgcG9pbnRzWzddIC0gYm9yZGVyV2lkdGgsIHBvaW50c1syXSArIGJvcmRlcldpZHRoLCBwb2ludHNbM10gKyBib3JkZXJXaWR0aF07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9Cn0KY2xhc3MgU3F1YXJlQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlNRVUFSRTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzdHJva2VDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvciwgWzAsIDAsIDBdKTsKICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgY29uc3QgaW50ZXJpb3JDb2xvciA9IGdldFJnYkNvbG9yKGRpY3QuZ2V0QXJyYXkoIklDIiksIG51bGwpOwogICAgICBjb25zdCBmaWxsQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KGludGVyaW9yQ29sb3IpOwogICAgICBjb25zdCBmaWxsQWxwaGEgPSBmaWxsQ29sb3IgPyBzdHJva2VBbHBoYSA6IG51bGw7CiAgICAgIGlmICh0aGlzLmJvcmRlclN0eWxlLndpZHRoID09PSAwICYmICFmaWxsQ29sb3IpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgIHhyZWYsCiAgICAgICAgZXh0cmE6IGAke3RoaXMuYm9yZGVyU3R5bGUud2lkdGh9IHdgLAogICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgIGZpbGxDb2xvciwKICAgICAgICBzdHJva2VBbHBoYSwKICAgICAgICBmaWxsQWxwaGEsCiAgICAgICAgcG9pbnRzQ2FsbGJhY2s6IChidWZmZXIsIHBvaW50cykgPT4gewogICAgICAgICAgY29uc3QgeCA9IHBvaW50c1s0XSArIHRoaXMuYm9yZGVyU3R5bGUud2lkdGggLyAyOwogICAgICAgICAgY29uc3QgeSA9IHBvaW50c1s1XSArIHRoaXMuYm9yZGVyU3R5bGUud2lkdGggLyAyOwogICAgICAgICAgY29uc3Qgd2lkdGggPSBwb2ludHNbNl0gLSBwb2ludHNbNF0gLSB0aGlzLmJvcmRlclN0eWxlLndpZHRoOwogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gcG9pbnRzWzNdIC0gcG9pbnRzWzddIC0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aDsKICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke3h9ICR7eX0gJHt3aWR0aH0gJHtoZWlnaHR9IHJlYCk7CiAgICAgICAgICBpZiAoZmlsbENvbG9yKSB7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCJCIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWZmZXIucHVzaCgiUyIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFtwb2ludHNbMF0sIHBvaW50c1s3XSwgcG9pbnRzWzJdLCBwb2ludHNbM11dOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9CmNsYXNzIENpcmNsZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5DSVJDTEU7CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzdHJva2VDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvciwgWzAsIDAsIDBdKTsKICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgY29uc3QgaW50ZXJpb3JDb2xvciA9IGdldFJnYkNvbG9yKGRpY3QuZ2V0QXJyYXkoIklDIiksIG51bGwpOwogICAgICBjb25zdCBmaWxsQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KGludGVyaW9yQ29sb3IpOwogICAgICBjb25zdCBmaWxsQWxwaGEgPSBmaWxsQ29sb3IgPyBzdHJva2VBbHBoYSA6IG51bGw7CiAgICAgIGlmICh0aGlzLmJvcmRlclN0eWxlLndpZHRoID09PSAwICYmICFmaWxsQ29sb3IpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgY29udHJvbFBvaW50c0Rpc3RhbmNlID0gNCAvIDMgKiBNYXRoLnRhbihNYXRoLlBJIC8gKDIgKiA0KSk7CiAgICAgIHRoaXMuX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICB4cmVmLAogICAgICAgIGV4dHJhOiBgJHt0aGlzLmJvcmRlclN0eWxlLndpZHRofSB3YCwKICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICBmaWxsQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgZmlsbEFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGNvbnN0IHgwID0gcG9pbnRzWzBdICsgdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB5MCA9IHBvaW50c1sxXSAtIHRoaXMuYm9yZGVyU3R5bGUud2lkdGggLyAyOwogICAgICAgICAgY29uc3QgeDEgPSBwb2ludHNbNl0gLSB0aGlzLmJvcmRlclN0eWxlLndpZHRoIC8gMjsKICAgICAgICAgIGNvbnN0IHkxID0gcG9pbnRzWzddICsgdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB4TWlkID0geDAgKyAoeDEgLSB4MCkgLyAyOwogICAgICAgICAgY29uc3QgeU1pZCA9IHkwICsgKHkxIC0geTApIC8gMjsKICAgICAgICAgIGNvbnN0IHhPZmZzZXQgPSAoeDEgLSB4MCkgLyAyICogY29udHJvbFBvaW50c0Rpc3RhbmNlOwogICAgICAgICAgY29uc3QgeU9mZnNldCA9ICh5MSAtIHkwKSAvIDIgKiBjb250cm9sUG9pbnRzRGlzdGFuY2U7CiAgICAgICAgICBidWZmZXIucHVzaChgJHt4TWlkfSAke3kxfSBtYCwgYCR7eE1pZCArIHhPZmZzZXR9ICR7eTF9ICR7eDF9ICR7eU1pZCArIHlPZmZzZXR9ICR7eDF9ICR7eU1pZH0gY2AsIGAke3gxfSAke3lNaWQgLSB5T2Zmc2V0fSAke3hNaWQgKyB4T2Zmc2V0fSAke3kwfSAke3hNaWR9ICR7eTB9IGNgLCBgJHt4TWlkIC0geE9mZnNldH0gJHt5MH0gJHt4MH0gJHt5TWlkIC0geU9mZnNldH0gJHt4MH0gJHt5TWlkfSBjYCwgYCR7eDB9ICR7eU1pZCArIHlPZmZzZXR9ICR7eE1pZCAtIHhPZmZzZXR9ICR7eTF9ICR7eE1pZH0gJHt5MX0gY2AsICJoIik7CiAgICAgICAgICBpZiAoZmlsbENvbG9yKSB7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCJCIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWZmZXIucHVzaCgiUyIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFtwb2ludHNbMF0sIHBvaW50c1s3XSwgcG9pbnRzWzJdLCBwb2ludHNbM11dOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9CmNsYXNzIFBvbHlsaW5lQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlBPTFlMSU5FOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIHRoaXMuZGF0YS52ZXJ0aWNlcyA9IG51bGw7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUG9seWdvbkFubm90YXRpb24pKSB7CiAgICAgIHRoaXMuc2V0TGluZUVuZGluZ3MoZGljdC5nZXRBcnJheSgiTEUiKSk7CiAgICAgIHRoaXMuZGF0YS5saW5lRW5kaW5ncyA9IHRoaXMubGluZUVuZGluZ3M7CiAgICB9CiAgICBjb25zdCByYXdWZXJ0aWNlcyA9IGRpY3QuZ2V0QXJyYXkoIlZlcnRpY2VzIik7CiAgICBpZiAoIWlzTnVtYmVyQXJyYXkocmF3VmVydGljZXMsIG51bGwpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHZlcnRpY2VzID0gdGhpcy5kYXRhLnZlcnRpY2VzID0gRmxvYXQzMkFycmF5LmZyb20ocmF3VmVydGljZXMpOwogICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgIGxldCBmaWxsQ29sb3IgPSBnZXRSZ2JDb2xvcihkaWN0LmdldEFycmF5KCJJQyIpLCBudWxsKTsKICAgICAgaWYgKGZpbGxDb2xvcikgewogICAgICAgIGZpbGxDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkoZmlsbENvbG9yKTsKICAgICAgfQogICAgICBsZXQgb3BlcmF0b3I7CiAgICAgIGlmIChmaWxsQ29sb3IpIHsKICAgICAgICBpZiAodGhpcy5jb2xvcikgewogICAgICAgICAgb3BlcmF0b3IgPSBmaWxsQ29sb3IuZXZlcnkoKGMsIGkpID0+IGMgPT09IHN0cm9rZUNvbG9yW2ldKSA/ICJmIiA6ICJCIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3BlcmF0b3IgPSAiZiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG9wZXJhdG9yID0gIlMiOwogICAgICB9CiAgICAgIGNvbnN0IGJvcmRlcldpZHRoID0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCB8fCAxLAogICAgICAgIGJvcmRlckFkanVzdCA9IDIgKiBib3JkZXJXaWR0aDsKICAgICAgY29uc3QgYmJveCA9IFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdmVydGljZXMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgIFV0aWwucmVjdEJvdW5kaW5nQm94KHZlcnRpY2VzW2ldIC0gYm9yZGVyQWRqdXN0LCB2ZXJ0aWNlc1tpICsgMV0gLSBib3JkZXJBZGp1c3QsIHZlcnRpY2VzW2ldICsgYm9yZGVyQWRqdXN0LCB2ZXJ0aWNlc1tpICsgMV0gKyBib3JkZXJBZGp1c3QsIGJib3gpOwogICAgICB9CiAgICAgIGlmICghVXRpbC5pbnRlcnNlY3QodGhpcy5yZWN0YW5nbGUsIGJib3gpKSB7CiAgICAgICAgdGhpcy5yZWN0YW5nbGUgPSBiYm94OwogICAgICB9CiAgICAgIHRoaXMuX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICB4cmVmLAogICAgICAgIGV4dHJhOiBgJHtib3JkZXJXaWR0aH0gd2AsCiAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgZmlsbENvbG9yLAogICAgICAgIGZpbGxBbHBoYTogZmlsbENvbG9yID8gc3Ryb2tlQWxwaGEgOiBudWxsLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHZlcnRpY2VzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7dmVydGljZXNbaV19ICR7dmVydGljZXNbaSArIDFdfSAke2kgPT09IDAgPyAibSIgOiAibCJ9YCk7CiAgICAgICAgICB9CiAgICAgICAgICBidWZmZXIucHVzaChvcGVyYXRvcik7CiAgICAgICAgICByZXR1cm4gW3BvaW50c1swXSwgcG9pbnRzWzddLCBwb2ludHNbMl0sIHBvaW50c1szXV07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9Cn0KY2xhc3MgUG9seWdvbkFubm90YXRpb24gZXh0ZW5kcyBQb2x5bGluZUFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlBPTFlHT047CiAgfQp9CmNsYXNzIENhcmV0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLkNBUkVUOwogIH0KfQpjbGFzcyBJbmtBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLklOSzsKICAgIHRoaXMuZGF0YS5pbmtMaXN0cyA9IFtdOwogICAgdGhpcy5kYXRhLmlzRWRpdGFibGUgPSAhdGhpcy5kYXRhLm5vSFRNTDsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIHRoaXMuZGF0YS5vcGFjaXR5ID0gZGljdC5nZXQoIkNBIikgfHwgMTsKICAgIGNvbnN0IHJhd0lua0xpc3RzID0gZGljdC5nZXRBcnJheSgiSW5rTGlzdCIpOwogICAgaWYgKCFBcnJheS5pc0FycmF5KHJhd0lua0xpc3RzKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSByYXdJbmtMaXN0cy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShyYXdJbmtMaXN0c1tpXSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBpbmtMaXN0ID0gbmV3IEZsb2F0MzJBcnJheShyYXdJbmtMaXN0c1tpXS5sZW5ndGgpOwogICAgICB0aGlzLmRhdGEuaW5rTGlzdHMucHVzaChpbmtMaXN0KTsKICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gcmF3SW5rTGlzdHNbaV0ubGVuZ3RoOyBqIDwgamo7IGogKz0gMikgewogICAgICAgIGNvbnN0IHggPSB4cmVmLmZldGNoSWZSZWYocmF3SW5rTGlzdHNbaV1bal0pLAogICAgICAgICAgeSA9IHhyZWYuZmV0Y2hJZlJlZihyYXdJbmtMaXN0c1tpXVtqICsgMV0pOwogICAgICAgIGlmICh0eXBlb2YgeCA9PT0gIm51bWJlciIgJiYgdHlwZW9mIHkgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICBpbmtMaXN0W2pdID0geDsKICAgICAgICAgIGlua0xpc3RbaiArIDFdID0geTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yLCBbMCwgMCwgMF0pOwogICAgICBjb25zdCBzdHJva2VBbHBoYSA9IGRpY3QuZ2V0KCJDQSIpOwogICAgICBjb25zdCBib3JkZXJXaWR0aCA9IHRoaXMuYm9yZGVyU3R5bGUud2lkdGggfHwgMSwKICAgICAgICBib3JkZXJBZGp1c3QgPSAyICogYm9yZGVyV2lkdGg7CiAgICAgIGNvbnN0IGJib3ggPSBbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV07CiAgICAgIGZvciAoY29uc3QgaW5rTGlzdCBvZiB0aGlzLmRhdGEuaW5rTGlzdHMpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbmtMaXN0Lmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgIFV0aWwucmVjdEJvdW5kaW5nQm94KGlua0xpc3RbaV0gLSBib3JkZXJBZGp1c3QsIGlua0xpc3RbaSArIDFdIC0gYm9yZGVyQWRqdXN0LCBpbmtMaXN0W2ldICsgYm9yZGVyQWRqdXN0LCBpbmtMaXN0W2kgKyAxXSArIGJvcmRlckFkanVzdCwgYmJveCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghVXRpbC5pbnRlcnNlY3QodGhpcy5yZWN0YW5nbGUsIGJib3gpKSB7CiAgICAgICAgdGhpcy5yZWN0YW5nbGUgPSBiYm94OwogICAgICB9CiAgICAgIHRoaXMuX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICB4cmVmLAogICAgICAgIGV4dHJhOiBgJHtib3JkZXJXaWR0aH0gd2AsCiAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgcG9pbnRzQ2FsbGJhY2s6IChidWZmZXIsIHBvaW50cykgPT4gewogICAgICAgICAgZm9yIChjb25zdCBpbmtMaXN0IG9mIHRoaXMuZGF0YS5pbmtMaXN0cykgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbmtMaXN0Lmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgICAgICBidWZmZXIucHVzaChgJHtpbmtMaXN0W2ldfSAke2lua0xpc3RbaSArIDFdfSAke2kgPT09IDAgPyAibSIgOiAibCJ9YCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnVmZmVyLnB1c2goIlMiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KICBzdGF0aWMgY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCB7CiAgICBhcFJlZiwKICAgIGFwCiAgfSkgewogICAgY29uc3QgewogICAgICBvbGRBbm5vdGF0aW9uLAogICAgICBjb2xvciwKICAgICAgZGF0ZSwKICAgICAgb3BhY2l0eSwKICAgICAgcGF0aHMsCiAgICAgIG91dGxpbmVzLAogICAgICByZWN0LAogICAgICByb3RhdGlvbiwKICAgICAgdGhpY2tuZXNzLAogICAgICB1c2VyCiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGNvbnN0IGluayA9IG9sZEFubm90YXRpb24gfHwgbmV3IERpY3QoeHJlZik7CiAgICBpbmsuc2V0SWZOb3RFeGlzdHMoIlR5cGUiLCBOYW1lLmdldCgiQW5ub3QiKSk7CiAgICBpbmsuc2V0SWZOb3RFeGlzdHMoIlN1YnR5cGUiLCBOYW1lLmdldCgiSW5rIikpOwogICAgaW5rLnNldChvbGRBbm5vdGF0aW9uID8gIk0iIDogIkNyZWF0aW9uRGF0ZSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZShkYXRlKX1gKTsKICAgIGluay5zZXRJZkFycmF5KCJSZWN0IiwgcmVjdCk7CiAgICBpbmsuc2V0SWZBcnJheSgiSW5rTGlzdCIsIG91dGxpbmVzPy5wb2ludHMgfHwgcGF0aHM/LnBvaW50cyk7CiAgICBpbmsuc2V0SWZOb3RFeGlzdHMoIkYiLCA0KTsKICAgIGluay5zZXRJZk51bWJlcigiUm90YXRlIiwgcm90YXRpb24pOwogICAgaW5rLnNldElmRGVmaW5lZCgiVCIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodXNlcikpOwogICAgaWYgKG91dGxpbmVzKSB7CiAgICAgIGluay5zZXRJZk5hbWUoIklUIiwgIklua0hpZ2hsaWdodCIpOwogICAgfQogICAgaWYgKHRoaWNrbmVzcyA+IDApIHsKICAgICAgY29uc3QgYnMgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgaW5rLnNldCgiQlMiLCBicyk7CiAgICAgIGJzLnNldCgiVyIsIHRoaWNrbmVzcyk7CiAgICB9CiAgICBpbmsuc2V0SWZBcnJheSgiQyIsIGdldFBkZkNvbG9yQXJyYXkoY29sb3IpKTsKICAgIGluay5zZXRJZk51bWJlcigiQ0EiLCBvcGFjaXR5KTsKICAgIGlmIChhcCB8fCBhcFJlZikgewogICAgICBjb25zdCBuID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGluay5zZXQoIkFQIiwgbik7CiAgICAgIG4uc2V0KCJOIiwgYXBSZWYgfHwgYXApOwogICAgfQogICAgcmV0dXJuIGluazsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKSB7CiAgICBpZiAoYW5ub3RhdGlvbi5vdXRsaW5lcykgewogICAgICByZXR1cm4gdGhpcy5jcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtRm9ySGlnaGxpZ2h0KGFubm90YXRpb24sIHhyZWYsIHBhcmFtcyk7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGNvbG9yLAogICAgICByZWN0LAogICAgICBwYXRocywKICAgICAgdGhpY2tuZXNzLAogICAgICBvcGFjaXR5CiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGlmICghY29sb3IpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBhcHBlYXJhbmNlQnVmZmVyID0gW2Ake3RoaWNrbmVzc30gdyAxIEogMSBqYCwgYCR7Z2V0UGRmQ29sb3IoY29sb3IsIGZhbHNlKX1gXTsKICAgIGlmIChvcGFjaXR5ICE9PSAxKSB7CiAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaCgiL1IwIGdzIik7CiAgICB9CiAgICBmb3IgKGNvbnN0IG91dGxpbmUgb2YgcGF0aHMubGluZXMpIHsKICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGAke251bWJlclRvU3RyaW5nKG91dGxpbmVbNF0pfSAke251bWJlclRvU3RyaW5nKG91dGxpbmVbNV0pfSBtYCk7CiAgICAgIGZvciAobGV0IGkgPSA2LCBpaSA9IG91dGxpbmUubGVuZ3RoOyBpIDwgaWk7IGkgKz0gNikgewogICAgICAgIGlmIChpc05hTihvdXRsaW5lW2ldKSkgewogICAgICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGAke251bWJlclRvU3RyaW5nKG91dGxpbmVbaSArIDRdKX0gJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lW2kgKyA1XSl9IGxgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgW2MxeCwgYzF5LCBjMngsIGMyeSwgeCwgeV0gPSBvdXRsaW5lLnNsaWNlKGksIGkgKyA2KTsKICAgICAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChbYzF4LCBjMXksIGMyeCwgYzJ5LCB4LCB5XS5tYXAobnVtYmVyVG9TdHJpbmcpLmpvaW4oIiAiKSArICIgYyIpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAob3V0bGluZS5sZW5ndGggPT09IDYpIHsKICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVs0XSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVs1XSl9IGxgKTsKICAgICAgfQogICAgfQogICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKCJTIik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYXBwZWFyYW5jZUJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgcmVjdCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGlmIChvcGFjaXR5ICE9PSAxKSB7CiAgICAgIGNvbnN0IHJlc291cmNlcyA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBjb25zdCBleHRHU3RhdGUgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgY29uc3QgcjAgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgcjAuc2V0KCJDQSIsIG9wYWNpdHkpOwogICAgICByMC5zZXRJZk5hbWUoIlR5cGUiLCAiRXh0R1N0YXRlIik7CiAgICAgIGV4dEdTdGF0ZS5zZXQoIlIwIiwgcjApOwogICAgICByZXNvdXJjZXMuc2V0KCJFeHRHU3RhdGUiLCBleHRHU3RhdGUpOwogICAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICB9CiAgICBjb25zdCBhcCA9IG5ldyBTdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICBhcC5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICByZXR1cm4gYXA7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtRm9ySGlnaGxpZ2h0KGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgcmVjdCwKICAgICAgb3V0bGluZXM6IHsKICAgICAgICBvdXRsaW5lCiAgICAgIH0sCiAgICAgIG9wYWNpdHkKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgaWYgKCFjb2xvcikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2VCdWZmZXIgPSBbYCR7Z2V0UGRmQ29sb3IoY29sb3IsIHRydWUpfWAsICIvUjAgZ3MiXTsKICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lWzRdKX0gJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lWzVdKX0gbWApOwogICAgZm9yIChsZXQgaSA9IDYsIGlpID0gb3V0bGluZS5sZW5ndGg7IGkgPCBpaTsgaSArPSA2KSB7CiAgICAgIGlmIChpc05hTihvdXRsaW5lW2ldKSkgewogICAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lW2kgKyA0XSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpICsgNV0pfSBsYCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgW2MxeCwgYzF5LCBjMngsIGMyeSwgeCwgeV0gPSBvdXRsaW5lLnNsaWNlKGksIGkgKyA2KTsKICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goW2MxeCwgYzF5LCBjMngsIGMyeSwgeCwgeV0ubWFwKG51bWJlclRvU3RyaW5nKS5qb2luKCIgIikgKyAiIGMiKTsKICAgICAgfQogICAgfQogICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKCJoIGYiKTsKICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlQnVmZmVyLmpvaW4oIlxuIik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCByZWN0KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTGVuZ3RoIiwgYXBwZWFyYW5jZS5sZW5ndGgpOwogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCBleHRHU3RhdGUgPSBuZXcgRGljdCh4cmVmKTsKICAgIHJlc291cmNlcy5zZXQoIkV4dEdTdGF0ZSIsIGV4dEdTdGF0ZSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICBjb25zdCByMCA9IG5ldyBEaWN0KHhyZWYpOwogICAgZXh0R1N0YXRlLnNldCgiUjAiLCByMCk7CiAgICByMC5zZXRJZk5hbWUoIkJNIiwgIk11bHRpcGx5Iik7CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICByMC5zZXQoImNhIiwgb3BhY2l0eSk7CiAgICAgIHIwLnNldElmTmFtZSgiVHlwZSIsICJFeHRHU3RhdGUiKTsKICAgIH0KICAgIGNvbnN0IGFwID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgIGFwLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHJldHVybiBhcDsKICB9Cn0KY2xhc3MgSGlnaGxpZ2h0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLkhJR0hMSUdIVDsKICAgIHRoaXMuZGF0YS5pc0VkaXRhYmxlID0gIXRoaXMuZGF0YS5ub0hUTUw7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICB0aGlzLmRhdGEub3BhY2l0eSA9IGRpY3QuZ2V0KCJDQSIpIHx8IDE7CiAgICBjb25zdCBxdWFkUG9pbnRzID0gdGhpcy5kYXRhLnF1YWRQb2ludHMgPSBnZXRRdWFkUG9pbnRzKGRpY3QsIG51bGwpOwogICAgaWYgKHF1YWRQb2ludHMpIHsKICAgICAgY29uc3QgcmVzb3VyY2VzID0gdGhpcy5hcHBlYXJhbmNlPy5kaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICAgIGlmICghdGhpcy5hcHBlYXJhbmNlIHx8ICFyZXNvdXJjZXM/LmhhcygiRXh0R1N0YXRlIikpIHsKICAgICAgICBpZiAodGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgICB3YXJuKCJIaWdobGlnaHRBbm5vdGF0aW9uIC0gaWdub3JpbmcgYnVpbHQtaW4gYXBwZWFyYW5jZSBzdHJlYW0uIik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZpbGxDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvciwgWzEsIDEsIDBdKTsKICAgICAgICBjb25zdCBmaWxsQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZmlsbENvbG9yLAogICAgICAgICAgYmxlbmRNb2RlOiAiTXVsdGlwbHkiLAogICAgICAgICAgZmlsbEFscGhhLAogICAgICAgICAgcG9pbnRzQ2FsbGJhY2s6IChidWZmZXIsIHBvaW50cykgPT4gewogICAgICAgICAgICBidWZmZXIucHVzaChgJHtwb2ludHNbMF19ICR7cG9pbnRzWzFdfSBtYCwgYCR7cG9pbnRzWzJdfSAke3BvaW50c1szXX0gbGAsIGAke3BvaW50c1s2XX0gJHtwb2ludHNbN119IGxgLCBgJHtwb2ludHNbNF19ICR7cG9pbnRzWzVdfSBsYCwgImYiKTsKICAgICAgICAgICAgcmV0dXJuIFtwb2ludHNbMF0sIHBvaW50c1s3XSwgcG9pbnRzWzJdLCBwb2ludHNbM11dOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRhdGEucG9wdXBSZWYgPSBudWxsOwogICAgfQogIH0KICBnZXQgb3ZlcmxheXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBzdGF0aWMgY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCB7CiAgICBhcFJlZiwKICAgIGFwCiAgfSkgewogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgZGF0ZSwKICAgICAgb2xkQW5ub3RhdGlvbiwKICAgICAgb3BhY2l0eSwKICAgICAgcmVjdCwKICAgICAgcm90YXRpb24sCiAgICAgIHVzZXIsCiAgICAgIHF1YWRQb2ludHMKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgY29uc3QgaGlnaGxpZ2h0ID0gb2xkQW5ub3RhdGlvbiB8fCBuZXcgRGljdCh4cmVmKTsKICAgIGhpZ2hsaWdodC5zZXRJZk5vdEV4aXN0cygiVHlwZSIsIE5hbWUuZ2V0KCJBbm5vdCIpKTsKICAgIGhpZ2hsaWdodC5zZXRJZk5vdEV4aXN0cygiU3VidHlwZSIsIE5hbWUuZ2V0KCJIaWdobGlnaHQiKSk7CiAgICBoaWdobGlnaHQuc2V0KG9sZEFubm90YXRpb24gPyAiTSIgOiAiQ3JlYXRpb25EYXRlIiwgYEQ6JHtnZXRNb2RpZmljYXRpb25EYXRlKGRhdGUpfWApOwogICAgaGlnaGxpZ2h0LnNldElmQXJyYXkoIlJlY3QiLCByZWN0KTsKICAgIGhpZ2hsaWdodC5zZXRJZk5vdEV4aXN0cygiRiIsIDQpOwogICAgaGlnaGxpZ2h0LnNldElmTm90RXhpc3RzKCJCb3JkZXIiLCBbMCwgMCwgMF0pOwogICAgaGlnaGxpZ2h0LnNldElmTnVtYmVyKCJSb3RhdGUiLCByb3RhdGlvbik7CiAgICBoaWdobGlnaHQuc2V0SWZBcnJheSgiUXVhZFBvaW50cyIsIHF1YWRQb2ludHMpOwogICAgaGlnaGxpZ2h0LnNldElmQXJyYXkoIkMiLCBnZXRQZGZDb2xvckFycmF5KGNvbG9yKSk7CiAgICBoaWdobGlnaHQuc2V0SWZOdW1iZXIoIkNBIiwgb3BhY2l0eSk7CiAgICBoaWdobGlnaHQuc2V0SWZEZWZpbmVkKCJUIiwgc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRSh1c2VyKSk7CiAgICBpZiAoYXBSZWYgfHwgYXApIHsKICAgICAgY29uc3QgbiA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBoaWdobGlnaHQuc2V0KCJBUCIsIG4pOwogICAgICBuLnNldCgiTiIsIGFwUmVmIHx8IGFwKTsKICAgIH0KICAgIHJldHVybiBoaWdobGlnaHQ7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgcmVjdCwKICAgICAgb3V0bGluZXMsCiAgICAgIG9wYWNpdHkKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgaWYgKCFjb2xvcikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2VCdWZmZXIgPSBbYCR7Z2V0UGRmQ29sb3IoY29sb3IsIHRydWUpfWAsICIvUjAgZ3MiXTsKICAgIGNvbnN0IGJ1ZmZlciA9IFtdOwogICAgZm9yIChjb25zdCBvdXRsaW5lIG9mIG91dGxpbmVzKSB7CiAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICBidWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lWzBdKX0gJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lWzFdKX0gbWApOwogICAgICBmb3IgKGxldCBpID0gMiwgaWkgPSBvdXRsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICBidWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lW2ldKX0gJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lW2kgKyAxXSl9IGxgKTsKICAgICAgfQogICAgICBidWZmZXIucHVzaCgiaCIpOwogICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goYnVmZmVyLmpvaW4oIlxuIikpOwogICAgfQogICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKCJmKiIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGFwcGVhcmFuY2VCdWZmZXIuam9pbigiXG4iKTsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW1EaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkZvcm1UeXBlIiwgMSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiRm9ybSIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJUeXBlIiwgIlhPYmplY3QiKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiQkJveCIsIHJlY3QpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJMZW5ndGgiLCBhcHBlYXJhbmNlLmxlbmd0aCk7CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgRGljdCh4cmVmKTsKICAgIGNvbnN0IGV4dEdTdGF0ZSA9IG5ldyBEaWN0KHhyZWYpOwogICAgcmVzb3VyY2VzLnNldCgiRXh0R1N0YXRlIiwgZXh0R1N0YXRlKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIGNvbnN0IHIwID0gbmV3IERpY3QoeHJlZik7CiAgICBleHRHU3RhdGUuc2V0KCJSMCIsIHIwKTsKICAgIHIwLnNldElmTmFtZSgiQk0iLCAiTXVsdGlwbHkiKTsKICAgIGlmIChvcGFjaXR5ICE9PSAxKSB7CiAgICAgIHIwLnNldCgiY2EiLCBvcGFjaXR5KTsKICAgICAgcjAuc2V0SWZOYW1lKCJUeXBlIiwgIkV4dEdTdGF0ZSIpOwogICAgfQogICAgY29uc3QgYXAgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KfQpjbGFzcyBVbmRlcmxpbmVBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuVU5ERVJMSU5FOwogICAgY29uc3QgcXVhZFBvaW50cyA9IHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhkaWN0LCBudWxsKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZXh0cmE6ICJbXSAwIGQgMC41NzEgdyIsCiAgICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgICAgcG9pbnRzQ2FsbGJhY2s6IChidWZmZXIsIHBvaW50cykgPT4gewogICAgICAgICAgICBidWZmZXIucHVzaChgJHtwb2ludHNbNF19ICR7cG9pbnRzWzVdICsgMS4zfSBtYCwgYCR7cG9pbnRzWzZdfSAke3BvaW50c1s3XSArIDEuM30gbGAsICJTIik7CiAgICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gbnVsbDsKICAgIH0KICB9CiAgZ2V0IG92ZXJsYXlzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgU3F1aWdnbHlBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuU1FVSUdHTFk7CiAgICBjb25zdCBxdWFkUG9pbnRzID0gdGhpcy5kYXRhLnF1YWRQb2ludHMgPSBnZXRRdWFkUG9pbnRzKGRpY3QsIG51bGwpOwogICAgaWYgKHF1YWRQb2ludHMpIHsKICAgICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgICBjb25zdCBzdHJva2VDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvciwgWzAsIDAsIDBdKTsKICAgICAgICBjb25zdCBzdHJva2VBbHBoYSA9IGRpY3QuZ2V0KCJDQSIpOwogICAgICAgIHRoaXMuX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICAgIHhyZWYsCiAgICAgICAgICBleHRyYTogIltdIDAgZCAxIHciLAogICAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgICBzdHJva2VBbHBoYSwKICAgICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgICAgY29uc3QgZHkgPSAocG9pbnRzWzFdIC0gcG9pbnRzWzVdKSAvIDY7CiAgICAgICAgICAgIGxldCBzaGlmdCA9IGR5OwogICAgICAgICAgICBsZXQgeCA9IHBvaW50c1s0XTsKICAgICAgICAgICAgY29uc3QgeSA9IHBvaW50c1s1XTsKICAgICAgICAgICAgY29uc3QgeEVuZCA9IHBvaW50c1s2XTsKICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7eH0gJHt5ICsgc2hpZnR9IG1gKTsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIHggKz0gMjsKICAgICAgICAgICAgICBzaGlmdCA9IHNoaWZ0ID09PSAwID8gZHkgOiAwOwogICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke3h9ICR7eSArIHNoaWZ0fSBsYCk7CiAgICAgICAgICAgIH0gd2hpbGUgKHggPCB4RW5kKTsKICAgICAgICAgICAgYnVmZmVyLnB1c2goIlMiKTsKICAgICAgICAgICAgcmV0dXJuIFtwb2ludHNbNF0sIHkgLSAyICogZHksIHhFbmQsIHkgKyAyICogZHldOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRhdGEucG9wdXBSZWYgPSBudWxsOwogICAgfQogIH0KICBnZXQgb3ZlcmxheXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQpjbGFzcyBTdHJpa2VPdXRBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuU1RSSUtFT1VUOwogICAgY29uc3QgcXVhZFBvaW50cyA9IHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhkaWN0LCBudWxsKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZXh0cmE6ICJbXSAwIGQgMSB3IiwKICAgICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGAkeyhwb2ludHNbMF0gKyBwb2ludHNbNF0pIC8gMn0gYCArIGAkeyhwb2ludHNbMV0gKyBwb2ludHNbNV0pIC8gMn0gbWAsIGAkeyhwb2ludHNbMl0gKyBwb2ludHNbNl0pIC8gMn0gYCArIGAkeyhwb2ludHNbM10gKyBwb2ludHNbN10pIC8gMn0gbGAsICJTIik7CiAgICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gbnVsbDsKICAgIH0KICB9CiAgZ2V0IG92ZXJsYXlzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgU3RhbXBBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgI3NhdmVkSGFzT3duQ2FudmFzID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5TVEFNUDsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEuaXNFZGl0YWJsZSA9ICF0aGlzLmRhdGEubm9IVE1MOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogIH0KICBtdXN0QmVWaWV3ZWRXaGVuRWRpdGluZyhpc0VkaXRpbmcsIG1vZGlmaWVkSWRzID0gbnVsbCkgewogICAgaWYgKGlzRWRpdGluZykgewogICAgICBpZiAoIXRoaXMuZGF0YS5pc0VkaXRhYmxlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgdGhpcy4jc2F2ZWRIYXNPd25DYW52YXMgPz89IHRoaXMuZGF0YS5oYXNPd25DYW52YXM7CiAgICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0cnVlOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLiNzYXZlZEhhc093bkNhbnZhcyAhPT0gbnVsbCkgewogICAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy4jc2F2ZWRIYXNPd25DYW52YXM7CiAgICAgIHRoaXMuI3NhdmVkSGFzT3duQ2FudmFzID0gbnVsbDsKICAgIH0KICAgIHJldHVybiAhbW9kaWZpZWRJZHM/Lmhhcyh0aGlzLmRhdGEuaWQpOwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlSW1hZ2UoYml0bWFwLCB4cmVmKSB7CiAgICBjb25zdCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSBiaXRtYXA7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICBhbHBoYTogdHJ1ZQogICAgfSk7CiAgICBjdHguZHJhd0ltYWdlKGJpdG1hcCwgMCwgMCk7CiAgICBjb25zdCBkYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCB3aWR0aCwgaGVpZ2h0KS5kYXRhOwogICAgY29uc3QgYnVmMzIgPSBuZXcgVWludDMyQXJyYXkoZGF0YS5idWZmZXIpOwogICAgY29uc3QgaGFzQWxwaGEgPSBidWYzMi5zb21lKEZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuID8geCA9PiB4ID4+PiAyNCAhPT0gMHhmZiA6IHggPT4gKHggJiAweGZmKSAhPT0gMHhmZik7CiAgICBpZiAoaGFzQWxwaGEpIHsKICAgICAgY3R4LmZpbGxTdHlsZSA9ICJ3aGl0ZSI7CiAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDApOwogICAgfQogICAgY29uc3QganBlZ0J1ZmZlclByb21pc2UgPSBjYW52YXMuY29udmVydFRvQmxvYih7CiAgICAgIHR5cGU6ICJpbWFnZS9qcGVnIiwKICAgICAgcXVhbGl0eTogMQogICAgfSkudGhlbihibG9iID0+IGJsb2IuYXJyYXlCdWZmZXIoKSk7CiAgICBjb25zdCB4b2JqZWN0TmFtZSA9IE5hbWUuZ2V0KCJYT2JqZWN0Iik7CiAgICBjb25zdCBpbWFnZU5hbWUgPSBOYW1lLmdldCgiSW1hZ2UiKTsKICAgIGNvbnN0IGltYWdlID0gbmV3IERpY3QoeHJlZik7CiAgICBpbWFnZS5zZXQoIlR5cGUiLCB4b2JqZWN0TmFtZSk7CiAgICBpbWFnZS5zZXQoIlN1YnR5cGUiLCBpbWFnZU5hbWUpOwogICAgaW1hZ2Uuc2V0KCJCaXRzUGVyQ29tcG9uZW50IiwgOCk7CiAgICBpbWFnZS5zZXRJZk5hbWUoIkNvbG9yU3BhY2UiLCAiRGV2aWNlUkdCIik7CiAgICBpbWFnZS5zZXRJZk5hbWUoIkZpbHRlciIsICJEQ1REZWNvZGUiKTsKICAgIGltYWdlLnNldCgiQkJveCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0XSk7CiAgICBpbWFnZS5zZXQoIldpZHRoIiwgd2lkdGgpOwogICAgaW1hZ2Uuc2V0KCJIZWlnaHQiLCBoZWlnaHQpOwogICAgbGV0IHNtYXNrU3RyZWFtID0gbnVsbDsKICAgIGlmIChoYXNBbHBoYSkgewogICAgICBjb25zdCBhbHBoYUJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGJ1ZjMyLmxlbmd0aCk7CiAgICAgIGlmIChGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbikgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGJ1ZjMyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGFscGhhQnVmZmVyW2ldID0gYnVmMzJbaV0gPj4+IDI0OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBidWYzMi5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBhbHBoYUJ1ZmZlcltpXSA9IGJ1ZjMyW2ldICYgMHhmZjsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3Qgc21hc2sgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgc21hc2suc2V0KCJUeXBlIiwgeG9iamVjdE5hbWUpOwogICAgICBzbWFzay5zZXQoIlN1YnR5cGUiLCBpbWFnZU5hbWUpOwogICAgICBzbWFzay5zZXQoIkJpdHNQZXJDb21wb25lbnQiLCA4KTsKICAgICAgc21hc2suc2V0SWZOYW1lKCJDb2xvclNwYWNlIiwgIkRldmljZUdyYXkiKTsKICAgICAgc21hc2suc2V0KCJXaWR0aCIsIHdpZHRoKTsKICAgICAgc21hc2suc2V0KCJIZWlnaHQiLCBoZWlnaHQpOwogICAgICBzbWFza1N0cmVhbSA9IG5ldyBTdHJlYW0oYWxwaGFCdWZmZXIsIDAsIDAsIHNtYXNrKTsKICAgIH0KICAgIGNvbnN0IGltYWdlU3RyZWFtID0gbmV3IFN0cmVhbShhd2FpdCBqcGVnQnVmZmVyUHJvbWlzZSwgMCwgMCwgaW1hZ2UpOwogICAgcmV0dXJuIHsKICAgICAgaW1hZ2VTdHJlYW0sCiAgICAgIHNtYXNrU3RyZWFtLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9OwogIH0KICBzdGF0aWMgY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCB7CiAgICBhcFJlZiwKICAgIGFwCiAgfSkgewogICAgY29uc3QgewogICAgICBkYXRlLAogICAgICBvbGRBbm5vdGF0aW9uLAogICAgICByZWN0LAogICAgICByb3RhdGlvbiwKICAgICAgdXNlcgogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCBzdGFtcCA9IG9sZEFubm90YXRpb24gfHwgbmV3IERpY3QoeHJlZik7CiAgICBzdGFtcC5zZXRJZk5vdEV4aXN0cygiVHlwZSIsIE5hbWUuZ2V0KCJBbm5vdCIpKTsKICAgIHN0YW1wLnNldElmTm90RXhpc3RzKCJTdWJ0eXBlIiwgTmFtZS5nZXQoIlN0YW1wIikpOwogICAgc3RhbXAuc2V0KG9sZEFubm90YXRpb24gPyAiTSIgOiAiQ3JlYXRpb25EYXRlIiwgYEQ6JHtnZXRNb2RpZmljYXRpb25EYXRlKGRhdGUpfWApOwogICAgc3RhbXAuc2V0SWZBcnJheSgiUmVjdCIsIHJlY3QpOwogICAgc3RhbXAuc2V0SWZOb3RFeGlzdHMoIkYiLCA0KTsKICAgIHN0YW1wLnNldElmTm90RXhpc3RzKCJCb3JkZXIiLCBbMCwgMCwgMF0pOwogICAgc3RhbXAuc2V0SWZOdW1iZXIoIlJvdGF0ZSIsIHJvdGF0aW9uKTsKICAgIHN0YW1wLnNldElmRGVmaW5lZCgiVCIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodXNlcikpOwogICAgaWYgKGFwUmVmIHx8IGFwKSB7CiAgICAgIGNvbnN0IG4gPSBuZXcgRGljdCh4cmVmKTsKICAgICAgc3RhbXAuc2V0KCJBUCIsIG4pOwogICAgICBuLnNldCgiTiIsIGFwUmVmIHx8IGFwKTsKICAgIH0KICAgIHJldHVybiBzdGFtcDsKICB9CiAgc3RhdGljIGFzeW5jICNjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtRm9yRHJhd2luZyhhbm5vdGF0aW9uLCB4cmVmKSB7CiAgICBjb25zdCB7CiAgICAgIGFyZUNvbnRvdXJzLAogICAgICBjb2xvciwKICAgICAgcmVjdCwKICAgICAgbGluZXMsCiAgICAgIHRoaWNrbmVzcwogICAgfSA9IGFubm90YXRpb247CiAgICBpZiAoIWNvbG9yKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZUJ1ZmZlciA9IFtgJHt0aGlja25lc3N9IHcgMSBKIDEgamAsIGAke2dldFBkZkNvbG9yKGNvbG9yLCBhcmVDb250b3Vycyl9YF07CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHsKICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGAke251bWJlclRvU3RyaW5nKGxpbmVbNF0pfSAke251bWJlclRvU3RyaW5nKGxpbmVbNV0pfSBtYCk7CiAgICAgIGZvciAobGV0IGkgPSA2LCBpaSA9IGxpbmUubGVuZ3RoOyBpIDwgaWk7IGkgKz0gNikgewogICAgICAgIGlmIChpc05hTihsaW5lW2ldKSkgewogICAgICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGAke251bWJlclRvU3RyaW5nKGxpbmVbaSArIDRdKX0gJHtudW1iZXJUb1N0cmluZyhsaW5lW2kgKyA1XSl9IGxgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgW2MxeCwgYzF5LCBjMngsIGMyeSwgeCwgeV0gPSBsaW5lLnNsaWNlKGksIGkgKyA2KTsKICAgICAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChbYzF4LCBjMXksIGMyeCwgYzJ5LCB4LCB5XS5tYXAobnVtYmVyVG9TdHJpbmcpLmpvaW4oIiAiKSArICIgYyIpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobGluZS5sZW5ndGggPT09IDYpIHsKICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcobGluZVs0XSl9ICR7bnVtYmVyVG9TdHJpbmcobGluZVs1XSl9IGxgKTsKICAgICAgfQogICAgfQogICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGFyZUNvbnRvdXJzID8gIkYiIDogIlMiKTsKICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlQnVmZmVyLmpvaW4oIlxuIik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCByZWN0KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTGVuZ3RoIiwgYXBwZWFyYW5jZS5sZW5ndGgpOwogICAgY29uc3QgYXAgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbShhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpIHsKICAgIGlmIChhbm5vdGF0aW9uLm9sZEFubm90YXRpb24pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAoYW5ub3RhdGlvbi5pc1NpZ25hdHVyZSkgewogICAgICByZXR1cm4gdGhpcy4jY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbUZvckRyYXdpbmcoYW5ub3RhdGlvbiwgeHJlZik7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHJvdGF0aW9uCiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGNvbnN0IHsKICAgICAgaW1hZ2VSZWYsCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSBwYXJhbXMuaW1hZ2U7CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgRGljdCh4cmVmKTsKICAgIGNvbnN0IHhvYmplY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIHJlc291cmNlcy5zZXQoIlhPYmplY3QiLCB4b2JqZWN0KTsKICAgIHhvYmplY3Quc2V0KCJJbTAiLCBpbWFnZVJlZik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYHEgJHt3aWR0aH0gMCAwICR7aGVpZ2h0fSAwIDAgY20gL0ltMCBEbyBRYDsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW1EaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkZvcm1UeXBlIiwgMSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiRm9ybSIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJUeXBlIiwgIlhPYmplY3QiKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiQkJveCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0XSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICBpZiAocm90YXRpb24pIHsKICAgICAgY29uc3QgbWF0cml4ID0gZ2V0Um90YXRpb25NYXRyaXgocm90YXRpb24sIHdpZHRoLCBoZWlnaHQpOwogICAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIk1hdHJpeCIsIG1hdHJpeCk7CiAgICB9CiAgICBjb25zdCBhcCA9IG5ldyBTdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICBhcC5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICByZXR1cm4gYXA7CiAgfQp9CmNsYXNzIEZpbGVBdHRhY2htZW50QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIGNvbnN0IGZpbGUgPSBuZXcgRmlsZVNwZWMoZGljdC5nZXQoIkZTIiksIHhyZWYpOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuRklMRUFUVEFDSE1FTlQ7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgdGhpcy5kYXRhLmZpbGUgPSBmaWxlLnNlcmlhbGl6YWJsZTsKICAgIGNvbnN0IG5hbWUgPSBkaWN0LmdldCgiTmFtZSIpOwogICAgdGhpcy5kYXRhLm5hbWUgPSBuYW1lIGluc3RhbmNlb2YgTmFtZSA/IHN0cmluZ1RvUERGU3RyaW5nKG5hbWUubmFtZSkgOiAiUHVzaFBpbiI7CiAgICBjb25zdCBmaWxsQWxwaGEgPSBkaWN0LmdldCgiY2EiKTsKICAgIHRoaXMuZGF0YS5maWxsQWxwaGEgPSB0eXBlb2YgZmlsbEFscGhhID09PSAibnVtYmVyIiAmJiBmaWxsQWxwaGEgPj0gMCAmJiBmaWxsQWxwaGEgPD0gMSA/IGZpbGxBbHBoYSA6IG51bGw7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9jYWxjdWxhdGVfbWQ1LmpzCgpjb25zdCBQQVJBTVMgPSB7CiAgZ2V0IHIoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJyIiwgbmV3IFVpbnQ4QXJyYXkoWzcsIDEyLCAxNywgMjIsIDcsIDEyLCAxNywgMjIsIDcsIDEyLCAxNywgMjIsIDcsIDEyLCAxNywgMjIsIDUsIDksIDE0LCAyMCwgNSwgOSwgMTQsIDIwLCA1LCA5LCAxNCwgMjAsIDUsIDksIDE0LCAyMCwgNCwgMTEsIDE2LCAyMywgNCwgMTEsIDE2LCAyMywgNCwgMTEsIDE2LCAyMywgNCwgMTEsIDE2LCAyMywgNiwgMTAsIDE1LCAyMSwgNiwgMTAsIDE1LCAyMSwgNiwgMTAsIDE1LCAyMSwgNiwgMTAsIDE1LCAyMV0pKTsKICB9LAogIGdldCBrKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiayIsIG5ldyBJbnQzMkFycmF5KFstNjgwODc2OTM2LCAtMzg5NTY0NTg2LCA2MDYxMDU4MTksIC0xMDQ0NTI1MzMwLCAtMTc2NDE4ODk3LCAxMjAwMDgwNDI2LCAtMTQ3MzIzMTM0MSwgLTQ1NzA1OTgzLCAxNzcwMDM1NDE2LCAtMTk1ODQxNDQxNywgLTQyMDYzLCAtMTk5MDQwNDE2MiwgMTgwNDYwMzY4MiwgLTQwMzQxMTAxLCAtMTUwMjAwMjI5MCwgMTIzNjUzNTMyOSwgLTE2NTc5NjUxMCwgLTEwNjk1MDE2MzIsIDY0MzcxNzcxMywgLTM3Mzg5NzMwMiwgLTcwMTU1ODY5MSwgMzgwMTYwODMsIC02NjA0NzgzMzUsIC00MDU1Mzc4NDgsIDU2ODQ0NjQzOCwgLTEwMTk4MDM2OTAsIC0xODczNjM5NjEsIDExNjM1MzE1MDEsIC0xNDQ0NjgxNDY3LCAtNTE0MDM3ODQsIDE3MzUzMjg0NzMsIC0xOTI2NjA3NzM0LCAtMzc4NTU4LCAtMjAyMjU3NDQ2MywgMTgzOTAzMDU2MiwgLTM1MzA5NTU2LCAtMTUzMDk5MjA2MCwgMTI3Mjg5MzM1MywgLTE1NTQ5NzYzMiwgLTEwOTQ3MzA2NDAsIDY4MTI3OTE3NCwgLTM1ODUzNzIyMiwgLTcyMjUyMTk3OSwgNzYwMjkxODksIC02NDAzNjQ0ODcsIC00MjE4MTU4MzUsIDUzMDc0MjUyMCwgLTk5NTMzODY1MSwgLTE5ODYzMDg0NCwgMTEyNjg5MTQxNSwgLTE0MTYzNTQ5MDUsIC01NzQzNDA1NSwgMTcwMDQ4NTU3MSwgLTE4OTQ5ODY2MDYsIC0xMDUxNTIzLCAtMjA1NDkyMjc5OSwgMTg3MzMxMzM1OSwgLTMwNjExNzQ0LCAtMTU2MDE5ODM4MCwgMTMwOTE1MTY0OSwgLTE0NTUyMzA3MCwgLTExMjAyMTAzNzksIDcxODc4NzI1OSwgLTM0MzQ4NTU1MV0pKTsKICB9Cn07CmZ1bmN0aW9uIGNhbGN1bGF0ZU1ENShkYXRhLCBvZmZzZXQsIGxlbmd0aCkgewogIGxldCBoMCA9IDE3MzI1ODQxOTMsCiAgICBoMSA9IC0yNzE3MzM4NzksCiAgICBoMiA9IC0xNzMyNTg0MTk0LAogICAgaDMgPSAyNzE3MzM4Nzg7CiAgY29uc3QgcGFkZGVkTGVuZ3RoID0gbGVuZ3RoICsgNzIgJiB+NjM7CiAgY29uc3QgcGFkZGVkID0gbmV3IFVpbnQ4QXJyYXkocGFkZGVkTGVuZ3RoKTsKICBsZXQgaSwgajsKICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIHBhZGRlZFtpXSA9IGRhdGFbb2Zmc2V0KytdOwogIH0KICBwYWRkZWRbaSsrXSA9IDB4ODA7CiAgY29uc3QgbiA9IHBhZGRlZExlbmd0aCAtIDg7CiAgaWYgKGkgPCBuKSB7CiAgICBpID0gbjsKICB9CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPDwgMyAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gNSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gMTMgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDIxICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+Pj4gMjkgJiAweGZmOwogIGkgKz0gMzsKICBjb25zdCB3ID0gbmV3IEludDMyQXJyYXkoMTYpOwogIGNvbnN0IHsKICAgIGssCiAgICByCiAgfSA9IFBBUkFNUzsKICBmb3IgKGkgPSAwOyBpIDwgcGFkZGVkTGVuZ3RoOykgewogICAgZm9yIChqID0gMDsgaiA8IDE2OyArK2osIGkgKz0gNCkgewogICAgICB3W2pdID0gcGFkZGVkW2ldIHwgcGFkZGVkW2kgKyAxXSA8PCA4IHwgcGFkZGVkW2kgKyAyXSA8PCAxNiB8IHBhZGRlZFtpICsgM10gPDwgMjQ7CiAgICB9CiAgICBsZXQgYSA9IGgwLAogICAgICBiID0gaDEsCiAgICAgIGMgPSBoMiwKICAgICAgZCA9IGgzLAogICAgICBmLAogICAgICBnOwogICAgZm9yIChqID0gMDsgaiA8IDY0OyArK2opIHsKICAgICAgaWYgKGogPCAxNikgewogICAgICAgIGYgPSBiICYgYyB8IH5iICYgZDsKICAgICAgICBnID0gajsKICAgICAgfSBlbHNlIGlmIChqIDwgMzIpIHsKICAgICAgICBmID0gZCAmIGIgfCB+ZCAmIGM7CiAgICAgICAgZyA9IDUgKiBqICsgMSAmIDE1OwogICAgICB9IGVsc2UgaWYgKGogPCA0OCkgewogICAgICAgIGYgPSBiIF4gYyBeIGQ7CiAgICAgICAgZyA9IDMgKiBqICsgNSAmIDE1OwogICAgICB9IGVsc2UgewogICAgICAgIGYgPSBjIF4gKGIgfCB+ZCk7CiAgICAgICAgZyA9IDcgKiBqICYgMTU7CiAgICAgIH0KICAgICAgY29uc3QgdG1wID0gZCwKICAgICAgICByb3RhdGVBcmcgPSBhICsgZiArIGtbal0gKyB3W2ddIHwgMCwKICAgICAgICByb3RhdGUgPSByW2pdOwogICAgICBkID0gYzsKICAgICAgYyA9IGI7CiAgICAgIGIgPSBiICsgKHJvdGF0ZUFyZyA8PCByb3RhdGUgfCByb3RhdGVBcmcgPj4+IDMyIC0gcm90YXRlKSB8IDA7CiAgICAgIGEgPSB0bXA7CiAgICB9CiAgICBoMCA9IGgwICsgYSB8IDA7CiAgICBoMSA9IGgxICsgYiB8IDA7CiAgICBoMiA9IGgyICsgYyB8IDA7CiAgICBoMyA9IGgzICsgZCB8IDA7CiAgfQogIHJldHVybiBuZXcgVWludDhBcnJheShbaDAgJiAweEZGLCBoMCA+PiA4ICYgMHhGRiwgaDAgPj4gMTYgJiAweEZGLCBoMCA+Pj4gMjQgJiAweEZGLCBoMSAmIDB4RkYsIGgxID4+IDggJiAweEZGLCBoMSA+PiAxNiAmIDB4RkYsIGgxID4+PiAyNCAmIDB4RkYsIGgyICYgMHhGRiwgaDIgPj4gOCAmIDB4RkYsIGgyID4+IDE2ICYgMHhGRiwgaDIgPj4+IDI0ICYgMHhGRiwgaDMgJiAweEZGLCBoMyA+PiA4ICYgMHhGRiwgaDMgPj4gMTYgJiAweEZGLCBoMyA+Pj4gMjQgJiAweEZGXSk7Cn0KCjsvLyAuL3NyYy9jb3JlL2RhdGFzZXRfcmVhZGVyLmpzCgoKCmZ1bmN0aW9uIGRlY29kZVN0cmluZyhzdHIpIHsKICB0cnkgewogICAgcmV0dXJuIHN0cmluZ1RvVVRGOFN0cmluZyhzdHIpOwogIH0gY2F0Y2ggKGV4KSB7CiAgICB3YXJuKGBVVEYtOCBkZWNvZGluZyBmYWlsZWQ6ICIke2V4fSIuYCk7CiAgICByZXR1cm4gc3RyOwogIH0KfQpjbGFzcyBEYXRhc2V0WE1MUGFyc2VyIGV4dGVuZHMgU2ltcGxlWE1MUGFyc2VyIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcihvcHRpb25zKTsKICAgIHRoaXMubm9kZSA9IG51bGw7CiAgfQogIG9uRW5kRWxlbWVudChuYW1lKSB7CiAgICBjb25zdCBub2RlID0gc3VwZXIub25FbmRFbGVtZW50KG5hbWUpOwogICAgaWYgKG5vZGUgJiYgbmFtZSA9PT0gInhmYTpkYXRhc2V0cyIpIHsKICAgICAgdGhpcy5ub2RlID0gbm9kZTsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJBYm9ydGluZyBEYXRhc2V0WE1MUGFyc2VyLiIpOwogICAgfQogIH0KfQpjbGFzcyBEYXRhc2V0UmVhZGVyIHsKICBjb25zdHJ1Y3RvcihkYXRhKSB7CiAgICBpZiAoZGF0YS5kYXRhc2V0cykgewogICAgICB0aGlzLm5vZGUgPSBuZXcgU2ltcGxlWE1MUGFyc2VyKHsKICAgICAgICBoYXNBdHRyaWJ1dGVzOiB0cnVlCiAgICAgIH0pLnBhcnNlRnJvbVN0cmluZyhkYXRhLmRhdGFzZXRzKS5kb2N1bWVudEVsZW1lbnQ7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRGF0YXNldFhNTFBhcnNlcih7CiAgICAgICAgaGFzQXR0cmlidXRlczogdHJ1ZQogICAgICB9KTsKICAgICAgdHJ5IHsKICAgICAgICBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKGRhdGFbInhkcDp4ZHAiXSk7CiAgICAgIH0gY2F0Y2gge30KICAgICAgdGhpcy5ub2RlID0gcGFyc2VyLm5vZGU7CiAgICB9CiAgfQogIGdldFZhbHVlKHBhdGgpIHsKICAgIGlmICghdGhpcy5ub2RlIHx8ICFwYXRoKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIGNvbnN0IG5vZGUgPSB0aGlzLm5vZGUuc2VhcmNoTm9kZShwYXJzZVhGQVBhdGgocGF0aCksIDApOwogICAgaWYgKCFub2RlKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIGNvbnN0IGZpcnN0ID0gbm9kZS5maXJzdENoaWxkOwogICAgaWYgKGZpcnN0Py5ub2RlTmFtZSA9PT0gInZhbHVlIikgewogICAgICByZXR1cm4gbm9kZS5jaGlsZHJlbi5tYXAoY2hpbGQgPT4gZGVjb2RlU3RyaW5nKGNoaWxkLnRleHRDb250ZW50KSk7CiAgICB9CiAgICByZXR1cm4gZGVjb2RlU3RyaW5nKG5vZGUudGV4dENvbnRlbnQpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvaW50ZXJzZWN0b3IuanMKY2xhc3MgU2luZ2xlSW50ZXJzZWN0b3IgewogICNhbm5vdGF0aW9uOwogIG1pblggPSBJbmZpbml0eTsKICBtaW5ZID0gSW5maW5pdHk7CiAgbWF4WCA9IC1JbmZpbml0eTsKICBtYXhZID0gLUluZmluaXR5OwogICNxdWFkUG9pbnRzID0gbnVsbDsKICAjdGV4dCA9IFtdOwogICNleHRyYUNoYXJzID0gW107CiAgI2xhc3RJbnRlcnNlY3RpbmdRdWFkSW5kZXggPSAtMTsKICAjY2FuVGFrZUV4dHJhQ2hhcnMgPSBmYWxzZTsKICBjb25zdHJ1Y3Rvcihhbm5vdGF0aW9uKSB7CiAgICB0aGlzLiNhbm5vdGF0aW9uID0gYW5ub3RhdGlvbjsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSBhbm5vdGF0aW9uLmRhdGEucXVhZFBvaW50czsKICAgIGlmICghcXVhZFBvaW50cykgewogICAgICBbdGhpcy5taW5YLCB0aGlzLm1pblksIHRoaXMubWF4WCwgdGhpcy5tYXhZXSA9IGFubm90YXRpb24uZGF0YS5yZWN0OwogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBxdWFkUG9pbnRzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDgpIHsKICAgICAgdGhpcy5taW5YID0gTWF0aC5taW4odGhpcy5taW5YLCBxdWFkUG9pbnRzW2ldKTsKICAgICAgdGhpcy5tYXhYID0gTWF0aC5tYXgodGhpcy5tYXhYLCBxdWFkUG9pbnRzW2kgKyAyXSk7CiAgICAgIHRoaXMubWluWSA9IE1hdGgubWluKHRoaXMubWluWSwgcXVhZFBvaW50c1tpICsgNV0pOwogICAgICB0aGlzLm1heFkgPSBNYXRoLm1heCh0aGlzLm1heFksIHF1YWRQb2ludHNbaSArIDFdKTsKICAgIH0KICAgIGlmIChxdWFkUG9pbnRzLmxlbmd0aCA+IDgpIHsKICAgICAgdGhpcy4jcXVhZFBvaW50cyA9IHF1YWRQb2ludHM7CiAgICB9CiAgfQogICNpbnRlcnNlY3RzKHgsIHkpIHsKICAgIGlmICh0aGlzLm1pblggPj0geCB8fCB0aGlzLm1heFggPD0geCB8fCB0aGlzLm1pblkgPj0geSB8fCB0aGlzLm1heFkgPD0geSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBxdWFkUG9pbnRzID0gdGhpcy4jcXVhZFBvaW50czsKICAgIGlmICghcXVhZFBvaW50cykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLiNsYXN0SW50ZXJzZWN0aW5nUXVhZEluZGV4ID49IDApIHsKICAgICAgY29uc3QgaSA9IHRoaXMuI2xhc3RJbnRlcnNlY3RpbmdRdWFkSW5kZXg7CiAgICAgIGlmICghKHF1YWRQb2ludHNbaV0gPj0geCB8fCBxdWFkUG9pbnRzW2kgKyAyXSA8PSB4IHx8IHF1YWRQb2ludHNbaSArIDVdID49IHkgfHwgcXVhZFBvaW50c1tpICsgMV0gPD0geSkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICB0aGlzLiNsYXN0SW50ZXJzZWN0aW5nUXVhZEluZGV4ID0gLTE7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBxdWFkUG9pbnRzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDgpIHsKICAgICAgaWYgKCEocXVhZFBvaW50c1tpXSA+PSB4IHx8IHF1YWRQb2ludHNbaSArIDJdIDw9IHggfHwgcXVhZFBvaW50c1tpICsgNV0gPj0geSB8fCBxdWFkUG9pbnRzW2kgKyAxXSA8PSB5KSkgewogICAgICAgIHRoaXMuI2xhc3RJbnRlcnNlY3RpbmdRdWFkSW5kZXggPSBpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGFkZEdseXBoKHgsIHksIGdseXBoKSB7CiAgICBpZiAoIXRoaXMuI2ludGVyc2VjdHMoeCwgeSkpIHsKICAgICAgdGhpcy5kaXNhYmxlRXh0cmFDaGFycygpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy4jZXh0cmFDaGFycy5sZW5ndGggPiAwKSB7CiAgICAgIHRoaXMuI3RleHQucHVzaCh0aGlzLiNleHRyYUNoYXJzLmpvaW4oIiIpKTsKICAgICAgdGhpcy4jZXh0cmFDaGFycy5sZW5ndGggPSAwOwogICAgfQogICAgdGhpcy4jdGV4dC5wdXNoKGdseXBoKTsKICAgIHRoaXMuI2NhblRha2VFeHRyYUNoYXJzID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBhZGRFeHRyYUNoYXIoY2hhcikgewogICAgaWYgKHRoaXMuI2NhblRha2VFeHRyYUNoYXJzKSB7CiAgICAgIHRoaXMuI2V4dHJhQ2hhcnMucHVzaChjaGFyKTsKICAgIH0KICB9CiAgZGlzYWJsZUV4dHJhQ2hhcnMoKSB7CiAgICBpZiAoIXRoaXMuI2NhblRha2VFeHRyYUNoYXJzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2NhblRha2VFeHRyYUNoYXJzID0gZmFsc2U7CiAgICB0aGlzLiNleHRyYUNoYXJzLmxlbmd0aCA9IDA7CiAgfQogIHNldFRleHQoKSB7CiAgICB0aGlzLiNhbm5vdGF0aW9uLmRhdGEub3ZlcmxhaWRUZXh0ID0gdGhpcy4jdGV4dC5qb2luKCIiKTsKICB9Cn0KY29uc3QgU1RFUFMgPSA2NDsKY2xhc3MgSW50ZXJzZWN0b3IgewogICNpbnRlcnNlY3RvcnMgPSBbXTsKICAjZ3JpZCA9IFtdOwogICNtaW5YOwogICNtYXhYOwogICNtaW5ZOwogICNtYXhZOwogICNpbnZYUmF0aW87CiAgI2ludllSYXRpbzsKICBjb25zdHJ1Y3Rvcihhbm5vdGF0aW9ucykgewogICAgbGV0IG1pblggPSBJbmZpbml0eTsKICAgIGxldCBtaW5ZID0gSW5maW5pdHk7CiAgICBsZXQgbWF4WCA9IC1JbmZpbml0eTsKICAgIGxldCBtYXhZID0gLUluZmluaXR5OwogICAgY29uc3QgaW50ZXJzZWN0b3JzID0gdGhpcy4jaW50ZXJzZWN0b3JzOwogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGlmICghYW5ub3RhdGlvbi5kYXRhLnF1YWRQb2ludHMgJiYgIWFubm90YXRpb24uZGF0YS5yZWN0KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaW50ZXJzZWN0b3IgPSBuZXcgU2luZ2xlSW50ZXJzZWN0b3IoYW5ub3RhdGlvbik7CiAgICAgIGludGVyc2VjdG9ycy5wdXNoKGludGVyc2VjdG9yKTsKICAgICAgbWluWCA9IE1hdGgubWluKG1pblgsIGludGVyc2VjdG9yLm1pblgpOwogICAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgaW50ZXJzZWN0b3IubWluWSk7CiAgICAgIG1heFggPSBNYXRoLm1heChtYXhYLCBpbnRlcnNlY3Rvci5tYXhYKTsKICAgICAgbWF4WSA9IE1hdGgubWF4KG1heFksIGludGVyc2VjdG9yLm1heFkpOwogICAgfQogICAgdGhpcy4jbWluWCA9IG1pblg7CiAgICB0aGlzLiNtaW5ZID0gbWluWTsKICAgIHRoaXMuI21heFggPSBtYXhYOwogICAgdGhpcy4jbWF4WSA9IG1heFk7CiAgICB0aGlzLiNpbnZYUmF0aW8gPSAoU1RFUFMgLSAxKSAvIChtYXhYIC0gbWluWCk7CiAgICB0aGlzLiNpbnZZUmF0aW8gPSAoU1RFUFMgLSAxKSAvIChtYXhZIC0gbWluWSk7CiAgICBmb3IgKGNvbnN0IGludGVyc2VjdG9yIG9mIGludGVyc2VjdG9ycykgewogICAgICBjb25zdCBpTWluID0gdGhpcy4jZ2V0R3JpZEluZGV4KGludGVyc2VjdG9yLm1pblgsIGludGVyc2VjdG9yLm1pblkpOwogICAgICBjb25zdCBpTWF4ID0gdGhpcy4jZ2V0R3JpZEluZGV4KGludGVyc2VjdG9yLm1heFgsIGludGVyc2VjdG9yLm1heFkpOwogICAgICBjb25zdCB3ID0gKGlNYXggLSBpTWluKSAlIFNURVBTOwogICAgICBjb25zdCBoID0gTWF0aC5mbG9vcigoaU1heCAtIGlNaW4pIC8gU1RFUFMpOwogICAgICBmb3IgKGxldCBpID0gaU1pbjsgaSA8PSBpTWluICsgaCAqIFNURVBTOyBpICs9IFNURVBTKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gdzsgaisrKSB7CiAgICAgICAgICBsZXQgZXhpc3RpbmcgPSB0aGlzLiNncmlkW2kgKyBqXTsKICAgICAgICAgIGlmICghZXhpc3RpbmcpIHsKICAgICAgICAgICAgdGhpcy4jZ3JpZFtpICsgal0gPSBleGlzdGluZyA9IFtdOwogICAgICAgICAgfQogICAgICAgICAgZXhpc3RpbmcucHVzaChpbnRlcnNlY3Rvcik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogICNnZXRHcmlkSW5kZXgoeCwgeSkgewogICAgY29uc3QgaSA9IE1hdGguZmxvb3IoKHggLSB0aGlzLiNtaW5YKSAqIHRoaXMuI2ludlhSYXRpbyk7CiAgICBjb25zdCBqID0gTWF0aC5mbG9vcigoeSAtIHRoaXMuI21pblkpICogdGhpcy4jaW52WVJhdGlvKTsKICAgIHJldHVybiBpICsgaiAqIFNURVBTOwogIH0KICBhZGRHbHlwaCh0cmFuc2Zvcm0sIHdpZHRoLCBoZWlnaHQsIGdseXBoKSB7CiAgICBjb25zdCB4ID0gdHJhbnNmb3JtWzRdICsgd2lkdGggLyAyOwogICAgY29uc3QgeSA9IHRyYW5zZm9ybVs1XSArIGhlaWdodCAvIDI7CiAgICBpZiAoeCA8IHRoaXMuI21pblggfHwgeSA8IHRoaXMuI21pblkgfHwgeCA+IHRoaXMuI21heFggfHwgeSA+IHRoaXMuI21heFkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgaW50ZXJzZWN0b3JzID0gdGhpcy4jZ3JpZFt0aGlzLiNnZXRHcmlkSW5kZXgoeCwgeSldOwogICAgaWYgKCFpbnRlcnNlY3RvcnMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBpbnRlcnNlY3RvciBvZiBpbnRlcnNlY3RvcnMpIHsKICAgICAgaW50ZXJzZWN0b3IuYWRkR2x5cGgoeCwgeSwgZ2x5cGgpOwogICAgfQogIH0KICBhZGRFeHRyYUNoYXIoY2hhcikgewogICAgZm9yIChjb25zdCBpbnRlcnNlY3RvciBvZiB0aGlzLiNpbnRlcnNlY3RvcnMpIHsKICAgICAgaW50ZXJzZWN0b3IuYWRkRXh0cmFDaGFyKGNoYXIpOwogICAgfQogIH0KICBzZXRUZXh0KCkgewogICAgZm9yIChjb25zdCBpbnRlcnNlY3RvciBvZiB0aGlzLiNpbnRlcnNlY3RvcnMpIHsKICAgICAgaW50ZXJzZWN0b3Iuc2V0VGV4dCgpOwogICAgfQogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2FsY3VsYXRlX3NoYV9vdGhlci5qcwoKY2xhc3MgV29yZDY0IHsKICBjb25zdHJ1Y3RvcihoaWdoSW50ZWdlciwgbG93SW50ZWdlcikgewogICAgdGhpcy5oaWdoID0gaGlnaEludGVnZXIgfCAwOwogICAgdGhpcy5sb3cgPSBsb3dJbnRlZ2VyIHwgMDsKICB9CiAgYW5kKHdvcmQpIHsKICAgIHRoaXMuaGlnaCAmPSB3b3JkLmhpZ2g7CiAgICB0aGlzLmxvdyAmPSB3b3JkLmxvdzsKICB9CiAgeG9yKHdvcmQpIHsKICAgIHRoaXMuaGlnaCBePSB3b3JkLmhpZ2g7CiAgICB0aGlzLmxvdyBePSB3b3JkLmxvdzsKICB9CiAgc2hpZnRSaWdodChwbGFjZXMpIHsKICAgIGlmIChwbGFjZXMgPj0gMzIpIHsKICAgICAgdGhpcy5sb3cgPSB0aGlzLmhpZ2ggPj4+IHBsYWNlcyAtIDMyIHwgMDsKICAgICAgdGhpcy5oaWdoID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubG93ID0gdGhpcy5sb3cgPj4+IHBsYWNlcyB8IHRoaXMuaGlnaCA8PCAzMiAtIHBsYWNlczsKICAgICAgdGhpcy5oaWdoID0gdGhpcy5oaWdoID4+PiBwbGFjZXMgfCAwOwogICAgfQogIH0KICByb3RhdGVSaWdodChwbGFjZXMpIHsKICAgIGxldCBsb3csIGhpZ2g7CiAgICBpZiAocGxhY2VzICYgMzIpIHsKICAgICAgaGlnaCA9IHRoaXMubG93OwogICAgICBsb3cgPSB0aGlzLmhpZ2g7CiAgICB9IGVsc2UgewogICAgICBsb3cgPSB0aGlzLmxvdzsKICAgICAgaGlnaCA9IHRoaXMuaGlnaDsKICAgIH0KICAgIHBsYWNlcyAmPSAzMTsKICAgIHRoaXMubG93ID0gbG93ID4+PiBwbGFjZXMgfCBoaWdoIDw8IDMyIC0gcGxhY2VzOwogICAgdGhpcy5oaWdoID0gaGlnaCA+Pj4gcGxhY2VzIHwgbG93IDw8IDMyIC0gcGxhY2VzOwogIH0KICBub3QoKSB7CiAgICB0aGlzLmhpZ2ggPSB+dGhpcy5oaWdoOwogICAgdGhpcy5sb3cgPSB+dGhpcy5sb3c7CiAgfQogIGFkZCh3b3JkKSB7CiAgICBjb25zdCBsb3dBZGQgPSAodGhpcy5sb3cgPj4+IDApICsgKHdvcmQubG93ID4+PiAwKTsKICAgIGxldCBoaWdoQWRkID0gKHRoaXMuaGlnaCA+Pj4gMCkgKyAod29yZC5oaWdoID4+PiAwKTsKICAgIGlmIChsb3dBZGQgPiAweGZmZmZmZmZmKSB7CiAgICAgIGhpZ2hBZGQgKz0gMTsKICAgIH0KICAgIHRoaXMubG93ID0gbG93QWRkIHwgMDsKICAgIHRoaXMuaGlnaCA9IGhpZ2hBZGQgfCAwOwogIH0KICBjb3B5VG8oYnl0ZXMsIG9mZnNldCkgewogICAgYnl0ZXNbb2Zmc2V0XSA9IHRoaXMuaGlnaCA+Pj4gMjQgJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgMV0gPSB0aGlzLmhpZ2ggPj4gMTYgJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgMl0gPSB0aGlzLmhpZ2ggPj4gOCAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyAzXSA9IHRoaXMuaGlnaCAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyA0XSA9IHRoaXMubG93ID4+PiAyNCAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyA1XSA9IHRoaXMubG93ID4+IDE2ICYgMHhmZjsKICAgIGJ5dGVzW29mZnNldCArIDZdID0gdGhpcy5sb3cgPj4gOCAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyA3XSA9IHRoaXMubG93ICYgMHhmZjsKICB9CiAgYXNzaWduKHdvcmQpIHsKICAgIHRoaXMuaGlnaCA9IHdvcmQuaGlnaDsKICAgIHRoaXMubG93ID0gd29yZC5sb3c7CiAgfQp9CmNvbnN0IGNhbGN1bGF0ZV9zaGFfb3RoZXJfUEFSQU1TID0gewogIGdldCBrKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiayIsIFtuZXcgV29yZDY0KDB4NDI4YTJmOTgsIDB4ZDcyOGFlMjIpLCBuZXcgV29yZDY0KDB4NzEzNzQ0OTEsIDB4MjNlZjY1Y2QpLCBuZXcgV29yZDY0KDB4YjVjMGZiY2YsIDB4ZWM0ZDNiMmYpLCBuZXcgV29yZDY0KDB4ZTliNWRiYTUsIDB4ODE4OWRiYmMpLCBuZXcgV29yZDY0KDB4Mzk1NmMyNWIsIDB4ZjM0OGI1MzgpLCBuZXcgV29yZDY0KDB4NTlmMTExZjEsIDB4YjYwNWQwMTkpLCBuZXcgV29yZDY0KDB4OTIzZjgyYTQsIDB4YWYxOTRmOWIpLCBuZXcgV29yZDY0KDB4YWIxYzVlZDUsIDB4ZGE2ZDgxMTgpLCBuZXcgV29yZDY0KDB4ZDgwN2FhOTgsIDB4YTMwMzAyNDIpLCBuZXcgV29yZDY0KDB4MTI4MzViMDEsIDB4NDU3MDZmYmUpLCBuZXcgV29yZDY0KDB4MjQzMTg1YmUsIDB4NGVlNGIyOGMpLCBuZXcgV29yZDY0KDB4NTUwYzdkYzMsIDB4ZDVmZmI0ZTIpLCBuZXcgV29yZDY0KDB4NzJiZTVkNzQsIDB4ZjI3Yjg5NmYpLCBuZXcgV29yZDY0KDB4ODBkZWIxZmUsIDB4M2IxNjk2YjEpLCBuZXcgV29yZDY0KDB4OWJkYzA2YTcsIDB4MjVjNzEyMzUpLCBuZXcgV29yZDY0KDB4YzE5YmYxNzQsIDB4Y2Y2OTI2OTQpLCBuZXcgV29yZDY0KDB4ZTQ5YjY5YzEsIDB4OWVmMTRhZDIpLCBuZXcgV29yZDY0KDB4ZWZiZTQ3ODYsIDB4Mzg0ZjI1ZTMpLCBuZXcgV29yZDY0KDB4MGZjMTlkYzYsIDB4OGI4Y2Q1YjUpLCBuZXcgV29yZDY0KDB4MjQwY2ExY2MsIDB4NzdhYzljNjUpLCBuZXcgV29yZDY0KDB4MmRlOTJjNmYsIDB4NTkyYjAyNzUpLCBuZXcgV29yZDY0KDB4NGE3NDg0YWEsIDB4NmVhNmU0ODMpLCBuZXcgV29yZDY0KDB4NWNiMGE5ZGMsIDB4YmQ0MWZiZDQpLCBuZXcgV29yZDY0KDB4NzZmOTg4ZGEsIDB4ODMxMTUzYjUpLCBuZXcgV29yZDY0KDB4OTgzZTUxNTIsIDB4ZWU2NmRmYWIpLCBuZXcgV29yZDY0KDB4YTgzMWM2NmQsIDB4MmRiNDMyMTApLCBuZXcgV29yZDY0KDB4YjAwMzI3YzgsIDB4OThmYjIxM2YpLCBuZXcgV29yZDY0KDB4YmY1OTdmYzcsIDB4YmVlZjBlZTQpLCBuZXcgV29yZDY0KDB4YzZlMDBiZjMsIDB4M2RhODhmYzIpLCBuZXcgV29yZDY0KDB4ZDVhNzkxNDcsIDB4OTMwYWE3MjUpLCBuZXcgV29yZDY0KDB4MDZjYTYzNTEsIDB4ZTAwMzgyNmYpLCBuZXcgV29yZDY0KDB4MTQyOTI5NjcsIDB4MGEwZTZlNzApLCBuZXcgV29yZDY0KDB4MjdiNzBhODUsIDB4NDZkMjJmZmMpLCBuZXcgV29yZDY0KDB4MmUxYjIxMzgsIDB4NWMyNmM5MjYpLCBuZXcgV29yZDY0KDB4NGQyYzZkZmMsIDB4NWFjNDJhZWQpLCBuZXcgV29yZDY0KDB4NTMzODBkMTMsIDB4OWQ5NWIzZGYpLCBuZXcgV29yZDY0KDB4NjUwYTczNTQsIDB4OGJhZjYzZGUpLCBuZXcgV29yZDY0KDB4NzY2YTBhYmIsIDB4M2M3N2IyYTgpLCBuZXcgV29yZDY0KDB4ODFjMmM5MmUsIDB4NDdlZGFlZTYpLCBuZXcgV29yZDY0KDB4OTI3MjJjODUsIDB4MTQ4MjM1M2IpLCBuZXcgV29yZDY0KDB4YTJiZmU4YTEsIDB4NGNmMTAzNjQpLCBuZXcgV29yZDY0KDB4YTgxYTY2NGIsIDB4YmM0MjMwMDEpLCBuZXcgV29yZDY0KDB4YzI0YjhiNzAsIDB4ZDBmODk3OTEpLCBuZXcgV29yZDY0KDB4Yzc2YzUxYTMsIDB4MDY1NGJlMzApLCBuZXcgV29yZDY0KDB4ZDE5MmU4MTksIDB4ZDZlZjUyMTgpLCBuZXcgV29yZDY0KDB4ZDY5OTA2MjQsIDB4NTU2NWE5MTApLCBuZXcgV29yZDY0KDB4ZjQwZTM1ODUsIDB4NTc3MTIwMmEpLCBuZXcgV29yZDY0KDB4MTA2YWEwNzAsIDB4MzJiYmQxYjgpLCBuZXcgV29yZDY0KDB4MTlhNGMxMTYsIDB4YjhkMmQwYzgpLCBuZXcgV29yZDY0KDB4MWUzNzZjMDgsIDB4NTE0MWFiNTMpLCBuZXcgV29yZDY0KDB4Mjc0ODc3NGMsIDB4ZGY4ZWViOTkpLCBuZXcgV29yZDY0KDB4MzRiMGJjYjUsIDB4ZTE5YjQ4YTgpLCBuZXcgV29yZDY0KDB4MzkxYzBjYjMsIDB4YzVjOTVhNjMpLCBuZXcgV29yZDY0KDB4NGVkOGFhNGEsIDB4ZTM0MThhY2IpLCBuZXcgV29yZDY0KDB4NWI5Y2NhNGYsIDB4Nzc2M2UzNzMpLCBuZXcgV29yZDY0KDB4NjgyZTZmZjMsIDB4ZDZiMmI4YTMpLCBuZXcgV29yZDY0KDB4NzQ4ZjgyZWUsIDB4NWRlZmIyZmMpLCBuZXcgV29yZDY0KDB4NzhhNTYzNmYsIDB4NDMxNzJmNjApLCBuZXcgV29yZDY0KDB4ODRjODc4MTQsIDB4YTFmMGFiNzIpLCBuZXcgV29yZDY0KDB4OGNjNzAyMDgsIDB4MWE2NDM5ZWMpLCBuZXcgV29yZDY0KDB4OTBiZWZmZmEsIDB4MjM2MzFlMjgpLCBuZXcgV29yZDY0KDB4YTQ1MDZjZWIsIDB4ZGU4MmJkZTkpLCBuZXcgV29yZDY0KDB4YmVmOWEzZjcsIDB4YjJjNjc5MTUpLCBuZXcgV29yZDY0KDB4YzY3MTc4ZjIsIDB4ZTM3MjUzMmIpLCBuZXcgV29yZDY0KDB4Y2EyNzNlY2UsIDB4ZWEyNjYxOWMpLCBuZXcgV29yZDY0KDB4ZDE4NmI4YzcsIDB4MjFjMGMyMDcpLCBuZXcgV29yZDY0KDB4ZWFkYTdkZDYsIDB4Y2RlMGViMWUpLCBuZXcgV29yZDY0KDB4ZjU3ZDRmN2YsIDB4ZWU2ZWQxNzgpLCBuZXcgV29yZDY0KDB4MDZmMDY3YWEsIDB4NzIxNzZmYmEpLCBuZXcgV29yZDY0KDB4MGE2MzdkYzUsIDB4YTJjODk4YTYpLCBuZXcgV29yZDY0KDB4MTEzZjk4MDQsIDB4YmVmOTBkYWUpLCBuZXcgV29yZDY0KDB4MWI3MTBiMzUsIDB4MTMxYzQ3MWIpLCBuZXcgV29yZDY0KDB4MjhkYjc3ZjUsIDB4MjMwNDdkODQpLCBuZXcgV29yZDY0KDB4MzJjYWFiN2IsIDB4NDBjNzI0OTMpLCBuZXcgV29yZDY0KDB4M2M5ZWJlMGEsIDB4MTVjOWJlYmMpLCBuZXcgV29yZDY0KDB4NDMxZDY3YzQsIDB4OWMxMDBkNGMpLCBuZXcgV29yZDY0KDB4NGNjNWQ0YmUsIDB4Y2IzZTQyYjYpLCBuZXcgV29yZDY0KDB4NTk3ZjI5OWMsIDB4ZmM2NTdlMmEpLCBuZXcgV29yZDY0KDB4NWZjYjZmYWIsIDB4M2FkNmZhZWMpLCBuZXcgV29yZDY0KDB4NmM0NDE5OGMsIDB4NGE0NzU4MTcpXSk7CiAgfQp9OwpmdW5jdGlvbiBjaChyZXN1bHQsIHgsIHksIHosIHRtcCkgewogIHJlc3VsdC5hc3NpZ24oeCk7CiAgcmVzdWx0LmFuZCh5KTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5ub3QoKTsKICB0bXAuYW5kKHopOwogIHJlc3VsdC54b3IodG1wKTsKfQpmdW5jdGlvbiBtYWoocmVzdWx0LCB4LCB5LCB6LCB0bXApIHsKICByZXN1bHQuYXNzaWduKHgpOwogIHJlc3VsdC5hbmQoeSk7CiAgdG1wLmFzc2lnbih4KTsKICB0bXAuYW5kKHopOwogIHJlc3VsdC54b3IodG1wKTsKICB0bXAuYXNzaWduKHkpOwogIHRtcC5hbmQoeik7CiAgcmVzdWx0Lnhvcih0bXApOwp9CmZ1bmN0aW9uIHNpZ21hKHJlc3VsdCwgeCwgdG1wKSB7CiAgcmVzdWx0LmFzc2lnbih4KTsKICByZXN1bHQucm90YXRlUmlnaHQoMjgpOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnJvdGF0ZVJpZ2h0KDM0KTsKICByZXN1bHQueG9yKHRtcCk7CiAgdG1wLmFzc2lnbih4KTsKICB0bXAucm90YXRlUmlnaHQoMzkpOwogIHJlc3VsdC54b3IodG1wKTsKfQpmdW5jdGlvbiBzaWdtYVByaW1lKHJlc3VsdCwgeCwgdG1wKSB7CiAgcmVzdWx0LmFzc2lnbih4KTsKICByZXN1bHQucm90YXRlUmlnaHQoMTQpOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnJvdGF0ZVJpZ2h0KDE4KTsKICByZXN1bHQueG9yKHRtcCk7CiAgdG1wLmFzc2lnbih4KTsKICB0bXAucm90YXRlUmlnaHQoNDEpOwogIHJlc3VsdC54b3IodG1wKTsKfQpmdW5jdGlvbiBsaXR0bGVTaWdtYShyZXN1bHQsIHgsIHRtcCkgewogIHJlc3VsdC5hc3NpZ24oeCk7CiAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDEpOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnJvdGF0ZVJpZ2h0KDgpOwogIHJlc3VsdC54b3IodG1wKTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5zaGlmdFJpZ2h0KDcpOwogIHJlc3VsdC54b3IodG1wKTsKfQpmdW5jdGlvbiBsaXR0bGVTaWdtYVByaW1lKHJlc3VsdCwgeCwgdG1wKSB7CiAgcmVzdWx0LmFzc2lnbih4KTsKICByZXN1bHQucm90YXRlUmlnaHQoMTkpOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnJvdGF0ZVJpZ2h0KDYxKTsKICByZXN1bHQueG9yKHRtcCk7CiAgdG1wLmFzc2lnbih4KTsKICB0bXAuc2hpZnRSaWdodCg2KTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlU0hBNTEyKGRhdGEsIG9mZnNldCwgbGVuZ3RoLCBtb2RlMzg0ID0gZmFsc2UpIHsKICBsZXQgaDAsIGgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGg3OwogIGlmICghbW9kZTM4NCkgewogICAgaDAgPSBuZXcgV29yZDY0KDB4NmEwOWU2NjcsIDB4ZjNiY2M5MDgpOwogICAgaDEgPSBuZXcgV29yZDY0KDB4YmI2N2FlODUsIDB4ODRjYWE3M2IpOwogICAgaDIgPSBuZXcgV29yZDY0KDB4M2M2ZWYzNzIsIDB4ZmU5NGY4MmIpOwogICAgaDMgPSBuZXcgV29yZDY0KDB4YTU0ZmY1M2EsIDB4NWYxZDM2ZjEpOwogICAgaDQgPSBuZXcgV29yZDY0KDB4NTEwZTUyN2YsIDB4YWRlNjgyZDEpOwogICAgaDUgPSBuZXcgV29yZDY0KDB4OWIwNTY4OGMsIDB4MmIzZTZjMWYpOwogICAgaDYgPSBuZXcgV29yZDY0KDB4MWY4M2Q5YWIsIDB4ZmI0MWJkNmIpOwogICAgaDcgPSBuZXcgV29yZDY0KDB4NWJlMGNkMTksIDB4MTM3ZTIxNzkpOwogIH0gZWxzZSB7CiAgICBoMCA9IG5ldyBXb3JkNjQoMHhjYmJiOWQ1ZCwgMHhjMTA1OWVkOCk7CiAgICBoMSA9IG5ldyBXb3JkNjQoMHg2MjlhMjkyYSwgMHgzNjdjZDUwNyk7CiAgICBoMiA9IG5ldyBXb3JkNjQoMHg5MTU5MDE1YSwgMHgzMDcwZGQxNyk7CiAgICBoMyA9IG5ldyBXb3JkNjQoMHgxNTJmZWNkOCwgMHhmNzBlNTkzOSk7CiAgICBoNCA9IG5ldyBXb3JkNjQoMHg2NzMzMjY2NywgMHhmZmMwMGIzMSk7CiAgICBoNSA9IG5ldyBXb3JkNjQoMHg4ZWI0NGE4NywgMHg2ODU4MTUxMSk7CiAgICBoNiA9IG5ldyBXb3JkNjQoMHhkYjBjMmUwZCwgMHg2NGY5OGZhNyk7CiAgICBoNyA9IG5ldyBXb3JkNjQoMHg0N2I1NDgxZCwgMHhiZWZhNGZhNCk7CiAgfQogIGNvbnN0IHBhZGRlZExlbmd0aCA9IE1hdGguY2VpbCgobGVuZ3RoICsgMTcpIC8gMTI4KSAqIDEyODsKICBjb25zdCBwYWRkZWQgPSBuZXcgVWludDhBcnJheShwYWRkZWRMZW5ndGgpOwogIGxldCBpLCBqOwogIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgcGFkZGVkW2ldID0gZGF0YVtvZmZzZXQrK107CiAgfQogIHBhZGRlZFtpKytdID0gMHg4MDsKICBjb25zdCBuID0gcGFkZGVkTGVuZ3RoIC0gMTY7CiAgaWYgKGkgPCBuKSB7CiAgICBpID0gbjsKICB9CiAgaSArPSAxMTsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+Pj4gMjkgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDIxICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAxMyAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gNSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPDwgMyAmIDB4ZmY7CiAgY29uc3QgdyA9IG5ldyBBcnJheSg4MCk7CiAgZm9yIChpID0gMDsgaSA8IDgwOyBpKyspIHsKICAgIHdbaV0gPSBuZXcgV29yZDY0KDAsIDApOwogIH0KICBjb25zdCB7CiAgICBrCiAgfSA9IGNhbGN1bGF0ZV9zaGFfb3RoZXJfUEFSQU1TOwogIGxldCBhID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgIGIgPSBuZXcgV29yZDY0KDAsIDApLAogICAgYyA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgbGV0IGQgPSBuZXcgV29yZDY0KDAsIDApLAogICAgZSA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICBmID0gbmV3IFdvcmQ2NCgwLCAwKTsKICBsZXQgZyA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICBoID0gbmV3IFdvcmQ2NCgwLCAwKTsKICBjb25zdCB0MSA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICB0MiA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgY29uc3QgdG1wMSA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICB0bXAyID0gbmV3IFdvcmQ2NCgwLCAwKTsKICBsZXQgdG1wMzsKICBmb3IgKGkgPSAwOyBpIDwgcGFkZGVkTGVuZ3RoOykgewogICAgZm9yIChqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgd1tqXS5oaWdoID0gcGFkZGVkW2ldIDw8IDI0IHwgcGFkZGVkW2kgKyAxXSA8PCAxNiB8IHBhZGRlZFtpICsgMl0gPDwgOCB8IHBhZGRlZFtpICsgM107CiAgICAgIHdbal0ubG93ID0gcGFkZGVkW2kgKyA0XSA8PCAyNCB8IHBhZGRlZFtpICsgNV0gPDwgMTYgfCBwYWRkZWRbaSArIDZdIDw8IDggfCBwYWRkZWRbaSArIDddOwogICAgICBpICs9IDg7CiAgICB9CiAgICBmb3IgKGogPSAxNjsgaiA8IDgwOyArK2opIHsKICAgICAgdG1wMyA9IHdbal07CiAgICAgIGxpdHRsZVNpZ21hUHJpbWUodG1wMywgd1tqIC0gMl0sIHRtcDIpOwogICAgICB0bXAzLmFkZCh3W2ogLSA3XSk7CiAgICAgIGxpdHRsZVNpZ21hKHRtcDEsIHdbaiAtIDE1XSwgdG1wMik7CiAgICAgIHRtcDMuYWRkKHRtcDEpOwogICAgICB0bXAzLmFkZCh3W2ogLSAxNl0pOwogICAgfQogICAgYS5hc3NpZ24oaDApOwogICAgYi5hc3NpZ24oaDEpOwogICAgYy5hc3NpZ24oaDIpOwogICAgZC5hc3NpZ24oaDMpOwogICAgZS5hc3NpZ24oaDQpOwogICAgZi5hc3NpZ24oaDUpOwogICAgZy5hc3NpZ24oaDYpOwogICAgaC5hc3NpZ24oaDcpOwogICAgZm9yIChqID0gMDsgaiA8IDgwOyArK2opIHsKICAgICAgdDEuYXNzaWduKGgpOwogICAgICBzaWdtYVByaW1lKHRtcDEsIGUsIHRtcDIpOwogICAgICB0MS5hZGQodG1wMSk7CiAgICAgIGNoKHRtcDEsIGUsIGYsIGcsIHRtcDIpOwogICAgICB0MS5hZGQodG1wMSk7CiAgICAgIHQxLmFkZChrW2pdKTsKICAgICAgdDEuYWRkKHdbal0pOwogICAgICBzaWdtYSh0MiwgYSwgdG1wMik7CiAgICAgIG1haih0bXAxLCBhLCBiLCBjLCB0bXAyKTsKICAgICAgdDIuYWRkKHRtcDEpOwogICAgICB0bXAzID0gaDsKICAgICAgaCA9IGc7CiAgICAgIGcgPSBmOwogICAgICBmID0gZTsKICAgICAgZC5hZGQodDEpOwogICAgICBlID0gZDsKICAgICAgZCA9IGM7CiAgICAgIGMgPSBiOwogICAgICBiID0gYTsKICAgICAgdG1wMy5hc3NpZ24odDEpOwogICAgICB0bXAzLmFkZCh0Mik7CiAgICAgIGEgPSB0bXAzOwogICAgfQogICAgaDAuYWRkKGEpOwogICAgaDEuYWRkKGIpOwogICAgaDIuYWRkKGMpOwogICAgaDMuYWRkKGQpOwogICAgaDQuYWRkKGUpOwogICAgaDUuYWRkKGYpOwogICAgaDYuYWRkKGcpOwogICAgaDcuYWRkKGgpOwogIH0KICBsZXQgcmVzdWx0OwogIGlmICghbW9kZTM4NCkgewogICAgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoNjQpOwogICAgaDAuY29weVRvKHJlc3VsdCwgMCk7CiAgICBoMS5jb3B5VG8ocmVzdWx0LCA4KTsKICAgIGgyLmNvcHlUbyhyZXN1bHQsIDE2KTsKICAgIGgzLmNvcHlUbyhyZXN1bHQsIDI0KTsKICAgIGg0LmNvcHlUbyhyZXN1bHQsIDMyKTsKICAgIGg1LmNvcHlUbyhyZXN1bHQsIDQwKTsKICAgIGg2LmNvcHlUbyhyZXN1bHQsIDQ4KTsKICAgIGg3LmNvcHlUbyhyZXN1bHQsIDU2KTsKICB9IGVsc2UgewogICAgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoNDgpOwogICAgaDAuY29weVRvKHJlc3VsdCwgMCk7CiAgICBoMS5jb3B5VG8ocmVzdWx0LCA4KTsKICAgIGgyLmNvcHlUbyhyZXN1bHQsIDE2KTsKICAgIGgzLmNvcHlUbyhyZXN1bHQsIDI0KTsKICAgIGg0LmNvcHlUbyhyZXN1bHQsIDMyKTsKICAgIGg1LmNvcHlUbyhyZXN1bHQsIDQwKTsKICB9CiAgcmV0dXJuIHJlc3VsdDsKfQpmdW5jdGlvbiBjYWxjdWxhdGVTSEEzODQoZGF0YSwgb2Zmc2V0LCBsZW5ndGgpIHsKICByZXR1cm4gY2FsY3VsYXRlU0hBNTEyKGRhdGEsIG9mZnNldCwgbGVuZ3RoLCB0cnVlKTsKfQoKOy8vIC4vc3JjL2NvcmUvY2FsY3VsYXRlX3NoYTI1Ni5qcwoKY29uc3QgY2FsY3VsYXRlX3NoYTI1Nl9QQVJBTVMgPSB7CiAgZ2V0IGsoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJrIiwgWzB4NDI4YTJmOTgsIDB4NzEzNzQ0OTEsIDB4YjVjMGZiY2YsIDB4ZTliNWRiYTUsIDB4Mzk1NmMyNWIsIDB4NTlmMTExZjEsIDB4OTIzZjgyYTQsIDB4YWIxYzVlZDUsIDB4ZDgwN2FhOTgsIDB4MTI4MzViMDEsIDB4MjQzMTg1YmUsIDB4NTUwYzdkYzMsIDB4NzJiZTVkNzQsIDB4ODBkZWIxZmUsIDB4OWJkYzA2YTcsIDB4YzE5YmYxNzQsIDB4ZTQ5YjY5YzEsIDB4ZWZiZTQ3ODYsIDB4MGZjMTlkYzYsIDB4MjQwY2ExY2MsIDB4MmRlOTJjNmYsIDB4NGE3NDg0YWEsIDB4NWNiMGE5ZGMsIDB4NzZmOTg4ZGEsIDB4OTgzZTUxNTIsIDB4YTgzMWM2NmQsIDB4YjAwMzI3YzgsIDB4YmY1OTdmYzcsIDB4YzZlMDBiZjMsIDB4ZDVhNzkxNDcsIDB4MDZjYTYzNTEsIDB4MTQyOTI5NjcsIDB4MjdiNzBhODUsIDB4MmUxYjIxMzgsIDB4NGQyYzZkZmMsIDB4NTMzODBkMTMsIDB4NjUwYTczNTQsIDB4NzY2YTBhYmIsIDB4ODFjMmM5MmUsIDB4OTI3MjJjODUsIDB4YTJiZmU4YTEsIDB4YTgxYTY2NGIsIDB4YzI0YjhiNzAsIDB4Yzc2YzUxYTMsIDB4ZDE5MmU4MTksIDB4ZDY5OTA2MjQsIDB4ZjQwZTM1ODUsIDB4MTA2YWEwNzAsIDB4MTlhNGMxMTYsIDB4MWUzNzZjMDgsIDB4Mjc0ODc3NGMsIDB4MzRiMGJjYjUsIDB4MzkxYzBjYjMsIDB4NGVkOGFhNGEsIDB4NWI5Y2NhNGYsIDB4NjgyZTZmZjMsIDB4NzQ4ZjgyZWUsIDB4NzhhNTYzNmYsIDB4ODRjODc4MTQsIDB4OGNjNzAyMDgsIDB4OTBiZWZmZmEsIDB4YTQ1MDZjZWIsIDB4YmVmOWEzZjcsIDB4YzY3MTc4ZjJdKTsKICB9Cn07CmZ1bmN0aW9uIHJvdHIoeCwgbikgewogIHJldHVybiB4ID4+PiBuIHwgeCA8PCAzMiAtIG47Cn0KZnVuY3Rpb24gY2FsY3VsYXRlX3NoYTI1Nl9jaCh4LCB5LCB6KSB7CiAgcmV0dXJuIHggJiB5IF4gfnggJiB6Owp9CmZ1bmN0aW9uIGNhbGN1bGF0ZV9zaGEyNTZfbWFqKHgsIHksIHopIHsKICByZXR1cm4geCAmIHkgXiB4ICYgeiBeIHkgJiB6Owp9CmZ1bmN0aW9uIGNhbGN1bGF0ZV9zaGEyNTZfc2lnbWEoeCkgewogIHJldHVybiByb3RyKHgsIDIpIF4gcm90cih4LCAxMykgXiByb3RyKHgsIDIyKTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVfc2hhMjU2X3NpZ21hUHJpbWUoeCkgewogIHJldHVybiByb3RyKHgsIDYpIF4gcm90cih4LCAxMSkgXiByb3RyKHgsIDI1KTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVfc2hhMjU2X2xpdHRsZVNpZ21hKHgpIHsKICByZXR1cm4gcm90cih4LCA3KSBeIHJvdHIoeCwgMTgpIF4geCA+Pj4gMzsKfQpmdW5jdGlvbiBjYWxjdWxhdGVfc2hhMjU2X2xpdHRsZVNpZ21hUHJpbWUoeCkgewogIHJldHVybiByb3RyKHgsIDE3KSBeIHJvdHIoeCwgMTkpIF4geCA+Pj4gMTA7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlU0hBMjU2KGRhdGEsIG9mZnNldCwgbGVuZ3RoKSB7CiAgbGV0IGgwID0gMHg2YTA5ZTY2NywKICAgIGgxID0gMHhiYjY3YWU4NSwKICAgIGgyID0gMHgzYzZlZjM3MiwKICAgIGgzID0gMHhhNTRmZjUzYSwKICAgIGg0ID0gMHg1MTBlNTI3ZiwKICAgIGg1ID0gMHg5YjA1Njg4YywKICAgIGg2ID0gMHgxZjgzZDlhYiwKICAgIGg3ID0gMHg1YmUwY2QxOTsKICBjb25zdCBwYWRkZWRMZW5ndGggPSBNYXRoLmNlaWwoKGxlbmd0aCArIDkpIC8gNjQpICogNjQ7CiAgY29uc3QgcGFkZGVkID0gbmV3IFVpbnQ4QXJyYXkocGFkZGVkTGVuZ3RoKTsKICBsZXQgaSwgajsKICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIHBhZGRlZFtpXSA9IGRhdGFbb2Zmc2V0KytdOwogIH0KICBwYWRkZWRbaSsrXSA9IDB4ODA7CiAgY29uc3QgbiA9IHBhZGRlZExlbmd0aCAtIDg7CiAgaWYgKGkgPCBuKSB7CiAgICBpID0gbjsKICB9CiAgaSArPSAzOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+PiAyOSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gMjEgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDEzICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiA1ICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA8PCAzICYgMHhmZjsKICBjb25zdCB3ID0gbmV3IFVpbnQzMkFycmF5KDY0KTsKICBjb25zdCB7CiAgICBrCiAgfSA9IGNhbGN1bGF0ZV9zaGEyNTZfUEFSQU1TOwogIGZvciAoaSA9IDA7IGkgPCBwYWRkZWRMZW5ndGg7KSB7CiAgICBmb3IgKGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICB3W2pdID0gcGFkZGVkW2ldIDw8IDI0IHwgcGFkZGVkW2kgKyAxXSA8PCAxNiB8IHBhZGRlZFtpICsgMl0gPDwgOCB8IHBhZGRlZFtpICsgM107CiAgICAgIGkgKz0gNDsKICAgIH0KICAgIGZvciAoaiA9IDE2OyBqIDwgNjQ7ICsraikgewogICAgICB3W2pdID0gY2FsY3VsYXRlX3NoYTI1Nl9saXR0bGVTaWdtYVByaW1lKHdbaiAtIDJdKSArIHdbaiAtIDddICsgY2FsY3VsYXRlX3NoYTI1Nl9saXR0bGVTaWdtYSh3W2ogLSAxNV0pICsgd1tqIC0gMTZdIHwgMDsKICAgIH0KICAgIGxldCBhID0gaDAsCiAgICAgIGIgPSBoMSwKICAgICAgYyA9IGgyLAogICAgICBkID0gaDMsCiAgICAgIGUgPSBoNCwKICAgICAgZiA9IGg1LAogICAgICBnID0gaDYsCiAgICAgIGggPSBoNywKICAgICAgdDEsCiAgICAgIHQyOwogICAgZm9yIChqID0gMDsgaiA8IDY0OyArK2opIHsKICAgICAgdDEgPSBoICsgY2FsY3VsYXRlX3NoYTI1Nl9zaWdtYVByaW1lKGUpICsgY2FsY3VsYXRlX3NoYTI1Nl9jaChlLCBmLCBnKSArIGtbal0gKyB3W2pdOwogICAgICB0MiA9IGNhbGN1bGF0ZV9zaGEyNTZfc2lnbWEoYSkgKyBjYWxjdWxhdGVfc2hhMjU2X21haihhLCBiLCBjKTsKICAgICAgaCA9IGc7CiAgICAgIGcgPSBmOwogICAgICBmID0gZTsKICAgICAgZSA9IGQgKyB0MSB8IDA7CiAgICAgIGQgPSBjOwogICAgICBjID0gYjsKICAgICAgYiA9IGE7CiAgICAgIGEgPSB0MSArIHQyIHwgMDsKICAgIH0KICAgIGgwID0gaDAgKyBhIHwgMDsKICAgIGgxID0gaDEgKyBiIHwgMDsKICAgIGgyID0gaDIgKyBjIHwgMDsKICAgIGgzID0gaDMgKyBkIHwgMDsKICAgIGg0ID0gaDQgKyBlIHwgMDsKICAgIGg1ID0gaDUgKyBmIHwgMDsKICAgIGg2ID0gaDYgKyBnIHwgMDsKICAgIGg3ID0gaDcgKyBoIHwgMDsKICB9CiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFtoMCA+PiAyNCAmIDB4RkYsIGgwID4+IDE2ICYgMHhGRiwgaDAgPj4gOCAmIDB4RkYsIGgwICYgMHhGRiwgaDEgPj4gMjQgJiAweEZGLCBoMSA+PiAxNiAmIDB4RkYsIGgxID4+IDggJiAweEZGLCBoMSAmIDB4RkYsIGgyID4+IDI0ICYgMHhGRiwgaDIgPj4gMTYgJiAweEZGLCBoMiA+PiA4ICYgMHhGRiwgaDIgJiAweEZGLCBoMyA+PiAyNCAmIDB4RkYsIGgzID4+IDE2ICYgMHhGRiwgaDMgPj4gOCAmIDB4RkYsIGgzICYgMHhGRiwgaDQgPj4gMjQgJiAweEZGLCBoNCA+PiAxNiAmIDB4RkYsIGg0ID4+IDggJiAweEZGLCBoNCAmIDB4RkYsIGg1ID4+IDI0ICYgMHhGRiwgaDUgPj4gMTYgJiAweEZGLCBoNSA+PiA4ICYgMHhGRiwgaDUgJiAweEZGLCBoNiA+PiAyNCAmIDB4RkYsIGg2ID4+IDE2ICYgMHhGRiwgaDYgPj4gOCAmIDB4RkYsIGg2ICYgMHhGRiwgaDcgPj4gMjQgJiAweEZGLCBoNyA+PiAxNiAmIDB4RkYsIGg3ID4+IDggJiAweEZGLCBoNyAmIDB4RkZdKTsKfQoKOy8vIC4vc3JjL2NvcmUvZGVjcnlwdF9zdHJlYW0uanMKCmNvbnN0IGNodW5rU2l6ZSA9IDUxMjsKY2xhc3MgRGVjcnlwdFN0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyLCBtYXliZUxlbmd0aCwgZGVjcnlwdCkgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIHRoaXMuZGVjcnlwdCA9IGRlY3J5cHQ7CiAgICB0aGlzLm5leHRDaHVuayA9IG51bGw7CiAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGxldCBjaHVuazsKICAgIGlmICh0aGlzLmluaXRpYWxpemVkKSB7CiAgICAgIGNodW5rID0gdGhpcy5uZXh0Q2h1bms7CiAgICB9IGVsc2UgewogICAgICBjaHVuayA9IHRoaXMuc3RyZWFtLmdldEJ5dGVzKGNodW5rU2l6ZSk7CiAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgfQogICAgaWYgKCFjaHVuaz8ubGVuZ3RoKSB7CiAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5uZXh0Q2h1bmsgPSB0aGlzLnN0cmVhbS5nZXRCeXRlcyhjaHVua1NpemUpOwogICAgY29uc3QgaGFzTW9yZURhdGEgPSB0aGlzLm5leHRDaHVuaz8ubGVuZ3RoID4gMDsKICAgIGNvbnN0IGRlY3J5cHQgPSB0aGlzLmRlY3J5cHQ7CiAgICBjaHVuayA9IGRlY3J5cHQoY2h1bmssICFoYXNNb3JlRGF0YSk7CiAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aCwKICAgICAgbmV3TGVuZ3RoID0gYnVmZmVyTGVuZ3RoICsgY2h1bmsubGVuZ3RoLAogICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihuZXdMZW5ndGgpOwogICAgYnVmZmVyLnNldChjaHVuaywgYnVmZmVyTGVuZ3RoKTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gbmV3TGVuZ3RoOwogIH0KICBnZXRPcmlnaW5hbFN0cmVhbSgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY3J5cHRvLmpzCgoKCgoKCmNsYXNzIEFSQ0ZvdXJDaXBoZXIgewogIGNvbnN0cnVjdG9yKGtleSkgewogICAgdGhpcy5hID0gMDsKICAgIHRoaXMuYiA9IDA7CiAgICBjb25zdCBzID0gbmV3IFVpbnQ4QXJyYXkoMjU2KTsKICAgIGNvbnN0IGtleUxlbmd0aCA9IGtleS5sZW5ndGg7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgKytpKSB7CiAgICAgIHNbaV0gPSBpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGogPSAwOyBpIDwgMjU2OyArK2kpIHsKICAgICAgY29uc3QgdG1wID0gc1tpXTsKICAgICAgaiA9IGogKyB0bXAgKyBrZXlbaSAlIGtleUxlbmd0aF0gJiAweGZmOwogICAgICBzW2ldID0gc1tqXTsKICAgICAgc1tqXSA9IHRtcDsKICAgIH0KICAgIHRoaXMucyA9IHM7CiAgfQogIGVuY3J5cHRCbG9jayhkYXRhKSB7CiAgICBsZXQgYSA9IHRoaXMuYSwKICAgICAgYiA9IHRoaXMuYjsKICAgIGNvbnN0IHMgPSB0aGlzLnM7CiAgICBjb25zdCBuID0gZGF0YS5sZW5ndGg7CiAgICBjb25zdCBvdXRwdXQgPSBuZXcgVWludDhBcnJheShuKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGEgPSBhICsgMSAmIDB4ZmY7CiAgICAgIGNvbnN0IHRtcCA9IHNbYV07CiAgICAgIGIgPSBiICsgdG1wICYgMHhmZjsKICAgICAgY29uc3QgdG1wMiA9IHNbYl07CiAgICAgIHNbYV0gPSB0bXAyOwogICAgICBzW2JdID0gdG1wOwogICAgICBvdXRwdXRbaV0gPSBkYXRhW2ldIF4gc1t0bXAgKyB0bXAyICYgMHhmZl07CiAgICB9CiAgICB0aGlzLmEgPSBhOwogICAgdGhpcy5iID0gYjsKICAgIHJldHVybiBvdXRwdXQ7CiAgfQogIGRlY3J5cHRCbG9jayhkYXRhKSB7CiAgICByZXR1cm4gdGhpcy5lbmNyeXB0QmxvY2soZGF0YSk7CiAgfQogIGVuY3J5cHQoZGF0YSkgewogICAgcmV0dXJuIHRoaXMuZW5jcnlwdEJsb2NrKGRhdGEpOwogIH0KfQpjbGFzcyBOdWxsQ2lwaGVyIHsKICBkZWNyeXB0QmxvY2soZGF0YSkgewogICAgcmV0dXJuIGRhdGE7CiAgfQogIGVuY3J5cHQoZGF0YSkgewogICAgcmV0dXJuIGRhdGE7CiAgfQp9CmNsYXNzIEFFU0Jhc2VDaXBoZXIgewogIF9zID0gbmV3IFVpbnQ4QXJyYXkoWzB4NjMsIDB4N2MsIDB4NzcsIDB4N2IsIDB4ZjIsIDB4NmIsIDB4NmYsIDB4YzUsIDB4MzAsIDB4MDEsIDB4NjcsIDB4MmIsIDB4ZmUsIDB4ZDcsIDB4YWIsIDB4NzYsIDB4Y2EsIDB4ODIsIDB4YzksIDB4N2QsIDB4ZmEsIDB4NTksIDB4NDcsIDB4ZjAsIDB4YWQsIDB4ZDQsIDB4YTIsIDB4YWYsIDB4OWMsIDB4YTQsIDB4NzIsIDB4YzAsIDB4YjcsIDB4ZmQsIDB4OTMsIDB4MjYsIDB4MzYsIDB4M2YsIDB4ZjcsIDB4Y2MsIDB4MzQsIDB4YTUsIDB4ZTUsIDB4ZjEsIDB4NzEsIDB4ZDgsIDB4MzEsIDB4MTUsIDB4MDQsIDB4YzcsIDB4MjMsIDB4YzMsIDB4MTgsIDB4OTYsIDB4MDUsIDB4OWEsIDB4MDcsIDB4MTIsIDB4ODAsIDB4ZTIsIDB4ZWIsIDB4MjcsIDB4YjIsIDB4NzUsIDB4MDksIDB4ODMsIDB4MmMsIDB4MWEsIDB4MWIsIDB4NmUsIDB4NWEsIDB4YTAsIDB4NTIsIDB4M2IsIDB4ZDYsIDB4YjMsIDB4MjksIDB4ZTMsIDB4MmYsIDB4ODQsIDB4NTMsIDB4ZDEsIDB4MDAsIDB4ZWQsIDB4MjAsIDB4ZmMsIDB4YjEsIDB4NWIsIDB4NmEsIDB4Y2IsIDB4YmUsIDB4MzksIDB4NGEsIDB4NGMsIDB4NTgsIDB4Y2YsIDB4ZDAsIDB4ZWYsIDB4YWEsIDB4ZmIsIDB4NDMsIDB4NGQsIDB4MzMsIDB4ODUsIDB4NDUsIDB4ZjksIDB4MDIsIDB4N2YsIDB4NTAsIDB4M2MsIDB4OWYsIDB4YTgsIDB4NTEsIDB4YTMsIDB4NDAsIDB4OGYsIDB4OTIsIDB4OWQsIDB4MzgsIDB4ZjUsIDB4YmMsIDB4YjYsIDB4ZGEsIDB4MjEsIDB4MTAsIDB4ZmYsIDB4ZjMsIDB4ZDIsIDB4Y2QsIDB4MGMsIDB4MTMsIDB4ZWMsIDB4NWYsIDB4OTcsIDB4NDQsIDB4MTcsIDB4YzQsIDB4YTcsIDB4N2UsIDB4M2QsIDB4NjQsIDB4NWQsIDB4MTksIDB4NzMsIDB4NjAsIDB4ODEsIDB4NGYsIDB4ZGMsIDB4MjIsIDB4MmEsIDB4OTAsIDB4ODgsIDB4NDYsIDB4ZWUsIDB4YjgsIDB4MTQsIDB4ZGUsIDB4NWUsIDB4MGIsIDB4ZGIsIDB4ZTAsIDB4MzIsIDB4M2EsIDB4MGEsIDB4NDksIDB4MDYsIDB4MjQsIDB4NWMsIDB4YzIsIDB4ZDMsIDB4YWMsIDB4NjIsIDB4OTEsIDB4OTUsIDB4ZTQsIDB4NzksIDB4ZTcsIDB4YzgsIDB4MzcsIDB4NmQsIDB4OGQsIDB4ZDUsIDB4NGUsIDB4YTksIDB4NmMsIDB4NTYsIDB4ZjQsIDB4ZWEsIDB4NjUsIDB4N2EsIDB4YWUsIDB4MDgsIDB4YmEsIDB4NzgsIDB4MjUsIDB4MmUsIDB4MWMsIDB4YTYsIDB4YjQsIDB4YzYsIDB4ZTgsIDB4ZGQsIDB4NzQsIDB4MWYsIDB4NGIsIDB4YmQsIDB4OGIsIDB4OGEsIDB4NzAsIDB4M2UsIDB4YjUsIDB4NjYsIDB4NDgsIDB4MDMsIDB4ZjYsIDB4MGUsIDB4NjEsIDB4MzUsIDB4NTcsIDB4YjksIDB4ODYsIDB4YzEsIDB4MWQsIDB4OWUsIDB4ZTEsIDB4ZjgsIDB4OTgsIDB4MTEsIDB4NjksIDB4ZDksIDB4OGUsIDB4OTQsIDB4OWIsIDB4MWUsIDB4ODcsIDB4ZTksIDB4Y2UsIDB4NTUsIDB4MjgsIDB4ZGYsIDB4OGMsIDB4YTEsIDB4ODksIDB4MGQsIDB4YmYsIDB4ZTYsIDB4NDIsIDB4NjgsIDB4NDEsIDB4OTksIDB4MmQsIDB4MGYsIDB4YjAsIDB4NTQsIDB4YmIsIDB4MTZdKTsKICBfaW52X3MgPSBuZXcgVWludDhBcnJheShbMHg1MiwgMHgwOSwgMHg2YSwgMHhkNSwgMHgzMCwgMHgzNiwgMHhhNSwgMHgzOCwgMHhiZiwgMHg0MCwgMHhhMywgMHg5ZSwgMHg4MSwgMHhmMywgMHhkNywgMHhmYiwgMHg3YywgMHhlMywgMHgzOSwgMHg4MiwgMHg5YiwgMHgyZiwgMHhmZiwgMHg4NywgMHgzNCwgMHg4ZSwgMHg0MywgMHg0NCwgMHhjNCwgMHhkZSwgMHhlOSwgMHhjYiwgMHg1NCwgMHg3YiwgMHg5NCwgMHgzMiwgMHhhNiwgMHhjMiwgMHgyMywgMHgzZCwgMHhlZSwgMHg0YywgMHg5NSwgMHgwYiwgMHg0MiwgMHhmYSwgMHhjMywgMHg0ZSwgMHgwOCwgMHgyZSwgMHhhMSwgMHg2NiwgMHgyOCwgMHhkOSwgMHgyNCwgMHhiMiwgMHg3NiwgMHg1YiwgMHhhMiwgMHg0OSwgMHg2ZCwgMHg4YiwgMHhkMSwgMHgyNSwgMHg3MiwgMHhmOCwgMHhmNiwgMHg2NCwgMHg4NiwgMHg2OCwgMHg5OCwgMHgxNiwgMHhkNCwgMHhhNCwgMHg1YywgMHhjYywgMHg1ZCwgMHg2NSwgMHhiNiwgMHg5MiwgMHg2YywgMHg3MCwgMHg0OCwgMHg1MCwgMHhmZCwgMHhlZCwgMHhiOSwgMHhkYSwgMHg1ZSwgMHgxNSwgMHg0NiwgMHg1NywgMHhhNywgMHg4ZCwgMHg5ZCwgMHg4NCwgMHg5MCwgMHhkOCwgMHhhYiwgMHgwMCwgMHg4YywgMHhiYywgMHhkMywgMHgwYSwgMHhmNywgMHhlNCwgMHg1OCwgMHgwNSwgMHhiOCwgMHhiMywgMHg0NSwgMHgwNiwgMHhkMCwgMHgyYywgMHgxZSwgMHg4ZiwgMHhjYSwgMHgzZiwgMHgwZiwgMHgwMiwgMHhjMSwgMHhhZiwgMHhiZCwgMHgwMywgMHgwMSwgMHgxMywgMHg4YSwgMHg2YiwgMHgzYSwgMHg5MSwgMHgxMSwgMHg0MSwgMHg0ZiwgMHg2NywgMHhkYywgMHhlYSwgMHg5NywgMHhmMiwgMHhjZiwgMHhjZSwgMHhmMCwgMHhiNCwgMHhlNiwgMHg3MywgMHg5NiwgMHhhYywgMHg3NCwgMHgyMiwgMHhlNywgMHhhZCwgMHgzNSwgMHg4NSwgMHhlMiwgMHhmOSwgMHgzNywgMHhlOCwgMHgxYywgMHg3NSwgMHhkZiwgMHg2ZSwgMHg0NywgMHhmMSwgMHgxYSwgMHg3MSwgMHgxZCwgMHgyOSwgMHhjNSwgMHg4OSwgMHg2ZiwgMHhiNywgMHg2MiwgMHgwZSwgMHhhYSwgMHgxOCwgMHhiZSwgMHgxYiwgMHhmYywgMHg1NiwgMHgzZSwgMHg0YiwgMHhjNiwgMHhkMiwgMHg3OSwgMHgyMCwgMHg5YSwgMHhkYiwgMHhjMCwgMHhmZSwgMHg3OCwgMHhjZCwgMHg1YSwgMHhmNCwgMHgxZiwgMHhkZCwgMHhhOCwgMHgzMywgMHg4OCwgMHgwNywgMHhjNywgMHgzMSwgMHhiMSwgMHgxMiwgMHgxMCwgMHg1OSwgMHgyNywgMHg4MCwgMHhlYywgMHg1ZiwgMHg2MCwgMHg1MSwgMHg3ZiwgMHhhOSwgMHgxOSwgMHhiNSwgMHg0YSwgMHgwZCwgMHgyZCwgMHhlNSwgMHg3YSwgMHg5ZiwgMHg5MywgMHhjOSwgMHg5YywgMHhlZiwgMHhhMCwgMHhlMCwgMHgzYiwgMHg0ZCwgMHhhZSwgMHgyYSwgMHhmNSwgMHhiMCwgMHhjOCwgMHhlYiwgMHhiYiwgMHgzYywgMHg4MywgMHg1MywgMHg5OSwgMHg2MSwgMHgxNywgMHgyYiwgMHgwNCwgMHg3ZSwgMHhiYSwgMHg3NywgMHhkNiwgMHgyNiwgMHhlMSwgMHg2OSwgMHgxNCwgMHg2MywgMHg1NSwgMHgyMSwgMHgwYywgMHg3ZF0pOwogIF9taXggPSBuZXcgVWludDMyQXJyYXkoWzB4MDAwMDAwMDAsIDB4MGUwOTBkMGIsIDB4MWMxMjFhMTYsIDB4MTIxYjE3MWQsIDB4MzgyNDM0MmMsIDB4MzYyZDM5MjcsIDB4MjQzNjJlM2EsIDB4MmEzZjIzMzEsIDB4NzA0ODY4NTgsIDB4N2U0MTY1NTMsIDB4NmM1YTcyNGUsIDB4NjI1MzdmNDUsIDB4NDg2YzVjNzQsIDB4NDY2NTUxN2YsIDB4NTQ3ZTQ2NjIsIDB4NWE3NzRiNjksIDB4ZTA5MGQwYjAsIDB4ZWU5OWRkYmIsIDB4ZmM4MmNhYTYsIDB4ZjI4YmM3YWQsIDB4ZDhiNGU0OWMsIDB4ZDZiZGU5OTcsIDB4YzRhNmZlOGEsIDB4Y2FhZmYzODEsIDB4OTBkOGI4ZTgsIDB4OWVkMWI1ZTMsIDB4OGNjYWEyZmUsIDB4ODJjM2FmZjUsIDB4YThmYzhjYzQsIDB4YTZmNTgxY2YsIDB4YjRlZTk2ZDIsIDB4YmFlNzliZDksIDB4ZGIzYmJiN2IsIDB4ZDUzMmI2NzAsIDB4YzcyOWExNmQsIDB4YzkyMGFjNjYsIDB4ZTMxZjhmNTcsIDB4ZWQxNjgyNWMsIDB4ZmYwZDk1NDEsIDB4ZjEwNDk4NGEsIDB4YWI3M2QzMjMsIDB4YTU3YWRlMjgsIDB4Yjc2MWM5MzUsIDB4Yjk2OGM0M2UsIDB4OTM1N2U3MGYsIDB4OWQ1ZWVhMDQsIDB4OGY0NWZkMTksIDB4ODE0Y2YwMTIsIDB4M2JhYjZiY2IsIDB4MzVhMjY2YzAsIDB4MjdiOTcxZGQsIDB4MjliMDdjZDYsIDB4MDM4ZjVmZTcsIDB4MGQ4NjUyZWMsIDB4MWY5ZDQ1ZjEsIDB4MTE5NDQ4ZmEsIDB4NGJlMzAzOTMsIDB4NDVlYTBlOTgsIDB4NTdmMTE5ODUsIDB4NTlmODE0OGUsIDB4NzNjNzM3YmYsIDB4N2RjZTNhYjQsIDB4NmZkNTJkYTksIDB4NjFkYzIwYTIsIDB4YWQ3NjZkZjYsIDB4YTM3ZjYwZmQsIDB4YjE2NDc3ZTAsIDB4YmY2ZDdhZWIsIDB4OTU1MjU5ZGEsIDB4OWI1YjU0ZDEsIDB4ODk0MDQzY2MsIDB4ODc0OTRlYzcsIDB4ZGQzZTA1YWUsIDB4ZDMzNzA4YTUsIDB4YzEyYzFmYjgsIDB4Y2YyNTEyYjMsIDB4ZTUxYTMxODIsIDB4ZWIxMzNjODksIDB4ZjkwODJiOTQsIDB4ZjcwMTI2OWYsIDB4NGRlNmJkNDYsIDB4NDNlZmIwNGQsIDB4NTFmNGE3NTAsIDB4NWZmZGFhNWIsIDB4NzVjMjg5NmEsIDB4N2JjYjg0NjEsIDB4NjlkMDkzN2MsIDB4NjdkOTllNzcsIDB4M2RhZWQ1MWUsIDB4MzNhN2Q4MTUsIDB4MjFiY2NmMDgsIDB4MmZiNWMyMDMsIDB4MDU4YWUxMzIsIDB4MGI4M2VjMzksIDB4MTk5OGZiMjQsIDB4MTc5MWY2MmYsIDB4NzY0ZGQ2OGQsIDB4Nzg0NGRiODYsIDB4NmE1ZmNjOWIsIDB4NjQ1NmMxOTAsIDB4NGU2OWUyYTEsIDB4NDA2MGVmYWEsIDB4NTI3YmY4YjcsIDB4NWM3MmY1YmMsIDB4MDYwNWJlZDUsIDB4MDgwY2IzZGUsIDB4MWExN2E0YzMsIDB4MTQxZWE5YzgsIDB4M2UyMThhZjksIDB4MzAyODg3ZjIsIDB4MjIzMzkwZWYsIDB4MmMzYTlkZTQsIDB4OTZkZDA2M2QsIDB4OThkNDBiMzYsIDB4OGFjZjFjMmIsIDB4ODRjNjExMjAsIDB4YWVmOTMyMTEsIDB4YTBmMDNmMWEsIDB4YjJlYjI4MDcsIDB4YmNlMjI1MGMsIDB4ZTY5NTZlNjUsIDB4ZTg5YzYzNmUsIDB4ZmE4Nzc0NzMsIDB4ZjQ4ZTc5NzgsIDB4ZGViMTVhNDksIDB4ZDBiODU3NDIsIDB4YzJhMzQwNWYsIDB4Y2NhYTRkNTQsIDB4NDFlY2RhZjcsIDB4NGZlNWQ3ZmMsIDB4NWRmZWMwZTEsIDB4NTNmN2NkZWEsIDB4NzljOGVlZGIsIDB4NzdjMWUzZDAsIDB4NjVkYWY0Y2QsIDB4NmJkM2Y5YzYsIDB4MzFhNGIyYWYsIDB4M2ZhZGJmYTQsIDB4MmRiNmE4YjksIDB4MjNiZmE1YjIsIDB4MDk4MDg2ODMsIDB4MDc4OThiODgsIDB4MTU5MjljOTUsIDB4MWI5YjkxOWUsIDB4YTE3YzBhNDcsIDB4YWY3NTA3NGMsIDB4YmQ2ZTEwNTEsIDB4YjM2NzFkNWEsIDB4OTk1ODNlNmIsIDB4OTc1MTMzNjAsIDB4ODU0YTI0N2QsIDB4OGI0MzI5NzYsIDB4ZDEzNDYyMWYsIDB4ZGYzZDZmMTQsIDB4Y2QyNjc4MDksIDB4YzMyZjc1MDIsIDB4ZTkxMDU2MzMsIDB4ZTcxOTViMzgsIDB4ZjUwMjRjMjUsIDB4ZmIwYjQxMmUsIDB4OWFkNzYxOGMsIDB4OTRkZTZjODcsIDB4ODZjNTdiOWEsIDB4ODhjYzc2OTEsIDB4YTJmMzU1YTAsIDB4YWNmYTU4YWIsIDB4YmVlMTRmYjYsIDB4YjBlODQyYmQsIDB4ZWE5ZjA5ZDQsIDB4ZTQ5NjA0ZGYsIDB4ZjY4ZDEzYzIsIDB4Zjg4NDFlYzksIDB4ZDJiYjNkZjgsIDB4ZGNiMjMwZjMsIDB4Y2VhOTI3ZWUsIDB4YzBhMDJhZTUsIDB4N2E0N2IxM2MsIDB4NzQ0ZWJjMzcsIDB4NjY1NWFiMmEsIDB4Njg1Y2E2MjEsIDB4NDI2Mzg1MTAsIDB4NGM2YTg4MWIsIDB4NWU3MTlmMDYsIDB4NTA3ODkyMGQsIDB4MGEwZmQ5NjQsIDB4MDQwNmQ0NmYsIDB4MTYxZGMzNzIsIDB4MTgxNGNlNzksIDB4MzIyYmVkNDgsIDB4M2MyMmUwNDMsIDB4MmUzOWY3NWUsIDB4MjAzMGZhNTUsIDB4ZWM5YWI3MDEsIDB4ZTI5M2JhMGEsIDB4ZjA4OGFkMTcsIDB4ZmU4MWEwMWMsIDB4ZDRiZTgzMmQsIDB4ZGFiNzhlMjYsIDB4YzhhYzk5M2IsIDB4YzZhNTk0MzAsIDB4OWNkMmRmNTksIDB4OTJkYmQyNTIsIDB4ODBjMGM1NGYsIDB4OGVjOWM4NDQsIDB4YTRmNmViNzUsIDB4YWFmZmU2N2UsIDB4YjhlNGYxNjMsIDB4YjZlZGZjNjgsIDB4MGMwYTY3YjEsIDB4MDIwMzZhYmEsIDB4MTAxODdkYTcsIDB4MWUxMTcwYWMsIDB4MzQyZTUzOWQsIDB4M2EyNzVlOTYsIDB4MjgzYzQ5OGIsIDB4MjYzNTQ0ODAsIDB4N2M0MjBmZTksIDB4NzI0YjAyZTIsIDB4NjA1MDE1ZmYsIDB4NmU1OTE4ZjQsIDB4NDQ2NjNiYzUsIDB4NGE2ZjM2Y2UsIDB4NTg3NDIxZDMsIDB4NTY3ZDJjZDgsIDB4MzdhMTBjN2EsIDB4MzlhODAxNzEsIDB4MmJiMzE2NmMsIDB4MjViYTFiNjcsIDB4MGY4NTM4NTYsIDB4MDE4YzM1NWQsIDB4MTM5NzIyNDAsIDB4MWQ5ZTJmNGIsIDB4NDdlOTY0MjIsIDB4NDllMDY5MjksIDB4NWJmYjdlMzQsIDB4NTVmMjczM2YsIDB4N2ZjZDUwMGUsIDB4NzFjNDVkMDUsIDB4NjNkZjRhMTgsIDB4NmRkNjQ3MTMsIDB4ZDczMWRjY2EsIDB4ZDkzOGQxYzEsIDB4Y2IyM2M2ZGMsIDB4YzUyYWNiZDcsIDB4ZWYxNWU4ZTYsIDB4ZTExY2U1ZWQsIDB4ZjMwN2YyZjAsIDB4ZmQwZWZmZmIsIDB4YTc3OWI0OTIsIDB4YTk3MGI5OTksIDB4YmI2YmFlODQsIDB4YjU2MmEzOGYsIDB4OWY1ZDgwYmUsIDB4OTE1NDhkYjUsIDB4ODM0ZjlhYTgsIDB4OGQ0Njk3YTNdKTsKICBfbWl4Q29sID0gbmV3IFVpbnQ4QXJyYXkoMjU2KS5tYXAoKF8sIGkpID0+IGkgPCAxMjggPyBpIDw8IDEgOiBpIDw8IDEgXiAweDFiKTsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgdGhpcy5idWZmZXJQb3NpdGlvbiA9IDA7CiAgfQogIF9leHBhbmRLZXkoY2lwaGVyS2V5KSB7CiAgICB1bnJlYWNoYWJsZSgiQ2Fubm90IGNhbGwgYF9leHBhbmRLZXlgIG9uIHRoZSBiYXNlIGNsYXNzIik7CiAgfQogIF9kZWNyeXB0KGlucHV0LCBrZXkpIHsKICAgIGxldCB0LCB1LCB2OwogICAgY29uc3Qgc3RhdGUgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICBzdGF0ZS5zZXQoaW5wdXQpOwogICAgZm9yIChsZXQgaiA9IDAsIGsgPSB0aGlzLl9rZXlTaXplOyBqIDwgMTY7ICsraiwgKytrKSB7CiAgICAgIHN0YXRlW2pdIF49IGtleVtrXTsKICAgIH0KICAgIGZvciAobGV0IGkgPSB0aGlzLl9jeWNsZXNPZlJlcGV0aXRpb24gLSAxOyBpID49IDE7IC0taSkgewogICAgICB0ID0gc3RhdGVbMTNdOwogICAgICBzdGF0ZVsxM10gPSBzdGF0ZVs5XTsKICAgICAgc3RhdGVbOV0gPSBzdGF0ZVs1XTsKICAgICAgc3RhdGVbNV0gPSBzdGF0ZVsxXTsKICAgICAgc3RhdGVbMV0gPSB0OwogICAgICB0ID0gc3RhdGVbMTRdOwogICAgICB1ID0gc3RhdGVbMTBdOwogICAgICBzdGF0ZVsxNF0gPSBzdGF0ZVs2XTsKICAgICAgc3RhdGVbMTBdID0gc3RhdGVbMl07CiAgICAgIHN0YXRlWzZdID0gdDsKICAgICAgc3RhdGVbMl0gPSB1OwogICAgICB0ID0gc3RhdGVbMTVdOwogICAgICB1ID0gc3RhdGVbMTFdOwogICAgICB2ID0gc3RhdGVbN107CiAgICAgIHN0YXRlWzE1XSA9IHN0YXRlWzNdOwogICAgICBzdGF0ZVsxMV0gPSB0OwogICAgICBzdGF0ZVs3XSA9IHU7CiAgICAgIHN0YXRlWzNdID0gdjsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgc3RhdGVbal0gPSB0aGlzLl9pbnZfc1tzdGF0ZVtqXV07CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDAsIGsgPSBpICogMTY7IGogPCAxNjsgKytqLCArK2spIHsKICAgICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgaiArPSA0KSB7CiAgICAgICAgY29uc3QgczAgPSB0aGlzLl9taXhbc3RhdGVbal1dOwogICAgICAgIGNvbnN0IHMxID0gdGhpcy5fbWl4W3N0YXRlW2ogKyAxXV07CiAgICAgICAgY29uc3QgczIgPSB0aGlzLl9taXhbc3RhdGVbaiArIDJdXTsKICAgICAgICBjb25zdCBzMyA9IHRoaXMuX21peFtzdGF0ZVtqICsgM11dOwogICAgICAgIHQgPSBzMCBeIHMxID4+PiA4IF4gczEgPDwgMjQgXiBzMiA+Pj4gMTYgXiBzMiA8PCAxNiBeIHMzID4+PiAyNCBeIHMzIDw8IDg7CiAgICAgICAgc3RhdGVbal0gPSB0ID4+PiAyNCAmIDB4ZmY7CiAgICAgICAgc3RhdGVbaiArIDFdID0gdCA+PiAxNiAmIDB4ZmY7CiAgICAgICAgc3RhdGVbaiArIDJdID0gdCA+PiA4ICYgMHhmZjsKICAgICAgICBzdGF0ZVtqICsgM10gPSB0ICYgMHhmZjsKICAgICAgfQogICAgfQogICAgdCA9IHN0YXRlWzEzXTsKICAgIHN0YXRlWzEzXSA9IHN0YXRlWzldOwogICAgc3RhdGVbOV0gPSBzdGF0ZVs1XTsKICAgIHN0YXRlWzVdID0gc3RhdGVbMV07CiAgICBzdGF0ZVsxXSA9IHQ7CiAgICB0ID0gc3RhdGVbMTRdOwogICAgdSA9IHN0YXRlWzEwXTsKICAgIHN0YXRlWzE0XSA9IHN0YXRlWzZdOwogICAgc3RhdGVbMTBdID0gc3RhdGVbMl07CiAgICBzdGF0ZVs2XSA9IHQ7CiAgICBzdGF0ZVsyXSA9IHU7CiAgICB0ID0gc3RhdGVbMTVdOwogICAgdSA9IHN0YXRlWzExXTsKICAgIHYgPSBzdGF0ZVs3XTsKICAgIHN0YXRlWzE1XSA9IHN0YXRlWzNdOwogICAgc3RhdGVbMTFdID0gdDsKICAgIHN0YXRlWzddID0gdTsKICAgIHN0YXRlWzNdID0gdjsKICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICBzdGF0ZVtqXSA9IHRoaXMuX2ludl9zW3N0YXRlW2pdXTsKICAgICAgc3RhdGVbal0gXj0ga2V5W2pdOwogICAgfQogICAgcmV0dXJuIHN0YXRlOwogIH0KICBfZW5jcnlwdChpbnB1dCwga2V5KSB7CiAgICBjb25zdCBzID0gdGhpcy5fczsKICAgIGxldCB0LCB1LCB2OwogICAgY29uc3Qgc3RhdGUgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICBzdGF0ZS5zZXQoaW5wdXQpOwogICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgIHN0YXRlW2pdIF49IGtleVtqXTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uOyBpKyspIHsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgc3RhdGVbal0gPSBzW3N0YXRlW2pdXTsKICAgICAgfQogICAgICB2ID0gc3RhdGVbMV07CiAgICAgIHN0YXRlWzFdID0gc3RhdGVbNV07CiAgICAgIHN0YXRlWzVdID0gc3RhdGVbOV07CiAgICAgIHN0YXRlWzldID0gc3RhdGVbMTNdOwogICAgICBzdGF0ZVsxM10gPSB2OwogICAgICB2ID0gc3RhdGVbMl07CiAgICAgIHUgPSBzdGF0ZVs2XTsKICAgICAgc3RhdGVbMl0gPSBzdGF0ZVsxMF07CiAgICAgIHN0YXRlWzZdID0gc3RhdGVbMTRdOwogICAgICBzdGF0ZVsxMF0gPSB2OwogICAgICBzdGF0ZVsxNF0gPSB1OwogICAgICB2ID0gc3RhdGVbM107CiAgICAgIHUgPSBzdGF0ZVs3XTsKICAgICAgdCA9IHN0YXRlWzExXTsKICAgICAgc3RhdGVbM10gPSBzdGF0ZVsxNV07CiAgICAgIHN0YXRlWzddID0gdjsKICAgICAgc3RhdGVbMTFdID0gdTsKICAgICAgc3RhdGVbMTVdID0gdDsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgaiArPSA0KSB7CiAgICAgICAgY29uc3QgczAgPSBzdGF0ZVtqXTsKICAgICAgICBjb25zdCBzMSA9IHN0YXRlW2ogKyAxXTsKICAgICAgICBjb25zdCBzMiA9IHN0YXRlW2ogKyAyXTsKICAgICAgICBjb25zdCBzMyA9IHN0YXRlW2ogKyAzXTsKICAgICAgICB0ID0gczAgXiBzMSBeIHMyIF4gczM7CiAgICAgICAgc3RhdGVbal0gXj0gdCBeIHRoaXMuX21peENvbFtzMCBeIHMxXTsKICAgICAgICBzdGF0ZVtqICsgMV0gXj0gdCBeIHRoaXMuX21peENvbFtzMSBeIHMyXTsKICAgICAgICBzdGF0ZVtqICsgMl0gXj0gdCBeIHRoaXMuX21peENvbFtzMiBeIHMzXTsKICAgICAgICBzdGF0ZVtqICsgM10gXj0gdCBeIHRoaXMuX21peENvbFtzMyBeIHMwXTsKICAgICAgfQogICAgICBmb3IgKGxldCBqID0gMCwgayA9IGkgKiAxNjsgaiA8IDE2OyArK2osICsraykgewogICAgICAgIHN0YXRlW2pdIF49IGtleVtrXTsKICAgICAgfQogICAgfQogICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgIHN0YXRlW2pdID0gc1tzdGF0ZVtqXV07CiAgICB9CiAgICB2ID0gc3RhdGVbMV07CiAgICBzdGF0ZVsxXSA9IHN0YXRlWzVdOwogICAgc3RhdGVbNV0gPSBzdGF0ZVs5XTsKICAgIHN0YXRlWzldID0gc3RhdGVbMTNdOwogICAgc3RhdGVbMTNdID0gdjsKICAgIHYgPSBzdGF0ZVsyXTsKICAgIHUgPSBzdGF0ZVs2XTsKICAgIHN0YXRlWzJdID0gc3RhdGVbMTBdOwogICAgc3RhdGVbNl0gPSBzdGF0ZVsxNF07CiAgICBzdGF0ZVsxMF0gPSB2OwogICAgc3RhdGVbMTRdID0gdTsKICAgIHYgPSBzdGF0ZVszXTsKICAgIHUgPSBzdGF0ZVs3XTsKICAgIHQgPSBzdGF0ZVsxMV07CiAgICBzdGF0ZVszXSA9IHN0YXRlWzE1XTsKICAgIHN0YXRlWzddID0gdjsKICAgIHN0YXRlWzExXSA9IHU7CiAgICBzdGF0ZVsxNV0gPSB0OwogICAgZm9yIChsZXQgaiA9IDAsIGsgPSB0aGlzLl9rZXlTaXplOyBqIDwgMTY7ICsraiwgKytrKSB7CiAgICAgIHN0YXRlW2pdIF49IGtleVtrXTsKICAgIH0KICAgIHJldHVybiBzdGF0ZTsKICB9CiAgX2RlY3J5cHRCbG9jazIoZGF0YSwgZmluYWxpemUpIHsKICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgbGV0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyLAogICAgICBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlclBvc2l0aW9uOwogICAgY29uc3QgcmVzdWx0ID0gW107CiAgICBsZXQgaXYgPSB0aGlzLml2OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3VyY2VMZW5ndGg7ICsraSkgewogICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoXSA9IGRhdGFbaV07CiAgICAgICsrYnVmZmVyTGVuZ3RoOwogICAgICBpZiAoYnVmZmVyTGVuZ3RoIDwgMTYpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBwbGFpbiA9IHRoaXMuX2RlY3J5cHQoYnVmZmVyLCB0aGlzLl9rZXkpOwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgICBwbGFpbltqXSBePSBpdltqXTsKICAgICAgfQogICAgICBpdiA9IGJ1ZmZlcjsKICAgICAgcmVzdWx0LnB1c2gocGxhaW4pOwogICAgICBidWZmZXIgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICAgIGJ1ZmZlckxlbmd0aCA9IDA7CiAgICB9CiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogICAgdGhpcy5pdiA9IGl2OwogICAgaWYgKHJlc3VsdC5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOwogICAgfQogICAgbGV0IG91dHB1dExlbmd0aCA9IDE2ICogcmVzdWx0Lmxlbmd0aDsKICAgIGlmIChmaW5hbGl6ZSkgewogICAgICBjb25zdCBsYXN0QmxvY2sgPSByZXN1bHQuYXQoLTEpOwogICAgICBsZXQgcHNMZW4gPSBsYXN0QmxvY2tbMTVdOwogICAgICBpZiAocHNMZW4gPD0gMTYpIHsKICAgICAgICBmb3IgKGxldCBpID0gMTUsIGlpID0gMTYgLSBwc0xlbjsgaSA+PSBpaTsgLS1pKSB7CiAgICAgICAgICBpZiAobGFzdEJsb2NrW2ldICE9PSBwc0xlbikgewogICAgICAgICAgICBwc0xlbiA9IDA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvdXRwdXRMZW5ndGggLT0gcHNMZW47CiAgICAgICAgcmVzdWx0W3Jlc3VsdC5sZW5ndGggLSAxXSA9IGxhc3RCbG9jay5zdWJhcnJheSgwLCAxNiAtIHBzTGVuKTsKICAgICAgfQogICAgfQogICAgY29uc3Qgb3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkob3V0cHV0TGVuZ3RoKTsKICAgIGZvciAobGV0IGkgPSAwLCBqID0gMCwgaWkgPSByZXN1bHQubGVuZ3RoOyBpIDwgaWk7ICsraSwgaiArPSAxNikgewogICAgICBvdXRwdXQuc2V0KHJlc3VsdFtpXSwgaik7CiAgICB9CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICBkZWNyeXB0QmxvY2soZGF0YSwgZmluYWxpemUsIGl2ID0gbnVsbCkgewogICAgY29uc3Qgc291cmNlTGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmJ1ZmZlcjsKICAgIGxldCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlclBvc2l0aW9uOwogICAgaWYgKGl2KSB7CiAgICAgIHRoaXMuaXYgPSBpdjsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBidWZmZXJMZW5ndGggPCAxNiAmJiBpIDwgc291cmNlTGVuZ3RoOyArK2ksICsrYnVmZmVyTGVuZ3RoKSB7CiAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aF0gPSBkYXRhW2ldOwogICAgICB9CiAgICAgIGlmIChidWZmZXJMZW5ndGggPCAxNikgewogICAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgICAgfQogICAgICB0aGlzLml2ID0gYnVmZmVyOwogICAgICBkYXRhID0gZGF0YS5zdWJhcnJheSgxNik7CiAgICB9CiAgICB0aGlzLmJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gMDsKICAgIHRoaXMuZGVjcnlwdEJsb2NrID0gdGhpcy5fZGVjcnlwdEJsb2NrMjsKICAgIHJldHVybiB0aGlzLmRlY3J5cHRCbG9jayhkYXRhLCBmaW5hbGl6ZSk7CiAgfQogIGVuY3J5cHQoZGF0YSwgaXYpIHsKICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgbGV0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyLAogICAgICBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlclBvc2l0aW9uOwogICAgY29uc3QgcmVzdWx0ID0gW107CiAgICBpdiB8fD0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3VyY2VMZW5ndGg7ICsraSkgewogICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoXSA9IGRhdGFbaV07CiAgICAgICsrYnVmZmVyTGVuZ3RoOwogICAgICBpZiAoYnVmZmVyTGVuZ3RoIDwgMTYpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgICBidWZmZXJbal0gXj0gaXZbal07CiAgICAgIH0KICAgICAgY29uc3QgY2lwaGVyID0gdGhpcy5fZW5jcnlwdChidWZmZXIsIHRoaXMuX2tleSk7CiAgICAgIGl2ID0gY2lwaGVyOwogICAgICByZXN1bHQucHVzaChjaXBoZXIpOwogICAgICBidWZmZXIgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICAgIGJ1ZmZlckxlbmd0aCA9IDA7CiAgICB9CiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogICAgdGhpcy5pdiA9IGl2OwogICAgaWYgKHJlc3VsdC5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOwogICAgfQogICAgY29uc3Qgb3V0cHV0TGVuZ3RoID0gMTYgKiByZXN1bHQubGVuZ3RoOwogICAgY29uc3Qgb3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkob3V0cHV0TGVuZ3RoKTsKICAgIGZvciAobGV0IGkgPSAwLCBqID0gMCwgaWkgPSByZXN1bHQubGVuZ3RoOyBpIDwgaWk7ICsraSwgaiArPSAxNikgewogICAgICBvdXRwdXQuc2V0KHJlc3VsdFtpXSwgaik7CiAgICB9CiAgICByZXR1cm4gb3V0cHV0OwogIH0KfQpjbGFzcyBBRVMxMjhDaXBoZXIgZXh0ZW5kcyBBRVNCYXNlQ2lwaGVyIHsKICBfcmNvbiA9IG5ldyBVaW50OEFycmF5KFsweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkXSk7CiAgY29uc3RydWN0b3Ioa2V5KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uID0gMTA7CiAgICB0aGlzLl9rZXlTaXplID0gMTYwOwogICAgdGhpcy5fa2V5ID0gdGhpcy5fZXhwYW5kS2V5KGtleSk7CiAgfQogIF9leHBhbmRLZXkoY2lwaGVyS2V5KSB7CiAgICBjb25zdCBiID0gMTc2OwogICAgY29uc3QgcyA9IHRoaXMuX3M7CiAgICBjb25zdCByY29uID0gdGhpcy5fcmNvbjsKICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KGIpOwogICAgcmVzdWx0LnNldChjaXBoZXJLZXkpOwogICAgZm9yIChsZXQgaiA9IDE2LCBpID0gMTsgaiA8IGI7ICsraSkgewogICAgICBsZXQgdDEgPSByZXN1bHRbaiAtIDNdOwogICAgICBsZXQgdDIgPSByZXN1bHRbaiAtIDJdOwogICAgICBsZXQgdDMgPSByZXN1bHRbaiAtIDFdOwogICAgICBsZXQgdDQgPSByZXN1bHRbaiAtIDRdOwogICAgICB0MSA9IHNbdDFdOwogICAgICB0MiA9IHNbdDJdOwogICAgICB0MyA9IHNbdDNdOwogICAgICB0NCA9IHNbdDRdOwogICAgICB0MSBePSByY29uW2ldOwogICAgICBmb3IgKGxldCBuID0gMDsgbiA8IDQ7ICsrbikgewogICAgICAgIHJlc3VsdFtqXSA9IHQxIF49IHJlc3VsdFtqIC0gMTZdOwogICAgICAgIGorKzsKICAgICAgICByZXN1bHRbal0gPSB0MiBePSByZXN1bHRbaiAtIDE2XTsKICAgICAgICBqKys7CiAgICAgICAgcmVzdWx0W2pdID0gdDMgXj0gcmVzdWx0W2ogLSAxNl07CiAgICAgICAgaisrOwogICAgICAgIHJlc3VsdFtqXSA9IHQ0IF49IHJlc3VsdFtqIC0gMTZdOwogICAgICAgIGorKzsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0KY2xhc3MgQUVTMjU2Q2lwaGVyIGV4dGVuZHMgQUVTQmFzZUNpcGhlciB7CiAgY29uc3RydWN0b3Ioa2V5KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uID0gMTQ7CiAgICB0aGlzLl9rZXlTaXplID0gMjI0OwogICAgdGhpcy5fa2V5ID0gdGhpcy5fZXhwYW5kS2V5KGtleSk7CiAgfQogIF9leHBhbmRLZXkoY2lwaGVyS2V5KSB7CiAgICBjb25zdCBiID0gMjQwOwogICAgY29uc3QgcyA9IHRoaXMuX3M7CiAgICBjb25zdCByZXN1bHQgPSBuZXcgVWludDhBcnJheShiKTsKICAgIHJlc3VsdC5zZXQoY2lwaGVyS2V5KTsKICAgIGxldCByID0gMTsKICAgIGxldCB0MSwgdDIsIHQzLCB0NDsKICAgIGZvciAobGV0IGogPSAzMiwgaSA9IDE7IGogPCBiOyArK2kpIHsKICAgICAgaWYgKGogJSAzMiA9PT0gMTYpIHsKICAgICAgICB0MSA9IHNbdDFdOwogICAgICAgIHQyID0gc1t0Ml07CiAgICAgICAgdDMgPSBzW3QzXTsKICAgICAgICB0NCA9IHNbdDRdOwogICAgICB9IGVsc2UgaWYgKGogJSAzMiA9PT0gMCkgewogICAgICAgIHQxID0gcmVzdWx0W2ogLSAzXTsKICAgICAgICB0MiA9IHJlc3VsdFtqIC0gMl07CiAgICAgICAgdDMgPSByZXN1bHRbaiAtIDFdOwogICAgICAgIHQ0ID0gcmVzdWx0W2ogLSA0XTsKICAgICAgICB0MSA9IHNbdDFdOwogICAgICAgIHQyID0gc1t0Ml07CiAgICAgICAgdDMgPSBzW3QzXTsKICAgICAgICB0NCA9IHNbdDRdOwogICAgICAgIHQxIF49IHI7CiAgICAgICAgaWYgKChyIDw8PSAxKSA+PSAyNTYpIHsKICAgICAgICAgIHIgPSAociBeIDB4MWIpICYgMHhmZjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCA0OyArK24pIHsKICAgICAgICByZXN1bHRbal0gPSB0MSBePSByZXN1bHRbaiAtIDMyXTsKICAgICAgICBqKys7CiAgICAgICAgcmVzdWx0W2pdID0gdDIgXj0gcmVzdWx0W2ogLSAzMl07CiAgICAgICAgaisrOwogICAgICAgIHJlc3VsdFtqXSA9IHQzIF49IHJlc3VsdFtqIC0gMzJdOwogICAgICAgIGorKzsKICAgICAgICByZXN1bHRbal0gPSB0NCBePSByZXN1bHRbaiAtIDMyXTsKICAgICAgICBqKys7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQp9CmNsYXNzIFBERkJhc2UgewogIF9oYXNoKHBhc3N3b3JkLCBpbnB1dCwgdXNlckJ5dGVzKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBfaGFzaGAgY2FsbGVkIik7CiAgfQogIGNoZWNrT3duZXJQYXNzd29yZChwYXNzd29yZCwgb3duZXJWYWxpZGF0aW9uU2FsdCwgdXNlckJ5dGVzLCBvd25lclBhc3N3b3JkKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDU2KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQob3duZXJWYWxpZGF0aW9uU2FsdCwgcGFzc3dvcmQubGVuZ3RoKTsKICAgIGhhc2hEYXRhLnNldCh1c2VyQnl0ZXMsIHBhc3N3b3JkLmxlbmd0aCArIG93bmVyVmFsaWRhdGlvblNhbHQubGVuZ3RoKTsKICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2hhc2gocGFzc3dvcmQsIGhhc2hEYXRhLCB1c2VyQnl0ZXMpOwogICAgcmV0dXJuIGlzQXJyYXlFcXVhbChyZXN1bHQsIG93bmVyUGFzc3dvcmQpOwogIH0KICBjaGVja1VzZXJQYXNzd29yZChwYXNzd29yZCwgdXNlclZhbGlkYXRpb25TYWx0LCB1c2VyUGFzc3dvcmQpIHsKICAgIGNvbnN0IGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkocGFzc3dvcmQubGVuZ3RoICsgOCk7CiAgICBoYXNoRGF0YS5zZXQocGFzc3dvcmQsIDApOwogICAgaGFzaERhdGEuc2V0KHVzZXJWYWxpZGF0aW9uU2FsdCwgcGFzc3dvcmQubGVuZ3RoKTsKICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2hhc2gocGFzc3dvcmQsIGhhc2hEYXRhLCBbXSk7CiAgICByZXR1cm4gaXNBcnJheUVxdWFsKHJlc3VsdCwgdXNlclBhc3N3b3JkKTsKICB9CiAgZ2V0T3duZXJLZXkocGFzc3dvcmQsIG93bmVyS2V5U2FsdCwgdXNlckJ5dGVzLCBvd25lckVuY3J5cHRpb24pIHsKICAgIGNvbnN0IGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkocGFzc3dvcmQubGVuZ3RoICsgNTYpOwogICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgIGhhc2hEYXRhLnNldChvd25lcktleVNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBoYXNoRGF0YS5zZXQodXNlckJ5dGVzLCBwYXNzd29yZC5sZW5ndGggKyBvd25lcktleVNhbHQubGVuZ3RoKTsKICAgIGNvbnN0IGtleSA9IHRoaXMuX2hhc2gocGFzc3dvcmQsIGhhc2hEYXRhLCB1c2VyQnl0ZXMpOwogICAgY29uc3QgY2lwaGVyID0gbmV3IEFFUzI1NkNpcGhlcihrZXkpOwogICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0QmxvY2sob3duZXJFbmNyeXB0aW9uLCBmYWxzZSwgbmV3IFVpbnQ4QXJyYXkoMTYpKTsKICB9CiAgZ2V0VXNlcktleShwYXNzd29yZCwgdXNlcktleVNhbHQsIHVzZXJFbmNyeXB0aW9uKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDgpOwogICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgIGhhc2hEYXRhLnNldCh1c2VyS2V5U2FsdCwgcGFzc3dvcmQubGVuZ3RoKTsKICAgIGNvbnN0IGtleSA9IHRoaXMuX2hhc2gocGFzc3dvcmQsIGhhc2hEYXRhLCBbXSk7CiAgICBjb25zdCBjaXBoZXIgPSBuZXcgQUVTMjU2Q2lwaGVyKGtleSk7CiAgICByZXR1cm4gY2lwaGVyLmRlY3J5cHRCbG9jayh1c2VyRW5jcnlwdGlvbiwgZmFsc2UsIG5ldyBVaW50OEFycmF5KDE2KSk7CiAgfQp9CmNsYXNzIFBERjE3IGV4dGVuZHMgUERGQmFzZSB7CiAgX2hhc2gocGFzc3dvcmQsIGlucHV0LCB1c2VyQnl0ZXMpIHsKICAgIHJldHVybiBjYWxjdWxhdGVTSEEyNTYoaW5wdXQsIDAsIGlucHV0Lmxlbmd0aCk7CiAgfQp9CmNsYXNzIFBERjIwIGV4dGVuZHMgUERGQmFzZSB7CiAgX2hhc2gocGFzc3dvcmQsIGlucHV0LCB1c2VyQnl0ZXMpIHsKICAgIGxldCBrID0gY2FsY3VsYXRlU0hBMjU2KGlucHV0LCAwLCBpbnB1dC5sZW5ndGgpLnN1YmFycmF5KDAsIDMyKTsKICAgIGxldCBlID0gWzBdOwogICAgbGV0IGkgPSAwOwogICAgd2hpbGUgKGkgPCA2NCB8fCBlLmF0KC0xKSA+IGkgLSAzMikgewogICAgICBjb25zdCBjb21iaW5lZExlbmd0aCA9IHBhc3N3b3JkLmxlbmd0aCArIGsubGVuZ3RoICsgdXNlckJ5dGVzLmxlbmd0aCwKICAgICAgICBjb21iaW5lZEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoY29tYmluZWRMZW5ndGgpOwogICAgICBsZXQgd3JpdGVPZmZzZXQgPSAwOwogICAgICBjb21iaW5lZEFycmF5LnNldChwYXNzd29yZCwgd3JpdGVPZmZzZXQpOwogICAgICB3cml0ZU9mZnNldCArPSBwYXNzd29yZC5sZW5ndGg7CiAgICAgIGNvbWJpbmVkQXJyYXkuc2V0KGssIHdyaXRlT2Zmc2V0KTsKICAgICAgd3JpdGVPZmZzZXQgKz0gay5sZW5ndGg7CiAgICAgIGNvbWJpbmVkQXJyYXkuc2V0KHVzZXJCeXRlcywgd3JpdGVPZmZzZXQpOwogICAgICBjb25zdCBrMSA9IG5ldyBVaW50OEFycmF5KGNvbWJpbmVkTGVuZ3RoICogNjQpOwogICAgICBmb3IgKGxldCBqID0gMCwgcG9zID0gMDsgaiA8IDY0OyBqKyssIHBvcyArPSBjb21iaW5lZExlbmd0aCkgewogICAgICAgIGsxLnNldChjb21iaW5lZEFycmF5LCBwb3MpOwogICAgICB9CiAgICAgIGNvbnN0IGNpcGhlciA9IG5ldyBBRVMxMjhDaXBoZXIoay5zdWJhcnJheSgwLCAxNikpOwogICAgICBlID0gY2lwaGVyLmVuY3J5cHQoazEsIGsuc3ViYXJyYXkoMTYsIDMyKSk7CiAgICAgIGNvbnN0IHJlbWFpbmRlciA9IE1hdGguc3VtUHJlY2lzZShlLnNsaWNlKDAsIDE2KSkgJSAzOwogICAgICBpZiAocmVtYWluZGVyID09PSAwKSB7CiAgICAgICAgayA9IGNhbGN1bGF0ZVNIQTI1NihlLCAwLCBlLmxlbmd0aCk7CiAgICAgIH0gZWxzZSBpZiAocmVtYWluZGVyID09PSAxKSB7CiAgICAgICAgayA9IGNhbGN1bGF0ZVNIQTM4NChlLCAwLCBlLmxlbmd0aCk7CiAgICAgIH0gZWxzZSBpZiAocmVtYWluZGVyID09PSAyKSB7CiAgICAgICAgayA9IGNhbGN1bGF0ZVNIQTUxMihlLCAwLCBlLmxlbmd0aCk7CiAgICAgIH0KICAgICAgaSsrOwogICAgfQogICAgcmV0dXJuIGsuc3ViYXJyYXkoMCwgMzIpOwogIH0KfQpjbGFzcyBDaXBoZXJUcmFuc2Zvcm0gewogIGNvbnN0cnVjdG9yKHN0cmluZ0NpcGhlckNvbnN0cnVjdG9yLCBzdHJlYW1DaXBoZXJDb25zdHJ1Y3RvcikgewogICAgdGhpcy5TdHJpbmdDaXBoZXJDb25zdHJ1Y3RvciA9IHN0cmluZ0NpcGhlckNvbnN0cnVjdG9yOwogICAgdGhpcy5TdHJlYW1DaXBoZXJDb25zdHJ1Y3RvciA9IHN0cmVhbUNpcGhlckNvbnN0cnVjdG9yOwogIH0KICBjcmVhdGVTdHJlYW0oc3RyZWFtLCBsZW5ndGgpIHsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyB0aGlzLlN0cmVhbUNpcGhlckNvbnN0cnVjdG9yKCk7CiAgICByZXR1cm4gbmV3IERlY3J5cHRTdHJlYW0oc3RyZWFtLCBsZW5ndGgsIGZ1bmN0aW9uIGNpcGhlclRyYW5zZm9ybURlY3J5cHRTdHJlYW0oZGF0YSwgZmluYWxpemUpIHsKICAgICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0QmxvY2soZGF0YSwgZmluYWxpemUpOwogICAgfSk7CiAgfQogIGRlY3J5cHRTdHJpbmcocykgewogICAgY29uc3QgY2lwaGVyID0gbmV3IHRoaXMuU3RyaW5nQ2lwaGVyQ29uc3RydWN0b3IoKTsKICAgIGxldCBkYXRhID0gc3RyaW5nVG9CeXRlcyhzKTsKICAgIGRhdGEgPSBjaXBoZXIuZGVjcnlwdEJsb2NrKGRhdGEsIHRydWUpOwogICAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoZGF0YSk7CiAgfQogIGVuY3J5cHRTdHJpbmcocykgewogICAgY29uc3QgY2lwaGVyID0gbmV3IHRoaXMuU3RyaW5nQ2lwaGVyQ29uc3RydWN0b3IoKTsKICAgIGlmIChjaXBoZXIgaW5zdGFuY2VvZiBBRVNCYXNlQ2lwaGVyKSB7CiAgICAgIGNvbnN0IHN0ckxlbiA9IHMubGVuZ3RoOwogICAgICBjb25zdCBwYWQgPSAxNiAtIHN0ckxlbiAlIDE2OwogICAgICBzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUocGFkKS5yZXBlYXQocGFkKTsKICAgICAgY29uc3QgaXYgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICAgIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMoaXYpOwogICAgICBsZXQgZGF0YSA9IHN0cmluZ1RvQnl0ZXMocyk7CiAgICAgIGRhdGEgPSBjaXBoZXIuZW5jcnlwdChkYXRhLCBpdik7CiAgICAgIGNvbnN0IGJ1ZiA9IG5ldyBVaW50OEFycmF5KDE2ICsgZGF0YS5sZW5ndGgpOwogICAgICBidWYuc2V0KGl2KTsKICAgICAgYnVmLnNldChkYXRhLCAxNik7CiAgICAgIHJldHVybiBieXRlc1RvU3RyaW5nKGJ1Zik7CiAgICB9CiAgICBsZXQgZGF0YSA9IHN0cmluZ1RvQnl0ZXMocyk7CiAgICBkYXRhID0gY2lwaGVyLmVuY3J5cHQoZGF0YSk7CiAgICByZXR1cm4gYnl0ZXNUb1N0cmluZyhkYXRhKTsKICB9Cn0KY2xhc3MgQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeSB7CiAgc3RhdGljIGdldCBfZGVmYXVsdFBhc3N3b3JkQnl0ZXMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfZGVmYXVsdFBhc3N3b3JkQnl0ZXMiLCBuZXcgVWludDhBcnJheShbMHgyOCwgMHhiZiwgMHg0ZSwgMHg1ZSwgMHg0ZSwgMHg3NSwgMHg4YSwgMHg0MSwgMHg2NCwgMHgwMCwgMHg0ZSwgMHg1NiwgMHhmZiwgMHhmYSwgMHgwMSwgMHgwOCwgMHgyZSwgMHgyZSwgMHgwMCwgMHhiNiwgMHhkMCwgMHg2OCwgMHgzZSwgMHg4MCwgMHgyZiwgMHgwYywgMHhhOSwgMHhmZSwgMHg2NCwgMHg1MywgMHg2OSwgMHg3YV0pKTsKICB9CiAgI2NyZWF0ZUVuY3J5cHRpb25LZXkyMChyZXZpc2lvbiwgcGFzc3dvcmQsIG93bmVyUGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIG93bmVyS2V5U2FsdCwgdUJ5dGVzLCB1c2VyUGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlcktleVNhbHQsIG93bmVyRW5jcnlwdGlvbiwgdXNlckVuY3J5cHRpb24sIHBlcm1zKSB7CiAgICBpZiAocGFzc3dvcmQpIHsKICAgICAgY29uc3QgcGFzc3dvcmRMZW5ndGggPSBNYXRoLm1pbigxMjcsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICAgIHBhc3N3b3JkID0gcGFzc3dvcmQuc3ViYXJyYXkoMCwgcGFzc3dvcmRMZW5ndGgpOwogICAgfSBlbHNlIHsKICAgICAgcGFzc3dvcmQgPSBbXTsKICAgIH0KICAgIGNvbnN0IHBkZkFsZ29yaXRobSA9IHJldmlzaW9uID09PSA2ID8gbmV3IFBERjIwKCkgOiBuZXcgUERGMTcoKTsKICAgIGlmIChwZGZBbGdvcml0aG0uY2hlY2tVc2VyUGFzc3dvcmQocGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlclBhc3N3b3JkKSkgewogICAgICByZXR1cm4gcGRmQWxnb3JpdGhtLmdldFVzZXJLZXkocGFzc3dvcmQsIHVzZXJLZXlTYWx0LCB1c2VyRW5jcnlwdGlvbik7CiAgICB9IGVsc2UgaWYgKHBhc3N3b3JkLmxlbmd0aCAmJiBwZGZBbGdvcml0aG0uY2hlY2tPd25lclBhc3N3b3JkKHBhc3N3b3JkLCBvd25lclZhbGlkYXRpb25TYWx0LCB1Qnl0ZXMsIG93bmVyUGFzc3dvcmQpKSB7CiAgICAgIHJldHVybiBwZGZBbGdvcml0aG0uZ2V0T3duZXJLZXkocGFzc3dvcmQsIG93bmVyS2V5U2FsdCwgdUJ5dGVzLCBvd25lckVuY3J5cHRpb24pOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogICNwcmVwYXJlS2V5RGF0YShmaWxlSWQsIHBhc3N3b3JkLCBvd25lclBhc3N3b3JkLCB1c2VyUGFzc3dvcmQsIGZsYWdzLCByZXZpc2lvbiwga2V5TGVuZ3RoLCBlbmNyeXB0TWV0YWRhdGEpIHsKICAgIGNvbnN0IGhhc2hEYXRhU2l6ZSA9IDQwICsgb3duZXJQYXNzd29yZC5sZW5ndGggKyBmaWxlSWQubGVuZ3RoOwogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShoYXNoRGF0YVNpemUpOwogICAgbGV0IGkgPSAwLAogICAgICBqLAogICAgICBuOwogICAgaWYgKHBhc3N3b3JkKSB7CiAgICAgIG4gPSBNYXRoLm1pbigzMiwgcGFzc3dvcmQubGVuZ3RoKTsKICAgICAgZm9yICg7IGkgPCBuOyArK2kpIHsKICAgICAgICBoYXNoRGF0YVtpXSA9IHBhc3N3b3JkW2ldOwogICAgICB9CiAgICB9CiAgICBqID0gMDsKICAgIHdoaWxlIChpIDwgMzIpIHsKICAgICAgaGFzaERhdGFbaSsrXSA9IENpcGhlclRyYW5zZm9ybUZhY3RvcnkuX2RlZmF1bHRQYXNzd29yZEJ5dGVzW2orK107CiAgICB9CiAgICBoYXNoRGF0YS5zZXQob3duZXJQYXNzd29yZCwgaSk7CiAgICBpICs9IG93bmVyUGFzc3dvcmQubGVuZ3RoOwogICAgaGFzaERhdGFbaSsrXSA9IGZsYWdzICYgMHhmZjsKICAgIGhhc2hEYXRhW2krK10gPSBmbGFncyA+PiA4ICYgMHhmZjsKICAgIGhhc2hEYXRhW2krK10gPSBmbGFncyA+PiAxNiAmIDB4ZmY7CiAgICBoYXNoRGF0YVtpKytdID0gZmxhZ3MgPj4+IDI0ICYgMHhmZjsKICAgIGhhc2hEYXRhLnNldChmaWxlSWQsIGkpOwogICAgaSArPSBmaWxlSWQubGVuZ3RoOwogICAgaWYgKHJldmlzaW9uID49IDQgJiYgIWVuY3J5cHRNZXRhZGF0YSkgewogICAgICBoYXNoRGF0YS5maWxsKDB4ZmYsIGksIGkgKyA0KTsKICAgICAgaSArPSA0OwogICAgfQogICAgbGV0IGhhc2ggPSBjYWxjdWxhdGVNRDUoaGFzaERhdGEsIDAsIGkpOwogICAgY29uc3Qga2V5TGVuZ3RoSW5CeXRlcyA9IGtleUxlbmd0aCA+PiAzOwogICAgaWYgKHJldmlzaW9uID49IDMpIHsKICAgICAgZm9yIChqID0gMDsgaiA8IDUwOyArK2opIHsKICAgICAgICBoYXNoID0gY2FsY3VsYXRlTUQ1KGhhc2gsIDAsIGtleUxlbmd0aEluQnl0ZXMpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBlbmNyeXB0aW9uS2V5ID0gaGFzaC5zdWJhcnJheSgwLCBrZXlMZW5ndGhJbkJ5dGVzKTsKICAgIGxldCBjaXBoZXIsIGNoZWNrRGF0YTsKICAgIGlmIChyZXZpc2lvbiA+PSAzKSB7CiAgICAgIGkgPSAwOwogICAgICBoYXNoRGF0YS5zZXQoQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeS5fZGVmYXVsdFBhc3N3b3JkQnl0ZXMsIGkpOwogICAgICBpICs9IDMyOwogICAgICBoYXNoRGF0YS5zZXQoZmlsZUlkLCBpKTsKICAgICAgaSArPSBmaWxlSWQubGVuZ3RoOwogICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihlbmNyeXB0aW9uS2V5KTsKICAgICAgY2hlY2tEYXRhID0gY2lwaGVyLmVuY3J5cHRCbG9jayhjYWxjdWxhdGVNRDUoaGFzaERhdGEsIDAsIGkpKTsKICAgICAgbiA9IGVuY3J5cHRpb25LZXkubGVuZ3RoOwogICAgICBjb25zdCBkZXJpdmVkS2V5ID0gbmV3IFVpbnQ4QXJyYXkobik7CiAgICAgIGZvciAoaiA9IDE7IGogPD0gMTk7ICsraikgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbjsgKytrKSB7CiAgICAgICAgICBkZXJpdmVkS2V5W2tdID0gZW5jcnlwdGlvbktleVtrXSBeIGo7CiAgICAgICAgfQogICAgICAgIGNpcGhlciA9IG5ldyBBUkNGb3VyQ2lwaGVyKGRlcml2ZWRLZXkpOwogICAgICAgIGNoZWNrRGF0YSA9IGNpcGhlci5lbmNyeXB0QmxvY2soY2hlY2tEYXRhKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY2lwaGVyID0gbmV3IEFSQ0ZvdXJDaXBoZXIoZW5jcnlwdGlvbktleSk7CiAgICAgIGNoZWNrRGF0YSA9IGNpcGhlci5lbmNyeXB0QmxvY2soQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeS5fZGVmYXVsdFBhc3N3b3JkQnl0ZXMpOwogICAgfQogICAgcmV0dXJuIGNoZWNrRGF0YS5ldmVyeSgoZGF0YSwgaykgPT4gdXNlclBhc3N3b3JkW2tdID09PSBkYXRhKSA/IGVuY3J5cHRpb25LZXkgOiBudWxsOwogIH0KICAjZGVjb2RlVXNlclBhc3N3b3JkKHBhc3N3b3JkLCBvd25lclBhc3N3b3JkLCByZXZpc2lvbiwga2V5TGVuZ3RoKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KDMyKTsKICAgIGxldCBpID0gMDsKICAgIGNvbnN0IG4gPSBNYXRoLm1pbigzMiwgcGFzc3dvcmQubGVuZ3RoKTsKICAgIGZvciAoOyBpIDwgbjsgKytpKSB7CiAgICAgIGhhc2hEYXRhW2ldID0gcGFzc3dvcmRbaV07CiAgICB9CiAgICBsZXQgaiA9IDA7CiAgICB3aGlsZSAoaSA8IDMyKSB7CiAgICAgIGhhc2hEYXRhW2krK10gPSBDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5Ll9kZWZhdWx0UGFzc3dvcmRCeXRlc1tqKytdOwogICAgfQogICAgbGV0IGhhc2ggPSBjYWxjdWxhdGVNRDUoaGFzaERhdGEsIDAsIGkpOwogICAgY29uc3Qga2V5TGVuZ3RoSW5CeXRlcyA9IGtleUxlbmd0aCA+PiAzOwogICAgaWYgKHJldmlzaW9uID49IDMpIHsKICAgICAgZm9yIChqID0gMDsgaiA8IDUwOyArK2opIHsKICAgICAgICBoYXNoID0gY2FsY3VsYXRlTUQ1KGhhc2gsIDAsIGhhc2gubGVuZ3RoKTsKICAgICAgfQogICAgfQogICAgbGV0IGNpcGhlciwgdXNlclBhc3N3b3JkOwogICAgaWYgKHJldmlzaW9uID49IDMpIHsKICAgICAgdXNlclBhc3N3b3JkID0gb3duZXJQYXNzd29yZDsKICAgICAgY29uc3QgZGVyaXZlZEtleSA9IG5ldyBVaW50OEFycmF5KGtleUxlbmd0aEluQnl0ZXMpOwogICAgICBmb3IgKGogPSAxOTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGtleUxlbmd0aEluQnl0ZXM7ICsraykgewogICAgICAgICAgZGVyaXZlZEtleVtrXSA9IGhhc2hba10gXiBqOwogICAgICAgIH0KICAgICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihkZXJpdmVkS2V5KTsKICAgICAgICB1c2VyUGFzc3dvcmQgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKHVzZXJQYXNzd29yZCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNpcGhlciA9IG5ldyBBUkNGb3VyQ2lwaGVyKGhhc2guc3ViYXJyYXkoMCwga2V5TGVuZ3RoSW5CeXRlcykpOwogICAgICB1c2VyUGFzc3dvcmQgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKG93bmVyUGFzc3dvcmQpOwogICAgfQogICAgcmV0dXJuIHVzZXJQYXNzd29yZDsKICB9CiAgI2J1aWxkT2JqZWN0S2V5KG51bSwgZ2VuLCBlbmNyeXB0aW9uS2V5LCBpc0FlcyA9IGZhbHNlKSB7CiAgICBjb25zdCBuID0gZW5jcnlwdGlvbktleS5sZW5ndGg7CiAgICBjb25zdCBrZXkgPSBuZXcgVWludDhBcnJheShuICsgOSk7CiAgICBrZXkuc2V0KGVuY3J5cHRpb25LZXkpOwogICAgbGV0IGkgPSBuOwogICAga2V5W2krK10gPSBudW0gJiAweGZmOwogICAga2V5W2krK10gPSBudW0gPj4gOCAmIDB4ZmY7CiAgICBrZXlbaSsrXSA9IG51bSA+PiAxNiAmIDB4ZmY7CiAgICBrZXlbaSsrXSA9IGdlbiAmIDB4ZmY7CiAgICBrZXlbaSsrXSA9IGdlbiA+PiA4ICYgMHhmZjsKICAgIGlmIChpc0FlcykgewogICAgICBrZXlbaSsrXSA9IDB4NzM7CiAgICAgIGtleVtpKytdID0gMHg0MTsKICAgICAga2V5W2krK10gPSAweDZjOwogICAgICBrZXlbaSsrXSA9IDB4NTQ7CiAgICB9CiAgICBjb25zdCBoYXNoID0gY2FsY3VsYXRlTUQ1KGtleSwgMCwgaSk7CiAgICByZXR1cm4gaGFzaC5zdWJhcnJheSgwLCBNYXRoLm1pbihuICsgNSwgMTYpKTsKICB9CiAgI2J1aWxkQ2lwaGVyQ29uc3RydWN0b3IoY2YsIG5hbWUsIG51bSwgZ2VuLCBrZXkpIHsKICAgIGlmICghKG5hbWUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgY3J5cHQgZmlsdGVyIG5hbWUuIik7CiAgICB9CiAgICBjb25zdCBzZWxmID0gdGhpczsKICAgIGNvbnN0IGNyeXB0RmlsdGVyID0gY2YuZ2V0KG5hbWUubmFtZSk7CiAgICBjb25zdCBjZm0gPSBjcnlwdEZpbHRlcj8uZ2V0KCJDRk0iKTsKICAgIGlmICghY2ZtIHx8IGNmbS5uYW1lID09PSAiTm9uZSIpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IE51bGxDaXBoZXIoKTsKICAgICAgfTsKICAgIH0KICAgIGlmIChjZm0ubmFtZSA9PT0gIlYyIikgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgQVJDRm91ckNpcGhlcihzZWxmLiNidWlsZE9iamVjdEtleShudW0sIGdlbiwga2V5LCBmYWxzZSkpOwogICAgICB9OwogICAgfQogICAgaWYgKGNmbS5uYW1lID09PSAiQUVTVjIiKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBRVMxMjhDaXBoZXIoc2VsZi4jYnVpbGRPYmplY3RLZXkobnVtLCBnZW4sIGtleSwgdHJ1ZSkpOwogICAgICB9OwogICAgfQogICAgaWYgKGNmbS5uYW1lID09PSAiQUVTVjMiKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBRVMyNTZDaXBoZXIoa2V5KTsKICAgICAgfTsKICAgIH0KICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVW5rbm93biBjcnlwdG8gbWV0aG9kIik7CiAgfQogIGNvbnN0cnVjdG9yKGRpY3QsIGZpbGVJZCwgcGFzc3dvcmQpIHsKICAgIGNvbnN0IGZpbHRlciA9IGRpY3QuZ2V0KCJGaWx0ZXIiKTsKICAgIGlmICghaXNOYW1lKGZpbHRlciwgIlN0YW5kYXJkIikpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJ1bmtub3duIGVuY3J5cHRpb24gbWV0aG9kIik7CiAgICB9CiAgICB0aGlzLmZpbHRlck5hbWUgPSBmaWx0ZXIubmFtZTsKICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICBjb25zdCBhbGdvcml0aG0gPSBkaWN0LmdldCgiViIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGFsZ29yaXRobSkgfHwgYWxnb3JpdGhtICE9PSAxICYmIGFsZ29yaXRobSAhPT0gMiAmJiBhbGdvcml0aG0gIT09IDQgJiYgYWxnb3JpdGhtICE9PSA1KSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigidW5zdXBwb3J0ZWQgZW5jcnlwdGlvbiBhbGdvcml0aG0iKTsKICAgIH0KICAgIHRoaXMuYWxnb3JpdGhtID0gYWxnb3JpdGhtOwogICAgbGV0IGtleUxlbmd0aCA9IGRpY3QuZ2V0KCJMZW5ndGgiKTsKICAgIGlmICgha2V5TGVuZ3RoKSB7CiAgICAgIGlmIChhbGdvcml0aG0gPD0gMykgewogICAgICAgIGtleUxlbmd0aCA9IDQwOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGNmRGljdCA9IGRpY3QuZ2V0KCJDRiIpOwogICAgICAgIGNvbnN0IHN0cmVhbUNyeXB0b05hbWUgPSBkaWN0LmdldCgiU3RtRiIpOwogICAgICAgIGlmIChjZkRpY3QgaW5zdGFuY2VvZiBEaWN0ICYmIHN0cmVhbUNyeXB0b05hbWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICBjZkRpY3Quc3VwcHJlc3NFbmNyeXB0aW9uID0gdHJ1ZTsKICAgICAgICAgIGNvbnN0IGhhbmRsZXJEaWN0ID0gY2ZEaWN0LmdldChzdHJlYW1DcnlwdG9OYW1lLm5hbWUpOwogICAgICAgICAga2V5TGVuZ3RoID0gaGFuZGxlckRpY3Q/LmdldCgiTGVuZ3RoIikgfHwgMTI4OwogICAgICAgICAgaWYgKGtleUxlbmd0aCA8IDQwKSB7CiAgICAgICAgICAgIGtleUxlbmd0aCA8PD0gMzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihrZXlMZW5ndGgpIHx8IGtleUxlbmd0aCA8IDQwIHx8IGtleUxlbmd0aCAlIDggIT09IDApIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJpbnZhbGlkIGtleSBsZW5ndGgiKTsKICAgIH0KICAgIGNvbnN0IG93bmVyQnl0ZXMgPSBzdHJpbmdUb0J5dGVzKGRpY3QuZ2V0KCJPIikpLAogICAgICB1c2VyQnl0ZXMgPSBzdHJpbmdUb0J5dGVzKGRpY3QuZ2V0KCJVIikpOwogICAgY29uc3Qgb3duZXJQYXNzd29yZCA9IG93bmVyQnl0ZXMuc3ViYXJyYXkoMCwgMzIpOwogICAgY29uc3QgdXNlclBhc3N3b3JkID0gdXNlckJ5dGVzLnN1YmFycmF5KDAsIDMyKTsKICAgIGNvbnN0IGZsYWdzID0gZGljdC5nZXQoIlAiKTsKICAgIGNvbnN0IHJldmlzaW9uID0gZGljdC5nZXQoIlIiKTsKICAgIGNvbnN0IGVuY3J5cHRNZXRhZGF0YSA9IChhbGdvcml0aG0gPT09IDQgfHwgYWxnb3JpdGhtID09PSA1KSAmJiBkaWN0LmdldCgiRW5jcnlwdE1ldGFkYXRhIikgIT09IGZhbHNlOwogICAgdGhpcy5lbmNyeXB0TWV0YWRhdGEgPSBlbmNyeXB0TWV0YWRhdGE7CiAgICBjb25zdCBmaWxlSWRCeXRlcyA9IHN0cmluZ1RvQnl0ZXMoZmlsZUlkKTsKICAgIGxldCBwYXNzd29yZEJ5dGVzOwogICAgaWYgKHBhc3N3b3JkKSB7CiAgICAgIGlmIChyZXZpc2lvbiA9PT0gNikgewogICAgICAgIHRyeSB7CiAgICAgICAgICBwYXNzd29yZCA9IHV0ZjhTdHJpbmdUb1N0cmluZyhwYXNzd29yZCk7CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICB3YXJuKCJDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5OiBVbmFibGUgdG8gY29udmVydCBVVEY4IGVuY29kZWQgcGFzc3dvcmQuIik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHBhc3N3b3JkQnl0ZXMgPSBzdHJpbmdUb0J5dGVzKHBhc3N3b3JkKTsKICAgIH0KICAgIGxldCBlbmNyeXB0aW9uS2V5OwogICAgaWYgKGFsZ29yaXRobSAhPT0gNSkgewogICAgICBlbmNyeXB0aW9uS2V5ID0gdGhpcy4jcHJlcGFyZUtleURhdGEoZmlsZUlkQnl0ZXMsIHBhc3N3b3JkQnl0ZXMsIG93bmVyUGFzc3dvcmQsIHVzZXJQYXNzd29yZCwgZmxhZ3MsIHJldmlzaW9uLCBrZXlMZW5ndGgsIGVuY3J5cHRNZXRhZGF0YSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBvd25lclZhbGlkYXRpb25TYWx0ID0gb3duZXJCeXRlcy5zdWJhcnJheSgzMiwgNDApOwogICAgICBjb25zdCBvd25lcktleVNhbHQgPSBvd25lckJ5dGVzLnN1YmFycmF5KDQwLCA0OCk7CiAgICAgIGNvbnN0IHVCeXRlcyA9IHVzZXJCeXRlcy5zdWJhcnJheSgwLCA0OCk7CiAgICAgIGNvbnN0IHVzZXJWYWxpZGF0aW9uU2FsdCA9IHVzZXJCeXRlcy5zdWJhcnJheSgzMiwgNDApOwogICAgICBjb25zdCB1c2VyS2V5U2FsdCA9IHVzZXJCeXRlcy5zdWJhcnJheSg0MCwgNDgpOwogICAgICBjb25zdCBvd25lckVuY3J5cHRpb24gPSBzdHJpbmdUb0J5dGVzKGRpY3QuZ2V0KCJPRSIpKTsKICAgICAgY29uc3QgdXNlckVuY3J5cHRpb24gPSBzdHJpbmdUb0J5dGVzKGRpY3QuZ2V0KCJVRSIpKTsKICAgICAgY29uc3QgcGVybXMgPSBzdHJpbmdUb0J5dGVzKGRpY3QuZ2V0KCJQZXJtcyIpKTsKICAgICAgZW5jcnlwdGlvbktleSA9IHRoaXMuI2NyZWF0ZUVuY3J5cHRpb25LZXkyMChyZXZpc2lvbiwgcGFzc3dvcmRCeXRlcywgb3duZXJQYXNzd29yZCwgb3duZXJWYWxpZGF0aW9uU2FsdCwgb3duZXJLZXlTYWx0LCB1Qnl0ZXMsIHVzZXJQYXNzd29yZCwgdXNlclZhbGlkYXRpb25TYWx0LCB1c2VyS2V5U2FsdCwgb3duZXJFbmNyeXB0aW9uLCB1c2VyRW5jcnlwdGlvbiwgcGVybXMpOwogICAgfQogICAgaWYgKCFlbmNyeXB0aW9uS2V5KSB7CiAgICAgIGlmICghcGFzc3dvcmQpIHsKICAgICAgICB0aHJvdyBuZXcgUGFzc3dvcmRFeGNlcHRpb24oIk5vIHBhc3N3b3JkIGdpdmVuIiwgUGFzc3dvcmRSZXNwb25zZXMuTkVFRF9QQVNTV09SRCk7CiAgICAgIH0KICAgICAgY29uc3QgZGVjb2RlZFBhc3N3b3JkID0gdGhpcy4jZGVjb2RlVXNlclBhc3N3b3JkKHBhc3N3b3JkQnl0ZXMsIG93bmVyUGFzc3dvcmQsIHJldmlzaW9uLCBrZXlMZW5ndGgpOwogICAgICBlbmNyeXB0aW9uS2V5ID0gdGhpcy4jcHJlcGFyZUtleURhdGEoZmlsZUlkQnl0ZXMsIGRlY29kZWRQYXNzd29yZCwgb3duZXJQYXNzd29yZCwgdXNlclBhc3N3b3JkLCBmbGFncywgcmV2aXNpb24sIGtleUxlbmd0aCwgZW5jcnlwdE1ldGFkYXRhKTsKICAgIH0KICAgIGlmICghZW5jcnlwdGlvbktleSkgewogICAgICB0aHJvdyBuZXcgUGFzc3dvcmRFeGNlcHRpb24oIkluY29ycmVjdCBQYXNzd29yZCIsIFBhc3N3b3JkUmVzcG9uc2VzLklOQ09SUkVDVF9QQVNTV09SRCk7CiAgICB9CiAgICBpZiAoYWxnb3JpdGhtID09PSA0ICYmIGVuY3J5cHRpb25LZXkubGVuZ3RoIDwgMTYpIHsKICAgICAgdGhpcy5lbmNyeXB0aW9uS2V5ID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICB0aGlzLmVuY3J5cHRpb25LZXkuc2V0KGVuY3J5cHRpb25LZXkpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5lbmNyeXB0aW9uS2V5ID0gZW5jcnlwdGlvbktleTsKICAgIH0KICAgIGlmIChhbGdvcml0aG0gPj0gNCkgewogICAgICBjb25zdCBjZiA9IGRpY3QuZ2V0KCJDRiIpOwogICAgICBpZiAoY2YgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY2Yuc3VwcHJlc3NFbmNyeXB0aW9uID0gdHJ1ZTsKICAgICAgfQogICAgICB0aGlzLmNmID0gY2Y7CiAgICAgIHRoaXMuc3RtZiA9IGRpY3QuZ2V0KCJTdG1GIikgfHwgTmFtZS5nZXQoIklkZW50aXR5Iik7CiAgICAgIHRoaXMuc3RyZiA9IGRpY3QuZ2V0KCJTdHJGIikgfHwgTmFtZS5nZXQoIklkZW50aXR5Iik7CiAgICAgIHRoaXMuZWZmID0gZGljdC5nZXQoIkVGRiIpIHx8IHRoaXMuc3RtZjsKICAgIH0KICB9CiAgY3JlYXRlQ2lwaGVyVHJhbnNmb3JtKG51bSwgZ2VuKSB7CiAgICBpZiAodGhpcy5hbGdvcml0aG0gPT09IDQgfHwgdGhpcy5hbGdvcml0aG0gPT09IDUpIHsKICAgICAgcmV0dXJuIG5ldyBDaXBoZXJUcmFuc2Zvcm0odGhpcy4jYnVpbGRDaXBoZXJDb25zdHJ1Y3Rvcih0aGlzLmNmLCB0aGlzLnN0cmYsIG51bSwgZ2VuLCB0aGlzLmVuY3J5cHRpb25LZXkpLCB0aGlzLiNidWlsZENpcGhlckNvbnN0cnVjdG9yKHRoaXMuY2YsIHRoaXMuc3RtZiwgbnVtLCBnZW4sIHRoaXMuZW5jcnlwdGlvbktleSkpOwogICAgfQogICAgY29uc3Qga2V5ID0gdGhpcy4jYnVpbGRPYmplY3RLZXkobnVtLCBnZW4sIHRoaXMuZW5jcnlwdGlvbktleSwgZmFsc2UpOwogICAgY29uc3QgY2lwaGVyQ29uc3RydWN0b3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBuZXcgQVJDRm91ckNpcGhlcihrZXkpOwogICAgfTsKICAgIHJldHVybiBuZXcgQ2lwaGVyVHJhbnNmb3JtKGNpcGhlckNvbnN0cnVjdG9yLCBjaXBoZXJDb25zdHJ1Y3Rvcik7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94cmVmLmpzCgoKCgoKCmNsYXNzIFhSZWYgewogIGNvbnN0cnVjdG9yKHN0cmVhbSwgcGRmTWFuYWdlcikgewogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLnBkZk1hbmFnZXIgPSBwZGZNYW5hZ2VyOwogICAgdGhpcy5lbnRyaWVzID0gW107CiAgICB0aGlzLl94cmVmU3RtcyA9IG5ldyBTZXQoKTsKICAgIHRoaXMuX2NhY2hlTWFwID0gbmV3IE1hcCgpOwogICAgdGhpcy5fcGVuZGluZ1JlZnMgPSBuZXcgUmVmU2V0KCk7CiAgICB0aGlzLl9uZXdQZXJzaXN0ZW50UmVmTnVtID0gbnVsbDsKICAgIHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bSA9IG51bGw7CiAgICB0aGlzLl9wZXJzaXN0ZW50UmVmc0NhY2hlID0gbnVsbDsKICB9CiAgZ2V0TmV3UGVyc2lzdGVudFJlZihvYmopIHsKICAgIGlmICh0aGlzLl9uZXdQZXJzaXN0ZW50UmVmTnVtID09PSBudWxsKSB7CiAgICAgIHRoaXMuX25ld1BlcnNpc3RlbnRSZWZOdW0gPSB0aGlzLmVudHJpZXMubGVuZ3RoIHx8IDE7CiAgICB9CiAgICBjb25zdCBudW0gPSB0aGlzLl9uZXdQZXJzaXN0ZW50UmVmTnVtKys7CiAgICB0aGlzLl9jYWNoZU1hcC5zZXQobnVtLCBvYmopOwogICAgcmV0dXJuIFJlZi5nZXQobnVtLCAwKTsKICB9CiAgZ2V0TmV3VGVtcG9yYXJ5UmVmKCkgewogICAgaWYgKHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bSA9PT0gbnVsbCkgewogICAgICB0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPSB0aGlzLmVudHJpZXMubGVuZ3RoIHx8IDE7CiAgICAgIGlmICh0aGlzLl9uZXdQZXJzaXN0ZW50UmVmTnVtKSB7CiAgICAgICAgdGhpcy5fcGVyc2lzdGVudFJlZnNDYWNoZSA9IG5ldyBNYXAoKTsKICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5fbmV3VGVtcG9yYXJ5UmVmTnVtOyBpIDwgdGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bTsgaSsrKSB7CiAgICAgICAgICB0aGlzLl9wZXJzaXN0ZW50UmVmc0NhY2hlLnNldChpLCB0aGlzLl9jYWNoZU1hcC5nZXQoaSkpOwogICAgICAgICAgdGhpcy5fY2FjaGVNYXAuZGVsZXRlKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIFJlZi5nZXQodGhpcy5fbmV3VGVtcG9yYXJ5UmVmTnVtKyssIDApOwogIH0KICByZXNldE5ld1RlbXBvcmFyeVJlZigpIHsKICAgIHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bSA9IG51bGw7CiAgICBpZiAodGhpcy5fcGVyc2lzdGVudFJlZnNDYWNoZSkgewogICAgICBmb3IgKGNvbnN0IFtudW0sIG9ial0gb2YgdGhpcy5fcGVyc2lzdGVudFJlZnNDYWNoZSkgewogICAgICAgIHRoaXMuX2NhY2hlTWFwLnNldChudW0sIG9iaik7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuX3BlcnNpc3RlbnRSZWZzQ2FjaGUgPSBudWxsOwogIH0KICBzZXRTdGFydFhSZWYoc3RhcnRYUmVmKSB7CiAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlID0gW3N0YXJ0WFJlZl07CiAgfQogIHBhcnNlKHJlY292ZXJ5TW9kZSA9IGZhbHNlKSB7CiAgICBsZXQgdHJhaWxlckRpY3Q7CiAgICBpZiAoIXJlY292ZXJ5TW9kZSkgewogICAgICB0cmFpbGVyRGljdCA9IHRoaXMucmVhZFhSZWYoKTsKICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oIkluZGV4aW5nIGFsbCBQREYgb2JqZWN0cyIpOwogICAgICB0cmFpbGVyRGljdCA9IHRoaXMuaW5kZXhPYmplY3RzKCk7CiAgICB9CiAgICB0cmFpbGVyRGljdC5hc3NpZ25YcmVmKHRoaXMpOwogICAgdGhpcy50cmFpbGVyID0gdHJhaWxlckRpY3Q7CiAgICBsZXQgZW5jcnlwdDsKICAgIHRyeSB7CiAgICAgIGVuY3J5cHQgPSB0cmFpbGVyRGljdC5nZXQoIkVuY3J5cHQiKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybihgWFJlZi5wYXJzZSAtIEludmFsaWQgIkVuY3J5cHQiIHJlZmVyZW5jZTogIiR7ZXh9Ii5gKTsKICAgIH0KICAgIGlmIChlbmNyeXB0IGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBpZHMgPSB0cmFpbGVyRGljdC5nZXQoIklEIik7CiAgICAgIGNvbnN0IGZpbGVJZCA9IGlkcz8ubGVuZ3RoID8gaWRzWzBdIDogIiI7CiAgICAgIGVuY3J5cHQuc3VwcHJlc3NFbmNyeXB0aW9uID0gdHJ1ZTsKICAgICAgdGhpcy5lbmNyeXB0ID0gbmV3IENpcGhlclRyYW5zZm9ybUZhY3RvcnkoZW5jcnlwdCwgZmlsZUlkLCB0aGlzLnBkZk1hbmFnZXIucGFzc3dvcmQpOwogICAgfQogICAgbGV0IHJvb3Q7CiAgICB0cnkgewogICAgICByb290ID0gdHJhaWxlckRpY3QuZ2V0KCJSb290Iik7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oYFhSZWYucGFyc2UgLSBJbnZhbGlkICJSb290IiByZWZlcmVuY2U6ICIke2V4fSIuYCk7CiAgICB9CiAgICBpZiAocm9vdCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBwYWdlcyA9IHJvb3QuZ2V0KCJQYWdlcyIpOwogICAgICAgIGlmIChwYWdlcyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICB0aHJvdyBleDsKICAgICAgICB9CiAgICAgICAgd2FybihgWFJlZi5wYXJzZSAtIEludmFsaWQgIlBhZ2VzIiByZWZlcmVuY2U6ICIke2V4fSIuYCk7CiAgICAgIH0KICAgIH0KICAgIGlmICghcmVjb3ZlcnlNb2RlKSB7CiAgICAgIHRocm93IG5ldyBYUmVmUGFyc2VFeGNlcHRpb24oKTsKICAgIH0KICAgIHRocm93IG5ldyBJbnZhbGlkUERGRXhjZXB0aW9uKCJJbnZhbGlkIFJvb3QgcmVmZXJlbmNlLiIpOwogIH0KICBwcm9jZXNzWFJlZlRhYmxlKHBhcnNlcikgewogICAgaWYgKCEoInRhYmxlU3RhdGUiIGluIHRoaXMpKSB7CiAgICAgIHRoaXMudGFibGVTdGF0ZSA9IHsKICAgICAgICBlbnRyeU51bTogMCwKICAgICAgICBzdHJlYW1Qb3M6IHBhcnNlci5sZXhlci5zdHJlYW0ucG9zLAogICAgICAgIHBhcnNlckJ1ZjE6IHBhcnNlci5idWYxLAogICAgICAgIHBhcnNlckJ1ZjI6IHBhcnNlci5idWYyCiAgICAgIH07CiAgICB9CiAgICBjb25zdCBvYmogPSB0aGlzLnJlYWRYUmVmVGFibGUocGFyc2VyKTsKICAgIGlmICghaXNDbWQob2JqLCAidHJhaWxlciIpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHRhYmxlOiBjb3VsZCBub3QgZmluZCB0cmFpbGVyIGRpY3Rpb25hcnkiKTsKICAgIH0KICAgIGxldCBkaWN0ID0gcGFyc2VyLmdldE9iaigpOwogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpICYmIGRpY3QuZGljdCkgewogICAgICBkaWN0ID0gZGljdC5kaWN0OwogICAgfQogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHRhYmxlOiBjb3VsZCBub3QgcGFyc2UgdHJhaWxlciBkaWN0aW9uYXJ5Iik7CiAgICB9CiAgICBkZWxldGUgdGhpcy50YWJsZVN0YXRlOwogICAgcmV0dXJuIGRpY3Q7CiAgfQogIHJlYWRYUmVmVGFibGUocGFyc2VyKSB7CiAgICBjb25zdCBzdHJlYW0gPSBwYXJzZXIubGV4ZXIuc3RyZWFtOwogICAgY29uc3QgdGFibGVTdGF0ZSA9IHRoaXMudGFibGVTdGF0ZTsKICAgIHN0cmVhbS5wb3MgPSB0YWJsZVN0YXRlLnN0cmVhbVBvczsKICAgIHBhcnNlci5idWYxID0gdGFibGVTdGF0ZS5wYXJzZXJCdWYxOwogICAgcGFyc2VyLmJ1ZjIgPSB0YWJsZVN0YXRlLnBhcnNlckJ1ZjI7CiAgICBsZXQgb2JqOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKCEoImZpcnN0RW50cnlOdW0iIGluIHRhYmxlU3RhdGUpIHx8ICEoImVudHJ5Q291bnQiIGluIHRhYmxlU3RhdGUpKSB7CiAgICAgICAgaWYgKGlzQ21kKG9iaiA9IHBhcnNlci5nZXRPYmooKSwgInRyYWlsZXIiKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHRhYmxlU3RhdGUuZmlyc3RFbnRyeU51bSA9IG9iajsKICAgICAgICB0YWJsZVN0YXRlLmVudHJ5Q291bnQgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIH0KICAgICAgbGV0IGZpcnN0ID0gdGFibGVTdGF0ZS5maXJzdEVudHJ5TnVtOwogICAgICBjb25zdCBjb3VudCA9IHRhYmxlU3RhdGUuZW50cnlDb3VudDsKICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZpcnN0KSB8fCAhTnVtYmVyLmlzSW50ZWdlcihjb3VudCkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiB0YWJsZTogd3JvbmcgdHlwZXMgaW4gc3Vic2VjdGlvbiBoZWFkZXIiKTsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gdGFibGVTdGF0ZS5lbnRyeU51bTsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICB0YWJsZVN0YXRlLnN0cmVhbVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgdGFibGVTdGF0ZS5lbnRyeU51bSA9IGk7CiAgICAgICAgdGFibGVTdGF0ZS5wYXJzZXJCdWYxID0gcGFyc2VyLmJ1ZjE7CiAgICAgICAgdGFibGVTdGF0ZS5wYXJzZXJCdWYyID0gcGFyc2VyLmJ1ZjI7CiAgICAgICAgY29uc3QgZW50cnkgPSB7fTsKICAgICAgICBlbnRyeS5vZmZzZXQgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgZW50cnkuZ2VuID0gcGFyc2VyLmdldE9iaigpOwogICAgICAgIGNvbnN0IHR5cGUgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBDbWQpIHsKICAgICAgICAgIHN3aXRjaCAodHlwZS5jbWQpIHsKICAgICAgICAgICAgY2FzZSAiZiI6CiAgICAgICAgICAgICAgZW50cnkuZnJlZSA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIm4iOgogICAgICAgICAgICAgIGVudHJ5LnVuY29tcHJlc3NlZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihlbnRyeS5vZmZzZXQpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKGVudHJ5LmdlbikgfHwgIShlbnRyeS5mcmVlIHx8IGVudHJ5LnVuY29tcHJlc3NlZCkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBlbnRyeSBpbiBYUmVmIHN1YnNlY3Rpb246ICR7Zmlyc3R9LCAke2NvdW50fWApOwogICAgICAgIH0KICAgICAgICBpZiAoaSA9PT0gMCAmJiBlbnRyeS5mcmVlICYmIGZpcnN0ID09PSAxKSB7CiAgICAgICAgICBmaXJzdCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5lbnRyaWVzW2kgKyBmaXJzdF0pIHsKICAgICAgICAgIHRoaXMuZW50cmllc1tpICsgZmlyc3RdID0gZW50cnk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRhYmxlU3RhdGUuZW50cnlOdW0gPSAwOwogICAgICB0YWJsZVN0YXRlLnN0cmVhbVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgIHRhYmxlU3RhdGUucGFyc2VyQnVmMSA9IHBhcnNlci5idWYxOwogICAgICB0YWJsZVN0YXRlLnBhcnNlckJ1ZjIgPSBwYXJzZXIuYnVmMjsKICAgICAgZGVsZXRlIHRhYmxlU3RhdGUuZmlyc3RFbnRyeU51bTsKICAgICAgZGVsZXRlIHRhYmxlU3RhdGUuZW50cnlDb3VudDsKICAgIH0KICAgIGlmICh0aGlzLmVudHJpZXNbMF0gJiYgIXRoaXMuZW50cmllc1swXS5mcmVlKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHRhYmxlOiB1bmV4cGVjdGVkIGZpcnN0IG9iamVjdCIpOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CiAgcHJvY2Vzc1hSZWZTdHJlYW0oc3RyZWFtKSB7CiAgICBpZiAoISgic3RyZWFtU3RhdGUiIGluIHRoaXMpKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaWN0LAogICAgICAgIHBvcwogICAgICB9ID0gc3RyZWFtOwogICAgICBjb25zdCBieXRlV2lkdGhzID0gZGljdC5nZXQoIlciKTsKICAgICAgY29uc3QgcmFuZ2UgPSBkaWN0LmdldCgiSW5kZXgiKSB8fCBbMCwgZGljdC5nZXQoIlNpemUiKV07CiAgICAgIHRoaXMuc3RyZWFtU3RhdGUgPSB7CiAgICAgICAgZW50cnlSYW5nZXM6IHJhbmdlLAogICAgICAgIGJ5dGVXaWR0aHMsCiAgICAgICAgZW50cnlOdW06IDAsCiAgICAgICAgc3RyZWFtUG9zOiBwb3MKICAgICAgfTsKICAgIH0KICAgIHRoaXMucmVhZFhSZWZTdHJlYW0oc3RyZWFtKTsKICAgIGRlbGV0ZSB0aGlzLnN0cmVhbVN0YXRlOwogICAgcmV0dXJuIHN0cmVhbS5kaWN0OwogIH0KICByZWFkWFJlZlN0cmVhbShzdHJlYW0pIHsKICAgIGNvbnN0IHN0cmVhbVN0YXRlID0gdGhpcy5zdHJlYW1TdGF0ZTsKICAgIHN0cmVhbS5wb3MgPSBzdHJlYW1TdGF0ZS5zdHJlYW1Qb3M7CiAgICBjb25zdCBbdHlwZUZpZWxkV2lkdGgsIG9mZnNldEZpZWxkV2lkdGgsIGdlbmVyYXRpb25GaWVsZFdpZHRoXSA9IHN0cmVhbVN0YXRlLmJ5dGVXaWR0aHM7CiAgICBjb25zdCBlbnRyeVJhbmdlcyA9IHN0cmVhbVN0YXRlLmVudHJ5UmFuZ2VzOwogICAgd2hpbGUgKGVudHJ5UmFuZ2VzLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgW2ZpcnN0LCBuXSA9IGVudHJ5UmFuZ2VzOwogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZmlyc3QpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG4pKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIFhSZWYgcmFuZ2UgZmllbGRzOiAke2ZpcnN0fSwgJHtufWApOwogICAgICB9CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcih0eXBlRmllbGRXaWR0aCkgfHwgIU51bWJlci5pc0ludGVnZXIob2Zmc2V0RmllbGRXaWR0aCkgfHwgIU51bWJlci5pc0ludGVnZXIoZ2VuZXJhdGlvbkZpZWxkV2lkdGgpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIFhSZWYgZW50cnkgZmllbGRzIGxlbmd0aDogJHtmaXJzdH0sICR7bn1gKTsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gc3RyZWFtU3RhdGUuZW50cnlOdW07IGkgPCBuOyArK2kpIHsKICAgICAgICBzdHJlYW1TdGF0ZS5lbnRyeU51bSA9IGk7CiAgICAgICAgc3RyZWFtU3RhdGUuc3RyZWFtUG9zID0gc3RyZWFtLnBvczsKICAgICAgICBsZXQgdHlwZSA9IDAsCiAgICAgICAgICBvZmZzZXQgPSAwLAogICAgICAgICAgZ2VuZXJhdGlvbiA9IDA7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0eXBlRmllbGRXaWR0aDsgKytqKSB7CiAgICAgICAgICBjb25zdCB0eXBlQnl0ZSA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgICAgICBpZiAodHlwZUJ5dGUgPT09IC0xKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIGJ5dGVXaWR0aHMgJ3R5cGUnLiIpOwogICAgICAgICAgfQogICAgICAgICAgdHlwZSA9IHR5cGUgPDwgOCB8IHR5cGVCeXRlOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZUZpZWxkV2lkdGggPT09IDApIHsKICAgICAgICAgIHR5cGUgPSAxOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG9mZnNldEZpZWxkV2lkdGg7ICsraikgewogICAgICAgICAgY29uc3Qgb2Zmc2V0Qnl0ZSA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgICAgICBpZiAob2Zmc2V0Qnl0ZSA9PT0gLTEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgYnl0ZVdpZHRocyAnb2Zmc2V0Jy4iKTsKICAgICAgICAgIH0KICAgICAgICAgIG9mZnNldCA9IG9mZnNldCA8PCA4IHwgb2Zmc2V0Qnl0ZTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBnZW5lcmF0aW9uRmllbGRXaWR0aDsgKytqKSB7CiAgICAgICAgICBjb25zdCBnZW5lcmF0aW9uQnl0ZSA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgICAgICBpZiAoZ2VuZXJhdGlvbkJ5dGUgPT09IC0xKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIGJ5dGVXaWR0aHMgJ2dlbmVyYXRpb24nLiIpOwogICAgICAgICAgfQogICAgICAgICAgZ2VuZXJhdGlvbiA9IGdlbmVyYXRpb24gPDwgOCB8IGdlbmVyYXRpb25CeXRlOwogICAgICAgIH0KICAgICAgICBjb25zdCBlbnRyeSA9IHt9OwogICAgICAgIGVudHJ5Lm9mZnNldCA9IG9mZnNldDsKICAgICAgICBlbnRyeS5nZW4gPSBnZW5lcmF0aW9uOwogICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBlbnRyeS5mcmVlID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGVudHJ5LnVuY29tcHJlc3NlZCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBYUmVmIGVudHJ5IHR5cGU6ICR7dHlwZX1gKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLmVudHJpZXNbZmlyc3QgKyBpXSkgewogICAgICAgICAgdGhpcy5lbnRyaWVzW2ZpcnN0ICsgaV0gPSBlbnRyeTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3RyZWFtU3RhdGUuZW50cnlOdW0gPSAwOwogICAgICBzdHJlYW1TdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICBlbnRyeVJhbmdlcy5zcGxpY2UoMCwgMik7CiAgICB9CiAgfQogIGluZGV4T2JqZWN0cygpIHsKICAgIGNvbnN0IFRBQiA9IDB4OSwKICAgICAgTEYgPSAweGEsCiAgICAgIENSID0gMHhkLAogICAgICBTUEFDRSA9IDB4MjA7CiAgICBjb25zdCBQRVJDRU5UID0gMHgyNSwKICAgICAgTFQgPSAweDNjOwogICAgZnVuY3Rpb24gcmVhZFRva2VuKGRhdGEsIG9mZnNldCkgewogICAgICBsZXQgdG9rZW4gPSAiIiwKICAgICAgICBjaCA9IGRhdGFbb2Zmc2V0XTsKICAgICAgd2hpbGUgKGNoICE9PSBMRiAmJiBjaCAhPT0gQ1IgJiYgY2ggIT09IExUKSB7CiAgICAgICAgaWYgKCsrb2Zmc2V0ID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdG9rZW4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICAgICAgY2ggPSBkYXRhW29mZnNldF07CiAgICAgIH0KICAgICAgcmV0dXJuIHRva2VuOwogICAgfQogICAgZnVuY3Rpb24gc2tpcFVudGlsKGRhdGEsIG9mZnNldCwgd2hhdCkgewogICAgICBjb25zdCBsZW5ndGggPSB3aGF0Lmxlbmd0aCwKICAgICAgICBkYXRhTGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICAgIGxldCBza2lwcGVkID0gMDsKICAgICAgd2hpbGUgKG9mZnNldCA8IGRhdGFMZW5ndGgpIHsKICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgd2hpbGUgKGkgPCBsZW5ndGggJiYgZGF0YVtvZmZzZXQgKyBpXSA9PT0gd2hhdFtpXSkgewogICAgICAgICAgKytpOwogICAgICAgIH0KICAgICAgICBpZiAoaSA+PSBsZW5ndGgpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBvZmZzZXQrKzsKICAgICAgICBza2lwcGVkKys7CiAgICAgIH0KICAgICAgcmV0dXJuIHNraXBwZWQ7CiAgICB9CiAgICBjb25zdCBnRW5kb2JqUmVnRXhwID0gL1xiKGVuZG9ianxcZCtccytcZCtccytvYmp8eHJlZnx0cmFpbGVyXHMqPDwpXGIvZzsKICAgIGNvbnN0IGdTdGFydHhyZWZSZWdFeHAgPSAvXGIoc3RhcnR4cmVmfFxkK1xzK1xkK1xzK29iailcYi9nOwogICAgY29uc3Qgb2JqUmVnRXhwID0gL14oXGQrKVxzKyhcZCspXHMrb2JqXGIvOwogICAgY29uc3QgdHJhaWxlckJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWzExNiwgMTE0LCA5NywgMTA1LCAxMDgsIDEwMSwgMTE0XSk7CiAgICBjb25zdCBzdGFydHhyZWZCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxMTUsIDExNiwgOTcsIDExNCwgMTE2LCAxMjAsIDExNCwgMTAxLCAxMDJdKTsKICAgIGNvbnN0IHhyZWZCeXRlcyA9IG5ldyBVaW50OEFycmF5KFs0NywgODgsIDgyLCAxMDEsIDEwMl0pOwogICAgdGhpcy5lbnRyaWVzLmxlbmd0aCA9IDA7CiAgICB0aGlzLl9jYWNoZU1hcC5jbGVhcigpOwogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW07CiAgICBzdHJlYW0ucG9zID0gMDsKICAgIGNvbnN0IGJ1ZmZlciA9IHN0cmVhbS5nZXRCeXRlcygpLAogICAgICBidWZmZXJTdHIgPSBieXRlc1RvU3RyaW5nKGJ1ZmZlciksCiAgICAgIGxlbmd0aCA9IGJ1ZmZlci5sZW5ndGg7CiAgICBsZXQgcG9zaXRpb24gPSBzdHJlYW0uc3RhcnQ7CiAgICBjb25zdCB0cmFpbGVycyA9IFtdLAogICAgICB4cmVmU3RtcyA9IFtdOwogICAgd2hpbGUgKHBvc2l0aW9uIDwgbGVuZ3RoKSB7CiAgICAgIGxldCBjaCA9IGJ1ZmZlcltwb3NpdGlvbl07CiAgICAgIGlmIChjaCA9PT0gVEFCIHx8IGNoID09PSBMRiB8fCBjaCA9PT0gQ1IgfHwgY2ggPT09IFNQQUNFKSB7CiAgICAgICAgKytwb3NpdGlvbjsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoY2ggPT09IFBFUkNFTlQpIHsKICAgICAgICBkbyB7CiAgICAgICAgICArK3Bvc2l0aW9uOwogICAgICAgICAgaWYgKHBvc2l0aW9uID49IGxlbmd0aCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGNoID0gYnVmZmVyW3Bvc2l0aW9uXTsKICAgICAgICB9IHdoaWxlIChjaCAhPT0gTEYgJiYgY2ggIT09IENSKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB0b2tlbiA9IHJlYWRUb2tlbihidWZmZXIsIHBvc2l0aW9uKTsKICAgICAgbGV0IG07CiAgICAgIGlmICh0b2tlbi5zdGFydHNXaXRoKCJ4cmVmIikgJiYgKHRva2VuLmxlbmd0aCA9PT0gNCB8fCAvXHMvLnRlc3QodG9rZW5bNF0pKSkgewogICAgICAgIHBvc2l0aW9uICs9IHNraXBVbnRpbChidWZmZXIsIHBvc2l0aW9uLCB0cmFpbGVyQnl0ZXMpOwogICAgICAgIHRyYWlsZXJzLnB1c2gocG9zaXRpb24pOwogICAgICAgIHBvc2l0aW9uICs9IHNraXBVbnRpbChidWZmZXIsIHBvc2l0aW9uLCBzdGFydHhyZWZCeXRlcyk7CiAgICAgIH0gZWxzZSBpZiAobSA9IG9ialJlZ0V4cC5leGVjKHRva2VuKSkgewogICAgICAgIGNvbnN0IG51bSA9IG1bMV0gfCAwLAogICAgICAgICAgZ2VuID0gbVsyXSB8IDA7CiAgICAgICAgY29uc3Qgc3RhcnRQb3MgPSBwb3NpdGlvbiArIHRva2VuLmxlbmd0aDsKICAgICAgICBsZXQgY29udGVudExlbmd0aCwKICAgICAgICAgIHVwZGF0ZUVudHJpZXMgPSBmYWxzZTsKICAgICAgICBpZiAoIXRoaXMuZW50cmllc1tudW1dKSB7CiAgICAgICAgICB1cGRhdGVFbnRyaWVzID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZW50cmllc1tudW1dLmdlbiA9PT0gZ2VuKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgUGFyc2VyKHsKICAgICAgICAgICAgICBsZXhlcjogbmV3IExleGVyKHN0cmVhbS5tYWtlU3ViU3RyZWFtKHN0YXJ0UG9zKSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHBhcnNlci5nZXRPYmooKTsKICAgICAgICAgICAgdXBkYXRlRW50cmllcyA9IHRydWU7CiAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBQYXJzZXJFT0ZFeGNlcHRpb24pIHsKICAgICAgICAgICAgICB3YXJuKGBpbmRleE9iamVjdHMgLS0gY2hlY2tpbmcgb2JqZWN0ICgke3Rva2VufSk6ICIke2V4fSIuYCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdXBkYXRlRW50cmllcyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHVwZGF0ZUVudHJpZXMpIHsKICAgICAgICAgIHRoaXMuZW50cmllc1tudW1dID0gewogICAgICAgICAgICBvZmZzZXQ6IHBvc2l0aW9uIC0gc3RyZWFtLnN0YXJ0LAogICAgICAgICAgICBnZW4sCiAgICAgICAgICAgIHVuY29tcHJlc3NlZDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZ0VuZG9ialJlZ0V4cC5sYXN0SW5kZXggPSBzdGFydFBvczsKICAgICAgICBjb25zdCBtYXRjaCA9IGdFbmRvYmpSZWdFeHAuZXhlYyhidWZmZXJTdHIpOwogICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgY29uc3QgZW5kUG9zID0gZ0VuZG9ialJlZ0V4cC5sYXN0SW5kZXggKyAxOwogICAgICAgICAgY29udGVudExlbmd0aCA9IGVuZFBvcyAtIHBvc2l0aW9uOwogICAgICAgICAgaWYgKG1hdGNoWzFdICE9PSAiZW5kb2JqIikgewogICAgICAgICAgICB3YXJuKGBpbmRleE9iamVjdHM6IEZvdW5kICIke21hdGNoWzFdfSIgaW5zaWRlIG9mIGFub3RoZXIgIm9iaiIsIGAgKyAnY2F1c2VkIGJ5IG1pc3NpbmcgImVuZG9iaiIgLS0gdHJ5aW5nIHRvIHJlY292ZXIuJyk7CiAgICAgICAgICAgIGNvbnRlbnRMZW5ndGggLT0gbWF0Y2hbMV0ubGVuZ3RoICsgMTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGVudExlbmd0aCA9IGxlbmd0aCAtIHBvc2l0aW9uOwogICAgICAgIH0KICAgICAgICBjb25zdCBjb250ZW50ID0gYnVmZmVyLnN1YmFycmF5KHBvc2l0aW9uLCBwb3NpdGlvbiArIGNvbnRlbnRMZW5ndGgpOwogICAgICAgIGNvbnN0IHhyZWZUYWdPZmZzZXQgPSBza2lwVW50aWwoY29udGVudCwgMCwgeHJlZkJ5dGVzKTsKICAgICAgICBpZiAoeHJlZlRhZ09mZnNldCA8IGNvbnRlbnRMZW5ndGggJiYgY29udGVudFt4cmVmVGFnT2Zmc2V0ICsgNV0gPCA2NCkgewogICAgICAgICAgeHJlZlN0bXMucHVzaChwb3NpdGlvbiAtIHN0cmVhbS5zdGFydCk7CiAgICAgICAgICB0aGlzLl94cmVmU3Rtcy5hZGQocG9zaXRpb24gLSBzdHJlYW0uc3RhcnQpOwogICAgICAgIH0KICAgICAgICBwb3NpdGlvbiArPSBjb250ZW50TGVuZ3RoOwogICAgICB9IGVsc2UgaWYgKHRva2VuLnN0YXJ0c1dpdGgoInRyYWlsZXIiKSAmJiAodG9rZW4ubGVuZ3RoID09PSA3IHx8IC9ccy8udGVzdCh0b2tlbls3XSkpKSB7CiAgICAgICAgdHJhaWxlcnMucHVzaChwb3NpdGlvbik7CiAgICAgICAgY29uc3Qgc3RhcnRQb3MgPSBwb3NpdGlvbiArIHRva2VuLmxlbmd0aDsKICAgICAgICBsZXQgY29udGVudExlbmd0aDsKICAgICAgICBnU3RhcnR4cmVmUmVnRXhwLmxhc3RJbmRleCA9IHN0YXJ0UG9zOwogICAgICAgIGNvbnN0IG1hdGNoID0gZ1N0YXJ0eHJlZlJlZ0V4cC5leGVjKGJ1ZmZlclN0cik7CiAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICBjb25zdCBlbmRQb3MgPSBnU3RhcnR4cmVmUmVnRXhwLmxhc3RJbmRleCArIDE7CiAgICAgICAgICBjb250ZW50TGVuZ3RoID0gZW5kUG9zIC0gcG9zaXRpb247CiAgICAgICAgICBpZiAobWF0Y2hbMV0gIT09ICJzdGFydHhyZWYiKSB7CiAgICAgICAgICAgIHdhcm4oYGluZGV4T2JqZWN0czogRm91bmQgIiR7bWF0Y2hbMV19IiBhZnRlciAidHJhaWxlciIsIGAgKyAnY2F1c2VkIGJ5IG1pc3NpbmcgInN0YXJ0eHJlZiIgLS0gdHJ5aW5nIHRvIHJlY292ZXIuJyk7CiAgICAgICAgICAgIGNvbnRlbnRMZW5ndGggLT0gbWF0Y2hbMV0ubGVuZ3RoICsgMTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGVudExlbmd0aCA9IGxlbmd0aCAtIHBvc2l0aW9uOwogICAgICAgIH0KICAgICAgICBwb3NpdGlvbiArPSBjb250ZW50TGVuZ3RoOwogICAgICB9IGVsc2UgewogICAgICAgIHBvc2l0aW9uICs9IHRva2VuLmxlbmd0aCArIDE7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgeHJlZlN0bSBvZiB4cmVmU3RtcykgewogICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnB1c2goeHJlZlN0bSk7CiAgICAgIHRoaXMucmVhZFhSZWYodHJ1ZSk7CiAgICB9CiAgICBjb25zdCB0cmFpbGVyRGljdHMgPSBbXTsKICAgIGxldCBpc0VuY3J5cHRlZCA9IGZhbHNlOwogICAgZm9yIChjb25zdCB0cmFpbGVyIG9mIHRyYWlsZXJzKSB7CiAgICAgIHN0cmVhbS5wb3MgPSB0cmFpbGVyOwogICAgICBjb25zdCBwYXJzZXIgPSBuZXcgUGFyc2VyKHsKICAgICAgICBsZXhlcjogbmV3IExleGVyKHN0cmVhbSksCiAgICAgICAgeHJlZjogdGhpcywKICAgICAgICBhbGxvd1N0cmVhbXM6IHRydWUsCiAgICAgICAgcmVjb3ZlcnlNb2RlOiB0cnVlCiAgICAgIH0pOwogICAgICBjb25zdCBvYmogPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGlmICghaXNDbWQob2JqLCAidHJhaWxlciIpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgZGljdCA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdHJhaWxlckRpY3RzLnB1c2goZGljdCk7CiAgICAgIGlmIChkaWN0LmhhcygiRW5jcnlwdCIpKSB7CiAgICAgICAgaXNFbmNyeXB0ZWQgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICBsZXQgdHJhaWxlckRpY3QsIHRyYWlsZXJFcnJvcjsKICAgIGZvciAoY29uc3QgZGljdCBvZiBbLi4udHJhaWxlckRpY3RzLCAiZ2VuRmFsbGJhY2siLCAuLi50cmFpbGVyRGljdHNdKSB7CiAgICAgIGlmIChkaWN0ID09PSAiZ2VuRmFsbGJhY2siKSB7CiAgICAgICAgaWYgKCF0cmFpbGVyRXJyb3IpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0aGlzLl9nZW5lcmF0aW9uRmFsbGJhY2sgPSB0cnVlOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCB2YWxpZFBhZ2VzRGljdCA9IGZhbHNlOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJvb3REaWN0ID0gZGljdC5nZXQoIlJvb3QiKTsKICAgICAgICBpZiAoIShyb290RGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcGFnZXNEaWN0ID0gcm9vdERpY3QuZ2V0KCJQYWdlcyIpOwogICAgICAgIGlmICghKHBhZ2VzRGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcGFnZXNDb3VudCA9IHBhZ2VzRGljdC5nZXQoIkNvdW50Iik7CiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIocGFnZXNDb3VudCkpIHsKICAgICAgICAgIHZhbGlkUGFnZXNEaWN0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgdHJhaWxlckVycm9yID0gZXg7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHZhbGlkUGFnZXNEaWN0ICYmICghaXNFbmNyeXB0ZWQgfHwgZGljdC5oYXMoIkVuY3J5cHQiKSkgJiYgZGljdC5oYXMoIklEIikpIHsKICAgICAgICByZXR1cm4gZGljdDsKICAgICAgfQogICAgICB0cmFpbGVyRGljdCA9IGRpY3Q7CiAgICB9CiAgICBpZiAodHJhaWxlckRpY3QpIHsKICAgICAgcmV0dXJuIHRyYWlsZXJEaWN0OwogICAgfQogICAgaWYgKHRoaXMudG9wRGljdCkgewogICAgICByZXR1cm4gdGhpcy50b3BEaWN0OwogICAgfQogICAgaWYgKCF0cmFpbGVyRGljdHMubGVuZ3RoKSB7CiAgICAgIGZvciAoY29uc3QgbnVtIGluIHRoaXMuZW50cmllcykgewogICAgICAgIGlmICghT2JqZWN0Lmhhc093bih0aGlzLmVudHJpZXMsIG51bSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBlbnRyeSA9IHRoaXMuZW50cmllc1tudW1dOwogICAgICAgIGNvbnN0IHJlZiA9IFJlZi5nZXQocGFyc2VJbnQobnVtKSwgZW50cnkuZ2VuKTsKICAgICAgICBsZXQgb2JqOwogICAgICAgIHRyeSB7CiAgICAgICAgICBvYmogPSB0aGlzLmZldGNoKHJlZik7CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICAgIG9iaiA9IG9iai5kaWN0OwogICAgICAgIH0KICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCAmJiBvYmouaGFzKCJSb290IikpIHsKICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0aHJvdyBuZXcgSW52YWxpZFBERkV4Y2VwdGlvbigiSW52YWxpZCBQREYgc3RydWN0dXJlLiIpOwogIH0KICByZWFkWFJlZihyZWNvdmVyeU1vZGUgPSBmYWxzZSkgewogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW07CiAgICBjb25zdCBzdGFydFhSZWZQYXJzZWRDYWNoZSA9IG5ldyBTZXQoKTsKICAgIHdoaWxlICh0aGlzLnN0YXJ0WFJlZlF1ZXVlLmxlbmd0aCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHN0YXJ0WFJlZiA9IHRoaXMuc3RhcnRYUmVmUXVldWVbMF07CiAgICAgICAgaWYgKHN0YXJ0WFJlZlBhcnNlZENhY2hlLmhhcyhzdGFydFhSZWYpKSB7CiAgICAgICAgICB3YXJuKCJyZWFkWFJlZiAtIHNraXBwaW5nIFhSZWYgdGFibGUgc2luY2UgaXQgd2FzIGFscmVhZHkgcGFyc2VkLiIpOwogICAgICAgICAgdGhpcy5zdGFydFhSZWZRdWV1ZS5zaGlmdCgpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHN0YXJ0WFJlZlBhcnNlZENhY2hlLmFkZChzdGFydFhSZWYpOwogICAgICAgIHN0cmVhbS5wb3MgPSBzdGFydFhSZWYgKyBzdHJlYW0uc3RhcnQ7CiAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgICAgICBsZXhlcjogbmV3IExleGVyKHN0cmVhbSksCiAgICAgICAgICB4cmVmOiB0aGlzLAogICAgICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgbGV0IG9iaiA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICBsZXQgZGljdDsKICAgICAgICBpZiAoaXNDbWQob2JqLCAieHJlZiIpKSB7CiAgICAgICAgICBkaWN0ID0gdGhpcy5wcm9jZXNzWFJlZlRhYmxlKHBhcnNlcik7CiAgICAgICAgICBpZiAoIXRoaXMudG9wRGljdCkgewogICAgICAgICAgICB0aGlzLnRvcERpY3QgPSBkaWN0OwogICAgICAgICAgfQogICAgICAgICAgb2JqID0gZGljdC5nZXQoIlhSZWZTdG0iKTsKICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikgJiYgIXRoaXMuX3hyZWZTdG1zLmhhcyhvYmopKSB7CiAgICAgICAgICAgIHRoaXMuX3hyZWZTdG1zLmFkZChvYmopOwogICAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnB1c2gob2JqKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHBhcnNlci5nZXRPYmooKSkgfHwgIWlzQ21kKHBhcnNlci5nZXRPYmooKSwgIm9iaiIpIHx8ICEoKG9iaiA9IHBhcnNlci5nZXRPYmooKSkgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBzdHJlYW0iKTsKICAgICAgICAgIH0KICAgICAgICAgIGRpY3QgPSB0aGlzLnByb2Nlc3NYUmVmU3RyZWFtKG9iaik7CiAgICAgICAgICBpZiAoIXRoaXMudG9wRGljdCkgewogICAgICAgICAgICB0aGlzLnRvcERpY3QgPSBkaWN0OwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFkaWN0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRmFpbGVkIHRvIHJlYWQgWFJlZiBzdHJlYW0iKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgc3RyZWFtIGhlYWRlciIpOwogICAgICAgIH0KICAgICAgICBvYmogPSBkaWN0LmdldCgiUHJldiIpOwogICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUucHVzaChvYmopOwogICAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnB1c2gob2JqLm51bSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgICAgaW5mbygiKHdoaWxlIHJlYWRpbmcgWFJlZik6ICIgKyBlKTsKICAgICAgfQogICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnNoaWZ0KCk7CiAgICB9CiAgICBpZiAodGhpcy50b3BEaWN0KSB7CiAgICAgIHJldHVybiB0aGlzLnRvcERpY3Q7CiAgICB9CiAgICBpZiAocmVjb3ZlcnlNb2RlKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICB0aHJvdyBuZXcgWFJlZlBhcnNlRXhjZXB0aW9uKCk7CiAgfQogIGdldEVudHJ5KGkpIHsKICAgIGNvbnN0IHhyZWZFbnRyeSA9IHRoaXMuZW50cmllc1tpXTsKICAgIGlmICh4cmVmRW50cnkgJiYgIXhyZWZFbnRyeS5mcmVlICYmIHhyZWZFbnRyeS5vZmZzZXQpIHsKICAgICAgcmV0dXJuIHhyZWZFbnRyeTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBmZXRjaElmUmVmKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2UpIHsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgcmV0dXJuIHRoaXMuZmV0Y2gob2JqLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CiAgZmV0Y2gocmVmLCBzdXBwcmVzc0VuY3J5cHRpb24gPSBmYWxzZSkgewogICAgaWYgKCEocmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoInJlZiBvYmplY3QgaXMgbm90IGEgcmVmZXJlbmNlIik7CiAgICB9CiAgICBjb25zdCBudW0gPSByZWYubnVtOwogICAgY29uc3QgY2FjaGVFbnRyeSA9IHRoaXMuX2NhY2hlTWFwLmdldChudW0pOwogICAgaWYgKGNhY2hlRW50cnkgIT09IHVuZGVmaW5lZCkgewogICAgICBpZiAoY2FjaGVFbnRyeSBpbnN0YW5jZW9mIERpY3QgJiYgIWNhY2hlRW50cnkub2JqSWQpIHsKICAgICAgICBjYWNoZUVudHJ5Lm9iaklkID0gcmVmLnRvU3RyaW5nKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNhY2hlRW50cnk7CiAgICB9CiAgICBsZXQgeHJlZkVudHJ5ID0gdGhpcy5nZXRFbnRyeShudW0pOwogICAgaWYgKHhyZWZFbnRyeSA9PT0gbnVsbCkgewogICAgICByZXR1cm4geHJlZkVudHJ5OwogICAgfQogICAgaWYgKHRoaXMuX3BlbmRpbmdSZWZzLmhhcyhyZWYpKSB7CiAgICAgIHRoaXMuX3BlbmRpbmdSZWZzLnJlbW92ZShyZWYpOwogICAgICB3YXJuKGBJZ25vcmluZyBjaXJjdWxhciByZWZlcmVuY2U6ICR7cmVmfS5gKTsKICAgICAgcmV0dXJuIENJUkNVTEFSX1JFRjsKICAgIH0KICAgIHRoaXMuX3BlbmRpbmdSZWZzLnB1dChyZWYpOwogICAgdHJ5IHsKICAgICAgeHJlZkVudHJ5ID0geHJlZkVudHJ5LnVuY29tcHJlc3NlZCA/IHRoaXMuZmV0Y2hVbmNvbXByZXNzZWQocmVmLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbikgOiB0aGlzLmZldGNoQ29tcHJlc3NlZChyZWYsIHhyZWZFbnRyeSwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgICAgdGhpcy5fcGVuZGluZ1JlZnMucmVtb3ZlKHJlZik7CiAgICB9IGNhdGNoIChleCkgewogICAgICB0aGlzLl9wZW5kaW5nUmVmcy5yZW1vdmUocmVmKTsKICAgICAgdGhyb3cgZXg7CiAgICB9CiAgICBpZiAoeHJlZkVudHJ5IGluc3RhbmNlb2YgRGljdCkgewogICAgICB4cmVmRW50cnkub2JqSWQgPSByZWYudG9TdHJpbmcoKTsKICAgIH0gZWxzZSBpZiAoeHJlZkVudHJ5IGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICB4cmVmRW50cnkuZGljdC5vYmpJZCA9IHJlZi50b1N0cmluZygpOwogICAgfQogICAgcmV0dXJuIHhyZWZFbnRyeTsKICB9CiAgZmV0Y2hVbmNvbXByZXNzZWQocmVmLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbiA9IGZhbHNlKSB7CiAgICBjb25zdCBnZW4gPSByZWYuZ2VuOwogICAgbGV0IG51bSA9IHJlZi5udW07CiAgICBpZiAoeHJlZkVudHJ5LmdlbiAhPT0gZ2VuKSB7CiAgICAgIGNvbnN0IG1zZyA9IGBJbmNvbnNpc3RlbnQgZ2VuZXJhdGlvbiBpbiBYUmVmOiAke3JlZn1gOwogICAgICBpZiAodGhpcy5fZ2VuZXJhdGlvbkZhbGxiYWNrICYmIHhyZWZFbnRyeS5nZW4gPCBnZW4pIHsKICAgICAgICB3YXJuKG1zZyk7CiAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hVbmNvbXByZXNzZWQoUmVmLmdldChudW0sIHhyZWZFbnRyeS5nZW4pLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbik7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IFhSZWZFbnRyeUV4Y2VwdGlvbihtc2cpOwogICAgfQogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW0ubWFrZVN1YlN0cmVhbSh4cmVmRW50cnkub2Zmc2V0ICsgdGhpcy5zdHJlYW0uc3RhcnQpOwogICAgY29uc3QgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgIGxleGVyOiBuZXcgTGV4ZXIoc3RyZWFtKSwKICAgICAgeHJlZjogdGhpcywKICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IG9iajEgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBjb25zdCBvYmoyID0gcGFyc2VyLmdldE9iaigpOwogICAgY29uc3Qgb2JqMyA9IHBhcnNlci5nZXRPYmooKTsKICAgIGlmIChvYmoxICE9PSBudW0gfHwgb2JqMiAhPT0gZ2VuIHx8ICEob2JqMyBpbnN0YW5jZW9mIENtZCkpIHsKICAgICAgdGhyb3cgbmV3IFhSZWZFbnRyeUV4Y2VwdGlvbihgQmFkICh1bmNvbXByZXNzZWQpIFhSZWYgZW50cnk6ICR7cmVmfWApOwogICAgfQogICAgaWYgKG9iajMuY21kICE9PSAib2JqIikgewogICAgICBpZiAob2JqMy5jbWQuc3RhcnRzV2l0aCgib2JqIikpIHsKICAgICAgICBudW0gPSBwYXJzZUludChvYmozLmNtZC5zdWJzdHJpbmcoMyksIDEwKTsKICAgICAgICBpZiAoIU51bWJlci5pc05hTihudW0pKSB7CiAgICAgICAgICByZXR1cm4gbnVtOwogICAgICAgIH0KICAgICAgfQogICAgICB0aHJvdyBuZXcgWFJlZkVudHJ5RXhjZXB0aW9uKGBCYWQgKHVuY29tcHJlc3NlZCkgWFJlZiBlbnRyeTogJHtyZWZ9YCk7CiAgICB9CiAgICB4cmVmRW50cnkgPSB0aGlzLmVuY3J5cHQgJiYgIXN1cHByZXNzRW5jcnlwdGlvbiA/IHBhcnNlci5nZXRPYmoodGhpcy5lbmNyeXB0LmNyZWF0ZUNpcGhlclRyYW5zZm9ybShudW0sIGdlbikpIDogcGFyc2VyLmdldE9iaigpOwogICAgaWYgKCEoeHJlZkVudHJ5IGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgeHJlZkVudHJ5KTsKICAgIH0KICAgIHJldHVybiB4cmVmRW50cnk7CiAgfQogIGZldGNoQ29tcHJlc3NlZChyZWYsIHhyZWZFbnRyeSwgc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2UpIHsKICAgIGNvbnN0IHRhYmxlT2Zmc2V0ID0geHJlZkVudHJ5Lm9mZnNldDsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuZmV0Y2goUmVmLmdldCh0YWJsZU9mZnNldCwgMCkpOwogICAgaWYgKCEoc3RyZWFtIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJiYWQgT2JqU3RtIHN0cmVhbSIpOwogICAgfQogICAgY29uc3QgZmlyc3QgPSBzdHJlYW0uZGljdC5nZXQoIkZpcnN0Iik7CiAgICBjb25zdCBuID0gc3RyZWFtLmRpY3QuZ2V0KCJOIik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZmlyc3QpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG4pKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiaW52YWxpZCBmaXJzdCBhbmQgbiBwYXJhbWV0ZXJzIGZvciBPYmpTdG0gc3RyZWFtIik7CiAgICB9CiAgICBsZXQgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgIGxleGVyOiBuZXcgTGV4ZXIoc3RyZWFtKSwKICAgICAgeHJlZjogdGhpcywKICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IG51bXMgPSBuZXcgQXJyYXkobik7CiAgICBjb25zdCBvZmZzZXRzID0gbmV3IEFycmF5KG4pOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgY29uc3QgbnVtID0gcGFyc2VyLmdldE9iaigpOwogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIobnVtKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgaW52YWxpZCBvYmplY3QgbnVtYmVyIGluIHRoZSBPYmpTdG0gc3RyZWFtOiAke251bX1gKTsKICAgICAgfQogICAgICBjb25zdCBvZmZzZXQgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihvZmZzZXQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBpbnZhbGlkIG9iamVjdCBvZmZzZXQgaW4gdGhlIE9ialN0bSBzdHJlYW06ICR7b2Zmc2V0fWApOwogICAgICB9CiAgICAgIG51bXNbaV0gPSBudW07CiAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5nZXRFbnRyeShudW0pOwogICAgICBpZiAoZW50cnk/Lm9mZnNldCA9PT0gdGFibGVPZmZzZXQgJiYgZW50cnkuZ2VuICE9PSBpKSB7CiAgICAgICAgZW50cnkuZ2VuID0gaTsKICAgICAgfQogICAgICBvZmZzZXRzW2ldID0gb2Zmc2V0OwogICAgfQogICAgY29uc3Qgc3RhcnQgPSAoc3RyZWFtLnN0YXJ0IHx8IDApICsgZmlyc3Q7CiAgICBjb25zdCBlbnRyaWVzID0gbmV3IEFycmF5KG4pOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gaSA8IG4gLSAxID8gb2Zmc2V0c1tpICsgMV0gLSBvZmZzZXRzW2ldIDogdW5kZWZpbmVkOwogICAgICBpZiAobGVuZ3RoIDwgMCkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBvZmZzZXQgaW4gdGhlIE9ialN0bSBzdHJlYW0uIik7CiAgICAgIH0KICAgICAgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydCArIG9mZnNldHNbaV0sIGxlbmd0aCwgc3RyZWFtLmRpY3QpKSwKICAgICAgICB4cmVmOiB0aGlzLAogICAgICAgIGFsbG93U3RyZWFtczogdHJ1ZQogICAgICB9KTsKICAgICAgY29uc3Qgb2JqID0gcGFyc2VyLmdldE9iaigpOwogICAgICBlbnRyaWVzW2ldID0gb2JqOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG51bSA9IG51bXNbaV0sCiAgICAgICAgZW50cnkgPSB0aGlzLmVudHJpZXNbbnVtXTsKICAgICAgaWYgKGVudHJ5ICYmIGVudHJ5Lm9mZnNldCA9PT0gdGFibGVPZmZzZXQgJiYgZW50cnkuZ2VuID09PSBpKSB7CiAgICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgb2JqKTsKICAgICAgfQogICAgfQogICAgeHJlZkVudHJ5ID0gZW50cmllc1t4cmVmRW50cnkuZ2VuXTsKICAgIGlmICh4cmVmRW50cnkgPT09IHVuZGVmaW5lZCkgewogICAgICB0aHJvdyBuZXcgWFJlZkVudHJ5RXhjZXB0aW9uKGBCYWQgKGNvbXByZXNzZWQpIFhSZWYgZW50cnk6ICR7cmVmfWApOwogICAgfQogICAgcmV0dXJuIHhyZWZFbnRyeTsKICB9CiAgYXN5bmMgZmV0Y2hJZlJlZkFzeW5jKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uKSB7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHJldHVybiB0aGlzLmZldGNoQXN5bmMob2JqLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CiAgYXN5bmMgZmV0Y2hBc3luYyhyZWYsIHN1cHByZXNzRW5jcnlwdGlvbikgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIHRoaXMuZmV0Y2gocmVmLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKCEoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikpIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLnBkZk1hbmFnZXIucmVxdWVzdFJhbmdlKGV4LmJlZ2luLCBleC5lbmQpOwogICAgICByZXR1cm4gdGhpcy5mZXRjaEFzeW5jKHJlZiwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICB9CiAgZ2V0Q2F0YWxvZ09iaigpIHsKICAgIHJldHVybiB0aGlzLnJvb3Q7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9kb2N1bWVudC5qcwoKCgoKCgoKCgoKCgoKCgoKCgoKCmNvbnN0IExFVFRFUl9TSVpFX01FRElBQk9YID0gWzAsIDAsIDYxMiwgNzkyXTsKY2xhc3MgUGFnZSB7CiAgI2FyZUFubm90YXRpb25zQ2FjaGVkID0gZmFsc2U7CiAgI3Jlc291cmNlc1Byb21pc2UgPSBudWxsOwogIGNvbnN0cnVjdG9yKHsKICAgIHBkZk1hbmFnZXIsCiAgICB4cmVmLAogICAgcGFnZUluZGV4LAogICAgcGFnZURpY3QsCiAgICByZWYsCiAgICBnbG9iYWxJZEZhY3RvcnksCiAgICBmb250Q2FjaGUsCiAgICBidWlsdEluQ01hcENhY2hlLAogICAgc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgZ2xvYmFsSW1hZ2VDYWNoZSwKICAgIHN5c3RlbUZvbnRDYWNoZSwKICAgIG5vbkJsZW5kTW9kZXNTZXQsCiAgICB4ZmFGYWN0b3J5CiAgfSkgewogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgdGhpcy5wYWdlRGljdCA9IHBhZ2VEaWN0OwogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMucmVmID0gcmVmOwogICAgdGhpcy5mb250Q2FjaGUgPSBmb250Q2FjaGU7CiAgICB0aGlzLmJ1aWx0SW5DTWFwQ2FjaGUgPSBidWlsdEluQ01hcENhY2hlOwogICAgdGhpcy5zdGFuZGFyZEZvbnREYXRhQ2FjaGUgPSBzdGFuZGFyZEZvbnREYXRhQ2FjaGU7CiAgICB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZSA9IGdsb2JhbENvbG9yU3BhY2VDYWNoZTsKICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZSA9IGdsb2JhbEltYWdlQ2FjaGU7CiAgICB0aGlzLnN5c3RlbUZvbnRDYWNoZSA9IHN5c3RlbUZvbnRDYWNoZTsKICAgIHRoaXMubm9uQmxlbmRNb2Rlc1NldCA9IG5vbkJsZW5kTW9kZXNTZXQ7CiAgICB0aGlzLmV2YWx1YXRvck9wdGlvbnMgPSBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnM7CiAgICB0aGlzLnhmYUZhY3RvcnkgPSB4ZmFGYWN0b3J5OwogICAgY29uc3QgaWRDb3VudGVycyA9IHsKICAgICAgb2JqOiAwCiAgICB9OwogICAgdGhpcy5fbG9jYWxJZEZhY3RvcnkgPSBjbGFzcyBleHRlbmRzIGdsb2JhbElkRmFjdG9yeSB7CiAgICAgIHN0YXRpYyBjcmVhdGVPYmpJZCgpIHsKICAgICAgICByZXR1cm4gYHAke3BhZ2VJbmRleH1fJHsrK2lkQ291bnRlcnMub2JqfWA7CiAgICAgIH0KICAgICAgc3RhdGljIGdldFBhZ2VPYmpJZCgpIHsKICAgICAgICByZXR1cm4gYHAke3JlZi50b1N0cmluZygpfWA7CiAgICAgIH0KICAgIH07CiAgfQogICNjcmVhdGVQYXJ0aWFsRXZhbHVhdG9yKGhhbmRsZXIpIHsKICAgIHJldHVybiBuZXcgUGFydGlhbEV2YWx1YXRvcih7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaGFuZGxlciwKICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgaWRGYWN0b3J5OiB0aGlzLl9sb2NhbElkRmFjdG9yeSwKICAgICAgZm9udENhY2hlOiB0aGlzLmZvbnRDYWNoZSwKICAgICAgYnVpbHRJbkNNYXBDYWNoZTogdGhpcy5idWlsdEluQ01hcENhY2hlLAogICAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGU6IHRoaXMuc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGU6IHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBnbG9iYWxJbWFnZUNhY2hlOiB0aGlzLmdsb2JhbEltYWdlQ2FjaGUsCiAgICAgIHN5c3RlbUZvbnRDYWNoZTogdGhpcy5zeXN0ZW1Gb250Q2FjaGUsCiAgICAgIG9wdGlvbnM6IHRoaXMuZXZhbHVhdG9yT3B0aW9ucwogICAgfSk7CiAgfQogICNnZXRJbmhlcml0YWJsZVByb3BlcnR5KGtleSwgZ2V0QXJyYXkgPSBmYWxzZSkgewogICAgY29uc3QgdmFsdWUgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdDogdGhpcy5wYWdlRGljdCwKICAgICAga2V5LAogICAgICBnZXRBcnJheSwKICAgICAgc3RvcFdoZW5Gb3VuZDogZmFsc2UKICAgIH0pOwogICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAxIHx8ICEodmFsdWVbMF0gaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gdmFsdWVbMF07CiAgICB9CiAgICByZXR1cm4gRGljdC5tZXJnZSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgZGljdEFycmF5OiB2YWx1ZQogICAgfSk7CiAgfQogIGdldCBjb250ZW50KCkgewogICAgcmV0dXJuIHRoaXMucGFnZURpY3QuZ2V0QXJyYXkoIkNvbnRlbnRzIik7CiAgfQogIGdldCByZXNvdXJjZXMoKSB7CiAgICBjb25zdCByZXNvdXJjZXMgPSB0aGlzLiNnZXRJbmhlcml0YWJsZVByb3BlcnR5KCJSZXNvdXJjZXMiKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgInJlc291cmNlcyIsIHJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QgPyByZXNvdXJjZXMgOiBEaWN0LmVtcHR5KTsKICB9CiAgZ2V0Qm91bmRpbmdCb3gobmFtZSkgewogICAgaWYgKHRoaXMueGZhRGF0YSkgewogICAgICByZXR1cm4gdGhpcy54ZmFEYXRhLmJib3g7CiAgICB9CiAgICBjb25zdCBib3ggPSBsb29rdXBOb3JtYWxSZWN0KHRoaXMuI2dldEluaGVyaXRhYmxlUHJvcGVydHkobmFtZSwgdHJ1ZSksIG51bGwpOwogICAgaWYgKGJveCkgewogICAgICBpZiAoYm94WzJdIC0gYm94WzBdID4gMCAmJiBib3hbM10gLSBib3hbMV0gPiAwKSB7CiAgICAgICAgcmV0dXJuIGJveDsKICAgICAgfQogICAgICB3YXJuKGBFbXB0eSwgb3IgaW52YWxpZCwgLyR7bmFtZX0gZW50cnkuYCk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZ2V0IG1lZGlhQm94KCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAibWVkaWFCb3giLCB0aGlzLmdldEJvdW5kaW5nQm94KCJNZWRpYUJveCIpIHx8IExFVFRFUl9TSVpFX01FRElBQk9YKTsKICB9CiAgZ2V0IGNyb3BCb3goKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjcm9wQm94IiwgdGhpcy5nZXRCb3VuZGluZ0JveCgiQ3JvcEJveCIpIHx8IHRoaXMubWVkaWFCb3gpOwogIH0KICBnZXQgdXNlclVuaXQoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLnBhZ2VEaWN0LmdldCgiVXNlclVuaXQiKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgInVzZXJVbml0IiwgdHlwZW9mIG9iaiA9PT0gIm51bWJlciIgJiYgb2JqID4gMCA/IG9iaiA6IDEuMCk7CiAgfQogIGdldCB2aWV3KCkgewogICAgY29uc3QgewogICAgICBjcm9wQm94LAogICAgICBtZWRpYUJveAogICAgfSA9IHRoaXM7CiAgICBpZiAoY3JvcEJveCAhPT0gbWVkaWFCb3ggJiYgIWlzQXJyYXlFcXVhbChjcm9wQm94LCBtZWRpYUJveCkpIHsKICAgICAgY29uc3QgYm94ID0gVXRpbC5pbnRlcnNlY3QoY3JvcEJveCwgbWVkaWFCb3gpOwogICAgICBpZiAoYm94ICYmIGJveFsyXSAtIGJveFswXSA+IDAgJiYgYm94WzNdIC0gYm94WzFdID4gMCkgewogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgInZpZXciLCBib3gpOwogICAgICB9CiAgICAgIHdhcm4oIkVtcHR5IC9Dcm9wQm94IGFuZCAvTWVkaWFCb3ggaW50ZXJzZWN0aW9uLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAidmlldyIsIG1lZGlhQm94KTsKICB9CiAgZ2V0IHJvdGF0ZSgpIHsKICAgIGxldCByb3RhdGUgPSB0aGlzLiNnZXRJbmhlcml0YWJsZVByb3BlcnR5KCJSb3RhdGUiKSB8fCAwOwogICAgaWYgKHJvdGF0ZSAlIDkwICE9PSAwKSB7CiAgICAgIHJvdGF0ZSA9IDA7CiAgICB9IGVsc2UgaWYgKHJvdGF0ZSA+PSAzNjApIHsKICAgICAgcm90YXRlICU9IDM2MDsKICAgIH0gZWxzZSBpZiAocm90YXRlIDwgMCkgewogICAgICByb3RhdGUgPSAocm90YXRlICUgMzYwICsgMzYwKSAlIDM2MDsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInJvdGF0ZSIsIHJvdGF0ZSk7CiAgfQogICNvblN1YlN0cmVhbUVycm9yKHJlYXNvbiwgb2JqSWQpIHsKICAgIGlmICh0aGlzLmV2YWx1YXRvck9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgIHdhcm4oYGdldENvbnRlbnRTdHJlYW0gLSBpZ25vcmluZyBzdWItc3RyZWFtICgke29iaklkfSk6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aHJvdyByZWFzb247CiAgfQogIGFzeW5jIGdldENvbnRlbnRTdHJlYW0oKSB7CiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAiY29udGVudCIpOwogICAgaWYgKGNvbnRlbnQgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgIHJldHVybiBjb250ZW50OwogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudCkpIHsKICAgICAgcmV0dXJuIG5ldyBTdHJlYW1zU2VxdWVuY2VTdHJlYW0oY29udGVudCwgdGhpcy4jb25TdWJTdHJlYW1FcnJvci5iaW5kKHRoaXMpKTsKICAgIH0KICAgIHJldHVybiBuZXcgTnVsbFN0cmVhbSgpOwogIH0KICBnZXQgeGZhRGF0YSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYURhdGEiLCB0aGlzLnhmYUZhY3RvcnkgPyB7CiAgICAgIGJib3g6IHRoaXMueGZhRmFjdG9yeS5nZXRCb3VuZGluZ0JveCh0aGlzLnBhZ2VJbmRleCkKICAgIH0gOiBudWxsKTsKICB9CiAgYXN5bmMgI3JlcGxhY2VJZEJ5UmVmKGFubm90YXRpb25zLCBkZWxldGVkQW5ub3RhdGlvbnMsIGV4aXN0aW5nQW5ub3RhdGlvbnMpIHsKICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKGFubm90YXRpb24uaWQpIHsKICAgICAgICBjb25zdCByZWYgPSBSZWYuZnJvbVN0cmluZyhhbm5vdGF0aW9uLmlkKTsKICAgICAgICBpZiAoIXJlZikgewogICAgICAgICAgd2FybihgQSBub24tbGlua2VkIGFubm90YXRpb24gY2Fubm90IGJlIG1vZGlmaWVkOiAke2Fubm90YXRpb24uaWR9YCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFubm90YXRpb24uZGVsZXRlZCkgewogICAgICAgICAgZGVsZXRlZEFubm90YXRpb25zLnB1dChyZWYsIHJlZik7CiAgICAgICAgICBpZiAoYW5ub3RhdGlvbi5wb3B1cFJlZikgewogICAgICAgICAgICBjb25zdCBwb3B1cFJlZiA9IFJlZi5mcm9tU3RyaW5nKGFubm90YXRpb24ucG9wdXBSZWYpOwogICAgICAgICAgICBpZiAocG9wdXBSZWYpIHsKICAgICAgICAgICAgICBkZWxldGVkQW5ub3RhdGlvbnMucHV0KHBvcHVwUmVmLCBwb3B1cFJlZik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYW5ub3RhdGlvbi5wb3B1cD8uZGVsZXRlZCkgewogICAgICAgICAgY29uc3QgcG9wdXBSZWYgPSBSZWYuZnJvbVN0cmluZyhhbm5vdGF0aW9uLnBvcHVwUmVmKTsKICAgICAgICAgIGlmIChwb3B1cFJlZikgewogICAgICAgICAgICBkZWxldGVkQW5ub3RhdGlvbnMucHV0KHBvcHVwUmVmLCBwb3B1cFJlZik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGV4aXN0aW5nQW5ub3RhdGlvbnM/LnB1dChyZWYpOwogICAgICAgIGFubm90YXRpb24ucmVmID0gcmVmOwogICAgICAgIHByb21pc2VzLnB1c2godGhpcy54cmVmLmZldGNoQXN5bmMocmVmKS50aGVuKG9iaiA9PiB7CiAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgICBhbm5vdGF0aW9uLm9sZEFubm90YXRpb24gPSBvYmouY2xvbmUoKTsKICAgICAgICAgIH0KICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICB3YXJuKGBDYW5ub3QgZmV0Y2ggXGBvbGRBbm5vdGF0aW9uXGAgZm9yOiAke3JlZn0uYCk7CiAgICAgICAgfSkpOwogICAgICAgIGRlbGV0ZSBhbm5vdGF0aW9uLmlkOwogICAgICB9CiAgICB9CiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgfQogIGFzeW5jIHNhdmVOZXdBbm5vdGF0aW9ucyhoYW5kbGVyLCB0YXNrLCBhbm5vdGF0aW9ucywgaW1hZ2VQcm9taXNlcywgY2hhbmdlcykgewogICAgaWYgKHRoaXMueGZhRmFjdG9yeSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlhGQTogQ2Fubm90IHNhdmUgbmV3IGFubm90YXRpb25zLiIpOwogICAgfQogICAgY29uc3QgcGFydGlhbEV2YWx1YXRvciA9IHRoaXMuI2NyZWF0ZVBhcnRpYWxFdmFsdWF0b3IoaGFuZGxlcik7CiAgICBjb25zdCBkZWxldGVkQW5ub3RhdGlvbnMgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICAgIGNvbnN0IGV4aXN0aW5nQW5ub3RhdGlvbnMgPSBuZXcgUmVmU2V0KCk7CiAgICBhd2FpdCB0aGlzLiNyZXBsYWNlSWRCeVJlZihhbm5vdGF0aW9ucywgZGVsZXRlZEFubm90YXRpb25zLCBleGlzdGluZ0Fubm90YXRpb25zKTsKICAgIGNvbnN0IHBhZ2VEaWN0ID0gdGhpcy5wYWdlRGljdDsKICAgIGNvbnN0IGFubm90YXRpb25zQXJyYXkgPSB0aGlzLmFubm90YXRpb25zLmZpbHRlcihhID0+ICEoYSBpbnN0YW5jZW9mIFJlZiAmJiBkZWxldGVkQW5ub3RhdGlvbnMuaGFzKGEpKSk7CiAgICBjb25zdCBuZXdEYXRhID0gYXdhaXQgQW5ub3RhdGlvbkZhY3Rvcnkuc2F2ZU5ld0Fubm90YXRpb25zKHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25zLCBpbWFnZVByb21pc2VzLCBjaGFuZ2VzKTsKICAgIGZvciAoY29uc3QgewogICAgICByZWYKICAgIH0gb2YgbmV3RGF0YS5hbm5vdGF0aW9ucykgewogICAgICBpZiAocmVmIGluc3RhbmNlb2YgUmVmICYmICFleGlzdGluZ0Fubm90YXRpb25zLmhhcyhyZWYpKSB7CiAgICAgICAgYW5ub3RhdGlvbnNBcnJheS5wdXNoKHJlZik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRpY3QgPSBwYWdlRGljdC5jbG9uZSgpOwogICAgZGljdC5zZXQoIkFubm90cyIsIGFubm90YXRpb25zQXJyYXkpOwogICAgY2hhbmdlcy5wdXQodGhpcy5yZWYsIHsKICAgICAgZGF0YTogZGljdAogICAgfSk7CiAgICBmb3IgKGNvbnN0IGRlbGV0ZWRSZWYgb2YgZGVsZXRlZEFubm90YXRpb25zKSB7CiAgICAgIGNoYW5nZXMucHV0KGRlbGV0ZWRSZWYsIHsKICAgICAgICBkYXRhOiBudWxsCiAgICAgIH0pOwogICAgfQogIH0KICBhc3luYyBzYXZlKGhhbmRsZXIsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKSB7CiAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gdGhpcy4jY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKTsKICAgIGNvbnN0IGFubm90YXRpb25zID0gYXdhaXQgdGhpcy5fcGFyc2VkQW5ub3RhdGlvbnM7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIHByb21pc2VzLnB1c2goYW5ub3RhdGlvbi5zYXZlKHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgd2Fybigic2F2ZSAtIGlnbm9yaW5nIGFubm90YXRpb24gZGF0YSBkdXJpbmcgIiArIGAiJHt0YXNrLm5hbWV9IiB0YXNrOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSkpOwogICAgfQogICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKTsKICB9CiAgYXN5bmMgbG9hZFJlc291cmNlcyhrZXlzKSB7CiAgICBhd2FpdCAodGhpcy4jcmVzb3VyY2VzUHJvbWlzZSA/Pz0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAicmVzb3VyY2VzIikpOwogICAgYXdhaXQgT2JqZWN0TG9hZGVyLmxvYWQodGhpcy5yZXNvdXJjZXMsIGtleXMsIHRoaXMueHJlZik7CiAgfQogIGFzeW5jICNnZXRNZXJnZWRSZXNvdXJjZXMoc3RyZWFtRGljdCwga2V5cykgewogICAgY29uc3QgbG9jYWxSZXNvdXJjZXMgPSBzdHJlYW1EaWN0Py5nZXQoIlJlc291cmNlcyIpOwogICAgaWYgKCEobG9jYWxSZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0ICYmIGxvY2FsUmVzb3VyY2VzLnNpemUpKSB7CiAgICAgIHJldHVybiB0aGlzLnJlc291cmNlczsKICAgIH0KICAgIGF3YWl0IE9iamVjdExvYWRlci5sb2FkKGxvY2FsUmVzb3VyY2VzLCBrZXlzLCB0aGlzLnhyZWYpOwogICAgcmV0dXJuIERpY3QubWVyZ2UoewogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIGRpY3RBcnJheTogW2xvY2FsUmVzb3VyY2VzLCB0aGlzLnJlc291cmNlc10sCiAgICAgIG1lcmdlU3ViRGljdHM6IHRydWUKICAgIH0pOwogIH0KICBhc3luYyBnZXRPcGVyYXRvckxpc3QoewogICAgaGFuZGxlciwKICAgIHNpbmssCiAgICB0YXNrLAogICAgaW50ZW50LAogICAgY2FjaGVLZXksCiAgICBhbm5vdGF0aW9uU3RvcmFnZSA9IG51bGwsCiAgICBtb2RpZmllZElkcyA9IG51bGwKICB9KSB7CiAgICBjb25zdCBjb250ZW50U3RyZWFtUHJvbWlzZSA9IHRoaXMuZ2V0Q29udGVudFN0cmVhbSgpOwogICAgY29uc3QgcmVzb3VyY2VzUHJvbWlzZSA9IHRoaXMubG9hZFJlc291cmNlcyhSRVNPVVJDRVNfS0VZU19PUEVSQVRPUl9MSVNUKTsKICAgIGNvbnN0IHBhcnRpYWxFdmFsdWF0b3IgPSB0aGlzLiNjcmVhdGVQYXJ0aWFsRXZhbHVhdG9yKGhhbmRsZXIpOwogICAgY29uc3QgbmV3QW5ub3RzQnlQYWdlID0gIXRoaXMueGZhRmFjdG9yeSA/IGdldE5ld0Fubm90YXRpb25zTWFwKGFubm90YXRpb25TdG9yYWdlKSA6IG51bGw7CiAgICBjb25zdCBuZXdBbm5vdHMgPSBuZXdBbm5vdHNCeVBhZ2U/LmdldCh0aGlzLnBhZ2VJbmRleCk7CiAgICBsZXQgbmV3QW5ub3RhdGlvbnNQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKG51bGwpOwogICAgbGV0IGRlbGV0ZWRBbm5vdGF0aW9ucyA9IG51bGw7CiAgICBpZiAobmV3QW5ub3RzKSB7CiAgICAgIGNvbnN0IGFubm90YXRpb25HbG9iYWxzUHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmVEb2MoImFubm90YXRpb25HbG9iYWxzIik7CiAgICAgIGxldCBpbWFnZVByb21pc2VzOwogICAgICBjb25zdCBtaXNzaW5nQml0bWFwcyA9IG5ldyBTZXQoKTsKICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgYml0bWFwSWQsCiAgICAgICAgYml0bWFwCiAgICAgIH0gb2YgbmV3QW5ub3RzKSB7CiAgICAgICAgaWYgKGJpdG1hcElkICYmICFiaXRtYXAgJiYgIW1pc3NpbmdCaXRtYXBzLmhhcyhiaXRtYXBJZCkpIHsKICAgICAgICAgIG1pc3NpbmdCaXRtYXBzLmFkZChiaXRtYXBJZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZAogICAgICB9ID0gdGhpcy5ldmFsdWF0b3JPcHRpb25zOwogICAgICBpZiAobWlzc2luZ0JpdG1hcHMuc2l6ZSA+IDApIHsKICAgICAgICBjb25zdCBhbm5vdGF0aW9uV2l0aEJpdG1hcHMgPSBuZXdBbm5vdHMuc2xpY2UoKTsKICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGFubm90YXRpb25dIG9mIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgICAgICBpZiAoIWtleS5zdGFydHNXaXRoKEFubm90YXRpb25FZGl0b3JQcmVmaXgpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGFubm90YXRpb24uYml0bWFwICYmIG1pc3NpbmdCaXRtYXBzLmhhcyhhbm5vdGF0aW9uLmJpdG1hcElkKSkgewogICAgICAgICAgICBhbm5vdGF0aW9uV2l0aEJpdG1hcHMucHVzaChhbm5vdGF0aW9uKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW1hZ2VQcm9taXNlcyA9IEFubm90YXRpb25GYWN0b3J5LmdlbmVyYXRlSW1hZ2VzKGFubm90YXRpb25XaXRoQml0bWFwcywgdGhpcy54cmVmLCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW1hZ2VQcm9taXNlcyA9IEFubm90YXRpb25GYWN0b3J5LmdlbmVyYXRlSW1hZ2VzKG5ld0Fubm90cywgdGhpcy54cmVmLCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCk7CiAgICAgIH0KICAgICAgZGVsZXRlZEFubm90YXRpb25zID0gbmV3IFJlZlNldCgpOwogICAgICBuZXdBbm5vdGF0aW9uc1Byb21pc2UgPSBQcm9taXNlLmFsbChbYW5ub3RhdGlvbkdsb2JhbHNQcm9taXNlLCB0aGlzLiNyZXBsYWNlSWRCeVJlZihuZXdBbm5vdHMsIGRlbGV0ZWRBbm5vdGF0aW9ucywgbnVsbCldKS50aGVuKChbYW5ub3RhdGlvbkdsb2JhbHNdKSA9PiB7CiAgICAgICAgaWYgKCFhbm5vdGF0aW9uR2xvYmFscykgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBBbm5vdGF0aW9uRmFjdG9yeS5wcmludE5ld0Fubm90YXRpb25zKGFubm90YXRpb25HbG9iYWxzLCBwYXJ0aWFsRXZhbHVhdG9yLCB0YXNrLCBuZXdBbm5vdHMsIGltYWdlUHJvbWlzZXMpOwogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHBhZ2VMaXN0UHJvbWlzZSA9IFByb21pc2UuYWxsKFtjb250ZW50U3RyZWFtUHJvbWlzZSwgcmVzb3VyY2VzUHJvbWlzZV0pLnRoZW4oYXN5bmMgKFtjb250ZW50U3RyZWFtXSkgPT4gewogICAgICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCB0aGlzLiNnZXRNZXJnZWRSZXNvdXJjZXMoY29udGVudFN0cmVhbS5kaWN0LCBSRVNPVVJDRVNfS0VZU19PUEVSQVRPUl9MSVNUKTsKICAgICAgY29uc3Qgb3BMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdChpbnRlbnQsIHNpbmspOwogICAgICBoYW5kbGVyLnNlbmQoIlN0YXJ0UmVuZGVyUGFnZSIsIHsKICAgICAgICB0cmFuc3BhcmVuY3k6IHBhcnRpYWxFdmFsdWF0b3IuaGFzQmxlbmRNb2RlcyhyZXNvdXJjZXMsIHRoaXMubm9uQmxlbmRNb2Rlc1NldCksCiAgICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgICBjYWNoZUtleQogICAgICB9KTsKICAgICAgYXdhaXQgcGFydGlhbEV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICAgIHN0cmVhbTogY29udGVudFN0cmVhbSwKICAgICAgICB0YXNrLAogICAgICAgIHJlc291cmNlcywKICAgICAgICBvcGVyYXRvckxpc3Q6IG9wTGlzdAogICAgICB9KTsKICAgICAgcmV0dXJuIG9wTGlzdDsKICAgIH0pOwogICAgbGV0IFtwYWdlT3BMaXN0LCBhbm5vdGF0aW9ucywgbmV3QW5ub3RhdGlvbnNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3BhZ2VMaXN0UHJvbWlzZSwgdGhpcy5fcGFyc2VkQW5ub3RhdGlvbnMsIG5ld0Fubm90YXRpb25zUHJvbWlzZV0pOwogICAgaWYgKG5ld0Fubm90YXRpb25zKSB7CiAgICAgIGFubm90YXRpb25zID0gYW5ub3RhdGlvbnMuZmlsdGVyKGEgPT4gIShhLnJlZiAmJiBkZWxldGVkQW5ub3RhdGlvbnMuaGFzKGEucmVmKSkpOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBuZXdBbm5vdGF0aW9ucy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgbmV3QW5ub3RhdGlvbiA9IG5ld0Fubm90YXRpb25zW2ldOwogICAgICAgIGlmIChuZXdBbm5vdGF0aW9uLnJlZlRvUmVwbGFjZSkgewogICAgICAgICAgY29uc3QgaiA9IGFubm90YXRpb25zLmZpbmRJbmRleChhID0+IGEucmVmICYmIGlzUmVmc0VxdWFsKGEucmVmLCBuZXdBbm5vdGF0aW9uLnJlZlRvUmVwbGFjZSkpOwogICAgICAgICAgaWYgKGogPj0gMCkgewogICAgICAgICAgICBhbm5vdGF0aW9ucy5zcGxpY2UoaiwgMSwgbmV3QW5ub3RhdGlvbik7CiAgICAgICAgICAgIG5ld0Fubm90YXRpb25zLnNwbGljZShpLS0sIDEpOwogICAgICAgICAgICBpaS0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBhbm5vdGF0aW9ucyA9IGFubm90YXRpb25zLmNvbmNhdChuZXdBbm5vdGF0aW9ucyk7CiAgICB9CiAgICBpZiAoYW5ub3RhdGlvbnMubGVuZ3RoID09PSAwIHx8IGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuQU5OT1RBVElPTlNfRElTQUJMRSkgewogICAgICBwYWdlT3BMaXN0LmZsdXNoKHRydWUpOwogICAgICByZXR1cm4gewogICAgICAgIGxlbmd0aDogcGFnZU9wTGlzdC50b3RhbExlbmd0aAogICAgICB9OwogICAgfQogICAgY29uc3QgcmVuZGVyRm9ybXMgPSAhIShpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkFOTk9UQVRJT05TX0ZPUk1TKSwKICAgICAgaXNFZGl0aW5nID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5JU19FRElUSU5HKSwKICAgICAgaW50ZW50QW55ID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5BTlkpLAogICAgICBpbnRlbnREaXNwbGF5ID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5ESVNQTEFZKSwKICAgICAgaW50ZW50UHJpbnQgPSAhIShpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLlBSSU5UKTsKICAgIGNvbnN0IG9wTGlzdFByb21pc2VzID0gW107CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKGludGVudEFueSB8fCBpbnRlbnREaXNwbGF5ICYmIGFubm90YXRpb24ubXVzdEJlVmlld2VkKGFubm90YXRpb25TdG9yYWdlLCByZW5kZXJGb3JtcykgJiYgYW5ub3RhdGlvbi5tdXN0QmVWaWV3ZWRXaGVuRWRpdGluZyhpc0VkaXRpbmcsIG1vZGlmaWVkSWRzKSB8fCBpbnRlbnRQcmludCAmJiBhbm5vdGF0aW9uLm11c3RCZVByaW50ZWQoYW5ub3RhdGlvblN0b3JhZ2UpKSB7CiAgICAgICAgb3BMaXN0UHJvbWlzZXMucHVzaChhbm5vdGF0aW9uLmdldE9wZXJhdG9yTGlzdChwYXJ0aWFsRXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICB3YXJuKCJnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBhbm5vdGF0aW9uIGRhdGEgZHVyaW5nICIgKyBgIiR7dGFzay5uYW1lfSIgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvcExpc3Q6IG51bGwsCiAgICAgICAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgICAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG9wTGlzdHMgPSBhd2FpdCBQcm9taXNlLmFsbChvcExpc3RQcm9taXNlcyk7CiAgICBsZXQgZm9ybSA9IGZhbHNlLAogICAgICBjYW52YXMgPSBmYWxzZTsKICAgIGZvciAoY29uc3QgewogICAgICBvcExpc3QsCiAgICAgIHNlcGFyYXRlRm9ybSwKICAgICAgc2VwYXJhdGVDYW52YXMKICAgIH0gb2Ygb3BMaXN0cykgewogICAgICBwYWdlT3BMaXN0LmFkZE9wTGlzdChvcExpc3QpOwogICAgICBmb3JtIHx8PSBzZXBhcmF0ZUZvcm07CiAgICAgIGNhbnZhcyB8fD0gc2VwYXJhdGVDYW52YXM7CiAgICB9CiAgICBwYWdlT3BMaXN0LmZsdXNoKHRydWUsIHsKICAgICAgZm9ybSwKICAgICAgY2FudmFzCiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIGxlbmd0aDogcGFnZU9wTGlzdC50b3RhbExlbmd0aAogICAgfTsKICB9CiAgYXN5bmMgZXh0cmFjdFRleHRDb250ZW50KHsKICAgIGhhbmRsZXIsCiAgICB0YXNrLAogICAgaW5jbHVkZU1hcmtlZENvbnRlbnQsCiAgICBkaXNhYmxlTm9ybWFsaXphdGlvbiwKICAgIHNpbmssCiAgICBpbnRlcnNlY3RvciA9IG51bGwKICB9KSB7CiAgICBjb25zdCBjb250ZW50U3RyZWFtUHJvbWlzZSA9IHRoaXMuZ2V0Q29udGVudFN0cmVhbSgpOwogICAgY29uc3QgcmVzb3VyY2VzUHJvbWlzZSA9IHRoaXMubG9hZFJlc291cmNlcyhSRVNPVVJDRVNfS0VZU19URVhUX0NPTlRFTlQpOwogICAgY29uc3QgbGFuZ1Byb21pc2UgPSB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygibGFuZyIpOwogICAgY29uc3QgW2NvbnRlbnRTdHJlYW0sLCBsYW5nXSA9IGF3YWl0IFByb21pc2UuYWxsKFtjb250ZW50U3RyZWFtUHJvbWlzZSwgcmVzb3VyY2VzUHJvbWlzZSwgbGFuZ1Byb21pc2VdKTsKICAgIGNvbnN0IHJlc291cmNlcyA9IGF3YWl0IHRoaXMuI2dldE1lcmdlZFJlc291cmNlcyhjb250ZW50U3RyZWFtLmRpY3QsIFJFU09VUkNFU19LRVlTX1RFWFRfQ09OVEVOVCk7CiAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gdGhpcy4jY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKTsKICAgIHJldHVybiBwYXJ0aWFsRXZhbHVhdG9yLmdldFRleHRDb250ZW50KHsKICAgICAgc3RyZWFtOiBjb250ZW50U3RyZWFtLAogICAgICB0YXNrLAogICAgICByZXNvdXJjZXMsCiAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50LAogICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbiwKICAgICAgc2luaywKICAgICAgdmlld0JveDogdGhpcy52aWV3LAogICAgICBsYW5nLAogICAgICBpbnRlcnNlY3RvcgogICAgfSk7CiAgfQogIGFzeW5jIGdldFN0cnVjdFRyZWUoKSB7CiAgICBjb25zdCBzdHJ1Y3RUcmVlUm9vdCA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJzdHJ1Y3RUcmVlUm9vdCIpOwogICAgaWYgKCFzdHJ1Y3RUcmVlUm9vdCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGF3YWl0IHRoaXMuX3BhcnNlZEFubm90YXRpb25zOwogICAgdHJ5IHsKICAgICAgY29uc3Qgc3RydWN0VHJlZSA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgIl9wYXJzZVN0cnVjdFRyZWUiLCBbc3RydWN0VHJlZVJvb3RdKTsKICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmUoc3RydWN0VHJlZSwgInNlcmlhbGl6YWJsZSIpOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIHdhcm4oYGdldFN0cnVjdFRyZWU6ICIke2V4fSIuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICBfcGFyc2VTdHJ1Y3RUcmVlKHN0cnVjdFRyZWVSb290KSB7CiAgICBjb25zdCB0cmVlID0gbmV3IFN0cnVjdFRyZWVQYWdlKHN0cnVjdFRyZWVSb290LCB0aGlzLnBhZ2VEaWN0KTsKICAgIHRyZWUucGFyc2UodGhpcy5yZWYpOwogICAgcmV0dXJuIHRyZWU7CiAgfQogIGFzeW5jIGdldEFubm90YXRpb25zRGF0YShoYW5kbGVyLCB0YXNrLCBpbnRlbnQpIHsKICAgIGNvbnN0IGFubm90YXRpb25zID0gYXdhaXQgdGhpcy5fcGFyc2VkQW5ub3RhdGlvbnM7CiAgICBpZiAoYW5ub3RhdGlvbnMubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBhbm5vdGF0aW9uczsKICAgIH0KICAgIGNvbnN0IGFubm90YXRpb25zRGF0YSA9IFtdLAogICAgICB0ZXh0Q29udGVudFByb21pc2VzID0gW107CiAgICBsZXQgcGFydGlhbEV2YWx1YXRvcjsKICAgIGNvbnN0IGludGVudEFueSA9ICEhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuQU5ZKSwKICAgICAgaW50ZW50RGlzcGxheSA9ICEhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuRElTUExBWSksCiAgICAgIGludGVudFByaW50ID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5QUklOVCk7CiAgICBjb25zdCBoaWdobGlnaHRlZEFubm90YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgY29uc3QgaXNWaXNpYmxlID0gaW50ZW50QW55IHx8IGludGVudERpc3BsYXkgJiYgYW5ub3RhdGlvbi52aWV3YWJsZTsKICAgICAgaWYgKGlzVmlzaWJsZSB8fCBpbnRlbnRQcmludCAmJiBhbm5vdGF0aW9uLnByaW50YWJsZSkgewogICAgICAgIGFubm90YXRpb25zRGF0YS5wdXNoKGFubm90YXRpb24uZGF0YSk7CiAgICAgIH0KICAgICAgaWYgKGFubm90YXRpb24uaGFzVGV4dENvbnRlbnQgJiYgaXNWaXNpYmxlKSB7CiAgICAgICAgcGFydGlhbEV2YWx1YXRvciA/Pz0gdGhpcy4jY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKTsKICAgICAgICB0ZXh0Q29udGVudFByb21pc2VzLnB1c2goYW5ub3RhdGlvbi5leHRyYWN0VGV4dENvbnRlbnQocGFydGlhbEV2YWx1YXRvciwgdGFzaywgWy1JbmZpbml0eSwgLUluZmluaXR5LCBJbmZpbml0eSwgSW5maW5pdHldKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICB3YXJuKGBnZXRBbm5vdGF0aW9uc0RhdGEgLSBpZ25vcmluZyB0ZXh0Q29udGVudCBkdXJpbmcgIiR7dGFzay5uYW1lfSIgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgfSkpOwogICAgICB9IGVsc2UgaWYgKGFubm90YXRpb24ub3ZlcmxheXNUZXh0Q29udGVudCAmJiBpc1Zpc2libGUpIHsKICAgICAgICBoaWdobGlnaHRlZEFubm90YXRpb25zLnB1c2goYW5ub3RhdGlvbik7CiAgICAgIH0KICAgIH0KICAgIGlmIChoaWdobGlnaHRlZEFubm90YXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgaW50ZXJzZWN0b3IgPSBuZXcgSW50ZXJzZWN0b3IoaGlnaGxpZ2h0ZWRBbm5vdGF0aW9ucyk7CiAgICAgIHRleHRDb250ZW50UHJvbWlzZXMucHVzaCh0aGlzLmV4dHJhY3RUZXh0Q29udGVudCh7CiAgICAgICAgaGFuZGxlciwKICAgICAgICB0YXNrLAogICAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50OiBmYWxzZSwKICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbjogZmFsc2UsCiAgICAgICAgc2luazogbnVsbCwKICAgICAgICB2aWV3Qm94OiB0aGlzLnZpZXcsCiAgICAgICAgbGFuZzogbnVsbCwKICAgICAgICBpbnRlcnNlY3RvcgogICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICBpbnRlcnNlY3Rvci5zZXRUZXh0KCk7CiAgICAgIH0pKTsKICAgIH0KICAgIGF3YWl0IFByb21pc2UuYWxsKHRleHRDb250ZW50UHJvbWlzZXMpOwogICAgcmV0dXJuIGFubm90YXRpb25zRGF0YTsKICB9CiAgZ2V0IGFubm90YXRpb25zKCkgewogICAgY29uc3QgYW5ub3RzID0gdGhpcy4jZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSgiQW5ub3RzIik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJhbm5vdGF0aW9ucyIsIEFycmF5LmlzQXJyYXkoYW5ub3RzKSA/IGFubm90cyA6IFtdKTsKICB9CiAgZ2V0IF9wYXJzZWRBbm5vdGF0aW9ucygpIHsKICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlKHRoaXMsICJhbm5vdGF0aW9ucyIpLnRoZW4oYXN5bmMgYW5ub3RzID0+IHsKICAgICAgaWYgKGFubm90cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gYW5ub3RzOwogICAgICB9CiAgICAgIGNvbnN0IFthbm5vdGF0aW9uR2xvYmFscywgZmllbGRPYmplY3RzXSA9IGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLnBkZk1hbmFnZXIuZW5zdXJlRG9jKCJhbm5vdGF0aW9uR2xvYmFscyIpLCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlRG9jKCJmaWVsZE9iamVjdHMiKV0pOwogICAgICBpZiAoIWFubm90YXRpb25HbG9iYWxzKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIGNvbnN0IG9ycGhhbkZpZWxkcyA9IGZpZWxkT2JqZWN0cz8ub3JwaGFuRmllbGRzOwogICAgICBjb25zdCBhbm5vdGF0aW9uUHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBhbm5vdGF0aW9uUmVmIG9mIGFubm90cykgewogICAgICAgIGFubm90YXRpb25Qcm9taXNlcy5wdXNoKEFubm90YXRpb25GYWN0b3J5LmNyZWF0ZSh0aGlzLnhyZWYsIGFubm90YXRpb25SZWYsIGFubm90YXRpb25HbG9iYWxzLCB0aGlzLl9sb2NhbElkRmFjdG9yeSwgZmFsc2UsIG9ycGhhbkZpZWxkcywgbnVsbCwgdGhpcy5yZWYpLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIHdhcm4oYF9wYXJzZWRBbm5vdGF0aW9uczogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgY29uc3Qgc29ydGVkQW5ub3RhdGlvbnMgPSBbXTsKICAgICAgbGV0IHBvcHVwQW5ub3RhdGlvbnMsIHdpZGdldEFubm90YXRpb25zOwogICAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYXdhaXQgUHJvbWlzZS5hbGwoYW5ub3RhdGlvblByb21pc2VzKSkgewogICAgICAgIGlmICghYW5ub3RhdGlvbikgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChhbm5vdGF0aW9uIGluc3RhbmNlb2YgV2lkZ2V0QW5ub3RhdGlvbikgewogICAgICAgICAgKHdpZGdldEFubm90YXRpb25zIHx8PSBbXSkucHVzaChhbm5vdGF0aW9uKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYW5ub3RhdGlvbiBpbnN0YW5jZW9mIFBvcHVwQW5ub3RhdGlvbikgewogICAgICAgICAgKHBvcHVwQW5ub3RhdGlvbnMgfHw9IFtdKS5wdXNoKGFubm90YXRpb24pOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHNvcnRlZEFubm90YXRpb25zLnB1c2goYW5ub3RhdGlvbik7CiAgICAgIH0KICAgICAgaWYgKHdpZGdldEFubm90YXRpb25zKSB7CiAgICAgICAgc29ydGVkQW5ub3RhdGlvbnMucHVzaCguLi53aWRnZXRBbm5vdGF0aW9ucyk7CiAgICAgIH0KICAgICAgaWYgKHBvcHVwQW5ub3RhdGlvbnMpIHsKICAgICAgICBzb3J0ZWRBbm5vdGF0aW9ucy5wdXNoKC4uLnBvcHVwQW5ub3RhdGlvbnMpOwogICAgICB9CiAgICAgIHJldHVybiBzb3J0ZWRBbm5vdGF0aW9uczsKICAgIH0pOwogICAgdGhpcy4jYXJlQW5ub3RhdGlvbnNDYWNoZWQgPSB0cnVlOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3BhcnNlZEFubm90YXRpb25zIiwgcHJvbWlzZSk7CiAgfQogIGdldCBqc0FjdGlvbnMoKSB7CiAgICBjb25zdCBhY3Rpb25zID0gY29sbGVjdEFjdGlvbnModGhpcy54cmVmLCB0aGlzLnBhZ2VEaWN0LCBQYWdlQWN0aW9uRXZlbnRUeXBlKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImpzQWN0aW9ucyIsIGFjdGlvbnMpOwogIH0KICBhc3luYyBjb2xsZWN0QW5ub3RhdGlvbnNCeVR5cGUoaGFuZGxlciwgdGFzaywgdHlwZXMsIHByb21pc2VzLCBhbm5vdGF0aW9uR2xvYmFscykgewogICAgY29uc3QgewogICAgICBwYWdlSW5kZXgKICAgIH0gPSB0aGlzOwogICAgaWYgKHRoaXMuI2FyZUFubm90YXRpb25zQ2FjaGVkKSB7CiAgICAgIGNvbnN0IGNhY2hlZEFubm90YXRpb25zID0gYXdhaXQgdGhpcy5fcGFyc2VkQW5ub3RhdGlvbnM7CiAgICAgIGZvciAoY29uc3QgewogICAgICAgIGRhdGEKICAgICAgfSBvZiBjYWNoZWRBbm5vdGF0aW9ucykgewogICAgICAgIGlmICghdHlwZXMgfHwgdHlwZXMuaGFzKGRhdGEuYW5ub3RhdGlvblR5cGUpKSB7CiAgICAgICAgICBkYXRhLnBhZ2VJbmRleCA9IHBhZ2VJbmRleDsKICAgICAgICAgIHByb21pc2VzLnB1c2goUHJvbWlzZS5yZXNvbHZlKGRhdGEpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYW5ub3RzID0gYXdhaXQgdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAiYW5ub3RhdGlvbnMiKTsKICAgIGZvciAoY29uc3QgYW5ub3RhdGlvblJlZiBvZiBhbm5vdHMpIHsKICAgICAgcHJvbWlzZXMucHVzaChBbm5vdGF0aW9uRmFjdG9yeS5jcmVhdGUodGhpcy54cmVmLCBhbm5vdGF0aW9uUmVmLCBhbm5vdGF0aW9uR2xvYmFscywgdGhpcy5fbG9jYWxJZEZhY3RvcnksIGZhbHNlLCBudWxsLCB0eXBlcywgdGhpcy5yZWYpLnRoZW4oYXN5bmMgYW5ub3RhdGlvbiA9PiB7CiAgICAgICAgaWYgKCFhbm5vdGF0aW9uKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgYW5ub3RhdGlvbi5kYXRhLnBhZ2VJbmRleCA9IHBhZ2VJbmRleDsKICAgICAgICBpZiAoYW5ub3RhdGlvbi5oYXNUZXh0Q29udGVudCAmJiBhbm5vdGF0aW9uLnZpZXdhYmxlKSB7CiAgICAgICAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gdGhpcy4jY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKTsKICAgICAgICAgIGF3YWl0IGFubm90YXRpb24uZXh0cmFjdFRleHRDb250ZW50KHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIFstSW5maW5pdHksIC1JbmZpbml0eSwgSW5maW5pdHksIEluZmluaXR5XSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbm5vdGF0aW9uLmRhdGE7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICB3YXJuKGBjb2xsZWN0QW5ub3RhdGlvbnNCeVR5cGU6ICIke3JlYXNvbn0iLmApOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9KSk7CiAgICB9CiAgfQp9CmNvbnN0IFBERl9IRUFERVJfU0lHTkFUVVJFID0gbmV3IFVpbnQ4QXJyYXkoWzB4MjUsIDB4NTAsIDB4NDQsIDB4NDYsIDB4MmRdKTsKY29uc3QgU1RBUlRYUkVGX1NJR05BVFVSRSA9IG5ldyBVaW50OEFycmF5KFsweDczLCAweDc0LCAweDYxLCAweDcyLCAweDc0LCAweDc4LCAweDcyLCAweDY1LCAweDY2XSk7CmNvbnN0IEVORE9CSl9TSUdOQVRVUkUgPSBuZXcgVWludDhBcnJheShbMHg2NSwgMHg2ZSwgMHg2NCwgMHg2ZiwgMHg2MiwgMHg2YV0pOwpmdW5jdGlvbiBmaW5kKHN0cmVhbSwgc2lnbmF0dXJlLCBsaW1pdCA9IDEwMjQsIGJhY2t3YXJkcyA9IGZhbHNlKSB7CiAgY29uc3Qgc2lnbmF0dXJlTGVuZ3RoID0gc2lnbmF0dXJlLmxlbmd0aDsKICBjb25zdCBzY2FuQnl0ZXMgPSBzdHJlYW0ucGVla0J5dGVzKGxpbWl0KTsKICBjb25zdCBzY2FuTGVuZ3RoID0gc2NhbkJ5dGVzLmxlbmd0aCAtIHNpZ25hdHVyZUxlbmd0aDsKICBpZiAoc2Nhbkxlbmd0aCA8PSAwKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChiYWNrd2FyZHMpIHsKICAgIGNvbnN0IHNpZ25hdHVyZUVuZCA9IHNpZ25hdHVyZUxlbmd0aCAtIDE7CiAgICBsZXQgcG9zID0gc2NhbkJ5dGVzLmxlbmd0aCAtIDE7CiAgICB3aGlsZSAocG9zID49IHNpZ25hdHVyZUVuZCkgewogICAgICBsZXQgaiA9IDA7CiAgICAgIHdoaWxlIChqIDwgc2lnbmF0dXJlTGVuZ3RoICYmIHNjYW5CeXRlc1twb3MgLSBqXSA9PT0gc2lnbmF0dXJlW3NpZ25hdHVyZUVuZCAtIGpdKSB7CiAgICAgICAgaisrOwogICAgICB9CiAgICAgIGlmIChqID49IHNpZ25hdHVyZUxlbmd0aCkgewogICAgICAgIHN0cmVhbS5wb3MgKz0gcG9zIC0gc2lnbmF0dXJlRW5kOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHBvcy0tOwogICAgfQogIH0gZWxzZSB7CiAgICBsZXQgcG9zID0gMDsKICAgIHdoaWxlIChwb3MgPD0gc2Nhbkxlbmd0aCkgewogICAgICBsZXQgaiA9IDA7CiAgICAgIHdoaWxlIChqIDwgc2lnbmF0dXJlTGVuZ3RoICYmIHNjYW5CeXRlc1twb3MgKyBqXSA9PT0gc2lnbmF0dXJlW2pdKSB7CiAgICAgICAgaisrOwogICAgICB9CiAgICAgIGlmIChqID49IHNpZ25hdHVyZUxlbmd0aCkgewogICAgICAgIHN0cmVhbS5wb3MgKz0gcG9zOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHBvcysrOwogICAgfQogIH0KICByZXR1cm4gZmFsc2U7Cn0KY2xhc3MgUERGRG9jdW1lbnQgewogICNwYWdlUHJvbWlzZXMgPSBuZXcgTWFwKCk7CiAgI3ZlcnNpb24gPSBudWxsOwogIGNvbnN0cnVjdG9yKHBkZk1hbmFnZXIsIHN0cmVhbSkgewogICAgaWYgKHN0cmVhbS5sZW5ndGggPD0gMCkgewogICAgICB0aHJvdyBuZXcgSW52YWxpZFBERkV4Y2VwdGlvbigiVGhlIFBERiBmaWxlIGlzIGVtcHR5LCBpLmUuIGl0cyBzaXplIGlzIHplcm8gYnl0ZXMuIik7CiAgICB9CiAgICB0aGlzLnBkZk1hbmFnZXIgPSBwZGZNYW5hZ2VyOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLnhyZWYgPSBuZXcgWFJlZihzdHJlYW0sIHBkZk1hbmFnZXIpOwogICAgY29uc3QgaWRDb3VudGVycyA9IHsKICAgICAgZm9udDogMAogICAgfTsKICAgIHRoaXMuX2dsb2JhbElkRmFjdG9yeSA9IGNsYXNzIHsKICAgICAgc3RhdGljIGdldERvY0lkKCkgewogICAgICAgIHJldHVybiBgZ18ke3BkZk1hbmFnZXIuZG9jSWR9YDsKICAgICAgfQogICAgICBzdGF0aWMgY3JlYXRlRm9udElkKCkgewogICAgICAgIHJldHVybiBgZiR7KytpZENvdW50ZXJzLmZvbnR9YDsKICAgICAgfQogICAgICBzdGF0aWMgY3JlYXRlT2JqSWQoKSB7CiAgICAgICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgY3JlYXRlT2JqSWRgIGNhbGxlZC4iKTsKICAgICAgfQogICAgICBzdGF0aWMgZ2V0UGFnZU9iaklkKCkgewogICAgICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYGdldFBhZ2VPYmpJZGAgY2FsbGVkLiIpOwogICAgICB9CiAgICB9OwogIH0KICBwYXJzZShyZWNvdmVyeU1vZGUpIHsKICAgIHRoaXMueHJlZi5wYXJzZShyZWNvdmVyeU1vZGUpOwogICAgdGhpcy5jYXRhbG9nID0gbmV3IENhdGFsb2codGhpcy5wZGZNYW5hZ2VyLCB0aGlzLnhyZWYpOwogIH0KICBnZXQgbGluZWFyaXphdGlvbigpIHsKICAgIGxldCBsaW5lYXJpemF0aW9uID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGxpbmVhcml6YXRpb24gPSBMaW5lYXJpemF0aW9uLmNyZWF0ZSh0aGlzLnN0cmVhbSk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXJyOwogICAgICB9CiAgICAgIGluZm8oZXJyKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImxpbmVhcml6YXRpb24iLCBsaW5lYXJpemF0aW9uKTsKICB9CiAgZ2V0IHN0YXJ0WFJlZigpIHsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgbGV0IHN0YXJ0WFJlZiA9IDA7CiAgICBpZiAodGhpcy5saW5lYXJpemF0aW9uKSB7CiAgICAgIHN0cmVhbS5yZXNldCgpOwogICAgICBpZiAoZmluZChzdHJlYW0sIEVORE9CSl9TSUdOQVRVUkUpKSB7CiAgICAgICAgc3RyZWFtLnNraXAoNik7CiAgICAgICAgbGV0IGNoID0gc3RyZWFtLnBlZWtCeXRlKCk7CiAgICAgICAgd2hpbGUgKGlzV2hpdGVTcGFjZShjaCkpIHsKICAgICAgICAgIHN0cmVhbS5wb3MrKzsKICAgICAgICAgIGNoID0gc3RyZWFtLnBlZWtCeXRlKCk7CiAgICAgICAgfQogICAgICAgIHN0YXJ0WFJlZiA9IHN0cmVhbS5wb3MgLSBzdHJlYW0uc3RhcnQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHN0ZXAgPSAxMDI0OwogICAgICBjb25zdCBzdGFydFhSZWZMZW5ndGggPSBTVEFSVFhSRUZfU0lHTkFUVVJFLmxlbmd0aDsKICAgICAgbGV0IGZvdW5kID0gZmFsc2UsCiAgICAgICAgcG9zID0gc3RyZWFtLmVuZDsKICAgICAgd2hpbGUgKCFmb3VuZCAmJiBwb3MgPiAwKSB7CiAgICAgICAgcG9zIC09IHN0ZXAgLSBzdGFydFhSZWZMZW5ndGg7CiAgICAgICAgaWYgKHBvcyA8IDApIHsKICAgICAgICAgIHBvcyA9IDA7CiAgICAgICAgfQogICAgICAgIHN0cmVhbS5wb3MgPSBwb3M7CiAgICAgICAgZm91bmQgPSBmaW5kKHN0cmVhbSwgU1RBUlRYUkVGX1NJR05BVFVSRSwgc3RlcCwgdHJ1ZSk7CiAgICAgIH0KICAgICAgaWYgKGZvdW5kKSB7CiAgICAgICAgc3RyZWFtLnNraXAoOSk7CiAgICAgICAgbGV0IGNoOwogICAgICAgIGRvIHsKICAgICAgICAgIGNoID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICB9IHdoaWxlIChpc1doaXRlU3BhY2UoY2gpKTsKICAgICAgICBsZXQgc3RyID0gIiI7CiAgICAgICAgd2hpbGUgKGNoID49IDB4MjAgJiYgY2ggPD0gMHgzOSkgewogICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgICAgY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgIH0KICAgICAgICBzdGFydFhSZWYgPSBwYXJzZUludChzdHIsIDEwKTsKICAgICAgICBpZiAoaXNOYU4oc3RhcnRYUmVmKSkgewogICAgICAgICAgc3RhcnRYUmVmID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInN0YXJ0WFJlZiIsIHN0YXJ0WFJlZik7CiAgfQogIGNoZWNrSGVhZGVyKCkgewogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW07CiAgICBzdHJlYW0ucmVzZXQoKTsKICAgIGlmICghZmluZChzdHJlYW0sIFBERl9IRUFERVJfU0lHTkFUVVJFKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBzdHJlYW0ubW92ZVN0YXJ0KCk7CiAgICBzdHJlYW0uc2tpcChQREZfSEVBREVSX1NJR05BVFVSRS5sZW5ndGgpOwogICAgbGV0IHZlcnNpb24gPSAiIiwKICAgICAgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgPiAweDIwICYmIHZlcnNpb24ubGVuZ3RoIDwgNykgewogICAgICB2ZXJzaW9uICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgfQogICAgaWYgKFBERl9WRVJTSU9OX1JFR0VYUC50ZXN0KHZlcnNpb24pKSB7CiAgICAgIHRoaXMuI3ZlcnNpb24gPSB2ZXJzaW9uOwogICAgfSBlbHNlIHsKICAgICAgd2FybihgSW52YWxpZCBQREYgaGVhZGVyIHZlcnNpb246ICR7dmVyc2lvbn1gKTsKICAgIH0KICB9CiAgcGFyc2VTdGFydFhSZWYoKSB7CiAgICB0aGlzLnhyZWYuc2V0U3RhcnRYUmVmKHRoaXMuc3RhcnRYUmVmKTsKICB9CiAgZ2V0IG51bVBhZ2VzKCkgewogICAgbGV0IG51bSA9IDA7CiAgICBpZiAodGhpcy5jYXRhbG9nLmhhc0FjdHVhbE51bVBhZ2VzKSB7CiAgICAgIG51bSA9IHRoaXMuY2F0YWxvZy5udW1QYWdlczsKICAgIH0gZWxzZSBpZiAodGhpcy54ZmFGYWN0b3J5KSB7CiAgICAgIG51bSA9IHRoaXMueGZhRmFjdG9yeS5nZXROdW1QYWdlcygpOwogICAgfSBlbHNlIGlmICh0aGlzLmxpbmVhcml6YXRpb24pIHsKICAgICAgbnVtID0gdGhpcy5saW5lYXJpemF0aW9uLm51bVBhZ2VzOwogICAgfSBlbHNlIHsKICAgICAgbnVtID0gdGhpcy5jYXRhbG9nLm51bVBhZ2VzOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAibnVtUGFnZXMiLCBudW0pOwogIH0KICAjaGFzT25seURvY3VtZW50U2lnbmF0dXJlcyhmaWVsZHMsIHJlY3Vyc2lvbkRlcHRoID0gMCkgewogICAgY29uc3QgUkVDVVJTSU9OX0xJTUlUID0gMTA7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZmllbGRzKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gZmllbGRzLmV2ZXJ5KGZpZWxkID0+IHsKICAgICAgZmllbGQgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihmaWVsZCk7CiAgICAgIGlmICghKGZpZWxkIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKGZpZWxkLmhhcygiS2lkcyIpKSB7CiAgICAgICAgaWYgKCsrcmVjdXJzaW9uRGVwdGggPiBSRUNVUlNJT05fTElNSVQpIHsKICAgICAgICAgIHdhcm4oIiNoYXNPbmx5RG9jdW1lbnRTaWduYXR1cmVzOiBtYXhpbXVtIHJlY3Vyc2lvbiBkZXB0aCByZWFjaGVkIik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLiNoYXNPbmx5RG9jdW1lbnRTaWduYXR1cmVzKGZpZWxkLmdldCgiS2lkcyIpLCByZWN1cnNpb25EZXB0aCk7CiAgICAgIH0KICAgICAgY29uc3QgaXNTaWduYXR1cmUgPSBpc05hbWUoZmllbGQuZ2V0KCJGVCIpLCAiU2lnIik7CiAgICAgIGNvbnN0IHJlY3RhbmdsZSA9IGZpZWxkLmdldCgiUmVjdCIpOwogICAgICBjb25zdCBpc0ludmlzaWJsZSA9IEFycmF5LmlzQXJyYXkocmVjdGFuZ2xlKSAmJiByZWN0YW5nbGUuZXZlcnkodmFsdWUgPT4gdmFsdWUgPT09IDApOwogICAgICByZXR1cm4gaXNTaWduYXR1cmUgJiYgaXNJbnZpc2libGU7CiAgICB9KTsKICB9CiAgZ2V0IF94ZmFTdHJlYW1zKCkgewogICAgY29uc3QgewogICAgICBhY3JvRm9ybQogICAgfSA9IHRoaXMuY2F0YWxvZzsKICAgIGlmICghYWNyb0Zvcm0pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCB4ZmEgPSBhY3JvRm9ybS5nZXQoIlhGQSIpOwogICAgY29uc3QgZW50cmllcyA9IG5ldyBNYXAoWyJ4ZHA6eGRwIiwgInRlbXBsYXRlIiwgImRhdGFzZXRzIiwgImNvbmZpZyIsICJjb25uZWN0aW9uU2V0IiwgImxvY2FsZVNldCIsICJzdHlsZXNoZWV0IiwgIi94ZHA6eGRwIl0ubWFwKGUgPT4gW2UsIG51bGxdKSk7CiAgICBpZiAoeGZhIGluc3RhbmNlb2YgQmFzZVN0cmVhbSAmJiAheGZhLmlzRW1wdHkpIHsKICAgICAgZW50cmllcy5zZXQoInhkcDp4ZHAiLCB4ZmEpOwogICAgICByZXR1cm4gZW50cmllczsKICAgIH0KICAgIGlmICghQXJyYXkuaXNBcnJheSh4ZmEpIHx8IHhmYS5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB4ZmEubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICBsZXQgbmFtZTsKICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICBuYW1lID0gInhkcDp4ZHAiOwogICAgICB9IGVsc2UgaWYgKGkgPT09IGlpIC0gMikgewogICAgICAgIG5hbWUgPSAiL3hkcDp4ZHAiOwogICAgICB9IGVsc2UgewogICAgICAgIG5hbWUgPSB4ZmFbaV07CiAgICAgIH0KICAgICAgaWYgKCFlbnRyaWVzLmhhcyhuYW1lKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZih4ZmFbaSArIDFdKTsKICAgICAgaWYgKCEoZGF0YSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHx8IGRhdGEuaXNFbXB0eSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGVudHJpZXMuc2V0KG5hbWUsIGRhdGEpOwogICAgfQogICAgcmV0dXJuIGVudHJpZXM7CiAgfQogIGdldCB4ZmFEYXRhc2V0cygpIHsKICAgIGNvbnN0IHN0cmVhbXMgPSB0aGlzLl94ZmFTdHJlYW1zOwogICAgaWYgKCFzdHJlYW1zKSB7CiAgICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYURhdGFzZXRzIiwgbnVsbCk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGtleSBvZiBbImRhdGFzZXRzIiwgInhkcDp4ZHAiXSkgewogICAgICBjb25zdCBzdHJlYW0gPSBzdHJlYW1zLmdldChrZXkpOwogICAgICBpZiAoIXN0cmVhbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3Qgc3RyID0gc3RyaW5nVG9VVEY4U3RyaW5nKHN0cmVhbS5nZXRTdHJpbmcoKSk7CiAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgIFtrZXldOiBzdHIKICAgICAgICB9OwogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYURhdGFzZXRzIiwgbmV3IERhdGFzZXRSZWFkZXIoZGF0YSkpOwogICAgICB9IGNhdGNoIHsKICAgICAgICB3YXJuKCJYRkEgLSBJbnZhbGlkIHV0Zi04IHN0cmluZy4iKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAieGZhRGF0YXNldHMiLCBudWxsKTsKICB9CiAgZ2V0IHhmYURhdGEoKSB7CiAgICBjb25zdCBzdHJlYW1zID0gdGhpcy5feGZhU3RyZWFtczsKICAgIGlmICghc3RyZWFtcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZm9yIChjb25zdCBba2V5LCBzdHJlYW1dIG9mIHN0cmVhbXMpIHsKICAgICAgaWYgKCFzdHJlYW0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGRhdGFba2V5XSA9IHN0cmluZ1RvVVRGOFN0cmluZyhzdHJlYW0uZ2V0U3RyaW5nKCkpOwogICAgICB9IGNhdGNoIHsKICAgICAgICB3YXJuKCJYRkEgLSBJbnZhbGlkIHV0Zi04IHN0cmluZy4iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldCB4ZmFGYWN0b3J5KCkgewogICAgbGV0IGRhdGE7CiAgICBpZiAodGhpcy5wZGZNYW5hZ2VyLmVuYWJsZVhmYSAmJiB0aGlzLmNhdGFsb2cubmVlZHNSZW5kZXJpbmcgJiYgdGhpcy5mb3JtSW5mby5oYXNYZmEgJiYgIXRoaXMuZm9ybUluZm8uaGFzQWNyb0Zvcm0pIHsKICAgICAgZGF0YSA9IHRoaXMueGZhRGF0YTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYUZhY3RvcnkiLCBkYXRhID8gbmV3IFhGQUZhY3RvcnkoZGF0YSkgOiBudWxsKTsKICB9CiAgZ2V0IGlzUHVyZVhmYSgpIHsKICAgIHJldHVybiB0aGlzLnhmYUZhY3RvcnkgPyB0aGlzLnhmYUZhY3RvcnkuaXNWYWxpZCgpIDogZmFsc2U7CiAgfQogIGdldCBodG1sRm9yWGZhKCkgewogICAgcmV0dXJuIHRoaXMueGZhRmFjdG9yeSA/IHRoaXMueGZhRmFjdG9yeS5nZXRQYWdlcygpIDogbnVsbDsKICB9CiAgYXN5bmMgI2xvYWRYZmFJbWFnZXMoKSB7CiAgICBjb25zdCB4ZmFJbWFnZXMgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygieGZhSW1hZ2VzIik7CiAgICBpZiAoIXhmYUltYWdlcykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnhmYUZhY3Rvcnkuc2V0SW1hZ2VzKHhmYUltYWdlcyk7CiAgfQogIGFzeW5jICNsb2FkWGZhRm9udHMoaGFuZGxlciwgdGFzaykgewogICAgY29uc3QgYWNyb0Zvcm0gPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYWNyb0Zvcm0iKTsKICAgIGlmICghYWNyb0Zvcm0pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcmVzb3VyY2VzID0gYXdhaXQgYWNyb0Zvcm0uZ2V0QXN5bmMoIkRSIik7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBhd2FpdCBPYmplY3RMb2FkZXIubG9hZChyZXNvdXJjZXMsIFsiRm9udCJdLCB0aGlzLnhyZWYpOwogICAgY29uc3QgZm9udFJlcyA9IHJlc291cmNlcy5nZXQoIkZvbnQiKTsKICAgIGlmICghKGZvbnRSZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKG51bGwpLCB0aGlzLnBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9ucywgewogICAgICB1c2VTeXN0ZW1Gb250czogZmFsc2UKICAgIH0pOwogICAgY29uc3QgewogICAgICBidWlsdEluQ01hcENhY2hlLAogICAgICBmb250Q2FjaGUsCiAgICAgIHN0YW5kYXJkRm9udERhdGFDYWNoZQogICAgfSA9IHRoaXMuY2F0YWxvZzsKICAgIGNvbnN0IHBhcnRpYWxFdmFsdWF0b3IgPSBuZXcgUGFydGlhbEV2YWx1YXRvcih7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaGFuZGxlciwKICAgICAgcGFnZUluZGV4OiAtMSwKICAgICAgaWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgIGZvbnRDYWNoZSwKICAgICAgYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICBvcHRpb25zCiAgICB9KTsKICAgIGNvbnN0IG9wZXJhdG9yTGlzdCA9IG5ldyBPcGVyYXRvckxpc3QoKTsKICAgIGNvbnN0IHBkZkZvbnRzID0gW107CiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSB7CiAgICAgIGdldCBmb250KCkgewogICAgICAgIHJldHVybiBwZGZGb250cy5hdCgtMSk7CiAgICAgIH0sCiAgICAgIHNldCBmb250KGZvbnQpIHsKICAgICAgICBwZGZGb250cy5wdXNoKGZvbnQpOwogICAgICB9LAogICAgICBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHBhcnNlRm9udCA9IChmb250TmFtZSwgZmFsbGJhY2tGb250RGljdCwgY3NzRm9udEluZm8pID0+IHBhcnRpYWxFdmFsdWF0b3IuaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIFtOYW1lLmdldChmb250TmFtZSksIDFdLCBudWxsLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgZmFsbGJhY2tGb250RGljdCwgY3NzRm9udEluZm8pLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgIHdhcm4oYGxvYWRYZmFGb250czogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfSk7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBbZm9udE5hbWUsIGZvbnRdIG9mIGZvbnRSZXMpIHsKICAgICAgY29uc3QgZGVzY3JpcHRvciA9IGZvbnQuZ2V0KCJGb250RGVzY3JpcHRvciIpOwogICAgICBpZiAoIShkZXNjcmlwdG9yIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgZm9udEZhbWlseSA9IGRlc2NyaXB0b3IuZ2V0KCJGb250RmFtaWx5Iik7CiAgICAgIGZvbnRGYW1pbHkgPSBmb250RmFtaWx5LnJlcGxhY2VBbGwoL1sgXSsoXGQpL2csICIkMSIpOwogICAgICBjb25zdCBmb250V2VpZ2h0ID0gZGVzY3JpcHRvci5nZXQoIkZvbnRXZWlnaHQiKTsKICAgICAgY29uc3QgaXRhbGljQW5nbGUgPSAtZGVzY3JpcHRvci5nZXQoIkl0YWxpY0FuZ2xlIik7CiAgICAgIGNvbnN0IGNzc0ZvbnRJbmZvID0gewogICAgICAgIGZvbnRGYW1pbHksCiAgICAgICAgZm9udFdlaWdodCwKICAgICAgICBpdGFsaWNBbmdsZQogICAgICB9OwogICAgICBpZiAoIXZhbGlkYXRlQ1NTRm9udChjc3NGb250SW5mbykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwcm9taXNlcy5wdXNoKHBhcnNlRm9udChmb250TmFtZSwgbnVsbCwgY3NzRm9udEluZm8pKTsKICAgIH0KICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsKICAgIGNvbnN0IG1pc3NpbmdGb250cyA9IHRoaXMueGZhRmFjdG9yeS5zZXRGb250cyhwZGZGb250cyk7CiAgICBpZiAoIW1pc3NpbmdGb250cykgewogICAgICByZXR1cm47CiAgICB9CiAgICBvcHRpb25zLmlnbm9yZUVycm9ycyA9IHRydWU7CiAgICBwcm9taXNlcy5sZW5ndGggPSAwOwogICAgcGRmRm9udHMubGVuZ3RoID0gMDsKICAgIGNvbnN0IHJlYWxseU1pc3NpbmdGb250cyA9IG5ldyBTZXQoKTsKICAgIGZvciAoY29uc3QgbWlzc2luZyBvZiBtaXNzaW5nRm9udHMpIHsKICAgICAgaWYgKCFnZXRYZmFGb250TmFtZShgJHttaXNzaW5nfS1SZWd1bGFyYCkpIHsKICAgICAgICByZWFsbHlNaXNzaW5nRm9udHMuYWRkKG1pc3NpbmcpOwogICAgICB9CiAgICB9CiAgICBpZiAocmVhbGx5TWlzc2luZ0ZvbnRzLnNpemUpIHsKICAgICAgbWlzc2luZ0ZvbnRzLnB1c2goIlBkZkpTLUZhbGxiYWNrIik7CiAgICB9CiAgICBmb3IgKGNvbnN0IG1pc3Npbmcgb2YgbWlzc2luZ0ZvbnRzKSB7CiAgICAgIGlmIChyZWFsbHlNaXNzaW5nRm9udHMuaGFzKG1pc3NpbmcpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBmb250SW5mbyBvZiBbewogICAgICAgIG5hbWU6ICJSZWd1bGFyIiwKICAgICAgICBmb250V2VpZ2h0OiA0MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDAKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJCb2xkIiwKICAgICAgICBmb250V2VpZ2h0OiA3MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDAKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJJdGFsaWMiLAogICAgICAgIGZvbnRXZWlnaHQ6IDQwMCwKICAgICAgICBpdGFsaWNBbmdsZTogMTIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJCb2xkSXRhbGljIiwKICAgICAgICBmb250V2VpZ2h0OiA3MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDEyCiAgICAgIH1dKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGAke21pc3Npbmd9LSR7Zm9udEluZm8ubmFtZX1gOwogICAgICAgIHByb21pc2VzLnB1c2gocGFyc2VGb250KG5hbWUsIGdldFhmYUZvbnREaWN0KG5hbWUpLCB7CiAgICAgICAgICBmb250RmFtaWx5OiBtaXNzaW5nLAogICAgICAgICAgZm9udFdlaWdodDogZm9udEluZm8uZm9udFdlaWdodCwKICAgICAgICAgIGl0YWxpY0FuZ2xlOiBmb250SW5mby5pdGFsaWNBbmdsZQogICAgICAgIH0pKTsKICAgICAgfQogICAgfQogICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgdGhpcy54ZmFGYWN0b3J5LmFwcGVuZEZvbnRzKHBkZkZvbnRzLCByZWFsbHlNaXNzaW5nRm9udHMpOwogIH0KICBsb2FkWGZhUmVzb3VyY2VzKGhhbmRsZXIsIHRhc2spIHsKICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy4jbG9hZFhmYUZvbnRzKGhhbmRsZXIsIHRhc2spLmNhdGNoKCgpID0+IHt9KSwgdGhpcy4jbG9hZFhmYUltYWdlcygpXSk7CiAgfQogIHNlcmlhbGl6ZVhmYURhdGEoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIHJldHVybiB0aGlzLnhmYUZhY3RvcnkgPyB0aGlzLnhmYUZhY3Rvcnkuc2VyaWFsaXplRGF0YShhbm5vdGF0aW9uU3RvcmFnZSkgOiBudWxsOwogIH0KICBnZXQgdmVyc2lvbigpIHsKICAgIHJldHVybiB0aGlzLmNhdGFsb2cudmVyc2lvbiB8fCB0aGlzLiN2ZXJzaW9uOwogIH0KICBnZXQgZm9ybUluZm8oKSB7CiAgICBjb25zdCBmb3JtSW5mbyA9IHsKICAgICAgaGFzRmllbGRzOiBmYWxzZSwKICAgICAgaGFzQWNyb0Zvcm06IGZhbHNlLAogICAgICBoYXNYZmE6IGZhbHNlLAogICAgICBoYXNTaWduYXR1cmVzOiBmYWxzZQogICAgfTsKICAgIGNvbnN0IHsKICAgICAgYWNyb0Zvcm0KICAgIH0gPSB0aGlzLmNhdGFsb2c7CiAgICBpZiAoIWFjcm9Gb3JtKSB7CiAgICAgIHJldHVybiBzaGFkb3codGhpcywgImZvcm1JbmZvIiwgZm9ybUluZm8pOwogICAgfQogICAgdHJ5IHsKICAgICAgY29uc3QgZmllbGRzID0gYWNyb0Zvcm0uZ2V0KCJGaWVsZHMiKTsKICAgICAgY29uc3QgaGFzRmllbGRzID0gQXJyYXkuaXNBcnJheShmaWVsZHMpICYmIGZpZWxkcy5sZW5ndGggPiAwOwogICAgICBmb3JtSW5mby5oYXNGaWVsZHMgPSBoYXNGaWVsZHM7CiAgICAgIGNvbnN0IHhmYSA9IGFjcm9Gb3JtLmdldCgiWEZBIik7CiAgICAgIGZvcm1JbmZvLmhhc1hmYSA9IEFycmF5LmlzQXJyYXkoeGZhKSAmJiB4ZmEubGVuZ3RoID4gMCB8fCB4ZmEgaW5zdGFuY2VvZiBCYXNlU3RyZWFtICYmICF4ZmEuaXNFbXB0eTsKICAgICAgY29uc3Qgc2lnRmxhZ3MgPSBhY3JvRm9ybS5nZXQoIlNpZ0ZsYWdzIik7CiAgICAgIGNvbnN0IGhhc1NpZ25hdHVyZXMgPSAhIShzaWdGbGFncyAmIDB4MSk7CiAgICAgIGNvbnN0IGhhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMgPSBoYXNTaWduYXR1cmVzICYmIHRoaXMuI2hhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMoZmllbGRzKTsKICAgICAgZm9ybUluZm8uaGFzQWNyb0Zvcm0gPSBoYXNGaWVsZHMgJiYgIWhhc09ubHlEb2N1bWVudFNpZ25hdHVyZXM7CiAgICAgIGZvcm1JbmZvLmhhc1NpZ25hdHVyZXMgPSBoYXNTaWduYXR1cmVzOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKGBDYW5ub3QgZmV0Y2ggZm9ybSBpbmZvcm1hdGlvbjogIiR7ZXh9Ii5gKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImZvcm1JbmZvIiwgZm9ybUluZm8pOwogIH0KICBnZXQgZG9jdW1lbnRJbmZvKCkgewogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBmb3JtSW5mbywKICAgICAgeHJlZgogICAgfSA9IHRoaXM7CiAgICBjb25zdCBkb2NJbmZvID0gewogICAgICBQREZGb3JtYXRWZXJzaW9uOiB0aGlzLnZlcnNpb24sCiAgICAgIExhbmd1YWdlOiBjYXRhbG9nLmxhbmcsCiAgICAgIEVuY3J5cHRGaWx0ZXJOYW1lOiB4cmVmLmVuY3J5cHQ/LmZpbHRlck5hbWUgPz8gbnVsbCwKICAgICAgSXNMaW5lYXJpemVkOiAhIXRoaXMubGluZWFyaXphdGlvbiwKICAgICAgSXNBY3JvRm9ybVByZXNlbnQ6IGZvcm1JbmZvLmhhc0Fjcm9Gb3JtLAogICAgICBJc1hGQVByZXNlbnQ6IGZvcm1JbmZvLmhhc1hmYSwKICAgICAgSXNDb2xsZWN0aW9uUHJlc2VudDogISFjYXRhbG9nLmNvbGxlY3Rpb24sCiAgICAgIElzU2lnbmF0dXJlc1ByZXNlbnQ6IGZvcm1JbmZvLmhhc1NpZ25hdHVyZXMKICAgIH07CiAgICBsZXQgaW5mb0RpY3Q7CiAgICB0cnkgewogICAgICBpbmZvRGljdCA9IHhyZWYudHJhaWxlci5nZXQoIkluZm8iKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICBpZiAoZXJyIGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBlcnI7CiAgICAgIH0KICAgICAgaW5mbygiVGhlIGRvY3VtZW50IGluZm9ybWF0aW9uIGRpY3Rpb25hcnkgaXMgaW52YWxpZC4iKTsKICAgIH0KICAgIGlmICghKGluZm9EaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZG9jdW1lbnRJbmZvIiwgZG9jSW5mbyk7CiAgICB9CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBpbmZvRGljdCkgewogICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgIGNhc2UgIlRpdGxlIjoKICAgICAgICBjYXNlICJBdXRob3IiOgogICAgICAgIGNhc2UgIlN1YmplY3QiOgogICAgICAgIGNhc2UgIktleXdvcmRzIjoKICAgICAgICBjYXNlICJDcmVhdG9yIjoKICAgICAgICBjYXNlICJQcm9kdWNlciI6CiAgICAgICAgY2FzZSAiQ3JlYXRpb25EYXRlIjoKICAgICAgICBjYXNlICJNb2REYXRlIjoKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGRvY0luZm9ba2V5XSA9IHN0cmluZ1RvUERGU3RyaW5nKHZhbHVlKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJUcmFwcGVkIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgZG9jSW5mb1trZXldID0gdmFsdWU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGxldCBjdXN0b21WYWx1ZTsKICAgICAgICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7CiAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSBzdHJpbmdUb1BERlN0cmluZyh2YWx1ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgICAgICAgIGN1c3RvbVZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY3VzdG9tVmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB3YXJuKGBCYWQgdmFsdWUsIGZvciBjdXN0b20ga2V5ICIke2tleX0iLCBpbiBJbmZvOiAke3ZhbHVlfS5gKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBkb2NJbmZvLkN1c3RvbSA/Pz0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGRvY0luZm8uQ3VzdG9tW2tleV0gPSBjdXN0b21WYWx1ZTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHdhcm4oYEJhZCB2YWx1ZSwgZm9yIGtleSAiJHtrZXl9IiwgaW4gSW5mbzogJHt2YWx1ZX0uYCk7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJkb2N1bWVudEluZm8iLCBkb2NJbmZvKTsKICB9CiAgZ2V0IGZpbmdlcnByaW50cygpIHsKICAgIGNvbnN0IEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTID0gMTAyNDsKICAgIGNvbnN0IEVNUFRZX0ZJTkdFUlBSSU5UID0gIlx4MDAiLnJlcGVhdCgxNik7CiAgICBmdW5jdGlvbiB2YWxpZGF0ZShkYXRhKSB7CiAgICAgIHJldHVybiB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIgJiYgZGF0YS5sZW5ndGggPT09IDE2ICYmIGRhdGEgIT09IEVNUFRZX0ZJTkdFUlBSSU5UOwogICAgfQogICAgY29uc3QgaWQgPSB0aGlzLnhyZWYudHJhaWxlci5nZXQoIklEIik7CiAgICBsZXQgaGFzaE9yaWdpbmFsLCBoYXNoTW9kaWZpZWQ7CiAgICBpZiAoQXJyYXkuaXNBcnJheShpZCkgJiYgdmFsaWRhdGUoaWRbMF0pKSB7CiAgICAgIGhhc2hPcmlnaW5hbCA9IHN0cmluZ1RvQnl0ZXMoaWRbMF0pOwogICAgICBpZiAoaWRbMV0gIT09IGlkWzBdICYmIHZhbGlkYXRlKGlkWzFdKSkgewogICAgICAgIGhhc2hNb2RpZmllZCA9IHN0cmluZ1RvQnl0ZXMoaWRbMV0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBoYXNoT3JpZ2luYWwgPSBjYWxjdWxhdGVNRDUodGhpcy5zdHJlYW0uZ2V0Qnl0ZVJhbmdlKDAsIEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTKSwgMCwgRklOR0VSUFJJTlRfRklSU1RfQllURVMpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZmluZ2VycHJpbnRzIiwgW3RvSGV4VXRpbChoYXNoT3JpZ2luYWwpLCBoYXNoTW9kaWZpZWQgPyB0b0hleFV0aWwoaGFzaE1vZGlmaWVkKSA6IG51bGxdKTsKICB9CiAgYXN5bmMgI2dldExpbmVhcml6YXRpb25QYWdlKHBhZ2VJbmRleCkgewogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBsaW5lYXJpemF0aW9uLAogICAgICB4cmVmCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHJlZiA9IFJlZi5nZXQobGluZWFyaXphdGlvbi5vYmplY3ROdW1iZXJGaXJzdCwgMCk7CiAgICB0cnkgewogICAgICBjb25zdCBvYmogPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMocmVmKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBsZXQgdHlwZSA9IG9iai5nZXRSYXcoIlR5cGUiKTsKICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzTmFtZSh0eXBlLCAiUGFnZSIpIHx8ICFvYmouaGFzKCJUeXBlIikgJiYgIW9iai5oYXMoIktpZHMiKSAmJiBvYmouaGFzKCJDb250ZW50cyIpKSB7CiAgICAgICAgICBpZiAoIWNhdGFsb2cucGFnZUtpZHNDb3VudENhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgICAgIGNhdGFsb2cucGFnZUtpZHNDb3VudENhY2hlLnB1dChyZWYsIDEpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFjYXRhbG9nLnBhZ2VJbmRleENhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgICAgIGNhdGFsb2cucGFnZUluZGV4Q2FjaGUucHV0KHJlZiwgMCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gW29iaiwgcmVmXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJUaGUgTGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGRvZXNuJ3QgcG9pbnQgdG8gYSB2YWxpZCBQYWdlIGRpY3Rpb25hcnkuIik7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgX2dldExpbmVhcml6YXRpb25QYWdlOiAiJHtyZWFzb24ubWVzc2FnZX0iLmApOwogICAgICByZXR1cm4gY2F0YWxvZy5nZXRQYWdlRGljdChwYWdlSW5kZXgpOwogICAgfQogIH0KICBnZXRQYWdlKHBhZ2VJbmRleCkgewogICAgY29uc3QgY2FjaGVkUHJvbWlzZSA9IHRoaXMuI3BhZ2VQcm9taXNlcy5nZXQocGFnZUluZGV4KTsKICAgIGlmIChjYWNoZWRQcm9taXNlKSB7CiAgICAgIHJldHVybiBjYWNoZWRQcm9taXNlOwogICAgfQogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBsaW5lYXJpemF0aW9uLAogICAgICB4ZmFGYWN0b3J5CiAgICB9ID0gdGhpczsKICAgIGxldCBwcm9taXNlOwogICAgaWYgKHhmYUZhY3RvcnkpIHsKICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShbRGljdC5lbXB0eSwgbnVsbF0pOwogICAgfSBlbHNlIGlmIChsaW5lYXJpemF0aW9uPy5wYWdlRmlyc3QgPT09IHBhZ2VJbmRleCkgewogICAgICBwcm9taXNlID0gdGhpcy4jZ2V0TGluZWFyaXphdGlvblBhZ2UocGFnZUluZGV4KTsKICAgIH0gZWxzZSB7CiAgICAgIHByb21pc2UgPSBjYXRhbG9nLmdldFBhZ2VEaWN0KHBhZ2VJbmRleCk7CiAgICB9CiAgICBwcm9taXNlID0gcHJvbWlzZS50aGVuKChbcGFnZURpY3QsIHJlZl0pID0+IG5ldyBQYWdlKHsKICAgICAgcGRmTWFuYWdlcjogdGhpcy5wZGZNYW5hZ2VyLAogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIHBhZ2VJbmRleCwKICAgICAgcGFnZURpY3QsCiAgICAgIHJlZiwKICAgICAgZ2xvYmFsSWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgIGZvbnRDYWNoZTogY2F0YWxvZy5mb250Q2FjaGUsCiAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IGNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiBjYXRhbG9nLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOiBjYXRhbG9nLmdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogY2F0YWxvZy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICBzeXN0ZW1Gb250Q2FjaGU6IGNhdGFsb2cuc3lzdGVtRm9udENhY2hlLAogICAgICBub25CbGVuZE1vZGVzU2V0OiBjYXRhbG9nLm5vbkJsZW5kTW9kZXNTZXQsCiAgICAgIHhmYUZhY3RvcnkKICAgIH0pKTsKICAgIHRoaXMuI3BhZ2VQcm9taXNlcy5zZXQocGFnZUluZGV4LCBwcm9taXNlKTsKICAgIHJldHVybiBwcm9taXNlOwogIH0KICBhc3luYyBjaGVja0ZpcnN0UGFnZShyZWNvdmVyeU1vZGUgPSBmYWxzZSkgewogICAgaWYgKHJlY292ZXJ5TW9kZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLmdldFBhZ2UoMCk7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIFhSZWZFbnRyeUV4Y2VwdGlvbikgewogICAgICAgIHRoaXMuI3BhZ2VQcm9taXNlcy5kZWxldGUoMCk7CiAgICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwKCk7CiAgICAgICAgdGhyb3cgbmV3IFhSZWZQYXJzZUV4Y2VwdGlvbigpOwogICAgICB9CiAgICB9CiAgfQogIGFzeW5jIGNoZWNrTGFzdFBhZ2UocmVjb3ZlcnlNb2RlID0gZmFsc2UpIHsKICAgIGNvbnN0IHsKICAgICAgY2F0YWxvZywKICAgICAgcGRmTWFuYWdlcgogICAgfSA9IHRoaXM7CiAgICBjYXRhbG9nLnNldEFjdHVhbE51bVBhZ2VzKCk7CiAgICBsZXQgbnVtUGFnZXM7CiAgICB0cnkgewogICAgICBhd2FpdCBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVEb2MoInhmYUZhY3RvcnkiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoImxpbmVhcml6YXRpb24iKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJudW1QYWdlcyIpXSk7CiAgICAgIGlmICh0aGlzLnhmYUZhY3RvcnkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5saW5lYXJpemF0aW9uKSB7CiAgICAgICAgbnVtUGFnZXMgPSB0aGlzLmxpbmVhcml6YXRpb24ubnVtUGFnZXM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbnVtUGFnZXMgPSBjYXRhbG9nLm51bVBhZ2VzOwogICAgICB9CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihudW1QYWdlcykpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgY291bnQgaXMgbm90IGFuIGludGVnZXIuIik7CiAgICAgIH0gZWxzZSBpZiAobnVtUGFnZXMgPD0gMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLmdldFBhZ2UobnVtUGFnZXMgLSAxKTsKICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICB0aGlzLiNwYWdlUHJvbWlzZXMuZGVsZXRlKG51bVBhZ2VzIC0gMSk7CiAgICAgIGF3YWl0IHRoaXMuY2xlYW51cCgpOwogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICB0aHJvdyBuZXcgWFJlZlBhcnNlRXhjZXB0aW9uKCk7CiAgICAgIH0KICAgICAgd2FybihgY2hlY2tMYXN0UGFnZSAtIGludmFsaWQgL1BhZ2VzIHRyZWUgL0NvdW50OiAke251bVBhZ2VzfS5gKTsKICAgICAgbGV0IHBhZ2VzVHJlZTsKICAgICAgdHJ5IHsKICAgICAgICBwYWdlc1RyZWUgPSBhd2FpdCBjYXRhbG9nLmdldEFsbFBhZ2VEaWN0cyhyZWNvdmVyeU1vZGUpOwogICAgICB9IGNhdGNoIChyZWFzb25BbGwpIHsKICAgICAgICBpZiAocmVhc29uQWxsIGluc3RhbmNlb2YgWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICAgIHRocm93IG5ldyBYUmVmUGFyc2VFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgY2F0YWxvZy5zZXRBY3R1YWxOdW1QYWdlcygxKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBbcGFnZURpY3QsIHJlZl1dIG9mIHBhZ2VzVHJlZSkgewogICAgICAgIGxldCBwcm9taXNlOwogICAgICAgIGlmIChwYWdlRGljdCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZS5yZWplY3QocGFnZURpY3QpOwogICAgICAgICAgcHJvbWlzZS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUobmV3IFBhZ2UoewogICAgICAgICAgICBwZGZNYW5hZ2VyLAogICAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICAgIHBhZ2VJbmRleCwKICAgICAgICAgICAgcGFnZURpY3QsCiAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgZ2xvYmFsSWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgICAgICAgIGZvbnRDYWNoZTogY2F0YWxvZy5mb250Q2FjaGUsCiAgICAgICAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IGNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiBjYXRhbG9nLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOiB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogY2F0YWxvZy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICAgICAgICBzeXN0ZW1Gb250Q2FjaGU6IGNhdGFsb2cuc3lzdGVtRm9udENhY2hlLAogICAgICAgICAgICBub25CbGVuZE1vZGVzU2V0OiBjYXRhbG9nLm5vbkJsZW5kTW9kZXNTZXQsCiAgICAgICAgICAgIHhmYUZhY3Rvcnk6IG51bGwKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4jcGFnZVByb21pc2VzLnNldChwYWdlSW5kZXgsIHByb21pc2UpOwogICAgICB9CiAgICAgIGNhdGFsb2cuc2V0QWN0dWFsTnVtUGFnZXMocGFnZXNUcmVlLnNpemUpOwogICAgfQogIH0KICBhc3luYyBmb250RmFsbGJhY2soaWQsIGhhbmRsZXIpIHsKICAgIGNvbnN0IHsKICAgICAgY2F0YWxvZywKICAgICAgcGRmTWFuYWdlcgogICAgfSA9IHRoaXM7CiAgICBmb3IgKGNvbnN0IHRyYW5zbGF0ZWRGb250IG9mIGF3YWl0IFByb21pc2UuYWxsKGNhdGFsb2cuZm9udENhY2hlKSkgewogICAgICBpZiAodHJhbnNsYXRlZEZvbnQubG9hZGVkTmFtZSA9PT0gaWQpIHsKICAgICAgICB0cmFuc2xhdGVkRm9udC5mYWxsYmFjayhoYW5kbGVyLCBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnMpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogIH0KICBhc3luYyBjbGVhbnVwKG1hbnVhbGx5VHJpZ2dlcmVkID0gZmFsc2UpIHsKICAgIHJldHVybiB0aGlzLmNhdGFsb2cgPyB0aGlzLmNhdGFsb2cuY2xlYW51cChtYW51YWxseVRyaWdnZXJlZCkgOiBjbGVhckdsb2JhbENhY2hlcygpOwogIH0KICBhc3luYyAjY29sbGVjdEZpZWxkT2JqZWN0cyhuYW1lLCBwYXJlbnRSZWYsIGZpZWxkUmVmLCBwcm9taXNlcywgYW5ub3RhdGlvbkdsb2JhbHMsIHZpc2l0ZWRSZWZzLCBvcnBoYW5GaWVsZHMpIHsKICAgIGNvbnN0IHsKICAgICAgeHJlZgogICAgfSA9IHRoaXM7CiAgICBpZiAoIShmaWVsZFJlZiBpbnN0YW5jZW9mIFJlZikgfHwgdmlzaXRlZFJlZnMuaGFzKGZpZWxkUmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB2aXNpdGVkUmVmcy5wdXQoZmllbGRSZWYpOwogICAgY29uc3QgZmllbGQgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMoZmllbGRSZWYpOwogICAgaWYgKCEoZmllbGQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgc3VidHlwZSA9IGF3YWl0IGZpZWxkLmdldEFzeW5jKCJTdWJ0eXBlIik7CiAgICBzdWJ0eXBlID0gc3VidHlwZSBpbnN0YW5jZW9mIE5hbWUgPyBzdWJ0eXBlLm5hbWUgOiBudWxsOwogICAgc3dpdGNoIChzdWJ0eXBlKSB7CiAgICAgIGNhc2UgIkxpbmsiOgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChmaWVsZC5oYXMoIlQiKSkgewogICAgICBjb25zdCBwYXJ0TmFtZSA9IHN0cmluZ1RvUERGU3RyaW5nKGF3YWl0IGZpZWxkLmdldEFzeW5jKCJUIikpOwogICAgICBuYW1lID0gbmFtZSA9PT0gIiIgPyBwYXJ0TmFtZSA6IGAke25hbWV9LiR7cGFydE5hbWV9YDsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBvYmogPSBmaWVsZDsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBvYmogPSBvYmouZ2V0UmF3KCJQYXJlbnQiKSB8fCBwYXJlbnRSZWY7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgaWYgKHZpc2l0ZWRSZWZzLmhhcyhvYmopKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgb2JqID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKG9iaik7CiAgICAgICAgfQogICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKG9iai5oYXMoIlQiKSkgewogICAgICAgICAgY29uc3QgcGFydE5hbWUgPSBzdHJpbmdUb1BERlN0cmluZyhhd2FpdCBvYmouZ2V0QXN5bmMoIlQiKSk7CiAgICAgICAgICBuYW1lID0gbmFtZSA9PT0gIiIgPyBwYXJ0TmFtZSA6IGAke25hbWV9LiR7cGFydE5hbWV9YDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKHBhcmVudFJlZiAmJiAhZmllbGQuaGFzKCJQYXJlbnQiKSAmJiBpc05hbWUoZmllbGQuZ2V0KCJTdWJ0eXBlIiksICJXaWRnZXQiKSkgewogICAgICBvcnBoYW5GaWVsZHMucHV0KGZpZWxkUmVmLCBwYXJlbnRSZWYpOwogICAgfQogICAgaWYgKCFwcm9taXNlcy5oYXMobmFtZSkpIHsKICAgICAgcHJvbWlzZXMuc2V0KG5hbWUsIFtdKTsKICAgIH0KICAgIHByb21pc2VzLmdldChuYW1lKS5wdXNoKEFubm90YXRpb25GYWN0b3J5LmNyZWF0ZSh4cmVmLCBmaWVsZFJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIG51bGwsIHRydWUsIG9ycGhhbkZpZWxkcywgbnVsbCwgbnVsbCkudGhlbihhbm5vdGF0aW9uID0+IGFubm90YXRpb24/LmdldEZpZWxkT2JqZWN0KCkpLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgd2FybihgI2NvbGxlY3RGaWVsZE9iamVjdHM6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0pKTsKICAgIGlmICghZmllbGQuaGFzKCJLaWRzIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qga2lkcyA9IGF3YWl0IGZpZWxkLmdldEFzeW5jKCJLaWRzIik7CiAgICBpZiAoQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICBmb3IgKGNvbnN0IGtpZCBvZiBraWRzKSB7CiAgICAgICAgYXdhaXQgdGhpcy4jY29sbGVjdEZpZWxkT2JqZWN0cyhuYW1lLCBmaWVsZFJlZiwga2lkLCBwcm9taXNlcywgYW5ub3RhdGlvbkdsb2JhbHMsIHZpc2l0ZWRSZWZzLCBvcnBoYW5GaWVsZHMpOwogICAgICB9CiAgICB9CiAgfQogIGdldCBmaWVsZE9iamVjdHMoKSB7CiAgICBjb25zdCBwcm9taXNlID0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiZm9ybUluZm8iKS50aGVuKGFzeW5jIGZvcm1JbmZvID0+IHsKICAgICAgaWYgKCFmb3JtSW5mby5oYXNGaWVsZHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBhbm5vdGF0aW9uR2xvYmFscyA9IGF3YWl0IHRoaXMuYW5ub3RhdGlvbkdsb2JhbHM7CiAgICAgIGlmICghYW5ub3RhdGlvbkdsb2JhbHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgYWNyb0Zvcm0KICAgICAgfSA9IGFubm90YXRpb25HbG9iYWxzOwogICAgICBjb25zdCB2aXNpdGVkUmVmcyA9IG5ldyBSZWZTZXQoKTsKICAgICAgY29uc3QgYWxsRmllbGRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgY29uc3QgZmllbGRQcm9taXNlcyA9IG5ldyBNYXAoKTsKICAgICAgY29uc3Qgb3JwaGFuRmllbGRzID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICAgIGZvciAoY29uc3QgZmllbGRSZWYgb2YgYWNyb0Zvcm0uZ2V0KCJGaWVsZHMiKSkgewogICAgICAgIGF3YWl0IHRoaXMuI2NvbGxlY3RGaWVsZE9iamVjdHMoIiIsIG51bGwsIGZpZWxkUmVmLCBmaWVsZFByb21pc2VzLCBhbm5vdGF0aW9uR2xvYmFscywgdmlzaXRlZFJlZnMsIG9ycGhhbkZpZWxkcyk7CiAgICAgIH0KICAgICAgY29uc3QgYWxsUHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBbbmFtZSwgcHJvbWlzZXNdIG9mIGZpZWxkUHJvbWlzZXMpIHsKICAgICAgICBhbGxQcm9taXNlcy5wdXNoKFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZpZWxkcyA9PiB7CiAgICAgICAgICBmaWVsZHMgPSBmaWVsZHMuZmlsdGVyKGZpZWxkID0+ICEhZmllbGQpOwogICAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGFsbEZpZWxkc1tuYW1lXSA9IGZpZWxkczsKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYWxsUHJvbWlzZXMpOwogICAgICByZXR1cm4gewogICAgICAgIGFsbEZpZWxkczogb2JqZWN0U2l6ZShhbGxGaWVsZHMpID4gMCA/IGFsbEZpZWxkcyA6IG51bGwsCiAgICAgICAgb3JwaGFuRmllbGRzCiAgICAgIH07CiAgICB9KTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImZpZWxkT2JqZWN0cyIsIHByb21pc2UpOwogIH0KICBnZXQgaGFzSlNBY3Rpb25zKCkgewogICAgY29uc3QgcHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmVEb2MoIl9wYXJzZUhhc0pTQWN0aW9ucyIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaGFzSlNBY3Rpb25zIiwgcHJvbWlzZSk7CiAgfQogIGFzeW5jIF9wYXJzZUhhc0pTQWN0aW9ucygpIHsKICAgIGNvbnN0IFtjYXRhbG9nSnNBY3Rpb25zLCBmaWVsZE9iamVjdHNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3RoaXMucGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJqc0FjdGlvbnMiKSwgdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiZmllbGRPYmplY3RzIildKTsKICAgIGlmIChjYXRhbG9nSnNBY3Rpb25zKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKGZpZWxkT2JqZWN0cz8uYWxsRmllbGRzKSB7CiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkT2JqZWN0cy5hbGxGaWVsZHMpLnNvbWUoZmllbGRPYmplY3QgPT4gZmllbGRPYmplY3Quc29tZShvYmplY3QgPT4gb2JqZWN0LmFjdGlvbnMgIT09IG51bGwpKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGNhbGN1bGF0aW9uT3JkZXJJZHMoKSB7CiAgICBjb25zdCBjYWxjdWxhdGlvbk9yZGVyID0gdGhpcy5jYXRhbG9nLmFjcm9Gb3JtPy5nZXQoIkNPIik7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoY2FsY3VsYXRpb25PcmRlcikgfHwgY2FsY3VsYXRpb25PcmRlci5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY2FsY3VsYXRpb25PcmRlcklkcyIsIG51bGwpOwogICAgfQogICAgY29uc3QgaWRzID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIGNhbGN1bGF0aW9uT3JkZXIpIHsKICAgICAgaWYgKGlkIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgaWRzLnB1c2goaWQudG9TdHJpbmcoKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImNhbGN1bGF0aW9uT3JkZXJJZHMiLCBpZHMubGVuZ3RoID8gaWRzIDogbnVsbCk7CiAgfQogIGdldCBhbm5vdGF0aW9uR2xvYmFscygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImFubm90YXRpb25HbG9iYWxzIiwgQW5ub3RhdGlvbkZhY3RvcnkuY3JlYXRlR2xvYmFscyh0aGlzLnBkZk1hbmFnZXIpKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3BkZl9tYW5hZ2VyLmpzCgoKCgoKCgoKCgpmdW5jdGlvbiBwYXJzZURvY0Jhc2VVcmwodXJsKSB7CiAgaWYgKHVybCkgewogICAgY29uc3QgYWJzb2x1dGVVcmwgPSBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHVybCk7CiAgICBpZiAoYWJzb2x1dGVVcmwpIHsKICAgICAgcmV0dXJuIGFic29sdXRlVXJsLmhyZWY7CiAgICB9CiAgICB3YXJuKGBJbnZhbGlkIGFic29sdXRlIGRvY0Jhc2VVcmw6ICIke3VybH0iLmApOwogIH0KICByZXR1cm4gbnVsbDsKfQpjbGFzcyBCYXNlUGRmTWFuYWdlciB7CiAgY29uc3RydWN0b3IoewogICAgZG9jQmFzZVVybCwKICAgIGRvY0lkLAogICAgZW5hYmxlWGZhLAogICAgZXZhbHVhdG9yT3B0aW9ucywKICAgIGhhbmRsZXIsCiAgICBwYXNzd29yZAogIH0pIHsKICAgIHRoaXMuX2RvY0Jhc2VVcmwgPSBwYXJzZURvY0Jhc2VVcmwoZG9jQmFzZVVybCk7CiAgICB0aGlzLl9kb2NJZCA9IGRvY0lkOwogICAgdGhpcy5fcGFzc3dvcmQgPSBwYXNzd29yZDsKICAgIHRoaXMuZW5hYmxlWGZhID0gZW5hYmxlWGZhOwogICAgZXZhbHVhdG9yT3B0aW9ucy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJj0gRmVhdHVyZVRlc3QuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ7CiAgICBldmFsdWF0b3JPcHRpb25zLmlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkICYmPSBGZWF0dXJlVGVzdC5pc0ltYWdlRGVjb2RlclN1cHBvcnRlZDsKICAgIHRoaXMuZXZhbHVhdG9yT3B0aW9ucyA9IE9iamVjdC5mcmVlemUoZXZhbHVhdG9yT3B0aW9ucyk7CiAgICBJbWFnZVJlc2l6ZXIuc2V0T3B0aW9ucyhldmFsdWF0b3JPcHRpb25zKTsKICAgIEpwZWdTdHJlYW0uc2V0T3B0aW9ucyhldmFsdWF0b3JPcHRpb25zKTsKICAgIE9wZXJhdG9yTGlzdC5zZXRPcHRpb25zKGV2YWx1YXRvck9wdGlvbnMpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgLi4uZXZhbHVhdG9yT3B0aW9ucywKICAgICAgaGFuZGxlcgogICAgfTsKICAgIEpweEltYWdlLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICBJY2NDb2xvclNwYWNlLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICBDbXlrSUNDQmFzZWRDUy5zZXRPcHRpb25zKG9wdGlvbnMpOwogIH0KICBnZXQgZG9jSWQoKSB7CiAgICByZXR1cm4gdGhpcy5fZG9jSWQ7CiAgfQogIGdldCBwYXNzd29yZCgpIHsKICAgIHJldHVybiB0aGlzLl9wYXNzd29yZDsKICB9CiAgZ2V0IGRvY0Jhc2VVcmwoKSB7CiAgICByZXR1cm4gdGhpcy5fZG9jQmFzZVVybDsKICB9CiAgZW5zdXJlRG9jKHByb3AsIGFyZ3MpIHsKICAgIHJldHVybiB0aGlzLmVuc3VyZSh0aGlzLnBkZkRvY3VtZW50LCBwcm9wLCBhcmdzKTsKICB9CiAgZW5zdXJlWFJlZihwcm9wLCBhcmdzKSB7CiAgICByZXR1cm4gdGhpcy5lbnN1cmUodGhpcy5wZGZEb2N1bWVudC54cmVmLCBwcm9wLCBhcmdzKTsKICB9CiAgZW5zdXJlQ2F0YWxvZyhwcm9wLCBhcmdzKSB7CiAgICByZXR1cm4gdGhpcy5lbnN1cmUodGhpcy5wZGZEb2N1bWVudC5jYXRhbG9nLCBwcm9wLCBhcmdzKTsKICB9CiAgZ2V0UGFnZShwYWdlSW5kZXgpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LmdldFBhZ2UocGFnZUluZGV4KTsKICB9CiAgZm9udEZhbGxiYWNrKGlkLCBoYW5kbGVyKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudC5mb250RmFsbGJhY2soaWQsIGhhbmRsZXIpOwogIH0KICBjbGVhbnVwKG1hbnVhbGx5VHJpZ2dlcmVkID0gZmFsc2UpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LmNsZWFudXAobWFudWFsbHlUcmlnZ2VyZWQpOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBlbnN1cmVgIGNhbGxlZCIpOwogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgcmVxdWVzdFJhbmdlYCBjYWxsZWQiKTsKICB9CiAgcmVxdWVzdExvYWRlZFN0cmVhbShub0ZldGNoID0gZmFsc2UpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYHJlcXVlc3RMb2FkZWRTdHJlYW1gIGNhbGxlZCIpOwogIH0KICBzZW5kUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBzZW5kUHJvZ3Jlc3NpdmVEYXRhYCBjYWxsZWQiKTsKICB9CiAgdXBkYXRlUGFzc3dvcmQocGFzc3dvcmQpIHsKICAgIHRoaXMuX3Bhc3N3b3JkID0gcGFzc3dvcmQ7CiAgfQogIHRlcm1pbmF0ZShyZWFzb24pIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYHRlcm1pbmF0ZWAgY2FsbGVkIik7CiAgfQp9CmNsYXNzIExvY2FsUGRmTWFuYWdlciBleHRlbmRzIEJhc2VQZGZNYW5hZ2VyIHsKICBjb25zdHJ1Y3RvcihhcmdzKSB7CiAgICBzdXBlcihhcmdzKTsKICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBTdHJlYW0oYXJncy5zb3VyY2UpOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG5ldyBQREZEb2N1bWVudCh0aGlzLCBzdHJlYW0pOwogICAgdGhpcy5fbG9hZGVkU3RyZWFtUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShzdHJlYW0pOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICBjb25zdCB2YWx1ZSA9IG9ialtwcm9wXTsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgcmV0dXJuIHZhbHVlLmFwcGx5KG9iaiwgYXJncyk7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIHJlcXVlc3RSYW5nZShiZWdpbiwgZW5kKSB7CiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgfQogIHJlcXVlc3RMb2FkZWRTdHJlYW0obm9GZXRjaCA9IGZhbHNlKSB7CiAgICByZXR1cm4gdGhpcy5fbG9hZGVkU3RyZWFtUHJvbWlzZTsKICB9CiAgdGVybWluYXRlKHJlYXNvbikge30KfQpjbGFzcyBOZXR3b3JrUGRmTWFuYWdlciBleHRlbmRzIEJhc2VQZGZNYW5hZ2VyIHsKICBjb25zdHJ1Y3RvcihhcmdzKSB7CiAgICBzdXBlcihhcmdzKTsKICAgIHRoaXMuc3RyZWFtTWFuYWdlciA9IG5ldyBDaHVua2VkU3RyZWFtTWFuYWdlcihhcmdzLnNvdXJjZSwgewogICAgICBtc2dIYW5kbGVyOiBhcmdzLmhhbmRsZXIsCiAgICAgIGxlbmd0aDogYXJncy5sZW5ndGgsCiAgICAgIGRpc2FibGVBdXRvRmV0Y2g6IGFyZ3MuZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgcmFuZ2VDaHVua1NpemU6IGFyZ3MucmFuZ2VDaHVua1NpemUKICAgIH0pOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG5ldyBQREZEb2N1bWVudCh0aGlzLCB0aGlzLnN0cmVhbU1hbmFnZXIuZ2V0U3RyZWFtKCkpOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICB0cnkgewogICAgICBjb25zdCB2YWx1ZSA9IG9ialtwcm9wXTsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHJldHVybiB2YWx1ZS5hcHBseShvYmosIGFyZ3MpOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmICghKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy5yZXF1ZXN0UmFuZ2UoZXguYmVnaW4sIGV4LmVuZCk7CiAgICAgIHJldHVybiB0aGlzLmVuc3VyZShvYmosIHByb3AsIGFyZ3MpOwogICAgfQogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtTWFuYWdlci5yZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCk7CiAgfQogIHJlcXVlc3RMb2FkZWRTdHJlYW0obm9GZXRjaCA9IGZhbHNlKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW1NYW5hZ2VyLnJlcXVlc3RBbGxDaHVua3Mobm9GZXRjaCk7CiAgfQogIHNlbmRQcm9ncmVzc2l2ZURhdGEoY2h1bmspIHsKICAgIHRoaXMuc3RyZWFtTWFuYWdlci5vblJlY2VpdmVEYXRhKHsKICAgICAgY2h1bmsKICAgIH0pOwogIH0KICB0ZXJtaW5hdGUocmVhc29uKSB7CiAgICB0aGlzLnN0cmVhbU1hbmFnZXIuYWJvcnQocmVhc29uKTsKICB9Cn0KCjsvLyAuL3NyYy9zaGFyZWQvbWVzc2FnZV9oYW5kbGVyLmpzCgpjb25zdCBDYWxsYmFja0tpbmQgPSB7CiAgREFUQTogMSwKICBFUlJPUjogMgp9Owpjb25zdCBTdHJlYW1LaW5kID0gewogIENBTkNFTDogMSwKICBDQU5DRUxfQ09NUExFVEU6IDIsCiAgQ0xPU0U6IDMsCiAgRU5RVUVVRTogNCwKICBFUlJPUjogNSwKICBQVUxMOiA2LAogIFBVTExfQ09NUExFVEU6IDcsCiAgU1RBUlRfQ09NUExFVEU6IDgKfTsKZnVuY3Rpb24gb25GbigpIHt9CmZ1bmN0aW9uIHdyYXBSZWFzb24oZXgpIHsKICBpZiAoZXggaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIEludmFsaWRQREZFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBQYXNzd29yZEV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIFJlc3BvbnNlRXhjZXB0aW9uIHx8IGV4IGluc3RhbmNlb2YgVW5rbm93bkVycm9yRXhjZXB0aW9uKSB7CiAgICByZXR1cm4gZXg7CiAgfQogIGlmICghKGV4IGluc3RhbmNlb2YgRXJyb3IgfHwgdHlwZW9mIGV4ID09PSAib2JqZWN0IiAmJiBleCAhPT0gbnVsbCkpIHsKICAgIHVucmVhY2hhYmxlKCd3cmFwUmVhc29uOiBFeHBlY3RlZCAicmVhc29uIiB0byBiZSBhIChwb3NzaWJseSBjbG9uZWQpIEVycm9yLicpOwogIH0KICBzd2l0Y2ggKGV4Lm5hbWUpIHsKICAgIGNhc2UgIkFib3J0RXhjZXB0aW9uIjoKICAgICAgcmV0dXJuIG5ldyBBYm9ydEV4Y2VwdGlvbihleC5tZXNzYWdlKTsKICAgIGNhc2UgIkludmFsaWRQREZFeGNlcHRpb24iOgogICAgICByZXR1cm4gbmV3IEludmFsaWRQREZFeGNlcHRpb24oZXgubWVzc2FnZSk7CiAgICBjYXNlICJQYXNzd29yZEV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgUGFzc3dvcmRFeGNlcHRpb24oZXgubWVzc2FnZSwgZXguY29kZSk7CiAgICBjYXNlICJSZXNwb25zZUV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2VFeGNlcHRpb24oZXgubWVzc2FnZSwgZXguc3RhdHVzLCBleC5taXNzaW5nKTsKICAgIGNhc2UgIlVua25vd25FcnJvckV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgVW5rbm93bkVycm9yRXhjZXB0aW9uKGV4Lm1lc3NhZ2UsIGV4LmRldGFpbHMpOwogIH0KICByZXR1cm4gbmV3IFVua25vd25FcnJvckV4Y2VwdGlvbihleC5tZXNzYWdlLCBleC50b1N0cmluZygpKTsKfQpjbGFzcyBNZXNzYWdlSGFuZGxlciB7CiAgI21lc3NhZ2VBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICBjb25zdHJ1Y3Rvcihzb3VyY2VOYW1lLCB0YXJnZXROYW1lLCBjb21PYmopIHsKICAgIHRoaXMuc291cmNlTmFtZSA9IHNvdXJjZU5hbWU7CiAgICB0aGlzLnRhcmdldE5hbWUgPSB0YXJnZXROYW1lOwogICAgdGhpcy5jb21PYmogPSBjb21PYmo7CiAgICB0aGlzLmNhbGxiYWNrSWQgPSAxOwogICAgdGhpcy5zdHJlYW1JZCA9IDE7CiAgICB0aGlzLnN0cmVhbVNpbmtzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLmFjdGlvbkhhbmRsZXIgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29tT2JqLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCB0aGlzLiNvbk1lc3NhZ2UuYmluZCh0aGlzKSwgewogICAgICBzaWduYWw6IHRoaXMuI21lc3NhZ2VBQy5zaWduYWwKICAgIH0pOwogIH0KICAjb25NZXNzYWdlKHsKICAgIGRhdGEKICB9KSB7CiAgICBpZiAoZGF0YS50YXJnZXROYW1lICE9PSB0aGlzLnNvdXJjZU5hbWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGRhdGEuc3RyZWFtKSB7CiAgICAgIHRoaXMuI3Byb2Nlc3NTdHJlYW1NZXNzYWdlKGRhdGEpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoZGF0YS5jYWxsYmFjaykgewogICAgICBjb25zdCBjYWxsYmFja0lkID0gZGF0YS5jYWxsYmFja0lkOwogICAgICBjb25zdCBjYXBhYmlsaXR5ID0gdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXTsKICAgICAgaWYgKCFjYXBhYmlsaXR5KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgcmVzb2x2ZSBjYWxsYmFjayAke2NhbGxiYWNrSWR9YCk7CiAgICAgIH0KICAgICAgZGVsZXRlIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF07CiAgICAgIGlmIChkYXRhLmNhbGxiYWNrID09PSBDYWxsYmFja0tpbmQuREFUQSkgewogICAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZShkYXRhLmRhdGEpOwogICAgICB9IGVsc2UgaWYgKGRhdGEuY2FsbGJhY2sgPT09IENhbGxiYWNrS2luZC5FUlJPUikgewogICAgICAgIGNhcGFiaWxpdHkucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgY2FsbGJhY2sgY2FzZSIpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuYWN0aW9uSGFuZGxlcltkYXRhLmFjdGlvbl07CiAgICBpZiAoIWFjdGlvbikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYWN0aW9uIGZyb20gd29ya2VyOiAke2RhdGEuYWN0aW9ufWApOwogICAgfQogICAgaWYgKGRhdGEuY2FsbGJhY2tJZCkgewogICAgICBjb25zdCBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWUgPSBkYXRhLnNvdXJjZU5hbWUsCiAgICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICAgIFByb21pc2UudHJ5KGFjdGlvbiwgZGF0YS5kYXRhKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBjYWxsYmFjazogQ2FsbGJhY2tLaW5kLkRBVEEsCiAgICAgICAgICBjYWxsYmFja0lkOiBkYXRhLmNhbGxiYWNrSWQsCiAgICAgICAgICBkYXRhOiByZXN1bHQKICAgICAgICB9KTsKICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIGNhbGxiYWNrOiBDYWxsYmFja0tpbmQuRVJST1IsCiAgICAgICAgICBjYWxsYmFja0lkOiBkYXRhLmNhbGxiYWNrSWQsCiAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGRhdGEuc3RyZWFtSWQpIHsKICAgICAgdGhpcy4jY3JlYXRlU3RyZWFtU2luayhkYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgYWN0aW9uKGRhdGEuZGF0YSk7CiAgfQogIG9uKGFjdGlvbk5hbWUsIGhhbmRsZXIpIHsKICAgIGNvbnN0IGFoID0gdGhpcy5hY3Rpb25IYW5kbGVyOwogICAgaWYgKGFoW2FjdGlvbk5hbWVdKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgaXMgYWxyZWFkeSBhbiBhY3Rpb25OYW1lIGNhbGxlZCAiJHthY3Rpb25OYW1lfSJgKTsKICAgIH0KICAgIGFoW2FjdGlvbk5hbWVdID0gaGFuZGxlcjsKICB9CiAgc2VuZChhY3Rpb25OYW1lLCBkYXRhLCB0cmFuc2ZlcnMpIHsKICAgIHRoaXMuY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgc291cmNlTmFtZTogdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lOiB0aGlzLnRhcmdldE5hbWUsCiAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgZGF0YQogICAgfSwgdHJhbnNmZXJzKTsKICB9CiAgc2VuZFdpdGhQcm9taXNlKGFjdGlvbk5hbWUsIGRhdGEsIHRyYW5zZmVycykgewogICAgY29uc3QgY2FsbGJhY2tJZCA9IHRoaXMuY2FsbGJhY2tJZCsrOwogICAgY29uc3QgY2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXSA9IGNhcGFiaWxpdHk7CiAgICB0cnkgewogICAgICB0aGlzLmNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlTmFtZTogdGhpcy5zb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWU6IHRoaXMudGFyZ2V0TmFtZSwKICAgICAgICBhY3Rpb246IGFjdGlvbk5hbWUsCiAgICAgICAgY2FsbGJhY2tJZCwKICAgICAgICBkYXRhCiAgICAgIH0sIHRyYW5zZmVycyk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBjYXBhYmlsaXR5LnJlamVjdChleCk7CiAgICB9CiAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBzZW5kV2l0aFN0cmVhbShhY3Rpb25OYW1lLCBkYXRhLCBxdWV1ZWluZ1N0cmF0ZWd5LCB0cmFuc2ZlcnMpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gdGhpcy5zdHJlYW1JZCsrLAogICAgICBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lID0gdGhpcy50YXJnZXROYW1lLAogICAgICBjb21PYmogPSB0aGlzLmNvbU9iajsKICAgIHJldHVybiBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICBzdGFydDogY29udHJvbGxlciA9PiB7CiAgICAgICAgY29uc3Qgc3RhcnRDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0gPSB7CiAgICAgICAgICBjb250cm9sbGVyLAogICAgICAgICAgc3RhcnRDYWxsOiBzdGFydENhcGFiaWxpdHksCiAgICAgICAgICBwdWxsQ2FsbDogbnVsbCwKICAgICAgICAgIGNhbmNlbENhbGw6IG51bGwsCiAgICAgICAgICBpc0Nsb3NlZDogZmFsc2UKICAgICAgICB9OwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIGRlc2lyZWRTaXplOiBjb250cm9sbGVyLmRlc2lyZWRTaXplCiAgICAgICAgfSwgdHJhbnNmZXJzKTsKICAgICAgICByZXR1cm4gc3RhcnRDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0sCiAgICAgIHB1bGw6IGNvbnRyb2xsZXIgPT4gewogICAgICAgIGNvbnN0IHB1bGxDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0ucHVsbENhbGwgPSBwdWxsQ2FwYWJpbGl0eTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTCwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgZGVzaXJlZFNpemU6IGNvbnRyb2xsZXIuZGVzaXJlZFNpemUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcHVsbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfSwKICAgICAgY2FuY2VsOiByZWFzb24gPT4gewogICAgICAgIGFzc2VydChyZWFzb24gaW5zdGFuY2VvZiBFcnJvciwgImNhbmNlbCBtdXN0IGhhdmUgYSB2YWxpZCByZWFzb24iKTsKICAgICAgICBjb25zdCBjYW5jZWxDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY2FuY2VsQ2FsbCA9IGNhbmNlbENhcGFiaWxpdHk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uaXNDbG9zZWQgPSB0cnVlOwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUwsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGNhbmNlbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfQogICAgfSwgcXVldWVpbmdTdHJhdGVneSk7CiAgfQogICNjcmVhdGVTdHJlYW1TaW5rKGRhdGEpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gZGF0YS5zdHJlYW1JZCwKICAgICAgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZSwKICAgICAgdGFyZ2V0TmFtZSA9IGRhdGEuc291cmNlTmFtZSwKICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICBjb25zdCBzZWxmID0gdGhpcywKICAgICAgYWN0aW9uID0gdGhpcy5hY3Rpb25IYW5kbGVyW2RhdGEuYWN0aW9uXTsKICAgIGNvbnN0IHN0cmVhbVNpbmsgPSB7CiAgICAgIGVucXVldWUoY2h1bmssIHNpemUgPSAxLCB0cmFuc2ZlcnMpIHsKICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYXN0RGVzaXJlZFNpemUgPSB0aGlzLmRlc2lyZWRTaXplOwogICAgICAgIHRoaXMuZGVzaXJlZFNpemUgLT0gc2l6ZTsKICAgICAgICBpZiAobGFzdERlc2lyZWRTaXplID4gMCAmJiB0aGlzLmRlc2lyZWRTaXplIDw9IDApIHsKICAgICAgICAgIHRoaXMuc2lua0NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgICAgICAgIHRoaXMucmVhZHkgPSB0aGlzLnNpbmtDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5FTlFVRVVFLAogICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICBjaHVuawogICAgICAgIH0sIHRyYW5zZmVycyk7CiAgICAgIH0sCiAgICAgIGNsb3NlKCkgewogICAgICAgIGlmICh0aGlzLmlzQ2FuY2VsbGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuaXNDYW5jZWxsZWQgPSB0cnVlOwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DTE9TRSwKICAgICAgICAgIHN0cmVhbUlkCiAgICAgICAgfSk7CiAgICAgICAgZGVsZXRlIHNlbGYuc3RyZWFtU2lua3Nbc3RyZWFtSWRdOwogICAgICB9LAogICAgICBlcnJvcihyZWFzb24pIHsKICAgICAgICBhc3NlcnQocmVhc29uIGluc3RhbmNlb2YgRXJyb3IsICJlcnJvciBtdXN0IGhhdmUgYSB2YWxpZCByZWFzb24iKTsKICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmlzQ2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuRVJST1IsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHNpbmtDYXBhYmlsaXR5OiBQcm9taXNlLndpdGhSZXNvbHZlcnMoKSwKICAgICAgb25QdWxsOiBudWxsLAogICAgICBvbkNhbmNlbDogbnVsbCwKICAgICAgaXNDYW5jZWxsZWQ6IGZhbHNlLAogICAgICBkZXNpcmVkU2l6ZTogZGF0YS5kZXNpcmVkU2l6ZSwKICAgICAgcmVhZHk6IG51bGwKICAgIH07CiAgICBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgIHN0cmVhbVNpbmsucmVhZHkgPSBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnByb21pc2U7CiAgICB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXSA9IHN0cmVhbVNpbms7CiAgICBQcm9taXNlLnRyeShhY3Rpb24sIGRhdGEuZGF0YSwgc3RyZWFtU2luaykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlTmFtZSwKICAgICAgICB0YXJnZXROYW1lLAogICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5TVEFSVF9DT01QTEVURSwKICAgICAgICBzdHJlYW1JZCwKICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgIH0pOwogICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuU1RBUlRfQ09NUExFVEUsCiAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgfSk7CiAgICB9KTsKICB9CiAgI3Byb2Nlc3NTdHJlYW1NZXNzYWdlKGRhdGEpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gZGF0YS5zdHJlYW1JZCwKICAgICAgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZSwKICAgICAgdGFyZ2V0TmFtZSA9IGRhdGEuc291cmNlTmFtZSwKICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICBjb25zdCBzdHJlYW1Db250cm9sbGVyID0gdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0sCiAgICAgIHN0cmVhbVNpbmsgPSB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXTsKICAgIHN3aXRjaCAoZGF0YS5zdHJlYW0pIHsKICAgICAgY2FzZSBTdHJlYW1LaW5kLlNUQVJUX0NPTVBMRVRFOgogICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuc3RhcnRDYWxsLnJlc29sdmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5zdGFydENhbGwucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFOgogICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIucHVsbENhbGwucmVzb2x2ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1Db250cm9sbGVyLnB1bGxDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuUFVMTDoKICAgICAgICBpZiAoIXN0cmVhbVNpbmspIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFLAogICAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgICAgc3VjY2VzczogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbVNpbmsuZGVzaXJlZFNpemUgPD0gMCAmJiBkYXRhLmRlc2lyZWRTaXplID4gMCkgewogICAgICAgICAgc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgfQogICAgICAgIHN0cmVhbVNpbmsuZGVzaXJlZFNpemUgPSBkYXRhLmRlc2lyZWRTaXplOwogICAgICAgIFByb21pc2UudHJ5KHN0cmVhbVNpbmsub25QdWxsIHx8IG9uRm4pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTF9DT01QTEVURSwKICAgICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkVOUVVFVUU6CiAgICAgICAgYXNzZXJ0KHN0cmVhbUNvbnRyb2xsZXIsICJlbnF1ZXVlIHNob3VsZCBoYXZlIHN0cmVhbSBjb250cm9sbGVyIik7CiAgICAgICAgaWYgKHN0cmVhbUNvbnRyb2xsZXIuaXNDbG9zZWQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzdHJlYW1Db250cm9sbGVyLmNvbnRyb2xsZXIuZW5xdWV1ZShkYXRhLmNodW5rKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkNMT1NFOgogICAgICAgIGFzc2VydChzdHJlYW1Db250cm9sbGVyLCAiY2xvc2Ugc2hvdWxkIGhhdmUgc3RyZWFtIGNvbnRyb2xsZXIiKTsKICAgICAgICBpZiAoc3RyZWFtQ29udHJvbGxlci5pc0Nsb3NlZCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuaXNDbG9zZWQgPSB0cnVlOwogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY29udHJvbGxlci5jbG9zZSgpOwogICAgICAgIHRoaXMuI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuRVJST1I6CiAgICAgICAgYXNzZXJ0KHN0cmVhbUNvbnRyb2xsZXIsICJlcnJvciBzaG91bGQgaGF2ZSBzdHJlYW0gY29udHJvbGxlciIpOwogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY29udHJvbGxlci5lcnJvcih3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgdGhpcy4jZGVsZXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW1Db250cm9sbGVyLCBzdHJlYW1JZCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEU6CiAgICAgICAgaWYgKGRhdGEuc3VjY2VzcykgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsLnJlc29sdmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuQ0FOQ0VMOgogICAgICAgIGlmICghc3RyZWFtU2luaykgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRhdGFSZWFzb24gPSB3cmFwUmVhc29uKGRhdGEucmVhc29uKTsKICAgICAgICBQcm9taXNlLnRyeShzdHJlYW1TaW5rLm9uQ2FuY2VsIHx8IG9uRm4sIGRhdGFSZWFzb24pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkNBTkNFTF9DT01QTEVURSwKICAgICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5yZWplY3QoZGF0YVJlYXNvbik7CiAgICAgICAgc3RyZWFtU2luay5pc0NhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgZGVsZXRlIHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBzdHJlYW0gY2FzZSIpOwogICAgfQogIH0KICBhc3luYyAjZGVsZXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW1Db250cm9sbGVyLCBzdHJlYW1JZCkgewogICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFtzdHJlYW1Db250cm9sbGVyLnN0YXJ0Q2FsbD8ucHJvbWlzZSwgc3RyZWFtQ29udHJvbGxlci5wdWxsQ2FsbD8ucHJvbWlzZSwgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsPy5wcm9taXNlXSk7CiAgICBkZWxldGUgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF07CiAgfQogIGRlc3Ryb3koKSB7CiAgICB0aGlzLiNtZXNzYWdlQUM/LmFib3J0KCk7CiAgICB0aGlzLiNtZXNzYWdlQUMgPSBudWxsOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvd3JpdGVyLmpzCgoKCgoKCgphc3luYyBmdW5jdGlvbiB3cml0ZU9iamVjdChyZWYsIG9iaiwgYnVmZmVyLCB7CiAgZW5jcnlwdCA9IG51bGwsCiAgZW5jcnlwdFJlZiA9IG51bGwKfSkgewogIGNvbnN0IHRyYW5zZm9ybSA9IGVuY3J5cHQgJiYgZW5jcnlwdFJlZiAhPT0gcmVmID8gZW5jcnlwdC5jcmVhdGVDaXBoZXJUcmFuc2Zvcm0ocmVmLm51bSwgcmVmLmdlbikgOiBudWxsOwogIGJ1ZmZlci5wdXNoKGAke3JlZi5udW19ICR7cmVmLmdlbn0gb2JqXG5gKTsKICBhd2FpdCB3cml0ZVZhbHVlKG9iaiwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIGJ1ZmZlci5wdXNoKCJcbmVuZG9ialxuIik7Cn0KYXN5bmMgZnVuY3Rpb24gd3JpdGVEaWN0KGRpY3QsIGJ1ZmZlciwgdHJhbnNmb3JtKSB7CiAgYnVmZmVyLnB1c2goIjw8Iik7CiAgZm9yIChjb25zdCBba2V5LCByYXdPYmpdIG9mIGRpY3QuZ2V0UmF3RW50cmllcygpKSB7CiAgICBidWZmZXIucHVzaChgIC8ke2VzY2FwZVBERk5hbWUoa2V5KX0gYCk7CiAgICBhd2FpdCB3cml0ZVZhbHVlKHJhd09iaiwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIH0KICBidWZmZXIucHVzaCgiPj4iKTsKfQphc3luYyBmdW5jdGlvbiB3cml0ZVN0cmVhbShzdHJlYW0sIGJ1ZmZlciwgdHJhbnNmb3JtKSB7CiAgc3RyZWFtID0gc3RyZWFtLmdldE9yaWdpbmFsU3RyZWFtKCk7CiAgc3RyZWFtLnJlc2V0KCk7CiAgbGV0IGJ5dGVzID0gc3RyZWFtLmdldEJ5dGVzKCk7CiAgY29uc3QgewogICAgZGljdAogIH0gPSBzdHJlYW07CiAgY29uc3QgW2ZpbHRlciwgcGFyYW1zXSA9IGF3YWl0IFByb21pc2UuYWxsKFtkaWN0LmdldEFzeW5jKCJGaWx0ZXIiKSwgZGljdC5nZXRBc3luYygiRGVjb2RlUGFybXMiKV0pOwogIGNvbnN0IGZpbHRlclplcm8gPSBBcnJheS5pc0FycmF5KGZpbHRlcikgPyBhd2FpdCBkaWN0LnhyZWYuZmV0Y2hJZlJlZkFzeW5jKGZpbHRlclswXSkgOiBmaWx0ZXI7CiAgY29uc3QgaXNGaWx0ZXJaZXJvRmxhdGVEZWNvZGUgPSBpc05hbWUoZmlsdGVyWmVybywgIkZsYXRlRGVjb2RlIik7CiAgY29uc3QgTUlOX0xFTkdUSF9GT1JfQ09NUFJFU1NJTkcgPSAyNTY7CiAgaWYgKGJ5dGVzLmxlbmd0aCA+PSBNSU5fTEVOR1RIX0ZPUl9DT01QUkVTU0lORyAmJiAhaXNGaWx0ZXJaZXJvRmxhdGVEZWNvZGUpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGNzID0gbmV3IENvbXByZXNzaW9uU3RyZWFtKCJkZWZsYXRlIik7CiAgICAgIGNvbnN0IHdyaXRlciA9IGNzLndyaXRhYmxlLmdldFdyaXRlcigpOwogICAgICBhd2FpdCB3cml0ZXIucmVhZHk7CiAgICAgIHdyaXRlci53cml0ZShieXRlcykudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgYXdhaXQgd3JpdGVyLnJlYWR5OwogICAgICAgIGF3YWl0IHdyaXRlci5jbG9zZSgpOwogICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgIGNvbnN0IGJ1ZiA9IGF3YWl0IG5ldyBSZXNwb25zZShjcy5yZWFkYWJsZSkuYXJyYXlCdWZmZXIoKTsKICAgICAgYnl0ZXMgPSBuZXcgVWludDhBcnJheShidWYpOwogICAgICBsZXQgbmV3RmlsdGVyLCBuZXdQYXJhbXM7CiAgICAgIGlmICghZmlsdGVyKSB7CiAgICAgICAgbmV3RmlsdGVyID0gTmFtZS5nZXQoIkZsYXRlRGVjb2RlIik7CiAgICAgIH0gZWxzZSBpZiAoIWlzRmlsdGVyWmVyb0ZsYXRlRGVjb2RlKSB7CiAgICAgICAgbmV3RmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gW05hbWUuZ2V0KCJGbGF0ZURlY29kZSIpLCAuLi5maWx0ZXJdIDogW05hbWUuZ2V0KCJGbGF0ZURlY29kZSIpLCBmaWx0ZXJdOwogICAgICAgIGlmIChwYXJhbXMpIHsKICAgICAgICAgIG5ld1BhcmFtcyA9IEFycmF5LmlzQXJyYXkocGFyYW1zKSA/IFtudWxsLCAuLi5wYXJhbXNdIDogW251bGwsIHBhcmFtc107CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChuZXdGaWx0ZXIpIHsKICAgICAgICBkaWN0LnNldCgiRmlsdGVyIiwgbmV3RmlsdGVyKTsKICAgICAgfQogICAgICBpZiAobmV3UGFyYW1zKSB7CiAgICAgICAgZGljdC5zZXQoIkRlY29kZVBhcm1zIiwgbmV3UGFyYW1zKTsKICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaW5mbyhgd3JpdGVTdHJlYW0gLSBjYW5ub3QgY29tcHJlc3MgZGF0YTogIiR7ZXh9Ii5gKTsKICAgIH0KICB9CiAgbGV0IHN0cmluZyA9IGJ5dGVzVG9TdHJpbmcoYnl0ZXMpOwogIGlmICh0cmFuc2Zvcm0pIHsKICAgIHN0cmluZyA9IHRyYW5zZm9ybS5lbmNyeXB0U3RyaW5nKHN0cmluZyk7CiAgfQogIGRpY3Quc2V0KCJMZW5ndGgiLCBzdHJpbmcubGVuZ3RoKTsKICBhd2FpdCB3cml0ZURpY3QoZGljdCwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIGJ1ZmZlci5wdXNoKCIgc3RyZWFtXG4iLCBzdHJpbmcsICJcbmVuZHN0cmVhbSIpOwp9CmFzeW5jIGZ1bmN0aW9uIHdyaXRlQXJyYXkoYXJyYXksIGJ1ZmZlciwgdHJhbnNmb3JtKSB7CiAgYnVmZmVyLnB1c2goIlsiKTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBhcnJheS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBhd2FpdCB3cml0ZVZhbHVlKGFycmF5W2ldLCBidWZmZXIsIHRyYW5zZm9ybSk7CiAgICBpZiAoaSA8IGlpIC0gMSkgewogICAgICBidWZmZXIucHVzaCgiICIpOwogICAgfQogIH0KICBidWZmZXIucHVzaCgiXSIpOwp9CmFzeW5jIGZ1bmN0aW9uIHdyaXRlVmFsdWUodmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKSB7CiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgYnVmZmVyLnB1c2goYC8ke2VzY2FwZVBERk5hbWUodmFsdWUubmFtZSl9YCk7CiAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFJlZikgewogICAgYnVmZmVyLnB1c2goYCR7dmFsdWUubnVtfSAke3ZhbHVlLmdlbn0gUmApOwogIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgQXJyYXlCdWZmZXIuaXNWaWV3KHZhbHVlKSkgewogICAgYXdhaXQgd3JpdGVBcnJheSh2YWx1ZSwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgaWYgKHRyYW5zZm9ybSkgewogICAgICB2YWx1ZSA9IHRyYW5zZm9ybS5lbmNyeXB0U3RyaW5nKHZhbHVlKTsKICAgIH0KICAgIGJ1ZmZlci5wdXNoKGAoJHtlc2NhcGVTdHJpbmcodmFsdWUpfSlgKTsKICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHsKICAgIGJ1ZmZlci5wdXNoKHZhbHVlLnRvU3RyaW5nKCkpOwogIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAiYm9vbGVhbiIpIHsKICAgIGJ1ZmZlci5wdXNoKHZhbHVlLnRvU3RyaW5nKCkpOwogIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICBhd2FpdCB3cml0ZURpY3QodmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgYXdhaXQgd3JpdGVTdHJlYW0odmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICBidWZmZXIucHVzaCgibnVsbCIpOwogIH0gZWxzZSB7CiAgICB3YXJuKGBVbmhhbmRsZWQgdmFsdWUgaW4gd3JpdGVyOiAke3R5cGVvZiB2YWx1ZX0sIHBsZWFzZSBmaWxlIGEgYnVnLmApOwogIH0KfQpmdW5jdGlvbiB3cml0ZUludChudW1iZXIsIHNpemUsIG9mZnNldCwgYnVmZmVyKSB7CiAgZm9yIChsZXQgaSA9IHNpemUgKyBvZmZzZXQgLSAxOyBpID4gb2Zmc2V0IC0gMTsgaS0tKSB7CiAgICBidWZmZXJbaV0gPSBudW1iZXIgJiAweGZmOwogICAgbnVtYmVyID4+PSA4OwogIH0KICByZXR1cm4gb2Zmc2V0ICsgc2l6ZTsKfQpmdW5jdGlvbiB3cml0ZVN0cmluZyhzdHJpbmcsIG9mZnNldCwgYnVmZmVyKSB7CiAgY29uc3QgaWkgPSBzdHJpbmcubGVuZ3RoOwogIGZvciAobGV0IGkgPSAwOyBpIDwgaWk7IGkrKykgewogICAgYnVmZmVyW29mZnNldCArIGldID0gc3RyaW5nLmNoYXJDb2RlQXQoaSkgJiAweGZmOwogIH0KICByZXR1cm4gb2Zmc2V0ICsgaWk7Cn0KZnVuY3Rpb24gY29tcHV0ZU1ENShmaWxlc2l6ZSwgeHJlZkluZm8pIHsKICBjb25zdCB0aW1lID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7CiAgY29uc3QgZmlsZW5hbWUgPSB4cmVmSW5mby5maWxlbmFtZSB8fCAiIjsKICBjb25zdCBtZDVCdWZmZXIgPSBbdGltZS50b1N0cmluZygpLCBmaWxlbmFtZSwgZmlsZXNpemUudG9TdHJpbmcoKSwgLi4ueHJlZkluZm8uaW5mb01hcC52YWx1ZXMoKV07CiAgY29uc3QgbWQ1QnVmZmVyTGVuID0gTWF0aC5zdW1QcmVjaXNlKG1kNUJ1ZmZlci5tYXAoc3RyID0+IHN0ci5sZW5ndGgpKTsKICBjb25zdCBhcnJheSA9IG5ldyBVaW50OEFycmF5KG1kNUJ1ZmZlckxlbik7CiAgbGV0IG9mZnNldCA9IDA7CiAgZm9yIChjb25zdCBzdHIgb2YgbWQ1QnVmZmVyKSB7CiAgICBvZmZzZXQgPSB3cml0ZVN0cmluZyhzdHIsIG9mZnNldCwgYXJyYXkpOwogIH0KICByZXR1cm4gYnl0ZXNUb1N0cmluZyhjYWxjdWxhdGVNRDUoYXJyYXksIDAsIGFycmF5Lmxlbmd0aCkpOwp9CmZ1bmN0aW9uIHdyaXRlWEZBRGF0YUZvckFjcm9mb3JtKHN0ciwgY2hhbmdlcykgewogIGNvbnN0IHhtbCA9IG5ldyBTaW1wbGVYTUxQYXJzZXIoewogICAgaGFzQXR0cmlidXRlczogdHJ1ZQogIH0pLnBhcnNlRnJvbVN0cmluZyhzdHIpOwogIGZvciAoY29uc3QgewogICAgeGZhCiAgfSBvZiBjaGFuZ2VzKSB7CiAgICBpZiAoIXhmYSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcGF0aCwKICAgICAgdmFsdWUKICAgIH0gPSB4ZmE7CiAgICBpZiAoIXBhdGgpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBub2RlUGF0aCA9IHBhcnNlWEZBUGF0aChwYXRoKTsKICAgIGxldCBub2RlID0geG1sLmRvY3VtZW50RWxlbWVudC5zZWFyY2hOb2RlKG5vZGVQYXRoLCAwKTsKICAgIGlmICghbm9kZSAmJiBub2RlUGF0aC5sZW5ndGggPiAxKSB7CiAgICAgIG5vZGUgPSB4bWwuZG9jdW1lbnRFbGVtZW50LnNlYXJjaE5vZGUoW25vZGVQYXRoLmF0KC0xKV0sIDApOwogICAgfQogICAgaWYgKG5vZGUpIHsKICAgICAgbm9kZS5jaGlsZE5vZGVzID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAodmFsID0+IG5ldyBTaW1wbGVET01Ob2RlKCJ2YWx1ZSIsIHZhbCkpIDogW25ldyBTaW1wbGVET01Ob2RlKCIjdGV4dCIsIHZhbHVlKV07CiAgICB9IGVsc2UgewogICAgICB3YXJuKGBOb2RlIG5vdCBmb3VuZCBmb3IgcGF0aDogJHtwYXRofWApOwogICAgfQogIH0KICBjb25zdCBidWZmZXIgPSBbXTsKICB4bWwuZG9jdW1lbnRFbGVtZW50LmR1bXAoYnVmZmVyKTsKICByZXR1cm4gYnVmZmVyLmpvaW4oIiIpOwp9CmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUFjcm9mb3JtKHsKICB4cmVmLAogIGFjcm9Gb3JtLAogIGFjcm9Gb3JtUmVmLAogIGhhc1hmYSwKICBoYXNYZmFEYXRhc2V0c0VudHJ5LAogIHhmYURhdGFzZXRzUmVmLAogIG5lZWRBcHBlYXJhbmNlcywKICBjaGFuZ2VzCn0pIHsKICBpZiAoaGFzWGZhICYmICFoYXNYZmFEYXRhc2V0c0VudHJ5ICYmICF4ZmFEYXRhc2V0c1JlZikgewogICAgd2FybigiWEZBIC0gQ2Fubm90IHNhdmUgaXQiKTsKICB9CiAgaWYgKCFuZWVkQXBwZWFyYW5jZXMgJiYgKCFoYXNYZmEgfHwgIXhmYURhdGFzZXRzUmVmIHx8IGhhc1hmYURhdGFzZXRzRW50cnkpKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IGRpY3QgPSBhY3JvRm9ybS5jbG9uZSgpOwogIGlmIChoYXNYZmEgJiYgIWhhc1hmYURhdGFzZXRzRW50cnkpIHsKICAgIGNvbnN0IG5ld1hmYSA9IGFjcm9Gb3JtLmdldCgiWEZBIikuc2xpY2UoKTsKICAgIG5ld1hmYS5zcGxpY2UoMiwgMCwgImRhdGFzZXRzIik7CiAgICBuZXdYZmEuc3BsaWNlKDMsIDAsIHhmYURhdGFzZXRzUmVmKTsKICAgIGRpY3Quc2V0KCJYRkEiLCBuZXdYZmEpOwogIH0KICBpZiAobmVlZEFwcGVhcmFuY2VzKSB7CiAgICBkaWN0LnNldCgiTmVlZEFwcGVhcmFuY2VzIiwgdHJ1ZSk7CiAgfQogIGNoYW5nZXMucHV0KGFjcm9Gb3JtUmVmLCB7CiAgICBkYXRhOiBkaWN0CiAgfSk7Cn0KZnVuY3Rpb24gdXBkYXRlWEZBKHsKICB4ZmFEYXRhLAogIHhmYURhdGFzZXRzUmVmLAogIGNoYW5nZXMsCiAgeHJlZgp9KSB7CiAgaWYgKHhmYURhdGEgPT09IG51bGwpIHsKICAgIGNvbnN0IGRhdGFzZXRzID0geHJlZi5mZXRjaElmUmVmKHhmYURhdGFzZXRzUmVmKTsKICAgIHhmYURhdGEgPSB3cml0ZVhGQURhdGFGb3JBY3JvZm9ybShkYXRhc2V0cy5nZXRTdHJpbmcoKSwgY2hhbmdlcyk7CiAgfQogIGNvbnN0IHhmYURhdGFTdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKHhmYURhdGEpOwogIHhmYURhdGFTdHJlYW0uZGljdCA9IG5ldyBEaWN0KHhyZWYpOwogIHhmYURhdGFTdHJlYW0uZGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiRW1iZWRkZWRGaWxlIik7CiAgY2hhbmdlcy5wdXQoeGZhRGF0YXNldHNSZWYsIHsKICAgIGRhdGE6IHhmYURhdGFTdHJlYW0KICB9KTsKfQphc3luYyBmdW5jdGlvbiBnZXRYUmVmVGFibGUoeHJlZkluZm8sIGJhc2VPZmZzZXQsIG5ld1JlZnMsIG5ld1hyZWYsIGJ1ZmZlcikgewogIGJ1ZmZlci5wdXNoKCJ4cmVmXG4iKTsKICBjb25zdCBpbmRleGVzID0gZ2V0SW5kZXhlcyhuZXdSZWZzKTsKICBsZXQgaW5kZXhlc1Bvc2l0aW9uID0gMDsKICBmb3IgKGNvbnN0IHsKICAgIHJlZiwKICAgIGRhdGEKICB9IG9mIG5ld1JlZnMpIHsKICAgIGlmIChyZWYubnVtID09PSBpbmRleGVzW2luZGV4ZXNQb3NpdGlvbl0pIHsKICAgICAgYnVmZmVyLnB1c2goYCR7aW5kZXhlc1tpbmRleGVzUG9zaXRpb25dfSAke2luZGV4ZXNbaW5kZXhlc1Bvc2l0aW9uICsgMV19XG5gKTsKICAgICAgaW5kZXhlc1Bvc2l0aW9uICs9IDI7CiAgICB9CiAgICBpZiAoZGF0YSAhPT0gbnVsbCkgewogICAgICBidWZmZXIucHVzaChgJHtiYXNlT2Zmc2V0LnRvU3RyaW5nKCkucGFkU3RhcnQoMTAsICIwIil9ICR7TWF0aC5taW4ocmVmLmdlbiwgMHhmZmZmKS50b1N0cmluZygpLnBhZFN0YXJ0KDUsICIwIil9IG5cclxuYCk7CiAgICAgIGJhc2VPZmZzZXQgKz0gZGF0YS5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICBidWZmZXIucHVzaChgMDAwMDAwMDAwMCAke01hdGgubWluKHJlZi5nZW4gKyAxLCAweGZmZmYpLnRvU3RyaW5nKCkucGFkU3RhcnQoNSwgIjAiKX0gZlxyXG5gKTsKICAgIH0KICB9CiAgY29tcHV0ZUlEcyhiYXNlT2Zmc2V0LCB4cmVmSW5mbywgbmV3WHJlZik7CiAgYnVmZmVyLnB1c2goInRyYWlsZXJcbiIpOwogIGF3YWl0IHdyaXRlRGljdChuZXdYcmVmLCBidWZmZXIsIG51bGwpOwogIGJ1ZmZlci5wdXNoKCJcbnN0YXJ0eHJlZlxuIiwgYmFzZU9mZnNldC50b1N0cmluZygpLCAiXG4lJUVPRlxuIik7Cn0KZnVuY3Rpb24gZ2V0SW5kZXhlcyhuZXdSZWZzKSB7CiAgY29uc3QgaW5kZXhlcyA9IFtdOwogIGZvciAoY29uc3QgewogICAgcmVmCiAgfSBvZiBuZXdSZWZzKSB7CiAgICBpZiAocmVmLm51bSA9PT0gaW5kZXhlcy5hdCgtMikgKyBpbmRleGVzLmF0KC0xKSkgewogICAgICBpbmRleGVzW2luZGV4ZXMubGVuZ3RoIC0gMV0gKz0gMTsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4ZXMucHVzaChyZWYubnVtLCAxKTsKICAgIH0KICB9CiAgcmV0dXJuIGluZGV4ZXM7Cn0KYXN5bmMgZnVuY3Rpb24gZ2V0WFJlZlN0cmVhbVRhYmxlKHhyZWZJbmZvLCBiYXNlT2Zmc2V0LCBuZXdSZWZzLCBuZXdYcmVmLCBidWZmZXIpIHsKICBjb25zdCB4cmVmVGFibGVEYXRhID0gW107CiAgbGV0IG1heE9mZnNldCA9IDA7CiAgbGV0IG1heEdlbiA9IDA7CiAgZm9yIChjb25zdCB7CiAgICByZWYsCiAgICBkYXRhLAogICAgb2JqU3RyZWFtUmVmLAogICAgaW5kZXgKICB9IG9mIG5ld1JlZnMpIHsKICAgIGxldCBnZW47CiAgICBtYXhPZmZzZXQgPSBNYXRoLm1heChtYXhPZmZzZXQsIGJhc2VPZmZzZXQpOwogICAgaWYgKG9ialN0cmVhbVJlZikgewogICAgICBnZW4gPSBpbmRleDsKICAgICAgeHJlZlRhYmxlRGF0YS5wdXNoKFsyLCBvYmpTdHJlYW1SZWYubnVtLCBnZW5dKTsKICAgIH0gZWxzZSBpZiAoZGF0YSAhPT0gbnVsbCkgewogICAgICBnZW4gPSBNYXRoLm1pbihyZWYuZ2VuLCAweGZmZmYpOwogICAgICB4cmVmVGFibGVEYXRhLnB1c2goWzEsIGJhc2VPZmZzZXQsIGdlbl0pOwogICAgICBiYXNlT2Zmc2V0ICs9IGRhdGEubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgZ2VuID0gTWF0aC5taW4ocmVmLmdlbiArIDEsIDB4ZmZmZik7CiAgICAgIHhyZWZUYWJsZURhdGEucHVzaChbMCwgMCwgZ2VuXSk7CiAgICB9CiAgICBtYXhHZW4gPSBNYXRoLm1heChtYXhHZW4sIGdlbik7CiAgfQogIG5ld1hyZWYuc2V0KCJJbmRleCIsIGdldEluZGV4ZXMobmV3UmVmcykpOwogIGNvbnN0IG9mZnNldFNpemUgPSBnZXRTaXplSW5CeXRlcyhtYXhPZmZzZXQpOwogIGNvbnN0IG1heEdlblNpemUgPSBnZXRTaXplSW5CeXRlcyhtYXhHZW4pOwogIGNvbnN0IHNpemVzID0gWzEsIG9mZnNldFNpemUsIG1heEdlblNpemVdOwogIG5ld1hyZWYuc2V0KCJXIiwgc2l6ZXMpOwogIGNvbXB1dGVJRHMoYmFzZU9mZnNldCwgeHJlZkluZm8sIG5ld1hyZWYpOwogIGNvbnN0IHN0cnVjdFNpemUgPSBNYXRoLnN1bVByZWNpc2Uoc2l6ZXMpOwogIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShzdHJ1Y3RTaXplICogeHJlZlRhYmxlRGF0YS5sZW5ndGgpOwogIGNvbnN0IHN0cmVhbSA9IG5ldyBTdHJlYW0oZGF0YSk7CiAgc3RyZWFtLmRpY3QgPSBuZXdYcmVmOwogIGxldCBvZmZzZXQgPSAwOwogIGZvciAoY29uc3QgW3R5cGUsIG9iak9mZnNldCwgZ2VuXSBvZiB4cmVmVGFibGVEYXRhKSB7CiAgICBvZmZzZXQgPSB3cml0ZUludCh0eXBlLCBzaXplc1swXSwgb2Zmc2V0LCBkYXRhKTsKICAgIG9mZnNldCA9IHdyaXRlSW50KG9iak9mZnNldCwgc2l6ZXNbMV0sIG9mZnNldCwgZGF0YSk7CiAgICBvZmZzZXQgPSB3cml0ZUludChnZW4sIHNpemVzWzJdLCBvZmZzZXQsIGRhdGEpOwogIH0KICBhd2FpdCB3cml0ZU9iamVjdCh4cmVmSW5mby5uZXdSZWYsIHN0cmVhbSwgYnVmZmVyLCB7fSk7CiAgYnVmZmVyLnB1c2goInN0YXJ0eHJlZlxuIiwgYmFzZU9mZnNldC50b1N0cmluZygpLCAiXG4lJUVPRlxuIik7Cn0KZnVuY3Rpb24gY29tcHV0ZUlEcyhiYXNlT2Zmc2V0LCB4cmVmSW5mbywgbmV3WHJlZikgewogIGlmIChBcnJheS5pc0FycmF5KHhyZWZJbmZvLmZpbGVJZHMpICYmIHhyZWZJbmZvLmZpbGVJZHMubGVuZ3RoID4gMCkgewogICAgY29uc3QgbWQ1ID0gY29tcHV0ZU1ENShiYXNlT2Zmc2V0LCB4cmVmSW5mbyk7CiAgICBuZXdYcmVmLnNldCgiSUQiLCBbeHJlZkluZm8uZmlsZUlkc1swXSB8fCBtZDUsIG1kNV0pOwogIH0KfQpmdW5jdGlvbiBnZXRUcmFpbGVyRGljdCh4cmVmSW5mbywgY2hhbmdlcywgdXNlWHJlZlN0cmVhbSkgewogIGNvbnN0IG5ld1hyZWYgPSBuZXcgRGljdChudWxsKTsKICBuZXdYcmVmLnNldElmRGVmaW5lZCgiUHJldiIsIHhyZWZJbmZvPy5zdGFydFhSZWYpOwogIGNvbnN0IHJlZkZvclhyZWZUYWJsZSA9IHhyZWZJbmZvLm5ld1JlZjsKICBpZiAodXNlWHJlZlN0cmVhbSkgewogICAgY2hhbmdlcy5wdXQocmVmRm9yWHJlZlRhYmxlLCB7CiAgICAgIGRhdGE6ICIiCiAgICB9KTsKICAgIG5ld1hyZWYuc2V0KCJTaXplIiwgcmVmRm9yWHJlZlRhYmxlLm51bSArIDEpOwogICAgbmV3WHJlZi5zZXRJZk5hbWUoIlR5cGUiLCAiWFJlZiIpOwogIH0gZWxzZSB7CiAgICBuZXdYcmVmLnNldCgiU2l6ZSIsIHJlZkZvclhyZWZUYWJsZS5udW0pOwogIH0KICBuZXdYcmVmLnNldElmRGVmaW5lZCgiUm9vdCIsIHhyZWZJbmZvPy5yb290UmVmKTsKICBuZXdYcmVmLnNldElmRGVmaW5lZCgiSW5mbyIsIHhyZWZJbmZvPy5pbmZvUmVmKTsKICBuZXdYcmVmLnNldElmRGVmaW5lZCgiRW5jcnlwdCIsIHhyZWZJbmZvPy5lbmNyeXB0UmVmKTsKICByZXR1cm4gbmV3WHJlZjsKfQphc3luYyBmdW5jdGlvbiB3cml0ZUNoYW5nZXMoY2hhbmdlcywgeHJlZiwgYnVmZmVyID0gW10pIHsKICBjb25zdCBuZXdSZWZzID0gW107CiAgZm9yIChjb25zdCBbcmVmLCB7CiAgICBkYXRhLAogICAgb2JqU3RyZWFtUmVmLAogICAgaW5kZXgKICB9XSBvZiBjaGFuZ2VzLml0ZW1zKCkpIHsKICAgIGlmIChvYmpTdHJlYW1SZWYpIHsKICAgICAgbmV3UmVmcy5wdXNoKHsKICAgICAgICByZWYsCiAgICAgICAgZGF0YSwKICAgICAgICBvYmpTdHJlYW1SZWYsCiAgICAgICAgaW5kZXgKICAgICAgfSk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKGRhdGEgPT09IG51bGwgfHwgdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciKSB7CiAgICAgIG5ld1JlZnMucHVzaCh7CiAgICAgICAgcmVmLAogICAgICAgIGRhdGEKICAgICAgfSk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgYXdhaXQgd3JpdGVPYmplY3QocmVmLCBkYXRhLCBidWZmZXIsIHhyZWYpOwogICAgbmV3UmVmcy5wdXNoKHsKICAgICAgcmVmLAogICAgICBkYXRhOiBidWZmZXIuam9pbigiIikKICAgIH0pOwogICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgfQogIHJldHVybiBuZXdSZWZzLnNvcnQoKGEsIGIpID0+IGEucmVmLm51bSAtIGIucmVmLm51bSk7Cn0KYXN5bmMgZnVuY3Rpb24gaW5jcmVtZW50YWxVcGRhdGUoewogIG9yaWdpbmFsRGF0YSwKICB4cmVmSW5mbywKICBjaGFuZ2VzLAogIHhyZWYgPSBudWxsLAogIGhhc1hmYSA9IGZhbHNlLAogIHhmYURhdGFzZXRzUmVmID0gbnVsbCwKICBoYXNYZmFEYXRhc2V0c0VudHJ5ID0gZmFsc2UsCiAgbmVlZEFwcGVhcmFuY2VzLAogIGFjcm9Gb3JtUmVmID0gbnVsbCwKICBhY3JvRm9ybSA9IG51bGwsCiAgeGZhRGF0YSA9IG51bGwsCiAgdXNlWHJlZlN0cmVhbSA9IGZhbHNlCn0pIHsKICBhd2FpdCB1cGRhdGVBY3JvZm9ybSh7CiAgICB4cmVmLAogICAgYWNyb0Zvcm0sCiAgICBhY3JvRm9ybVJlZiwKICAgIGhhc1hmYSwKICAgIGhhc1hmYURhdGFzZXRzRW50cnksCiAgICB4ZmFEYXRhc2V0c1JlZiwKICAgIG5lZWRBcHBlYXJhbmNlcywKICAgIGNoYW5nZXMKICB9KTsKICBpZiAoaGFzWGZhKSB7CiAgICB1cGRhdGVYRkEoewogICAgICB4ZmFEYXRhLAogICAgICB4ZmFEYXRhc2V0c1JlZiwKICAgICAgY2hhbmdlcywKICAgICAgeHJlZgogICAgfSk7CiAgfQogIGNvbnN0IG5ld1hyZWYgPSBnZXRUcmFpbGVyRGljdCh4cmVmSW5mbywgY2hhbmdlcywgdXNlWHJlZlN0cmVhbSk7CiAgY29uc3QgYnVmZmVyID0gW107CiAgY29uc3QgbmV3UmVmcyA9IGF3YWl0IHdyaXRlQ2hhbmdlcyhjaGFuZ2VzLCB4cmVmLCBidWZmZXIpOwogIGxldCBiYXNlT2Zmc2V0ID0gb3JpZ2luYWxEYXRhLmxlbmd0aDsKICBjb25zdCBsYXN0Qnl0ZSA9IG9yaWdpbmFsRGF0YS5hdCgtMSk7CiAgaWYgKGxhc3RCeXRlICE9PSAweDBhICYmIGxhc3RCeXRlICE9PSAweDBkKSB7CiAgICBidWZmZXIucHVzaCgiXG4iKTsKICAgIGJhc2VPZmZzZXQgKz0gMTsKICB9CiAgZm9yIChjb25zdCB7CiAgICBkYXRhCiAgfSBvZiBuZXdSZWZzKSB7CiAgICBpZiAoZGF0YSAhPT0gbnVsbCkgewogICAgICBidWZmZXIucHVzaChkYXRhKTsKICAgIH0KICB9CiAgYXdhaXQgKHVzZVhyZWZTdHJlYW0gPyBnZXRYUmVmU3RyZWFtVGFibGUoeHJlZkluZm8sIGJhc2VPZmZzZXQsIG5ld1JlZnMsIG5ld1hyZWYsIGJ1ZmZlcikgOiBnZXRYUmVmVGFibGUoeHJlZkluZm8sIGJhc2VPZmZzZXQsIG5ld1JlZnMsIG5ld1hyZWYsIGJ1ZmZlcikpOwogIGNvbnN0IHRvdGFsTGVuZ3RoID0gb3JpZ2luYWxEYXRhLmxlbmd0aCArIE1hdGguc3VtUHJlY2lzZShidWZmZXIubWFwKHN0ciA9PiBzdHIubGVuZ3RoKSk7CiAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheSh0b3RhbExlbmd0aCk7CiAgYXJyYXkuc2V0KG9yaWdpbmFsRGF0YSk7CiAgbGV0IG9mZnNldCA9IG9yaWdpbmFsRGF0YS5sZW5ndGg7CiAgZm9yIChjb25zdCBzdHIgb2YgYnVmZmVyKSB7CiAgICBvZmZzZXQgPSB3cml0ZVN0cmluZyhzdHIsIG9mZnNldCwgYXJyYXkpOwogIH0KICByZXR1cm4gYXJyYXk7Cn0KCjsvLyAuL3NyYy9jb3JlL2VkaXRvci9wZGZfZWRpdG9yLmpzCgoKCgoKCgpjb25zdCBNQVhfTEVBVkVTX1BFUl9QQUdFU19OT0RFID0gMTY7CmNvbnN0IE1BWF9JTl9OQU1FX1RSRUVfTk9ERSA9IDY0OwpjbGFzcyBQYWdlRGF0YSB7CiAgY29uc3RydWN0b3IocGFnZSwgZG9jdW1lbnREYXRhKSB7CiAgICB0aGlzLnBhZ2UgPSBwYWdlOwogICAgdGhpcy5kb2N1bWVudERhdGEgPSBkb2N1bWVudERhdGE7CiAgICB0aGlzLmFubm90YXRpb25zID0gbnVsbDsKICAgIHRoaXMucG9pbnRpbmdOYW1lZERlc3RpbmF0aW9ucyA9IG51bGw7CiAgICBkb2N1bWVudERhdGEucGFnZXNNYXAucHV0KHBhZ2UucmVmLCB0aGlzKTsKICB9Cn0KY2xhc3MgRG9jdW1lbnREYXRhIHsKICBjb25zdHJ1Y3Rvcihkb2N1bWVudCkgewogICAgdGhpcy5kb2N1bWVudCA9IGRvY3VtZW50OwogICAgdGhpcy5kZXN0aW5hdGlvbnMgPSBudWxsOwogICAgdGhpcy5wYWdlTGFiZWxzID0gbnVsbDsKICAgIHRoaXMucGFnZXNNYXAgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICAgIHRoaXMub2xkUmVmTWFwcGluZyA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgdGhpcy5kZWR1cE5hbWVkRGVzdGluYXRpb25zID0gbmV3IE1hcCgpOwogICAgdGhpcy51c2VkTmFtZWREZXN0aW5hdGlvbnMgPSBuZXcgU2V0KCk7CiAgICB0aGlzLnBvc3Rwb25lZFJlZkNvcGllcyA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgdGhpcy51c2VkU3RydWN0UGFyZW50cyA9IG5ldyBTZXQoKTsKICAgIHRoaXMub2xkU3RydWN0UGFyZW50TWFwcGluZyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuc3RydWN0VHJlZVJvb3QgPSBudWxsOwogICAgdGhpcy5wYXJlbnRUcmVlID0gbnVsbDsKICAgIHRoaXMuaWRUcmVlID0gbnVsbDsKICAgIHRoaXMucm9sZU1hcCA9IG51bGw7CiAgICB0aGlzLmNsYXNzTWFwID0gbnVsbDsKICAgIHRoaXMubmFtZXNwYWNlcyA9IG51bGw7CiAgICB0aGlzLnN0cnVjdFRyZWVBRiA9IG51bGw7CiAgICB0aGlzLnN0cnVjdFRyZWVQcm9udW5jaWF0aW9uTGV4aWNvbiA9IFtdOwogIH0KfQpjbGFzcyBYUmVmV3JhcHBlciB7CiAgY29uc3RydWN0b3IoZW50cmllcykgewogICAgdGhpcy5lbnRyaWVzID0gZW50cmllczsKICB9CiAgZmV0Y2gocmVmKSB7CiAgICByZXR1cm4gcmVmIGluc3RhbmNlb2YgUmVmID8gdGhpcy5lbnRyaWVzW3JlZi5udW1dIDogcmVmOwogIH0KfQpjbGFzcyBQREZFZGl0b3IgewogIGNvbnN0cnVjdG9yKHsKICAgIHVzZU9iamVjdFN0cmVhbXMgPSB0cnVlLAogICAgdGl0bGUgPSAiIiwKICAgIGF1dGhvciA9ICIiCiAgfSA9IHt9KSB7CiAgICB0aGlzLmhhc1NpbmdsZUZpbGUgPSBmYWxzZTsKICAgIHRoaXMuY3VycmVudERvY3VtZW50ID0gbnVsbDsKICAgIHRoaXMub2xkUGFnZXMgPSBbXTsKICAgIHRoaXMubmV3UGFnZXMgPSBbXTsKICAgIHRoaXMueHJlZiA9IFtudWxsXTsKICAgIHRoaXMueHJlZldyYXBwZXIgPSBuZXcgWFJlZldyYXBwZXIodGhpcy54cmVmKTsKICAgIHRoaXMubmV3UmVmQ291bnQgPSAxOwogICAgW3RoaXMucm9vdFJlZiwgdGhpcy5yb290RGljdF0gPSB0aGlzLm5ld0RpY3Q7CiAgICBbdGhpcy5pbmZvUmVmLCB0aGlzLmluZm9EaWN0XSA9IHRoaXMubmV3RGljdDsKICAgIFt0aGlzLnBhZ2VzUmVmLCB0aGlzLnBhZ2VzRGljdF0gPSB0aGlzLm5ld0RpY3Q7CiAgICB0aGlzLm5hbWVzRGljdCA9IG51bGw7CiAgICB0aGlzLnVzZU9iamVjdFN0cmVhbXMgPSB1c2VPYmplY3RTdHJlYW1zOwogICAgdGhpcy5vYmpTdHJlYW1SZWZzID0gdXNlT2JqZWN0U3RyZWFtcyA/IG5ldyBTZXQoKSA6IG51bGw7CiAgICB0aGlzLnZlcnNpb24gPSAiMS43IjsKICAgIHRoaXMudGl0bGUgPSB0aXRsZTsKICAgIHRoaXMuYXV0aG9yID0gYXV0aG9yOwogICAgdGhpcy5wYWdlTGFiZWxzID0gbnVsbDsKICAgIHRoaXMubmFtZWREZXN0aW5hdGlvbnMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnBhcmVudFRyZWUgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnN0cnVjdFRyZWVLaWRzID0gW107CiAgICB0aGlzLmlkVHJlZSA9IG5ldyBNYXAoKTsKICAgIHRoaXMuY2xhc3NNYXAgPSBuZXcgRGljdCgpOwogICAgdGhpcy5yb2xlTWFwID0gbmV3IERpY3QoKTsKICAgIHRoaXMubmFtZXNwYWNlcyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuc3RydWN0VHJlZUFGID0gW107CiAgICB0aGlzLnN0cnVjdFRyZWVQcm9udW5jaWF0aW9uTGV4aWNvbiA9IFtdOwogIH0KICBnZXQgbmV3UmVmKCkgewogICAgY29uc3QgcmVmID0gUmVmLmdldCh0aGlzLm5ld1JlZkNvdW50KyssIDApOwogICAgcmV0dXJuIHJlZjsKICB9CiAgZ2V0IG5ld0RpY3QoKSB7CiAgICBjb25zdCByZWYgPSB0aGlzLm5ld1JlZjsKICAgIGNvbnN0IGRpY3QgPSB0aGlzLnhyZWZbcmVmLm51bV0gPSBuZXcgRGljdCgpOwogICAgcmV0dXJuIFtyZWYsIGRpY3RdOwogIH0KICBhc3luYyAjY2xvbmVPYmplY3Qob2JqLCB4cmVmKSB7CiAgICBjb25zdCByZWYgPSB0aGlzLm5ld1JlZjsKICAgIHRoaXMueHJlZltyZWYubnVtXSA9IGF3YWl0IHRoaXMuI2NvbGxlY3REZXBlbmRlbmNpZXMob2JqLCB0cnVlLCB4cmVmKTsKICAgIHJldHVybiByZWY7CiAgfQogIGNsb25lRGljdChkaWN0KSB7CiAgICBjb25zdCBuZXdEaWN0ID0gZGljdC5jbG9uZSgpOwogICAgbmV3RGljdC54cmVmID0gdGhpcy54cmVmV3JhcHBlcjsKICAgIHJldHVybiBuZXdEaWN0OwogIH0KICBhc3luYyAjY29sbGVjdERlcGVuZGVuY2llcyhvYmosIG11c3RDbG9uZSwgeHJlZikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIFJlZikgewogICAgICBjb25zdCB7CiAgICAgICAgY3VycmVudERvY3VtZW50OiB7CiAgICAgICAgICBvbGRSZWZNYXBwaW5nCiAgICAgICAgfQogICAgICB9ID0gdGhpczsKICAgICAgbGV0IG5ld1JlZiA9IG9sZFJlZk1hcHBpbmcuZ2V0KG9iaik7CiAgICAgIGlmIChuZXdSZWYpIHsKICAgICAgICByZXR1cm4gbmV3UmVmOwogICAgICB9CiAgICAgIGNvbnN0IG9sZFJlZiA9IG9iajsKICAgICAgb2JqID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKG9sZFJlZik7CiAgICAgIGlmICh0eXBlb2Ygb2JqID09PSAibnVtYmVyIikgewogICAgICAgIHJldHVybiBvYmo7CiAgICAgIH0KICAgICAgbmV3UmVmID0gdGhpcy5uZXdSZWY7CiAgICAgIG9sZFJlZk1hcHBpbmcucHV0KG9sZFJlZiwgbmV3UmVmKTsKICAgICAgdGhpcy54cmVmW25ld1JlZi5udW1dID0gYXdhaXQgdGhpcy4jY29sbGVjdERlcGVuZGVuY2llcyhvYmosIHRydWUsIHhyZWYpOwogICAgICByZXR1cm4gbmV3UmVmOwogICAgfQogICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgIGNvbnN0IHsKICAgICAgY3VycmVudERvY3VtZW50OiB7CiAgICAgICAgcG9zdHBvbmVkUmVmQ29waWVzCiAgICAgIH0KICAgIH0gPSB0aGlzOwogICAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkgewogICAgICBpZiAobXVzdENsb25lKSB7CiAgICAgICAgb2JqID0gb2JqLnNsaWNlKCk7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gb2JqLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBwb3N0cG9uZWRBY3Rpb25zID0gcG9zdHBvbmVkUmVmQ29waWVzLmdldChvYmpbaV0pOwogICAgICAgIGlmIChwb3N0cG9uZWRBY3Rpb25zKSB7CiAgICAgICAgICBwb3N0cG9uZWRBY3Rpb25zLnB1c2gocmVmID0+IG9ialtpXSA9IHJlZik7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLiNjb2xsZWN0RGVwZW5kZW5jaWVzKG9ialtpXSwgdHJ1ZSwgeHJlZikudGhlbihuZXdPYmogPT4gb2JqW2ldID0gbmV3T2JqKSk7CiAgICAgIH0KICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgICByZXR1cm4gb2JqOwogICAgfQogICAgbGV0IGRpY3Q7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAoewogICAgICAgIGRpY3QKICAgICAgfSA9IG9iaiA9IG9iai5nZXRPcmlnaW5hbFN0cmVhbSgpLmNsb25lKCkpOwogICAgICBkaWN0LnhyZWYgPSB0aGlzLnhyZWZXcmFwcGVyOwogICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGlmIChtdXN0Q2xvbmUpIHsKICAgICAgICBvYmogPSBvYmouY2xvbmUoKTsKICAgICAgICBvYmoueHJlZiA9IHRoaXMueHJlZldyYXBwZXI7CiAgICAgIH0KICAgICAgZGljdCA9IG9iajsKICAgIH0KICAgIGlmIChkaWN0KSB7CiAgICAgIGZvciAoY29uc3QgW2tleSwgcmF3T2JqXSBvZiBkaWN0LmdldFJhd0VudHJpZXMoKSkgewogICAgICAgIGNvbnN0IHBvc3Rwb25lZEFjdGlvbnMgPSBwb3N0cG9uZWRSZWZDb3BpZXMuZ2V0KHJhd09iaik7CiAgICAgICAgaWYgKHBvc3Rwb25lZEFjdGlvbnMpIHsKICAgICAgICAgIHBvc3Rwb25lZEFjdGlvbnMucHVzaChyZWYgPT4gZGljdC5zZXQoa2V5LCByZWYpKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMuI2NvbGxlY3REZXBlbmRlbmNpZXMocmF3T2JqLCB0cnVlLCB4cmVmKS50aGVuKG5ld09iaiA9PiBkaWN0LnNldChrZXksIG5ld09iaikpKTsKICAgICAgfQogICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgICB9CiAgICByZXR1cm4gb2JqOwogIH0KICBhc3luYyAjY2xvbmVTdHJ1Y3RUcmVlTm9kZShwYXJlbnRTdHJ1Y3RSZWYsIG5vZGUsIHhyZWYsIHJlbW92ZWRTdHJ1Y3RFbGVtZW50cywgZGVkdXBJRHMsIGRlZHVwQ2xhc3NlcywgZGVkdXBSb2xlcywgdmlzaXRlZCA9IG5ldyBSZWZTZXQoKSkgewogICAgY29uc3QgewogICAgICBjdXJyZW50RG9jdW1lbnQ6IHsKICAgICAgICBwYWdlc01hcCwKICAgICAgICBvbGRSZWZNYXBwaW5nCiAgICAgIH0KICAgIH0gPSB0aGlzOwogICAgY29uc3QgcGcgPSBub2RlLmdldFJhdygiUGciKTsKICAgIGlmIChwZyBpbnN0YW5jZW9mIFJlZiAmJiAhcGFnZXNNYXAuaGFzKHBnKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBraWRzOwogICAgY29uc3QgayA9IGtpZHMgPSBub2RlLmdldFJhdygiSyIpOwogICAgaWYgKGsgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgaWYgKHZpc2l0ZWQuaGFzKGspKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAga2lkcyA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhrKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGtpZHMpKSB7CiAgICAgICAga2lkcyA9IFtrXTsKICAgICAgfQogICAgfQogICAga2lkcyA9IEFycmF5LmlzQXJyYXkoa2lkcykgPyBraWRzIDogW2tpZHNdOwogICAgY29uc3QgbmV3S2lkcyA9IFtdOwogICAgY29uc3Qgc3RydWN0RWxlbUluZGljZXMgPSBbXTsKICAgIGZvciAobGV0IGtpZCBvZiBraWRzKSB7CiAgICAgIGNvbnN0IGtpZFJlZiA9IGtpZCBpbnN0YW5jZW9mIFJlZiA/IGtpZCA6IG51bGw7CiAgICAgIGlmIChraWRSZWYpIHsKICAgICAgICBpZiAodmlzaXRlZC5oYXMoa2lkUmVmKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZpc2l0ZWQucHV0KGtpZFJlZik7CiAgICAgICAga2lkID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKGtpZFJlZik7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBraWQgPT09ICJudW1iZXIiKSB7CiAgICAgICAgbmV3S2lkcy5wdXNoKGtpZCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCEoa2lkIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBwZ1JlZiA9IGtpZC5nZXRSYXcoIlBnIik7CiAgICAgIGlmIChwZ1JlZiBpbnN0YW5jZW9mIFJlZiAmJiAhcGFnZXNNYXAuaGFzKHBnUmVmKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHR5cGUgPSBraWQuZ2V0KCJUeXBlIik7CiAgICAgIGlmICghdHlwZSB8fCBpc05hbWUodHlwZSwgIlN0cnVjdEVsZW0iKSkgewogICAgICAgIGxldCBzZXRBc1NwYW4gPSBmYWxzZTsKICAgICAgICBpZiAoa2lkUmVmICYmIHJlbW92ZWRTdHJ1Y3RFbGVtZW50cy5oYXMoa2lkUmVmKSkgewogICAgICAgICAgaWYgKCFpc05hbWUoa2lkLmdldCgiUyIpLCAiTGluayIpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc2V0QXNTcGFuID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV3S2lkUmVmID0gYXdhaXQgdGhpcy4jY2xvbmVTdHJ1Y3RUcmVlTm9kZShraWRSZWYsIGtpZCwgeHJlZiwgcmVtb3ZlZFN0cnVjdEVsZW1lbnRzLCBkZWR1cElEcywgZGVkdXBDbGFzc2VzLCBkZWR1cFJvbGVzLCB2aXNpdGVkKTsKICAgICAgICBpZiAobmV3S2lkUmVmKSB7CiAgICAgICAgICBzdHJ1Y3RFbGVtSW5kaWNlcy5wdXNoKG5ld0tpZHMubGVuZ3RoKTsKICAgICAgICAgIG5ld0tpZHMucHVzaChuZXdLaWRSZWYpOwogICAgICAgICAgaWYgKGtpZFJlZikgewogICAgICAgICAgICBvbGRSZWZNYXBwaW5nLnB1dChraWRSZWYsIG5ld0tpZFJlZik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc2V0QXNTcGFuKSB7CiAgICAgICAgICAgIHRoaXMueHJlZltuZXdLaWRSZWYubnVtXS5zZXRJZk5hbWUoIlMiLCAiU3BhbiIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoaXNOYW1lKHR5cGUsICJPQkpSIikpIHsKICAgICAgICBpZiAoIWtpZFJlZikgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG5ld0tpZFJlZiA9IG9sZFJlZk1hcHBpbmcuZ2V0KGtpZFJlZik7CiAgICAgICAgaWYgKCFuZXdLaWRSZWYpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBuZXdLaWQgPSB0aGlzLnhyZWZbbmV3S2lkUmVmLm51bV07CiAgICAgICAgY29uc3Qgb2JqUmVmID0gbmV3S2lkLmdldFJhdygiT2JqIik7CiAgICAgICAgaWYgKG9ialJlZiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgY29uc3Qgb2JqID0gdGhpcy54cmVmW29ialJlZi5udW1dOwogICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QgJiYgIW9iai5oYXMoIlN0cnVjdFBhcmVudCIpICYmIHBhcmVudFN0cnVjdFJlZikgewogICAgICAgICAgICBjb25zdCBzdHJ1Y3RQYXJlbnQgPSB0aGlzLnBhcmVudFRyZWUuc2l6ZTsKICAgICAgICAgICAgdGhpcy5wYXJlbnRUcmVlLnNldChzdHJ1Y3RQYXJlbnQsIFtvbGRSZWZNYXBwaW5nLCBwYXJlbnRTdHJ1Y3RSZWZdKTsKICAgICAgICAgICAgb2JqLnNldCgiU3RydWN0UGFyZW50Iiwgc3RydWN0UGFyZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbmV3S2lkcy5wdXNoKG5ld0tpZFJlZik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGlzTmFtZSh0eXBlLCAiTUNSIikpIHsKICAgICAgICBjb25zdCBuZXdLaWQgPSBhd2FpdCB0aGlzLiNjb2xsZWN0RGVwZW5kZW5jaWVzKGtpZFJlZiB8fCBraWQsIHRydWUsIHhyZWYpOwogICAgICAgIG5ld0tpZHMucHVzaChuZXdLaWQpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChraWRSZWYpIHsKICAgICAgICBjb25zdCBuZXdLaWRSZWYgPSBhd2FpdCB0aGlzLiNjb2xsZWN0RGVwZW5kZW5jaWVzKGtpZFJlZiwgdHJ1ZSwgeHJlZik7CiAgICAgICAgbmV3S2lkcy5wdXNoKG5ld0tpZFJlZik7CiAgICAgIH0KICAgIH0KICAgIGlmIChraWRzLmxlbmd0aCAhPT0gMCAmJiBuZXdLaWRzLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IG5ld05vZGVSZWYgPSB0aGlzLm5ld1JlZjsKICAgIGNvbnN0IG5ld05vZGUgPSB0aGlzLnhyZWZbbmV3Tm9kZVJlZi5udW1dID0gdGhpcy5jbG9uZURpY3Qobm9kZSk7CiAgICBuZXdOb2RlLmRlbGV0ZSgiSUQiKTsKICAgIG5ld05vZGUuZGVsZXRlKCJDIik7CiAgICBuZXdOb2RlLmRlbGV0ZSgiSyIpOwogICAgbmV3Tm9kZS5kZWxldGUoIlAiKTsKICAgIG5ld05vZGUuZGVsZXRlKCJTIik7CiAgICBhd2FpdCB0aGlzLiNjb2xsZWN0RGVwZW5kZW5jaWVzKG5ld05vZGUsIGZhbHNlLCB4cmVmKTsKICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBub2RlLmdldCgiQyIpOwogICAgaWYgKGNsYXNzTmFtZXMgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIGNvbnN0IG5ld0NsYXNzTmFtZSA9IGRlZHVwQ2xhc3Nlcy5nZXQoY2xhc3NOYW1lcy5uYW1lKTsKICAgICAgaWYgKG5ld0NsYXNzTmFtZSkgewogICAgICAgIG5ld05vZGUuc2V0KCJDIiwgTmFtZS5nZXQobmV3Q2xhc3NOYW1lKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV3Tm9kZS5zZXQoIkMiLCBjbGFzc05hbWVzKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGNsYXNzTmFtZXMpKSB7CiAgICAgIGNvbnN0IG5ld0NsYXNzTmFtZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBjbGFzc05hbWUgb2YgY2xhc3NOYW1lcykgewogICAgICAgIGlmIChjbGFzc05hbWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICBjb25zdCBuZXdDbGFzc05hbWUgPSBkZWR1cENsYXNzZXMuZ2V0KGNsYXNzTmFtZS5uYW1lKTsKICAgICAgICAgIGlmIChuZXdDbGFzc05hbWUpIHsKICAgICAgICAgICAgbmV3Q2xhc3NOYW1lcy5wdXNoKE5hbWUuZ2V0KG5ld0NsYXNzTmFtZSkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3Q2xhc3NOYW1lcy5wdXNoKGNsYXNzTmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIG5ld05vZGUuc2V0KCJDIiwgbmV3Q2xhc3NOYW1lcyk7CiAgICB9CiAgICBjb25zdCByb2xlTmFtZSA9IG5vZGUuZ2V0KCJTIik7CiAgICBpZiAocm9sZU5hbWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIGNvbnN0IG5ld1JvbGVOYW1lID0gZGVkdXBSb2xlcy5nZXQocm9sZU5hbWUubmFtZSk7CiAgICAgIGlmIChuZXdSb2xlTmFtZSkgewogICAgICAgIG5ld05vZGUuc2V0KCJTIiwgTmFtZS5nZXQobmV3Um9sZU5hbWUpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBuZXdOb2RlLnNldCgiUyIsIHJvbGVOYW1lKTsKICAgICAgfQogICAgfQogICAgY29uc3QgaWQgPSBub2RlLmdldCgiSUQiKTsKICAgIGlmICh0eXBlb2YgaWQgPT09ICJzdHJpbmciKSB7CiAgICAgIGNvbnN0IHN0cmluZ0lkID0gc3RyaW5nVG9QREZTdHJpbmcoaWQsIGZhbHNlKTsKICAgICAgY29uc3QgbmV3SWQgPSBkZWR1cElEcy5nZXQoc3RyaW5nSWQpOwogICAgICBpZiAobmV3SWQpIHsKICAgICAgICBuZXdOb2RlLnNldCgiSUQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKG5ld0lkKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV3Tm9kZS5zZXQoIklEIiwgaWQpOwogICAgICB9CiAgICB9CiAgICBsZXQgYXR0cmlidXRlcyA9IG5ld05vZGUuZ2V0KCJBIik7CiAgICBpZiAoYXR0cmlidXRlcykgewogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoYXR0cmlidXRlcykpIHsKICAgICAgICBhdHRyaWJ1dGVzID0gW2F0dHJpYnV0ZXNdOwogICAgICB9CiAgICAgIGZvciAobGV0IGF0dHIgb2YgYXR0cmlidXRlcykgewogICAgICAgIGF0dHIgPSB0aGlzLnhyZWZXcmFwcGVyLmZldGNoKGF0dHIpOwogICAgICAgIGlmIChpc05hbWUoYXR0ci5nZXQoIk8iKSwgIlRhYmxlIikgJiYgYXR0ci5oYXMoIkhlYWRlcnMiKSkgewogICAgICAgICAgY29uc3QgaGVhZGVycyA9IHRoaXMueHJlZldyYXBwZXIuZmV0Y2goYXR0ci5nZXRSYXcoIkhlYWRlcnMiKSk7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShoZWFkZXJzKSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBoZWFkZXJzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBuZXdJZCA9IGRlZHVwSURzLmdldChzdHJpbmdUb1BERlN0cmluZyhoZWFkZXJzW2ldLCBmYWxzZSkpOwogICAgICAgICAgICAgIGlmIChuZXdJZCkgewogICAgICAgICAgICAgICAgaGVhZGVyc1tpXSA9IG5ld0lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBpbmRleCBvZiBzdHJ1Y3RFbGVtSW5kaWNlcykgewogICAgICBjb25zdCBzdHJ1Y3RFbGVtUmVmID0gbmV3S2lkc1tpbmRleF07CiAgICAgIGNvbnN0IHN0cnVjdEVsZW0gPSB0aGlzLnhyZWZbc3RydWN0RWxlbVJlZi5udW1dOwogICAgICBzdHJ1Y3RFbGVtLnNldCgiUCIsIG5ld05vZGVSZWYpOwogICAgfQogICAgaWYgKG5ld0tpZHMubGVuZ3RoID09PSAxKSB7CiAgICAgIG5ld05vZGUuc2V0KCJLIiwgbmV3S2lkc1swXSk7CiAgICB9IGVsc2UgaWYgKG5ld0tpZHMubGVuZ3RoID4gMSkgewogICAgICBuZXdOb2RlLnNldCgiSyIsIG5ld0tpZHMpOwogICAgfQogICAgcmV0dXJuIG5ld05vZGVSZWY7CiAgfQogIGFzeW5jIGV4dHJhY3RQYWdlcyhwYWdlSW5mb3MpIHsKICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICBsZXQgbmV3SW5kZXggPSAwOwogICAgdGhpcy5oYXNTaW5nbGVGaWxlID0gcGFnZUluZm9zLmxlbmd0aCA9PT0gMTsKICAgIGNvbnN0IGFsbERvY3VtZW50RGF0YSA9IFtdOwogICAgZm9yIChjb25zdCB7CiAgICAgIGRvY3VtZW50LAogICAgICBpbmNsdWRlUGFnZXMsCiAgICAgIGV4Y2x1ZGVQYWdlcwogICAgfSBvZiBwYWdlSW5mb3MpIHsKICAgICAgaWYgKCFkb2N1bWVudCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGRvY3VtZW50RGF0YSA9IG5ldyBEb2N1bWVudERhdGEoZG9jdW1lbnQpOwogICAgICBhbGxEb2N1bWVudERhdGEucHVzaChkb2N1bWVudERhdGEpOwogICAgICBwcm9taXNlcy5wdXNoKHRoaXMuI2NvbGxlY3REb2N1bWVudERhdGEoZG9jdW1lbnREYXRhKSk7CiAgICAgIGxldCBrZXB0SW5kaWNlcywga2VwdFJhbmdlcywgZGVsZXRlZEluZGljZXMsIGRlbGV0ZWRSYW5nZXM7CiAgICAgIGZvciAoY29uc3QgcGFnZSBvZiBpbmNsdWRlUGFnZXMgfHwgW10pIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYWdlKSkgewogICAgICAgICAgKGtlcHRSYW5nZXMgfHw9IFtdKS5wdXNoKHBhZ2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAoa2VwdEluZGljZXMgfHw9IG5ldyBTZXQoKSkuYWRkKHBhZ2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgZXhjbHVkZVBhZ2VzIHx8IFtdKSB7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFnZSkpIHsKICAgICAgICAgIChkZWxldGVkUmFuZ2VzIHx8PSBbXSkucHVzaChwYWdlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgKGRlbGV0ZWRJbmRpY2VzIHx8PSBuZXcgU2V0KCkpLmFkZChwYWdlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZG9jdW1lbnQubnVtUGFnZXM7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgaWYgKGRlbGV0ZWRJbmRpY2VzPy5oYXMoaSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZGVsZXRlZFJhbmdlcykgewogICAgICAgICAgbGV0IGlzRGVsZXRlZCA9IGZhbHNlOwogICAgICAgICAgZm9yIChjb25zdCBbc3RhcnQsIGVuZF0gb2YgZGVsZXRlZFJhbmdlcykgewogICAgICAgICAgICBpZiAoaSA+PSBzdGFydCAmJiBpIDw9IGVuZCkgewogICAgICAgICAgICAgIGlzRGVsZXRlZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc0RlbGV0ZWQpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxldCB0YWtlUGFnZSA9IGZhbHNlOwogICAgICAgIGlmIChrZXB0SW5kaWNlcykgewogICAgICAgICAgdGFrZVBhZ2UgPSBrZXB0SW5kaWNlcy5oYXMoaSk7CiAgICAgICAgfQogICAgICAgIGlmICghdGFrZVBhZ2UgJiYga2VwdFJhbmdlcykgewogICAgICAgICAgZm9yIChjb25zdCBbc3RhcnQsIGVuZF0gb2Yga2VwdFJhbmdlcykgewogICAgICAgICAgICBpZiAoaSA+PSBzdGFydCAmJiBpIDw9IGVuZCkgewogICAgICAgICAgICAgIHRha2VQYWdlID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIXRha2VQYWdlICYmICFrZXB0SW5kaWNlcyAmJiAha2VwdFJhbmdlcykgewogICAgICAgICAgdGFrZVBhZ2UgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIXRha2VQYWdlKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV3UGFnZUluZGV4ID0gbmV3SW5kZXgrKzsKICAgICAgICBwcm9taXNlcy5wdXNoKGRvY3VtZW50LmdldFBhZ2UoaSkudGhlbihwYWdlID0+IHsKICAgICAgICAgIHRoaXMub2xkUGFnZXNbbmV3UGFnZUluZGV4XSA9IG5ldyBQYWdlRGF0YShwYWdlLCBkb2N1bWVudERhdGEpOwogICAgICAgIH0pKTsKICAgICAgfQogICAgfQogICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgcHJvbWlzZXMubGVuZ3RoID0gMDsKICAgIHRoaXMuI2NvbGxlY3RWYWxpZERlc3RpbmF0aW9ucyhhbGxEb2N1bWVudERhdGEpOwogICAgdGhpcy4jY29sbGVjdFBhZ2VMYWJlbHMoKTsKICAgIGZvciAoY29uc3QgcGFnZSBvZiB0aGlzLm9sZFBhZ2VzKSB7CiAgICAgIHByb21pc2VzLnB1c2godGhpcy4jcG9zdENvbGxlY3RQYWdlRGF0YShwYWdlKSk7CiAgICB9CiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgICB0aGlzLiNmaW5kRHVwbGljYXRlTmFtZWREZXN0aW5hdGlvbnMoKTsKICAgIHRoaXMuI3NldFBvc3Rwb25lZFJlZkNvcGllcyhhbGxEb2N1bWVudERhdGEpOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5vbGRQYWdlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIHRoaXMubmV3UGFnZXNbaV0gPSBhd2FpdCB0aGlzLiNtYWtlUGFnZUNvcHkoaSwgbnVsbCk7CiAgICB9CiAgICB0aGlzLiNmaXhQb3N0cG9uZWRSZWZDb3BpZXMoYWxsRG9jdW1lbnREYXRhKTsKICAgIGF3YWl0IHRoaXMuI21lcmdlU3RydWN0VHJlZXMoYWxsRG9jdW1lbnREYXRhKTsKICAgIHJldHVybiB0aGlzLndyaXRlUERGKCk7CiAgfQogIGFzeW5jICNjb2xsZWN0RG9jdW1lbnREYXRhKGRvY3VtZW50RGF0YSkgewogICAgY29uc3QgewogICAgICBkb2N1bWVudDogewogICAgICAgIHBkZk1hbmFnZXIsCiAgICAgICAgeHJlZgogICAgICB9CiAgICB9ID0gZG9jdW1lbnREYXRhOwogICAgYXdhaXQgUHJvbWlzZS5hbGwoW3BkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZGVzdGluYXRpb25zIikudGhlbihkZXN0aW5hdGlvbnMgPT4gZG9jdW1lbnREYXRhLmRlc3RpbmF0aW9ucyA9IGRlc3RpbmF0aW9ucyksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygicmF3UGFnZUxhYmVscyIpLnRoZW4ocGFnZUxhYmVscyA9PiBkb2N1bWVudERhdGEucGFnZUxhYmVscyA9IHBhZ2VMYWJlbHMpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInN0cnVjdFRyZWVSb290IikudGhlbihzdHJ1Y3RUcmVlUm9vdCA9PiBkb2N1bWVudERhdGEuc3RydWN0VHJlZVJvb3QgPSBzdHJ1Y3RUcmVlUm9vdCldKTsKICAgIGNvbnN0IHN0cnVjdFRyZWVSb290ID0gZG9jdW1lbnREYXRhLnN0cnVjdFRyZWVSb290OwogICAgaWYgKHN0cnVjdFRyZWVSb290KSB7CiAgICAgIGNvbnN0IHJvb3REaWN0ID0gc3RydWN0VHJlZVJvb3QuZGljdDsKICAgICAgY29uc3QgcGFyZW50VHJlZSA9IHJvb3REaWN0LmdldCgiUGFyZW50VHJlZSIpOwogICAgICBpZiAocGFyZW50VHJlZSkgewogICAgICAgIGNvbnN0IG51bWJlclRyZWUgPSBuZXcgTnVtYmVyVHJlZShwYXJlbnRUcmVlLCB4cmVmKTsKICAgICAgICBkb2N1bWVudERhdGEucGFyZW50VHJlZSA9IG51bWJlclRyZWUuZ2V0QWxsKHRydWUpOwogICAgICB9CiAgICAgIGNvbnN0IGlkVHJlZSA9IHJvb3REaWN0LmdldCgiSURUcmVlIik7CiAgICAgIGlmIChpZFRyZWUpIHsKICAgICAgICBjb25zdCBuYW1lVHJlZSA9IG5ldyBOYW1lVHJlZShpZFRyZWUsIHhyZWYpOwogICAgICAgIGRvY3VtZW50RGF0YS5pZFRyZWUgPSBuYW1lVHJlZS5nZXRBbGwodHJ1ZSk7CiAgICAgIH0KICAgICAgZG9jdW1lbnREYXRhLnJvbGVNYXAgPSByb290RGljdC5nZXQoIlJvbGVNYXAiKSB8fCBudWxsOwogICAgICBkb2N1bWVudERhdGEuY2xhc3NNYXAgPSByb290RGljdC5nZXQoIkNsYXNzTWFwIikgfHwgbnVsbDsKICAgICAgbGV0IG5hbWVzcGFjZXMgPSByb290RGljdC5nZXQoIk5hbWVzcGFjZXMiKSB8fCBudWxsOwogICAgICBpZiAobmFtZXNwYWNlcyAmJiAhQXJyYXkuaXNBcnJheShuYW1lc3BhY2VzKSkgewogICAgICAgIG5hbWVzcGFjZXMgPSBbbmFtZXNwYWNlc107CiAgICAgIH0KICAgICAgZG9jdW1lbnREYXRhLm5hbWVzcGFjZXMgPSBuYW1lc3BhY2VzOwogICAgICBkb2N1bWVudERhdGEuc3RydWN0VHJlZUFGID0gcm9vdERpY3QuZ2V0KCJBRiIpIHx8IG51bGw7CiAgICAgIGRvY3VtZW50RGF0YS5zdHJ1Y3RUcmVlUHJvbnVuY2lhdGlvbkxleGljb24gPSByb290RGljdC5nZXQoIlByb251bmNpYXRpb25MZXhpY29uIikgfHwgbnVsbDsKICAgIH0KICB9CiAgYXN5bmMgI3Bvc3RDb2xsZWN0UGFnZURhdGEocGFnZURhdGEpIHsKICAgIGNvbnN0IHsKICAgICAgcGFnZTogewogICAgICAgIHhyZWYsCiAgICAgICAgYW5ub3RhdGlvbnMKICAgICAgfSwKICAgICAgZG9jdW1lbnREYXRhOiB7CiAgICAgICAgcGFnZXNNYXAsCiAgICAgICAgZGVzdGluYXRpb25zLAogICAgICAgIHVzZWROYW1lZERlc3RpbmF0aW9ucwogICAgICB9CiAgICB9ID0gcGFnZURhdGE7CiAgICBpZiAoIWFubm90YXRpb25zKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICBsZXQgbmV3QW5ub3RhdGlvbnMgPSBbXTsKICAgIGxldCBuZXdJbmRleCA9IDA7CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb25SZWYgb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgY29uc3QgbmV3QW5ub3RhdGlvbkluZGV4ID0gbmV3SW5kZXgrKzsKICAgICAgcHJvbWlzZXMucHVzaCh4cmVmLmZldGNoSWZSZWZBc3luYyhhbm5vdGF0aW9uUmVmKS50aGVuKGFzeW5jIGFubm90YXRpb25EaWN0ID0+IHsKICAgICAgICBpZiAoIWlzTmFtZShhbm5vdGF0aW9uRGljdC5nZXQoIlN1YnR5cGUiKSwgIkxpbmsiKSkgewogICAgICAgICAgbmV3QW5ub3RhdGlvbnNbbmV3QW5ub3RhdGlvbkluZGV4XSA9IGFubm90YXRpb25SZWY7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFjdGlvbiA9IGFubm90YXRpb25EaWN0LmdldCgiQSIpOwogICAgICAgIGNvbnN0IGRlc3QgPSBhY3Rpb24gaW5zdGFuY2VvZiBEaWN0ID8gYWN0aW9uLmdldCgiRCIpIDogYW5ub3RhdGlvbkRpY3QuZ2V0KCJEZXN0Iik7CiAgICAgICAgaWYgKCFkZXN0IHx8IEFycmF5LmlzQXJyYXkoZGVzdCkgJiYgKCEoZGVzdFswXSBpbnN0YW5jZW9mIFJlZikgfHwgcGFnZXNNYXAuaGFzKGRlc3RbMF0pKSkgewogICAgICAgICAgbmV3QW5ub3RhdGlvbnNbbmV3QW5ub3RhdGlvbkluZGV4XSA9IGFubm90YXRpb25SZWY7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGVzdCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIGNvbnN0IGRlc3RTdHJpbmcgPSBzdHJpbmdUb1BERlN0cmluZyhkZXN0LCB0cnVlKTsKICAgICAgICAgIGlmIChkZXN0aW5hdGlvbnMuaGFzKGRlc3RTdHJpbmcpKSB7CiAgICAgICAgICAgIG5ld0Fubm90YXRpb25zW25ld0Fubm90YXRpb25JbmRleF0gPSBhbm5vdGF0aW9uUmVmOwogICAgICAgICAgICB1c2VkTmFtZWREZXN0aW5hdGlvbnMuYWRkKGRlc3RTdHJpbmcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkpOwogICAgfQogICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgbmV3QW5ub3RhdGlvbnMgPSBuZXdBbm5vdGF0aW9ucy5maWx0ZXIoYW5ub3QgPT4gISFhbm5vdCk7CiAgICBwYWdlRGF0YS5hbm5vdGF0aW9ucyA9IG5ld0Fubm90YXRpb25zLmxlbmd0aCA+IDAgPyBuZXdBbm5vdGF0aW9ucyA6IG51bGw7CiAgfQogICNzZXRQb3N0cG9uZWRSZWZDb3BpZXMoYWxsRG9jdW1lbnREYXRhKSB7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcG9zdHBvbmVkUmVmQ29waWVzLAogICAgICBwYWdlc01hcAogICAgfSBvZiBhbGxEb2N1bWVudERhdGEpIHsKICAgICAgZm9yIChjb25zdCBvbGRQYWdlUmVmIG9mIHBhZ2VzTWFwLmtleXMoKSkgewogICAgICAgIHBvc3Rwb25lZFJlZkNvcGllcy5wdXQob2xkUGFnZVJlZiwgW10pOwogICAgICB9CiAgICB9CiAgfQogICNmaXhQb3N0cG9uZWRSZWZDb3BpZXMoYWxsRG9jdW1lbnREYXRhKSB7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcG9zdHBvbmVkUmVmQ29waWVzLAogICAgICBvbGRSZWZNYXBwaW5nCiAgICB9IG9mIGFsbERvY3VtZW50RGF0YSkgewogICAgICBmb3IgKGNvbnN0IFtvbGRSZWYsIGFjdGlvbnNdIG9mIHBvc3Rwb25lZFJlZkNvcGllcy5pdGVtcygpKSB7CiAgICAgICAgY29uc3QgbmV3UmVmID0gb2xkUmVmTWFwcGluZy5nZXQob2xkUmVmKTsKICAgICAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBhY3Rpb25zKSB7CiAgICAgICAgICBhY3Rpb24obmV3UmVmKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcG9zdHBvbmVkUmVmQ29waWVzLmNsZWFyKCk7CiAgICB9CiAgfQogICN2aXNpdE9iamVjdChvYmosIGNhbGxiYWNrLCB2aXNpdGVkID0gbmV3IFJlZlNldCgpKSB7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIGlmICghdmlzaXRlZC5oYXMob2JqKSkgewogICAgICAgIHZpc2l0ZWQucHV0KG9iaik7CiAgICAgICAgdGhpcy4jdmlzaXRPYmplY3QodGhpcy54cmVmW29iai5udW1dLCBjYWxsYmFjaywgdmlzaXRlZCk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkgewogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2Ygb2JqKSB7CiAgICAgICAgdGhpcy4jdmlzaXRPYmplY3QoaXRlbSwgY2FsbGJhY2ssIHZpc2l0ZWQpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBkaWN0OwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgKHsKICAgICAgICBkaWN0CiAgICAgIH0gPSBvYmopOwogICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGRpY3QgPSBvYmo7CiAgICB9CiAgICBpZiAoZGljdCkgewogICAgICBjYWxsYmFjayhkaWN0KTsKICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiBkaWN0LmdldFJhd1ZhbHVlcygpKSB7CiAgICAgICAgdGhpcy4jdmlzaXRPYmplY3QodmFsdWUsIGNhbGxiYWNrLCB2aXNpdGVkKTsKICAgICAgfQogICAgfQogIH0KICBhc3luYyAjbWVyZ2VTdHJ1Y3RUcmVlcyhhbGxEb2N1bWVudERhdGEpIHsKICAgIGxldCBuZXdTdHJ1Y3RQYXJlbnRJZCA9IDA7CiAgICBjb25zdCB7CiAgICAgIHBhcmVudFRyZWU6IG5ld1BhcmVudFRyZWUKICAgIH0gPSB0aGlzOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5uZXdQYWdlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkb2N1bWVudERhdGE6IHsKICAgICAgICAgIHBhcmVudFRyZWUsCiAgICAgICAgICBvbGRSZWZNYXBwaW5nLAogICAgICAgICAgb2xkU3RydWN0UGFyZW50TWFwcGluZywKICAgICAgICAgIHVzZWRTdHJ1Y3RQYXJlbnRzLAogICAgICAgICAgZG9jdW1lbnQ6IHsKICAgICAgICAgICAgeHJlZgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSA9IHRoaXMub2xkUGFnZXNbaV07CiAgICAgIGlmICghcGFyZW50VHJlZSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2VSZWYgPSB0aGlzLm5ld1BhZ2VzW2ldOwogICAgICBjb25zdCBwYWdlRGljdCA9IHRoaXMueHJlZltwYWdlUmVmLm51bV07CiAgICAgIHRoaXMuI3Zpc2l0T2JqZWN0KHBhZ2VEaWN0LCBkaWN0ID0+IHsKICAgICAgICBjb25zdCBzdHJ1Y3RQYXJlbnQgPSBkaWN0LmdldCgiU3RydWN0UGFyZW50IikgPz8gZGljdC5nZXQoIlN0cnVjdFBhcmVudHMiKTsKICAgICAgICBpZiAodHlwZW9mIHN0cnVjdFBhcmVudCAhPT0gIm51bWJlciIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdXNlZFN0cnVjdFBhcmVudHMuYWRkKHN0cnVjdFBhcmVudCk7CiAgICAgICAgbGV0IHBhcmVudCA9IHBhcmVudFRyZWUuZ2V0KHN0cnVjdFBhcmVudCk7CiAgICAgICAgY29uc3QgcGFyZW50UmVmID0gcGFyZW50IGluc3RhbmNlb2YgUmVmID8gcGFyZW50IDogbnVsbDsKICAgICAgICBpZiAocGFyZW50UmVmKSB7CiAgICAgICAgICBjb25zdCBhcnJheSA9IHhyZWYuZmV0Y2gocGFyZW50UmVmKTsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycmF5KSkgewogICAgICAgICAgICBwYXJlbnQgPSBhcnJheTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyZW50KSAmJiBwYXJlbnQuZXZlcnkocmVmID0+IHJlZiA9PT0gbnVsbCkpIHsKICAgICAgICAgIHBhcmVudCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgICBpZiAoZGljdC5oYXMoIlN0cnVjdFBhcmVudCIpKSB7CiAgICAgICAgICAgIGRpY3QuZGVsZXRlKCJTdHJ1Y3RQYXJlbnQiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRpY3QuZGVsZXRlKCJTdHJ1Y3RQYXJlbnRzIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBuZXdTdHJ1Y3RQYXJlbnQgPSBvbGRTdHJ1Y3RQYXJlbnRNYXBwaW5nLmdldChzdHJ1Y3RQYXJlbnQpOwogICAgICAgIGlmIChuZXdTdHJ1Y3RQYXJlbnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbmV3U3RydWN0UGFyZW50ID0gbmV3U3RydWN0UGFyZW50SWQrKzsKICAgICAgICAgIG9sZFN0cnVjdFBhcmVudE1hcHBpbmcuc2V0KHN0cnVjdFBhcmVudCwgbmV3U3RydWN0UGFyZW50KTsKICAgICAgICAgIG5ld1BhcmVudFRyZWUuc2V0KG5ld1N0cnVjdFBhcmVudCwgW29sZFJlZk1hcHBpbmcsIHBhcmVudF0pOwogICAgICAgIH0KICAgICAgICBpZiAoZGljdC5oYXMoIlN0cnVjdFBhcmVudCIpKSB7CiAgICAgICAgICBkaWN0LnNldCgiU3RydWN0UGFyZW50IiwgbmV3U3RydWN0UGFyZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGljdC5zZXQoIlN0cnVjdFBhcmVudHMiLCBuZXdTdHJ1Y3RQYXJlbnQpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHN0cnVjdFRyZWVLaWRzLAogICAgICBpZFRyZWU6IG5ld0lkVHJlZSwKICAgICAgY2xhc3NNYXA6IG5ld0NsYXNzTWFwLAogICAgICByb2xlTWFwOiBuZXdSb2xlTWFwLAogICAgICBuYW1lc3BhY2VzOiBuZXdOYW1lc3BhY2VzLAogICAgICBzdHJ1Y3RUcmVlQUY6IG5ld1N0cnVjdFRyZWVBRiwKICAgICAgc3RydWN0VHJlZVByb251bmNpYXRpb25MZXhpY29uOiBuZXdTdHJ1Y3RUcmVlUHJvbnVuY2lhdGlvbkxleGljb24KICAgIH0gPSB0aGlzOwogICAgZm9yIChjb25zdCBkb2N1bWVudERhdGEgb2YgYWxsRG9jdW1lbnREYXRhKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkb2N1bWVudDogewogICAgICAgICAgeHJlZgogICAgICAgIH0sCiAgICAgICAgb2xkUmVmTWFwcGluZywKICAgICAgICBwYXJlbnRUcmVlLAogICAgICAgIHVzZWRTdHJ1Y3RQYXJlbnRzLAogICAgICAgIHN0cnVjdFRyZWVSb290LAogICAgICAgIGlkVHJlZSwKICAgICAgICBjbGFzc01hcCwKICAgICAgICByb2xlTWFwLAogICAgICAgIG5hbWVzcGFjZXMsCiAgICAgICAgc3RydWN0VHJlZUFGLAogICAgICAgIHN0cnVjdFRyZWVQcm9udW5jaWF0aW9uTGV4aWNvbgogICAgICB9ID0gZG9jdW1lbnREYXRhOwogICAgICBpZiAoIXN0cnVjdFRyZWVSb290KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGhpcy5jdXJyZW50RG9jdW1lbnQgPSBkb2N1bWVudERhdGE7CiAgICAgIGNvbnN0IHJlbW92ZWRTdHJ1Y3RFbGVtZW50cyA9IG5ldyBSZWZTZXQoKTsKICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgcGFyZW50VHJlZSB8fCBbXSkgewogICAgICAgIGlmICghdXNlZFN0cnVjdFBhcmVudHMuaGFzKGtleSkgJiYgdmFsdWUgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgIHJlbW92ZWRTdHJ1Y3RFbGVtZW50cy5wdXQodmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBkZWR1cElEcyA9IG5ldyBNYXAoKTsKICAgICAgZm9yIChjb25zdCBbaWQsIG5vZGVSZWZdIG9mIGlkVHJlZSB8fCBbXSkgewogICAgICAgIGxldCBfaWQgPSBpZDsKICAgICAgICBpZiAobmV3SWRUcmVlLmhhcyhpZCkpIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOzsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld0lkID0gYCR7aWR9XyR7aX1gOwogICAgICAgICAgICBpZiAoIW5ld0lkVHJlZS5oYXMobmV3SWQpKSB7CiAgICAgICAgICAgICAgZGVkdXBJRHMuc2V0KGlkLCBuZXdJZCk7CiAgICAgICAgICAgICAgX2lkID0gbmV3SWQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbmV3SWRUcmVlLnNldChfaWQsIG5vZGVSZWYpOwogICAgICB9CiAgICAgIGNvbnN0IGRlZHVwQ2xhc3NlcyA9IG5ldyBNYXAoKTsKICAgICAgaWYgKGNsYXNzTWFwPy5zaXplID4gMCkgewogICAgICAgIGZvciAobGV0IFtjbGFzc05hbWUsIGNsYXNzRGljdF0gb2YgY2xhc3NNYXApIHsKICAgICAgICAgIGNsYXNzRGljdCA9IGF3YWl0IHRoaXMuI2NvbGxlY3REZXBlbmRlbmNpZXMoY2xhc3NEaWN0LCB0cnVlLCB4cmVmKTsKICAgICAgICAgIGlmIChuZXdDbGFzc01hcC5oYXMoY2xhc3NOYW1lKSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMTs7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IG5ld0NsYXNzTmFtZSA9IGAke2NsYXNzTmFtZX1fJHtpfWA7CiAgICAgICAgICAgICAgaWYgKCFuZXdDbGFzc01hcC5oYXMobmV3Q2xhc3NOYW1lKSkgewogICAgICAgICAgICAgICAgZGVkdXBDbGFzc2VzLnNldChjbGFzc05hbWUsIG5ld0NsYXNzTmFtZSk7CiAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSBuZXdDbGFzc05hbWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG5ld0NsYXNzTWFwLnNldChjbGFzc05hbWUsIGNsYXNzRGljdCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IGRlZHVwUm9sZXMgPSBuZXcgTWFwKCk7CiAgICAgIGlmIChyb2xlTWFwPy5zaXplID4gMCkgewogICAgICAgIGZvciAoY29uc3QgW3JvbGVOYW1lLCBtYXBwZWROYW1lXSBvZiByb2xlTWFwKSB7CiAgICAgICAgICBjb25zdCBuZXdNYXBwZWROYW1lID0gbmV3Um9sZU1hcC5nZXQocm9sZU5hbWUpOwogICAgICAgICAgaWYgKCFuZXdNYXBwZWROYW1lKSB7CiAgICAgICAgICAgIG5ld1JvbGVNYXAuc2V0KHJvbGVOYW1lLCBtYXBwZWROYW1lKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobmV3TWFwcGVkTmFtZSA9PT0gbWFwcGVkTmFtZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGkgPSAxOzsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld1JvbGVOYW1lID0gYCR7cm9sZU5hbWV9XyR7aX1gOwogICAgICAgICAgICBpZiAoIW5ld1JvbGVNYXAuaGFzKG5ld1JvbGVOYW1lKSkgewogICAgICAgICAgICAgIGRlZHVwUm9sZXMuc2V0KHJvbGVOYW1lLCBuZXdSb2xlTmFtZSk7CiAgICAgICAgICAgICAgbmV3Um9sZU1hcC5zZXQobmV3Um9sZU5hbWUsIG1hcHBlZE5hbWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChuYW1lc3BhY2VzPy5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yIChjb25zdCBuYW1lc3BhY2VSZWYgb2YgbmFtZXNwYWNlcykgewogICAgICAgICAgY29uc3QgbmFtZXNwYWNlID0gYXdhaXQgeHJlZi5mZXRjaElmUmVmQXN5bmMobmFtZXNwYWNlUmVmKTsKICAgICAgICAgIGxldCBucyA9IG5hbWVzcGFjZS5nZXQoIk5TIik7CiAgICAgICAgICBpZiAoIW5zIHx8IG5ld05hbWVzcGFjZXMuaGFzKG5zKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIG5zID0gc3RyaW5nVG9QREZTdHJpbmcobnMsIGZhbHNlKTsKICAgICAgICAgIGNvbnN0IG5ld05hbWVzcGFjZSA9IGF3YWl0IHRoaXMuI2NvbGxlY3REZXBlbmRlbmNpZXMobmFtZXNwYWNlLCB0cnVlLCB4cmVmKTsKICAgICAgICAgIG5ld05hbWVzcGFjZXMuc2V0KG5zLCBuZXdOYW1lc3BhY2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3RydWN0VHJlZUFGKSB7CiAgICAgICAgZm9yIChjb25zdCBhZlJlZiBvZiBzdHJ1Y3RUcmVlQUYpIHsKICAgICAgICAgIG5ld1N0cnVjdFRyZWVBRi5wdXNoKGF3YWl0IHRoaXMuI2NvbGxlY3REZXBlbmRlbmNpZXMoYWZSZWYsIHRydWUsIHhyZWYpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHN0cnVjdFRyZWVQcm9udW5jaWF0aW9uTGV4aWNvbikgewogICAgICAgIGZvciAoY29uc3QgbGV4aWNvblJlZiBvZiBzdHJ1Y3RUcmVlUHJvbnVuY2lhdGlvbkxleGljb24pIHsKICAgICAgICAgIG5ld1N0cnVjdFRyZWVQcm9udW5jaWF0aW9uTGV4aWNvbi5wdXNoKGF3YWl0IHRoaXMuI2NvbGxlY3REZXBlbmRlbmNpZXMobGV4aWNvblJlZiwgdHJ1ZSwgeHJlZikpOwogICAgICAgIH0KICAgICAgfQogICAgICBsZXQga2lkcyA9IHN0cnVjdFRyZWVSb290LmRpY3QuZ2V0KCJLIik7CiAgICAgIGlmICgha2lkcykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGtpZHMgPSBBcnJheS5pc0FycmF5KGtpZHMpID8ga2lkcyA6IFtraWRzXTsKICAgICAgZm9yIChsZXQga2lkIG9mIGtpZHMpIHsKICAgICAgICBjb25zdCBraWRSZWYgPSBraWQgaW5zdGFuY2VvZiBSZWYgPyBraWQgOiBudWxsOwogICAgICAgIGlmIChraWRSZWYgJiYgcmVtb3ZlZFN0cnVjdEVsZW1lbnRzLmhhcyhraWRSZWYpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAga2lkID0gYXdhaXQgeHJlZi5mZXRjaElmUmVmQXN5bmMoa2lkKTsKICAgICAgICBjb25zdCBuZXdLaWRSZWYgPSBhd2FpdCB0aGlzLiNjbG9uZVN0cnVjdFRyZWVOb2RlKGtpZFJlZiwga2lkLCB4cmVmLCByZW1vdmVkU3RydWN0RWxlbWVudHMsIGRlZHVwSURzLCBkZWR1cENsYXNzZXMsIGRlZHVwUm9sZXMpOwogICAgICAgIGlmIChuZXdLaWRSZWYpIHsKICAgICAgICAgIHN0cnVjdFRyZWVLaWRzLnB1c2gobmV3S2lkUmVmKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBbaWQsIG5vZGVSZWZdIG9mIGlkVHJlZSB8fCBbXSkgewogICAgICAgIGNvbnN0IG5ld05vZGVSZWYgPSBvbGRSZWZNYXBwaW5nLmdldChub2RlUmVmKTsKICAgICAgICBjb25zdCBuZXdJZCA9IGRlZHVwSURzLmdldChpZCkgfHwgaWQ7CiAgICAgICAgaWYgKG5ld05vZGVSZWYpIHsKICAgICAgICAgIG5ld0lkVHJlZS5zZXQobmV3SWQsIG5ld05vZGVSZWYpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuZXdJZFRyZWUuZGVsZXRlKG5ld0lkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgW2tleSwgW29sZFJlZk1hcHBpbmcsIHBhcmVudF1dIG9mIG5ld1BhcmVudFRyZWUpIHsKICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICBuZXdQYXJlbnRUcmVlLmRlbGV0ZShrZXkpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShwYXJlbnQpKSB7CiAgICAgICAgY29uc3QgbmV3UGFyZW50ID0gb2xkUmVmTWFwcGluZy5nZXQocGFyZW50KTsKICAgICAgICBpZiAobmV3UGFyZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIG5ld1BhcmVudFRyZWUuZGVsZXRlKGtleSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5ld1BhcmVudFRyZWUuc2V0KGtleSwgbmV3UGFyZW50KTsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgbmV3UGFyZW50cyA9IHBhcmVudC5tYXAocmVmID0+IHJlZiBpbnN0YW5jZW9mIFJlZiAmJiBvbGRSZWZNYXBwaW5nLmdldChyZWYpIHx8IG51bGwpOwogICAgICBpZiAobmV3UGFyZW50cy5sZW5ndGggPT09IDAgfHwgbmV3UGFyZW50cy5ldmVyeShyZWYgPT4gcmVmID09PSBudWxsKSkgewogICAgICAgIG5ld1BhcmVudFRyZWUuZGVsZXRlKGtleSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbmV3UGFyZW50VHJlZS5zZXQoa2V5LCBuZXdQYXJlbnRzKTsKICAgIH0KICAgIHRoaXMuY3VycmVudERvY3VtZW50ID0gbnVsbDsKICB9CiAgI2NvbGxlY3RWYWxpZERlc3RpbmF0aW9ucyhhbGxEb2N1bWVudERhdGEpIHsKICAgIGZvciAoY29uc3QgZG9jdW1lbnREYXRhIG9mIGFsbERvY3VtZW50RGF0YSkgewogICAgICBpZiAoIWRvY3VtZW50RGF0YS5kZXN0aW5hdGlvbnMpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgZGVzdGluYXRpb25zLAogICAgICAgIHBhZ2VzTWFwCiAgICAgIH0gPSBkb2N1bWVudERhdGE7CiAgICAgIGNvbnN0IG5ld0Rlc3RpbmF0aW9ucyA9IGRvY3VtZW50RGF0YS5kZXN0aW5hdGlvbnMgPSBuZXcgTWFwKCk7CiAgICAgIGZvciAoY29uc3QgW2tleSwgZGVzdF0gb2YgT2JqZWN0LmVudHJpZXMoZGVzdGluYXRpb25zKSkgewogICAgICAgIGNvbnN0IHBhZ2VSZWYgPSBkZXN0WzBdOwogICAgICAgIGNvbnN0IHBhZ2VEYXRhID0gcGFnZXNNYXAuZ2V0KHBhZ2VSZWYpOwogICAgICAgIGlmICghcGFnZURhdGEpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICAocGFnZURhdGEucG9pbnRpbmdOYW1lZERlc3RpbmF0aW9ucyB8fD0gbmV3IFNldCgpKS5hZGQoa2V5KTsKICAgICAgICBuZXdEZXN0aW5hdGlvbnMuc2V0KGtleSwgZGVzdCk7CiAgICAgIH0KICAgIH0KICB9CiAgI2ZpbmREdXBsaWNhdGVOYW1lZERlc3RpbmF0aW9ucygpIHsKICAgIGNvbnN0IHsKICAgICAgbmFtZWREZXN0aW5hdGlvbnMKICAgIH0gPSB0aGlzOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5vbGRQYWdlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHBhZ2UgPSB0aGlzLm9sZFBhZ2VzW2ldOwogICAgICBjb25zdCB7CiAgICAgICAgZG9jdW1lbnREYXRhOiB7CiAgICAgICAgICBkZXN0aW5hdGlvbnMsCiAgICAgICAgICBkZWR1cE5hbWVkRGVzdGluYXRpb25zLAogICAgICAgICAgdXNlZE5hbWVkRGVzdGluYXRpb25zCiAgICAgICAgfQogICAgICB9ID0gcGFnZTsKICAgICAgbGV0IHsKICAgICAgICBwb2ludGluZ05hbWVkRGVzdGluYXRpb25zCiAgICAgIH0gPSBwYWdlOwogICAgICBpZiAoIXBvaW50aW5nTmFtZWREZXN0aW5hdGlvbnMpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwYWdlLnBvaW50aW5nTmFtZWREZXN0aW5hdGlvbnMgPSBwb2ludGluZ05hbWVkRGVzdGluYXRpb25zID0gcG9pbnRpbmdOYW1lZERlc3RpbmF0aW9ucy5pbnRlcnNlY3Rpb24odXNlZE5hbWVkRGVzdGluYXRpb25zKTsKICAgICAgZm9yIChjb25zdCBwb2ludGluZ0Rlc3Qgb2YgcG9pbnRpbmdOYW1lZERlc3RpbmF0aW9ucykgewogICAgICAgIGlmICghdXNlZE5hbWVkRGVzdGluYXRpb25zLmhhcyhwb2ludGluZ0Rlc3QpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZGVzdCA9IGRlc3RpbmF0aW9ucy5nZXQocG9pbnRpbmdEZXN0KS5zbGljZSgpOwogICAgICAgIGlmICghbmFtZWREZXN0aW5hdGlvbnMuaGFzKHBvaW50aW5nRGVzdCkpIHsKICAgICAgICAgIG5hbWVkRGVzdGluYXRpb25zLnNldChwb2ludGluZ0Rlc3QsIGRlc3QpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG5ld05hbWUgPSBgJHtwb2ludGluZ0Rlc3R9X3Ake2kgKyAxfWA7CiAgICAgICAgZGVkdXBOYW1lZERlc3RpbmF0aW9ucy5zZXQocG9pbnRpbmdEZXN0LCBuZXdOYW1lKTsKICAgICAgICBuYW1lZERlc3RpbmF0aW9ucy5zZXQobmV3TmFtZSwgZGVzdCk7CiAgICAgIH0KICAgIH0KICB9CiAgI2ZpeE5hbWVkRGVzdGluYXRpb25zKGFubm90YXRpb25zLCBkZWR1cE5hbWVkRGVzdGluYXRpb25zKSB7CiAgICBpZiAoZGVkdXBOYW1lZERlc3RpbmF0aW9ucy5zaXplID09PSAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGZpeERlc3RpbmF0aW9uID0gKGRpY3QsIGtleSwgZGVzdCkgPT4gewogICAgICBpZiAodHlwZW9mIGRlc3QgPT09ICJzdHJpbmciKSB7CiAgICAgICAgZGljdC5zZXQoa2V5LCBkZWR1cE5hbWVkRGVzdGluYXRpb25zLmdldChzdHJpbmdUb1BERlN0cmluZyhkZXN0LCB0cnVlKSkgfHwgZGVzdCk7CiAgICAgIH0KICAgIH07CiAgICBmb3IgKGNvbnN0IGFubm90UmVmIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGNvbnN0IGFubm90RGljdCA9IHRoaXMueHJlZlthbm5vdFJlZi5udW1dOwogICAgICBpZiAoIWlzTmFtZShhbm5vdERpY3QuZ2V0KCJTdWJ0eXBlIiksICJMaW5rIikpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBhY3Rpb24gPSBhbm5vdERpY3QuZ2V0KCJBIik7CiAgICAgIGlmIChhY3Rpb24gaW5zdGFuY2VvZiBEaWN0ICYmIGFjdGlvbi5oYXMoIkQiKSkgewogICAgICAgIGNvbnN0IGRlc3QgPSBhY3Rpb24uZ2V0KCJEIik7CiAgICAgICAgZml4RGVzdGluYXRpb24oYWN0aW9uLCAiRCIsIGRlc3QpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGRlc3QgPSBhbm5vdERpY3QuZ2V0KCJEZXN0Iik7CiAgICAgIGZpeERlc3RpbmF0aW9uKGFubm90RGljdCwgIkRlc3QiLCBkZXN0KTsKICAgIH0KICB9CiAgYXN5bmMgI2NvbGxlY3RQYWdlTGFiZWxzKCkgewogICAgaWYgKCF0aGlzLmhhc1NpbmdsZUZpbGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICBkb2N1bWVudERhdGE6IHsKICAgICAgICBkb2N1bWVudCwKICAgICAgICBwYWdlTGFiZWxzCiAgICAgIH0KICAgIH0gPSB0aGlzLm9sZFBhZ2VzWzBdOwogICAgaWYgKCFwYWdlTGFiZWxzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG51bVBhZ2VzID0gZG9jdW1lbnQubnVtUGFnZXM7CiAgICBjb25zdCBvbGRQYWdlTGFiZWxzID0gW107CiAgICBjb25zdCBvbGRQYWdlSW5kaWNlcyA9IG5ldyBTZXQodGhpcy5vbGRQYWdlcy5tYXAoKHsKICAgICAgcGFnZTogewogICAgICAgIHBhZ2VJbmRleAogICAgICB9CiAgICB9KSA9PiBwYWdlSW5kZXgpKTsKICAgIGxldCBjdXJyZW50TGFiZWwgPSBudWxsOwogICAgbGV0IHN0Rmlyc3RJbmRleCA9IC0xOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1QYWdlczsgaSsrKSB7CiAgICAgIGNvbnN0IG5ld0xhYmVsID0gcGFnZUxhYmVscy5nZXQoaSk7CiAgICAgIGlmIChuZXdMYWJlbCkgewogICAgICAgIGN1cnJlbnRMYWJlbCA9IG5ld0xhYmVsOwogICAgICAgIHN0Rmlyc3RJbmRleCA9IGN1cnJlbnRMYWJlbC5oYXMoIlN0IikgPyBpIDogLTE7CiAgICAgIH0KICAgICAgaWYgKCFvbGRQYWdlSW5kaWNlcy5oYXMoaSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoc3RGaXJzdEluZGV4ICE9PSAtMSkgewogICAgICAgIGNvbnN0IHN0ID0gY3VycmVudExhYmVsLmdldCgiU3QiKTsKICAgICAgICBjdXJyZW50TGFiZWwgPSB0aGlzLmNsb25lRGljdChjdXJyZW50TGFiZWwpOwogICAgICAgIGN1cnJlbnRMYWJlbC5zZXQoIlN0Iiwgc3QgKyAoaSAtIHN0Rmlyc3RJbmRleCkpOwogICAgICAgIHN0Rmlyc3RJbmRleCA9IC0xOwogICAgICB9CiAgICAgIG9sZFBhZ2VMYWJlbHMucHVzaChjdXJyZW50TGFiZWwpOwogICAgfQogICAgY3VycmVudExhYmVsID0gb2xkUGFnZUxhYmVsc1swXTsKICAgIGxldCBjdXJyZW50SW5kZXggPSAwOwogICAgY29uc3QgbmV3UGFnZUxhYmVscyA9IHRoaXMucGFnZUxhYmVscyA9IFtbMCwgY3VycmVudExhYmVsXV07CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBvbGRQYWdlTGFiZWxzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgbGFiZWwgPSBvbGRQYWdlTGFiZWxzW2ldOwogICAgICBpZiAobGFiZWwgPT09IGN1cnJlbnRMYWJlbCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGN1cnJlbnRJbmRleCA9IGk7CiAgICAgIGN1cnJlbnRMYWJlbCA9IGxhYmVsOwogICAgICBuZXdQYWdlTGFiZWxzLnB1c2goW2N1cnJlbnRJbmRleCwgY3VycmVudExhYmVsXSk7CiAgICB9CiAgfQogIGFzeW5jICNtYWtlUGFnZUNvcHkocGFnZUluZGV4KSB7CiAgICBjb25zdCB7CiAgICAgIHBhZ2UsCiAgICAgIGRvY3VtZW50RGF0YSwKICAgICAgYW5ub3RhdGlvbnMsCiAgICAgIHBvaW50aW5nTmFtZWREZXN0aW5hdGlvbnMKICAgIH0gPSB0aGlzLm9sZFBhZ2VzW3BhZ2VJbmRleF07CiAgICB0aGlzLmN1cnJlbnREb2N1bWVudCA9IGRvY3VtZW50RGF0YTsKICAgIGNvbnN0IHsKICAgICAgZGVkdXBOYW1lZERlc3RpbmF0aW9ucywKICAgICAgb2xkUmVmTWFwcGluZwogICAgfSA9IGRvY3VtZW50RGF0YTsKICAgIGNvbnN0IHsKICAgICAgeHJlZiwKICAgICAgcm90YXRlLAogICAgICBtZWRpYUJveCwKICAgICAgcmVzb3VyY2VzLAogICAgICByZWY6IG9sZFBhZ2VSZWYKICAgIH0gPSBwYWdlOwogICAgY29uc3QgcGFnZVJlZiA9IHRoaXMubmV3UmVmOwogICAgY29uc3QgcGFnZURpY3QgPSB0aGlzLnhyZWZbcGFnZVJlZi5udW1dID0gdGhpcy5jbG9uZURpY3QocGFnZS5wYWdlRGljdCk7CiAgICBvbGRSZWZNYXBwaW5nLnB1dChvbGRQYWdlUmVmLCBwYWdlUmVmKTsKICAgIGlmIChwb2ludGluZ05hbWVkRGVzdGluYXRpb25zKSB7CiAgICAgIGZvciAoY29uc3QgcG9pbnRpbmdEZXN0IG9mIHBvaW50aW5nTmFtZWREZXN0aW5hdGlvbnMpIHsKICAgICAgICBjb25zdCBuYW1lID0gZGVkdXBOYW1lZERlc3RpbmF0aW9ucy5nZXQocG9pbnRpbmdEZXN0KSB8fCBwb2ludGluZ0Rlc3Q7CiAgICAgICAgY29uc3QgZGVzdCA9IHRoaXMubmFtZWREZXN0aW5hdGlvbnMuZ2V0KG5hbWUpOwogICAgICAgIGRlc3RbMF0gPSBwYWdlUmVmOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IGtleSBvZiBbIlJvdGF0ZSIsICJNZWRpYUJveCIsICJDcm9wQm94IiwgIkJsZWVkQm94IiwgIlRyaW1Cb3giLCAiQXJ0Qm94IiwgIlJlc291cmNlcyIsICJBbm5vdHMiLCAiUGFyZW50IiwgIlVzZXJVbml0Il0pIHsKICAgICAgcGFnZURpY3QuZGVsZXRlKGtleSk7CiAgICB9CiAgICBjb25zdCBsYXN0UmVmID0gdGhpcy5uZXdSZWZDb3VudDsKICAgIGF3YWl0IHRoaXMuI2NvbGxlY3REZXBlbmRlbmNpZXMocGFnZURpY3QsIGZhbHNlLCB4cmVmKTsKICAgIHBhZ2VEaWN0LnNldCgiUm90YXRlIiwgcm90YXRlKTsKICAgIHBhZ2VEaWN0LnNldCgiTWVkaWFCb3giLCBtZWRpYUJveCk7CiAgICBmb3IgKGNvbnN0IGJveE5hbWUgb2YgWyJDcm9wQm94IiwgIkJsZWVkQm94IiwgIlRyaW1Cb3giLCAiQXJ0Qm94Il0pIHsKICAgICAgY29uc3QgYm94ID0gcGFnZS5nZXRCb3VuZGluZ0JveChib3hOYW1lKTsKICAgICAgaWYgKGJveD8uc29tZSgodmFsdWUsIGluZGV4KSA9PiB2YWx1ZSAhPT0gbWVkaWFCb3hbaW5kZXhdKSkgewogICAgICAgIHBhZ2VEaWN0LnNldChib3hOYW1lLCBib3gpOwogICAgICB9CiAgICB9CiAgICBjb25zdCB1c2VyVW5pdCA9IHBhZ2UudXNlclVuaXQ7CiAgICBpZiAodXNlclVuaXQgIT09IDEpIHsKICAgICAgcGFnZURpY3Quc2V0KCJVc2VyVW5pdCIsIHVzZXJVbml0KTsKICAgIH0KICAgIHBhZ2VEaWN0LnNldElmRGljdCgiUmVzb3VyY2VzIiwgYXdhaXQgdGhpcy4jY29sbGVjdERlcGVuZGVuY2llcyhyZXNvdXJjZXMsIHRydWUsIHhyZWYpKTsKICAgIGlmIChhbm5vdGF0aW9ucykgewogICAgICBjb25zdCBuZXdBbm5vdGF0aW9ucyA9IGF3YWl0IHRoaXMuI2NvbGxlY3REZXBlbmRlbmNpZXMoYW5ub3RhdGlvbnMsIHRydWUsIHhyZWYpOwogICAgICB0aGlzLiNmaXhOYW1lZERlc3RpbmF0aW9ucyhuZXdBbm5vdGF0aW9ucywgZGVkdXBOYW1lZERlc3RpbmF0aW9ucyk7CiAgICAgIHBhZ2VEaWN0LnNldElmQXJyYXkoIkFubm90cyIsIG5ld0Fubm90YXRpb25zKTsKICAgIH0KICAgIGlmICh0aGlzLnVzZU9iamVjdFN0cmVhbXMpIHsKICAgICAgY29uc3QgbmV3TGFzdFJlZiA9IHRoaXMubmV3UmVmQ291bnQ7CiAgICAgIGNvbnN0IHBhZ2VPYmplY3RSZWZzID0gW107CiAgICAgIGZvciAobGV0IGkgPSBsYXN0UmVmOyBpIDwgbmV3TGFzdFJlZjsgaSsrKSB7CiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy54cmVmW2ldOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgcGFnZU9iamVjdFJlZnMucHVzaChSZWYuZ2V0KGksIDApKTsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VPYmplY3RSZWZzLmxlbmd0aDsgaSArPSAweGZmZmYpIHsKICAgICAgICBjb25zdCBvYmpTdHJlYW1SZWYgPSB0aGlzLm5ld1JlZjsKICAgICAgICB0aGlzLm9ialN0cmVhbVJlZnMuYWRkKG9ialN0cmVhbVJlZi5udW0pOwogICAgICAgIHRoaXMueHJlZltvYmpTdHJlYW1SZWYubnVtXSA9IHBhZ2VPYmplY3RSZWZzLnNsaWNlKGksIGkgKyAweGZmZmYpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmN1cnJlbnREb2N1bWVudCA9IG51bGw7CiAgICByZXR1cm4gcGFnZVJlZjsKICB9CiAgI21ha2VQYWdlVHJlZSgpIHsKICAgIGNvbnN0IHsKICAgICAgbmV3UGFnZXM6IHBhZ2VzLAogICAgICByb290RGljdCwKICAgICAgcGFnZXNSZWYsCiAgICAgIHBhZ2VzRGljdAogICAgfSA9IHRoaXM7CiAgICByb290RGljdC5zZXQoIlBhZ2VzIiwgcGFnZXNSZWYpOwogICAgcGFnZXNEaWN0LnNldElmTmFtZSgiVHlwZSIsICJQYWdlcyIpOwogICAgcGFnZXNEaWN0LnNldCgiQ291bnQiLCBwYWdlcy5sZW5ndGgpOwogICAgY29uc3QgbWF4TGVhdmVzID0gTUFYX0xFQVZFU19QRVJfUEFHRVNfTk9ERSA8PSAxID8gcGFnZXMubGVuZ3RoIDogTUFYX0xFQVZFU19QRVJfUEFHRVNfTk9ERTsKICAgIGNvbnN0IHN0YWNrID0gW3sKICAgICAgZGljdDogcGFnZXNEaWN0LAogICAgICBraWRzOiBwYWdlcywKICAgICAgcGFyZW50UmVmOiBwYWdlc1JlZgogICAgfV07CiAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICBjb25zdCB7CiAgICAgICAgZGljdCwKICAgICAgICBraWRzLAogICAgICAgIHBhcmVudFJlZgogICAgICB9ID0gc3RhY2sucG9wKCk7CiAgICAgIGlmIChraWRzLmxlbmd0aCA8PSBtYXhMZWF2ZXMpIHsKICAgICAgICBkaWN0LnNldCgiS2lkcyIsIGtpZHMpOwogICAgICAgIGZvciAoY29uc3QgcmVmIG9mIGtpZHMpIHsKICAgICAgICAgIHRoaXMueHJlZltyZWYubnVtXS5zZXQoIlBhcmVudCIsIHBhcmVudFJlZik7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGNodW5rU2l6ZSA9IE1hdGgubWF4KG1heExlYXZlcywgTWF0aC5jZWlsKGtpZHMubGVuZ3RoIC8gbWF4TGVhdmVzKSk7CiAgICAgIGNvbnN0IGtpZHNDaHVua3MgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBraWRzLmxlbmd0aDsgaSArPSBjaHVua1NpemUpIHsKICAgICAgICBraWRzQ2h1bmtzLnB1c2goa2lkcy5zbGljZShpLCBpICsgY2h1bmtTaXplKSk7CiAgICAgIH0KICAgICAgY29uc3Qga2lkc1JlZnMgPSBbXTsKICAgICAgZGljdC5zZXQoIktpZHMiLCBraWRzUmVmcyk7CiAgICAgIGZvciAoY29uc3QgY2h1bmsgb2Yga2lkc0NodW5rcykgewogICAgICAgIGNvbnN0IFtraWRSZWYsIGtpZERpY3RdID0gdGhpcy5uZXdEaWN0OwogICAgICAgIGtpZHNSZWZzLnB1c2goa2lkUmVmKTsKICAgICAgICBraWREaWN0LnNldElmTmFtZSgiVHlwZSIsICJQYWdlcyIpOwogICAgICAgIGtpZERpY3Quc2V0KCJQYXJlbnQiLCBwYXJlbnRSZWYpOwogICAgICAgIGtpZERpY3Quc2V0KCJDb3VudCIsIGNodW5rLmxlbmd0aCk7CiAgICAgICAgc3RhY2sucHVzaCh7CiAgICAgICAgICBkaWN0OiBraWREaWN0LAogICAgICAgICAga2lkczogY2h1bmssCiAgICAgICAgICBwYXJlbnRSZWY6IGtpZFJlZgogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQogICNtYWtlTmFtZU51bVRyZWUobWFwLCBhcmVOYW1lcykgewogICAgY29uc3QgYWxsRW50cmllcyA9IG1hcC5zb3J0KGFyZU5hbWVzID8gKFtrZXlBXSwgW2tleUJdKSA9PiBrZXlBLmxvY2FsZUNvbXBhcmUoa2V5QikgOiAoW2tleUFdLCBba2V5Ql0pID0+IGtleUEgLSBrZXlCKTsKICAgIGNvbnN0IG1heExlYXZlcyA9IE1BWF9JTl9OQU1FX1RSRUVfTk9ERSA8PSAxID8gYWxsRW50cmllcy5sZW5ndGggOiBNQVhfSU5fTkFNRV9UUkVFX05PREU7CiAgICBjb25zdCBbdHJlZVJlZiwgdHJlZURpY3RdID0gdGhpcy5uZXdEaWN0OwogICAgY29uc3Qgc3RhY2sgPSBbewogICAgICBkaWN0OiB0cmVlRGljdCwKICAgICAgZW50cmllczogYWxsRW50cmllcwogICAgfV07CiAgICBjb25zdCB2YWx1ZVR5cGUgPSBhcmVOYW1lcyA/ICJOYW1lcyIgOiAiTnVtcyI7CiAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICBjb25zdCB7CiAgICAgICAgZGljdCwKICAgICAgICBlbnRyaWVzCiAgICAgIH0gPSBzdGFjay5wb3AoKTsKICAgICAgaWYgKGVudHJpZXMubGVuZ3RoIDw9IG1heExlYXZlcykgewogICAgICAgIGRpY3Quc2V0KCJMaW1pdHMiLCBbZW50cmllc1swXVswXSwgZW50cmllcy5hdCgtMSlbMF1dKTsKICAgICAgICBkaWN0LnNldCh2YWx1ZVR5cGUsIGVudHJpZXMuZmxhdCgpKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBlbnRyaWVzQ2h1bmtzID0gW107CiAgICAgIGNvbnN0IGNodW5rU2l6ZSA9IE1hdGgubWF4KG1heExlYXZlcywgTWF0aC5jZWlsKGVudHJpZXMubGVuZ3RoIC8gbWF4TGVhdmVzKSk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZW50cmllcy5sZW5ndGg7IGkgKz0gY2h1bmtTaXplKSB7CiAgICAgICAgZW50cmllc0NodW5rcy5wdXNoKGVudHJpZXMuc2xpY2UoaSwgaSArIGNodW5rU2l6ZSkpOwogICAgICB9CiAgICAgIGNvbnN0IGVudHJpZXNSZWZzID0gW107CiAgICAgIGRpY3Quc2V0KCJLaWRzIiwgZW50cmllc1JlZnMpOwogICAgICBmb3IgKGNvbnN0IGNodW5rIG9mIGVudHJpZXNDaHVua3MpIHsKICAgICAgICBjb25zdCBbZW50cmllc1JlZiwgZW50cmllc0RpY3RdID0gdGhpcy5uZXdEaWN0OwogICAgICAgIGVudHJpZXNSZWZzLnB1c2goZW50cmllc1JlZik7CiAgICAgICAgZW50cmllc0RpY3Quc2V0KCJMaW1pdHMiLCBbY2h1bmtbMF1bMF0sIGNodW5rLmF0KC0xKVswXV0pOwogICAgICAgIHN0YWNrLnB1c2goewogICAgICAgICAgZGljdDogZW50cmllc0RpY3QsCiAgICAgICAgICBlbnRyaWVzOiBjaHVuawogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJlZVJlZjsKICB9CiAgI21ha2VQYWdlTGFiZWxzVHJlZSgpIHsKICAgIGNvbnN0IHsKICAgICAgcGFnZUxhYmVscwogICAgfSA9IHRoaXM7CiAgICBpZiAoIXBhZ2VMYWJlbHMgfHwgcGFnZUxhYmVscy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICByb290RGljdAogICAgfSA9IHRoaXM7CiAgICBjb25zdCBwYWdlTGFiZWxzUmVmID0gdGhpcy4jbWFrZU5hbWVOdW1UcmVlKHRoaXMucGFnZUxhYmVscywgZmFsc2UpOwogICAgcm9vdERpY3Quc2V0KCJQYWdlTGFiZWxzIiwgcGFnZUxhYmVsc1JlZik7CiAgfQogICNtYWtlRGVzdGluYXRpb25zVHJlZSgpIHsKICAgIGNvbnN0IHsKICAgICAgbmFtZWREZXN0aW5hdGlvbnMKICAgIH0gPSB0aGlzOwogICAgaWYgKG5hbWVkRGVzdGluYXRpb25zLnNpemUgPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLm5hbWVzRGljdCkgewogICAgICBbdGhpcy5uYW1lc1JlZiwgdGhpcy5uYW1lc0RpY3RdID0gdGhpcy5uZXdEaWN0OwogICAgICB0aGlzLnJvb3REaWN0LnNldCgiTmFtZXMiLCB0aGlzLm5hbWVzUmVmKTsKICAgIH0KICAgIHRoaXMubmFtZXNEaWN0LnNldCgiRGVzdHMiLCB0aGlzLiNtYWtlTmFtZU51bVRyZWUoQXJyYXkuZnJvbShuYW1lZERlc3RpbmF0aW9ucy5lbnRyaWVzKCkpLCB0cnVlKSk7CiAgfQogICNtYWtlU3RydWN0VHJlZSgpIHsKICAgIGNvbnN0IHsKICAgICAgc3RydWN0VHJlZUtpZHMKICAgIH0gPSB0aGlzOwogICAgaWYgKCFzdHJ1Y3RUcmVlS2lkcyB8fCBzdHJ1Y3RUcmVlS2lkcy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICByb290RGljdAogICAgfSA9IHRoaXM7CiAgICBjb25zdCBzdHJ1Y3RUcmVlUmVmID0gdGhpcy5uZXdSZWY7CiAgICBjb25zdCBzdHJ1Y3RUcmVlID0gdGhpcy54cmVmW3N0cnVjdFRyZWVSZWYubnVtXSA9IG5ldyBEaWN0KCk7CiAgICBzdHJ1Y3RUcmVlLnNldElmTmFtZSgiVHlwZSIsICJTdHJ1Y3RUcmVlUm9vdCIpOwogICAgc3RydWN0VHJlZS5zZXRJZkFycmF5KCJLIiwgc3RydWN0VHJlZUtpZHMpOwogICAgZm9yIChjb25zdCBraWRSZWYgb2Ygc3RydWN0VHJlZUtpZHMpIHsKICAgICAgY29uc3Qga2lkID0gdGhpcy54cmVmW2tpZFJlZi5udW1dOwogICAgICBjb25zdCB0eXBlID0ga2lkLmdldCgiVHlwZSIpOwogICAgICBpZiAoIXR5cGUgfHwgaXNOYW1lKHR5cGUsICJTdHJ1Y3RFbGVtIikpIHsKICAgICAgICBraWQuc2V0KCJQIiwgc3RydWN0VHJlZVJlZik7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLnBhcmVudFRyZWUuc2l6ZSA+IDApIHsKICAgICAgY29uc3QgcGFyZW50VHJlZVJlZiA9IHRoaXMuI21ha2VOYW1lTnVtVHJlZShBcnJheS5mcm9tKHRoaXMucGFyZW50VHJlZS5lbnRyaWVzKCkpLCBmYWxzZSk7CiAgICAgIGNvbnN0IHBhcmVudFRyZWUgPSB0aGlzLnhyZWZbcGFyZW50VHJlZVJlZi5udW1dOwogICAgICBwYXJlbnRUcmVlLnNldElmTmFtZSgiVHlwZSIsICJQYXJlbnRUcmVlIik7CiAgICAgIHN0cnVjdFRyZWUuc2V0KCJQYXJlbnRUcmVlIiwgcGFyZW50VHJlZVJlZik7CiAgICAgIHN0cnVjdFRyZWUuc2V0KCJQYXJlbnRUcmVlTmV4dEtleSIsIHRoaXMucGFyZW50VHJlZS5zaXplKTsKICAgIH0KICAgIGlmICh0aGlzLmlkVHJlZS5zaXplID4gMCkgewogICAgICBjb25zdCBpZFRyZWVSZWYgPSB0aGlzLiNtYWtlTmFtZU51bVRyZWUoQXJyYXkuZnJvbSh0aGlzLmlkVHJlZS5lbnRyaWVzKCkpLCB0cnVlKTsKICAgICAgY29uc3QgaWRUcmVlID0gdGhpcy54cmVmW2lkVHJlZVJlZi5udW1dOwogICAgICBpZFRyZWUuc2V0SWZOYW1lKCJUeXBlIiwgIklEVHJlZSIpOwogICAgICBzdHJ1Y3RUcmVlLnNldCgiSURUcmVlIiwgaWRUcmVlUmVmKTsKICAgIH0KICAgIGlmICh0aGlzLmNsYXNzTWFwLnNpemUgPiAwKSB7CiAgICAgIGNvbnN0IGNsYXNzTWFwUmVmID0gdGhpcy5uZXdSZWY7CiAgICAgIHRoaXMueHJlZltjbGFzc01hcFJlZi5udW1dID0gdGhpcy5jbGFzc01hcDsKICAgICAgc3RydWN0VHJlZS5zZXQoIkNsYXNzTWFwIiwgY2xhc3NNYXBSZWYpOwogICAgfQogICAgaWYgKHRoaXMucm9sZU1hcC5zaXplID4gMCkgewogICAgICBjb25zdCByb2xlTWFwUmVmID0gdGhpcy5uZXdSZWY7CiAgICAgIHRoaXMueHJlZltyb2xlTWFwUmVmLm51bV0gPSB0aGlzLnJvbGVNYXA7CiAgICAgIHN0cnVjdFRyZWUuc2V0KCJSb2xlTWFwIiwgcm9sZU1hcFJlZik7CiAgICB9CiAgICBpZiAodGhpcy5uYW1lc3BhY2VzLnNpemUgPiAwKSB7CiAgICAgIGNvbnN0IG5hbWVzcGFjZXNSZWYgPSB0aGlzLm5ld1JlZjsKICAgICAgdGhpcy54cmVmW25hbWVzcGFjZXNSZWYubnVtXSA9IEFycmF5LmZyb20odGhpcy5uYW1lc3BhY2VzLnZhbHVlcygpKTsKICAgICAgc3RydWN0VHJlZS5zZXQoIk5hbWVzcGFjZXMiLCBuYW1lc3BhY2VzUmVmKTsKICAgIH0KICAgIGlmICh0aGlzLnN0cnVjdFRyZWVBRi5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IHN0cnVjdFRyZWVBRlJlZiA9IHRoaXMubmV3UmVmOwogICAgICB0aGlzLnhyZWZbc3RydWN0VHJlZUFGUmVmLm51bV0gPSB0aGlzLnN0cnVjdFRyZWVBRjsKICAgICAgc3RydWN0VHJlZS5zZXQoIkFGIiwgc3RydWN0VHJlZUFGUmVmKTsKICAgIH0KICAgIGlmICh0aGlzLnN0cnVjdFRyZWVQcm9udW5jaWF0aW9uTGV4aWNvbi5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IHN0cnVjdFRyZWVQcm9udW5jaWF0aW9uTGV4aWNvblJlZiA9IHRoaXMubmV3UmVmOwogICAgICB0aGlzLnhyZWZbc3RydWN0VHJlZVByb251bmNpYXRpb25MZXhpY29uUmVmLm51bV0gPSB0aGlzLnN0cnVjdFRyZWVQcm9udW5jaWF0aW9uTGV4aWNvbjsKICAgICAgc3RydWN0VHJlZS5zZXQoIlByb251bmNpYXRpb25MZXhpY29uIiwgc3RydWN0VHJlZVByb251bmNpYXRpb25MZXhpY29uUmVmKTsKICAgIH0KICAgIHJvb3REaWN0LnNldCgiU3RydWN0VHJlZVJvb3QiLCBzdHJ1Y3RUcmVlUmVmKTsKICB9CiAgYXN5bmMgI21ha2VSb290KCkgewogICAgY29uc3QgewogICAgICByb290RGljdAogICAgfSA9IHRoaXM7CiAgICByb290RGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiQ2F0YWxvZyIpOwogICAgcm9vdERpY3Quc2V0SWZOYW1lKCJWZXJzaW9uIiwgdGhpcy52ZXJzaW9uKTsKICAgIHRoaXMuI21ha2VQYWdlVHJlZSgpOwogICAgdGhpcy4jbWFrZVBhZ2VMYWJlbHNUcmVlKCk7CiAgICB0aGlzLiNtYWtlRGVzdGluYXRpb25zVHJlZSgpOwogICAgdGhpcy4jbWFrZVN0cnVjdFRyZWUoKTsKICB9CiAgI21ha2VJbmZvKCkgewogICAgY29uc3QgaW5mb01hcCA9IG5ldyBNYXAoKTsKICAgIGlmICh0aGlzLmhhc1NpbmdsZUZpbGUpIHsKICAgICAgY29uc3QgewogICAgICAgIHhyZWY6IHsKICAgICAgICAgIHRyYWlsZXIKICAgICAgICB9CiAgICAgIH0gPSB0aGlzLm9sZFBhZ2VzWzBdLmRvY3VtZW50RGF0YS5kb2N1bWVudDsKICAgICAgY29uc3Qgb2xkSW5mb0RpY3QgPSB0cmFpbGVyLmdldCgiSW5mbyIpOwogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBvbGRJbmZvRGljdCB8fCBbXSkgewogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBpbmZvTWFwLnNldChrZXksIHN0cmluZ1RvUERGU3RyaW5nKHZhbHVlKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpbmZvTWFwLmRlbGV0ZSgiTW9kRGF0ZSIpOwogICAgaW5mb01hcC5zZXQoIkNyZWF0aW9uRGF0ZSIsIGdldE1vZGlmaWNhdGlvbkRhdGUoKSk7CiAgICBpbmZvTWFwLnNldCgiQ3JlYXRvciIsICJQREYuanMiKTsKICAgIGluZm9NYXAuc2V0KCJQcm9kdWNlciIsICJGaXJlZm94Iik7CiAgICBpZiAodGhpcy5hdXRob3IpIHsKICAgICAgaW5mb01hcC5zZXQoIkF1dGhvciIsIHRoaXMuYXV0aG9yKTsKICAgIH0KICAgIGlmICh0aGlzLnRpdGxlKSB7CiAgICAgIGluZm9NYXAuc2V0KCJUaXRsZSIsIHRoaXMudGl0bGUpOwogICAgfQogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgaW5mb01hcCkgewogICAgICB0aGlzLmluZm9EaWN0LnNldChrZXksIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodmFsdWUpKTsKICAgIH0KICAgIHJldHVybiBpbmZvTWFwOwogIH0KICBhc3luYyAjbWFrZUVuY3J5cHQoKSB7CiAgICBpZiAoIXRoaXMuaGFzU2luZ2xlRmlsZSkgewogICAgICByZXR1cm4gW251bGwsIG51bGwsIG51bGxdOwogICAgfQogICAgY29uc3QgewogICAgICBkb2N1bWVudERhdGEKICAgIH0gPSB0aGlzLm9sZFBhZ2VzWzBdOwogICAgY29uc3QgewogICAgICBkb2N1bWVudDogewogICAgICAgIHhyZWY6IHsKICAgICAgICAgIHRyYWlsZXIsCiAgICAgICAgICBlbmNyeXB0CiAgICAgICAgfQogICAgICB9CiAgICB9ID0gZG9jdW1lbnREYXRhOwogICAgaWYgKCF0cmFpbGVyLmhhcygiRW5jcnlwdCIpKSB7CiAgICAgIHJldHVybiBbbnVsbCwgbnVsbCwgbnVsbF07CiAgICB9CiAgICBjb25zdCBlbmNyeXB0RGljdCA9IHRyYWlsZXIuZ2V0KCJFbmNyeXB0Iik7CiAgICBpZiAoIShlbmNyeXB0RGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBbbnVsbCwgbnVsbCwgbnVsbF07CiAgICB9CiAgICB0aGlzLmN1cnJlbnREb2N1bWVudCA9IGRvY3VtZW50RGF0YTsKICAgIGNvbnN0IHJlc3VsdCA9IFthd2FpdCB0aGlzLiNjbG9uZU9iamVjdChlbmNyeXB0RGljdCwgdHJhaWxlci54cmVmKSwgZW5jcnlwdCwgdHJhaWxlci5nZXQoIklEIildOwogICAgdGhpcy5jdXJyZW50RG9jdW1lbnQgPSBudWxsOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgYXN5bmMgI2NyZWF0ZUNoYW5nZXMoKSB7CiAgICBjb25zdCBjaGFuZ2VzID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICBjaGFuZ2VzLnB1dChSZWYuZ2V0KDAsIDB4ZmZmZiksIHsKICAgICAgZGF0YTogbnVsbAogICAgfSk7CiAgICBmb3IgKGxldCBpID0gMSwgaWkgPSB0aGlzLnhyZWYubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBpZiAodGhpcy5vYmpTdHJlYW1SZWZzPy5oYXMoaSkpIHsKICAgICAgICBhd2FpdCB0aGlzLiNjcmVhdGVPYmplY3RTdHJlYW0oUmVmLmdldChpLCAwKSwgdGhpcy54cmVmW2ldLCBjaGFuZ2VzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjaGFuZ2VzLnB1dChSZWYuZ2V0KGksIDApLCB7CiAgICAgICAgICBkYXRhOiB0aGlzLnhyZWZbaV0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFtjaGFuZ2VzLCB0aGlzLm5ld1JlZl07CiAgfQogIGFzeW5jICNjcmVhdGVPYmplY3RTdHJlYW0ob2JqU3RyZWFtUmVmLCBvYmpSZWZzLCBjaGFuZ2VzKSB7CiAgICBjb25zdCBzdHJlYW1CdWZmZXIgPSBbIiJdOwogICAgY29uc3Qgb2JqT2Zmc2V0cyA9IFtdOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IG9ialJlZnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBvYmpSZWYgPSBvYmpSZWZzW2ldOwogICAgICBjaGFuZ2VzLnB1dChvYmpSZWYsIHsKICAgICAgICBkYXRhOiBudWxsLAogICAgICAgIG9ialN0cmVhbVJlZiwKICAgICAgICBpbmRleDogaQogICAgICB9KTsKICAgICAgb2JqT2Zmc2V0cy5wdXNoKGAke29ialJlZi5udW19ICR7b2Zmc2V0fWApOwogICAgICBjb25zdCBkYXRhID0gdGhpcy54cmVmW29ialJlZi5udW1dOwogICAgICBhd2FpdCB3cml0ZVZhbHVlKGRhdGEsIGJ1ZmZlciwgbnVsbCk7CiAgICAgIGNvbnN0IG9iaiA9IGJ1ZmZlci5qb2luKCIiKTsKICAgICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgICAgIHN0cmVhbUJ1ZmZlci5wdXNoKG9iaik7CiAgICAgIG9mZnNldCArPSBvYmoubGVuZ3RoICsgMTsKICAgIH0KICAgIHN0cmVhbUJ1ZmZlclswXSA9IG9iak9mZnNldHMuam9pbigiXG4iKTsKICAgIGNvbnN0IG9ialN0cmVhbSA9IG5ldyBTdHJpbmdTdHJlYW0oc3RyZWFtQnVmZmVyLmpvaW4oIlxuIikpOwogICAgY29uc3Qgb2JqU3RyZWFtRGljdCA9IG9ialN0cmVhbS5kaWN0ID0gbmV3IERpY3QoKTsKICAgIG9ialN0cmVhbURpY3Quc2V0SWZOYW1lKCJUeXBlIiwgIk9ialN0bSIpOwogICAgb2JqU3RyZWFtRGljdC5zZXQoIk4iLCBvYmpSZWZzLmxlbmd0aCk7CiAgICBvYmpTdHJlYW1EaWN0LnNldCgiRmlyc3QiLCBzdHJlYW1CdWZmZXJbMF0ubGVuZ3RoICsgMSk7CiAgICBjaGFuZ2VzLnB1dChvYmpTdHJlYW1SZWYsIHsKICAgICAgZGF0YTogb2JqU3RyZWFtCiAgICB9KTsKICB9CiAgYXN5bmMgd3JpdGVQREYoKSB7CiAgICBhd2FpdCB0aGlzLiNtYWtlUm9vdCgpOwogICAgY29uc3QgaW5mb01hcCA9IHRoaXMuI21ha2VJbmZvKCk7CiAgICBjb25zdCBbZW5jcnlwdFJlZiwgZW5jcnlwdCwgZmlsZUlkc10gPSBhd2FpdCB0aGlzLiNtYWtlRW5jcnlwdCgpOwogICAgY29uc3QgW2NoYW5nZXMsIHhyZWZUYWJsZVJlZl0gPSBhd2FpdCB0aGlzLiNjcmVhdGVDaGFuZ2VzKCk7CiAgICBjb25zdCBoZWFkZXIgPSBbLi4uYCVQREYtJHt0aGlzLnZlcnNpb259XG4lYC5zcGxpdCgiIikubWFwKGMgPT4gYy5jaGFyQ29kZUF0KDApKSwgMHhmYSwgMHhkZSwgMHhmYSwgMHhjZV07CiAgICByZXR1cm4gaW5jcmVtZW50YWxVcGRhdGUoewogICAgICBvcmlnaW5hbERhdGE6IG5ldyBVaW50OEFycmF5KGhlYWRlciksCiAgICAgIGNoYW5nZXMsCiAgICAgIHhyZWZJbmZvOiB7CiAgICAgICAgc3RhcnRYUmVmOiBudWxsLAogICAgICAgIHJvb3RSZWY6IHRoaXMucm9vdFJlZiwKICAgICAgICBpbmZvUmVmOiB0aGlzLmluZm9SZWYsCiAgICAgICAgZW5jcnlwdFJlZiwKICAgICAgICBuZXdSZWY6IHhyZWZUYWJsZVJlZiwKICAgICAgICBmaWxlSWRzOiBmaWxlSWRzIHx8IFtudWxsLCBudWxsXSwKICAgICAgICBpbmZvTWFwCiAgICAgIH0sCiAgICAgIHVzZVhyZWZTdHJlYW06IHRoaXMudXNlT2JqZWN0U3RyZWFtcywKICAgICAgeHJlZjogewogICAgICAgIGVuY3J5cHQsCiAgICAgICAgZW5jcnlwdFJlZgogICAgICB9CiAgICB9KTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3dvcmtlcl9zdHJlYW0uanMKCmNsYXNzIFBERldvcmtlclN0cmVhbSB7CiAgY29uc3RydWN0b3IobXNnSGFuZGxlcikgewogICAgdGhpcy5fbXNnSGFuZGxlciA9IG1zZ0hhbmRsZXI7CiAgICB0aGlzLl9jb250ZW50TGVuZ3RoID0gbnVsbDsKICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID0gbnVsbDsKICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMgPSBbXTsKICB9CiAgZ2V0RnVsbFJlYWRlcigpIHsKICAgIGFzc2VydCghdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIsICJQREZXb3JrZXJTdHJlYW0uZ2V0RnVsbFJlYWRlciBjYW4gb25seSBiZSBjYWxsZWQgb25jZS4iKTsKICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID0gbmV3IFBERldvcmtlclN0cmVhbVJlYWRlcih0aGlzLl9tc2dIYW5kbGVyKTsKICAgIHJldHVybiB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcjsKICB9CiAgZ2V0UmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCkgewogICAgY29uc3QgcmVhZGVyID0gbmV3IFBERldvcmtlclN0cmVhbVJhbmdlUmVhZGVyKGJlZ2luLCBlbmQsIHRoaXMuX21zZ0hhbmRsZXIpOwogICAgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycy5wdXNoKHJlYWRlcik7CiAgICByZXR1cm4gcmVhZGVyOwogIH0KICBjYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pIHsKICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyPy5jYW5jZWwocmVhc29uKTsKICAgIGZvciAoY29uc3QgcmVhZGVyIG9mIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMuc2xpY2UoMCkpIHsKICAgICAgcmVhZGVyLmNhbmNlbChyZWFzb24pOwogICAgfQogIH0KfQpjbGFzcyBQREZXb3JrZXJTdHJlYW1SZWFkZXIgewogIGNvbnN0cnVjdG9yKG1zZ0hhbmRsZXIpIHsKICAgIHRoaXMuX21zZ0hhbmRsZXIgPSBtc2dIYW5kbGVyOwogICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBudWxsOwogICAgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9IGZhbHNlOwogICAgdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgPSBmYWxzZTsKICAgIGNvbnN0IHJlYWRhYmxlU3RyZWFtID0gdGhpcy5fbXNnSGFuZGxlci5zZW5kV2l0aFN0cmVhbSgiR2V0UmVhZGVyIik7CiAgICB0aGlzLl9yZWFkZXIgPSByZWFkYWJsZVN0cmVhbS5nZXRSZWFkZXIoKTsKICAgIHRoaXMuX2hlYWRlcnNSZWFkeSA9IHRoaXMuX21zZ0hhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJSZWFkZXJIZWFkZXJzUmVhZHkiKS50aGVuKGRhdGEgPT4gewogICAgICB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCA9IGRhdGEuaXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgICAgIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQgPSBkYXRhLmlzUmFuZ2VTdXBwb3J0ZWQ7CiAgICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBkYXRhLmNvbnRlbnRMZW5ndGg7CiAgICB9KTsKICB9CiAgZ2V0IGhlYWRlcnNSZWFkeSgpIHsKICAgIHJldHVybiB0aGlzLl9oZWFkZXJzUmVhZHk7CiAgfQogIGdldCBjb250ZW50TGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRMZW5ndGg7CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICB9CiAgZ2V0IGlzUmFuZ2VTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gdGhpcy5faXNSYW5nZVN1cHBvcnRlZDsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGNvbnN0IHsKICAgICAgdmFsdWUsCiAgICAgIGRvbmUKICAgIH0gPSBhd2FpdCB0aGlzLl9yZWFkZXIucmVhZCgpOwogICAgaWYgKGRvbmUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIGRvbmU6IHRydWUKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIHZhbHVlOiB2YWx1ZS5idWZmZXIsCiAgICAgIGRvbmU6IGZhbHNlCiAgICB9OwogIH0KICBjYW5jZWwocmVhc29uKSB7CiAgICB0aGlzLl9yZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgfQp9CmNsYXNzIFBERldvcmtlclN0cmVhbVJhbmdlUmVhZGVyIHsKICBjb25zdHJ1Y3RvcihiZWdpbiwgZW5kLCBtc2dIYW5kbGVyKSB7CiAgICB0aGlzLl9tc2dIYW5kbGVyID0gbXNnSGFuZGxlcjsKICAgIHRoaXMub25Qcm9ncmVzcyA9IG51bGw7CiAgICBjb25zdCByZWFkYWJsZVN0cmVhbSA9IHRoaXMuX21zZ0hhbmRsZXIuc2VuZFdpdGhTdHJlYW0oIkdldFJhbmdlUmVhZGVyIiwgewogICAgICBiZWdpbiwKICAgICAgZW5kCiAgICB9KTsKICAgIHRoaXMuX3JlYWRlciA9IHJlYWRhYmxlU3RyZWFtLmdldFJlYWRlcigpOwogIH0KICBnZXQgaXNTdHJlYW1pbmdTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGFzeW5jIHJlYWQoKSB7CiAgICBjb25zdCB7CiAgICAgIHZhbHVlLAogICAgICBkb25lCiAgICB9ID0gYXdhaXQgdGhpcy5fcmVhZGVyLnJlYWQoKTsKICAgIGlmIChkb25lKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICBkb25lOiB0cnVlCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gewogICAgICB2YWx1ZTogdmFsdWUuYnVmZmVyLAogICAgICBkb25lOiBmYWxzZQogICAgfTsKICB9CiAgY2FuY2VsKHJlYXNvbikgewogICAgdGhpcy5fcmVhZGVyLmNhbmNlbChyZWFzb24pOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvd29ya2VyLmpzCgoKCgoKCgoKCgoKY2xhc3MgV29ya2VyVGFzayB7CiAgY29uc3RydWN0b3IobmFtZSkgewogICAgdGhpcy5uYW1lID0gbmFtZTsKICAgIHRoaXMudGVybWluYXRlZCA9IGZhbHNlOwogICAgdGhpcy5fY2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogIH0KICBnZXQgZmluaXNoZWQoKSB7CiAgICByZXR1cm4gdGhpcy5fY2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBmaW5pc2goKSB7CiAgICB0aGlzLl9jYXBhYmlsaXR5LnJlc29sdmUoKTsKICB9CiAgdGVybWluYXRlKCkgewogICAgdGhpcy50ZXJtaW5hdGVkID0gdHJ1ZTsKICB9CiAgZW5zdXJlTm90VGVybWluYXRlZCgpIHsKICAgIGlmICh0aGlzLnRlcm1pbmF0ZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXb3JrZXIgdGFzayB3YXMgdGVybWluYXRlZCIpOwogICAgfQogIH0KfQpjbGFzcyBXb3JrZXJNZXNzYWdlSGFuZGxlciB7CiAgc3RhdGljIHsKICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIiAmJiAhaXNOb2RlSlMgJiYgdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBzZWxmLnBvc3RNZXNzYWdlID09PSAiZnVuY3Rpb24iICYmICJvbm1lc3NhZ2UiIGluIHNlbGYpIHsKICAgICAgdGhpcy5pbml0aWFsaXplRnJvbVBvcnQoc2VsZik7CiAgICB9CiAgfQogIHN0YXRpYyBzZXR1cChoYW5kbGVyLCBwb3J0KSB7CiAgICBsZXQgdGVzdE1lc3NhZ2VQcm9jZXNzZWQgPSBmYWxzZTsKICAgIGhhbmRsZXIub24oInRlc3QiLCBkYXRhID0+IHsKICAgICAgaWYgKHRlc3RNZXNzYWdlUHJvY2Vzc2VkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRlc3RNZXNzYWdlUHJvY2Vzc2VkID0gdHJ1ZTsKICAgICAgaGFuZGxlci5zZW5kKCJ0ZXN0IiwgZGF0YSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJjb25maWd1cmUiLCBkYXRhID0+IHsKICAgICAgc2V0VmVyYm9zaXR5TGV2ZWwoZGF0YS52ZXJib3NpdHkpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXREb2NSZXF1ZXN0IiwgZGF0YSA9PiB0aGlzLmNyZWF0ZURvY3VtZW50SGFuZGxlcihkYXRhLCBwb3J0KSk7CiAgfQogIHN0YXRpYyBjcmVhdGVEb2N1bWVudEhhbmRsZXIoZG9jUGFyYW1zLCBwb3J0KSB7CiAgICBsZXQgcGRmTWFuYWdlcjsKICAgIGxldCB0ZXJtaW5hdGVkID0gZmFsc2U7CiAgICBsZXQgY2FuY2VsWEhScyA9IG51bGw7CiAgICBjb25zdCBXb3JrZXJUYXNrcyA9IG5ldyBTZXQoKTsKICAgIGNvbnN0IHZlcmJvc2l0eSA9IGdldFZlcmJvc2l0eUxldmVsKCk7CiAgICBjb25zdCB7CiAgICAgIGRvY0lkLAogICAgICBhcGlWZXJzaW9uCiAgICB9ID0gZG9jUGFyYW1zOwogICAgY29uc3Qgd29ya2VyVmVyc2lvbiA9ICI1LjQuNTMwIjsKICAgIGlmIChhcGlWZXJzaW9uICE9PSB3b3JrZXJWZXJzaW9uKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIEFQSSB2ZXJzaW9uICIke2FwaVZlcnNpb259IiBkb2VzIG5vdCBtYXRjaCBgICsgYHRoZSBXb3JrZXIgdmVyc2lvbiAiJHt3b3JrZXJWZXJzaW9ufSIuYCk7CiAgICB9CiAgICBjb25zdCBidWlsZE1zZyA9ICh0eXBlLCBwcm9wKSA9PiBgVGhlIFxgJHt0eXBlfS5wcm90b3R5cGVcYCBjb250YWlucyB1bmV4cGVjdGVkIGVudW1lcmFibGUgcHJvcGVydHkgYCArIGAiJHtwcm9wfSIsIHRodXMgYnJlYWtpbmcgZS5nLiBcYGZvci4uLmluXGAgaXRlcmF0aW9uIG9mICR7dHlwZX1zLmA7CiAgICBmb3IgKGNvbnN0IHByb3AgaW4ge30pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGJ1aWxkTXNnKCJPYmplY3QiLCBwcm9wKSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IHByb3AgaW4gW10pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGJ1aWxkTXNnKCJBcnJheSIsIHByb3ApKTsKICAgIH0KICAgIGNvbnN0IHdvcmtlckhhbmRsZXJOYW1lID0gZG9jSWQgKyAiX3dvcmtlciI7CiAgICBsZXQgaGFuZGxlciA9IG5ldyBNZXNzYWdlSGFuZGxlcih3b3JrZXJIYW5kbGVyTmFtZSwgZG9jSWQsIHBvcnQpOwogICAgZnVuY3Rpb24gZW5zdXJlTm90VGVybWluYXRlZCgpIHsKICAgICAgaWYgKHRlcm1pbmF0ZWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldvcmtlciB3YXMgdGVybWluYXRlZCIpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzdGFydFdvcmtlclRhc2sodGFzaykgewogICAgICBXb3JrZXJUYXNrcy5hZGQodGFzayk7CiAgICB9CiAgICBmdW5jdGlvbiBmaW5pc2hXb3JrZXJUYXNrKHRhc2spIHsKICAgICAgdGFzay5maW5pc2goKTsKICAgICAgV29ya2VyVGFza3MuZGVsZXRlKHRhc2spOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gbG9hZERvY3VtZW50KHJlY292ZXJ5TW9kZSkgewogICAgICBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2hlY2tIZWFkZXIiKTsKICAgICAgYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoInBhcnNlU3RhcnRYUmVmIik7CiAgICAgIGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJwYXJzZSIsIFtyZWNvdmVyeU1vZGVdKTsKICAgICAgYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImNoZWNrRmlyc3RQYWdlIiwgW3JlY292ZXJ5TW9kZV0pOwogICAgICBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2hlY2tMYXN0UGFnZSIsIFtyZWNvdmVyeU1vZGVdKTsKICAgICAgY29uc3QgaXNQdXJlWGZhID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImlzUHVyZVhmYSIpOwogICAgICBpZiAoaXNQdXJlWGZhKSB7CiAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKCJsb2FkWGZhUmVzb3VyY2VzIik7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJsb2FkWGZhUmVzb3VyY2VzIiwgW2hhbmRsZXIsIHRhc2tdKTsKICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICB9CiAgICAgIGNvbnN0IFtudW1QYWdlcywgZmluZ2VycHJpbnRzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZURvYygibnVtUGFnZXMiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoImZpbmdlcnByaW50cyIpXSk7CiAgICAgIGNvbnN0IGh0bWxGb3JYZmEgPSBpc1B1cmVYZmEgPyBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygiaHRtbEZvclhmYSIpIDogbnVsbDsKICAgICAgcmV0dXJuIHsKICAgICAgICBudW1QYWdlcywKICAgICAgICBmaW5nZXJwcmludHMsCiAgICAgICAgaHRtbEZvclhmYQogICAgICB9OwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gZ2V0UGRmTWFuYWdlcih7CiAgICAgIGRhdGEsCiAgICAgIHBhc3N3b3JkLAogICAgICBkaXNhYmxlQXV0b0ZldGNoLAogICAgICByYW5nZUNodW5rU2l6ZSwKICAgICAgbGVuZ3RoLAogICAgICBkb2NCYXNlVXJsLAogICAgICBlbmFibGVYZmEsCiAgICAgIGV2YWx1YXRvck9wdGlvbnMKICAgIH0pIHsKICAgICAgY29uc3QgcGRmTWFuYWdlckFyZ3MgPSB7CiAgICAgICAgc291cmNlOiBudWxsLAogICAgICAgIGRpc2FibGVBdXRvRmV0Y2gsCiAgICAgICAgZG9jQmFzZVVybCwKICAgICAgICBkb2NJZCwKICAgICAgICBlbmFibGVYZmEsCiAgICAgICAgZXZhbHVhdG9yT3B0aW9ucywKICAgICAgICBoYW5kbGVyLAogICAgICAgIGxlbmd0aCwKICAgICAgICBwYXNzd29yZCwKICAgICAgICByYW5nZUNodW5rU2l6ZQogICAgICB9OwogICAgICBpZiAoZGF0YSkgewogICAgICAgIHBkZk1hbmFnZXJBcmdzLnNvdXJjZSA9IGRhdGE7CiAgICAgICAgcmV0dXJuIG5ldyBMb2NhbFBkZk1hbmFnZXIocGRmTWFuYWdlckFyZ3MpOwogICAgICB9CiAgICAgIGNvbnN0IHBkZlN0cmVhbSA9IG5ldyBQREZXb3JrZXJTdHJlYW0oaGFuZGxlciksCiAgICAgICAgZnVsbFJlcXVlc3QgPSBwZGZTdHJlYW0uZ2V0RnVsbFJlYWRlcigpOwogICAgICBjb25zdCBwZGZNYW5hZ2VyQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICBsZXQgbmV3UGRmTWFuYWdlciwKICAgICAgICBjYWNoZWRDaHVua3MgPSBbXSwKICAgICAgICBsb2FkZWQgPSAwOwogICAgICBmdWxsUmVxdWVzdC5oZWFkZXJzUmVhZHkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFmdWxsUmVxdWVzdC5pc1JhbmdlU3VwcG9ydGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHBkZk1hbmFnZXJBcmdzLnNvdXJjZSA9IHBkZlN0cmVhbTsKICAgICAgICBwZGZNYW5hZ2VyQXJncy5sZW5ndGggPSBmdWxsUmVxdWVzdC5jb250ZW50TGVuZ3RoOwogICAgICAgIHBkZk1hbmFnZXJBcmdzLmRpc2FibGVBdXRvRmV0Y2ggfHw9IGZ1bGxSZXF1ZXN0LmlzU3RyZWFtaW5nU3VwcG9ydGVkOwogICAgICAgIG5ld1BkZk1hbmFnZXIgPSBuZXcgTmV0d29ya1BkZk1hbmFnZXIocGRmTWFuYWdlckFyZ3MpOwogICAgICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2FjaGVkQ2h1bmtzKSB7CiAgICAgICAgICBuZXdQZGZNYW5hZ2VyLnNlbmRQcm9ncmVzc2l2ZURhdGEoY2h1bmspOwogICAgICAgIH0KICAgICAgICBjYWNoZWRDaHVua3MgPSBbXTsKICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZXNvbHZlKG5ld1BkZk1hbmFnZXIpOwogICAgICAgIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVqZWN0KHJlYXNvbik7CiAgICAgICAgY2FuY2VsWEhScyA9IG51bGw7CiAgICAgIH0pOwogICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgY29uc3QgcmVhZENodW5rID0gZnVuY3Rpb24gKHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZG9uZQogICAgICAgIH0pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgICBpZiAoIW5ld1BkZk1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBkZkZpbGUgPSBhcnJheUJ1ZmZlcnNUb0J5dGVzKGNhY2hlZENodW5rcyk7CiAgICAgICAgICAgICAgICBjYWNoZWRDaHVua3MgPSBbXTsKICAgICAgICAgICAgICAgIGlmIChsZW5ndGggJiYgcGRmRmlsZS5sZW5ndGggIT09IGxlbmd0aCkgewogICAgICAgICAgICAgICAgICB3YXJuKCJyZXBvcnRlZCBIVFRQIGxlbmd0aCBpcyBkaWZmZXJlbnQgZnJvbSBhY3R1YWwiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBkZk1hbmFnZXJBcmdzLnNvdXJjZSA9IHBkZkZpbGU7CiAgICAgICAgICAgICAgICBuZXdQZGZNYW5hZ2VyID0gbmV3IExvY2FsUGRmTWFuYWdlcihwZGZNYW5hZ2VyQXJncyk7CiAgICAgICAgICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZXNvbHZlKG5ld1BkZk1hbmFnZXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYW5jZWxYSFJzID0gbnVsbDsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICAgICAgICAgIGlmICghZnVsbFJlcXVlc3QuaXNTdHJlYW1pbmdTdXBwb3J0ZWQpIHsKICAgICAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY1Byb2dyZXNzIiwgewogICAgICAgICAgICAgICAgbG9hZGVkLAogICAgICAgICAgICAgICAgdG90YWw6IE1hdGgubWF4KGxvYWRlZCwgZnVsbFJlcXVlc3QuY29udGVudExlbmd0aCB8fCAwKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdQZGZNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgbmV3UGRmTWFuYWdlci5zZW5kUHJvZ3Jlc3NpdmVEYXRhKHZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjYWNoZWRDaHVua3MucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVsbFJlcXVlc3QucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBmdWxsUmVxdWVzdC5yZWFkKCkudGhlbihyZWFkQ2h1bmssIHJlamVjdCk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVqZWN0KGUpOwogICAgICAgIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICB9KTsKICAgICAgY2FuY2VsWEhScyA9IHJlYXNvbiA9PiB7CiAgICAgICAgcGRmU3RyZWFtLmNhbmNlbEFsbFJlcXVlc3RzKHJlYXNvbik7CiAgICAgIH07CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgfQogICAgZnVuY3Rpb24gc2V0dXBEb2MoZGF0YSkgewogICAgICBmdW5jdGlvbiBvblN1Y2Nlc3MoZG9jKSB7CiAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgIGhhbmRsZXIuc2VuZCgiR2V0RG9jIiwgewogICAgICAgICAgcGRmSW5mbzogZG9jCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gb25GYWlsdXJlKGV4KSB7CiAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgIGlmIChleCBpbnN0YW5jZW9mIFBhc3N3b3JkRXhjZXB0aW9uKSB7CiAgICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYFBhc3N3b3JkRXhjZXB0aW9uOiByZXNwb25zZSAke2V4LmNvZGV9YCk7CiAgICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICBoYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiUGFzc3dvcmRSZXF1ZXN0IiwgZXgpLnRoZW4oZnVuY3Rpb24gKHsKICAgICAgICAgICAgcGFzc3dvcmQKICAgICAgICAgIH0pIHsKICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgcGRmTWFuYWdlci51cGRhdGVQYXNzd29yZChwYXNzd29yZCk7CiAgICAgICAgICAgIHBkZk1hbmFnZXJSZWFkeSgpOwogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY0V4Y2VwdGlvbiIsIGV4KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY0V4Y2VwdGlvbiIsIHdyYXBSZWFzb24oZXgpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcGRmTWFuYWdlclJlYWR5KCkgewogICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICBsb2FkRG9jdW1lbnQoZmFsc2UpLnRoZW4ob25TdWNjZXNzLCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgICBpZiAoIShyZWFzb24gaW5zdGFuY2VvZiBYUmVmUGFyc2VFeGNlcHRpb24pKSB7CiAgICAgICAgICAgIG9uRmFpbHVyZShyZWFzb24pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBwZGZNYW5hZ2VyLnJlcXVlc3RMb2FkZWRTdHJlYW0oKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgICAgICBsb2FkRG9jdW1lbnQodHJ1ZSkudGhlbihvblN1Y2Nlc3MsIG9uRmFpbHVyZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgIGdldFBkZk1hbmFnZXIoZGF0YSkudGhlbihmdW5jdGlvbiAobmV3UGRmTWFuYWdlcikgewogICAgICAgIGlmICh0ZXJtaW5hdGVkKSB7CiAgICAgICAgICBuZXdQZGZNYW5hZ2VyLnRlcm1pbmF0ZShuZXcgQWJvcnRFeGNlcHRpb24oIldvcmtlciB3YXMgdGVybWluYXRlZC4iKSk7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldvcmtlciB3YXMgdGVybWluYXRlZCIpOwogICAgICAgIH0KICAgICAgICBwZGZNYW5hZ2VyID0gbmV3UGRmTWFuYWdlcjsKICAgICAgICBwZGZNYW5hZ2VyLnJlcXVlc3RMb2FkZWRTdHJlYW0odHJ1ZSkudGhlbihzdHJlYW0gPT4gewogICAgICAgICAgaGFuZGxlci5zZW5kKCJEYXRhTG9hZGVkIiwgewogICAgICAgICAgICBsZW5ndGg6IHN0cmVhbS5ieXRlcy5ieXRlTGVuZ3RoCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSkudGhlbihwZGZNYW5hZ2VyUmVhZHksIG9uRmFpbHVyZSk7CiAgICB9CiAgICBoYW5kbGVyLm9uKCJHZXRQYWdlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShkYXRhLnBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmUocGFnZSwgInJvdGF0ZSIpLCBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAicmVmIiksIHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJ1c2VyVW5pdCIpLCBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAidmlldyIpXSkudGhlbihmdW5jdGlvbiAoW3JvdGF0ZSwgcmVmLCB1c2VyVW5pdCwgdmlld10pIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHJvdGF0ZSwKICAgICAgICAgICAgcmVmLAogICAgICAgICAgICByZWZTdHI6IHJlZj8udG9TdHJpbmcoKSA/PyBudWxsLAogICAgICAgICAgICB1c2VyVW5pdCwKICAgICAgICAgICAgdmlldwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFBhZ2VJbmRleCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGNvbnN0IHBhZ2VSZWYgPSBSZWYuZ2V0KGRhdGEubnVtLCBkYXRhLmdlbik7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImdldFBhZ2VJbmRleCIsIFtwYWdlUmVmXSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldERlc3RpbmF0aW9ucyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImRlc3RpbmF0aW9ucyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXREZXN0aW5hdGlvbiIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImdldERlc3RpbmF0aW9uIiwgW2RhdGEuaWRdKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGFnZUxhYmVscyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInBhZ2VMYWJlbHMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGFnZUxheW91dCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInBhZ2VMYXlvdXQiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGFnZU1vZGUiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJwYWdlTW9kZSIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRWaWV3ZXJQcmVmZXJlbmNlcyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInZpZXdlclByZWZlcmVuY2VzIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE9wZW5BY3Rpb24iLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJvcGVuQWN0aW9uIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldEF0dGFjaG1lbnRzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYXR0YWNobWVudHMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RG9jSlNBY3Rpb25zIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygianNBY3Rpb25zIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFBhZ2VKU0FjdGlvbnMiLCBmdW5jdGlvbiAoewogICAgICBwYWdlSW5kZXgKICAgIH0pIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4ocGFnZSA9PiBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAianNBY3Rpb25zIikpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRBbm5vdGF0aW9uc0J5VHlwZSIsIGFzeW5jIGZ1bmN0aW9uICh7CiAgICAgIHR5cGVzLAogICAgICBwYWdlSW5kZXhlc1RvU2tpcAogICAgfSkgewogICAgICBjb25zdCBbbnVtUGFnZXMsIGFubm90YXRpb25HbG9iYWxzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZURvYygibnVtUGFnZXMiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoImFubm90YXRpb25HbG9iYWxzIildKTsKICAgICAgaWYgKCFhbm5vdGF0aW9uR2xvYmFscykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2VQcm9taXNlcyA9IFtdOwogICAgICBjb25zdCBhbm5vdGF0aW9uUHJvbWlzZXMgPSBbXTsKICAgICAgbGV0IHRhc2sgPSBudWxsOwogICAgICB0cnkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IG51bVBhZ2VzOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgaWYgKHBhZ2VJbmRleGVzVG9Ta2lwPy5oYXMoaSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRhc2spIHsKICAgICAgICAgICAgdGFzayA9IG5ldyBXb3JrZXJUYXNrKCJHZXRBbm5vdGF0aW9uc0J5VHlwZSIpOwogICAgICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICB9CiAgICAgICAgICBwYWdlUHJvbWlzZXMucHVzaChwZGZNYW5hZ2VyLmdldFBhZ2UoaSkudGhlbihhc3luYyBwYWdlID0+IHsKICAgICAgICAgICAgaWYgKCFwYWdlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYWdlLmNvbGxlY3RBbm5vdGF0aW9uc0J5VHlwZShoYW5kbGVyLCB0YXNrLCB0eXBlcywgYW5ub3RhdGlvblByb21pc2VzLCBhbm5vdGF0aW9uR2xvYmFscykgfHwgW107CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHBhZ2VQcm9taXNlcyk7CiAgICAgICAgY29uc3QgYW5ub3RhdGlvbnMgPSBhd2FpdCBQcm9taXNlLmFsbChhbm5vdGF0aW9uUHJvbWlzZXMpOwogICAgICAgIHJldHVybiBhbm5vdGF0aW9ucy5maWx0ZXIoYSA9PiAhIWEpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGlmICh0YXNrKSB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRPdXRsaW5lIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZG9jdW1lbnRPdXRsaW5lIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE9wdGlvbmFsQ29udGVudENvbmZpZyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coIm9wdGlvbmFsQ29udGVudENvbmZpZyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRQZXJtaXNzaW9ucyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInBlcm1pc3Npb25zIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE1ldGFkYXRhIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZURvYygiZG9jdW1lbnRJbmZvIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygibWV0YWRhdGEiKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJoYXNTdHJ1Y3RUcmVlIildKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0TWFya0luZm8iLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJtYXJrSW5mbyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXREYXRhIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIucmVxdWVzdExvYWRlZFN0cmVhbSgpLnRoZW4oc3RyZWFtID0+IHN0cmVhbS5ieXRlcyk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldEFubm90YXRpb25zIiwgZnVuY3Rpb24gKHsKICAgICAgcGFnZUluZGV4LAogICAgICBpbnRlbnQKICAgIH0pIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYEdldEFubm90YXRpb25zOiBwYWdlICR7cGFnZUluZGV4fWApOwogICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICByZXR1cm4gcGFnZS5nZXRBbm5vdGF0aW9uc0RhdGEoaGFuZGxlciwgdGFzaywgaW50ZW50KS50aGVuKGRhdGEgPT4gewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgIH0sIHJlYXNvbiA9PiB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RmllbGRPYmplY3RzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJmaWVsZE9iamVjdHMiKS50aGVuKGZpZWxkT2JqZWN0cyA9PiBmaWVsZE9iamVjdHM/LmFsbEZpZWxkcyB8fCBudWxsKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiSGFzSlNBY3Rpb25zIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJoYXNKU0FjdGlvbnMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0Q2FsY3VsYXRpb25PcmRlcklkcyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2FsY3VsYXRpb25PcmRlcklkcyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJFeHRyYWN0UGFnZXMiLCBhc3luYyBmdW5jdGlvbiAoewogICAgICBwYWdlSW5mb3MKICAgIH0pIHsKICAgICAgaWYgKCFwYWdlSW5mb3MpIHsKICAgICAgICB3YXJuKCJleHRyYWN0UGFnZXM6IG5vdGhpbmcgdG8gZXh0cmFjdC4iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGFnZUluZm9zKSkgewogICAgICAgIHBhZ2VJbmZvcyA9IFtwYWdlSW5mb3NdOwogICAgICB9CiAgICAgIGxldCBuZXdEb2N1bWVudElkID0gMDsKICAgICAgZm9yIChjb25zdCBwYWdlSW5mbyBvZiBwYWdlSW5mb3MpIHsKICAgICAgICBpZiAocGFnZUluZm8uZG9jdW1lbnQgPT09IG51bGwpIHsKICAgICAgICAgIHBhZ2VJbmZvLmRvY3VtZW50ID0gcGRmTWFuYWdlci5wZGZEb2N1bWVudDsKICAgICAgICB9IGVsc2UgaWYgKEFycmF5QnVmZmVyLmlzVmlldyhwYWdlSW5mby5kb2N1bWVudCkpIHsKICAgICAgICAgIGNvbnN0IG1hbmFnZXIgPSBuZXcgTG9jYWxQZGZNYW5hZ2VyKHsKICAgICAgICAgICAgc291cmNlOiBwYWdlSW5mby5kb2N1bWVudCwKICAgICAgICAgICAgZG9jSWQ6IGAke2RvY0lkfV9leHRyYWN0UGFnZXNfJHtuZXdEb2N1bWVudElkKyt9YCwKICAgICAgICAgICAgaGFuZGxlciwKICAgICAgICAgICAgcGFzc3dvcmQ6IHBhZ2VJbmZvLnBhc3N3b3JkID8/IG51bGwsCiAgICAgICAgICAgIGV2YWx1YXRvck9wdGlvbnM6IE9iamVjdC5hc3NpZ24oe30sIHBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9ucykKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IHJlY292ZXJ5TW9kZSA9IGZhbHNlOwogICAgICAgICAgbGV0IGlzVmFsaWQgPSB0cnVlOwogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBhd2FpdCBtYW5hZ2VyLnJlcXVlc3RMb2FkZWRTdHJlYW0oKTsKICAgICAgICAgICAgICBhd2FpdCBtYW5hZ2VyLmVuc3VyZURvYygiY2hlY2tIZWFkZXIiKTsKICAgICAgICAgICAgICBhd2FpdCBtYW5hZ2VyLmVuc3VyZURvYygicGFyc2VTdGFydFhSZWYiKTsKICAgICAgICAgICAgICBhd2FpdCBtYW5hZ2VyLmVuc3VyZURvYygicGFyc2UiLCBbcmVjb3ZlcnlNb2RlXSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFhSZWZQYXJzZUV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgaWYgKHJlY292ZXJ5TW9kZSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgcmVjb3ZlcnlNb2RlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHdhcm4oImV4dHJhY3RQYWdlczogWFJlZlBhcnNlRXhjZXB0aW9uLiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZSBpbnN0YW5jZW9mIFBhc3N3b3JkRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYFBhc3N3b3JkRXhjZXB0aW9uOiByZXNwb25zZSAke2UuY29kZX1gKTsKICAgICAgICAgICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgICAgICBwYXNzd29yZAogICAgICAgICAgICAgICAgICB9ID0gYXdhaXQgaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIlBhc3N3b3JkUmVxdWVzdCIsIGUpOwogICAgICAgICAgICAgICAgICBtYW5hZ2VyLnVwZGF0ZVBhc3N3b3JkKHBhc3N3b3JkKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHdhcm4oImV4dHJhY3RQYWdlczogaW52YWxpZCBwYXNzd29yZC4iKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHdhcm4oImV4dHJhY3RQYWdlczogaW52YWxpZCBkb2N1bWVudC4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghaXNWYWxpZCkgewogICAgICAgICAgICBwYWdlSW5mby5kb2N1bWVudCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBpc1B1cmVYZmEgPSBhd2FpdCBtYW5hZ2VyLmVuc3VyZURvYygiaXNQdXJlWGZhIik7CiAgICAgICAgICBpZiAoaXNQdXJlWGZhKSB7CiAgICAgICAgICAgIHBhZ2VJbmZvLmRvY3VtZW50ID0gbnVsbDsKICAgICAgICAgICAgd2FybigiZXh0cmFjdFBhZ2VzIGRvZXMgbm90IHN1cHBvcnQgcHVyZSBYRkEgZG9jdW1lbnRzLiIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcGFnZUluZm8uZG9jdW1lbnQgPSBtYW5hZ2VyLnBkZkRvY3VtZW50OwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3YXJuKCJleHRyYWN0UGFnZXM6IGludmFsaWQgZG9jdW1lbnQuIik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcGRmRWRpdG9yID0gbmV3IFBERkVkaXRvcigpOwogICAgICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IHBkZkVkaXRvci5leHRyYWN0UGFnZXMocGFnZUluZm9zKTsKICAgICAgICByZXR1cm4gYnVmZmVyOwogICAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgICBjb25zb2xlLmVycm9yKHJlYXNvbik7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0pOwogICAgaGFuZGxlci5vbigiU2F2ZURvY3VtZW50IiwgYXN5bmMgZnVuY3Rpb24gKHsKICAgICAgaXNQdXJlWGZhLAogICAgICBudW1QYWdlcywKICAgICAgYW5ub3RhdGlvblN0b3JhZ2UsCiAgICAgIGZpbGVuYW1lCiAgICB9KSB7CiAgICAgIGNvbnN0IGdsb2JhbFByb21pc2VzID0gW3BkZk1hbmFnZXIucmVxdWVzdExvYWRlZFN0cmVhbSgpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImFjcm9Gb3JtIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYWNyb0Zvcm1SZWYiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoInN0YXJ0WFJlZiIpLCBwZGZNYW5hZ2VyLmVuc3VyZURvYygieHJlZiIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInN0cnVjdFRyZWVSb290IildOwogICAgICBjb25zdCBjaGFuZ2VzID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICAgIGNvbnN0IG5ld0Fubm90YXRpb25zQnlQYWdlID0gIWlzUHVyZVhmYSA/IGdldE5ld0Fubm90YXRpb25zTWFwKGFubm90YXRpb25TdG9yYWdlKSA6IG51bGw7CiAgICAgIGNvbnN0IFtzdHJlYW0sIGFjcm9Gb3JtLCBhY3JvRm9ybVJlZiwgc3RhcnRYUmVmLCB4cmVmLCBfc3RydWN0VHJlZVJvb3RdID0gYXdhaXQgUHJvbWlzZS5hbGwoZ2xvYmFsUHJvbWlzZXMpOwogICAgICBjb25zdCBjYXRhbG9nUmVmID0geHJlZi50cmFpbGVyLmdldFJhdygiUm9vdCIpIHx8IG51bGw7CiAgICAgIGxldCBzdHJ1Y3RUcmVlUm9vdDsKICAgICAgaWYgKG5ld0Fubm90YXRpb25zQnlQYWdlKSB7CiAgICAgICAgaWYgKCFfc3RydWN0VHJlZVJvb3QpIHsKICAgICAgICAgIGlmIChhd2FpdCBTdHJ1Y3RUcmVlUm9vdC5jYW5DcmVhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgICAgICAgICAgY2F0YWxvZ1JlZiwKICAgICAgICAgICAgcGRmTWFuYWdlciwKICAgICAgICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UKICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgIHN0cnVjdFRyZWVSb290ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGF3YWl0IF9zdHJ1Y3RUcmVlUm9vdC5jYW5VcGRhdGVTdHJ1Y3RUcmVlKHsKICAgICAgICAgIHBkZk1hbmFnZXIsCiAgICAgICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZQogICAgICAgIH0pKSB7CiAgICAgICAgICBzdHJ1Y3RUcmVlUm9vdCA9IF9zdHJ1Y3RUcmVlUm9vdDsKICAgICAgICB9CiAgICAgICAgY29uc3QgaW1hZ2VQcm9taXNlcyA9IEFubm90YXRpb25GYWN0b3J5LmdlbmVyYXRlSW1hZ2VzKGFubm90YXRpb25TdG9yYWdlLnZhbHVlcygpLCB4cmVmLCBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnMuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpOwogICAgICAgIGNvbnN0IG5ld0Fubm90YXRpb25Qcm9taXNlcyA9IHN0cnVjdFRyZWVSb290ID09PSB1bmRlZmluZWQgPyBwcm9taXNlcyA6IFtdOwogICAgICAgIGZvciAoY29uc3QgW3BhZ2VJbmRleCwgYW5ub3RhdGlvbnNdIG9mIG5ld0Fubm90YXRpb25zQnlQYWdlKSB7CiAgICAgICAgICBuZXdBbm5vdGF0aW9uUHJvbWlzZXMucHVzaChwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKHBhZ2UgPT4gewogICAgICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYFNhdmUgKGVkaXRvcik6IHBhZ2UgJHtwYWdlSW5kZXh9YCk7CiAgICAgICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgcmV0dXJuIHBhZ2Uuc2F2ZU5ld0Fubm90YXRpb25zKGhhbmRsZXIsIHRhc2ssIGFubm90YXRpb25zLCBpbWFnZVByb21pc2VzLCBjaGFuZ2VzKS5maW5hbGx5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cnVjdFRyZWVSb290ID09PSBudWxsKSB7CiAgICAgICAgICBwcm9taXNlcy5wdXNoKFByb21pc2UuYWxsKG5ld0Fubm90YXRpb25Qcm9taXNlcykudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGF3YWl0IFN0cnVjdFRyZWVSb290LmNyZWF0ZVN0cnVjdHVyZVRyZWUoewogICAgICAgICAgICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgICAgICAgICAgIHhyZWYsCiAgICAgICAgICAgICAgY2F0YWxvZ1JlZiwKICAgICAgICAgICAgICBwZGZNYW5hZ2VyLAogICAgICAgICAgICAgIGNoYW5nZXMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgfSBlbHNlIGlmIChzdHJ1Y3RUcmVlUm9vdCkgewogICAgICAgICAgcHJvbWlzZXMucHVzaChQcm9taXNlLmFsbChuZXdBbm5vdGF0aW9uUHJvbWlzZXMpLnRoZW4oYXN5bmMgKCkgPT4gewogICAgICAgICAgICBhd2FpdCBzdHJ1Y3RUcmVlUm9vdC51cGRhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgICAgICAgICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZSwKICAgICAgICAgICAgICBwZGZNYW5hZ2VyLAogICAgICAgICAgICAgIGNoYW5nZXMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChpc1B1cmVYZmEpIHsKICAgICAgICBwcm9taXNlcy5wdXNoKHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJzZXJpYWxpemVYZmFEYXRhIiwgW2Fubm90YXRpb25TdG9yYWdlXSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAobGV0IHBhZ2VJbmRleCA9IDA7IHBhZ2VJbmRleCA8IG51bVBhZ2VzOyBwYWdlSW5kZXgrKykgewogICAgICAgICAgcHJvbWlzZXMucHVzaChwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgICAgIGNvbnN0IHRhc2sgPSBuZXcgV29ya2VyVGFzayhgU2F2ZTogcGFnZSAke3BhZ2VJbmRleH1gKTsKICAgICAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgICByZXR1cm4gcGFnZS5zYXZlKGhhbmRsZXIsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKS5maW5hbGx5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcmVmcyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsKICAgICAgbGV0IHhmYURhdGEgPSBudWxsOwogICAgICBpZiAoaXNQdXJlWGZhKSB7CiAgICAgICAgeGZhRGF0YSA9IHJlZnNbMF07CiAgICAgICAgaWYgKCF4ZmFEYXRhKSB7CiAgICAgICAgICByZXR1cm4gc3RyZWFtLmJ5dGVzOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaGFuZ2VzLnNpemUgPT09IDApIHsKICAgICAgICByZXR1cm4gc3RyZWFtLmJ5dGVzOwogICAgICB9CiAgICAgIGNvbnN0IG5lZWRBcHBlYXJhbmNlcyA9IGFjcm9Gb3JtUmVmICYmIGFjcm9Gb3JtIGluc3RhbmNlb2YgRGljdCAmJiBjaGFuZ2VzLnZhbHVlcygpLnNvbWUocmVmID0+IHJlZi5uZWVkQXBwZWFyYW5jZXMpOwogICAgICBjb25zdCB4ZmEgPSBhY3JvRm9ybSBpbnN0YW5jZW9mIERpY3QgJiYgYWNyb0Zvcm0uZ2V0KCJYRkEiKSB8fCBudWxsOwogICAgICBsZXQgeGZhRGF0YXNldHNSZWYgPSBudWxsOwogICAgICBsZXQgaGFzWGZhRGF0YXNldHNFbnRyeSA9IGZhbHNlOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh4ZmEpKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0geGZhLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgIGlmICh4ZmFbaV0gPT09ICJkYXRhc2V0cyIpIHsKICAgICAgICAgICAgeGZhRGF0YXNldHNSZWYgPSB4ZmFbaSArIDFdOwogICAgICAgICAgICBoYXNYZmFEYXRhc2V0c0VudHJ5ID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHhmYURhdGFzZXRzUmVmID09PSBudWxsKSB7CiAgICAgICAgICB4ZmFEYXRhc2V0c1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHhmYSkgewogICAgICAgIHdhcm4oIlVuc3VwcG9ydGVkIFhGQSB0eXBlLiIpOwogICAgICB9CiAgICAgIGxldCBuZXdYcmVmSW5mbyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGlmICh4cmVmLnRyYWlsZXIpIHsKICAgICAgICBjb25zdCBpbmZvTWFwID0gbmV3IE1hcCgpOwogICAgICAgIGNvbnN0IHhyZWZJbmZvID0geHJlZi50cmFpbGVyLmdldCgiSW5mbyIpIHx8IG51bGw7CiAgICAgICAgaWYgKHhyZWZJbmZvIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgeHJlZkluZm8pIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICBpbmZvTWFwLnNldChrZXksIHN0cmluZ1RvUERGU3RyaW5nKHZhbHVlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbmV3WHJlZkluZm8gPSB7CiAgICAgICAgICByb290UmVmOiBjYXRhbG9nUmVmLAogICAgICAgICAgZW5jcnlwdFJlZjogeHJlZi50cmFpbGVyLmdldFJhdygiRW5jcnlwdCIpIHx8IG51bGwsCiAgICAgICAgICBuZXdSZWY6IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCksCiAgICAgICAgICBpbmZvUmVmOiB4cmVmLnRyYWlsZXIuZ2V0UmF3KCJJbmZvIikgfHwgbnVsbCwKICAgICAgICAgIGluZm9NYXAsCiAgICAgICAgICBmaWxlSWRzOiB4cmVmLnRyYWlsZXIuZ2V0KCJJRCIpIHx8IG51bGwsCiAgICAgICAgICBzdGFydFhSZWYsCiAgICAgICAgICBmaWxlbmFtZQogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGluY3JlbWVudGFsVXBkYXRlKHsKICAgICAgICBvcmlnaW5hbERhdGE6IHN0cmVhbS5ieXRlcywKICAgICAgICB4cmVmSW5mbzogbmV3WHJlZkluZm8sCiAgICAgICAgY2hhbmdlcywKICAgICAgICB4cmVmLAogICAgICAgIGhhc1hmYTogISF4ZmEsCiAgICAgICAgeGZhRGF0YXNldHNSZWYsCiAgICAgICAgaGFzWGZhRGF0YXNldHNFbnRyeSwKICAgICAgICBuZWVkQXBwZWFyYW5jZXMsCiAgICAgICAgYWNyb0Zvcm1SZWYsCiAgICAgICAgYWNyb0Zvcm0sCiAgICAgICAgeGZhRGF0YSwKICAgICAgICB1c2VYcmVmU3RyZWFtOiBpc0RpY3QoeHJlZi50b3BEaWN0LCAiWFJlZiIpCiAgICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgIHhyZWYucmVzZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE9wZXJhdG9yTGlzdCIsIGZ1bmN0aW9uIChkYXRhLCBzaW5rKSB7CiAgICAgIGNvbnN0IHBhZ2VJbmRleCA9IGRhdGEucGFnZUluZGV4OwogICAgICBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKGBHZXRPcGVyYXRvckxpc3Q6IHBhZ2UgJHtwYWdlSW5kZXh9YCk7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIGNvbnN0IHN0YXJ0ID0gdmVyYm9zaXR5ID49IFZlcmJvc2l0eUxldmVsLklORk9TID8gRGF0ZS5ub3coKSA6IDA7CiAgICAgICAgcGFnZS5nZXRPcGVyYXRvckxpc3QoewogICAgICAgICAgaGFuZGxlciwKICAgICAgICAgIHNpbmssCiAgICAgICAgICB0YXNrLAogICAgICAgICAgaW50ZW50OiBkYXRhLmludGVudCwKICAgICAgICAgIGNhY2hlS2V5OiBkYXRhLmNhY2hlS2V5LAogICAgICAgICAgYW5ub3RhdGlvblN0b3JhZ2U6IGRhdGEuYW5ub3RhdGlvblN0b3JhZ2UsCiAgICAgICAgICBtb2RpZmllZElkczogZGF0YS5tb2RpZmllZElkcwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKG9wZXJhdG9yTGlzdEluZm8pIHsKICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICBpZiAoc3RhcnQpIHsKICAgICAgICAgICAgaW5mbyhgcGFnZT0ke3BhZ2VJbmRleCArIDF9IC0gZ2V0T3BlcmF0b3JMaXN0OiB0aW1lPWAgKyBgJHtEYXRlLm5vdygpIC0gc3RhcnR9bXMsIGxlbj0ke29wZXJhdG9yTGlzdEluZm8ubGVuZ3RofWApOwogICAgICAgICAgfQogICAgICAgICAgc2luay5jbG9zZSgpOwogICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICBpZiAodGFzay50ZXJtaW5hdGVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHNpbmsuZXJyb3IocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFRleHRDb250ZW50IiwgZnVuY3Rpb24gKGRhdGEsIHNpbmspIHsKICAgICAgY29uc3QgewogICAgICAgIHBhZ2VJbmRleCwKICAgICAgICBpbmNsdWRlTWFya2VkQ29udGVudCwKICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbgogICAgICB9ID0gZGF0YTsKICAgICAgcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIGNvbnN0IHRhc2sgPSBuZXcgV29ya2VyVGFzaygiR2V0VGV4dENvbnRlbnQ6IHBhZ2UgIiArIHBhZ2VJbmRleCk7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIGNvbnN0IHN0YXJ0ID0gdmVyYm9zaXR5ID49IFZlcmJvc2l0eUxldmVsLklORk9TID8gRGF0ZS5ub3coKSA6IDA7CiAgICAgICAgcGFnZS5leHRyYWN0VGV4dENvbnRlbnQoewogICAgICAgICAgaGFuZGxlciwKICAgICAgICAgIHRhc2ssCiAgICAgICAgICBzaW5rLAogICAgICAgICAgaW5jbHVkZU1hcmtlZENvbnRlbnQsCiAgICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIGlmIChzdGFydCkgewogICAgICAgICAgICBpbmZvKGBwYWdlPSR7cGFnZUluZGV4ICsgMX0gLSBnZXRUZXh0Q29udGVudDogdGltZT1gICsgYCR7RGF0ZS5ub3coKSAtIHN0YXJ0fW1zYCk7CiAgICAgICAgICB9CiAgICAgICAgICBzaW5rLmNsb3NlKCk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIGlmICh0YXNrLnRlcm1pbmF0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgc2luay5lcnJvcihyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0U3RydWN0VHJlZSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmdldFBhZ2UoZGF0YS5wYWdlSW5kZXgpLnRoZW4ocGFnZSA9PiBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAiZ2V0U3RydWN0VHJlZSIpKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiRm9udEZhbGxiYWNrIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZm9udEZhbGxiYWNrKGRhdGEuaWQsIGhhbmRsZXIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJDbGVhbnVwIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuY2xlYW51cCh0cnVlKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiVGVybWluYXRlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgdGVybWluYXRlZCA9IHRydWU7CiAgICAgIGNvbnN0IHdhaXRPbiA9IFtdOwogICAgICBpZiAocGRmTWFuYWdlcikgewogICAgICAgIHBkZk1hbmFnZXIudGVybWluYXRlKG5ldyBBYm9ydEV4Y2VwdGlvbigiV29ya2VyIHdhcyB0ZXJtaW5hdGVkLiIpKTsKICAgICAgICBjb25zdCBjbGVhbnVwUHJvbWlzZSA9IHBkZk1hbmFnZXIuY2xlYW51cCgpOwogICAgICAgIHdhaXRPbi5wdXNoKGNsZWFudXBQcm9taXNlKTsKICAgICAgICBwZGZNYW5hZ2VyID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjbGVhckdsb2JhbENhY2hlcygpOwogICAgICB9CiAgICAgIGNhbmNlbFhIUnM/LihuZXcgQWJvcnRFeGNlcHRpb24oIldvcmtlciB3YXMgdGVybWluYXRlZC4iKSk7CiAgICAgIGZvciAoY29uc3QgdGFzayBvZiBXb3JrZXJUYXNrcykgewogICAgICAgIHdhaXRPbi5wdXNoKHRhc2suZmluaXNoZWQpOwogICAgICAgIHRhc2sudGVybWluYXRlKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHdhaXRPbikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgaGFuZGxlci5kZXN0cm95KCk7CiAgICAgICAgaGFuZGxlciA9IG51bGw7CiAgICAgIH0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJSZWFkeSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHNldHVwRG9jKGRvY1BhcmFtcyk7CiAgICAgIGRvY1BhcmFtcyA9IG51bGw7CiAgICB9KTsKICAgIHJldHVybiB3b3JrZXJIYW5kbGVyTmFtZTsKICB9CiAgc3RhdGljIGluaXRpYWxpemVGcm9tUG9ydChwb3J0KSB7CiAgICBjb25zdCBoYW5kbGVyID0gbmV3IE1lc3NhZ2VIYW5kbGVyKCJ3b3JrZXIiLCAibWFpbiIsIHBvcnQpOwogICAgdGhpcy5zZXR1cChoYW5kbGVyLCBwb3J0KTsKICAgIGhhbmRsZXIuc2VuZCgicmVhZHkiLCBudWxsKTsKICB9Cn0KCjsvLyAuL3NyYy9wZGYud29ya2VyLmpzCgpnbG9iYWxUaGlzLnBkZmpzV29ya2VyID0gewogIFdvcmtlck1lc3NhZ2VIYW5kbGVyOiBXb3JrZXJNZXNzYWdlSGFuZGxlcgp9OwoKZXhwb3J0IHsgV29ya2VyTWVzc2FnZUhhbmRsZXIgfTsKCi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBkZi53b3JrZXIubWpzLm1hcA==",v&&v.tagName.toUpperCase()==="SCRIPT"&&v.src||new URL("main.js",document.baseURI).href).toString();let XI=null,RI=1;const vI=document.getElementById("pdfDropZone"),si=document.getElementById("pdfFileInput"),ci=document.getElementById("pdfInfo"),Gi=document.getElementById("pdfFileName"),bi=document.getElementById("pdfPageCount"),mi=document.getElementById("pdfControls"),Bi=document.getElementById("pdfButtons"),oi=document.getElementById("pdfPreviewContainer"),Jd=document.getElementById("pdfPreviewCanvas"),_g=document.getElementById("pdfStatus"),zd=document.getElementById("importAllPagesBtn"),kd=document.getElementById("importCurrentPageBtn"),rA=document.getElementById("prevPageBtn"),UA=document.getElementById("nextPageBtn"),Wi=document.getElementById("pageIndicator"),wi=document.getElementById("totalPages"),hi=document.getElementById("currentPageNum"),OA=document.getElementById("pdfScale");vI?.addEventListener("click",()=>{si?.click()}),vI?.addEventListener("dragover",G=>{G.preventDefault(),vI.style.borderColor="var(--color-primary)",vI.style.backgroundColor="rgba(var(--color-primary-rgb), 0.1)"}),vI?.addEventListener("dragleave",()=>{vI.style.borderColor="var(--color-border)",vI.style.backgroundColor="transparent"}),vI?.addEventListener("drop",G=>{G.preventDefault(),vI.style.borderColor="var(--color-border)",vI.style.backgroundColor="transparent";const I=G.dataTransfer?.files;I&&I.length>0&&ai(I[0])}),si?.addEventListener("change",G=>{const I=G.target;I.files&&I.files.length>0&&ai(I.files[0])});async function ai(G){if(!G.type.includes("pdf")){kI("Please upload a valid PDF file","error");return}kI("Loading PDF...","loading");try{const I=await G.arrayBuffer();XI=await vl({data:I}).promise;const C=XI.numPages;RI=1,Gi&&(Gi.textContent=G.name),bi&&(bi.textContent=String(C)),wi&&(wi.textContent=String(C)),ci&&(ci.style.display="block"),mi&&(mi.style.display="block"),Bi&&(Bi.style.display="block"),oi&&(oi.style.display="block"),await EC(RI),xA(),kI(`PDF loaded successfully! ${C} pages found.`,"success")}catch(I){console.error("Error loading PDF:",I),kI("Failed to load PDF. Please try again.","error")}}async function EC(G){if(XI)try{const I=await XI.getPage(G),g=parseFloat(OA?.value||"2"),C=I.getViewport({scale:g}),A=Jd,l=A.getContext("2d");if(!l)return;A.height=C.height,A.width=C.width;const i={canvasContext:l,viewport:C};await I.render(i).promise,Wi&&(Wi.textContent=String(G)),hi&&(hi.textContent=String(G))}catch(I){console.error("Error rendering page:",I),kI("Failed to render page","error")}}function xA(){if(!XI)return;const G=XI.numPages;rA&&(rA.disabled=RI<=1),UA&&(UA.disabled=RI>=G)}rA?.addEventListener("click",async()=>{RI>1&&(RI--,await EC(RI),xA())}),UA?.addEventListener("click",async()=>{XI&&RI<XI.numPages&&(RI++,await EC(RI),xA())}),OA?.addEventListener("change",async()=>{XI&&await EC(RI)}),kd?.addEventListener("click",async()=>{if(XI){kI(`Importing page ${RI}...`,"loading");try{await Yi(RI),kI(`Page ${RI} imported successfully!`,"success")}catch(G){console.error("Error importing page:",G),kI("Failed to import page","error")}}}),zd?.addEventListener("click",async()=>{if(!XI)return;const G=XI.numPages;kI(`Importing all ${G} pages...`,"loading");try{for(let I=1;I<=G;I++)kI(`Importing page ${I} of ${G}...`,"loading"),await Yi(I),await new Promise(g=>setTimeout(g,100));kI(`All ${G} pages imported successfully!`,"success")}catch(I){console.error("Error importing pages:",I),kI("Failed to import all pages","error")}});async function Yi(G){if(!XI)return;const I=await XI.getPage(G),g=parseFloat(OA?.value||"2"),C=I.getViewport({scale:g}),A=document.createElement("canvas"),l=A.getContext("2d");if(!l)throw new Error("Could not get canvas context");A.height=C.height,A.width=C.width;const i={canvasContext:l,viewport:C};await I.render(i).promise;const d=await(await new Promise((c,b)=>{A.toBlob(m=>{m?c(m):b(new Error("Failed to convert canvas to blob"))},"image/png")})).arrayBuffer(),s=new Uint8Array(d);parent.postMessage({type:"import-pdf-page",data:Array.from(s),width:C.width,height:C.height,pageNum:G},"*")}function kI(G,I){_g&&(_g.textContent=G,_g.className=`status-message ${I}`,_g.style.display="block",(I==="success"||I==="error")&&setTimeout(()=>{_g&&(_g.style.display="none")},3e3))}const Ld=document.getElementById("sourceLanguage"),Td=document.getElementById("targetLanguage"),PC=document.getElementById("useSelectedText"),Vi=document.getElementById("textInputGroup"),jd=document.getElementById("textToTranslate"),Qd=document.getElementById("translateBtn"),ni=document.getElementById("translationResult"),fC=document.getElementById("translatedText"),qg=document.getElementById("translationStatus"),rd=document.getElementById("copyTranslationBtn"),vA=document.getElementById("replaceTextBtn");let Xg="",EA="";PC?.addEventListener("change",()=>{Vi&&(Vi.style.display=PC.checked?"none":"block"),vA&&(vA.style.display=PC.checked?"block":"none")});function Ud(){parent.postMessage({type:"get-selected-text"},"*")}window.addEventListener("message",G=>{G.data?.source==="penpot"&&G.data.type==="selected-text"&&(Xg=G.data.text||"",EA=G.data.shapeId||"",Xg?yI(`Loaded text from selection: "${Xg.substring(0,50)}${Xg.length>50?"...":""}"`,"success"):yI("No text found in selected shape","error"))}),Qd?.addEventListener("click",async()=>{let G="";if(PC?.checked){if(Xg||(yI("Getting text from selection...","loading"),Ud(),await new Promise(A=>setTimeout(A,500))),!Xg){yI("No text found in selection. Please select a text shape in Penpot.","error");return}G=Xg}else G=jd?.value||"";if(!G.trim()){yI("Please enter text to translate","error");return}const I=await pd("translation","Select a model for translation:");if(!I){yI("Operation cancelled","error");return}const g=Ld?.value||"auto",C=Td?.value||"en";yI("Translating...","loading");try{const A=g==="auto"?`Translate the following text to ${PA(C)}. Only output the translated text, nothing else:

${G}`:`Translate the following text from ${PA(g)} to ${PA(C)}. Only output the translated text, nothing else:

${G}`,l=await Sd(A,I,"translation");console.log("Translation API response:",l);const i=l.candidates[0]?.content?.parts[0]?.text||"";if(console.log("Translation result:",i),i)console.log("Setting translation text to:",i),fC&&(fC.textContent=i,console.log("translatedText element updated")),ni&&(ni.style.display="block",console.log("translationResult displayed")),yI("Translation complete!","success");else throw console.error("No translation in response:",l),new Error("No translation received")}catch(A){console.error("Translation error:",A),yI(A instanceof Error?A.message:"Translation failed","error")}}),rd?.addEventListener("click",async()=>{const G=fC?.textContent||"";console.log("Attempting to copy text:",G);try{await navigator.clipboard.writeText(G),console.log("Copied successfully"),yI("Copied to clipboard!","success")}catch(I){console.error("Clipboard API failed:",I);try{const g=document.createElement("textarea");g.value=G,g.style.position="fixed",g.style.opacity="0",document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g),console.log("Copied using fallback method"),yI("Copied to clipboard!","success")}catch(g){console.error("Fallback copy failed:",g),yI("Failed to copy","error")}}}),vA?.addEventListener("click",()=>{const G=fC?.textContent||"";if(!G||!EA){yI("No translation or selected shape","error");return}parent.postMessage({type:"replace-text",shapeId:EA,text:G},"*"),yI("Text replaced in Penpot!","success")});function PA(G){return{en:"English",es:"Spanish",fr:"French",de:"German",it:"Italian",pt:"European Portuguese",zh:"Chinese",ja:"Japanese",ko:"Korean",ar:"Arabic",ru:"Russian"}[G]||G}function yI(G,I){qg&&(qg.textContent=G,qg.className=`status-message ${I}`,qg.style.display="block",(I==="success"||I==="error")&&setTimeout(()=>{qg&&(qg.style.display="none")},3e3))}const Od=document.getElementById("loadImageBtn"),$g=document.getElementById("imageEditorCanvas"),ei=document.getElementById("imageEditOptions"),S=document.getElementById("cropCanvas"),_C=document.getElementById("cropOverlay"),xd=document.getElementById("startCropBtn"),vd=document.getElementById("resetCropBtn"),Ed=document.getElementById("flipHorizontalBtn"),Pd=document.getElementById("flipVerticalBtn"),LI=document.getElementById("cropControls"),fd=document.getElementById("applyCropBtn"),_d=document.getElementById("cancelCropBtn"),AI=document.getElementById("imageEditorStatus"),Rg=document.getElementById("brightnessSlider"),Zg=document.getElementById("brightnessValue"),yg=document.getElementById("contrastSlider"),dg=document.getElementById("contrastValue"),ug=document.getElementById("saturationSlider"),sg=document.getElementById("saturationValue"),Hg=document.getElementById("hueSlider"),cg=document.getElementById("hueValue"),Mg=document.getElementById("blurSlider"),Gg=document.getElementById("blurValue"),Dg=document.getElementById("grayscaleSlider"),bg=document.getElementById("grayscaleValue"),Kg=document.getElementById("sepiaSlider"),mg=document.getElementById("sepiaValue"),qd=document.getElementById("resetFiltersBtn"),$d=document.getElementById("applyChangesBtn");let hI=null,qC="",Bg=!1;const k={brightness:0,contrast:0,saturation:0,hue:0,blur:0,grayscale:0,sepia:0};function EI(){if(!hI)return;const G=S.getContext("2d");if(!G)return;G.clearRect(0,0,S.width,S.height);const I=[];k.brightness!==0&&I.push(`brightness(${100+k.brightness}%)`),k.contrast!==0&&I.push(`contrast(${100+k.contrast}%)`),k.saturation!==0&&I.push(`saturate(${100+k.saturation}%)`),k.hue!==0&&I.push(`hue-rotate(${k.hue}deg)`),k.blur>0&&I.push(`blur(${k.blur}px)`),k.grayscale>0&&I.push(`grayscale(${k.grayscale}%)`),k.sepia>0&&I.push(`sepia(${k.sepia}%)`),I.length>0?G.filter=I.join(" "):G.filter="none",G.drawImage(hI,0,0,S.width,S.height),G.filter="none"}Od?.addEventListener("click",()=>{iI("Loading image from selection...","loading"),parent.postMessage({type:"get-selected-image"},"*")}),window.addEventListener("message",G=>{G.data?.source==="penpot"&&G.data.type==="selected-image"&&(G.data.message?iI(G.data.message,"error"):G.data.imageData&&G.data.shapeId?Is(G.data.imageData,G.data.shapeId):iI("No image selected or image not found","error"))});function Is(G,I){if(qC=I,G.dataUrl){const l=new Image;l.onload=()=>{hI=l;const i=l.width,Z=l.height;console.log("Image loaded with ORIGINAL dimensions:",{originalShapeWidth:G.width,originalShapeHeight:G.height,canvasWidth:i,canvasHeight:Z,aspectRatio:(i/Z).toFixed(2),previewScale:G.previewScale||1}),S.width=i,S.height=Z;const d=S.getContext("2d");d&&d.drawImage(l,0,0,i,Z),$g&&($g.style.display="block"),ei&&(ei.style.display="block"),LI&&(LI.style.display="none"),Bg=!1,k.brightness=0,k.contrast=0,k.saturation=0,k.hue=0,k.blur=0,k.grayscale=0,k.sepia=0,Rg&&(Rg.value="0"),Zg&&(Zg.textContent="0"),yg&&(yg.value="0"),dg&&(dg.textContent="0"),ug&&(ug.value="0"),sg&&(sg.textContent="0"),Hg&&(Hg.value="0"),cg&&(cg.textContent="0"),Mg&&(Mg.value="0"),Gg&&(Gg.textContent="0"),Dg&&(Dg.value="0"),bg&&(bg.textContent="0"),Kg&&(Kg.value="0"),mg&&(mg.textContent="0"),iI("Image loaded! Use sliders to adjust or click operations.","success")},l.onerror=()=>{iI("Failed to load image","error")},l.src=G.dataUrl;return}const g=G.width,C=G.height;S.width=g,S.height=C;const A=S.getContext("2d");A&&(A.fillStyle="#f0f0f0",A.fillRect(0,0,g,C),A.strokeStyle="#999",A.lineWidth=2,A.strokeRect(0,0,g,C),A.fillStyle="#666",A.font="14px sans-serif",A.textAlign="center",A.fillText("Image Area",g/2,C/2-10),A.fillText(`${Math.round(G.width)} × ${Math.round(G.height)}`,g/2,C/2+10)),$g&&($g.style.display="block"),LI&&(LI.style.display="none"),Bg=!1,iI("Click 'Start Crop' and draw the area you want to keep","success")}let KI=null,X={x:0,y:0,width:0,height:0};xd?.addEventListener("click",()=>{Bg=!0,X={x:0,y:0,width:S.width,height:S.height},LI&&(LI.style.display="block"),ti(),iI("Drag the corners to adjust crop area","loading")}),vd?.addEventListener("click",()=>{Bg=!1,KI=null,LI&&(LI.style.display="none"),_C&&(_C.innerHTML=""),k.brightness=0,k.contrast=0,k.saturation=0,k.hue=0,k.blur=0,k.grayscale=0,k.sepia=0,Rg&&(Rg.value="0"),Zg&&(Zg.textContent="0"),yg&&(yg.value="0"),dg&&(dg.textContent="0"),ug&&(ug.value="0"),sg&&(sg.textContent="0"),Hg&&(Hg.value="0"),cg&&(cg.textContent="0"),Mg&&(Mg.value="0"),Gg&&(Gg.textContent="0"),Dg&&(Dg.value="0"),bg&&(bg.textContent="0"),Kg&&(Kg.value="0"),mg&&(mg.textContent="0");const G=S.getContext("2d");G&&hI&&(G.clearRect(0,0,S.width,S.height),G.drawImage(hI,0,0,S.width,S.height)),iI("Image and filters reset","success")}),Ed?.addEventListener("click",()=>{if(!S.getContext("2d")||!hI)return;const I=document.createElement("canvas");I.width=S.width,I.height=S.height;const g=I.getContext("2d");if(!g)return;g.save(),g.scale(-1,1),g.drawImage(hI,-I.width,0,I.width,I.height),g.restore();const C=new Image;C.onload=()=>{hI=C,EI(),iI("Image flipped horizontally","success"),setTimeout(()=>{AI&&(AI.style.display="none")},2e3)},C.src=I.toDataURL()}),Pd?.addEventListener("click",()=>{if(!S.getContext("2d")||!hI)return;const I=document.createElement("canvas");I.width=S.width,I.height=S.height;const g=I.getContext("2d");if(!g)return;g.save(),g.scale(1,-1),g.drawImage(hI,0,-I.height,I.width,I.height),g.restore();const C=new Image;C.onload=()=>{hI=C,EI(),iI("Image flipped vertically","success"),setTimeout(()=>{AI&&(AI.style.display="none")},2e3)},C.src=I.toDataURL()}),Rg?.addEventListener("input",G=>{const I=parseInt(G.target.value);k.brightness=I,Zg&&(Zg.textContent=I.toString()),EI()}),yg?.addEventListener("input",G=>{const I=parseInt(G.target.value);k.contrast=I,dg&&(dg.textContent=I.toString()),EI()}),ug?.addEventListener("input",G=>{const I=parseInt(G.target.value);k.saturation=I,sg&&(sg.textContent=I.toString()),EI()}),Hg?.addEventListener("input",G=>{const I=parseInt(G.target.value);k.hue=I,cg&&(cg.textContent=I.toString()),EI()}),Mg?.addEventListener("input",G=>{const I=parseInt(G.target.value);k.blur=I,Gg&&(Gg.textContent=I.toString()),EI()}),Dg?.addEventListener("input",G=>{const I=parseInt(G.target.value);k.grayscale=I,bg&&(bg.textContent=I.toString()),EI()}),Kg?.addEventListener("input",G=>{const I=parseInt(G.target.value);k.sepia=I,mg&&(mg.textContent=I.toString()),EI()}),qd?.addEventListener("click",()=>{k.brightness=0,k.contrast=0,k.saturation=0,k.hue=0,k.blur=0,k.grayscale=0,k.sepia=0,Rg&&(Rg.value="0"),Zg&&(Zg.textContent="0"),yg&&(yg.value="0"),dg&&(dg.textContent="0"),ug&&(ug.value="0"),sg&&(sg.textContent="0"),Hg&&(Hg.value="0"),cg&&(cg.textContent="0"),Mg&&(Mg.value="0"),Gg&&(Gg.textContent="0"),Dg&&(Dg.value="0"),bg&&(bg.textContent="0"),Kg&&(Kg.value="0"),mg&&(mg.textContent="0"),EI(),iI("All filters reset","success"),setTimeout(()=>{AI&&(AI.style.display="none")},2e3)}),$d?.addEventListener("click",async()=>{if(!qC||!hI){iI("No image loaded","error");return}iI("Processing and uploading image...","loading");try{const I=S.toDataURL("image/png").split(",")[1],g=atob(I),C=new Uint8Array(g.length);for(let A=0;A<g.length;A++)C[A]=g.charCodeAt(A);console.log("Applying changes with dimensions:",S.width,"x",S.height),parent.postMessage({type:"upload-cropped-image",imageData:Array.from(C),shapeId:qC,width:S.width,height:S.height},"*"),iI("Image updated successfully!","success"),setTimeout(()=>{AI&&(AI.style.display="none")},3e3)}catch(G){console.error("Error applying changes:",G),iI("Failed to apply changes","error")}}),S?.addEventListener("mousedown",G=>{if(!Bg)return;const I=S.getBoundingClientRect(),g=S.width/I.width,C=S.height/I.height,A=(G.clientX-I.left)*g,l=(G.clientY-I.top)*C,i=20;Math.abs(A-X.x)<i&&Math.abs(l-X.y)<i?KI="tl":Math.abs(A-(X.x+X.width))<i&&Math.abs(l-X.y)<i?KI="tr":Math.abs(A-X.x)<i&&Math.abs(l-(X.y+X.height))<i?KI="bl":Math.abs(A-(X.x+X.width))<i&&Math.abs(l-(X.y+X.height))<i&&(KI="br")}),S?.addEventListener("mousemove",G=>{if(!Bg||!KI)return;const I=S.getBoundingClientRect(),g=S.width/I.width,C=S.height/I.height,A=Math.max(0,Math.min(S.width,(G.clientX-I.left)*g)),l=Math.max(0,Math.min(S.height,(G.clientY-I.top)*C));if(KI==="tl"){const i=X.x+X.width-A,Z=X.y+X.height-l;i>20&&Z>20&&(X.x=A,X.y=l,X.width=i,X.height=Z)}else if(KI==="tr"){const i=A-X.x,Z=X.y+X.height-l;i>20&&Z>20&&(X.width=i,X.y=l,X.height=Z)}else if(KI==="bl"){const i=X.x+X.width-A,Z=l-X.y;i>20&&Z>20&&(X.x=A,X.width=i,X.height=Z)}else if(KI==="br"){const i=A-X.x,Z=l-X.y;i>20&&Z>20&&(X.width=i,X.height=Z)}ti()}),S?.addEventListener("mouseup",()=>{KI=null});function ti(){const G=S.getContext("2d");if(!G)return;G.clearRect(0,0,S.width,S.height),hI&&G.drawImage(hI,0,0,S.width,S.height),G.fillStyle="rgba(0, 0, 0, 0.5)",G.fillRect(0,0,S.width,X.y),G.fillRect(0,X.y+X.height,S.width,S.height-X.y-X.height),G.fillRect(0,X.y,X.x,X.height),G.fillRect(X.x+X.width,X.y,S.width-X.x-X.width,X.height),G.strokeStyle="#6366f1",G.lineWidth=2,G.strokeRect(X.x,X.y,X.width,X.height);const I=10;G.fillStyle="#6366f1",G.fillRect(X.x-I/2,X.y-I/2,I,I),G.fillRect(X.x+X.width-I/2,X.y-I/2,I,I),G.fillRect(X.x-I/2,X.y+X.height-I/2,I,I),G.fillRect(X.x+X.width-I/2,X.y+X.height-I/2,I,I),G.fillStyle="#6366f1",G.font="bold 14px sans-serif",G.fillText(`${Math.round(X.width)} × ${Math.round(X.height)}px`,X.x+5,X.y+20)}fd?.addEventListener("click",async()=>{if(!X||X.width===0||X.height===0){iI("No crop area selected","error");return}if(!hI){iI("No image loaded","error");return}iI("Processing crop...","loading");try{console.log("Crop area (in pixels):",{x:X.x,y:X.y,width:X.width,height:X.height});const G=document.createElement("canvas");G.width=X.width,G.height=X.height;const I=G.getContext("2d");if(!I)throw new Error("Could not get canvas context");I.drawImage(hI,X.x,X.y,X.width,X.height,0,0,X.width,X.height);const C=await(await new Promise((l,i)=>{G.toBlob(Z=>{Z?l(Z):i(new Error("Failed to create blob"))},"image/png")})).arrayBuffer(),A=new Uint8Array(C);console.log("Crop output:",{blobSize:A.length+" bytes",width:X.width,height:X.height}),parent.postMessage({type:"upload-cropped-image",imageData:Array.from(A),width:X.width,height:X.height,originalX:X.x,originalY:X.y,shapeId:qC},"*"),iI("Uploading cropped image...","loading")}catch(G){console.error("Crop error:",G),iI("Failed to crop image","error")}}),window.addEventListener("message",G=>{G.data.source==="penpot"&&G.data.type==="crop-success"&&(iI("Image cropped successfully!","success"),setTimeout(()=>{$g&&($g.style.display="none"),LI&&(LI.style.display="none"),Bg=!1,KI=null},1500))}),_d?.addEventListener("click",()=>{Bg=!1,KI=null,LI&&(LI.style.display="none"),_C&&(_C.innerHTML="");const G=S.getContext("2d");G&&hI&&(G.clearRect(0,0,S.width,S.height),G.drawImage(hI,0,0,S.width,S.height))});function iI(G,I){AI&&(AI.textContent=G,AI.className=`status-message ${I}`,AI.style.display="block",(I==="success"||I==="error")&&setTimeout(()=>{AI&&(AI.style.display="none")},3e3))}const gs=document.querySelector("#removeBgBtn");function og(G,I){AI&&(AI.textContent=G,AI.className=`status-message ${I}`,AI.style.display="block",(I==="success"||I==="error")&&setTimeout(()=>{AI&&(AI.style.display="none")},3e3))}gs?.addEventListener("click",async()=>{og("Requesting image from Penpot...","loading"),parent.postMessage({type:"get-image-for-bg-removal"},"*")}),window.addEventListener("message",async G=>{if(G.data.source==="penpot"&&G.data.type==="image-for-bg-removal"){if(!G.data.imageData){og("Please select an image in Penpot first","error");return}try{og("Click on the background color to remove...","loading");const I=G.data.width,g=G.data.height;console.log("Original image dimensions:",I,g);const C=G.data.imageData,A=new Image;A.crossOrigin="anonymous",A.onload=()=>{const l=document.createElement("canvas"),Z=Math.min(1,400/Math.max(I,g)),d=I*Z,s=g*Z;l.width=d,l.height=s,l.style.cursor="crosshair",l.style.border="2px solid var(--color-accent)",l.style.maxWidth="100%",l.style.display="block",l.style.margin="0 auto";const c=l.getContext("2d");if(!c)throw new Error("Failed to get preview context");c.drawImage(A,0,0,d,s),og("Click on the background color you want to remove","success");const b=document.querySelector("#image-editor");b&&AI&&b.insertBefore(l,AI),l.addEventListener("click",m=>{const B=l.getBoundingClientRect(),W=Math.floor((m.clientX-B.left)*(d/B.width)),o=Math.floor((m.clientY-B.top)*(s/B.height)),h=c.getImageData(W,o,1,1).data,w={r:h[0],g:h[1],b:h[2]};console.log("Selected background color:",w),l.remove(),og("Removing background...","loading");const a=document.createElement("canvas");a.width=I,a.height=g;const Y=a.getContext("2d",{alpha:!0});if(!Y)throw new Error("Failed to get canvas context");Y.drawImage(A,0,0,I,g);const V=Y.getImageData(0,0,I,g),n=V.data,e=50;let t=0;for(let N=0;N<n.length;N+=4){const R=n[N],H=n[N+1],y=n[N+2];Math.abs(R-w.r)<=e&&Math.abs(H-w.g)<=e&&Math.abs(y-w.b)<=e&&(n[N+3]=0,t++)}console.log("Pixels made transparent:",t),Y.putImageData(V,0,0),a.toBlob(N=>{N&&N.arrayBuffer().then(R=>{const H=new Uint8Array(R);og("Uploading result to Penpot...","loading"),parent.postMessage({type:"upload-bg-removed-image",imageData:Array.from(H),originalShapeId:G.data.shapeId,width:I,height:g},"*")})},"image/png",1)})},A.onerror=()=>{throw new Error("Failed to load image")},A.src=C}catch(I){console.error("Background removal error:",I),og(I instanceof Error?I.message:"Failed to remove background","error")}}G.data.source==="penpot"&&G.data.type==="bg-removal-success"&&og("Background removed successfully!","success")})})();
//# sourceMappingURL=main.js.map
