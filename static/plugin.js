(function(){"use strict";penpot.ui.open("Penpot AI Designer","ui.html",{width:440,height:600});function x(){const o=penpot.selection;if(!o||o.length===0)return{context:"",width:500,height:500,svg:""};const t=new Set,e=[];let s=!1,n=!1,i=!1,c=0,r=0,a=1/0,g=1/0,p=-1/0,d=-1/0;o.forEach(l=>{l.x!==void 0&&l.y!==void 0&&l.width&&l.height&&(a=Math.min(a,l.x),g=Math.min(g,l.y),p=Math.max(p,l.x+l.width),d=Math.max(d,l.y+l.height)),l.fills&&Array.isArray(l.fills)&&l.fills.forEach(u=>{u.fillColor&&(t.add(u.fillColor),n=!0,r++)}),l.strokes&&Array.isArray(l.strokes)&&l.strokes.forEach(u=>{u.strokeColor&&(t.add(u.strokeColor),i=!0,c++)}),l.type==="text"?s=!0:l.type==="rectangle"?e.push("rectangles"):l.type==="ellipse"?e.push("circles/ellipses"):l.type==="path"&&e.push("custom paths")});let h="";const f=o.length>0;console.log("Selection analysis:",{selectionCount:o.length,hasStrokes:i,hasFills:n,strokeCount:c,fillCount:r,colorsFound:t.size,shapesFound:e.length}),f&&(i&&!n?h+="IMPORTANT STYLE: Create a SIMPLE LINE DRAWING with outlines only, NO FILLS. Use minimalist line art style. ":!i&&n?h+="STYLE: Use solid filled shapes without outlines. ":c>r*2?h+="IMPORTANT STYLE: Emphasize line work and outlines over fills. Keep it minimal. ":!i&&!n&&e.length>0&&(h+="IMPORTANT STYLE: Create a SIMPLE LINE DRAWING with clean outlines. Use minimalist line art style with NO FILLS. ")),t.size>0&&(h+=`Use these colors: ${Array.from(t).join(", ")}. `),e.length>0&&(h+=`Incorporate similar shapes like ${[...new Set(e)].join(", ")}. `),s&&(h+="Include text elements in the design. "),f&&!h&&(h=`${o.length} element${o.length>1?"s":""} selected. `);const m=p>a?Math.round(p-a):500,y=d>g?Math.round(d-g):500;return{context:h,width:m,height:y,svg:""}}penpot.on("selectionchange",()=>{const{context:o,width:t,height:e,svg:s}=x();penpot.ui.sendMessage({source:"penpot",type:"selection-context",context:o,width:t,height:e,svg:s})}),setTimeout(()=>{const{context:o,width:t,height:e,svg:s}=x();penpot.ui.sendMessage({source:"penpot",type:"selection-context",context:o,width:t,height:e,svg:s})},100),penpot.ui.onMessage(async o=>{if(o.type==="import-svg"||o.type==="insert-svg")try{const t=o.svg||o.content;if(!t)throw new Error("No SVG content provided");const e=penpot.createShapeFromSvg(t);if(e){const s=o.offsetX||0;e.x=penpot.viewport.center.x-(e.width||0)/2+s,e.y=penpot.viewport.center.y-(e.height||0)/2,penpot.selection=[e],penpot.ui.sendMessage({source:"penpot",type:"import-success"})}else throw new Error("Failed to create SVG shape")}catch(t){console.error("SVG import error:",t),penpot.ui.sendMessage({source:"penpot",type:"import-error",error:t instanceof Error?t.message:"Unknown error"})}if(o.type==="import-pdf-page")try{if(!o.data)throw new Error("No data provided");const t=new Uint8Array(o.data),e=`PDF Page ${o.pageNum}`,s=await penpot.uploadMediaData(e,t,"image/png");if(s){const n=penpot.createRectangle();if(n){n.fills=[{fillOpacity:1,fillImage:s}];const i=o.width||500,c=o.height||500,r=o.pageNum||1;n.resize(i,c);const a=(r-1)*(c+50);n.x=penpot.viewport.center.x-i/2,n.y=penpot.viewport.center.y-c/2+a,n.name=e,penpot.selection=[n]}}}catch(t){console.error("PDF import error:",t),penpot.ui.sendMessage({source:"penpot",type:"import-error",error:t instanceof Error?t.message:"Unknown error"})}if(o.type==="get-selected-text"){const t=penpot.selection;if(t&&t.length>0){const e=t[0];e.type==="text"?penpot.ui.sendMessage({source:"penpot",type:"selected-text",text:e.characters||"",shapeId:e.id}):penpot.ui.sendMessage({source:"penpot",type:"selected-text",text:"",shapeId:""})}else penpot.ui.sendMessage({source:"penpot",type:"selected-text",text:"",shapeId:""})}if(o.type==="replace-text"){const t=penpot.selection;if(t&&t.length>0){const e=t[0];e.type==="text"&&o.text!==void 0&&(e.characters=o.text)}}if(o.type==="get-selected-image"){const t=penpot.selection;if(console.log("Get selected image request, selection:",t),t&&t.length>0){const e=t[0];if(console.log("Shape type:",e.type),console.log("Shape fills:",e.fills),e.type==="rectangle"&&e.fills&&e.fills.length>0){console.log("Checking fills for image...");const s=e.fills.find(n=>n.fillImage);if(console.log("Image fill found:",s),s&&s.fillImage){console.log("fillImage object:",s.fillImage),console.log("fillImage keys:",Object.keys(s.fillImage));const n={x:e.x,y:e.y,width:e.width,height:e.height,imageName:s.fillImage.name,imageAssetId:s.fillImage.id};try{console.log("Exporting preview at 1.0 scale without borders...");const i=e.strokes,c=e.borderRadius;e.strokes=[],e.borderRadius&&(e.borderRadius=0);const r=await e.export({type:"png",scale:1});if(e.strokes=i,c&&(e.borderRadius=c),console.log("Preview export successful, size:",r?.length),r&&r.length>0){const a=new Uint8Array(r),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";let p="";for(let d=0;d<a.length;d+=3){const h=a[d],f=d+1<a.length?a[d+1]:0,m=d+2<a.length?a[d+2]:0,y=h>>2,w=(h&3)<<4|f>>4,l=(f&15)<<2|m>>6,u=m&63;p+=g[y],p+=g[w],p+=d+1<a.length?g[l]:"=",p+=d+2<a.length?g[u]:"="}n.dataUrl=`data:image/png;base64,${p}`,n.previewScale=1,console.log("Preview base64 conversion successful")}}catch(i){console.error("Preview export failed:",i)}penpot.ui.sendMessage({source:"penpot",type:"selected-image",imageData:n,shapeId:e.id});return}}}console.log("No image found in selection"),penpot.ui.sendMessage({source:"penpot",type:"selected-image",imageData:null,shapeId:null})}if(o.type==="upload-cropped-image")try{const t=penpot.selection;if(t&&t.length>0){const e=t[0];if(!o.imageData)throw new Error("No image data provided");const s=new Uint8Array(o.imageData);console.log("Uploading cropped image from canvas, size:",s.length,"dimensions from message:",o.width,"x",o.height);const n=await penpot.uploadMediaData("Cropped Image",s,"image/png");if(n){console.log("Image asset created with dimensions:",n.width,"x",n.height);const i=penpot.createRectangle();if(i){const c=o.width||n.width||e.width||100,r=o.height||n.height||e.height||100,a=o.originalX||0,g=o.originalY||0;console.log("Setting cropped shape dimensions to:",c,r),i.x=e.x+a,i.y=e.y+g,i.resize(c,r),i.fills=[{fillOpacity:1,fillImage:n}],i.name="Cropped Image",i.strokes=[],i.proportionLock=!0,penpot.selection=[i],console.log("Cropped image created. Final dimensions:",i.width,"x",i.height),penpot.ui.sendMessage({source:"penpot",type:"crop-success"})}}}}catch(t){console.error("Upload cropped image error:",t),penpot.ui.sendMessage({source:"penpot",type:"crop-error",error:t instanceof Error?t.message:"Unknown error"})}if(o.type==="get-image-for-bg-removal"){const t=penpot.selection;if(t&&t.length>0){const e=t[0];if(e.type==="rectangle"&&e.fills&&e.fills.length>0){const s=e.fills.find(n=>n.fillImage);if(s&&s.fillImage)try{console.log("Exporting image for background removal...");const n=e.strokes,i=e.borderRadius;e.strokes=[],e.borderRadius&&(e.borderRadius=0);const c=await e.export({type:"png",scale:1});if(e.strokes=n,i&&(e.borderRadius=i),c&&c.length>0){const r=new Uint8Array(c),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";let g="";for(let p=0;p<r.length;p+=3){const d=r[p],h=p+1<r.length?r[p+1]:0,f=p+2<r.length?r[p+2]:0,m=d>>2,y=(d&3)<<4|h>>4,w=(h&15)<<2|f>>6,l=f&63;g+=a[m],g+=a[y],g+=p+1<r.length?a[w]:"=",g+=p+2<r.length?a[l]:"="}penpot.ui.sendMessage({source:"penpot",type:"image-for-bg-removal",imageData:`data:image/png;base64,${g}`,shapeId:e.id,width:e.width,height:e.height});return}}catch(n){console.error("Export for bg removal failed:",n)}}}penpot.ui.sendMessage({source:"penpot",type:"image-for-bg-removal",imageData:null,shapeId:null})}if(o.type==="upload-bg-removed-image")try{const t=penpot.selection;if(t&&t.length>0){const e=t[0];if(!o.imageData)throw new Error("No image data provided");const s=new Uint8Array(o.imageData);console.log("Uploading background-removed image, size:",s.length,"dimensions:",o.width,"x",o.height);const n=await penpot.uploadMediaData("Background Removed",s,"image/png");if(n){console.log("Image asset created:",n),console.log("Image asset width:",n.width),console.log("Image asset height:",n.height);const i=penpot.createRectangle();if(i){const c=o.width||n.width||e.width||100,r=o.height||n.height||e.height||100;console.log("Message dimensions:",o.width,"x",o.height),console.log("Asset dimensions:",n.width,"x",n.height),console.log("Setting shape dimensions to:",c,"x",r),i.x=e.x,i.y=e.y,i.resize(c,r),i.fills=[{fillOpacity:1,fillImage:n}],i.name="Background Removed",i.strokes=[],i.proportionLock=!0,console.log("Background-removed image created. Final dimensions:",i.width,"x",i.height),penpot.selection=[i],console.log("Background-removed image created with dimensions:",i.width,"x",i.height),penpot.ui.sendMessage({source:"penpot",type:"bg-removal-success"})}}}}catch(t){console.error("Upload background-removed image error:",t),penpot.ui.sendMessage({source:"penpot",type:"bg-removal-error",error:t instanceof Error?t.message:"Unknown error"})}}),penpot.on("themechange",o=>{penpot.ui.sendMessage({source:"penpot",type:"themechange",theme:o})})})();
//# sourceMappingURL=plugin.js.map
