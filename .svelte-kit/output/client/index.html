<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matilha Collective Tools</title>
  </head>
  <body>
    <h2>Matilha Collective Tools</h2>

    <!-- Tab Navigation -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="image-editor">
        Image Editor
      </button>
      <button class="tab-btn" data-tab="image-tracing">Image Tracing</button>
      <button class="tab-btn" data-tab="pdf-import">PDF Import</button>
      <button class="tab-btn" data-tab="translation">Translation</button>
    </div>

    <!-- Tab Content: Image Editor -->
    <div class="tab-content active" id="image-editor">
      <div class="form-group">
        <label>Select Image from Penpot</label>
        <button
          type="button"
          data-appearance="secondary"
          id="loadImageBtn"
          style="width: 100%; margin-bottom: 8px"
        >
          Load Selected Image
        </button>
        <small
          >Select an image in Penpot, then click to load it for editing</small
        >
      </div>

      <div
        id="imageEditorCanvas"
        style="
          display: none;
          position: sticky;
          top: 0;
          z-index: 100;
          background: var(--color-background-primary);
          padding: 8px 0;
          margin-bottom: 12px;
          border-bottom: 1px solid var(--color-border);
        "
      >
        <div
          style="
            position: relative;
            display: inline-block;
            max-width: 100%;
            max-height: 250px;
            overflow: auto;
          "
        >
          <canvas
            id="cropCanvas"
            style="
              max-width: 100%;
              max-height: 250px;
              width: auto;
              height: auto;
              object-fit: contain;
              border: 2px solid var(--color-primary);
              cursor: crosshair;
              display: block;
            "
          ></canvas>
          <div
            id="cropOverlay"
            style="position: absolute; top: 0; left: 0; pointer-events: none"
          ></div>
        </div>
      </div>

      <div id="imageEditOptions" style="display: none; margin-bottom: 16px">
        <div class="form-group">
          <label>Image Operations</label>
          <div
            style="
              display: flex;
              gap: 8px;
              flex-wrap: wrap;
              margin-bottom: 12px;
            "
          >
            <button
              type="button"
              id="startCropBtn"
              data-appearance="secondary"
              style="flex: 1; min-width: 120px"
            >
              ‚úÇÔ∏è Crop Image
            </button>
            <button
              type="button"
              id="resetCropBtn"
              data-appearance="secondary"
              style="flex: 1; min-width: 120px"
            >
              ‚Ü∫ Reset
            </button>
          </div>

          <div
            style="
              display: flex;
              gap: 8px;
              flex-wrap: wrap;
              margin-bottom: 12px;
            "
          >
            <button
              type="button"
              id="flipHorizontalBtn"
              data-appearance="secondary"
              style="flex: 1; min-width: 120px"
            >
              ‚ÜîÔ∏è Flip H
            </button>
            <button
              type="button"
              id="flipVerticalBtn"
              data-appearance="secondary"
              style="flex: 1; min-width: 120px"
            >
              ‚ÜïÔ∏è Flip V
            </button>
          </div>

          <details class="options-section" style="margin-bottom: 12px">
            <summary>üé® Adjust Colors & Filters</summary>

            <div class="form-group">
              <label for="brightnessSlider">
                Brightness: <span id="brightnessValue">0</span>
              </label>
              <input
                type="range"
                id="brightnessSlider"
                min="-100"
                max="100"
                value="0"
                style="width: 100%"
              />
            </div>

            <div class="form-group">
              <label for="contrastSlider">
                Contrast: <span id="contrastValue">0</span>
              </label>
              <input
                type="range"
                id="contrastSlider"
                min="-100"
                max="100"
                value="0"
                style="width: 100%"
              />
            </div>

            <div class="form-group">
              <label for="saturationSlider">
                Saturation: <span id="saturationValue">0</span>
              </label>
              <input
                type="range"
                id="saturationSlider"
                min="-100"
                max="100"
                value="0"
                style="width: 100%"
              />
            </div>

            <div class="form-group">
              <label for="hueSlider">
                Hue Shift: <span id="hueValue">0</span>¬∞
              </label>
              <input
                type="range"
                id="hueSlider"
                min="0"
                max="360"
                value="0"
                style="width: 100%"
              />
            </div>

            <div class="form-group">
              <label for="blurSlider">
                Blur: <span id="blurValue">0</span>px
              </label>
              <input
                type="range"
                id="blurSlider"
                min="0"
                max="20"
                value="0"
                style="width: 100%"
              />
            </div>

            <div class="form-group">
              <label for="grayscaleSlider">
                Grayscale: <span id="grayscaleValue">0</span>%
              </label>
              <input
                type="range"
                id="grayscaleSlider"
                min="0"
                max="100"
                value="0"
                style="width: 100%"
              />
            </div>

            <div class="form-group">
              <label for="sepiaSlider">
                Sepia: <span id="sepiaValue">0</span>%
              </label>
              <input
                type="range"
                id="sepiaSlider"
                min="0"
                max="100"
                value="0"
                style="width: 100%"
              />
            </div>

            <button
              type="button"
              data-appearance="secondary"
              id="resetFiltersBtn"
              style="width: 100%; margin-top: 8px"
            >
              Reset All Filters
            </button>
          </details>

          <button
            type="button"
            data-appearance="primary"
            id="removeBgBtn"
            style="width: 100%; margin-bottom: 8px"
          >
            üéØ Remove Background (AI)
          </button>

          <button
            type="button"
            data-appearance="primary"
            id="applyChangesBtn"
            style="width: 100%; margin-top: 12px"
          >
            üíæ Apply Changes & Replace in Penpot
          </button>
        </div>
      </div>

      <div id="cropControls" style="display: none; margin-bottom: 16px">
        <div
          style="
            padding: 12px;
            background: var(--color-background-secondary);
            border-radius: 4px;
            margin-bottom: 8px;
          "
        >
          <div style="font-size: 13px; margin-bottom: 4px">Crop Selection</div>
          <div
            style="font-size: 11px; color: var(--color-foreground-secondary)"
          >
            Click and drag on the canvas to select area to crop
          </div>
        </div>

        <button
          type="button"
          data-appearance="primary"
          id="applyCropBtn"
          style="width: 100%; margin-bottom: 8px"
        >
          Apply Crop & Replace in Penpot
        </button>
        <button
          type="button"
          data-appearance="secondary"
          id="cancelCropBtn"
          style="width: 100%"
        >
          Cancel Crop
        </button>
      </div>

      <div id="imageEditorStatus" class="status-message"></div>
    </div>
    <!-- End Tab Content: Image Editor -->

    <!-- Tab Content: Image Tracing -->
    <div class="tab-content" id="image-tracing">
      <div class="form-group">
        <label>Image Tracing (PNG ‚Üí SVG)</label>
        <div id="traceDropZone" class="drop-zone">
          <span id="traceDropZoneText">üñåÔ∏è Drop PNG/JPG to trace into SVG</span>
          <img
            id="tracePreviewImage"
            style="
              display: none;
              max-width: 100%;
              max-height: 150px;
              border-radius: 4px;
              margin-top: 8px;
            "
          />
        </div>
        <input
          type="file"
          id="traceFileInput"
          accept="image/*"
          style="display: none"
        />
        <button
          type="button"
          data-appearance="primary"
          id="traceBtn"
          style="display: none; margin-top: 8px; width: 100%"
        >
          Trace to SVG
        </button>
        <small>Convert bitmap images to vector SVG paths</small>
      </div>
    </div>
    <!-- End Tab Content: Image Tracing -->

    <!-- Tab Content: PDF Import -->
    <div class="tab-content" id="pdf-import">
      <div class="form-group">
        <label>Upload PDF Presentation</label>
        <div id="pdfDropZone" class="drop-zone">
          <span id="pdfDropZoneText">üìÑ Drop PDF or click to upload</span>
        </div>
        <input
          type="file"
          id="pdfFileInput"
          accept=".pdf"
          style="display: none"
        />
        <small>Upload a PDF presentation to import slides into Penpot</small>
      </div>

      <div id="pdfInfo" style="display: none; margin-bottom: 16px">
        <strong>PDF Loaded:</strong> <span id="pdfFileName"></span><br />
        <strong>Pages:</strong> <span id="pdfPageCount"></span>
      </div>

      <div class="form-group" style="display: none" id="pdfControls">
        <label for="pdfScale">Image Quality (Scale)</label>
        <select id="pdfScale">
          <option value="1">Standard (1x)</option>
          <option value="2" selected>High (2x)</option>
          <option value="3">Very High (3x)</option>
        </select>
        <small>Higher quality creates larger images but better clarity</small>
      </div>

      <div id="pdfButtons" style="display: none; margin-top: 16px">
        <button
          type="button"
          data-appearance="primary"
          id="importAllPagesBtn"
          style="width: 100%; margin-bottom: 8px"
        >
          Import All Pages
        </button>
        <button
          type="button"
          data-appearance="secondary"
          id="importCurrentPageBtn"
          style="width: 100%"
        >
          Import Page <span id="currentPageNum">1</span>
        </button>
        <div
          style="display: flex; gap: 8px; margin-top: 8px; align-items: center"
        >
          <button type="button" id="prevPageBtn" style="flex: 1">
            ‚Üê Previous
          </button>
          <span style="padding: 0 8px"
            >Page <span id="pageIndicator">1</span> of
            <span id="totalPages">1</span></span
          >
          <button type="button" id="nextPageBtn" style="flex: 1">Next ‚Üí</button>
        </div>
      </div>

      <div id="pdfPreviewContainer" style="margin-top: 16px; display: none">
        <canvas
          id="pdfPreviewCanvas"
          style="
            max-width: 100%;
            border: 1px solid var(--color-border);
            border-radius: 4px;
          "
        ></canvas>
      </div>

      <div id="pdfStatus" class="status-message"></div>
    </div>
    <!-- End Tab Content: PDF Import -->

    <!-- Tab Content: Translation -->
    <div class="tab-content" id="translation">
      <div class="form-group">
        <label for="sourceLanguage">Source Language</label>
        <select id="sourceLanguage">
          <option value="auto">Auto-detect</option>
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="it">Italian</option>
          <option value="pt">European Portuguese</option>
          <option value="zh">Chinese</option>
          <option value="ja">Japanese</option>
          <option value="ko">Korean</option>
          <option value="ar">Arabic</option>
          <option value="ru">Russian</option>
        </select>
      </div>

      <div class="form-group">
        <label for="targetLanguage">Target Language</label>
        <select id="targetLanguage">
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="it">Italian</option>
          <option value="pt">European Portuguese</option>
          <option value="zh">Chinese</option>
          <option value="ja">Japanese</option>
          <option value="ko">Korean</option>
          <option value="ar">Arabic</option>
          <option value="ru">Russian</option>
        </select>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" id="useSelectedText" />
          Use selected text from Penpot
        </label>
        <small
          >Check this to translate text from selected shapes in Penpot</small
        >
      </div>

      <div class="form-group" id="textInputGroup">
        <label for="textToTranslate">Text to Translate</label>
        <textarea
          id="textToTranslate"
          rows="5"
          placeholder="Enter or paste text to translate..."
        ></textarea>
      </div>

      <button
        type="button"
        data-appearance="primary"
        id="translateBtn"
        style="width: 100%; margin-bottom: 16px"
      >
        Translate
      </button>

      <div id="translationResult" style="display: none; margin-top: 16px">
        <label>Translation</label>
        <div
          id="translatedText"
          style="
            padding: 12px;
            background: var(--color-background-secondary);
            border-radius: 4px;
            white-space: pre-wrap;
            margin-bottom: 8px;
          "
        ></div>
        <button
          type="button"
          data-appearance="secondary"
          id="copyTranslationBtn"
          style="width: 100%; margin-bottom: 8px"
        >
          Copy Translation
        </button>
        <button
          type="button"
          data-appearance="secondary"
          id="replaceTextBtn"
          style="width: 100%; display: none"
        >
          Replace Selected Text in Penpot
        </button>
      </div>

      <div id="translationStatus" class="status-message"></div>
    </div>
    <!-- End Tab Content: Translation -->

    <!-- Model Selection Modal -->
    <div id="modelModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Select AI Model</h3>
          <button id="closeModal" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <p id="modalDescription">Choose a model for this task:</p>
          <div id="modelLoadingState" style="text-align: center; padding: 20px">
            <div class="spinner"></div>
            <p>Loading available models...</p>
          </div>
          <div
            id="modelList"
            style="display: none; max-height: 400px; overflow-y: auto"
          ></div>
        </div>
        <div class="modal-footer">
          <button
            id="cancelModelSelection"
            data-appearance="secondary"
            type="button"
          >
            Cancel
          </button>
          <button id="confirmModelSelection" type="button" disabled>
            Continue
          </button>
        </div>
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
